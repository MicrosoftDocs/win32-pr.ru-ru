---
title: Подписка на события модели автоматизации пользовательского интерфейса
description: Автоматизация пользовательского интерфейса Майкрософт позволяет клиентам подписываться на интересующие вас события. Эта возможность повышает производительность, устраняя необходимость постоянного опроса элементов пользовательского интерфейса в системе, чтобы проверить, изменились ли сведения, структура или состояние.
ms.assetid: 7019ecb8-6123-4e00-926c-6725d7e71385
keywords:
- Клиенты, события модели автоматизации пользовательского интерфейса
- Клиенты, события для автоматизации пользовательского интерфейса
- Модель автоматизации пользовательского интерфейса, события для клиентов
- Модель автоматизации пользовательского интерфейса, события клиента
- Автоматизация пользовательского интерфейса, подписка на события
- Модель автоматизации пользовательского интерфейса, методы подписки
- Модель автоматизации пользовательского интерфейса, примеры кода
- Модель автоматизации пользовательского интерфейса, примеры
- Модель автоматизации пользовательского интерфейса, примеры
- подписка на события модели автоматизации пользовательского интерфейса
- события, подписка на модель автоматизации пользовательского интерфейса
- Примеры
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5d9a89df1b9d2afc401e07b6cd77d1307d912f11
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104330360"
---
# <a name="subscribing-to-ui-automation-events"></a><span data-ttu-id="f50c6-116">Подписка на события модели автоматизации пользовательского интерфейса</span><span class="sxs-lookup"><span data-stu-id="f50c6-116">Subscribing to UI Automation Events</span></span>

<span data-ttu-id="f50c6-117">Автоматизация пользовательского интерфейса Майкрософт позволяет клиентам подписываться на интересующие вас события.</span><span class="sxs-lookup"><span data-stu-id="f50c6-117">Microsoft UI Automation allows clients to subscribe to events of interest.</span></span> <span data-ttu-id="f50c6-118">Эта возможность повышает производительность, устраняя необходимость постоянного опроса элементов пользовательского интерфейса в системе, чтобы проверить, изменились ли сведения, структура или состояние.</span><span class="sxs-lookup"><span data-stu-id="f50c6-118">This capability improves performance by eliminating the need to continually poll the UI elements in the system to see if any information, structure, or state has changed.</span></span>

<span data-ttu-id="f50c6-119">Эффективность также повышается благодаря возможности прослушивания событий только в заданной области.</span><span class="sxs-lookup"><span data-stu-id="f50c6-119">Efficiency is also improved by the ability to listen for events only within a defined scope.</span></span> <span data-ttu-id="f50c6-120">Например, клиент может прослушивать изменения выбора на элементе списка, в самом списке или во всем диалоговом окне.</span><span class="sxs-lookup"><span data-stu-id="f50c6-120">For example, a client can listen for selection changes on an item in a list, on the list itself, or on an entire dialog box.</span></span>

> [!Note]  
> <span data-ttu-id="f50c6-121">Не считайте, что все возможные события вызываются поставщиком автоматизации пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="f50c6-121">Do not assume that all possible events are raised by a UI Automation provider.</span></span> <span data-ttu-id="f50c6-122">Например, не все изменения свойств приводят к возникновению событий стандартными поставщиками прокси для Windows Forms и элементов управления Microsoft Win32.</span><span class="sxs-lookup"><span data-stu-id="f50c6-122">For example, not all property changes cause events to be raised by the standard proxy providers for Windows Forms and Microsoft Win32 controls.</span></span>

 

<span data-ttu-id="f50c6-123">Более широкое представление о событиях модели автоматизации пользовательского интерфейса см. в разделе [Общие сведения о событиях модели автоматизации пользовательского интерфейса](uiauto-eventsoverview.md).</span><span class="sxs-lookup"><span data-stu-id="f50c6-123">For a broader view of UI Automation events, see [UI Automation Events Overview](uiauto-eventsoverview.md).</span></span>

> [!Note]  
> <span data-ttu-id="f50c6-124">Перед реализацией обработчика событий необходимо ознакомиться с проблемами, описанными в разделе [Общие сведения о проблемах с потоками](uiauto-threading.md).</span><span class="sxs-lookup"><span data-stu-id="f50c6-124">Before implementing an event handler, you should be familiar with the threading issues described in [Understanding Threading Issues](uiauto-threading.md).</span></span>

 

<span data-ttu-id="f50c6-125">В этом разделе содержатся следующие подразделы.</span><span class="sxs-lookup"><span data-stu-id="f50c6-125">This topic contains the following sections.</span></span>

-   [<span data-ttu-id="f50c6-126">Регистрация обработчиков событий</span><span class="sxs-lookup"><span data-stu-id="f50c6-126">Registering Event Handlers</span></span>](#registering-event-handlers)
-   [<span data-ttu-id="f50c6-127">Примеры</span><span class="sxs-lookup"><span data-stu-id="f50c6-127">Examples</span></span>](#examples)
-   [<span data-ttu-id="f50c6-128">См. также</span><span class="sxs-lookup"><span data-stu-id="f50c6-128">Related topics</span></span>](#related-topics)

## <a name="registering-event-handlers"></a><span data-ttu-id="f50c6-129">Регистрация обработчиков событий</span><span class="sxs-lookup"><span data-stu-id="f50c6-129">Registering Event Handlers</span></span>

<span data-ttu-id="f50c6-130">Клиентские приложения подписываются на события определенного типа путем регистрации обработчика событий с помощью одного из следующих методов [**иуиаутоматион**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomation) .</span><span class="sxs-lookup"><span data-stu-id="f50c6-130">Client applications subscribe to events of a particular kind by registering an event handler, using one of the following [**IUIAutomation**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomation) methods.</span></span>



| <span data-ttu-id="f50c6-131">Метод подписки</span><span class="sxs-lookup"><span data-stu-id="f50c6-131">Subscription Method</span></span>                                                                                                                                                                                                | <span data-ttu-id="f50c6-132">Тип события</span><span class="sxs-lookup"><span data-stu-id="f50c6-132">Event Type</span></span>       | <span data-ttu-id="f50c6-133">Интерфейс обратного вызова</span><span class="sxs-lookup"><span data-stu-id="f50c6-133">Callback Interface</span></span>                                                                                    |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------|-------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="f50c6-134">**аддфокусчанжедевенсандлер**</span><span class="sxs-lookup"><span data-stu-id="f50c6-134">**AddFocusChangedEventHandler**</span></span>](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addfocuschangedeventhandler)                                                                                                                            | <span data-ttu-id="f50c6-135">Изменение фокуса</span><span class="sxs-lookup"><span data-stu-id="f50c6-135">Focus change</span></span>     | [<span data-ttu-id="f50c6-136">**иуиаутоматионфокусчанжедевенсандлер**</span><span class="sxs-lookup"><span data-stu-id="f50c6-136">**IUIAutomationFocusChangedEventHandler**</span></span>](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationfocuschangedeventhandler)         |
| <span data-ttu-id="f50c6-137">[**Аддпропертичанжедевенсандлер**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addpropertychangedeventhandler), [ **аддпропертичанжедевенсандлернативеаррай**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addpropertychangedeventhandlernativearray)</span><span class="sxs-lookup"><span data-stu-id="f50c6-137">[**AddPropertyChangedEventHandler**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addpropertychangedeventhandler), [**AddPropertyChangedEventHandlerNativeArray**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addpropertychangedeventhandlernativearray)</span></span> | <span data-ttu-id="f50c6-138">Изменение свойства</span><span class="sxs-lookup"><span data-stu-id="f50c6-138">Property change</span></span>  | [<span data-ttu-id="f50c6-139">**иуиаутоматионпропертичанжедевенсандлер**</span><span class="sxs-lookup"><span data-stu-id="f50c6-139">**IUIAutomationPropertyChangedEventHandler**</span></span>](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationpropertychangedeventhandler)   |
| [<span data-ttu-id="f50c6-140">**аддструктуречанжедевенсандлер**</span><span class="sxs-lookup"><span data-stu-id="f50c6-140">**AddStructureChangedEventHandler**</span></span>](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addstructurechangedeventhandler)                                                                                                                    | <span data-ttu-id="f50c6-141">Изменение структуры</span><span class="sxs-lookup"><span data-stu-id="f50c6-141">Structure change</span></span> | [<span data-ttu-id="f50c6-142">**иуиаутоматионструктуречанжедевенсандлер**</span><span class="sxs-lookup"><span data-stu-id="f50c6-142">**IUIAutomationStructureChangedEventHandler**</span></span>](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationstructurechangedeventhandler) |
| [<span data-ttu-id="f50c6-143">**адднотификатионевенсандлер**</span><span class="sxs-lookup"><span data-stu-id="f50c6-143">**AddNotificationEventHandler**</span></span>](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation5-addnotificationeventhandler)                                                                                                                           | <span data-ttu-id="f50c6-144">Уведомление</span><span class="sxs-lookup"><span data-stu-id="f50c6-144">Notification</span></span>     | [<span data-ttu-id="f50c6-145">**иуиаутоматионнотификатионевенсандлер**</span><span class="sxs-lookup"><span data-stu-id="f50c6-145">**IUIAutomationNotificationEventHandler**</span></span>](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationnotificationeventhandler)         |
| [<span data-ttu-id="f50c6-146">**аддаутоматионевенсандлер**</span><span class="sxs-lookup"><span data-stu-id="f50c6-146">**AddAutomationEventHandler**</span></span>](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addautomationeventhandler)                                                                                                                                | <span data-ttu-id="f50c6-147">Другие события</span><span class="sxs-lookup"><span data-stu-id="f50c6-147">Other events</span></span>     | [<span data-ttu-id="f50c6-148">**иуиаутоматионевенсандлер**</span><span class="sxs-lookup"><span data-stu-id="f50c6-148">**IUIAutomationEventHandler**</span></span>](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationeventhandler)                                 |



 

<span data-ttu-id="f50c6-149">Когда клиент добавляет обработчик событий для всех потомков ([**TreeScope \_ потомков**](/windows/desktop/api/UIAutomationClient/ne-uiautomationclient-treescope)), модель автоматизации пользовательского интерфейса добавляет только один обработчик для корня поддерева, а обработчик прослушивает все потомки.</span><span class="sxs-lookup"><span data-stu-id="f50c6-149">When a client adds an event handler for all descendants ([**TreeScope\_Descendants**](/windows/desktop/api/UIAutomationClient/ne-uiautomationclient-treescope)), UI Automation adds only one handler for the root of sub-tree, and the handler listens across all descendents.</span></span> <span data-ttu-id="f50c6-150">Автоматизация пользовательского интерфейса не добавляет обработчики событий рекурсивно.</span><span class="sxs-lookup"><span data-stu-id="f50c6-150">UI Automation does not add event handlers recursively.</span></span>

<span data-ttu-id="f50c6-151">Когда клиент вызывает метод [**иуиаутоматион:: ремовеаллевенсандлерс**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-removealleventhandlers) , модель автоматизации пользовательского интерфейса удаляет все обработчики событий из клиентского процесса.</span><span class="sxs-lookup"><span data-stu-id="f50c6-151">When a client calls the [**IUIAutomation::RemoveAllEventHandlers**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-removealleventhandlers) method, UI Automation removes all event handlers from the client process.</span></span>

<span data-ttu-id="f50c6-152">Для получения и обработки событий необходимо реализовать объект обработки событий, который предоставляет интерфейс обратного вызова, и необходимо зарегистрировать объект, вызвав метод регистрации события, такой как [**иуиаутоматион:: аддпропертичанжедевенсандлер**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addpropertychangedeventhandler).</span><span class="sxs-lookup"><span data-stu-id="f50c6-152">To receive and handle events, you implement an event-handling object that exposes a callback interface, and you must register the object by calling an event registration method such as [**IUIAutomation::AddPropertyChangedEventHandler**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addpropertychangedeventhandler).</span></span> <span data-ttu-id="f50c6-153">Интерфейс обратного вызова имеет единственный метод; Модель автоматизации пользовательского интерфейса вызывает этот метод при обработке события.</span><span class="sxs-lookup"><span data-stu-id="f50c6-153">The callback interface has a single method; UI Automation calls this method when the event is processed.</span></span>

<span data-ttu-id="f50c6-154">При завершении работы или когда события модели автоматизации пользовательского интерфейса больше не интересуются приложением, клиенты автоматизации пользовательского интерфейса должны вызывать один или несколько из следующих методов [**иуиаутоматион**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomation) .</span><span class="sxs-lookup"><span data-stu-id="f50c6-154">On shutdown, or when UI Automation events are no longer of interest to the application, UI Automation clients should call one or more of the following [**IUIAutomation**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomation) methods.</span></span>

> [!Note]  
> <span data-ttu-id="f50c6-155">Клиент автоматизации пользовательского интерфейса не должен использовать несколько потоков для добавления или удаления обработчиков событий.</span><span class="sxs-lookup"><span data-stu-id="f50c6-155">A UI Automation client should not use multiple threads to add or remove event handlers.</span></span> <span data-ttu-id="f50c6-156">Непредвиденное поведение может возникнуть, если один или несколько обработчиков событий добавляются или удаляются в рамках одного и того же клиентского процесса.</span><span class="sxs-lookup"><span data-stu-id="f50c6-156">Unexpected behavior can result if one event handler is being added or removed while another is being added or removed in the same client process.</span></span>

 



| <span data-ttu-id="f50c6-157">Метод</span><span class="sxs-lookup"><span data-stu-id="f50c6-157">Method</span></span>                                                                                                | <span data-ttu-id="f50c6-158">Описание</span><span class="sxs-lookup"><span data-stu-id="f50c6-158">Description</span></span>                                                                                                                                                                                                                                                                     |
|-------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="f50c6-159">**ремовеаутоматионевенсандлер**</span><span class="sxs-lookup"><span data-stu-id="f50c6-159">**RemoveAutomationEventHandler**</span></span>](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-removeautomationeventhandler)             | <span data-ttu-id="f50c6-160">Отменяет регистрацию обработчика событий, зарегистрированного с помощью [**аддаутоматионевенсандлер**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addautomationeventhandler).</span><span class="sxs-lookup"><span data-stu-id="f50c6-160">Unregisters an event handler that was registered by using [**AddAutomationEventHandler**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addautomationeventhandler).</span></span>                                                                                                                                  |
| [<span data-ttu-id="f50c6-161">**ремовефокусчанжедевенсандлер**</span><span class="sxs-lookup"><span data-stu-id="f50c6-161">**RemoveFocusChangedEventHandler**</span></span>](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-removefocuschangedeventhandler)         | <span data-ttu-id="f50c6-162">Отменяет регистрацию обработчика событий, зарегистрированного с помощью [**аддфокусчанжедевенсандлер**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addfocuschangedeventhandler).</span><span class="sxs-lookup"><span data-stu-id="f50c6-162">Unregisters an event handler that was registered by using [**AddFocusChangedEventHandler**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addfocuschangedeventhandler).</span></span>                                                                                                                              |
| [<span data-ttu-id="f50c6-163">**ремовепропертичанжедевенсандлер**</span><span class="sxs-lookup"><span data-stu-id="f50c6-163">**RemovePropertyChangedEventHandler**</span></span>](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-removepropertychangedeventhandler)   | <span data-ttu-id="f50c6-164">Отменяет регистрацию обработчика событий, зарегистрированного с помощью [**аддпропертичанжедевенсандлер**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addpropertychangedeventhandler) или [**аддпропертичанжедевенсандлернативеаррай**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addpropertychangedeventhandlernativearray).</span><span class="sxs-lookup"><span data-stu-id="f50c6-164">Unregisters an event handler that was registered by using [**AddPropertyChangedEventHandler**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addpropertychangedeventhandler) or [**AddPropertyChangedEventHandlerNativeArray**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addpropertychangedeventhandlernativearray).</span></span> |
| [<span data-ttu-id="f50c6-165">**ремовеструктуречанжедевенсандлер**</span><span class="sxs-lookup"><span data-stu-id="f50c6-165">**RemoveStructureChangedEventHandler**</span></span>](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-removestructurechangedeventhandler) | <span data-ttu-id="f50c6-166">Отменяет регистрацию обработчика событий, зарегистрированного с помощью [**аддструктуречанжедевенсандлер**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addstructurechangedeventhandler).</span><span class="sxs-lookup"><span data-stu-id="f50c6-166">Unregisters an event handler that was registered by using [**AddStructureChangedEventHandler**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-addstructurechangedeventhandler).</span></span>                                                                                                                      |
| [<span data-ttu-id="f50c6-167">**ремовенотификатионевенсандлер**</span><span class="sxs-lookup"><span data-stu-id="f50c6-167">**RemoveNotificationEventHandler**</span></span>](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation5-removenotificationeventhandler)        | <span data-ttu-id="f50c6-168">Отменяет регистрацию обработчика событий, Богданов зарегистрированных с помощью [**адднотификатионевенсандлер**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation5-addnotificationeventhandler).</span><span class="sxs-lookup"><span data-stu-id="f50c6-168">Unregisters an event handler that weas registered by using [**AddNotificationEventHandler**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation5-addnotificationeventhandler).</span></span>                                                                                                                            |
| [<span data-ttu-id="f50c6-169">**ремовеаллевенсандлерс**</span><span class="sxs-lookup"><span data-stu-id="f50c6-169">**RemoveAllEventHandlers**</span></span>](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-removealleventhandlers)                         | <span data-ttu-id="f50c6-170">Отменяет регистрацию всех зарегистрированных обработчиков событий.</span><span class="sxs-lookup"><span data-stu-id="f50c6-170">Unregisters all registered event handlers.</span></span>                                                                                                                                                                                                                                      |



 

<span data-ttu-id="f50c6-171">Событие может доставляться в обработчик событий после отмены подписки обработчика, если событие получено одновременно с запросом на отмену подписки на событие.</span><span class="sxs-lookup"><span data-stu-id="f50c6-171">It is possible for an event to be delivered to an event handler after the handler has been unsubscribed, if the event is received simultaneously with the request to unsubscribe the event.</span></span> <span data-ttu-id="f50c6-172">Рекомендуется следовать стандарту модели COM и избегать уничтожения объекта обработчика событий до тех пор, пока его число ссылок не достигнет нуля.</span><span class="sxs-lookup"><span data-stu-id="f50c6-172">The best practice is to follow the Component Object Model (COM) standard and avoid destroying the event handler object until its reference count has reached zero.</span></span> <span data-ttu-id="f50c6-173">Уничтожение обработчика событий сразу после отмены подписки на события может привести к нарушению прав доступа, если событие доставляется позднее.</span><span class="sxs-lookup"><span data-stu-id="f50c6-173">Destroying an event handler immediately after unsubscribing for events may result in an access violation if an event is delivered late.</span></span>

## <a name="examples"></a><span data-ttu-id="f50c6-174">Примеры</span><span class="sxs-lookup"><span data-stu-id="f50c6-174">Examples</span></span>

<span data-ttu-id="f50c6-175">Примеры кода, демонстрирующие обработку событий автоматизации пользовательского интерфейса, см. [в разделе Реализация обработчиков событий](uiauto-howto-implement-event-handlers.md).</span><span class="sxs-lookup"><span data-stu-id="f50c6-175">For code examples that show how to handle UI Automation events, see [How to Implement Event Handlers](uiauto-howto-implement-event-handlers.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="f50c6-176">См. также</span><span class="sxs-lookup"><span data-stu-id="f50c6-176">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="f50c6-177">**Зрения**</span><span class="sxs-lookup"><span data-stu-id="f50c6-177">**Conceptual**</span></span>
</dt> <dt>

[<span data-ttu-id="f50c6-178">Обзор событий автоматизации пользовательского интерфейса</span><span class="sxs-lookup"><span data-stu-id="f50c6-178">UI Automation Events Overview</span></span>](uiauto-eventsoverview.md)
</dt> <dt>

[<span data-ttu-id="f50c6-179">Основные сведения о проблемах с потоками</span><span class="sxs-lookup"><span data-stu-id="f50c6-179">Understanding Threading Issues</span></span>](uiauto-threading.md)
</dt> </dl>

 

 




