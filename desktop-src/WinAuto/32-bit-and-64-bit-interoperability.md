---
title: 32-разрядное и 64-разрядное взаимодействие
description: Приложения с поддержкой специальных возможностей должны взаимодействовать через границы процесса для получения сведений о пользовательском интерфейсе от серверов Microsoft Active Accessibility и поставщиков автоматизации пользовательского интерфейса Майкрософт.
ms.assetid: 8b46daed-4fd9-430c-bb4d-24be9c8015b5
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6897082db00e27d77d90e5fc72d5f229834ce760
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103792480"
---
# <a name="32-bit-and-64-bit-interoperability"></a><span data-ttu-id="575a2-103">32-разрядное и 64-разрядное взаимодействие</span><span class="sxs-lookup"><span data-stu-id="575a2-103">32-bit and 64-bit Interoperability</span></span>

<span data-ttu-id="575a2-104">Приложения с поддержкой специальных возможностей должны взаимодействовать через границы процесса для получения сведений о пользовательском интерфейсе от серверов Microsoft Active Accessibility и поставщиков автоматизации пользовательского интерфейса Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="575a2-104">Assistive technology applications need to communicate across process boundaries to get UI information from Microsoft Active Accessibility servers and Microsoft UI Automation providers.</span></span> <span data-ttu-id="575a2-105">В этом разделе описываются основные проблемы взаимодействия между процессами, которые необходимо учитывать при разработке приложений специальных возможностей Windows.</span><span class="sxs-lookup"><span data-stu-id="575a2-105">This topic describes the main interprocess communication issues that you need to keep in mind when developing Windows accessibility applications.</span></span>

<span data-ttu-id="575a2-106">Когда приложения используют API автоматизации Windows, компоненты времени выполнения Microsoft Active Accessibility и автоматизации пользовательского интерфейса автоматически обрабатывают все проблемы и сложности, связанные с выполнением межпроцессного взаимодействия (IPC), включая проблемы взаимодействия, связанные с тем, что один процесс имеет 32 бит, а второй — 64-бит.</span><span class="sxs-lookup"><span data-stu-id="575a2-106">When applications use the Windows Automation API, the Microsoft Active Accessibility and UI Automation run-time components automatically handle all of the issues and complexities involved in performing interprocess communications (IPC), including the interoperability issues involved when one process is 32-bits and the other is 64-bits.</span></span> <span data-ttu-id="575a2-107">Корпорация Майкрософт распознает, что есть случаи, когда для взаимодействия с сервером Microsoft Active Accessibility или поставщиком автоматизации пользовательского интерфейса может потребоваться использовать некоторую форму IPC вместо API службы автоматизации Windows.</span><span class="sxs-lookup"><span data-stu-id="575a2-107">Microsoft recognizes that there are occasions when an assistive technology application may need to use some form of IPC instead of the Windows Automation API to communicate with a Microsoft Active Accessibility server or UI Automation provider.</span></span> <span data-ttu-id="575a2-108">В этих случаях для взаимодействия с другими процессами Корпорация Майкрософт рекомендует использовать сообщения DCOM или Windows (значения, меньшие, чем у **\_ пользователя WM**).</span><span class="sxs-lookup"><span data-stu-id="575a2-108">On these occasions, Microsoft recommends that you use DCOM or Windows messages (those with values less than that of **WM\_USER**) to communicate with other processes.</span></span> <span data-ttu-id="575a2-109">Как и в случае с API автоматизации Windows, сообщения DCOM и Windows автоматически обрабатывали все проблемы IPC, включая 32-разр. в 64-разрядную совместимость.</span><span class="sxs-lookup"><span data-stu-id="575a2-109">Like the Windows Automation API, DCOM and Windows messages automatically handle all IPC issues for you, including 32-bit to 64-bit interoperability.</span></span>

<span data-ttu-id="575a2-110">Если Windows Automation API, DCOM и сообщения Windows не являются вариантами, при реализации выбранного метода IPC учитывайте следующие моменты:</span><span class="sxs-lookup"><span data-stu-id="575a2-110">When the Windows Automation API, DCOM, and Windows messages are not an option, keep the following issues in mind when implementing your chosen IPC method:</span></span>

-   <span data-ttu-id="575a2-111">Общая память — при использовании общей памяти следует иметь в виду, что структура в 32-разрядном процессе может иметь разный размер и макет, чем та же структура в 64-разрядном процессе.</span><span class="sxs-lookup"><span data-stu-id="575a2-111">Shared Memory—When using shared memory, be aware that a structure in a 32-bit process may have a different size and layout than the same structure in a 64-bit process.</span></span> <span data-ttu-id="575a2-112">Это особенно справедливо для структур, содержащих указатели или дескрипторы.</span><span class="sxs-lookup"><span data-stu-id="575a2-112">This is especially true for structures that contain pointers or handles.</span></span>
-   <span data-ttu-id="575a2-113">Усечение указателя — несмотря на то, что 32-разрядное приложение может использовать тип данных **лонглонг** для хранения 64-разрядного значения, существуют экземпляры, в которых не существует элемента API Windows, который позволил бы 32-разрядному приложению получать 64-разрядное значение от 64-разрядного процесса, а также отправлять 64-битное значение в 64-разрядный процесс.</span><span class="sxs-lookup"><span data-stu-id="575a2-113">Pointer Truncation—Although a 32-bit application can use the **LONGLONG** data type to store a 64-bit value, there are instances where no Windows API element exists that would enable the 32-bit application to receive a 64-bit value from a 64-bit process, or to send a 64-bit value to a 64-bit process.</span></span> <span data-ttu-id="575a2-114">Например, функции [**жетвиндовлонгптр**](/windows/desktop/api/winuser/nf-winuser-getwindowlongptra) и [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage) усекаются все значения указателей, в результате чего 32-разрядное приложение имеет бесполезное значение.</span><span class="sxs-lookup"><span data-stu-id="575a2-114">For example, the [**GetWindowLongPtr**](/windows/desktop/api/winuser/nf-winuser-getwindowlongptra) and [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage) functions truncate all pointer values, leaving the 32-bit application with a useless value.</span></span>
-   <span data-ttu-id="575a2-115">Дескрипторы — так как дескрипторы kernel32 и User32 существенны только 32 в 32-разрядных и 64-разрядных процессах, они могут передаваться между процессами без проблем.</span><span class="sxs-lookup"><span data-stu-id="575a2-115">Handles—Because kernel32 and user32 handles are only 32-bit significant in both 32-bit and 64-bit processes, they can be transferred between processes without a problem.</span></span> <span data-ttu-id="575a2-116">Однако некоторые элементы, которые Windows определяет как дескрипторы, на самом деле просто являются переинкапсулированными указателями (например, **хтриитем**).</span><span class="sxs-lookup"><span data-stu-id="575a2-116">However, some items that Windows defines as handles are really just wrapped pointers (for example, **HTREEITEM**).</span></span> <span data-ttu-id="575a2-117">Эти "дескрипторы" будут обрезаны, если они передаются из 64-разрядного процесса в 32-разрядный процесс.</span><span class="sxs-lookup"><span data-stu-id="575a2-117">These "handles" will be truncated if they are passed from a 64-bit process to a 32-bit process.</span></span>
-   <span data-ttu-id="575a2-118">[WinEvent](winevents-infrastructure.md) Функции обработчика — для регистрации функции-обработчика в контексте с 32-разрядным серверным процессом функция-обработчик должна находиться в 32-разрядной библиотеке DLL.</span><span class="sxs-lookup"><span data-stu-id="575a2-118">[WinEvent](winevents-infrastructure.md) Hook Functions—To register an in-context hook function with a 32-bit server process, the hook function must reside in a 32-bit DLL.</span></span> <span data-ttu-id="575a2-119">Аналогично, для регистрации функции-обработчика в контексте с 64-разрядным серверным процессом функция-обработчик должна находиться в 64-разрядной библиотеке DLL.</span><span class="sxs-lookup"><span data-stu-id="575a2-119">Similarly, to register an in-context hook function with a 64-bit server process, the hook function must reside in a 64-bit DLL.</span></span> <span data-ttu-id="575a2-120">Если приложение, поддерживающее вспомогательные технологии, пытается зарегистрировать функцию-обработчик в контексте на сервере с другой битовой глубиной, события все равно будут доставляться функции-обработчику, но они будут доставлены вне контекста.</span><span class="sxs-lookup"><span data-stu-id="575a2-120">If an assistive technology application attempts to register an in-context hook function with a server that has a different bit-depth, events will still be delivered to the hook function, but they will be delivered out-of-context.</span></span> <span data-ttu-id="575a2-121">Дополнительные сведения см. в разделе Виневентс, [функции обработчика в контексте и вне контекста](in-context-and-out-of-context-hook-functions.md).</span><span class="sxs-lookup"><span data-stu-id="575a2-121">For more information, see WinEvents and [In-Context and Out-of-Context Hook Functions](in-context-and-out-of-context-hook-functions.md).</span></span>

<span data-ttu-id="575a2-122">Дополнительные сведения о 32-разрядном и 64-разрядном взаимодействии см. в разделе [взаимодействие процессов](/windows/desktop/WinProg64/process-interoperability).</span><span class="sxs-lookup"><span data-stu-id="575a2-122">For more information about 32-bit and 64-bit interoperability, see [Process Interoperability](/windows/desktop/WinProg64/process-interoperability).</span></span>

## <a name="related-topics"></a><span data-ttu-id="575a2-123">См. также</span><span class="sxs-lookup"><span data-stu-id="575a2-123">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="575a2-124">Общие сведения об API автоматизации Windows</span><span class="sxs-lookup"><span data-stu-id="575a2-124">Windows Automation API Overview</span></span>](windows-automation-api-overview.md)
</dt> </dl>

 

 