---
title: 32-разрядное и 64-разрядное взаимодействие
description: Приложения с поддержкой специальных возможностей должны взаимодействовать через границы процесса для получения сведений о пользовательском интерфейсе от серверов Microsoft Active Accessibility и поставщиков автоматизации пользовательского интерфейса Майкрософт.
ms.assetid: 8b46daed-4fd9-430c-bb4d-24be9c8015b5
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6897082db00e27d77d90e5fc72d5f229834ce760
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103792480"
---
# <a name="32-bit-and-64-bit-interoperability"></a>32-разрядное и 64-разрядное взаимодействие

Приложения с поддержкой специальных возможностей должны взаимодействовать через границы процесса для получения сведений о пользовательском интерфейсе от серверов Microsoft Active Accessibility и поставщиков автоматизации пользовательского интерфейса Майкрософт. В этом разделе описываются основные проблемы взаимодействия между процессами, которые необходимо учитывать при разработке приложений специальных возможностей Windows.

Когда приложения используют API автоматизации Windows, компоненты времени выполнения Microsoft Active Accessibility и автоматизации пользовательского интерфейса автоматически обрабатывают все проблемы и сложности, связанные с выполнением межпроцессного взаимодействия (IPC), включая проблемы взаимодействия, связанные с тем, что один процесс имеет 32 бит, а второй — 64-бит. Корпорация Майкрософт распознает, что есть случаи, когда для взаимодействия с сервером Microsoft Active Accessibility или поставщиком автоматизации пользовательского интерфейса может потребоваться использовать некоторую форму IPC вместо API службы автоматизации Windows. В этих случаях для взаимодействия с другими процессами Корпорация Майкрософт рекомендует использовать сообщения DCOM или Windows (значения, меньшие, чем у **\_ пользователя WM**). Как и в случае с API автоматизации Windows, сообщения DCOM и Windows автоматически обрабатывали все проблемы IPC, включая 32-разр. в 64-разрядную совместимость.

Если Windows Automation API, DCOM и сообщения Windows не являются вариантами, при реализации выбранного метода IPC учитывайте следующие моменты:

-   Общая память — при использовании общей памяти следует иметь в виду, что структура в 32-разрядном процессе может иметь разный размер и макет, чем та же структура в 64-разрядном процессе. Это особенно справедливо для структур, содержащих указатели или дескрипторы.
-   Усечение указателя — несмотря на то, что 32-разрядное приложение может использовать тип данных **лонглонг** для хранения 64-разрядного значения, существуют экземпляры, в которых не существует элемента API Windows, который позволил бы 32-разрядному приложению получать 64-разрядное значение от 64-разрядного процесса, а также отправлять 64-битное значение в 64-разрядный процесс. Например, функции [**жетвиндовлонгптр**](/windows/desktop/api/winuser/nf-winuser-getwindowlongptra) и [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage) усекаются все значения указателей, в результате чего 32-разрядное приложение имеет бесполезное значение.
-   Дескрипторы — так как дескрипторы kernel32 и User32 существенны только 32 в 32-разрядных и 64-разрядных процессах, они могут передаваться между процессами без проблем. Однако некоторые элементы, которые Windows определяет как дескрипторы, на самом деле просто являются переинкапсулированными указателями (например, **хтриитем**). Эти "дескрипторы" будут обрезаны, если они передаются из 64-разрядного процесса в 32-разрядный процесс.
-   [WinEvent](winevents-infrastructure.md) Функции обработчика — для регистрации функции-обработчика в контексте с 32-разрядным серверным процессом функция-обработчик должна находиться в 32-разрядной библиотеке DLL. Аналогично, для регистрации функции-обработчика в контексте с 64-разрядным серверным процессом функция-обработчик должна находиться в 64-разрядной библиотеке DLL. Если приложение, поддерживающее вспомогательные технологии, пытается зарегистрировать функцию-обработчик в контексте на сервере с другой битовой глубиной, события все равно будут доставляться функции-обработчику, но они будут доставлены вне контекста. Дополнительные сведения см. в разделе Виневентс, [функции обработчика в контексте и вне контекста](in-context-and-out-of-context-hook-functions.md).

Дополнительные сведения о 32-разрядном и 64-разрядном взаимодействии см. в разделе [взаимодействие процессов](/windows/desktop/WinProg64/process-interoperability).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Общие сведения об API автоматизации Windows](windows-automation-api-overview.md)
</dt> </dl>

 

 