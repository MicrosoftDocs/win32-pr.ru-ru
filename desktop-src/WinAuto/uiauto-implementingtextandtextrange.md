---
title: Шаблоны элементов управления Text и TextRange
description: Описывает правила и соглашения для реализации Итекстпровидер, ITextProvider2 и Итекстранжепровидер, включая сведения о свойствах и методах.
ms.assetid: 4d541c31-11f7-4d7e-a0e0-9ed1da873d07
keywords:
- Модель автоматизации пользовательского интерфейса, реализация шаблона элемента управления Text
- Модель автоматизации пользовательского интерфейса, реализация шаблона элемента управления TextRange
- Модель автоматизации пользовательского интерфейса, шаблон элемента управления Text
- Модель автоматизации пользовательского интерфейса, шаблон элемента управления TextRange
- Модель автоматизации пользовательского интерфейса, Итекстпровидер
- Модель автоматизации пользовательского интерфейса, Итекстранжепровидер
- ITextProvider
- ITextRangeProvider
- Реализация шаблона элемента управления текстом модели автоматизации пользовательского интерфейса
- Реализация шаблона элемента управления TextRange модели автоматизации пользовательского интерфейса
- Шаблон элемента управления Text
- Шаблон элемента управления TextRange
- шаблоны элементов управления, Итекстпровидер
- шаблоны элементов управления, Итекстранжепровидер
- шаблоны элементов управления, реализация текста автоматизации пользовательского интерфейса
- шаблоны элементов управления, реализация модели автоматизации пользовательского интерфейса TextRange
- шаблоны элементов управления, текст
- шаблоны элементов управления, TextRange
- интерфейсы, Итекстпровидер
- интерфейсы, Итекстранжепровидер
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f53429dc8ec137a83b6a40db377b5c84aeb36120
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104550373"
---
# <a name="text-and-textrange-control-patterns"></a>Шаблоны элементов управления Text и TextRange

Описывает правила и соглашения для реализации [**итекстпровидер**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextprovider), [**ITextProvider2**](/windows/desktop/api/uiautomationcore/nn-uiautomationcore-itextprovider2)и [**итекстранжепровидер**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextrangeprovider), включая сведения о свойствах и методах. Шаблон элемента управления **Text** позволяет приложениям и элементам управления предоставлять простую объектную модель текста, позволяя клиентам получать текстовое содержимое, текстовые атрибуты и внедренные объекты из текстовых элементов управления.

Для поддержки шаблона элемента управления **Text** элементы управления реализуют интерфейсы [**итекстпровидер**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextprovider) и [**ITextProvider2**](/windows/desktop/api/uiautomationcore/nn-uiautomationcore-itextprovider2) . Типы элементов управления, которые должны поддерживать шаблон элемента управления **Text** , включают в себя типы [Edit](uiauto-supporteditcontroltype.md) и [Document](uiauto-supportdocumentcontroltype.md) Control, а также любой другой тип элемента управления, позволяющий пользователю вводить текст или выбирать текст только для чтения.

Шаблон элемента управления **Text** можно использовать с другими шаблонами элементов управления автоматизации пользовательского интерфейса Майкрософт для поддержки нескольких типов внедренных объектов в тексте, включая таблицы, гиперссылки и кнопки команд.

Интерфейсы [**итекстпровидер**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextprovider) и [**ITextProvider2**](/windows/desktop/api/uiautomationcore/nn-uiautomationcore-itextprovider2) включают ряд методов для получения текстовых диапазонов. *Текстовый диапазон* — это объект, представляющий непрерывный участок текста (или несколько несвязных диапазонов текста) в текстовом контейнере. Один метод **итекстпровидер** получает текстовый диапазон, представляющий весь документ, а другие запрашивают диапазоны текста, представляющие некоторую часть документа, например выделенный текст, видимый текст или объект, внедренный в текст.

Объект текстового диапазона представлен шаблоном элемента управления **TextRange** , который реализуется через интерфейс [**итекстранжепровидер**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextrangeprovider) . Шаблон элемента управления **TextRange** предоставляет методы и свойства, используемые для предоставления сведений о тексте в диапазоне, перемещения конечных точек диапазона, выделения или девыделения текста, прокрутки диапазона на представление и т. д.

Дополнительные сведения о шаблонах элементов управления **Text** и **TextRange** см. в разделе [Поддержка модели автоматизации пользовательского интерфейса для текстового содержимого](uiauto-ui-automation-textpattern-overview.md).

Начиная с поставщиков Windows 8.1 может реализовать интерфейс [**ITextRangeProvider2**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextrangeprovider2) . Это позволяет вызывать контекстные меню, связанные с текстовым диапазоном. Это поддерживает такие сценарии, как Автозамена текста или выбор кандидатов редактора методов ввода (IME).

В этом разделе содержатся следующие подразделы.

-   [Правила и соглашения реализации](#implementation-guidelines-and-conventions)
-   [Обязательные члены для **итекстпровидер**](#required-members-for-itextprovider)
-   [Обязательные члены для **итекстранжепровидер**](#required-members-for-itextrangeprovider)
-   [Поддержка диапазонов текста](#supporting-text-ranges)
    -   [Управление текстовым диапазоном по единицам текста](#manipulating-a-text-range-by-text-unit)
    -   [Выбор текста в текстовом диапазоне](#selecting-text-in-a-text-range)
    -   [Получение текста из текстового диапазона](#acquiring-text-from-a-text-range)
    -   [Реализация Шовконтекстмену](#implementing-showcontextmenu)
-   [Взаимодействие с системным курсором](#interoperability-with-the-system-caret)
-   [См. также](#related-topics)

## <a name="implementation-guidelines-and-conventions"></a>Правила и соглашения реализации

При реализации шаблона элемента управления **Text** Обратите внимание на следующие правила и соглашения.

-   Любой элемент управления, обеспечивающий доступ к тексту (например, ввод текста или выбор текста только для чтения), должен поддерживать шаблон элемента управления **Text** .
-   Шаблон элемента управления **Text** можно использовать с любым элементом пользовательского интерфейса, который представляет текст, даже статическую метку для стандартного элемента управления "Кнопка". Однако он не является обязательным для статических текстовых элементов управления, которые не могут быть выбраны или не имеют точки вставки.
-   Чтобы обеспечить полный доступ к тексту, элементы управления, реализующие [**итекстпровидер**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextprovider) , также должны поддерживать интерфейс [**ивалуепровидер**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-ivalueprovider) . **Ивалуепровидер** дополняет **итекстпровидер** , предоставляя программный способ изменения текста. Кроме того, она обеспечивает более высокую совместимость с клиентскими приложениями с поддержкой специальных возможностей, в том числе на основе устаревших технологий, таких как Microsoft Active Accessibility. При реализации обоих шаблонов элементов управления событие **TextChanged** ([**UIA \_ Text \_ текстчанжедевентид**](uiauto-event-ids.md)) и событие **аутоматионпропертичанжед** ([**UIA \_ аутоматионпропертичанжедевентид**](uiauto-event-ids.md)) эквивалентны для свойства **value** ([**UIA \_ ValueValuePropertyId**](uiauto-control-pattern-propids.md)). Оба события должны поддерживаться.
-   Шаблон элемента управления **Text** поддерживает только один поток текста и одно окно просмотра для каждого элемента управления. Если приложение предлагает несколько представлений документа в панелях, каждое представление (элемент управления) должно поддерживать [**итекстпровидер**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextprovider) независимо друг от друга.
-   Метод [**итекстпровидер::**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-getselection) noreturn может возвращать один текстовый диапазон, представляющий текущий выделенный текст. Если элемент управления поддерживает выбор нескольких несмежных диапазонов текста **, метод WebMethod** должен возвращать массив, который содержит один интерфейс [**итекстранжепровидер**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextrangeprovider) для каждого выбранного фрагмента текста.
-   Шаблон элемента управления **Text** представляет точку вставки в виде вырожденного (пустого) текстового диапазона. Метод [**итекстпровидер::**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-getselection) noreturn должен возвращать вырожденный диапазон текста, если точка вставки существует, а текст не выбран. Дополнительные сведения см. [в разделе взаимодействие с системным курсором](#interoperability-with-the-system-caret).
-   Метод [**итекстпровидер:: жетвисиблеранжес**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-getvisibleranges) может возвращать один текстовый диапазон, если непрерывный диапазон текста отображается в окне просмотра или может возвращать массив несвязанных текстовых диапазонов, представляющих несколько частично видимых строк текста.
-   Метод [**итекстпровидер:: ранжефромчилд**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-rangefromchild) должен возвращать вырожденный диапазон, если дочерний элемент не содержит текста. Поскольку внедренный объект может содержать текст, метод **ранжефромчилд** не всегда может возвращать вырожденный текстовый диапазон. Дополнительные сведения см. в статье [как модель автоматизации пользовательского интерфейса предоставляет внедренные объекты](uiauto-textpattern-and-embedded-objects-overview.md).
-   Метод [**итекстпровидер:: ранжефромпоинт**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-rangefrompoint) выполняет проверку нажатия в области документа, используя указанные экранные координаты. Результирующий диапазон текста должен соответствовать положению курсора или выделению, которое будет получено при щелчке расположения на указанных координатах экрана. Например, если изображение находится на заданных координатах экрана, то результирующий диапазон текста должен совпадать с текстовым диапазоном, который метод [**итекстпровидер:: ранжефромчилд**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-rangefromchild) будет получать для изображения. Аналогично, если клиентское приложение запрашивает текстовый диапазон для расположения в центре курсора системы (точка вставки), результирующий диапазон текста должен совпадать с положением системного курсора.
-   Свойство [**итекстпровидер::D окументранже**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-get_documentrange) всегда должно предоставлять текстовый диапазон, включающий весь текст, поддерживаемый соответствующей реализацией [**итекстпровидер**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextprovider) .
-   Событие [**UIA \_ Text \_ текстчанжедевентид**](uiauto-event-ids.md) должно вызываться после любого изменения текста, даже если это изменение не отображается в окне просмотра. Например, поставщик должен вызывать событие, даже если пользователь вставит тот же текст над выделенным текстом.
-   [**Текст UIA \_ \_ текстселектиончанжедевентид**](uiauto-event-ids.md) должен вызываться всякий раз, когда изменяется выборка текста или когда точка вставки (курсор) перемещается между текстом.

При реализации шаблона элемента управления **TextRange** Обратите внимание на следующие правила и соглашения.

-   Все методы шаблона элемента управления **TextRange** должны выполнять текстовые операции независимо от состояния видимости текста. Видимость текстового диапазона всегда может быть определена с помощью запроса атрибута « **скрытый** текст» ([**UIA \_ ишидденаттрибутеид**](uiauto-textattribute-ids.md)).
-   Если это возможно, поставщик должен гарантировать, что любые изменения текста, такие как удаления, вставки и перемещения, будут отражены в связанных объектах текстового диапазона (экземплярах интерфейса [**итекстранжепровидер**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextrangeprovider) ) и порождать событие [**UIA \_ Text \_ текстчанжедевентид**](uiauto-event-ids.md) . Клиенты могут использовать событие как подсказку для подтверждения редакционных изменений, внесенных в текст элемента управления.
-   Все объекты текстового диапазона, используемые методами [**итекстранжепровидер:: Compare**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-compare), [**компариндпоинтс**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-compareendpoints)и [**мовиндпоинтбиранже**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-moveendpointbyrange) , должны быть однорангами одной и той же реализации шаблона элемента управления **Text** .
-   Хотя это и не обязательно, значение *претвал* , полученное методом [**Итекстранжепровидер:: компариндпоинтс**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-compareendpoints) , может указывать расстояние в символах [**( \_ символ текстунит**](/windows/desktop/api/UIAutomationCore/ne-uiautomationcore-textunit)) между двумя конечными точками. Однако клиентские приложения не должны зависеть от точности *претвал* за пределами положительного или отрицательного значения.
-   Для методов [**итекстранжепровидер:: експандтоенклосингунит**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-expandtoenclosingunit), [**Move**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-move)и [**мовиндпоинтбюнит**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-moveendpointbyunit) необходимо тщательно рассмотреть указанную единицу текста. Дополнительные сведения см. в разделе Управление параметром TextRange по текстовому блоку.
-   Требования к реализации, связанные с методами [**итекстранжепровидер:: SELECT**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-select), [**аддтоселектион**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-addtoselection)и [**ремовефромселектион**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-removefromselection) , см. в разделе выделение текста в текстовом диапазоне.
-   Методы [**итекстранжепровидер:: строки FindText**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-findtext) и [**финдаттрибуте**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-findattribute) выполняют поиск по одной совпадающей текстовой строке или текстовому атрибуту в обратном направлении. Если совпадений не найдено, они должны вернуть **значение NULL** .
-   Метод [**итекстранжепровидер:: GetAttributeValue**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-getattributevalue) должен возвращать адрес, полученный от функции [**уиажетресерведмикседаттрибутевалуе**](/windows/desktop/api/UIAutomationCoreApi/nf-uiautomationcoreapi-uiagetreservedmixedattributevalue) или [**уиажетресерведнотсуппортедвалуе**](/windows/desktop/api/UIAutomationCoreApi/nf-uiautomationcoreapi-uiagetreservednotsupportedvalue) , если связанный атрибут изменяется в диапазоне или если атрибут не поддерживается элементом управления "текст". Спецификация шаблона элемента управления **TextRange** не позволяет добавлять новые идентификаторы атрибутов текста или изменять способ определения существующих атрибутов.
-   Если это возможно, метод [**итекстранжепровидер:: жетбаундингректанглес**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-getboundingrectangles) должен возвращать массив, который содержит один ограничивающий прямоугольник для каждой полностью или частично видимой строки текста в текстовом диапазоне. Если это невозможно, поставщик может возвратить массив, содержащий ограничивающие прямоугольники только полностью видимых строк. Однако это ограничивает способность клиентского приложения точно описать, как текст отображается на экране.
-   Метод [**итекстранжепровидер::**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-getchildren) Child должен возвращать все дочерние элементы, внедренные в текстовый диапазон, но не требуется возвращать дочерние элементы дочерних элементов. Например, если текстовый диапазон содержит таблицу с числом дочерних ячеек, метод **дочернего** элемента может вернуть только элемент Table, а не элементы ячейки. В целях повышения производительности или архитектуры поставщик может не иметь возможности предоставлять все внедренные объекты, размещенные в документе в дереве автоматизации. В этом случае поставщик должен по крайней мере поддерживать перечисление дочерних объектов через метод **Children** и, как вариант, поддерживать шаблон элемента управления [виртуализедитем](uiauto-implementingvirtualizeditem.md) для поддержки отмены виртуализации.
-   Метод [**итекстранжепровидер:: жетенклосинжелемент**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-getenclosingelement) обычно возвращает поставщик текста, который предоставляет текстовый диапазон. Однако если поставщик текста поддерживает дочерние объекты, такие как таблицы или гиперссылки, то этот элемент может быть потомком поставщика текста. Элемент, возвращаемый функцией **жетенклосинжелемент** , должен быть ближайшим к заданному текстовому диапазону. Например, если текстовый диапазон находится в ячейке таблицы, **жетенклосинжелемент** должен возвращать содержащуюся ячейку вместо элемента table.
-   Метод [**итекстранжепровидер:: GetText**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-gettext) должен возвращать обычный текст в диапазоне. Дополнительные сведения см. в разделе Получение текста из текстового диапазона.
-   Вызов [**итекстранжепровидер:: скроллинтовиев**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-scrollintoview) должен выровняйте текст в окне просмотра текстового элемента управления, как указано в параметре *алигнтотоп* . Хотя в условиях горизонтального выравнивания нет необходимости, текстовый диапазон должен быть видимым как по горизонтали, так и по вертикали. При оценке параметра *алигнтотоп* поставщик должен учитывать ориентацию текстового элемента управления и направление потока текста. Например, если *алигнтотоп* имеет **значение true** для вертикально ориентированного текстового элемента управления, содержащего текст, который передается справа налево, поставщик должен выравнивать текстовый диапазон с правой стороны окна просмотра.
-   При перемещении по документу по [**текстунит \_ строке**](/windows/desktop/api/UIAutomationCore/ne-uiautomationcore-textunit), если текстовый диапазон входит в внедренную таблицу, каждая строка текста в ячейке должна рассматриваться как линия.

## <a name="required-members-for-itextprovider"></a>Обязательные члены для **итекстпровидер**

Для реализации интерфейса [**итекстпровидер**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextprovider) требуются следующие свойства и методы.



| Обязательные члены                                                                                        | Тип члена | Примечания |
|---------------------------------------------------------------------------------------------------------|-------------|-------|
| [**DocumentRange**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-get_documentrange)                                             | Свойство    | Нет  |
| [**суппортедтекстселектион**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-get_supportedtextselection)                           | Свойство    | Нет  |
| [**Выборка**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-getselection)                                               | Метод      | Нет  |
| [**жетвисиблеранжес**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-getvisibleranges)                                       | Метод      | Нет  |
| [**ранжефромчилд**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-rangefromchild)                                           | Метод      | Нет  |
| [**ранжефромпоинт**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-rangefrompoint)                                           | Метод      | Нет  |
| [**\_Текстовая \_ ТЕКСТЧАНЖЕДЕВЕНТИДа UIA**](uiauto-event-ids.md)                   | Событие       | Нет  |
| [**\_Текстовая \_ ТЕКСТСЕЛЕКТИОНЧАНЖЕДЕВЕНТИДа UIA**](uiauto-event-ids.md) | Событие       | Нет  |



 

Для реализации интерфейса [**ITextProvider2**](/windows/desktop/api/uiautomationcore/nn-uiautomationcore-itextprovider2) требуются следующие дополнительные свойства и методы.



| Обязательные члены                                                         | Тип члена | Примечания |
|--------------------------------------------------------------------------|-------------|-------|
| [**жеткаретранже**](/windows/desktop/api/uiautomationcore/nf-uiautomationcore-itextprovider2-getcaretrange)         | Метод      | Нет  |
| [**ранжефроманнотатион**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider2-rangefromannotation) | Метод      | Нет  |



 

## <a name="required-members-for-itextrangeprovider"></a>Обязательные члены для **итекстранжепровидер**

Для реализации интерфейса [**итекстранжепровидер**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextrangeprovider) требуются следующие свойства и методы.



| Обязательные члены                                                                 | Тип члена | Примечания |
|----------------------------------------------------------------------------------|-------------|-------|
| [**аддтоселектион**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-addtoselection)               | Метод      | Нет  |
| [**Клонировать**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-clone)                                 | Метод      | Нет  |
| [**Сравнение**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-compare)                             | Метод      | Нет  |
| [**компариндпоинтс**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-compareendpoints)           | Метод      | Нет  |
| [**експандтоенклосингунит**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-expandtoenclosingunit) | Метод      | Нет  |
| [**FindAttribute**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-findattribute)                 | Метод      | Нет  |
| [**Строки FindText**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-findtext)                           | Метод      | Нет  |
| [**GetAttributeValue**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-getattributevalue)         | Метод      | Нет  |
| [**жетбаундингректанглес**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-getboundingrectangles) | Метод      | Нет  |
| [**GetChildren**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-getchildren)                     | Метод      | Нет  |
| [**жетенклосинжелемент**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-getenclosingelement)     | Метод      | Нет  |
| [**GetText**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-gettext)                             | Метод      | Нет  |
| [**Переместить**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-move)                                   | Метод      | Нет  |
| [**мовиндпоинтбюнит**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-moveendpointbyunit)       | Метод      | Нет  |
| [**мовиндпоинтбиранже**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-moveendpointbyrange)     | Метод      | Нет  |
| [**Метьте**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-select)                               | Метод      | Нет  |
| [**скроллинтовиев**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-scrollintoview)               | Метод      | Нет  |



 

Для реализации интерфейса [**ITextRangeProvider2**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextrangeprovider2) требуются следующие дополнительные свойства и методы.



| Обязательные члены                                                      | Тип члена | Примечания                                      |
|-----------------------------------------------------------------------|-------------|--------------------------------------------|
| [**ShowContextMenu**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider2-showcontextmenu) | Метод      | См. раздел "реализация Шовконтекстмену". |



 

Шаблон элемента управления **TextRange** не имеет связанных событий.

## <a name="supporting-text-ranges"></a>Поддержка диапазонов текста

В этом разделе описывается, как поставщик должен реализовать различные методы интерфейсов [**итекстранжепровидер**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextrangeprovider) и [**ITextRangeProvider2**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextrangeprovider2) для поддержки шаблона элемента управления **TextRange** .

### <a name="manipulating-a-text-range-by-text-unit"></a>Управление текстовым диапазоном по единицам текста

Интерфейс [**итекстранжепровидер**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextrangeprovider) предоставляет несколько методов для манипулирования текстовыми диапазонами и перемещения по ним в элементе управления на основе текста. Методы [**итекстранжепровидер:: Move**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-move), [**мовиндпоинтбюнит**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-moveendpointbyunit)и [**експандтоенклосингунит**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-expandtoenclosingunit) перемещают текстовый диапазон или одну из его конечных точек на указанную единицу текста, например символ, слово, абзац и т. д. Дополнительные сведения см. в разделе [единицы измерения текста модели автоматизации пользовательского интерфейса](/windows/desktop/WinAuto/uiauto-uiautomationtextunits).

Несмотря на свое имя, метод [**итекстранжепровидер:: експандтоенклосингунит**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-expandtoenclosingunit) не обязательно расширяет текстовый диапазон. Вместо этого он нормализует текстовый диапазон, перемещая конечные точки, чтобы диапазон охватывает указанную единицу текста. Диапазон расширяется, если он меньше указанной единицы, или сокращен, если он превышает заданную единицу. Очень важно, чтобы метод **експандтоенклосингунит** всегда выполнял нормализацию текстовых диапазонов согласованным образом. в противном случае другие аспекты обработки текстового диапазона по текстовому блоку будут непредсказуемыми. На следующей схеме показано, как **експандтоенклосингунит** нормализует текстовый диапазон, перемещая конечные точки диапазона.

![Схема, показывающая позиции конечной точки текстового диапазона до и после вызова експандтоенклосингунит](images/expandtoenclosingunit.jpg)

Если текстовый диапазон начинается с начала текстового блока и заканчивается в начале (или до) следующей границы единицы текста, конечная точка перемещается на следующую границу единицы текста (см. 1 и 2 на предыдущей схеме).

Если текстовый диапазон начинается в начале текстового блока и заканчивается на единице (или после), конечная точка остается или перемещается назад на следующую границу единицы после начальной конечной точки (см. 3 и 4 на предыдущем рисунке). Если между начальной и конечной конечными точками имеется более одной границы единицы текста, конечная точка перемещается назад к следующей границе единицы после начальной конечной точки, что приводит к подлине текстового диапазона, имеющего одну единицу текста.

Если диапазон текста начинается в середине единицы текста, начальная конечная точка перемещается назад в начало текстового блока, а конечная конечная точка перемещается вперед или назад при необходимости на следующую границу единицы после начальной конечной точки (см. 5 – 8 на предыдущей схеме).

При вызове метода [**итекстранжепровидер:: Move**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-move) поставщик нормализует текстовый диапазон на заданную единицу текста, используя ту же логику нормализации, что и метод [**експандтоенклосингунит**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-expandtoenclosingunit) . Затем поставщик перемещает диапазон назад или вперед по заданному числу единиц текста. При перемещении диапазона поставщик должен игнорировать границы любых внедренных объектов в тексте. (Однако сама граница единицы может зависеть от существования внедренного объекта). На следующей схеме показано, как метод **Move** перемещает текстовый диапазон, единицу измерения между внедренными объектами и границами единиц текста.

![Диаграмма, показывающая, как метод Move перемещает конечные точки диапазона между объектами и границами единиц текста](images/move.jpg)

Метод [**итекстранжепровидер:: мовиндпоинтбюнит**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-moveendpointbyunit) перемещает одну из конечных точек вперед или назад по указанной единице текста, как показано на следующем рисунке.

![Диаграмма, показывающая, как мовиндпоинтбюнит перемещает конечную точку диапазона](images/moveendpointbyunit.gif)

Метод [**итекстранжепровидер:: мовиндпоинтбиранже**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-moveendpointbyrange) позволяет клиентскому приложению задать одну конечную точку текстового диапазона в том же расположении, что и указанная конечная точка второго текстового диапазона.

### <a name="selecting-text-in-a-text-range"></a>Выбор текста в текстовом диапазоне

Интерфейс [**итекстранжепровидер**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-itextrangeprovider) включает несколько методов для управления выделением текста в элементе управления на основе текста.

Метод [**итекстранжепровидер:: SELECT**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-select) должен выбрать текст, соответствующий диапазону текста, и удалить предыдущий выделенный фрагмент из элемента управления "текст". Если для вырожденного текстового диапазона вызывается **SELECT** , поставщик должен переместить точку вставки в расположение текстового диапазона без выбора текста.

Если элемент управления поддерживает выделение нескольких необъединяемых диапазонов текста, методы [**итекстранжепровидер:: аддтоселектион**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-addtoselection) и [**ремовефромселектион**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-removefromselection) добавляют диапазоны текста в и удаляют их из коллекции выбранных текстовых диапазонов. Если элемент управления поддерживает только один выбранный текстовый диапазон за раз, но операция выбора приведет к выбору нескольких необъединяемых текстовых диапазонов, поставщик должен либо вернуть ошибку **E \_ INVALIDOPERATION** , либо расширить или усечь текущий выделенный фрагмент. Свойство [**итекстпровидер:: суппортедтекстселектион**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-get_supportedtextselection) должно указывать, поддерживает ли элемент управления выделение одного или нескольких диапазонов текста или нет вообще.

Если текстовый элемент управления поддерживает вставку текста, вызов [**итекстранжепровидер:: аддтоселектион**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-addtoselection) или [**ремовефромселектион**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-removefromselection) в диапазоне вырожденного текста в элементе управления должен переместить точку вставки, но не должен выбирать какой-либо текст.

### <a name="acquiring-text-from-a-text-range"></a>Получение текста из текстового диапазона

Метод [**итекстранжепровидер:: GetText**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-gettext) должен возвращать обычный текст текстового диапазона. Обычный текст должен включать все управляющие символы, найденные в исходном тексте, такие как возврат каретки и знак Юникода слева направо (ЛРМ). Обычный текст не должен содержать теги разметки, такие как HTML, которые могут присутствовать в исходном тексте. Кроме того, все Escape-коды в исходном тексте должны быть преобразованы в эквиваленты обычного текста. Например, " &nbsp; " следует преобразовать в простой символ пробела.

Если внедренный объект охватывает диапазон текста, в обычном тексте должен содержаться внутренний текст объекта, но не альтернативный текст (свойство Name внедренного объекта), так как он может не соответствовать описательному внутреннему тексту. Дополнительные сведения см. в статье [как модель автоматизации пользовательского интерфейса предоставляет внедренные объекты](uiauto-textpattern-and-embedded-objects-overview.md).

### <a name="implementing-showcontextmenu"></a>Реализация Шовконтекстмену

[**ITextRangeProvider2:: шовконтекстмену**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider2-showcontextmenu) должен всегда показывать контекстное меню в начальной конечной точке диапазона. Это должно быть эквивалентно тому, что произойдет, если пользователь нажал на клавишу контекстного меню или SHIFT + F10 с точкой вставки в начале диапазона.

Если отображение контекстного меню обычно приводит к перемещению точки вставки в заданное место, то оно должно сделать это для программного вызова [**шовконтекстмену**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider2-showcontextmenu) для поддержки модели автоматизации пользовательского интерфейса.

## <a name="interoperability-with-the-system-caret"></a>Взаимодействие с системным курсором

Правильная поддержка точки вставки важна для многих клиентских приложений, включая те, которые не основаны на автоматизации пользовательского интерфейса. В шаблоне элемента управления **Text** точка вставки представлена вырожденным (пустым) текстовым диапазоном в позиции системного курсора. Когда точка вставки будет перемещена, элемент управления должен вызвать событие **текстселектиончанжед** ([**UIA \_ Text \_ текстселектиончанжедевентид**](uiauto-event-ids.md)). Некоторые клиентские приложения зависят от этого события, чтобы отслеживать положение курсора и отслеживать выделение текста.

Если элемент управления содержит выделенный текст, текущий дизайн шаблона элемента управления **Text** не предоставляет способа непосредственного связывания места вставки с определенным текстовым диапазоном. Поставщик должен отследить выбор текста и установить расположение точки вставки соответствующим образом. Поскольку выбор текста обычно выполняется путем перемещения точки вставки, удерживая нажатой клавишу SHIFT или CTRL или и то и другое, поставщик может отнести выбор текста, проверив состояние этих ключей при каждом изменении выбора.

Поскольку платформа специальных возможностей предоставляет встроенную поддержку системного курсора, но не для пользовательского курсора, элементы управления на основе текста должны по возможности использовать системный курсор. Элементы управления, использующие пользовательское курсор, могут обеспечить доступность курсора, создавая системную точку ввода, которая имеет те же размеры, что и пользовательское курсор, и размещая системную курсор в том же расположении в пользовательском интерфейсе элемента управления, что и пользовательское курсор — то есть в точке вставки. В качестве альтернативы элемент управления, использующий пользовательское курсор, может реализовать поставщик Active Accessibility Майкрософт [**для \_ курсора OBJID**](object-identifiers.md) , чтобы предоставить сведения о специальных возможностях непосредственно для пользовательского курсора.

Дополнительные сведения о системных курсорах см. в разделе символы [крышки](/windows/desktop/menurc/carets).

Чтобы проверить, правильно ли элемент управления предоставляет расположение курсора системы, используйте средства [отслеживания событий](accessible-event-watcher.md) для [проверки](inspect-objects.md) и доступности.

Экранные координаты центра точечного изображения курсора системы должны всегда соответствовать расположению точки вставки. Таким образом, клиент может использовать координаты экрана курсора в вызове [**итекстпровидер:: ранжефромпоинт**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-rangefrompoint) для получения текстового диапазона, точно представляющего положение точки вставки.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Типы элементов управления и поддерживаемые ими шаблоны элементов управления](uiauto-controlpatternmapping.md)
</dt> <dt>

[Тип элемента управления "текст"](uiauto-supporttextcontroltype.md)
</dt> <dt>

[Шаблон элемента управления также TextEdit](textedit-control-pattern.md)
</dt> <dt>

[Шаблон элемента управления Текстчилд](textchild-control-pattern.md)
</dt> <dt>

[Общие сведения о шаблонах элементов управления модели автоматизации пользовательского интерфейса](uiauto-controlpatternsoverview.md)
</dt> <dt>

[Поддержка модели автоматизации пользовательского интерфейса для текстового содержимого](uiauto-ui-automation-textpattern-overview.md)
</dt> <dt>

[Общие сведения о дереве модели автоматизации пользовательского интерфейса](uiauto-treeoverview.md)
</dt> </dl>

 

 