---
title: Масштабирование экрана Active Accessibility и Windows Vista
description: Windows Vista позволяет пользователям изменять параметр точек на дюйм (DPI) таким образом, чтобы большинство элементов пользовательского интерфейса отображались крупнее.
ms.assetid: c781fefd-09f0-4340-b3d3-f4e57308f392
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6db8e192dc01d4c7d75f19741cdfac7b3b08d22c
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104488056"
---
# <a name="active-accessibility-and-windows-vista-screen-scaling"></a><span data-ttu-id="c3bf1-103">Масштабирование экрана Active Accessibility и Windows Vista</span><span class="sxs-lookup"><span data-stu-id="c3bf1-103">Active Accessibility and Windows Vista Screen Scaling</span></span>

<span data-ttu-id="c3bf1-104">Windows Vista позволяет пользователям изменять параметр точек на дюйм (DPI) таким образом, чтобы большинство элементов пользовательского интерфейса отображались крупнее.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-104">Windows Vista enables users to change the dots-per-inch (dpi) setting so that most UI elements on the screen appear larger.</span></span> <span data-ttu-id="c3bf1-105">Хотя эта функция была доступна в Microsoft Windows, в предыдущих версиях масштабирование пришлось бы реализовать в приложениях.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-105">Although this feature has long been available in Microsoft Windows, in previous versions the scaling had to be implemented by applications.</span></span> <span data-ttu-id="c3bf1-106">В Windows Vista диспетчер окон рабочего стола выполняет масштабирование по умолчанию для всех приложений, которые не обрабатывали собственное масштабирование.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-106">In Windows Vista, the Desktop Window Manager performs default scaling for all applications that do not handle their own scaling.</span></span> <span data-ttu-id="c3bf1-107">Клиентские приложения Microsoft Active Accessibility должны учитывать эту функцию.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-107">Microsoft Active Accessibility client applications must take this feature into account.</span></span>

## <a name="scaling-in-windows-vista"></a><span data-ttu-id="c3bf1-108">Масштабирование в Windows Vista</span><span class="sxs-lookup"><span data-stu-id="c3bf1-108">Scaling in Windows Vista</span></span>

<span data-ttu-id="c3bf1-109">Значение dpi по умолчанию — 96. Это означает, что 96 пикселов занимают ширину или высоту на одном определенном дюйме.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-109">The default dpi setting is 96, which means that 96 pixels occupy a width or height of one notional inch.</span></span> <span data-ttu-id="c3bf1-110">Точный размер "дюйма" зависит от размера и физического разрешения монитора.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-110">The exact measure of an "inch" depends on the size and physical resolution of the monitor.</span></span> <span data-ttu-id="c3bf1-111">Например, на мониторе шириной в 12 дюймов при горизонтальном разрешении в 1280 пикселей горизонтальная линия в 96 пикселей имеет протяженность около 9/10 дюйма.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-111">For example, on a monitor 12 inches wide, at a horizontal resolution of 1280 pixels, a horizontal line of 96 pixels extends about 9/10 of an inch.</span></span>

<span data-ttu-id="c3bf1-112">Изменение параметра dpi отличается от изменения разрешения экрана.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-112">Changing the dpi setting is not the same as changing the screen resolution.</span></span> <span data-ttu-id="c3bf1-113">При масштабировании dpi количество физических пикселей на экране остается неизменным.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-113">With dpi scaling, the number of physical pixels on the screen remains the same.</span></span> <span data-ttu-id="c3bf1-114">Однако масштабирование применяется к размеру и расположению элементов пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-114">However, scaling is applied to the size and location of UI elements.</span></span> <span data-ttu-id="c3bf1-115">Это масштабирование может автоматически выполняться диспетчером окон рабочего стола для рабочего стола и для приложений, в которых не указан явный запрет на масштабирование.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-115">This scaling can be performed automatically by the Desktop Window Manager (DWM) for the desktop and for applications that do not explicitly ask not to be scaled.</span></span>

<span data-ttu-id="c3bf1-116">Фактически, когда пользователь устанавливает коэффициент масштабирования 120 dpi, вертикальный или горизонтальный дюйм на экране станет больше 25%.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-116">In effect, when the user sets the scale factor to 120 dpi, a vertical or horizontal inch on the screen becomes bigger by 25 percent.</span></span> <span data-ttu-id="c3bf1-117">Все измерения масштабируются согласованно.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-117">All dimensions are scaled accordingly.</span></span> <span data-ttu-id="c3bf1-118">Смещение окна от верхнего и левого краев экрана увеличивается на 25 процентов.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-118">The offset of a window from the top and left edges of the screen increases by 25 percent.</span></span> <span data-ttu-id="c3bf1-119">Размер окна увеличивается в той же пропорции вместе с смещениями и размерами всех элементов пользовательского интерфейса, которые он содержит.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-119">The size of the window increases in the same proportion, along with the offsets and sizes of all UI elements it contains.</span></span>

<span data-ttu-id="c3bf1-120">По умолчанию DWM не выполняет масштабирование для приложений, не поддерживающих dpi, когда пользователь устанавливает значение dpi равным 120, но выполняет его, если для dpi задано пользовательское число 144 или выше.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-120">By default, the DWM does not perform scaling for non-dpi-aware applications when the user sets the dpi to 120, but does perform it when the dpi is set to a custom value of 144 or higher.</span></span> <span data-ttu-id="c3bf1-121">Тем не менее пользователь может переопределить поведение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-121">However, the user can override the default behavior.</span></span>

<span data-ttu-id="c3bf1-122">Масштабирование экрана создает новые проблемы для приложений, которые каким-либо образом связаны с экранными координатами.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-122">Screen scaling creates new challenges for applications that are concerned in any way with screen coordinates.</span></span> <span data-ttu-id="c3bf1-123">Теперь экран содержит две системы координат: физическую и логическую.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-123">The screen now contains two coordinate systems: physical and logical.</span></span> <span data-ttu-id="c3bf1-124">Физические координаты точки являются фактическим смещением в пикселях от верхнего левого угла начала координат.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-124">The physical coordinates of a point are the actual offset in pixels from the top left of the origin.</span></span> <span data-ttu-id="c3bf1-125">Логические координаты — это смещения, какими они были бы, если бы сами пиксели масштабировались.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-125">The logical coordinates are the offsets as they would be if the pixels themselves were scaled.</span></span>

<span data-ttu-id="c3bf1-126">Предположим, вы разрабатываете диалоговое окно с кнопкой, имеющей координаты (100, 48).</span><span class="sxs-lookup"><span data-stu-id="c3bf1-126">Suppose you design a dialog box with a button at coordinates (100, 48).</span></span> <span data-ttu-id="c3bf1-127">Когда это диалоговое окно отображается по умолчанию 96 dpi, кнопка находится в расположениях с физическими координатами (100, 48).</span><span class="sxs-lookup"><span data-stu-id="c3bf1-127">When this dialog box is displayed at the default 96 dpi, the button is located at physical coordinates of (100, 48).</span></span> <span data-ttu-id="c3bf1-128">В 120 dpi он находится в физических координатах (125, 60).</span><span class="sxs-lookup"><span data-stu-id="c3bf1-128">At 120 dpi, it is located at physical coordinates of (125, 60).</span></span> <span data-ttu-id="c3bf1-129">Однако логические координаты одинаковы при любом значении DPI: (100, 48).</span><span class="sxs-lookup"><span data-stu-id="c3bf1-129">But the logical coordinates are the same at any dpi setting: (100, 48).</span></span>

<span data-ttu-id="c3bf1-130">Логические координаты важны, так как они делают поведение операционной системы и приложений совместимым, независимо от параметра dpi.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-130">Logical coordinates are important, because they make the behavior of the operating system and applications consistent regardless of the dpi setting.</span></span> <span data-ttu-id="c3bf1-131">Например, **System. Windows. Forms. Cursor. положением** обычно возвращает логические координаты.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-131">For example, **System.Windows.Forms.Cursor.Position** normally returns the logical coordinates.</span></span> <span data-ttu-id="c3bf1-132">При перемещении курсора по элементу в диалоговом окне возвращаются одни и те же координаты независимо от параметра dpi.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-132">If you move the cursor over an element in a dialog box, the same coordinates are returned regardless of the dpi setting.</span></span> <span data-ttu-id="c3bf1-133">Если нарисовать элемент управления в (100, 100), он выводится на эти логические координаты и будет занимать ту же относительную точку при любом значении DPI.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-133">If you draw a control at (100, 100), it is drawn to those logical coordinates, and will occupy the same relative position at any dpi setting.</span></span>

## <a name="scaling-in-active-accessibility-clients"></a><span data-ttu-id="c3bf1-134">Масштабирование в Active Accessibility клиентов</span><span class="sxs-lookup"><span data-stu-id="c3bf1-134">Scaling in Active Accessibility Clients</span></span>

<span data-ttu-id="c3bf1-135">Microsoft Active Accessibility не использует логические координаты.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-135">Microsoft Active Accessibility does not use logical coordinates.</span></span> <span data-ttu-id="c3bf1-136">Следующие методы и функции возвращают физические координаты или принимают их в качестве параметров.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-136">The following methods and functions either return physical coordinates or take them as parameters.</span></span>

-   [<span data-ttu-id="c3bf1-137">**IAccessible:: Акчиттест**</span><span class="sxs-lookup"><span data-stu-id="c3bf1-137">**IAccessible::accHitTest**</span></span>](/windows/desktop/api/Oleacc/nf-oleacc-iaccessible-acchittest)
-   [<span data-ttu-id="c3bf1-138">**IAccessible:: Акклокатион**</span><span class="sxs-lookup"><span data-stu-id="c3bf1-138">**IAccessible::accLocation**</span></span>](/windows/desktop/api/Oleacc/nf-oleacc-iaccessible-acclocation)
-   [<span data-ttu-id="c3bf1-139">**акцессиблеобжектфромпоинт**</span><span class="sxs-lookup"><span data-stu-id="c3bf1-139">**AccessibleObjectFromPoint**</span></span>](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfrompoint)

<span data-ttu-id="c3bf1-140">По умолчанию клиентское приложение Microsoft Active Accessibility, работающее в среде без 96 dpi, не сможет получить правильные результаты этих вызовов.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-140">By default, an Microsoft Active Accessibility client application running in a non-96-dpi environment will not be able to obtain correct results from these calls.</span></span> <span data-ttu-id="c3bf1-141">Например, поскольку положением курсора являются логические координаты, клиент не может просто передать эти координаты [**акцессиблеобжектфромпоинт**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfrompoint) , чтобы получить элемент, находящийся под курсором.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-141">For example, because the cursor position is in logical coordinates, the client cannot simply pass these coordinates to [**AccessibleObjectFromPoint**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfrompoint) to obtain the element that is under the cursor.</span></span>

<span data-ttu-id="c3bf1-142">Кроме того, приложение, которое создает окно за пределами клиентской области, например приложение для специальных возможностей, которое выделяет элементы пользовательского интерфейса, не создает окно в правильном расположении на экране, так как окно будет помещено на логические координаты, а не на физические координаты, возвращаемые методом [**IAccessible:: акклокатион**](/windows/desktop/api/Oleacc/nf-oleacc-iaccessible-acclocation).</span><span class="sxs-lookup"><span data-stu-id="c3bf1-142">In addition, an application that creates a window outside its client area, such as an accessibility application that highlights focused UI elements, will not create the window at the correct screen location, because the window will be placed at the logical coordinates, not the physical coordinates returned by [**IAccessible::accLocation**](/windows/desktop/api/Oleacc/nf-oleacc-iaccessible-acclocation).</span></span>

<span data-ttu-id="c3bf1-143">Решение состоит из двух частей:</span><span class="sxs-lookup"><span data-stu-id="c3bf1-143">The solution is in two parts:</span></span>

-   <span data-ttu-id="c3bf1-144">Установите клиентское приложение "с учетом dpi".</span><span class="sxs-lookup"><span data-stu-id="c3bf1-144">Make the client application "dpi-aware".</span></span> <span data-ttu-id="c3bf1-145">Для этого вызовите функцию [**сетпроцессдпиаваре**](/windows/win32/api/winuser/nf-winuser-setprocessdpiaware) при запуске.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-145">To do this, call the [**SetProcessDPIAware**](/windows/win32/api/winuser/nf-winuser-setprocessdpiaware) function at startup.</span></span> <span data-ttu-id="c3bf1-146">Эта функция выполняет весь процесс, учитывающий dpi, что означает, что все окна, принадлежащие процессу, не масштабируются.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-146">This function makes the entire process dpi-aware, meaning that all windows that belong to the process are unscaled.</span></span>
-   <span data-ttu-id="c3bf1-147">Используйте функции с поддержкой dpi.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-147">Use functions that are dpi-aware.</span></span> <span data-ttu-id="c3bf1-148">Например, чтобы получить координаты курсора, вызовите функцию [**жетфисикалкурсорпос**](/windows/win32/api/winuser/nf-winuser-getphysicalcursorpos) .</span><span class="sxs-lookup"><span data-stu-id="c3bf1-148">For example, to get cursor coordinates, call the [**GetPhysicalCursorPos**](/windows/win32/api/winuser/nf-winuser-getphysicalcursorpos) function.</span></span> <span data-ttu-id="c3bf1-149">Не используйте [**жеткурсорпос**](/windows/win32/api/winuser/nf-winuser-getcursorpos). его поведение в приложениях, поддерживающих dpi, не определено.</span><span class="sxs-lookup"><span data-stu-id="c3bf1-149">Do not use [**GetCursorPos**](/windows/win32/api/winuser/nf-winuser-getcursorpos); its behavior in dpi-aware applications is undefined.</span></span>

<span data-ttu-id="c3bf1-150">Если приложение выполняет прямое межпроцессное взаимодействие с приложениями, не поддерживающими dpi, возможно преобразование между логическими и физическими координатами с помощью функций [**фисикалтологикалпоинт**](/windows/win32/api/winuser/nf-winuser-physicaltologicalpoint) и [**логикалтофисикалпоинт**](/windows/win32/api/winuser/nf-winuser-logicaltophysicalpoint) .</span><span class="sxs-lookup"><span data-stu-id="c3bf1-150">If your application performs direct cross-process communication with non-dpi-aware applications, you may have convert between logical and physical coordinates by using the [**PhysicalToLogicalPoint**](/windows/win32/api/winuser/nf-winuser-physicaltologicalpoint) and [**LogicalToPhysicalPoint**](/windows/win32/api/winuser/nf-winuser-logicaltophysicalpoint) functions.</span></span>

 

 