---
description: В примере расширенного распознавания демонстрируются расширенные возможности программного интерфейса программирования автоматизации приложений Microsoft Tablet PC (API), используемого для распознавания рукописного текста.
ms.assetid: 4c9b9f31-c317-43fd-8404-35295b41d093
title: Пример расширенного распознавания
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7e23a078ded9c6967f8e45780f8cb3a739b246f6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103807990"
---
# <a name="advanced-recognition-sample"></a><span data-ttu-id="9d350-103">Пример расширенного распознавания</span><span class="sxs-lookup"><span data-stu-id="9d350-103">Advanced Recognition Sample</span></span>

<span data-ttu-id="9d350-104">В примере расширенного распознавания демонстрируются расширенные возможности программного интерфейса программирования автоматизации приложений Microsoft Tablet PC (API), используемого для распознавания рукописного текста.</span><span class="sxs-lookup"><span data-stu-id="9d350-104">The advanced recognition sample demonstrates advanced features of the Microsoft Tablet PC Automation application programming interface (API) used for handwriting recognition.</span></span>

<span data-ttu-id="9d350-105">Он включает следующие компоненты.</span><span class="sxs-lookup"><span data-stu-id="9d350-105">It includes the following features:</span></span>

-   <span data-ttu-id="9d350-106">Перечисление установленного распознавателя</span><span class="sxs-lookup"><span data-stu-id="9d350-106">Enumerating the installed recognizer</span></span>
-   <span data-ttu-id="9d350-107">Создание контекста распознавателя с конкретным языком</span><span class="sxs-lookup"><span data-stu-id="9d350-107">Creating a recognizer context with a specific language</span></span>
-   <span data-ttu-id="9d350-108">Использование объекта распознавателя</span><span class="sxs-lookup"><span data-stu-id="9d350-108">Using the recognizer object</span></span>
-   <span data-ttu-id="9d350-109">Настройка фактоид распознавания и списков слов</span><span class="sxs-lookup"><span data-stu-id="9d350-109">Setting recognition factoid and word lists</span></span>
-   <span data-ttu-id="9d350-110">Использование руководств для повышения качества распознавания</span><span class="sxs-lookup"><span data-stu-id="9d350-110">Using guides to improve the recognition quality</span></span>
-   <span data-ttu-id="9d350-111">Динамическое распознавание фона</span><span class="sxs-lookup"><span data-stu-id="9d350-111">Dynamic background recognition</span></span>
-   <span data-ttu-id="9d350-112">Распознавание жестов</span><span class="sxs-lookup"><span data-stu-id="9d350-112">Gesture recognition</span></span>

<span data-ttu-id="9d350-113">Используются следующие интерфейсы: [**иинкрекогнизер**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkrecognizer), **иинкрекоконтекст**, [**иинкрекогнитионресулт**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkrecognitionresult), **иинкрекогнитионгуиде**, **иинквордлист**, [**IInkGesture**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkgesture), **IInkCollector**, **IInkDisp**, **IInkRenderer**, **IInkDrawingAttributes**, **IInkStrokes** и **IInkStroke**.</span><span class="sxs-lookup"><span data-stu-id="9d350-113">The interfaces used are: [**IInkRecognizer**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkrecognizer), **IInkRecoContext**, [**IInkRecognitionResult**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkrecognitionresult), **IInkRecognitionGuide**, **IInkWordList**, [**IInkGesture**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkgesture), **IInkCollector**, **IInkDisp**, **IInkRenderer**, **IInkDrawingAttributes**, **IInkStrokes**, and **IInkStroke**.</span></span>

## <a name="ink-and-project-headers"></a><span data-ttu-id="9d350-114">Рукописный ввод и заголовки проектов</span><span class="sxs-lookup"><span data-stu-id="9d350-114">Ink and Project Headers</span></span>

<span data-ttu-id="9d350-115">Сначала включите заголовки для интерфейсов автоматизации планшетных ПК.</span><span class="sxs-lookup"><span data-stu-id="9d350-115">First, include the headers for Tablet PC Automation interfaces.</span></span> <span data-ttu-id="9d350-116">Они устанавливаются вместе с пакетом SDK для платформы Tablet PC Platform.</span><span class="sxs-lookup"><span data-stu-id="9d350-116">These are installed with the Tablet PC Platform SDK.</span></span> <span data-ttu-id="9d350-117">Файл Тпцеррор. h содержит определения кодов ошибок API для планшетных ПК.</span><span class="sxs-lookup"><span data-stu-id="9d350-117">The TpcError.h file contains the Tablet PC API Error Code definitions.</span></span>


```C++
#include <msinkaut.h>
#include <msinkaut_i.c>
#include <TpcError.h>
```



<span data-ttu-id="9d350-118">Файл Евентсинкс. h определяет интерфейсы **иинкевентсимпл** и **иинкрекогнитионевентсимпл** и настраивает события [**рекогнитионвисалтернатес**](inkrecognizercontext-recognitionwithalternates.md), [**Stroke**](inkcollector-stroke.md)и [**жестов**](inkcollector-gesture.md) .</span><span class="sxs-lookup"><span data-stu-id="9d350-118">The EventSinks.h file defines the **IInkEventsImpl** and **IInkRecognitionEventsImpl** interfaces, and sets up the [**RecognitionWithAlternates**](inkrecognizercontext-recognitionwithalternates.md), [**Stroke**](inkcollector-stroke.md), and [**Gesture**](inkcollector-gesture.md) events.</span></span>


```C++
#include "EventSinks.h"
```



<span data-ttu-id="9d350-119">Файл Чилдвндс. h содержит определения классов **Цинкинпутвнд** и **крекуутпутвнд**, которые являются производными от квиндовимпл ATL и используются для создания дочерних окон примера.</span><span class="sxs-lookup"><span data-stu-id="9d350-119">The ChildWnds.h file contains the definitions of the classes **CInkInputWnd** and **CRecoOutputWnd**, which are derived from the ATL's CWindowImpl and used for creating the sample's child windows.</span></span>


```C++
#include "ChildWnds.h"
```



<span data-ttu-id="9d350-120">Файл Адвреко. h объявляет класс **кадврекоапп** , который является классом окна приложения для этого примера.</span><span class="sxs-lookup"><span data-stu-id="9d350-120">The AdvReco.h file declares the **CAdvRecoApp** class, which is the application window class for this sample.</span></span>


```C++
#include "AdvReco.h"
```



## <a name="initializing-the-application-window"></a><span data-ttu-id="9d350-121">Инициализация окна приложения</span><span class="sxs-lookup"><span data-stu-id="9d350-121">Initializing the Application Window</span></span>

<span data-ttu-id="9d350-122">`Run`Метод окна настраивает объект **кадврекоапп** , загружает меню и значок для окна, создает объект [**инкрекогнизерконтекст**](inkrecognizercontext-class.md) для распознавателя по умолчанию и запускает цикл обработки сообщений окна.</span><span class="sxs-lookup"><span data-stu-id="9d350-122">The window's `Run` method sets up the **CAdvRecoApp** object, loads the menu and icon for the window, creates an [**InkRecognizerContext**](inkrecognizercontext-class.md) object for the default recognizer, and starts the window's message loop.</span></span>

<span data-ttu-id="9d350-123">Метод **OnCreate** окна обрабатывает событие **\_ создания WM** и создает дочерние окна.</span><span class="sxs-lookup"><span data-stu-id="9d350-123">The window's **OnCreate** method handles the **WM\_CREATE** event and creates the child windows.</span></span> <span data-ttu-id="9d350-124">Объект [**InkCollector**](inkcollector-class.md) подключается к источнику событий сборщика рукописных данных и включает ввод рукописных данных в окне ввода.</span><span class="sxs-lookup"><span data-stu-id="9d350-124">An [**InkCollector**](inkcollector-class.md) object connects to the ink collector's event source, and enables ink input on the input window.</span></span> <span data-ttu-id="9d350-125">Затем он создает объект [**инкрекогнизергуиде**](inkrecognizerguide-class.md) и использует свойство модуля [**подготовки**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_renderer) сборщика рукописных данных для преобразования прямоугольников с руководством по распознаванию в пространство рукописного ввода.</span><span class="sxs-lookup"><span data-stu-id="9d350-125">Then it creates an [**InkRecognizerGuide**](inkrecognizerguide-class.md) object and uses the ink collector's [**Renderer**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_renderer) property to convert the recognition guide box rectangles to ink space.</span></span> <span data-ttu-id="9d350-126">Наконец, метод **OnCreate** создает объект [**инквордлист**](inkwordlist-class.md) .</span><span class="sxs-lookup"><span data-stu-id="9d350-126">Finally, the **OnCreate** method creates an [**InkWordList**](inkwordlist-class.md) object.</span></span>

## <a name="handling-ink-collector-events"></a><span data-ttu-id="9d350-127">Обработка событий сборщика рукописных данных</span><span class="sxs-lookup"><span data-stu-id="9d350-127">Handling Ink Collector Events</span></span>

<span data-ttu-id="9d350-128">Метод **onstroke** окна обрабатывает событие [**Stroke**](inkcollector-stroke.md) сборщика рукописных данных.</span><span class="sxs-lookup"><span data-stu-id="9d350-128">The window's **OnStroke** method handles the ink collector's [**Stroke**](inkcollector-stroke.md) event.</span></span> <span data-ttu-id="9d350-129">Новый объект [**иинкстрокедисп**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkstrokedisp) добавляется в [инкстрокес](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) свойства [**Ink**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_ink) сборщика рукописных данных.</span><span class="sxs-lookup"><span data-stu-id="9d350-129">The new [**IInkStrokeDisp**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkstrokedisp) object is added to the [InkStrokes](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) of the ink collector's [**Ink**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_ink) property.</span></span>

<span data-ttu-id="9d350-130">Метод **ongesture** окна обрабатывает событие [**жеста**](inkcollector-gesture.md) сборщика рукописных данных.</span><span class="sxs-lookup"><span data-stu-id="9d350-130">The window's **OnGesture** method handles the ink collector's [**Gesture**](inkcollector-gesture.md) event.</span></span> <span data-ttu-id="9d350-131">Метод **ongesture** определяет жест, сначала используя жест с наивысшим уровнем достоверности, и проверяет, поддерживает ли окно этот конкретный жест.</span><span class="sxs-lookup"><span data-stu-id="9d350-131">The **OnGesture** method identifies the gesture, using the highest confidence gesture first, and checks if the window supports this particular gesture.</span></span> <span data-ttu-id="9d350-132">Если жест поддерживается, ограничивающий прямоугольник для жеста становится недействительным, так как жест удаляется из коллекции штрихов.</span><span class="sxs-lookup"><span data-stu-id="9d350-132">If the gesture is supported, the gesture's bounding box is invalidated, as the gesture is removed from the strokes collection.</span></span> <span data-ttu-id="9d350-133">Если жест не поддерживается, событие **жеста** отменяется, что приводит к тому, что сборщик рукописных данных создает событие [**Stroke**](inkcollector-stroke.md) .</span><span class="sxs-lookup"><span data-stu-id="9d350-133">If the gesture is not supported, the **Gesture** event is canceled, which causes the ink collector to raise a [**Stroke**](inkcollector-stroke.md) event.</span></span> <span data-ttu-id="9d350-134">Наконец, окно результатов обновляется.</span><span class="sxs-lookup"><span data-stu-id="9d350-134">Finally, the results window is updated.</span></span>

## <a name="handling-recognizer-context-events"></a><span data-ttu-id="9d350-135">Обработка событий контекста распознавателя</span><span class="sxs-lookup"><span data-stu-id="9d350-135">Handling Recognizer Context Events</span></span>

<span data-ttu-id="9d350-136">Метод **онрекогнитионвисалтернатес** окна обрабатывает событие [**рекогнитионвисалтернатес**](inkrecognizercontext-recognitionwithalternates.md) контекста распознавателя.</span><span class="sxs-lookup"><span data-stu-id="9d350-136">The window's **OnRecognitionWithAlternates** method handles the recognizer context's [**RecognitionWithAlternates**](inkrecognizercontext-recognitionwithalternates.md) event.</span></span> <span data-ttu-id="9d350-137">Метод **онрекогнитионвисалтернатес** отображает результаты распознавания в окне результаты.</span><span class="sxs-lookup"><span data-stu-id="9d350-137">The **OnRecognitionWithAlternates** method displays the recognition results in the results window.</span></span>

## <a name="handling-menu-commands"></a><span data-ttu-id="9d350-138">Обработка команд меню</span><span class="sxs-lookup"><span data-stu-id="9d350-138">Handling Menu Commands</span></span>

<span data-ttu-id="9d350-139">Метод **Onrecognizeя** окна обрабатывает команды в меню распознавателя.</span><span class="sxs-lookup"><span data-stu-id="9d350-139">The window's **OnRecognizer** method handles the commands on the Recognizer menu.</span></span> <span data-ttu-id="9d350-140">Если выбрана команда **по умолчанию** , метод [**жетдефаултрекогнизер**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizers-getdefaultrecognizer) объекта [инкрекогнизерс](/previous-versions/windows/desktop/legacy/ms702438(v=vs.85)) используется для получения распознавателя по умолчанию. в противном случае извлекается выбранный распознаватель.</span><span class="sxs-lookup"><span data-stu-id="9d350-140">If the **Default** command was selected, the [**GetDefaultRecognizer**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizers-getdefaultrecognizer) method of the [InkRecognizers](/previous-versions/windows/desktop/legacy/ms702438(v=vs.85)) is used to retrieve the default recognizer; otherwise, the selected recognizer is retrieved.</span></span> <span data-ttu-id="9d350-141">Затем создается и используется контекст распознавателя, а затем обновляются строки меню и состояния.</span><span class="sxs-lookup"><span data-stu-id="9d350-141">Then, a recognizer context is created and used, and menu and status bar are updated.</span></span>

<span data-ttu-id="9d350-142">Метод **онфактоидвордлист** окна обрабатывает команду **use список слов** в меню **фактоид** .</span><span class="sxs-lookup"><span data-stu-id="9d350-142">The window's **OnFactoidWordlist** method handles the **Use Wordlist** command on the **Factoid** menu.</span></span> <span data-ttu-id="9d350-143">Для свойства [**Stroke**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) контекста распознавателя установлено **значение NULL** , чтобы сбросить контекст распознавателя.</span><span class="sxs-lookup"><span data-stu-id="9d350-143">The recognizer context's [**Strokes**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) property is set to **NULL** to reset the recognizer context.</span></span> <span data-ttu-id="9d350-144">Если параметр **использовать** пустые значения отключен, свойство [**список слов**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_wordlist) в контексте распознавателя имеет значение **null**; в противном случае в качестве значения свойства **список слов** для контекста распознавателя задается значение [**инквордлист**](inkwordlist-class.md) , созданное в методе **OnCreate** .</span><span class="sxs-lookup"><span data-stu-id="9d350-144">If the **Use Wordlist** option is turned off, the recognizer context's [**WordList**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_wordlist) property is set to **NULL**; otherwise, the recognizer context's **WordList** property is set to the [**InkWordList**](inkwordlist-class.md) that was created in the **OnCreate** method.</span></span> <span data-ttu-id="9d350-145">Наконец, [инкстрокес](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) сборщика рукописных данных повторно присоединяется к контексту распознавателя, вызывается метод [**баккграундрекогнизевисалтернатес**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) контекста распознавателя и обновляется меню.</span><span class="sxs-lookup"><span data-stu-id="9d350-145">Finally, the [InkStrokes](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) of the ink collector is reattached to the recognizer context, the recognizer context's [**BackgroundRecognizeWithAlternates**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) method is called, and the menu is updated.</span></span>

<span data-ttu-id="9d350-146">Метод **онфактоид** окна обрабатывает команды фактоид в меню **фактоид** .</span><span class="sxs-lookup"><span data-stu-id="9d350-146">The window's **OnFactoid** method handles the factoid commands on the **Factoid** menu.</span></span> <span data-ttu-id="9d350-147">Сначала он устанавливает для свойства [**Strokes**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) контекст распознавателя **значение NULL**, устанавливает свойство [**фактоид**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_factoid) контекста распознавателя в выбранное фактоид и перенаписывает [инкстрокес](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) сборщика рукописных данных в контекст распознавателя.</span><span class="sxs-lookup"><span data-stu-id="9d350-147">It first sets the recognizer context's [**Strokes**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) property to **NULL**, sets the recognizer context's [**Factoid**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_factoid) property to the selected factoid, and reassigns the [InkStrokes](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) of the ink collector to the recognizer context.</span></span> <span data-ttu-id="9d350-148">Если объект [фактоид](factoid-constants.md) поддерживается контекстом распознавателя, вызывается метод [**баккграундрекогнизевисалтернатес**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) контекста распознавателя. в противном случае отображается сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="9d350-148">If the [Factoid](factoid-constants.md) object is supported by the recognizer context, the recognizer context's [**BackgroundRecognizeWithAlternates**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) method is called; otherwise, an error message is displayed.</span></span> <span data-ttu-id="9d350-149">Наконец, меню и строка состояния обновляются.</span><span class="sxs-lookup"><span data-stu-id="9d350-149">Finally, the menu and status bar are updated.</span></span>

<span data-ttu-id="9d350-150">Метод **onguide** окна обрабатывает команды в меню **Guide** .</span><span class="sxs-lookup"><span data-stu-id="9d350-150">The window's **OnGuide** method handles the commands on the **Guide** menu.</span></span> <span data-ttu-id="9d350-151">Если контекст распознавателя поддерживает параметры программы Guide, метод **onguide** устанавливает для свойства [**Stroke**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) контекста распознавателя **значение NULL**, устанавливает для свойства "программа" в контексте распознавателя выбранное значение [**параметра Guide,**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_guide) переназначает [инкстрокес](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) из сборщика рукописного текста в контекст распознавателя и вызывает метод [**баккграундрекогнизевисалтернатес**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) в контексте распознавателя.</span><span class="sxs-lookup"><span data-stu-id="9d350-151">If the recognizer context supports the guide options, the **OnGuide** method sets the recognizer context's [**Strokes**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) property to **NULL**, sets the recognizer context's [**Guide**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_guide) property to the selected guide setting, reassigns the [InkStrokes](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) of the ink collector to the recognizer context, and calls the recognizer context's [**BackgroundRecognizeWithAlternates**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) method.</span></span> <span data-ttu-id="9d350-152">В противном случае отображается сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="9d350-152">Otherwise, an error message is displayed.</span></span> <span data-ttu-id="9d350-153">Наконец, окно ввода, меню и строка состояния обновляются.</span><span class="sxs-lookup"><span data-stu-id="9d350-153">Finally, the input window, menu, and status bar are updated.</span></span>

<span data-ttu-id="9d350-154">Метод **onmode** окна обрабатывает команды в меню **режим** .</span><span class="sxs-lookup"><span data-stu-id="9d350-154">The window's **OnMode** method handles the commands on the **Mode** menu.</span></span> <span data-ttu-id="9d350-155">Он отключает сборщик рукописных данных, обновляет свойство [**режиме CollectionMode**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_collectionmode) сборщика рукописных данных, обновляет меню и отображает или скрывает списки жестов.</span><span class="sxs-lookup"><span data-stu-id="9d350-155">It disables the ink collector, updates the ink collector's [**CollectionMode**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_collectionmode) property, updates the menu, and shows or hides the gesture lists.</span></span> <span data-ttu-id="9d350-156">Наконец, включен сборщик рукописных данных.</span><span class="sxs-lookup"><span data-stu-id="9d350-156">Finally, the ink collector is enabled.</span></span>

<span data-ttu-id="9d350-157">Метод **onrecognize** окна обрабатывает команду **Recognize** в меню рукописного ввода.</span><span class="sxs-lookup"><span data-stu-id="9d350-157">The window's **OnRecognize** method handles the **Recognize** command on the Ink menu.</span></span> <span data-ttu-id="9d350-158">Он вызывает метод [**ендинкинпут**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-endinkinput) контекста распознавателя, чтобы предотвратить добавление рукописного ввода в контекст распознавателя.</span><span class="sxs-lookup"><span data-stu-id="9d350-158">It calls the recognizer context's [**EndInkInput**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-endinkinput) method to keep ink from being added to the recognizer context.</span></span> <span data-ttu-id="9d350-159">Иногда это необходимо, так как не все распознаватели поддерживают частичное распознавание.</span><span class="sxs-lookup"><span data-stu-id="9d350-159">This is sometimes necessary, as not all recognizers support partial recognition.</span></span> <span data-ttu-id="9d350-160">Затем вызывается метод [**распознавания**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-recognize) контекста распознавателя и результаты передаются в метод **онрекогнитионвисалтернатес** окна.</span><span class="sxs-lookup"><span data-stu-id="9d350-160">Then it calls the recognizer context's [**Recognize**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-recognize) method, and passes the results to the window's **OnRecognitionWithAlternates** method.</span></span> <span data-ttu-id="9d350-161">Наконец, [инкстрокес](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) сборщика рукописных данных переназначится в контекст распознавателя.</span><span class="sxs-lookup"><span data-stu-id="9d350-161">Finally, the [InkStrokes](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) of the ink collector is reassigned to the recognizer context.</span></span>

<span data-ttu-id="9d350-162">Метод **OnClear** окна обрабатывает команду **clear** в меню **рукописного ввода** .</span><span class="sxs-lookup"><span data-stu-id="9d350-162">The window's **OnClear** method handles the **Clear** command on the **Ink** menu.</span></span> <span data-ttu-id="9d350-163">Он удаляет штрихи из свойства [**рукописного ввода**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_ink) сборщика рукописных данных, освобождает старую коллекцию штрихов и создает новый для свойства **Ink** сборщика рукописных данных и прикрепляет новую коллекцию штрихов к контексту распознавателя.</span><span class="sxs-lookup"><span data-stu-id="9d350-163">It deletes the strokes from the ink collector's [**Ink**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_ink) property, releases the old strokes collection and creates a new one for the ink collector's **Ink** property, and attaches the new strokes collection to the recognizer context.</span></span>

<span data-ttu-id="9d350-164">Метод **onexit** окна обрабатывает команду **Exit** в меню **рукописного ввода** и вызывает \_ событие закрытия WM.</span><span class="sxs-lookup"><span data-stu-id="9d350-164">The window's **OnExit** method handles the **Exit** command on the **Ink** menu, and raises the WM\_CLOSE event.</span></span>

## <a name="helper-methods"></a><span data-ttu-id="9d350-165">Вспомогательные методы</span><span class="sxs-lookup"><span data-stu-id="9d350-165">Helper Methods</span></span>

<span data-ttu-id="9d350-166">Метод **лоадмену** окна вызывается из метода **Run** окна и добавляет в меню список поддерживаемых распознавателей и список поддерживаемых фактоидс.</span><span class="sxs-lookup"><span data-stu-id="9d350-166">The window's **LoadMenu** method is called from the window's **Run** method, and adds the list of supported recognizers and the list of supported factoids to the menu.</span></span> <span data-ttu-id="9d350-167">Сначала он получает [инкрекогнизерс](/previous-versions/windows/desktop/legacy/ms702438(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="9d350-167">First, it retrieves the [InkRecognizers](/previous-versions/windows/desktop/legacy/ms702438(v=vs.85)).</span></span> <span data-ttu-id="9d350-168">Затем он перебирает доступные распознаватели и выбирает только те из них, которые имеют список языков в свойстве **Languages** , которое добавляется в меню **распознавателя** .</span><span class="sxs-lookup"><span data-stu-id="9d350-168">Then it iterates through the available recognizers and only selects ones that have a list of languages in the **Languages** property, which it adds to the **Recognizer** menu.</span></span> <span data-ttu-id="9d350-169">Наконец, он заполняет меню **фактоид** списком фактоидс, определенным как глобальная константа.</span><span class="sxs-lookup"><span data-stu-id="9d350-169">Finally, it populates the **Factoid** menu with the list of factoids defined as a global constant.</span></span>

<span data-ttu-id="9d350-170">Метод **усерекогнизер** окна вызывается из метода **onrecognizeя** окна, когда пользователь выбирает новый распознаватель.</span><span class="sxs-lookup"><span data-stu-id="9d350-170">The window's **UseRecognizer** method is called from the window's **OnRecognizer** method when the user selects a new recognizer.</span></span> <span data-ttu-id="9d350-171">Он создает контекст распознавателя, отсоединяет старый контекст от приемника событий распознавателя, очищает и освобождает старый контекст и прикрепляет новый контекст к приемнику событий распознавателя.</span><span class="sxs-lookup"><span data-stu-id="9d350-171">It creates a recognizer context, detaches the old context from the recognizer event sink, clears and releases the old context, and attaches the new context to the recognizer event sink.</span></span>

<span data-ttu-id="9d350-172">Затем метод **усерекогнизер** проверяет свойство [**возможностей**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizer-get_capabilities) распознавателя, которое возвращает значение [**инкрекогнизеркапабилитиес**](/windows/desktop/api/msinkaut/ne-msinkaut-inkrecognizercapabilities) .</span><span class="sxs-lookup"><span data-stu-id="9d350-172">Then, the **UseRecognizer** method checks the recognizer's [**Capabilities**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizer-get_capabilities) property, which returns an [**InkRecognizerCapabilities**](/windows/desktop/api/msinkaut/ne-msinkaut-inkrecognizercapabilities) value.</span></span> <span data-ttu-id="9d350-173">Если распознаватель поддерживает ввод с линией, команда **строки** в меню " **Направляющая** " будет включена.</span><span class="sxs-lookup"><span data-stu-id="9d350-173">If the recognizer supports lined input, the **Lines** command on the **Guide** menu is enabled.</span></span> <span data-ttu-id="9d350-174">Если распознаватель поддерживает Упакованные входные данные, команда " **окна** " становится доступной.</span><span class="sxs-lookup"><span data-stu-id="9d350-174">If the recognizer supports boxed input, the **Boxes** command is enabled.</span></span> <span data-ttu-id="9d350-175">Если распознаватель не поддерживает свободные входные данные, команда **None** отключена.</span><span class="sxs-lookup"><span data-stu-id="9d350-175">If the recognizer does not support free input, the **None** command is disabled.</span></span> <span data-ttu-id="9d350-176">Если текущий выбор руководств не поддерживается, то обновляются и свойство [**Guide**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_guide) контекста распознавателя, и меню.</span><span class="sxs-lookup"><span data-stu-id="9d350-176">If the current guide selection is not supported, both the [**Guide**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_guide) property of the recognizer context and the menu are updated.</span></span>

<span data-ttu-id="9d350-177">Затем метод **усерекогнизер** пытается задать свойства " [**список слов**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_wordlist) " и [**фактоид**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_factoid) для контекста распознавателя.</span><span class="sxs-lookup"><span data-stu-id="9d350-177">Then, the **UseRecognizer** method attempts to set the [**WordList**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_wordlist) and [**Factoid**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_factoid) properties of the recognizer context.</span></span> <span data-ttu-id="9d350-178">Если какой-либо из параметров не поддерживается распознавателем, то используется значение по умолчанию и обновляется меню.</span><span class="sxs-lookup"><span data-stu-id="9d350-178">If either setting is not supported by the recognizer, then the default value is used and the menu is updated.</span></span>

<span data-ttu-id="9d350-179">Наконец, метод **усерекогнизер** присоединяет свойство [**Strokes**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) объекта [**инкдисп**](inkdisp-class.md) сборщика рукописных данных к контексту распознавателя, изменяет шрифт окна вывода на единицу, поддерживаемую языком распознавателя, сбрасывает окно вывода и обновляет результаты распознавания, вызывая метод [**баккграундрекогнизевисалтернатес**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) контекста распознавателя.</span><span class="sxs-lookup"><span data-stu-id="9d350-179">Finally, the **UseRecognizer** method attaches the [**Strokes**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) property of the ink collector's [**InkDisp**](inkdisp-class.md) object to the recognizer context, changes the output window's font to one supported by the language of the recognizer, resets the output window, and updates the recognition results by calling the recognizer context's [**BackgroundRecognizeWithAlternates**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) method.</span></span>

<span data-ttu-id="9d350-180">Метод **жетжестуренаме** окна вызывается из метода **ongesture** окна.</span><span class="sxs-lookup"><span data-stu-id="9d350-180">The window's **GetGestureName** method is called from the window's **OnGesture** method.</span></span> <span data-ttu-id="9d350-181">Он выполняет поиск жеста и возвращает индекс в имя жеста, которое хранится в таблице строк в файле Адвреко. rc.</span><span class="sxs-lookup"><span data-stu-id="9d350-181">It searches for the gesture and returns an index to the gesture's name, which is stored in a string table in the AdvReco.rc file.</span></span>

 

 
