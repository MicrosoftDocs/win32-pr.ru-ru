---
description: Использование отката шрифта
ms.assetid: 952f33b6-ca52-40a2-b914-52c1c62ae0e0
title: Использование отката шрифта
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9afb073a01cc1c5b90d4a4861a973846d3ae9ae1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103819001"
---
# <a name="using-font-fallback"></a><span data-ttu-id="29a49-103">Использование отката шрифта</span><span class="sxs-lookup"><span data-stu-id="29a49-103">Using Font Fallback</span></span>

> [!Note]  
> <span data-ttu-id="29a49-104">В этом разделе все замечания о [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) применяются одинаково к [**скриптшапеопентипе**](/windows/desktop/api/Usp10/nf-usp10-scriptshapeopentype).</span><span class="sxs-lookup"><span data-stu-id="29a49-104">In this topic, all remarks about [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) apply equally to [**ScriptShapeOpenType**](/windows/desktop/api/Usp10/nf-usp10-scriptshapeopentype).</span></span>

 

<span data-ttu-id="29a49-105">Приложение должно использовать откат шрифтов во время вывода текста, если некоторые символы в строке не поддерживаются в шрифте или если приложение использует [сложный скрипт](uniscribe-glossary.md) , не поддерживаемый шрифтом.</span><span class="sxs-lookup"><span data-stu-id="29a49-105">Your application must use font fallback during text display if some characters in a string are not supported in the font, or if the application uses a [complex script](uniscribe-glossary.md) not supported by the font.</span></span> <span data-ttu-id="29a49-106">Требование отката шрифта определяется во время процесса макета для текста, когда приложение вызывает функцию [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) .</span><span class="sxs-lookup"><span data-stu-id="29a49-106">The requirement for font fallback is detected during the layout process for text, when the application calls the [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) function.</span></span> <span data-ttu-id="29a49-107">Сведения о отображении текста см. [в разделе Отображение текста с помощью Uniscribe](displaying-text-with-uniscribe.md).</span><span class="sxs-lookup"><span data-stu-id="29a49-107">For information about text display, see [Displaying Text with Uniscribe](displaying-text-with-uniscribe.md).</span></span>

## <a name="determine-the-need-for-font-fallback-for-unsupported-characters"></a><span data-ttu-id="29a49-108">Определение необходимости резервирования шрифтов для неподдерживаемых символов</span><span class="sxs-lookup"><span data-stu-id="29a49-108">Determine the Need for Font Fallback for Unsupported Characters</span></span>

<span data-ttu-id="29a49-109">Если некоторые символы в строке не поддерживаются в запрошенном шрифте, вызов приложения [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) будет выполнен.</span><span class="sxs-lookup"><span data-stu-id="29a49-109">If some of the characters in a string are not supported in a requested font, an application call to [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) succeeds.</span></span> <span data-ttu-id="29a49-110">Однако приложение должно проверить выходной буфер глифов на наличие отсутствующих глифов.</span><span class="sxs-lookup"><span data-stu-id="29a49-110">However, the application must scan the glyph output buffer for the presence of missing glyphs.</span></span> <span data-ttu-id="29a49-111">Индекс глифа отсутствующего глифа может быть определен для определенного шрифта путем вызова [**скриптжетфонтпропертиес**](/windows/desktop/api/Usp10/nf-usp10-scriptgetfontproperties).</span><span class="sxs-lookup"><span data-stu-id="29a49-111">The glyph index of the missing glyph can be determined for a specific font by calling [**ScriptGetFontProperties**](/windows/desktop/api/Usp10/nf-usp10-scriptgetfontproperties).</span></span> <span data-ttu-id="29a49-112">Если конкретный глиф недоступен, приложение должно либо вернуться к другому шрифту для глифа, либо визуализировать графический символ, указывающий на отсутствие доступных глифов.</span><span class="sxs-lookup"><span data-stu-id="29a49-112">If a particular glyph is unavailable, the application must either fall back to a different font for a glyph or render a graphic symbol that indicates that no glyph is available.</span></span>

## <a name="determine-the-need-for-font-fallback-for-unsupported-complex-scripts"></a><span data-ttu-id="29a49-113">Определение необходимости резервирования шрифтов для неподдерживаемых сложных наборов символов</span><span class="sxs-lookup"><span data-stu-id="29a49-113">Determine the Need for Font Fallback for Unsupported Complex Scripts</span></span>

<span data-ttu-id="29a49-114">Шрифт, предпочитаемый приложением для вывода, может не поддерживать сложные сценарии, необходимые для текста.</span><span class="sxs-lookup"><span data-stu-id="29a49-114">The font that an application prefers for display might not support a complex script that is required by the text.</span></span> <span data-ttu-id="29a49-115">В этом случае вызов приложения в [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) завершается сбоем с кодом ошибки E, \_ \_ отсутствующим \_ в \_ шрифте.</span><span class="sxs-lookup"><span data-stu-id="29a49-115">In this case, the application call to [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) fails with the error code E\_SCRIPT\_NOT\_IN\_FONT.</span></span>

## <a name="assign-a-fallback-font"></a><span data-ttu-id="29a49-116">Назначение резервного шрифта</span><span class="sxs-lookup"><span data-stu-id="29a49-116">Assign a Fallback Font</span></span>

<span data-ttu-id="29a49-117">После определения того, что требуется откат шрифта, приложение должно назначить резервный шрифт.</span><span class="sxs-lookup"><span data-stu-id="29a49-117">Once it has determined that font fallback is required, the application must assign a fallback font.</span></span> <span data-ttu-id="29a49-118">Приложение может использовать следующие методы:</span><span class="sxs-lookup"><span data-stu-id="29a49-118">The application can try the following techniques:</span></span>

-   <span data-ttu-id="29a49-119">Вызывайте [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) для каждого шрифта в списке шрифтов, пока один вызов не будет иметь допустимый возврат.</span><span class="sxs-lookup"><span data-stu-id="29a49-119">Call [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) for each font in a font list until one call has an acceptable return.</span></span>
-   <span data-ttu-id="29a49-120">Вызывайте [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) с каждым шрифтом в списке, пока не сможете определить, что шрифт не будет выполнен.</span><span class="sxs-lookup"><span data-stu-id="29a49-120">Call [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) with each font in a list until it can be determined that no font will succeed.</span></span> <span data-ttu-id="29a49-121">Если код ошибки всегда имеет \_ \_ \_ \_ нешрифтовый сценарий, то шрифты не поддерживаются сложным сценарием.</span><span class="sxs-lookup"><span data-stu-id="29a49-121">If the error code is always E\_SCRIPT\_NOT\_IN\_FONT, a complex script is not supported by the fonts.</span></span> <span data-ttu-id="29a49-122">Либо отрисовывает графический символ, указывающий, что нет доступных глифов, либо переопределите скрипт как неопределенный (без обработки скрипта) и начните снова.</span><span class="sxs-lookup"><span data-stu-id="29a49-122">Either render a graphic symbol that indicates that no glyph is available, or re-specify the script as undefined (no script processing) and start again.</span></span> <span data-ttu-id="29a49-123">Чтобы задать для скрипта значение undefine, установите для элемента **ескрипт** структуры [**\_ анализа скрипта**](/windows/win32/api/usp10/ns-usp10-script_analysis) значение \_ undefine script.</span><span class="sxs-lookup"><span data-stu-id="29a49-123">To set the script as undefined, set the **eScript** member of the [**SCRIPT\_ANALYSIS**](/windows/win32/api/usp10/ns-usp10-script_analysis) structure to SCRIPT\_UNDEFINED.</span></span>
-   <span data-ttu-id="29a49-124">Вызывайте [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) с каждым шрифтом в списке, пока не сможете определить, что шрифт не будет выполнен.</span><span class="sxs-lookup"><span data-stu-id="29a49-124">Call [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) with each font in a list until it can be determined that no font will succeed.</span></span> <span data-ttu-id="29a49-125">Если код ошибки указывает, что некоторые символы сопоставлены с отсутствующими глифами, разбейте строку на меньшие диапазоны.</span><span class="sxs-lookup"><span data-stu-id="29a49-125">If the error code indicates that some of the characters are mapping to missing glyphs, break up the string into smaller ranges.</span></span> <span data-ttu-id="29a49-126">Для поддиапазонов можно назначить различные шрифты, чтобы можно было отобразить больше символов.</span><span class="sxs-lookup"><span data-stu-id="29a49-126">Different fonts can be assigned to subranges so that more of the characters can be rendered.</span></span>

## <a name="generate-glyph-information"></a><span data-ttu-id="29a49-127">Создание сведений о глифе</span><span class="sxs-lookup"><span data-stu-id="29a49-127">Generate Glyph Information</span></span>

<span data-ttu-id="29a49-128">После того, как приложение назначило шрифт, который проходит через вызовы [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape), он может вызвать [**скриптплаце**](/windows/desktop/api/Usp10/nf-usp10-scriptplace) , чтобы создать ширину и объемное смещение глифа из выходных данных **скриптшапе**.</span><span class="sxs-lookup"><span data-stu-id="29a49-128">Once the application has assigned a font that succeeds in calls to [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape), it can make calls to [**ScriptPlace**](/windows/desktop/api/Usp10/nf-usp10-scriptplace) to generate glyph advance width and two-dimensional offset information from the output of **ScriptShape**.</span></span> <span data-ttu-id="29a49-129">Шрифт должен быть выполнен в этих вызовах.</span><span class="sxs-lookup"><span data-stu-id="29a49-129">The font should succeed in these calls.</span></span> <span data-ttu-id="29a49-130">Сбой шрифта при вызове **скриптплаце** после успешного выполнения в вызове **скриптшапе** указывает на поврежденный шрифт.</span><span class="sxs-lookup"><span data-stu-id="29a49-130">A font failure in a call to **ScriptPlace** after success in a **ScriptShape** call indicates a broken font.</span></span>

## <a name="related-topics"></a><span data-ttu-id="29a49-131">См. также</span><span class="sxs-lookup"><span data-stu-id="29a49-131">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="29a49-132">Использование Uniscribe</span><span class="sxs-lookup"><span data-stu-id="29a49-132">Using Uniscribe</span></span>](using-uniscribe.md)
</dt> </dl>

 

 



