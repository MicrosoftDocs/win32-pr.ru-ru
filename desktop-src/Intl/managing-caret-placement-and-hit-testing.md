---
description: Языки со сложными скриптами разбиваются на кластеры с помощью Скриптшапе. Изменение порядка символов всегда происходит в границах кластера. Сами по себе кластеры гарантированно передаются в направлении порядка чтения.
ms.assetid: 50b4b643-af96-4a6f-80f9-27a71ce16b0e
title: Управление размещением курсора и проверкой попадания
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 60396a668c89f7392b28adde0bb123060bf50348
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105682997"
---
# <a name="managing-caret-placement-and-hit-testing"></a><span data-ttu-id="4b117-105">Управление размещением курсора и проверкой попадания</span><span class="sxs-lookup"><span data-stu-id="4b117-105">Managing Caret Placement and Hit Testing</span></span>

<span data-ttu-id="4b117-106">Языки со сложными скриптами разбиваются на [кластеры](uniscribe-glossary.md) с помощью [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape).</span><span class="sxs-lookup"><span data-stu-id="4b117-106">Complex script languages are broken into [clusters](uniscribe-glossary.md) by [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape).</span></span> <span data-ttu-id="4b117-107">Изменение порядка символов всегда происходит в границах кластера.</span><span class="sxs-lookup"><span data-stu-id="4b117-107">Character reordering always occurs within cluster boundaries.</span></span> <span data-ttu-id="4b117-108">Сами по себе кластеры гарантированно передаются в направлении порядка чтения.</span><span class="sxs-lookup"><span data-stu-id="4b117-108">The clusters themselves are guaranteed to advance in the direction of the reading order.</span></span>

<span data-ttu-id="4b117-109">Сведения о кластере в логическом массиве кластера используются для равномерного совместного использования ширины кластера глифов между логическими символами, которые они представляют.</span><span class="sxs-lookup"><span data-stu-id="4b117-109">Cluster information in the logical cluster array is used to share the width of a cluster of glyphs equally among the logical characters they represent.</span></span> <span data-ttu-id="4b117-110">Например, глиф алиф лам делится на четыре области:</span><span class="sxs-lookup"><span data-stu-id="4b117-110">For example, the lam alef glyph is divided into four areas:</span></span>

-   <span data-ttu-id="4b117-111">Ведущая половина лам.</span><span class="sxs-lookup"><span data-stu-id="4b117-111">The leading half of the lam.</span></span>
-   <span data-ttu-id="4b117-112">Конечная половина лам.</span><span class="sxs-lookup"><span data-stu-id="4b117-112">The trailing half of the lam.</span></span>
-   <span data-ttu-id="4b117-113">Начальная половина Алиф.</span><span class="sxs-lookup"><span data-stu-id="4b117-113">The leading half of the alef.</span></span>
-   <span data-ttu-id="4b117-114">Конечная половина Алиф.</span><span class="sxs-lookup"><span data-stu-id="4b117-114">The trailing half of the alef.</span></span>

<span data-ttu-id="4b117-115">Соглашения о размещении курсоров в кластерах зависят от скрипта.</span><span class="sxs-lookup"><span data-stu-id="4b117-115">Conventions for caret placement within clusters depend on the script.</span></span> <span data-ttu-id="4b117-116">Для арабского скрипта, если задано расположение курсора между базовым символом и его комбинированной меткой, курсор отображается на середине по базовому символу.</span><span class="sxs-lookup"><span data-stu-id="4b117-116">For the Arabic script, if the caret position is set between a base character and its combining mark, the caret is displayed halfway through the base character.</span></span> <span data-ttu-id="4b117-117">Для тайского скрипта курсор не может быть помещен в кластер.</span><span class="sxs-lookup"><span data-stu-id="4b117-117">For the Thai script, the caret cannot be positioned within a cluster.</span></span> <span data-ttu-id="4b117-118">Таким же, когда пользователь перемещает курсор, приложение должно продвинуть все глифы, составляющие кластер.</span><span class="sxs-lookup"><span data-stu-id="4b117-118">Thus, when the user advances the caret, the application must advance past all the glyphs that make up the cluster.</span></span>

<span data-ttu-id="4b117-119">Функции [**скрипткстокп**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) и [**скрипткптокс**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox) преобразуются между позициями курсора (в смещениях кодовых точек) и позициями x (в пикселях).</span><span class="sxs-lookup"><span data-stu-id="4b117-119">The [**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) and [**ScriptCPtoX**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox) functions translate between caret positions (in code point offsets) and x positions (in pixels).</span></span> <span data-ttu-id="4b117-120">Функция **скрипткстокп** имеет знания о соглашениях о положении курсора для каждого скрипта:</span><span class="sxs-lookup"><span data-stu-id="4b117-120">The **ScriptXtoCP** function has knowledge of the caret position conventions of each script:</span></span>

-   <span data-ttu-id="4b117-121">Для Индийского и тайского положения курсоров привязываются к границам кластера.</span><span class="sxs-lookup"><span data-stu-id="4b117-121">For Indian and Thai, caret positions are snapped to cluster boundaries.</span></span>
-   <span data-ttu-id="4b117-122">Для арабского положения курсоров интерполируются с кластерами.</span><span class="sxs-lookup"><span data-stu-id="4b117-122">For Arabic, caret positions are interpolated with clusters.</span></span>
-   <span data-ttu-id="4b117-123">Для иврита, в версиях до Usp10.dll версии 1,420, позиции курсора интерполируются с кластерами.</span><span class="sxs-lookup"><span data-stu-id="4b117-123">For Hebrew, in versions prior to Usp10.dll, version 1.420, caret positions are interpolated with clusters.</span></span> <span data-ttu-id="4b117-124">Начиная с Usp10.dll версии 1,420, позиции курсора привязываются к границам кластера.</span><span class="sxs-lookup"><span data-stu-id="4b117-124">Beginning with Usp10.dll, version 1.420, caret positions are snapped to cluster boundaries.</span></span>

<span data-ttu-id="4b117-125">И [**скрипткстокп**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) , и [**скрипткптокс**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox) работают только в пределах выполнения.</span><span class="sxs-lookup"><span data-stu-id="4b117-125">Both [**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) and [**ScriptCPtoX**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox) operate only within runs.</span></span> <span data-ttu-id="4b117-126">Функция требует, чтобы определенные параметры были получены из предыдущих вызовов Uniscribe, как показано в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="4b117-126">The functions require that certain parameters come from earlier Uniscribe calls, as shown in the following table.</span></span>



| <span data-ttu-id="4b117-127">Параметр</span><span class="sxs-lookup"><span data-stu-id="4b117-127">Parameter</span></span>                                        | <span data-ttu-id="4b117-128">Источник</span><span class="sxs-lookup"><span data-stu-id="4b117-128">Source</span></span>                                                 |
|--------------------------------------------------|--------------------------------------------------------|
| <span data-ttu-id="4b117-129">*СРП*</span><span class="sxs-lookup"><span data-stu-id="4b117-129">*psa*</span></span>                                            | <span data-ttu-id="4b117-130">Возвращается методом [**скриптитемизе**](/windows/desktop/api/Usp10/nf-usp10-scriptitemize).</span><span class="sxs-lookup"><span data-stu-id="4b117-130">As returned by [**ScriptItemize**](/windows/desktop/api/Usp10/nf-usp10-scriptitemize).</span></span> |
| <span data-ttu-id="4b117-131">*кглифспвлогклуст*</span><span class="sxs-lookup"><span data-stu-id="4b117-131">*cGlyphspwLogClust*</span></span><br/> <span data-ttu-id="4b117-132">*псва*</span><span class="sxs-lookup"><span data-stu-id="4b117-132">*psva*</span></span><br/> | <span data-ttu-id="4b117-133">Возвращается методом [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape).</span><span class="sxs-lookup"><span data-stu-id="4b117-133">As returned by [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape).</span></span>     |
| <span data-ttu-id="4b117-134">*пиадванце*</span><span class="sxs-lookup"><span data-stu-id="4b117-134">*piAdvance*</span></span>                                      | <span data-ttu-id="4b117-135">Возвращается методом [**скриптплаце**](/windows/desktop/api/Usp10/nf-usp10-scriptplace).</span><span class="sxs-lookup"><span data-stu-id="4b117-135">As returned by [**ScriptPlace**](/windows/desktop/api/Usp10/nf-usp10-scriptplace).</span></span>     |



 

<span data-ttu-id="4b117-136">Приложение должно установить запуск, в котором заданное смещение курсора или позиция по оси x, перед передачей информации в [**скрипткптокс**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox) или [**скрипткстокп**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp).</span><span class="sxs-lookup"><span data-stu-id="4b117-136">The application must establish the run in which a given caret offset or x position is before passing the information to [**ScriptCPtoX**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox) or [**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp).</span></span> <span data-ttu-id="4b117-137">Если приложение не сохраняет сведения о ширине, оно может выполнить проверку попадания и положение курсора после отображения каждого запуска.</span><span class="sxs-lookup"><span data-stu-id="4b117-137">If the application does not save the width information, it can do hit testing and caret placement after displaying each run.</span></span> <span data-ttu-id="4b117-138">В качестве альтернативы приложение может кэшировать достаточно информации для проверки попадания и размещения курсора в текущей строке без необходимости повторной обработки абзаца.</span><span class="sxs-lookup"><span data-stu-id="4b117-138">As an alternative, the application can cache enough information to do hit testing and caret placement on the current line without requiring reprocessing of the paragraph.</span></span>

<span data-ttu-id="4b117-139">[**Скрипткстокп**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) Возвращает конечное значение ребра, чтобы приложение знало сторону символа или кластера, в котором пользователь щелкнул.</span><span class="sxs-lookup"><span data-stu-id="4b117-139">[**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) returns a trailing edge value so that the application knows the side of the character or cluster on which the user has clicked.</span></span> <span data-ttu-id="4b117-140">Значение равно 0 или ширине символа или кластера в кодовых позициях.</span><span class="sxs-lookup"><span data-stu-id="4b117-140">The value is either 0 or the width of the character or cluster in code points.</span></span> <span data-ttu-id="4b117-141">Возвращаемая позиции символа является позицией символа, на который щелкнул пользователь.</span><span class="sxs-lookup"><span data-stu-id="4b117-141">The returned character position is the position of the character on which the user clicked.</span></span> <span data-ttu-id="4b117-142">Дополнительные сведения см. [в разделе отображение курсора в двунаправленных строках](displaying-the-caret-in-bidirectional-strings.md).</span><span class="sxs-lookup"><span data-stu-id="4b117-142">For more information, see [Displaying the Caret in Bidirectional Strings](displaying-the-caret-in-bidirectional-strings.md).</span></span>

<span data-ttu-id="4b117-143">Для таких языков, как тайский, для которых пользователь не должен располагать курсором в кластере, [**скрипткстокп**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) устанавливает для конечного флага значение 0 или ширину кластера.</span><span class="sxs-lookup"><span data-stu-id="4b117-143">For languages such as Thai, for which the user conventionally does not want to place the caret into a cluster, [**ScriptXtoCP**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) sets the trailing side flag to 0 or to the cluster width.</span></span> <span data-ttu-id="4b117-144">Для таких языков, как арабский, для которых пользователь должен иметь возможность редактирования в кластере, **скрипткстокп** устанавливает для конечного флага значение 0 или значение 1.</span><span class="sxs-lookup"><span data-stu-id="4b117-144">For languages such as Arabic, for which the user expects to be able to edit within a cluster, **ScriptXtoCP** sets the trailing side flag to 0 or to 1.</span></span>

<span data-ttu-id="4b117-145">Чтобы помочь приложению установить допустимые расположения курсора при обработке клавиш со стрелками, Uniscribe предоставляет сведения о допустимых позициях курсора в элементе **фчарстоп** в логических атрибутах, возвращенных [**скриптбреак**](/windows/desktop/api/Usp10/nf-usp10-scriptbreak).</span><span class="sxs-lookup"><span data-stu-id="4b117-145">To help the application establish valid locations for the caret when handling the arrow keys, Uniscribe provides information on valid caret positions in the **fCharStop** member in the logical attributes returned by [**ScriptBreak**](/windows/desktop/api/Usp10/nf-usp10-scriptbreak).</span></span> <span data-ttu-id="4b117-146">**Значение true** возвращается для большинства символов и **false** для символов между кластерами в таких скриптах, как тайский.</span><span class="sxs-lookup"><span data-stu-id="4b117-146">**TRUE** is returned for most characters and **FALSE** for intercluster characters in scripts such as Thai.</span></span> <span data-ttu-id="4b117-147">Приложение должно проверить значение **фнидскаретинфо** в структуре [**\_ свойств скрипта**](/windows/desktop/api/Usp10/ns-usp10-script_properties) для элемента, чтобы узнать, нужно ли вызывать **скриптбреак** для проверки допустимости позиций курсора.</span><span class="sxs-lookup"><span data-stu-id="4b117-147">The application should check the **fNeedsCaretInfo** value in the [**SCRIPT\_PROPERTIES**](/windows/desktop/api/Usp10/ns-usp10-script_properties) structure for an item to see if it is necessary to call **ScriptBreak** to check for valid caret positions.</span></span> <span data-ttu-id="4b117-148">Если значение **фнидскаретинфо** равно **false**, то все кодовые точки являются допустимыми позициями курсора.</span><span class="sxs-lookup"><span data-stu-id="4b117-148">If the **fNeedsCaretInfo** value is **FALSE**, all code points are valid caret positions.</span></span>

## <a name="related-topics"></a><span data-ttu-id="4b117-149">См. также</span><span class="sxs-lookup"><span data-stu-id="4b117-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4b117-150">Использование Uniscribe</span><span class="sxs-lookup"><span data-stu-id="4b117-150">Using Uniscribe</span></span>](using-uniscribe.md)
</dt> </dl>

 

 




