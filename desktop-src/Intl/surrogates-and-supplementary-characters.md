---
description: Суррогаты и дополнительные символы
ms.assetid: 0dea39e2-a2b4-47fc-b44a-56af8ba1e346
title: Суррогаты и дополнительные символы
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c8d6b738955c8b8de4f6cb0ae43c78f86752a928
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105650526"
---
# <a name="surrogates-and-supplementary-characters"></a><span data-ttu-id="ca772-103">Суррогаты и дополнительные символы</span><span class="sxs-lookup"><span data-stu-id="ca772-103">Surrogates and Supplementary Characters</span></span>

<span data-ttu-id="ca772-104">Приложения Windows обычно используют UTF-16 для представления символьных данных в [Юникоде](unicode.md) .</span><span class="sxs-lookup"><span data-stu-id="ca772-104">Windows applications normally use UTF-16 to represent [Unicode](unicode.md) character data.</span></span> <span data-ttu-id="ca772-105">Использование 16 бит позволяет непосредственно представить 65 536 уникальных символов, но эта базовая многоязыковая плоскость (BMP) не настолько близка, чтобы охватить все символы, используемые в языках человека.</span><span class="sxs-lookup"><span data-stu-id="ca772-105">The use of 16 bits allows direct representation of 65,536 unique characters, but this Basic Multilingual Plane (BMP) is not nearly enough to cover all the symbols used in human languages.</span></span> <span data-ttu-id="ca772-106">Юникод версии 4,1 включает свыше 97 000 символов, а более 70 000 символов только для китайского языка.</span><span class="sxs-lookup"><span data-stu-id="ca772-106">Unicode version 4.1 includes over 97,000 characters, with over 70,000 characters for Chinese alone.</span></span>

<span data-ttu-id="ca772-107">Стандарт Unicode установил 16 дополнительных "плоскостей" символов, каждый из которых имеет тот же размер, что и BMP.</span><span class="sxs-lookup"><span data-stu-id="ca772-107">The Unicode standard has established 16 additional "planes" of characters, each the same size as the BMP.</span></span> <span data-ttu-id="ca772-108">Естественно, большинство кодовых точек, которые выходят за рамки BMP, еще не имеют назначенных символов, но определение плоскостей дает Юникоду возможность определить 1 114 112 символов (то есть 2 ¹ ⁶ \* 17 символов) в диапазоне кодовых точек u + 0000 до U + 10FFFF.</span><span class="sxs-lookup"><span data-stu-id="ca772-108">Naturally, most code points beyond the BMP do not yet have characters assigned to them, but definition of the planes gives Unicode the potential to define 1,114,112 characters (that is, 2¹⁶ \* 17 characters) within the code point range U+0000 to U+10FFFF.</span></span> <span data-ttu-id="ca772-109">Для UTF-16 представляет этот большой набор символов, стандарт Unicode определяет "добавочные символы".</span><span class="sxs-lookup"><span data-stu-id="ca772-109">For UTF-16 to represent this larger set of characters, the Unicode Standard defines "supplementary characters".</span></span>

## <a name="about-supplementary-characters"></a><span data-ttu-id="ca772-110">О дополнительных символах</span><span class="sxs-lookup"><span data-stu-id="ca772-110">About Supplementary Characters</span></span>

<span data-ttu-id="ca772-111">Дополнительный символ — это символ, расположенный за пределами BMP, а "суррогат" — это значение кода UTF-16.</span><span class="sxs-lookup"><span data-stu-id="ca772-111">A supplementary character is a character located beyond the BMP, and a "surrogate" is a UTF-16 code value.</span></span> <span data-ttu-id="ca772-112">Для UTF-16 требуется "суррогатная пара" для представления одного дополнительного символа.</span><span class="sxs-lookup"><span data-stu-id="ca772-112">For UTF-16, a "surrogate pair" is required to represent a single supplementary character.</span></span> <span data-ttu-id="ca772-113">Первый (высокий) суррогат — это 16-разрядное значение кода в диапазоне от U + D800 до U + DBFF.</span><span class="sxs-lookup"><span data-stu-id="ca772-113">The first (high) surrogate is a 16-bit code value in the range U+D800 to U+DBFF.</span></span> <span data-ttu-id="ca772-114">Второй (низкий) суррогат — это 16-разрядное значение кода в диапазоне от U + DC00 до U + DFFF.</span><span class="sxs-lookup"><span data-stu-id="ca772-114">The second (low) surrogate is a 16-bit code value in the range U+DC00 to U+DFFF.</span></span> <span data-ttu-id="ca772-115">С помощью суррогатного механизма UTF-16 может поддерживать все 1 114 112 возможных символов Юникода.</span><span class="sxs-lookup"><span data-stu-id="ca772-115">Using the surrogate mechanism, UTF-16 can support all 1,114,112 potential Unicode characters.</span></span> <span data-ttu-id="ca772-116">Дополнительные сведения о дополнительных символах, суррогатах и суррогатных парах см. в [стандарте Юникода](https://www.unicode.org/standard/standard.html).</span><span class="sxs-lookup"><span data-stu-id="ca772-116">For more details about supplementary characters, surrogates, and surrogate pairs, refer to [The Unicode Standard](https://www.unicode.org/standard/standard.html).</span></span>

> [!Note]  
> <span data-ttu-id="ca772-117">В Windows 2000 реализована поддержка базового ввода, вывода и простой сортировки добавочных символов.</span><span class="sxs-lookup"><span data-stu-id="ca772-117">Windows 2000 introduces support for basic input, output, and simple sorting of supplementary characters.</span></span> <span data-ttu-id="ca772-118">Однако не все компоненты системы совместимы с дополнительными символами.</span><span class="sxs-lookup"><span data-stu-id="ca772-118">However, not all system components are compatible with supplementary characters.</span></span>

 

<span data-ttu-id="ca772-119">Операционная система поддерживает дополнительные символы следующими способами.</span><span class="sxs-lookup"><span data-stu-id="ca772-119">The operating system supports supplementary characters in the following ways:</span></span>

-   <span data-ttu-id="ca772-120">В формате 12 таблицы OpenType Font кмап напрямую поддерживается 4-байтовый код символа.</span><span class="sxs-lookup"><span data-stu-id="ca772-120">Format 12 of the OpenType font cmap table directly supports the 4-byte character code.</span></span> <span data-ttu-id="ca772-121">Дополнительные сведения см. в [спецификации шрифтов OpenType](/typography/opentype/spec/).</span><span class="sxs-lookup"><span data-stu-id="ca772-121">For more information, see the [OpenType font specification](/typography/opentype/spec/).</span></span>
-   <span data-ttu-id="ca772-122">В Windows поддерживаются [редакторы методов ввода](../dxtecharts/installing-and-using-input-method-editors.md), поддерживающие суррогаты (IME).</span><span class="sxs-lookup"><span data-stu-id="ca772-122">Windows supports surrogate-enabled [input method editors (IMEs)](../dxtecharts/installing-and-using-input-method-editors.md).</span></span>
-   <span data-ttu-id="ca772-123">API [Windows GDI](../gdi/windows-gdi.md) поддерживает формат 12 кмап таблиц в шрифтах, чтобы суррогаты могли отображаться правильно.</span><span class="sxs-lookup"><span data-stu-id="ca772-123">The [Windows GDI](../gdi/windows-gdi.md) API supports format 12 cmap tables in fonts so that surrogates can be displayed correctly.</span></span>
-   <span data-ttu-id="ca772-124">API [Uniscribe](uniscribe.md) поддерживает дополнительные символы.</span><span class="sxs-lookup"><span data-stu-id="ca772-124">The [Uniscribe](uniscribe.md) API supports supplementary characters.</span></span>
-   <span data-ttu-id="ca772-125">[Элементы управления Windows](../controls/window-controls.md), включая [правку](../controls/edit-controls.md) и [Форматирование](../controls/rich-edit-controls.md), поддерживают дополнительные символы.</span><span class="sxs-lookup"><span data-stu-id="ca772-125">[Windows controls](../controls/window-controls.md), including [Edit](../controls/edit-controls.md) and [Rich Edit](../controls/rich-edit-controls.md), support supplementary characters.</span></span>
-   <span data-ttu-id="ca772-126">Обработчик HTML поддерживает HTML-страницы, включающие дополнительные символы для вывода, редактирования (через Outlook Express) и отправки форм.</span><span class="sxs-lookup"><span data-stu-id="ca772-126">The HTML engine supports HTML pages that include supplementary characters for display, editing (through Outlook Express), and forms submission.</span></span>
-   <span data-ttu-id="ca772-127">Таблица сортировки операционной системы поддерживает дополнительные символы.</span><span class="sxs-lookup"><span data-stu-id="ca772-127">The operating system sorting table supports supplementary characters.</span></span>

## <a name="general-guidelines-for-software-development-using-supplementary-characters"></a><span data-ttu-id="ca772-128">Общие рекомендации по разработке программного обеспечения с использованием добавочных символов</span><span class="sxs-lookup"><span data-stu-id="ca772-128">General Guidelines for Software Development Using Supplementary Characters</span></span>

<span data-ttu-id="ca772-129">UTF-16 обрабатывает дополнительные символы как суррогатные пары.</span><span class="sxs-lookup"><span data-stu-id="ca772-129">UTF-16 handles supplementary characters as surrogate pairs.</span></span> <span data-ttu-id="ca772-130">Операционная система обрабатывает суррогатную пару аналогично тому, как она обрабатывает [несамостоятельные знаки](using-nonspacing-characters-and-diacritics.md).</span><span class="sxs-lookup"><span data-stu-id="ca772-130">The operating system processes a surrogate pair similarly to the way it processes [nonspacing marks](using-nonspacing-characters-and-diacritics.md).</span></span> <span data-ttu-id="ca772-131">Во время отображения суррогатная пара отображается как один глиф с помощью Uniscribe, как было предписано стандартом Unicode.</span><span class="sxs-lookup"><span data-stu-id="ca772-131">At display time, the surrogate pair displays as one glyph by means of Uniscribe, as prescribed by the Unicode Standard.</span></span>

<span data-ttu-id="ca772-132">В Windows Vista появились три новых макроса, помогающие определить суррогаты и суррогатные пары в строках UTF-16.</span><span class="sxs-lookup"><span data-stu-id="ca772-132">Windows Vista introduces three new macros to help identify surrogates and surrogate pairs in UTF-16 strings.</span></span> <span data-ttu-id="ca772-133">Это [**\_ старший \_ суррогат**](/windows/win32/api/Winnls/nf-winnls-is_high_surrogate), [**\_ младший \_ символ-заместитель**](/windows/win32/api/Winnls/nf-winnls-is_low_surrogate)и [**является \_ суррогатной \_ парой**](/windows/win32/api/Winnls/nf-winnls-is_surrogate_pair).</span><span class="sxs-lookup"><span data-stu-id="ca772-133">These are [**IS\_HIGH\_SURROGATE**](/windows/win32/api/Winnls/nf-winnls-is_high_surrogate), [**IS\_LOW\_SURROGATE**](/windows/win32/api/Winnls/nf-winnls-is_low_surrogate), and [**IS\_SURROGATE\_PAIR**](/windows/win32/api/Winnls/nf-winnls-is_surrogate_pair).</span></span>

<span data-ttu-id="ca772-134">Приложения автоматически поддерживают дополнительные символы, если они поддерживают Юникод и используют системные элементы управления и стандартные функции API, такие как [**ExtTextOut**](/windows/win32/api/wingdi/nf-wingdi-exttextouta) и [**DrawText**](/windows/win32/api/winuser/nf-winuser-drawtext).</span><span class="sxs-lookup"><span data-stu-id="ca772-134">Applications automatically support supplementary characters if they support Unicode and use system controls and standard API functions, such as [**ExtTextOut**](/windows/win32/api/wingdi/nf-wingdi-exttextouta) and [**DrawText**](/windows/win32/api/winuser/nf-winuser-drawtext).</span></span> <span data-ttu-id="ca772-135">Таким же, если приложение использует стандартные системные элементы управления или использует общие вызовы [**ExtTextOut**](/windows/win32/api/wingdi/nf-wingdi-exttextouta)для вывода, добавочные символы должны работать без специального программирования.</span><span class="sxs-lookup"><span data-stu-id="ca772-135">Thus, if your application uses standard system controls or uses general [**ExtTextOut**](/windows/win32/api/wingdi/nf-wingdi-exttextouta)-type calls to display, supplementary characters should work without any special coding.</span></span>

<span data-ttu-id="ca772-136">Приложения, которые реализуют свои собственные возможности редактирования, могут использовать Uniscribe для обработки текста.</span><span class="sxs-lookup"><span data-stu-id="ca772-136">Applications that implement their own editing support by working out glyph positions in a customized way can use Uniscribe for all text processing.</span></span> <span data-ttu-id="ca772-137">Uniscribe имеет отдельные функции для обработки сложных наборов символов, таких как отображение текста, проверка попадания и перемещение курсора.</span><span class="sxs-lookup"><span data-stu-id="ca772-137">Uniscribe has separate functions to deal with complex script processing, such as text display, hit testing, and cursor movement.</span></span> <span data-ttu-id="ca772-138">Приложение должно вызывать функции Uniscribe специально для получения этих дополнительных функций.</span><span class="sxs-lookup"><span data-stu-id="ca772-138">An application must call the Uniscribe functions specifically to get these advanced features.</span></span> <span data-ttu-id="ca772-139">Обратите внимание, что приложения, использующие функции Uniscribe, полностью многоязычны, но это накладывает снижение производительности.</span><span class="sxs-lookup"><span data-stu-id="ca772-139">Note that applications using the Uniscribe functions are fully multilingual, but this imposes a performance penalty.</span></span> <span data-ttu-id="ca772-140">Поэтому некоторые приложения должны выполнять собственную обработку добавочных символов.</span><span class="sxs-lookup"><span data-stu-id="ca772-140">Thus some applications should do their own processing of supplementary characters.</span></span>

<span data-ttu-id="ca772-141">Так как суррогатный механизм для представления дополнительных символов определен правильно, приложение может включать код для обработки суррогатной обработки текста в кодировке UTF-16.</span><span class="sxs-lookup"><span data-stu-id="ca772-141">Because the surrogate mechanism to represent supplementary characters is well-defined, your application can include code to handle UTF-16 surrogate text processing.</span></span> <span data-ttu-id="ca772-142">Когда приложение встречает разделенное значение UTF-16 из нижнего зарезервированного диапазона суррогатов (младший суррогат) или верхнего зарезервированного диапазона суррогатов (старший суррогат), значение должно быть равно одной половине суррогатной пары.</span><span class="sxs-lookup"><span data-stu-id="ca772-142">When the application encounters a separated UTF-16 value from either the lower reserved surrogate range (a low surrogate) or the upper reserved surrogate range (a high surrogate), the value must be one half of a surrogate pair.</span></span> <span data-ttu-id="ca772-143">Таким образом, приложение может обнаружить суррогатную пару, выполнив простую проверку диапазона.</span><span class="sxs-lookup"><span data-stu-id="ca772-143">Thus, the application can detect a surrogate pair by doing simple range checking.</span></span> <span data-ttu-id="ca772-144">Если он обнаруживает значение UTF-16 в нижнем или верхнем диапазоне, оно должно отформатировать обратную или переправку 1 16-разрядной ширины, чтобы получить остальную часть символа.</span><span class="sxs-lookup"><span data-stu-id="ca772-144">If it encounters a UTF-16 value in the lower or upper range, it must track backward or forward one 16-bit width to get the rest of the character.</span></span> <span data-ttu-id="ca772-145">При написании приложения помните, что [**чарнекст**](/windows/win32/api/winuser/nf-winuser-charnexta) и [**чарпрев**](/windows/win32/api/winuser/nf-winuser-charpreva) перемещаются по 16-разрядным кодовым позициям, а не по суррогатным парам.</span><span class="sxs-lookup"><span data-stu-id="ca772-145">When writing your application, keep in mind that [**CharNext**](/windows/win32/api/winuser/nf-winuser-charnexta) and [**CharPrev**](/windows/win32/api/winuser/nf-winuser-charpreva) move by 16-bit code points, not by surrogate pairs.</span></span>

> [!Note]  
> <span data-ttu-id="ca772-146">Отдельные суррогатные точки кода имеют либо старший суррогат без смежного младшего суррогата, либо наоборот.</span><span class="sxs-lookup"><span data-stu-id="ca772-146">Standalone surrogate code points have either a high surrogate without an adjacent low surrogate, or vice versa.</span></span> <span data-ttu-id="ca772-147">Эти кодовые точки являются недопустимыми и не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="ca772-147">These code points are invalid and are not supported.</span></span> <span data-ttu-id="ca772-148">Их поведение не определено.</span><span class="sxs-lookup"><span data-stu-id="ca772-148">Their behavior is undefined.</span></span>

 

<span data-ttu-id="ca772-149">Если вы разрабатываете шрифт или поставщик IME, обратите внимание, что в операционных системах, предшествующих Windows XP, по умолчанию отключена поддержка дополнительных символов.</span><span class="sxs-lookup"><span data-stu-id="ca772-149">If you are developing a font or IME provider, note that pre-Windows XP operating systems disable supplementary character support by default.</span></span> <span data-ttu-id="ca772-150">В Windows XP и более поздних версиях по умолчанию включены дополнительные символы.</span><span class="sxs-lookup"><span data-stu-id="ca772-150">Windows XP and later enable supplementary characters by default.</span></span> <span data-ttu-id="ca772-151">Если вы предоставляете шрифт и пакет IME, требующие добавочных символов, приложение должно задать следующие значения реестра:</span><span class="sxs-lookup"><span data-stu-id="ca772-151">If you provide a font and IME package that requires supplementary characters, your application must set the following registry values:</span></span>


```C++
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\LanguagePack]
SURROGATE=(REG_DWORD)0x00000002

[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\International\Scripts\42]
IEFixedFontName=[Surrogate Font Face Name]
IEPropFontName=[Surrogate Font Face Name]
```



## <a name="related-topics"></a><span data-ttu-id="ca772-152">См. также</span><span class="sxs-lookup"><span data-stu-id="ca772-152">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ca772-153">Кодировки</span><span class="sxs-lookup"><span data-stu-id="ca772-153">Character Sets</span></span>](character-sets.md)
</dt> </dl>

 

 
