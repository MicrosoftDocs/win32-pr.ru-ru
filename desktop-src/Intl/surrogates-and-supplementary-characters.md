---
description: Суррогаты и дополнительные символы
ms.assetid: 0dea39e2-a2b4-47fc-b44a-56af8ba1e346
title: Суррогаты и дополнительные символы
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a5b1dc4743627297962c7279449c06cc1ff967ac35f931a6e945b4577c937b59
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120130054"
---
# <a name="surrogates-and-supplementary-characters"></a>Суррогаты и дополнительные символы

Windows приложения обычно используют UTF-16 для представления символьных данных в [юникоде](unicode.md) . Использование 16 бит позволяет непосредственно представить 65 536 уникальных символов, но эта базовая многоязыковая плоскость (BMP) не настолько близка, чтобы охватить все символы, используемые в языках человека. Юникод версии 4,1 включает свыше 97 000 символов, а более 70 000 символов только для китайского языка.

Стандарт Unicode установил 16 дополнительных "плоскостей" символов, каждый из которых имеет тот же размер, что и BMP. Естественно, большинство кодовых точек, которые выходят за рамки BMP, еще не имеют назначенных символов, но определение плоскостей дает Юникоду возможность определить 1 114 112 символов (то есть 2 ¹ ⁶ \* 17 символов) в диапазоне кодовых точек u + 0000 до U + 10FFFF. Для UTF-16 представляет этот большой набор символов, стандарт Unicode определяет "добавочные символы".

## <a name="about-supplementary-characters"></a>О дополнительных символах

Дополнительный символ — это символ, расположенный за пределами BMP, а "суррогат" — это значение кода UTF-16. Для UTF-16 требуется "суррогатная пара" для представления одного дополнительного символа. Первый (высокий) суррогат — это 16-разрядное значение кода в диапазоне от U + D800 до U + DBFF. Второй (низкий) суррогат — это 16-разрядное значение кода в диапазоне от U + DC00 до U + DFFF. С помощью суррогатного механизма UTF-16 может поддерживать все 1 114 112 возможных символов Юникода. Дополнительные сведения о дополнительных символах, суррогатах и суррогатных парах см. в [стандарте Юникода](https://www.unicode.org/standard/standard.html).

> [!Note]  
> в Windows 2000 введена поддержка базового ввода, вывода и простой сортировки добавочных символов. Однако не все компоненты системы совместимы с дополнительными символами.

 

Операционная система поддерживает дополнительные символы следующими способами.

-   В формате 12 таблицы OpenType Font кмап напрямую поддерживается 4-байтовый код символа. Дополнительные сведения см. в [спецификации шрифтов OpenType](/typography/opentype/spec/).
-   Windows поддерживает [редакторы методов ввода](../dxtecharts/installing-and-using-input-method-editors.md)с поддержкой суррогатов (ime).
-   API [Windows GDI](../gdi/windows-gdi.md) поддерживает формат 12 кмап таблиц в шрифтах, чтобы суррогаты могли отображаться правильно.
-   API [Uniscribe](uniscribe.md) поддерживает дополнительные символы.
-   [элементы управления Windows](../controls/window-controls.md), включая [edit](../controls/edit-controls.md) и [Rich edit](../controls/rich-edit-controls.md), поддерживают дополнительные символы.
-   обработчик html поддерживает html-страницы, содержащие дополнительные символы для вывода, редактирования (с помощью Outlook Express) и отправки форм.
-   Таблица сортировки операционной системы поддерживает дополнительные символы.

## <a name="general-guidelines-for-software-development-using-supplementary-characters"></a>Общие рекомендации по разработке программного обеспечения с использованием добавочных символов

UTF-16 обрабатывает дополнительные символы как суррогатные пары. Операционная система обрабатывает суррогатную пару аналогично тому, как она обрабатывает [несамостоятельные знаки](using-nonspacing-characters-and-diacritics.md). Во время отображения суррогатная пара отображается как один глиф с помощью Uniscribe, как было предписано стандартом Unicode.

Windows В Vista появились три новых макроса, помогающие определить суррогаты и суррогатные пары в строках UTF-16. Это [**\_ старший \_ суррогат**](/windows/win32/api/Winnls/nf-winnls-is_high_surrogate), [**\_ младший \_ символ-заместитель**](/windows/win32/api/Winnls/nf-winnls-is_low_surrogate)и [**является \_ суррогатной \_ парой**](/windows/win32/api/Winnls/nf-winnls-is_surrogate_pair).

Приложения автоматически поддерживают дополнительные символы, если они поддерживают Юникод и используют системные элементы управления и стандартные функции API, такие как [**ExtTextOut**](/windows/win32/api/wingdi/nf-wingdi-exttextouta) и [**DrawText**](/windows/win32/api/winuser/nf-winuser-drawtext). Таким же, если приложение использует стандартные системные элементы управления или использует общие вызовы [**ExtTextOut**](/windows/win32/api/wingdi/nf-wingdi-exttextouta)для вывода, добавочные символы должны работать без специального программирования.

Приложения, которые реализуют свои собственные возможности редактирования, могут использовать Uniscribe для обработки текста. Uniscribe имеет отдельные функции для обработки сложных наборов символов, таких как отображение текста, проверка попадания и перемещение курсора. Приложение должно вызывать функции Uniscribe специально для получения этих дополнительных функций. Обратите внимание, что приложения, использующие функции Uniscribe, полностью многоязычны, но это накладывает снижение производительности. Поэтому некоторые приложения должны выполнять собственную обработку добавочных символов.

Так как суррогатный механизм для представления дополнительных символов определен правильно, приложение может включать код для обработки суррогатной обработки текста в кодировке UTF-16. Когда приложение встречает разделенное значение UTF-16 из нижнего зарезервированного диапазона суррогатов (младший суррогат) или верхнего зарезервированного диапазона суррогатов (старший суррогат), значение должно быть равно одной половине суррогатной пары. Таким образом, приложение может обнаружить суррогатную пару, выполнив простую проверку диапазона. Если он обнаруживает значение UTF-16 в нижнем или верхнем диапазоне, оно должно отформатировать обратную или переправку 1 16-разрядной ширины, чтобы получить остальную часть символа. При написании приложения помните, что [**чарнекст**](/windows/win32/api/winuser/nf-winuser-charnexta) и [**чарпрев**](/windows/win32/api/winuser/nf-winuser-charpreva) перемещаются по 16-разрядным кодовым позициям, а не по суррогатным парам.

> [!Note]  
> Отдельные суррогатные точки кода имеют либо старший суррогат без смежного младшего суррогата, либо наоборот. Эти кодовые точки являются недопустимыми и не поддерживаются. Их поведение не определено.

 

если вы разрабатываете шрифт или поставщик IME, обратите внимание, что в операционных системах, предшествующих Windows XP, по умолчанию отключена поддержка дополнительных символов. Windows XP и более поздних версий по умолчанию включают дополнительные символы. Если вы предоставляете шрифт и пакет IME, требующие добавочных символов, приложение должно задать следующие значения реестра:


```C++
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\LanguagePack]
SURROGATE=(REG_DWORD)0x00000002

[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\International\Scripts\42]
IEFixedFontName=[Surrogate Font Face Name]
IEPropFontName=[Surrogate Font Face Name]
```



## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Кодировки](character-sets.md)
</dt> </dl>

 

 
