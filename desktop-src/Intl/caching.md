---
description: Uniscribe сохраняет сопоставления Юникода с глифом (кмап), ширину глифов и таблицы формирования скриптов OpenType.
ms.assetid: c06c0eaf-41cb-4fd1-9750-a78355217f12
title: Кэширование (Международная локализация)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3cf8bf7dd10fe414bc170086ff9b8c34142dc197
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105684682"
---
# <a name="caching-internationalization"></a><span data-ttu-id="8e8c8-103">Кэширование (Международная локализация)</span><span class="sxs-lookup"><span data-stu-id="8e8c8-103">Caching (Internationalization)</span></span>

<span data-ttu-id="8e8c8-104">Uniscribe сохраняет сопоставления Юникода с глифом (кмап), ширину глифов и таблицы формирования скриптов OpenType.</span><span class="sxs-lookup"><span data-stu-id="8e8c8-104">Uniscribe saves Unicode-to-glyph (cmap) mappings, glyph widths, and OpenType script shaping tables.</span></span> <span data-ttu-id="8e8c8-105">Дескриптор таблиц для конкретного шрифта определенного размера называется "кэшем скриптов".</span><span class="sxs-lookup"><span data-stu-id="8e8c8-105">A handle to the tables for a particular font of a particular size is called a "script cache".</span></span> <span data-ttu-id="8e8c8-106">Многие функции Uniscribe вызывают как параметр дескриптора контекста устройства, так и указатель на структуру [**\_ кэша скрипта**](script-cache.md) .</span><span class="sxs-lookup"><span data-stu-id="8e8c8-106">Many Uniscribe functions call for both a device context handle parameter and a pointer to a [**SCRIPT\_CACHE**](script-cache.md) structure.</span></span> <span data-ttu-id="8e8c8-107">Эти функции сначала ищут сведения в кэше скрипта, используя контекст устройства, только если требуемые таблицы еще не кэшированы.</span><span class="sxs-lookup"><span data-stu-id="8e8c8-107">These functions look first for information through the script cache, using the device context only when required tables are not already cached.</span></span> <span data-ttu-id="8e8c8-108">При вызове функции [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape), [**скриптплаце**](/windows/desktop/api/Usp10/nf-usp10-scriptplace)или [**скрипттекстаут**](/windows/desktop/api/Usp10/nf-usp10-scripttextout) приложение должно передать указатель на структуру **\_ кэша скрипта** .</span><span class="sxs-lookup"><span data-stu-id="8e8c8-108">When calling the [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape), [**ScriptPlace**](/windows/desktop/api/Usp10/nf-usp10-scriptplace), or [**ScriptTextOut**](/windows/desktop/api/Usp10/nf-usp10-scripttextout) function, the application must pass a pointer to a **SCRIPT\_CACHE** structure.</span></span> <span data-ttu-id="8e8c8-109">Перед первым возвратом приложения в функцию Uniscribe этот обработчик должен инициализироваться со **значением NULL** .</span><span class="sxs-lookup"><span data-stu-id="8e8c8-109">The handle should be initialized to **NULL** before the first time the application passes it to a Uniscribe function.</span></span> <span data-ttu-id="8e8c8-110">Приложение никогда не должно передавать один и тот же маркер для различных шрифтов или различных размеров.</span><span class="sxs-lookup"><span data-stu-id="8e8c8-110">The application should never pass the same handle for different fonts or different sizes.</span></span>

<span data-ttu-id="8e8c8-111">Приложение может освободить кэш скриптов в любое время.</span><span class="sxs-lookup"><span data-stu-id="8e8c8-111">An application can free a script cache at any time.</span></span> <span data-ttu-id="8e8c8-112">Uniscribe поддерживает подсчет ссылок в своих шрифтах и кэшах форм, освобождает данные только при освобождении всех размеров шрифта и освобождает данные, только если освобождаются все шрифты, поддерживаемые фигурой.</span><span class="sxs-lookup"><span data-stu-id="8e8c8-112">Uniscribe maintains reference counts in its font and shaper caches, frees font data only when all sizes of the font are freed, and frees shaper data only when all fonts that the shaper supports are freed.</span></span> <span data-ttu-id="8e8c8-113">Когда приложение выполняется с использованием стиля, оно должно вызвать функцию [**скриптфрикаче**](/windows/desktop/api/Usp10/nf-usp10-scriptfreecache) , чтобы освободить кэш скриптов для стиля.</span><span class="sxs-lookup"><span data-stu-id="8e8c8-113">When the application is done with a style, it should call the [**ScriptFreeCache**](/windows/desktop/api/Usp10/nf-usp10-scriptfreecache) function to free the script cache for the style.</span></span>

<span data-ttu-id="8e8c8-114">Для [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) и [**скриптплаце**](/windows/desktop/api/Usp10/nf-usp10-scriptplace)допустимо, чтобы приложение передавало контекст неопределенного устройства.</span><span class="sxs-lookup"><span data-stu-id="8e8c8-114">For [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) and [**ScriptPlace**](/windows/desktop/api/Usp10/nf-usp10-scriptplace), it is valid for the application to pass a null device context.</span></span> <span data-ttu-id="8e8c8-115">Чаще всего вызов будет выполнен, так как необходимые таблицы уже кэшированы.</span><span class="sxs-lookup"><span data-stu-id="8e8c8-115">Most often the call will succeed, as required tables are already cached.</span></span> <span data-ttu-id="8e8c8-116">Если для формирования или размещения требуется доступ к контексту устройства, **скриптшапе** или **скриптплаце** сразу же возвращает \_ код ошибки E.</span><span class="sxs-lookup"><span data-stu-id="8e8c8-116">If the shaping or placement requires access to a device context, **ScriptShape** or **ScriptPlace** returns immediately with the E\_PENDING error code.</span></span> <span data-ttu-id="8e8c8-117">Затем приложение должно выбрать шрифт в контексте устройства.</span><span class="sxs-lookup"><span data-stu-id="8e8c8-117">Then the application must select the font in the device context.</span></span> <span data-ttu-id="8e8c8-118">Для большинства приложений это способствует повышению производительности за счет предотвращения повторной подготовки обработчика контекста устройства к вызовам [**SelectObject**](/windows/win32/api/wingdi/nf-wingdi-selectobject).</span><span class="sxs-lookup"><span data-stu-id="8e8c8-118">For most applications, this helps performance by avoiding repeated preparation of a device context handle with calls to [**SelectObject**](/windows/win32/api/wingdi/nf-wingdi-selectobject).</span></span>

## <a name="related-topics"></a><span data-ttu-id="8e8c8-119">См. также</span><span class="sxs-lookup"><span data-stu-id="8e8c8-119">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8e8c8-120">Использование Uniscribe</span><span class="sxs-lookup"><span data-stu-id="8e8c8-120">Using Uniscribe</span></span>](using-uniscribe.md)
</dt> </dl>

 

 
