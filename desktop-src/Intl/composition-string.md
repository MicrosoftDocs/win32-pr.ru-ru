---
description: Строка композиции — это текущий текст в окне композиции.
ms.assetid: ab226567-f68d-4fa4-9ead-e9bfabde927e
title: Строка композиции
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5e5cb63163ca9a8076edc4d01053e4baeffc619c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103998635"
---
# <a name="composition-string"></a><span data-ttu-id="3c119-103">Строка композиции</span><span class="sxs-lookup"><span data-stu-id="3c119-103">Composition String</span></span>

<span data-ttu-id="3c119-104">Строка композиции — это текущий текст в окне композиции.</span><span class="sxs-lookup"><span data-stu-id="3c119-104">The composition string is the current text in the composition window.</span></span> <span data-ttu-id="3c119-105">Это текст, который редактор IME преобразует в конечные символы.</span><span class="sxs-lookup"><span data-stu-id="3c119-105">This is the text that the IME converts to final characters.</span></span> <span data-ttu-id="3c119-106">Каждая строка композиции состоит из одного или нескольких "предложений".</span><span class="sxs-lookup"><span data-stu-id="3c119-106">Each composition string consists of one or more "clauses".</span></span> <span data-ttu-id="3c119-107">Предложение — это наименьшее сочетание символов, которое редактор IME может преобразовать в окончательный символ.</span><span class="sxs-lookup"><span data-stu-id="3c119-107">A clause is the smallest combination of characters that the IME can convert to a final character.</span></span> <span data-ttu-id="3c119-108">Чтобы получить и задать строку композиции, приложение вызывает функции [**иммжеткомпоситионстринг**](/windows/desktop/api/Imm/nf-imm-immgetcompositionstringa) и [**иммсеткомпоситионстринг**](/windows/desktop/api/Imm/nf-imm-immsetcompositionstringa) соответственно.</span><span class="sxs-lookup"><span data-stu-id="3c119-108">To get and set the composition string, the application calls the [**ImmGetCompositionString**](/windows/desktop/api/Imm/nf-imm-immgetcompositionstringa) and [**ImmSetCompositionString**](/windows/desktop/api/Imm/nf-imm-immsetcompositionstringa) functions, respectively.</span></span>

<span data-ttu-id="3c119-109">При вводе пользователем текста в окне композиции редактор IME отслеживает состояние строки композиции.</span><span class="sxs-lookup"><span data-stu-id="3c119-109">As the user enters text in the composition window, the IME tracks the status of the composition string.</span></span> <span data-ttu-id="3c119-110">Это состояние включает сведения об атрибутах, сведения о предложении, вводе данных и положении курсора.</span><span class="sxs-lookup"><span data-stu-id="3c119-110">This status includes attribute information, clause information, typing information, and cursor position.</span></span> <span data-ttu-id="3c119-111">Приложение может получить состояние композиции с помощью функции [**иммжеткомпоситионстринг**](/windows/desktop/api/Imm/nf-imm-immgetcompositionstringa) .</span><span class="sxs-lookup"><span data-stu-id="3c119-111">The application can retrieve the composition status by using the [**ImmGetCompositionString**](/windows/desktop/api/Imm/nf-imm-immgetcompositionstringa) function.</span></span>

<span data-ttu-id="3c119-112">Сведения об атрибутах подготавливаются к просмотру в массиве 8-разрядных значений, указывающих состояние символов в строке композиции.</span><span class="sxs-lookup"><span data-stu-id="3c119-112">Attribute information is rendered in an array of 8-bit values that specifies the status of characters in the composition string.</span></span> <span data-ttu-id="3c119-113">Все символы одного предложения должны иметь один и тот же атрибут.</span><span class="sxs-lookup"><span data-stu-id="3c119-113">All characters of one clause must have the same attribute.</span></span> <span data-ttu-id="3c119-114">Массив включает по одному значению для каждого байта в строке, в том числе по одному байту для интереса и ко второму байтам любых двухбайтовых символов в строке.</span><span class="sxs-lookup"><span data-stu-id="3c119-114">The array includes one value for each byte in the string, including one byte each for the lead and second bytes of any double-byte characters in the string.</span></span> <span data-ttu-id="3c119-115">Для каждого значения в массиве биты 0 – 3 могут иметь одно сочетание следующих значений.</span><span class="sxs-lookup"><span data-stu-id="3c119-115">For each value in the array, bits 0 through 3 can be one combination of the following values.</span></span>



| <span data-ttu-id="3c119-116">Значение</span><span class="sxs-lookup"><span data-stu-id="3c119-116">Value</span></span>                      | <span data-ttu-id="3c119-117">Значение</span><span class="sxs-lookup"><span data-stu-id="3c119-117">Meaning</span></span>                                                                                                   |
|----------------------------|-----------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="3c119-118">\_Вход attr</span><span class="sxs-lookup"><span data-stu-id="3c119-118">ATTR\_INPUT</span></span>                | <span data-ttu-id="3c119-119">Символ, вводимых пользователем.</span><span class="sxs-lookup"><span data-stu-id="3c119-119">Character being entered by the user.</span></span> <span data-ttu-id="3c119-120">Редактор IME еще не преобразует этот символ.</span><span class="sxs-lookup"><span data-stu-id="3c119-120">The IME has yet to convert this character.</span></span>                           |
| <span data-ttu-id="3c119-121">\_Ошибка ввода атрибута attr \_</span><span class="sxs-lookup"><span data-stu-id="3c119-121">ATTR\_INPUT\_ERROR</span></span>         | <span data-ttu-id="3c119-122">Символ ошибки, который редактор IME не может преобразовать.</span><span class="sxs-lookup"><span data-stu-id="3c119-122">An error character that the IME cannot convert.</span></span> <span data-ttu-id="3c119-123">Например, редактор IME не может объединить несколько согласных.</span><span class="sxs-lookup"><span data-stu-id="3c119-123">For example, the IME cannot put together some consonants.</span></span> |
| <span data-ttu-id="3c119-124">\_целевой объект attr \_ преобразован</span><span class="sxs-lookup"><span data-stu-id="3c119-124">ATTR\_TARGET\_CONVERTED</span></span>    | <span data-ttu-id="3c119-125">Символ, выбранный пользователем, а затем преобразованный редактором IME.</span><span class="sxs-lookup"><span data-stu-id="3c119-125">Character selected by the user and then converted by the IME.</span></span>                                             |
| <span data-ttu-id="3c119-126">Превышено \_ Преобразование attr</span><span class="sxs-lookup"><span data-stu-id="3c119-126">ATTR\_CONVERTED</span></span>            | <span data-ttu-id="3c119-127">Символ, который уже преобразован редактором IME.</span><span class="sxs-lookup"><span data-stu-id="3c119-127">Character that the IME has already converted.</span></span>                                                             |
| <span data-ttu-id="3c119-128">\_целевой \_ нотконвертед attr</span><span class="sxs-lookup"><span data-stu-id="3c119-128">ATTR\_TARGET\_NOTCONVERTED</span></span> | <span data-ttu-id="3c119-129">Преобразуемый символ.</span><span class="sxs-lookup"><span data-stu-id="3c119-129">Character being converted.</span></span> <span data-ttu-id="3c119-130">Пользователь выбрал этот символ, но редактор IME еще не его преобразовал.</span><span class="sxs-lookup"><span data-stu-id="3c119-130">The user has selected this character but the IME has not yet converted it.</span></span>     |
| <span data-ttu-id="3c119-131">ATTR \_ фикседконвертед</span><span class="sxs-lookup"><span data-stu-id="3c119-131">ATTR\_FIXEDCONVERTED</span></span>       | <span data-ttu-id="3c119-132">Символы, которые редактор IME больше не будет преобразовывать.</span><span class="sxs-lookup"><span data-stu-id="3c119-132">Characters that the IME will no longer convert.</span></span>                                                           |



 

<span data-ttu-id="3c119-133">Все остальные значения зарезервированы.</span><span class="sxs-lookup"><span data-stu-id="3c119-133">All other values are reserved.</span></span> <span data-ttu-id="3c119-134">В японском языке любой непреобразованный символ, имеющий \_ входной атрибут attr, — это символ хирагана, катакана или алфавитно-цифровой знак.</span><span class="sxs-lookup"><span data-stu-id="3c119-134">In Japanese, any unconverted character having the ATTR\_INPUT attribute is a hiragana, katakana, or alphanumeric character.</span></span> <span data-ttu-id="3c119-135">В корейском языке этот атрибут представляет символ хангыль, который еще не преобразован редактором IME.</span><span class="sxs-lookup"><span data-stu-id="3c119-135">In Korean, this attribute represents a Hangul character that the IME has not yet converted.</span></span> <span data-ttu-id="3c119-136">В традиционном китайском и упрощенном китайском языке каждый редактор IME может ограничить свой символ в каком бы то ни было диапазоне.</span><span class="sxs-lookup"><span data-stu-id="3c119-136">In Traditional Chinese and Simplified Chinese, each IME can limit its character within some range.</span></span>

<span data-ttu-id="3c119-137">Сведения о предложении, включенные в состояние строки композиции, — это массив из 32-разрядных значений, указывающий позиции предложений в строке композиции.</span><span class="sxs-lookup"><span data-stu-id="3c119-137">The clause information included in the composition string status is an array of 32-bit values that specifies the positions of the clauses in the composition string.</span></span> <span data-ttu-id="3c119-138">Массив включает по одному значению для каждого предложения и конечное значение, указывающее длину полной строки.</span><span class="sxs-lookup"><span data-stu-id="3c119-138">The array includes one value for each clause and a final value that specifies the length of the full string.</span></span> <span data-ttu-id="3c119-139">Каждое значение в массиве указывает смещение в байтах от начала строки до предложения.</span><span class="sxs-lookup"><span data-stu-id="3c119-139">Each value in the array specifies the offset, in bytes, from the beginning of the string to the clause.</span></span> <span data-ttu-id="3c119-140">Первое значение всегда равно 0, поскольку первое предложение всегда начинается с начала строки.</span><span class="sxs-lookup"><span data-stu-id="3c119-140">The first value is always 0 because the first clause always starts at the beginning of the string.</span></span> <span data-ttu-id="3c119-141">Например, если строка имеет два предложения, сведения о предложении имеют три значения: первое значение равно 0, второе значение — смещение второго предложения, а третье значение — Длина строки.</span><span class="sxs-lookup"><span data-stu-id="3c119-141">For example, if a string has two clauses, the clause information has three values: the first value is 0, the second value is the offset of the second clause, and the third value is the length of the string.</span></span> <span data-ttu-id="3c119-142">Для Юникода позиция предложения учитывается в символах Юникода, а длина строки — это размер в символах Юникода.</span><span class="sxs-lookup"><span data-stu-id="3c119-142">For Unicode, the position of a clause is counted in Unicode characters, and the length of a string is the size in Unicode characters.</span></span>

<span data-ttu-id="3c119-143">Сведения о вводе в состояние строки композиции — это строка символов, завершающаяся нулем, представляющая символы, вводимые пользователем на клавиатуре.</span><span class="sxs-lookup"><span data-stu-id="3c119-143">The typing information included in the composition string status is a null-terminated character string representing the characters that the user enters at the keyboard.</span></span>

<span data-ttu-id="3c119-144">Позицией курсора, включенной в состояние строки композиции, является значение, указывающее позицию курсора относительно символов в строке композиции.</span><span class="sxs-lookup"><span data-stu-id="3c119-144">The cursor position included in the composition string status is a value indicating the position of the cursor relative to the characters in the composition string.</span></span> <span data-ttu-id="3c119-145">Значение — это смещение в байтах от начала строки.</span><span class="sxs-lookup"><span data-stu-id="3c119-145">The value is the offset, in bytes, from the beginning of the string.</span></span> <span data-ttu-id="3c119-146">Если это значение равно 0, курсор находится непосредственно перед первым символом в строке.</span><span class="sxs-lookup"><span data-stu-id="3c119-146">If this value is 0, the cursor is immediately before the first character in the string.</span></span> <span data-ttu-id="3c119-147">Если значение равно длине строки, курсор находится сразу после последнего символа.</span><span class="sxs-lookup"><span data-stu-id="3c119-147">If the value is equal to the length of the string, the cursor is immediately after the last character.</span></span> <span data-ttu-id="3c119-148">Если значение равно 1, курсор отсутствует.</span><span class="sxs-lookup"><span data-stu-id="3c119-148">If the value is 1, the cursor is not present.</span></span> <span data-ttu-id="3c119-149">Для Юникода обе позиции и длина измеряются в символах Юникода.</span><span class="sxs-lookup"><span data-stu-id="3c119-149">For Unicode, both position and length are measured in Unicode characters.</span></span>

<span data-ttu-id="3c119-150">Приложение может задать строку композиции или элементы состояния композиции с помощью функции [**иммсеткомпоситионстринг**](/windows/desktop/api/Imm/nf-imm-immsetcompositionstringa) .</span><span class="sxs-lookup"><span data-stu-id="3c119-150">Your application can set the composition string or elements of the composition status by using the [**ImmSetCompositionString**](/windows/desktop/api/Imm/nf-imm-immsetcompositionstringa) function.</span></span> <span data-ttu-id="3c119-151">Чтобы обеспечить обновление внешнего вида окна композиции на основе этих изменений, функция позволяет приложению отправить в окно сообщение уведомления.</span><span class="sxs-lookup"><span data-stu-id="3c119-151">To ensure that the composition window updates its appearance based on these changes, the function allows the application to send a notification message to the window.</span></span> <span data-ttu-id="3c119-152">Приложения, которые устанавливают сочетание элементов состояния композиции, обычно отключают уведомления для всех вызовов этой функции, кроме последнего, чтобы для окна композиции создавалось только одно сообщение уведомления.</span><span class="sxs-lookup"><span data-stu-id="3c119-152">Applications that set a combination of composition status elements typically disable notifications for all but the last call to this function so that only one notification message is generated for the composition window.</span></span>

<span data-ttu-id="3c119-153">Наконец, элемент управления "поле ввода" поддерживает два сообщения для изменения обработки строк композиции с помощью IME.</span><span class="sxs-lookup"><span data-stu-id="3c119-153">Finally, the edit control supports two messages for changing the handling of composition strings by the IME.</span></span> <span data-ttu-id="3c119-154">Дополнительные сведения см. в разделе [**EM \_ Жетиместатус**](../controls/em-getimestatus.md) и [**EM \_ сетиместатус**](../controls/em-setimestatus.md).</span><span class="sxs-lookup"><span data-stu-id="3c119-154">For more information, see [**EM\_GETIMESTATUS**](../controls/em-getimestatus.md) and [**EM\_SETIMESTATUS**](../controls/em-setimestatus.md).</span></span> <span data-ttu-id="3c119-155">Дополнительные сведения об элементе управления "поле ввода" см. в разделе [Edit Control](../controls/edit-controls.md).</span><span class="sxs-lookup"><span data-stu-id="3c119-155">For more information on the edit control, see [Edit Control](../controls/edit-controls.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="3c119-156">См. также</span><span class="sxs-lookup"><span data-stu-id="3c119-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3c119-157">О диспетчере методов ввода</span><span class="sxs-lookup"><span data-stu-id="3c119-157">About Input Method Manager</span></span>](about-input-method-manager.md)
</dt> </dl>

 

 
