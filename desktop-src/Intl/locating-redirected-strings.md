---
description: В этом разделе обсуждаются программные инструкции по поиску перенаправленных строк реестра. Дополнительные сведения см. в разделе Использование перенаправления строк реестра.
ms.assetid: 03d1512f-35a6-4b3a-9a0e-97e17bd9b126
title: Поиск перенаправленных строк
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f11600ad57c04de54d914c2c876b67967dfa1467
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105683000"
---
# <a name="locating-redirected-strings"></a><span data-ttu-id="75b10-104">Поиск перенаправленных строк</span><span class="sxs-lookup"><span data-stu-id="75b10-104">Locating Redirected Strings</span></span>

<span data-ttu-id="75b10-105">В этом разделе обсуждаются программные инструкции по поиску перенаправленных строк реестра.</span><span class="sxs-lookup"><span data-stu-id="75b10-105">This topic discusses programming instructions for locating redirected registry strings.</span></span> <span data-ttu-id="75b10-106">Дополнительные сведения см. [в разделе Использование перенаправления строк реестра](using-registry-string-redirection.md).</span><span class="sxs-lookup"><span data-stu-id="75b10-106">For more information, see [Using Registry String Redirection](using-registry-string-redirection.md).</span></span>

## <a name="load-a-language-neutral-registry-value"></a><span data-ttu-id="75b10-107">Загрузка значения реестра Language-Neutral</span><span class="sxs-lookup"><span data-stu-id="75b10-107">Load a Language-Neutral Registry Value</span></span>

<span data-ttu-id="75b10-108">В Windows Vista и более поздних версиях приложение MUI использует значение реестра, не зависящее от языка, чтобы разрешить доступ к строкам, зависящим от языка, хранящимся в таблице строковых ресурсов.</span><span class="sxs-lookup"><span data-stu-id="75b10-108">On Windows Vista and later, the MUI application uses a language-neutral registry value to allow access to language-specific strings stored in a string resource table.</span></span> <span data-ttu-id="75b10-109">Дополнительные сведения см. в разделе Создание Language-Neutral ресурса в [с помощью перенаправления строки реестра](using-registry-string-redirection.md).</span><span class="sxs-lookup"><span data-stu-id="75b10-109">For more information, see Create a Language-Neutral Resource in [Using Registry String Redirection](using-registry-string-redirection.md).</span></span>

<span data-ttu-id="75b10-110">Код приложения, считывающий не зависящее от языка значение из реестра, должен загрузить строки на правильном языке пользовательского интерфейса, вызвав [**реглоадмуистрингв**](/windows/win32/api/winreg/nf-winreg-regloadmuistringa).</span><span class="sxs-lookup"><span data-stu-id="75b10-110">Application code that reads the language-neutral value from the registry should load the strings in the correct user interface language by calling [**RegLoadMUIStringW**](/windows/win32/api/winreg/nf-winreg-regloadmuistringa).</span></span> <span data-ttu-id="75b10-111">При использовании этой функции приложению не нужно явно работать с загрузкой ресурсов.</span><span class="sxs-lookup"><span data-stu-id="75b10-111">If using this function, your application does not have to deal explicitly with resource loading.</span></span>

<span data-ttu-id="75b10-112">Если вы обновляете существующее приложение в соответствии с языком реестра, не зависящим от языка, вы обычно сохраняете существующие строковые значения, локализованные для английского языка или другого языка в реестре в качестве резервных и для обеспечения обратной совместимости.</span><span class="sxs-lookup"><span data-stu-id="75b10-112">If you are updating an existing application to the language-neutral use of the registry, you will typically keep the existing string values, localized to English or to some other single language in the registry, as fallbacks and for backward compatibility.</span></span> <span data-ttu-id="75b10-113">Хранение литеральной строки в реестре позволяет приложению возвращаться к литеральной строке, если вызов [**реглоадмуистрингв**](/windows/win32/api/winreg/nf-winreg-regloadmuistringa) завершается ошибкой.</span><span class="sxs-lookup"><span data-stu-id="75b10-113">Keeping a literal string in the registry allows the application to fall back to the literal string if a call to [**RegLoadMUIStringW**](/windows/win32/api/winreg/nf-winreg-regloadmuistringa) fails.</span></span> <span data-ttu-id="75b10-114">Необходимо решить, как реализовать такой откат, так как MUI не поддерживает такую реализацию.</span><span class="sxs-lookup"><span data-stu-id="75b10-114">You must decide how to implement such a fallback, as MUI provides no support for such an implementation.</span></span>

## <a name="use-shell-api-to-set-shortcut-strings-from-the-registry"></a><span data-ttu-id="75b10-115">Использование API оболочки для задания строк ярлыка из реестра</span><span class="sxs-lookup"><span data-stu-id="75b10-115">Use Shell API to Set Shortcut Strings from the Registry</span></span>

<span data-ttu-id="75b10-116">Приложение может использовать API оболочки для создания строк для ярлыков, связывающих файлы или папки в меню " **Пуск** " или на рабочем столе.</span><span class="sxs-lookup"><span data-stu-id="75b10-116">Your application can use the shell API to create strings for shortcuts that link files or folders in the **Start** menu or on the desktop.</span></span> <span data-ttu-id="75b10-117">Дополнительные сведения см. в разделе Создание ресурсов для контекстных строк в [с помощью перенаправления строк реестра](using-registry-string-redirection.md).</span><span class="sxs-lookup"><span data-stu-id="75b10-117">For more information, see Create Resources for Shortcut Strings in [Using Registry String Redirection](using-registry-string-redirection.md).</span></span>

<span data-ttu-id="75b10-118">Приложение может использовать [**шсетлокализеднаме**](/windows/win32/api/shellapi/nf-shellapi-shsetlocalizedname) для загрузки отображаемого имени, совместимого с MUI, для ярлыка.</span><span class="sxs-lookup"><span data-stu-id="75b10-118">The application can use [**SHSetLocalizedName**](/windows/win32/api/shellapi/nf-shellapi-shsetlocalizedname) to load the MUI-compliant display name for a shortcut.</span></span> <span data-ttu-id="75b10-119">Чтобы задать связанное всплывающее подсказку, следует использовать [**ишелллинк:: SetDescription**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishelllinka-setdescription) .</span><span class="sxs-lookup"><span data-stu-id="75b10-119">It should use [**IShellLink::SetDescription**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishelllinka-setdescription) to set the associated InfoTip.</span></span> <span data-ttu-id="75b10-120">Вызовы регистрируют строки в реестре.</span><span class="sxs-lookup"><span data-stu-id="75b10-120">The calls register the strings with the registry.</span></span> <span data-ttu-id="75b10-121">Рассмотрим следующие примеры, для которых "HKCR" представляет \_ раздел реестра hKey classes \_ root:</span><span class="sxs-lookup"><span data-stu-id="75b10-121">Consider the following examples, for which "HKCR" represents the HKEY\_CLASSES\_ROOT registry key:</span></span>


```C++
HKCR,"CLSID\%CLSID_AntiSpyware%",,,"Windows AntiSpyware"

HKCR,"CLSID\%CLSID_AntiSpyware%","LocalizedString",,"@%ProgramFiles%\Windows AntiSpyware\MSASCui.exe,-104"

HKCR,"CLSID\%CLSID_AntiSpyware%","InfoTip",,"@%ProgramFiles%\Windows AntiSpyware\MSASCui.exe,-208"
```



<span data-ttu-id="75b10-122">В первой строке представлена нелокализованная строка литерала для обеспечения обратной совместимости и возврата.</span><span class="sxs-lookup"><span data-stu-id="75b10-122">The first line provides an unlocalized literal string for fallback and backward compatibility.</span></span> <span data-ttu-id="75b10-123">Во второй строке показан способ регистрации отображаемого имени с помощью MUI.</span><span class="sxs-lookup"><span data-stu-id="75b10-123">The second line shows the MUI-compliant way to register the display name.</span></span> <span data-ttu-id="75b10-124">Эта строка указывает идентификатор строки 104, хранящийся в Msascui.exe (для Windows XP) или в соответствующем файле для конкретного языка (для Windows Vista).</span><span class="sxs-lookup"><span data-stu-id="75b10-124">This line indicates the string identifier 104 stored in Msascui.exe (for Windows XP) or in its associated language-specific file (for Windows Vista).</span></span> <span data-ttu-id="75b10-125">Этот идентификатор строки соответствует параметру "Мое сетевое окружение".</span><span class="sxs-lookup"><span data-stu-id="75b10-125">This string identifier corresponds to "My Network Places".</span></span> <span data-ttu-id="75b10-126">Третья строка в примере обрабатывает регистрацию подсказки.</span><span class="sxs-lookup"><span data-stu-id="75b10-126">The third line in the example handles InfoTip registration.</span></span> <span data-ttu-id="75b10-127">% CLSID \_ AntiSpyware% указывает переменную среды, представляющую идентификатор GUID, соответствующий идентификатору класса этого компонента.</span><span class="sxs-lookup"><span data-stu-id="75b10-127">%CLSID\_AntiSpyware% specifies an environment variable representing the GUID that matches the class identifier of this component.</span></span>

<span data-ttu-id="75b10-128">В приведенном выше примере приложение вызывает [**шсетлокализеднаме**](/windows/win32/api/shellapi/nf-shellapi-shsetlocalizedname) , чтобы указать путь к исполняемому файлу для первых двух параметров, и укажите *идсрес* как "@% ProgramFiles% \\ Windows AntiSpyware \\MSASCui.exe, 104".</span><span class="sxs-lookup"><span data-stu-id="75b10-128">For the example shown above, the application calls [**SHSetLocalizedName**](/windows/win32/api/shellapi/nf-shellapi-shsetlocalizedname) to specify the path of the executable for the first two parameters, and specify *idsRes* as "@%ProgramFiles%\\Windows AntiSpyware\\MSASCui.exe,104".</span></span> <span data-ttu-id="75b10-129">Вызов [**ишелллинк:: SetDescription**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishelllinka-setdescription)указывает путь для подсказки в виде "@% ProgramFiles% \\ Windows antispyware \\MSASCui.exe, 208".</span><span class="sxs-lookup"><span data-stu-id="75b10-129">A call to [**IShellLink::SetDescription**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishelllinka-setdescription), specifies the path for the InfoTip as "@%ProgramFiles%\\Windows AntiSpyware\\MSASCui.exe,208".</span></span>

## <a name="query-friendly-document-type-names-in-the-registry"></a><span data-ttu-id="75b10-130">Запрос понятных имен типов документов в реестре</span><span class="sxs-lookup"><span data-stu-id="75b10-130">Query Friendly Document Type Names in the Registry</span></span>

<span data-ttu-id="75b10-131">Создание ресурсов для удобных имен типов документов рассматривается в разделе Создание ресурсов для удобных имен типов документов в [с помощью перенаправления строк реестра](using-registry-string-redirection.md).</span><span class="sxs-lookup"><span data-stu-id="75b10-131">Resource creation for friendly document type names is discussed in Create Resources for Friendly Document Type Names in [Using Registry String Redirection](using-registry-string-redirection.md).</span></span> <span data-ttu-id="75b10-132">Чтобы запросить понятное имя документа, приложение должно использовать [**икуеряссоЦиатионс:: init**](/windows/win32/api/shlwapi/nf-shlwapi-iqueryassociations-init), за которым следует вызов [**ИкуеряссоЦиатионс:: GetString**](/windows/win32/api/shlwapi/nf-shlwapi-iqueryassociations-getstring).</span><span class="sxs-lookup"><span data-stu-id="75b10-132">To query a friendly document name, the application should use [**IQueryAssociations::Init**](/windows/win32/api/shlwapi/nf-shlwapi-iqueryassociations-init), followed by a call to [**IQueryAssociations::GetString**](/windows/win32/api/shlwapi/nf-shlwapi-iqueryassociations-getstring).</span></span> <span data-ttu-id="75b10-133">При вызове **икуеряссоЦиатионс:: init** указывается тип документа, например TXT.</span><span class="sxs-lookup"><span data-stu-id="75b10-133">The call to **IQueryAssociations::Init** specifies the document type, for example, ".txt".</span></span> <span data-ttu-id="75b10-134">При вызове **икуеряссоЦиатионс:: GetString** необходимо указать ассокстр \_ фриендлидокнаме в качестве идентификатора строки.</span><span class="sxs-lookup"><span data-stu-id="75b10-134">The call to **IQueryAssociations::GetString** must specify ASSOCSTR\_FRIENDLYDOCNAME as the string identifier.</span></span>

## <a name="register-microsoft-management-console-snap-in-strings-not-read-from-the-registry"></a><span data-ttu-id="75b10-135">Регистрация строк оснастки консоли управления (Майкрософт), не считанных из реестра</span><span class="sxs-lookup"><span data-stu-id="75b10-135">Register Microsoft Management Console Snap-in Strings Not Read from the Registry</span></span>

<span data-ttu-id="75b10-136">Приложение может использовать оснастку консоли управления Майкрософт (MMC) для размещения своих задач управления.</span><span class="sxs-lookup"><span data-stu-id="75b10-136">Your application can use a Microsoft Management Console (MMC) snap-in to host its management tasks.</span></span> <span data-ttu-id="75b10-137">Большинство строк обрабатываются как ресурсы с помощью параметров реестра, описанных в разделе Создание строковых ресурсов для консоли управления (Майкрософт) Snap-Ins в [разделе Использование перенаправления строк реестра](using-registry-string-redirection.md).</span><span class="sxs-lookup"><span data-stu-id="75b10-137">Most strings are handled as resources using the registry settings described in Create String Resources for Microsoft Management Console Snap-Ins in [Using Registry String Redirection](using-registry-string-redirection.md).</span></span> <span data-ttu-id="75b10-138">Однако некоторые оснастки регистрируют значения строк реестра, которые консоль управления (MMC) не может прочитать из реестра.</span><span class="sxs-lookup"><span data-stu-id="75b10-138">However, some snap-ins register registry string values that MMC cannot read from the registry.</span></span> <span data-ttu-id="75b10-139">В этом случае оснастка должна получить значения с помощью интерфейса [**иснапинабаут**](/windows/win32/api/mmc/nn-mmc-isnapinabout) , совместимого с MUI.</span><span class="sxs-lookup"><span data-stu-id="75b10-139">In this case, the snap-in must obtain the values using the [**ISnapinAbout**](/windows/win32/api/mmc/nn-mmc-isnapinabout) interface, which is MUI-compatible.</span></span>

## <a name="set-the-display-name-and-description-for-a-windows-service-from-the-registry"></a><span data-ttu-id="75b10-140">Установка отображаемого имени и описания для службы Windows из реестра</span><span class="sxs-lookup"><span data-stu-id="75b10-140">Set the Display Name and Description for a Windows Service from the Registry</span></span>

<span data-ttu-id="75b10-141">Если приложение MUI использует службу Windows, оно должно отображать отображаемое имя и описание службы.</span><span class="sxs-lookup"><span data-stu-id="75b10-141">If your MUI application is using a Windows service, it must display the service display name and description.</span></span> <span data-ttu-id="75b10-142">Связанные ресурсы обсуждаются в разделе "Создание строковых ресурсов для службы Windows" раздела [Использование перенаправления строк реестра](using-registry-string-redirection.md).</span><span class="sxs-lookup"><span data-stu-id="75b10-142">The associated resources are discussed in "Create String Resources for a Windows Service" in [Using Registry String Redirection](using-registry-string-redirection.md).</span></span>

<span data-ttu-id="75b10-143">Чтобы задать отображаемое имя службы, приложение MUI вызывает [**CreateService**](/windows/win32/api/winsvc/nf-winsvc-createservicea) или [**чанжесервицеконфиг**](/windows/win32/api/winsvc/nf-winsvc-changeserviceconfiga).</span><span class="sxs-lookup"><span data-stu-id="75b10-143">To set the service display name, the MUI application calls [**CreateService**](/windows/win32/api/winsvc/nf-winsvc-createservicea) or [**ChangeServiceConfig**](/windows/win32/api/winsvc/nf-winsvc-changeserviceconfiga).</span></span> <span data-ttu-id="75b10-144">Имя является строкой в формате " `@<PE-path>,-<stringID>[;<comment>]` ".</span><span class="sxs-lookup"><span data-stu-id="75b10-144">The name is a string of the form "`@<PE-path>,-<stringID>[;<comment>]`".</span></span> <span data-ttu-id="75b10-145">Например, если служба реализуется с помощью DLL-файла с путем% ProgramFiles% \\ % MyPath% \\MyDll.dll, а строковый идентификатор отображаемого имени для конкретного языка — 347, параметр указывается как " `@%ProgramFiles%\\%MyPath%\\MyDll.dll,-347` ".</span><span class="sxs-lookup"><span data-stu-id="75b10-145">For example, if your service is implemented by a .dll file with path %ProgramFiles%\\%MyPath%\\MyDll.dll, and the string identifier of the language-specific display name is 347, the parameter is specified as "`@%ProgramFiles%\\%MyPath%\\MyDll.dll,-347`".</span></span> <span data-ttu-id="75b10-146">Двойная обратная косая черта ( \\ \\ ) необходима, поскольку C/C++ использует обратную косую черту в качестве escape-символа в строках.</span><span class="sxs-lookup"><span data-stu-id="75b10-146">The double backslashes (\\\\) are necessary because C/C++ uses the backslash as an escape character in strings.</span></span>

<span data-ttu-id="75b10-147">Чтобы задать описание службы для конкретного языка, приложение MUI должно сделать элемент **лпдескриптион** в структуре [**\_ описания службы**](/windows/win32/api/winsvc/ns-winsvc-service_descriptiona) указать строку формы " `@<PE-path>,-<stringID>[;<comment>]` ", ссылающуюся на соответствующий идентификатор строки.</span><span class="sxs-lookup"><span data-stu-id="75b10-147">To set the language-specific service description, the MUI application should make the **lpDescription** member of a [**SERVICE\_DESCRIPTION**](/windows/win32/api/winsvc/ns-winsvc-service_descriptiona) structure indicate a string of form "`@<PE-path>,-<stringID>[;<comment>]`", referencing the appropriate string identifier.</span></span> <span data-ttu-id="75b10-148">Затем приложение вызывает [**ChangeServiceConfig2**](/windows/win32/api/winsvc/nf-winsvc-changeserviceconfig2a) с параметром *двинфолевел* , указанным как \_ Описание конфигурации службы \_ , и параметр *LpInfo* , указанный в качестве структуры **\_ описания службы** .</span><span class="sxs-lookup"><span data-stu-id="75b10-148">Then the application calls [**ChangeServiceConfig2**](/windows/win32/api/winsvc/nf-winsvc-changeserviceconfig2a) with parameter *dwInfoLevel* specified as SERVICE\_CONFIG\_DESCRIPTION and parameter *lpInfo* specified as the **SERVICE\_DESCRIPTION** structure.</span></span>

## <a name="related-topics"></a><span data-ttu-id="75b10-149">См. также</span><span class="sxs-lookup"><span data-stu-id="75b10-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="75b10-150">Поиск ресурсов Win32 PE</span><span class="sxs-lookup"><span data-stu-id="75b10-150">Locating Win32 PE Resources</span></span>](locating-win32-pe-resources.md)
</dt> <dt>

[<span data-ttu-id="75b10-151">Использование перенаправления строк реестра</span><span class="sxs-lookup"><span data-stu-id="75b10-151">Using Registry String Redirection</span></span>](using-registry-string-redirection.md)
</dt> </dl>

 

 
