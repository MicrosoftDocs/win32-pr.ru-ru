---
description: Приложения могут использовать функции API Uniscribe для поддержки оформления и редактирования международного текста. Uniscribe использует абзац в качестве единицы для вывода текста, а функция Uniscribe должна использоваться для всего абзаца.
ms.assetid: e1adc567-0445-4deb-8634-25653f82127c
title: Отображение текста с помощью Uniscribe
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 17caf7e7880a61bdf9afbaf6db5b60065b01d3d3960f2ed5629a007aa304b7b7
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118949609"
---
# <a name="displaying-text-with-uniscribe"></a>Отображение текста с помощью Uniscribe

Приложения могут использовать функции API Uniscribe для поддержки оформления и редактирования международного текста. Uniscribe использует абзац в качестве единицы для вывода текста, а функция Uniscribe должна использоваться для всего абзаца.

При использовании Uniscribe для вывода текста приложение должно проходить через процесс форматирования ("Layout"), как правило, с использованием Uniscribe. Приложение делит текстовый абзац на строки символов с тем же стилем, называемый «запуском». Стиль определяется конкретной реализацией, но обычно включает такие атрибуты, как шрифт, размер и цвет. При определении запусков приложение может также применять другие сведения, такие как язык и региональные параметры, поддерживаемые для лексических средств. Например, приложение может рассматриваться как отдельный запуск в основном тексте на английском языке, который отображается на французском языке.

После определения выполнения для всех абзацев приложение делит каждый абзац на строки, имеющие один и тот же сценарий и направление ("Items"). Приложение применяет сведения об элементе для создания запусков, уникальных в скрипте и направлении, и полностью попадает в один элемент ("Ranges").

Разбивка элемента на диапазоны является несколько произвольными, хотя диапазон должен состоять из одной или нескольких последовательных определяемых сценарием групп символов, называемых "кластерами". Для европейских языков кластер обычно соответствует одному символу кодовой страницы или кодовой точке Юникода и состоит из одного [глифа](uniscribe-glossary.md). Однако в таких языках, как тайский, кластер представляет собой группу глифов и соответствует нескольким последовательным символам или кодовым точкам. Например, в тайском кластере может содержаться согласный, гласный и знак тона. Чтобы она не нарушала кластеры, приложение обычно должно либо использовать самые длинные диапазоны, либо использовать собственные лексические сведения для разрыва между диапазонами в местах, которые не находятся в середине кластера.

После определения кластеров в каждом диапазоне приложение должно определить размер каждого кластера. Он использует Uniscribe для суммирования кластеров, чтобы определить размер каждого диапазона. Затем приложение суммирует Размеры диапазонов до тех пор, пока не будет переполнена линия, то есть достигает поля. Диапазон, который переполняет линию, делится между текущей строкой и следующей строкой. Для каждой строки приложение создает карту от визуального расположения до логической позицией для каждого диапазона. Затем приложение помещает кодовые точки для каждого диапазона в глифы, которые впоследствии могут быть размещены и отображены.

Приложение выполняет компоновку текста только один раз. После этого он либо сохраняет глифы и позиции для отображения, либо создает их каждый раз при отображении текста с компромиссом и скоростью, чем с памятью. Обычно приложение реализует процесс макета один раз, а затем создает глифы и позиции при каждом отображении текста.

Приложение, использующее [сложные сценарии](uniscribe-glossary.md) , имеет следующие проблемы с простым подходом к макету и отображению.

-   Ширина символа сложного скрипта зависит от контекста. Невозможно сохранить ширину в простых таблицах.
-   Для разбиения слов в скриптах, таких как тайский, требуется поддержка словаря. Например, между тайскими словами не используется ни один символ разделителя.
-   Для арабского, иврита, фарси, урду и других языков с [двунаправленным письмом](uniscribe-glossary.md) необходимо изменить порядок перед отображением.
-   Для простого использования сложных наборов символов часто требуется какая-либо форма сопоставления шрифтов.

Тот факт, что Uniscribe использует абзац в качестве единицы измерения, помогает приложению работать надлежащим образом с этими сложными проблемами со сценариями.

> [!Note]  
> Uniscribe должен использоваться для всего абзаца, даже если разделы абзаца не являются сложными скриптами.

 

Как показано в следующей таблице, Uniscribe версии 1,6 или более поздней поддерживает несколько функций, использующих Теги OpenType. Их можно заменить на соответствующие обычные функции Uniscribe. Как правило, приложения должны полностью работать с функциями из одного набора или другого и не должны пытаться использовать функции Mix и Match.



| Обычная функция Uniscribe             | Эквивалентная функция OpenType                           |
|----------------------------------------|--------------------------------------------------------|
| [**скриптитемизе**](/windows/desktop/api/Usp10/nf-usp10-scriptitemize) | [**скриптитемизеопентипе**](/windows/desktop/api/usp10/nf-usp10-scriptitemizeopentype) |
| [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape)     | [**скриптшапеопентипе**](/windows/desktop/api/Usp10/nf-usp10-scriptshapeopentype)     |
| [**скриптплаце**](/windows/desktop/api/Usp10/nf-usp10-scriptplace)     | [**скриптплацеопентипе**](/windows/desktop/api/Usp10/nf-usp10-scriptplaceopentype)     |



 

## <a name="lay-out-text-using-uniscribe"></a>Разметить текст с помощью Uniscribe

Приложение может выполнить следующие действия для разметки текстового абзаца с помощью Uniscribe. В этой процедуре предполагается, что приложение уже разделяет абзац на запуск.

1.  Вызывайте [**скриптрекорддигитсубститутион**](/windows/desktop/api/Usp10/nf-usp10-scriptrecorddigitsubstitution) только при запуске или при получении сообщения [**WM \_ сеттингчанже**](../winmsg/wm-settingchange.md) .
2.  Используемых Вызовите [**скриптискомплекс**](/windows/desktop/api/Usp10/nf-usp10-scriptiscomplex) , чтобы определить, требуется ли для абзаца сложная обработка.
3.  Используемых При использовании Uniscribe для работы с двунаправленным текстом и/или подстановкой цифр вызовите [**скриптапплидигитсубститутион**](/windows/desktop/api/Usp10/nf-usp10-scriptapplydigitsubstitution) , чтобы подготовить [**\_ элемент управления скрипта**](/windows/win32/api/usp10/ns-usp10-script_control) и структуры [**\_ состояния скрипта**](/windows/win32/api/usp10/ns-usp10-script_state) в качестве входных данных для [**скриптитемизе**](/windows/desktop/api/Usp10/nf-usp10-scriptitemize). Если пропустить этот шаг, но по-прежнему требуется подстановка цифр, замените национальные цифры для Юникода U + 0030 на U + 0039 (европейские цифры). Дополнительные сведения о подстановке цифр см. в разделе [Цифровые фигуры](digit-shapes.md).
4.  Вызовите [**скриптитемизе**](/windows/desktop/api/Usp10/nf-usp10-scriptitemize) , чтобы разделить абзац на элементы. Если не использовать Uniscribe для подстановки цифр, а также известен двунаправленный порядок, например, из-за раскладки клавиатуры, используемой для ввода символа, вызовите **скриптитемизе**. В вызове укажите пустые указатели для [**\_ элементов управления скрипта**](/windows/win32/api/usp10/ns-usp10-script_control) и структуры [**\_ состояния скрипта**](/windows/win32/api/usp10/ns-usp10-script_state) . Этот метод создает элементы, используя только механизм формирования, и элементы могут быть упорядочены с помощью сведений о подсистеме.
    > [!Note]  
    > Как правило, приложения, работающие только с сценариями слева направо и без подстановки цифр, должны передавать пустые указатели для [**\_ элементов управления скрипта**](/windows/win32/api/usp10/ns-usp10-script_control) и структуры [**\_ состояния скрипта**](/windows/win32/api/usp10/ns-usp10-script_state) .

     

5.  Объедините сведения об элементе с информацией о запуске для создания диапазонов.
6.  Вызовите [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) для обнаружения кластеров и создания глифов.
7.  Если [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) возвращает сценарий Code USP \_ E \_ , \_ не \_ \_ находящийся в Font или S \_ , с выходными данными, содержащими отсутствующие глифы, выберите символы из другого шрифта. Либо замените другим шрифтом, либо отключите формирование, установив элемент **ескрипт** структуры [**\_ анализа скриптов**](/windows/win32/api/usp10/ns-usp10-script_analysis) , ПЕРЕдаваемой в **скриптшапе** в скрипт \_ undefine. Дополнительные сведения см. [в разделе Использование отката шрифта](using-font-fallback.md).
8.  Вызовите [**скриптплаце**](/windows/desktop/api/Usp10/nf-usp10-scriptplace) , чтобы создать значения [ширины](uniscribe-glossary.md) и позиции x и y для глифов в каждом последовательном диапазоне. Это первый шаг, для которого будет учитываться размер текста.
9.  Суммировать Размеры диапазонов до тех пор, пока не будет переполняется строка.
10. Разбейте диапазон на границе слова с помощью членов **фсофтбреак** и **фвхитеспаце** в логических атрибутах. Чтобы разбить один кластер символов за пределы выполнения, используйте сведения, возвращаемые при вызове [**скриптбреак**](/windows/desktop/api/Usp10/nf-usp10-scriptbreak).
    > [!Note]  
    > Определите, должна ли первая кодовая точка диапазона быть точкой останова по словам, так как это требуется для последнего символа предыдущего диапазона. Например, если один диапазон заканчивается запятой, рассмотрим первый символ следующего диапазона, который будет точкой разрыва слова.

     

11. Повторите шаги с 6 по 10 для каждой строки в абзаце. Однако при прерывании последнего выполнения в строке вызовите [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) , чтобы изменить форму оставшейся части выполнения, как первый запуск на следующей строке.

## <a name="display-text-using-uniscribe"></a>Отображение текста с помощью Uniscribe

Чтобы отобразить текстовый абзац, приложение может выполнить следующие действия. В этой процедуре предполагается, что приложение уже разработало текст и не сохранило глифы и позиции из процесса макета. Если важна скорость, приложение может сохранить глифы и позиции из процедуры макета и начать с шага 2 в процедуре вывода.

> [!Note]  
> Приложение может опустить шаг 2, если текст не содержит символов из скриптов с направлением справа налево, не содержит двунаправленных управляющих символов и использует уровень внедрения слева направо.

 

1.  Для каждого запуска выполните следующие действия.
    1.  Если стиль изменился с момента последнего запуска, обновите его до контекста устройства, отпустив и повторно получая его.
    2.  Вызовите [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) , чтобы создать глифы для запуска.
    3.  Вызовите [**скриптплаце**](/windows/desktop/api/Usp10/nf-usp10-scriptplace) , чтобы создать предварительную ширину и смещение x, y для каждого глифа.
2.  Выполните следующие действия, чтобы установить правильный порядок отображения для выполнения в строке:
    1.  Извлечение массива уровней двунаправленного [внедрения](uniscribe-glossary.md), по одному на диапазон. Уровень внедрения предоставляется (элемент СКРИПТа \_ ) si. ( \_Анализ скриптов) a. (Скрипт \_ STATE) s. Убидилевел.
    2.  Передайте этот массив в [**скриптлайаут**](/windows/desktop/api/Usp10/nf-usp10-scriptlayout) , чтобы создать карту визуальных позиций для логических позиций.
3.  Используемых Чтобы выровнять текст, либо вызовите [**скриптжустифи**](/windows/desktop/api/Usp10/nf-usp10-scriptjustify) , либо воспользуйтесь специальными знаниями о тексте.
4.  Используйте карту "Visual-to-logical" для отображения выполнения в визуальном порядке. Начиная с левого конца строки вызовите [**скрипттекстаут**](/windows/desktop/api/Usp10/nf-usp10-scripttextout) , чтобы отобразить выполнение, заданное первой записью в сопоставлении. Для каждой последующей записи на карте вызовите **скрипттекстаут** , чтобы отобразить указанный запуск справа от ранее отображаемого запуска.

    Если опустить шаг 2, начните с левого конца строки и вызовите [**скрипттекстаут**](/windows/desktop/api/Usp10/nf-usp10-scripttextout) , чтобы отобразить первый логический запуск, а затем для вывода каждого логического запуска справа от предыдущего запуска.

5.  Повторите приведенные выше шаги для всех строк в абзаце.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Использование Uniscribe](using-uniscribe.md)
</dt> </dl>

 

 
