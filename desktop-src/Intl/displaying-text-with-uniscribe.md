---
description: Приложения могут использовать функции API Uniscribe для поддержки оформления и редактирования международного текста. Uniscribe использует абзац в качестве единицы для вывода текста, а функция Uniscribe должна использоваться для всего абзаца.
ms.assetid: e1adc567-0445-4deb-8634-25653f82127c
title: Отображение текста с помощью Uniscribe
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: baeb9a2be4d00efaa2681097ddefe3a6de4c576b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104348162"
---
# <a name="displaying-text-with-uniscribe"></a><span data-ttu-id="4376a-104">Отображение текста с помощью Uniscribe</span><span class="sxs-lookup"><span data-stu-id="4376a-104">Displaying Text with Uniscribe</span></span>

<span data-ttu-id="4376a-105">Приложения могут использовать функции API Uniscribe для поддержки оформления и редактирования международного текста.</span><span class="sxs-lookup"><span data-stu-id="4376a-105">Your applications can use Uniscribe API functions to support typography and the display and editing of international text.</span></span> <span data-ttu-id="4376a-106">Uniscribe использует абзац в качестве единицы для вывода текста, а функция Uniscribe должна использоваться для всего абзаца.</span><span class="sxs-lookup"><span data-stu-id="4376a-106">Uniscribe uses the paragraph as the unit for text display, and the Uniscribe functionality must be used for the entire paragraph.</span></span>

<span data-ttu-id="4376a-107">При использовании Uniscribe для вывода текста приложение должно проходить через процесс форматирования ("Layout"), как правило, с использованием Uniscribe.</span><span class="sxs-lookup"><span data-stu-id="4376a-107">When using Uniscribe for display of text, an application must go through a formatting ("layout") process, typically using Uniscribe.</span></span> <span data-ttu-id="4376a-108">Приложение делит текстовый абзац на строки символов с тем же стилем, называемый «запуском».</span><span class="sxs-lookup"><span data-stu-id="4376a-108">The application divides a text paragraph into strings of characters with the same style, called "runs".</span></span> <span data-ttu-id="4376a-109">Стиль определяется конкретной реализацией, но обычно включает такие атрибуты, как шрифт, размер и цвет.</span><span class="sxs-lookup"><span data-stu-id="4376a-109">The style is determined by the particular implementation, but typically includes such attributes as font, size, and color.</span></span> <span data-ttu-id="4376a-110">При определении запусков приложение может также применять другие сведения, такие как язык и региональные параметры, поддерживаемые для лексических средств.</span><span class="sxs-lookup"><span data-stu-id="4376a-110">In defining runs, the application can also apply other information, such as language and locale data maintained for use with lexical tools.</span></span> <span data-ttu-id="4376a-111">Например, приложение может рассматриваться как отдельный запуск в основном тексте на английском языке, который отображается на французском языке.</span><span class="sxs-lookup"><span data-stu-id="4376a-111">For example, an application might treat as a separate run a passage in a primarily English text that is rendered in French.</span></span>

<span data-ttu-id="4376a-112">После определения выполнения для всех абзацев приложение делит каждый абзац на строки, имеющие один и тот же сценарий и направление ("Items").</span><span class="sxs-lookup"><span data-stu-id="4376a-112">Once it has determined the runs for all paragraphs, the application divides each paragraph into strings that have the same script and direction ("items").</span></span> <span data-ttu-id="4376a-113">Приложение применяет сведения об элементе для создания запусков, уникальных в скрипте и направлении, и полностью попадает в один элемент ("Ranges").</span><span class="sxs-lookup"><span data-stu-id="4376a-113">The application applies the item information to produce runs that are unique in script and direction and fall entirely within a single item ("ranges").</span></span>

<span data-ttu-id="4376a-114">Разбивка элемента на диапазоны является несколько произвольными, хотя диапазон должен состоять из одной или нескольких последовательных определяемых сценарием групп символов, называемых "кластерами".</span><span class="sxs-lookup"><span data-stu-id="4376a-114">The breakdown of an item into ranges is somewhat arbitrary, although a range should consist of one or more consecutive script-defined, indivisible character groupings, called "clusters."</span></span> <span data-ttu-id="4376a-115">Для европейских языков кластер обычно соответствует одному символу кодовой страницы или кодовой точке Юникода и состоит из одного [глифа](uniscribe-glossary.md).</span><span class="sxs-lookup"><span data-stu-id="4376a-115">For European languages, a cluster typically corresponds to a single code page character or Unicode code point, and consists of a single [glyph](uniscribe-glossary.md).</span></span> <span data-ttu-id="4376a-116">Однако в таких языках, как тайский, кластер представляет собой группу глифов и соответствует нескольким последовательным символам или кодовым точкам.</span><span class="sxs-lookup"><span data-stu-id="4376a-116">However, in languages such as Thai, a cluster is a grouping of glyphs and corresponds to multiple consecutive characters or code points.</span></span> <span data-ttu-id="4376a-117">Например, в тайском кластере может содержаться согласный, гласный и знак тона.</span><span class="sxs-lookup"><span data-stu-id="4376a-117">For example, a Thai cluster might contain a consonant, a vowel, and a tone mark.</span></span> <span data-ttu-id="4376a-118">Чтобы она не нарушала кластеры, приложение обычно должно либо использовать самые длинные диапазоны, либо использовать собственные лексические сведения для разрыва между диапазонами в местах, которые не находятся в середине кластера.</span><span class="sxs-lookup"><span data-stu-id="4376a-118">So that it does not break clusters, the application typically should either use the longest ranges it can or use its own lexical information to break between ranges in places that are not in the middle of a cluster.</span></span>

<span data-ttu-id="4376a-119">После определения кластеров в каждом диапазоне приложение должно определить размер каждого кластера.</span><span class="sxs-lookup"><span data-stu-id="4376a-119">When it has identified the clusters in each range, the application must determine the size of each cluster.</span></span> <span data-ttu-id="4376a-120">Он использует Uniscribe для суммирования кластеров, чтобы определить размер каждого диапазона.</span><span class="sxs-lookup"><span data-stu-id="4376a-120">It uses Uniscribe to sum the clusters to determine the size of each range.</span></span> <span data-ttu-id="4376a-121">Затем приложение суммирует Размеры диапазонов до тех пор, пока не будет переполнена линия, то есть достигает поля.</span><span class="sxs-lookup"><span data-stu-id="4376a-121">Then the application sums the sizes of the ranges until they overflow a line, that is, reach the margin.</span></span> <span data-ttu-id="4376a-122">Диапазон, который переполняет линию, делится между текущей строкой и следующей строкой.</span><span class="sxs-lookup"><span data-stu-id="4376a-122">The range that overflows the line is divided between the current line and the next line.</span></span> <span data-ttu-id="4376a-123">Для каждой строки приложение создает карту от визуального расположения до логической позицией для каждого диапазона.</span><span class="sxs-lookup"><span data-stu-id="4376a-123">For each line, the application builds a map from visual position to logical position for each range.</span></span> <span data-ttu-id="4376a-124">Затем приложение помещает кодовые точки для каждого диапазона в глифы, которые впоследствии могут быть размещены и отображены.</span><span class="sxs-lookup"><span data-stu-id="4376a-124">Then the application shapes the code points for each range into glyphs, which it can subsequently position and render.</span></span>

<span data-ttu-id="4376a-125">Приложение выполняет компоновку текста только один раз.</span><span class="sxs-lookup"><span data-stu-id="4376a-125">An application does text layout only one time.</span></span> <span data-ttu-id="4376a-126">После этого он либо сохраняет глифы и позиции для отображения, либо создает их каждый раз при отображении текста с компромиссом и скоростью, чем с памятью.</span><span class="sxs-lookup"><span data-stu-id="4376a-126">Afterwards, it either saves the glyphs and positions for display purposes or it generates them each time it displays the text, with the tradeoff being speed versus memory.</span></span> <span data-ttu-id="4376a-127">Обычно приложение реализует процесс макета один раз, а затем создает глифы и позиции при каждом отображении текста.</span><span class="sxs-lookup"><span data-stu-id="4376a-127">A typical application implements the layout process once, then generates the glyphs and positions each time it displays the text.</span></span>

<span data-ttu-id="4376a-128">Приложение, использующее [сложные сценарии](uniscribe-glossary.md) , имеет следующие проблемы с простым подходом к макету и отображению.</span><span class="sxs-lookup"><span data-stu-id="4376a-128">An application that uses [complex scripts](uniscribe-glossary.md) has the following problems with a simple approach to layout and display.</span></span>

-   <span data-ttu-id="4376a-129">Ширина символа сложного скрипта зависит от контекста.</span><span class="sxs-lookup"><span data-stu-id="4376a-129">The width of a complex script character depends on its context.</span></span> <span data-ttu-id="4376a-130">Невозможно сохранить ширину в простых таблицах.</span><span class="sxs-lookup"><span data-stu-id="4376a-130">It is not possible to save the widths in simple tables.</span></span>
-   <span data-ttu-id="4376a-131">Для разбиения слов в скриптах, таких как тайский, требуется поддержка словаря.</span><span class="sxs-lookup"><span data-stu-id="4376a-131">Breaking between words in scripts such as Thai requires dictionary support.</span></span> <span data-ttu-id="4376a-132">Например, между тайскими словами не используется ни один символ разделителя.</span><span class="sxs-lookup"><span data-stu-id="4376a-132">For example, no separator character is used between Thai words.</span></span>
-   <span data-ttu-id="4376a-133">Для арабского, иврита, фарси, урду и других языков с [двунаправленным письмом](uniscribe-glossary.md) необходимо изменить порядок перед отображением.</span><span class="sxs-lookup"><span data-stu-id="4376a-133">Arabic, Hebrew, Persian, Urdu, and other [bidirectional text](uniscribe-glossary.md) languages require reordering before display.</span></span>
-   <span data-ttu-id="4376a-134">Для простого использования сложных наборов символов часто требуется какая-либо форма сопоставления шрифтов.</span><span class="sxs-lookup"><span data-stu-id="4376a-134">Some form of font association is often required to easily use complex scripts.</span></span>

<span data-ttu-id="4376a-135">Тот факт, что Uniscribe использует абзац в качестве единицы измерения, помогает приложению работать надлежащим образом с этими сложными проблемами со сценариями.</span><span class="sxs-lookup"><span data-stu-id="4376a-135">The fact that Uniscribe uses the paragraph as the display unit helps the application deal adequately with these complex script issues.</span></span>

> [!Note]  
> <span data-ttu-id="4376a-136">Uniscribe должен использоваться для всего абзаца, даже если разделы абзаца не являются сложными скриптами.</span><span class="sxs-lookup"><span data-stu-id="4376a-136">Uniscribe must be used for an entire paragraph, even if sections of the paragraph are not complex scripts.</span></span>

 

<span data-ttu-id="4376a-137">Как показано в следующей таблице, Uniscribe версии 1,6 или более поздней поддерживает несколько функций, использующих Теги OpenType.</span><span class="sxs-lookup"><span data-stu-id="4376a-137">As shown in the following table, Uniscribe version 1.6 or greater supports several functions that take advantage of OpenType tags.</span></span> <span data-ttu-id="4376a-138">Их можно заменить на соответствующие обычные функции Uniscribe.</span><span class="sxs-lookup"><span data-stu-id="4376a-138">They can be substituted for the corresponding regular Uniscribe functions.</span></span> <span data-ttu-id="4376a-139">Как правило, приложения должны полностью работать с функциями из одного набора или другого и не должны пытаться использовать функции Mix и Match.</span><span class="sxs-lookup"><span data-stu-id="4376a-139">Generally your applications should work entirely with functions from one set or the other and should not attempt to "mix and match" functions.</span></span>



| <span data-ttu-id="4376a-140">Обычная функция Uniscribe</span><span class="sxs-lookup"><span data-stu-id="4376a-140">Regular Uniscribe function</span></span>             | <span data-ttu-id="4376a-141">Эквивалентная функция OpenType</span><span class="sxs-lookup"><span data-stu-id="4376a-141">Equivalent OpenType function</span></span>                           |
|----------------------------------------|--------------------------------------------------------|
| [<span data-ttu-id="4376a-142">**скриптитемизе**</span><span class="sxs-lookup"><span data-stu-id="4376a-142">**ScriptItemize**</span></span>](/windows/desktop/api/Usp10/nf-usp10-scriptitemize) | [<span data-ttu-id="4376a-143">**скриптитемизеопентипе**</span><span class="sxs-lookup"><span data-stu-id="4376a-143">**ScriptItemizeOpenType**</span></span>](/windows/desktop/api/usp10/nf-usp10-scriptitemizeopentype) |
| [<span data-ttu-id="4376a-144">**скриптшапе**</span><span class="sxs-lookup"><span data-stu-id="4376a-144">**ScriptShape**</span></span>](/windows/desktop/api/Usp10/nf-usp10-scriptshape)     | [<span data-ttu-id="4376a-145">**скриптшапеопентипе**</span><span class="sxs-lookup"><span data-stu-id="4376a-145">**ScriptShapeOpenType**</span></span>](/windows/desktop/api/Usp10/nf-usp10-scriptshapeopentype)     |
| [<span data-ttu-id="4376a-146">**скриптплаце**</span><span class="sxs-lookup"><span data-stu-id="4376a-146">**ScriptPlace**</span></span>](/windows/desktop/api/Usp10/nf-usp10-scriptplace)     | [<span data-ttu-id="4376a-147">**скриптплацеопентипе**</span><span class="sxs-lookup"><span data-stu-id="4376a-147">**ScriptPlaceOpenType**</span></span>](/windows/desktop/api/Usp10/nf-usp10-scriptplaceopentype)     |



 

## <a name="lay-out-text-using-uniscribe"></a><span data-ttu-id="4376a-148">Разметить текст с помощью Uniscribe</span><span class="sxs-lookup"><span data-stu-id="4376a-148">Lay Out Text Using Uniscribe</span></span>

<span data-ttu-id="4376a-149">Приложение может выполнить следующие действия для разметки текстового абзаца с помощью Uniscribe.</span><span class="sxs-lookup"><span data-stu-id="4376a-149">Your application can use the following steps to lay out out a text paragraph with Uniscribe.</span></span> <span data-ttu-id="4376a-150">В этой процедуре предполагается, что приложение уже разделяет абзац на запуск.</span><span class="sxs-lookup"><span data-stu-id="4376a-150">This procedure assumes that the application has already divided the paragraph into runs.</span></span>

1.  <span data-ttu-id="4376a-151">Вызывайте [**скриптрекорддигитсубститутион**](/windows/desktop/api/Usp10/nf-usp10-scriptrecorddigitsubstitution) только при запуске или при получении сообщения [**WM \_ сеттингчанже**](../winmsg/wm-settingchange.md) .</span><span class="sxs-lookup"><span data-stu-id="4376a-151">Call [**ScriptRecordDigitSubstitution**](/windows/desktop/api/Usp10/nf-usp10-scriptrecorddigitsubstitution) only when starting or when receiving a [**WM\_SETTINGCHANGE**](../winmsg/wm-settingchange.md) message.</span></span>
2.  <span data-ttu-id="4376a-152">Используемых Вызовите [**скриптискомплекс**](/windows/desktop/api/Usp10/nf-usp10-scriptiscomplex) , чтобы определить, требуется ли для абзаца сложная обработка.</span><span class="sxs-lookup"><span data-stu-id="4376a-152">(Optional) Call [**ScriptIsComplex**](/windows/desktop/api/Usp10/nf-usp10-scriptiscomplex) to determine if the paragraph requires complex processing.</span></span>
3.  <span data-ttu-id="4376a-153">Используемых При использовании Uniscribe для работы с двунаправленным текстом и/или подстановкой цифр вызовите [**скриптапплидигитсубститутион**](/windows/desktop/api/Usp10/nf-usp10-scriptapplydigitsubstitution) , чтобы подготовить [**\_ элемент управления скрипта**](/windows/win32/api/usp10/ns-usp10-script_control) и структуры [**\_ состояния скрипта**](/windows/win32/api/usp10/ns-usp10-script_state) в качестве входных данных для [**скриптитемизе**](/windows/desktop/api/Usp10/nf-usp10-scriptitemize).</span><span class="sxs-lookup"><span data-stu-id="4376a-153">(Optional) If using Uniscribe to handle bidirectional text and/or digit substitution, call [**ScriptApplyDigitSubstitution**](/windows/desktop/api/Usp10/nf-usp10-scriptapplydigitsubstitution) to prepare the [**SCRIPT\_CONTROL**](/windows/win32/api/usp10/ns-usp10-script_control) and [**SCRIPT\_STATE**](/windows/win32/api/usp10/ns-usp10-script_state) structures as inputs to [**ScriptItemize**](/windows/desktop/api/Usp10/nf-usp10-scriptitemize).</span></span> <span data-ttu-id="4376a-154">Если пропустить этот шаг, но по-прежнему требуется подстановка цифр, замените национальные цифры для Юникода U + 0030 на U + 0039 (европейские цифры).</span><span class="sxs-lookup"><span data-stu-id="4376a-154">If skipping this step, but still requiring digit substitution, substitute national digits for Unicode U+0030 through U+0039 (European digits).</span></span> <span data-ttu-id="4376a-155">Дополнительные сведения о подстановке цифр см. в разделе [Цифровые фигуры](digit-shapes.md).</span><span class="sxs-lookup"><span data-stu-id="4376a-155">For information about digit substitution, see [Digit Shapes](digit-shapes.md).</span></span>
4.  <span data-ttu-id="4376a-156">Вызовите [**скриптитемизе**](/windows/desktop/api/Usp10/nf-usp10-scriptitemize) , чтобы разделить абзац на элементы.</span><span class="sxs-lookup"><span data-stu-id="4376a-156">Call [**ScriptItemize**](/windows/desktop/api/Usp10/nf-usp10-scriptitemize) to divide the paragraph into items.</span></span> <span data-ttu-id="4376a-157">Если не использовать Uniscribe для подстановки цифр, а также известен двунаправленный порядок, например, из-за раскладки клавиатуры, используемой для ввода символа, вызовите **скриптитемизе**.</span><span class="sxs-lookup"><span data-stu-id="4376a-157">If not using Uniscribe for digit substitution and the bidirectional order is known, for example, because of the keyboard layout used to enter the character, call **ScriptItemize**.</span></span> <span data-ttu-id="4376a-158">В вызове укажите пустые указатели для [**\_ элементов управления скрипта**](/windows/win32/api/usp10/ns-usp10-script_control) и структуры [**\_ состояния скрипта**](/windows/win32/api/usp10/ns-usp10-script_state) .</span><span class="sxs-lookup"><span data-stu-id="4376a-158">In the call, provide null pointers for the [**SCRIPT\_CONTROL**](/windows/win32/api/usp10/ns-usp10-script_control) and [**SCRIPT\_STATE**](/windows/win32/api/usp10/ns-usp10-script_state) structures.</span></span> <span data-ttu-id="4376a-159">Этот метод создает элементы, используя только механизм формирования, и элементы могут быть упорядочены с помощью сведений о подсистеме.</span><span class="sxs-lookup"><span data-stu-id="4376a-159">This technique generates items by use of the shaping engine only, and the items can be reordered using the engine information.</span></span>
    > [!Note]  
    > <span data-ttu-id="4376a-160">Как правило, приложения, работающие только с сценариями слева направо и без подстановки цифр, должны передавать пустые указатели для [**\_ элементов управления скрипта**](/windows/win32/api/usp10/ns-usp10-script_control) и структуры [**\_ состояния скрипта**](/windows/win32/api/usp10/ns-usp10-script_state) .</span><span class="sxs-lookup"><span data-stu-id="4376a-160">Typically, applications that work only with left-to-right scripts and without any digit substitution should pass null pointers for the [**SCRIPT\_CONTROL**](/windows/win32/api/usp10/ns-usp10-script_control) and [**SCRIPT\_STATE**](/windows/win32/api/usp10/ns-usp10-script_state) structures.</span></span>

     

5.  <span data-ttu-id="4376a-161">Объедините сведения об элементе с информацией о запуске для создания диапазонов.</span><span class="sxs-lookup"><span data-stu-id="4376a-161">Merge the item information with the run information to produce ranges.</span></span>
6.  <span data-ttu-id="4376a-162">Вызовите [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) для обнаружения кластеров и создания глифов.</span><span class="sxs-lookup"><span data-stu-id="4376a-162">Call [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) to identify clusters and generate glyphs.</span></span>
7.  <span data-ttu-id="4376a-163">Если [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) возвращает сценарий Code USP \_ E \_ , \_ не \_ \_ находящийся в Font или S \_ , с выходными данными, содержащими отсутствующие глифы, выберите символы из другого шрифта.</span><span class="sxs-lookup"><span data-stu-id="4376a-163">If [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) returns the code USP\_E\_SCRIPT\_NOT\_IN\_FONT or S\_OK with the output containing missing glyphs, select characters from a different font.</span></span> <span data-ttu-id="4376a-164">Либо замените другим шрифтом, либо отключите формирование, установив элемент **ескрипт** структуры [**\_ анализа скриптов**](/windows/win32/api/usp10/ns-usp10-script_analysis) , ПЕРЕдаваемой в **скриптшапе** в скрипт \_ undefine.</span><span class="sxs-lookup"><span data-stu-id="4376a-164">Either substitute another font or disable shaping by setting the **eScript** member of the [**SCRIPT\_ANALYSIS**](/windows/win32/api/usp10/ns-usp10-script_analysis) structure passed to **ScriptShape** to SCRIPT\_UNDEFINED.</span></span> <span data-ttu-id="4376a-165">Дополнительные сведения см. [в разделе Использование отката шрифта](using-font-fallback.md).</span><span class="sxs-lookup"><span data-stu-id="4376a-165">For more information, see [Using Font Fallback](using-font-fallback.md).</span></span>
8.  <span data-ttu-id="4376a-166">Вызовите [**скриптплаце**](/windows/desktop/api/Usp10/nf-usp10-scriptplace) , чтобы создать значения [ширины](uniscribe-glossary.md) и позиции x и y для глифов в каждом последовательном диапазоне.</span><span class="sxs-lookup"><span data-stu-id="4376a-166">Call [**ScriptPlace**](/windows/desktop/api/Usp10/nf-usp10-scriptplace) to generate [advance widths](uniscribe-glossary.md) and x and y positions for the glyphs in each successive range.</span></span> <span data-ttu-id="4376a-167">Это первый шаг, для которого будет учитываться размер текста.</span><span class="sxs-lookup"><span data-stu-id="4376a-167">This is the first step for which text size becomes a consideration.</span></span>
9.  <span data-ttu-id="4376a-168">Суммировать Размеры диапазонов до тех пор, пока не будет переполняется строка.</span><span class="sxs-lookup"><span data-stu-id="4376a-168">Sum the range sizes until the line overflows.</span></span>
10. <span data-ttu-id="4376a-169">Разбейте диапазон на границе слова с помощью членов **фсофтбреак** и **фвхитеспаце** в логических атрибутах.</span><span class="sxs-lookup"><span data-stu-id="4376a-169">Break the range on a word boundary by using the **fSoftBreak** and **fWhiteSpace** members in the logical attributes.</span></span> <span data-ttu-id="4376a-170">Чтобы разбить один кластер символов за пределы выполнения, используйте сведения, возвращаемые при вызове [**скриптбреак**](/windows/desktop/api/Usp10/nf-usp10-scriptbreak).</span><span class="sxs-lookup"><span data-stu-id="4376a-170">To break a single character cluster off the run, use the information returned by calling [**ScriptBreak**](/windows/desktop/api/Usp10/nf-usp10-scriptbreak).</span></span>
    > [!Note]  
    > <span data-ttu-id="4376a-171">Определите, должна ли первая кодовая точка диапазона быть точкой останова по словам, так как это требуется для последнего символа предыдущего диапазона.</span><span class="sxs-lookup"><span data-stu-id="4376a-171">Decide if the first code point of a range should be a word break point because the last character of the previous range requires it.</span></span> <span data-ttu-id="4376a-172">Например, если один диапазон заканчивается запятой, рассмотрим первый символ следующего диапазона, который будет точкой разрыва слова.</span><span class="sxs-lookup"><span data-stu-id="4376a-172">For example, if one range ends in a comma, consider the first character of the next range to be a word break point.</span></span>

     

11. <span data-ttu-id="4376a-173">Повторите шаги с 6 по 10 для каждой строки в абзаце.</span><span class="sxs-lookup"><span data-stu-id="4376a-173">Repeat steps 6 through 10 for each line in the paragraph.</span></span> <span data-ttu-id="4376a-174">Однако при прерывании последнего выполнения в строке вызовите [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) , чтобы изменить форму оставшейся части выполнения, как первый запуск на следующей строке.</span><span class="sxs-lookup"><span data-stu-id="4376a-174">However, if breaking the last run on the line, call [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) to reshape the remaining part of the run as the first run on the next line.</span></span>

## <a name="display-text-using-uniscribe"></a><span data-ttu-id="4376a-175">Отображение текста с помощью Uniscribe</span><span class="sxs-lookup"><span data-stu-id="4376a-175">Display Text Using Uniscribe</span></span>

<span data-ttu-id="4376a-176">Чтобы отобразить текстовый абзац, приложение может выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="4376a-176">Your application can use the following steps to display a text paragraph.</span></span> <span data-ttu-id="4376a-177">В этой процедуре предполагается, что приложение уже разработало текст и не сохранило глифы и позиции из процесса макета.</span><span class="sxs-lookup"><span data-stu-id="4376a-177">This procedure assumes that the application has already laid out the text and has not saved the glyphs and positions from the layout process.</span></span> <span data-ttu-id="4376a-178">Если важна скорость, приложение может сохранить глифы и позиции из процедуры макета и начать с шага 2 в процедуре вывода.</span><span class="sxs-lookup"><span data-stu-id="4376a-178">If speed is a concern, the application can save the glyphs and positions from the layout procedure and start at step 2 in the display procedure.</span></span>

> [!Note]  
> <span data-ttu-id="4376a-179">Приложение может опустить шаг 2, если текст не содержит символов из скриптов с направлением справа налево, не содержит двунаправленных управляющих символов и использует уровень внедрения слева направо.</span><span class="sxs-lookup"><span data-stu-id="4376a-179">The application can omit step 2 if the text contains no characters from right-to-left scripts, contains no bidirectional control characters, and uses a left-to-right base embedding level.</span></span>

 

1.  <span data-ttu-id="4376a-180">Для каждого запуска выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="4376a-180">For each run, do the following:</span></span>
    1.  <span data-ttu-id="4376a-181">Если стиль изменился с момента последнего запуска, обновите его до контекста устройства, отпустив и повторно получая его.</span><span class="sxs-lookup"><span data-stu-id="4376a-181">If the style has changed since the last run, update the handle to the device context by releasing and getting it again.</span></span>
    2.  <span data-ttu-id="4376a-182">Вызовите [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) , чтобы создать глифы для запуска.</span><span class="sxs-lookup"><span data-stu-id="4376a-182">Call [**ScriptShape**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) to generate glyphs for the run.</span></span>
    3.  <span data-ttu-id="4376a-183">Вызовите [**скриптплаце**](/windows/desktop/api/Usp10/nf-usp10-scriptplace) , чтобы создать предварительную ширину и смещение x, y для каждого глифа.</span><span class="sxs-lookup"><span data-stu-id="4376a-183">Call [**ScriptPlace**](/windows/desktop/api/Usp10/nf-usp10-scriptplace) to generate an advance width and an x,y offset for each glyph.</span></span>
2.  <span data-ttu-id="4376a-184">Выполните следующие действия, чтобы установить правильный порядок отображения для выполнения в строке:</span><span class="sxs-lookup"><span data-stu-id="4376a-184">Do the following to establish the correct visual order for the runs in the line:</span></span>
    1.  <span data-ttu-id="4376a-185">Извлечение массива уровней двунаправленного [внедрения](uniscribe-glossary.md), по одному на диапазон.</span><span class="sxs-lookup"><span data-stu-id="4376a-185">Extract an array of bidirectional [embedding levels](uniscribe-glossary.md), one per range.</span></span> <span data-ttu-id="4376a-186">Уровень внедрения предоставляется (элемент СКРИПТа \_ ) si. ( \_Анализ скриптов) a.</span><span class="sxs-lookup"><span data-stu-id="4376a-186">The embedding level is given by (SCRIPT\_ITEM) si.(SCRIPT\_ANALYSIS) a.</span></span> <span data-ttu-id="4376a-187">(Скрипт \_ STATE) s. Убидилевел.</span><span class="sxs-lookup"><span data-stu-id="4376a-187">(SCRIPT\_STATE) s.uBidiLevel.</span></span>
    2.  <span data-ttu-id="4376a-188">Передайте этот массив в [**скриптлайаут**](/windows/desktop/api/Usp10/nf-usp10-scriptlayout) , чтобы создать карту визуальных позиций для логических позиций.</span><span class="sxs-lookup"><span data-stu-id="4376a-188">Pass this array to [**ScriptLayout**](/windows/desktop/api/Usp10/nf-usp10-scriptlayout) to generate a map of visual positions to logical positions.</span></span>
3.  <span data-ttu-id="4376a-189">Используемых Чтобы выровнять текст, либо вызовите [**скриптжустифи**](/windows/desktop/api/Usp10/nf-usp10-scriptjustify) , либо воспользуйтесь специальными знаниями о тексте.</span><span class="sxs-lookup"><span data-stu-id="4376a-189">(Optional) To justify the text, either call [**ScriptJustify**](/windows/desktop/api/Usp10/nf-usp10-scriptjustify) or use specialized knowledge of the text.</span></span>
4.  <span data-ttu-id="4376a-190">Используйте карту "Visual-to-logical" для отображения выполнения в визуальном порядке.</span><span class="sxs-lookup"><span data-stu-id="4376a-190">Use the visual-to-logical map to display the runs in visual order.</span></span> <span data-ttu-id="4376a-191">Начиная с левого конца строки вызовите [**скрипттекстаут**](/windows/desktop/api/Usp10/nf-usp10-scripttextout) , чтобы отобразить выполнение, заданное первой записью в сопоставлении.</span><span class="sxs-lookup"><span data-stu-id="4376a-191">Starting at the left end of the line, call [**ScriptTextOut**](/windows/desktop/api/Usp10/nf-usp10-scripttextout) to display the run given by the first entry in the map.</span></span> <span data-ttu-id="4376a-192">Для каждой последующей записи на карте вызовите **скрипттекстаут** , чтобы отобразить указанный запуск справа от ранее отображаемого запуска.</span><span class="sxs-lookup"><span data-stu-id="4376a-192">For each subsequent entry in the map, call **ScriptTextOut** to display the indicated run to the right of the previously displayed run.</span></span>

    <span data-ttu-id="4376a-193">Если опустить шаг 2, начните с левого конца строки и вызовите [**скрипттекстаут**](/windows/desktop/api/Usp10/nf-usp10-scripttextout) , чтобы отобразить первый логический запуск, а затем для вывода каждого логического запуска справа от предыдущего запуска.</span><span class="sxs-lookup"><span data-stu-id="4376a-193">If omitting step 2, start at the left end of the line and call [**ScriptTextOut**](/windows/desktop/api/Usp10/nf-usp10-scripttextout) to display the first logical run, and then to display each logical run to the right of the previous run.</span></span>

5.  <span data-ttu-id="4376a-194">Повторите приведенные выше шаги для всех строк в абзаце.</span><span class="sxs-lookup"><span data-stu-id="4376a-194">Repeat the steps above for all lines in the paragraph.</span></span>

## <a name="related-topics"></a><span data-ttu-id="4376a-195">См. также</span><span class="sxs-lookup"><span data-stu-id="4376a-195">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4376a-196">Использование Uniscribe</span><span class="sxs-lookup"><span data-stu-id="4376a-196">Using Uniscribe</span></span>](using-uniscribe.md)
</dt> </dl>

 

 
