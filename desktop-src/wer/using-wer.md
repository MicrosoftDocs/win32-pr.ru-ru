---
title: Использование WER
description: Начиная с Windows Vista, Windows предоставляет отчеты о сбоях, неответе и сбоях ядра по умолчанию, не требуя внесения изменений в приложение.
ms.assetid: c096cd89-e3a7-4959-a35f-40e6168f277e
keywords:
- Отчеты об ошибках Windows отчетов об ошибках Windows, использование
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 655bed6d11757d7d4e08cd00ac47479e1246f96b
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "104412779"
---
# <a name="using-wer"></a><span data-ttu-id="44b65-104">Использование WER</span><span class="sxs-lookup"><span data-stu-id="44b65-104">Using WER</span></span>

<span data-ttu-id="44b65-105">Начиная с Windows Vista, Windows предоставляет отчеты о сбоях, неответе и сбоях ядра по умолчанию, не требуя внесения изменений в приложение.</span><span class="sxs-lookup"><span data-stu-id="44b65-105">Beginning with Windows Vista, Windows provides crash, non-response, and kernel fault error reporting by default without requiring changes to your application.</span></span> <span data-ttu-id="44b65-106">При необходимости отчет будет содержать сведения дампа минидампа и кучи.</span><span class="sxs-lookup"><span data-stu-id="44b65-106">The report will include minidump and heap dump information if required.</span></span> <span data-ttu-id="44b65-107">Вместо этого приложения используют API WER для отправки отчетов о проблемах, связанных с приложениями, в корпорацию Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="44b65-107">Applications instead use the WER API to send application-specific problem reports to Microsoft.</span></span>

<span data-ttu-id="44b65-108">Так как Windows автоматически сообщает о необработанных исключениях, приложение не должно обрабатывать неустранимые исключения.</span><span class="sxs-lookup"><span data-stu-id="44b65-108">Because Windows automatically reports unhandled exceptions, application should not handle fatal exceptions.</span></span> <span data-ttu-id="44b65-109">Если процесс сбоя или неотвечающего процесса является интерактивным, WER отображает пользовательский интерфейс, уведомляющий пользователя о проблеме.</span><span class="sxs-lookup"><span data-stu-id="44b65-109">If the faulting or not-responding process is interactive, WER displays a user interface informing the user of the problem.</span></span> <span data-ttu-id="44b65-110">Приложение считается неотвечающим, если оно не реагирует на сообщения Windows в течение пяти секунд, пока пользователь пытается взаимодействовать с приложением.</span><span class="sxs-lookup"><span data-stu-id="44b65-110">An application is considered unresponsive if it does not respond to Windows messages for five seconds while the user is trying to interact with the application.</span></span>

## <a name="windows-error-reporting-flow-for-crashes-non-response-and-kernel-faults"></a><span data-ttu-id="44b65-111">Поток отчеты об ошибках Windows для сбоев, нереагирования и сбоев ядра</span><span class="sxs-lookup"><span data-stu-id="44b65-111">Windows Error Reporting flow for crashes, non-response, and kernel faults</span></span>

<span data-ttu-id="44b65-112">Ниже показаны действия, выполняемые для сбоев приложения, нереагирования или сбоя ядра.</span><span class="sxs-lookup"><span data-stu-id="44b65-112">The following shows the steps that occur for an application crash, non-response, or kernel fault.</span></span>

1.  <span data-ttu-id="44b65-113">Происходит событие проблемы.</span><span class="sxs-lookup"><span data-stu-id="44b65-113">The problem event occurs.</span></span>
2.  <span data-ttu-id="44b65-114">Операционная система вызывает WER.</span><span class="sxs-lookup"><span data-stu-id="44b65-114">The operating system invokes WER.</span></span>
3.  <span data-ttu-id="44b65-115">WER собирает данные, создает отчет и запрашивает у пользователя разрешение (при необходимости).</span><span class="sxs-lookup"><span data-stu-id="44b65-115">WER collects the data, builds a report, and prompts the user for consent (if needed).</span></span>
4.  <span data-ttu-id="44b65-116">WER отправляет отчет в корпорацию Майкрософт (сервер Watson), если он был отправлен.</span><span class="sxs-lookup"><span data-stu-id="44b65-116">WER sends the report to Microsoft (Watson Server) if the user consented.</span></span>
5.  <span data-ttu-id="44b65-117">Если сервер Watson запрашивает дополнительные данные, то средство WER собирает данные и запрашивает у пользователя разрешение (при необходимости).</span><span class="sxs-lookup"><span data-stu-id="44b65-117">If the Watson server requests additional data, WER collects the data and prompts the user for consent (if needed).</span></span>
6.  <span data-ttu-id="44b65-118">Если приложение зарегистрировано для восстановления и перезапуска, то программа WER выполняет зарегистрированные функции обратного вызова, пока данные сжимаются и отправляются в корпорацию Майкрософт (если пользователь не отправлял).</span><span class="sxs-lookup"><span data-stu-id="44b65-118">If the application has registered for recovery and restart, WER executes the registered callback functions while the data is compressed and sent to Microsoft (if the user consented).</span></span>
7.  <span data-ttu-id="44b65-119">Если в корпорации Майкрософт есть ответ на проблему, пользователь получает уведомления.</span><span class="sxs-lookup"><span data-stu-id="44b65-119">If a response to the problem is available from Microsoft, the user is notified.</span></span>

<span data-ttu-id="44b65-120">Приложения могут использовать следующие функции для настройки содержимого отчета, отправляемого в корпорацию Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="44b65-120">Applications can use the following functions to customize the contents of the report that is sent to Microsoft.</span></span> <span data-ttu-id="44b65-121">Функции регистрации сообщают о том, что в отчете об ошибках, создаваемых, включаются определенные файлы и блоки памяти.</span><span class="sxs-lookup"><span data-stu-id="44b65-121">The registration functions tell WER to include the specific files and memory blocks in the error report that it creates.</span></span>

-   [<span data-ttu-id="44b65-122">**веррегистерфиле**</span><span class="sxs-lookup"><span data-stu-id="44b65-122">**WerRegisterFile**</span></span>](/windows/desktop/api/Werapi/nf-werapi-werregisterfile)
-   [<span data-ttu-id="44b65-123">**веррегистермемориблокк**</span><span class="sxs-lookup"><span data-stu-id="44b65-123">**WerRegisterMemoryBlock**</span></span>](/windows/desktop/api/Werapi/nf-werapi-werregistermemoryblock)
-   [<span data-ttu-id="44b65-124">**версетфлагс**</span><span class="sxs-lookup"><span data-stu-id="44b65-124">**WerSetFlags**</span></span>](/windows/desktop/api/Werapi/nf-werapi-wersetflags)
-   [<span data-ttu-id="44b65-125">**верунрегистерфиле**</span><span class="sxs-lookup"><span data-stu-id="44b65-125">**WerUnregisterFile**</span></span>](/windows/desktop/api/Werapi/nf-werapi-werunregisterfile)
-   [<span data-ttu-id="44b65-126">**верунрегистермемориблокк**</span><span class="sxs-lookup"><span data-stu-id="44b65-126">**WerUnregisterMemoryBlock**</span></span>](/windows/desktop/api/Werapi/nf-werapi-werunregistermemoryblock)
-   [<span data-ttu-id="44b65-127">**вержетфлагс**</span><span class="sxs-lookup"><span data-stu-id="44b65-127">**WerGetFlags**</span></span>](/windows/desktop/api/Werapi/nf-werapi-wergetflags)

## <a name="windows-error-reporting-flow-for-generic-event-reporting"></a><span data-ttu-id="44b65-128">Поток отчеты об ошибках Windows для отчетов об универсальных событиях</span><span class="sxs-lookup"><span data-stu-id="44b65-128">Windows Error Reporting flow for generic event reporting</span></span>

<span data-ttu-id="44b65-129">Следующие шаги показывают, как приложения могут получить отчет об ошибке для некритической ошибки.</span><span class="sxs-lookup"><span data-stu-id="44b65-129">The following steps show how applications can get an error report for a non-fatal error condition.</span></span>

1.  <span data-ttu-id="44b65-130">Возникло некритическое событие проблемы.</span><span class="sxs-lookup"><span data-stu-id="44b65-130">The non-fatal problem event occurs.</span></span>
2.  <span data-ttu-id="44b65-131">Приложение распознает событие и использует следующую последовательность вызовов функций для создания отчета.</span><span class="sxs-lookup"><span data-stu-id="44b65-131">The application recognizes the event and uses the following sequence of function calls to generate the report.</span></span>
    1.  <span data-ttu-id="44b65-132">Чтобы создать отчет, вызовите функцию [**веррепорткреате**](/windows/desktop/api/Werapi/nf-werapi-werreportcreate) .</span><span class="sxs-lookup"><span data-stu-id="44b65-132">Call the [**WerReportCreate**](/windows/desktop/api/Werapi/nf-werapi-werreportcreate) function to create the report.</span></span>
    2.  <span data-ttu-id="44b65-133">Вызовите функцию [**веррепортсетпараметер**](/windows/desktop/api/Werapi/nf-werapi-werreportsetparameter) , чтобы задать параметры отчета.</span><span class="sxs-lookup"><span data-stu-id="44b65-133">Call the [**WerReportSetParameter**](/windows/desktop/api/Werapi/nf-werapi-werreportsetparameter) function to set the report parameters.</span></span>
    3.  <span data-ttu-id="44b65-134">Вызовите функцию [**веррепортаддфиле**](/windows/desktop/api/Werapi/nf-werapi-werreportaddfile) , чтобы добавить файлы в отчет.</span><span class="sxs-lookup"><span data-stu-id="44b65-134">Call the [**WerReportAddFile**](/windows/desktop/api/Werapi/nf-werapi-werreportaddfile) function to add files to the report.</span></span>
    4.  <span data-ttu-id="44b65-135">Вызовите функцию [**веррепортадддумп**](/windows/desktop/api/Werapi/nf-werapi-werreportadddump) , чтобы добавить в отчет Малый дамп (при необходимости).</span><span class="sxs-lookup"><span data-stu-id="44b65-135">Call the [**WerReportAddDump**](/windows/desktop/api/Werapi/nf-werapi-werreportadddump) function to add a minidump to the report (if needed).</span></span>
    5.  <span data-ttu-id="44b65-136">Чтобы отправить отчет, вызовите функцию [**веррепортсубмит**](/windows/desktop/api/Werapi/nf-werapi-werreportsubmit) .</span><span class="sxs-lookup"><span data-stu-id="44b65-136">Call the [**WerReportSubmit**](/windows/desktop/api/Werapi/nf-werapi-werreportsubmit) function to send the report.</span></span>
    6.  <span data-ttu-id="44b65-137">Вызовите [**веррепортклосехандле**](/windows/desktop/api/Werapi/nf-werapi-werreportclosehandle) , чтобы освободить ресурсы.</span><span class="sxs-lookup"><span data-stu-id="44b65-137">Call the [**WerReportCloseHandle**](/windows/desktop/api/Werapi/nf-werapi-werreportclosehandle) to free resources.</span></span>
3.  <span data-ttu-id="44b65-138">В зависимости от конкретных параметров, используемых при вызове функций на шаге 2, WER завершает отчеты об ошибках.</span><span class="sxs-lookup"><span data-stu-id="44b65-138">Depending on the specific options used when calling the functions in step 2, WER will finish the error reporting.</span></span> <span data-ttu-id="44b65-139">WER гарантирует, что отчеты будут выполняться в соответствии с политиками, установленными пользователем.</span><span class="sxs-lookup"><span data-stu-id="44b65-139">WER will ensure that the reporting is done in accordance with the policies set by the user.</span></span> <span data-ttu-id="44b65-140">Например, WER отправит отчет в корпорацию Майкрософт, поставит в очередь отчет и отобразит соответствующие пользовательские интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="44b65-140">For example, WER will send the report to Microsoft, queue the report, and show the appropriate user interfaces to the user.</span></span>

## <a name="excluding-an-application-from-windows-error-reporting"></a><span data-ttu-id="44b65-141">Исключение приложения из отчеты об ошибках Windows</span><span class="sxs-lookup"><span data-stu-id="44b65-141">Excluding an application from Windows Error Reporting</span></span>

<span data-ttu-id="44b65-142">Чтобы исключить приложение из отчетов об ошибках Windows, используйте функцию [**вераддексклудедаппликатион**](/windows/desktop/api/Werapi/nf-werapi-weraddexcludedapplication) .</span><span class="sxs-lookup"><span data-stu-id="44b65-142">To exclude your application from Windows error reporting, use the [**WerAddExcludedApplication**](/windows/desktop/api/Werapi/nf-werapi-weraddexcludedapplication) function.</span></span> <span data-ttu-id="44b65-143">Чтобы восстановить отчеты об ошибках для приложения, используйте функцию [**верремовиксклудедаппликатион**](/windows/desktop/api/Werapi/nf-werapi-werremoveexcludedapplication) .</span><span class="sxs-lookup"><span data-stu-id="44b65-143">To restore error reporting for your application, use the [**WerRemoveExcludedApplication**](/windows/desktop/api/Werapi/nf-werapi-werremoveexcludedapplication) function.</span></span>

## <a name="automatically-recovering-data-and-restarting-a-faulted-application"></a><span data-ttu-id="44b65-144">Автоматическое восстановление данных и перезапуск сбойного приложения</span><span class="sxs-lookup"><span data-stu-id="44b65-144">Automatically recovering data and restarting a faulted application</span></span>

<span data-ttu-id="44b65-145">Приложение может использовать восстановление и перезагрузку приложения, чтобы сохранить данные и сведения о состоянии до завершения работы приложения из-за необработанного исключения или зависания приложения.</span><span class="sxs-lookup"><span data-stu-id="44b65-145">An application can use Application Recovery and Restart to save data and state information before the application exits due to an unhandled exception or when the application stops responding.</span></span> <span data-ttu-id="44b65-146">При запросе приложение также перезапускается.</span><span class="sxs-lookup"><span data-stu-id="44b65-146">The application is also restarted, if requested.</span></span> <span data-ttu-id="44b65-147">Дополнительные сведения см. в разделе [Восстановление приложений и перезапуск](/windows/desktop/Recovery/application-recovery-and-restart-portal).</span><span class="sxs-lookup"><span data-stu-id="44b65-147">For details, see [Application Recovery and Restart](/windows/desktop/Recovery/application-recovery-and-restart-portal).</span></span>

## <a name="legacy-api"></a><span data-ttu-id="44b65-148">Устаревший API</span><span class="sxs-lookup"><span data-stu-id="44b65-148">Legacy API</span></span>

<span data-ttu-id="44b65-149">Приложение может сообщить об ошибке, вызвав функцию [**репортфаулт**](/windows/desktop/api/ErrorRep/nf-errorrep-reportfault) .</span><span class="sxs-lookup"><span data-stu-id="44b65-149">An application can report a fault by calling the [**ReportFault**](/windows/desktop/api/ErrorRep/nf-errorrep-reportfault) function.</span></span> <span data-ttu-id="44b65-150">Однако не следует использовать функцию **репортфаулт** , если нет особой необходимости в том, что поведение по умолчанию для отчетов об ошибках операционной системы не может быть удовлетворено.</span><span class="sxs-lookup"><span data-stu-id="44b65-150">However, you should not use the **ReportFault** function unless you have a very specific requirement that the operating system's default error reporting behavior cannot fulfill.</span></span>

<span data-ttu-id="44b65-151">Если включен отчет об ошибках, система отображает диалоговое окно, указывающее, что приложение столкнулось с проблемой и будет закрыто.</span><span class="sxs-lookup"><span data-stu-id="44b65-151">If error reporting is enabled, the system displays a dialog box to the user indicating that the application has encountered a problem and will close.</span></span> <span data-ttu-id="44b65-152">При наличии отладчика, настроенного в разделе **" \_ \_ программное обеспечение на локальном компьютере" \\ программы hKey \\ Microsoft \\ Windows NT \\ CurrentVersion \\ аедебуг** , пользователю предоставляется возможность запустить отладчик.</span><span class="sxs-lookup"><span data-stu-id="44b65-152">If there is a debugger configured in the **HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AeDebug** key, the user is given the option to launch the debugger.</span></span> <span data-ttu-id="44b65-153">Пользователю также предоставляется возможность отправить отчет в корпорацию Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="44b65-153">The user is also given the option to send a report to Microsoft.</span></span> <span data-ttu-id="44b65-154">Если пользователь отправляет отчет, система отображает еще одно диалоговое окно, которое составило пользователя для отчета и предоставляет ссылку на дополнительные сведения.</span><span class="sxs-lookup"><span data-stu-id="44b65-154">If the user sends the report, the system displays another dialog box thanking the user for the report and providing a link to more information.</span></span>

<span data-ttu-id="44b65-155">Система отчетов об ошибках поддерживает следующие режимы работы.</span><span class="sxs-lookup"><span data-stu-id="44b65-155">The error reporting system supports the following operation modes.</span></span>



| <span data-ttu-id="44b65-156">Режим работы</span><span class="sxs-lookup"><span data-stu-id="44b65-156">Operation mode</span></span>          | <span data-ttu-id="44b65-157">Описание</span><span class="sxs-lookup"><span data-stu-id="44b65-157">Description</span></span>                                                                                                                                                                                                                                                                                                                                  |
|-------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="44b65-158">Отчеты о общей памяти</span><span class="sxs-lookup"><span data-stu-id="44b65-158">Shared memory reporting</span></span> | <span data-ttu-id="44b65-159">Если контекст безопасности приложения совпадает с контекстом безопасности вошедшего в систему пользователя, система отчетов об ошибках использует блок общей памяти для обмена данными.</span><span class="sxs-lookup"><span data-stu-id="44b65-159">If the application's security context is the same as the security context of the logged-on user, the error reporting system uses a block of shared memory for communication.</span></span> <span data-ttu-id="44b65-160">Этот режим нельзя использовать с режимом создания отчетов манифеста.</span><span class="sxs-lookup"><span data-stu-id="44b65-160">This mode cannot be used with manifest reporting mode.</span></span><br/>                                                                                               |
| <span data-ttu-id="44b65-161">Отчеты о манифестах</span><span class="sxs-lookup"><span data-stu-id="44b65-161">Manifest reporting</span></span>      | <span data-ttu-id="44b65-162">Если контекст безопасности приложения не совпадает с контекстом безопасности вошедшего в систему пользователя, система отчетов об ошибках использует файл для обмена данными.</span><span class="sxs-lookup"><span data-stu-id="44b65-162">If the application's security context is not the same as the security context of the logged-on user, the error reporting system uses a file for communication.</span></span> <span data-ttu-id="44b65-163">Этот режим также используется для создания отчетов о неотвечающих приложениях и сбоях ядра.</span><span class="sxs-lookup"><span data-stu-id="44b65-163">This mode is also used for reporting unresponsive applications and kernel faults.</span></span> <span data-ttu-id="44b65-164">Этот режим нельзя использовать с режимом создания отчетов общей памяти.</span><span class="sxs-lookup"><span data-stu-id="44b65-164">This mode cannot be used with shared memory reporting mode.</span></span><br/>                      |
| <span data-ttu-id="44b65-165">Отчеты в Интернете</span><span class="sxs-lookup"><span data-stu-id="44b65-165">Internet reporting</span></span>      | <span data-ttu-id="44b65-166">Система отчетов об ошибках отправляет все данные в корпорацию Майкрософт через Интернет.</span><span class="sxs-lookup"><span data-stu-id="44b65-166">The error reporting system sends all data to Microsoft through the Internet.</span></span> <span data-ttu-id="44b65-167">Это режим работы по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="44b65-167">This is the default mode of operation.</span></span> <span data-ttu-id="44b65-168">Его нельзя использовать с корпоративным режимом отчетов.</span><span class="sxs-lookup"><span data-stu-id="44b65-168">It cannot be used with corporate reporting mode.</span></span> <span data-ttu-id="44b65-169">Этот режим используется, если администратор не указал путь передачи Организации.</span><span class="sxs-lookup"><span data-stu-id="44b65-169">This mode is used when there is no corporate upload path specified by the administrator.</span></span><br/>                                                                     |
| <span data-ttu-id="44b65-170">Корпоративные отчеты</span><span class="sxs-lookup"><span data-stu-id="44b65-170">Corporate reporting</span></span>     | <span data-ttu-id="44b65-171">Система отчетов об ошибках отправляет все данные в общую папку, а не передает их непосредственно в корпорацию Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="44b65-171">The error reporting system sends all data to a file share instead of uploading it directly to Microsoft.</span></span> <span data-ttu-id="44b65-172">Это позволяет корпоративным ИТ-менеджерам проверять данные перед их отправкой в корпорацию Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="44b65-172">This allows corporate IT managers to review data before it is sent to Microsoft.</span></span> <span data-ttu-id="44b65-173">Этот режим используется при наличии корпоративного пути передачи, указанного администратором.</span><span class="sxs-lookup"><span data-stu-id="44b65-173">This mode is used when there is a corporate upload path specified by the administrator.</span></span> <span data-ttu-id="44b65-174">Его нельзя использовать с режимом создания отчетов в Интернете.</span><span class="sxs-lookup"><span data-stu-id="44b65-174">It cannot be used with Internet reporting mode.</span></span><br/> |
| <span data-ttu-id="44b65-175">Отчеты без монитора</span><span class="sxs-lookup"><span data-stu-id="44b65-175">Headless reporting</span></span>      | <span data-ttu-id="44b65-176">Система отчетов об ошибках не отображает никаких диалоговых окон для пользователя.</span><span class="sxs-lookup"><span data-stu-id="44b65-176">The error reporting system will not display any dialog boxes to the user.</span></span> <span data-ttu-id="44b65-177">Это позволяет корпоративным ИТ Manager получать отчеты об ошибках от своих сотрудников в любое время.</span><span class="sxs-lookup"><span data-stu-id="44b65-177">This allows corporate IT managers to collect error reports from their employees at all times.</span></span> <span data-ttu-id="44b65-178">Этот режим используется, когда администратор включает отчеты, но уведомление отключено.</span><span class="sxs-lookup"><span data-stu-id="44b65-178">This mode is used when reporting is enabled by the administrator, but notification is disabled.</span></span> <span data-ttu-id="44b65-179">Его можно использовать только в корпоративном режиме отчетов.</span><span class="sxs-lookup"><span data-stu-id="44b65-179">It can be used only with corporate reporting mode.</span></span><br/>        |



 

<span data-ttu-id="44b65-180">Чтобы исключить приложение из отчетов об ошибках, используйте функцию [**аддерексклудедаппликатион**](/windows/desktop/api/ErrorRep/nf-errorrep-adderexcludedapplicationa) .</span><span class="sxs-lookup"><span data-stu-id="44b65-180">To exclude your application from error reporting, use the [**AddERExcludedApplication**](/windows/desktop/api/ErrorRep/nf-errorrep-adderexcludedapplicationa) function.</span></span>

 

