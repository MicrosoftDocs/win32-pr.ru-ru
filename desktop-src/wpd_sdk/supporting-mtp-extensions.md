---
description: Поддержка расширений MTP
ms.assetid: 9e5f3da6-346a-4eca-bc85-2755c569986d
title: Поддержка расширений MTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 898df3f1347af2ccc42a796b480156b6603b13ec
ms.sourcegitcommit: 0f7a8198bacd5493ab1e78a9583c7a3578794765
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/25/2021
ms.locfileid: "110423734"
---
# <a name="supporting-mtp-extensions"></a><span data-ttu-id="1fb46-103">Поддержка расширений MTP</span><span class="sxs-lookup"><span data-stu-id="1fb46-103">Supporting MTP Extensions</span></span>

## <a name="media-transfer-protocol"></a><span data-ttu-id="1fb46-104">Протокол передачи мультимедиа</span><span class="sxs-lookup"><span data-stu-id="1fb46-104">Media Transfer Protocol</span></span>

<span data-ttu-id="1fb46-105">Протокол передачи мультимедиа (MTP) является расширением протокола передачи изображений (PTP).</span><span class="sxs-lookup"><span data-stu-id="1fb46-105">Media Transfer Protocol (MTP) is an extension to the Picture Transfer Protocol (PTP).</span></span> <span data-ttu-id="1fb46-106">В результате все семантики протокола PTP действительны в MTP.</span><span class="sxs-lookup"><span data-stu-id="1fb46-106">As a result, all PTP protocol semantics are valid in MTP.</span></span>

<span data-ttu-id="1fb46-107">MTP взаимодействует с помощью команд и ответов между двумя сторонами, инициатором и респондентом.</span><span class="sxs-lookup"><span data-stu-id="1fb46-107">MTP communicates by using commands and responses between two parties, the initiator and the responder.</span></span> <span data-ttu-id="1fb46-108">Роли вовлеченных устройств четко определены.</span><span class="sxs-lookup"><span data-stu-id="1fb46-108">The roles of the involved devices are very clearly defined.</span></span> <span data-ttu-id="1fb46-109">ПК обычно является инициатором, а устройство всегда является респондентом.</span><span class="sxs-lookup"><span data-stu-id="1fb46-109">The PC typically is the initiator, and the device is always the responder.</span></span> <span data-ttu-id="1fb46-110">Устройство, не являющееся ПК, также может быть инициатором (например, колодой автомобилей или Microsoft X).</span><span class="sxs-lookup"><span data-stu-id="1fb46-110">A non-PC device could also be an initiator (for example, a car deck or a Microsoft X-box).</span></span> <span data-ttu-id="1fb46-111">Устройство не может одновременно предположить обе роли.</span><span class="sxs-lookup"><span data-stu-id="1fb46-111">A device can never assume both roles at the same time.</span></span>

<span data-ttu-id="1fb46-112">Инициатор начинает обмен данными, отправляя команду в ответчик.</span><span class="sxs-lookup"><span data-stu-id="1fb46-112">The initiator starts communication by sending a command to the responder.</span></span> <span data-ttu-id="1fb46-113">Ответчик обрабатывает команду и отправляет соответствующий ответ.</span><span class="sxs-lookup"><span data-stu-id="1fb46-113">The responder processes the command and sends back an appropriate response.</span></span> <span data-ttu-id="1fb46-114">Возможно, имеется фаза данных, связанная с командой.</span><span class="sxs-lookup"><span data-stu-id="1fb46-114">There might be a data phase associated with the command.</span></span> <span data-ttu-id="1fb46-115">В этом случае направление потока данных должно быть известно заранее и принято как инициатором, так и респондентом.</span><span class="sxs-lookup"><span data-stu-id="1fb46-115">If this is the case, the direction of data flow must be known beforehand and accepted by both the initiator and the responder.</span></span> <span data-ttu-id="1fb46-116">Имейте в виду, что отсутствует описательный заголовок, указывающий потоки данных для новых команд.</span><span class="sxs-lookup"><span data-stu-id="1fb46-116">Be aware that there is not a descriptive header that indicates data flows for new commands.</span></span>

<span data-ttu-id="1fb46-117">Ответчик может начать обмен данными независимо от инициатора.</span><span class="sxs-lookup"><span data-stu-id="1fb46-117">The responder can start communication independent of the initiator.</span></span> <span data-ttu-id="1fb46-118">Например, ответчик может отправить события инициатору.</span><span class="sxs-lookup"><span data-stu-id="1fb46-118">For example, the responder can send events to the initiator.</span></span> <span data-ttu-id="1fb46-119">Однако данные не могут быть отправлены вместе с событием.</span><span class="sxs-lookup"><span data-stu-id="1fb46-119">However, no data can be sent together with the event.</span></span> <span data-ttu-id="1fb46-120">При наличии данных, которые необходимо считать частью события, инициатор должен отправить команду MTP, а устройство — отправить данные в ответ на команду.</span><span class="sxs-lookup"><span data-stu-id="1fb46-120">If there is any data that needs to be read as part of the event, the initiator must send an MTP command, and the device can then send data in response to the command.</span></span>

<span data-ttu-id="1fb46-121">Полное описание MTP см. в [спецификации MTP](https://www.usb.org/sites/default/files/MTPv1_1.zip).</span><span class="sxs-lookup"><span data-stu-id="1fb46-121">For a complete description of MTP, refer to the [MTP specification](https://www.usb.org/sites/default/files/MTPv1_1.zip).</span></span>

## <a name="sending-mtp-commands"></a><span data-ttu-id="1fb46-122">Отправка команд MTP</span><span class="sxs-lookup"><span data-stu-id="1fb46-122">Sending MTP Commands</span></span>

<span data-ttu-id="1fb46-123">Приложения могут отсылать команды MTP на устройство, вызывая метод [**ипортабледевице:: сендкомманд**](/windows/desktop/api/PortableDeviceApi/nf-portabledeviceapi-iportabledevice-sendcommand) .</span><span class="sxs-lookup"><span data-stu-id="1fb46-123">Applications can send MTP commands to a device by invoking the [**IPortableDevice::SendCommand**](/windows/desktop/api/PortableDeviceApi/nf-portabledeviceapi-iportabledevice-sendcommand) method.</span></span> <span data-ttu-id="1fb46-124">Отправляемая команда зависит от наличия фазы данных, а также от того, считываются ли какие-либо сопутствующие данные с устройства или записываются на него.</span><span class="sxs-lookup"><span data-stu-id="1fb46-124">The command that is sent depends on whether there is a data phase, and, on whether any accompanying data is read from or written to the device.</span></span> <span data-ttu-id="1fb46-125">В следующей таблице описаны три возможные команды расширения MTP.</span><span class="sxs-lookup"><span data-stu-id="1fb46-125">The following table describes the three possible MTP extension commands.</span></span>

<span data-ttu-id="1fb46-126">Имейте в виду, что эти команды относятся к MTP; и поэтому реализуются только драйвером класса WPD MTP.</span><span class="sxs-lookup"><span data-stu-id="1fb46-126">Be aware that these commands are specific to MTP; and are therefore, only implemented by the WPD MTP class driver.</span></span>



| <span data-ttu-id="1fb46-127">Команда</span><span class="sxs-lookup"><span data-stu-id="1fb46-127">Command</span></span>  | <span data-ttu-id="1fb46-128">Описание</span><span class="sxs-lookup"><span data-stu-id="1fb46-128">Description</span></span>  |
|--------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="1fb46-129">**\_команда WPD \_ , \_ \_ завершающая \_ \_ Перенос данных MTP**</span><span class="sxs-lookup"><span data-stu-id="1fb46-129">**WPD\_COMMAND\_MTP\_EXT\_END\_DATA\_TRANSFER**</span></span>](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-end-data-transfer)                                      | <span data-ttu-id="1fb46-130">Выдает команду MTP, которая сигнализирует о завершении операции чтения или записи данных.</span><span class="sxs-lookup"><span data-stu-id="1fb46-130">Issues an MTP command that signals the conclusion of a data read or write operation.</span></span>              |
| [<span data-ttu-id="1fb46-131">**\_команда WPD \_ , \_ \_ выполняемая \_ командой MTP, \_ без \_ \_ фазы данных**</span><span class="sxs-lookup"><span data-stu-id="1fb46-131">**WPD\_COMMAND\_MTP\_EXT\_EXECUTE\_COMMAND\_WITHOUT\_DATA\_PHASE**</span></span>](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-execute-command-without-data-phase)  | <span data-ttu-id="1fb46-132">Выдает команду MTP без соответствующей фазы данных.</span><span class="sxs-lookup"><span data-stu-id="1fb46-132">Issues an MTP command without a corresponding data phase.</span></span>                                         |
| [<span data-ttu-id="1fb46-133">**\_команда WPD \_ MTP \_ \_ выполнить \_ команду \_ с \_ данными \_ для \_ записи**</span><span class="sxs-lookup"><span data-stu-id="1fb46-133">**WPD\_COMMAND\_MTP\_EXT\_EXECUTE\_COMMAND\_WITH\_DATA\_TO\_WRITE**</span></span>](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-execute-command-with-data-to-write) | <span data-ttu-id="1fb46-134">Выдает команду MTP, за которой следуют прилагаемые данные, которые будут записаны на устройство.</span><span class="sxs-lookup"><span data-stu-id="1fb46-134">Issues an MTP command that is followed by accompanying data, which will be written to the device.</span></span> |
| [<span data-ttu-id="1fb46-135">**\_команда WPD \_ MTP \_ \_ Execute \_ команда \_ с \_ данными \_ для \_ чтения**</span><span class="sxs-lookup"><span data-stu-id="1fb46-135">**WPD\_COMMAND\_MTP\_EXT\_EXECUTE\_COMMAND\_WITH\_DATA\_TO\_READ**</span></span>](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-execute-command-with-data-to-read)   | <span data-ttu-id="1fb46-136">Выдает команду MTP, за которой следуют прилагаемые данные, которые считываются с устройства.</span><span class="sxs-lookup"><span data-stu-id="1fb46-136">Issues an MTP command that is followed by accompanying data, which is read from the device.</span></span>       |
| [<span data-ttu-id="1fb46-137">**\_команда WPD \_ MTP \_ \_ Read \_ Data**</span><span class="sxs-lookup"><span data-stu-id="1fb46-137">**WPD\_COMMAND\_MTP\_EXT\_READ\_DATA**</span></span>](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-read-data)                                                       | <span data-ttu-id="1fb46-138">Выдает команду MTP, которая отправляет данные с устройства на компьютер.</span><span class="sxs-lookup"><span data-stu-id="1fb46-138">Issues an MTP command that sends data from the device to the PC.</span></span>                                  |
| [<span data-ttu-id="1fb46-139">**\_команда WPD \_ MTP \_ ext \_ Write \_ Data**</span><span class="sxs-lookup"><span data-stu-id="1fb46-139">**WPD\_COMMAND\_MTP\_EXT\_WRITE\_DATA**</span></span>](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-write-data)                                                     | <span data-ttu-id="1fb46-140">Выдает команду MTP, которая отправляет данные на устройство с компьютера.</span><span class="sxs-lookup"><span data-stu-id="1fb46-140">Issues an MTP command that sends data to the device from the PC.</span></span>                                  |



 

<span data-ttu-id="1fb46-141">Независимо от этапа, необходимо указать **\_ свойство WPD \_ для \_ \_ \_ кода операции MTP** и **Свойства WPD в \_ \_ \_ \_ \_ параметрах операции MTP** .</span><span class="sxs-lookup"><span data-stu-id="1fb46-141">Regardless of the phase, **WPD\_PROPERTY\_MTP\_EXT\_OPERATION\_CODE** and **WPD\_PROPERTY\_MTP\_EXT\_OPERATION\_PARAMS** must be specified.</span></span>

<span data-ttu-id="1fb46-142">Если драйверу MTP удалось отправить команду на устройство, возвращаемые значения всегда будут содержать **свойство WPD с \_ \_ \_ \_ \_ кодом ответа MTP**.</span><span class="sxs-lookup"><span data-stu-id="1fb46-142">If the MTP driver was able to send the command to the device, the return values will always contain **WPD\_PROPERTY\_MTP\_EXT\_RESPONSE\_CODE**.</span></span> <span data-ttu-id="1fb46-143">Если код ответа указывает на успешное выполнение и если семантика команды допускает параметры ответа, то также будут доступны **Свойства WPD для \_ \_ \_ \_ ответов \_ MTP ext** .</span><span class="sxs-lookup"><span data-stu-id="1fb46-143">If the response code indicates success and if the semantics of the command allow for response parameters, **WPD\_PROPERTY\_MTP\_EXT\_RESPONSE\_PARAMS** will also be available.</span></span>

## <a name="related-topics"></a><span data-ttu-id="1fb46-144">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="1fb46-144">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="1fb46-145">**Инструкции по программированию**</span><span class="sxs-lookup"><span data-stu-id="1fb46-145">**Programming Guide**</span></span>](programming-guide.md)
</dt> </dl>

 

 
