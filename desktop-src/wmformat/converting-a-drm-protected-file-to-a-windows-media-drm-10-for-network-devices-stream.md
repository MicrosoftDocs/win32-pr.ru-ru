---
title: Преобразование файла DRM-Protected в поток Windows Media DRM 10 для сетевых устройств
description: Преобразование файла DRM-Protected в поток Windows Media DRM 10 для сетевых устройств
ms.assetid: 11aa0cfd-6d87-4ec4-82d8-db2507402911
keywords:
- Windows Media Format SDK, преобразование файлов, защищенных с использованием DRM
- Windows Media Format SDK, файлы, защищенные с использованием DRM
- Расширенный формат систем (ASF), преобразование файлов, защищенных с использованием DRM
- ASF (Расширенный системный формат), преобразование файлов, защищенных с использованием DRM
- Расширенный формат систем (ASF), файлы, защищенные с использованием DRM
- ASF (Расширенный системный формат), файлы, защищенные с использованием DRM
- Управление цифровыми правами (DRM), преобразование файлов, защищенных с использованием DRM
- DRM (Управление цифровыми правами), преобразование файлов, защищенных с использованием DRM
- Управление цифровыми правами (DRM), файлы, защищенные с использованием DRM
- DRM (Управление цифровыми правами), файлы, защищенные с использованием DRM
- Windows Media Format SDK, Windows Media DRM 10 для сетевых устройств
- Windows Media Format SDK, DRM 10 для сетевых устройств
- Расширенный формат систем (ASF), Windows Media DRM 10 для сетевых устройств
- ASF (Расширенный системный формат), Windows Media DRM 10 для сетевых устройств
- Расширенный формат систем (ASF), DRM 10 для сетевых устройств
- ASF (Расширенный системный формат), DRM 10 для сетевых устройств
- Управление цифровыми правами (DRM), Windows Media DRM 10 для сетевых устройств
- DRM (Управление цифровыми правами), Windows Media DRM 10 для сетевых устройств
- Управление цифровыми правами (DRM), DRM 10 для сетевых устройств
- DRM (Управление цифровыми правами), DRM 10 для сетевых устройств
- Windows Media DRM 10 для сетевых устройств, преобразование файлов, защищенных с использованием DRM
- DRM 10 для сетевых устройств, преобразование файлов, защищенных с использованием DRM
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 644c1b4f7ede688434fbb1dde11b7051c6f644a5
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "103788839"
---
# <a name="converting-a-drm-protected-file-to-a-windows-media-drm-10-for-network-devices-stream"></a><span data-ttu-id="8922a-125">Преобразование файла DRM-Protected в поток Windows Media DRM 10 для сетевых устройств</span><span class="sxs-lookup"><span data-stu-id="8922a-125">Converting a DRM-Protected File to a Windows Media DRM 10 for Network Devices Stream</span></span>

<span data-ttu-id="8922a-126">После регистрации и проверки устройства можно начать обработку сообщений с запросами лицензий.</span><span class="sxs-lookup"><span data-stu-id="8922a-126">After a device is registered and validated, you can begin processing license request messages from it.</span></span> <span data-ttu-id="8922a-127">Сообщения о запросах лицензий отправляются устройствами, когда требуется действие из приложения.</span><span class="sxs-lookup"><span data-stu-id="8922a-127">License request messages are sent by devices when action from the application is needed.</span></span> <span data-ttu-id="8922a-128">В настоящее время поддерживается только действие "Воспроизвести", которое представляет собой запрос на защиту данных для воспроизведения.</span><span class="sxs-lookup"><span data-stu-id="8922a-128">The only action currently supported is "Play", which is a request for secure data for playback.</span></span>

<span data-ttu-id="8922a-129">При получении сообщения с запросом лицензии необходимо выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="8922a-129">When you receive a license request message, you should perform the following steps:</span></span>

1.  <span data-ttu-id="8922a-130">Проанализируйте сообщение с запросом лицензии, вызвав метод [**ивмдрммессажепарсер::P арселиценсерекуестмсг**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmmessageparser-parselicenserequestmsg) .</span><span class="sxs-lookup"><span data-stu-id="8922a-130">Parse the license request message by calling the [**IWMDRMMessageParser::ParseLicenseRequestMsg**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmmessageparser-parselicenserequestmsg) method.</span></span>
2.  <span data-ttu-id="8922a-131">Получите интерфейс [**ивмрегистереддевице**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmregistereddevice) для устройства, вызвав метод [**Ивмдевицерегистратион:: жетрегистереддевицебид**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdeviceregistration-getregistereddevicebyid) , передав сертификат и серийный номер, полученные на шаге 1.</span><span class="sxs-lookup"><span data-stu-id="8922a-131">Get the [**IWMRegisteredDevice**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmregistereddevice) interface for the device by calling the [**IWMDeviceRegistration::GetRegisteredDeviceByID**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdeviceregistration-getregistereddevicebyid) method, passing in the certificate and serial number obtained in step 1.</span></span>
3.  <span data-ttu-id="8922a-132">Убедитесь, что устройство готово к получению защищенных данных:</span><span class="sxs-lookup"><span data-stu-id="8922a-132">Verify that the device is ready to receive secure data:</span></span>
    -   <span data-ttu-id="8922a-133">Вызовите [**ивмрегистереддевице:: утвердил**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isapproved) , чтобы убедиться, что устройство утверждено.</span><span class="sxs-lookup"><span data-stu-id="8922a-133">Call [**IWMRegisteredDevice::IsApproved**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isapproved) to verify that the device has been approved.</span></span> <span data-ttu-id="8922a-134">Утверждение всегда должно основываться на предпочтениях пользователя.</span><span class="sxs-lookup"><span data-stu-id="8922a-134">Approval should always be based on user preference.</span></span>
    -   <span data-ttu-id="8922a-135">Вызовите [**ивмрегистереддевице:: IsValid**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isvalid) , чтобы убедиться, что устройство проверено в течение последних 48 часов.</span><span class="sxs-lookup"><span data-stu-id="8922a-135">Call [**IWMRegisteredDevice::IsValid**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isvalid) to verify that the device has been validated within the last 48 hours.</span></span> <span data-ttu-id="8922a-136">Если устройство является недопустимым, необходимо выполнить обнаружение близлежащих устройств.</span><span class="sxs-lookup"><span data-stu-id="8922a-136">If the device is not valid, you need to perform proximity detection.</span></span> <span data-ttu-id="8922a-137">Дополнительные сведения см. в разделе [выполнение обнаружения близлежащих](performing-proximity-detection.md)устройств.</span><span class="sxs-lookup"><span data-stu-id="8922a-137">For more information, see [Performing Proximity Detection](performing-proximity-detection.md).</span></span>
    -   <span data-ttu-id="8922a-138">Вызовите метод [**ивмрегистереддевице:: OnOpen**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isopened) , чтобы убедиться, что устройство открыто.</span><span class="sxs-lookup"><span data-stu-id="8922a-138">Call [**IWMRegisteredDevice::IsOpened**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isopened) to verify that the device has been opened.</span></span> <span data-ttu-id="8922a-139">Если устройство не открыто, его можно открыть, вызвав [**ивмрегистереддевице:: Open**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-open).</span><span class="sxs-lookup"><span data-stu-id="8922a-139">If the device is not open, you can open it by calling [**IWMRegisteredDevice::Open**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-open).</span></span> <span data-ttu-id="8922a-140">На компьютере может быть открыто только 10 устройств.</span><span class="sxs-lookup"><span data-stu-id="8922a-140">You can only have 10 devices open on the computer at a time.</span></span> <span data-ttu-id="8922a-141">Возможно, потребуется закрыть другое устройство, прежде чем можно будет открыть тот, для которого обрабатывается запрос.</span><span class="sxs-lookup"><span data-stu-id="8922a-141">It is possible that you may need to close another device before you can open the one for which you are processing the request.</span></span> <span data-ttu-id="8922a-142">Чтобы закрыть устройство, вызовите метод [**ивмрегистереддевице:: Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-close) .</span><span class="sxs-lookup"><span data-stu-id="8922a-142">To close a device, call the [**IWMRegisteredDevice::Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-close) method.</span></span>
4.  <span data-ttu-id="8922a-143">Создайте экземпляр объекта перешифрования DRM, вызвав функцию [**вмкреатедрмтранскриптор**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-wmcreatedrmtranscryptor) .</span><span class="sxs-lookup"><span data-stu-id="8922a-143">Create an instance of the DRM transcryptor object by calling the [**WMCreateDRMTranscryptor**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-wmcreatedrmtranscryptor) function.</span></span>
5.  <span data-ttu-id="8922a-144">Вызовите метод [**ивмдрмтранскриптор:: Initialize**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-initialize) для инициализации перешифрования.</span><span class="sxs-lookup"><span data-stu-id="8922a-144">Call the [**IWMDRMTranscryptor::Initialize**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-initialize) method to initialize the transcryptor.</span></span> <span data-ttu-id="8922a-145">Этот метод принимает указатель на реализацию интерфейса [**ивмстатускаллбакк**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstatuscallback) , который используется для доставки сообщений о состоянии.</span><span class="sxs-lookup"><span data-stu-id="8922a-145">This method takes a pointer to your implementation of the [**IWMStatusCallback**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstatuscallback) interface, which it uses to deliver status messages.</span></span> <span data-ttu-id="8922a-146">Этот метод также возвращает сообщение о запросе лицензии, которое необходимо отправить на устройство, прежде чем продолжить.</span><span class="sxs-lookup"><span data-stu-id="8922a-146">This method also returns a license request message that must be sent to the device before continuing.</span></span>
6.  <span data-ttu-id="8922a-147">Когда метод [**ивмстатускаллбакк:: OnStatus**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmstatuscallback-onstatus) приложения получает \_ \_ сообщение о состоянии инициализации ВМТ, вызовите метод [**ивмдрмтранскриптор:: Seek**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-seek) , чтобы найти соответствующую начальную точку в файле.</span><span class="sxs-lookup"><span data-stu-id="8922a-147">When your application's [**IWMStatusCallback::OnStatus**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmstatuscallback-onstatus) method receives the WMT\_TRANSCRYPTOR\_INIT status message, call the [**IWMDRMTranscryptor::Seek**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-seek) method to seek to the appropriate start position in the file.</span></span> <span data-ttu-id="8922a-148">Чтобы начать с начала файла, необходимо вызвать **Seek** с Time 0.</span><span class="sxs-lookup"><span data-stu-id="8922a-148">To start at the beginning of the file, you must call **Seek** with time 0.</span></span>
7.  <span data-ttu-id="8922a-149">\_ \_ При готовности к доставке данных из файла в новое время презентации оно отправляет сообщение с повмтм прешифровании.</span><span class="sxs-lookup"><span data-stu-id="8922a-149">The transcryptor sends a WMT\_TRANSCRYPTOR\_SEEKED message when it is ready to deliver data from the file at the new presentation time.</span></span> <span data-ttu-id="8922a-150">Выполните повторяющиеся вызовы метода [**ивмдрмтранскриптор:: Read**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-read) , чтобы получить преобразованные фрагменты данных мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="8922a-150">Make repeated calls to the [**IWMDRMTranscryptor::Read**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-read) method to get converted chunks of media data.</span></span> <span data-ttu-id="8922a-151">Каждый вызов является асинхронным и не завершается, пока не \_ \_ получено сообщение о считывании ВМТ.</span><span class="sxs-lookup"><span data-stu-id="8922a-151">Each call is asynchronous and is not complete until a WMT\_TRANSCRYPTOR\_READ message is received.</span></span> <span data-ttu-id="8922a-152">После получения сообщения данные можно отправить на принимающее устройство.</span><span class="sxs-lookup"><span data-stu-id="8922a-152">When you receive the message, you can send the data to the receiving device.</span></span>
8.  <span data-ttu-id="8922a-153">При получении сообщения ВМТ- \_ шифрования \_ с сообщением о том, что для параметра *HR* установлено значение NS \_ S \_ \_ (EOF), весь файл считывается.</span><span class="sxs-lookup"><span data-stu-id="8922a-153">When you receive a WMT\_TRANSCRYPTOR\_READ message with the *hr* parameter set to NS\_S\_TRANSCRYPTOR\_EOF, the entire file has been read.</span></span> <span data-ttu-id="8922a-154">На этом этапе вызовите метод [**ивмдрмтранскриптор:: Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-close) , чтобы закрыть файл и освободить ресурсы.</span><span class="sxs-lookup"><span data-stu-id="8922a-154">At this point, call the [**IWMDRMTranscryptor::Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-close) method to close the file and free resources.</span></span>
9.  <span data-ttu-id="8922a-155">Когда \_ \_ получено закрытое сообщение ВМТ-шифрования, можно освободить интерфейс [**ивмдрмтранскриптор**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmdrmtranscryptor) .</span><span class="sxs-lookup"><span data-stu-id="8922a-155">When the WMT\_TRANSCRYPTOR\_CLOSED message is received, you can release the [**IWMDRMTranscryptor**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmdrmtranscryptor) interface.</span></span>

> [!Note]  
> <span data-ttu-id="8922a-156">DRM не поддерживает версию этого пакета SDK на базе x64.</span><span class="sxs-lookup"><span data-stu-id="8922a-156">DRM is not supported by the x64-based version of this SDK.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="8922a-157">См. также</span><span class="sxs-lookup"><span data-stu-id="8922a-157">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8922a-158">**Использование протокола Windows Media DRM 10 для сетевых устройств**</span><span class="sxs-lookup"><span data-stu-id="8922a-158">**Using the Windows Media DRM 10 for Network Devices Protocol**</span></span>](using-the-windows-media-drm-10-for-network-devices-protocol.md)
</dt> </dl>

 

 




