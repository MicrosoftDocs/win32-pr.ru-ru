---
title: Написание примеров видеороликов
description: Написание примеров видеороликов
ms.assetid: 1d375186-230a-4a18-a995-b331c72a76e7
keywords:
- Расширенный формат систем (ASF), написание образцов видеороликов
- ASF (Расширенный системный формат), написание образцов видеороликов
- видеоизображения, создание образцов
- потоки, запись образцов видеороликов
- кодеки, написание образцов видеороликов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0fbac644d7938477ba3d2e8b21ebb6e631a47708
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "104336295"
---
# <a name="writing-video-image-samples"></a><span data-ttu-id="8b3e7-108">Написание примеров видеороликов</span><span class="sxs-lookup"><span data-stu-id="8b3e7-108">Writing Video Image Samples</span></span>

<span data-ttu-id="8b3e7-109">Поток видеоизображения — это видео, которое содержит последовательность изображений.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-109">A Video Image stream is a video that contains a series of still images.</span></span> <span data-ttu-id="8b3e7-110">Изображения могут перемещаться внутри рамки, и каждое изображение может быть перенесено в следующую область.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-110">The images can move within the frame, and each image can blend into the next.</span></span> <span data-ttu-id="8b3e7-111">Потоки видеороликов кодируются с помощью кодека Windows Media Video 9 Image v2.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-111">Video Image streams are encoded using the Windows Media Video 9 Image v2 codec.</span></span> <span data-ttu-id="8b3e7-112">Выходное видео аналогично тому, что было создано кодеком Windows Media Video 9.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-112">The output video is similar to that created by the Windows Media Video 9 codec.</span></span>

<span data-ttu-id="8b3e7-113">Чтобы создать профиль, содержащий поток видеоизображения, начните с перечисления видеокодеков, как описано в статье [Получение сведений о конфигурации потока из кодеков](getting-stream-configuration-information-from-codecs.md).</span><span class="sxs-lookup"><span data-stu-id="8b3e7-113">To create a profile that contains a Video Image stream, start by enumerating the video codecs as described in [Getting Stream Configuration Information from Codecs](getting-stream-configuration-information-from-codecs.md).</span></span> <span data-ttu-id="8b3e7-114">Найдите кодек, который поддерживает \_ ПОДТИП вммедиасубтипе WVP2.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-114">Search for the codec that supports the WMMEDIASUBTYPE\_WVP2 subtype.</span></span>

<span data-ttu-id="8b3e7-115">После настройки профиля в объекте модуля записи вызовите метод [**ивмвритер:: жетинпутпропс**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-getinputprops) , чтобы получить свойства мультимедиа для входного потока видеоизображения.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-115">After you set the profile on the writer object, call [**IWMWriter::GetInputProps**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-getinputprops) to get the media properties for the Video Image input stream.</span></span> <span data-ttu-id="8b3e7-116">Получите тип мультимедиа из объекта свойств носителя, вызвав [**ивммедиапропс:: жетмедиатипе**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype), и измените ПОДТИП на вммедиасубтипе \_ видеоимаже.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-116">Get the media type from the media properties object, by calling [**IWMMediaProps::GetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype), and change the subtype to WMMEDIASUBTYPE\_VIDEOIMAGE.</span></span> <span data-ttu-id="8b3e7-117">Необходимо задать ширину и высоту видео в соответствии с максимальным размером, необходимым для охватывающих изображения, которые будут добавлены в поток.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-117">You should set the video width and height to the maximum dimensions needed to encompass the images you will add to the stream.</span></span> <span data-ttu-id="8b3e7-118">Затем вызовите [**ивммедиапропс:: сетмедиатипе**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-setmediatype) с измененным типом входных данных.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-118">Then call [**IWMMediaProps::SetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-setmediatype) with the modified input type.</span></span> <span data-ttu-id="8b3e7-119">Теперь вы готовы начать отправку образцов в объект модуля записи.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-119">Now you are ready to begin sending samples to the writer object.</span></span>

<span data-ttu-id="8b3e7-120">Каждый пример должен начинаться с структуры **ВМТ \_ видеоимаже \_ SAMPLE2** .</span><span class="sxs-lookup"><span data-stu-id="8b3e7-120">Each sample must begin with a **WMT\_VIDEOIMAGE\_SAMPLE2** structure.</span></span> <span data-ttu-id="8b3e7-121">Кроме того, примеры могут содержать растровые изображения.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-121">Additionally, samples may contain bitmap images.</span></span> <span data-ttu-id="8b3e7-122">Изображение прикрепляется к образцу только для первого кадра, в котором он отображается.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-122">An image is only attached to a sample for the first frame in which it appears.</span></span> <span data-ttu-id="8b3e7-123">Всем дополнительным кадрам, использующим этот образ, требуется только информация в структуре.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-123">All additional frames using that image need only information in the structure.</span></span> <span data-ttu-id="8b3e7-124">Входные точечные рисунки должны иметь формат RGB, 24 бита на пиксель.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-124">Input bitmaps must be formatted as RGB, 24 bits per pixel.</span></span>

<span data-ttu-id="8b3e7-125">Файлы точечных рисунков хранят данные изображения таким образом, чтобы данные для каждой строки изображения занимали несколько байтов, кратных четырем.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-125">Bitmap files store the image data so that the data for each row of the image takes a number of bytes divisible by four.</span></span> <span data-ttu-id="8b3e7-126">(Это называется шагом точечного рисунка.) Это заставляет начало каждой строки видео превышено на границу **DWORD** , что делает копирование более эффективным.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-126">(This is called the stride of the bitmap.) This forces the beginning of every row of video to a **DWORD** boundary, which makes copying more efficient.</span></span> <span data-ttu-id="8b3e7-127">Если строки изображения не делятся неравномерно на четыре, то строка заполняется до следующего наибольшего числа, кратного четырем байтам.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-127">If the image rows are not evenly divisible by four, the row is padded to the next highest multiple of four bytes.</span></span> <span data-ttu-id="8b3e7-128">При присоединении данных изображения необходимо удалить все заполнения, существующие в конце данных для каждой строки.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-128">When you attach image data, you must remove any padding that exists at the end of the data for each row.</span></span>

<span data-ttu-id="8b3e7-129">Кодек Windows Media Video 9 Image v2 поддерживает до двух изображений в памяти за раз.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-129">The Windows Media Video 9 Image v2 codec maintains up to two images in memory at a time.</span></span> <span data-ttu-id="8b3e7-130">Эти изображения называются предыдущим и текущим изображениями.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-130">These images are called the previous image and the current image.</span></span> <span data-ttu-id="8b3e7-131">Каждый образ имеет набор элементов в структуре **ВМТ \_ видеоимаже \_ SAMPLE2** , который определяет, как изображение отображается в кадре.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-131">Each image has a set of members in the **WMT\_VIDEOIMAGE\_SAMPLE2** structure, which dictate how the image is presented in the frame.</span></span> <span data-ttu-id="8b3e7-132">Вы можете добавить образ, задав для элемента Двконтролфлагс в **ВМТ \_ видеоимаже \_ SAMPLE2** значение ВМТ \_ видеоимаже \_ пример \_ входного \_ кадра.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-132">You can add an image by setting the dwControlFlags member of **WMT\_VIDEOIMAGE\_SAMPLE2** to WMT\_VIDEOIMAGE\_SAMPLE\_INPUT\_FRAME.</span></span> <span data-ttu-id="8b3e7-133">При передаче кадра ввода в кодек этот образ станет текущим изображением.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-133">When you pass an input frame to the codec, that image becomes the current image.</span></span> <span data-ttu-id="8b3e7-134">Изображение, которое было текущим изображением в предыдущем примере, обычно становится предыдущим изображением, а изображение, которое было предыдущим изображением в предыдущем примере, отбрасывается.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-134">The image that was the current image in the previous sample usually becomes the previous image, and the image that was the previous image in the previous sample is discarded.</span></span> <span data-ttu-id="8b3e7-135">Можно настроить кодек для удержания старого предыдущего изображения, задав для элемента **Бкиппревимаже** **значение true**.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-135">You can configure the codec to retain the old previous image by setting the **bKeepPrevImage** member to **TRUE**.</span></span> <span data-ttu-id="8b3e7-136">В этом случае изображение, которое было текущим изображением в предыдущем примере, отбрасывается.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-136">In that case, the image that was the current image in the previous sample is discarded.</span></span>

<span data-ttu-id="8b3e7-137">Базовая композиция кадра видеоизображения определяется двумя факторами для каждого изображения: областью интересов и коэффициентом смешения.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-137">The basic composition of a Video Image frame is determined by two factors for each image: region of interest and blend coefficient.</span></span> <span data-ttu-id="8b3e7-138">Область, представляющая интерес для изображения, определяется исходной точкой, шириной и высотой.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-138">The region of interest for an image is defined by an origin point, width, and height.</span></span> <span data-ttu-id="8b3e7-139">Часть изображения, описываемая интересующим регионом, заполняет выходной кадр.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-139">The part of an image described by the region of interest fills the output frame.</span></span> <span data-ttu-id="8b3e7-140">Если размер интересующей области отличается от размера выходного фрейма, кодек изменяет его размер.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-140">If the region of interest is a different size than the output frame, the codec resizes it.</span></span> <span data-ttu-id="8b3e7-141">Коэффициент смешения изображения определяет смешение двух изображений.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-141">The blend coefficient of the image determines the blending of the two images.</span></span> <span data-ttu-id="8b3e7-142">Коэффициенты смешения для текущего и предыдущего изображений должны всего 1,0.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-142">The blend coefficients for the current and previous images must total 1.0.</span></span> <span data-ttu-id="8b3e7-143">Например, если для **фкуррблендкоеф** задано значение 0,5, а **фпревблендкоеф** имеет значение 0,5, то выходной кадр состоит из одинакового смешения интересующих регионов из обоих изображений.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-143">For example, if **fCurrBlendCoef** is set to 0.5 and **fPrevBlendCoef** is set to 0.5, then the output frame is composed of an equal blend of the regions of interest from both images.</span></span>

<span data-ttu-id="8b3e7-144">Управляя интересующей областью изображения, можно создавать эффекты панорамирования и масштабирования.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-144">By manipulating the region of interest for an image, you can create pan and zoom effects.</span></span> <span data-ttu-id="8b3e7-145">Коэффициенты смешения позволяют пересекать (растворение) между изображениями.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-145">The blend coefficients enable you to cross-fade (dissolve) between images.</span></span> <span data-ttu-id="8b3e7-146">Помимо этих эффектов, для создания более сложных кадров можно использовать один из стандартных переходов.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-146">In addition to these effects, you can use one of the predefined transitions to create more complex frames.</span></span> <span data-ttu-id="8b3e7-147">Доступные переходы описаны в разделе [переходы по изображениям видео](video-image-transitions.md) этой документации.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-147">The available transitions are described in the [Video Image Transitions](video-image-transitions.md) section of this documentation.</span></span> <span data-ttu-id="8b3e7-148">При использовании перехода необходимо настроить каждый кадр.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-148">When using a transition, you must configure each frame.</span></span> <span data-ttu-id="8b3e7-149">Самый простой способ сделать это — создать функцию, которая постепенно изменяет члены структуры **ВМТ \_ видеоимаже \_ SAMPLE2** для выполнения всего действия.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-149">The easiest way to do this is to create a function that incrementally changes members of the **WMT\_VIDEOIMAGE\_SAMPLE2** structure for a complete effect.</span></span>

<span data-ttu-id="8b3e7-150">Дополнительные сведения о значениях, которые необходимо задать для обозначений, см. в разделе [**ВМТ \_ видеоимаже \_ SAMPLE2**](/previous-versions/windows/desktop/api/Wmsdkidl/ns-wmsdkidl-wmt_videoimage_sample2).</span><span class="sxs-lookup"><span data-stu-id="8b3e7-150">For more information about the values to set for deformations, see [**WMT\_VIDEOIMAGE\_SAMPLE2**](/previous-versions/windows/desktop/api/Wmsdkidl/ns-wmsdkidl-wmt_videoimage_sample2).</span></span>

<span data-ttu-id="8b3e7-151">**Примечание** . Если вы хотите включить звук в файл с потоком видеоизображения, необходимо использовать несжатый звуковый вход.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-151">**Note** If you want to include audio in a file with a Video Image stream, you must use uncompressed audio input.</span></span> <span data-ttu-id="8b3e7-152">Чтобы объединить поток видеоизображения с существующим сжатым потоком звука, необходимо распаковать звук и передать образцы в несжатом виде.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-152">To combine a Video Image stream with an existing compressed audio stream, you must decompress the audio and pass the samples in uncompressed.</span></span> <span data-ttu-id="8b3e7-153">Если передать сжатые образцы в модуль записи при записи потока видеоизображения, возникнет ошибка, в результате чего образцы будут удалены из видео.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-153">If you pass compressed samples to the writer when writing a Video Image stream, an error will occur, resulting in samples being dropped from the video.</span></span>

<span data-ttu-id="8b3e7-154">Кроме того, сжатые файлы видеоизображений без звуковых потоков могут содержать несколько очень мелких, очень сжатых видеокадров в одном пакете ASF, что может привести к плохому воспроизведению в предыдущих версиях проигрывателя Windows Media.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-154">Also, compressed Video Image files with no audio streams can contain several very small, highly compressed video frames in a single ASF packet, which can result in a poor playback experience on previous versions of Windows Media Player.</span></span> <span data-ttu-id="8b3e7-155">Чтобы избежать этой проблемы, лучшим решением будет Вставка в файл звукового потока без звука, хотя это также увеличит размер файла.</span><span class="sxs-lookup"><span data-stu-id="8b3e7-155">To avoid this problem, the best solution is to insert a silent audio stream into the file, although this will also increase the file size.</span></span>

## <a name="related-topics"></a><span data-ttu-id="8b3e7-156">См. также</span><span class="sxs-lookup"><span data-stu-id="8b3e7-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8b3e7-157">**Видеоизображение**</span><span class="sxs-lookup"><span data-stu-id="8b3e7-157">**Video Image**</span></span>](video-image.md)
</dt> <dt>

[<span data-ttu-id="8b3e7-158">**Запись файлов ASF**</span><span class="sxs-lookup"><span data-stu-id="8b3e7-158">**Writing ASF Files**</span></span>](writing-asf-files.md)
</dt> </dl>

 

 




