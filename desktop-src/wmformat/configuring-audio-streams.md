---
title: Настройка звуковых потоков
description: Настройка звуковых потоков
ms.assetid: 6ddd9bc1-3fde-4098-afce-fdda461ced62
keywords:
- потоки, Настройка звуковых потоков
- кодеки, Настройка звуковых потоков
- звуковые потоки, Настройка
- кодеки, форматы
- потоки, интерфейс ИвмкодеЦинфо
- ИвмкодеЦинфо, звуковые потоки
- потоки, синхронизация/V
- звуковые потоки, синхронизация/V
- Синхронизация A/V
- потоки, синхронизация/V
- звуковые потоки, синхронизация/V
- потоки, аудио форматы с низкой задержкой
- звуковые потоки, форматы с низкой задержкой
- кодеки, форматы с низкой задержкой
- потоки, переменная скорость (VBR)
- звуковые потоки, переменная скорость (VBR)
- кодеки, переменные скорость (VBR)
- Переменная скорость (VBR), Настройка
- VBR (переменная скорость), Настройка
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3ad3931ec41e73c125417d39cdd177dc16056e9e
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105710329"
---
# <a name="configuring-audio-streams"></a><span data-ttu-id="bee7e-122">Настройка звуковых потоков</span><span class="sxs-lookup"><span data-stu-id="bee7e-122">Configuring Audio Streams</span></span>

<span data-ttu-id="bee7e-123">Обычно для настройки используются потоки аудио.</span><span class="sxs-lookup"><span data-stu-id="bee7e-123">Audio streams are generally the most straightforward to configure.</span></span> <span data-ttu-id="bee7e-124">Получите конфигурацию потока из кодека, используя методы [**ивмкодеЦинфо**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmcodecinfo) , как описано в статье [Получение сведений о конфигурации потока из кодеков](getting-stream-configuration-information-from-codecs.md).</span><span class="sxs-lookup"><span data-stu-id="bee7e-124">Get a stream configuration from the codec using the methods of [**IWMCodecInfo**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmcodecinfo) as described in [Getting Stream Configuration Information from Codecs](getting-stream-configuration-information-from-codecs.md).</span></span> <span data-ttu-id="bee7e-125">В большинстве случаев не следует изменять параметры из полученных.</span><span class="sxs-lookup"><span data-stu-id="bee7e-125">Under most circumstances, you should not alter the settings from those retrieved.</span></span>

<span data-ttu-id="bee7e-126">Формат кодека, выбранный из перечисленных в списке, зависит от предполагаемого использования файлов ASF, созданных с профилем.</span><span class="sxs-lookup"><span data-stu-id="bee7e-126">The codec format that you select from those enumerated depends upon the intended use of the ASF files made with the profile.</span></span> <span data-ttu-id="bee7e-127">Описание формата кодека, полученное с помощью [**IWMCodecInfo2:: жеткодекформатдеск**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmcodecinfo2-getcodecformatdesc) , суммирует характеристики формата.</span><span class="sxs-lookup"><span data-stu-id="bee7e-127">The codec format description retrieved by [**IWMCodecInfo2::GetCodecFormatDesc**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmcodecinfo2-getcodecformatdesc) summarizes the characteristics of the format.</span></span> <span data-ttu-id="bee7e-128">Если в приложении не отображаются описания для выбора между ними, можно вызвать **QueryInterface** в интерфейсе [**ивмстреамконфиг**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstreamconfig) формата кодека, чтобы получить интерфейс [**ивммедиапропс**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmmediaprops) .</span><span class="sxs-lookup"><span data-stu-id="bee7e-128">If your application does not display the descriptions to choose between them, you can call **QueryInterface** on the [**IWMStreamConfig**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstreamconfig) interface of the codec format to get the [**IWMMediaProps**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmmediaprops) interface.</span></span> <span data-ttu-id="bee7e-129">Затем можно получить структуру [**\_ \_ типа мультимедиа WM**](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wm_media_type) , вызвав [**ивммедиапропс:: жетмедиатипе**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype).</span><span class="sxs-lookup"><span data-stu-id="bee7e-129">Then you can retrieve the [**WM\_MEDIA\_TYPE**](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wm_media_type) structure by calling [**IWMMediaProps::GetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype).</span></span> <span data-ttu-id="bee7e-130">Изучив структуру **\_ \_ типа мультимедиа WM** и структуру [**вавеформатекс**](/previous-versions/windows/desktop/legacy/dd757720(v=vs.85)) , на которую он указывает, можно определить параметры формата кодека и сравнить их с вашими требованиями.</span><span class="sxs-lookup"><span data-stu-id="bee7e-130">By examining the **WM\_MEDIA\_TYPE** structure and the [**WAVEFORMATEX**](/previous-versions/windows/desktop/legacy/dd757720(v=vs.85)) structure it points to, you can determine the settings of the codec format and compare them to your requirements.</span></span>

## <a name="getting-audio-formats-for-av-synchronization"></a><span data-ttu-id="bee7e-131">Получение форматов звука для синхронизации/V</span><span class="sxs-lookup"><span data-stu-id="bee7e-131">Getting Audio Formats for A/V Synchronization</span></span>

<span data-ttu-id="bee7e-132">Аудиокодек Windows Media Audio и кодек Windows Media Audio Professional поддерживают форматы только для звуковых файлов, а также для аудио-и видеофайлов.</span><span class="sxs-lookup"><span data-stu-id="bee7e-132">The Windows Media Audio codec and Windows Media Audio Professional codec both support formats for audio-only files and for audio/video files.</span></span> <span data-ttu-id="bee7e-133">Форматы только для звука оптимизированы для файлов, содержащих только звуковые данные, а форматы аудио и видео оптимизированы для аудио, который находится в файле с видеопотоком.</span><span class="sxs-lookup"><span data-stu-id="bee7e-133">The audio-only formats are optimized for files containing only audio data, while the audio/video formats are optimized for audio that is in a file with a video stream.</span></span> <span data-ttu-id="bee7e-134">При перечислении форматов кодеков для этих кодеков форматы аудио и видео поступают после форматов только для аудио.</span><span class="sxs-lookup"><span data-stu-id="bee7e-134">When enumerating codec formats for these codecs, the audio/video formats come after the audio-only formats.</span></span> <span data-ttu-id="bee7e-135">Все описания формата аудио/видео содержат строку "(A/V)".</span><span class="sxs-lookup"><span data-stu-id="bee7e-135">The audio/video format descriptions all contain the string "(A/V)".</span></span> <span data-ttu-id="bee7e-136">Можно задать форматы, предназначенные для синхронизации аудио и видео программным путем, проверив количество пакетов в секунду.</span><span class="sxs-lookup"><span data-stu-id="bee7e-136">You can identify the formats designed for audio/video synchronization programmatically by checking the number of packets per second.</span></span> <span data-ttu-id="bee7e-137">Форматы для синхронизации имеют 5 или более пакетов в секунду, если скорость потока больше или равна 32 000 бит/сек.</span><span class="sxs-lookup"><span data-stu-id="bee7e-137">Formats for synchronization have 5 or more packets per second if the bit rate is greater than or equal to 32,000 bits per second.</span></span> <span data-ttu-id="bee7e-138">Форматы с скоростями битов, меньшими 32 000 бит в секунду, можно использовать с синхронизированным видео, если они используют 3 или более пакетов в секунду.</span><span class="sxs-lookup"><span data-stu-id="bee7e-138">Formats with bit rates less than 32,000 bits per second can be used with synchronized video if they use 3 or more packets per second.</span></span> <span data-ttu-id="bee7e-139">Пример кода в разделе [to find Audio formats](to-find-audio-formats.md) содержит код, необходимый для выполнения этой проверки:</span><span class="sxs-lookup"><span data-stu-id="bee7e-139">The code example in the [To Find Audio Formats](to-find-audio-formats.md) topic contains the code required to make this check:</span></span>


```C++
if((pWave->nAvgBytesPerSec / pWave->nBlockAlign) >= 
       ((pWave->nAvgBytesPerSec >= 4000) ? 5.0 : 3.0))
{
    // Set this stream configuration as the new best match.
}
```



## <a name="getting-low-delay-audio-formats"></a><span data-ttu-id="bee7e-140">Получение Low-Delay звуковых форматов</span><span class="sxs-lookup"><span data-stu-id="bee7e-140">Getting Low-Delay Audio Formats</span></span>

<span data-ttu-id="bee7e-141">Кодек Windows Media 9,1 и кодек Windows Media Audio 9,1 Professional поддерживают форматы с низкой задержкой.</span><span class="sxs-lookup"><span data-stu-id="bee7e-141">The Windows Media 9.1 codec and the Windows Media Audio 9.1 Professional codec both support low-delay formats.</span></span> <span data-ttu-id="bee7e-142">В этих форматах окно буфера меньше, чем в других звуковых форматах.</span><span class="sxs-lookup"><span data-stu-id="bee7e-142">These formats have a smaller buffer window than other audio formats.</span></span> <span data-ttu-id="bee7e-143">Воспроизведение звука с низкой задержкой предназначено для повышения производительности в ситуациях, когда файлы или потоки будут часто переключаться. Например, приложение, которое содержит несколько песен для потоковой передачи в пользовательском интерфейсе и позволяет пользователям произвольно переключаться между ними.</span><span class="sxs-lookup"><span data-stu-id="bee7e-143">Low-delay audio is intended to improve performance in scenarios where files or streams will be switched frequently; for example, an application that lists a number of songs for streaming in the user interface and allows users to arbitrarily switch between them.</span></span>

<span data-ttu-id="bee7e-144">Форматы с низкой задержкой доступны только в режиме CBR (один или два прохода).</span><span class="sxs-lookup"><span data-stu-id="bee7e-144">Low-delay formats are available only in CBR mode (one-pass or two-pass).</span></span> <span data-ttu-id="bee7e-145">Все описания формата с низкой задержкой содержат строку "низкая задержка".</span><span class="sxs-lookup"><span data-stu-id="bee7e-145">The low-delay format descriptions all contain the string "Low Delay".</span></span> <span data-ttu-id="bee7e-146">Форматы можно задать программно, проверив значение битовой скорости формата.</span><span class="sxs-lookup"><span data-stu-id="bee7e-146">You can identify the formats programmatically by checking the bit-rate value of the format.</span></span> <span data-ttu-id="bee7e-147">Форматы с низкой задержкой имеют скорость в 1 килобит меньше, чем скорость в эквивалентном нормальном формате.</span><span class="sxs-lookup"><span data-stu-id="bee7e-147">The low-delay formats are assigned bit rates that are 1 kilobit less than the bit rates of the equivalent normal format.</span></span> <span data-ttu-id="bee7e-148">Например, кодек Windows Media Audio 9,1 поддерживает однопроходный формат CBR с скоростью в 192 кбит/с.</span><span class="sxs-lookup"><span data-stu-id="bee7e-148">For example, the Windows Media Audio 9.1 codec supports a single-pass CBR format with a bit rate of 192 kbps.</span></span> <span data-ttu-id="bee7e-149">Эквивалентный формат с низкой задержкой имеет скорость 191 кбит/с.</span><span class="sxs-lookup"><span data-stu-id="bee7e-149">The equivalent low-delay format has a bit rate of 191 kbps.</span></span> <span data-ttu-id="bee7e-150">Кроме того, за исключением формата Mono 5 кбит/с, поддерживаемого кодеком Windows Media Audio 9,1, форматы с низкой задержкой являются единственными форматами с нечетным значением битовой скорости.</span><span class="sxs-lookup"><span data-stu-id="bee7e-150">In addition, with the exception of the 5 kbps mono format supported by the Windows Media Audio 9.1 codec, the low-delay formats are the only formats that have an odd bit-rate value.</span></span>

## <a name="configuring-variable-bit-rate-audio"></a><span data-ttu-id="bee7e-151">Настройка звука переменной скорости</span><span class="sxs-lookup"><span data-stu-id="bee7e-151">Configuring Variable Bit Rate Audio</span></span>

<span data-ttu-id="bee7e-152">Если для одного из аудиокодеков Windows Media требуется формат переменной скорости (VBR), его можно получить, задав параметры перечисления в методе [**IWMCodecInfo3:: сеткодеценумератионсеттинг**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmcodecinfo3-setcodecenumerationsetting) .</span><span class="sxs-lookup"><span data-stu-id="bee7e-152">When you need a variable bit rate (VBR) format for one of the Windows Media audio codecs, you can get it by setting the enumeration settings in the [**IWMCodecInfo3::SetCodecEnumerationSetting**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmcodecinfo3-setcodecenumerationsetting) method.</span></span> <span data-ttu-id="bee7e-153">Задайте для параметра g \_ всзвбренаблед значение true и задайте для параметра g \_ всзнумпассес значение 1 для параметра с параметром VBR или 2 для двух проходов (ограниченный или неограниченный).</span><span class="sxs-lookup"><span data-stu-id="bee7e-153">Set g\_wszVBREnabled to True, and set g\_wszNumPasses to 1 for quality-based VBR or 2 for two-pass VBR (constrained or unconstrained).</span></span> <span data-ttu-id="bee7e-154">При использовании ограниченных двух проходов VBR необходимо вручную задать максимальную скорость и окно буфера для потока с помощью методов [**ивмпропертиваулт**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmpropertyvault) , как описано в разделе [Настройка потоков VBR](configuring-vbr-streams.md).</span><span class="sxs-lookup"><span data-stu-id="bee7e-154">If you are using constrained two-pass VBR, you must manually set the maximum bit rate and buffer window for the stream using the methods of [**IWMPropertyVault**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmpropertyvault) as described in [Configuring VBR Streams](configuring-vbr-streams.md).</span></span>

<span data-ttu-id="bee7e-155">В профилях VBR на основе качества элемент **навгбитесперсек** структуры **вавеформатекс** содержит уровень качества (от 1 до 100) в байтах нижнего порядка, а три старших байта — 0x7fffff.</span><span class="sxs-lookup"><span data-stu-id="bee7e-155">In quality-based VBR profiles, the **nAvgBytesPerSec** member of the **WAVEFORMATEX** structure contains the quality level (1 through 100) in the low-order byte and the three high-order bytes are set to 0x7fffff.</span></span> <span data-ttu-id="bee7e-156">Не пытайтесь изменить параметр качества, изменив это значение вручную. необходимо использовать формат, так как он извлекается из кодека.</span><span class="sxs-lookup"><span data-stu-id="bee7e-156">Do not attempt to modify the quality setting by modifying this value manually; you must use the format as it is retrieved from the codec.</span></span> <span data-ttu-id="bee7e-157">Чтобы использовать другое значение качества, необходимо перечислить форматы до тех пор, пока не найдете соответствующий потребностям.</span><span class="sxs-lookup"><span data-stu-id="bee7e-157">To use a different quality value, you must enumerate formats until you find one that meets your needs.</span></span> <span data-ttu-id="bee7e-158">Кроме того, **навгбитесперсек** не будет сохраняться в файле ASF; При получении структуры **вавеформатекс** для файла, открытого с помощью объекта Reader, **навгбитесперсек** содержит приблизительное значение, представляющее среднее число байтов в секунду.</span><span class="sxs-lookup"><span data-stu-id="bee7e-158">Also, **nAvgBytesPerSec** will not be preserved in the ASF file; when you obtain the **WAVEFORMATEX** structure for a file that has been opened with the reader object, **nAvgBytesPerSec** contains an approximate value representing the average number of bytes per second.</span></span>

> [!Note]  
> <span data-ttu-id="bee7e-159">При настройке звуковых потоков никогда не следует использовать значение окна буфера аудио, которое больше значения для всех потоков видео в файле.</span><span class="sxs-lookup"><span data-stu-id="bee7e-159">When configuring audio streams, you should never have an audio buffer window value that is greater than the value for any video streams in the file.</span></span> <span data-ttu-id="bee7e-160">Обычно это не является проблемой, так как значения окна звукового буфера должны находиться в диапазоне от 1,5 до 3 секунд, а значения видео должны находиться в диапазоне от 3 до 5 секунд.</span><span class="sxs-lookup"><span data-stu-id="bee7e-160">Normally this is not an issue, as audio buffer window values should range between 1.5 and 3 seconds and video values should range between 3 and 5 seconds.</span></span> <span data-ttu-id="bee7e-161">Если окно буфера аудио больше, чем окно буфера видео, файл будет воспроизводиться с потоками, которые немного не синхронизированы.</span><span class="sxs-lookup"><span data-stu-id="bee7e-161">If an audio buffer window is greater than a video buffer window, the file will play back with the streams slightly out of synchronization.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="bee7e-162">См. также</span><span class="sxs-lookup"><span data-stu-id="bee7e-162">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="bee7e-163">**Общая конфигурация для всех потоков**</span><span class="sxs-lookup"><span data-stu-id="bee7e-163">**Configuration Common to All Streams**</span></span>](configuration-common-to-all-streams.md)
</dt> <dt>

[<span data-ttu-id="bee7e-164">**Настройка потоков**</span><span class="sxs-lookup"><span data-stu-id="bee7e-164">**Configuring Streams**</span></span>](configuring-streams.md)
</dt> <dt>

[<span data-ttu-id="bee7e-165">**Поиск форматов аудио**</span><span class="sxs-lookup"><span data-stu-id="bee7e-165">**To Find Audio Formats**</span></span>](to-find-audio-formats.md)
</dt> </dl>

 

 