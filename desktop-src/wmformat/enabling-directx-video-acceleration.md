---
title: Включение ускорения видео DirectX
description: Включение ускорения видео DirectX
ms.assetid: 5cb2f564-88e3-4b60-bde3-6ccf69c97c48
keywords:
- Windows Media Format SDK, включение ДКСВА
- Windows Media Format SDK, ускорение видео DirectX (ДКСВА)
- Windows Media Format SDK, ускорение видео
- Расширенный системный формат (ASF), включение ДКСВА
- ASF (Расширенный системный формат), включение ДКСВА
- Расширенный формат систем (ASF), ускорение видео DirectX (ДКСВА)
- ASF (Расширенный системный формат), ускорение видео DirectX (ДКСВА)
- Расширенный системный формат (ASF), ускорение видео
- ASF (Расширенный системный формат), ускорение видео
- Ускорение видео DirectX (ДКСВА), включение
- ДКСВА (ускорение видео DirectX), включение
- Ускорение видео DirectX (ДКСВА), порядок операций
- ДКСВА (ускорение видео DirectX), порядок операций
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 896147fe11b4b7f5fb91d8dc288e616b643bd5ce
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "104412487"
---
# <a name="enabling-directx-video-acceleration"></a><span data-ttu-id="111a6-116">Включение ускорения видео DirectX</span><span class="sxs-lookup"><span data-stu-id="111a6-116">Enabling DirectX Video Acceleration</span></span>

<span data-ttu-id="111a6-117">В этом разделе описано, как включить ускорение видео Microsoft® DirectX® при воспроизведении потокового содержимого в пользовательском проигрывателе.</span><span class="sxs-lookup"><span data-stu-id="111a6-117">This section describes how to enable Microsoft® DirectX® Video Acceleration when playing streamed content in a custom player.</span></span>

## <a name="background"></a><span data-ttu-id="111a6-118">Историческая справка</span><span class="sxs-lookup"><span data-stu-id="111a6-118">Background</span></span>

<span data-ttu-id="111a6-119">DirectX-ускорение видео (DirectX ва) — это спецификация API для аппаратного ускорения операций декодирования.</span><span class="sxs-lookup"><span data-stu-id="111a6-119">DirectX Video Acceleration (DirectX VA) is an API specification for hardware acceleration of 2-D decoding operations.</span></span> <span data-ttu-id="111a6-120">Он позволяет программным декодерам разгружать определенные ресурсоемкие операции на графическую карту для обработки.</span><span class="sxs-lookup"><span data-stu-id="111a6-120">It enables software decoders to offload certain CPU-intensive operations to the graphics card for processing.</span></span> <span data-ttu-id="111a6-121">Для конечных пользователей это может быть высокоскоростным видео, например воспроизведением полноэкранных DVD-дисков на старых компьютерах, оснащенных графическими картами, совместимыми с DirectX.</span><span class="sxs-lookup"><span data-stu-id="111a6-121">For end users, this makes possible high-bit-rate video such as full-screen DVD playback on older computers equipped with DirectX VA-compatible graphics cards.</span></span>

<span data-ttu-id="111a6-122">Начиная с Windows Media Format SDK серии 9, фильтр оболочки DMO поддерживает DirectX ва.</span><span class="sxs-lookup"><span data-stu-id="111a6-122">Beginning with the Windows Media Format 9 Series SDK, the DMO Wrapper filter supports DirectX VA.</span></span> <span data-ttu-id="111a6-123">Это означает, что для локального воспроизведения приложения могут использовать фильтр чтения WM ASF для воспроизведения содержимого на основе Windows Media и аппаратное ускорение DirectX, которое будет вызываться автоматически, если графическая карта поддерживает ее.</span><span class="sxs-lookup"><span data-stu-id="111a6-123">This means that, for local playback, applications can use the WM ASF Reader filter to play Windows Media-based content and DirectX VA hardware acceleration will be invoked automatically if the graphics card supports it.</span></span> <span data-ttu-id="111a6-124">Однако фильтр чтения WM ASF не поддерживает воспроизведение потокового содержимого.</span><span class="sxs-lookup"><span data-stu-id="111a6-124">However, the WM ASF Reader filter does not support playback of streamed content.</span></span> <span data-ttu-id="111a6-125">Таким образом, если требуется поддержка DirectX ва при воспроизведении потокового содержимого в пользовательском проигрывателе, необходимо использовать альтернативный механизм, который используется проигрывателем Windows Media, начиная с серии Windows Media 9.</span><span class="sxs-lookup"><span data-stu-id="111a6-125">Therefore, if you want to support DirectX VA when playing streamed content in a custom player, you must use an alternate mechanism, which is the one used by Windows Media Player beginning with the Windows Media 9 Series.</span></span>

<span data-ttu-id="111a6-126">Поскольку проигрыватель Windows Media был разработан до разработки фильтров КАСФ, проигрыватель Windows Media имеет собственный фильтр исходного кода на основе пакета SDK Windows Media Format для воспроизведения содержимого на основе Windows Media.</span><span class="sxs-lookup"><span data-stu-id="111a6-126">Because Windows Media Player was designed before the QASF filters had been developed, Windows Media Player has its own source filter, based on the Windows Media Format SDK, for playing Windows Media-based content.</span></span> <span data-ttu-id="111a6-127">Фильтр источников данных WMP Windows Media позволяет передавать распакованные данные непосредственно в модули подготовки аудио и видео.</span><span class="sxs-lookup"><span data-stu-id="111a6-127">The WMP Windows Media Source Filter delivers decompressed data downstream directly to the audio and video renderers.</span></span> <span data-ttu-id="111a6-128">Модуль чтения WM ASF, напротив, предоставляет сжатое содержимое, переданное в объекты мультимедиа DirectX декодера Windows Media (дмос), размещенные внутри оболочки DMO.</span><span class="sxs-lookup"><span data-stu-id="111a6-128">By contrast, the WM ASF Reader delivers compressed content downstream to the Windows Media Decoder DirectX Media Objects (DMOs), which are hosted inside the DMO Wrapper.</span></span> <span data-ttu-id="111a6-129">На следующих диаграммах показаны различия между модулем чтения WM ASF и фильтром источника проигрывателя Windows Media.</span><span class="sxs-lookup"><span data-stu-id="111a6-129">The following diagrams illustrate the differences between the WM ASF Reader and the WMP Windows Media Source Filter.</span></span>

![несжатые образцы вывода выходных данных фильтра источника](images/wmp-dxva-graph.png)

![результаты сжатых выборок фильтра источника касф](images/qasf-dxva-graph.png)

<span data-ttu-id="111a6-132">Чтобы включить DirectX для потокового содержимого, необходимо создать настраиваемый фильтр исходного кода, подобный показанному на верхней диаграмме.</span><span class="sxs-lookup"><span data-stu-id="111a6-132">To enable DirectX VA for streamed content, you must create a custom source filter like the one in the top diagram.</span></span> <span data-ttu-id="111a6-133">По сути, этот фильтр будет использовать пакет SDK Windows Media Format для создания экземпляра объекта чтения WM, распаковки образцов и отправки их вверх по выходным креплениям.</span><span class="sxs-lookup"><span data-stu-id="111a6-133">Basically, this filter will use the Windows Media Format SDK to instantiate a WM Reader object, decompress the samples, and send them downstream on its output pins.</span></span> <span data-ttu-id="111a6-134">В этом обсуждении предполагается, что фильтр источника уже создан и теперь готов к реализации поддержки DirectX.</span><span class="sxs-lookup"><span data-stu-id="111a6-134">This discussion assumes that you have created the source filter already and are now ready to implement the DirectX VA support.</span></span>

<span data-ttu-id="111a6-135">Чтобы включить DirectX ва, основная задача фильтра источника заключается в предоставлении модуля подготовки отчетов и декодера WMV с интерфейсами, необходимыми для согласования подключения DirectX.</span><span class="sxs-lookup"><span data-stu-id="111a6-135">To enable DirectX VA, the basic task of the source filter is to provide the Video Renderer and the WMV Decoder DMO with the interfaces they will need to negotiate the DirectX VA connection.</span></span> <span data-ttu-id="111a6-136">Фильтр источника не участвует в этих согласованиях.</span><span class="sxs-lookup"><span data-stu-id="111a6-136">The source filter does not participate in those negotiations.</span></span> <span data-ttu-id="111a6-137">После запуска потоковой передачи единственной задачей, связанной с DirectX, которая может выполнять фильтр источника, является изменение меток времени в видеороликах до того, как декодер WMV доставляет их в модуль подготовки видео.</span><span class="sxs-lookup"><span data-stu-id="111a6-137">After streaming starts, the only DirectX VA-related task that the source filter can perform is to modify the time stamps on the video samples before the WMV decoder delivers them to the Video Renderer.</span></span> <span data-ttu-id="111a6-138">Основной причиной этого является предоставление настраиваемого элемента управления временной шкалой, помимо того, что включает стандартные интерфейсы® DirectShow.</span><span class="sxs-lookup"><span data-stu-id="111a6-138">The primary reason for doing this is to provide custom timeline control beyond what the standard DirectShow® interfaces enable.</span></span>

<span data-ttu-id="111a6-139">Для обеспечения необходимого взаимодействия между пакетом SDK Windows Media Format, фильтром исходного кода проигрывателя, драйвером DMO видеодекодера Windows Media, а также микшером наложения и модулем подготовки видео для микширования определяются три интерфейса.</span><span class="sxs-lookup"><span data-stu-id="111a6-139">Three interfaces are defined to enable the necessary communications between the Windows Media Format SDK, the player's source filter, the Windows Media Video decoder DMO, and the Overlay Mixer or Video Mixing Renderer.</span></span> <span data-ttu-id="111a6-140">Эти интерфейсы описаны в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="111a6-140">These interfaces are described in the following table.</span></span>



| <span data-ttu-id="111a6-141">Интерфейс</span><span class="sxs-lookup"><span data-stu-id="111a6-141">Interface</span></span>                                                        | <span data-ttu-id="111a6-142">Описание</span><span class="sxs-lookup"><span data-stu-id="111a6-142">Description</span></span>                                                                                                                                                                                        |
|------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="111a6-143">**ивмкодекамвидеоакцелератор**</span><span class="sxs-lookup"><span data-stu-id="111a6-143">**IWMCodecAMVideoAccelerator**</span></span>](/previous-versions/windows/desktop/api/wmdxva/nn-wmdxva-iwmcodecamvideoaccelerator) | <span data-ttu-id="111a6-144">Предоставляется драйвером DMO декодера Windows Media и вызывается фильтром источника проигрывателя мультимедиа для настройки различных подключений, необходимых для включения DirectX-поддержки при декодировании видеосодержимого Windows Media.</span><span class="sxs-lookup"><span data-stu-id="111a6-144">Exposed by the Windows Media Decoder DMO and called by a media player's source filter to set up the various connections required to enable DirectX VA for decoding of Windows Media Video content.</span></span> |
| [<span data-ttu-id="111a6-145">**ивмплайертиместамфук**</span><span class="sxs-lookup"><span data-stu-id="111a6-145">**IWMPlayerTimestampHook**</span></span>](/previous-versions/windows/desktop/api/wmdxva/nn-wmdxva-iwmplayertimestamphook)         | <span data-ttu-id="111a6-146">Реализовано в исходном фильтре проигрывателя.</span><span class="sxs-lookup"><span data-stu-id="111a6-146">Implemented on the player's source filter.</span></span> <span data-ttu-id="111a6-147">Он позволяет фильтру изменять метки времени в видеороликах перед их доставкой.</span><span class="sxs-lookup"><span data-stu-id="111a6-147">It enables the filter to modify the time stamps on the video samples before delivering them downstream.</span></span>                                                 |
| [<span data-ttu-id="111a6-148">**ивмреадеракцелератор**</span><span class="sxs-lookup"><span data-stu-id="111a6-148">**IWMReaderAccelerator**</span></span>](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmreaderaccelerator)             | <span data-ttu-id="111a6-149">Реализуется для объекта модуля чтения WM.</span><span class="sxs-lookup"><span data-stu-id="111a6-149">Implemented on the WM Reader object.</span></span> <span data-ttu-id="111a6-150">Он вызывается фильтром источника проигрывателя для получения интерфейсов из декодера DMO.</span><span class="sxs-lookup"><span data-stu-id="111a6-150">It is called by a player source filter to obtain interfaces from the decoder DMO.</span></span>                                                                             |



 

## <a name="order-of-operations-in-directx-vaenabled-playback"></a><span data-ttu-id="111a6-151">Порядок операций в DirectX с поддержкой воспроизведения</span><span class="sxs-lookup"><span data-stu-id="111a6-151">Order of Operations in DirectX VA–enabled Playback</span></span>

<span data-ttu-id="111a6-152">В этом разделе описывается общий порядок операций во время выполнения для проигрывателя с поддержкой DirectX и его фильтра источников.</span><span class="sxs-lookup"><span data-stu-id="111a6-152">This section describes the general order of operations at run time for a DirectX VA-enabled player and its source filter.</span></span> <span data-ttu-id="111a6-153">В этом разделе рассматриваются следующие компоненты:</span><span class="sxs-lookup"><span data-stu-id="111a6-153">The components referred to in this section are:</span></span>

-   <span data-ttu-id="111a6-154">Сторонний проигрыватель мультимедиа, называемый проигрывателем.</span><span class="sxs-lookup"><span data-stu-id="111a6-154">A third-party media player, referred to as the player.</span></span>
-   <span data-ttu-id="111a6-155">Настраиваемый фильтр источника, созданный проигрывателем, который использует пакет SDK Windows Media Format для распаковки содержимого на основе Windows Media.</span><span class="sxs-lookup"><span data-stu-id="111a6-155">A custom source filter, instantiated by the player, that uses the Windows Media Format SDK to decompress Windows Media-based content.</span></span>
-   <span data-ttu-id="111a6-156">Закрепление вывода видео в исходном фильтре проигрывателя, называемое выходным закреплением.</span><span class="sxs-lookup"><span data-stu-id="111a6-156">The video output pin of the player's source filter, referred to as the output pin.</span></span>
-   <span data-ttu-id="111a6-157">Граф фильтра воспроизведения видео DirectShow, называемый графом.</span><span class="sxs-lookup"><span data-stu-id="111a6-157">The DirectShow video playback filter graph, referred to as the graph.</span></span>
-   <span data-ttu-id="111a6-158">Модуль подготовки видео с микшированием, называемый VMR.</span><span class="sxs-lookup"><span data-stu-id="111a6-158">The Video Mixing Renderer, referred to as the VMR.</span></span>
-   <span data-ttu-id="111a6-159">Объект асинхронного модуля чтения пакета SDK Windows Media Format, называемый модулем чтения.</span><span class="sxs-lookup"><span data-stu-id="111a6-159">The Windows Media Format SDK Asynchronous Reader object, referred to as the reader.</span></span>
-   <span data-ttu-id="111a6-160">Объект мультимедиа DirectX декодера Windows Media, называемый декодером DMO.</span><span class="sxs-lookup"><span data-stu-id="111a6-160">The Windows Media Video Decoder DirectX Media Object, referred to as the decoder DMO.</span></span>

<span data-ttu-id="111a6-161">Порядок операций выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="111a6-161">The order of operations is as follows:</span></span>

1.  <span data-ttu-id="111a6-162">Проигрыватель создает экземпляры исходного фильтра и объекта Reader.</span><span class="sxs-lookup"><span data-stu-id="111a6-162">The player instantiates its source filter and a reader object.</span></span> <span data-ttu-id="111a6-163">Читатель создает видеодекодер DMO и задает для него (сжатый) тип входных данных.</span><span class="sxs-lookup"><span data-stu-id="111a6-163">The reader creates a video decoder DMO and sets the (compressed) input type on it.</span></span> <span data-ttu-id="111a6-164">Это должно произойти до того, как проигрыватель попытается настроить граф воспроизведения видео, так как пакет SDK и декодер DMO должны быть вовлечены в процесс согласования с графом, а объекты DMO должны иметь формат входных данных на шаге 9.</span><span class="sxs-lookup"><span data-stu-id="111a6-164">This must happen before the player attempts to configure its video playback graph because the SDK and the decoder DMO must be involved in the negotiation process with the graph, and the DMO must know the input format during step 9.</span></span>
2.  <span data-ttu-id="111a6-165">Проигрыватель вызывает **играфбуилдер:: Render**, предоставляя ему выходной ПИН-код фильтра источника видео.</span><span class="sxs-lookup"><span data-stu-id="111a6-165">The player calls **IGraphBuilder::Render**, providing it the video source filter's output pin.</span></span> <span data-ttu-id="111a6-166">На этом этапе диспетчер графа фильтров DirectShow пытается подключить VMR к фильтру источника видео проигрывателя.</span><span class="sxs-lookup"><span data-stu-id="111a6-166">At this point, the DirectShow filter graph manager tries to connect the VMR to the player's video source filter.</span></span>
3.  <span data-ttu-id="111a6-167">Диспетчер графов фильтров вызывает **Ипин:: Connect** по выходному контакту фильтра источника видео проигрывателя.</span><span class="sxs-lookup"><span data-stu-id="111a6-167">The filter graph manager calls **IPin::Connect** on the output pin of the player's video source filter.</span></span>

<span data-ttu-id="111a6-168">Шаги с 4 по 10 происходят в **Ипин:: Connect**.</span><span class="sxs-lookup"><span data-stu-id="111a6-168">Steps 4 through 10 occur inside of **IPin::Connect**.</span></span>

1.  <span data-ttu-id="111a6-169">Фильтр источника получает интерфейс **ивмкодекамвидеоакцелератор** из метода **Ивмреадеракцелератор:: жеткодеЦинтерфаце** средства чтения.</span><span class="sxs-lookup"><span data-stu-id="111a6-169">The source filter obtains the **IWMCodecAMVideoAccelerator** interface from the reader's **IWMReaderAccelerator::GetCodecInterface** method.</span></span> <span data-ttu-id="111a6-170">Если кодек не поддерживает DirectX ва, вызов **жеткодеЦинтерфаце** может завершиться ошибкой.</span><span class="sxs-lookup"><span data-stu-id="111a6-170">If the codec does not support DirectX VA, the call to **GetCodecInterface** may fail.</span></span> <span data-ttu-id="111a6-171">В этом случае согласование выполняется обычным образом без поддержки DirectX.</span><span class="sxs-lookup"><span data-stu-id="111a6-171">In this case, negotiation proceeds as usual, without DirectX VA support.</span></span>
2.  <span data-ttu-id="111a6-172">Фильтр источника передает указатель **иамвидеоакцелератор** из ПИН-кода, переданного в **Connect** к декодеру DMO через **ивмкодекамвидеоакцелератор:: сетакцелераторинтерфаце**.</span><span class="sxs-lookup"><span data-stu-id="111a6-172">The source filter passes the **IAMVideoAccelerator** pointer from the pin passed into **Connect** to the decoder DMO through **IWMCodecAMVideoAccelerator::SetAcceleratorInterface**.</span></span>
3.  <span data-ttu-id="111a6-173">Затем фильтр источника делегирует оставшуюся часть операции **Ипин::** Connect методу **Кбасеаутпутпин:: Connect** .</span><span class="sxs-lookup"><span data-stu-id="111a6-173">The source filter then delegates the remainder of the **IPin::Connect** operation to the **CBaseOutputPin::Connect** method.</span></span> <span data-ttu-id="111a6-174">Перечисление форматов с помощью пакета SDK продолжается, как и сегодня.</span><span class="sxs-lookup"><span data-stu-id="111a6-174">The format enumeration with the SDK proceeds as it does today.</span></span> <span data-ttu-id="111a6-175">Если кодек поддерживает DirectX ва для подключенного содержимого, то в коде DMO сначала отображаются подтипы DirectX ва, до того как поддерживаются типы YUV и RGB.</span><span class="sxs-lookup"><span data-stu-id="111a6-175">If the codec supports DirectX VA for the content being connected, the codec DMO presents those DirectX VA subtypes first, prior to the YUV and RGB types supported.</span></span> <span data-ttu-id="111a6-176">Если доступна поддержка DirectX ва, то шаги с 7 по 11 попытаются выполнить в контексте подтипа DirectX ва.</span><span class="sxs-lookup"><span data-stu-id="111a6-176">If DirectX VA support is available, steps 7 through 11 are attempted in the context of a DirectX VA subtype.</span></span> <span data-ttu-id="111a6-177">В следующем фрагменте кода показано, как можно опознать мультимедийный подтип носителя DirectX.</span><span class="sxs-lookup"><span data-stu-id="111a6-177">The following code snippet shows how to identify a DirectX VA media subtype.</span></span>
    ```C++
    bool IsDXVASubtype( AM_MEDIA_TYPE * pmt )
    {
        // All DXVA types have the same last 3 DWORDs.
        // guidDXVA is the base GUID for all DXVA subtypes.

        GUID guidDXVA = { 0x00000000, 0xa0c7, 0x11d3, { 0xb9,0x84,0x00,0xc0,0x4f,0x2e,0x73,0xc5 } };

        unsigned long const * plguid;
        unsigned long const * plguidDXVA;
        plguid = (unsigned long const *)&pmt->subtype;
        plguidDXVA = (unsigned long *)&guidDXVA;

        if( ( plguid[1] == plguidDXVA[1] ) &&
            ( plguid[2] == plguidDXVA[2] ) &&
            ( plguid[3] == plguidDXVA[3] ) )
        {
            return true;
        }

        return false;
    }
    
    ```

    

4.  <span data-ttu-id="111a6-178">Реализация **кбасеаутпутпин:: Connect** вызывает **Ипин:: комплетеконнект** во время шага 3.</span><span class="sxs-lookup"><span data-stu-id="111a6-178">The **CBaseOutputPin::Connect** implementation calls **IPin::CompleteConnect** during step 3.</span></span> <span data-ttu-id="111a6-179">Если подтипы DirectX ва рассматриваются, выполняется согласование DirectX.</span><span class="sxs-lookup"><span data-stu-id="111a6-179">If a DirectX VA subtype is being considered, the DirectX VA negotiation is attempted.</span></span> <span data-ttu-id="111a6-180">Выходной ПИН-код вызывает **ивмкодекамвидеоакцелератор:: неготиатеконнектион**, передавая ему текущий тип выходного носителя.</span><span class="sxs-lookup"><span data-stu-id="111a6-180">The output pin calls **IWMCodecAMVideoAccelerator::NegotiateConnection**, passing it the current output media type.</span></span>
5.  <span data-ttu-id="111a6-181">Декодер DMO выполняет необходимое согласование с VMR через интерфейс **иамвидеоакцелератор** и возвращает идентификатор GUID подтипа видео, для которого согласованы два.</span><span class="sxs-lookup"><span data-stu-id="111a6-181">The decoder DMO performs the required negotiation with the VMR through the **IAMVideoAccelerator** interface, and returns the video subtype GUID that the two have agreed on.</span></span> <span data-ttu-id="111a6-182">Закрепление вывода делегирует все вызовы **иамвидеоакцелераторнотифи** , полученные во время этого процесса, в интерфейс **ИАМВИДЕОАКЦЕЛЕРАТОРНОТИФИ** декодера DMO, который также можно получить с помощью метода **ивмреадеракцелератор:: жеткодеЦинтерфаце** .</span><span class="sxs-lookup"><span data-stu-id="111a6-182">The output pin delegates all **IAMVideoAcceleratorNotify** calls received during this process to the decoder DMO's **IAMVideoAcceleratorNotify** interface, which can also be obtained through the **IWMReaderAccelerator::GetCodecInterface** method.</span></span>
6.  <span data-ttu-id="111a6-183">Если **неготиатеконнектион** , то выходной ПИН-код вызывает **Ивмкодекамвидеоакцелератор:: сетплайернотифи** с интерфейсом **ивмплайертиместамфук** .</span><span class="sxs-lookup"><span data-stu-id="111a6-183">If **NegotiateConnection** succeeds, the output pin calls **IWMCodecAMVideoAccelerator::SetPlayerNotify** with an **IWMPlayerTimestampHook** interface.</span></span> <span data-ttu-id="111a6-184">Этот обработчик позволяет исходному фильтру обновлять отметки времени в примерах перед их передачей в модуль подготовки отчетов.</span><span class="sxs-lookup"><span data-stu-id="111a6-184">This hook allows the source filter to update the time stamps on the samples before they are handed to the renderer.</span></span>
7.  <span data-ttu-id="111a6-185">Фильтр источника вызывает **ивмреадеракцелератор:: notify** с согласованным типом носителя.</span><span class="sxs-lookup"><span data-stu-id="111a6-185">The source filter calls **IWMReaderAccelerator::Notify** with the negotiated media type.</span></span> <span data-ttu-id="111a6-186">Это позволяет модулю чтения обновлять свои внутренние переменные и фиксировать в DirectX ва.</span><span class="sxs-lookup"><span data-stu-id="111a6-186">This allows the reader to update its internal variables and commit to DirectX VA.</span></span> <span data-ttu-id="111a6-187">Это Последнее место, в котором кодек или модуль чтения могут завершиться ошибкой.</span><span class="sxs-lookup"><span data-stu-id="111a6-187">This is the last place the codec or reader can fail.</span></span> <span data-ttu-id="111a6-188">Если какой либо из указанных выше шагов завершится ошибкой, фильтр источника должен вернуться к шагу 3 и попробовать следующий тип, перечисленный модулем чтения.</span><span class="sxs-lookup"><span data-stu-id="111a6-188">If any of the above steps fail, the source filter should return to step 3 and try the next type enumerated by the reader.</span></span>
8.  <span data-ttu-id="111a6-189">Начинается воспроизведение.</span><span class="sxs-lookup"><span data-stu-id="111a6-189">Playback starts.</span></span> <span data-ttu-id="111a6-190">Модуль чтения пропускает выходные буферы из декодера DMO, если тип выходных данных соединения — DirectX ва.</span><span class="sxs-lookup"><span data-stu-id="111a6-190">The reader ignores output buffers from the decoder DMO if the connection output type is DirectX VA.</span></span>
9.  <span data-ttu-id="111a6-191">Когда происходит **Ипин::D** , фильтр источника вызывает **Ивмкодекамвидеоакцелератор:: Сетакцелераторинтерфаце** со **значением NULL**.</span><span class="sxs-lookup"><span data-stu-id="111a6-191">When **IPin::Disconnect** occurs, the source filter calls **IWMCodecAMVideoAccelerator::SetAcceleratorInterface** with a **NULL**.</span></span> <span data-ttu-id="111a6-192">Это нарушает подключение DirectX о связи между кодеком и модулем подготовки.</span><span class="sxs-lookup"><span data-stu-id="111a6-192">This breaks the DirectX VA connection between the codec and the renderer.</span></span>

## <a name="related-topics"></a><span data-ttu-id="111a6-193">См. также</span><span class="sxs-lookup"><span data-stu-id="111a6-193">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="111a6-194">**Чтение файлов ASF**</span><span class="sxs-lookup"><span data-stu-id="111a6-194">**Reading ASF Files**</span></span>](reading-asf-files.md)
</dt> </dl>

 

 




