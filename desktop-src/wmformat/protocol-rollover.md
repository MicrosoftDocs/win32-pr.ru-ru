---
title: Смена протокола
description: Смена протокола
ms.assetid: 61db5e2b-4858-446e-9a27-e0305b46683d
keywords:
- Windows Media Format SDK, переключение протокола
- Расширенный системный формат (ASF), переключение протокола
- ASF (Расширенный системный формат), переключение протокола
- Смена протокола
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b2de8d0496467535f5740a10082f82e285c11ef6
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "104069572"
---
# <a name="protocol-rollover"></a><span data-ttu-id="b1d46-107">Смена протокола</span><span class="sxs-lookup"><span data-stu-id="b1d46-107">Protocol Rollover</span></span>

<span data-ttu-id="b1d46-108">Переключение протокола — это процесс, при котором объект чтения обнаруживает лучший протокол потоковой передачи, доступный с сервера.</span><span class="sxs-lookup"><span data-stu-id="b1d46-108">Protocol rollover is a process whereby the reader object discovers the best streaming protocol available from a server.</span></span> <span data-ttu-id="b1d46-109">При открытии URL-адреса, содержащего схему "MMS", модуль чтения использует смену протокола.</span><span class="sxs-lookup"><span data-stu-id="b1d46-109">The reader uses protocol rollover whenever it opens a URL that contains an "mms" scheme.</span></span>

<span data-ttu-id="b1d46-110">Модуль чтения поддерживает несколько протоколов:</span><span class="sxs-lookup"><span data-stu-id="b1d46-110">The reader supports several protocols:</span></span>

-   <span data-ttu-id="b1d46-111">Протокол передачи данных в реальном времени (RTSP)</span><span class="sxs-lookup"><span data-stu-id="b1d46-111">Real Time Streaming Protocol (RTSP)</span></span>
-   <span data-ttu-id="b1d46-112">Протокол HTTP</span><span class="sxs-lookup"><span data-stu-id="b1d46-112">Hypertext Transfer Protocol (HTTP)</span></span>
-   <span data-ttu-id="b1d46-113">Microsoft Media Server (MMS)</span><span class="sxs-lookup"><span data-stu-id="b1d46-113">Microsoft Media Server (MMS)</span></span>

<span data-ttu-id="b1d46-114">Протоколы RTSP и MMS имеют две разновидности: один использует [*UDP*](wmformat-glossary.md) в качестве базового протокола доставки, а другой — по протоколу TCP.</span><span class="sxs-lookup"><span data-stu-id="b1d46-114">The RTSP and MMS protocols both come in two flavors, one using [*UDP*](wmformat-glossary.md) as the underlying delivery protocol, and the other using TCP.</span></span>

<span data-ttu-id="b1d46-115">Объект модуля чтения всегда использует протокол TCP для команд управления воспроизведением, но он может использовать TCP или UDP для доставки потокового содержимого.</span><span class="sxs-lookup"><span data-stu-id="b1d46-115">The reader object always uses TCP for playback control commands, but it can use either TCP or UDP for delivery of the streamed content.</span></span> <span data-ttu-id="b1d46-116">Протокол UDP является предпочтительным для доставки содержимого, так как он накладывает меньше ресурсов на пропускную способность, чем TCP.</span><span class="sxs-lookup"><span data-stu-id="b1d46-116">UDP is preferred for content delivery, because it imposes less bandwidth overhead than TCP.</span></span> <span data-ttu-id="b1d46-117">Протокол TCP обеспечивает надежный транспорт с помощью виртуальных каналов, но стоимость этого означает, что протокол TCP не так хорошо подходит для цифровых мультимедийных потоков, где эффективное использование пропускной способности является более важным, чем случайные потерянные пакеты.</span><span class="sxs-lookup"><span data-stu-id="b1d46-117">The TCP protocol ensures reliable transport through the use of "virtual circuits," but the cost of doing so means that TCP is not as well suited for digital media streams, where efficient use of bandwidth is more important that occasional lost packets.</span></span>

<span data-ttu-id="b1d46-118">Если URL-адрес указывает "mms://", средство чтения пытается использовать следующие протоколы для доставки данных в следующем порядке:</span><span class="sxs-lookup"><span data-stu-id="b1d46-118">When a URL specifies "mms://", the reader attempts to use the following protocols for data delivery, in the following order:</span></span>

1.  <span data-ttu-id="b1d46-119">РТСПУ (RTSP с использованием UDP)</span><span class="sxs-lookup"><span data-stu-id="b1d46-119">RTSPU (RTSP using UDP)</span></span>
2.  <span data-ttu-id="b1d46-120">Протокол RTSP (RTSP с использованием TCP)</span><span class="sxs-lookup"><span data-stu-id="b1d46-120">RTSPT (RTSP using TCP)</span></span>
3.  <span data-ttu-id="b1d46-121">ММСУ (MMS с использованием UDP)</span><span class="sxs-lookup"><span data-stu-id="b1d46-121">MMSU (MMS using UDP)</span></span>
4.  <span data-ttu-id="b1d46-122">ММСТ (MMS по протоколу TCP)</span><span class="sxs-lookup"><span data-stu-id="b1d46-122">MMST (MMS using TCP)</span></span>
5.  <span data-ttu-id="b1d46-123">HTTP</span><span class="sxs-lookup"><span data-stu-id="b1d46-123">HTTP</span></span>

<span data-ttu-id="b1d46-124">HTTP является односторонним протоколом, основанным на протоколе TCP, и является протоколом, используемым веб-серверами.</span><span class="sxs-lookup"><span data-stu-id="b1d46-124">HTTP is a one-way protocol based on TCP, and is the protocol used by Web servers.</span></span> <span data-ttu-id="b1d46-125">Потоковая передача с использованием HTTP менее эффективна, чем использование протокола RTSP.</span><span class="sxs-lookup"><span data-stu-id="b1d46-125">Streaming with HTTP is less efficient that using RTSP.</span></span> <span data-ttu-id="b1d46-126">Однако большинство брандмауэров настроены на прием HTTP-запросов, тогда как они обычно отклоняют другие протоколы потоковой передачи.</span><span class="sxs-lookup"><span data-stu-id="b1d46-126">However, most firewalls are configured to accept HTTP requests, whereas they typically reject other streaming protocols.</span></span>

<span data-ttu-id="b1d46-127">Серия Windows Media Services 9 в Microsoft Windows Server 2003 будет отклонять любые запросы ММСУ или ММСТ из средства чтения пакетов SDK формата Windows Media, так как протокол RTSP является предпочтительным.</span><span class="sxs-lookup"><span data-stu-id="b1d46-127">Windows Media Services 9 Series in Microsoft Windows Server 2003 will reject any MMSU or MMST requests from a Windows Media Format SDK reader, because RTSP is the preferred streaming protocol.</span></span> <span data-ttu-id="b1d46-128">Службы Windows Media версии 4,1 и более ранних версий не поддерживают протокол RTSP.</span><span class="sxs-lookup"><span data-stu-id="b1d46-128">Windows Media Services version 4.1 and earlier do not support RTSP.</span></span> <span data-ttu-id="b1d46-129">В этом случае объект модуля чтения возвращается к ММСУ или HTTP.</span><span class="sxs-lookup"><span data-stu-id="b1d46-129">In this case the reader object falls back to MMSU or HTTP.</span></span>

<span data-ttu-id="b1d46-130">Переключение протокола не применяется, если схема URL-адресов предоставляет конкретный протокол, например "rtspu://" для РТСПУ или "https://" для HTTP.</span><span class="sxs-lookup"><span data-stu-id="b1d46-130">Protocol rollover does not apply if the URL scheme gives a specific protocol, such as "rtspu://" for RTSPU or "https://" for HTTP.</span></span> <span data-ttu-id="b1d46-131">Если схема URL-адресов имеет значение "rtsp://", модуль чтения пытается выполнить РТСПУ и RTSP, но не другие.</span><span class="sxs-lookup"><span data-stu-id="b1d46-131">If the URL scheme is "rtsp://", the reader tries RTSPU and RTSPT, but no others.</span></span>

<span data-ttu-id="b1d46-132">После того, как средство чтения откроет файл, можно запросить используемый протокол, вызвав метод [**IWMReaderAdvanced2:: жетпротоколнаме**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmreaderadvanced2-getprotocolname) в модуле чтения.</span><span class="sxs-lookup"><span data-stu-id="b1d46-132">After the reader opens a file, you can query which protocol it is using by calling the [**IWMReaderAdvanced2::GetProtocolName**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmreaderadvanced2-getprotocolname) method on the reader.</span></span> <span data-ttu-id="b1d46-133">Во время потоковой передачи или загрузки содержимого этот метод возвращает имя, как только содержимое будет полностью кэшировано, метод **жетпротоколнаме** возвращает строку "Cache".</span><span class="sxs-lookup"><span data-stu-id="b1d46-133">While the content is being streamed or downloaded, this method returns the name as soon as the content is completely cached, the **GetProtocolName** method returns the string "Cache."</span></span>

<span data-ttu-id="b1d46-134">Чтобы получить имена всех протоколов Windows Media Server, поддерживаемых средством чтения, вызовите метод [**ивмреадернетворкконфиг:: жетсуппортедпротоколнаме**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmreadernetworkconfig-getsupportedprotocolname) в модуле чтения.</span><span class="sxs-lookup"><span data-stu-id="b1d46-134">To get the names of all the Windows Media server protocols that the reader supports, call the [**IWMReaderNetworkConfig::GetSupportedProtocolName**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmreadernetworkconfig-getsupportedprotocolname) method on the reader.</span></span> <span data-ttu-id="b1d46-135">Вы можете отключить один или несколько протоколов в списке переключения протокола средства чтения с помощью интерфейса **ивмреадернетворкконфиг** .</span><span class="sxs-lookup"><span data-stu-id="b1d46-135">You can disable one or more of the protocols in the reader's protocol rollover list, using **IWMReaderNetworkConfig** interface.</span></span> <span data-ttu-id="b1d46-136">Например, метод [**ивмреадернетворкконфиг:: сетенаблеткп**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmreadernetworkconfig-setenabletcp) включает или отключает протоколы на основе TCP, а [**Ивмреадернетворкконфиг:: сетенаблеудп**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmreadernetworkconfig-setenableudp) включает или отключает протоколы на основе UDP.</span><span class="sxs-lookup"><span data-stu-id="b1d46-136">For example, the [**IWMReaderNetworkConfig::SetEnableTCP**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmreadernetworkconfig-setenabletcp) method enables or disables the TCP-based protocols, and [**IWMReaderNetworkConfig::SetEnableUDP**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmreadernetworkconfig-setenableudp) enables or disables the UDP-based protocols.</span></span> <span data-ttu-id="b1d46-137">Эти методы применяются только к смене протокола. протоколы по-прежнему доступны, если схема URL-адресов содержит конкретный протокол.</span><span class="sxs-lookup"><span data-stu-id="b1d46-137">These methods apply only to protocol rollover; the protocols are still available if the URL scheme contains a specific protocol.</span></span> <span data-ttu-id="b1d46-138">Обычно нет причин отключить какие-либо протоколы, используемые при смене протокола. Это может привести к снижению производительности.</span><span class="sxs-lookup"><span data-stu-id="b1d46-138">There is usually no reason to disable any of the protocols used in protocol rollover; doing so can degrade performance.</span></span> <span data-ttu-id="b1d46-139">Однако он может быть полезен для тестирования.</span><span class="sxs-lookup"><span data-stu-id="b1d46-139">However, it might be useful for testing.</span></span>

 

 




