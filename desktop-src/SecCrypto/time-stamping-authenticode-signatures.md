---
description: Отметка времени Authenticode основана на стандартных \# подписях PKCS 7. Средства подписывания от корпорации Майкрософт позволяют разработчикам закреплять отметки времени в то же время, когда они прикреплены к сигнатурам Authenticode.
ms.assetid: d0bd3e2f-1eee-4f71-9467-974994f720d5
title: Метки времени подписи Authenticode
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0232853441d2c11d331c175ac7e8dfd120b341ff
ms.sourcegitcommit: dc2f43e0f23f4a4ce239118cf9a5180f3ff0dd1d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/30/2021
ms.locfileid: "108327189"
---
# <a name="time-stamping-authenticode-signatures"></a><span data-ttu-id="89729-104">Метки времени подписи Authenticode</span><span class="sxs-lookup"><span data-stu-id="89729-104">Time Stamping Authenticode Signatures</span></span>

<span data-ttu-id="89729-105">Подписи Microsoft Authenticode обеспечивают гарантии автору и целостности для двоичных данных.</span><span class="sxs-lookup"><span data-stu-id="89729-105">Microsoft Authenticode signatures provide authorship and integrity guarantees for binary data.</span></span> <span data-ttu-id="89729-106">Отметка времени Authenticode основана на стандартных \# подписях PKCS 7.</span><span class="sxs-lookup"><span data-stu-id="89729-106">Authenticode time stamping is based on standard PKCS \#7 countersignatures.</span></span> <span data-ttu-id="89729-107">Средства подписывания от корпорации Майкрософт позволяют разработчикам закреплять отметки времени в то же время, когда они прикреплены к сигнатурам Authenticode.</span><span class="sxs-lookup"><span data-stu-id="89729-107">Signing tools from Microsoft allow developers to affix time stamps at the same time as they affix Authenticode signatures.</span></span> <span data-ttu-id="89729-108">Отметка времени позволяет проверять подписи Authenticode даже после истечения срока действия сертификатов, используемых для подписи.</span><span class="sxs-lookup"><span data-stu-id="89729-108">Time stamping allows Authenticode signatures to be verifiable even after the certificates used for signature have expired.</span></span>

## <a name="a-brief-introduction-to-authenticode"></a><span data-ttu-id="89729-109">Краткое введение в Authenticode</span><span class="sxs-lookup"><span data-stu-id="89729-109">A Brief Introduction to Authenticode</span></span>

<span data-ttu-id="89729-110">[*Authenticode*](../secgloss/a-gly.md) применяет технологию цифровой подписи, чтобы гарантировать автор и целостность двоичных данных, таких как устанавливаемое программное обеспечение.</span><span class="sxs-lookup"><span data-stu-id="89729-110">[*Authenticode*](../secgloss/a-gly.md) applies digital signature technology to guarantee the authorship and integrity of binary data such as installable software.</span></span> <span data-ttu-id="89729-111">Клиентский веб-браузер или другие системные компоненты могут использовать подписи Authenticode для проверки целостности данных при скачивании или установке программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="89729-111">A client web browser, or other system components, can use the Authenticode signatures to verify the integrity of the data when the software is downloaded or installed.</span></span> <span data-ttu-id="89729-112">Подписи Authenticode можно использовать во многих форматах программного обеспечения, включая CAB, exe, OCX и DLL.</span><span class="sxs-lookup"><span data-stu-id="89729-112">Authenticode signatures can be used with many software formats, including .cab, .exe, .ocx, and .dll.</span></span>

<span data-ttu-id="89729-113">Корпорация Майкрософт поддерживает список общедоступных [*центров сертификации*](/security/trusted-root/participants-list) (CAS).</span><span class="sxs-lookup"><span data-stu-id="89729-113">Microsoft maintains a list of public [*certification authorities*](/security/trusted-root/participants-list) (CAs).</span></span> <span data-ttu-id="89729-114">Издатели сертификатов Authenticode в настоящее время включают [SSL.com](https://www.ssl.com/), [DigiCert](https://www.digicert.com/), [Сектиго (Comodo)](https://www.sectigo.com/)и [глобалсигн](https://www.globalsign.com/).</span><span class="sxs-lookup"><span data-stu-id="89729-114">Issuers of Authenticode certificates currently include [SSL.com](https://www.ssl.com/), [Digicert](https://www.digicert.com/), [Sectigo(Comodo)](https://www.sectigo.com/), and [GlobalSign](https://www.globalsign.com/).</span></span>

## <a name="about-cryptographic-time-stamping"></a><span data-ttu-id="89729-115">О криптографической отметке времени</span><span class="sxs-lookup"><span data-stu-id="89729-115">About Cryptographic Time Stamping</span></span>

<span data-ttu-id="89729-116">В прошлом были предложены различные методы криптографических меток времени.</span><span class="sxs-lookup"><span data-stu-id="89729-116">In the past, a variety of cryptographic time stamping methods have been proposed.</span></span> <span data-ttu-id="89729-117">См., например, Хабер и Сторнетта "как Time-Stamp цифровой документ" в *журнале криптологи* (1991) и беналох и де Маре "односторонние агрегаты: децентрализованная альтернатива цифровым подписям" в *Springer Link-Верлаг конспектах в* Ах. 765 (еурокрипт "93").</span><span class="sxs-lookup"><span data-stu-id="89729-117">See, for example, Haber and Stornetta "How to Time-Stamp a Digital Document" in the *Journal of Cryptology* (1991) and Benaloh and de Mare "One-Way Accumulators: A Decentralized Alternative to Digital Signatures" in *Springer-Verlag Lecture Notes in Computer Science* vol. 765 (EUROCRYPT '93).</span></span> <span data-ttu-id="89729-118">Расширенная выдержка из этой статьи доступна в [Microsoft Research](https://research.microsoft.com/research/pubs/view.aspx?id=233&type=Publication&0sr=a).</span><span class="sxs-lookup"><span data-stu-id="89729-118">An extended abstract of this article is available from [Microsoft Research](https://research.microsoft.com/research/pubs/view.aspx?id=233&type=Publication&0sr=a).</span></span> <span data-ttu-id="89729-119">(Эти ресурсы могут быть недоступны в некоторых языках и странах или регионах.) Поскольку время является физическим, а не математическим количеством, эти методы обычно связаны с тем, как связывать объекты, чтобы можно было определить порядок их создания или как эффективно сгруппировать объекты, которые могут быть описаны как созданные параллельно.</span><span class="sxs-lookup"><span data-stu-id="89729-119">(These resources may not be available in some languages and countries or regions.) Because time is a physical, rather than a mathematical, quantity, these methods generally concern how to link objects so that their order of creation can be determined or how to efficiently group objects that can all be described as having been created concurrently.</span></span>

<span data-ttu-id="89729-120">Системам, которые выводят на себя проверку подлинности как количество, всегда требуется какое-либо доверие.</span><span class="sxs-lookup"><span data-stu-id="89729-120">Systems that purport to authenticate time as a quantity always require some form of trust.</span></span> <span data-ttu-id="89729-121">В строго отчужденияном параметре можно использовать сложные протоколы, чтобы обеспечить некоторую степень согласованностью по.</span><span class="sxs-lookup"><span data-stu-id="89729-121">In a strongly adversarial setting, complex protocols can be used to ensure some degree of synchrony.</span></span> <span data-ttu-id="89729-122">Однако для этих протоколов требуется обширное взаимодействие между заинтересованными сторонами.</span><span class="sxs-lookup"><span data-stu-id="89729-122">However, these protocols require extensive interaction between affected parties.</span></span> <span data-ttu-id="89729-123">На практике, если одному из них требуется только сертификация времени из надежного источника, источник может просто действовать как Нотари, предоставляя подписанный оператор (сертификация), который объект был представлен для подписи в указанное время.</span><span class="sxs-lookup"><span data-stu-id="89729-123">In practice, if one only needs certification of time from a trusted source, the source can simply act as a notary by providing a signed statement (certification) that the object was presented for signature at the indicated time.</span></span>

<span data-ttu-id="89729-124">Метод метки времени, реализованный ниже, позволяет проверять подписи даже после истечения срока действия сертификата подписи или его отзыва.</span><span class="sxs-lookup"><span data-stu-id="89729-124">The countersignature method of time stamping implemented below allows for signatures to be verified even after the signing certificate has expired or been revoked.</span></span> <span data-ttu-id="89729-125">Метка времени позволяет средству проверки надежно понять время, когда была прикреплена подпись, и, таким образом, доверять подписи, если она была действительной в это время.</span><span class="sxs-lookup"><span data-stu-id="89729-125">The time stamp allows the verifier to reliably know the time that the signature was affixed and thereby trust the signature if it was valid at that time.</span></span> <span data-ttu-id="89729-126">Время Стампер должно иметь надежный и защищенный источник времени.</span><span class="sxs-lookup"><span data-stu-id="89729-126">The time stamper should have a reliable and protected time source.</span></span>

## <a name="pkcs-7-signed-documents-and-countersignatures"></a><span data-ttu-id="89729-127">\#Подписанные документы PKCS 7 и подписи от других сторон</span><span class="sxs-lookup"><span data-stu-id="89729-127">PKCS \#7 Signed Documents and Countersignatures</span></span>

<span data-ttu-id="89729-128">PKCS \# 7 — это стандартный формат для криптографических данных, включая подписанные данные, сертификаты и [*списки отзыва сертификатов*](../secgloss/c-gly.md) (CRL).</span><span class="sxs-lookup"><span data-stu-id="89729-128">PKCS \#7 is a standard format for cryptographic data, including signed data, certificates, and [*certificate revocation lists*](../secgloss/c-gly.md) (CRLs).</span></span> <span data-ttu-id="89729-129">Конкретный \# интересующий тип PKCS 7 в контексте отметки времени — это подписанные данные, соответствующие стандартному \# типу содержимого [**сигнеддата**](signeddata.md) PKCS 7.</span><span class="sxs-lookup"><span data-stu-id="89729-129">The particular PKCS \#7 type of interest in the context of time stamping is signed data, corresponding to the PKCS \#7 defined [**SignedData**](signeddata.md) content type.</span></span>

<span data-ttu-id="89729-130">Пакет PKCS \# 7 состоит из [**сигнеддата**](signeddata.md) , который определяет реальное содержимое и некоторые сведения о них и блоках сигнатур SignerInfo.</span><span class="sxs-lookup"><span data-stu-id="89729-130">The PKCS \#7 package consists of [**SignedData**](signeddata.md) that identifies the actual content and certain information about it and SignerInfo signature blocks.</span></span> <span data-ttu-id="89729-131">SignerInfo может сам содержать подпись другой стороны, которая рекурсивно является еще одной SignerInfoой.</span><span class="sxs-lookup"><span data-stu-id="89729-131">A SignerInfo may itself contain a countersignature, which recursively is another SignerInfo.</span></span> <span data-ttu-id="89729-132">В принципе, может присутствовать последовательность таких подписей.</span><span class="sxs-lookup"><span data-stu-id="89729-132">In principle, a sequence of such countersignatures may be present.</span></span> <span data-ttu-id="89729-133">Подпись другой стороны — это атрибут, не прошедший проверку подлинности, в отношении сигнатуры в SignerInfo; то есть, он может быть прикреплен к исходной сигнатуре.</span><span class="sxs-lookup"><span data-stu-id="89729-133">The countersignature is an unauthenticated attribute with respect to the signature in the SignerInfo; that is, it may be affixed subsequent to the original signature.</span></span> <span data-ttu-id="89729-134">В форме структуры:</span><span class="sxs-lookup"><span data-stu-id="89729-134">In outline form:</span></span>

<span data-ttu-id="89729-135">[**Сигнеддата**](signeddata.md) (PKCS \# 7)</span><span class="sxs-lookup"><span data-stu-id="89729-135">[**SignedData**](signeddata.md) (PKCS \#7)</span></span>

-   <span data-ttu-id="89729-136">Версия (из PKCS \# 7, обычно версия 1)</span><span class="sxs-lookup"><span data-stu-id="89729-136">Version (of PKCS \#7, generally version 1)</span></span>
-   <span data-ttu-id="89729-137">Дижесталгорисмс (коллекция всех алгоритмов, используемых блоками сигнатур SignerInfo, для оптимизированной обработки)</span><span class="sxs-lookup"><span data-stu-id="89729-137">DigestAlgorithms (collection of all algorithms used by SignerInfo signature blocks, for optimized processing)</span></span>
-   <span data-ttu-id="89729-138">Контентинфо (contentType равняется [**сигнеддата**](signeddata.md), а содержимое или ссылка на содержимое)</span><span class="sxs-lookup"><span data-stu-id="89729-138">ContentInfo (contentType equals [**SignedData**](signeddata.md), plus content or reference to content)</span></span>
-   <span data-ttu-id="89729-139">Необязательные сертификаты (коллекция всех используемых сертификатов)</span><span class="sxs-lookup"><span data-stu-id="89729-139">OPTIONAL Certificates (collection of all certificates used)</span></span>
-   <span data-ttu-id="89729-140">Необязательные списки отзыва сертификатов (коллекция всех списков отзыва сертификатов)</span><span class="sxs-lookup"><span data-stu-id="89729-140">OPTIONAL CRLs (collection of all CRLs)</span></span>
-   <span data-ttu-id="89729-141">Блоки сигнатур SignerInfo (фактическая подпись, состоящая из одного или нескольких блоков подписи SignerInfo)</span><span class="sxs-lookup"><span data-stu-id="89729-141">SignerInfo signature blocks (the actual signature, composed of one or more SignerInfo signature blocks)</span></span>

<span data-ttu-id="89729-142">SignerInfo (блок сигнатуры)</span><span class="sxs-lookup"><span data-stu-id="89729-142">SignerInfo (the signature block)</span></span>

-   <span data-ttu-id="89729-143">Версия (из PKCS \# 7, обычно версия 1)</span><span class="sxs-lookup"><span data-stu-id="89729-143">Version (of PKCS \#7, generally version 1)</span></span>
-   <span data-ttu-id="89729-144">Сертификат (поставщик и серийный номер для уникальной идентификации сертификата подписывания в [**сигнеддата**](signeddata.md))</span><span class="sxs-lookup"><span data-stu-id="89729-144">Certificate (issuer and serial number to uniquely identify of signer's certificate in [**SignedData**](signeddata.md))</span></span>
-   <span data-ttu-id="89729-145">Дижесталгорисм и Дижестенкриптионалгорисм, а также дайджест (хэш), а также Енкриптеддижест (фактическая подпись)</span><span class="sxs-lookup"><span data-stu-id="89729-145">DigestAlgorithm plus the DigestEncryptionAlgorithm plus the Digest (hash), plus the EncryptedDigest (actual signature)</span></span>
-   <span data-ttu-id="89729-146">Необязательный Аусентикатедаттрибутес (например, подписанный этим подписавшим)</span><span class="sxs-lookup"><span data-stu-id="89729-146">OPTIONAL AuthenticatedAttributes (for example, signed by this signer)</span></span>
-   <span data-ttu-id="89729-147">Необязательный Унаусентикатедаттрибутес (например, не подписанный этим подписавшим)</span><span class="sxs-lookup"><span data-stu-id="89729-147">OPTIONAL UnauthenticatedAttributes (for example, not signed by this signer)</span></span>

<span data-ttu-id="89729-148">Примером атрибута, прошедшего проверку подлинности, является время подписи (OID 1.2.840.113549.1.9.5), поскольку оно является частью того, что это за подпись службы отметок времени.</span><span class="sxs-lookup"><span data-stu-id="89729-148">An example of an authenticated attribute is the signing time (OID 1.2.840.113549.1.9.5) because it is part of what the time stamp service signs.</span></span> <span data-ttu-id="89729-149">Примером непроверенного атрибута является подпись другой стороны (OID 1.2.840.113549.1.9.6), так как она может быть прикреплена после подписи.</span><span class="sxs-lookup"><span data-stu-id="89729-149">An example of an unauthenticated attribute is the countersignature (OID 1.2.840.113549.1.9.6) because it can be affixed after signing.</span></span> <span data-ttu-id="89729-150">В этом случае сам SignerInfo содержит SignerInfo (подпись другой стороны).</span><span class="sxs-lookup"><span data-stu-id="89729-150">In this case, the SignerInfo itself contains a SignerInfo (the Countersignature).</span></span>

> [!Note]  
> <span data-ttu-id="89729-151">Объект, подписанный в другой подписи, является исходной сигнатурой (то есть Енкриптеддижест исходного SignerInfo).</span><span class="sxs-lookup"><span data-stu-id="89729-151">The object that is signed in the countersignature is the original signature (that is, the EncryptedDigest of the original SignerInfo).</span></span>

 

## <a name="signtool-and-the-authenticode-process"></a><span data-ttu-id="89729-152">Средство SignTool и процесс Authenticode</span><span class="sxs-lookup"><span data-stu-id="89729-152">SignTool and the Authenticode Process</span></span>

<span data-ttu-id="89729-153">Средство [SignTool](signtool.md) доступно для подписывания Authenticode и двоичных данных отметок времени.</span><span class="sxs-lookup"><span data-stu-id="89729-153">[SignTool](signtool.md) is available for Authenticode signing and time stamping binary data.</span></span> <span data-ttu-id="89729-154">Средство устанавливается в \\ папку bin пути установки пакета средств разработки программного обеспечения (SDK) для Microsoft Windows.</span><span class="sxs-lookup"><span data-stu-id="89729-154">The tool is installed in the \\Bin folder of the Microsoft Windows Software Development Kit (SDK) installation path.</span></span>

<span data-ttu-id="89729-155">Двоичные данные для подписи и отметок времени относительно просты при использовании средства [SignTool](signtool.md).</span><span class="sxs-lookup"><span data-stu-id="89729-155">Signing and time stamping binary data is relatively straightforward using [SignTool](signtool.md).</span></span> <span data-ttu-id="89729-156">Издатель должен получить сертификат подписи кода из коммерческого ЦС для подписи кода.</span><span class="sxs-lookup"><span data-stu-id="89729-156">The publisher must get a code signing certificate from a commercial code signing CA.</span></span> <span data-ttu-id="89729-157">Для удобства Корпорация Майкрософт публикует и обновляет список общедоступных центров сертификации, включая те, которые выдают сертификаты Authenticode.</span><span class="sxs-lookup"><span data-stu-id="89729-157">For convenience, Microsoft publishes and updates a list of public CAs, including those that issue Authenticode certificates.</span></span> <span data-ttu-id="89729-158">При готовности к публикации объектные файлы подписываются и отметок времени с использованием соответствующих параметров командной строки с помощью средства SignTool.</span><span class="sxs-lookup"><span data-stu-id="89729-158">When ready to publish, the object files are signed and time stamped using appropriate command line parameters with the SignTool tool.</span></span> <span data-ttu-id="89729-159">Результатом любой операции SignTool всегда является \# Формат PKCS 7 [**сигнеддата**](signeddata.md).</span><span class="sxs-lookup"><span data-stu-id="89729-159">The result of any SignTool operation is always a PKCS \#7 format [**SignedData**](signeddata.md).</span></span>

<span data-ttu-id="89729-160">Средство SignTool принимает в качестве входных данных необработанные двоичные данные, которые должны быть подписаны, имеют отметку времени или ранее подписанные двоичные данные.</span><span class="sxs-lookup"><span data-stu-id="89729-160">SignTool accepts as input either raw binary data to be signed and time stamped, or previously signed binary data to be time stamped.</span></span> <span data-ttu-id="89729-161">Данные, которые ранее были подписаны, могут отмечаться с помощью команды " **отметка времени" SignTool** .</span><span class="sxs-lookup"><span data-stu-id="89729-161">Data that has previously been signed can be time stamped by using the **signtool timestamp** command.</span></span>



| <span data-ttu-id="89729-162">Аргумент</span><span class="sxs-lookup"><span data-stu-id="89729-162">Argument</span></span>             | <span data-ttu-id="89729-163">Описание</span><span class="sxs-lookup"><span data-stu-id="89729-163">Description</span></span>                                                                                                                                                                                                    |
|----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="89729-164">**/T** *хттпаддресс*</span><span class="sxs-lookup"><span data-stu-id="89729-164">**/t** *HTTPAddress*</span></span> | <span data-ttu-id="89729-165">Указывает, что файл должен иметь метку времени.</span><span class="sxs-lookup"><span data-stu-id="89729-165">Indicates that the file is to be time stamped.</span></span> <span data-ttu-id="89729-166">Должен быть указан URL-адрес, указывающий адрес сервера отметок времени.</span><span class="sxs-lookup"><span data-stu-id="89729-166">A URL that specifies an address of a time stamping server must be provided.</span></span> <span data-ttu-id="89729-167">параметр **/t** можно использовать одновременно с командами " **подписать** " и " **отметка времени** " средства SignTool.</span><span class="sxs-lookup"><span data-stu-id="89729-167">**/t** can be used with both **signtool sign** and **signtool timestamp** commands.</span></span> |



 

<span data-ttu-id="89729-168">Дополнительные сведения о средствах, которые могут быть полезны в этом контексте, см. в разделе [средства шифрования и средство](cryptography-tools.md) [SignTool](signtool.md).</span><span class="sxs-lookup"><span data-stu-id="89729-168">For more information about tools that may be useful in this context, see [Cryptography Tools](cryptography-tools.md) and [SignTool](signtool.md).</span></span>

## <a name="implementation-details-and-wire-format"></a><span data-ttu-id="89729-169">Сведения о реализации и формат сети</span><span class="sxs-lookup"><span data-stu-id="89729-169">Implementation Details and Wire Format</span></span>

<span data-ttu-id="89729-170">Средство [SignTool](signtool.md) использует реализацию Windows Authenticode для создания подписей меток времени.</span><span class="sxs-lookup"><span data-stu-id="89729-170">[SignTool](signtool.md) relies on the Windows Authenticode implementation to create and time stamp signatures.</span></span> <span data-ttu-id="89729-171">[*Authenticode*](../secgloss/a-gly.md) работает с двоичными файлами, например CAB, exe, DLL или OCX.</span><span class="sxs-lookup"><span data-stu-id="89729-171">[*Authenticode*](../secgloss/a-gly.md) operates on binary files, for example .cab, .exe, .dll, or .ocx.</span></span> <span data-ttu-id="89729-172">Сначала Authenticode создает подпись, выдавая PKCS \# 7 [**сигнеддата**](signeddata.md).</span><span class="sxs-lookup"><span data-stu-id="89729-172">Authenticode first creates the signature, producing a PKCS \#7 [**SignedData**](signeddata.md).</span></span> <span data-ttu-id="89729-173">Это **сигнеддата** , который должен быть скрепляющая подпись, как описано в PKCS \# 9.</span><span class="sxs-lookup"><span data-stu-id="89729-173">It is this **SignedData** that must be countersigned, as described in PKCS \#9.</span></span>

<span data-ttu-id="89729-174">Процесс подписи от другой стороны выполняется в четыре этапа:</span><span class="sxs-lookup"><span data-stu-id="89729-174">The countersignature process takes place in four steps:</span></span>

1.  <span data-ttu-id="89729-175">Скопируйте сигнатуру (то есть Енкриптеддижест) из SignerInfo в \# [**сигнеддата**](signeddata.md)PKCS 7.</span><span class="sxs-lookup"><span data-stu-id="89729-175">Copy the signature (that is, the encryptedDigest) from the SignerInfo of the PKCS \#7 [**SignedData**](signeddata.md).</span></span>
2.  <span data-ttu-id="89729-176">Создайте запрос метки времени, содержимое которого является исходной подписью.</span><span class="sxs-lookup"><span data-stu-id="89729-176">Construct a time stamp request whose content is the original signature.</span></span> <span data-ttu-id="89729-177">Отправьте его в [*нотации абстрактного синтаксиса*](../secgloss/a-gly.md) сервера метки времени (ASN. 1), закодированного как тиместампрекуест.</span><span class="sxs-lookup"><span data-stu-id="89729-177">Send this to the time stamp server [*Abstract Syntax Notation One*](../secgloss/a-gly.md) (ASN.1) encoded as a TimeStampRequest.</span></span>
3.  <span data-ttu-id="89729-178">Получение отметки времени, отформатированной в виде второй PKCS \# 7 [**сигнеддата**](signeddata.md), возвращаемой сервером отметок времени.</span><span class="sxs-lookup"><span data-stu-id="89729-178">Receive a time stamp, formatted as a second PKCS \#7 [**SignedData**](signeddata.md), returned from the time stamp server.</span></span>
4.  <span data-ttu-id="89729-179">Скопируйте SignerInfo из метки времени непосредственно в оригинальный \# [**сигнеддата**](signeddata.md)PKCS 7, как подпись PKCS 9 (т. е. \# атрибут без проверки подлинности в SignerInfo исходного файла).</span><span class="sxs-lookup"><span data-stu-id="89729-179">Copy the SignerInfo from the time stamp directly into the original PKCS \#7 [**SignedData**](signeddata.md), as a PKCS \#9 countersignature (that is, an unauthenticated attribute in the SignerInfo of the original).</span></span>

## <a name="time-stamp-request"></a><span data-ttu-id="89729-180">Запрос метки времени</span><span class="sxs-lookup"><span data-stu-id="89729-180">Time Stamp Request</span></span>

<span data-ttu-id="89729-181">Запрос метки времени отправляется в сообщении HTTP 1,1 POST.</span><span class="sxs-lookup"><span data-stu-id="89729-181">The time stamp request is sent within an HTTP 1.1 POST message.</span></span> <span data-ttu-id="89729-182">В заголовке HTTP директива CacheControl имеет значение No-cache, а директива Content-Type имеет значение Application/октет-Stream.</span><span class="sxs-lookup"><span data-stu-id="89729-182">In the HTTP header, the CacheControl directive is set to no-cache, and the Content-Type directive is set to application/octet-stream.</span></span> <span data-ttu-id="89729-183">Текст HTTP-сообщения представляет собой кодировку Base64 для запроса метки времени ( [*distinguished Encoding Rules*](../secgloss/d-gly.md) (Der)).</span><span class="sxs-lookup"><span data-stu-id="89729-183">The body of the HTTP message is a base64 encoding of [*Distinguished Encoding Rules*](../secgloss/d-gly.md) (DER) encoding of the time stamp request.</span></span>

<span data-ttu-id="89729-184">Кроме того, в настоящее время директива Content-Length также используется при формировании HTTP-сообщения, так как она помогает серверу отметок времени искать место запроса в HTTP-запросе POST.</span><span class="sxs-lookup"><span data-stu-id="89729-184">Although not currently used, the Content-Length directive should also be used in constructing the HTTP message because it helps the time stamp server locate where the request is within the HTTP POST.</span></span>

<span data-ttu-id="89729-185">Другие заголовки HTTP также могут присутствовать и игнорироваться, если они не понятны запрашивающей стороны или сервером отметок времени.</span><span class="sxs-lookup"><span data-stu-id="89729-185">Other HTTP headers may also be present and should be ignored if they are not understood by the requestor or time stamp server.</span></span>

<span data-ttu-id="89729-186">Запрос метки времени — это сообщение в кодировке ASN. 1.</span><span class="sxs-lookup"><span data-stu-id="89729-186">The time stamp request is an ASN.1 encoded message.</span></span> <span data-ttu-id="89729-187">Формат запроса выглядит следующим образом.</span><span class="sxs-lookup"><span data-stu-id="89729-187">The format of the request is as follows.</span></span>

``` syntax
TimeStampRequest ::= SEQUENCE {
   countersignatureType OBJECT IDENTIFIER,
   attributes Attributes OPTIONAL, 
   content  ContentInfo
}
```

<span data-ttu-id="89729-188">Каунтерсигнатуретипе — это [*идентификатор объекта*](../secgloss/o-gly.md) (OID), который определяет это как отметку времени от другой стороны и должен быть точным идентификатором OID 1.3.6.1.4.1.311.3.2.1.</span><span class="sxs-lookup"><span data-stu-id="89729-188">The countersignatureType is the [*object identifier*](../secgloss/o-gly.md) (OID) that identifies this as a time stamp countersignature and should be the exact OID 1.3.6.1.4.1.311.3.2.1.</span></span>

<span data-ttu-id="89729-189">В запрос метки времени атрибуты в данный момент не включены.</span><span class="sxs-lookup"><span data-stu-id="89729-189">No attributes are currently included in the time stamp request.</span></span>

<span data-ttu-id="89729-190">Содержимое является Контентинфо, как определено в PKCS \# 7.</span><span class="sxs-lookup"><span data-stu-id="89729-190">The content is a ContentInfo as defined by PKCS \#7.</span></span> <span data-ttu-id="89729-191">Содержимое представляет собой подписанные данные.</span><span class="sxs-lookup"><span data-stu-id="89729-191">The content is the data to be signed.</span></span> <span data-ttu-id="89729-192">Для отметки времени подписи ContentType должен быть данными, а содержимое должно быть Енкриптеддижест (Подпись) из SignerInfo \# содержимого PKCS 7 для отметки времени.</span><span class="sxs-lookup"><span data-stu-id="89729-192">For signature time stamping, the ContentType should be Data, and the content should be the encryptedDigest (signature) from the SignerInfo of the PKCS \#7 content to be time stamped.</span></span>

## <a name="time-stamp-response"></a><span data-ttu-id="89729-193">Ответ метки времени</span><span class="sxs-lookup"><span data-stu-id="89729-193">Time Stamp Response</span></span>

<span data-ttu-id="89729-194">Ответ метки времени также отправляется в сообщении HTTP 1,1.</span><span class="sxs-lookup"><span data-stu-id="89729-194">The time stamp response is also sent within an HTTP 1.1 message.</span></span> <span data-ttu-id="89729-195">В заголовке HTTP директива Content-Type также устанавливается в значение Application/октет-Stream.</span><span class="sxs-lookup"><span data-stu-id="89729-195">In the HTTP header, the Content-Type directive is also set to application/octet-stream.</span></span> <span data-ttu-id="89729-196">Текст HTTP-сообщения представляет собой кодировку Base64 в кодировке DER для отклика метки времени.</span><span class="sxs-lookup"><span data-stu-id="89729-196">The body of the HTTP message is a base64 encoding of DER encoding of the time stamp response.</span></span>

<span data-ttu-id="89729-197">Отметка времени — это сообщение, \# подписанное PKCS 7, подписанное на время Стампер.</span><span class="sxs-lookup"><span data-stu-id="89729-197">The time stamp response is a PKCS \#7 signed message signed by the time stamper.</span></span> <span data-ttu-id="89729-198">Контентинфо \# сообщения PKCS 7 идентично контентинфо, полученной в отметке времени.</span><span class="sxs-lookup"><span data-stu-id="89729-198">The ContentInfo of the PKCS \#7 message is identical to the ContentInfo received in the time stamp.</span></span> <span data-ttu-id="89729-199">Содержимое PKCS \# 7 содержит атрибут проверки подлинности времени подписи (определенный в PKCS \# 99, OID 1.2.840.113549.9.5).</span><span class="sxs-lookup"><span data-stu-id="89729-199">The PKCS \#7 content contains the signing time authenticated attribute (defined in PKCS \#99, OID 1.2.840.113549.9.5).</span></span>

<span data-ttu-id="89729-200">После того как Authenticode получит метку времени с сервера, Authenticode включает метку времени в исходную \# [**сигнеддата**](signeddata.md) PKCS 7 в качестве другой подписи.</span><span class="sxs-lookup"><span data-stu-id="89729-200">After Authenticode receives the time stamp from the server, Authenticode incorporates the time stamp into the original PKCS \#7 [**SignedData**](signeddata.md) as a countersignature.</span></span> <span data-ttu-id="89729-201">Для этого Контентинфо возвращенного PKCS \# 7 **сигнеддата** отбрасывается, а SignerInfo возвращенной метки времени копируется как подпись другой стороны в SignerInfo исходного файла PKCS \# 7 **сигнеддата**.</span><span class="sxs-lookup"><span data-stu-id="89729-201">To accomplish this, the ContentInfo of the returned PKCS \#7 **SignedData** is discarded, and the SignerInfo of the returned time stamp is copied as a countersignature into the SignerInfo of the original PKCS \#7 **SignedData**.</span></span> <span data-ttu-id="89729-202">Цепочка сертификатов для времени Стампер также копируется в сертификаты исходного файла PKCS \# 7 **сигнеддата** в качестве атрибута, не прошедшего проверку подлинности, в исходном подписавшем.</span><span class="sxs-lookup"><span data-stu-id="89729-202">The certificate chain of the time stamper is also copied into Certificates in the original PKCS \#7 **SignedData** as an unauthenticated attribute of the original signer.</span></span>

<span data-ttu-id="89729-203">Дополнительные сведения о PKCS и других субъектах безопасности см. в [библиотеке содержимого веб-сайта RSA](https://www.rsa.com/content_library.aspx).</span><span class="sxs-lookup"><span data-stu-id="89729-203">For more information about PKCS and other security subjects, see the [content library of the RSA website](https://www.rsa.com/content_library.aspx).</span></span>

 

 
