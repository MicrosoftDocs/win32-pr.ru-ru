---
description: Описание вызовов, необходимых для создания сертификата.
ms.assetid: 74154b3b-75fc-412f-835c-1a6f54e688c6
title: Создание сертификата
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b8f237fd729499aa5153f12f68657e2ce227da7b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103913416"
---
# <a name="building-a-certificate"></a><span data-ttu-id="15459-103">Создание сертификата</span><span class="sxs-lookup"><span data-stu-id="15459-103">Building a Certificate</span></span>

<span data-ttu-id="15459-104">Порядок вызова в сборке сертификата выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="15459-104">The order of calls in building a certificate is as follows:</span></span>

1.  <span data-ttu-id="15459-105">[*Центр сертификации*](../secgloss/c-gly.md) (ЦС) инициализирует модули с помощью вызовов [**ицертполици**](/windows/desktop/api/Certpol/nn-certpol-icertpolicy) и [**ицертексит**](/windows/desktop/api/Certexit/nn-certexit-icertexit) (происходит один раз при инициализации сервера).</span><span class="sxs-lookup"><span data-stu-id="15459-105">[*Certification authority*](../secgloss/c-gly.md) (CA) initializes modules through calls to [**ICertPolicy**](/windows/desktop/api/Certpol/nn-certpol-icertpolicy) and [**ICertExit**](/windows/desktop/api/Certexit/nn-certexit-icertexit) (happens once on server initialization).</span></span> <span data-ttu-id="15459-106">ЦС инициализирует модули политики и выхода, вызывая [**ICertPolicy2:: Initialize**](/windows/desktop/api/Certpol/nf-certpol-icertpolicy-initialize) и [**Ицертексит:: Initialize**](/windows/desktop/api/Certexit/nf-certexit-icertexit-initialize).</span><span class="sxs-lookup"><span data-stu-id="15459-106">The CA will initialize the policy and exit modules by calling [**ICertPolicy2::Initialize**](/windows/desktop/api/Certpol/nf-certpol-icertpolicy-initialize) and [**ICertExit::Initialize**](/windows/desktop/api/Certexit/nf-certexit-icertexit-initialize).</span></span>
2.  <span data-ttu-id="15459-107">Посредник вызывает ЦС через [**ицертконфиг**](/windows/desktop/api/Certcli/nn-certcli-icertconfig) (происходит один раз для каждой промежуточной инициализации).</span><span class="sxs-lookup"><span data-stu-id="15459-107">Intermediary calls the CA through [**ICertConfig**](/windows/desktop/api/Certcli/nn-certcli-icertconfig) (happens once per intermediary initialization).</span></span> <span data-ttu-id="15459-108">Промежуточный носитель находит необходимую строку конфигурации путем вызова [**ицертконфиг:: config**](/windows/desktop/api/Certcli/nf-certcli-icertconfig-getconfig).</span><span class="sxs-lookup"><span data-stu-id="15459-108">The intermediary finds the needed configuration string by calling [**ICertConfig::GetConfig**](/windows/desktop/api/Certcli/nf-certcli-icertconfig-getconfig).</span></span>
3.  <span data-ttu-id="15459-109">Клиент вызывает посредника через интерфейс, относящийся к промежуточному посреднику (происходит один раз для каждого запроса).</span><span class="sxs-lookup"><span data-stu-id="15459-109">Client calls the intermediary through an interface specific to the intermediary (happens once per request).</span></span> <span data-ttu-id="15459-110">Клиент отправляет запрос на [*сертификат*](../secgloss/c-gly.md) промежуточному посреднику.</span><span class="sxs-lookup"><span data-stu-id="15459-110">The client sends a [*certificate request*](../secgloss/c-gly.md) to the intermediary.</span></span> <span data-ttu-id="15459-111">Это может быть, например, Microsoft Internet Explorer, который отправляет запрос через [Управление регистрацией сертификатов](certificate-enrollment-control.md) в Microsoft службы IIS.</span><span class="sxs-lookup"><span data-stu-id="15459-111">This can be, for example, Microsoft Internet Explorer sending a request through [Certificate Enrollment Control](certificate-enrollment-control.md) to Microsoft Internet Information Services.</span></span>
4.  <span data-ttu-id="15459-112">Посредник в ЦС через [**интерфейса ICertRequest**](/windows/desktop/api/Certcli/nn-certcli-icertrequest) (происходит один раз для каждого запроса).</span><span class="sxs-lookup"><span data-stu-id="15459-112">Intermediary to CA through [**ICertRequest**](/windows/desktop/api/Certcli/nn-certcli-icertrequest) (happens once per request).</span></span> <span data-ttu-id="15459-113">Посредник отправляет запрос сертификата в ЦС через [**интерфейса ICertRequest:: submit**](/windows/desktop/api/Certcli/nf-certcli-icertrequest-submit).</span><span class="sxs-lookup"><span data-stu-id="15459-113">The intermediary sends the certificate request to the CA through [**ICertRequest::Submit**](/windows/desktop/api/Certcli/nf-certcli-icertrequest-submit).</span></span> <span data-ttu-id="15459-114">В случае службы IIS это можно сделать с помощью скриптов Active Server страниц.</span><span class="sxs-lookup"><span data-stu-id="15459-114">In the case of Internet Information Services, this could be done through Active Server Pages scripts.</span></span>
5.  <span data-ttu-id="15459-115">ЦС вызывает модуль политики через интерфейс [**ицертполици**](/windows/desktop/api/Certpol/nn-certpol-icertpolicy) (происходит один раз для каждого запроса).</span><span class="sxs-lookup"><span data-stu-id="15459-115">The CA calls the Policy Module through the [**ICertPolicy**](/windows/desktop/api/Certpol/nn-certpol-icertpolicy) interface (happens once per request).</span></span> <span data-ttu-id="15459-116">Центр сертификации уведомляет модуль политики о том, что запрос пришел путем вызова [**ицертполици:: верифирекуест**](/windows/desktop/api/Certpol/nf-certpol-icertpolicy-verifyrequest).</span><span class="sxs-lookup"><span data-stu-id="15459-116">The CA notifies the policy module that a request has arrived by calling [**ICertPolicy::VerifyRequest**](/windows/desktop/api/Certpol/nf-certpol-icertpolicy-verifyrequest).</span></span> <span data-ttu-id="15459-117">Модуль политики может проверить запрос и изменить сертификат, вызвав методы интерфейса [**ицертсерверполици**](/windows/desktop/api/Certif/nn-certif-icertserverpolicy) .</span><span class="sxs-lookup"><span data-stu-id="15459-117">The policy module can examine the request and change the certificate by calling methods of the [**ICertServerPolicy**](/windows/desktop/api/Certif/nn-certif-icertserverpolicy) interface.</span></span> <span data-ttu-id="15459-118">После этого модуль политики может указать, что запрос будет "ОК" (если это так, сертификат будет создан на этом этапе), запрос будет отклонен или запрос должен быть приостановлен.</span><span class="sxs-lookup"><span data-stu-id="15459-118">The policy module can then indicate that the request is OK (if so, the certificate is built at this point), the request is to be denied, or the request should be suspended.</span></span>
6.  <span data-ttu-id="15459-119">Используемых Администратор вызывает ЦС через интерфейс [**ицертадмин**](/windows/desktop/api/Certadm/nn-certadm-icertadmin) .</span><span class="sxs-lookup"><span data-stu-id="15459-119">(Optional) Administrator calls the CA through the [**ICertAdmin**](/windows/desktop/api/Certadm/nn-certadm-icertadmin) interface.</span></span> <span data-ttu-id="15459-120">Если запрос приостановлен, администратор может повторно отправить или отклонить запрос либо изменить атрибуты и расширения запроса.</span><span class="sxs-lookup"><span data-stu-id="15459-120">If the request is suspended, the administrator can resubmit or deny the request, or modify request attributes and extensions.</span></span> <span data-ttu-id="15459-121">Обратите внимание, что если запрос повторно отправляется, модуль политики будет иметь еще одну возможность обработки запроса (в результате вызова [**ицертполици:: верифирекуест**](/windows/desktop/api/Certpol/nf-certpol-icertpolicy-verifyrequest)).</span><span class="sxs-lookup"><span data-stu-id="15459-121">Note that if the request is resubmitted, the Policy Module will have another opportunity to process the request (as a result of a call to [**ICertPolicy::VerifyRequest**](/windows/desktop/api/Certpol/nf-certpol-icertpolicy-verifyrequest)).</span></span> <span data-ttu-id="15459-122">Задача повторной отправки или отклонения запроса может выполняться с помощью оснастки MMC центра сертификации или другого приложения, использующего **ицертадмин**.</span><span class="sxs-lookup"><span data-stu-id="15459-122">The task of resubmitting or denying the request can be performed by means of the Certification Authority MMC snap-in, or another application that uses **ICertAdmin**.</span></span>
7.  <span data-ttu-id="15459-123">ЦС вызывает модуль Exit через интерфейс [**ицертексит**](/windows/desktop/api/Certexit/nn-certexit-icertexit) .</span><span class="sxs-lookup"><span data-stu-id="15459-123">The CA calls the exit module through the [**ICertExit**](/windows/desktop/api/Certexit/nn-certexit-icertexit) interface.</span></span> <span data-ttu-id="15459-124">Если в модуле выхода указано (при вызове [**ицертексит:: Initialize**](/windows/desktop/api/Certexit/nf-certexit-icertexit-initialize) на шаге 1), что он заинтересован в отображении выданных сертификатов или ожидающих запросов, ЦС вызывает [**Ицертексит:: notify**](/windows/desktop/api/Certexit/nf-certexit-icertexit-notify).</span><span class="sxs-lookup"><span data-stu-id="15459-124">If the exit module has indicated (when [**ICertExit::Initialize**](/windows/desktop/api/Certexit/nf-certexit-icertexit-initialize) was called, in step 1) that it is interested in seeing certificates issued or requests held pending, the CA will call [**ICertExit::Notify**](/windows/desktop/api/Certexit/nf-certexit-icertexit-notify).</span></span>
8.  <span data-ttu-id="15459-125">Модуль выхода вызывает ЦС через интерфейс [**ицертсерверексит**](/windows/desktop/api/Certif/nn-certif-icertserverexit) .</span><span class="sxs-lookup"><span data-stu-id="15459-125">The exit module calls the CA through the [**ICertServerExit**](/windows/desktop/api/Certif/nn-certif-icertserverexit) interface.</span></span> <span data-ttu-id="15459-126">Модуль выхода может проверить запрос и новый сертификат, вызвав методы **ицертсерверексит**.</span><span class="sxs-lookup"><span data-stu-id="15459-126">The exit module can examine the request and the new certificate by calling methods of **ICertServerExit**.</span></span>

 

 
