---
description: Службы сертификатов поддерживают обновление центра сертификации (ЦС).
ms.assetid: b6c76642-9a23-471e-af08-58e91d778f09
title: Продление центра сертификации
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: de57cd16ae6fc4c90bfeea411a06efcb14d028b7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103991397"
---
# <a name="certification-authority-renewal"></a><span data-ttu-id="f319d-103">Продление центра сертификации</span><span class="sxs-lookup"><span data-stu-id="f319d-103">Certification Authority Renewal</span></span>

<span data-ttu-id="f319d-104">[*Службы сертификатов*](../secgloss/c-gly.md) поддерживают обновление [*центра сертификации*](../secgloss/c-gly.md) (ЦС).</span><span class="sxs-lookup"><span data-stu-id="f319d-104">[*Certificate Services*](../secgloss/c-gly.md) supports the renewal of a [*certification authority*](../secgloss/c-gly.md) (CA).</span></span> <span data-ttu-id="f319d-105">Продление — это выдача нового сертификата ЦС для продления срока службы ЦС за пределами даты окончания его исходного сертификата.</span><span class="sxs-lookup"><span data-stu-id="f319d-105">Renewal is the issuing of a new certificate for the CA to extend the CA's life beyond the end date of its original certificate.</span></span> <span data-ttu-id="f319d-106">Центр сертификации можно обновить как задачу в оснастке MMC центра сертификации или с помощью средства Certutil.exe (с командой **-реневцерт** ).</span><span class="sxs-lookup"><span data-stu-id="f319d-106">You can renew a CA as a task within the Certificate Authority MMC snap-in or by using the Certutil.exe tool (with the **-renewCert** command).</span></span>

<span data-ttu-id="f319d-107">Каждое продление приводит к новому сертификату ЦС. Однако администратор может либо создать новую пару из открытого и закрытого ключей, либо повторно использовать существующую пару открытого и закрытого ключей для сертификата ЦС.</span><span class="sxs-lookup"><span data-stu-id="f319d-107">Each renewal results in a new CA certificate; however, the administrator can either generate a new public/private key pair or reuse the existing public/private key pair for the CA certificate.</span></span> <span data-ttu-id="f319d-108">Для согласованности и целостности сертификаты ЦС и [*списки отзыва сертификатов*](../secgloss/c-gly.md) (CRL), ВЫДАННЫЕ центром сертификации до его продления, будут доступны после обновления ЦС.</span><span class="sxs-lookup"><span data-stu-id="f319d-108">For consistency and integrity, CA certificates and [*certificate revocation lists*](../secgloss/c-gly.md) (CRL) issued by the CA before its renewal will be available after the CA has been renewed.</span></span> <span data-ttu-id="f319d-109">Чтобы сделать их доступными, службы сертификатов поддерживают индекс сертификатов ЦС, списков отзыва сертификатов и ключей.</span><span class="sxs-lookup"><span data-stu-id="f319d-109">To make these available, Certificate Services maintains an index of CA certificates, CRLs, and keys.</span></span>

<span data-ttu-id="f319d-110">Ниже приведены индексы и имена суффиксов сертификатов ЦС и CRL во время различных операций обновления ЦС.</span><span class="sxs-lookup"><span data-stu-id="f319d-110">The indexes and suffix names of CA certificates and CRLs during various CA renewal operations are as follows.</span></span>



| <span data-ttu-id="f319d-111">Операция</span><span class="sxs-lookup"><span data-stu-id="f319d-111">Operation</span></span>                | <span data-ttu-id="f319d-112">Индекс сертификата ЦС</span><span class="sxs-lookup"><span data-stu-id="f319d-112">CA certificate index</span></span> | <span data-ttu-id="f319d-113">Суффикс имени файла сертификата ЦС</span><span class="sxs-lookup"><span data-stu-id="f319d-113">CA certificate file name suffix</span></span> | <span data-ttu-id="f319d-114">Список отзыва сертификатов и индекс ключа</span><span class="sxs-lookup"><span data-stu-id="f319d-114">CRL and key index</span></span> | <span data-ttu-id="f319d-115">Список CRL и суффикс имени контейнера ключей</span><span class="sxs-lookup"><span data-stu-id="f319d-115">CRL and key container name suffix</span></span> |
|--------------------------|----------------------|---------------------------------|-------------------|-----------------------------------|
| <span data-ttu-id="f319d-116">Установка исходного ЦС</span><span class="sxs-lookup"><span data-stu-id="f319d-116">Original CA installation</span></span> | <span data-ttu-id="f319d-117">0</span><span class="sxs-lookup"><span data-stu-id="f319d-117">0</span></span>                    | <span data-ttu-id="f319d-118">""</span><span class="sxs-lookup"><span data-stu-id="f319d-118">""</span></span>                              | <span data-ttu-id="f319d-119">0</span><span class="sxs-lookup"><span data-stu-id="f319d-119">0</span></span>                 | <span data-ttu-id="f319d-120">""</span><span class="sxs-lookup"><span data-stu-id="f319d-120">""</span></span>                                |
| <span data-ttu-id="f319d-121">Продление с новым ключом</span><span class="sxs-lookup"><span data-stu-id="f319d-121">Renewal with new key</span></span>     | <span data-ttu-id="f319d-122">1</span><span class="sxs-lookup"><span data-stu-id="f319d-122">1</span></span>                    | <span data-ttu-id="f319d-123">"(1)"</span><span class="sxs-lookup"><span data-stu-id="f319d-123">"(1)"</span></span>                           | <span data-ttu-id="f319d-124">1</span><span class="sxs-lookup"><span data-stu-id="f319d-124">1</span></span>                 | <span data-ttu-id="f319d-125">"(1)"</span><span class="sxs-lookup"><span data-stu-id="f319d-125">"(1)"</span></span>                             |
| <span data-ttu-id="f319d-126">Повторное использование ключа обновления</span><span class="sxs-lookup"><span data-stu-id="f319d-126">Renewal reusing key</span></span>      | <span data-ttu-id="f319d-127">2</span><span class="sxs-lookup"><span data-stu-id="f319d-127">2</span></span>                    | <span data-ttu-id="f319d-128">"(2)"</span><span class="sxs-lookup"><span data-stu-id="f319d-128">"(2)"</span></span>                           | <span data-ttu-id="f319d-129">1</span><span class="sxs-lookup"><span data-stu-id="f319d-129">1</span></span>                 | <span data-ttu-id="f319d-130">"(1)"</span><span class="sxs-lookup"><span data-stu-id="f319d-130">"(1)"</span></span>                             |
| <span data-ttu-id="f319d-131">Повторное использование ключа обновления</span><span class="sxs-lookup"><span data-stu-id="f319d-131">Renewal reusing key</span></span>      | <span data-ttu-id="f319d-132">3</span><span class="sxs-lookup"><span data-stu-id="f319d-132">3</span></span>                    | <span data-ttu-id="f319d-133">"(3)"</span><span class="sxs-lookup"><span data-stu-id="f319d-133">"(3)"</span></span>                           | <span data-ttu-id="f319d-134">1</span><span class="sxs-lookup"><span data-stu-id="f319d-134">1</span></span>                 | <span data-ttu-id="f319d-135">"(1)"</span><span class="sxs-lookup"><span data-stu-id="f319d-135">"(1)"</span></span>                             |
| <span data-ttu-id="f319d-136">Продление с новым ключом</span><span class="sxs-lookup"><span data-stu-id="f319d-136">Renewal with new key</span></span>     | <span data-ttu-id="f319d-137">4</span><span class="sxs-lookup"><span data-stu-id="f319d-137">4</span></span>                    | <span data-ttu-id="f319d-138">"(4)"</span><span class="sxs-lookup"><span data-stu-id="f319d-138">"(4)"</span></span>                           | <span data-ttu-id="f319d-139">4</span><span class="sxs-lookup"><span data-stu-id="f319d-139">4</span></span>                 | <span data-ttu-id="f319d-140">"(4)"</span><span class="sxs-lookup"><span data-stu-id="f319d-140">"(4)"</span></span>                             |
| <span data-ttu-id="f319d-141">Повторное использование ключа обновления</span><span class="sxs-lookup"><span data-stu-id="f319d-141">Renewal reusing key</span></span>      | <span data-ttu-id="f319d-142">5</span><span class="sxs-lookup"><span data-stu-id="f319d-142">5</span></span>                    | <span data-ttu-id="f319d-143">"(5)"</span><span class="sxs-lookup"><span data-stu-id="f319d-143">"(5)"</span></span>                           | <span data-ttu-id="f319d-144">4</span><span class="sxs-lookup"><span data-stu-id="f319d-144">4</span></span>                 | <span data-ttu-id="f319d-145">"(4)"</span><span class="sxs-lookup"><span data-stu-id="f319d-145">"(4)"</span></span>                             |
| <span data-ttu-id="f319d-146">Продление с новым ключом</span><span class="sxs-lookup"><span data-stu-id="f319d-146">Renewal with new key</span></span>     | <span data-ttu-id="f319d-147">6</span><span class="sxs-lookup"><span data-stu-id="f319d-147">6</span></span>                    | <span data-ttu-id="f319d-148">"(6)"</span><span class="sxs-lookup"><span data-stu-id="f319d-148">"(6)"</span></span>                           | <span data-ttu-id="f319d-149">6</span><span class="sxs-lookup"><span data-stu-id="f319d-149">6</span></span>                 | <span data-ttu-id="f319d-150">"(6)"</span><span class="sxs-lookup"><span data-stu-id="f319d-150">"(6)"</span></span>                             |
| <span data-ttu-id="f319d-151">Повторное использование ключа обновления</span><span class="sxs-lookup"><span data-stu-id="f319d-151">Renewal reusing key</span></span>      | <span data-ttu-id="f319d-152">7</span><span class="sxs-lookup"><span data-stu-id="f319d-152">7</span></span>                    | <span data-ttu-id="f319d-153">"(7)"</span><span class="sxs-lookup"><span data-stu-id="f319d-153">"(7)"</span></span>                           | <span data-ttu-id="f319d-154">6</span><span class="sxs-lookup"><span data-stu-id="f319d-154">6</span></span>                 | <span data-ttu-id="f319d-155">"(6)"</span><span class="sxs-lookup"><span data-stu-id="f319d-155">"(6)"</span></span>                             |



 

<span data-ttu-id="f319d-156">При установке ЦС индекс сертификата равен нулю, а суффикс сертификата — "" (пустая строка).</span><span class="sxs-lookup"><span data-stu-id="f319d-156">When a CA is installed, the certificate index is zero and the certificate suffix is "" (an empty string).</span></span> <span data-ttu-id="f319d-157">При каждом обновлении сертификата (независимо от того, используются ли ключи повторно), индекс сертификата увеличивается на единицу, а суффикс имени файла сертификата становится строкой в формате "(*n*)", где *n* представляет количество раз, когда сертификат ЦС был продлен.</span><span class="sxs-lookup"><span data-stu-id="f319d-157">Each time the certificate is renewed (whether or not keys are reused), the certificate index is incremented by one, and the certificate file name suffix becomes a string of the form "(*n*)", where *n* represents the number of times the CA certificate has been renewed.</span></span> <span data-ttu-id="f319d-158">После первого продления индекс сертификата равен 1, а суффикс имени файла сертификата — "(1)".</span><span class="sxs-lookup"><span data-stu-id="f319d-158">After the first renewal, the certificate index is 1 and the certificate file name suffix is "(1)".</span></span> <span data-ttu-id="f319d-159">После второго продления индекс сертификата равен 2, а суффикс имени файла сертификата — "(2)" и т. д.</span><span class="sxs-lookup"><span data-stu-id="f319d-159">After the second renewal, the certificate index is 2 and the certificate file name suffix is "(2)", and so on.</span></span>

<span data-ttu-id="f319d-160">Хотя индекс и суффикс сертификата ЦС увеличиваются на один раз при каждом обновлении центра сертификации, список CRL и индексы ключей и суффиксы имени файла устанавливаются в индекс сертификата ЦС только в том случае, если процесс обновления включает новую пару из открытого и закрытого ключей.</span><span class="sxs-lookup"><span data-stu-id="f319d-160">Although the CA certificate index and suffix are incremented by one each time the CA is renewed, the CRL and key indexes and the file name suffixes are set to the CA certificate index only if the renewal process includes a new public/private key pair.</span></span> <span data-ttu-id="f319d-161">В противном случае значения этих индексов и суффиксов остаются теми же, что и для последнего индекса.</span><span class="sxs-lookup"><span data-stu-id="f319d-161">If it does not, the values of these indexes and suffixes remain the same as they were for the last index.</span></span> <span data-ttu-id="f319d-162">Во время продления администратор указывает, создается ли новая пара ключей или используется существующая пара ключей.</span><span class="sxs-lookup"><span data-stu-id="f319d-162">During renewal, an administrator specifies whether a new key pair is generated or the existing key pair is used.</span></span> <span data-ttu-id="f319d-163">(В оснастке «Центр сертификации» в качестве параметра пользовательского интерфейса указывается новая или существующая пара ключей; в средстве Certutil.exe команда **certutil-реневцерт** обновляет ЦС с помощью новой пары ключей, а команда **certutil-РЕНЕВЦЕРТ реусекэйс** обновляет ЦС с помощью существующей пары ключей.)</span><span class="sxs-lookup"><span data-stu-id="f319d-163">(In the Certificate Authority MMC snap-in, an option in the user interface specifies a new or an existing key pair; in the Certutil.exe tool, the command **certutil -renewCert** renews the CA with a new key pair, while the command **certutil -renewCert ReuseKeys** renews the CA with the existing key pair.)</span></span>

<span data-ttu-id="f319d-164">Индекс списка отзыва сертификатов напрямую привязан к индексу ключа, который устанавливается в индекс сертификата ЦС только в том случае, если для обновления используется новая пара ключей.</span><span class="sxs-lookup"><span data-stu-id="f319d-164">The CRL index is directly tied to the key index, which is set to the CA certificate index only when a new key pair is used for the renewal.</span></span> <span data-ttu-id="f319d-165">После первого продления (которое использовало новую пару ключей) индекс списка CRL и ключа устанавливается в 1, а список CRL и суффикс имени контейнера ключа — "(1)".</span><span class="sxs-lookup"><span data-stu-id="f319d-165">After the first renewal (which used a new key pair), the index of the CRL and key is set to 1, and the CRL and key container name suffix is "(1)".</span></span> <span data-ttu-id="f319d-166">Однако после второго продления индекс списка отзыва сертификатов и ключа остается равным 1, а список CRL и суффикс имени контейнера ключей также остается "(1)"; Это связано с тем, что второе продление использует существующую пару ключей, и для каждой пары ключей ЦС выдается только один список отзыва сертификатов.</span><span class="sxs-lookup"><span data-stu-id="f319d-166">After the second renewal, however, the index of the CRL and key remains 1, and the CRL and key container name suffix also remains "(1)"; this is because the second renewal used the existing key pair and only one CRL is issued for each CA key pair.</span></span>

<span data-ttu-id="f319d-167">Вы можете получить индексированные сертификаты ЦС и списки отзыва сертификатов, вызвав метод **жетцертификатепроперти** (в интерфейсах [**ицертсерверексит**](/windows/desktop/api/Certif/nn-certif-icertserverexit) и [**ицертсерверполици**](/windows/desktop/api/Certif/nn-certif-icertserverpolicy) ).</span><span class="sxs-lookup"><span data-stu-id="f319d-167">You can retrieve the indexed CA certificates and CRLs by calling the **GetCertificateProperty** method (in both the [**ICertServerExit**](/windows/desktop/api/Certif/nn-certif-icertserverexit) and [**ICertServerPolicy**](/windows/desktop/api/Certif/nn-certif-icertserverpolicy) interfaces).</span></span> <span data-ttu-id="f319d-168">При получении определенных свойств, связанных с сертификатом ЦС или списком отзыва сертификатов, можно добавить в имена свойств индекс, начинающийся с нуля сертификата ЦС.</span><span class="sxs-lookup"><span data-stu-id="f319d-168">When you retrieve certain properties related to the CA certificate or CRL, you can append the CA certificate's zero-based index to the property names.</span></span> <span data-ttu-id="f319d-169">Например, чтобы получить индекс списка отзыва сертификатов, соответствующий третьему сертификату ЦС, передайте свойство "Крлиндекс. 2" в [**ицертсерверполици:: жетцертификатепроперти**](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-getcertificateproperty); для таблицы полученное значение свойства "Крлиндекс. 2" будет равно 1.</span><span class="sxs-lookup"><span data-stu-id="f319d-169">For example, to retrieve the CRL index that corresponds to the CA's third certificate, pass the property "CRLIndex.2" to [**ICertServerPolicy::GetCertificateProperty**](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-getcertificateproperty); for the table, the retrieved "CRLIndex.2" property value would be 1.</span></span> <span data-ttu-id="f319d-170">Свойство с именем "Церткаунт" можно использовать, чтобы определить, сколько раз ЦС выдавал сертификат ЦС.</span><span class="sxs-lookup"><span data-stu-id="f319d-170">A property called "CertCount" can be used to determine the number of times the CA has been issued a CA certificate.</span></span>

<span data-ttu-id="f319d-171">Сертификаты и списки отзыва сертификатов ЦС содержат расширение, которое предоставляет сведения о сертификате и индексе ключа.</span><span class="sxs-lookup"><span data-stu-id="f319d-171">CA certificates and CRLs contain an extension that provides information about the certificate and key index.</span></span> <span data-ttu-id="f319d-172">Расширение определяется в Винкрипт. h как Сзоид \_ CERTSRV \_ \_ версии CA со значением "1.3.6.1.4.1.311.21.1".</span><span class="sxs-lookup"><span data-stu-id="f319d-172">The extension is defined in Wincrypt.h as szOID\_CERTSRV\_CA\_VERSION with a value of "1.3.6.1.4.1.311.21.1".</span></span> <span data-ttu-id="f319d-173">Данные расширения — это значение **типа DWORD** (кодируется в виде \_ целого числа X509 в расширении); младшие 16 бит являются индексом сертификата, а старшие 16 бит — ключевым индексом.</span><span class="sxs-lookup"><span data-stu-id="f319d-173">The extension data is a **DWORD** value (encoded as X509\_INTEGER in the extension); the low 16 bits are the certificate index, and the high 16 bits are the key index.</span></span>

<span data-ttu-id="f319d-174">При первоначальной установке ЦС создается нулевой индекс сертификата и индекс ключа, равный нулю.</span><span class="sxs-lookup"><span data-stu-id="f319d-174">The initial installation of a CA produces a certificate index of zero and a key index of zero.</span></span> <span data-ttu-id="f319d-175">Возобновление сертификата ЦС приведет к увеличению индекса сертификата.</span><span class="sxs-lookup"><span data-stu-id="f319d-175">Renewal of a CA certificate will cause the certificate index to be incremented.</span></span> <span data-ttu-id="f319d-176">Если ключ повторно используется в продлении, индекс ключа будет таким же, как и предыдущий индекс ключа.</span><span class="sxs-lookup"><span data-stu-id="f319d-176">If the key is reused in the renewal, the key index will be the same as the previous key index.</span></span> <span data-ttu-id="f319d-177">Если ключ не используется повторно, индекс ключа будет соответствовать новому индексу сертификата.</span><span class="sxs-lookup"><span data-stu-id="f319d-177">If the key is not reused, the key index will match the new certificate index.</span></span>

## <a name="related-topics"></a><span data-ttu-id="f319d-178">См. также</span><span class="sxs-lookup"><span data-stu-id="f319d-178">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f319d-179">**Ицертсерверполици:: Жетцертификатепроперти**</span><span class="sxs-lookup"><span data-stu-id="f319d-179">**ICertServerPolicy::GetCertificateProperty**</span></span>](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-getcertificateproperty)
</dt> <dt>

[<span data-ttu-id="f319d-180">**Ицертсерверексит:: Жетцертификатепроперти**</span><span class="sxs-lookup"><span data-stu-id="f319d-180">**ICertServerExit::GetCertificateProperty**</span></span>](/windows/desktop/api/Certif/nf-certif-icertserverexit-getcertificateproperty)
</dt> </dl>

 

 
