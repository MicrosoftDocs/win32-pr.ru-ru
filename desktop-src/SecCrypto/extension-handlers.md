---
description: Начиная с формата сертификата X. 509 версии 3, сертификат может содержать расширения сертификата.
ms.assetid: fb106cab-8a61-4a83-8fb4-7c045d905575
title: Обработчики расширений
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cfcf1b47fcc97b87f5956f4584aee07acce04222
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105684444"
---
# <a name="extension-handlers"></a><span data-ttu-id="76f1d-103">Обработчики расширений</span><span class="sxs-lookup"><span data-stu-id="76f1d-103">Extension Handlers</span></span>

<span data-ttu-id="76f1d-104">Начиная с формата сертификата [*X. 509*](../secgloss/x-gly.md) версии 3, сертификат может содержать расширения сертификата.</span><span class="sxs-lookup"><span data-stu-id="76f1d-104">Beginning with [*X.509*](../secgloss/x-gly.md) Certificate format Version 3, a certificate may contain certificate extensions.</span></span> <span data-ttu-id="76f1d-105">(Содержимое сертификата X. 509 см. в разделе [Свойства сертификата](certificate-properties.md).) Эти расширения указывают дополнительные сведения.</span><span class="sxs-lookup"><span data-stu-id="76f1d-105">(For the contents of an X.509 Certificate, see [Certificate Properties](certificate-properties.md).) These extensions indicate additional information.</span></span> <span data-ttu-id="76f1d-106">Например, расширение может указывать дополнительные сведения об идентификации субъекта или сведения об использовании ключа, которые указывают задачи (такие как подпись или шифрование), для которых может использоваться ключ.</span><span class="sxs-lookup"><span data-stu-id="76f1d-106">For example, an extension can indicate additional subject identification information, or it can indicate key usage information, which specifies the tasks (such as signature or encryption) for which a key can be used.</span></span> <span data-ttu-id="76f1d-107">Набор стандартных расширений определяется для использования приложением, а расширения также могут быть настроены.</span><span class="sxs-lookup"><span data-stu-id="76f1d-107">A set of standard extensions is defined for application use, and extensions may also be customized.</span></span>

<span data-ttu-id="76f1d-108">Каждое расширение имеет связанную строку идентификатора объекта, которая определяет тип дополнительной информации и структуру данных, содержащую эти сведения.</span><span class="sxs-lookup"><span data-stu-id="76f1d-108">Each extension has an associated object identifier string that identifies the type of additional information and a data structure that contains this information.</span></span> <span data-ttu-id="76f1d-109">Например, идентификатором объекта использования ключа является "2.5.29.15", который указывает сведения об использовании ключа.</span><span class="sxs-lookup"><span data-stu-id="76f1d-109">For example, the key usage object identifier is "2.5.29.15", which indicates key usage information.</span></span> <span data-ttu-id="76f1d-110">Связанная с ним структура данных — это [**\_ Многоразрядный \_ большой двоичный объект**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_bit_blob) (битовое значение), указывающий, как можно использовать ключ.</span><span class="sxs-lookup"><span data-stu-id="76f1d-110">Its associated data structure is a [**CRYPT\_BIT\_BLOB**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_bit_blob) (bitfield) specifying how the key can be used.</span></span>

<span data-ttu-id="76f1d-111">Расширение можно добавить в сертификат перед его выдаче.</span><span class="sxs-lookup"><span data-stu-id="76f1d-111">An extension can be added to a certificate before it is issued.</span></span> <span data-ttu-id="76f1d-112">При выдаче сертификата все включенные расширения являются частью сертификата.</span><span class="sxs-lookup"><span data-stu-id="76f1d-112">When the certificate is issued, any enabled extensions are part of the certificate.</span></span> <span data-ttu-id="76f1d-113">Если расширение помечено как критическое, его использование должно быть известно с помощью приложения, а приложение должно соответствовать намерению или значению расширения.</span><span class="sxs-lookup"><span data-stu-id="76f1d-113">If an extension is marked critical, its use must be known by the using application, and the application must adhere to the intent or value of the extension.</span></span> <span data-ttu-id="76f1d-114">Службы сертификации позволяют задавать расширения для невыданного сертификата с помощью методов, предоставляемых [**ицертадмин**](/windows/desktop/api/Certadm/nn-certadm-icertadmin) и [**ицертсерверполици**](/windows/desktop/api/Certif/nn-certif-icertserverpolicy).</span><span class="sxs-lookup"><span data-stu-id="76f1d-114">Certificate Services allows extensions to be set on a non-issued certificate through methods provided by [**ICertAdmin**](/windows/desktop/api/Certadm/nn-certadm-icertadmin) and [**ICertServerPolicy**](/windows/desktop/api/Certif/nn-certif-icertserverpolicy).</span></span> <span data-ttu-id="76f1d-115">Дополнительные сведения о расширениях сертификатов см. в разделе [**\_ расширение сертификата**](/windows/desktop/api/Wincrypt/ns-wincrypt-cert_extension) в документации CryptoAPI.</span><span class="sxs-lookup"><span data-stu-id="76f1d-115">For details about certificate extensions, see [**CERT\_EXTENSION**](/windows/desktop/api/Wincrypt/ns-wincrypt-cert_extension) in the CryptoAPI documentation.</span></span> <span data-ttu-id="76f1d-116">Дополнительные сведения о структурах данных общих расширений сертификатов см. в разделе [структуры расширений сертификатов X. 509](cryptography-structures.md).</span><span class="sxs-lookup"><span data-stu-id="76f1d-116">For information about common certificate extension data structures, see [X.509 Certificate Extension Structures](cryptography-structures.md).</span></span>

<span data-ttu-id="76f1d-117">Обработчик расширения — это COM-объект, который предоставляет подпрограммы для кодирования более сложных, но часто используемых расширений и типов данных, таких как IA5String или Принтаблестринг.</span><span class="sxs-lookup"><span data-stu-id="76f1d-117">The extension handler is a COM object that provides routines for encoding the more complex, but commonly used extensions and data types, such as IA5String or PrintableString.</span></span>

<span data-ttu-id="76f1d-118">Расширения, имеющие типы данных **Date**, **Long** и **BSTR** , не нуждаются в обработчике расширений.</span><span class="sxs-lookup"><span data-stu-id="76f1d-118">Extensions that have the data types **DATE**, **LONG**, and **BSTR** do not require an extension handler.</span></span> <span data-ttu-id="76f1d-119">Модуль политики просто вызывает [**ицертсерверполици:: сетцертификатикстенсион**](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-setcertificateextension) с параметром *типа* , который имеет значение, представляющее тип данных расширения: проптипе \_ Date, проптипе \_ long или проптипе \_ String.</span><span class="sxs-lookup"><span data-stu-id="76f1d-119">The policy module simply calls [**ICertServerPolicy::SetCertificateExtension**](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-setcertificateextension) with the *Type* parameter set to a value representing the extension data type: PROPTYPE\_DATE, PROPTYPE\_LONG, or PROPTYPE\_STRING.</span></span> <span data-ttu-id="76f1d-120">Затем расширение передается в ядро сервера.</span><span class="sxs-lookup"><span data-stu-id="76f1d-120">It then passes the extension to the server engine.</span></span> <span data-ttu-id="76f1d-121">Ядро сервера, в свою очередь, выполняет [*синтаксическую нотацию синтаксиса One*](../secgloss/a-gly.md) (ASN. 1) перед сохранением расширения в сертификате.</span><span class="sxs-lookup"><span data-stu-id="76f1d-121">The server engine, in turn, performs the [*Abstract Syntax Notation One*](../secgloss/a-gly.md) (ASN.1) encoding before storing the extension in the certificate.</span></span>

<span data-ttu-id="76f1d-122">Однако расширения, имеющие типы данных, отличные от этих типов по умолчанию, должны иметь тип ASN. 1, закодированный обработчиком расширений, прежде чем модуль политики передаст их в ядро сервера.</span><span class="sxs-lookup"><span data-stu-id="76f1d-122">However, extensions that have data types other than these default types must be ASN.1 encoded by an extension handler before the policy module passes them to the server engine.</span></span> <span data-ttu-id="76f1d-123">Когда модуль политики вызывает [**ицертсерверполици:: сетцертификатикстенсион**](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-setcertificateextension) для передачи расширения ASN. 1, закодированного в ядро сервера, он должен задать для параметра *типа* значение проптипе \_ binary.</span><span class="sxs-lookup"><span data-stu-id="76f1d-123">When the policy module calls [**ICertServerPolicy::SetCertificateExtension**](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-setcertificateextension) to pass an ASN.1-encoded extension to the server engine, it must set the *Type* parameter to PROPTYPE\_BINARY.</span></span> <span data-ttu-id="76f1d-124">Затем ядро сервера просто сохраняет это закодированное расширение в сертификате.</span><span class="sxs-lookup"><span data-stu-id="76f1d-124">The server engine then simply stores this encoded extension in the certificate.</span></span>

<span data-ttu-id="76f1d-125">Обработчик расширения по умолчанию, Certenc.dll, экспортирует ряд интерфейсов **ицертенкодекскскс** и может вызываться модулем политики.</span><span class="sxs-lookup"><span data-stu-id="76f1d-125">The default extension handler, Certenc.dll, exports a number of **ICertEncodeXXX** interfaces and can be called by the policy module.</span></span> <span data-ttu-id="76f1d-126">Необходимые сведения о типе также содержатся в Certencl.dll, который предоставляется в пакете SDK для платформы.</span><span class="sxs-lookup"><span data-stu-id="76f1d-126">The necessary type information is also contained in Certencl.dll which is supplied in the Platform Software Development Kit (SDK).</span></span> <span data-ttu-id="76f1d-127">Каждый интерфейс предоставляет метод **кодирования** , который возвращает расширение сертификата ASN. 1 с кодировкой для модуля политики в двоичном формате.</span><span class="sxs-lookup"><span data-stu-id="76f1d-127">Each interface provides an **Encode** method that returns an ASN.1-encoded certificate extension to the policy module in a binary format.</span></span> <span data-ttu-id="76f1d-128">Затем модуль политики может задать расширение в сертификате, вызвав метод [**ицертсерверполици:: сетцертификатикстенсион**](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-setcertificateextension) .</span><span class="sxs-lookup"><span data-stu-id="76f1d-128">The policy module can then set the extension in a certificate by calling the [**ICertServerPolicy::SetCertificateExtension**](/windows/desktop/api/Certif/nf-certif-icertserverpolicy-setcertificateextension) method.</span></span>

<span data-ttu-id="76f1d-129">Дополнительные сведения см. в разделе [написание пользовательских обработчиков расширений](writing-custom-extension-handlers.md).</span><span class="sxs-lookup"><span data-stu-id="76f1d-129">For more information, see [Writing Custom Extension Handlers](writing-custom-extension-handlers.md).</span></span>

 

 
