---
description: Сервер канала указывает режим типа канала, режим чтения и режим ожидания в параметре Двпипемоде функции Креатенамедпипе. Клиенты канала могут задавать эти режимы канала для обработки их каналов с помощью функции CreateFile.
ms.assetid: 07cf9d06-6265-47f4-a9f1-c19c06cc5f9f
title: Типы именованных каналов, чтение и режимы ожидания
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b116e5ca9357a65a6d63549b96065843b046d479
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103896689"
---
# <a name="named-pipe-type-read-and-wait-modes"></a><span data-ttu-id="77724-104">Типы именованных каналов, чтение и режимы ожидания</span><span class="sxs-lookup"><span data-stu-id="77724-104">Named Pipe Type, Read, and Wait Modes</span></span>

<span data-ttu-id="77724-105">Сервер канала указывает режим типа канала, режим чтения и режим ожидания в параметре *двпипемоде* функции [**креатенамедпипе**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) .</span><span class="sxs-lookup"><span data-stu-id="77724-105">The pipe server specifies the pipe type mode, read mode, and wait mode in the *dwPipeMode* parameter of the [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) function.</span></span> <span data-ttu-id="77724-106">Клиенты канала могут задавать эти режимы канала для обработки их каналов с помощью функции [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) .</span><span class="sxs-lookup"><span data-stu-id="77724-106">Pipe clients can specify these pipe modes for their pipe handles using the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function.</span></span>

## <a name="type-mode"></a><span data-ttu-id="77724-107">Режим типа</span><span class="sxs-lookup"><span data-stu-id="77724-107">Type Mode</span></span>

<span data-ttu-id="77724-108">Режим типа канала определяет способ, которым данные записываются в именованный канал.</span><span class="sxs-lookup"><span data-stu-id="77724-108">The type mode of a pipe determines how data is written to a named pipe.</span></span> <span data-ttu-id="77724-109">Данные могут передаваться через именованный канал в виде потока байтов или в виде потока сообщений.</span><span class="sxs-lookup"><span data-stu-id="77724-109">Data can be transmitted through a named pipe as either a stream of bytes or as a stream of messages.</span></span> <span data-ttu-id="77724-110">Сервер канала указывает тип канала при вызове [**креатенамедпипе**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) для создания экземпляра именованного канала.</span><span class="sxs-lookup"><span data-stu-id="77724-110">The pipe server specifies the pipe type when calling [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) to create an instance of a named pipe.</span></span> <span data-ttu-id="77724-111">Режимы типа должны быть одинаковыми для всех экземпляров канала.</span><span class="sxs-lookup"><span data-stu-id="77724-111">The type modes must be the same for all instances of a pipe.</span></span>

<span data-ttu-id="77724-112">Чтобы создать канал типа Byte, укажите \_ байт типа канала \_ или используйте значение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="77724-112">To create a byte-type pipe, specify PIPE\_TYPE\_BYTE or use the default value.</span></span> <span data-ttu-id="77724-113">Данные записываются в канал в виде потока байтов, и система не различает байты, записанные в разных операциях записи.</span><span class="sxs-lookup"><span data-stu-id="77724-113">The data is written to the pipe as a stream of bytes, and the system does not differentiate between the bytes written in different write operations.</span></span>

<span data-ttu-id="77724-114">Чтобы создать канал типа сообщений, укажите \_ сообщение типа канала \_ .</span><span class="sxs-lookup"><span data-stu-id="77724-114">To create a message-type pipe, specify PIPE\_TYPE\_MESSAGE.</span></span> <span data-ttu-id="77724-115">Система обрабатывает байты, записанные в каждой операции записи, в канал в виде единицы сообщения.</span><span class="sxs-lookup"><span data-stu-id="77724-115">The system treats the bytes written in each write operation to the pipe as a message unit.</span></span> <span data-ttu-id="77724-116">Система всегда выполняет операции записи для каналов типа сообщений, как если бы был включен режим сквозной записи.</span><span class="sxs-lookup"><span data-stu-id="77724-116">The system always performs write operations on message-type pipes as if write-through mode were enabled.</span></span>

## <a name="read-mode"></a><span data-ttu-id="77724-117">Режим чтения</span><span class="sxs-lookup"><span data-stu-id="77724-117">Read Mode</span></span>

<span data-ttu-id="77724-118">Режим чтения канала определяет способ считывания данных из именованного канала.</span><span class="sxs-lookup"><span data-stu-id="77724-118">The read mode of a pipe determines how data is read from a named pipe.</span></span> <span data-ttu-id="77724-119">Сервер канала указывает начальный режим чтения для обработчика канала при вызове [**креатенамедпипе**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea).</span><span class="sxs-lookup"><span data-stu-id="77724-119">The pipe server specifies the initial read mode for a pipe handle when calling [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea).</span></span> <span data-ttu-id="77724-120">Данные можно считывать в режиме чтения байтов или в режиме чтения сообщений.</span><span class="sxs-lookup"><span data-stu-id="77724-120">Data can be read in byte-read mode or message-read mode.</span></span> <span data-ttu-id="77724-121">Обработчик канала типа Byte может быть только в режиме чтения байтов.</span><span class="sxs-lookup"><span data-stu-id="77724-121">A handle to a byte-type pipe can be in byte-read mode only.</span></span> <span data-ttu-id="77724-122">Обработчик типа сообщений может быть в режиме чтения или считывания сообщения.</span><span class="sxs-lookup"><span data-stu-id="77724-122">A handle to a message-type pipe can be in either byte-read or message-read mode.</span></span> <span data-ttu-id="77724-123">Для канала типа сообщений режим чтения может отличаться для обработки сервером и клиентом одного и того же экземпляра канала.</span><span class="sxs-lookup"><span data-stu-id="77724-123">For a message-type pipe, the read mode can be different for server and client handles to the same pipe instance.</span></span>

<span data-ttu-id="77724-124">Чтобы создать обработчик канала в режиме чтения байтов, укажите канал \_ READMODE \_ Byte или используйте значение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="77724-124">To create the pipe handle in byte-read mode, specify PIPE\_READMODE\_BYTE or use the default value.</span></span> <span data-ttu-id="77724-125">Данные считываются из канала в виде потока байтов.</span><span class="sxs-lookup"><span data-stu-id="77724-125">Data is read from the pipe as a stream of bytes.</span></span> <span data-ttu-id="77724-126">Операция чтения завершается успешно при считывании всех доступных байтов в канале или при считывании указанного числа байтов.</span><span class="sxs-lookup"><span data-stu-id="77724-126">A read operation is completed successfully when all available bytes in the pipe are read or when the specified number of bytes is read.</span></span>

<span data-ttu-id="77724-127">Чтобы создать маркер канала в режиме чтения сообщений, укажите PIPE \_ READMODE \_ сообщение.</span><span class="sxs-lookup"><span data-stu-id="77724-127">To create the pipe handle in message-read mode, specify PIPE\_READMODE\_MESSAGE.</span></span> <span data-ttu-id="77724-128">Данные считываются из канала в виде потока сообщений.</span><span class="sxs-lookup"><span data-stu-id="77724-128">Data is read from the pipe as a stream of messages.</span></span> <span data-ttu-id="77724-129">Операция чтения успешно завершена только при считывании всего сообщения.</span><span class="sxs-lookup"><span data-stu-id="77724-129">A read operation is completed successfully only when the entire message is read.</span></span> <span data-ttu-id="77724-130">Если указанное число считанных байтов меньше размера следующего сообщения, функция считывает как можно больше сообщений, прежде чем возвращать ноль (функция [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) возвращает ошибку \_ больше \_ данных).</span><span class="sxs-lookup"><span data-stu-id="77724-130">If the specified number of bytes to read is less than the size of the next message, the function reads as much of the message as possible before returning zero (the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function returns ERROR\_MORE\_DATA).</span></span> <span data-ttu-id="77724-131">Оставшуюся часть сообщения можно прочитать с помощью другой операции чтения.</span><span class="sxs-lookup"><span data-stu-id="77724-131">The remainder of the message can be read using another read operation.</span></span>

<span data-ttu-id="77724-132">Для клиента канала обработчик канала, возвращаемый функцией [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) , изначально всегда находится в режиме чтения байтов.</span><span class="sxs-lookup"><span data-stu-id="77724-132">For a pipe client, a pipe handle returned by [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) is always in byte-read mode initially.</span></span> <span data-ttu-id="77724-133">Как клиенты, так и серверы канала могут использовать функцию [**сетнамедпипехандлестате**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-setnamedpipehandlestate) для изменения режима чтения для маркера канала.</span><span class="sxs-lookup"><span data-stu-id="77724-133">Both pipe clients and pipe servers can use the [**SetNamedPipeHandleState**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-setnamedpipehandlestate) function to change the read mode of a pipe handle.</span></span> <span data-ttu-id="77724-134">Обработчик канала должен иметь \_ \_ право доступа к атрибутам записи файла.</span><span class="sxs-lookup"><span data-stu-id="77724-134">The pipe handle must have the FILE\_WRITE\_ATTRIBUTES access right.</span></span>

## <a name="wait-mode"></a><span data-ttu-id="77724-135">Режим ожидания</span><span class="sxs-lookup"><span data-stu-id="77724-135">Wait Mode</span></span>

<span data-ttu-id="77724-136">Режим ожидания для маркера канала определяет, как функции [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile)и [**коннектнамедпипе**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) обрабатывали длительные операции.</span><span class="sxs-lookup"><span data-stu-id="77724-136">The wait mode of a pipe handle determines how the [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), and [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) functions handle lengthy operations.</span></span> <span data-ttu-id="77724-137">В режиме ожидания блокировки функции неограниченное время ожидают для процесса на другом конце канала, чтобы завершить операцию.</span><span class="sxs-lookup"><span data-stu-id="77724-137">In blocking-wait mode, the functions wait indefinitely for a process on the other end of the pipe to complete an operation.</span></span> <span data-ttu-id="77724-138">В режиме неблокирующего ожидания функции немедленно возвращают в ситуации, в которых в противном случае требовалось неопределенное время ожидания.</span><span class="sxs-lookup"><span data-stu-id="77724-138">In nonblocking-wait mode, the functions return immediately in situations that would otherwise require an indefinite wait.</span></span>

<span data-ttu-id="77724-139">На операцию [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) влияет режим ожидания для обработчика канала, если канал пуст.</span><span class="sxs-lookup"><span data-stu-id="77724-139">A [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) operation is affected by the wait mode of a pipe handle when the pipe is empty.</span></span> <span data-ttu-id="77724-140">С помощью маркера ожидания блокировки операция не завершается успешно, пока данные не будут доступны из потока, записывающего на другой конец канала.</span><span class="sxs-lookup"><span data-stu-id="77724-140">With a blocking-wait handle, the operation is not completed successfully until data is available from a thread writing to the other end of the pipe.</span></span> <span data-ttu-id="77724-141">Используя неблокирующий маркер-Wait, функция немедленно возвращает ноль, а функция [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) возвращает ошибку \_ No \_ Data.</span><span class="sxs-lookup"><span data-stu-id="77724-141">Using a nonblocking-wait handle, the function returns zero immediately, and the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function returns ERROR\_NO\_DATA.</span></span>

<span data-ttu-id="77724-142">На операцию [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) влияет режим ожидания для обработчика канала при недостатке места в буфере канала.</span><span class="sxs-lookup"><span data-stu-id="77724-142">A [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) operation is affected by the wait mode of a pipe handle when there is insufficient space in the pipe's buffer.</span></span> <span data-ttu-id="77724-143">С помощью маркера ожидания блокировки операция записи не может быть выполнена до тех пор, пока в буфере не будет создано достаточно места потоком, считывающим с другого конца канала.</span><span class="sxs-lookup"><span data-stu-id="77724-143">With a blocking-wait handle, the write operation cannot succeed until sufficient space is created in the buffer by a thread reading from the other end of the pipe.</span></span> <span data-ttu-id="77724-144">С помощью неблокирующего обработчика ожидания операция записи возвращает ненулевое значение немедленно, без записи байтов (для канала типа сообщения) или после записи как количество байт, которое содержит буфер (для канала типа Byte).</span><span class="sxs-lookup"><span data-stu-id="77724-144">With a nonblocking-wait handle, the write operation returns a nonzero value immediately, without writing any bytes (for a message-type pipe) or after writing as many bytes as the buffer holds (for a byte-type pipe).</span></span>

<span data-ttu-id="77724-145">На операцию [**коннектнамедпипе**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) влияет режим ожидания для обработки канала при отсутствии подключения клиента или ожидания соединения с экземпляром канала.</span><span class="sxs-lookup"><span data-stu-id="77724-145">A [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) operation is affected by the wait mode of a pipe handle when there is no client connected or waiting to connect to the pipe instance.</span></span> <span data-ttu-id="77724-146">При использовании маркера ожидания блокировки операция подключения не выполняется до тех пор, пока клиент канала не подключится к экземпляру канала, вызвав функцию [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) или [**каллнамедпипе**](/windows/desktop/api/Winbase/nf-winbase-callnamedpipea) .</span><span class="sxs-lookup"><span data-stu-id="77724-146">With a blocking-wait handle, the connect operation does not succeed until a pipe client connects to the pipe instance by calling either the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) or [**CallNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-callnamedpipea) function.</span></span> <span data-ttu-id="77724-147">При использовании неблокирующего маркера ожидания операция подключения немедленно возвращает ноль, а функция [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) ВОЗВРАЩАЕТ \_ канал ошибки \_ .</span><span class="sxs-lookup"><span data-stu-id="77724-147">With a nonblocking-wait handle, the connect operation returns zero immediately, and the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function returns ERROR\_PIPE\_LISTENING.</span></span>

<span data-ttu-id="77724-148">По умолчанию все дескрипторы именованных каналов, возвращаемые функцией [**креатенамедпипе**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) или [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) , создаются с включенным режимом ожидания блокировки.</span><span class="sxs-lookup"><span data-stu-id="77724-148">By default, all named pipe handles returned by the [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) or [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function are created with blocking-wait mode enabled.</span></span> <span data-ttu-id="77724-149">Чтобы создать канал в режиме неблокирующего ожидания, сервер канала определяет канал с параметром \_ Wait при вызове **креатенамедпипе**.</span><span class="sxs-lookup"><span data-stu-id="77724-149">To create the pipe in nonblocking-wait mode, the pipe server specifies PIPE\_NOWAIT when calling **CreateNamedPipe**.</span></span>

<span data-ttu-id="77724-150">Клиенты канала и серверы канала могут изменить режим ожидания обработчика канала, указав либо канал ожидания канала, \_ либо канал без \_ ожидания при вызове функции [**сетнамедпипехандлестате**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-setnamedpipehandlestate) .</span><span class="sxs-lookup"><span data-stu-id="77724-150">Both pipe clients and pipe servers can change a pipe handle's wait mode by specifying either PIPE\_WAIT or PIPE\_NOWAIT in a call to the [**SetNamedPipeHandleState**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-setnamedpipehandlestate) function.</span></span>

> [!Note]  
> <span data-ttu-id="77724-151">Режим неблокирующего ожидания поддерживается для обеспечения совместимости с Microsoft LAN Manager версии 2,0.</span><span class="sxs-lookup"><span data-stu-id="77724-151">The nonblocking-wait mode is supported for compatibility with Microsoft LAN Manager version 2.0.</span></span> <span data-ttu-id="77724-152">Этот режим не следует использовать для получения перекрывающихся входных и выходных данных (ввода-вывода) с именованными каналами.</span><span class="sxs-lookup"><span data-stu-id="77724-152">This mode should not be used to achieve overlapped input and output (I/O) with named pipes.</span></span> <span data-ttu-id="77724-153">Вместо этого следует использовать перекрывающиеся операции ввода-вывода, так как она позволяет выполнять трудоемкую операцию в фоновом режиме после возврата функции.</span><span class="sxs-lookup"><span data-stu-id="77724-153">Overlapped I/O should be used instead, because it enables time-consuming operations to run in the background after the function returns.</span></span> <span data-ttu-id="77724-154">Дополнительные сведения о перекрывающихся операциях ввода-вывода см. в разделе [синхронные и перекрывающиеся входные и выходные данные](synchronous-and-overlapped-input-and-output.md).</span><span class="sxs-lookup"><span data-stu-id="77724-154">For more information about overlapped I/O, see [Synchronous and Overlapped Input and Output](synchronous-and-overlapped-input-and-output.md).</span></span>

 

 

 
