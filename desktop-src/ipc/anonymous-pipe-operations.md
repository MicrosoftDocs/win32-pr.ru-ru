---
description: Операции с анонимным каналом, включая создание канала, запись в канал, дескрипторы каналов.
ms.assetid: df81471c-1072-4456-a877-304e76ade4bd
title: Операции с анонимным каналом
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 963d7127c51859b05e570d00291470a49be5ba66
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105683290"
---
# <a name="anonymous-pipe-operations"></a><span data-ttu-id="26212-103">Операции с анонимным каналом</span><span class="sxs-lookup"><span data-stu-id="26212-103">Anonymous Pipe Operations</span></span>

<span data-ttu-id="26212-104">Функция [**креатепипе**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-createpipe) создает анонимный канал и возвращает два маркера: дескриптор чтения для канала и дескриптор записи в канал.</span><span class="sxs-lookup"><span data-stu-id="26212-104">The [**CreatePipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-createpipe) function creates an anonymous pipe and returns two handles: a read handle to the pipe and a write handle to the pipe.</span></span> <span data-ttu-id="26212-105">Маркер чтения имеет доступ только для чтения к каналу, а маркер записи имеет доступ только на запись к каналу.</span><span class="sxs-lookup"><span data-stu-id="26212-105">The read handle has read-only access to the pipe, and the write handle has write-only access to the pipe.</span></span> <span data-ttu-id="26212-106">Для обмена данными с помощью канала сервер канала должен передать обработчику канала другой процесс.</span><span class="sxs-lookup"><span data-stu-id="26212-106">To communicate using the pipe, the pipe server must pass a pipe handle to another process.</span></span> <span data-ttu-id="26212-107">Обычно это осуществляется с помощью наследования. то есть процесс допускает наследование маркера дочерним процессом.</span><span class="sxs-lookup"><span data-stu-id="26212-107">Usually, this is done through inheritance; that is, the process allows the handle to be inherited by a child process.</span></span> <span data-ttu-id="26212-108">Этот процесс также может дублировать обработчик канала с помощью функции [**дупликатехандле**](/windows/desktop/api/handleapi/nf-handleapi-duplicatehandle) и отправить его в несвязанный процесс, используя некоторую форму межпроцессного взаимодействия, например DDE или общую память.</span><span class="sxs-lookup"><span data-stu-id="26212-108">The process can also duplicate a pipe handle using the [**DuplicateHandle**](/windows/desktop/api/handleapi/nf-handleapi-duplicatehandle) function and send it to an unrelated process using some form of interprocess communication, such as DDE or shared memory.</span></span>

<span data-ttu-id="26212-109">Сервер канала может отправить клиенту канала либо маркер чтения, либо маркер записи, в зависимости от того, должен ли клиент использовать анонимный канал для отправки информации или получения сведений.</span><span class="sxs-lookup"><span data-stu-id="26212-109">A pipe server can send either the read handle or the write handle to the pipe client, depending on whether the client should use the anonymous pipe to send information or receive information.</span></span> <span data-ttu-id="26212-110">Для чтения из канала используйте маркер чтения канала в вызове функции [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) .</span><span class="sxs-lookup"><span data-stu-id="26212-110">To read from the pipe, use the pipe's read handle in a call to the [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) function.</span></span> <span data-ttu-id="26212-111">Вызов **ReadFile** возвращается, когда в канал записывается другой процесс.</span><span class="sxs-lookup"><span data-stu-id="26212-111">The **ReadFile** call returns when another process has written to the pipe.</span></span> <span data-ttu-id="26212-112">Вызов **ReadFile** также может возвращать значение, если все дескрипторы записи в канал были закрыты, или если ошибка возникает до завершения операции чтения.</span><span class="sxs-lookup"><span data-stu-id="26212-112">The **ReadFile** call can also return if all write handles to the pipe have been closed or if an error occurs before the read operation has been completed.</span></span>

<span data-ttu-id="26212-113">Для записи в канал используйте маркер записи канала в вызове функции [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) .</span><span class="sxs-lookup"><span data-stu-id="26212-113">To write to the pipe, use the pipe's write handle in a call to the [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) function.</span></span> <span data-ttu-id="26212-114">Вызов **WriteFile** не возвращает значение до тех пор, пока не будет записано указанное число байтов в канал или возникает ошибка.</span><span class="sxs-lookup"><span data-stu-id="26212-114">The **WriteFile** call does not return until it has written the specified number of bytes to the pipe or an error occurs.</span></span> <span data-ttu-id="26212-115">Если буфер канала полон и имеется больше байтов для написания, **WriteFile** не возвращает данные, пока другой процесс не считывает из канала, что делает доступным больше места в буфере.</span><span class="sxs-lookup"><span data-stu-id="26212-115">If the pipe buffer is full and there are more bytes to be written, **WriteFile** does not return until another process reads from the pipe, making more buffer space available.</span></span> <span data-ttu-id="26212-116">Сервер канала указывает размер буфера для канала при вызове [**креатепипе**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-createpipe).</span><span class="sxs-lookup"><span data-stu-id="26212-116">The pipe server specifies the buffer size for the pipe when it calls [**CreatePipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-createpipe).</span></span>

<span data-ttu-id="26212-117">Асинхронные (перекрывающиеся) операции чтения и записи не поддерживаются анонимными каналами.</span><span class="sxs-lookup"><span data-stu-id="26212-117">Asynchronous (overlapped) read and write operations are not supported by anonymous pipes.</span></span> <span data-ttu-id="26212-118">Это означает, что нельзя использовать функции [**реадфиликс**](/windows/desktop/api/fileapi/nf-fileapi-readfileex) и [**вритефиликс**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) с анонимными каналами.</span><span class="sxs-lookup"><span data-stu-id="26212-118">This means that you cannot use the [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex) and [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) functions with anonymous pipes.</span></span> <span data-ttu-id="26212-119">Кроме того, параметр *лповерлаппед* параметров [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) и [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) игнорируется, если эти функции используются с анонимными каналами.</span><span class="sxs-lookup"><span data-stu-id="26212-119">In addition, the *lpOverlapped* parameter of [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) and [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) is ignored when these functions are used with anonymous pipes.</span></span>

<span data-ttu-id="26212-120">Анонимный канал существует до тех пор, пока не будут закрыты все дескрипторы канала, как чтение, так и запись.</span><span class="sxs-lookup"><span data-stu-id="26212-120">An anonymous pipe exists until all pipe handles, both read and write, have been closed.</span></span> <span data-ttu-id="26212-121">Процесс может закрыть свои дескрипторы канала с помощью функции [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) .</span><span class="sxs-lookup"><span data-stu-id="26212-121">A process can close its pipe handles by using the [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) function.</span></span> <span data-ttu-id="26212-122">Все дескрипторы каналов также закрываются после завершения процесса.</span><span class="sxs-lookup"><span data-stu-id="26212-122">All pipe handles are also closed when the process terminates.</span></span>

<span data-ttu-id="26212-123">Анонимные каналы реализуются с помощью именованного канала с уникальным именем.</span><span class="sxs-lookup"><span data-stu-id="26212-123">Anonymous pipes are implemented using a named pipe with a unique name.</span></span> <span data-ttu-id="26212-124">Таким образом, часто можно передать обработчику анонимный канал в функцию, для которой требуется маркер именованного канала.</span><span class="sxs-lookup"><span data-stu-id="26212-124">Therefore, you can often pass a handle to an anonymous pipe to a function that requires a handle to a named pipe.</span></span>

 

 
