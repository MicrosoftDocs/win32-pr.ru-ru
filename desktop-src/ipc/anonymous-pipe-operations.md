---
description: Операции с анонимным каналом, включая создание канала, запись в канал, дескрипторы каналов.
ms.assetid: df81471c-1072-4456-a877-304e76ade4bd
title: Операции с анонимным каналом
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 963d7127c51859b05e570d00291470a49be5ba66
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105683290"
---
# <a name="anonymous-pipe-operations"></a>Операции с анонимным каналом

Функция [**креатепипе**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-createpipe) создает анонимный канал и возвращает два маркера: дескриптор чтения для канала и дескриптор записи в канал. Маркер чтения имеет доступ только для чтения к каналу, а маркер записи имеет доступ только на запись к каналу. Для обмена данными с помощью канала сервер канала должен передать обработчику канала другой процесс. Обычно это осуществляется с помощью наследования. то есть процесс допускает наследование маркера дочерним процессом. Этот процесс также может дублировать обработчик канала с помощью функции [**дупликатехандле**](/windows/desktop/api/handleapi/nf-handleapi-duplicatehandle) и отправить его в несвязанный процесс, используя некоторую форму межпроцессного взаимодействия, например DDE или общую память.

Сервер канала может отправить клиенту канала либо маркер чтения, либо маркер записи, в зависимости от того, должен ли клиент использовать анонимный канал для отправки информации или получения сведений. Для чтения из канала используйте маркер чтения канала в вызове функции [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) . Вызов **ReadFile** возвращается, когда в канал записывается другой процесс. Вызов **ReadFile** также может возвращать значение, если все дескрипторы записи в канал были закрыты, или если ошибка возникает до завершения операции чтения.

Для записи в канал используйте маркер записи канала в вызове функции [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) . Вызов **WriteFile** не возвращает значение до тех пор, пока не будет записано указанное число байтов в канал или возникает ошибка. Если буфер канала полон и имеется больше байтов для написания, **WriteFile** не возвращает данные, пока другой процесс не считывает из канала, что делает доступным больше места в буфере. Сервер канала указывает размер буфера для канала при вызове [**креатепипе**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-createpipe).

Асинхронные (перекрывающиеся) операции чтения и записи не поддерживаются анонимными каналами. Это означает, что нельзя использовать функции [**реадфиликс**](/windows/desktop/api/fileapi/nf-fileapi-readfileex) и [**вритефиликс**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) с анонимными каналами. Кроме того, параметр *лповерлаппед* параметров [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) и [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) игнорируется, если эти функции используются с анонимными каналами.

Анонимный канал существует до тех пор, пока не будут закрыты все дескрипторы канала, как чтение, так и запись. Процесс может закрыть свои дескрипторы канала с помощью функции [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) . Все дескрипторы каналов также закрываются после завершения процесса.

Анонимные каналы реализуются с помощью именованного канала с уникальным именем. Таким образом, часто можно передать обработчику анонимный канал в функцию, для которой требуется маркер именованного канала.

 

 
