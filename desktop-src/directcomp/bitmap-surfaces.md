---
title: Растровые объекты
description: В этом разделе описываются типы растрового содержимого, которое поддерживает DirectComposition.
ms.assetid: BC32CF76-D5E4-4B25-AFD5-42E8DABFA0D0
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c390778fef1ee7ad96c90a8b7706fa635f3615ff
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104413593"
---
# <a name="bitmap-objects"></a><span data-ttu-id="59064-103">Растровые объекты</span><span class="sxs-lookup"><span data-stu-id="59064-103">Bitmap objects</span></span>

> [!NOTE]
> <span data-ttu-id="59064-104">Для приложений в Windows 10 рекомендуется использовать интерфейсы API Windows. UI. компоновки вместо DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="59064-104">For apps on Windows 10, we recommend using Windows.UI.Composition APIs instead of DirectComposition.</span></span> <span data-ttu-id="59064-105">Дополнительные сведения см. в разделе [модернизировать The классическое приложение с использованием визуального слоя](/windows/uwp/composition/visual-layer-in-desktop-apps).</span><span class="sxs-lookup"><span data-stu-id="59064-105">For more info, see [Modernize your desktop app using the Visual layer](/windows/uwp/composition/visual-layer-in-desktop-apps).</span></span>

<span data-ttu-id="59064-106">Microsoft DirectComposition — это механизм компоновки точечных рисунков.</span><span class="sxs-lookup"><span data-stu-id="59064-106">Microsoft DirectComposition is a bitmap compositing engine.</span></span> <span data-ttu-id="59064-107">Он позволяет разработчикам приложений объединять несколько растровых изображений и манипулировать ими различными способами для достижения интересных визуальных эффектов и анимации в пользовательском интерфейсе приложения.</span><span class="sxs-lookup"><span data-stu-id="59064-107">It enables application developers to combine multiple bitmaps and manipulate them in various ways to achieve interesting visual effects and animations in an application UI.</span></span> <span data-ttu-id="59064-108">В этом разделе описываются типы растрового содержимого, которое поддерживает DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="59064-108">This topic describes the types of bitmap content that DirectComposition supports.</span></span>

-   [<span data-ttu-id="59064-109">Растровое содержимое</span><span class="sxs-lookup"><span data-stu-id="59064-109">Bitmap content</span></span>](#bitmap-content)
    -   [<span data-ttu-id="59064-110">Растровые изображения видеопамяти</span><span class="sxs-lookup"><span data-stu-id="59064-110">Video memory bitmaps</span></span>](#video-memory-bitmaps)
    -   [<span data-ttu-id="59064-111">Точечные рисунки окна</span><span class="sxs-lookup"><span data-stu-id="59064-111">Window bitmaps</span></span>](#window-bitmaps)
    -   [<span data-ttu-id="59064-112">Связывание содержимого растрового изображения с визуальным элементом</span><span class="sxs-lookup"><span data-stu-id="59064-112">Associating bitmap content with a visual</span></span>](#associating-bitmap-content-with-a-visual)
    -   [<span data-ttu-id="59064-113">Альфа-канал</span><span class="sxs-lookup"><span data-stu-id="59064-113">Alpha channel</span></span>](#alpha-channel)
-   [<span data-ttu-id="59064-114">См. также</span><span class="sxs-lookup"><span data-stu-id="59064-114">Related topics</span></span>](#related-topics)

## <a name="bitmap-content"></a><span data-ttu-id="59064-115">Растровое содержимое</span><span class="sxs-lookup"><span data-stu-id="59064-115">Bitmap content</span></span>

<span data-ttu-id="59064-116">Приложения предоставляют DirectComposition с растровым содержимым для создания и анимации путем создания визуальных объектов и установки [свойства содержимого](basic-concepts.md) этих объектов.</span><span class="sxs-lookup"><span data-stu-id="59064-116">Applications provide DirectComposition with the bitmap content to compose and animate by creating visual objects and then setting the [Content property](basic-concepts.md) of those objects.</span></span> <span data-ttu-id="59064-117">DirectComposition не предоставляет службы растрирования.</span><span class="sxs-lookup"><span data-stu-id="59064-117">DirectComposition does not offer any rasterization services.</span></span> <span data-ttu-id="59064-118">Приложение должно использовать другую библиотеку растрирования с аппаратным ускорением, например [Direct2D](../direct2d/direct2d-portal.md) или [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) , для заполнения составных точечных рисунков.</span><span class="sxs-lookup"><span data-stu-id="59064-118">An application must use some other software-based or hardware-accelerated rasterization library such as [Direct2D](../direct2d/direct2d-portal.md) or [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) to populate the bitmaps that are to be composed.</span></span> <span data-ttu-id="59064-119">После составления DirectComposition передает составное растровое содержимое в [Диспетчер окон рабочего стола (DWM)](/windows/desktop/dwm/dwm-overview) для отрисовки на экране.</span><span class="sxs-lookup"><span data-stu-id="59064-119">After composing, DirectComposition passes composed bitmap content to [Desktop Window Manager (DWM)](/windows/desktop/dwm/dwm-overview) for rendering to the screen.</span></span>

<span data-ttu-id="59064-120">**Поддерживаемые типы растрового содержимого**   Microsoft DirectComposition поддерживает следующие виды точечных рисунков:</span><span class="sxs-lookup"><span data-stu-id="59064-120">**Supported types of bitmap content** Microsoft DirectComposition supports the following kinds of bitmaps:</span></span>

-   [<span data-ttu-id="59064-121">Растровые изображения видеопамяти</span><span class="sxs-lookup"><span data-stu-id="59064-121">Video memory bitmaps</span></span>](#video-memory-bitmaps)
-   [<span data-ttu-id="59064-122">Точечные рисунки окна</span><span class="sxs-lookup"><span data-stu-id="59064-122">Window bitmaps</span></span>](#window-bitmaps)

### <a name="video-memory-bitmaps"></a><span data-ttu-id="59064-123">Растровые изображения видеопамяти</span><span class="sxs-lookup"><span data-stu-id="59064-123">Video memory bitmaps</span></span>

<span data-ttu-id="59064-124">Растровое изображение видеопамяти можно растрово использовать в аппаратном обеспечении с помощью методов Microsoft DirectX (включая модель взаимодействия DX-to-GDI).</span><span class="sxs-lookup"><span data-stu-id="59064-124">A video memory bitmap is rasterized in hardware by using Microsoft DirectX methods (including the DX-to-GDI interop model).</span></span> <span data-ttu-id="59064-125">Он поддерживается перекрестными общими областями, видимыми вызывающему приложению и DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="59064-125">It is backed by cross-process shared surfaces that are visible to the calling application and to DirectComposition.</span></span> <span data-ttu-id="59064-126">Точечный рисунок видеопамяти не подлежит разрыву, так как приложение может считывать данные только из поверхностей, DirectComposition текстуры от.</span><span class="sxs-lookup"><span data-stu-id="59064-126">A video memory bitmap is not subject to tearing because the application can only read from the surfaces that DirectComposition textures from.</span></span>

### <a name="video-content"></a><span data-ttu-id="59064-127">Видеоматериал</span><span class="sxs-lookup"><span data-stu-id="59064-127">Video content</span></span>

<span data-ttu-id="59064-128">Приложения могут использовать DirectComposition для создания кадров видео, использующих цепочки подкачки DirectX без окон, привязанные к поверхности DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="59064-128">Applications can use DirectComposition to compose video frames that use DirectX windowless swap chains that are bound to a DirectComposition surface.</span></span> <span data-ttu-id="59064-129">По сути, DirectComposition считает содержимое видео последовательностью растровых изображений.</span><span class="sxs-lookup"><span data-stu-id="59064-129">Conceptually, DirectComposition treats video content as a sequence of bitmaps.</span></span> <span data-ttu-id="59064-130">DirectComposition не предоставляет средств для представления видеокадров.</span><span class="sxs-lookup"><span data-stu-id="59064-130">DirectComposition does not provide a means of presenting video frames.</span></span>

<span data-ttu-id="59064-131">DirectComposition поддерживает бесоконные цепочки подкачки, то есть цепочки подкачки, не привязанные к конкретному окну, и позволяет двум различным приложениям совместно использовать цепочки подкачки без окон через границы процесса.</span><span class="sxs-lookup"><span data-stu-id="59064-131">DirectComposition supports DirectX windowless swap chains—that is, swap chains that are not bound to a particular window—and enables two different applications to share windowless swap chains across process boundaries.</span></span> <span data-ttu-id="59064-132">Совместное использование бесоконных цепочек подкачки позволяет выполнять видеосценарии, в которых цепочка буферов создается в одном процессе и используется с DirectComposition во втором процессе.</span><span class="sxs-lookup"><span data-stu-id="59064-132">Sharing windowless swap chains enables video scenarios where the swap chain is created in one process and is used with DirectComposition in a second process.</span></span> <span data-ttu-id="59064-133">Цепочки подкачки без окон создаются с помощью метода [**IDXGIFactory2:: креатесвапчаинфоркомпоситионсурфаце**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforcomposition) .</span><span class="sxs-lookup"><span data-stu-id="59064-133">Windowless swap chains are created using the [**IDXGIFactory2::CreateSwapChainForCompositionSurface**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforcomposition) method.</span></span>

<span data-ttu-id="59064-134">Дополнительные сведения о цепочках подкачки DirectX см. в статье [Общие сведения о DXGI](/windows/desktop/direct3ddxgi/d3d10-graphics-programming-guide-dxgi).</span><span class="sxs-lookup"><span data-stu-id="59064-134">For more information about DirectX swap chains, see [DXGI Overview](/windows/desktop/direct3ddxgi/d3d10-graphics-programming-guide-dxgi).</span></span>

### <a name="stereo-content"></a><span data-ttu-id="59064-135">Стерео содержимое</span><span class="sxs-lookup"><span data-stu-id="59064-135">Stereo content</span></span>

<span data-ttu-id="59064-136">По сути, цепочка стереозвука состоит из поверхностей Microsoft DirectX Graphics Framework (DXGI), представляющих левый и правый каналы для стерео трехмерного содержимого.</span><span class="sxs-lookup"><span data-stu-id="59064-136">Conceptually, a stereo swap chain consists of Microsoft DirectX Graphics Infrastructure (DXGI) surfaces that represent the left and right channels for stereo 3D content.</span></span> <span data-ttu-id="59064-137">Если цепочка стереозвука используется в качестве ресурса точечного рисунка для визуального элемента, DirectComposition в стерео.</span><span class="sxs-lookup"><span data-stu-id="59064-137">When a stereo swap chain is used as the bitmap resource for a visual, DirectComposition composes in stereo.</span></span> <span data-ttu-id="59064-138">Все нестерео-содержимое (содержимое Mono) считается идентичным левым и правым каналом. то есть для обоих каналов используется одно и то же содержимое растрового изображения.</span><span class="sxs-lookup"><span data-stu-id="59064-138">All non-stereo content (mono content) is considered to have identical left and right channel content; that is, the same bitmap content is used for both channels.</span></span> <span data-ttu-id="59064-139">DirectComposition объединяет все содержимое левого и правого содержимого отдельно.</span><span class="sxs-lookup"><span data-stu-id="59064-139">DirectComposition composes all left content and all right content separately.</span></span> <span data-ttu-id="59064-140">Если устройство вывода не поддерживает стерео, DirectComposition рассматривает левый или правый канал (в зависимости от приложения) как содержимое Mono и объединяет его, используя только эти данные для ресурса точечного рисунка.</span><span class="sxs-lookup"><span data-stu-id="59064-140">If the display device is not stereo capable, DirectComposition treats the left or right stereo channel (depending on the application) as mono content and composes using only that data for the bitmap resource.</span></span>

<span data-ttu-id="59064-141">DirectComposition не поддерживает создание и обработку стерео-содержимого, а также не может повысить уровень цепочки Mono до пары стерео.</span><span class="sxs-lookup"><span data-stu-id="59064-141">DirectComposition does not support creating or manipulating stereo content, and cannot promote a mono swap chain to a stereo pair.</span></span> <span data-ttu-id="59064-142">Приложение должно выполнить эти задачи перед показом содержимого DirectX стерео в DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="59064-142">An application must perform these tasks before presenting DirectX stereo content to DirectComposition.</span></span> <span data-ttu-id="59064-143">Кроме того, приложение должно предоставлять смещения левого и правого канала для восприятия глубины; DirectComposition не может скорректировать значения левого и правого смещения канала, чтобы изменить воспринимаемую глубину стерео содержимого DirectX.</span><span class="sxs-lookup"><span data-stu-id="59064-143">Also, an application must provide the left and right channel offsets for depth perception; DirectComposition cannot adjust the left and right channel offsets to modify the perceived depth of DirectX stereo content.</span></span>

<span data-ttu-id="59064-144">Стерео-содержимое DirectX состояло и сохраняется в DWM, когда доступно оборудование с поддержкой стерео.</span><span class="sxs-lookup"><span data-stu-id="59064-144">DirectX stereo content is composed and persisted to DWM when stereo-capable hardware is available.</span></span>

### <a name="window-bitmaps"></a><span data-ttu-id="59064-145">Точечные рисунки окна</span><span class="sxs-lookup"><span data-stu-id="59064-145">Window bitmaps</span></span>

<span data-ttu-id="59064-146">"Точечный рисунок" не является реальным точечным рисунком, но является заполнителем, который DirectComposition заменяет в режиме реального времени с помощью растрирования многоуровневого или дочернего окна верхнего уровня.</span><span class="sxs-lookup"><span data-stu-id="59064-146">A "window bitmap" is not a real bitmap, but is a placeholder that DirectComposition replaces in real time with rasterizations of layered top-level or child windows.</span></span> <span data-ttu-id="59064-147">Растровое изображение окна аналогично эскизу DWM, за исключением того, что эскиз может содержать вклады из многих окон, например принадлежащие дочерние окна, в то время как точечный рисунок окна DirectComposition всегда является представлением всего одного окна и его дочерних элементов.</span><span class="sxs-lookup"><span data-stu-id="59064-147">A window bitmap is similar to a DWM thumbnail, except that a thumbnail can contain contributions from many windows, such as owned non-child windows, whereas a DirectComposition window bitmap is always a representation of just one window and its children.</span></span>

<span data-ttu-id="59064-148">Поскольку DirectComposition имеет доступ к областям перенаправления всех окон и всех визуальных деревьев, он может повторно использовать содержимое из одного окна в нескольких визуальных деревьях.</span><span class="sxs-lookup"><span data-stu-id="59064-148">Because DirectComposition has access to the redirection surfaces of all windows and all visual trees, it can reuse the content from one window in multiple visual trees.</span></span> <span data-ttu-id="59064-149">Окно должно быть разслойно, поскольку в неслоеном окне отсутствует выделенная поверхность перенаправления и, следовательно, ее растрирование не всегда доступна для DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="59064-149">The window must be layered because a non-layered window does not have a dedicated redirection surface and, therefore, its rasterization is not always available to DirectComposition.</span></span>

<span data-ttu-id="59064-150">Чтобы использовать точечный рисунок окна, приложение связывает визуальный элемент с дескриптором окна (HWND).</span><span class="sxs-lookup"><span data-stu-id="59064-150">To use a window bitmap, an application associates a visual with a window handle (HWND).</span></span> <span data-ttu-id="59064-151">После этого DirectComposition повторно создает визуальный элемент при каждом изменении содержимого окна, включая изменение содержимого в результате изменений визуальных деревьев, связанных с окном.</span><span class="sxs-lookup"><span data-stu-id="59064-151">Afterward, DirectComposition re-composes the visual whenever the contents of the window change, including when the contents change as a result of changes to the visual trees associated with the window.</span></span> <span data-ttu-id="59064-152">Другими словами, как эскизы DWM, точечные рисунки DirectComposition окна являются динамическими.</span><span class="sxs-lookup"><span data-stu-id="59064-152">In other words, like DWM thumbnails, DirectComposition window bitmaps are "live".</span></span>

### <a name="associating-bitmap-content-with-a-visual"></a><span data-ttu-id="59064-153">Связывание содержимого растрового изображения с визуальным элементом</span><span class="sxs-lookup"><span data-stu-id="59064-153">Associating bitmap content with a visual</span></span>

<span data-ttu-id="59064-154">Для всех трех видов точечных рисунков приложение может связать один и тот же точечный рисунок с несколькими визуальными элементами. Это означает, что одно выделение памяти может использоваться для отображения одного и того же содержимого несколько раз.</span><span class="sxs-lookup"><span data-stu-id="59064-154">For all three kinds of bitmaps, an application can associate the same bitmap with multiple visuals, which means that a single memory allocation can be used to display the same content several times.</span></span>

### <a name="alpha-channel"></a><span data-ttu-id="59064-155">Альфа-канал</span><span class="sxs-lookup"><span data-stu-id="59064-155">Alpha channel</span></span>

<span data-ttu-id="59064-156">Все точечные рисунки имеют формат 32 бит на пиксель (бит в пикселах), который включает восемь бит для прозрачности на пиксель.</span><span class="sxs-lookup"><span data-stu-id="59064-156">All bitmaps have a 32 bits per pixel (BPP) format, which includes eight bits for per-pixel transparency.</span></span> <span data-ttu-id="59064-157">Однако приложение может указать, как DirectComposition должен использовать альфа-канал.</span><span class="sxs-lookup"><span data-stu-id="59064-157">However, an application can specify how DirectComposition should consume the alpha channel.</span></span> <span data-ttu-id="59064-158">В частности, DirectComposition может состоять из альфа-канала или вообще игнорировать альфа-канал. в этом случае точечный рисунок считается полностью непрозрачным.</span><span class="sxs-lookup"><span data-stu-id="59064-158">In particular, DirectComposition can respect the alpha channel, or it can ignore alpha altogether, in which case the bitmap is considered to be fully opaque.</span></span>

<span data-ttu-id="59064-159">В дополнительном режиме альфа-канала этот канал игнорируется, но значения красного, зеленого и синего интерпретируются как значения альфа для каждого канала вместо обычной интерпретации этих каналов как интенситиес Color.</span><span class="sxs-lookup"><span data-stu-id="59064-159">An additional alpha mode ignores the alpha channel, but treats the red, green, and blue values as per-channel alpha values instead of the normal interpretation of those channels as color intensities.</span></span> <span data-ttu-id="59064-160">Этот режим удобен для визуализации с поддержкой ClearType, для чего требуются сведения о покрытии.</span><span class="sxs-lookup"><span data-stu-id="59064-160">This mode is useful for ClearType rendering, which requires sub-pixel coverage information.</span></span> <span data-ttu-id="59064-161">Чтобы использовать режим альфа для каждого канала, приложение должно сначала использовать [Direct2D](../direct2d/direct2d-portal.md) и [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) для записи данных о покрытии в точечный рисунок.</span><span class="sxs-lookup"><span data-stu-id="59064-161">To use the per-channel alpha mode, an application must first use [Direct2D](../direct2d/direct2d-portal.md) and [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) to write sub-pixel coverage data to a bitmap.</span></span> <span data-ttu-id="59064-162">Затем приложение должно установить правильный режим альфа-канала и указать цвет текста при связывании точечного рисунка с визуальным изображением.</span><span class="sxs-lookup"><span data-stu-id="59064-162">Next the application must set the correct alpha mode and specify a text color when it associates the bitmap with a visual.</span></span> <span data-ttu-id="59064-163">DirectComposition смешивает цвет текста с данными о покрытии, что обеспечивает ClearType в смешении с фоном.</span><span class="sxs-lookup"><span data-stu-id="59064-163">DirectComposition blends the text color with the coverage data, which produces ClearType blending against the background.</span></span>

<span data-ttu-id="59064-164">В ситуациях, когда алгоритм ClearType неприменим, например, если точечный рисунок не соответствует разровну по осям и не должен быть нарисован на промежуточной поверхности, DirectComposition может использовать данные о покрытии в точечном рисунке для создания растрирования в градациях серого вместо этого автоматически и без дополнительных затрат.</span><span class="sxs-lookup"><span data-stu-id="59064-164">In situations where the ClearType algorithm is not applicable, such as if the bitmap is not pixel-aligned and axis-aligned, or if it needs to be drawn to an intermediate surface, DirectComposition can use the subpixel coverage data in the bitmap to produce a grayscale rasterization instead, automatically and at no additional cost.</span></span>

<span data-ttu-id="59064-165">Дополнительные сведения см. в описании параметра *алфамоде* функции [**Идкомпоситиондевице:: креатесурфаце**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createsurface) или [**идкомпоситиондевице:: креатевиртуалсурфаце**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createvirtualsurface) .</span><span class="sxs-lookup"><span data-stu-id="59064-165">For more information, see the description of the *alphaMode* parameter of the [**IDCompositionDevice::CreateSurface**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createsurface) or [**IDCompositionDevice::CreateVirtualSurface**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createvirtualsurface) function.</span></span>

## <a name="related-topics"></a><span data-ttu-id="59064-166">См. также</span><span class="sxs-lookup"><span data-stu-id="59064-166">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="59064-167">Основные понятия DirectComposition</span><span class="sxs-lookup"><span data-stu-id="59064-167">DirectComposition Concepts</span></span>](directcomposition-concepts.md)
</dt> </dl>

 

 