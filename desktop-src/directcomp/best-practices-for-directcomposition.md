---
title: Рекомендации по DirectComposition
description: В этом разделе описываются рекомендации по использованию Microsoft DirectComposition.
ms.assetid: D3A1ECD4-9358-44B9-8A84-7D901219D5CD
keywords:
- рекомендации по DirectComposition
- Рекомендуемые методики для DirectComposition
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2f0d19b82b188105c7914e89282c08b12dd4bdc4
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103793573"
---
# <a name="best-practices-for-directcomposition"></a><span data-ttu-id="a7997-105">Рекомендации по DirectComposition</span><span class="sxs-lookup"><span data-stu-id="a7997-105">Best practices for DirectComposition</span></span>

> [!NOTE]
> <span data-ttu-id="a7997-106">Для приложений в Windows 10 рекомендуется использовать интерфейсы API Windows. UI. компоновки вместо DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="a7997-106">For apps on Windows 10, we recommend using Windows.UI.Composition APIs instead of DirectComposition.</span></span> <span data-ttu-id="a7997-107">Дополнительные сведения см. в разделе [модернизировать The классическое приложение с использованием визуального слоя](/windows/uwp/composition/visual-layer-in-desktop-apps).</span><span class="sxs-lookup"><span data-stu-id="a7997-107">For more info, see [Modernize your desktop app using the Visual layer](/windows/uwp/composition/visual-layer-in-desktop-apps).</span></span>

<span data-ttu-id="a7997-108">В этом разделе описываются рекомендации по использованию Microsoft DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="a7997-108">This topic describes best practices for using Microsoft DirectComposition.</span></span>

-   [<span data-ttu-id="a7997-109">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="a7997-109">Best practices</span></span>](#best-practices-for-directcomposition)
-   [<span data-ttu-id="a7997-110">Вопросы безопасности</span><span class="sxs-lookup"><span data-stu-id="a7997-110">Security considerations</span></span>](#security-considerations)
-   [<span data-ttu-id="a7997-111">См. также</span><span class="sxs-lookup"><span data-stu-id="a7997-111">Related topics</span></span>](#related-topics)

## <a name="best-practices"></a><span data-ttu-id="a7997-112">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="a7997-112">Best practices</span></span>

<span data-ttu-id="a7997-113">В следующей таблице представлены рекомендации, Рекомендуемые для работы с визуальными элементами Microsoft DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="a7997-113">The following table presents the practices recommended for working with Microsoft DirectComposition visuals.</span></span>



| <span data-ttu-id="a7997-114">Практика</span><span class="sxs-lookup"><span data-stu-id="a7997-114">Practice</span></span>                                                                                                                                                                                                                                                        | <span data-ttu-id="a7997-115">Описание</span><span class="sxs-lookup"><span data-stu-id="a7997-115">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="a7997-116">После создания устройства DirectComposition вызовите метод [**идкомпоситиондевице:: чеккдевицестате**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-checkdevicestate) в ответ на каждое сообщение [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) , чтобы убедиться, что устройство остается действительным.</span><span class="sxs-lookup"><span data-stu-id="a7997-116">After creating a DirectComposition device, call the [**IDCompositionDevice::CheckDeviceState**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-checkdevicestate) method in response to each [**WM\_PAINT**](/windows/desktop/gdi/wm-paint) message to ensure that the device is still valid.</span></span><br/> | <span data-ttu-id="a7997-117">Если устройство Microsoft DirectX Graphics Framework (DXGI) теряется, устройство DirectComposition, связанное с устройством DXGI, также теряется.</span><span class="sxs-lookup"><span data-stu-id="a7997-117">If the Microsoft DirectX Graphics Infrastructure (DXGI) device is lost, the DirectComposition device associated with the DXGI device is also lost.</span></span> <span data-ttu-id="a7997-118">При обнаружении потерянного устройства DirectComposition отправляет сообщение [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) всем окнам.</span><span class="sxs-lookup"><span data-stu-id="a7997-118">When it detects a lost device, DirectComposition sends the [**WM\_PAINT**](/windows/desktop/gdi/wm-paint) message to all windows.</span></span> <span data-ttu-id="a7997-119">Вызов [**чеккдевицестате**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-checkdevicestate) в ответ на каждое сообщение **WM \_ Paint** позволяет определить, является ли объект устройства DirectComposition допустимым и, если нет, предпринять шаги по восстановлению содержимого.</span><span class="sxs-lookup"><span data-stu-id="a7997-119">Calling [**CheckDeviceState**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-checkdevicestate) in response to each **WM\_PAINT** message lets you determine whether the DirectComposition device object is still valid and, if not, take steps to recover content.</span></span> <br/> <span data-ttu-id="a7997-120">Дополнительные сведения см. в разделе [объект устройства](basic-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="a7997-120">For more information, see [Device object](basic-concepts.md).</span></span><br/> |
| <span data-ttu-id="a7997-121">Создайте только число визуальных элементов, необходимых для композиции или анимации, и уничтожайте визуальные элементы сразу после того, как DirectComposition завершит их использование.</span><span class="sxs-lookup"><span data-stu-id="a7997-121">Create only the number of visuals needed for a composition or animation, and destroy the visuals immediately after DirectComposition finishes using them.</span></span><br/>                                                                                            | <span data-ttu-id="a7997-122">DirectComposition использует графический процессор (GPU), ресурс, который приложение использует совместно с другими приложениями и операционной системой.</span><span class="sxs-lookup"><span data-stu-id="a7997-122">DirectComposition uses the graphics processing unit (GPU), a resource that your application shares with other applications and the operating system.</span></span> <span data-ttu-id="a7997-123">Такой подход гарантирует, что все приложения и операционная система получат достаточно ресурсов GPU.</span><span class="sxs-lookup"><span data-stu-id="a7997-123">This practice ensures that all applications and the operating system receive adequate GPU resources.</span></span><br/> <span data-ttu-id="a7997-124">Дополнительные сведения см. в разделе [визуальные элементы](basic-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="a7997-124">For more information, see [Visuals](basic-concepts.md).</span></span><br/>                                                                                                                                                                                                                                                                     |
| <span data-ttu-id="a7997-125">Не отменяйте отображение визуальных элементов, задав для параметра Opacity значение 0%; Вместо этого следует удалить визуальные элементы из визуального дерева.</span><span class="sxs-lookup"><span data-stu-id="a7997-125">Do not hide visuals by setting opacity to 0%; instead, remove visuals from the visual tree.</span></span><br/>                                                                                                                                                          | <span data-ttu-id="a7997-126">Для установки значения Opacity в 0% требуются дополнительные системные ресурсы, чем их удаление из визуального дерева.</span><span class="sxs-lookup"><span data-stu-id="a7997-126">Setting opacity to 0% requires more system resources than removing them from the visual tree.</span></span><br/> <span data-ttu-id="a7997-127">Дополнительные сведения см. в разделе [прозрачность](effects.md) и [визуальное дерево](basic-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="a7997-127">For more information, see [Opacity](effects.md) and [Visual tree](basic-concepts.md).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                      |
| <span data-ttu-id="a7997-128">Не следует скрывать визуальный элемент, применяя пустой (нулевой размер) прямоугольник клипа к визуальному элементу.</span><span class="sxs-lookup"><span data-stu-id="a7997-128">Do not hide a visual by applying an empty (zero sized) clip rectangle to a visual.</span></span> <span data-ttu-id="a7997-129">Вместо этого удалите визуальный элемент из визуального дерева.</span><span class="sxs-lookup"><span data-stu-id="a7997-129">Instead, remove the visual from the visual tree.</span></span> <br/>                                                                                                                 | <span data-ttu-id="a7997-130">Удаление визуального элемента из визуального дерева приводит к лучшей производительности, чем применение пустого прямоугольника обрезки.</span><span class="sxs-lookup"><span data-stu-id="a7997-130">Removing a visual from the visual tree results in better performance than applying an empty clip rectangle.</span></span><br/> <span data-ttu-id="a7997-131">Дополнительные сведения см. в разделе [Обрезка](clipping.md).</span><span class="sxs-lookup"><span data-stu-id="a7997-131">For more information, see [Clipping](clipping.md).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                |
| <span data-ttu-id="a7997-132">Не применяйте прямоугольник клипа к визуальному элементу, если прямоугольник обрезки не нужен, например, в виде прямоугольника обрезки, включающего все содержимое растрового изображения.</span><span class="sxs-lookup"><span data-stu-id="a7997-132">Do not apply a clip rectangle to a visual if the clip rectangle is not needed, such as a clip rectangle that includes the entire bitmap content of the visual.</span></span><br/>                                                                                       | <span data-ttu-id="a7997-133">Ненужные прямоугольники обрезки негативируют производительность системы.</span><span class="sxs-lookup"><span data-stu-id="a7997-133">Unnecessary clip rectangles harm system performance.</span></span><br/> <span data-ttu-id="a7997-134">Дополнительные сведения см. в разделе [Обрезка](clipping.md).</span><span class="sxs-lookup"><span data-stu-id="a7997-134">For more information, see [Clipping](clipping.md).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="a7997-135">Если требуется большой точечный рисунок с одним цветом, создайте уменьшенную поверхность, а затем примените преобразование масштабирования вместо создания поверхности полного размера.</span><span class="sxs-lookup"><span data-stu-id="a7997-135">If you need a large, single-color bitmap, create a smaller bitmap surface and then apply a scale transform instead of creating a full-sized surface.</span></span> <br/>                                                                                                | <span data-ttu-id="a7997-136">Применение преобразования масштабирования к меньшей поверхности использует меньше системных ресурсов, чем поверхность полного размера.</span><span class="sxs-lookup"><span data-stu-id="a7997-136">Applying a scale transform to a smaller surface is uses fewer system resources than a full-size surface.</span></span><br/> <span data-ttu-id="a7997-137">Дополнительные сведения см. в разделе [растровые объекты](bitmap-surfaces.md) и [преобразования](transforms.md).</span><span class="sxs-lookup"><span data-stu-id="a7997-137">For more information, see [Bitmap objects](bitmap-surfaces.md) and [Transforms](transforms.md).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                     |
| <span data-ttu-id="a7997-138">Избегайте применения трехмерных преобразований к нескольким уровням визуального дерева, например к родительскому элементу и его потомкам.</span><span class="sxs-lookup"><span data-stu-id="a7997-138">Avoid applying 3D transforms to multiple levels of a visual tree, such as to a parent and its descendent(s).</span></span> <br/>                                                                                                                                        | <span data-ttu-id="a7997-139">Применение трехмерных преобразований к нескольким уровням визуального дерева может привести к непредвиденным результатам, так как трехмерные преобразования не умножаются в дереве.</span><span class="sxs-lookup"><span data-stu-id="a7997-139">Applying 3D transforms to multiple levels of a visual tree can produce unintended results because 3D transformations are not multiplied out in the tree.</span></span> <span data-ttu-id="a7997-140">Например, поворот на 90 градусов вокруг оси y в дочернем элементе и поворот на 90 градусов вокруг оси y в родительском элементе приводит к повороту обоих визуальных элементов на Nothing.</span><span class="sxs-lookup"><span data-stu-id="a7997-140">For example, a 90 degree rotation around the y-axis on a child, and a  90 degree rotation around the y-axis on a parent, results in both visuals being rotated away to nothing.</span></span><br/> <span data-ttu-id="a7997-141">Дополнительные сведения см. в статье [Эффекты](effects.md).</span><span class="sxs-lookup"><span data-stu-id="a7997-141">For more information, see [Effects](effects.md).</span></span><br/>                                                                                                                                                                                                     |



 

## <a name="security-considerations"></a><span data-ttu-id="a7997-142">Вопросы безопасности</span><span class="sxs-lookup"><span data-stu-id="a7997-142">Security considerations</span></span>

<span data-ttu-id="a7997-143">В следующих статьях приводятся рекомендации по написанию безопасного кода C++.</span><span class="sxs-lookup"><span data-stu-id="a7997-143">The following articles provide guidance for writing secure C++ code.</span></span>

-   [<span data-ttu-id="a7997-144">Рекомендации по обеспечению безопасности для C++</span><span class="sxs-lookup"><span data-stu-id="a7997-144">Security Best Practices for C++</span></span>](/cpp/security/security-best-practices-for-cpp?view=vs-2019)
-   <span data-ttu-id="a7997-145">[Шаблоны & рекомендации по обеспечению безопасности для приложений](/previous-versions/msp-n-p/ff650760(v=pandp.10))</span><span class="sxs-lookup"><span data-stu-id="a7997-145">[Patterns & Practices Security Guidance for Applications](/previous-versions/msp-n-p/ff650760(v=pandp.10))</span></span>

## <a name="related-topics"></a><span data-ttu-id="a7997-146">См. также</span><span class="sxs-lookup"><span data-stu-id="a7997-146">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a7997-147">Как использовать DirectComposition</span><span class="sxs-lookup"><span data-stu-id="a7997-147">How to Use DirectComposition</span></span>](how-to-use-directcomposition.md)
</dt> </dl>

 

