---
title: Основные понятия (DirectComposition)
description: В этом разделе приводится обзор основных понятий Microsoft DirectComposition.
ms.assetid: F442BDCA-C913-4438-BFFA-D3F28B68EE85
keywords:
- Основные понятия DirectComposition
- Основные понятия DirectComposition
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0550dc12cb0dcc5262701658d8e3883ee1ce8d82
ms.sourcegitcommit: 73417d55867c804274a55abe5ca71bcba7006119
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/20/2020
ms.locfileid: "104551682"
---
# <a name="basic-concepts"></a><span data-ttu-id="f3090-105">Основные понятия</span><span class="sxs-lookup"><span data-stu-id="f3090-105">Basic concepts</span></span>

> [!NOTE]
> <span data-ttu-id="f3090-106">Для приложений в Windows 10 рекомендуется использовать интерфейсы API Windows. UI. компоновки вместо DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="f3090-106">For apps on Windows 10, we recommend using Windows.UI.Composition APIs instead of DirectComposition.</span></span> <span data-ttu-id="f3090-107">Дополнительные сведения см. в разделе [модернизировать The классическое приложение с использованием визуального слоя](/windows/uwp/composition/visual-layer-in-desktop-apps).</span><span class="sxs-lookup"><span data-stu-id="f3090-107">For more info, see [Modernize your desktop app using the Visual layer](/windows/uwp/composition/visual-layer-in-desktop-apps).</span></span>

<span data-ttu-id="f3090-108">В этом разделе приводится обзор основных понятий Microsoft DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="f3090-108">This topic provides an overview of the basic concepts of Microsoft DirectComposition.</span></span> <span data-ttu-id="f3090-109">Он содержит следующие подразделы:</span><span class="sxs-lookup"><span data-stu-id="f3090-109">It contains the following sections:</span></span>

-   [<span data-ttu-id="f3090-110">Композиция</span><span class="sxs-lookup"><span data-stu-id="f3090-110">Composition</span></span>](#composition-target-window)
-   [<span data-ttu-id="f3090-111">Визуальные элементы</span><span class="sxs-lookup"><span data-stu-id="f3090-111">Visuals</span></span>](#visuals)
    -   [<span data-ttu-id="f3090-112">Визуальное дерево</span><span class="sxs-lookup"><span data-stu-id="f3090-112">Visual tree</span></span>](#visual-tree)
    -   [<span data-ttu-id="f3090-113">Свойства визуального объекта</span><span class="sxs-lookup"><span data-stu-id="f3090-113">Properties of a visual object</span></span>](#properties-of-a-visual-object)
-   [<span data-ttu-id="f3090-114">Объект устройства</span><span class="sxs-lookup"><span data-stu-id="f3090-114">Device object</span></span>](#device-object)
-   [<span data-ttu-id="f3090-115">Окно цели композиции</span><span class="sxs-lookup"><span data-stu-id="f3090-115">Composition target window</span></span>](#composition-target-window)
-   [<span data-ttu-id="f3090-116">Транзакционная композиция</span><span class="sxs-lookup"><span data-stu-id="f3090-116">Transactional composition</span></span>](#transactional-composition)
    -   [<span data-ttu-id="f3090-117">Пакетная обработка в MSBuild</span><span class="sxs-lookup"><span data-stu-id="f3090-117">Batching</span></span>](#batching)
    -   [<span data-ttu-id="f3090-118">Синхронизация</span><span class="sxs-lookup"><span data-stu-id="f3090-118">Synchronization</span></span>](#synchronization)
    -   [<span data-ttu-id="f3090-119">Визуальные деревья для разных устройств</span><span class="sxs-lookup"><span data-stu-id="f3090-119">Cross-device visual trees</span></span>](#cross-device-visual-trees)
-   [<span data-ttu-id="f3090-120">См. также</span><span class="sxs-lookup"><span data-stu-id="f3090-120">Related topics</span></span>](#related-topics)

## <a name="composition"></a><span data-ttu-id="f3090-121">Композиция</span><span class="sxs-lookup"><span data-stu-id="f3090-121">Composition</span></span>

<span data-ttu-id="f3090-122">DirectComposition определяет *композицию* в виде коллекции точечных рисунков, которые комбинируются и обрабатываются путем применения различных преобразований, эффектов и анимации для создания визуального результата в пользовательском интерфейсе приложения.</span><span class="sxs-lookup"><span data-stu-id="f3090-122">DirectComposition defines a *composition* as a collection of bitmaps that are combined and manipulated by applying various transforms, effects, and animations to produce a visual result in an application UI.</span></span> <span data-ttu-id="f3090-123">DirectComposition работает только с растровым содержимым; Он не поддерживает векторы или текст.</span><span class="sxs-lookup"><span data-stu-id="f3090-123">DirectComposition works with bitmap content only; it does not support vectors or text.</span></span> <span data-ttu-id="f3090-124">DirectComposition не предоставляет содержимое точечного рисунка.</span><span class="sxs-lookup"><span data-stu-id="f3090-124">DirectComposition does not provide bitmap content.</span></span> <span data-ttu-id="f3090-125">Вместо этого он предоставляет интерфейсы, в которых пользователи могут рисовать с помощью D2D, DXGI или передать собственное содержимое текстуры.</span><span class="sxs-lookup"><span data-stu-id="f3090-125">Instead it provides interfaces in which users can draw with D2D, DXGI, or upload their own texture content.</span></span>

<span data-ttu-id="f3090-126">Приложение DirectComposition создает два набора объектов для создания сцены: точечные рисунки, состоящие вместе, и визуальные элементы, определяющие пространственные связи между точечными рисунками.</span><span class="sxs-lookup"><span data-stu-id="f3090-126">A DirectComposition application creates two sets of objects to compose a scene: bitmaps that are composed together, and visuals that define the spatial relationships among the bitmaps.</span></span> <span data-ttu-id="f3090-127">Дополнительные сведения об объектах Bitmap, поддерживаемых DirectComposition, см. в разделе [растровые объекты](bitmap-surfaces.md).</span><span class="sxs-lookup"><span data-stu-id="f3090-127">For more information about the bitmap objects supported by DirectComposition, see [Bitmap objects](bitmap-surfaces.md).</span></span>

## <a name="visuals"></a><span data-ttu-id="f3090-128">Визуальные элементы</span><span class="sxs-lookup"><span data-stu-id="f3090-128">Visuals</span></span>

<span data-ttu-id="f3090-129">*Визуальные* элементы (или *визуальные объекты*) являются фундаментальными элементами DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="f3090-129">*Visuals* (or *visual objects*) are the fundamental elements of DirectComposition.</span></span> <span data-ttu-id="f3090-130">Они являются основными стандартными блоками, которые используются для создания композиций и анимации в пользовательском интерфейсе приложения.</span><span class="sxs-lookup"><span data-stu-id="f3090-130">They are the basic building blocks that you use to create compositions and animations in your application UI.</span></span>

<span data-ttu-id="f3090-131">В терминах программирования визуальный элемент представляет собой объект с набором свойств и предоставляет интерфейс, который используется для задания значений свойств.</span><span class="sxs-lookup"><span data-stu-id="f3090-131">In programming terms, a visual is an object that has a set of properties, and exposes an interface that you use to set the value of the properties.</span></span> <span data-ttu-id="f3090-132">Свойство содержимого визуального элемента связывает определенное растровое изображение с визуальным элементом, в то время как другие свойства управляют положением DirectComposition и обрабатывают визуальный элемент по мере его отрисовки на экране.</span><span class="sxs-lookup"><span data-stu-id="f3090-132">A visual's Content property associates a particular bitmap with the visual, while other properties control how DirectComposition positions and manipulates the visual as it is rendered to the screen.</span></span>

<span data-ttu-id="f3090-133">Дополнительные сведения см. в разделе [Свойства визуального элемента](#properties-of-a-visual-object).</span><span class="sxs-lookup"><span data-stu-id="f3090-133">For more information, see [Properties of a Visual](#properties-of-a-visual-object).</span></span>

### <a name="visual-tree"></a><span data-ttu-id="f3090-134">Визуальное дерево</span><span class="sxs-lookup"><span data-stu-id="f3090-134">Visual tree</span></span>

<span data-ttu-id="f3090-135">DirectComposition создает композицию из иерархической коллекции визуальных объектов, называемых *визуальным деревом*.</span><span class="sxs-lookup"><span data-stu-id="f3090-135">DirectComposition creates a composition from a hierarchical collection of visual objects called a *visual tree*.</span></span> <span data-ttu-id="f3090-136">Визуальный элемент в корне дерева называется *корневым визуальным* элементом и может иметь один или несколько *дочерних визуальных элементов* , связанных с ним.</span><span class="sxs-lookup"><span data-stu-id="f3090-136">The visual at the root of a tree is called the *root visual* and it can have one or more *child visuals* associated with it.</span></span> <span data-ttu-id="f3090-137">Дочерний визуальный элемент может иметь один или несколько дочерних визуальных элементов.</span><span class="sxs-lookup"><span data-stu-id="f3090-137">A child visual can have one or more child visuals of its own.</span></span> <span data-ttu-id="f3090-138">Любой визуальный элемент, имеющий связанные дочерние визуальные элементы, называется *родительским визуальным* элементом, а все дочерние визуальные элементы с одним и тем же родителем называются *визуальными элементами*.</span><span class="sxs-lookup"><span data-stu-id="f3090-138">Any visual that has associated child visuals is called a *parent visual*, and all child visuals that share the same parent are called *sibling visuals*.</span></span> <span data-ttu-id="f3090-139">Конкретный визуальный элемент вместе со всеми его дочерними и вложенными визуальными элементами называется *визуальным поддеревом*.</span><span class="sxs-lookup"><span data-stu-id="f3090-139">A particular visual along with all its child and descendent visuals is called a *visual subtree*.</span></span>

<span data-ttu-id="f3090-140">Расположение визуального элемента в дереве помогает определить положение экрана и z-порядок относительно других визуальных элементов в композиции.</span><span class="sxs-lookup"><span data-stu-id="f3090-140">A visual's location in the tree helps determine its screen position and z-order relative to the other visuals in the composition.</span></span> <span data-ttu-id="f3090-141">Корневой визуальный элемент располагается относительно левого верхнего угла клиентской области целевого окна, в котором отображается композиция.</span><span class="sxs-lookup"><span data-stu-id="f3090-141">The root visual is positioned relative to the upper-left corner of the client area of the target window where the composition is rendered.</span></span> <span data-ttu-id="f3090-142">Все дочерние визуальные элементы располагаются относительно левого верхнего угла родительского визуального элемента (или визуального элемента, заданного свойством Трансформпарент) и всегда отображаются перед родительским элементом в z-порядке.</span><span class="sxs-lookup"><span data-stu-id="f3090-142">All child visuals are positioned relative to the upper-left corner of their parent visual (or the visual specified by the TransformParent property), and always appear in front of their parent in the z-order.</span></span>

<span data-ttu-id="f3090-143">На следующем рисунке показана композиция визуальных элементов и структура визуального дерева, используемая для создания композиции.</span><span class="sxs-lookup"><span data-stu-id="f3090-143">The following illustration shows a composition of visuals and the structure of the visual tree used to produce the composition.</span></span> <span data-ttu-id="f3090-144">Visual 1 — это корневой визуальный элемент, который также является родительским для дочерних визуальных элементов 2 и 3, представляющих собой одноуровневые визуальные элементы.</span><span class="sxs-lookup"><span data-stu-id="f3090-144">Visual 1 is the root visual and is also the parent of child Visuals 2 and 3, which are sibling visuals.</span></span> <span data-ttu-id="f3090-145">Visual 3 имеет два дочерних визуальных элемента, визуальные элементы 4 и 5.</span><span class="sxs-lookup"><span data-stu-id="f3090-145">Visual 3 has two child visuals of its own, Visuals 4 and 5.</span></span> <span data-ttu-id="f3090-146">Все визуальные элементы с 3 по 5 составляют визуальное поддерево.</span><span class="sxs-lookup"><span data-stu-id="f3090-146">Together, Visuals 3 through 5 make up a visual subtree.</span></span>

![Композиция визуальных элементов и соответствующее визуальное дерево](images/visuals-and-corresponding-tree.png)

<span data-ttu-id="f3090-148">Родительский визуальный элемент поддерживает упорядоченный список своих дочерних визуальных элементов.</span><span class="sxs-lookup"><span data-stu-id="f3090-148">A parent visual maintains an ordered list of its child visuals.</span></span> <span data-ttu-id="f3090-149">Когда визуальные элементы одного уровня расположены друг за другом, DirectComposition задает z-порядок одноуровневых элементов на основе порядка их появления в списке дочерних элементов родительского визуального элемента.</span><span class="sxs-lookup"><span data-stu-id="f3090-149">When sibling visuals are positioned such that they overlap one another, DirectComposition sets the z-order of the siblings based on the order in which they appear in the parent visual's children list.</span></span> <span data-ttu-id="f3090-150">Одноуровневый элемент, появляющийся позже в списке, помещается перед всеми одноуровневыми элементами, которые появляются ранее в списке.</span><span class="sxs-lookup"><span data-stu-id="f3090-150">A sibling that appears later in the list is placed in front of all siblings that appear earlier in the list.</span></span> <span data-ttu-id="f3090-151">На следующем рисунке показан z-порядок перекрывающихся дочерних визуальных элементов.</span><span class="sxs-lookup"><span data-stu-id="f3090-151">The following illustration shows the z-order of overlapping child visuals.</span></span>

![z-порядок пересекающихся дочерних визуальных элементов](images/overlapping-child-visuals.png)

### <a name="properties-of-a-visual-object"></a><span data-ttu-id="f3090-153">Свойства визуального объекта</span><span class="sxs-lookup"><span data-stu-id="f3090-153">Properties of a visual object</span></span>

<span data-ttu-id="f3090-154">Визуальный объект предоставляет набор свойств, позволяющих задать содержимое растрового изображения для визуального элемента и управлять тем, как DirectComposition позиции и манипулирует визуальным содержимым.</span><span class="sxs-lookup"><span data-stu-id="f3090-154">A visual object exposes a set of properties that enable you to set the bitmap content for the visual, and to control how DirectComposition positions and manipulates the visual content.</span></span> <span data-ttu-id="f3090-155">В следующих разделах подробно описывается каждое свойство.</span><span class="sxs-lookup"><span data-stu-id="f3090-155">The following sections describe each property in detail.</span></span>

-   [<span data-ttu-id="f3090-156">Свойство содержимого</span><span class="sxs-lookup"><span data-stu-id="f3090-156">Content property</span></span>](#content-property)
-   [<span data-ttu-id="f3090-157">Свойство Clip</span><span class="sxs-lookup"><span data-stu-id="f3090-157">Clip property</span></span>](#clip-property)
-   [<span data-ttu-id="f3090-158">Бордермоде, свойство</span><span class="sxs-lookup"><span data-stu-id="f3090-158">BorderMode property</span></span>](#bordermode-property)
-   [<span data-ttu-id="f3090-159">Битмапинтерполатионмоде, свойство</span><span class="sxs-lookup"><span data-stu-id="f3090-159">BitmapInterpolationMode property</span></span>](#bitmapinterpolationmode-property)
-   [<span data-ttu-id="f3090-160">Компоситемоде, свойство</span><span class="sxs-lookup"><span data-stu-id="f3090-160">CompositeMode property</span></span>](#compositemode-property)
-   [<span data-ttu-id="f3090-161">Свойства Оффсеткс и offset</span><span class="sxs-lookup"><span data-stu-id="f3090-161">OffsetX and OffsetY properties</span></span>](#offsetx-and-offsety-properties)
-   [<span data-ttu-id="f3090-162">Свойство Effect</span><span class="sxs-lookup"><span data-stu-id="f3090-162">Effect property</span></span>](#effect-property)
-   [<span data-ttu-id="f3090-163">Transform - свойство</span><span class="sxs-lookup"><span data-stu-id="f3090-163">Transform property</span></span>](#transform-property)
-   [<span data-ttu-id="f3090-164">Трансформпарент, свойство</span><span class="sxs-lookup"><span data-stu-id="f3090-164">TransformParent property</span></span>](#transformparent-property)

### <a name="content-property"></a><span data-ttu-id="f3090-165">Свойство содержимого</span><span class="sxs-lookup"><span data-stu-id="f3090-165">Content property</span></span>

<span data-ttu-id="f3090-166">Свойство содержимого визуального элемента определяет содержимое растрового изображения, связанное с визуальным элементом.</span><span class="sxs-lookup"><span data-stu-id="f3090-166">A visual's Content property specifies the bitmap content that is associated with the visual.</span></span> <span data-ttu-id="f3090-167">Это битовая карта, которую DirectComposition использует при включении визуального элемента в композицию.</span><span class="sxs-lookup"><span data-stu-id="f3090-167">This is the bitmap that DirectComposition uses when you include the visual in a composition.</span></span>

<span data-ttu-id="f3090-168">Свойство содержимого визуального элемента задается путем вызова метода [**идкомпоситионвисуал:: сетконтент**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setcontent) .</span><span class="sxs-lookup"><span data-stu-id="f3090-168">You set the Content property of a visual by calling the [**IDCompositionVisual::SetContent**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setcontent) method.</span></span>

<span data-ttu-id="f3090-169">Дополнительные сведения о типах растрового содержимого, поддерживаемых DirectComposition, см. в разделе [растровые объекты](bitmap-surfaces.md).</span><span class="sxs-lookup"><span data-stu-id="f3090-169">For more information about the types of bitmap content supported by DirectComposition, see [Bitmap objects](bitmap-surfaces.md).</span></span>

### <a name="clip-property"></a><span data-ttu-id="f3090-170">Свойство Clip</span><span class="sxs-lookup"><span data-stu-id="f3090-170">Clip property</span></span>

<span data-ttu-id="f3090-171">Свойство Clip визуального элемента определяет прямоугольную область, называемую вырезанной областью (или *прямоугольником* *обрезки* ).</span><span class="sxs-lookup"><span data-stu-id="f3090-171">The Clip property of a visual specifies a rectangular area called the *clipping region* (or *clip rectangle*).</span></span> <span data-ttu-id="f3090-172">При отрисовке визуального элемента отображается только часть визуального элемента, находящаяся внутри вырезанной области, а любое содержимое, разпадающее за пределы области обрезки, обрезается (то есть не отображается).</span><span class="sxs-lookup"><span data-stu-id="f3090-172">When a visual is rendered, only the portion of the visual that falls inside the clipping region is displayed, while any content that extends outside the clipping region is clipped (that is, not displayed).</span></span> <span data-ttu-id="f3090-173">DirectComposition поддерживает отрезкие области, имеющие скругленные или квадратные углы.</span><span class="sxs-lookup"><span data-stu-id="f3090-173">DirectComposition supports clipping regions that have rounded or squared corners.</span></span>

<span data-ttu-id="f3090-174">Свойство Clip визуального элемента задается путем вызова метода [**идкомпоситионвисуал:: сетклип**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setclip(constd2d_rect_f_)) .</span><span class="sxs-lookup"><span data-stu-id="f3090-174">You set the Clip property of a visual by calling the [**IDCompositionVisual::SetClip**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setclip(constd2d_rect_f_)) method.</span></span>

<span data-ttu-id="f3090-175">Дополнительные сведения см. в разделе [Обрезка](clipping.md).</span><span class="sxs-lookup"><span data-stu-id="f3090-175">For more information, see [Clipping](clipping.md).</span></span>

### <a name="bordermode-property"></a><span data-ttu-id="f3090-176">Бордермоде, свойство</span><span class="sxs-lookup"><span data-stu-id="f3090-176">BorderMode property</span></span>

<span data-ttu-id="f3090-177">Свойство Бордермоде указывает, как составлять границы точечных рисунков и клипов, связанных с этим визуальным элементом, или с визуальными элементами в поддереве, корнем которого является этот визуальный элемент.</span><span class="sxs-lookup"><span data-stu-id="f3090-177">The BorderMode property specifies how to compose the edges of bitmaps and clips associated with this visual, or with visuals in the subtree rooted at this visual.</span></span>

<span data-ttu-id="f3090-178">Режим границы влияет на то, как края растрового изображения формируются при преобразовании растрового изображения таким способом, чтобы границы не совпадали с целыми координатами.</span><span class="sxs-lookup"><span data-stu-id="f3090-178">The border mode affects how the edges of a bitmap are composed when the bitmap is transformed such that the edges are not axis-aligned with integer coordinates.</span></span> <span data-ttu-id="f3090-179">Он также влияет на то, как содержимое обрезается по углам клипа, имеющего скругленные углы, и на границе зажима, преобразованной таким способом, что границы не вычисляются с помощью целых координат.</span><span class="sxs-lookup"><span data-stu-id="f3090-179">It also affects how content is clipped at the corners of a clip that has rounded corners, and at the edge of a clip that is transformed such that the edges are not axis-aligned with integer coordinates.</span></span>

<span data-ttu-id="f3090-180">Дополнительные сведения см. в разделе [**идкомпоситионвисуал:: сетбордермоде**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setbordermode).</span><span class="sxs-lookup"><span data-stu-id="f3090-180">For more information, see [**IDCompositionVisual::SetBorderMode**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setbordermode).</span></span>

### <a name="bitmapinterpolationmode-property"></a><span data-ttu-id="f3090-181">Битмапинтерполатионмоде, свойство</span><span class="sxs-lookup"><span data-stu-id="f3090-181">BitmapInterpolationMode property</span></span>

<span data-ttu-id="f3090-182">Свойство Битмапинтерполатионмоде указывает DirectComposition, как создать точечный рисунок, когда он преобразуется таким образом, что между пикселями в точечном рисунке и пикселями экрана нет соответствия «один к одному».</span><span class="sxs-lookup"><span data-stu-id="f3090-182">The BitmapInterpolationMode property tells DirectComposition how to compose a bitmap when it is transformed such that there is no one-to-one correspondence between pixels in the bitmap and pixels on the screen.</span></span>

<span data-ttu-id="f3090-183">Чтобы задать свойство Битмапинтерполатионмоде визуального элемента, вызовите метод [**идкомпоситионвисуал:: сетбитмапинтерполатионмоде**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setbitmapinterpolationmode) .</span><span class="sxs-lookup"><span data-stu-id="f3090-183">You set the BitmapInterpolationMode property of a visual by calling the [**IDCompositionVisual::SetBitmapInterpolationMode**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setbitmapinterpolationmode) method.</span></span>

### <a name="compositemode-property"></a><span data-ttu-id="f3090-184">Компоситемоде, свойство</span><span class="sxs-lookup"><span data-stu-id="f3090-184">CompositeMode property</span></span>

<span data-ttu-id="f3090-185">Свойство Компоситемоде указывает DirectComposition, как смешивать растровое содержимое визуального элемента с помощью целевого объекта рендеринга.</span><span class="sxs-lookup"><span data-stu-id="f3090-185">The CompositeMode property tells DirectComposition how to blend the bitmap content of a visual with the render target.</span></span> <span data-ttu-id="f3090-186">Описание поддерживаемых составных режимов см. в разделе [**дкомпоситион \_ составной \_ режим**](/windows/desktop/api/DcompTypes/ne-dcomptypes-dcomposition_composite_mode).</span><span class="sxs-lookup"><span data-stu-id="f3090-186">For a description of the supported composite modes, see [**DCOMPOSITION\_COMPOSITE\_MODE**](/windows/desktop/api/DcompTypes/ne-dcomptypes-dcomposition_composite_mode).</span></span>

<span data-ttu-id="f3090-187">Чтобы задать свойство Компоситемоде визуального элемента, вызовите метод [**идкомпоситионвисуал:: сеткомпоситемоде**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setcompositemode) .</span><span class="sxs-lookup"><span data-stu-id="f3090-187">You set the CompositeMode property of a visual by calling the [**IDCompositionVisual::SetCompositeMode**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setcompositemode) method.</span></span>

### <a name="offsetx-and-offsety-properties"></a><span data-ttu-id="f3090-188">Свойства Оффсеткс и offset</span><span class="sxs-lookup"><span data-stu-id="f3090-188">OffsetX and OffsetY properties</span></span>

<span data-ttu-id="f3090-189">Свойства Оффсеткс и offset указывают DirectComposition, где должен размещаться визуальный элемент по горизонтали и вертикали.</span><span class="sxs-lookup"><span data-stu-id="f3090-189">The OffsetX and OffsetY properties tell DirectComposition where to position a visual horizontally and vertically.</span></span> <span data-ttu-id="f3090-190">Они определяют двухмерную фиксированную позицией, из которой рассчитываются все преобразования и эффекты для визуального элемента.</span><span class="sxs-lookup"><span data-stu-id="f3090-190">They define the two-dimensional fixed position from which all transforms and effects for the visual are calculated.</span></span>

<span data-ttu-id="f3090-191">Для корневого визуального элемента свойства Оффсеткс и Offset определяют координату x и координату y точки относительно верхнего левого угла окна, в котором размещается визуальный элемент.</span><span class="sxs-lookup"><span data-stu-id="f3090-191">For a root visual, the OffsetX and OffsetY properties define the x-coordinate and y-coordinate of a point relative to the upper-left corner of the window that hosts the visual.</span></span> <span data-ttu-id="f3090-192">Для дочернего визуального элемента координаты задаются относительно левого верхнего угла родителя или, если [свойство трансформпарент](#transformparent-property) задано, верхний левый угол указанного визуального элемента.</span><span class="sxs-lookup"><span data-stu-id="f3090-192">For a child visual, the coordinates are relative to the upper-left corner of the parent or, if the [TransformParent property](#transformparent-property) is specified, the upper-left corner of the specified visual.</span></span> <span data-ttu-id="f3090-193">При отрисовке визуального элемента он позиционируется таким, что верхний левый угол отображается в соответствии с заданными координатами.</span><span class="sxs-lookup"><span data-stu-id="f3090-193">When a visual is rendered, it is positioned such that the visual's upper-left corner coincides with the specified coordinates.</span></span>

<span data-ttu-id="f3090-194">Чтобы задать свойства Оффсеткс и offset визуального элемента, вызовите методы [**идкомпоситионвисуал:: сетоффсеткс**](/previous-versions/windows/desktop/legacy/hh449126(v=vs.85)) и [**сетоффсети**](/previous-versions/windows/desktop/legacy/hh449131(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="f3090-194">You set the OffsetX and OffsetY properties of a visual by calling the [**IDCompositionVisual::SetOffsetX**](/previous-versions/windows/desktop/legacy/hh449126(v=vs.85)) and [**SetOffsetY**](/previous-versions/windows/desktop/legacy/hh449131(v=vs.85)) methods.</span></span>

### <a name="effect-property"></a><span data-ttu-id="f3090-195">Свойство Effect</span><span class="sxs-lookup"><span data-stu-id="f3090-195">Effect property</span></span>

<span data-ttu-id="f3090-196">Свойство Effect позволяет указать эффект или группу эффектов, которые изменяют, как будет состоять визуальный элемент и его поддерево.</span><span class="sxs-lookup"><span data-stu-id="f3090-196">The Effect property lets you specify an effect, or group of effects, that will modify how a visual and its subtree is composed.</span></span> <span data-ttu-id="f3090-197">Например, можно указать эффекты, управляющие прозрачностью визуального элемента, смешать визуальный элемент с другим точечным рисунком различными способами, а также применить преобразования перспективы к визуализации.</span><span class="sxs-lookup"><span data-stu-id="f3090-197">For example, you can specify effects that control the opacity of a visual, blend the visual with another bitmap in various ways, and apply perspective transforms to the visual.</span></span>

<span data-ttu-id="f3090-198">Чтобы задать свойство Effect визуального элемента, вызовите метод [**идкомпоситионвисуал:: сетеффект**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-seteffect) .</span><span class="sxs-lookup"><span data-stu-id="f3090-198">You set the Effect property of a visual by calling the [**IDCompositionVisual::SetEffect**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-seteffect) method.</span></span>

<span data-ttu-id="f3090-199">Дополнительные сведения см. в статье [Эффекты](effects.md).</span><span class="sxs-lookup"><span data-stu-id="f3090-199">For more information, see [Effects](effects.md).</span></span>

### <a name="transform-property"></a><span data-ttu-id="f3090-200">Transform - свойство</span><span class="sxs-lookup"><span data-stu-id="f3090-200">Transform property</span></span>

<span data-ttu-id="f3090-201">Свойство Transform задает двухмерный (2D) преобразование или группу двумерных преобразований для DirectComposition, выполняемых в визуальном элементе.</span><span class="sxs-lookup"><span data-stu-id="f3090-201">The Transform property specifies a two-dimensional (2D) transformation, or group of 2D transformations, for DirectComposition to perform on the visual.</span></span> <span data-ttu-id="f3090-202">Преобразование (или преобразование) — это операция, которая изменяет систему координат визуального элемента относительно ее родителя или относительно визуального элемента, заданного [свойством трансформпарент](#transformparent-property).</span><span class="sxs-lookup"><span data-stu-id="f3090-202">A transformation (or transform) is an operation that modifies the coordinate system of a visual relative to its parent, or relative to the visual specified by the [TransformParent property](#transformparent-property).</span></span> <span data-ttu-id="f3090-203">С помощью преобразований можно изменить положение, размер или природу визуального элемента, переместив его в другое место (перевод), сделав его больше или меньше (масштабирование), отключив его (вращение), искажение фигуры (наклон) и т. д.</span><span class="sxs-lookup"><span data-stu-id="f3090-203">You can use transforms to alter the position, size, or nature of a visual by moving it to another location (translation), making it larger or smaller (scaling), turning it (rotation), distorting its shape (skewing), and so on.</span></span>

<span data-ttu-id="f3090-204">Свойство Transform визуального элемента задается путем вызова метода [**идкомпоситионвисуал:: сеттрансформ**](/previous-versions/windows/desktop/legacy/hh449178(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="f3090-204">You set the Transform property of a visual by calling the [**IDCompositionVisual::SetTransform**](/previous-versions/windows/desktop/legacy/hh449178(v=vs.85)) method.</span></span>

<span data-ttu-id="f3090-205">Дополнительные сведения см. в статье [Преобразования](transforms.md).</span><span class="sxs-lookup"><span data-stu-id="f3090-205">For more information, see [Transforms](transforms.md).</span></span>

### <a name="transformparent-property"></a><span data-ttu-id="f3090-206">Трансформпарент, свойство</span><span class="sxs-lookup"><span data-stu-id="f3090-206">TransformParent property</span></span>

<span data-ttu-id="f3090-207">Система координат визуального элемента изменяется свойствами Оффсеткс, offset и Transform.</span><span class="sxs-lookup"><span data-stu-id="f3090-207">The coordinate system of a visual is modified by the OffsetX, OffsetY, and Transform properties.</span></span> <span data-ttu-id="f3090-208">Как правило, эти свойства определяют систему координат визуального элемента относительно непосредственного родителя.</span><span class="sxs-lookup"><span data-stu-id="f3090-208">Normally, these properties define the coordinate system of a visual relative to its immediate parent.</span></span> <span data-ttu-id="f3090-209">Чтобы использовать какой-либо визуальный элемент, отличный от родительского, в качестве основания для системы координат дочернего визуального элемента, используйте свойство Трансформпарент, чтобы указать другой визуальный элемент в качестве родительского для преобразования.</span><span class="sxs-lookup"><span data-stu-id="f3090-209">To use some visual other than the parent as the basis for the coordinate system of a child visual, use the TransformParent property to specify a different visual as the "parent" for transform purposes.</span></span>

<span data-ttu-id="f3090-210">Чтобы задать свойство Трансформпарент визуального элемента, вызовите метод [**идкомпоситионвисуал:: сеттрансформпарент**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-settransformparent) .</span><span class="sxs-lookup"><span data-stu-id="f3090-210">You set the TransformParent property of a visual by calling the [**IDCompositionVisual::SetTransformParent**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-settransformparent) method.</span></span>

## <a name="device-object"></a><span data-ttu-id="f3090-211">Объект устройства</span><span class="sxs-lookup"><span data-stu-id="f3090-211">Device object</span></span>

<span data-ttu-id="f3090-212">Чтобы использовать DirectComposition, необходимо создать различные объекты модели COM и управлять ими.</span><span class="sxs-lookup"><span data-stu-id="f3090-212">To use DirectComposition, you must create and manipulate a variety of Component Object Model (COM) objects.</span></span> <span data-ttu-id="f3090-213">Первым объектом, который необходимо создать, является *объект устройства* DirectComposition, так как он служит фабрикой для создания всех других объектов, используемых в составе.</span><span class="sxs-lookup"><span data-stu-id="f3090-213">The first object that you need to create is the DirectComposition *device object* because it serves as the factory for creating all other objects used in a composition.</span></span>

<span data-ttu-id="f3090-214">Объект устройства создается путем вызова функции [**дкомпоситионкреатедевице**](/windows/desktop/api/Dcomp/nf-dcomp-dcompositioncreatedevice) , которая возвращает указатель на интерфейс [**идкомпоситиондевице**](/windows/win32/api/dcomp/nn-dcomp-idcompositiondevice) .</span><span class="sxs-lookup"><span data-stu-id="f3090-214">You create a device object by calling the [**DCompositionCreateDevice**](/windows/desktop/api/Dcomp/nf-dcomp-dcompositioncreatedevice) function, which returns an [**IDCompositionDevice**](/windows/win32/api/dcomp/nn-dcomp-idcompositiondevice) interface pointer.</span></span> <span data-ttu-id="f3090-215">Этот интерфейс предоставляет набор методов, используемых для создания визуальных объектов, объектов Clip, объектов анимации, объектов Transform, объектов эффектов и т. д.</span><span class="sxs-lookup"><span data-stu-id="f3090-215">This interface exposes a set of methods that you use to create visual objects, clip objects, animation objects, transform objects, effect objects, and so on.</span></span>

<span data-ttu-id="f3090-216">Объект устройства служит еще одной целью, помимо фабрики для создания других объектов.</span><span class="sxs-lookup"><span data-stu-id="f3090-216">The device object serves one other purpose besides being a factory for creating other objects.</span></span> <span data-ttu-id="f3090-217">Он предоставляет метод, именуемый [**commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) , который передает визуальное дерево в DirectComposition для обработки.</span><span class="sxs-lookup"><span data-stu-id="f3090-217">It exposes a method called [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) that passes a visual tree to DirectComposition for processing.</span></span> <span data-ttu-id="f3090-218">Дополнительные сведения см. в разделе [транзакционная композиция](#transactional-composition).</span><span class="sxs-lookup"><span data-stu-id="f3090-218">For more information, see [Transactional Composition](#transactional-composition).</span></span>

<span data-ttu-id="f3090-219">Помните, что, несмотря на то, что в приложении можно создать несколько экземпляров объекта устройства, все объекты, используемые в определенной композиции, должны создаваться одним и тем же объектом устройства — за одним исключением можно объединять визуальные объекты из различных объектов устройств в одном визуальном дереве.</span><span class="sxs-lookup"><span data-stu-id="f3090-219">Remember that, while you can create multiple instances of the device object in your application, all of the objects that you use in a particular composition must be created by the same device object—with one exception: You can combine visual objects from different device objects in the same visual tree.</span></span> <span data-ttu-id="f3090-220">После этого DirectComposition считает визуальное дерево обычным, за исключением того, что изменения в конкретном визуальном объекте в дереве вступают в силу только при вызове метода [**commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) для объекта устройства, создавшего визуальный объект.</span><span class="sxs-lookup"><span data-stu-id="f3090-220">When you do so, DirectComposition treats the visual tree as it normally would, except that changes to a particular visual object in the tree take effect only when the [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) method is called on the device object that created the visual object.</span></span>

<span data-ttu-id="f3090-221">Возможность использования визуальных элементов из различных устройств в одном визуальном дереве позволяет нескольким потокам создавать и манипулировать одним визуальным деревом, одновременно сохраняя два независимых устройства, которые можно использовать для асинхронной фиксации изменений.</span><span class="sxs-lookup"><span data-stu-id="f3090-221">The ability to use visuals from different devices in the same visual tree enables multiple threads to create and manipulate a single visual tree while maintaining two independent devices that can be used to commit changes asynchronously.</span></span> <span data-ttu-id="f3090-222">Дополнительные сведения см. в разделе [визуальные деревья для разных устройств](#cross-device-visual-trees).</span><span class="sxs-lookup"><span data-stu-id="f3090-222">For more information, see [Cross-Device Visual Trees](#cross-device-visual-trees).</span></span>

## <a name="composition-target-window"></a><span data-ttu-id="f3090-223">Окно цели композиции</span><span class="sxs-lookup"><span data-stu-id="f3090-223">Composition target window</span></span>

<span data-ttu-id="f3090-224">Визуальное дерево должно быть привязано к окну, прежде чем можно будет отобразить на экране все визуальные элементы дерева.</span><span class="sxs-lookup"><span data-stu-id="f3090-224">A visual tree must be bound to a window before any of the tree's visuals can be displayed on the screen.</span></span> <span data-ttu-id="f3090-225">Окно, называемое *окном цели композиции*, может быть окном верхнего уровня или дочерним окном.</span><span class="sxs-lookup"><span data-stu-id="f3090-225">The window, called the *composition target window*, can be a top-level window or a child window.</span></span> <span data-ttu-id="f3090-226">Кроме того, окно цели композиции может быть слоеным окном. то есть, он может иметь стиль окна с [**\_ \_ слоем WS ex**](/windows/desktop/winmsg/extended-window-styles) .</span><span class="sxs-lookup"><span data-stu-id="f3090-226">Also, the composition target window can be a layered window; that is, it can have the [**WS\_EX\_LAYERED**](/windows/desktop/winmsg/extended-window-styles) window style.</span></span>

<span data-ttu-id="f3090-227">DirectComposition позволяет приложению привязать к каждому окну не более двух визуальных деревьев.</span><span class="sxs-lookup"><span data-stu-id="f3090-227">DirectComposition allows an application to bind a maximum of two visual trees to each window.</span></span> <span data-ttu-id="f3090-228">Визуальные деревья включают в себя одно, которое состоит поверх самого окна, но позади всех дочерних окон окна, а другое — в верхней части окна и поверх дочерних окон.</span><span class="sxs-lookup"><span data-stu-id="f3090-228">The visual trees include one that is composed on top of the window itself, but behind all of the window’s child windows, and another that is composed on top of the window and on top of the child windows.</span></span> <span data-ttu-id="f3090-229">Иными словами, каждое окно имеет четыре концептуальных слоя, и все слои обрезаются до видимой области целевого окна.</span><span class="sxs-lookup"><span data-stu-id="f3090-229">In other words, each window has four conceptual layers, and all layers are clipped to the target window's visible region.</span></span> <span data-ttu-id="f3090-230">На следующем рисунке показаны четыре концептуальных слоя окна.</span><span class="sxs-lookup"><span data-stu-id="f3090-230">The following illustration shows the four conceptual layers of a window.</span></span>

![концептуальные слои окна](images/directcomposition-layers.png)

## <a name="transactional-composition"></a><span data-ttu-id="f3090-232">Транзакционная композиция</span><span class="sxs-lookup"><span data-stu-id="f3090-232">Transactional composition</span></span>

<span data-ttu-id="f3090-233">DirectComposition использует модель транзакций, в которой создается пакетный набор изменений для визуального элемента, а затем зафиксируется значение DirectComposition для обработки всех элементов одновременно.</span><span class="sxs-lookup"><span data-stu-id="f3090-233">DirectComposition uses a transactional model where you create a batched set of changes to a visual and then "commit" the set to DirectComposition for processing all at once.</span></span> <span data-ttu-id="f3090-234">Вы можете изменить тот же визуальный объект DirectComposition и зафиксировать изменения любое количество раз.</span><span class="sxs-lookup"><span data-stu-id="f3090-234">You can modify the same DirectComposition visual object and commit the changes any number of times.</span></span> <span data-ttu-id="f3090-235">Когда диспетчер окон рабочего стола (DWM) берет пакеты, он выбирает все ожидающие пакеты и применяет их к следующему кадру в том порядке, в котором они были зафиксированы.</span><span class="sxs-lookup"><span data-stu-id="f3090-235">When the Desktop Window Manager (DWM) picks up batches, it picks up all pending batches and applies them to the next frame in the order they were committed.</span></span>

<span data-ttu-id="f3090-236">Все изменения в одной фиксации гарантированно применяются к одному кадру.</span><span class="sxs-lookup"><span data-stu-id="f3090-236">All changes within a single commit are guaranteed to be applied to a single frame.</span></span> <span data-ttu-id="f3090-237">Так как DWM собирает пакеты по одному разу на кадр, можно изменить любой конкретный объект только один раз для каждого кадра.</span><span class="sxs-lookup"><span data-stu-id="f3090-237">Because DWM collects batches once per frame, you can modify any particular object only once per frame.</span></span> <span data-ttu-id="f3090-238">Последующие фиксации, которые изменяют различные объекты, могут также применяться к текущему кадру, но DirectComposition не гарантирует, что изменения будут происходить в одном кадре.</span><span class="sxs-lookup"><span data-stu-id="f3090-238">Subsequent commits that modify different objects might also be applied to the current frame, but DirectComposition does not guarantee that the changes will occur in the same frame.</span></span>

<span data-ttu-id="f3090-239">Методы [**идкомпоситионсурфаце:: бегиндрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) и [**Идкомпоситионсурфаце:: EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) позволяют синхронизировать обновления отрисовки с визуальными обновлениями.</span><span class="sxs-lookup"><span data-stu-id="f3090-239">The [**IDCompositionSurface::BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) and [**IDCompositionSurface::EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) methods let you synchronize rendering updates with visual updates.</span></span> <span data-ttu-id="f3090-240">Например, можно вызвать **идкомпоситионсурфаце:: бегиндрав**, обновить свойства Оффсеткс и Clip визуального элемента, вызвать [**Идкомпоситиондевице:: Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit), нарисовать содержимое с помощью Microsoft DirectX, а затем вызвать **идкомпоситионсурфаце:: EndDraw**.</span><span class="sxs-lookup"><span data-stu-id="f3090-240">For example, you can call **IDCompositionSurface::BeginDraw**, update the OffsetX and Clip properties of a visual, call [**IDCompositionDevice::Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit), draw content with Microsoft DirectX, and then call **IDCompositionSurface::EndDraw**.</span></span> <span data-ttu-id="f3090-241">В этом случае Microsoft DirectComposition гарантирует, что содержимое растрового изображения и свойства визуальных элементов будут обновляться одновременно.</span><span class="sxs-lookup"><span data-stu-id="f3090-241">In this case, Microsoft DirectComposition ensures that bitmap content and the visual properties are updated at the same time.</span></span>

### <a name="batching"></a><span data-ttu-id="f3090-242">Пакетная обработка</span><span class="sxs-lookup"><span data-stu-id="f3090-242">Batching</span></span>

<span data-ttu-id="f3090-243">Можно зафиксировать несколько изменений одного и того же визуального элемента или внести несколько изменений в различные визуальные элементы в пределах одного кадра.</span><span class="sxs-lookup"><span data-stu-id="f3090-243">You can commit multiple changes to the same visual, or multiple changes to different visuals, within the same frame.</span></span> <span data-ttu-id="f3090-244">При внесении нескольких изменений в один и тот же визуальный элемент в одном и том же фрейме учитывайте следующие моменты:</span><span class="sxs-lookup"><span data-stu-id="f3090-244">When making multiple changes to the same visual within the same frame, keep the following points in mind:</span></span>

-   <span data-ttu-id="f3090-245">При внесении нескольких изменений в одно и то же свойство визуального элемента применяется только Последнее изменение.</span><span class="sxs-lookup"><span data-stu-id="f3090-245">If you make multiple changes to the same property of a visual, only the last change is applied.</span></span> <span data-ttu-id="f3090-246">Например, если для параметра Opacity задано значение 0, то в 0,5 и, наконец, в 1,0, к визуальному элементу применяется только непрозрачность 1,0.</span><span class="sxs-lookup"><span data-stu-id="f3090-246">For example, if you set the opacity to 0, then to 0.5, and finally to 1.0, only an opacity of 1.0 is applied to the visual.</span></span>
-   <span data-ttu-id="f3090-247">При изменении нескольких свойств одного и того же визуального элемента DirectComposition применяет изменения сначала к визуальному элементу, а затем к любым дочерним визуальным элементами.</span><span class="sxs-lookup"><span data-stu-id="f3090-247">If you change multiple properties of the same visual, DirectComposition applies the changes first to the visual and then to any child visuals.</span></span> <span data-ttu-id="f3090-248">Свойства применяются в следующем порядке независимо от порядка их указания:</span><span class="sxs-lookup"><span data-stu-id="f3090-248">The properties are applied in the following order regardless of the order in which you specify them:</span></span>

    1.  <span data-ttu-id="f3090-249">Offset</span><span class="sxs-lookup"><span data-stu-id="f3090-249">Offset</span></span>
    2.  <span data-ttu-id="f3090-250">Преобразование</span><span class="sxs-lookup"><span data-stu-id="f3090-250">Transform</span></span>
    3.  <span data-ttu-id="f3090-251">Отсечение</span><span class="sxs-lookup"><span data-stu-id="f3090-251">Clip</span></span>
    4.  <span data-ttu-id="f3090-252">Действие</span><span class="sxs-lookup"><span data-stu-id="f3090-252">Effect</span></span>

    <span data-ttu-id="f3090-253">На следующем рисунке показан результат применения всех четырех свойств к визуальному элементу.</span><span class="sxs-lookup"><span data-stu-id="f3090-253">The following illustration shows the result of applying all four properties to a visual.</span></span>

    ![результат применения всех четырех свойств к визуальному элементу](images/order-of-properties.png)

    <span data-ttu-id="f3090-255">Помните, что все изменения применяются к визуальному элементу одновременно в контексте того же кадра.</span><span class="sxs-lookup"><span data-stu-id="f3090-255">Remember that all changes are applied to the visual at once within the context of the same frame.</span></span> <span data-ttu-id="f3090-256">Это означает, что с точки зрения пользователя изменения визуального элемента происходят мгновенно.</span><span class="sxs-lookup"><span data-stu-id="f3090-256">This means that, from the user's perspective, the changes to the visual occur instantaneously.</span></span>

-   <span data-ttu-id="f3090-257">Для свойства Transform можно использовать [**идкомпоситиондевице:: креатетрансформграуп**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createtransformgroup) , чтобы создать группу преобразований, которые будут применяться ко всему визуальному элементу.</span><span class="sxs-lookup"><span data-stu-id="f3090-257">For the Transform property, you can use [**IDCompositionDevice::CreateTransformGroup**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createtransformgroup) to create a group of transforms to apply to a visual all at once.</span></span> <span data-ttu-id="f3090-258">DirectComposition применяет преобразования в указанном порядке.</span><span class="sxs-lookup"><span data-stu-id="f3090-258">DirectComposition applies the transforms in the order that you specify.</span></span>
-   <span data-ttu-id="f3090-259">Для свойства Effect можно использовать [**идкомпоситионеффектграуп**](/windows/win32/api/dcomp/nn-dcomp-idcompositioneffectgroup) , чтобы применить группу эффектов.</span><span class="sxs-lookup"><span data-stu-id="f3090-259">For the Effect property, you can use [**IDCompositionEffectGroup**](/windows/win32/api/dcomp/nn-dcomp-idcompositioneffectgroup) to apply a group of effects.</span></span> <span data-ttu-id="f3090-260">DirectComposition применяет эффекты в указанном порядке.</span><span class="sxs-lookup"><span data-stu-id="f3090-260">DirectComposition applies the effects in the order that you specify.</span></span> <span data-ttu-id="f3090-261">Кроме того, преобразование «Трехмерная перспектива» приводит к преобразованию визуального дерева после применения всех трехмерных преобразований в текущем визуальном элементе.</span><span class="sxs-lookup"><span data-stu-id="f3090-261">In addition, 3D perspective transformations result in flattening of the visual tree after all 3D transformations in the current visual have been applied.</span></span> <span data-ttu-id="f3090-262">Это гарантирует, что полученный визуальный элемент будет выглядеть как можно ближе к объемному.</span><span class="sxs-lookup"><span data-stu-id="f3090-262">This helps ensure that the resulting visual looks as close to 3D as possible.</span></span>

### <a name="synchronization"></a><span data-ttu-id="f3090-263">Синхронизация</span><span class="sxs-lookup"><span data-stu-id="f3090-263">Synchronization</span></span>

<span data-ttu-id="f3090-264">Приложение может вызывать DirectComposition из нескольких потоков одновременно.</span><span class="sxs-lookup"><span data-stu-id="f3090-264">Your application can call DirectComposition from multiple threads at the same time.</span></span> <span data-ttu-id="f3090-265">Порядок выполнения гарантируется для последовательных вызовов, но не для одновременных вызовов.</span><span class="sxs-lookup"><span data-stu-id="f3090-265">The order of execution is guaranteed for sequential calls, but not for concurrent calls.</span></span> <span data-ttu-id="f3090-266">Например, если поток A изменяет визуальный элемент и поток б фиксирует пакет одновременно, он не определяет, включено ли визуальное изменение в зафиксированный пакет или начинает новый пакет.</span><span class="sxs-lookup"><span data-stu-id="f3090-266">For example, if thread A modifies a visual and thread B commits the batch at the same time, it is not defined whether that visual change is included in the committed batch or whether it starts a new batch.</span></span> <span data-ttu-id="f3090-267">С другой стороны, если приложение использует другие механизмы синхронизации, чтобы убедиться, что один метод вызывается раньше другого, DirectComposition учитывает порядок вызова и обрабатывает их, как если бы оба вызова были выданы в таком порядке из одного потока.</span><span class="sxs-lookup"><span data-stu-id="f3090-267">On the other hand, if your application uses other synchronization mechanisms to ensure that one method is called before the other, DirectComposition honors the call order and processes them as if both calls were issued in that order from a single thread.</span></span>

### <a name="cross-device-visual-trees"></a><span data-ttu-id="f3090-268">Визуальные деревья для разных устройств</span><span class="sxs-lookup"><span data-stu-id="f3090-268">Cross-device visual trees</span></span>

<span data-ttu-id="f3090-269">Объекты DirectComposition не привязаны к потоку; для изменения одного и того же набора объектов можно использовать несколько потоков.</span><span class="sxs-lookup"><span data-stu-id="f3090-269">DirectComposition objects are not thread bound; you can use multiple threads to modify the same set of objects.</span></span> <span data-ttu-id="f3090-270">Однако при совместном использовании одного объекта устройства учитывайте следующие моменты.</span><span class="sxs-lookup"><span data-stu-id="f3090-270">However, be aware of the following issues when sharing the same device object.</span></span>

-   <span data-ttu-id="f3090-271">Оба потока должны иметь возможность вызова [**идкомпоситиондевице:: Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit).</span><span class="sxs-lookup"><span data-stu-id="f3090-271">Both threads need to be able to call [**IDCompositionDevice::Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit).</span></span> <span data-ttu-id="f3090-272">Если только один из потоков вызывает **идкомпоситиондевице:: Commit**, другой поток не может зафиксировать свои изменения в DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="f3090-272">If only one of the threads calls **IDCompositionDevice::Commit**, the other thread cannot commit any of its changes to DirectComposition.</span></span>
-   <span data-ttu-id="f3090-273">Транзакционное поведение может быть потеряно, если один поток вызывает [**идкомпоситиондевице:: Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) , а другой поток все еще выполняет изменения, которые должны быть частью одной транзакции.</span><span class="sxs-lookup"><span data-stu-id="f3090-273">Transactional behavior might be lost if one thread calls [**IDCompositionDevice::Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) while the other thread is still making changes that are intended to be part of the same transaction.</span></span>

<span data-ttu-id="f3090-274">Если необходимо зафиксировать несколько одновременных транзакций в DirectComposition, необходимо использовать несколько объектов устройств, возможно, из нескольких потоков.</span><span class="sxs-lookup"><span data-stu-id="f3090-274">If you need to commit multiple simultaneous transactions to DirectComposition, you must use multiple device objects, possibly from multiple threads.</span></span> <span data-ttu-id="f3090-275">В этом сценарии одно и то же визуальное дерево совместно используется объектами обоих устройств, и каждый объект устройства фиксирует свои собственные транзакции.</span><span class="sxs-lookup"><span data-stu-id="f3090-275">In this scenario, the same visual tree is shared by both device objects, and each device object commits its own transactions.</span></span>

<span data-ttu-id="f3090-276">На следующем рисунке показано визуальное дерево, совместно используемое двумя объектами устройства.</span><span class="sxs-lookup"><span data-stu-id="f3090-276">The following illustration shows a visual tree that is shared by two device objects.</span></span> <span data-ttu-id="f3090-277">Визуальные элементы 1, 2, 4 и 5 принадлежат одному устройству или другому, но Visual 3 совместно используется обоими устройствами и поэтому может использоваться для соединения двух поддеревьев в одном, более крупном визуальном дереве.</span><span class="sxs-lookup"><span data-stu-id="f3090-277">Visuals 1, 2, 4 and 5 are owned by one device or the other, but visual 3 is shared by both devices, and can therefore be used to connect two sub-trees into a single, larger visual tree.</span></span> <span data-ttu-id="f3090-278">Совместное использование визуального дерева позволяет асинхронно манипулировать двумя устройствами из двух разных потоков.</span><span class="sxs-lookup"><span data-stu-id="f3090-278">Sharing the visual tree allows the two devices to be manipulated from two different threads asynchronously.</span></span>

![визуальное дерево, совместно используемое двумя устройствами](images/shared-visual-tree-1.png)

<span data-ttu-id="f3090-280">Чтобы продемонстрировать полезность совместного использования визуального дерева между двумя устройствами, рассмотрим архитектуру, обеспечивающую сенсорный ввод с низкой задержкой.</span><span class="sxs-lookup"><span data-stu-id="f3090-280">To illustrate the usefulness of sharing a visual tree between two devices, consider an architecture that enables low-latency touch input.</span></span> <span data-ttu-id="f3090-281">Архитектура может использовать два потока, один из которых обрабатывает большинство задач пользовательского интерфейса, и второй поток, предназначенный для обработки событий сенсорного ввода.</span><span class="sxs-lookup"><span data-stu-id="f3090-281">The architecture could use two threads, one that handles most UI tasks, and a second thread dedicated to processing touch input events.</span></span> <span data-ttu-id="f3090-282">Сенсорный поток обновляет преобразование конкретного визуального элемента на основе пользовательского жеста ввода.</span><span class="sxs-lookup"><span data-stu-id="f3090-282">The touch thread updates the transform of a particular visual based on the user input gesture.</span></span> <span data-ttu-id="f3090-283">При обновлении преобразования поток касания может сделать все поддерево в рамках этого визуального элемента проследить за пальцем пользователя, увеличить или уменьшить масштаб по мере выполнения пользователем жеста с несколькими касаниями и т. д.</span><span class="sxs-lookup"><span data-stu-id="f3090-283">By updating the transform, the touch thread can make the entire subtree under that visual follow the user’s finger, scale up or down as the user executes a multi-touch gesture, and so on.</span></span> <span data-ttu-id="f3090-284">Поток пользовательского интерфейса удерживает владение большей частью дерева композиции, при этом поток касания владеет только одними визуальными элементами, помеченными для асинхронного ответа на сенсорный экран.</span><span class="sxs-lookup"><span data-stu-id="f3090-284">The UI thread retains ownership of most of the composition tree, with the touch thread owning only the few visuals that are tagged for asynchronous touch response.</span></span> <span data-ttu-id="f3090-285">На следующем рисунке показана упрощенная версия такого дерева компоновки:</span><span class="sxs-lookup"><span data-stu-id="f3090-285">The following illustration shows a simplified version of such a composition tree:</span></span>

![визуальное дерево, совместно используемое в потоке пользовательского интерфейса и сенсорном потоке](images/shared-visual-tree-2.png)

<span data-ttu-id="f3090-287">Как правило, поток пользовательского интерфейса изменяет только те визуальные элементы, которые он владеет исключительно, а сенсорный поток изменяет только общий визуальный элемент.</span><span class="sxs-lookup"><span data-stu-id="f3090-287">Typically, the UI thread modifies only the visuals that it owns exclusively, and the touch thread modifies only the shared visual.</span></span> <span data-ttu-id="f3090-288">Единственное исключение возникает при создании или удалении поддерева с поддержкой сенсорного ввода.</span><span class="sxs-lookup"><span data-stu-id="f3090-288">The only exception occurs when creating or destroying a touch-enabled subtree.</span></span>

## <a name="related-topics"></a><span data-ttu-id="f3090-289">См. также</span><span class="sxs-lookup"><span data-stu-id="f3090-289">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f3090-290">**Идкомпоситионсурфаце:: Бегиндрав**</span><span class="sxs-lookup"><span data-stu-id="f3090-290">**IDCompositionSurface::BeginDraw**</span></span>](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw)
</dt> <dt>

[<span data-ttu-id="f3090-291">**Идкомпоситионсурфаце:: EndDraw**</span><span class="sxs-lookup"><span data-stu-id="f3090-291">**IDCompositionSurface::EndDraw**</span></span>](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw)
</dt> <dt>

[<span data-ttu-id="f3090-292">**Идкомпоситондевице:: Commit**</span><span class="sxs-lookup"><span data-stu-id="f3090-292">**IDCompositonDevice::Commit**</span></span>](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit)
</dt> <dt>

[<span data-ttu-id="f3090-293">Основные понятия DirectComposition</span><span class="sxs-lookup"><span data-stu-id="f3090-293">DirectComposition Concepts</span></span>](directcomposition-concepts.md)
</dt> </dl>

 

 