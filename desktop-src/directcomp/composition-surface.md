---
title: Область композиции
description: В этом разделе описываются типы типов поверхностей, которые поддерживает Microsoft DirectComposition.
ms.assetid: E19B4F0E-1CFA-4E93-BB6A-BFB701BC72CA
keywords:
- область композиции
- Логическая поверхность DirectComposition
- Виртуальная поверхность DirectComposition
- Обновление логической поверхности
- логическая поверхность, обновление
- Обрезка виртуальной поверхности
- Виртуальная поверхность, усечение
- обрезать виртуальную поверхность
- изменение размера виртуальной поверхности
- виртуальные сурейса, изменение размера
- изменить размер виртуальной поверхности
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9f4bd30bfbd1de91444b7076184db597cd7a8c82
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104070181"
---
# <a name="composition-surface"></a><span data-ttu-id="aa537-114">Область композиции</span><span class="sxs-lookup"><span data-stu-id="aa537-114">Composition surface</span></span>

> [!NOTE]
> <span data-ttu-id="aa537-115">Для приложений в Windows 10 рекомендуется использовать интерфейсы API Windows. UI. компоновки вместо DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="aa537-115">For apps on Windows 10, we recommend using Windows.UI.Composition APIs instead of DirectComposition.</span></span> <span data-ttu-id="aa537-116">Дополнительные сведения см. в разделе [модернизировать The классическое приложение с использованием визуального слоя](/windows/uwp/composition/visual-layer-in-desktop-apps).</span><span class="sxs-lookup"><span data-stu-id="aa537-116">For more info, see [Modernize your desktop app using the Visual layer](/windows/uwp/composition/visual-layer-in-desktop-apps).</span></span>

<span data-ttu-id="aa537-117">В этом разделе описываются типы типов поверхностей, которые поддерживает Microsoft DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="aa537-117">This topic describes the types of types of surfaces that Microsoft DirectComposition supports.</span></span>

-   [<span data-ttu-id="aa537-118">Логическая поверхность DirectComposition</span><span class="sxs-lookup"><span data-stu-id="aa537-118">DirectComposition logical surface</span></span>](#directcomposition-logical-surface)
    -   [<span data-ttu-id="aa537-119">Обновление логической поверхности</span><span class="sxs-lookup"><span data-stu-id="aa537-119">Updating a logical surface</span></span>](#updating-a-logical-surface)
    -   [<span data-ttu-id="aa537-120">Приостановка обновлений на логическую поверхность</span><span class="sxs-lookup"><span data-stu-id="aa537-120">Suspending updates to a logical surface</span></span>](#suspending-updates-to-a-logical-surface)
    -   [<span data-ttu-id="aa537-121">Возобновление работы обновлений на логическую поверхность</span><span class="sxs-lookup"><span data-stu-id="aa537-121">Resuming updates to a logical surface</span></span>](#resuming-updates-to-a-logical-surface)
    -   [<span data-ttu-id="aa537-122">Завершение обновлений на логическую поверхность</span><span class="sxs-lookup"><span data-stu-id="aa537-122">Ending updates to a logical surface</span></span>](#suspending-updates-to-a-logical-surface)
    -   [<span data-ttu-id="aa537-123">Пример использования логической поверхности</span><span class="sxs-lookup"><span data-stu-id="aa537-123">Example of using a logical surface</span></span>](#example-of-using-a-logical-surface)
-   [<span data-ttu-id="aa537-124">Виртуальная поверхность DirectComposition</span><span class="sxs-lookup"><span data-stu-id="aa537-124">DirectComposition virtual surface</span></span>](#directcomposition-virtual-surface)
    -   [<span data-ttu-id="aa537-125">Изменение размера виртуальной поверхности</span><span class="sxs-lookup"><span data-stu-id="aa537-125">Resizing a virtual surface</span></span>](#resizing-a-virtual-surface)
    -   [<span data-ttu-id="aa537-126">Обрезка виртуальной поверхности</span><span class="sxs-lookup"><span data-stu-id="aa537-126">Trimming a virtual surface</span></span>](#trimming-a-virtual-surface)
-   [<span data-ttu-id="aa537-127">См. также</span><span class="sxs-lookup"><span data-stu-id="aa537-127">Related topics</span></span>](#related-topics)

## <a name="directcomposition-logical-surface"></a><span data-ttu-id="aa537-128">Логическая поверхность DirectComposition</span><span class="sxs-lookup"><span data-stu-id="aa537-128">DirectComposition logical surface</span></span>

<span data-ttu-id="aa537-129">DirectComposition предоставляет объект [**идкомпоситионсурфаце**](/windows/win32/api/dcomp/nn-dcomp-idcompositionsurface) для представления логической области композиции.</span><span class="sxs-lookup"><span data-stu-id="aa537-129">DirectComposition exposes the [**IDCompositionSurface**](/windows/win32/api/dcomp/nn-dcomp-idcompositionsurface) object to represent a logical composition surface.</span></span> <span data-ttu-id="aa537-130">DirectComposition предоставляет интерфейсы API, которые можно использовать для создания, обновления и удаления этих логических поверхностей.</span><span class="sxs-lookup"><span data-stu-id="aa537-130">DirectComposition exposes APIs that you can use to create, update, and delete these logical surfaces.</span></span> <span data-ttu-id="aa537-131">Каждая поверхность может быть связана с одним или несколькими визуальными элементами.</span><span class="sxs-lookup"><span data-stu-id="aa537-131">Each surface can be associated with one or more visuals.</span></span> <span data-ttu-id="aa537-132">Приложение отвечает за управление жизненным циклом логических поверхностей.</span><span class="sxs-lookup"><span data-stu-id="aa537-132">An application is responsible for managing the lifetime of logical surfaces.</span></span>

### <a name="updating-a-logical-surface"></a><span data-ttu-id="aa537-133">Обновление логической поверхности</span><span class="sxs-lookup"><span data-stu-id="aa537-133">Updating a logical surface</span></span>

<span data-ttu-id="aa537-134">Приложение может обновить логическую поверхность, вызвав [**бегиндрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) и указав размер и смещение прямоугольника на логической поверхности, которую приложение желает обновить.</span><span class="sxs-lookup"><span data-stu-id="aa537-134">An application can update a logical surface by calling [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) and specifying the size and offset of the rectangle on the logical surface that the app wants to update.</span></span> <span data-ttu-id="aa537-135">DirectComposition выделяет прямоугольник указанного размера, а затем возвращает поверхность и соответствующее смещение, которое приложение должно нарисовать или обновить.</span><span class="sxs-lookup"><span data-stu-id="aa537-135">DirectComposition allocates a rectangle of the specified size, and then returns the surface and the corresponding offset that the application needs to draw or update.</span></span> <span data-ttu-id="aa537-136">Ограничения прямоугольника обновления связаны размером поверхности.</span><span class="sxs-lookup"><span data-stu-id="aa537-136">The update rectangle’s limits are bound by the surface size.</span></span> <span data-ttu-id="aa537-137">Например, прямоугольник обновления для поверхности с 40 на 100 пикселей может иметь значение до (0, 0, 40100).</span><span class="sxs-lookup"><span data-stu-id="aa537-137">For example, the update rectangle for a 40-by-100 pixel surface can be up to (0,0,40,100).</span></span> <span data-ttu-id="aa537-138">Кроме того, обновляемая область обеспечивается ограничивающим прямоугольником.</span><span class="sxs-lookup"><span data-stu-id="aa537-138">Also, the updatable region is enforced by a guard rectangle.</span></span> <span data-ttu-id="aa537-139">Так как в каждый момент времени может быть только один прямоугольник защиты, одновременно может обновляться только одна логическая область.</span><span class="sxs-lookup"><span data-stu-id="aa537-139">Because there can be only one guard rectangle at a time, only one logical surface can be updated at a time.</span></span> <span data-ttu-id="aa537-140">**Бегиндрав** возвращает код ошибки, если [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) или [**суспенддрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) не вызывался после предыдущего вызова **бегиндрав**.</span><span class="sxs-lookup"><span data-stu-id="aa537-140">**BeginDraw** returns an error code if [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) or [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) has not been called after a previous call to **BeginDraw**.</span></span> <span data-ttu-id="aa537-141">Приложение может добавить зафиксированный вызов **бегиндрав** в пакет, но не вступит в силу, пока **EndDraw** не будет вызван и зафиксирован.</span><span class="sxs-lookup"><span data-stu-id="aa537-141">An application can add a committed call to **BeginDraw** to a batch, but it does not take effect until **EndDraw** is called and committed.</span></span>

### <a name="suspending-updates-to-a-logical-surface"></a><span data-ttu-id="aa537-142">Приостановка обновлений на логическую поверхность</span><span class="sxs-lookup"><span data-stu-id="aa537-142">Suspending updates to a logical surface</span></span>

<span data-ttu-id="aa537-143">Приложение, нуждающееся в обновлении разных поверхностей, может вызвать [**суспенддрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) для текущего обновления, а затем вызвать [**бегиндрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) , чтобы начать новое обновление.</span><span class="sxs-lookup"><span data-stu-id="aa537-143">An application that needs to update different surfaces can call [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) on the current update, and then call [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) to begin a new update.</span></span> <span data-ttu-id="aa537-144">Microsoft DirectComposition допускает несколько обновлений, но только один может быть активным за раз.</span><span class="sxs-lookup"><span data-stu-id="aa537-144">Microsoft DirectComposition allows multiple updates, but only one can be active at a time.</span></span> <span data-ttu-id="aa537-145">Это означает, что необходимо вызвать **суспенддрав** или [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) на одной поверхности перед вызовом **бегиндрав** для следующего.</span><span class="sxs-lookup"><span data-stu-id="aa537-145">This means that you need to call **SuspendDraw** or [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) on one surface before calling **BeginDraw** on the next one.</span></span> <span data-ttu-id="aa537-146">В отличие от **EndDraw**, зафиксированный пакет может содержать поверхность, которая находится в **суспенддрав** состоянии, но такие обновления не будут отображаться на экране, пока не будет вызван **EndDraw** .</span><span class="sxs-lookup"><span data-stu-id="aa537-146">Unlike **EndDraw**, a committed batch can contain a surface that is in a **SuspendDraw** state, but such updates won’t be shown on the screen until **EndDraw** is called.</span></span>

### <a name="resuming-updates-to-a-logical-surface"></a><span data-ttu-id="aa537-147">Возобновление работы обновлений на логическую поверхность</span><span class="sxs-lookup"><span data-stu-id="aa537-147">Resuming updates to a logical surface</span></span>

<span data-ttu-id="aa537-148">Приложение может возобновить обновление до поверхности в [**суспенддрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) состоянии путем вызова [**ресумедрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw).</span><span class="sxs-lookup"><span data-stu-id="aa537-148">An application can resume an update to a surface that is in a [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) state by calling [**ResumeDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw).</span></span> <span data-ttu-id="aa537-149">Этот метод может быть вызван только на приостановленной поверхности.</span><span class="sxs-lookup"><span data-stu-id="aa537-149">This method can be called only on a suspended surface.</span></span>

### <a name="ending-updates-to-a-logical-surface"></a><span data-ttu-id="aa537-150">Завершение обновлений на логическую поверхность</span><span class="sxs-lookup"><span data-stu-id="aa537-150">Ending updates to a logical surface</span></span>

<span data-ttu-id="aa537-151">Вызов [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) и [**commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) является единственным способом просмотра изменений точечных рисунков на экране.</span><span class="sxs-lookup"><span data-stu-id="aa537-151">Calling [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) and [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) is the only way to see bitmap update changes on the screen.</span></span> <span data-ttu-id="aa537-152">Каждый вызов **EndDraw** должен иметь соответствующий вызов [**бегиндрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) для удаления прямоугольника защиты.</span><span class="sxs-lookup"><span data-stu-id="aa537-152">Each call to **EndDraw** must have a corresponding call to [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) to remove the guard rectangle.</span></span> <span data-ttu-id="aa537-153">Логическая поверхность сохраняет все обновления до тех пор, пока не будет вызвана **фиксация** .</span><span class="sxs-lookup"><span data-stu-id="aa537-153">The logical surface retains all the updates until **Commit** is called.</span></span> <span data-ttu-id="aa537-154">Можно также вызвать **EndDraw** на поверхности, которая находится в состоянии [**суспенддрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) , так как **EndDraw** является подразумеваемым возобновлением/окончанием.</span><span class="sxs-lookup"><span data-stu-id="aa537-154">You can also call **EndDraw** on a surface that is in the [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) state because **EndDraw** is an implied resume/end.</span></span> <span data-ttu-id="aa537-155">После вызова **EndDraw** обновленное содержимое отображается на экране и удаляется, чтобы память для обновления могла повторно использоваться для последующего обновления.</span><span class="sxs-lookup"><span data-stu-id="aa537-155">After you call **EndDraw**, the updated content is presented to the screen and discarded so that the memory for the update can be reused for a later update.</span></span>

### <a name="example-of-using-a-logical-surface"></a><span data-ttu-id="aa537-156">Пример использования логической поверхности</span><span class="sxs-lookup"><span data-stu-id="aa537-156">Example of using a logical surface</span></span>

<span data-ttu-id="aa537-157">В следующем примере описываются шаги, которые может предпринять приложение при создании визуального дерева, состоящего из двух визуальных элементов, а затем требуется обновить определенные регионы двух логических поверхностей, связанных с визуальными элементами.</span><span class="sxs-lookup"><span data-stu-id="aa537-157">The following example describes the steps that an application would take if it created a visual tree consisting of two visuals, and then needed to update specific regions of the two logical surfaces associated with the visuals:</span></span>

1.  <span data-ttu-id="aa537-158">Создайте устройство DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="aa537-158">Create a DirectComposition device.</span></span>
2.  <span data-ttu-id="aa537-159">Создайте визуальное дерево, состоящее из корневого узла и визуальных элементов 1 и 2.</span><span class="sxs-lookup"><span data-stu-id="aa537-159">Create the visual tree consisting of a root node and visuals 1 and 2.</span></span>
3.  <span data-ttu-id="aa537-160">Создайте логические поверхности 1 и 2.</span><span class="sxs-lookup"><span data-stu-id="aa537-160">Create logical surfaces 1 and 2.</span></span>
4.  <span data-ttu-id="aa537-161">Вызовите [**сетконтент**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setcontent) , чтобы связать логическую поверхность с визуальными элементами 1 и 2.</span><span class="sxs-lookup"><span data-stu-id="aa537-161">Call [**SetContent**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-setcontent) to associate a logical surface with visuals 1 and 2.</span></span>
5.  <span data-ttu-id="aa537-162">Вызовите [**бегиндрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) в подпрямоугольнике логической поверхности 1.</span><span class="sxs-lookup"><span data-stu-id="aa537-162">Call [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) on a sub-rectangle of logical surface 1.</span></span>
6.  <span data-ttu-id="aa537-163">Обновление поверхности в смещении, возвращенном DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="aa537-163">Update the surface at the offset returned by DirectComposition.</span></span>
7.  <span data-ttu-id="aa537-164">Другие возможные шаги.</span><span class="sxs-lookup"><span data-stu-id="aa537-164">Optional steps:</span></span>
    1.  <span data-ttu-id="aa537-165">Вызовите [**суспенддрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) на логической поверхности 1.</span><span class="sxs-lookup"><span data-stu-id="aa537-165">Call [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw) on logical surface 1.</span></span>
    2.  <span data-ttu-id="aa537-166">Вызовите [**бегиндрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) для подпрямоугольника логической поверхности 2.</span><span class="sxs-lookup"><span data-stu-id="aa537-166">Call [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) on sub-rect of logical surface 2.</span></span>
    3.  <span data-ttu-id="aa537-167">Обновление поверхности в смещении, возвращенном DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="aa537-167">Update the surface at the offset returned by DirectComposition.</span></span>
    4.  <span data-ttu-id="aa537-168">Вызовите [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) на логической поверхности 2.</span><span class="sxs-lookup"><span data-stu-id="aa537-168">Call [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) on logical surface 2.</span></span>
    5.  <span data-ttu-id="aa537-169">Вызовите [**ресумедрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw) на логической поверхности 1.</span><span class="sxs-lookup"><span data-stu-id="aa537-169">Call [**ResumeDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw) on logical surface 1.</span></span>
8.  <span data-ttu-id="aa537-170">Обновление поверхности в смещении, возвращенном DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="aa537-170">Update the surface at the offset returned by DirectComposition.</span></span>
9.  <span data-ttu-id="aa537-171">Вызовите [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) на логической поверхности 1.</span><span class="sxs-lookup"><span data-stu-id="aa537-171">Call [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) on logical surface 1.</span></span>
10. <span data-ttu-id="aa537-172">Вызов [**commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit).</span><span class="sxs-lookup"><span data-stu-id="aa537-172">Call [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit).</span></span>

## <a name="directcomposition-virtual-surface"></a><span data-ttu-id="aa537-173">Виртуальная поверхность DirectComposition</span><span class="sxs-lookup"><span data-stu-id="aa537-173">DirectComposition virtual surface</span></span>

<span data-ttu-id="aa537-174">DirectComposition предоставляет интерфейс [**идкомпоситионвиртуалсурфаце**](/windows/win32/api/dcomp/nn-dcomp-idcompositionvirtualsurface) для представления виртуальной поверхности, которая представляет собой коллекцию логических поверхностей (плиток), расположенных в фиксированной сетке с плитками фиксированного размера.</span><span class="sxs-lookup"><span data-stu-id="aa537-174">DirectComposition exposes the [**IDCompositionVirtualSurface**](/windows/win32/api/dcomp/nn-dcomp-idcompositionvirtualsurface) interface to represent a virtual surface, which is a collection of logical surfaces (tiles) arranged in a fixed grid with tiles of a fixed size.</span></span> <span data-ttu-id="aa537-175">Приложение задает размер виртуальной текстуры во время создания.</span><span class="sxs-lookup"><span data-stu-id="aa537-175">The application specifies the size of the virtual texture at creation time.</span></span> <span data-ttu-id="aa537-176">Размер определяет границы виртуальной поверхности.</span><span class="sxs-lookup"><span data-stu-id="aa537-176">The size establishes the boundaries for the virtual surface.</span></span> <span data-ttu-id="aa537-177">Поверхность может быть связана с одним или несколькими визуальными элементами.</span><span class="sxs-lookup"><span data-stu-id="aa537-177">The surface can be associated with one or more visuals.</span></span>

<span data-ttu-id="aa537-178">При инициализации виртуальной поверхности она не поддерживается фактическими выделениями.</span><span class="sxs-lookup"><span data-stu-id="aa537-178">When a virtual surface is initialized, it is not backed by actual allocations.</span></span> <span data-ttu-id="aa537-179">Иными словами, он не хранит никаких битов.</span><span class="sxs-lookup"><span data-stu-id="aa537-179">In other words, it doesn’t hold any bits.</span></span> <span data-ttu-id="aa537-180">DirectComposition выделяет плитки (т. е. объекты поверхности композиции) после того, как приложение запустит обновление поверхности.</span><span class="sxs-lookup"><span data-stu-id="aa537-180">DirectComposition allocates tiles (that is, composition surface objects) after the application starts updating the surface.</span></span> <span data-ttu-id="aa537-181">Приложение обновляет виртуальную поверхность, вызывая [**бегиндрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) и указывая интересующую область относительно координат виртуальной поверхности.</span><span class="sxs-lookup"><span data-stu-id="aa537-181">The application updates the virtual surface by calling [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw) and specifying the region of interest with respect to the coordinates of the virtual surface.</span></span> <span data-ttu-id="aa537-182">Затем DirectComposition выделяет необходимые плитки для размещения обновления и возвращает поверхность композиции и смещение для обновления.</span><span class="sxs-lookup"><span data-stu-id="aa537-182">Then, DirectComposition allocates the necessary tiles to hold the update, and returns the composition surface and offset to update.</span></span>

<span data-ttu-id="aa537-183">Как и для логических поверхностей, вы можете вызывать [**бегиндрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw), [**суспенддрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw), [**ресумедрав**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw) и [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) на виртуальной поверхности.</span><span class="sxs-lookup"><span data-stu-id="aa537-183">As with logical surfaces, you can call [**BeginDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-begindraw), [**SuspendDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-suspenddraw), [**ResumeDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-resumedraw) and [**EndDraw**](/windows/win32/api/dcomp/nf-dcomp-idcompositionsurface-enddraw) on a virtual surface.</span></span> <span data-ttu-id="aa537-184">Кроме того, DirectComposition предоставляет методы, которые можно использовать для изменения размера и обрезки существующей виртуальной поверхности.</span><span class="sxs-lookup"><span data-stu-id="aa537-184">In addition, DirectComposition exposes methods that you can use to resize and trim an existing virtual surface.</span></span>

### <a name="resizing-a-virtual-surface"></a><span data-ttu-id="aa537-185">Изменение размера виртуальной поверхности</span><span class="sxs-lookup"><span data-stu-id="aa537-185">Resizing a virtual surface</span></span>

<span data-ttu-id="aa537-186">Метод изменения [**размера**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-resize) изменяет границы виртуальной поверхности, что означает, что новые обновления или выделения должны попадать в границы, заданные новым размером.</span><span class="sxs-lookup"><span data-stu-id="aa537-186">The [**Resize**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-resize) method changes the boundaries of the virtual surface, meaning that any new updates or allocations must fall in the boundaries set by the new size.</span></span> <span data-ttu-id="aa537-187">Приложение использует **Размер** , чтобы сообщить DirectComposition, что определенный регион виртуальной поверхности больше не нужен и его можно освободить.</span><span class="sxs-lookup"><span data-stu-id="aa537-187">An application uses **Resize** to tell DirectComposition that a particular region of the virtual surface is no longer needed and can be reclaimed.</span></span> <span data-ttu-id="aa537-188">Если **изменить размер** сжимает виртуальную поверхность, приложение больше не сможет обновлять регионы за пределами новых границ.</span><span class="sxs-lookup"><span data-stu-id="aa537-188">If **Resize** shrinks the virtual surface, the application can no longer update the regions outside the new boundaries.</span></span>

<span data-ttu-id="aa537-189">На следующем рисунке показано, что размер виртуальной поверхности с 3 по 3 изменен на 2.</span><span class="sxs-lookup"><span data-stu-id="aa537-189">The following illustration shows a 3-by-3 virtual surface resized to 2-by-2.</span></span> <span data-ttu-id="aa537-190">Красная область представляет плитки, которые отбрасываются в ходе операции изменения размера, и память освобождается DirectComposition.</span><span class="sxs-lookup"><span data-stu-id="aa537-190">The red region represents tiles that are discarded as part of the resize operation, and the memory is reclaimed by DirectComposition.</span></span> <span data-ttu-id="aa537-191">После изменения размера приложение не сможет вносить обновления в красный регион без изменения размера виртуальной поверхности.</span><span class="sxs-lookup"><span data-stu-id="aa537-191">After the resize, the application can't make updates to the red region without resizing the virtual surface again.</span></span>

![<span data-ttu-id="aa537-192">изменение размера виртуальной поверхности</span><span class="sxs-lookup"><span data-stu-id="aa537-192">resizing a virtual surface</span></span> ](images/resize-virtual-surface.png)

<span data-ttu-id="aa537-193">Операция изменения размера вступает в силу немедленно.</span><span class="sxs-lookup"><span data-stu-id="aa537-193">The resize operation takes effect immediately.</span></span> <span data-ttu-id="aa537-194">DirectComposition не ждет, пока приложение вызовет [**commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) для внесения изменений в размер.</span><span class="sxs-lookup"><span data-stu-id="aa537-194">DirectComposition doesn't wait for the application to call [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit) to make the resize updates.</span></span> <span data-ttu-id="aa537-195">Например, предположим, что приложение выполняет следующую последовательность вызовов.</span><span class="sxs-lookup"><span data-stu-id="aa537-195">For example, suppose an application makes the following sequence of calls.</span></span>


```
pVirtualSurface->Resize(0, 0);
pVirtualSurface->Resize(INT_MAX, INT_MAX);
pDevice->Commit();
```



<span data-ttu-id="aa537-196">В этом примере приложение теряет все содержимое при первом изменении размера.</span><span class="sxs-lookup"><span data-stu-id="aa537-196">In this example, the application loses all content on the first resize.</span></span> <span data-ttu-id="aa537-197">Второй размер не действует, несмотря на то, что он был вызван перед [**фиксацией**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit).</span><span class="sxs-lookup"><span data-stu-id="aa537-197">The second resize has no effect even though it was called before [**Commit**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-commit).</span></span> <span data-ttu-id="aa537-198">В этом случае на экране ничего не отображается.</span><span class="sxs-lookup"><span data-stu-id="aa537-198">In this case nothing shows on the screen.</span></span>

### <a name="trimming-a-virtual-surface"></a><span data-ttu-id="aa537-199">Обрезка виртуальной поверхности</span><span class="sxs-lookup"><span data-stu-id="aa537-199">Trimming a virtual surface</span></span>

<span data-ttu-id="aa537-200">Метод [**Trim**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-trim) определяет регион виртуальной поверхности, который требуется приложению.</span><span class="sxs-lookup"><span data-stu-id="aa537-200">The [**Trim**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-trim) method identifies the region of the virtual surface that the application needs.</span></span> <span data-ttu-id="aa537-201">Она не изменяет размер границ виртуальной поверхности, но она сообщает DirectComposition, какие логические поверхности в данный момент необходимо выделить.</span><span class="sxs-lookup"><span data-stu-id="aa537-201">It doesn't resize the boundaries of the virtual surface, but it does tell DirectComposition which logical surfaces currently need to be allocated.</span></span>

<span data-ttu-id="aa537-202">На следующем рисунке зеленый квадрат — это окно просмотра приложения.</span><span class="sxs-lookup"><span data-stu-id="aa537-202">In the following illustration, the green square is the application’s viewport.</span></span> <span data-ttu-id="aa537-203">Сначала приложение подготавливается к первым шести плиткам (синим) виртуальной поверхности (светло-серым), которые находятся в окне просмотра.</span><span class="sxs-lookup"><span data-stu-id="aa537-203">The application initially renders to the first six tiles (blue) of the virtual surface (light gray) that are in the viewport.</span></span> <span data-ttu-id="aa537-204">По мере прокрутки страницы, представленной виртуальной поверхностью, приложению необходимо визуализировать последние шесть плиток.</span><span class="sxs-lookup"><span data-stu-id="aa537-204">As the page that is represented by the virtual surface scrolls, the application needs to render the last six tiles.</span></span> <span data-ttu-id="aa537-205">Приложение вызывает [**Trim**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-trim) , чтобы указать, что область, определенная последними шести плитками, является местом, где находится содержимое, а остальное не требуется в данный момент.</span><span class="sxs-lookup"><span data-stu-id="aa537-205">The application calls [**Trim**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvirtualsurface-trim) to indicate that the region defined by the last six tiles is where the content is, and the rest is not needed at the moment.</span></span> <span data-ttu-id="aa537-206">DirectComposition может затем перезапустить логические поверхности, которые изначально представляли первые шесть плиток (темно-серый цвет).</span><span class="sxs-lookup"><span data-stu-id="aa537-206">DirectComposition can then choose to recycle the logical surfaces that originally represented the first six tiles (dark gray).</span></span>

![Обрезка виртуальной поверхности](images/trim-virtual-surface.png)

## <a name="related-topics"></a><span data-ttu-id="aa537-208">См. также</span><span class="sxs-lookup"><span data-stu-id="aa537-208">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="aa537-209">Основные понятия DirectComposition</span><span class="sxs-lookup"><span data-stu-id="aa537-209">DirectComposition Concepts</span></span>](directcomposition-concepts.md)
</dt> </dl>

 

 