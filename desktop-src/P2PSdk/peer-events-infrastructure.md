---
description: Одноранговая инфраструктура использует события для уведомления приложений об изменениях, произошедших в одноранговой сети, например об узле, который добавляется или удаляется из графа.
ms.assetid: a056da1c-b8f9-4dad-8df9-df24c6b359b7
title: Инфраструктура событий одноранговых узлов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6347ad6a7dd0cf2fae4a0aa623bfda48ab0aa9f8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105663309"
---
# <a name="peer-events-infrastructure"></a><span data-ttu-id="7c5d8-103">Инфраструктура событий одноранговых узлов</span><span class="sxs-lookup"><span data-stu-id="7c5d8-103">Peer Events Infrastructure</span></span>

<span data-ttu-id="7c5d8-104">Одноранговая инфраструктура использует события для уведомления приложений об изменениях, произошедших в одноранговой сети, например об узле, который добавляется или удаляется из графа.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-104">The Peer Infrastructure uses events to notify applications of changes that have occurred within a peer network, for example, a node that is added or removed from a graph.</span></span> <span data-ttu-id="7c5d8-105">Инфраструктуры одноранговых схем и одноранговых групп используют инфраструктуру событий.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-105">The Peer Graphing and Peer Grouping Infrastructures use the peer events infrastructure.</span></span>

## <a name="receiving-peer-event-notification"></a><span data-ttu-id="7c5d8-106">Получение уведомления о событии однорангового узла</span><span class="sxs-lookup"><span data-stu-id="7c5d8-106">Receiving Peer Event Notification</span></span>

<span data-ttu-id="7c5d8-107">Одноранговый узел может зарегистрироваться для получения уведомлений при изменении атрибута диаграммы или группы или при возникновении определенного однорангового события.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-107">A peer can register to receive notification when an attribute of a graph or group changes, or a specific peer event occurs.</span></span> <span data-ttu-id="7c5d8-108">Одноранговые приложения вызывают функцию [**пирграфрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent) или [**пирграупрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent) и передают в одноранговую инфраструктуру обработчик событий, созданный ранее путем вызова функции [**CreateEvent**](graphing-reference-links.md).</span><span class="sxs-lookup"><span data-stu-id="7c5d8-108">A peer application calls the [**PeerGraphRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent) or [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent) function, and passes an event handle to the Peer Infrastructure, which is created previously by a call to [**CreateEvent**](graphing-reference-links.md).</span></span> <span data-ttu-id="7c5d8-109">Одноранговая инфраструктура использует дескриптор для сигнализации приложения о том, что произошло событие однорангового узла.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-109">The Peer Infrastructure uses the handle to signal an application that a peer event has occurred.</span></span>

<span data-ttu-id="7c5d8-110">Приложение также передает ряд структур [**\_ \_ \_ регистрации**](/windows/desktop/api/P2P/ns-p2p-peer_group_event_registration) [**\_ \_ событий \_**](/windows/desktop/api/P2P/ns-p2p-peer_graph_event_registration) одноранговых групп, которые указывают на одноранговую инфраструктуру конкретные события одноранговых узлов, для которых приложение запрашивает уведомления.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-110">The application also passes a series of [**PEER\_GRAPH\_EVENT\_REGISTRATION**](/windows/desktop/api/P2P/ns-p2p-peer_graph_event_registration) or [**PEER\_GROUP\_EVENT\_REGISTRATION**](/windows/desktop/api/P2P/ns-p2p-peer_group_event_registration) structures that indicate to the Peer Infrastructure the specific peer events for which the application is requesting notification.</span></span> <span data-ttu-id="7c5d8-111">Приложение также должно точно указать, сколько структур передается.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-111">The application must also specify exactly how many structures are being passed.</span></span>

## <a name="peer-graphing-events"></a><span data-ttu-id="7c5d8-112">События одноранговой диаграммы</span><span class="sxs-lookup"><span data-stu-id="7c5d8-112">Peer Graphing Events</span></span>

<span data-ttu-id="7c5d8-113">Приложение одноранговых диаграмм может зарегистрироваться для получения уведомлений о 9 одноранговых событиях графа.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-113">A Peer Graphing application can register to receive notification for 9 peer graph events.</span></span> <span data-ttu-id="7c5d8-114">Имя каждого события предшествует **\_ \_ \_ событию однорангового графа**, например **\_ \_ \_ изменение состояния однорангового графа**.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-114">Each event name is prefaced with **PEER\_GRAPH\_EVENT\_**, for example, **PEER\_GRAPH\_STATUS\_CHANGED**.</span></span> <span data-ttu-id="7c5d8-115">Если не указано иное, сведения об изменении извлекаются с помощью [**пирграфжетевентдата**](/windows/desktop/api/P2P/nf-p2p-peergraphgeteventdata).</span><span class="sxs-lookup"><span data-stu-id="7c5d8-115">Unless otherwise noted, information about a change is retrieved by using [**PeerGraphGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergraphgeteventdata).</span></span>

-   <span data-ttu-id="7c5d8-116">**Одноранговая сеть \_ \_Состояние события графа \_ \_ изменилось** указывает, что состояние диаграммы изменено, например, узел синхронизирован с графиком.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-116">**PEER\_GRAPH\_EVENT\_STATUS\_CHANGED** indicates that the status of a graph is changed, for example, a node has synchronized with a graph.</span></span>
-   <span data-ttu-id="7c5d8-117">**Одноранговая сеть \_ \_ \_ \_ Изменение свойства события Graph** указывает на изменение свойства диаграммы или группы, например, изменение понятного имени графа.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-117">**PEER\_GRAPH\_EVENT\_PROPERTY\_CHANGED** indicates that a property of a graph or group is changed, for example, the friendly name of a graph has changed.</span></span>
    > [!Note]  
    > <span data-ttu-id="7c5d8-118">Приложение должно вызвать [**пирграфжетпропертиес**](/windows/desktop/api/P2P/nf-p2p-peergraphgetproperties) для получения измененных сведений.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-118">The application must call [**PeerGraphGetProperties**](/windows/desktop/api/P2P/nf-p2p-peergraphgetproperties) to obtain the changed information.</span></span>

     

-   <span data-ttu-id="7c5d8-119">**Одноранговая сеть \_ \_ \_ \_ Изменение записи о событии Graph** означает, что запись изменена, например, запись удаляется.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-119">**PEER\_GRAPH\_EVENT\_RECORD\_CHANGED** indicates that a record is changed, for example, a record is deleted.</span></span>
-   <span data-ttu-id="7c5d8-120">**Одноранговая сеть \_ \_ \_ Прямое \_ соединение с событием Graph** означает, что прямое соединение изменилось, например, если узел подключен.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-120">**PEER\_GRAPH\_EVENT\_DIRECT\_CONNECTION** indicates that a direct connection is changed, for example, a node has connected.</span></span>
-   <span data-ttu-id="7c5d8-121">**Одноранговая сеть \_ \_ \_ \_ Подключение соседа о событии Graph** указывает на изменение соединения с соседним узлом, например с подключением узла.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-121">**PEER\_GRAPH\_EVENT\_NEIGHBOR\_CONNECTION** indicates that a connection to a neighbor node is changed, for example, a node has connected.</span></span>
-   <span data-ttu-id="7c5d8-122">**Одноранговая сеть \_ \_ \_ Поступающие \_ данные события Graph** указывают, что данные были получены от прямого или соседнего соединения.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-122">**PEER\_GRAPH\_EVENT\_INCOMING\_DATA** indicates that data has been received from a direct or neighbor connection.</span></span>
-   <span data-ttu-id="7c5d8-123">**Одноранговая сеть \_ \_ \_ \_ Требуется подключение к событию графа** указывает, что для инфраструктуры диаграмм требуется новое соединение.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-123">**PEER\_GRAPH\_EVENT\_CONNECTION\_REQUIRED** indicates that the Graphing Infrastructure requires a new connection.</span></span>
    > [!Note]  
    > <span data-ttu-id="7c5d8-124">Вызов [**пирграфконнект**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect) подключается к новому узлу.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-124">A call to [**PeerGraphConnect**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect) connects to a new node.</span></span> <span data-ttu-id="7c5d8-125">Вызов [**пирграфжетевентдата**](/windows/desktop/api/P2P/nf-p2p-peergraphgeteventdata) не возвращает данные.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-125">A call to [**PeerGraphGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergraphgeteventdata) does not return data.</span></span>

     

-   <span data-ttu-id="7c5d8-126">**Одноранговая сеть \_ \_ \_ \_ Изменение узла событий Graph** означает, что сведения о присутствии узла изменены, например, изменился IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-126">**PEER\_GRAPH\_EVENT\_NODE\_CHANGED** indicates that node presence information is changed, for example, an IP address has changed.</span></span>
-   <span data-ttu-id="7c5d8-127">**Одноранговая сеть \_ Событие ГРАФа \_ \_ синхронизировано** указывает на то, что конкретный тип записи является синхронизированным.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-127">**PEER\_GRAPH\_EVENT\_SYNCHRONIZED** indicates that a specific record type is synchronized.</span></span>

<span data-ttu-id="7c5d8-128">Когда приложение получает уведомление о возникновении однорангового события, приложение вызывает [**пирграфжетевентдата**](/windows/desktop/api/P2P/nf-p2p-peergraphgeteventdata)и передает маркер однорангового события, возвращенный [**пирграфрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent).</span><span class="sxs-lookup"><span data-stu-id="7c5d8-128">After an application receives notification that a peer event has occurred, the application calls [**PeerGraphGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergraphgeteventdata), and passes the peer event handle returned by [**PeerGraphRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent).</span></span> <span data-ttu-id="7c5d8-129">Одноранговая инфраструктура возвращает указатель на структуру [**\_ \_ \_ данных события однорангового графа**](/windows/desktop/api/P2P/ns-p2p-peer_graph_event_data) , которая содержит запрошенные данные.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-129">The Peer Infrastructure returns a pointer to a [**PEER\_GRAPH\_EVENT\_DATA**](/windows/desktop/api/P2P/ns-p2p-peer_graph_event_data) structure that contains the requested data.</span></span> <span data-ttu-id="7c5d8-130">Эта функция должна вызываться до тех пор, пока не будут возвращены **\_ \_ \_ \_ данные события для однорангового узла** .</span><span class="sxs-lookup"><span data-stu-id="7c5d8-130">This function should be called until **PEER\_S\_NO\_EVENT\_DATA** is returned.</span></span>

<span data-ttu-id="7c5d8-131">После того как приложению не требуется уведомление о событии однорангового узла, приложение вызывает либо [**пирграфунрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergraphunregisterevent), либо передает маркер однорангового события, возвращенный [**пирграфрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent) при регистрации приложения.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-131">After an application does not require a peer event notification, the application calls either [**PeerGraphUnregisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergraphunregisterevent), and passes the peer event handle returned by [**PeerGraphRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent) when the application registered.</span></span>

## <a name="handling-graph-connection-referrals"></a><span data-ttu-id="7c5d8-132">Обработка ссылок на подключения графов</span><span class="sxs-lookup"><span data-stu-id="7c5d8-132">Handling Graph Connection Referrals</span></span>

<span data-ttu-id="7c5d8-133">При вызове [**пирграфконнект**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect) одноранговый узел уведомляется об успешном или неуспешном выполнении через событие **\_ \_ \_ \_ соединения соседа асинхронного однорангового графа** .</span><span class="sxs-lookup"><span data-stu-id="7c5d8-133">When [**PeerGraphConnect**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect) is called, the connecting peer is notified of success or failure through the asynchronous **PEER\_GRAPH\_EVENT\_NEIGHBOR\_CONNECTION** event.</span></span> <span data-ttu-id="7c5d8-134">Если соединение не удалось из-за конкретных проблем с сетью (например, неправильно настроенного брандмауэра), возникает **событие \_ \_ \_ \_ подключения соседа однорангового графа** , при этом состояние подключения установлено в **одноранговое \_ соединение \_ не удалось**.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-134">If the connection failed due to a specific networking issues (such as a misconfigured firewall), the **PEER\_GRAPH\_EVENT\_NEIGHBOR\_CONNECTION** event is raised, with the connection status set to **PEER\_CONNECTION\_FAILED**.</span></span>

<span data-ttu-id="7c5d8-135">Тем не менее, когда одноранговый узел получает ссылку при попытке подключения к занятому узлу, на Соединенном одноранговом узле создается **\_ \_ \_ \_ Подключение к соседнему объекту графа однорангового** узла, при этом состояние подключения установлено в **одноранговое \_ соединение \_**.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-135">However, when a peer receives a referral when it attempts to connect to a busy node, the **PEER\_GRAPH\_EVENT\_NEIGHBOR\_CONNECTION** is raised on the connecting peer, with the connection status set to **PEER\_CONNECTION\_FAILED**.</span></span> <span data-ttu-id="7c5d8-136">Соединительный узел может называться другим узлом, который сам по себе занят и может отправить ссылку, а на подключенном одноранговом узле порождается то же событие и состояние.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-136">The connecting peer may be referred to another node which itself is busy and may send a referral, and the same event and status are raised on the connecting peer.</span></span> <span data-ttu-id="7c5d8-137">Эта цепочка ссылок, приводящая **\_ к \_ ошибкам однорангового подключения** , может продолжаться до тех пор, пока не будет исчерпано максимальное число попыток подключения.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-137">This chain of referrals that result in **PEER\_CONNECTION\_FAILED** event statuses can continue until the maximum number of connection attempts has been exhausted.</span></span> <span data-ttu-id="7c5d8-138">Одноранговый узел не имеет механизма для определения разницы между полной попыткой соединения и ссылкой соединения.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-138">The peer does not have a mechanism to determine the difference between a full connection attempt and the connection referral.</span></span>

<span data-ttu-id="7c5d8-139">Для решения этой проблемы разработчики должны использовать события изменения состояния однорангового графа, чтобы определить, выполнено ли попытка подключения.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-139">To address this issue, developers should consider using the peer graph status change events to determine if the connection attempt suceeded.</span></span> <span data-ttu-id="7c5d8-140">Если событие не получено в течение определенного промежутка времени, приложение может предположить, что подключенный одноранговый узел упоминается и что одноранговое приложение должно считать попытку подключения неудачной.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-140">If the event is not received within a specific amount of time, the application can assume that the connecting peer is being referred and that the peer application should consider the connection attempt a failure.</span></span>

## <a name="peer-grouping-events"></a><span data-ttu-id="7c5d8-141">События группирования одноранговых узлов</span><span class="sxs-lookup"><span data-stu-id="7c5d8-141">Peer Grouping Events</span></span>

<span data-ttu-id="7c5d8-142">Приложение однорангового группирования может зарегистрироваться для получения уведомлений о 8 одноранговых событиях.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-142">A Peer Grouping application can register to receive notification for 8 peer events.</span></span> <span data-ttu-id="7c5d8-143">Каждое имя события предшествует **\_ \_ событию \_ одноранговой группы**, например **\_ \_ \_ \_ изменилось состояние события одноранговой группы**.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-143">Each event name is prefaced with **PEER\_GROUP\_EVENT\_**; for example, **PEER\_GROUP\_EVENT\_STATUS\_CHANGED**.</span></span> <span data-ttu-id="7c5d8-144">Если не указано иное, сведения об изменении извлекаются с помощью [**пирграупжетевентдата**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata).</span><span class="sxs-lookup"><span data-stu-id="7c5d8-144">Unless otherwise noted, information about a change is retrieved by using [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata).</span></span>

-   <span data-ttu-id="7c5d8-145">**Одноранговая сеть \_ \_ \_ \_ Изменение состояния события группы** означает, что состояние группы изменилось.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-145">**PEER\_GROUP\_EVENT\_STATUS\_CHANGED** indicates that the group status has changed.</span></span> <span data-ttu-id="7c5d8-146">Возможны два значения состояния: **\_ \_ \_ Ожидание состояния одноранговой группы**, которое указывает, что группа не имеет соединений и ожидает наличия новых участников; и **состояние одноранговой \_ группы \_ \_ имеет соединения**, что означает, что у группы есть хотя бы одно соединение.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-146">There are two status values possible: **PEER\_GROUP\_STATUS\_LISTENING**, which indicates that the group has no connections and is waiting for new members; and **PEER\_GROUP\_STATUS\_HAS CONNECTIONS**, which indicates that the group has at least one connection.</span></span> <span data-ttu-id="7c5d8-147">Это значение состояния может быть получено путем вызова [**пирграупжетстатус**](/windows/desktop/api/P2P/nf-p2p-peergroupgetstatus) после возникновения этого события.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-147">This status value can be obtained by calling [**PeerGroupGetStatus**](/windows/desktop/api/P2P/nf-p2p-peergroupgetstatus) after this event is raised.</span></span>
-   <span data-ttu-id="7c5d8-148">**Одноранговая сеть \_ \_ \_ \_ Изменение свойства события группы** указывает на то, что свойства группы были изменены или обновлены создателем группы.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-148">**PEER\_GROUP\_EVENT\_PROPERTY\_CHANGED** indicates that the group properties have been changed or updated by the group creator.</span></span>
-   <span data-ttu-id="7c5d8-149">**Одноранговая сеть \_ \_ \_ \_ Изменение записи о событии группы** означает, что была выполнена операция записи.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-149">**PEER\_GROUP\_EVENT\_RECORD\_CHANGED** indicates that a record operation has been performed.</span></span> <span data-ttu-id="7c5d8-150">Это событие возникает, когда одноранговый узел, участвующий в группе, публикует, обновляет или удаляет запись.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-150">This event is raised when a peer participating in the group publishes, updates, or deletes a record.</span></span> <span data-ttu-id="7c5d8-151">Например, это событие возникает, когда приложение разговора отправляет сообщение разговора.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-151">For example, this event is raised when a chat application sends a chat message.</span></span>
-   <span data-ttu-id="7c5d8-152">**Одноранговая сеть \_ \_Член события \_ группы \_ изменился** указывает, что состояние элемента в группе изменилось.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-152">**PEER\_GROUP\_EVENT\_MEMBER\_CHANGED** indicates that a member's status within the group has changed.</span></span> <span data-ttu-id="7c5d8-153">Изменения состояния включают:</span><span class="sxs-lookup"><span data-stu-id="7c5d8-153">Status changes include:</span></span>
    -   <span data-ttu-id="7c5d8-154">**Одноранговая сеть \_ УЧАСТНИК \_ подключен**.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-154">**PEER\_MEMBER\_CONNECTED**.</span></span> <span data-ttu-id="7c5d8-155">Одноранговый узел подключен к группе.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-155">A peer has connected to the group.</span></span>
    -   <span data-ttu-id="7c5d8-156">**Одноранговая сеть \_ ЧЛЕН \_ отключен**.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-156">**PEER\_MEMBER\_DISCONNECTED**.</span></span> <span data-ttu-id="7c5d8-157">Одноранговый узел отключен от группы.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-157">A peer has disconnected from the group.</span></span>
    -   <span data-ttu-id="7c5d8-158">**Одноранговая сеть \_ \_ПРИСОЕДИНЕН участник**.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-158">**PEER\_MEMBER\_JOINED**.</span></span> <span data-ttu-id="7c5d8-159">Сведения о новых членстве опубликованы для однорангового узла.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-159">New membership information has been published for a peer.</span></span>
    -   <span data-ttu-id="7c5d8-160">**Одноранговая сеть \_ ЭЛЕМЕНТ \_ обновлен**.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-160">**PEER\_MEMBER\_UPDATED**.</span></span> <span data-ttu-id="7c5d8-161">Одноранговый узел обновлен новыми данными, например новым IP-адресом.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-161">A peer has updated with new information, such as a new IP address.</span></span>
-   <span data-ttu-id="7c5d8-162">**Одноранговая сеть \_ \_ \_ \_ Подключение к соседнему узлу события группы**.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-162">**PEER\_GROUP\_EVENT\_NEIGHBOR\_CONNECTION**.</span></span> <span data-ttu-id="7c5d8-163">Узлы, которые будут участвовать в подключениях соседей в группе, должны зарегистрироваться для этого события.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-163">Peers who will participate in neighbor connections within the group must register for this event.</span></span> <span data-ttu-id="7c5d8-164">Обратите внимание, что регистрация для этого события не позволяет одноранговому узлу принимать данные. Регистрация для этого события гарантирует получение уведомления только при получении запроса на подключение соседа.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-164">Note that registering for this event does not enable the peer to receive data; registration for this event only ensures notification when a request for a neighbor connection is received.</span></span>
-   <span data-ttu-id="7c5d8-165">**Одноранговая сеть \_ \_ \_ прямое \_ соединение с событием группы**.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-165">**PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION**.</span></span> <span data-ttu-id="7c5d8-166">Узлы, которые будут участвовать в прямых подключениях в группе, должны зарегистрироваться для этого события.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-166">Peers who will participate in direct connections within the group must register for this event.</span></span> <span data-ttu-id="7c5d8-167">Обратите внимание, что регистрация для этого события не позволяет одноранговому узлу принимать данные. Регистрация для этого события гарантирует получение уведомления только при получении запроса на прямое подключение.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-167">Note that registering for this event does not enable the peer to receive data; registration for this event only ensures notification when a request for a direct connection is received.</span></span>
-   <span data-ttu-id="7c5d8-168">**Одноранговая сеть \_ ГРУППИРОВАНие \_ \_ входящих \_ данных событий**.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-168">**PEER\_GROUP\_EVENT\_INCOMING\_DATA**.</span></span> <span data-ttu-id="7c5d8-169">Узлы, которые будут принимать данные через соседа или прямое подключение, должны регистрироваться для этого события.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-169">Peers who will receive data over a neighbor or direct connection must register for this event.</span></span> <span data-ttu-id="7c5d8-170">При возникновении этого события непрозрачные данные, передаваемые другим участвующим одноранговым узлом, могут быть получены путем вызова [**пирграупжетевентдата**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata).</span><span class="sxs-lookup"><span data-stu-id="7c5d8-170">When this event is raised, the opaque data transmitted by the other participating peer can be obtained by calling [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata).</span></span> <span data-ttu-id="7c5d8-171">Обратите внимание, что для получения этого события узел должен быть ранее зарегистрирован для **\_ \_ \_ \_ подключения к соседнему** узлу события **одноранговой \_ группы \_ \_ \_** .</span><span class="sxs-lookup"><span data-stu-id="7c5d8-171">Note that to receive this event, the peer must have previously registered for **PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION** or **PEER\_GROUP\_EVENT\_NEIGHBOR\_CONNECTION**.</span></span>
-   <span data-ttu-id="7c5d8-172">**Одноранговая сеть \_ \_ \_ \_ не удалось установить соединение с событием группы**.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-172">**PEER\_GROUP\_EVENT\_CONNECTION\_FAILED**.</span></span> <span data-ttu-id="7c5d8-173">Не удалось установить соединение по какой-либо причине.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-173">A connection failed for some reason.</span></span> <span data-ttu-id="7c5d8-174">При возникновении этого события данные не предоставляются, и [**пирграупжетевентдата**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata) не должен вызываться.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-174">No data is provided when this event is raised, and [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata) should not be called.</span></span>

<span data-ttu-id="7c5d8-175">Когда приложение получает уведомление о возникновении однорангового события ( **\_ \_ \_ \_ не удалось подключиться к событию одноранговой группы**), приложение вызывает [**пирграупжетевентдата**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata)и передает маркер однорангового события, возвращенный [**пирграупрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span><span class="sxs-lookup"><span data-stu-id="7c5d8-175">After an application receives notification that a peer event has occurred (excluding **PEER\_GROUP\_EVENT\_CONNECTION\_FAILED**), the application calls [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata), and passes the peer event handle returned by [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span></span> <span data-ttu-id="7c5d8-176">Одноранговая инфраструктура возвращает указатель на структуру [**\_ \_ \_ данных события одноранговой группы**](/windows/win32/api/p2p/ns-p2p-peer_group_event_data-r1) , которая содержит запрошенные данные.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-176">The Peer Infrastructure returns a pointer to a [**PEER\_GROUP\_EVENT\_DATA**](/windows/win32/api/p2p/ns-p2p-peer_group_event_data-r1) structure that contains the requested data.</span></span> <span data-ttu-id="7c5d8-177">Эта функция должна вызываться до тех пор, пока не будут возвращены **\_ \_ \_ \_ данные события для однорангового узла** .</span><span class="sxs-lookup"><span data-stu-id="7c5d8-177">This function must be called until **PEER\_S\_NO\_EVENT\_DATA** is returned.</span></span> <span data-ttu-id="7c5d8-178">Если приложению больше не требуется уведомление для однорангового события, необходимо выполнить вызов [**пирграупунрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergroupunregisterevent), передав маркер однорангового события, возвращенный **пирграупрегистеревент** , при регистрации приложения для конкретного события.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-178">When an application no longer requires notification for a peer event, a call must be made to [**PeerGroupUnregisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupunregisterevent), passing the peer event handle returned by **PeerGroupRegisterEvent** when the application registered for the particular event.</span></span>

## <a name="example-of-registering-for-peer-graphing-events"></a><span data-ttu-id="7c5d8-179">Пример регистрации для событий одноранговой диаграммы</span><span class="sxs-lookup"><span data-stu-id="7c5d8-179">Example of Registering for Peer Graphing Events</span></span>

<span data-ttu-id="7c5d8-180">В следующем примере кода показано, как выполнить регистрацию с помощью событий одноранговых диаграмм.</span><span class="sxs-lookup"><span data-stu-id="7c5d8-180">The following code sample shows you how to register with the Peer Graphing events.</span></span>


```C++
//-----------------------------------------------------------------------------
// Function: RegisterForEvents
//
// Purpose:  Registers the EventCallback function so it can be called for only
//           the events that are specified.
//
// Returns:  HRESULT
//
HRESULT RegisterForEvents()
{
    HPEEREVENT  g_hPeerEvent = NULL;        // The one PeerEvent handle
    HANDLE      g_hEvent = NULL;            // Handle signaled by Graphing when we have an event
    HRESULT hr = S_OK;
    PEER_GRAPH_EVENT_REGISTRATION regs[] = {
        { PEER_GRAPH_EVENT_RECORD_CHANGED, 0 },
        { PEER_GRAPH_EVENT_NODE_CHANGED,   0 },
        { PEER_GRAPH_EVENT_STATUS_CHANGED, 0 },
        { PEER_GRAPH_EVENT_DIRECT_CONNECTION, 0 },
        { PEER_GRAPH_EVENT_INCOMING_DATA, 0 },
    };

    g_hEvent = CreateEvent(NULL, FALSE, FALSE, NULL);
    if (g_hEvent == NULL)
    {
        wprintf(L"CreateEvent call failed.\n");
        hr = E_OUTOFMEMORY;
    }
    else
    {
        hr = PeerGraphRegisterEvent(g_hGraph, g_hEvent, celems(regs), regs,  &g_hPeerEvent);
        if (FAILED(hr))
        {
           wprintf(L"PeerGraphRegisterEvent call failed.\n");
            CloseHandle(g_hEvent);
            g_hEvent = NULL;
        }
    }

    if (SUCCEEDED(hr))
    {
        if (!RegisterWaitForSingleObject(&g_hWait, g_hEvent, EventCallback, NULL, INFINITE, WT_EXECUTEDEFAULT))
        {
            hr = HRESULT_FROM_WIN32(GetLastError());
            wprintf(L"Could not set up event callback.\n");
            CloseHandle(g_hEvent);
            g_hEvent = NULL;
        }
    }

    return hr;
}
```



 

 



