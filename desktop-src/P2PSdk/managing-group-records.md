---
description: Запись группы — это конкретные данные, опубликованные для всех активных участников одноранговой группы, например сообщение разговора или обновление состояния, относящееся к приложению.
ms.assetid: 073ee4e9-0e97-451a-a808-8265575d073c
title: Управление записями групп
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3b6d9e3257cc597b715dc9c65eb5945c00c15286
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105663322"
---
# <a name="managing-group-records"></a><span data-ttu-id="247df-103">Управление записями групп</span><span class="sxs-lookup"><span data-stu-id="247df-103">Managing Group Records</span></span>

<span data-ttu-id="247df-104">Запись группы — это конкретные данные, опубликованные для всех активных участников одноранговой группы, например сообщение разговора или обновление состояния, относящееся к приложению.</span><span class="sxs-lookup"><span data-stu-id="247df-104">A group record is specific data published to all active members of a peer group, for example, a chat message or an application-specific status update.</span></span> <span data-ttu-id="247df-105">Запись представляется структурой [**одноранговой \_ записи**](/windows/desktop/api/P2P/ns-p2p-peer_record) и содержит следующие сведения о одноранговом узле:</span><span class="sxs-lookup"><span data-stu-id="247df-105">A record is represented by the [**PEER\_RECORD**](/windows/desktop/api/P2P/ns-p2p-peer_record) structure, and contains the following information about a peer:</span></span>

-   <span data-ttu-id="247df-106">Идентификатор записи — это значение, уникально идентифицирующее запись в одноранговой группе.</span><span class="sxs-lookup"><span data-stu-id="247df-106">The record ID is a value that uniquely identifies a record in the peer group.</span></span>
-   <span data-ttu-id="247df-107">Идентификатор GUID, указывающий тип записи.</span><span class="sxs-lookup"><span data-stu-id="247df-107">A GUID that specifies the record type.</span></span> <span data-ttu-id="247df-108">Приложения могут поддерживать различные типы записей.</span><span class="sxs-lookup"><span data-stu-id="247df-108">Applications can support different record types.</span></span> <span data-ttu-id="247df-109">Приложение интерпретирует поле **данных** записи на основе типа записи.</span><span class="sxs-lookup"><span data-stu-id="247df-109">An application interprets the **data** field of a record based on the record type.</span></span> <span data-ttu-id="247df-110">Некоторые идентификаторы GUID зарезервированы, и вызов API **возвращает \_ \_ \_ несанкционированный доступ к узлу E** , когда приложение пытается их использовать.</span><span class="sxs-lookup"><span data-stu-id="247df-110">Some GUIDs are reserved, and the API call returns **PEER\_E\_NOT\_AUTHORIZED** when the application attempts to use them.</span></span>
-   <span data-ttu-id="247df-111">Набор атрибутов записи, описанных в виде XML-строки.</span><span class="sxs-lookup"><span data-stu-id="247df-111">A set of record attributes described as an XML string.</span></span> <span data-ttu-id="247df-112">Атрибуты используются при поиске записей.</span><span class="sxs-lookup"><span data-stu-id="247df-112">The attributes are used when searching records.</span></span> <span data-ttu-id="247df-113">Дополнительные сведения об атрибутах см. в разделе [запись атрибута Schema](record-attribute-schema.md).</span><span class="sxs-lookup"><span data-stu-id="247df-113">For more information about attributes, see [Record Attribute Schema](record-attribute-schema.md).</span></span>
-   <span data-ttu-id="247df-114">Одноранговый момент создания записи.</span><span class="sxs-lookup"><span data-stu-id="247df-114">The peer time that a record is created.</span></span>
-   <span data-ttu-id="247df-115">Время на одноранговом уровне, в течение которого срок действия записи истекает.</span><span class="sxs-lookup"><span data-stu-id="247df-115">The peer time that a record expires.</span></span>
-   <span data-ttu-id="247df-116">Время на одноранговом уровне, в которое изменяется запись.</span><span class="sxs-lookup"><span data-stu-id="247df-116">The peer time that a record is modified.</span></span>
-   <span data-ttu-id="247df-117">Создатель записи.</span><span class="sxs-lookup"><span data-stu-id="247df-117">The creator of a record.</span></span>
-   <span data-ttu-id="247df-118">Член, который изменяет запись.</span><span class="sxs-lookup"><span data-stu-id="247df-118">The member who modifies a record.</span></span>
-   <span data-ttu-id="247df-119">Структура [**\_ данных однорангового узла**](/windows/desktop/api/P2P/ns-p2p-peer_data) , содержащая криптографическую подпись для всех полей в этой структуре [**одноранговой \_ записи**](/windows/desktop/api/P2P/ns-p2p-peer_record) .</span><span class="sxs-lookup"><span data-stu-id="247df-119">A [**PEER\_DATA**](/windows/desktop/api/P2P/ns-p2p-peer_data) structure that contains the cryptographic signature for all of the fields in this [**PEER\_RECORD**](/windows/desktop/api/P2P/ns-p2p-peer_record) structure.</span></span> <span data-ttu-id="247df-120">Это поле нельзя обновить напрямую или изменить с помощью однорангового узла.</span><span class="sxs-lookup"><span data-stu-id="247df-120">This field cannot be directly updated or altered by a peer.</span></span>
-   <span data-ttu-id="247df-121">Структура [**\_ данных однорангового узла**](/windows/desktop/api/P2P/ns-p2p-peer_data) , содержащая данные приложения, связанные с этой записью, в виде массива байтов.</span><span class="sxs-lookup"><span data-stu-id="247df-121">A [**PEER\_DATA**](/windows/desktop/api/P2P/ns-p2p-peer_data) structure that contains the application-specific data associated with this record as an array of bytes.</span></span> <span data-ttu-id="247df-122">Тип данных, имеющихся в этом поле, определяется определяемым приложением типом записи.</span><span class="sxs-lookup"><span data-stu-id="247df-122">The type of data present in this field is determined by application-defined record type.</span></span>

## <a name="obtaining-peer-group-records"></a><span data-ttu-id="247df-123">Получение записей одноранговых групп</span><span class="sxs-lookup"><span data-stu-id="247df-123">Obtaining Peer Group Records</span></span>

<span data-ttu-id="247df-124">Отдельные записи получаются путем вызова [**пирграупжетрекорд**](/windows/desktop/api/P2P/nf-p2p-peergroupgetrecord) с идентификатором записи.</span><span class="sxs-lookup"><span data-stu-id="247df-124">Individual records are obtained by calling [**PeerGroupGetRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupgetrecord) with the ID of the record.</span></span> <span data-ttu-id="247df-125">При обработке всех записей определенного типа перечислимый набор всех текущих записей одноранговых групп получается путем первого вызова [**пирграупенумрекордс**](/windows/desktop/api/P2P/nf-p2p-peergroupenumrecords) для открытия перечисления и последовательного вызова [**пиржетнекститем**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem) до получения всех записей.</span><span class="sxs-lookup"><span data-stu-id="247df-125">When processing all records of a specific type, the enumerated set of all current peer group records is obtained by first calling [**PeerGroupEnumRecords**](/windows/desktop/api/P2P/nf-p2p-peergroupenumrecords) to open the enumeration and then iteratively calling [**PeerGetNextItem**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem) until all records are retrieved.</span></span> <span data-ttu-id="247df-126">По завершении закройте перечисление и освободите память, связанную с ней, вызвав [**пиренденумератион**](/windows/desktop/api/P2P/nf-p2p-peerendenumeration).</span><span class="sxs-lookup"><span data-stu-id="247df-126">When finished, close the enumeration and release the memory associated with it by calling [**PeerEndEnumeration**](/windows/desktop/api/P2P/nf-p2p-peerendenumeration).</span></span>

<span data-ttu-id="247df-127">Когда запись создается, удаляется или обновляется одноранговым узлом, затронутая запись публикуется во всех членах одноранговой группы посредством события **\_ \_ \_ \_ изменения записи события одноранговой группы** .</span><span class="sxs-lookup"><span data-stu-id="247df-127">When a record is created, deleted, or updated by a peer, the affected record is published to all members of the peer group by way of the **PEER\_GROUP\_EVENT\_RECORD\_CHANGE** event.</span></span> <span data-ttu-id="247df-128">Обратите внимание, что если одноранговый узел не подключен к группе, он получит обновленную запись, а затем подключится к ней позже.</span><span class="sxs-lookup"><span data-stu-id="247df-128">Note that if a peer is not connected to the group, it will receive the updated record then next time it connects.</span></span> <span data-ttu-id="247df-129">Важно зарегистрировать это событие с помощью [**пирграупрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent) , если ваше приложение обслуживает и управляет записями любым осмысленным способом.</span><span class="sxs-lookup"><span data-stu-id="247df-129">It is important to register for this event with [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent) if your application maintains or manages records in any meaningful way.</span></span> <span data-ttu-id="247df-130">Кроме того, приложение может запрашивать базу данных записей по запросу с помощью [**пирграупсеарчрекордс**](/windows/desktop/api/P2P/nf-p2p-peergroupsearchrecords).</span><span class="sxs-lookup"><span data-stu-id="247df-130">Alternatively, the application can query the record database on demand using [**PeerGroupSearchRecords**](/windows/desktop/api/P2P/nf-p2p-peergroupsearchrecords).</span></span>

<span data-ttu-id="247df-131">При возникновении события **\_ \_ \_ \_ изменения записи о событии одноранговой группы** конкретный идентификатор и тип записи, а также тип изменения (Добавление, обновление, удаление) получаются в виде структуры [**данных однорангового \_ \_ \_ изменения \_ записей событий**](/windows/desktop/api/P2P/ns-p2p-peer_event_record_change_data) .</span><span class="sxs-lookup"><span data-stu-id="247df-131">When the **PEER\_GROUP\_EVENT\_RECORD\_CHANGE** event is raised, the specific record ID and type as well as the type of change (add, update, delete) is received as a [**PEER\_EVENT\_RECORD\_CHANGE\_DATA**](/windows/desktop/api/P2P/ns-p2p-peer_event_record_change_data) structure.</span></span> <span data-ttu-id="247df-132">Эта структура получается с помощью вызова [**пирграупжетевентдата**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata).</span><span class="sxs-lookup"><span data-stu-id="247df-132">This structure is obtained with a call to [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata).</span></span> <span data-ttu-id="247df-133">Если изменение является добавлением или обновлением, следует использовать [**пирграупжетрекорд**](/windows/desktop/api/P2P/nf-p2p-peergroupgetrecord) для получения записи с ПРЕДОСТАВЛЕНным идентификатором.</span><span class="sxs-lookup"><span data-stu-id="247df-133">If the change is an add or an update, you should use [**PeerGroupGetRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupgetrecord) to obtain the record with the supplied ID.</span></span> <span data-ttu-id="247df-134">Локальная база данных записей для инфраструктуры обновляется автоматически.</span><span class="sxs-lookup"><span data-stu-id="247df-134">The local record database for the infrastructure is updated automatically.</span></span>

<span data-ttu-id="247df-135">Можно также выполнить поиск определенных записей на основе определенных пользовательских атрибутов, предоставляемых в поле **пвзаттрибутес** [**одноранговой \_ записи**](/windows/desktop/api/P2P/ns-p2p-peer_record), а также всех предопределенных атрибутов.</span><span class="sxs-lookup"><span data-stu-id="247df-135">You can also search for specific records based on specific custom attributes supplied in the **pwzAttributes** field of [**PEER\_RECORD**](/windows/desktop/api/P2P/ns-p2p-peer_record), as well as any predefined attributes.</span></span> <span data-ttu-id="247df-136">Для этого используйте функцию [**пирграупсеарчрекордс**](/windows/desktop/api/P2P/nf-p2p-peergroupsearchrecords) с XML-запросом поиска в формате, указанном в разделе [Формат запроса поиска записей](record-search-query-format.md) .</span><span class="sxs-lookup"><span data-stu-id="247df-136">To accomplish this, use the [**PeerGroupSearchRecords**](/windows/desktop/api/P2P/nf-p2p-peergroupsearchrecords) function with an XML search query formatted as specified in the [Record Search Query Format](record-search-query-format.md) topic.</span></span>

<span data-ttu-id="247df-137">Дополнительные сведения о работе с записями в одноранговой инфраструктуре см. в разделе " [записи](records.md) " статьи [использование одноранговой инфраструктуры](using-the-peer-infrastructure.md).</span><span class="sxs-lookup"><span data-stu-id="247df-137">For more details on working with records in the Peer Infrastructure, please refer to the [Records](records.md) topic in [Using the Peer Infrastructure](using-the-peer-infrastructure.md).</span></span>

## <a name="administration-of-peer-group-records"></a><span data-ttu-id="247df-138">Администрирование записей одноранговых групп</span><span class="sxs-lookup"><span data-stu-id="247df-138">Administration of Peer Group Records</span></span>

<span data-ttu-id="247df-139">Когда начальные приглашения выдаются создателем одноранговой группы, он может указать, что определенные члены будут обслуживать роль администратора (администратор роли одноранговой \_ группы \_ \_ ) при выдаче новых учетных данных пользователю (через [**пирграупкреатеинвитатион**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) или [**пирграуписсуекредентиалс**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials)).</span><span class="sxs-lookup"><span data-stu-id="247df-139">When the initial invitations are issued by the peer group's creator, it can specify that certain members serve in an administrative role (PEER\_GROUP\_ROLE\_ADMIN) whenever it issues new credentials to the user (via either [**PeerGroupCreateInvitation**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) or [**PeerGroupIssueCredentials**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials)).</span></span> <span data-ttu-id="247df-140">Администратор может непосредственно добавлять, удалять и обновлять любые записи одноранговых групп.</span><span class="sxs-lookup"><span data-stu-id="247df-140">An administrator has the ability to directly add, delete, and update any peer group records.</span></span> <span data-ttu-id="247df-141">И наоборот, член одноранговой группы, которому назначена роль **\_ \_ роли \_** одноранговой группы или участника роли **одноранговой \_ группы \_ \_ \_** , может добавлять, обновлять и удалять собственные записи.</span><span class="sxs-lookup"><span data-stu-id="247df-141">Conversely, a peer group member with it's role set to either **PEER\_GROUP\_ROLE\_MEMBER** or **PEER\_GROUP\_ROLE\_INVITING\_MEMBER** can only add, update, and delete its own record(s).</span></span>

<span data-ttu-id="247df-142">Создатель имеет роль администратора по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="247df-142">The creator has the administrator role by default.</span></span>

<span data-ttu-id="247df-143">Чтобы обновить запись, получите запись с помощью [**пирграупжетрекорд**](/windows/desktop/api/P2P/nf-p2p-peergroupgetrecord) или [**пирграупенумрекордс**](/windows/desktop/api/P2P/nf-p2p-peergroupenumrecords), внесите изменения и передайте обновленную запись в [**пирграупупдатерекорд**](/windows/desktop/api/P2P/nf-p2p-peergroupupdaterecord).</span><span class="sxs-lookup"><span data-stu-id="247df-143">To update a record, obtain the record with [**PeerGroupGetRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupgetrecord) or [**PeerGroupEnumRecords**](/windows/desktop/api/P2P/nf-p2p-peergroupenumrecords), make the changes, and pass the updated record to [**PeerGroupUpdateRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupupdaterecord).</span></span>

<span data-ttu-id="247df-144">Чтобы удалить запись, передайте идентификатор записи для удаления в [**пирграупделетерекорд**](/windows/desktop/api/P2P/nf-p2p-peergroupdeleterecord).</span><span class="sxs-lookup"><span data-stu-id="247df-144">To delete a record, pass the record ID to delete to [**PeerGroupDeleteRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupdeleterecord).</span></span>

<span data-ttu-id="247df-145">Чтобы добавить запись, создайте новую структуру [**одноранговой \_ записи**](/windows/desktop/api/P2P/ns-p2p-peer_record) и заполните следующие поля:</span><span class="sxs-lookup"><span data-stu-id="247df-145">To add a record, create a new [**PEER\_RECORD**](/windows/desktop/api/P2P/ns-p2p-peer_record) structure and populate the following fields:</span></span>

-   <span data-ttu-id="247df-146">**двсизе**.</span><span class="sxs-lookup"><span data-stu-id="247df-146">**dwSize**.</span></span> <span data-ttu-id="247df-147">Это поле содержит значение **sizeof**([**одноранговая \_ запись**](/windows/desktop/api/P2P/ns-p2p-peer_record)).</span><span class="sxs-lookup"><span data-stu-id="247df-147">This field contains the value of **sizeof**([**PEER\_RECORD**](/windows/desktop/api/P2P/ns-p2p-peer_record)).</span></span>
-   <span data-ttu-id="247df-148">**фтекспиратион**.</span><span class="sxs-lookup"><span data-stu-id="247df-148">**ftExpiration**.</span></span> <span data-ttu-id="247df-149">Это поле содержит дату и время истечения срока действия записи, выраженное во время пиринга в виде структуры **fileTime** .</span><span class="sxs-lookup"><span data-stu-id="247df-149">This field contains the expiration date and time of this record, expressed in peer time as a **FILETIME** structure.</span></span>
-   <span data-ttu-id="247df-150">**введите**.</span><span class="sxs-lookup"><span data-stu-id="247df-150">**type**.</span></span> <span data-ttu-id="247df-151">Это поле содержит значение **идентификатора GUID** , определяющее тип записи для приложения.</span><span class="sxs-lookup"><span data-stu-id="247df-151">This field contains a **GUID** value that identifies the record type to the application.</span></span> <span data-ttu-id="247df-152">Если этот тип является настраиваемым для инфраструктуры приложений, необходимо также заполнить поле **данных** .</span><span class="sxs-lookup"><span data-stu-id="247df-152">If this type is custom to your application infrastructure, you should also populate the **data** field.</span></span>

<span data-ttu-id="247df-153">Следующие поля заполняются инфраструктурой и будут игнорироваться, если они заданы приложением:</span><span class="sxs-lookup"><span data-stu-id="247df-153">The following fields are populated by the infrastructure, and will be ignored if set by the application:</span></span>

-   <span data-ttu-id="247df-154">**id**</span><span class="sxs-lookup"><span data-stu-id="247df-154">**id**</span></span>
-   <span data-ttu-id="247df-155">**пвзкреаторид**</span><span class="sxs-lookup"><span data-stu-id="247df-155">**pwzCreatorId**</span></span>
-   <span data-ttu-id="247df-156">**пвзластмодифиедбид**</span><span class="sxs-lookup"><span data-stu-id="247df-156">**pwzLastModifiedById**</span></span>
-   <span data-ttu-id="247df-157">**фткреатион**</span><span class="sxs-lookup"><span data-stu-id="247df-157">**ftCreation**</span></span>
-   <span data-ttu-id="247df-158">**фтластмодифиед**</span><span class="sxs-lookup"><span data-stu-id="247df-158">**ftLastModified**</span></span>
-   <span data-ttu-id="247df-159">**секуритидата**</span><span class="sxs-lookup"><span data-stu-id="247df-159">**securityData**</span></span>

<span data-ttu-id="247df-160">Остальные поля являются необязательными.</span><span class="sxs-lookup"><span data-stu-id="247df-160">The remaining fields are optional.</span></span> <span data-ttu-id="247df-161">Чтобы добавить эту новую запись в одноранговую группу, передайте ее в [**пирграупаддрекорд**](/windows/desktop/api/P2P/nf-p2p-peergroupaddrecord).</span><span class="sxs-lookup"><span data-stu-id="247df-161">To add this new record to the peer group, pass it to [**PeerGroupAddRecord**](/windows/desktop/api/P2P/nf-p2p-peergroupaddrecord).</span></span>

## <a name="importing-and-exporting-records"></a><span data-ttu-id="247df-162">Импорт и экспорт записей</span><span class="sxs-lookup"><span data-stu-id="247df-162">Importing and Exporting Records</span></span>

<span data-ttu-id="247df-163">Записи одноранговых групп обслуживаются локально в качестве базы данных.</span><span class="sxs-lookup"><span data-stu-id="247df-163">Peer-to-peer group records are maintained locally as a database.</span></span> <span data-ttu-id="247df-164">Чтобы сохранить текущий моментальный снимок базы данных записи одноранговой группы в локальном файле, вызовите [**пирграупекспортдатабасе**](/windows/desktop/api/P2P/nf-p2p-peergroupexportdatabase)и передайте ему маркер в одноранговую группу.</span><span class="sxs-lookup"><span data-stu-id="247df-164">To save a current snapshot of the peer group record database to a local file, call [**PeerGroupExportDatabase**](/windows/desktop/api/P2P/nf-p2p-peergroupexportdatabase), and pass it the handle to the peer group.</span></span> <span data-ttu-id="247df-165">Затем этот файл можно перенести на другой компьютер или приложение, что может извлекать и использовать эту базу данных записи путем вызова [**пирграупимпортдатабасе**](/windows/desktop/api/P2P/nf-p2p-peergroupimportdatabase).</span><span class="sxs-lookup"><span data-stu-id="247df-165">This file can then be transported to a different computer or application, which can extract and use this record database by calling [**PeerGroupImportDatabase**](/windows/desktop/api/P2P/nf-p2p-peergroupimportdatabase).</span></span>

 

 



