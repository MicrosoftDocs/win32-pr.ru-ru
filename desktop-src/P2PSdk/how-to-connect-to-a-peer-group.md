---
description: В этом разделе описывается, как приложение подключается к одноранговой группе с помощью интерфейсов API группирования одноранговых узлов.
ms.assetid: 56fa28d8-3b3a-4cd5-8448-c8c4ce8d0b2c
title: Подключение к одноранговой группе
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d5bb3f41342573742e634a6e7ebce283188f3ffd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105663333"
---
# <a name="how-to-connect-to-a-peer-group"></a><span data-ttu-id="a8629-103">Подключение к одноранговой группе</span><span class="sxs-lookup"><span data-stu-id="a8629-103">How to Connect to a Peer Group</span></span>

<span data-ttu-id="a8629-104">В этом разделе описывается, как приложение подключается к одноранговой группе с помощью интерфейсов API группирования одноранговых узлов.</span><span class="sxs-lookup"><span data-stu-id="a8629-104">This topic discusses how an application connects to a peer group using the Peer Grouping APIs.</span></span>

## <a name="joining-a-peer-group"></a><span data-ttu-id="a8629-105">Присоединение к одноранговой группе</span><span class="sxs-lookup"><span data-stu-id="a8629-105">Joining a Peer Group</span></span>

<span data-ttu-id="a8629-106">Чтобы присоединить одноранговую группу, вызовите [**пирграупжоин**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin), передав имя удостоверения однорангового узла и приглашения (а также необязательное имя облака PNRP, если имя облака в приглашении неоднозначно).</span><span class="sxs-lookup"><span data-stu-id="a8629-106">To join a peer group, call [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin), passing in the identity name of the peer and the invitation (and an optional PNRP cloud name, if the cloud name in the invitation is ambiguous).</span></span>

<span data-ttu-id="a8629-107">В случае успеха [**пирграупжоин**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) возвращает маркер одноранговой группы.</span><span class="sxs-lookup"><span data-stu-id="a8629-107">If successful, [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) returns a handle to the peer group.</span></span>

<span data-ttu-id="a8629-108">Если узел ранее присоединился к одноранговой группе, а затем закрыл его, то одноранговую группу следует повторно открыть, вызвав [**пирграупопен**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) и передав имя одноранговой группы.</span><span class="sxs-lookup"><span data-stu-id="a8629-108">If the peer has previously joined the peer group and then closed the handle, the peer group should be reopened by calling [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) and passing in the name of the peer group.</span></span> <span data-ttu-id="a8629-109">Этот вызов возвращает новый маркер одноранговой группы.</span><span class="sxs-lookup"><span data-stu-id="a8629-109">This call returns a new peer group handle.</span></span>

<span data-ttu-id="a8629-110">После успешного присоединения одноранговой группы одноранговый узел может подключиться непосредственно к одноранговой группе и начать взаимодействие, вызвав [**пирграупконнект**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span><span class="sxs-lookup"><span data-stu-id="a8629-110">Once the peer group is successfully joined, the peer may connect directly to the peer group and begin interacting by calling [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span></span> <span data-ttu-id="a8629-111">После подключения узел считается подключенным к сети.</span><span class="sxs-lookup"><span data-stu-id="a8629-111">After connecting, the peer is considered to be "online".</span></span>

<span data-ttu-id="a8629-112">Если приложение не будет взаимодействовать с группой в это время, оно может остаться в автономном режиме.</span><span class="sxs-lookup"><span data-stu-id="a8629-112">If an application will not interact with the group at the time, it can remain "offline".</span></span> <span data-ttu-id="a8629-113">Если он принимает участие непосредственно в одноранговой группе на последующем экземпляре, последующий вызов [**пирграупконнект**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) переводит его в режим «в сети».</span><span class="sxs-lookup"><span data-stu-id="a8629-113">If it chooses to participate directly in the peer group at a later instance, a subsequent call to [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) will bring it online.</span></span> <span data-ttu-id="a8629-114">После того как одноранговая группа присоединилась к одноранговой группе, она должна подключаться по крайней мере один раз, прежде чем она сможет публиковать записи в одноранговой группе.</span><span class="sxs-lookup"><span data-stu-id="a8629-114">After a peer has joined the peer group, it must connect at least once before it will be able to publish records to the peer group.</span></span>

## <a name="opening-a-peer-group-without-connecting-offline"></a><span data-ttu-id="a8629-115">Открытие одноранговой группы без подключения (вне сети)</span><span class="sxs-lookup"><span data-stu-id="a8629-115">Opening a Peer Group Without Connecting (Offline)</span></span>

<span data-ttu-id="a8629-116">Часто может потребоваться, чтобы приложение подключаться к одноранговой группе, но не участвовало в нем напрямую, получать и публиковать обновления записей, но не отправлять и не получать сообщения данных.</span><span class="sxs-lookup"><span data-stu-id="a8629-116">Often, you may wish to have an application connect to a peer group but not directly participate it, receiving and publishing record updates but not sending or receiving data messages.</span></span> <span data-ttu-id="a8629-117">Приложение находится в состоянии "вне сети" сразу после вызова [**пирграупкреате**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate), [**пирграупжоин**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin)или [**пирграупопен**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) .</span><span class="sxs-lookup"><span data-stu-id="a8629-117">An application is in this "offline" state immediately after [**PeerGroupCreate**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate), [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin), or [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) have been called.</span></span>

<span data-ttu-id="a8629-118">Автономное приложение может подключиться к сети в любое время, вызвав [**пирграупконнект**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span><span class="sxs-lookup"><span data-stu-id="a8629-118">An offline application can go online at any time by calling [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span></span> <span data-ttu-id="a8629-119">После подключения одноранговая группа не может переключиться в автономный режим, пока все другие приложения, связанные с этим удостоверением и совместно с этой группой, также не будут закрыты.</span><span class="sxs-lookup"><span data-stu-id="a8629-119">Once connected, a peer group cannot go offline until all other applications associated with this identity and sharing this group have closed connections to it as well.</span></span>

<span data-ttu-id="a8629-120">Одноранговая группа — это общий ресурс с той же одноранговой группой, доступной для нескольких приложений.</span><span class="sxs-lookup"><span data-stu-id="a8629-120">A peer group is a shared resource, with the same peer group available to multiple applications.</span></span> <span data-ttu-id="a8629-121">Если несколько приложений для одного и того же удостоверения и пользователя Windows используют одну и ту же одноранговую группу, они также используют одну и ту же основную базу данных и соединения (соседа и Direct).</span><span class="sxs-lookup"><span data-stu-id="a8629-121">If more than one application for the same identity and Windows user is using the same peer group, they also share the same underlying database and connections (neighbor and direct).</span></span> <span data-ttu-id="a8629-122">Если какое-либо из этих приложений вызывает [**пирграупконнект**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect), все другие приложения для этого удостоверения или пользователя, участвующего в группе, также подключаются к группе.</span><span class="sxs-lookup"><span data-stu-id="a8629-122">If any one of these applications calls [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect), all of the other applications for this identity/user participating in the group also connect to the group.</span></span> <span data-ttu-id="a8629-123">Если запись добавляется одним приложением, когда группа находится в автономном режиме, другие приложения также смогут ее увидеть.</span><span class="sxs-lookup"><span data-stu-id="a8629-123">If a record is added by one application while the group is offline, other applications are also be able to see it.</span></span> <span data-ttu-id="a8629-124">В результате приложение должно быть готово к подключению к сети в любое время.</span><span class="sxs-lookup"><span data-stu-id="a8629-124">As a result, an application must be ready to go online at any time.</span></span>

## <a name="connecting-to-a-peer-group-online"></a><span data-ttu-id="a8629-125">Подключение к одноранговой группе (в сети)</span><span class="sxs-lookup"><span data-stu-id="a8629-125">Connecting to a Peer Group (Online)</span></span>

<span data-ttu-id="a8629-126">Чтобы приступить к участию в группе, вызовите [**пирграупконнект**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) после создания, присоединения или открытия группы.</span><span class="sxs-lookup"><span data-stu-id="a8629-126">To begin participating in a group, call [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) after creating, joining, or opening the group.</span></span> <span data-ttu-id="a8629-127">В этом состоянии прямые подключения можно открыть с другими одноранговыми узлами, участвующими в той же группе, вызвав [**пирграупопендиректконнектион**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection).</span><span class="sxs-lookup"><span data-stu-id="a8629-127">In this state, direct connections can be opened with other peers participating in the same group by calling [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection).</span></span>

<span data-ttu-id="a8629-128">Чтобы определить, не завершилась ли попытка соединения, зарегистрируйте \_ \_ \_ событие сбоя подключения к СОбытию одноранговой группы \_ .</span><span class="sxs-lookup"><span data-stu-id="a8629-128">To detect if a connection attempt has failed, register for the PEER\_GROUP\_EVENT\_CONNECTION\_FAILED event.</span></span> <span data-ttu-id="a8629-129">Это событие возникает, если инфраструктуре группирования не удается найти другой член, к которому необходимо подключиться, или если происходит сбой соединения перед синхронизацией базы данных группы и не удается установить другое соединение.</span><span class="sxs-lookup"><span data-stu-id="a8629-129">This event is raised if the grouping infrastructure cannot find another member to connect to, or if the connection fails before the group database is synchronized and another connection cannot be established.</span></span>

<span data-ttu-id="a8629-130">Хотя несколько приложений, которые выполняются на одноранговом узле и участвуют в одной группе с одним и тем же идентификатором однорангового узла, могут находиться вне сети, вызов [**пирграупконнект**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) в любом из приложений приводит к тому, что все приложения становятся в сети.</span><span class="sxs-lookup"><span data-stu-id="a8629-130">Although multiple applications executing on the peer and participating in the same group with the same peer identity may be offline, a call to [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) by any one of the applications results in all of the applications becoming online.</span></span>

<span data-ttu-id="a8629-131">Кроме того, если одно приложение на одноранговом узле подключено к группе, все другие приложения, вызывающие [**пирграупжоин**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) или [**пирграупопен**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) , также будут немедленно подключены.</span><span class="sxs-lookup"><span data-stu-id="a8629-131">Also, if one application on the peer has connected to the group, any other applications that call [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) or [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) are immediately connected as well.</span></span> <span data-ttu-id="a8629-132">Если приложение вызывает [**пирграупклосе**](/windows/desktop/api/P2P/nf-p2p-peergroupclose), обработчик закрывается только для этого приложения.</span><span class="sxs-lookup"><span data-stu-id="a8629-132">If an application calls [**PeerGroupClose**](/windows/desktop/api/P2P/nf-p2p-peergroupclose), the handle is closed for only that application.</span></span> <span data-ttu-id="a8629-133">Таким же последующий вызов **пирграупопен** приложением возвращает новый маркер группы, и приложение немедленно переводится в режим «в сети», если другие приложения, участвующие в той же группе, все еще подключены.</span><span class="sxs-lookup"><span data-stu-id="a8629-133">Thus, a subsequent call to **PeerGroupOpen** by the application returns a new group handle, and the application is brought online immediately if any other applications participating in the same group are still connected.</span></span>

## <a name="sending-and-receiving-data"></a><span data-ttu-id="a8629-134">Отправка и получение данных</span><span class="sxs-lookup"><span data-stu-id="a8629-134">Sending and Receiving Data</span></span>

<span data-ttu-id="a8629-135">Для отправки и получения данных между конкретными узлами участника в группе необходимо установить прямые соединения с теми членами, с которыми планируется взаимодействовать.</span><span class="sxs-lookup"><span data-stu-id="a8629-135">To send and receive data between specific member nodes in the group, direct connections must be established with those members you intend to interact with.</span></span> <span data-ttu-id="a8629-136">Установление прямого подключения является асинхронным вызовом [**пирграупопендиректконнектион**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection), передачей маркера для подключенной группы, а также идентификатором однорангового узла в группе, к которой вы хотите подключиться.</span><span class="sxs-lookup"><span data-stu-id="a8629-136">Establishing a direct connection is an asynchronous call to [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection), passing in the handle for a connected group as well as the identity of the peer within the group you wish to connect to.</span></span> <span data-ttu-id="a8629-137">Этот метод возвращает идентификатор соединения.</span><span class="sxs-lookup"><span data-stu-id="a8629-137">This method will return a connection ID.</span></span> <span data-ttu-id="a8629-138">Если вызов выполнен успешно, \_ \_ \_ \_ на одноранговом узле вызывается событие прямого подключения одноранговой группы, проверяющее идентификатор подключения.</span><span class="sxs-lookup"><span data-stu-id="a8629-138">If the call is successful, a PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION event is raised on the peer, validating the connection ID.</span></span>

<span data-ttu-id="a8629-139">Чтобы получить прямые подключения от других одноранговых узлов, зарегистрируйте событие прямого соединения для одноранговой \_ группы \_ с помощью \_ \_ вызова [**пирграупрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span><span class="sxs-lookup"><span data-stu-id="a8629-139">To receive direct connections from other online peers, register for the PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION event with a call to [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span></span>

<span data-ttu-id="a8629-140">После успешной установки прямого подключения приложение может начать отправку данных с помощью вызовов [**пирграупсенддата**](/windows/desktop/api/P2P/nf-p2p-peergroupsenddata), передав допустимый идентификатор соединения.</span><span class="sxs-lookup"><span data-stu-id="a8629-140">Once a direct connection has been successfully established, the application can begin sending data with calls to [**PeerGroupSendData**](/windows/desktop/api/P2P/nf-p2p-peergroupsenddata), passing the valid connection ID.</span></span> <span data-ttu-id="a8629-141">Порядок передачи многокомпонентных данных обрабатывается **пирграупсенддата**.</span><span class="sxs-lookup"><span data-stu-id="a8629-141">The ordering of multipart data transmissions is handled by **PeerGroupSendData**.</span></span> <span data-ttu-id="a8629-142">Однако приложения должны реализовать правильный стек протокола для обработки непрозрачных данных, возвращаемых этим вызовом API.</span><span class="sxs-lookup"><span data-stu-id="a8629-142">However, applications should implement a proper protocol stack for handling the opaque data returned by this API call.</span></span>

<span data-ttu-id="a8629-143">Чтобы получить данные через прямое соединение, приложение должно зарегистрироваться для \_ \_ события входящих данных события одноранговой группы \_ \_ с помощью [**пирграупрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span><span class="sxs-lookup"><span data-stu-id="a8629-143">To receive data over a direct connection, the application must register for the PEER\_GROUP\_EVENT\_INCOMING\_DATA event with [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span></span> <span data-ttu-id="a8629-144">Обработчик событий отвечает за получение и упорядочение непрозрачных данных и передачу их в приложение.</span><span class="sxs-lookup"><span data-stu-id="a8629-144">The event handler is responsible for obtaining and ordering the opaque data, and passing it to the application.</span></span> <span data-ttu-id="a8629-145">Эти данные получаются в обработчике событий путем вызова [**пирграупжетевентдата**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata) с дескриптором для зарегистрированных событий.</span><span class="sxs-lookup"><span data-stu-id="a8629-145">This data is obtained within the event handler by calling [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata) with the handle to the registered events.</span></span>

<span data-ttu-id="a8629-146">Прямое соединение закрывается вызовом [**пирграупклоседиректконнектион**](/windows/desktop/api/P2P/nf-p2p-peergroupclosedirectconnection) и передачей идентификатора соединения, полученного при предыдущем вызове метода [**пирграупопендиректконнектион**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection) или полученного в данных события для прямого соединения с одноранговой \_ \_ группой событий \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="a8629-146">A direct connection is closed by calling [**PeerGroupCloseDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupclosedirectconnection) and passing in the connection ID obtained by a previous call to [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection) or received in the event data for PEER\_EVENT\_GROUP\_DIRECT\_CONNECTION.</span></span>

 

 



