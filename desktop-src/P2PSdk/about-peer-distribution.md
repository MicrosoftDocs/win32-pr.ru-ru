---
description: api однорангового распространения, поддерживающий функцию кэширования ветвей в Windows 7, Windows Server 2008 R2, Windows 8 и Windows Server 2012, предлагает набор api-интерфейсов платформы, которые могут повысить скорость реагирования в работе централизованных приложений при доступе из удаленных офисов и способствовать сокращению общей загрузки глобальной сети, не мешая технологиям сетевой безопасности.
ms.assetid: feb9666e-563a-49f4-ad1c-f166a0faff31
title: О одноранговом распределении
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 11085b38819f8b102f71f59294924c7c6e079881c8af87f77923351ff424f959
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119553484"
---
# <a name="about-peer-distribution"></a>О одноранговом распределении

api однорангового распространения, поддерживающий функцию кэширования ветвей в Windows 7, Windows Server 2008 R2, Windows 8 и Windows Server 2012, предлагает набор api-интерфейсов платформы, которые могут повысить скорость реагирования в работе централизованных приложений при доступе из удаленных офисов и способствовать сокращению общей загрузки глобальной сети, не мешая технологиям сетевой безопасности.

Система одноранговой рассылки предоставляет набор API-интерфейсов платформы, которые используются издателями, которые предоставляют цифровое содержимое и потребители, которые его запрашивают. Чтобы легко отличать эти роли, может быть проще подумать об издателе в роли сервера и потребителе в клиентской роли. В этом случае важно помнить, что, помимо этих концептуальных ролей, служба однорангового распространения является действительной одноранговой системой, как показывается возможностью любого узла распределения узлов для публикации и использования цифрового содержимого. API-интерфейсы платформы одноранговой рассылки предоставляются издателям и потребителям с помощью библиотеки импорта **Win32 (мещаются** в библиотеке).

Жизненный цикл содержимого, предоставляемого издателем и получаемый потребителем с помощью службы одноранговой рассылки, состоит из следующих операций.



|                         | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Публикация содержимого** | Публикация выполняется для получения описания **информации о** терминах **содержимого или сведений о содержимом** для краткости. Эти сведения о содержимом затем могут использоваться экземпляром службы однорангового распространения для проверки подлинности и перестроения содержимого. когда содержимое публикуется приложением в службе распространения Peer, что является концептуально операцией на стороне сервера, это содержимое связывается с удостоверением Publisher, основанным на идентификаторе безопасности пользователя, связанного с маркером доступа потока. Эта привязка выполняется для ограничения доступа к содержимому неавторизованными сущностями. Однако важно отметить, что доступ к сведениям о содержимом эквивалентен доступу к самому содержимому, так как сведения о содержимом можно использовать для получения содержимого с одноранговых узлов или из размещенного кэша.<br/> В Windows 8 существует новая версия структуры данных сведений о содержимом. Однако предыдущая версия по-прежнему поддерживается. для взаимодействия с клиентами Windows 7 администратор может настроить службу однорангового распространения, чтобы она использовала предыдущую версию структуры данных о содержимом.<br/> |
| **Получение содержимого**   | Чтобы потребитель получал содержимое из службы распространения Peer, необходимо предоставить доступ к сведениям о опубликованном содержимом, связанным с этим содержимым. Служба одноранговой рассылки, используемая для публикации содержимого, может предоставить связанную информацию о содержимом. После получения сведений о содержимом потребитель может использовать другие API-интерфейсы распространения одноранговых узлов для запроса содержимого от службы распространения Peer. Служба одноранговой рассылки попытается получить содержимое из локальной сети. Если содержимое недоступно, клиентское приложение отвечает за получение содержимого с исходного сервера.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Удаление публикации** | Для приложений, которые опубликовали содержимое в службе одноранговой рассылки, была предоставлена функция [**пирдистсерверунпублиш**](/windows/desktop/api/PeerDist/nf-peerdist-peerdistserverunpublish) , позволяющая отменять публикацию содержимого. После публикации содержимого локальная служба распространения одноранговых узлов больше не будет предоставлять сведения о содержимом, связанном с этим содержимым.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |



 

## <a name="asynchronous-completions"></a>Асинхронные завершения

API однорангового распространения поддерживает асинхронную модель API, а в качестве результата API-интерфейсы однорангового распределения позволяют использовать порты завершения ввода/вывода или события в качестве механизмов сигнализации для обработки завершений асинхронных операций распределения. Для любого из этих механизмов одноранговое распределение использует структуру [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) . В общем случае одноранговая рассылка принимает владение структурой **OVERLAPPED** и всеми параметрами out, которые клиент передает асинхронным функциям API. Клиент не должен обращаться к этим ресурсам до завершения определенной асинхронной функции. Как только асинхронные функции будут завершены, службе одноранговой рассылки больше не потребуется доступ к этим ресурсам, и их можно будет использовать повторно по мере того, как вызывающее приложение видит свое соответствие.

Асинхронное завершение не будет выполняться, если функция возвращает код ошибки, отличный **\_ \_ от типа операций ввода-вывода с ошибками**. Возврат значения, отличного **\_ \_ от типа "ошибка ввода-вывода** ", означает, что вызов завершился с ошибкой синхронно. Если API-интерфейс распространения однорангового узла возвращает **\_ \_ ожидающие операции ввода-вывода с ошибками**, вызывающий объект должен ожидать асинхронного завершения

Код ошибки асинхронного завершения может быть получен одним из двух способов:

**Завершение на основе порта завершения ввода-вывода**

Пользователь вызывает механизм порта завершения ввода-вывода, предоставляя маркер порта завершения и ключ завершения для следующих функций API:

<dl>

[**пирдистрегистерфорстатусчанженотификатион**](/windows/desktop/api/PeerDist/nf-peerdist-peerdistregisterforstatuschangenotification)  
[**пирдистсерверпублишстреам**](/windows/desktop/api/PeerDist/nf-peerdist-peerdistserverpublishstream)  
[**пирдистсерверопенконтентинформатион**](/windows/desktop/api/PeerDist/nf-peerdist-peerdistserveropencontentinformation)  
[**пирдистклиентопенконтент**](/windows/desktop/api/PeerDist/nf-peerdist-peerdistclientopencontent)  
</dl>

Пользователь создает порт завершения, вызывая [**CreateIoCompletionPort**](/windows/desktop/FileIO/createiocompletionport). Этот маркер порта завершения может использоваться одновременно для других асинхронных операций ввода-вывода, а также для операций, связанных с одноранговой рассылкой.

Вызывающий объект должен использовать функцию [**жеткуеуедкомплетионстатус**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) для управления асинхронным завершением. Если асинхронная операция завершается ошибкой, функция **жеткуеуедкомплетионстатус** возвратит **false** , а [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) вернет соответствующий код ошибки. Вызывающий объект должен игнорировать все поля структуры [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) , если код ошибки является любым, кроме **ошибки \_ успешного выполнения**. Асинхронная операция завершается с ошибкой, если функция **жеткуеуедкомплетионстатус** возвращает **значение true**.

Дополнительные сведения см. в разделе [порты завершения ввода-вывода](/windows/desktop/FileIO/i-o-completion-ports).

**Завершение на основе событий**

Если вызывающий объект устанавливает допустимый дескриптор события в поле *Хевент* структуры [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) , то одноранговое распределение использует его для сигнализации о завершении связанной операции асинхронного ввода-вывода.

Вызывающий поток может управлять перекрывающейся операциями, задавая маркер для объекта события ручного [**сброса структуры в**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) одной из функций ожидания. После получения сигнала вызывающий объект должен вызвать [**пиржетоверлаппедресулт**](https://www.bing.com/search?q=**PeerGetOverlappedResult**) , передав СООТВЕТСТВУЮЩУЮ структуру **OVERLAPPED** . **Пиржетоверлаппедресулт** будет возвращать **значение false** , и вызывающий объект должен вызвать [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) для получения кода ошибки. Вызывающий объект должен игнорировать все поля структуры **OVERLAPPED** , если код ошибки является любым, кроме **ошибки \_ успешного выполнения**. Асинхронная операция завершается с ошибкой, если функция **пиржетоверлаппедресулт** возвращает **значение true**.

Если вызывающий объект предоставляет порт завершения вместе с событием, то в качестве механизма завершения будет использоваться событие.

**Windows 7:** Используйте функцию [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) вместо [**пиржетоверлаппедресулт**](https://www.bing.com/search?q=**PeerGetOverlappedResult**).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Справочник по API однорангового распространения](peer-distribution-api-reference.md)
</dt> </dl>

 

