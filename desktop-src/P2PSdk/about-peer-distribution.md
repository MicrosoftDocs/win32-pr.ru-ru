---
description: Интерфейс API однорангового распространения, поддерживающий функцию кэширования ветвей в Windows 7, Windows Server 2008 R2, Windows 8 и Windows Server 2012, предлагает набор API-интерфейсов платформы, которые могут повысить скорость реагирования в работе централизованных приложений при доступе из удаленных офисов и способствовать сокращению общего использования глобальной сети, не мешая технологиям сетевой безопасности.
ms.assetid: feb9666e-563a-49f4-ad1c-f166a0faff31
title: О одноранговом распределении
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1c996aed35ac691284ba61b757d6ff5a88033aad
ms.sourcegitcommit: b32433cc0394159c7263809ae67615ab5792d40d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/30/2021
ms.locfileid: "113120439"
---
# <a name="about-peer-distribution"></a><span data-ttu-id="d7063-103">О одноранговом распределении</span><span class="sxs-lookup"><span data-stu-id="d7063-103">About Peer Distribution</span></span>

<span data-ttu-id="d7063-104">Интерфейс API однорангового распространения, поддерживающий функцию кэширования ветвей в Windows 7, Windows Server 2008 R2, Windows 8 и Windows Server 2012, предлагает набор API-интерфейсов платформы, которые могут повысить скорость реагирования в работе централизованных приложений при доступе из удаленных офисов и способствовать сокращению общего использования глобальной сети, не мешая технологиям сетевой безопасности.</span><span class="sxs-lookup"><span data-stu-id="d7063-104">The Peer Distribution API, which supports the Branch Cache feature in Windows 7, Windows Server 2008 R2, Windows 8, and Windows Server 2012 offers a set of platform APIs that can increase network responsiveness of centralized applications when accessed from remote offices and aid in reducing overall wide area network (WAN) utilization without interfering with the network security technologies.</span></span>

<span data-ttu-id="d7063-105">Система одноранговой рассылки предоставляет набор API-интерфейсов платформы, которые используются издателями, которые предоставляют цифровое содержимое и потребители, которые его запрашивают.</span><span class="sxs-lookup"><span data-stu-id="d7063-105">The Peer Distribution system offers a set of platform APIs utilized by both the publishers that provide digital content and consumers that request it.</span></span> <span data-ttu-id="d7063-106">Чтобы легко отличать эти роли, может быть проще подумать об издателе в роли сервера и потребителе в клиентской роли.</span><span class="sxs-lookup"><span data-stu-id="d7063-106">To easily differentiate these roles, it may be easier to think of the publisher in a server role and the consumer in a client role.</span></span> <span data-ttu-id="d7063-107">В этом случае важно помнить, что, помимо этих концептуальных ролей, служба однорангового распространения является действительной одноранговой системой, как показывается возможностью любого узла распределения узлов для публикации и использования цифрового содержимого.</span><span class="sxs-lookup"><span data-stu-id="d7063-107">That aside, it is important to remember that aside from these conceptual roles, the Peer Distribution service is a true peer system, as indicated by the ability for any Peer Distribution node to both publish and consume digital content.</span></span> <span data-ttu-id="d7063-108">API-интерфейсы платформы одноранговой рассылки предоставляются издателям и потребителям с помощью библиотеки импорта **Win32 (мещаются** в библиотеке).</span><span class="sxs-lookup"><span data-stu-id="d7063-108">The Peer Distribution platform APIs are exposed to publishers and consumers by a Win32 import library (**PeerDist.Lib**).</span></span>

<span data-ttu-id="d7063-109">Жизненный цикл содержимого, предоставляемого издателем и получаемый потребителем с помощью службы одноранговой рассылки, состоит из следующих операций.</span><span class="sxs-lookup"><span data-stu-id="d7063-109">The lifecycle of content supplied by a publisher and retrieved by a consumer with the Peer Distribution service is composed of the following operations:</span></span>



|                         | <span data-ttu-id="d7063-110">Описание</span><span class="sxs-lookup"><span data-stu-id="d7063-110">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="d7063-111">**Публикация содержимого**</span><span class="sxs-lookup"><span data-stu-id="d7063-111">**Content Publication**</span></span> | <span data-ttu-id="d7063-112">Публикация выполняется для получения описания **информации о** терминах **содержимого или сведений о содержимом** для краткости.</span><span class="sxs-lookup"><span data-stu-id="d7063-112">Publishing is done to produce a description of content termed **Content Information**, or **Content Info** for short.</span></span> <span data-ttu-id="d7063-113">Эти сведения о содержимом затем могут использоваться экземпляром службы однорангового распространения для проверки подлинности и перестроения содержимого.</span><span class="sxs-lookup"><span data-stu-id="d7063-113">This Content Info can then be used by an instance of the Peer Distribution service to authenticate and rebuild the content.</span></span> <span data-ttu-id="d7063-114">Когда содержимое публикуется приложением в службе распространения Peer, что является концептуально операцией на стороне сервера, это содержимое связывается с удостоверением издателя, основанным на идентификаторе безопасности пользователя, связанного с маркером доступа потока.</span><span class="sxs-lookup"><span data-stu-id="d7063-114">When content is published by an application into the Peer Distribution service, which is conceptually a server-side operation, that content becomes associated with the Publisher Identity, which is based on the SID of the user associated with the thread access token.</span></span> <span data-ttu-id="d7063-115">Эта привязка выполняется для ограничения доступа к содержимому неавторизованными сущностями.</span><span class="sxs-lookup"><span data-stu-id="d7063-115">This binding is done to limit access to content by unauthorized entities.</span></span> <span data-ttu-id="d7063-116">Однако важно отметить, что доступ к сведениям о содержимом эквивалентен доступу к самому содержимому, так как сведения о содержимом можно использовать для получения содержимого с одноранговых узлов или из размещенного кэша.</span><span class="sxs-lookup"><span data-stu-id="d7063-116">However, it is important to note that access to the content information is equivalent to access to the content itself, as the content information can be used to obtain the content from peers or a hosted cache.</span></span><br/> <span data-ttu-id="d7063-117">В Windows 8 имеется новая версия структуры данных сведений о содержимом; Однако предыдущая версия по-прежнему поддерживается.</span><span class="sxs-lookup"><span data-stu-id="d7063-117">There is a new version of the content information data structure in Windows 8; however, the previous version is still supported.</span></span> <span data-ttu-id="d7063-118">Для взаимодействия с клиентами Windows 7 Администратор может настроить службу однорангового распространения для использования предыдущей версии структуры данных содержимого.</span><span class="sxs-lookup"><span data-stu-id="d7063-118">To interoperate with Windows 7 clients, an administrator may configure the Peer Distribution service to use the previous version of the content information data structure.</span></span><br/> |
| <span data-ttu-id="d7063-119">**Получение содержимого**</span><span class="sxs-lookup"><span data-stu-id="d7063-119">**Content Retrieval**</span></span>   | <span data-ttu-id="d7063-120">Чтобы потребитель получал содержимое из службы распространения Peer, необходимо предоставить доступ к сведениям о опубликованном содержимом, связанным с этим содержимым.</span><span class="sxs-lookup"><span data-stu-id="d7063-120">For a consumer to retrieve content from the Peer Distribution service, access must be provided to the published Content Info associated with that content.</span></span> <span data-ttu-id="d7063-121">Служба одноранговой рассылки, используемая для публикации содержимого, может предоставить связанную информацию о содержимом.</span><span class="sxs-lookup"><span data-stu-id="d7063-121">The Peer Distribution service used to publish the content can provide the associated Content Info.</span></span> <span data-ttu-id="d7063-122">После получения сведений о содержимом потребитель может использовать другие API-интерфейсы распространения одноранговых узлов для запроса содержимого от службы распространения Peer.</span><span class="sxs-lookup"><span data-stu-id="d7063-122">Once the consumer has the Content Info, other Peer Distribution APIs can be used to request content from the Peer Distribution service.</span></span> <span data-ttu-id="d7063-123">Служба одноранговой рассылки попытается получить содержимое из локальной сети.</span><span class="sxs-lookup"><span data-stu-id="d7063-123">The Peer Distribution service will attempt to retrieve the content from the local network.</span></span> <span data-ttu-id="d7063-124">Если содержимое недоступно, клиентское приложение отвечает за получение содержимого с исходного сервера.</span><span class="sxs-lookup"><span data-stu-id="d7063-124">If the content is not available, the client application is responsible for retrieving the content from the source server.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="d7063-125">**Удаление публикации**</span><span class="sxs-lookup"><span data-stu-id="d7063-125">**Publication Removal**</span></span> | <span data-ttu-id="d7063-126">Для приложений, которые опубликовали содержимое в службе одноранговой рассылки, была предоставлена функция [**пирдистсерверунпублиш**](/windows/desktop/api/PeerDist/nf-peerdist-peerdistserverunpublish) , позволяющая отменять публикацию содержимого.</span><span class="sxs-lookup"><span data-stu-id="d7063-126">For applications that have published content into the Peer Distribution service, the [**PeerDistServerUnpublish**](/windows/desktop/api/PeerDist/nf-peerdist-peerdistserverunpublish) function has been provided to allow content to be unpublished.</span></span> <span data-ttu-id="d7063-127">После публикации содержимого локальная служба распространения одноранговых узлов больше не будет предоставлять сведения о содержимом, связанном с этим содержимым.</span><span class="sxs-lookup"><span data-stu-id="d7063-127">Once content has been unpublished, the local Peer Distribution service will no longer provide the content info associated with that content.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |



 

## <a name="asynchronous-completions"></a><span data-ttu-id="d7063-128">Асинхронные завершения</span><span class="sxs-lookup"><span data-stu-id="d7063-128">Asynchronous Completions</span></span>

<span data-ttu-id="d7063-129">API однорангового распространения поддерживает асинхронную модель API, а в качестве результата API-интерфейсы однорангового распределения позволяют использовать порты завершения ввода/вывода или события в качестве механизмов сигнализации для обработки завершений асинхронных операций распределения.</span><span class="sxs-lookup"><span data-stu-id="d7063-129">The Peer Distribution API supports an asynchronous API model, and as a result Peer Distribution APIs allow for the use of either I/O Completion Ports or Events as the signaling mechanisms for processing asynchronous Peer Distribution operation completions.</span></span> <span data-ttu-id="d7063-130">Для любого из этих механизмов одноранговое распределение использует структуру [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) .</span><span class="sxs-lookup"><span data-stu-id="d7063-130">For either mechanism, Peer Distribution uses an [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure.</span></span> <span data-ttu-id="d7063-131">В общем случае одноранговая рассылка принимает владение структурой **OVERLAPPED** и всеми параметрами out, которые клиент передает асинхронным функциям API.</span><span class="sxs-lookup"><span data-stu-id="d7063-131">In general, Peer Distribution takes the ownership of an **OVERLAPPED** structure and any out parameters that the Client passes to asynchronous API functions.</span></span> <span data-ttu-id="d7063-132">Клиент не должен обращаться к этим ресурсам до завершения определенной асинхронной функции.</span><span class="sxs-lookup"><span data-stu-id="d7063-132">The Client must not access these resources until the particular asynchronous function completes.</span></span> <span data-ttu-id="d7063-133">Как только асинхронные функции будут завершены, службе одноранговой рассылки больше не потребуется доступ к этим ресурсам, и их можно будет использовать повторно по мере того, как вызывающее приложение видит свое соответствие.</span><span class="sxs-lookup"><span data-stu-id="d7063-133">As soon as the asynchronous functions completes, the Peer Distribution service will no longer require access to these resources and they may be reused as the calling application sees fit.</span></span>

<span data-ttu-id="d7063-134">Асинхронное завершение не будет выполняться, если функция возвращает код ошибки, отличный **\_ \_ от типа операций ввода-вывода с ошибками**.</span><span class="sxs-lookup"><span data-stu-id="d7063-134">There will not be any asynchronous completion if the function returns any error code other than **ERROR\_IO\_PENDING**.</span></span> <span data-ttu-id="d7063-135">Возврат значения, отличного **\_ \_ от типа "ошибка ввода-вывода** ", означает, что вызов завершился с ошибкой синхронно.</span><span class="sxs-lookup"><span data-stu-id="d7063-135">The return of a value other than **ERROR\_IO\_PENDING** means that the call has failed synchronously.</span></span> <span data-ttu-id="d7063-136">Если API-интерфейс распространения однорангового узла возвращает **\_ \_ ожидающие операции ввода-вывода с ошибками**, вызывающий объект должен ожидать асинхронного завершения</span><span class="sxs-lookup"><span data-stu-id="d7063-136">If the Peer Distribution API returns **ERROR\_IO\_PENDING**, the caller must wait for asynchronous completion.</span></span>

<span data-ttu-id="d7063-137">Код ошибки асинхронного завершения может быть получен одним из двух способов:</span><span class="sxs-lookup"><span data-stu-id="d7063-137">The error code of the asynchronous completion can be retrieved in one of two ways:</span></span>

<span data-ttu-id="d7063-138">**Завершение на основе порта завершения ввода-вывода**</span><span class="sxs-lookup"><span data-stu-id="d7063-138">**I/O Completion Port Based Completion**</span></span>

<span data-ttu-id="d7063-139">Пользователь вызывает механизм порта завершения ввода-вывода, предоставляя маркер порта завершения и ключ завершения для следующих функций API:</span><span class="sxs-lookup"><span data-stu-id="d7063-139">User invokes the I/O completion port mechanism by providing a completion port handle and completion key to the following API functions:</span></span>

<dl>

[<span data-ttu-id="d7063-140">**пирдистрегистерфорстатусчанженотификатион**</span><span class="sxs-lookup"><span data-stu-id="d7063-140">**PeerDistRegisterForStatusChangeNotification**</span></span>](/windows/desktop/api/PeerDist/nf-peerdist-peerdistregisterforstatuschangenotification)  
[<span data-ttu-id="d7063-141">**пирдистсерверпублишстреам**</span><span class="sxs-lookup"><span data-stu-id="d7063-141">**PeerDistServerPublishStream**</span></span>](/windows/desktop/api/PeerDist/nf-peerdist-peerdistserverpublishstream)  
[<span data-ttu-id="d7063-142">**пирдистсерверопенконтентинформатион**</span><span class="sxs-lookup"><span data-stu-id="d7063-142">**PeerDistServerOpenContentInformation**</span></span>](/windows/desktop/api/PeerDist/nf-peerdist-peerdistserveropencontentinformation)  
[<span data-ttu-id="d7063-143">**пирдистклиентопенконтент**</span><span class="sxs-lookup"><span data-stu-id="d7063-143">**PeerDistClientOpenContent**</span></span>](/windows/desktop/api/PeerDist/nf-peerdist-peerdistclientopencontent)  
</dl>

<span data-ttu-id="d7063-144">Пользователь создает порт завершения, вызывая [**CreateIoCompletionPort**](/windows/desktop/FileIO/createiocompletionport).</span><span class="sxs-lookup"><span data-stu-id="d7063-144">The User creates a completion port by calling [**CreateIoCompletionPort**](/windows/desktop/FileIO/createiocompletionport).</span></span> <span data-ttu-id="d7063-145">Этот маркер порта завершения может использоваться одновременно для других асинхронных операций ввода-вывода, а также для операций, связанных с одноранговой рассылкой.</span><span class="sxs-lookup"><span data-stu-id="d7063-145">This completion port handle can be simultaneously used for other asynchronous I/O operations as well as Peer Distribution specific operations.</span></span>

<span data-ttu-id="d7063-146">Вызывающий объект должен использовать функцию [**жеткуеуедкомплетионстатус**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) для управления асинхронным завершением.</span><span class="sxs-lookup"><span data-stu-id="d7063-146">The caller should use [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) function to manage asynchronous completion.</span></span> <span data-ttu-id="d7063-147">Если асинхронная операция завершается ошибкой, функция **жеткуеуедкомплетионстатус** возвратит **false** , а [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) вернет соответствующий код ошибки.</span><span class="sxs-lookup"><span data-stu-id="d7063-147">If the asynchronous operation fails the **GetQueuedCompletionStatus** function will return **FALSE** and [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) will return the appropriate error code.</span></span> <span data-ttu-id="d7063-148">Вызывающий объект должен игнорировать все поля структуры [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) , если код ошибки является любым, кроме **ошибки \_ успешного выполнения**.</span><span class="sxs-lookup"><span data-stu-id="d7063-148">The caller should ignore all the fields of the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure if the error code is anything other than **ERROR\_SUCCESS**.</span></span> <span data-ttu-id="d7063-149">Асинхронная операция завершается с ошибкой, если функция **жеткуеуедкомплетионстатус** возвращает **значение true**.</span><span class="sxs-lookup"><span data-stu-id="d7063-149">The asynchronous operation succeeds if the **GetQueuedCompletionStatus** function returns **TRUE**.</span></span>

<span data-ttu-id="d7063-150">Дополнительные сведения см. в разделе [порты завершения ввода-вывода](/windows/desktop/FileIO/i-o-completion-ports).</span><span class="sxs-lookup"><span data-stu-id="d7063-150">For more information see [I/O Completion Ports](/windows/desktop/FileIO/i-o-completion-ports).</span></span>

<span data-ttu-id="d7063-151">**Завершение на основе событий**</span><span class="sxs-lookup"><span data-stu-id="d7063-151">**Event Based Completion**</span></span>

<span data-ttu-id="d7063-152">Если вызывающий объект устанавливает допустимый дескриптор события в поле *Хевент* структуры [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) , то одноранговое распределение использует его для сигнализации о завершении связанной операции асинхронного ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="d7063-152">If the caller sets a valid Event handle to the *hEvent* field of [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure, Peer Distribution uses it to signal that the associated asynchronous I/O operation has completed.</span></span>

<span data-ttu-id="d7063-153">Вызывающий поток может управлять перекрывающейся операциями, задавая маркер для объекта события ручного [**сброса структуры в**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) одной из функций ожидания.</span><span class="sxs-lookup"><span data-stu-id="d7063-153">A thread caller can manage overlapped operations by specifying a handle to the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure's manual-reset event object in one of the wait functions.</span></span> <span data-ttu-id="d7063-154">После получения сигнала вызывающий объект должен вызвать [**пиржетоверлаппедресулт**](https://www.bing.com/search?q=**PeerGetOverlappedResult**) , передав СООТВЕТСТВУЮЩУЮ структуру **OVERLAPPED** .</span><span class="sxs-lookup"><span data-stu-id="d7063-154">After the Event is signaled the caller must call [**PeerGetOverlappedResult**](https://www.bing.com/search?q=**PeerGetOverlappedResult**) passing in the appropriate **OVERLAPPED** structure.</span></span> <span data-ttu-id="d7063-155">**Пиржетоверлаппедресулт** будет возвращать **значение false** , и вызывающий объект должен вызвать [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) для получения кода ошибки.</span><span class="sxs-lookup"><span data-stu-id="d7063-155">**PeerGetOverlappedResult** will return **FALSE** and the caller must call [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) in order to retrieve the error code.</span></span> <span data-ttu-id="d7063-156">Вызывающий объект должен игнорировать все поля структуры **OVERLAPPED** , если код ошибки является любым, кроме **ошибки \_ успешного выполнения**.</span><span class="sxs-lookup"><span data-stu-id="d7063-156">The caller should ignore all the fields of the **OVERLAPPED** structure if the error code is anything other than **ERROR\_SUCCESS**.</span></span> <span data-ttu-id="d7063-157">Асинхронная операция завершается с ошибкой, если функция **пиржетоверлаппедресулт** возвращает **значение true**.</span><span class="sxs-lookup"><span data-stu-id="d7063-157">The asynchronous operation succeeds if the **PeerGetOverlappedResult** function returns **TRUE**.</span></span>

<span data-ttu-id="d7063-158">Если вызывающий объект предоставляет порт завершения вместе с событием, то в качестве механизма завершения будет использоваться событие.</span><span class="sxs-lookup"><span data-stu-id="d7063-158">If the caller provides a completion port along with an event, the event will be used as the completion mechanism.</span></span>

<span data-ttu-id="d7063-159">**Windows 7:** Используйте функцию [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) вместо [**пиржетоверлаппедресулт**](https://www.bing.com/search?q=**PeerGetOverlappedResult**).</span><span class="sxs-lookup"><span data-stu-id="d7063-159">**Windows 7:** Use the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) function instead of [**PeerGetOverlappedResult**](https://www.bing.com/search?q=**PeerGetOverlappedResult**).</span></span>

## <a name="related-topics"></a><span data-ttu-id="d7063-160">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="d7063-160">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d7063-161">Справочник по API однорангового распространения</span><span class="sxs-lookup"><span data-stu-id="d7063-161">Peer Distribution API Reference</span></span>](peer-distribution-api-reference.md)
</dt> </dl>

 

