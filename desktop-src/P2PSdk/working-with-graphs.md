---
description: При работе с одноранговыми графами функции должны вызываться в определенном порядке. Поток вызовов зависит от того, создаете ли вы или открываете одноранговый граф. В этом разделе определяется последовательность вызовов функций в простом одноранговых приложениях графа.
ms.assetid: cb4f48d0-d1e2-4a4b-bd5a-6e8f66d03806
title: Работа с диаграммами
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b4328b7a0109139421cf03c72a7228a3dc17e375
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105663264"
---
# <a name="working-with-graphs"></a><span data-ttu-id="62069-105">Работа с диаграммами</span><span class="sxs-lookup"><span data-stu-id="62069-105">Working with Graphs</span></span>

<span data-ttu-id="62069-106">При работе с одноранговыми графами функции должны вызываться в определенном порядке.</span><span class="sxs-lookup"><span data-stu-id="62069-106">When working with peer graphs, functions must be called in a specific order.</span></span> <span data-ttu-id="62069-107">Поток вызовов зависит от того, создаете ли вы или открываете одноранговый граф.</span><span class="sxs-lookup"><span data-stu-id="62069-107">The flow of calls depends on whether you are creating or opening a peer graph.</span></span> <span data-ttu-id="62069-108">В этом разделе определяется последовательность вызовов функций в простом одноранговых приложениях графа.</span><span class="sxs-lookup"><span data-stu-id="62069-108">This topic identifies the flow of function calls in a simple peer graph application.</span></span>

## <a name="starting-up-a-graph"></a><span data-ttu-id="62069-109">Запуск графа</span><span class="sxs-lookup"><span data-stu-id="62069-109">Starting Up a Graph</span></span>

<span data-ttu-id="62069-110">Прежде чем приложение вызовет функцию в API одноранговых диаграмм, необходимо вызвать [**пирграфстартуп**](/windows/desktop/api/P2P/nf-p2p-peergraphstartup) , чтобы инициализировать API одноранговых диаграмм для приложения, а затем задать поддерживаемую версию.</span><span class="sxs-lookup"><span data-stu-id="62069-110">Before an application calls a function in the Peer Graphing API, [**PeerGraphStartup**](/windows/desktop/api/P2P/nf-p2p-peergraphstartup) must be called to initialize the Peer Graphing API for an application, and then set the supported version.</span></span>

## <a name="creating-a-peer-graph"></a><span data-ttu-id="62069-111">Создание однорангового графа</span><span class="sxs-lookup"><span data-stu-id="62069-111">Creating a Peer Graph</span></span>

<span data-ttu-id="62069-112">Следующая процедура определяет поток вызовов для создания однорангового графа.</span><span class="sxs-lookup"><span data-stu-id="62069-112">The following procedure identifies the flow of calls for creating a peer graph.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="62069-113">Только один одноранговый узел должен вызывать [**пирграфкреате**](/windows/desktop/api/P2P/nf-p2p-peergraphcreate).</span><span class="sxs-lookup"><span data-stu-id="62069-113">Only one peer should call [**PeerGraphCreate**](/windows/desktop/api/P2P/nf-p2p-peergraphcreate).</span></span> <span data-ttu-id="62069-114">Все остальные узлы должны вызывать [**пирграфопен**](/windows/desktop/api/P2P/nf-p2p-peergraphopen).</span><span class="sxs-lookup"><span data-stu-id="62069-114">All other peers should call [**PeerGraphOpen**](/windows/desktop/api/P2P/nf-p2p-peergraphopen).</span></span> <span data-ttu-id="62069-115">Несколько вызовов **пирграфкреате** делают недействительным граф.</span><span class="sxs-lookup"><span data-stu-id="62069-115">Multiple calls to **PeerGraphCreate** invalidate a graph.</span></span>

 

-   <span data-ttu-id="62069-116">Создание однорангового графа.</span><span class="sxs-lookup"><span data-stu-id="62069-116">Create a peer graph.</span></span> <span data-ttu-id="62069-117">Вызовите [**пирграфкреате**](/windows/desktop/api/P2P/nf-p2p-peergraphcreate).</span><span class="sxs-lookup"><span data-stu-id="62069-117">Call [**PeerGraphCreate**](/windows/desktop/api/P2P/nf-p2p-peergraphcreate).</span></span>
-   <span data-ttu-id="62069-118">Регистрация для событий одноранговых узлов.</span><span class="sxs-lookup"><span data-stu-id="62069-118">Register for peer events.</span></span> <span data-ttu-id="62069-119">Вызовите [**пирграфрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent).</span><span class="sxs-lookup"><span data-stu-id="62069-119">Call [**PeerGraphRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent).</span></span>
    > [!Note]  
    > <span data-ttu-id="62069-120">Дополнительные сведения о регистрации событий одноранговых узлов см. в разделе [инфраструктура событий](peer-events-infrastructure.md).</span><span class="sxs-lookup"><span data-stu-id="62069-120">For more information about registering for peer events, see [Events Infrastructure](peer-events-infrastructure.md).</span></span>

     

-   <span data-ttu-id="62069-121">Прослушивать подключения к одноранговой диаграмме.</span><span class="sxs-lookup"><span data-stu-id="62069-121">Listen for connections to a peer graph.</span></span> <span data-ttu-id="62069-122">Вызовите [**пирграфлистен**](/windows/desktop/api/P2P/nf-p2p-peergraphlisten).</span><span class="sxs-lookup"><span data-stu-id="62069-122">Call [**PeerGraphListen**](/windows/desktop/api/P2P/nf-p2p-peergraphlisten).</span></span>
-   <span data-ttu-id="62069-123">Выполнение функций, зависящих от приложения, для оставшейся части времени выполнения, например обработка одноранговых событий и работа с соединениями.</span><span class="sxs-lookup"><span data-stu-id="62069-123">Perform application-dependent functions for the remainder of the running time, for example, process peer events and work with connections.</span></span>
-   <span data-ttu-id="62069-124">Закройте соединение с одноранговой диаграммой.</span><span class="sxs-lookup"><span data-stu-id="62069-124">Close the connection to a peer graph.</span></span> <span data-ttu-id="62069-125">Вызовите [**пирграфклосе**](/windows/desktop/api/P2P/nf-p2p-peergraphclose).</span><span class="sxs-lookup"><span data-stu-id="62069-125">Call [**PeerGraphClose**](/windows/desktop/api/P2P/nf-p2p-peergraphclose).</span></span>

## <a name="opening-a-peer-graph"></a><span data-ttu-id="62069-126">Открытие однорангового графа</span><span class="sxs-lookup"><span data-stu-id="62069-126">Opening a Peer Graph</span></span>

<span data-ttu-id="62069-127">Поток вызовов функций для открытия однорангового графа зависит от возвращаемого значения вызова [**пирграфопен**](/windows/desktop/api/P2P/nf-p2p-peergraphopen).</span><span class="sxs-lookup"><span data-stu-id="62069-127">The flow of function calls to open a peer graph depends on the return value of the call to [**PeerGraphOpen**](/windows/desktop/api/P2P/nf-p2p-peergraphopen).</span></span> <span data-ttu-id="62069-128">Наиболее важными значениями являются " **S \_** " и **" \_ Peer \_ S \_ Created**", которые описаны в следующих разделах этой статьи.</span><span class="sxs-lookup"><span data-stu-id="62069-128">The most important values are **S\_OK** and **PEER\_S\_DATA\_CREATED**, which are explained in the following sections of this topic.</span></span>

> [!Note]  
> <span data-ttu-id="62069-129">Если вызов [**пирграфопен**](/windows/desktop/api/P2P/nf-p2p-peergraphopen) не возвращает значение **s \_ ОК** или не удается **\_ \_ \_ создать одноранговые данные**, обработайте ошибку.</span><span class="sxs-lookup"><span data-stu-id="62069-129">If a call to [**PeerGraphOpen**](/windows/desktop/api/P2P/nf-p2p-peergraphopen) does not return **S\_OK** or **PEER\_S\_DATA\_CREATED**, handle the error.</span></span>

 

## <a name="when-peergraphopen-returns-s_ok"></a><span data-ttu-id="62069-130">Когда Пирграфопен возвращает значение S \_ ОК</span><span class="sxs-lookup"><span data-stu-id="62069-130">When PeerGraphOpen Returns S\_OK</span></span>

<span data-ttu-id="62069-131">Когда вызов [**пирграфопен**](/windows/desktop/api/P2P/nf-p2p-peergraphopen) возвращает " **\_ ОК**", был открыт одноранговый граф и существующая база данных.</span><span class="sxs-lookup"><span data-stu-id="62069-131">When a call to [**PeerGraphOpen**](/windows/desktop/api/P2P/nf-p2p-peergraphopen) returns **S\_OK**, a peer graph and an existing database have been opened.</span></span> <span data-ttu-id="62069-132">Следующая процедура позволяет определить, что можно сделать для открытия однорангового графа, когда вызов **пирграфопен** возвращает **S \_ ОК** .</span><span class="sxs-lookup"><span data-stu-id="62069-132">The following procedure identifies what you can do to open a peer graph when a call to **PeerGraphOpen** returns **S\_OK**</span></span>

-   <span data-ttu-id="62069-133">Регистрация для событий одноранговых узлов.</span><span class="sxs-lookup"><span data-stu-id="62069-133">Register for peer events.</span></span> <span data-ttu-id="62069-134">Вызовите [**пирграфрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent).</span><span class="sxs-lookup"><span data-stu-id="62069-134">Call [**PeerGraphRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent).</span></span>
    > [!Note]  
    > <span data-ttu-id="62069-135">Дополнительные сведения о регистрации событий см. в разделе [инфраструктура событий](peer-events-infrastructure.md).</span><span class="sxs-lookup"><span data-stu-id="62069-135">For more information about registering for events, see [Events Infrastructure](peer-events-infrastructure.md).</span></span>

     

-   <span data-ttu-id="62069-136">Нахождение узла.</span><span class="sxs-lookup"><span data-stu-id="62069-136">Locate a node.</span></span> <span data-ttu-id="62069-137">Это процесс, выполняемый за пределами инфраструктуры одноранговых диаграмм, с помощью метода или приложения, которые вы определяете.</span><span class="sxs-lookup"><span data-stu-id="62069-137">This is a process performed outside of the Peer Graphing Infrastructure, by using a method or application that you identify.</span></span> <span data-ttu-id="62069-138">API одноранговых диаграмм не предоставляет специальный механизм поиска исходного узла графа для подключения.</span><span class="sxs-lookup"><span data-stu-id="62069-138">The Peer Graphing API does not provide a specific mechanism to find an initial graph node to connect to.</span></span> <span data-ttu-id="62069-139">Приложение должно использовать другой механизм, например API [протокола PNRP](pnrp-namespace-provider-api.md) , для определения местонахождения исходного узла.</span><span class="sxs-lookup"><span data-stu-id="62069-139">An application must use another mechanism, such as the [Peer Name Resolution Protocol (PNRP)](pnrp-namespace-provider-api.md) API, to locate the initial node.</span></span>
-   <span data-ttu-id="62069-140">Если узел найден, подключитесь к нему.</span><span class="sxs-lookup"><span data-stu-id="62069-140">If a node is found, connect to it.</span></span> <span data-ttu-id="62069-141">Вызовите [**пирграфконнект**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect), а затем вызовите [**пирграфлистен**](/windows/desktop/api/P2P/nf-p2p-peergraphlisten) для прослушивания соединений с одноранговый граф.</span><span class="sxs-lookup"><span data-stu-id="62069-141">Call [**PeerGraphConnect**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect), then call [**PeerGraphListen**](/windows/desktop/api/P2P/nf-p2p-peergraphlisten) to listen for connections to the peer graph.</span></span>
    > [!Note]  
    > <span data-ttu-id="62069-142">Если узел не найден, не вызывайте [**пирграфконнект**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect) и [**пирграфлистен**](/windows/desktop/api/P2P/nf-p2p-peergraphlisten).</span><span class="sxs-lookup"><span data-stu-id="62069-142">If a node is not found, do not call [**PeerGraphConnect**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect) and [**PeerGraphListen**](/windows/desktop/api/P2P/nf-p2p-peergraphlisten).</span></span>

     

-   <span data-ttu-id="62069-143">Выполнение функций, зависящих от приложения, для оставшейся части времени выполнения, например обработка одноранговых событий и работа с соединениями в зависимости от того, подключен ли узел к одноранговой диаграмме или нет.</span><span class="sxs-lookup"><span data-stu-id="62069-143">Perform application-dependent functions for the remainder of the running time, for example, process peer events and work with connections, depending on whether the node is connected to the peer graph or not.</span></span> <span data-ttu-id="62069-144">Например, приложение может выбрать время ожидания или периодическое выполнение обнаружения активного узла в графе.</span><span class="sxs-lookup"><span data-stu-id="62069-144">For example, the application can choose to timeout or periodically perform discovery for an active node in the graph.</span></span>
-   <span data-ttu-id="62069-145">Закройте подключение к одноранговой диаграмме.</span><span class="sxs-lookup"><span data-stu-id="62069-145">Close the connection to the peer graph.</span></span> <span data-ttu-id="62069-146">Вызовите [**пирграфклосе**](/windows/desktop/api/P2P/nf-p2p-peergraphclose).</span><span class="sxs-lookup"><span data-stu-id="62069-146">Call [**PeerGraphClose**](/windows/desktop/api/P2P/nf-p2p-peergraphclose).</span></span>

## <a name="when-peergraphopen-returns-peer_s_data_created"></a><span data-ttu-id="62069-147">Когда Пирграфопен возвращает созданные одноранговые \_ \_ данные S \_</span><span class="sxs-lookup"><span data-stu-id="62069-147">When PeerGraphOpen Returns PEER\_S\_DATA\_CREATED</span></span>

<span data-ttu-id="62069-148">Когда [**пирграфопен**](/windows/desktop/api/P2P/nf-p2p-peergraphopen) возвращает **созданные одноранговые \_ \_ данные \_ S**, это означает, что существующая база данных для однорангового графа не найдена, создается новая база данных и открывается при первом запуске.</span><span class="sxs-lookup"><span data-stu-id="62069-148">When [**PeerGraphOpen**](/windows/desktop/api/P2P/nf-p2p-peergraphopen) returns **PEER\_S\_DATA\_CREATED**, it means that an existing database for a peer graph is not found, a new database is created, and this is the first time it is opened.</span></span> <span data-ttu-id="62069-149">Для использования или прослушивания однорангового графа необходимо подключение к одноранговой диаграмме и синхронизация с одноранговой диаграммой.</span><span class="sxs-lookup"><span data-stu-id="62069-149">To use or listen on a peer graph, a peer must be connected to and synchronized with a peer graph.</span></span>

<span data-ttu-id="62069-150">Следующая процедура позволяет определить, что можно сделать для открытия однорангового графа, когда вызов [**пирграфопен**](/windows/desktop/api/P2P/nf-p2p-peergraphopen) возвращает **созданные одноранговые \_ \_ данные \_ S**.</span><span class="sxs-lookup"><span data-stu-id="62069-150">The following procedure identifies what you can do to open a peer graph when a call to [**PeerGraphOpen**](/windows/desktop/api/P2P/nf-p2p-peergraphopen) returns **PEER\_S\_DATA\_CREATED**.</span></span>

-   <span data-ttu-id="62069-151">Откройте одноранговый граф.</span><span class="sxs-lookup"><span data-stu-id="62069-151">Open a peer graph.</span></span> <span data-ttu-id="62069-152">Вызовите [**пирграфопен**](/windows/desktop/api/P2P/nf-p2p-peergraphopen).</span><span class="sxs-lookup"><span data-stu-id="62069-152">Call [**PeerGraphOpen**](/windows/desktop/api/P2P/nf-p2p-peergraphopen).</span></span>
-   <span data-ttu-id="62069-153">Регистрация для событий одноранговых узлов.</span><span class="sxs-lookup"><span data-stu-id="62069-153">Register for peer events.</span></span> <span data-ttu-id="62069-154">Вызовите [**пирграфрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent).</span><span class="sxs-lookup"><span data-stu-id="62069-154">Call [**PeerGraphRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent).</span></span>
    > [!Note]  
    > <span data-ttu-id="62069-155">Дополнительные сведения о регистрации событий одноранговых узлов см. в разделе [инфраструктура событий](peer-events-infrastructure.md).</span><span class="sxs-lookup"><span data-stu-id="62069-155">For more information about registering for peer events, see [Events Infrastructure](peer-events-infrastructure.md).</span></span>

     

-   <span data-ttu-id="62069-156">Нахождение узла.</span><span class="sxs-lookup"><span data-stu-id="62069-156">Locate a node.</span></span> <span data-ttu-id="62069-157">Это процесс, выполняемый за пределами инфраструктуры одноранговых диаграмм, с помощью метода или приложения, которые вы определяете.</span><span class="sxs-lookup"><span data-stu-id="62069-157">This is a process performed outside of the Peer Graphing Infrastructure, by using a method or application that you identify.</span></span> <span data-ttu-id="62069-158">API одноранговых диаграмм не предоставляет специальный механизм поиска исходного узла графа для подключения.</span><span class="sxs-lookup"><span data-stu-id="62069-158">The Peer Graphing API does not provide a specific mechanism to find an initial graph node to connect to.</span></span> <span data-ttu-id="62069-159">Приложение должно использовать другой механизм, например API [протокола PNRP](pnrp-namespace-provider-api.md) , для определения местонахождения исходного узла.</span><span class="sxs-lookup"><span data-stu-id="62069-159">An application must use another mechanism, such as the [Peer Name Resolution Protocol (PNRP)](pnrp-namespace-provider-api.md) API, to locate the initial node.</span></span>
-   <span data-ttu-id="62069-160">Если узел найден, подключитесь к нему.</span><span class="sxs-lookup"><span data-stu-id="62069-160">If a node is found, connect to it.</span></span> <span data-ttu-id="62069-161">Вызовите [**пирграфконнект**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect), а затем вызовите [**пирграфлистен**](/windows/desktop/api/P2P/nf-p2p-peergraphlisten) для прослушивания соединений с одноранговый граф.</span><span class="sxs-lookup"><span data-stu-id="62069-161">Call [**PeerGraphConnect**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect), then call [**PeerGraphListen**](/windows/desktop/api/P2P/nf-p2p-peergraphlisten) to listen for connections to the peer graph.</span></span>
    > [!Note]  
    > <span data-ttu-id="62069-162">Если узел не найден, не вызывайте [**пирграфконнект**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect) и [**пирграфлистен**](/windows/desktop/api/P2P/nf-p2p-peergraphlisten).</span><span class="sxs-lookup"><span data-stu-id="62069-162">If a node is not found, do not call [**PeerGraphConnect**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect) and [**PeerGraphListen**](/windows/desktop/api/P2P/nf-p2p-peergraphlisten).</span></span>

     

-   <span data-ttu-id="62069-163">Выполнение функций, зависящих от приложения, для оставшейся части времени выполнения, например обработка одноранговых событий и работа с соединениями в зависимости от того, подключен ли узел к одноранговой диаграмме или нет.</span><span class="sxs-lookup"><span data-stu-id="62069-163">Perform application-dependent functions for the remainder of the running time, for example, process peer events and work with connections, depending on whether the node is connected to the peer graph or not.</span></span> <span data-ttu-id="62069-164">Например, приложение может выбрать время ожидания или периодическое выполнение обнаружения активного узла в графе.</span><span class="sxs-lookup"><span data-stu-id="62069-164">For example, the application can choose to timeout or periodically perform discovery for an active node in the graph.</span></span>
-   <span data-ttu-id="62069-165">Закройте подключение к одноранговой диаграмме.</span><span class="sxs-lookup"><span data-stu-id="62069-165">Close the connection to the peer graph.</span></span> <span data-ttu-id="62069-166">Вызовите [**пирграфклосе**](/windows/desktop/api/P2P/nf-p2p-peergraphclose).</span><span class="sxs-lookup"><span data-stu-id="62069-166">Call [**PeerGraphClose**](/windows/desktop/api/P2P/nf-p2p-peergraphclose).</span></span>

 

 



