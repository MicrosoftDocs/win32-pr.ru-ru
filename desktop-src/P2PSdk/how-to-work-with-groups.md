---
description: Одноранговая группировка — это технология, позволяющая разработчикам быстро и эффективно создавать безопасные одноранговые сети.
ms.assetid: ee72f60b-1e5b-4b69-bda0-2ae80734c144
title: Работа с группами
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f7bebf958d0c3fdee6ad0dc400d495c54ec2e6fe
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104545527"
---
# <a name="how-to-work-with-groups"></a><span data-ttu-id="b52d1-103">Работа с группами</span><span class="sxs-lookup"><span data-stu-id="b52d1-103">How to Work With Groups</span></span>

<span data-ttu-id="b52d1-104">Одноранговая группировка — это технология, позволяющая разработчикам быстро и эффективно создавать безопасные одноранговые сети.</span><span class="sxs-lookup"><span data-stu-id="b52d1-104">Peer-to-peer Grouping is a technology that allows a developer to create a secure peer network quickly and effectively.</span></span> <span data-ttu-id="b52d1-105">В следующем списке перечислены основные моменты, которые необходимо учитывать при создании приложения однорангового группирования.</span><span class="sxs-lookup"><span data-stu-id="b52d1-105">The following list identifies the major considerations in creating a peer grouping application.</span></span>

-   [<span data-ttu-id="b52d1-106">Получение удостоверения однорангового узла</span><span class="sxs-lookup"><span data-stu-id="b52d1-106">Obtaining a Peer Identity</span></span>](#obtaining-a-peer-identity)
-   [<span data-ttu-id="b52d1-107">Запуск одноранговой группы</span><span class="sxs-lookup"><span data-stu-id="b52d1-107">Starting Up a Peer Group</span></span>](#starting-up-the-peer-grouping-infrastructure)
-   [<span data-ttu-id="b52d1-108">Регистрация для группирования событий</span><span class="sxs-lookup"><span data-stu-id="b52d1-108">Registering for Grouping Events</span></span>](#registering-for-peer-grouping-events)
-   [<span data-ttu-id="b52d1-109">Подключение к группе</span><span class="sxs-lookup"><span data-stu-id="b52d1-109">Connecting to a Group</span></span>](#obtaining-a-group-handle)
-   [<span data-ttu-id="b52d1-110">Создание ролей администратора и члена</span><span class="sxs-lookup"><span data-stu-id="b52d1-110">Creating Administrator and Member Roles</span></span>](#creating-administrator-and-member-roles)
-   [<span data-ttu-id="b52d1-111">Поиск однорангового узла</span><span class="sxs-lookup"><span data-stu-id="b52d1-111">Finding a Peer</span></span>](#finding-a-peer)
-   [<span data-ttu-id="b52d1-112">Прямое подключение к одноранговому узлу</span><span class="sxs-lookup"><span data-stu-id="b52d1-112">Connecting Directly to a Peer</span></span>](#connecting-directly-to-a-peer)
-   [<span data-ttu-id="b52d1-113">Закрытие и завершение работы группы</span><span class="sxs-lookup"><span data-stu-id="b52d1-113">Closing and Shutting Down a Group</span></span>](#closing-and-shutting-down-a-peer-group)

## <a name="obtaining-a-peer-identity"></a><span data-ttu-id="b52d1-114">Получение удостоверения однорангового узла</span><span class="sxs-lookup"><span data-stu-id="b52d1-114">Obtaining a Peer Identity</span></span>

<span data-ttu-id="b52d1-115">Перед созданием или подключением к группе необходимо получить одноранговый идентификатор, который используется для уникальной идентификации однорангового узла в группе.</span><span class="sxs-lookup"><span data-stu-id="b52d1-115">Before creating or connecting to a group, a peer must obtain a peer identity, which is a name used to uniquely identify a peer to a group.</span></span> <span data-ttu-id="b52d1-116">Чтобы получить список всех идентификаторов одноранговых узлов, определенных на одноранговом узле, вызовите [**пиренумидентитиес**](/windows/desktop/api/P2P/nf-p2p-peerenumidentities), который возвращает маркер в перечисление.</span><span class="sxs-lookup"><span data-stu-id="b52d1-116">To obtain an enumerated list of all peer identities defined on the peer, call [**PeerEnumIdentities**](/windows/desktop/api/P2P/nf-p2p-peerenumidentities), which returns a handle to the enumeration.</span></span> <span data-ttu-id="b52d1-117">Чтобы получить идентификаторы одноранговых узлов, вызовите [**пиржетнекститем**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem) с помощью маркера перечисления и числа извлекаемых элементов.</span><span class="sxs-lookup"><span data-stu-id="b52d1-117">To obtain the peer identities, call [**PeerGetNextItem**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem) with the enumeration handle and the number of members to retrieve.</span></span> <span data-ttu-id="b52d1-118">Продолжайте вызывать **пиржетнекститем** , пока параметр *pCount* не вернет значение, меньшее запрошенного количества одноранговых идентификаторов.</span><span class="sxs-lookup"><span data-stu-id="b52d1-118">Continue calling **PeerGetNextItem** until the *pCount* parameter returns a value less than the number of peer identities requested.</span></span>

<span data-ttu-id="b52d1-119">Если одноранговый идентификатор для однорангового узла не существует, его можно создать, вызвав [**пиридентитикреате**](/windows/desktop/api/P2P/nf-p2p-peeridentitycreate).</span><span class="sxs-lookup"><span data-stu-id="b52d1-119">If a peer identity for the peer does not exist, it can be created by calling [**PeerIdentityCreate**](/windows/desktop/api/P2P/nf-p2p-peeridentitycreate).</span></span> <span data-ttu-id="b52d1-120">После создания удостоверения однорангового узла узел создает большой двоичный объект XML Identity, содержащий назначенный ему открытый ключ.</span><span class="sxs-lookup"><span data-stu-id="b52d1-120">After creating a peer identity, the peer generates an identity XML blob that contains the public key assigned to it</span></span>

<span data-ttu-id="b52d1-121">Сведения об удостоверении однорангового узла получаются путем вызова [**пиридентитижетксмл**](/windows/desktop/api/P2P/nf-p2p-peeridentitygetxml).</span><span class="sxs-lookup"><span data-stu-id="b52d1-121">The peer identity information is obtained by calling [**PeerIdentityGetXML**](/windows/desktop/api/P2P/nf-p2p-peeridentitygetxml).</span></span> <span data-ttu-id="b52d1-122">Эти сведения об удостоверении однорангового узла используются создателем группы или администратором для выдаче учетных данных, необходимых для присоединения к группе, в качестве XML-объекта приглашения.</span><span class="sxs-lookup"><span data-stu-id="b52d1-122">This peer identity information is used by the group creator or an administrator to issue the credentials needed to join the group, as an invitation XML blob.</span></span>

<span data-ttu-id="b52d1-123">Дополнительные сведения о одноранговых удостоверениях см. в документации по [API диспетчера удостоверений](identity-manager-api.md) .</span><span class="sxs-lookup"><span data-stu-id="b52d1-123">For more information on peer identities, please refer to the [Identity Manager API](identity-manager-api.md) documentation</span></span>

## <a name="starting-up-the-peer-grouping-infrastructure"></a><span data-ttu-id="b52d1-124">Запуск инфраструктуры однорангового группирования</span><span class="sxs-lookup"><span data-stu-id="b52d1-124">Starting Up the Peer Grouping Infrastructure</span></span>

<span data-ttu-id="b52d1-125">Перед вызовом приложением любой функции в API однорангового группирования необходимо вызвать [**пирграупстартуп**](/windows/desktop/api/P2P/nf-p2p-peergroupstartup) .</span><span class="sxs-lookup"><span data-stu-id="b52d1-125">Before any function in the Peer Grouping API is called by an application, [**PeerGroupStartup**](/windows/desktop/api/P2P/nf-p2p-peergroupstartup) must be called.</span></span> <span data-ttu-id="b52d1-126">Эта функция инициализирует инфраструктуру однорангового группирования для приложения и задает поддерживаемую версию.</span><span class="sxs-lookup"><span data-stu-id="b52d1-126">This function initializes the Peer Grouping Infrastructure for the application and sets the supported version.</span></span>

## <a name="obtaining-a-group-handle"></a><span data-ttu-id="b52d1-127">Получение маркера группы</span><span class="sxs-lookup"><span data-stu-id="b52d1-127">Obtaining a Group Handle</span></span>

<span data-ttu-id="b52d1-128">Чтобы подключиться к группе и начать участвовать в ней, необходимо получить маркер одноранговой группы.</span><span class="sxs-lookup"><span data-stu-id="b52d1-128">To connect to a group and begin participating, a handle to a peer group must be obtained.</span></span> <span data-ttu-id="b52d1-129">В следующем списке приведены три способа подключения к одноранговой группе:</span><span class="sxs-lookup"><span data-stu-id="b52d1-129">The following list identifies the three ways to connect to a peer group:</span></span>

-   <span data-ttu-id="b52d1-130">Создание одноранговой группы путем вызова [**пирграупкреате**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate), которая инициализирует новую одноранговую группу и возвращает допустимый маркер с одноранговым узлом в качестве владельца и единственного администратора.</span><span class="sxs-lookup"><span data-stu-id="b52d1-130">Creating a peer group by calling [**PeerGroupCreate**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate), which initializes a new peer group and returns a valid handle with the peer as the owner and sole administrator.</span></span>
-   <span data-ttu-id="b52d1-131">Присоединение к одноранговой группе путем вызова [**пирграупжоин**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin).</span><span class="sxs-lookup"><span data-stu-id="b52d1-131">Joining a peer group by calling [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin).</span></span> <span data-ttu-id="b52d1-132">Чтобы присоединиться к одноранговой группе, одноранговый узел должен получить приглашение от администратора одноранговой группы.</span><span class="sxs-lookup"><span data-stu-id="b52d1-132">To join a peer group, a peer must receive an invitation from a peer group administrator.</span></span> <span data-ttu-id="b52d1-133">Чтобы получить приглашение, отправьте администратору, который создает приглашение, и отправляет его по внешнему механизму, например по электронной почте или FTP.</span><span class="sxs-lookup"><span data-stu-id="b52d1-133">To obtain an invitation, send the identity information XML blob to the administrator who creates an invitation and sends it to you by an external mechanism, such as email or FTP.</span></span> <span data-ttu-id="b52d1-134">Приглашение и одноранговый идентификатор передаются в **пирграупжоин**, который возвращает допустимый маркер в группу.</span><span class="sxs-lookup"><span data-stu-id="b52d1-134">The invitation and peer identity are passed to **PeerGroupJoin**, which returns a valid handle to the group.</span></span>
-   <span data-ttu-id="b52d1-135">Открытие одноранговой группы, присоединенной к узлу ранее путем вызова [**пирграупопен**](/windows/desktop/api/P2P/nf-p2p-peergroupopen).</span><span class="sxs-lookup"><span data-stu-id="b52d1-135">Opening a peer group that a peer has joined previously by calling [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen).</span></span> <span data-ttu-id="b52d1-136">В этом случае получение приглашения не требуется.</span><span class="sxs-lookup"><span data-stu-id="b52d1-136">In this situation, obtaining an invitation is not necessary.</span></span>

<span data-ttu-id="b52d1-137">После получения допустимого маркера одноранговой группы из одной из перечисленных выше функций можно подключиться к одноранговой группе, вызвав [**пирграупконнект**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) с новым маркером.</span><span class="sxs-lookup"><span data-stu-id="b52d1-137">After you obtain a valid peer group handle from one of the above functions, you can connect to a peer group by calling [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) with the new handle.</span></span>

> [!Note]  
> <span data-ttu-id="b52d1-138">В случае сбоя соединения с одноранговой группой \_ \_ \_ \_ возникает событие сбоя подключения к одноранговой группе.</span><span class="sxs-lookup"><span data-stu-id="b52d1-138">If the connection to a peer group fails, the PEER\_GROUP\_EVENT\_CONNECTION\_FAILED event occurs.</span></span> <span data-ttu-id="b52d1-139">Обработчик может попытаться восстановить соединение с одноранговой группой.</span><span class="sxs-lookup"><span data-stu-id="b52d1-139">The handler can attempt to reestablish the connection to the peer group.</span></span>

 

## <a name="registering-for-peer-grouping-events"></a><span data-ttu-id="b52d1-140">Регистрация для событий группирования одноранговых узлов</span><span class="sxs-lookup"><span data-stu-id="b52d1-140">Registering for Peer Grouping Events</span></span>

<span data-ttu-id="b52d1-141">Прежде чем одноранговый узел участвует в одноранговой группе, он должен зарегистрировать события одноранговой группы.</span><span class="sxs-lookup"><span data-stu-id="b52d1-141">Before a peer participates in a peer group, the peer must register for peer group events.</span></span> <span data-ttu-id="b52d1-142">Чтобы выполнить регистрацию для определенных одноранговых событий, вызовите [**пирграупрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent)и передайте один или несколько типов событий однорангового узла, определенных в типе события одноранговой \_ группы \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="b52d1-142">To register for specific peer events, call [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent), and pass in one or more of the peer event types defined in PEER\_GROUP\_EVENT\_TYPE.</span></span> <span data-ttu-id="b52d1-143">Для каждого однорангового события, применяемого к приложению, необходимо зарегистрировать. Например, чтобы получить данные через прямое подключение, зарегистрируйте события одноранговой \_ группы \_ с \_ прямым \_ подключением и \_ \_ СОБЫТИЕм \_ входящих данных событий одноранговой группы \_ .</span><span class="sxs-lookup"><span data-stu-id="b52d1-143">You must register for each peer event that applies to your application; for example, to receive data over a direct connection, register for the PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION and PEER\_GROUP\_EVENT\_INCOMING\_DATA events.</span></span> <span data-ttu-id="b52d1-144">Каждый вызов принимает обработчик события и возвращает обработчик **хпиревент** для этого однорангового события.</span><span class="sxs-lookup"><span data-stu-id="b52d1-144">Each call takes an event handle and returns an **HPEEREVENT** handle for that peer event.</span></span>

<span data-ttu-id="b52d1-145">Обработчики событий могут получать данные, связанные с однорангового события, передавая дескриптор зарегистрированным одноранговым событиям в [**пирграупжетевентдата**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata).</span><span class="sxs-lookup"><span data-stu-id="b52d1-145">Event handlers can obtain the data associated with a peer event by passing the handle to registered peer events to [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata).</span></span> <span data-ttu-id="b52d1-146">Данные одноранговых событий возвращаются в виде \_ \_ объединения данных событий одноранговой группы \_ .</span><span class="sxs-lookup"><span data-stu-id="b52d1-146">This peer event data is returned as a PEER\_GROUP\_EVENT\_DATA union.</span></span> <span data-ttu-id="b52d1-147">Если одноранговая очередь событий пуста, эта функция возвращает одноранговые \_ элементы \_ без \_ \_ данных события.</span><span class="sxs-lookup"><span data-stu-id="b52d1-147">If the peer event queue is empty, this function returns PEER\_S\_NO\_EVENT\_DATA.</span></span>

<span data-ttu-id="b52d1-148">Вы можете отменить регистрацию для одноранговых событий, вызвав [**пирграупунрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergroupunregisterevent) и предоставив маркер для события однорангового узла, регистрацию которого нужно отменить.</span><span class="sxs-lookup"><span data-stu-id="b52d1-148">You can unregister for peer events by calling [**PeerGroupUnregisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupunregisterevent) and providing the handle for the peer event you want to unregister.</span></span> <span data-ttu-id="b52d1-149">После вызова функции одноранговые события, связанные с этим маркером, больше не регистрируются.</span><span class="sxs-lookup"><span data-stu-id="b52d1-149">After the function is called, the peer events associated with the handle are no longer registered.</span></span>

## <a name="creating-administrator-and-member-roles"></a><span data-ttu-id="b52d1-150">Создание ролей администратора и члена</span><span class="sxs-lookup"><span data-stu-id="b52d1-150">Creating Administrator and Member Roles</span></span>

<span data-ttu-id="b52d1-151">Узел, создающий одноранговую группу, называется создателем одноранговой группы и имеет роль администратора по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="b52d1-151">The peer who creates the peer group is known as the peer group creator, and has the administrator role by default.</span></span> <span data-ttu-id="b52d1-152">Только создатель одноранговой группы может задавать свойства группы.</span><span class="sxs-lookup"><span data-stu-id="b52d1-152">Only the peer group creator can set the group properties.</span></span>

<span data-ttu-id="b52d1-153">Коллеги, приглашенные в одноранговую группу, могут быть либо администратором, либо членом.</span><span class="sxs-lookup"><span data-stu-id="b52d1-153">Peers invited to the peer group can be either an administrator or a member.</span></span> <span data-ttu-id="b52d1-154">Если администратор, выдающий приглашение, назначает роль администратора, он может пригласить новых участников в одноранговую группу, а также назначить роль администратора другим участникам.</span><span class="sxs-lookup"><span data-stu-id="b52d1-154">If they are assigned an administrator role by the administrator issuing the invitation, they can invite new members to the peer group, and likewise assign the administrator role to other members.</span></span>

<span data-ttu-id="b52d1-155">Роли членов одноранговых групп задаются в приглашениях, которые администратор передает участнику.</span><span class="sxs-lookup"><span data-stu-id="b52d1-155">The roles of peer group members are set in the invitations the administrator gives to a member.</span></span> <span data-ttu-id="b52d1-156">Чтобы добавить дополнительных администраторов, присвойте параметру *Пролес* [**пирграупкреатеинвитатион**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) значение "Администратор роли одноранговой \_ группы \_ \_ " при создании приглашения.</span><span class="sxs-lookup"><span data-stu-id="b52d1-156">To add more administrators, set the value of the *pRoles* parameter of [**PeerGroupCreateInvitation**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) to PEER\_GROUP\_ROLE\_ADMIN when creating an invitation.</span></span>

<span data-ttu-id="b52d1-157">Участники могут участвовать в одноранговой группе, но не могут приглашать и авторизовать новые члены, задавать свойства группы или обновлять или удалять записи групп, которые они не создают.</span><span class="sxs-lookup"><span data-stu-id="b52d1-157">Members can participate in a peer group, but cannot invite and authorize new members, set group properties, or update or delete group records that they do not specifically create.</span></span> <span data-ttu-id="b52d1-158">Чтобы назначить состояние участника участвующему одноранговому узлу,  [](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) \_ \_ \_ при создании приглашения для этого узла задайте значение параметра пролес в параметре пирграупкреатеинвитатион в качестве участника роли одноранговой группы.</span><span class="sxs-lookup"><span data-stu-id="b52d1-158">To assign member status to a participating peer, set the value of the **pRoles** parameter of [**PeerGroupCreateInvitation**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) to PEER\_GROUP\_ROLE\_MEMBER when you create an invitation for that peer.</span></span>

<span data-ttu-id="b52d1-159">Чтобы изменить роль члена, необходимо выдать этому члену новые учетные данные, содержащие новую роль.</span><span class="sxs-lookup"><span data-stu-id="b52d1-159">To change the role of a member, new credentials containing the new role must be issued to that member.</span></span> <span data-ttu-id="b52d1-160">Для этого получите структуру [**\_ \_ сведений об учетных данных однорангового узла**](/windows/desktop/api/P2P/ns-p2p-peer_credential_info) для этого элемента из структуры однорангового \_ члена, возвращенной [**пирграупенуммемберс**](/windows/desktop/api/P2P/nf-p2p-peergroupenummembers).</span><span class="sxs-lookup"><span data-stu-id="b52d1-160">To accomplish this, obtain the [**PEER\_CREDENTIAL\_INFO**](/windows/desktop/api/P2P/ns-p2p-peer_credential_info) structure for this member from the PEER\_MEMBER structure returned by [**PeerGroupEnumMembers**](/windows/desktop/api/P2P/nf-p2p-peergroupenummembers).</span></span> <span data-ttu-id="b52d1-161">Измените значение поля **пролес** в **поле \_ \_ сведения об учетных данных однорангового узла** на новую роль и передайте структуру в [**пирграуписсуекредентиалс**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials).</span><span class="sxs-lookup"><span data-stu-id="b52d1-161">Change the **pRoles** field in **PEER\_CREDENTIAL\_INFO** to the new role, and pass the structure to [**PeerGroupIssueCredentials**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials).</span></span>

<span data-ttu-id="b52d1-162">Новые учетные данные не вступят в силу для однорангового узла, пока они не подключаются к одноранговой группе.</span><span class="sxs-lookup"><span data-stu-id="b52d1-162">The new credentials will not go into effect for the peer until they connect to the peer group.</span></span> <span data-ttu-id="b52d1-163">Если они подключены в данный момент, они должны закрыть группу и повторно подключиться, чтобы получить обновленные учетные данные.</span><span class="sxs-lookup"><span data-stu-id="b52d1-163">If they are currently connected, they must close the group and reconnect to obtain the updated credentials.</span></span>

## <a name="finding-a-peer"></a><span data-ttu-id="b52d1-164">Поиск однорангового узла</span><span class="sxs-lookup"><span data-stu-id="b52d1-164">Finding a Peer</span></span>

<span data-ttu-id="b52d1-165">Чтобы получить список всех узлов, участвующих в одноранговой группе, вызовите [**пирграупенуммемберс**](/windows/desktop/api/P2P/nf-p2p-peergroupenummembers) с помощью маркера группы, который возвращает маркер в перечисление.</span><span class="sxs-lookup"><span data-stu-id="b52d1-165">To obtain an enumerated list of all peers participating in the peer group, call [**PeerGroupEnumMembers**](/windows/desktop/api/P2P/nf-p2p-peergroupenummembers) with the group handle, which returns a handle to the enumeration.</span></span> <span data-ttu-id="b52d1-166">Чтобы получить члены, вызовите [**пиржетнекститем**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem) с помощью маркера перечисления и числа извлекаемых элементов.</span><span class="sxs-lookup"><span data-stu-id="b52d1-166">To obtain the members, call [**PeerGetNextItem**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem) with the enum handle and the number of members to retrieve.</span></span> <span data-ttu-id="b52d1-167">Продолжайте вызывать **пиржетнекститем** , пока параметр *pCount* не вернет значение, меньшее запрошенного количества элементов.</span><span class="sxs-lookup"><span data-stu-id="b52d1-167">Continue calling **PeerGetNextItem** until the *pCount* parameter returns a value less than the number of members requested.</span></span> <span data-ttu-id="b52d1-168">Обратите внимание, что полный список доступных членов не может быть возвращен.</span><span class="sxs-lookup"><span data-stu-id="b52d1-168">Note that the complete list of available members may not be returned.</span></span>

<span data-ttu-id="b52d1-169">Каждый элемент представляется в виде структуры [**однорангового \_ члена**](/windows/desktop/api/P2P/ns-p2p-peer_member) , которая содержит идентификаторы одноранговых узлов, идентификаторов узла и IP-адресов для активных одноранговых узлов.</span><span class="sxs-lookup"><span data-stu-id="b52d1-169">Each member is represented as a [**PEER\_MEMBER**](/windows/desktop/api/P2P/ns-p2p-peer_member) structure, which contains the identity of the peer, node IDs, and IP addresses for active peers.</span></span>

<span data-ttu-id="b52d1-170">По завершении закройте перечисление и освободите связанную память, вызвав [**пиренденумератион**](/windows/desktop/api/P2P/nf-p2p-peerendenumeration).</span><span class="sxs-lookup"><span data-stu-id="b52d1-170">When finished, close the enumeration and release the associated memory by calling [**PeerEndEnumeration**](/windows/desktop/api/P2P/nf-p2p-peerendenumeration).</span></span>

## <a name="connecting-directly-to-a-peer"></a><span data-ttu-id="b52d1-171">Прямое подключение к одноранговому узлу</span><span class="sxs-lookup"><span data-stu-id="b52d1-171">Connecting Directly to a Peer</span></span>

<span data-ttu-id="b52d1-172">При подключении однорангового узла к одноранговой группе инициируется непосредственная связь "один к одному" с другими подключенными членами с помощью вызова [**пирграупопендиректконнектион**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection) и предоставления удостоверения другого однорангового узла.</span><span class="sxs-lookup"><span data-stu-id="b52d1-172">When a peer is connected to a peer group, direct one-to-one exchanges with other connected members are initiated by calling [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection) and supplying the identity of the other peer.</span></span> <span data-ttu-id="b52d1-173">Этот вызов является асинхронным и возвращает 64-разрядный идентификатор соединения.</span><span class="sxs-lookup"><span data-stu-id="b52d1-173">This call is asynchronous, and returns a 64-bit connection ID.</span></span> <span data-ttu-id="b52d1-174">Если вызов выполнен успешно, вы получаете событие однорангового \_ \_ \_ узла события прямого соединения с прямой группой, \_ \_ чтобы указать, что соединение прошло успешно.</span><span class="sxs-lookup"><span data-stu-id="b52d1-174">If the call is successful, you receive the PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION\_EVENT peer event to indicate that the connection is successful.</span></span> <span data-ttu-id="b52d1-175">Если соединение установлено успешно, идентификатор соединения является допустимым и может использоваться для отправки и получения данных через прямое соединение.</span><span class="sxs-lookup"><span data-stu-id="b52d1-175">If the connection is successful, the connection ID is valid and can be used to send and receive data through the direct connection.</span></span>

<span data-ttu-id="b52d1-176">Чтобы иметь возможность получать прямые подключения, другой узел также должен быть зарегистрирован ранее для события однорангового \_ \_ узла с \_ прямым \_ подключением.</span><span class="sxs-lookup"><span data-stu-id="b52d1-176">To be able to receive direct connections, the other peer must also have previously registered for the PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION peer event.</span></span>

<span data-ttu-id="b52d1-177">Чтобы отправить данные на одноранговый узел, вызовите [**пирграупсенддата**](/windows/desktop/api/P2P/nf-p2p-peergroupsenddata) с ДОПУСТИМЫм идентификатором соединения.</span><span class="sxs-lookup"><span data-stu-id="b52d1-177">To send data to a peer, call [**PeerGroupSendData**](/windows/desktop/api/P2P/nf-p2p-peergroupsenddata) with a valid connection ID.</span></span> <span data-ttu-id="b52d1-178">Для получения данных другой узел должен быть зарегистрирован для события однорангового \_ узла события одноранговой группы \_ \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="b52d1-178">To receive data, the other peer must be registered for the PEER\_GROUP\_EVENT\_INCOMING\_DATA peer event.</span></span> <span data-ttu-id="b52d1-179">Аналогично, если отправляющий узел хочет получать данные в свою очередь, он также должен быть зарегистрирован для события однорангового \_ узла для события Peer в группе узлов \_ \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="b52d1-179">Likewise, if the sending peer wants to receive data in turn, it also must be registered for the PEER\_GROUP\_EVENT\_INCOMING\_DATA peer event.</span></span>

<span data-ttu-id="b52d1-180">Чтобы получить общий набор активных в данный момент прямых подключений с другими одноранговыми узлами в группе, вызовите [**пирграупенумконнектионс**](/windows/desktop/api/P2P/nf-p2p-peergroupenumconnections) , чтобы открыть перечисление и выполнить итерацию по списку соединений с помощью [**пиржетнекститем**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem).</span><span class="sxs-lookup"><span data-stu-id="b52d1-180">To receive the total set of currently active direct connections with other peers in a group, call [**PeerGroupEnumConnections**](/windows/desktop/api/P2P/nf-p2p-peergroupenumconnections) to open the enumeration and iterate through the list of connections by using [**PeerGetNextItem**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem).</span></span>

<span data-ttu-id="b52d1-181">Чтобы закрыть прямое соединение, вызовите [**пирграупклоседиректконнектион**](/windows/desktop/api/P2P/nf-p2p-peergroupclosedirectconnection) и передайте идентификатор подключения.</span><span class="sxs-lookup"><span data-stu-id="b52d1-181">To close a direct connection, call [**PeerGroupCloseDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupclosedirectconnection) and pass in the connection ID.</span></span>

## <a name="closing-and-shutting-down-a-peer-group"></a><span data-ttu-id="b52d1-182">Закрытие и завершение работы одноранговой группы</span><span class="sxs-lookup"><span data-stu-id="b52d1-182">Closing and Shutting Down a Peer Group</span></span>

<span data-ttu-id="b52d1-183">Чтобы закрыть соединение с одноранговой группой, вызовите [**пирграупклосе**](/windows/desktop/api/P2P/nf-p2p-peergroupclose), который делает недействительным маркер группы, но не завершает работу инфраструктуры однорангового группирования.</span><span class="sxs-lookup"><span data-stu-id="b52d1-183">To close a connection to a peer group, call [**PeerGroupClose**](/windows/desktop/api/P2P/nf-p2p-peergroupclose), which invalidates the group handle, but does not shut down the Peer Grouping Infrastructure.</span></span> <span data-ttu-id="b52d1-184">Данные одноранговой группы удаляются путем вызова [**пирграупделете**](/windows/desktop/api/P2P/nf-p2p-peergroupdelete).</span><span class="sxs-lookup"><span data-stu-id="b52d1-184">Peer-to-peer group data is deleted by calling [**PeerGroupDelete**](/windows/desktop/api/P2P/nf-p2p-peergroupdelete).</span></span>

<span data-ttu-id="b52d1-185">После завершения работы приложения с помощью инфраструктуры однорангового группирования необходимо вызвать [**пирграупшутдовн**](/windows/desktop/api/P2P/nf-p2p-peergroupshutdown).</span><span class="sxs-lookup"><span data-stu-id="b52d1-185">When the application is finished using the Peer Grouping Infrastructure, it must call [**PeerGroupShutdown**](/windows/desktop/api/P2P/nf-p2p-peergroupshutdown).</span></span>

 

 



