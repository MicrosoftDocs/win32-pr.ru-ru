---
description: В этом разделе обсуждается процесс приглашения однорангового узла к присоединению к одноранговой группе с помощью интерфейсов API группирования одноранговых узлов.
ms.assetid: 6afcbfec-b1df-45cd-8a43-221dfe5d8c33
title: Приглашение однорангового узла в группу
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 68b1e8852f58387d424944d4a8821f56b5e11e8d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103998544"
---
# <a name="inviting-a-peer-to-a-group"></a><span data-ttu-id="b5ac4-103">Приглашение однорангового узла в группу</span><span class="sxs-lookup"><span data-stu-id="b5ac4-103">Inviting a Peer to a Group</span></span>

<span data-ttu-id="b5ac4-104">В этом разделе обсуждается процесс приглашения однорангового узла к присоединению к одноранговой группе с помощью интерфейсов API группирования одноранговых узлов.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-104">This topic discusses the process of inviting a peer to join a peer group using the Peer Grouping APIs.</span></span>

<span data-ttu-id="b5ac4-105">Для участия в одноранговой группе требуются действительные учетные данные.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-105">A peer group requires valid credentials to participate.</span></span> <span data-ttu-id="b5ac4-106">Учетные данные выдаются вне группы в виде приглашений или непосредственно членам группы при необходимости обновления учетных данных.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-106">Credentials are issued from outside a group in the form of invitations, or directly to members within a group when credential updates are needed.</span></span>

## <a name="group-member-certificates"></a><span data-ttu-id="b5ac4-107">Сертификаты членов групп</span><span class="sxs-lookup"><span data-stu-id="b5ac4-107">Group Member Certificates</span></span>

<span data-ttu-id="b5ac4-108">Одноранговая группа создается, когда приложение вызывает [**пирграупкреате**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate).</span><span class="sxs-lookup"><span data-stu-id="b5ac4-108">A peer group is created when an application makes a call to [**PeerGroupCreate**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate).</span></span>

<span data-ttu-id="b5ac4-109">Для участия в одноранговой группе каждый узел должен иметь одноранговый идентификатор.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-109">To participate in a peer group, each peer must have a peer identity.</span></span> <span data-ttu-id="b5ac4-110">Вызовите [**пиренумидентитиес**](/windows/desktop/api/P2P/nf-p2p-peerenumidentities) , пока не будут возвращены все идентификаторы узлов, определенные для однорангового узла, и выберите тот, который следует использовать.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-110">Call [**PeerEnumIdentities**](/windows/desktop/api/P2P/nf-p2p-peerenumidentities) until all peer identities defined for the peer have been returned, and select the one that should be used.</span></span> <span data-ttu-id="b5ac4-111">Если одноранговый идентификатор не существует, создайте его, вызвав [**пиридентитикреате**](/windows/desktop/api/P2P/nf-p2p-peeridentitycreate).</span><span class="sxs-lookup"><span data-stu-id="b5ac4-111">If a peer identity does not exist, create one by calling [**PeerIdentityCreate**](/windows/desktop/api/P2P/nf-p2p-peeridentitycreate).</span></span>

<span data-ttu-id="b5ac4-112">Каждое удостоверение однорангового узла связано с конкретным набором учетных данных, которые можно использовать для подтверждения членства в одноранговой группе при подключении, а также при публикации записей или приглашении дополнительных участников.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-112">Each peer identity is associated with a specific set of credentials that can be used to prove peer group membership when connecting, as well as when publishing records or inviting additional members.</span></span> <span data-ttu-id="b5ac4-113">Эти учетные данные представляются в виде цепочек [сертификатов X. 509](https://www.ietf.org/rfc/rfc2511.txt) , называемых сертификатами членства в группах (ГМК).</span><span class="sxs-lookup"><span data-stu-id="b5ac4-113">These credentials are represented as chains of [X.509 certificates](https://www.ietf.org/rfc/rfc2511.txt) called Group Membership Certificates (GMC).</span></span>

<span data-ttu-id="b5ac4-114">Чтобы создать ГМК для однорангового удостоверения, необходимо сначала получить его открытый ключ.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-114">To create the GMC for a peer identity, you must first obtain its public key.</span></span> <span data-ttu-id="b5ac4-115">Этот ключ получается путем вызова [**пиридентитижетксмл**](/windows/desktop/api/P2P/nf-p2p-peeridentitygetxml) на потенциальном приглашении и передачи его удостоверения однорангового узла.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-115">This key is obtained by calling [**PeerIdentityGetXML**](/windows/desktop/api/P2P/nf-p2p-peeridentitygetxml) on the potential invitee and passing in its peer identity.</span></span> <span data-ttu-id="b5ac4-116">Эта функция возвращает сертификат в кодировке Base-64, содержащий открытый ключ RSA, используемый для создания ГМК для удостоверения однорангового узла (помимо прочего), инкапсулированного в большой двоичный объект XML, в следующем формате:</span><span class="sxs-lookup"><span data-stu-id="b5ac4-116">This function returns a base-64 encoded certificate (IDC) that contains the RSA public key used to create the GMC for the peer identity (among other things), encapsulated in an XML blob, in the following format:</span></span>

``` syntax
<PEERIDENTITYINFO VERSION="1.0">
     <IDC xmlns:dt="urn:schemas-microsoft-com:datatypes" dt:dt="bin.base64">
          <!-- Base-64 encoded certificate  -->
     </IDC>
</PEERIDENTITYINFO>
```

<span data-ttu-id="b5ac4-117">Эту строку можно передать в [**пирграупкреатеинвитатион**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation), которая возвращает приглашение, содержащее ГМК для этого удостоверения однорангового узла.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-117">This string can be passed to [**PeerGroupCreateInvitation**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation), which returns an invitation that contains the GMC for that peer identity.</span></span> <span data-ttu-id="b5ac4-118">Приглашение должно быть передано приглашению с помощью другого процесса, например электронной почты, FTP или защищенного файлового ресурса.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-118">The invitation must be passed to the invitee using a different process such as e-mail, FTP, or a secure file share.</span></span>

<span data-ttu-id="b5ac4-119">В качестве альтернативы можно разместить IDC в новой структуре [**\_ \_ сведений об учетных данных одноранговых узлов**](/windows/desktop/api/P2P/ns-p2p-peer_credential_info) и передать ее в [**пирграуписсуекредентиалс**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials), что также создает приглашение.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-119">Alternatively, the IDC itself can be placed in a new [**PEER\_CREDENTIAL\_INFO**](/windows/desktop/api/P2P/ns-p2p-peer_credential_info) structure and passed to [**PeerGroupIssueCredentials**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials), which likewise generates an invitation.</span></span>

<span data-ttu-id="b5ac4-120">Обратите внимание, что приложениям запрещено добавлять теги внутри тега **пиридентитинфо** или изменять этот фрагмент XML каким-либо образом.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-120">Note that applications are not allowed to add tags within the **PEERIDENTITYINFO** tag or modify this XML fragment in any way.</span></span> <span data-ttu-id="b5ac4-121">Приложениям разрешено включать этот фрагмент XML в другие XML-документы, но перед передачей этого фрагмента в функции [**пирграупкреатеинвитатион**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) или [**пирграуписсуекредентиалс**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials) необходимо извлечь все зависящие от приложения XML.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-121">Applications are allowed to incorporate this XML fragment into other XML documents, but must strip out all application-specific XML before passing this fragment to the [**PeerGroupCreateInvitation**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) or [**PeerGroupIssueCredentials**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials) functions.</span></span>

<span data-ttu-id="b5ac4-122">Члены Гмкс выдаются администраторами и создателем одноранговой группы.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-122">Member GMCs are issued by administrators and the peer group creator.</span></span> <span data-ttu-id="b5ac4-123">Участники должны получить новые Гмкс с расширенным временем существования их Гмкс до момента истечения срока действия.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-123">Members must obtain new GMCs with extended lifetimes their GMCs before the expiration time has passed.</span></span> <span data-ttu-id="b5ac4-124">Администратор одноранговой группы выдает обновленные учетные данные, вызывая [**пирграуписсуекредентиалс**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials) с существующими учетными данными для этого узла.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-124">The peer group administrator issues updated credentials by calling [**PeerGroupIssueCredentials**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials) with the existing credentials for that peer.</span></span>

<span data-ttu-id="b5ac4-125">Структура [**\_ \_ сведений об учетных данных одноранговых узлов**](/windows/desktop/api/P2P/ns-p2p-peer_credential_info) содержит основные данные о состоянии членства однорангового узла, включая открытый ключ для их ГМК.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-125">The [**PEER\_CREDENTIAL\_INFO**](/windows/desktop/api/P2P/ns-p2p-peer_credential_info) structure contains the basic data on a peer's membership status, including the public key for their GMC.</span></span> <span data-ttu-id="b5ac4-126">Новые учетные данные можно опубликовать в одноранговой группе, установив \_ \_ флаг учетных данных для хранилища одноранговых групп \_ в вызове [**пирграуписсуекредентиалс**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials).</span><span class="sxs-lookup"><span data-stu-id="b5ac4-126">Newly-issued credentials can be published to the peer group by setting the PEER\_GROUP\_STORE\_CREDENTIALS flag in the call to [**PeerGroupIssueCredentials**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials).</span></span> <span data-ttu-id="b5ac4-127">Когда получатель новых учетных данных присоединяется к одноранговой группе, существующие учетные данные будут обновлены инфраструктурой однорангового группирования.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-127">When the recipient of the new credentials joins the peer group, it's existing credentials will be updated by the Peer Grouping Infrastructure.</span></span>

## <a name="issuing-an-invitation"></a><span data-ttu-id="b5ac4-128">Выдача приглашения</span><span class="sxs-lookup"><span data-stu-id="b5ac4-128">Issuing an Invitation</span></span>

<span data-ttu-id="b5ac4-129">Участник приглашен на присоединение к одноранговой группе одним из следующих двух способов:</span><span class="sxs-lookup"><span data-stu-id="b5ac4-129">A member is invited to join the peer group in one of the following two ways:</span></span>

-   <span data-ttu-id="b5ac4-130">Администратор одноранговой группы вызывает [**пирграупкреатеинвитатион**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation), передавая строку XML со сведениями об удостоверениях, полученную из потенциальных приглашений, с помощью общего механизма, такого как электронная почта или сеанс обмена мгновенными сообщениями.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-130">A peer group administrator calls [**PeerGroupCreateInvitation**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation), passing in the identity information XML string obtained from the potential invitee via a common out-of-band mechanism, such as email or an IM session.</span></span> <span data-ttu-id="b5ac4-131">Приглашение также передается через некоторый внешний процесс или механизм одноранговому узлу, который в конечном итоге получает его в виде XML-строки или текстового файла.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-131">The invitation is also passed through some external process or mechanism to the peer, who will ultimately receive it as an XML string or text file.</span></span>
-   <span data-ttu-id="b5ac4-132">Администратор одноранговой группы вызывает [**пирграуписсуекредентиалс**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials).</span><span class="sxs-lookup"><span data-stu-id="b5ac4-132">A peer group administrator calls [**PeerGroupIssueCredentials**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials).</span></span> <span data-ttu-id="b5ac4-133">Чтобы использовать эту функцию, узел должен уже публиковать сведения о членстве в одноранговой группе ([**одноранговый \_ член**](/windows/desktop/api/P2P/ns-p2p-peer_member)) или иметь доступный открытый ключ (пары ключей RSA, используемый для создания удостоверения субъекта).</span><span class="sxs-lookup"><span data-stu-id="b5ac4-133">To use this function, the peer must have already published membership information to the peer group ([**PEER\_MEMBER**](/windows/desktop/api/P2P/ns-p2p-peer_member)), or have an available public key (of the RSA key pair used to create the subject identity).</span></span> <span data-ttu-id="b5ac4-134">В первом случае структура одноранговых [**\_ \_ сведений об учетных данных**](/windows/desktop/api/P2P/ns-p2p-peer_credential_info) , необходимая для **пирграуписсуекредентиалс** , может быть получена из структуры **одноранговых \_ членов** . в последнем случае новая структура **\_ учетных данных \_ однорангового узла** может быть заполнена открытым ключом.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-134">In the former case, the [**PEER\_CREDENTIAL\_INFO**](/windows/desktop/api/P2P/ns-p2p-peer_credential_info) structure required for **PeerGroupIssueCredentials** can be obtained from the **PEER\_MEMBER** structure; in the latter case, a new **PEER\_CREDENTIAL\_INFO** structure can be populated with the public key.</span></span>

<span data-ttu-id="b5ac4-135">После получения строки приглашения одноранговая группа передает ее в [**пирграупжоин**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) для присоединения к одноранговой группе.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-135">After receiving the invitation string, the peer passes it to [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) to join the peer group.</span></span> <span data-ttu-id="b5ac4-136">Если вызов **пирграупжоин** успешно выполнен, узел может позже открыть одноранговую группу, вызвав [**пирграупопен**](/windows/desktop/api/P2P/nf-p2p-peergroupopen).</span><span class="sxs-lookup"><span data-stu-id="b5ac4-136">If the call to **PeerGroupJoin** is successful, the peer can later open the peer group by calling [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen).</span></span>

## <a name="parsing-an-invitation"></a><span data-ttu-id="b5ac4-137">Анализ приглашения</span><span class="sxs-lookup"><span data-stu-id="b5ac4-137">Parsing an Invitation</span></span>

<span data-ttu-id="b5ac4-138">При необходимости можно проанализировать приглашение, вызвав [**пирграуппарсеинвитатион**](/windows/desktop/api/P2P/nf-p2p-peergroupparseinvitation), который возвращает структуру [**\_ \_ сведений о приглашении однорангового узла**](/windows/desktop/api/P2P/ns-p2p-peer_invitation_info) .</span><span class="sxs-lookup"><span data-stu-id="b5ac4-138">Optionally, an invitation can be parsed by calling [**PeerGroupParseInvitation**](/windows/desktop/api/P2P/nf-p2p-peergroupparseinvitation), which returns a [**PEER\_INVITATION\_INFO**](/windows/desktop/api/P2P/ns-p2p-peer_invitation_info) structure.</span></span> <span data-ttu-id="b5ac4-139">Поля в структуре можно легко получить в целях показа.</span><span class="sxs-lookup"><span data-stu-id="b5ac4-139">The fields in the structure can be easily obtained for display purposes.</span></span>

 

 



