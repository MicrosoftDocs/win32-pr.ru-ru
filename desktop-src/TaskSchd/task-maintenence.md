---
title: Автоматическое обслуживание (планировщик задач)
description: Действие обслуживания относится к приложению или процессу, которое помогает поддерживать работоспособность и производительность компьютера Windows.
ms.assetid: 1D38341B-15AA-422F-AED1-647FCDE69E2E
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 456383eeb75c3b29bf575357d4b17d5f8a66234b
ms.sourcegitcommit: 857e701bbd35004661bb047e1f24622af9ff1dd7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/19/2020
ms.locfileid: "104414032"
---
# <a name="automatic-maintenance"></a><span data-ttu-id="cd63e-103">Автоматическое обслуживание</span><span class="sxs-lookup"><span data-stu-id="cd63e-103">Automatic maintenance</span></span>

<span data-ttu-id="cd63e-104">Действие обслуживания относится к приложению или процессу, которое помогает поддерживать работоспособность и производительность компьютера Windows.</span><span class="sxs-lookup"><span data-stu-id="cd63e-104">Maintenance activity refers to an application or process that helps maintain the health and performance of a Windows PC.</span></span> <span data-ttu-id="cd63e-105">Обслуживание включает в себя поддержание актуальности операционной системы Windows (ОС) и приложений, проверку безопасности и выполнение проверок на наличие вредоносных программ.</span><span class="sxs-lookup"><span data-stu-id="cd63e-105">Maintenance includes keeping the Windows operating system (OS) and applications up-to-date, checking security, and running scans for malware.</span></span> <span data-ttu-id="cd63e-106">Автоматическое управление Windows (WAM) — это набор усовершенствований API планировщик задач, которые можно использовать для связывания приложений с расписанием обслуживания Windows.</span><span class="sxs-lookup"><span data-stu-id="cd63e-106">Windows Automatic Management (WAM) is a set of enhancements to the Task Scheduler API that you can use to link your applications into the Windows maintenance schedule.</span></span> <span data-ttu-id="cd63e-107">В частности, WAM позволяет добавлять действия, требующие регулярного планирования, но не имеющие точных требований к времени.</span><span class="sxs-lookup"><span data-stu-id="cd63e-107">Specifically, WAM allows you to add activities that require regular scheduling, but that don't have exact time requirements.</span></span> <span data-ttu-id="cd63e-108">Вместо этого WAM полагается на операционную систему, чтобы выбрать подходящее время для активации задачи в течение дня.</span><span class="sxs-lookup"><span data-stu-id="cd63e-108">Instead, WAM relies on the operating system to choose the appropriate time to activate the task throughout the day.</span></span> <span data-ttu-id="cd63e-109">Система выбирает эти моменты в зависимости от минимального воздействия на пользователя, производительности ПК и эффективности энергопотребления.</span><span class="sxs-lookup"><span data-stu-id="cd63e-109">The system chooses those times based on minimal impact to the user, PC performance, and energy efficiency.</span></span>

## <a name="how-scheduled-maintenance-works"></a><span data-ttu-id="cd63e-110">Как работает плановое обслуживание</span><span class="sxs-lookup"><span data-stu-id="cd63e-110">How scheduled maintenance works</span></span>

<span data-ttu-id="cd63e-111">Задачи обслуживания планировщик задач — это уступающей задачи, выполняемые при простое компьютера и питании от сети.</span><span class="sxs-lookup"><span data-stu-id="cd63e-111">Task Scheduler maintenance tasks are opportunistic tasks that run when the machine is idle and on AC power.</span></span> <span data-ttu-id="cd63e-112">Одна из основных целей задач обслуживания заключается в том, чтобы снизить влияние на ПК, планируя обслуживание только в том случае, если ПК подключен к питанию от сети и простою (т. е. Если вы не используете или не выполнили шаг с компьютером).</span><span class="sxs-lookup"><span data-stu-id="cd63e-112">One of the major goals of maintenance tasks is to minimize impact to the PC by scheduling maintenance only when the PC is plugged in to AC power and idle (that is, when you're not using, or have stepped away from, the machine).</span></span> <span data-ttu-id="cd63e-113">Идея обслуживания сегодня заключается в том, чтобы компьютер работал с минимальными нарушениями работы пользователя.</span><span class="sxs-lookup"><span data-stu-id="cd63e-113">The idea of maintenance today is for the machine to do work with the least disruption to the user.</span></span> <span data-ttu-id="cd63e-114">Поэтому для использования этих периодов простоев в этом разделе мы улучшили час обслуживания в старом стиле (мы поговорим подробнее об этом в разделе « **&mdash; ежедневное пробуждение автоматического обслуживания** » ниже).</span><span class="sxs-lookup"><span data-stu-id="cd63e-114">Hence the old-style maintenance hour (we talk more about this in the **Automatic maintenance&mdash;daily wakeup** section later in this topic) has been improved in order to take advantage of these idle periods.</span></span> <span data-ttu-id="cd63e-115">Хотя часы обслуживания по-прежнему можно использовать, выполнение оппортунистической обслуживания лучше для обеспечения работоспособности системы.</span><span class="sxs-lookup"><span data-stu-id="cd63e-115">While the maintenance hour can still be leveraged, running opportunistic maintenance is better for system health.</span></span>

<span data-ttu-id="cd63e-116">Ваша задача может быть недоступна, если компьютер не тратит много времени на время простоя и при питании от сети.</span><span class="sxs-lookup"><span data-stu-id="cd63e-116">Your task may be starved if a machine doesn't spend much time both idle and on AC power.</span></span> <span data-ttu-id="cd63e-117">Убедитесь, что ваш сценарий по-прежнему предоставит пользователю значение, даже если оно отложено.</span><span class="sxs-lookup"><span data-stu-id="cd63e-117">Make sure that your scenario will still provide value to the user, even if it is delayed.</span></span> <span data-ttu-id="cd63e-118">Если пользователь активно использует компьютер, система откладывает обслуживание до последующего времени.</span><span class="sxs-lookup"><span data-stu-id="cd63e-118">If the user is actively using the machine, then the system defers maintenance until a later time.</span></span> <span data-ttu-id="cd63e-119">Система также приостанавливает выполнение любой задачи обслуживания, если пользователь возвращается к использованию компьютера.</span><span class="sxs-lookup"><span data-stu-id="cd63e-119">The system also suspends any executing maintenance task if the user returns to using the PC.</span></span>

<span data-ttu-id="cd63e-120">Система перезапускает приостановленную задачу обслуживания во время следующего периода простоя; Однако система не приостанавливает ни одну задачу, помеченную как критическая.</span><span class="sxs-lookup"><span data-stu-id="cd63e-120">The system restarts a suspended maintenance task during the next idle period; however, the system won't suspend any task marked as critical.</span></span> <span data-ttu-id="cd63e-121">Вместо этого система позволяет выполнить критическую задачу, независимо от действий пользователя.</span><span class="sxs-lookup"><span data-stu-id="cd63e-121">Instead, the system allows a critical task to complete, regardless of user action.</span></span>

<span data-ttu-id="cd63e-122">Из-за особенностей планирования некоторые запланированные задачи могут не завершиться: возможно, имеется слишком много запланированных событий, которые помещаются в течение периода обслуживания в 1 час, или, возможно, компьютер просто не был включен.</span><span class="sxs-lookup"><span data-stu-id="cd63e-122">Due to the nature of scheduling, some scheduled tasks may not finish: perhaps there are too many scheduled events to fit into the 1-hour maintenance window, or maybe the computer was simply not turned on.</span></span> <span data-ttu-id="cd63e-123">В таких случаях можно определить задачу с крайним сроком.</span><span class="sxs-lookup"><span data-stu-id="cd63e-123">In such cases, you can define a task with a deadline.</span></span> <span data-ttu-id="cd63e-124">Крайний срок определяется как повторяющийся период времени, в течение которого система должна успешно выполнять задачу по крайней мере один раз.</span><span class="sxs-lookup"><span data-stu-id="cd63e-124">A deadline is defined as a recurring timeframe in which the system must successfully perform the task at least once.</span></span>

<span data-ttu-id="cd63e-125">Если задача пропустила крайний срок, планировщик обслуживания по-прежнему будет пытаться выполнить эту задачу в течение периода обслуживания.</span><span class="sxs-lookup"><span data-stu-id="cd63e-125">If a task misses a deadline, then the maintenance scheduler will continue to attempt to execute the task during the maintenance window.</span></span> <span data-ttu-id="cd63e-126">Кроме того, планировщик не будет ограничиваться обычным временем в 1 час.</span><span class="sxs-lookup"><span data-stu-id="cd63e-126">Further, the scheduler will not limit itself to the regular 1-hour time limit.</span></span> <span data-ttu-id="cd63e-127">Вместо этого планировщик увеличивает длительность периода обслуживания, чтобы завершить отложенную задачу.</span><span class="sxs-lookup"><span data-stu-id="cd63e-127">Instead, the scheduler extends the duration of the maintenance window in order to complete the delayed task.</span></span>

<span data-ttu-id="cd63e-128">После того, как система завершит задачу (даже с кодом ошибки ошибки), попытка считается успешной.</span><span class="sxs-lookup"><span data-stu-id="cd63e-128">Once the system completes the task (even with a failure error code), the attempt is considered successful.</span></span> <span data-ttu-id="cd63e-129">После успешной попытки планировщик сбрасывается до регулярного расписания обслуживания и попытается выполнить задачу в течение следующего периода.</span><span class="sxs-lookup"><span data-stu-id="cd63e-129">After a successful attempt, the scheduler resets to the regular maintenance schedule, and will attempt the task during the next period.</span></span>

## <a name="automatic-maintenancemdashdaily-wakeup"></a><span data-ttu-id="cd63e-130">&mdash;Ежедневное пробуждение автоматического обслуживания</span><span class="sxs-lookup"><span data-stu-id="cd63e-130">Automatic maintenance&mdash;daily wakeup</span></span>

<span data-ttu-id="cd63e-131">В Windows 7 задача обслуживания выполняется исключительно в течение *часа обслуживания*, по умолчанию — до 3 am и настраивается с помощью групповая политика.</span><span class="sxs-lookup"><span data-stu-id="cd63e-131">On Windows 7, a maintenance task runs exclusively during *maintenance hour*, defaulting to 3 AM, and configurable via Group Policy.</span></span> <span data-ttu-id="cd63e-132">Компьютер будет выходить из режима ожидания, выполнять задачи обслуживания и вернуться в спящий режим.</span><span class="sxs-lookup"><span data-stu-id="cd63e-132">The machine would wake up from standby, run maintenance tasks, and go back to sleep.</span></span> <span data-ttu-id="cd63e-133">Этот ежедневный сеанс был ограничен максимальным продолжительностью в 1 час на попытку.</span><span class="sxs-lookup"><span data-stu-id="cd63e-133">This daily session was limited to a maximum duration of 1 hour per attempt.</span></span> <span data-ttu-id="cd63e-134">Это позволит системе выполнять обслуживание ежедневно, начиная с 3 AM по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="cd63e-134">This would allow the system to perform maintenance daily, starting at 3 AM by default.</span></span> <span data-ttu-id="cd63e-135">Обратите внимание, что пользователь может повторно запланировать время активации обслуживания, настроив эти параметры.</span><span class="sxs-lookup"><span data-stu-id="cd63e-135">Note that the user may re-schedule the time that the maintenance is triggered by configuring these settings.</span></span>

<span data-ttu-id="cd63e-136">С появлением ноутбуков и значительных затрат на время работы от аккумулятора компьютеры больше не настроены на разрешение пробуждения S3 в большинстве случаев и обычно дозе в режим гибернации как можно скорее, чтобы сэкономить батарею.</span><span class="sxs-lookup"><span data-stu-id="cd63e-136">With the advent of laptops, and the heavy focus on battery life, machines are no longer configured to allow S3 wakeup in most circumstances, and generally Doze-To-S4 (hibernate) as soon as possible, to save battery.</span></span> <span data-ttu-id="cd63e-137">В ответ на эти изменения планировщик задач (> Win7) запускает задачи обслуживания, когда они загружаются, а компьютер находится в состоянии простоя и находится на питании от сети.</span><span class="sxs-lookup"><span data-stu-id="cd63e-137">In response to these changes, Task Scheduler (> Win7) runs maintenance tasks whenever they are due, and the machine is idle and on AC power.</span></span>

<span data-ttu-id="cd63e-138">Этот параметр можно настроить на панели управления.</span><span class="sxs-lookup"><span data-stu-id="cd63e-138">This setting can be configured in Control Panel.</span></span>

<span data-ttu-id="cd63e-139">Откройте **Панель управления**  >  **система и** Управление безопасностью  >  **и обслуживание**  >  **Автоматическое обслуживание**.</span><span class="sxs-lookup"><span data-stu-id="cd63e-139">Open **Control Panel** > **System and Security** > **Security and Maintenance** > **Automatic Maintenance**.</span></span>

<span data-ttu-id="cd63e-140">В зависимости от того, как настроены ваши компьютеры и задачи, ежедневное поведение пробуждения может не произойти в сегодняшний день, как ожидалось в результате этой новой конфигурации.</span><span class="sxs-lookup"><span data-stu-id="cd63e-140">So based on how your machines and your tasks are configured, the daily wakeup behavior may not occur today as expected because of this new configuration.</span></span> <span data-ttu-id="cd63e-141">Сначала можно определить, поддерживает ли компьютер режим S3 или протокол CS (с подключением).</span><span class="sxs-lookup"><span data-stu-id="cd63e-141">You can first determine whether your machine is S3 capable or CS (Connected Standby) capable.</span></span>
<span data-ttu-id="cd63e-142">Это можно сделать, открыв командную строку Power Shell с повышенными привилегиями и выполнив следующую команду.</span><span class="sxs-lookup"><span data-stu-id="cd63e-142">This can be done by opening an elevated power shell prompt, and running the following command.</span></span>

```console
powercfg /a
```

<span data-ttu-id="cd63e-143">Час обслуживания, если компьютер настроен правильно, все равно работает, но если нет,</span><span class="sxs-lookup"><span data-stu-id="cd63e-143">Maintenance hour, if the machine is configured correctly, still works, but if it doesn't,</span></span>
  - <span data-ttu-id="cd63e-144">Проверьте параметры BIOS для параметров пробуждения.</span><span class="sxs-lookup"><span data-stu-id="cd63e-144">Check your BIOS settings for Wake settings.</span></span> 
  - <span data-ttu-id="cd63e-145">Проверьте, включен ли параметр Разрешить таймер пробуждения в окне "Параметры электропитания".</span><span class="sxs-lookup"><span data-stu-id="cd63e-145">Check whether Allow Wake Timer is enabled in Power Options.</span></span>
    <span data-ttu-id="cd63e-146">Последовательно выберите пункты **Панель управления**  >  **оборудование и звук**  >  **Параметры электропитания**  >  **изменить параметры плана**  >  **изменить дополнительные параметры питания** > щелкните **спящий режим**  >  **Разрешить таймер пробуждения**.</span><span class="sxs-lookup"><span data-stu-id="cd63e-146">Go to **Control Panel** > **Hardware and Sound** > **Power Options** > **Edit Plan Settings** > **Change advanced power settings** > click **Sleep** > **Allow Wake Timer**.</span></span>
  - <span data-ttu-id="cd63e-147">Проверьте, настроена ли для запланированной задачи Следующая настройка.</span><span class="sxs-lookup"><span data-stu-id="cd63e-147">Check whether your scheduled task is configured with following.</span></span>
      * <span data-ttu-id="cd63e-148">Маинтенанцесеттингс: для задачи необходимо настроить период, крайний срок.</span><span class="sxs-lookup"><span data-stu-id="cd63e-148">MaintenanceSettings: Task should be configured with Period, Deadline.</span></span>
      * <span data-ttu-id="cd63e-149">Включено: задача должна быть включена.</span><span class="sxs-lookup"><span data-stu-id="cd63e-149">Enabled: Task should be enabled.</span></span>
      * <span data-ttu-id="cd63e-150">Вакеторун: задаче должно быть разрешено пробудить компьютер.</span><span class="sxs-lookup"><span data-stu-id="cd63e-150">WakeToRun: Task should be allowed to wake the machine.</span></span>
  - <span data-ttu-id="cd63e-151">Для планирования пробуждения из CS необходимо, чтобы компьютер АОАК.</span><span class="sxs-lookup"><span data-stu-id="cd63e-151">For scheduling wakes from CS, the machine should be AOAC capable.</span></span>
  - <span data-ttu-id="cd63e-152">Для планирования пробуждения на компьютерах S3</span><span class="sxs-lookup"><span data-stu-id="cd63e-152">For scheduling wakes in S3 machines,</span></span>
      * <span data-ttu-id="cd63e-153">Проверьте, перешла ли компьютер в режим S3 при питании от сети.</span><span class="sxs-lookup"><span data-stu-id="cd63e-153">Check whether the machine went into S3 on AC Power.</span></span>
      * <span data-ttu-id="cd63e-154">Система должна **Включить Wake** в групповая политика для обслуживания.</span><span class="sxs-lookup"><span data-stu-id="cd63e-154">The system should have **Wake Enabled** in Group Policy for Maintenance.</span></span>
 
<span data-ttu-id="cd63e-155">Подключенный ждущий режим — это состояние системы, которое может войти в систему, совместимую с АОАК.</span><span class="sxs-lookup"><span data-stu-id="cd63e-155">Connected Standby is the system state that an AOAC-compliant system can enter.</span></span>

<span data-ttu-id="cd63e-156">Ознакомьтесь с различиями между современными ждущими и S3 в разделе [современные резервные VS и S3](/windows-hardware/design/device-experiences/modern-standby-vs-s3).</span><span class="sxs-lookup"><span data-stu-id="cd63e-156">See differences between Modern Standby and S3 in the topic [Modern Standby vs S3](/windows-hardware/design/device-experiences/modern-standby-vs-s3).</span></span>

## <a name="defining-an-automatic-maintenance-task"></a><span data-ttu-id="cd63e-157">Определение задачи автоматического обслуживания</span><span class="sxs-lookup"><span data-stu-id="cd63e-157">Defining an Automatic Maintenance Task</span></span>

<span data-ttu-id="cd63e-158">Любую планировщик задачную задачу можно преобразовать в задачу обслуживания.</span><span class="sxs-lookup"><span data-stu-id="cd63e-158">You can convert any Task Scheduler task to a maintenance task.</span></span> <span data-ttu-id="cd63e-159">Для этого необходимо убедиться, что приложение можно приостановить.</span><span class="sxs-lookup"><span data-stu-id="cd63e-159">To do so, you must confirm that your application can be suspended.</span></span> <span data-ttu-id="cd63e-160">Затем необходимо расширить определение задачи с помощью новых элементов [**маинтенанцесеттингс**](taskschedulerschema-maintenancesettings-maintenancesettingstype-element.md) и [**алловстартондеманд**](taskschedulerschema-allowstartondemand-settingstype-element.md) .</span><span class="sxs-lookup"><span data-stu-id="cd63e-160">Then, you must extend the task definition with the new [**MaintenanceSettings**](taskschedulerschema-maintenancesettings-maintenancesettingstype-element.md) and [**AllowStartOnDemand**](taskschedulerschema-allowstartondemand-settingstype-element.md) elements.</span></span>

<span data-ttu-id="cd63e-161">Основная проблема при создании задачи обслуживания заключается в том, что система может приостановить и перезапустить задачу.</span><span class="sxs-lookup"><span data-stu-id="cd63e-161">The main concern with creating a maintenance task is ensuring that the system can suspend and restart the task.</span></span> <span data-ttu-id="cd63e-162">Скорее всего, система будет приостанавливать задачу обслуживания несколько раз; Поэтому необходимо убедиться, что приложение может сохранить свое собственное состояние, а затем возобновить его в произвольный момент времени.</span><span class="sxs-lookup"><span data-stu-id="cd63e-162">The system will likely suspend a maintenance task multiple times; therefore, you need to ensure that your application is able to save its own state, and then resume at an arbitrary time.</span></span> <span data-ttu-id="cd63e-163">Это гарантирует, что система не будет многократно выполнять одну и ту же часть задачи.</span><span class="sxs-lookup"><span data-stu-id="cd63e-163">This ensures that the system does not perform the same part of your task repeatedly.</span></span>

<span data-ttu-id="cd63e-164">После того как вы убедитесь, что приложение может быть приостановлено и возобновлено надлежащим образом, можно использовать элементы **маинтенанцесеттингс** и **алловстартондеманд** , чтобы определить расписание.</span><span class="sxs-lookup"><span data-stu-id="cd63e-164">Once you have ensured that your application can be suspended and resumed gracefully, you can use the **MaintenanceSettings** and **AllowStartOnDemand** elements to define the schedule.</span></span> <span data-ttu-id="cd63e-165">**Маинтенанцесеттингс** определяется в соответствии с периодом, крайним сроком и исключительные права.</span><span class="sxs-lookup"><span data-stu-id="cd63e-165">**MaintenanceSettings** is defined according to the period, deadline, and exclusivity.</span></span>

-   <span data-ttu-id="cd63e-166">Этот **период** является обязательным и определяет, как часто должна выполняться задача.</span><span class="sxs-lookup"><span data-stu-id="cd63e-166">The **period** is mandatory, and defines how often the task should occur.</span></span> <span data-ttu-id="cd63e-167">Обычно это определяется в рамках многодневного цикла, например "один раз в 5 дней".</span><span class="sxs-lookup"><span data-stu-id="cd63e-167">Usually, this is defined in terms of a multi-day cycle, such as “once every 5 days”.</span></span> <span data-ttu-id="cd63e-168">Период должен составлять по крайней мере один день, то есть вы не можете запланировать выполнение задачи несколько раз в день.</span><span class="sxs-lookup"><span data-stu-id="cd63e-168">A period must be at least one day, meaning that you can't schedule a task to occur multiple times in a day.</span></span>
-   <span data-ttu-id="cd63e-169">**Крайний срок** является необязательным и определяет, сколько времени планировщик может завершить задачу, прежде чем уведомлять пользователя или выполнять аварийное обслуживание.</span><span class="sxs-lookup"><span data-stu-id="cd63e-169">The **deadline** is optional, and defines how long the scheduler can fail to complete the task before notifying the user or performing emergency maintenance.</span></span> <span data-ttu-id="cd63e-170">Крайний срок должен быть больше периода, что означает, что система должна иметь возможность выполнять задачу по крайней мере один раз перед уведомлением пользователя.</span><span class="sxs-lookup"><span data-stu-id="cd63e-170">The deadline must be longer than the period, meaning that the system must have the opportunity to attempt the task at least once before notifying the user.</span></span>
-   <span data-ttu-id="cd63e-171">Кроме того, задача обслуживания может быть определена как *монопольная*.</span><span class="sxs-lookup"><span data-stu-id="cd63e-171">In addition, a maintenance task can optionally be defined as *exclusive*.</span></span> <span data-ttu-id="cd63e-172">Монопольная задача выполняется отдельно от других задач обслуживания.</span><span class="sxs-lookup"><span data-stu-id="cd63e-172">An exclusive task runs separate from other maintenance tasks.</span></span> <span data-ttu-id="cd63e-173">Обычно монопольная задача — это одна из задач, использующая большой объем ресурсов, таких как большое количество времени ЦП или монопольный доступ к базе данных.</span><span class="sxs-lookup"><span data-stu-id="cd63e-173">Usually, an exclusive task is one that uses a great deal of resources, such as a large amount of CPU time, or exclusive access to a database.</span></span> <span data-ttu-id="cd63e-174">Система завершает все неисключительные задачи обслуживания перед запуском монопольной задачи.</span><span class="sxs-lookup"><span data-stu-id="cd63e-174">The system completes all non-exclusive maintenance tasks before starting an exclusive task.</span></span> <span data-ttu-id="cd63e-175">Поэтому задачу следует объявлять как исключительную только при необходимости.</span><span class="sxs-lookup"><span data-stu-id="cd63e-175">Therefore, you should declare a task as exclusive only when necessary.</span></span>

<span data-ttu-id="cd63e-176">В отличие от этого, **алловстартондеманд** просто указывает, что система или пользователь может запустить задачу в любое время.</span><span class="sxs-lookup"><span data-stu-id="cd63e-176">In contrast, **AllowStartOnDemand** merely indicates that the system or the user can start the task at any time.</span></span> <span data-ttu-id="cd63e-177">Это позволяет системе запускать задачу во время регулярного обслуживания.</span><span class="sxs-lookup"><span data-stu-id="cd63e-177">This allows the system to start the task during regular maintenance.</span></span> <span data-ttu-id="cd63e-178">В противном случае необходимо задать уникальный триггер для задачи.</span><span class="sxs-lookup"><span data-stu-id="cd63e-178">Otherwise, you would have to set a unique trigger for the task.</span></span>
