---
title: Усиление безопасности задач
description: Использование функции усиления безопасности задач позволяет владельцам задач выполнять свои задачи с минимальными необходимыми привилегиями.
ms.assetid: ba03add5-aa05-4bef-baec-684ca17363bd
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0ab70679d605a9ad56c6d26116245ae17d41a7a1
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104253292"
---
# <a name="task-security-hardening"></a><span data-ttu-id="7ef24-103">Усиление безопасности задач</span><span class="sxs-lookup"><span data-stu-id="7ef24-103">Task Security Hardening</span></span>

<span data-ttu-id="7ef24-104">Использование функции усиления безопасности задач позволяет владельцам задач выполнять свои задачи с минимальными необходимыми привилегиями.</span><span class="sxs-lookup"><span data-stu-id="7ef24-104">Using the tasks security hardening feature will allow task owners to run their tasks with minimum required privileges.</span></span> <span data-ttu-id="7ef24-105">Обратите внимание, что эта функция включена по умолчанию, и владельцы задач могут вносить дальнейшие изменения с помощью массива идентификаторов безопасности маркера процесса задачи и необходимых прав задач.</span><span class="sxs-lookup"><span data-stu-id="7ef24-105">Note that this feature is enabled by default and task owners can make further adjustments by using the task process token security identifier type and task required privileges array.</span></span>

## <a name="task-process-token-sid-type-and-task-required-privileges-array"></a><span data-ttu-id="7ef24-106">Тип идентификатора безопасности маркера процесса задачи и массив необходимых привилегий для задачи</span><span class="sxs-lookup"><span data-stu-id="7ef24-106">Task Process Token SID Type and Task Required Privileges Array</span></span>

<span data-ttu-id="7ef24-107">Указание **процесстокенсидтипе** на уровне определения задачи позволяет владельцам задач запрашивать запуск процесса задачи с типом SID "None" или "Unrestricted".</span><span class="sxs-lookup"><span data-stu-id="7ef24-107">Specifying **ProcessTokenSidType** at the task definition level allows task owners to request a task process to run with the "none" SID type or the "unrestricted" SID type.</span></span> <span data-ttu-id="7ef24-108">Если поле имеется в определении задачи, проверка гарантирует, что задача UserId содержит имя или соответствующую строку идентификатора безопасности для одной из встроенных учетных записей службы: "СЕТЕВая служба" или "ЛОКАЛЬная служба".</span><span class="sxs-lookup"><span data-stu-id="7ef24-108">If the field is present in task definition, validation ensures that task UserId contains the name or the corresponding SID string for one of those operating system built-in service accounts: "NETWORK SERVICE" or "LOCAL SERVICE".</span></span>

<span data-ttu-id="7ef24-109">Тип SID "нет" означает, что задача выполняется в процессе, который не содержит идентификатор безопасности токена процесса (изменения в списке групп токенов процессов не вносятся).</span><span class="sxs-lookup"><span data-stu-id="7ef24-109">The SID type "none" means that the task runs in a process that does not contain a process token SID (no changes will be made to the process token groups list).</span></span> <span data-ttu-id="7ef24-110">Идентификатор безопасности учетной записи участника задачи (LocalService/NetworkService) в этом случае имеет полный доступ к маркеру процесса.</span><span class="sxs-lookup"><span data-stu-id="7ef24-110">The task principal account SID (LocalService/NetworkService) in that case has full access to the process token.</span></span>

<span data-ttu-id="7ef24-111">Тип SID "Unrestricted" означает, что идентификатор безопасности задачи будет производным от полного пути задачи и будет добавлен в список групп токенов процесса.</span><span class="sxs-lookup"><span data-stu-id="7ef24-111">The "unrestricted" SID type means that a task SID will be derived from the full task path and will be added to the process token groups list.</span></span> <span data-ttu-id="7ef24-112">Например, \\ \\ рактаск Microsoft Windows \\ RAC \\ , который выполняется в учетной записи Local Service, идентификатор безопасности задачи является производным от имени Microsoft-Windows-RAC-рактаск, где символ "-" заменяется на " \\ ", так как "" \\ является недопустимым знаком имени пользователя.</span><span class="sxs-lookup"><span data-stu-id="7ef24-112">For example, the \\Microsoft\\Windows\\RAC\\RACTask which runs in the Local Service account, the task SID is derived from the name Microsoft-Windows-RAC-RACTask where a "-" is substituted for a "\\" since "\\" is an invalid user name character.</span></span> <span data-ttu-id="7ef24-113">Хорошо известное имя группы для идентификатора безопасности задачи — «задача NT \\ <modified full task path> » ( \\ Формат имени пользователя имя_домена).</span><span class="sxs-lookup"><span data-stu-id="7ef24-113">The well known group name for the task SID would be "NT TASK\\<modified full task path>" (domainname\\username format).</span></span> <span data-ttu-id="7ef24-114">Список управления доступом по умолчанию для маркера процесса (DACL) также изменится, чтобы разрешить полный доступ для идентификатора SID задачи и ИД безопасности локальной системы, а также управлять доступом на уровне SID учетной записи участника задачи.</span><span class="sxs-lookup"><span data-stu-id="7ef24-114">The process token default discretionary access control list (DACL) will also be modified to allow full control for the task SID and local system SID only and read control to the task principal account SID.</span></span> <span data-ttu-id="7ef24-115">"schtasks.exe/шовсид/TN <full task path> " отобразит идентификатор безопасности задачи, соответствующий задаче.</span><span class="sxs-lookup"><span data-stu-id="7ef24-115">"schtasks.exe /showsid /tn <full task path>" will show the task SID that is corresponding to the task.</span></span>

<span data-ttu-id="7ef24-116">Когда запускается действие задачи, не относящегося к COM-сервером, подсистема планирования записывает в журнал учетной записи участника задачи, получает маркер процесса и запрашивает список привилегий, которые имеет маркер, а затем сравнивает его со списком привилегий, указанным в Рекуиредпривилежес.</span><span class="sxs-lookup"><span data-stu-id="7ef24-116">When a non-COM task action starts up, the scheduling engine logs on the task principal account, gets the process token and queries the list of privileges that the token has and then compares that with the privileges list specified in RequiredPrivileges.</span></span> <span data-ttu-id="7ef24-117">Если в последнем случае привилегия не указана, то она помечается как \_ привилегия SE \_ .</span><span class="sxs-lookup"><span data-stu-id="7ef24-117">If a privilege is not specified in the latter, then that is marked as SE\_PRIVILEGE\_REMOVED.</span></span> <span data-ttu-id="7ef24-118">Затем исполняемое действие будет запущено с результирующим маркером маркера с помощью API параметр CreateProcessAsUser.</span><span class="sxs-lookup"><span data-stu-id="7ef24-118">The executable action will then be started with the resulting token handle by using the CreateProcessAsUser API.</span></span>

<span data-ttu-id="7ef24-119">Когда запускается действие задачи COM, оно должно быть активировано taskhost.exe процессом.</span><span class="sxs-lookup"><span data-stu-id="7ef24-119">When a COM task action starts up, it must be activated by the taskhost.exe process.</span></span> <span data-ttu-id="7ef24-120">Механизм планирования запрашивает блок контекста каждого запущенного taskhost.exe с той же учетной записью, что и начальная задача.</span><span class="sxs-lookup"><span data-stu-id="7ef24-120">The scheduling engine queries the context block of each running taskhost.exe with the same account as the starting task.</span></span> <span data-ttu-id="7ef24-121">Если обнаруживается, что ведущий процесс был запущен с надмножеством привилегий, необходимых для запуска задачи, то эта задача будет размещена в этом процессе.</span><span class="sxs-lookup"><span data-stu-id="7ef24-121">If it finds that a host process was started with a superset of privileges that the starting task needs, then that task gets hosted in that process.</span></span> <span data-ttu-id="7ef24-122">Если такой процесс не найден, он объединяет сведения о усилении безопасности всех задач, выполняемых в серверов задач, под учетной записью участника задачи с указанной маской Рекуиредпривилежес, а затем запускает новый экземпляр taskhost.exe.</span><span class="sxs-lookup"><span data-stu-id="7ef24-122">If it does not find such a process, it combines the hardening info of all the tasks that are running in the taskhosts under the task principal account with the specified RequiredPrivileges mask and then starts up a new instance of taskhost.exe.</span></span>

<span data-ttu-id="7ef24-123">Если Рекуиредпривилежес отсутствует в определении задачи, для процесса задачи будут использоваться права доступа по умолчанию для учетной записи участника задачи без SeImpersonatePrivilege.</span><span class="sxs-lookup"><span data-stu-id="7ef24-123">If RequiredPrivileges is not present in the task definition, the default privileges of task principal account without the SeImpersonatePrivilege will be used for task process.</span></span> <span data-ttu-id="7ef24-124">Если **процесстокенсидтипе** отсутствует в определении задачи, в качестве значения по умолчанию используется "unrestricteded".</span><span class="sxs-lookup"><span data-stu-id="7ef24-124">If **ProcessTokenSidType** is not present in the task definition, "unrestricted" is used as the default.</span></span>

## <a name="related-topics"></a><span data-ttu-id="7ef24-125">См. также</span><span class="sxs-lookup"><span data-stu-id="7ef24-125">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="7ef24-126">Сведения о регистрации задачи</span><span class="sxs-lookup"><span data-stu-id="7ef24-126">Task Registration Information</span></span>](task-registration-information.md)
</dt> <dt>

[<span data-ttu-id="7ef24-127">Сведения о планировщик задач</span><span class="sxs-lookup"><span data-stu-id="7ef24-127">About The Task Scheduler</span></span>](about-the-task-scheduler.md)
</dt> <dt>

[<span data-ttu-id="7ef24-128">Контексты безопасности для задач</span><span class="sxs-lookup"><span data-stu-id="7ef24-128">Security Contexts for Tasks</span></span>](security-contexts-for-running-tasks.md)
</dt> </dl>

 

 




