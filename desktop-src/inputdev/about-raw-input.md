---
title: О необработанном вводе
description: В этом разделе обсуждаются пользовательские данные с устройств, таких как джойстики, сенсорные экраны и микрофоны.
ms.assetid: 013ed309-f667-47ed-ade0-5e7ca5a0997a
keywords:
- Ввод данных пользователем, необработанный ввод
- запись вводимых пользователем данных, необработанные входные данные
- необработанный ввод
- регистрация необработанных входных данных
- чтение необработанного ввода
- необработанные входные данные джойстика
- Ввод необработанного сенсорного экрана
- Ввод необработанного микрофона
- Устройство HID
- HID (устройство HID)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b3535e5601ec63a254c76060611999a1a2f08aeb
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104069997"
---
# <a name="about-raw-input"></a><span data-ttu-id="4c632-113">О необработанном вводе</span><span class="sxs-lookup"><span data-stu-id="4c632-113">About Raw Input</span></span>

<span data-ttu-id="4c632-114">Рядом с традиционной клавиатурой и мышью имеется много пользовательских устройств ввода.</span><span class="sxs-lookup"><span data-stu-id="4c632-114">There are many user-input devices beside the traditional keyboard and mouse.</span></span> <span data-ttu-id="4c632-115">Например, вводимые пользователем данные могут поступать из джойстика, сенсорного экрана, микрофона или других устройств, которые обеспечивают большую гибкость при вводе данных пользователем.</span><span class="sxs-lookup"><span data-stu-id="4c632-115">For example, user input can come from a joystick, a touch screen, a microphone, or other devices that allow great flexibility in user input.</span></span> <span data-ttu-id="4c632-116">Эти устройства в совокупности называются устройствами с человеческим интерфейсом (Хидс).</span><span class="sxs-lookup"><span data-stu-id="4c632-116">These devices are collectively known as Human Interface Devices (HIDs).</span></span> <span data-ttu-id="4c632-117">API необработанных входных данных обеспечивает устойчивый и надежный способ приема необработанных данных от любых HID-приложений, включая клавиатуру и мышь.</span><span class="sxs-lookup"><span data-stu-id="4c632-117">The raw input API provides a stable and robust way for applications to accept raw input from any HID, including the keyboard and mouse.</span></span>

<span data-ttu-id="4c632-118">В этом разделе описываются следующие темы:</span><span class="sxs-lookup"><span data-stu-id="4c632-118">This section covers the following topics:</span></span>

-   [<span data-ttu-id="4c632-119">Необработанная входная модель</span><span class="sxs-lookup"><span data-stu-id="4c632-119">Raw Input Model</span></span>](#raw-input-model)
-   [<span data-ttu-id="4c632-120">Регистрация для ввода необработанных данных</span><span class="sxs-lookup"><span data-stu-id="4c632-120">Registration for Raw Input</span></span>](#registration-for-raw-input)
-   [<span data-ttu-id="4c632-121">Чтение необработанного ввода</span><span class="sxs-lookup"><span data-stu-id="4c632-121">Reading Raw Input</span></span>](#reading-raw-input)

## <a name="raw-input-model"></a><span data-ttu-id="4c632-122">Необработанная входная модель</span><span class="sxs-lookup"><span data-stu-id="4c632-122">Raw Input Model</span></span>

<span data-ttu-id="4c632-123">Ранее, клавиатура и мышь, как правило, генерируют входные данные.</span><span class="sxs-lookup"><span data-stu-id="4c632-123">Previously, the keyboard and mouse typically generated input data.</span></span> <span data-ttu-id="4c632-124">Система интерпретирует данные, поступающие с этих устройств, таким образом, чтобы исключить сведения об необработанных данных для конкретных устройств.</span><span class="sxs-lookup"><span data-stu-id="4c632-124">The system interpreted the data coming from these devices in a way that eliminated the device-specific details of the raw information.</span></span> <span data-ttu-id="4c632-125">Например, клавиатура создает код проверки для конкретного устройства, но система предоставляет приложению код виртуального ключа.</span><span class="sxs-lookup"><span data-stu-id="4c632-125">For example, the keyboard generates the device-specific scan code but the system provides an application with the virtual key code.</span></span> <span data-ttu-id="4c632-126">Помимо скрытия сведений необработанного ввода, диспетчер окон не поддерживал все новые Хидс.</span><span class="sxs-lookup"><span data-stu-id="4c632-126">Besides hiding the details of the raw input, the window manager did not support all the new HIDs.</span></span> <span data-ttu-id="4c632-127">Чтобы получить входные данные из неподдерживаемого Хидс, приложению пришлось делать многие вещи: открыть устройство, управлять общим режимом, периодически читать устройство или настроить порт завершения ввода-вывода и т. д.</span><span class="sxs-lookup"><span data-stu-id="4c632-127">To get input from the unsupported HIDs, an application had to do many things: open the device, manage the shared mode, periodically read the device or set up the I/O completion port, and so forth.</span></span> <span data-ttu-id="4c632-128">Модель необработанных входных данных и соответствующие API были разработаны, чтобы обеспечить простой доступ к необработанным данным со всех устройств ввода, включая клавиатуру и мышь.</span><span class="sxs-lookup"><span data-stu-id="4c632-128">The raw input model and the associated APIs were developed to allow simple access to raw input from all input devices, including the keyboard and mouse.</span></span>

<span data-ttu-id="4c632-129">Необработанная входная модель отличается от исходной модели ввода Windows для клавиатуры и мыши.</span><span class="sxs-lookup"><span data-stu-id="4c632-129">The raw input model is different from the original Windows input model for the keyboard and mouse.</span></span> <span data-ttu-id="4c632-130">В исходной входной модели приложение получает ненезависимые от устройства входные данные в форме сообщений, которые отправляются или передаются в окнах, например [**WM \_ char**](wm-char.md), [**WM \_ MOUSEMOVE**](wm-mousemove.md)и [**WM \_ аппкомманд**](wm-appcommand.md).</span><span class="sxs-lookup"><span data-stu-id="4c632-130">In the original input model, an application receives device-independent input in the form of messages that are sent or posted to its windows, such as [**WM\_CHAR**](wm-char.md), [**WM\_MOUSEMOVE**](wm-mousemove.md), and [**WM\_APPCOMMAND**](wm-appcommand.md).</span></span> <span data-ttu-id="4c632-131">В отличие от необработанных входных данных приложение должно зарегистрировать устройства, из которых требуется получить данные.</span><span class="sxs-lookup"><span data-stu-id="4c632-131">In contrast, for raw input an application must register the devices it wants to get data from.</span></span> <span data-ttu-id="4c632-132">Кроме того, приложение получает необработанный ввод с помощью сообщения [**\_ ввода WM**](wm-input.md) .</span><span class="sxs-lookup"><span data-stu-id="4c632-132">Also, the application gets the raw input through the [**WM\_INPUT**](wm-input.md) message.</span></span>

<span data-ttu-id="4c632-133">Модель необработанных входных данных имеет несколько преимуществ.</span><span class="sxs-lookup"><span data-stu-id="4c632-133">There are several advantages to the raw input model:</span></span>

-   <span data-ttu-id="4c632-134">Приложению не требуется обнаруживать или открывать входное устройство.</span><span class="sxs-lookup"><span data-stu-id="4c632-134">An application does not have to detect or open the input device.</span></span>
-   <span data-ttu-id="4c632-135">Приложение получает данные непосредственно с устройства и обрабатывает их потребности.</span><span class="sxs-lookup"><span data-stu-id="4c632-135">An application gets the data directly from the device, and processes the data for its needs.</span></span>
-   <span data-ttu-id="4c632-136">Приложение может отличать источник входных данных, даже если он относится к одному типу устройства.</span><span class="sxs-lookup"><span data-stu-id="4c632-136">An application can distinguish the source of the input even if it is from the same type of device.</span></span> <span data-ttu-id="4c632-137">Например, два устройства мыши.</span><span class="sxs-lookup"><span data-stu-id="4c632-137">For example, two mouse devices.</span></span>
-   <span data-ttu-id="4c632-138">Приложение управляет трафиком данных путем указания данных из коллекции устройств или только конкретных типов устройств.</span><span class="sxs-lookup"><span data-stu-id="4c632-138">An application manages the data traffic by specifying data from a collection of devices or only specific device types.</span></span>
-   <span data-ttu-id="4c632-139">Устройства HID можно использовать по мере их появления в Marketplace, не дожидаясь поступления новых типов сообщений или обновленной операционной системы для использования новых команд в [**WM \_ аппкомманд**](wm-appcommand.md).</span><span class="sxs-lookup"><span data-stu-id="4c632-139">HID devices can be used as they become available in the marketplace, without waiting for new message types or an updated OS to have new commands in [**WM\_APPCOMMAND**](wm-appcommand.md).</span></span>

<span data-ttu-id="4c632-140">Обратите внимание, что [**WM \_ аппкомманд**](wm-appcommand.md) предоставляет для некоторых HID устройств.</span><span class="sxs-lookup"><span data-stu-id="4c632-140">Note that [**WM\_APPCOMMAND**](wm-appcommand.md) does provide for some HID devices.</span></span> <span data-ttu-id="4c632-141">Однако **WM \_ аппкомманд** — это независимое от устройства входное событие, а [**\_ Вход WM**](wm-input.md) отправляет необработанные данные низкого уровня, характерные для устройства.</span><span class="sxs-lookup"><span data-stu-id="4c632-141">However, **WM\_APPCOMMAND** is a higher level device-independent input event, while [**WM\_INPUT**](wm-input.md) sends raw, low level data that is specific to a device.</span></span>

## <a name="registration-for-raw-input"></a><span data-ttu-id="4c632-142">Регистрация для ввода необработанных данных</span><span class="sxs-lookup"><span data-stu-id="4c632-142">Registration for Raw Input</span></span>

<span data-ttu-id="4c632-143">По умолчанию приложение не получает необработанные входные данные.</span><span class="sxs-lookup"><span data-stu-id="4c632-143">By default, no application receives raw input.</span></span> <span data-ttu-id="4c632-144">Чтобы получить необработанные данные с устройства, приложение должно зарегистрировать устройство.</span><span class="sxs-lookup"><span data-stu-id="4c632-144">To receive raw input from a device, an application must register the device.</span></span>

<span data-ttu-id="4c632-145">Для регистрации устройств приложение сначала создает массив структур [**равинпутдевице**](/windows/win32/api/winuser/ns-winuser-rawinputdevice) , задающих [коллекцию верхнего уровня](/windows-hardware/drivers/hid/top-level-collections) (ТЛК) для нужных устройств.</span><span class="sxs-lookup"><span data-stu-id="4c632-145">To register devices, an application first creates an array of [**RAWINPUTDEVICE**](/windows/win32/api/winuser/ns-winuser-rawinputdevice) structures that specify the [top level collection](/windows-hardware/drivers/hid/top-level-collections) (TLC) for the devices it wants.</span></span> <span data-ttu-id="4c632-146">ТЛК определяется [страницей использования](/windows-hardware/drivers/hid/hid-usages#usage-page) (класс устройства) и [идентификатором использования](/windows-hardware/drivers/hid/hid-usages#usage-id) (устройством в классе).</span><span class="sxs-lookup"><span data-stu-id="4c632-146">The TLC is defined by a [Usage Page](/windows-hardware/drivers/hid/hid-usages#usage-page) (the class of the device) and a [Usage ID](/windows-hardware/drivers/hid/hid-usages#usage-id) (the device within the class).</span></span> <span data-ttu-id="4c632-147">Например, чтобы получить клавиатуру ТЛК, задайте Усажепаже = 0x01 и Усажеид = 0x06.</span><span class="sxs-lookup"><span data-stu-id="4c632-147">For example, to get the keyboard TLC, set UsagePage = 0x01 and UsageID = 0x06.</span></span> <span data-ttu-id="4c632-148">Приложение вызывает [**регистерравинпутдевицес**](/windows/win32/api/winuser/nf-winuser-registerrawinputdevices) для регистрации устройств.</span><span class="sxs-lookup"><span data-stu-id="4c632-148">The application calls [**RegisterRawInputDevices**](/windows/win32/api/winuser/nf-winuser-registerrawinputdevices) to register the devices.</span></span>

<span data-ttu-id="4c632-149">Обратите внимание, что приложение может зарегистрировать устройство, которое в настоящее время не подключено к системе.</span><span class="sxs-lookup"><span data-stu-id="4c632-149">Note that an application can register a device that is not currently attached to the system.</span></span> <span data-ttu-id="4c632-150">Когда устройство подключено, Диспетчер Windows автоматически отправляет необработанные входные данные в приложение.</span><span class="sxs-lookup"><span data-stu-id="4c632-150">When this device is attached, the Windows Manager will automatically send the raw input to the application.</span></span> <span data-ttu-id="4c632-151">Чтобы получить список устройств ввода необработанных данных в системе, приложение вызывает [**жетравинпутдевицелист**](/windows/win32/api/winuser/nf-winuser-getrawinputdevicelist).</span><span class="sxs-lookup"><span data-stu-id="4c632-151">To get the list of raw input devices on the system, an application calls [**GetRawInputDeviceList**](/windows/win32/api/winuser/nf-winuser-getrawinputdevicelist).</span></span> <span data-ttu-id="4c632-152">Используя *хдевице* из этого вызова, приложение вызывает [**жетравинпутдевицеинфо**](/windows/win32/api/winuser/nf-winuser-getrawinputdeviceinfoa) для получения сведений об устройстве.</span><span class="sxs-lookup"><span data-stu-id="4c632-152">Using the *hDevice* from this call, an application calls [**GetRawInputDeviceInfo**](/windows/win32/api/winuser/nf-winuser-getrawinputdeviceinfoa) to get the device information.</span></span>

<span data-ttu-id="4c632-153">С помощью члена **dwFlags** в [**равинпутдевице**](/windows/win32/api/winuser/ns-winuser-rawinputdevice)приложение может выбрать устройства для прослушивания, а также те, которые требуется игнорировать.</span><span class="sxs-lookup"><span data-stu-id="4c632-153">Through the **dwFlags** member of [**RAWINPUTDEVICE**](/windows/win32/api/winuser/ns-winuser-rawinputdevice), an application can select the devices to listen to and also those it wants to ignore.</span></span> <span data-ttu-id="4c632-154">Например, приложение может запросить входные данные со всех устройств телефонии, за исключением ответов на компьютеры.</span><span class="sxs-lookup"><span data-stu-id="4c632-154">For example, an application can ask for input from all telephony devices except for answering machines.</span></span> <span data-ttu-id="4c632-155">Пример кода см. в разделе [Регистрация для ввода необработанных данных](using-raw-input.md).</span><span class="sxs-lookup"><span data-stu-id="4c632-155">For sample code, see [Registering for Raw Input](using-raw-input.md).</span></span>

<span data-ttu-id="4c632-156">Обратите внимание, что мышь и клавиатура также являются Хидс, поэтому данные из них могут быть получены как с помощью HID-сообщений [**WM \_ , так**](wm-input.md) и из традиционных сообщений.</span><span class="sxs-lookup"><span data-stu-id="4c632-156">Note that the mouse and the keyboard are also HIDs, so data from them can come through both the HID message [**WM\_INPUT**](wm-input.md) and from traditional messages.</span></span> <span data-ttu-id="4c632-157">Приложение может выбрать любой из методов в [**равинпутдевице**](/windows/win32/api/winuser/ns-winuser-rawinputdevice).</span><span class="sxs-lookup"><span data-stu-id="4c632-157">An application can select either method by the proper selection of flags in [**RAWINPUTDEVICE**](/windows/win32/api/winuser/ns-winuser-rawinputdevice).</span></span>

<span data-ttu-id="4c632-158">Чтобы получить состояние регистрации приложения, вызовите [**жетрегистередравинпутдевицес**](/windows/win32/api/winuser/nf-winuser-getregisteredrawinputdevices) в любое время.</span><span class="sxs-lookup"><span data-stu-id="4c632-158">To get an application's registration status, call [**GetRegisteredRawInputDevices**](/windows/win32/api/winuser/nf-winuser-getregisteredrawinputdevices) at any time.</span></span>

## <a name="reading-raw-input"></a><span data-ttu-id="4c632-159">Чтение необработанного ввода</span><span class="sxs-lookup"><span data-stu-id="4c632-159">Reading Raw Input</span></span>

<span data-ttu-id="4c632-160">Приложение получает необработанный ввод из любой HID, чей [коллекция верхнего уровня](/windows-hardware/drivers/hid/top-level-collections) (ТЛК) соответствует ТЛК из регистрации.</span><span class="sxs-lookup"><span data-stu-id="4c632-160">An application receives raw input from any HID whose [top level collection](/windows-hardware/drivers/hid/top-level-collections) (TLC) matches a TLC from the registration.</span></span> <span data-ttu-id="4c632-161">Когда приложение получает необработанный ввод, его очередь сообщений получает [**\_ входное сообщение WM**](wm-input.md) и флаг состояния очереди **QS \_ равинпут** (**\_ Вход QS** также включает этот флаг).</span><span class="sxs-lookup"><span data-stu-id="4c632-161">When an application receives raw input, its message queue gets a [**WM\_INPUT**](wm-input.md) message and the queue status flag **QS\_RAWINPUT** is set (**QS\_INPUT** also includes this flag).</span></span> <span data-ttu-id="4c632-162">Приложение может принимать данные, когда оно находится на переднем плане, и когда оно находится в фоновом режиме.</span><span class="sxs-lookup"><span data-stu-id="4c632-162">An application can receive data when it is in the foreground and when it is in the background.</span></span>

<span data-ttu-id="4c632-163">Существует два способа чтения необработанных данных: метод без буферизации (или стандартный) и буферизованный метод.</span><span class="sxs-lookup"><span data-stu-id="4c632-163">There are two ways to read the raw data: the unbuffered (or standard) method and the buffered method.</span></span> <span data-ttu-id="4c632-164">Небуферизованный метод получает необработанные данные по одной структуре [**равинпут**](/windows/win32/api/winuser/ns-winuser-rawinput) за раз и подходит для многих хидс.</span><span class="sxs-lookup"><span data-stu-id="4c632-164">The unbuffered method gets the raw data one [**RAWINPUT**](/windows/win32/api/winuser/ns-winuser-rawinput) structure at a time and is adequate for many HIDs.</span></span> <span data-ttu-id="4c632-165">В этом случае приложение вызывает метод [**onmessage**](/windows/desktop/api/winuser/nf-winuser-getmessage) для получения [**\_ входного сообщения WM**](wm-input.md) .</span><span class="sxs-lookup"><span data-stu-id="4c632-165">Here, the application calls [**GetMessage**](/windows/desktop/api/winuser/nf-winuser-getmessage) to get the [**WM\_INPUT**](wm-input.md) message.</span></span> <span data-ttu-id="4c632-166">Затем приложение вызывает [**жетравинпутдата**](/windows/win32/api/winuser/nf-winuser-getrawinputdata) с помощью обработчика **равинпут** , содержащегося в **\_ входных данных WM**.</span><span class="sxs-lookup"><span data-stu-id="4c632-166">Then the application calls [**GetRawInputData**](/windows/win32/api/winuser/nf-winuser-getrawinputdata) using the **RAWINPUT** handle contained in **WM\_INPUT**.</span></span> <span data-ttu-id="4c632-167">Пример см. в разделе [Выполнение стандартного чтения необработанных данных](using-raw-input.md).</span><span class="sxs-lookup"><span data-stu-id="4c632-167">For an example, see [Doing a Standard Read of Raw Input](using-raw-input.md).</span></span>

<span data-ttu-id="4c632-168">В отличие от этого, буферизованный метод получает массив структур [**равинпут**](/windows/win32/api/winuser/ns-winuser-rawinput) за раз.</span><span class="sxs-lookup"><span data-stu-id="4c632-168">In contrast, the buffered method gets an array of [**RAWINPUT**](/windows/win32/api/winuser/ns-winuser-rawinput) structures at a time.</span></span> <span data-ttu-id="4c632-169">Он предоставляется для устройств, которые могут создавать большие объемы необработанных данных.</span><span class="sxs-lookup"><span data-stu-id="4c632-169">This is provided for devices that can produce large amounts of raw input.</span></span> <span data-ttu-id="4c632-170">В этом методе приложение вызывает [**жетравинпутбуффер**](/windows/win32/api/winuser/nf-winuser-getrawinputbuffer) для получения массива структур **равинпут** .</span><span class="sxs-lookup"><span data-stu-id="4c632-170">In this method, the application calls [**GetRawInputBuffer**](/windows/win32/api/winuser/nf-winuser-getrawinputbuffer) to get an array of **RAWINPUT** structures.</span></span> <span data-ttu-id="4c632-171">Обратите внимание, что макрос [**некстравинпутблокк**](/windows/win32/api/winuser/nf-winuser-nextrawinputblock) используется для прохода по массиву структур **равинпут** .</span><span class="sxs-lookup"><span data-stu-id="4c632-171">Note that the [**NEXTRAWINPUTBLOCK**](/windows/win32/api/winuser/nf-winuser-nextrawinputblock) macro is used to traverse an array of **RAWINPUT** structures.</span></span> <span data-ttu-id="4c632-172">Пример см. в разделе [выполнение буферизованного чтения необработанных входных данных](using-raw-input.md).</span><span class="sxs-lookup"><span data-stu-id="4c632-172">For an example, see [Doing a Buffered Read of Raw Input](using-raw-input.md).</span></span>

<span data-ttu-id="4c632-173">Для интерпретации необработанного ввода необходимо получить подробные сведения о Хидс.</span><span class="sxs-lookup"><span data-stu-id="4c632-173">To interpret the raw input, detailed information about the HIDs is required.</span></span> <span data-ttu-id="4c632-174">Приложение получает сведения об устройстве, вызывая [**жетравинпутдевицеинфо**](/windows/win32/api/winuser/nf-winuser-getrawinputdeviceinfoa) с помощью обработчика устройства.</span><span class="sxs-lookup"><span data-stu-id="4c632-174">An application gets the device information by calling [**GetRawInputDeviceInfo**](/windows/win32/api/winuser/nf-winuser-getrawinputdeviceinfoa) with the device handle.</span></span> <span data-ttu-id="4c632-175">Этот обработчик может поступать либо [**из \_ входных данных WM**](wm-input.md) , либо из члена **хдевице** [**равинпусеадер**](/windows/win32/api/winuser/ns-winuser-rawinputheader).</span><span class="sxs-lookup"><span data-stu-id="4c632-175">This handle can come either from [**WM\_INPUT**](wm-input.md) or from the **hDevice** member of [**RAWINPUTHEADER**](/windows/win32/api/winuser/ns-winuser-rawinputheader).</span></span>