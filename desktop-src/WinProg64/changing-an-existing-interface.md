---
title: Изменение существующего интерфейса
description: Везде, где это возможно, реализуйте новый интерфейс для приложения, а не вносите изменения в существующий.
ms.assetid: 29845cf5-445c-403d-b298-d4e07c3536b7
keywords:
- изменение существующих интерфейсов в 64-разрядном программировании Windows
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 51a656ee768dcc2e88725d2cff0ddc5604fd771f
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104533305"
---
# <a name="changing-an-existing-interface"></a><span data-ttu-id="16acb-104">Изменение существующего интерфейса</span><span class="sxs-lookup"><span data-stu-id="16acb-104">Changing an Existing Interface</span></span>

<span data-ttu-id="16acb-105">Везде, где это возможно, реализуйте новый интерфейс для приложения, а не вносите изменения в существующий.</span><span class="sxs-lookup"><span data-stu-id="16acb-105">Whenever possible, implement a new interface for your application, rather than making changes to an existing one.</span></span> <span data-ttu-id="16acb-106">Если не удается изменить существующий интерфейс, следует использовать новые типы данных только в новых методах.</span><span class="sxs-lookup"><span data-stu-id="16acb-106">If you cannot avoid changing an existing interface, use new data types in new methods only.</span></span> <span data-ttu-id="16acb-107">Внедрение нового типа данных или изменение существующего типа является наиболее распространенным источником проблем совместимости.</span><span class="sxs-lookup"><span data-stu-id="16acb-107">Introducing a new data type or modifying an existing type is the most common source of incompatibility problems.</span></span> <span data-ttu-id="16acb-108">Модель времени выполнения RPC предполагает, что получающее приложение знает о типах получаемых данных, поэтому данные помещаются в сеть без универсального описания данных.</span><span class="sxs-lookup"><span data-stu-id="16acb-108">The RPC run-time model assumes that the receiving application knows about the types of data that it receives, so data is put onto the wire without a generic data description.</span></span> <span data-ttu-id="16acb-109">Когда получатель принимает тип данных, отличный от того, который отправитель поместит на канал передачи, заглушка вызывает исключение (или передача завершается неудачно другим способом).</span><span class="sxs-lookup"><span data-stu-id="16acb-109">When the recipient expects a different data type than what the sender has put on the wire, the stub raises an exception (or transmission fails in some other less graceful manner).</span></span>

<span data-ttu-id="16acb-110">Интерфейс RPC определяется его UUID и основными и дополнительными номерами версий.</span><span class="sxs-lookup"><span data-stu-id="16acb-110">An RPC interface is defined by its UUID and its major and minor version numbers.</span></span> <span data-ttu-id="16acb-111">При изменении существующего интерфейса следует добавить новые методы в конце интерфейса и изменить дополнительный номер версии.</span><span class="sxs-lookup"><span data-stu-id="16acb-111">When you change an existing interface, you should add the new methods at the end of the interface and change the minor version number.</span></span> <span data-ttu-id="16acb-112">Если вы добавляете методы в любое другое место или вносите другие изменения в интерфейс, вам также потребуется изменить основной номер версии.</span><span class="sxs-lookup"><span data-stu-id="16acb-112">If you add methods anywhere else or make any other changes to the interface, you will also need to change the major version number.</span></span>

<span data-ttu-id="16acb-113">В реальной ситуации бывают случаи, когда невозможно изменить даже дополнительный номер версии, так как новый клиент не сможет взаимодействовать со старым сервером, и вы не сможете обновить сервер.</span><span class="sxs-lookup"><span data-stu-id="16acb-113">Realistically, there are times when you cannot change even the minor version number, because a new client will not be able to communicate with an old server and you cannot update the server.</span></span> <span data-ttu-id="16acb-114">Время выполнения RPC вызывает исключение RPC \_ \_ прокнум \_ вне \_ \_ допустимого диапазона, когда клиент вызывает метод за пределами, заданными для его интерфейса с сервером.</span><span class="sxs-lookup"><span data-stu-id="16acb-114">The RPC run time raises an exception, RPC\_S\_PROCNUM\_OUT\_OF\_RANGE, when a client calls a method beyond the ones specified for its interface with the server.</span></span> <span data-ttu-id="16acb-115">Для решения этой проблемы необходимо оставить номера версий без изменений и написать код клиента для корректной работы с этим исключением. Клиент может устранить его производительность, например, или каким-либо способом подходит для вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="16acb-115">The workaround is to leave the version numbers unchanged and write your client code to handle this exception gracefully—by the client degrading its performance, for example, or by whatever means are appropriate for your application.</span></span>

<span data-ttu-id="16acb-116">Существует аналогичный обходной путь для одного особого случая изменения типа данных в существующем методе.</span><span class="sxs-lookup"><span data-stu-id="16acb-116">There is a similar workaround for one special case of changing a data type in an existing method.</span></span> <span data-ttu-id="16acb-117">Если имеется [**объединение**](/windows/desktop/Midl/union) , ветви которого являются указателями и не имеет ветви по умолчанию для нераспознаваемых типов, можно добавить новую ветвь, использующую новый тип данных.</span><span class="sxs-lookup"><span data-stu-id="16acb-117">If you have a [**union**](/windows/desktop/Midl/union) whose branches are pointers and that does not have a default branch for unrecognized types, you can add a new branch that uses the new data type.</span></span> <span data-ttu-id="16acb-118">При этом размер структуры данных не изменится.</span><span class="sxs-lookup"><span data-stu-id="16acb-118">This will not change the size of the data structure.</span></span> <span data-ttu-id="16acb-119">Когда клиент обращается к новому серверу, он может использовать новый тип данных.</span><span class="sxs-lookup"><span data-stu-id="16acb-119">When your client talks to a new server, it can use the new data type.</span></span> <span data-ttu-id="16acb-120">Однако если клиент обращается к старому серверу, то во время выполнения будет вызван \_ \_ Недопустимый тег исключения RPC S \_ .</span><span class="sxs-lookup"><span data-stu-id="16acb-120">However, when your client talks to an old server, the run time will raise the exception RPC\_S\_INVALID\_TAG.</span></span> <span data-ttu-id="16acb-121">Опять же, вам потребуется написать клиентский код для правильной обработке этого исключения.</span><span class="sxs-lookup"><span data-stu-id="16acb-121">Again, you will need to write your client code to handle this exception appropriately.</span></span>

<span data-ttu-id="16acb-122">Интерфейс DCOM определяется по его идентификатору GUID.</span><span class="sxs-lookup"><span data-stu-id="16acb-122">A DCOM interface is identified by its GUID.</span></span> <span data-ttu-id="16acb-123">В DCOM интерфейсы считаются неизменяемыми, и вы можете вносить изменения только путем создания нового интерфейса, который наследует от старого.</span><span class="sxs-lookup"><span data-stu-id="16acb-123">In DCOM, interfaces are considered immutable and you can make changes only by creating a new interface that inherits from the old one.</span></span> <span data-ttu-id="16acb-124">Эти правила гарантируют, что клиенты и серверы останутся совместимыми.</span><span class="sxs-lookup"><span data-stu-id="16acb-124">These rules ensure that clients and servers remain compatible.</span></span>

 

 