---
title: Отражение реестра
description: Перенаправитель реестра изолирует 32-разрядные и 64-разрядные приложения, предоставляя отдельные логические представления определенных частей реестра в эмуляторе WOW64. Однако значения некоторых разделов реестра должны быть одинаковыми в 32-разрядных и 64-битных представлениях.
ms.assetid: eac9038b-9f59-4ac7-8974-f94a4a62a257
keywords:
- отражение реестра 64-bit Windows программирование
- отражение 64-разрядное Windowsное программирование
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d9104ba6bf4d537a597a2a45bfd9034379ed1781dd893e23633c08e9e9c1149b
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119899044"
---
# <a name="registry-reflection"></a>Отражение реестра

\[сведения в этом разделе относятся к Windows server 2008, Windows Vista, Windows Server 2003 и Windows XP. начиная с Windows 7 и Windows Server 2008 R2, подсистема WOW64 больше не использует отражение реестра, а ранее отраженные ключи являются общими. Дополнительные сведения см. в разделе [разделы реестра, затрагиваемые WOW64](shared-registry-keys.md).\]

[Перенаправитель реестра](registry-redirector.md) изолирует 32-разрядные и 64-разрядные приложения, предоставляя отдельные логические представления определенных частей реестра в эмуляторе WOW64. Однако значения некоторых разделов реестра должны быть одинаковыми в 32-разрядных и 64-битных представлениях.

Процесс *отражения реестра* копирует разделы и значения реестра между двумя представлениями реестра, чтобы синхронизировать их. Каждое представление имеет отдельную физическую копию каждого отраженного раздела реестра, один для 32-разрядного представления реестра, а другой для 64-битного представления реестра.

Отраженный ключ копируется при закрытии ключа путем вызова [**Ошибка RegCloseKey**](/windows/desktop/api/winreg/nf-winreg-regclosekey). Обратите внимание, что это приводит к увеличению возможного состояния гонки: Если в нескольких процессах изменяется отраженный ключ, последний вызов **Ошибка RegCloseKey** определяет окончательное значение ключа.

Reflector копирует данные активации COM для локальных серверов между представлениями, но не копирует данные в процессе, так как 32/64 in-Process смешение не разрешено на 64-бит Windows.

Отражение не включено для общих разделов реестра или для разделов реестра, которые не перенаправляются. Например, отражение не включено для **системного ключа hKey \_ локального \_ компьютера \\** . Список разделов реестра, которые перенаправлены, являются общими или отраженными, см. в разделе [разделы реестра, затрагиваемые WOW64](shared-registry-keys.md).

При отражении реестра используется политика "побеждает в последнюю очередь", как показано в следующем примере:

-   после чистой установки 64-разрядной Windows для .doc файлов регистрируется 64-разрядная Wordpad.exe. Отражатель копирует .docную регистрацию из 64-разрядного представления реестра в представление реестра 32-bit.
-   администратор устанавливает 32-разрядный Office, который регистрирует 32-разрядные Winword.exe для .doc файлов в представлении в виде 32-разрядного представления реестра. Reflector в реестре копирует эту информацию в представление реестра 64-bit, поэтому оба 32-разрядных и 64-разрядных приложений запускают 32-разрядную версию Winword.exe для .doc файлов.
-   администратор устанавливает 64-разрядный Office, который регистрирует 64-разрядные Winword.exe для .doc файлов в представлении в виде 64-разрядного представления реестра. Отражение реестра копирует эту информацию в 32-разрядный реестр, поэтому оба 32-разрядные и 64-разрядные приложения запускают 64-разрядную версию Winword.exe для .doc файлов.

Таким образом, сведения о сопоставлении файлов сохраняются для последнего установленного приложения.

Это может быть полезно для 32-разрядных и 64-разрядных приложений для совместного использования конкретных значений разделов реестра, которые обычно записываются в отдельные представления реестра. Например, 32-разрядный сервер OLE, который может обслуживать запросы с 32-и 64-разрядных клиентов, может сделать его 32-разрядный доступ 64 к данным системного реестра.

Когда компонент записывает данные в системный реестр, WOW64 анализирует информацию и создает копию данных в альтернативном представлении реестра при необходимости. Как правило, этот процесс сохраняет две отдельные физические копии одних и тех же разделов реестра в обоих представлениях в реестре и называется отражением реестра или зеркальным отображением реестра.

Большинство ключей в корне классов находятся в этой категории. Обновления ключей отражаются после завершения обновления и закрытия ключа. В определенных случаях запись в ключ не отражается, если у ключа есть зависимость разрядности. Например, 32-разрядный ключ InprocServer32 не относится к 64-разрядным приложениям, поэтому ключ InprocServer32 не отражается в представлении реестра 64-bit. Однако 64-разрядные приложения могут использовать ключ 32-bit LocalServer32, а ключ LocalServer32 — отражен.

Для **\_ классов " \_ \\ программное \\ обеспечение \\ на локальном компьютере" в hKey классы** CLSID и **hKey \_ текущие \_ пользовательские \\ классы программного обеспечения \\ \\ CLSID** отражаются только идентификаторы CLSID, не указывающие InprocServer32 или InprocHandler32. Отражены только идентификаторы CLSID, так как они выполняются вне процесса и могут быть активированы с помощью 32 или 64-разрядных приложений. InProcServer32 CLSID не отражаются, так как невозможно загрузить 32-разрядную библиотеку DLL для выполнения в 64-разрядном процессе или 64-разрядную библиотеку DLL для выполнения в 32-разрядном процессе.

Для **\_ \_ \\ классов программного обеспечения \\ \\ hKey на локальном компьютере AppID** и **hKey \_ текущие \_ пользовательские \\ классы программного обеспечения \\ \\ AppID**, значения реестра [дллсуррогате](../com/dllsurrogate.md) и [дллсуррогатиксекутабле]( ../com/dllsurrogateexecutable.md) не отражаются, если их значение является пустой строкой.

Чтобы отключить и включить отражение реестра для определенного отраженного ключа, используйте функции [**регдисаблерефлектионкэй**](/windows/desktop/api/winreg/nf-winreg-regdisablereflectionkey) и [**реженаблерефлектионкэй**](/windows/desktop/api/winreg/nf-winreg-regenablereflectionkey) . Эти функции не влияют на ключи, которые не находятся в списке отраженных ключей ранее в этом разделе. Приложения должны отключать отражение только для разделов реестра, которые они создают, и не пытаться отключить отражение для стандартных ключей, таких как **hKey \_ локальный \_ компьютер** или **hKey \_ текущий \_ пользователь**. Чтобы определить, отключены ли ключи в списке отражения, используйте функцию [**регкуерирефлектионкэй**](/windows/desktop/api/winreg/nf-winreg-regqueryreflectionkey) .

Отраженные ключи не следует использовать в операциях реестра с поддержкой транзакций. Запись в отраженные ключи во время транзакции может привести к сбою транзакции. Дополнительные сведения о транзакциях см. в разделе [Диспетчер транзакций ядра](/windows/desktop/Ktm/kernel-transaction-manager-portal).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Перенаправитель реестра](registry-redirector.md)
</dt> <dt>

[Отражение реестра в Windows](/windows-hardware/drivers/display/microsoft-windows-vista-display-driver-64-bit-issues)
</dt> <dt>

[Разделы реестра, относящиеся к WOW64](shared-registry-keys.md)
</dt> </dl>

 

 