---
title: Перенаправитель реестра
description: Перенаправитель реестра изолирует 32-разрядные и 64-разрядные приложения, предоставляя отдельные логические представления определенных частей реестра в эмуляторе WOW64.
ms.assetid: b3989f79-0439-485a-96c1-4f2227d48653
keywords:
- 64-разрядное руководством по программированию для Windows, 64-разрядное программирование для Windows, перенаправитель реестра
- перенаправление реестра 64-разрядное программирование для Windows
- перенаправление на 64-разрядное программирование для Windows
- WOW64 64-разрядное программирование Windows, перенаправитель реестра
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 04c11e68f307aa014adb7cae8415f1baba155678
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104411046"
---
# <a name="registry-redirector"></a><span data-ttu-id="560d2-107">Перенаправитель реестра</span><span class="sxs-lookup"><span data-stu-id="560d2-107">Registry Redirector</span></span>

<span data-ttu-id="560d2-108">Перенаправитель реестра изолирует 32-разрядные и 64-разрядные приложения, предоставляя отдельные логические представления определенных частей реестра в эмуляторе WOW64.</span><span class="sxs-lookup"><span data-stu-id="560d2-108">The registry redirector isolates 32-bit and 64-bit applications by providing separate logical views of certain portions of the registry on WOW64.</span></span> <span data-ttu-id="560d2-109">Перенаправитель реестра перехватывает вызовы реестра 32-bit и 64-bit в соответствующие логические представления реестра и сопоставляет их с соответствующим физическим расположением реестра.</span><span class="sxs-lookup"><span data-stu-id="560d2-109">The registry redirector intercepts 32-bit and 64-bit registry calls to their respective logical registry views and maps them to the corresponding physical registry location.</span></span> <span data-ttu-id="560d2-110">Процесс перенаправления прозрачен для приложения.</span><span class="sxs-lookup"><span data-stu-id="560d2-110">The redirection process is transparent to the application.</span></span> <span data-ttu-id="560d2-111">Поэтому 32-разрядное приложение может обращаться к данным реестра, как если бы оно выполнялось в 32-разрядной версии Windows, даже если данные хранятся в другом расположении в 64-разрядной версии Windows.</span><span class="sxs-lookup"><span data-stu-id="560d2-111">Therefore, a 32-bit application can access registry data as if it were running on 32-bit Windows even if the data is stored in a different location on 64-bit Windows.</span></span>

<span data-ttu-id="560d2-112">**Windows 10 на ARM:** Помимо 32-разрядного логического представления для приложений x86, Windows 10 в ARM включает в себя отдельное логическое представление для 32-разрядных приложений ARM.</span><span class="sxs-lookup"><span data-stu-id="560d2-112">**Windows 10 on ARM:** In addition to the 32-bit logical view for x86 applications, Windows 10 on ARM includes a separate logical view for 32-bit ARM applications.</span></span>

<span data-ttu-id="560d2-113">Подмножество ключей в перенаправленных путях реестра является общим.</span><span class="sxs-lookup"><span data-stu-id="560d2-113">A subset of keys under redirected registry paths are shared.</span></span> <span data-ttu-id="560d2-114">32-разрядные вызовы реестра для общих ключей не перенаправляются.</span><span class="sxs-lookup"><span data-stu-id="560d2-114">32-bit registry calls to shared keys are not redirected.</span></span> <span data-ttu-id="560d2-115">Вместо этого одна физическая копия ключа сопоставляется с каждым логическим представлением реестра.</span><span class="sxs-lookup"><span data-stu-id="560d2-115">Instead, one physical copy of the key is mapped into each logical view of the registry.</span></span> <span data-ttu-id="560d2-116">Список перенаправленных ключей и общих ключей см. в разделе [разделы реестра, затрагиваемые WOW64](shared-registry-keys.md).</span><span class="sxs-lookup"><span data-stu-id="560d2-116">For a list of redirected keys and shared keys, see [Registry Keys Affected by WOW64](shared-registry-keys.md).</span></span>

<span data-ttu-id="560d2-117">Windows **server 2008, Windows Vista, Windows server 2003 и Windows XP:** Чтобы обеспечить взаимодействие приложений с помощью COM и других механизмов, также *отражаются* подмножество перенаправленных разделов реестра.</span><span class="sxs-lookup"><span data-stu-id="560d2-117">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** To enable application interoperability through COM and other mechanisms, a subset of redirected registry keys are also *reflected*.</span></span> <span data-ttu-id="560d2-118">Процесс отражения реестра копирует разделы и значения реестра между двумя представлениями реестра, чтобы синхронизировать их.</span><span class="sxs-lookup"><span data-stu-id="560d2-118">The process of registry reflection copies registry keys and values between two registry views to keep them synchronized.</span></span> <span data-ttu-id="560d2-119">Отражение реестра удалено начиная с Windows 7 и Windows Server 2008 R2.</span><span class="sxs-lookup"><span data-stu-id="560d2-119">Registry reflection was removed starting with Windows 7 and Windows Server 2008 R2.</span></span> <span data-ttu-id="560d2-120">Дополнительные сведения см. в разделе [отражение реестра](registry-reflection.md).</span><span class="sxs-lookup"><span data-stu-id="560d2-120">For more information, see [Registry Reflection](registry-reflection.md).</span></span>

<span data-ttu-id="560d2-121">В следующем сценарии показано использование этих логических представлений.</span><span class="sxs-lookup"><span data-stu-id="560d2-121">The following scenario illustrates the use of these logical views:</span></span>

-   <span data-ttu-id="560d2-122">32-разрядное приложение x86 проверяет наличие следующего раздела реестра: **hKey \_ Local \_ Machine \\ Software \\ Hello**.</span><span class="sxs-lookup"><span data-stu-id="560d2-122">A 32-bit x86 application checks for the existence of the following registry key: **HKEY\_LOCAL\_MACHINE\\Software\\Hello**.</span></span> <span data-ttu-id="560d2-123">Если ключ не существует, приложение создает его со значением по умолчанию "Hello 32-bit x86 World"; в противном случае он считывает и отображает значение.</span><span class="sxs-lookup"><span data-stu-id="560d2-123">If the key does not exist, the application creates it with a default value of "Hello 32-bit x86 world"; otherwise, it reads and displays the value.</span></span>
-   <span data-ttu-id="560d2-124">Одно и то же приложение изменяется для записи "Hello 64-bit World" вместо "Hello 32-разрядный мир x86" и повторной компиляции в качестве 64-разрядного приложения x64 или ARM64.</span><span class="sxs-lookup"><span data-stu-id="560d2-124">The same application is modified to write "Hello 64-bit world" instead of "Hello 32-bit x86 world" and recompiled as a 64-bit x64 or ARM64 application.</span></span>
-   <span data-ttu-id="560d2-125">**Windows 10 на ARM:** Одно и то же приложение изменяется для записи "Hello 32-bit ARM" и повторной компиляции в виде приложения с 32-разрядной версией ARM.</span><span class="sxs-lookup"><span data-stu-id="560d2-125">**Windows 10 on ARM:** The same application is modified to write “Hello 32-bit ARM world” and recompiled as a 32-bit ARM application.</span></span>
-   <span data-ttu-id="560d2-126">Когда 32-разрядное приложение x86 запускается в 64-разрядной версии Windows, отображается сообщение "Hello 32-bit x86 World".</span><span class="sxs-lookup"><span data-stu-id="560d2-126">When the 32-bit x86 application is run on 64-bit Windows, it displays "Hello 32-bit x86 world".</span></span> <span data-ttu-id="560d2-127">При запуске 64-разрядного приложения отображается сообщение "Hello 64-bit World".</span><span class="sxs-lookup"><span data-stu-id="560d2-127">When the 64-bit application is run, it displays "Hello 64-bit world".</span></span> <span data-ttu-id="560d2-128">**Windows 10 на ARM:** Когда 32-разрядное приложение ARM запускается в 64-разрядной ARM64 Windows, отображается сообщение "Hello 32-bit ARM".</span><span class="sxs-lookup"><span data-stu-id="560d2-128">**Windows 10 on ARM:** When the 32-bit ARM application is run on 64-bit ARM64 Windows, it displays "Hello 32-bit ARM world".</span></span> <span data-ttu-id="560d2-129">Все приложения вызывают те же функции реестра с одним и тем же предопределенным маркером и одним и тем же именем ключа. Разница заключается в том, что каждое приложение работает со своим логическим представлением реестра, и каждое представление сопоставляется с отдельным физическим расположением реестра, что обеспечивает неизменность всех версий строки.</span><span class="sxs-lookup"><span data-stu-id="560d2-129">All applications call the same registry functions with the same predefined handle and the same key name; the difference is that each application operates on its logical view of registry, and each view is mapped to a separate physical location of the registry, which keeps all versions of the string intact.</span></span>

<span data-ttu-id="560d2-130">Перенаправленные ключи сопоставляются с физическими расположениями в разделе **WOW6432Node**.</span><span class="sxs-lookup"><span data-stu-id="560d2-130">Redirected keys are mapped to physical locations under **Wow6432Node**.</span></span> <span data-ttu-id="560d2-131">Например, **Программа hKey \_ для \_ локального \\ компьютера** перенаправляется в **hKey \_ Local \_ Machine \\ Software \\ WOW6432Node**.</span><span class="sxs-lookup"><span data-stu-id="560d2-131">For example, **HKEY\_LOCAL\_MACHINE\\Software** is redirected to **HKEY\_LOCAL\_MACHINE\\Software\\Wow6432Node**.</span></span> <span data-ttu-id="560d2-132">Однако физическое расположение перенаправленных ключей должно считаться зарезервированным системой.</span><span class="sxs-lookup"><span data-stu-id="560d2-132">However, the physical location of redirected keys should be considered reserved by the system.</span></span> <span data-ttu-id="560d2-133">Приложения не должны напрямую обращаться к физическому расположению ключа, так как это расположение может измениться.</span><span class="sxs-lookup"><span data-stu-id="560d2-133">Applications should not access a key's physical location directly, because this location may change.</span></span> <span data-ttu-id="560d2-134">Дополнительные сведения см. [в разделе доступ к альтернативному представлению реестра](accessing-an-alternate-registry-view.md).</span><span class="sxs-lookup"><span data-stu-id="560d2-134">For more information, see [Accessing an Alternate Registry View](accessing-an-alternate-registry-view.md).</span></span>

<span data-ttu-id="560d2-135">**Windows 10 на ARM:** Перенаправленные 32-разрядные ключи ARM сопоставляются с физическими расположениями в разделе WowAA32Node.</span><span class="sxs-lookup"><span data-stu-id="560d2-135">**Windows 10 on ARM:** Redirected 32-bit ARM keys are mapped to physical locations under WowAA32Node.</span></span>

<span data-ttu-id="560d2-136">Чтобы помочь 32-разрядным приложениям, которые записывают данные **reg \_ SZ** или **reg \_ expand \_ SZ** , содержащие% ProgramFiles% или% COMMONPROGRAMFILES%, в реестр, WOW64 перехватывает эти операции записи и заменяет их на "% ProgramFiles (x86)%" и "% COMMONPROGRAMFILES (x86)%".</span><span class="sxs-lookup"><span data-stu-id="560d2-136">To help 32-bit applications that write **REG\_SZ** or **REG\_EXPAND\_SZ** data containing %ProgramFiles% or %commonprogramfiles% to the registry, WOW64 intercepts these write operations and replaces them with "%ProgramFiles(x86)%" and "%commonprogramfiles(x86)%".</span></span> <span data-ttu-id="560d2-137">Например, если каталог Program Files находится на диске C, то "% ProgramFiles (x86)%" разворачивается в "C: \\ Program Files (x86)".</span><span class="sxs-lookup"><span data-stu-id="560d2-137">For example, if the Program Files directory is on the C drive, then "%ProgramFiles(x86)%" expands to "C:\\Program Files (x86)".</span></span> <span data-ttu-id="560d2-138">Замена выполняется только при соблюдении следующих условий.</span><span class="sxs-lookup"><span data-stu-id="560d2-138">The replacement occurs only if the following conditions are met:</span></span>

-   <span data-ttu-id="560d2-139">Строка должна начинаться с% ProgramFiles% или% CommonProgramFiles%.</span><span class="sxs-lookup"><span data-stu-id="560d2-139">The string must begin with %ProgramFiles% or %commonprogramfiles%.</span></span> <span data-ttu-id="560d2-140">Если строка начинается с пробела или любого символа, отличного от%, он не заменяется.</span><span class="sxs-lookup"><span data-stu-id="560d2-140">If the string begins with a space or any character other than %, it is not replaced.</span></span>
-   <span data-ttu-id="560d2-141">Вариант% ProgramFiles% или% COMMONPROGRAMFILES% должен быть в точности так, как показано, так как при сравнении строк учитывается регистр.</span><span class="sxs-lookup"><span data-stu-id="560d2-141">The case of %ProgramFiles% or %commonprogramfiles% must be exactly as shown because the string comparison is case-sensitive.</span></span> <span data-ttu-id="560d2-142">Например, если строка начинается с% CommonProgramFiles% вместо% COMMONPROGRAMFILES%, она не заменяется.</span><span class="sxs-lookup"><span data-stu-id="560d2-142">For example, if the string begins with %CommonProgramFiles% instead of %commonprogramfiles%, it is not replaced.</span></span>
-   <span data-ttu-id="560d2-143">Длина строки не может превышать \_ \* 2 + 15 символов.</span><span class="sxs-lookup"><span data-stu-id="560d2-143">The string cannot exceed MAX\_PATH\*2+15 characters.</span></span> <span data-ttu-id="560d2-144">Если она превышает эту длину, она не заменяется.</span><span class="sxs-lookup"><span data-stu-id="560d2-144">If it exceeds this length, it is not replaced.</span></span>
-   <span data-ttu-id="560d2-145">Ключ не может быть открыт с помощью ключа \_ WOW64 \_ 64KEY.</span><span class="sxs-lookup"><span data-stu-id="560d2-145">The key cannot be opened with KEY\_WOW64\_64KEY.</span></span> <span data-ttu-id="560d2-146">Этот флаг указывает, что операции с ключом должны выполняться в 64-разрядном представлении реестра, поэтому оно не заменяется.</span><span class="sxs-lookup"><span data-stu-id="560d2-146">This flag specifies that operations on the key should be performed on the 64-bit registry view, so it is not replaced.</span></span> <span data-ttu-id="560d2-147">Дополнительные сведения см. [в разделе доступ к альтернативному представлению реестра](accessing-an-alternate-registry-view.md).</span><span class="sxs-lookup"><span data-stu-id="560d2-147">For more information, see [Accessing an Alternate Registry View](accessing-an-alternate-registry-view.md).</span></span>

<span data-ttu-id="560d2-148">Windows **server 2008, Windows Vista, Windows server 2003 и Windows XP:** \_Флаг 64KEY для ключа WOW \_ 64 \_ не влияет на замену ключа.</span><span class="sxs-lookup"><span data-stu-id="560d2-148">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** The KEY\_WOW\_64\_64KEY flag does not affect whether a key is replaced.</span></span> <span data-ttu-id="560d2-149">Этот флаг влияет на замену, начиная с Windows 7 и Windows Server 2008 R2.</span><span class="sxs-lookup"><span data-stu-id="560d2-149">This flag affects replacement starting with Windows 7 and Windows Server 2008 R2.</span></span>

<span data-ttu-id="560d2-150">Кроме того, REG \_ SZ или REG \_ expand \_ SZ ключи, содержащие System32, заменяются на SysWOW64.</span><span class="sxs-lookup"><span data-stu-id="560d2-150">In addition, REG\_SZ or REG\_EXPAND\_SZ keys containing system32 are replaced with syswow64.</span></span> <span data-ttu-id="560d2-151">Строка должна начинаться с пути, указывающего на или в% WINDIR% \\ System32.</span><span class="sxs-lookup"><span data-stu-id="560d2-151">The string must begin with the path pointing to or under %windir%\\system32.</span></span> <span data-ttu-id="560d2-152">При сравнении строк регистр не учитывается.</span><span class="sxs-lookup"><span data-stu-id="560d2-152">The string comparison is not case-sensitive.</span></span> <span data-ttu-id="560d2-153">Переменные среды развертываются до сопоставления с путем, поэтому все следующие пути будут заменены:% WINDIR% \\ System32,% systemroot% \\ system32 и C: \\ Windows \\ System32.</span><span class="sxs-lookup"><span data-stu-id="560d2-153">Environment variables are expanded before matching the path, so all of the following paths are replaced: %windir%\\system32, %SystemRoot%\\system32, and C:\\windows\\system32.</span></span> <span data-ttu-id="560d2-154">Это исправление применяется только к ключам, которые были отражены до Windows 7.</span><span class="sxs-lookup"><span data-stu-id="560d2-154">This patch is applied only to the keys that were reflected prior to Windows 7.</span></span>

<span data-ttu-id="560d2-155">Дополнительные сведения см. в следующих разделах:</span><span class="sxs-lookup"><span data-stu-id="560d2-155">For more information, see the following topics:</span></span>

-   [<span data-ttu-id="560d2-156">Отражение реестра</span><span class="sxs-lookup"><span data-stu-id="560d2-156">Registry Reflection</span></span>](registry-reflection.md)
-   [<span data-ttu-id="560d2-157">Разделы реестра, относящиеся к WOW64</span><span class="sxs-lookup"><span data-stu-id="560d2-157">Registry Keys Affected by WOW64</span></span>](shared-registry-keys.md)
-   [<span data-ttu-id="560d2-158">Доступ к альтернативному представлению реестра</span><span class="sxs-lookup"><span data-stu-id="560d2-158">Accessing an Alternate Registry View</span></span>](accessing-an-alternate-registry-view.md)
-   [<span data-ttu-id="560d2-159">Пример перенаправления реестра в эмуляторе WOW64</span><span class="sxs-lookup"><span data-stu-id="560d2-159">Example of Registry Redirection on WOW64</span></span>](example-of-registry-reflection-and-redirection-on-wow64.md)
-   [<span data-ttu-id="560d2-160">Удаленный доступ к реестру в 64-разрядной версии Windows</span><span class="sxs-lookup"><span data-stu-id="560d2-160">Remote Registry Access in 64-bit Windows</span></span>](remote-registry-access-in-64-bit-windows.md)

 

 




