---
title: Перенаправитель файловой системы
description: Каталог WINDIR \\ system32 зарезервирован для 64-разрядных приложений в 64-разрядной версии Windows.
ms.assetid: b4d36fe8-8bbb-469b-8ad1-650d559a4c75
keywords:
- перенаправление файловой системы 64-разрядное программирование для Windows
- 64-разрядное руководством по программированию для Windows, 64-разрядное программирование для Windows, перенаправитель файловой системы
- WOW64 64-разрядное программирование Windows, перенаправитель файловой системы
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 561d03c8da51bd37a2d97746296bc74e24e43154
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104070334"
---
# <a name="file-system-redirector"></a><span data-ttu-id="922a7-106">Перенаправитель файловой системы</span><span class="sxs-lookup"><span data-stu-id="922a7-106">File System Redirector</span></span>

<span data-ttu-id="922a7-107">Каталог% WINDIR% \\ system32 зарезервирован для 64-разрядных приложений в 64-разрядной версии Windows.</span><span class="sxs-lookup"><span data-stu-id="922a7-107">The %windir%\\System32 directory is reserved for 64-bit applications on 64-bit Windows.</span></span> <span data-ttu-id="922a7-108">Большинство имен файлов DLL не были изменены при создании 64-разрядных версий библиотек DLL, поэтому 32-разрядные версии библиотек DLL хранятся в другом каталоге.</span><span class="sxs-lookup"><span data-stu-id="922a7-108">Most DLL file names were not changed when 64-bit versions of the DLLs were created, so 32-bit versions of the DLLs are stored in a different directory.</span></span> <span data-ttu-id="922a7-109">WOW64 скрывает это различие с помощью *перенаправителя файловой системы*.</span><span class="sxs-lookup"><span data-stu-id="922a7-109">WOW64 hides this difference by using a *file system redirector*.</span></span>

<span data-ttu-id="922a7-110">В большинстве случаев каждый раз, когда 32-разрядное приложение пытается получить доступ к папке% WINDIR% \\ System32,% WINDIR% \\ ластгуд \\ System32 или% WINDIR% \\regedit.exe, доступ перенаправляется на путь, зависящий от архитектуры.</span><span class="sxs-lookup"><span data-stu-id="922a7-110">In most cases, whenever a 32-bit application attempts to access %windir%\\System32, %windir%\\lastgood\\system32, or %windir%\\regedit.exe, the access is redirected to an architecture-specific path.</span></span>

> [!Note]  
> <span data-ttu-id="922a7-111">Эти пути предоставляются только для справки.</span><span class="sxs-lookup"><span data-stu-id="922a7-111">These paths are provided for reference only.</span></span> <span data-ttu-id="922a7-112">В целях совместимости приложения не должны использовать эти пути напрямую.</span><span class="sxs-lookup"><span data-stu-id="922a7-112">For compatibility, applications should not use these paths directly.</span></span> <span data-ttu-id="922a7-113">Вместо этого они должны вызывать интерфейсы API, описанные ниже.</span><span class="sxs-lookup"><span data-stu-id="922a7-113">Instead, they should call the APIs described below.</span></span>

 



|                              |                                          |                                          |
|------------------------------|------------------------------------------|------------------------------------------|
| <span data-ttu-id="922a7-114">Исходный путь</span><span class="sxs-lookup"><span data-stu-id="922a7-114">Original Path</span></span>                | <span data-ttu-id="922a7-115">Путь перенаправления для 32-разрядных процессов x86</span><span class="sxs-lookup"><span data-stu-id="922a7-115">Redirected Path for 32-bit x86 Processes</span></span> | <span data-ttu-id="922a7-116">Путь перенаправления для процессов ARM 32-bit</span><span class="sxs-lookup"><span data-stu-id="922a7-116">Redirected Path for 32-bit ARM Processes</span></span> |
| <span data-ttu-id="922a7-117">% WINDIR% \\ system32</span><span class="sxs-lookup"><span data-stu-id="922a7-117">%windir%\\System32</span></span>           | <span data-ttu-id="922a7-118">% WINDIR% \\ SysWOW64</span><span class="sxs-lookup"><span data-stu-id="922a7-118">%windir%\\SysWOW64</span></span>                       | <span data-ttu-id="922a7-119">% WINDIR% \\ SysArm32</span><span class="sxs-lookup"><span data-stu-id="922a7-119">%windir%\\SysArm32</span></span>                       |
| <span data-ttu-id="922a7-120">% WINDIR% \\ ластгуд \\ system32</span><span class="sxs-lookup"><span data-stu-id="922a7-120">%windir%\\lastgood\\system32</span></span> | <span data-ttu-id="922a7-121">% WINDIR% \\ ластгуд \\ SysWOW64</span><span class="sxs-lookup"><span data-stu-id="922a7-121">%windir%\\lastgood\\SysWOW64</span></span>             | <span data-ttu-id="922a7-122">% WINDIR% \\ ластгуд \\ SysArm32</span><span class="sxs-lookup"><span data-stu-id="922a7-122">%windir%\\lastgood\\SysArm32</span></span>             |
| <span data-ttu-id="922a7-123">% WINDIR% \\regedit.exe</span><span class="sxs-lookup"><span data-stu-id="922a7-123">%windir%\\regedit.exe</span></span>        | <span data-ttu-id="922a7-124">% WINDIR% \\ SysWOW64 \\regedit.exe</span><span class="sxs-lookup"><span data-stu-id="922a7-124">%windir%\\SysWOW64\\regedit.exe</span></span>          | <span data-ttu-id="922a7-125">% WINDIR% \\ SysArm32 \\regedit.exe</span><span class="sxs-lookup"><span data-stu-id="922a7-125">%windir%\\ SysArm32\\regedit.exe</span></span>         |



 

<span data-ttu-id="922a7-126">Если доступ приводит к тому, что система выводит запрос UAC, перенаправление не происходит.</span><span class="sxs-lookup"><span data-stu-id="922a7-126">If the access causes the system to display the UAC prompt, redirection does not occur.</span></span> <span data-ttu-id="922a7-127">Вместо этого запускается 64-разрядная версия запрашиваемого файла.</span><span class="sxs-lookup"><span data-stu-id="922a7-127">Instead, the 64-bit version of the requested file is launched.</span></span> <span data-ttu-id="922a7-128">Чтобы избежать этой проблемы, укажите каталог SysWOW64, чтобы избежать перенаправления и обеспечить доступ к 32-разрядной версии файла, или запустите 32-разрядное приложение с правами администратора, чтобы запрос UAC не отображался.</span><span class="sxs-lookup"><span data-stu-id="922a7-128">To prevent this problem, either specify the SysWOW64 directory to avoid redirection and ensure access to the 32-bit version of the file, or run the 32-bit application with administrator privileges so the UAC prompt is not displayed.</span></span>

<span data-ttu-id="922a7-129">**Windows Server 2003 и Windows XP:  ** UAC не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="922a7-129">**Windows Server 2003 and Windows XP:  ** UAC is not supported.</span></span>

<span data-ttu-id="922a7-130">Некоторые подкаталоги исключены из перенаправления.</span><span class="sxs-lookup"><span data-stu-id="922a7-130">Certain subdirectories are exempt from redirection.</span></span> <span data-ttu-id="922a7-131">Доступ к этим подкаталогам не перенаправляется в% WINDIR% \\ SysWOW64:</span><span class="sxs-lookup"><span data-stu-id="922a7-131">Access to these subdirectories is not redirected to %windir%\\SysWOW64:</span></span> <dl> <span data-ttu-id="922a7-132">% WINDIR% \\ system32 \\ катрут</span><span class="sxs-lookup"><span data-stu-id="922a7-132">%windir%\\system32\\catroot</span></span>  
<span data-ttu-id="922a7-133">% WINDIR% \\ System32, \\ Catroot2</span><span class="sxs-lookup"><span data-stu-id="922a7-133">%windir%\\system32\\catroot2</span></span>  
<span data-ttu-id="922a7-134">% WINDIR% \\ system32 \\ дриверсторе</span><span class="sxs-lookup"><span data-stu-id="922a7-134">%windir%\\system32\\driverstore</span></span>  
<span data-ttu-id="922a7-135">драйверы% WINDIR \\ % \\ system32 \\ и т. д.</span><span class="sxs-lookup"><span data-stu-id="922a7-135">%windir%\\system32\\drivers\\etc</span></span>  
<span data-ttu-id="922a7-136">файлы журнала% windir% \\ system32 \\</span><span class="sxs-lookup"><span data-stu-id="922a7-136">%windir%\\system32\\logfiles</span></span>  
<span data-ttu-id="922a7-137">% WINDIR% \\ System32, \\ очередь</span><span class="sxs-lookup"><span data-stu-id="922a7-137">%windir%\\system32\\spool</span></span>  
</dl>

<span data-ttu-id="922a7-138">**Windows server 2008, Windows Vista, Windows server 2003 и Windows XP:  **% WINDIR% \\ system32 \\ дриверсторе перенаправляется.</span><span class="sxs-lookup"><span data-stu-id="922a7-138">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:  **%windir%\\system32\\driverstore is redirected.</span></span>

<span data-ttu-id="922a7-139">Чтобы получить имя 32-разрядного системного каталога, 64-разрядные приложения должны использовать функцию [**GetSystemWow64Directory2**](/windows/desktop/api/wow64apiset/nf-wow64apiset-getsystemwow64directory2a) (Windows 10, версия 1511) или функцию [**GetSystemWow64Directory**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetknownfolderpath) .</span><span class="sxs-lookup"><span data-stu-id="922a7-139">To retrieve the name of the 32-bit system directory, 64-bit applications should use the [**GetSystemWow64Directory2**](/windows/desktop/api/wow64apiset/nf-wow64apiset-getsystemwow64directory2a) function (Windows 10, version 1511) or the [**GetSystemWow64Directory**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetknownfolderpath) function.</span></span>

<span data-ttu-id="922a7-140">Приложения должны использовать функцию [**шжеткновнфолдерпас**](https://www.bing.com/search?q=**SHGetKnownFolderPath**) для определения имени каталога% ProgramFiles%.</span><span class="sxs-lookup"><span data-stu-id="922a7-140">Applications should use the [**SHGetKnownFolderPath**](https://www.bing.com/search?q=**SHGetKnownFolderPath**) function to determine the %ProgramFiles% directory name.</span></span>

<span data-ttu-id="922a7-141">**Windows Server 2003 и Windows XP:** Приложения должны использовать функцию [**шжетспеЦиалфолдерпас**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetspecialfolderpatha) для определения имени каталога% ProgramFiles%.</span><span class="sxs-lookup"><span data-stu-id="922a7-141">**Windows Server 2003 and Windows XP:** Applications should use the [**SHGetSpecialFolderPath**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetspecialfolderpatha) function to determine the %ProgramFiles% directory name.</span></span>

<span data-ttu-id="922a7-142">Приложения могут управлять перенаправитель файловой системы WOW64 с помощью функций [**Wow64DisableWow64FsRedirection**](/windows/desktop/api/wow64apiset/nf-wow64apiset-wow64disablewow64fsredirection), [**Wow64EnableWow64FsRedirection**](/windows/desktop/api/winbase/nf-winbase-wow64enablewow64fsredirection)и [**Wow64RevertWow64FsRedirection**](/windows/desktop/api/wow64apiset/nf-wow64apiset-wow64revertwow64fsredirection) .</span><span class="sxs-lookup"><span data-stu-id="922a7-142">Applications can control the WOW64 file system redirector using the [**Wow64DisableWow64FsRedirection**](/windows/desktop/api/wow64apiset/nf-wow64apiset-wow64disablewow64fsredirection), [**Wow64EnableWow64FsRedirection**](/windows/desktop/api/winbase/nf-winbase-wow64enablewow64fsredirection), and [**Wow64RevertWow64FsRedirection**](/windows/desktop/api/wow64apiset/nf-wow64apiset-wow64revertwow64fsredirection) functions.</span></span> <span data-ttu-id="922a7-143">Отключение перенаправления файловой системы влияет на все операции с файлами, выполняемые вызывающим потоком, поэтому его следует отключить только при необходимости для одного вызова [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) и снова включить снова сразу после возврата функции.</span><span class="sxs-lookup"><span data-stu-id="922a7-143">Disabling file system redirection affects all file operations performed by the calling thread, so it should be disabled only when necessary for a single [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) call and re-enabled again immediately after the function returns.</span></span> <span data-ttu-id="922a7-144">Отключение перенаправления файловой системы для более длительных периодов может препятствовать тому, что 32-разрядные приложения загружают системные библиотеки DLL, что приводит к сбою приложений.</span><span class="sxs-lookup"><span data-stu-id="922a7-144">Disabling file system redirection for longer periods can prevent 32-bit applications from loading system DLLs, causing the applications to fail.</span></span>

<span data-ttu-id="922a7-145">32-разрядные приложения могут получить доступ к собственному системному каталогу, подставив% WINDIR% \\ сиснативе для% WINDIR% \\ System32.</span><span class="sxs-lookup"><span data-stu-id="922a7-145">32-bit applications can access the native system directory by substituting %windir%\\Sysnative for %windir%\\System32.</span></span> <span data-ttu-id="922a7-146">WOW64 распознает Сиснативе как Специальный псевдоним, используемый для указания того, что файловая система не должна перенаправлять доступ.</span><span class="sxs-lookup"><span data-stu-id="922a7-146">WOW64 recognizes Sysnative as a special alias used to indicate that the file system should not redirect the access.</span></span> <span data-ttu-id="922a7-147">Этот механизм является гибким и простым в использовании, поэтому он является рекомендуемым механизмом обхода перенаправления файловой системы.</span><span class="sxs-lookup"><span data-stu-id="922a7-147">This mechanism is flexible and easy to use, therefore, it is the recommended mechanism to bypass file system redirection.</span></span> <span data-ttu-id="922a7-148">Обратите внимание, что 64-разрядные приложения не могут использовать псевдоним Сиснативе, так как это виртуальный каталог, а не реальный.</span><span class="sxs-lookup"><span data-stu-id="922a7-148">Note that 64-bit applications cannot use the Sysnative alias as it is a virtual directory not a real one.</span></span>

<span data-ttu-id="922a7-149">**Windows Server 2003 и Windows XP:** Псевдоним Сиснативе был добавлен начиная с Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="922a7-149">**Windows Server 2003 and Windows XP:** The Sysnative alias was added starting with Windows Vista.</span></span>

 

 