---
description: Изменения в системной палитре для устройства отображения могут иметь значительные и иногда нежелательные эффекты на цветах, используемых в Windows на рабочем столе.
ms.assetid: 9c470b6f-c0d3-462e-9649-1f39b06bd543
title: Сообщения палитры
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9f19a5458ec89d8d9a0524fd2ec383de740c0179
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104984885"
---
# <a name="palette-messages"></a><span data-ttu-id="02192-103">Сообщения палитры</span><span class="sxs-lookup"><span data-stu-id="02192-103">Palette Messages</span></span>

<span data-ttu-id="02192-104">Изменения в системной палитре для устройства отображения могут иметь значительные и иногда нежелательные эффекты на цветах, используемых в Windows на рабочем столе.</span><span class="sxs-lookup"><span data-stu-id="02192-104">Changes to the system palette for the display device can have dramatic and sometimes undesirable effects on the colors used in windows on the desktop.</span></span> <span data-ttu-id="02192-105">Чтобы уменьшить влияние этих изменений, система предоставляет набор сообщений, которые помогают приложениям управлять своими логическими палитрами, одновременно обеспечивая максимально близкое цветовое значение в активном окне к нужным цветам.</span><span class="sxs-lookup"><span data-stu-id="02192-105">To minimize the impact of these changes, the system provides a set of messages that help applications manage their logical palettes while ensuring that colors in the active window are as close as possible to the colors intended.</span></span>

<span data-ttu-id="02192-106">Система отправляет сообщение [**WM \_ куериневпалетте**](wm-querynewpalette.md) в окно верхнего уровня или перекрытие перед активацией окна.</span><span class="sxs-lookup"><span data-stu-id="02192-106">The system sends a [**WM\_QUERYNEWPALETTE**](wm-querynewpalette.md) message to a top-level or overlapped window just before activating the window.</span></span> <span data-ttu-id="02192-107">Это сообщение дает приложению возможность выбрать и реализовать ее логическую палитру, чтобы она получала лучшее возможное сопоставление цветов для логической палитры.</span><span class="sxs-lookup"><span data-stu-id="02192-107">This message gives an application the opportunity to select and realize its logical palette so that it receives the best possible mapping of colors for its logical palette.</span></span> <span data-ttu-id="02192-108">Когда приложение получает сообщение, оно должно использовать функции [**селектпалетте**](/windows/desktop/api/Wingdi/nf-wingdi-selectpalette), [**унреализеобжект**](/windows/desktop/api/Wingdi/nf-wingdi-unrealizeobject)и [**реализепалетте**](/windows/desktop/api/Wingdi/nf-wingdi-realizepalette) для выбора и реализации логической палитры.</span><span class="sxs-lookup"><span data-stu-id="02192-108">When the application receives the message, it should use the [**SelectPalette**](/windows/desktop/api/Wingdi/nf-wingdi-selectpalette), [**UnrealizeObject**](/windows/desktop/api/Wingdi/nf-wingdi-unrealizeobject), and [**RealizePalette**](/windows/desktop/api/Wingdi/nf-wingdi-realizepalette) functions to select and realize the logical palette.</span></span> <span data-ttu-id="02192-109">Это направляет систему на обновление цветов в системной палитре таким образом, чтобы ее цвета соответствовали максимальному числу цветов в логической палитре.</span><span class="sxs-lookup"><span data-stu-id="02192-109">Doing so directs the system to update colors in the system palette so that its colors match as many colors in the logical palette as possible.</span></span>

<span data-ttu-id="02192-110">Когда приложение вызывает изменения в системной палитре в результате реализации логической палитры, система отправляет сообщение [**WM \_ палеттечанжед**](wm-palettechanged.md) всем окнам верхнего уровня и перекрывающихся окон.</span><span class="sxs-lookup"><span data-stu-id="02192-110">When an application causes changes to the system palette as a result of realizing its logical palette, the system sends a [**WM\_PALETTECHANGED**](wm-palettechanged.md) message to all top-level and overlapped windows.</span></span> <span data-ttu-id="02192-111">Это сообщение предоставляет приложениям возможность обновлять цвета в клиентских областях окна, заменяя цвета, которые были изменены, цветами, более точно соответствующими нужным цветам.</span><span class="sxs-lookup"><span data-stu-id="02192-111">This message gives applications the opportunity to update the colors in the client areas of their windows, replacing colors that have changed with colors that more closely match the intended colors.</span></span> <span data-ttu-id="02192-112">Приложение, получающее сообщение **WM \_ палеттечанжед** , должно использовать [**унреализеобжект**](/windows/desktop/api/Wingdi/nf-wingdi-unrealizeobject) и [**реализепалетте**](/windows/desktop/api/Wingdi/nf-wingdi-realizepalette) для сброса логических палитр, связанных со всеми неактивными окнами, а затем обновлять цвета в клиентской области для каждого неактивного окна с помощью функции [**упдатеколорс**](/windows/desktop/api/Wingdi/nf-wingdi-updatecolors) .</span><span class="sxs-lookup"><span data-stu-id="02192-112">An application that receives the **WM\_PALETTECHANGED** message should use [**UnrealizeObject**](/windows/desktop/api/Wingdi/nf-wingdi-unrealizeobject) and [**RealizePalette**](/windows/desktop/api/Wingdi/nf-wingdi-realizepalette) to reset the logical palettes associated with all inactive windows and then update the colors in the client area for each inactive window by using the [**UpdateColors**](/windows/desktop/api/Wingdi/nf-wingdi-updatecolors) function.</span></span> <span data-ttu-id="02192-113">Этот метод не гарантирует наибольшее число точных совпадений цветов. Однако это гарантирует, что цвета в логической палитре сопоставлены с разумными цветами в системной палитре.</span><span class="sxs-lookup"><span data-stu-id="02192-113">This technique does not guarantee the greatest number of exact color matches; however, it does ensure that colors in the logical palette are mapped to reasonable colors in the system palette.</span></span>

> [!Note]  
> <span data-ttu-id="02192-114">Чтобы избежать создания бесконечного цикла, приложение никогда не должно понимать палитру для окна, чей Handle соответствует маркеру, переданному в параметре *wParam* сообщения [**WM \_ палеттечанжед**](wm-palettechanged.md) .</span><span class="sxs-lookup"><span data-stu-id="02192-114">To avoid creating an infinite loop, an application should never realize the palette for the window whose handle matches the handle passed in the *wParam* parameter of the [**WM\_PALETTECHANGED**](wm-palettechanged.md) message.</span></span>

 

<span data-ttu-id="02192-115">Функция [**упдатеколорс**](/windows/desktop/api/Wingdi/nf-wingdi-updatecolors) обычно обновляет клиентскую область неактивного окна быстрее, чем перерисовка области.</span><span class="sxs-lookup"><span data-stu-id="02192-115">The [**UpdateColors**](/windows/desktop/api/Wingdi/nf-wingdi-updatecolors) function typically updates a client area of an inactive window faster than redrawing the area.</span></span> <span data-ttu-id="02192-116">Однако, поскольку **упдатеколорс** выполняет преобразование цветов на основе цвета каждого пикселя до изменения системной палитры, каждый вызов этой функции приводит к утрате некоторой точности цвета.</span><span class="sxs-lookup"><span data-stu-id="02192-116">However, because **UpdateColors** performs color translation based on the color of each pixel before the system palette changed, each call to this function results in the loss of some color accuracy.</span></span> <span data-ttu-id="02192-117">Это означает, что **упдатеколорс** нельзя использовать для обновления цветов, когда окно станет активным.</span><span class="sxs-lookup"><span data-stu-id="02192-117">This means **UpdateColors** cannot be used to update colors when the window becomes active.</span></span> <span data-ttu-id="02192-118">В таких случаях приложение должно перерисовывать клиентскую область.</span><span class="sxs-lookup"><span data-stu-id="02192-118">In such cases, the application should redraw the client area.</span></span>

<span data-ttu-id="02192-119">Система может отправить сообщение [**WM \_ куериневпалетте**](wm-querynewpalette.md) при внесении изменений в логическую палитру.</span><span class="sxs-lookup"><span data-stu-id="02192-119">The system may send the [**WM\_QUERYNEWPALETTE**](wm-querynewpalette.md) message when changes to the logical palette are made.</span></span> <span data-ttu-id="02192-120">Кроме того, система может отправить сообщение [**WM \_ палеттеисчангинг**](wm-paletteischanging.md) всем окнам верхнего уровня и перекрывающихся окон при изменении системной палитры.</span><span class="sxs-lookup"><span data-stu-id="02192-120">Also, the system may send the [**WM\_PALETTEISCHANGING**](wm-paletteischanging.md) message to all top-level and overlapped windows when the system palette is about to change.</span></span>

 

 



