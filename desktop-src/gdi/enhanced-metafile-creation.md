---
description: Для создания расширенного метафайла используется функция Креатинхметафиле, предоставляя соответствующие аргументы.
ms.assetid: b012e50e-a7f5-4687-9833-38dacc113d77
title: Расширенное создание метафайлов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 080c350e41e895c5d4bf834a6f407cca5907743d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103811962"
---
# <a name="enhanced-metafile-creation"></a><span data-ttu-id="77da0-103">Расширенное создание метафайлов</span><span class="sxs-lookup"><span data-stu-id="77da0-103">Enhanced Metafile Creation</span></span>

<span data-ttu-id="77da0-104">Для создания расширенного метафайла используется функция [**креатинхметафиле**](/windows/desktop/api/Wingdi/nf-wingdi-createenhmetafilea) , предоставляя соответствующие аргументы.</span><span class="sxs-lookup"><span data-stu-id="77da0-104">You create an enhanced metafile by using the [**CreateEnhMetaFile**](/windows/desktop/api/Wingdi/nf-wingdi-createenhmetafilea) function, supplying the appropriate arguments.</span></span> <span data-ttu-id="77da0-105">Система использует эти аргументы для сохранения размеров изображения, определяет, должен ли метафайл храниться на диске или в памяти и т. д.</span><span class="sxs-lookup"><span data-stu-id="77da0-105">The system uses these arguments to maintain picture dimensions, determine whether the metafile should be stored on a disk or in memory, and so on.</span></span>

<span data-ttu-id="77da0-106">Чтобы поддерживать размеры изображений на выходных устройствах, [**креатинхметафиле**](/windows/desktop/api/Wingdi/nf-wingdi-createenhmetafilea) требует разрешения эталонного устройства.</span><span class="sxs-lookup"><span data-stu-id="77da0-106">To maintain picture dimensions across output devices, [**CreateEnhMetaFile**](/windows/desktop/api/Wingdi/nf-wingdi-createenhmetafilea) requires the resolution of the reference device.</span></span> <span data-ttu-id="77da0-107">Это устройство, на котором впервые появилось изображение, а *ссылочный контроллер домена* — это *контекст устройства* , связанный с *устройством-ссылкой* .</span><span class="sxs-lookup"><span data-stu-id="77da0-107">This *reference device* is the device on which the picture first appeared, and the *reference DC* is the *device context* associated with the reference device.</span></span> <span data-ttu-id="77da0-108">При вызове функции **креатинхметафиле** необходимо указать маркер, идентифицирующий этот контроллер домена.</span><span class="sxs-lookup"><span data-stu-id="77da0-108">When calling the **CreateEnhMetaFile** function, you must supply a handle that identifies this DC.</span></span> <span data-ttu-id="77da0-109">Этот обработчик можно получить, вызвав функцию [**GetDC**](/windows/desktop/api/Winuser/nf-winuser-getdc) или [**креатедк**](/windows/desktop/api/Wingdi/nf-wingdi-createdca) .</span><span class="sxs-lookup"><span data-stu-id="77da0-109">You can get this handle by calling the [**GetDC**](/windows/desktop/api/Winuser/nf-winuser-getdc) or [**CreateDC**](/windows/desktop/api/Wingdi/nf-wingdi-createdca) function.</span></span> <span data-ttu-id="77da0-110">Можно также указать **значение NULL** в качестве маркера для использования текущего устройства дисплея для эталонного устройства.</span><span class="sxs-lookup"><span data-stu-id="77da0-110">You can also specify **NULL** as the handle to use the current display device for the reference device.</span></span>

<span data-ttu-id="77da0-111">Большинство приложений постоянно хранят изображения и, следовательно, создают расширенный метафайл, хранящийся на диске. Однако в некоторых случаях это не требуется.</span><span class="sxs-lookup"><span data-stu-id="77da0-111">Most applications store pictures permanently and therefore create an enhanced metafile that is stored on a disk; however, there are some instances when this is not necessary.</span></span> <span data-ttu-id="77da0-112">Например, приложение для обработки текстов, которое предоставляет возможности рисования диаграмм, может хранить определенную пользователем диаграмму в памяти в виде расширенного метафайла, а затем копировать в файл документа пользователя расширенные метафайлы из памяти.</span><span class="sxs-lookup"><span data-stu-id="77da0-112">For example, a word-processing application that provides chart-drawing capabilities could store a user-defined chart in memory as an enhanced metafile and then copy the enhanced metafile bits from memory into the user's document file.</span></span> <span data-ttu-id="77da0-113">Приложение, которое требует постоянного сохранения на диске метафайла, должно указывать имя файла при вызове [**креатинхметафиле**](/windows/desktop/api/Wingdi/nf-wingdi-createenhmetafilea).</span><span class="sxs-lookup"><span data-stu-id="77da0-113">An application that requires a metafile that is stored permanently on a disk must supply the file name when it calls [**CreateEnhMetaFile**](/windows/desktop/api/Wingdi/nf-wingdi-createenhmetafilea).</span></span> <span data-ttu-id="77da0-114">Если имя файла не указано, система автоматически рассчитает метафайл как временный файл и сохранит его в памяти.</span><span class="sxs-lookup"><span data-stu-id="77da0-114">If you do not supply a file name, the system automatically treats the metafile as a temporary file and stores it in memory.</span></span>

<span data-ttu-id="77da0-115">В метафайл, содержащий сведения о снимке и авторе, можно добавить необязательное текстовое описание.</span><span class="sxs-lookup"><span data-stu-id="77da0-115">You can add an optional text description to a metafile containing information about the picture and the author.</span></span> <span data-ttu-id="77da0-116">Приложение может отображать эти строки в диалоговом окне открытия файла, чтобы предоставить пользователю сведения о содержимом метафайлов, которые помогут выбрать соответствующий файл.</span><span class="sxs-lookup"><span data-stu-id="77da0-116">An application can display these strings in the File Open dialog box to provide the user with information about metafile content that will help in selecting the appropriate file.</span></span> <span data-ttu-id="77da0-117">Если приложение содержит текстовое описание, оно должно предоставить указатель на строку при вызове [**креатинхметафиле**](/windows/desktop/api/Wingdi/nf-wingdi-createenhmetafilea).</span><span class="sxs-lookup"><span data-stu-id="77da0-117">If an application includes the text description, it must supply a pointer to the string when it calls [**CreateEnhMetaFile**](/windows/desktop/api/Wingdi/nf-wingdi-createenhmetafilea).</span></span>

<span data-ttu-id="77da0-118">Когда [**креатинхметафиле**](/windows/desktop/api/Wingdi/nf-wingdi-createenhmetafilea) завершается, возвращается маркер, который идентифицирует специальный контекст устройства Metafile.</span><span class="sxs-lookup"><span data-stu-id="77da0-118">When [**CreateEnhMetaFile**](/windows/desktop/api/Wingdi/nf-wingdi-createenhmetafilea) succeeds, it returns a handle that identifies a special metafile device context.</span></span> <span data-ttu-id="77da0-119">Контекст устройства метафайла уникален в том, что он связан с файлом, а не с устройством вывода.</span><span class="sxs-lookup"><span data-stu-id="77da0-119">A metafile device context is unique in that it is associated with a file rather than with an output device.</span></span> <span data-ttu-id="77da0-120">Когда система обрабатывает функцию GDI, которая получила маркер для контекста устройства метафайла, она преобразует функцию GDI в запись расширенного метафайла и добавляет запись в конец расширенного метафайла.</span><span class="sxs-lookup"><span data-stu-id="77da0-120">When the system processes a GDI function that received a handle to a metafile device context, it converts the GDI function into an enhanced-metafile record and appends the record to the end of the enhanced metafile.</span></span>

<span data-ttu-id="77da0-121">После завершения изображения и добавления последней записи к расширенному метафайлу приложение может закрыть файл, вызвав функцию [**клосинхметафиле**](/windows/desktop/api/Wingdi/nf-wingdi-closeenhmetafile) .</span><span class="sxs-lookup"><span data-stu-id="77da0-121">After a picture is complete and the last record is appended to the enhanced metafile, the application can close the file by calling the [**CloseEnhMetaFile**](/windows/desktop/api/Wingdi/nf-wingdi-closeenhmetafile) function.</span></span> <span data-ttu-id="77da0-122">Эта функция закрывает и удаляет специальный контекст устройства метафайла и возвращает маркер, идентифицирующий расширенный метафайл.</span><span class="sxs-lookup"><span data-stu-id="77da0-122">This function closes and deletes the special metafile device context and returns a handle identifying the enhanced metafile.</span></span>

<span data-ttu-id="77da0-123">Чтобы удалить метафайл с расширенным форматом или расширенный формат метафайлов, вызовите функцию [**делетинхметафиле**](/windows/desktop/api/Wingdi/nf-wingdi-deleteenhmetafile) .</span><span class="sxs-lookup"><span data-stu-id="77da0-123">To delete an enhanced-format metafile or an enhanced-format metafile handle, call the [**DeleteEnhMetaFile**](/windows/desktop/api/Wingdi/nf-wingdi-deleteenhmetafile) function.</span></span>

 

 



