---
description: Чтобы позволить приложениям размещать выходные данные в памяти, а не отправлять их на реальное устройство, используйте специальный контекст устройства для операций точечного рисунка, который называется контекстом устройства памяти.
ms.assetid: 0a682dc4-31a4-43c8-b0b1-ab01986b1dac
title: Контексты устройств памяти
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 095de04fdf965a87011895015ad7ea6c9782e286
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103811938"
---
# <a name="memory-device-contexts"></a><span data-ttu-id="6406a-103">Контексты устройств памяти</span><span class="sxs-lookup"><span data-stu-id="6406a-103">Memory Device Contexts</span></span>

<span data-ttu-id="6406a-104">Чтобы позволить приложениям размещать выходные данные в памяти, а не отправлять их на реальное устройство, используйте специальный контекст устройства для операций точечного рисунка, который называется *контекстом устройства памяти*.</span><span class="sxs-lookup"><span data-stu-id="6406a-104">To enable applications to place output in memory rather than sending it to an actual device, use a special device context for bitmap operations called a *memory device context*.</span></span> <span data-ttu-id="6406a-105">Контроллер домена памяти позволяет системе обрабатывать часть памяти как виртуальное устройство.</span><span class="sxs-lookup"><span data-stu-id="6406a-105">A memory DC enables the system to treat a portion of memory as a virtual device.</span></span> <span data-ttu-id="6406a-106">Это массив битов в памяти, который приложение может временно использовать для хранения цветовых данных для точечных рисунков, созданных на обычной поверхности рисования.</span><span class="sxs-lookup"><span data-stu-id="6406a-106">It is an array of bits in memory that an application can use temporarily to store the color data for bitmaps created on a normal drawing surface.</span></span> <span data-ttu-id="6406a-107">Так как точечный рисунок совместим с устройством, контроллер памяти также иногда называют *совместимым контекстом устройства*.</span><span class="sxs-lookup"><span data-stu-id="6406a-107">Because the bitmap is compatible with the device, a memory DC is also sometimes referred to as a *compatible device context*.</span></span>

<span data-ttu-id="6406a-108">Контроллер домена памяти хранит растровые изображения для конкретного устройства.</span><span class="sxs-lookup"><span data-stu-id="6406a-108">The memory DC stores bitmap images for a particular device.</span></span> <span data-ttu-id="6406a-109">Приложение может создать контроллер домена памяти, вызвав функцию [**креатекомпатибледк**](/windows/desktop/api/Wingdi/nf-wingdi-createcompatibledc) .</span><span class="sxs-lookup"><span data-stu-id="6406a-109">An application can create a memory DC by calling the [**CreateCompatibleDC**](/windows/desktop/api/Wingdi/nf-wingdi-createcompatibledc) function.</span></span>

<span data-ttu-id="6406a-110">Исходным точечным рисунком в памяти DC является просто заполнитель.</span><span class="sxs-lookup"><span data-stu-id="6406a-110">The original bitmap in a memory DC is simply a placeholder.</span></span> <span data-ttu-id="6406a-111">Его размеры — один пиксель на один пиксель.</span><span class="sxs-lookup"><span data-stu-id="6406a-111">Its dimensions are one pixel by one pixel.</span></span> <span data-ttu-id="6406a-112">Прежде чем приложение сможет начать рисование, необходимо выбрать точечный рисунок с соответствующей шириной и высотой в контроллере домена, вызвав функцию [**SelectObject**](/windows/desktop/api/Wingdi/nf-wingdi-selectobject) .</span><span class="sxs-lookup"><span data-stu-id="6406a-112">Before an application can begin drawing, it must select a bitmap with the appropriate width and height into the DC by calling the [**SelectObject**](/windows/desktop/api/Wingdi/nf-wingdi-selectobject) function.</span></span> <span data-ttu-id="6406a-113">Чтобы создать точечный рисунок соответствующих измерений, используйте функцию [**креатебитмап**](/windows/desktop/api/Wingdi/nf-wingdi-createbitmap), [**креатебитмапиндирект**](/windows/desktop/api/Wingdi/nf-wingdi-createbitmapindirect)или [**креатекомпатиблебитмап**](/windows/desktop/api/Wingdi/nf-wingdi-createcompatiblebitmap) .</span><span class="sxs-lookup"><span data-stu-id="6406a-113">To create a bitmap of the appropriate dimensions, use the [**CreateBitmap**](/windows/desktop/api/Wingdi/nf-wingdi-createbitmap), [**CreateBitmapIndirect**](/windows/desktop/api/Wingdi/nf-wingdi-createbitmapindirect), or [**CreateCompatibleBitmap**](/windows/desktop/api/Wingdi/nf-wingdi-createcompatiblebitmap) function.</span></span> <span data-ttu-id="6406a-114">После выбора растрового изображения в КОНТРОЛЛЕРе памяти система заменяет одноразрядный массив массивом, достаточно большим для хранения сведений о цвете для указанного прямоугольника пикселей.</span><span class="sxs-lookup"><span data-stu-id="6406a-114">After the bitmap is selected into the memory DC, the system replaces the single-bit array with an array large enough to store color information for the specified rectangle of pixels.</span></span>

<span data-ttu-id="6406a-115">Когда приложение передает маркер, возвращенный функцией [**креатекомпатибледк**](/windows/desktop/api/Wingdi/nf-wingdi-createcompatibledc) , в одну из функций рисования, запрошенные выходные данные не отображаются на поверхности рисования устройства.</span><span class="sxs-lookup"><span data-stu-id="6406a-115">When an application passes the handle returned by [**CreateCompatibleDC**](/windows/desktop/api/Wingdi/nf-wingdi-createcompatibledc) to one of the drawing functions, the requested output does not appear on a device's drawing surface.</span></span> <span data-ttu-id="6406a-116">Вместо этого система сохраняет сведения о цвете для результирующей линии, кривой, текста или области в массиве битов.</span><span class="sxs-lookup"><span data-stu-id="6406a-116">Instead, the system stores the color information for the resultant line, curve, text, or region in the array of bits.</span></span> <span data-ttu-id="6406a-117">Приложение может копировать изображение, сохраненное в памяти, обратно на поверхность рисования путем вызова функции [**BitBlt**](/windows/desktop/api/Wingdi/nf-wingdi-bitblt) , ОПРЕДЕЛЯЮЩЕЙ контроллер домена памяти в качестве контекста исходного устройства, а также окна или экрана контроллера домена в качестве контекста целевого устройства.</span><span class="sxs-lookup"><span data-stu-id="6406a-117">The application can copy the image stored in memory back onto a drawing surface by calling the [**BitBlt**](/windows/desktop/api/Wingdi/nf-wingdi-bitblt) function, identifying the memory DC as the source device context and a window or screen DC as the target device context.</span></span>

<span data-ttu-id="6406a-118">При отображении DIB или DDB, созданного на основе DIB на устройстве палитры, можно увеличить скорость рисования изображения, разложив логическую палитру в соответствии с макетом системной палитры.</span><span class="sxs-lookup"><span data-stu-id="6406a-118">When displaying a DIB or a DDB created from a DIB on a palette device, you can improve the speed at which the image is drawn by arranging the logical palette to match the layout of the system palette.</span></span> <span data-ttu-id="6406a-119">Для этого вызовите [**жетдевицекапс**](/windows/desktop/api/Wingdi/nf-wingdi-getdevicecaps) со значением нумресервед, чтобы получить количество зарезервированных цветов в системе.</span><span class="sxs-lookup"><span data-stu-id="6406a-119">To do this, call [**GetDeviceCaps**](/windows/desktop/api/Wingdi/nf-wingdi-getdevicecaps) with the NUMRESERVED value to get the number of reserved colors in the system.</span></span> <span data-ttu-id="6406a-120">Затем вызовите [**жетсистемпалеттинтриес**](/windows/desktop/api/Wingdi/nf-wingdi-getsystempaletteentries) и заполните первую и последнюю нумресервед/2 записи логической палитры соответствующими системными цветами.</span><span class="sxs-lookup"><span data-stu-id="6406a-120">Then call [**GetSystemPaletteEntries**](/windows/desktop/api/Wingdi/nf-wingdi-getsystempaletteentries) and fill in the first and last NUMRESERVED/2 entries of the logical palette with the corresponding system colors.</span></span> <span data-ttu-id="6406a-121">Например, если НУМРЕСЕРВЕД имеет значение 20, необходимо заполнить первые и последние 10 записей логической палитры системными цветами.</span><span class="sxs-lookup"><span data-stu-id="6406a-121">For example, if NUMRESERVED is 20, you would fill in the first and last 10 entries of the logical palette with the system colors.</span></span> <span data-ttu-id="6406a-122">Затем заполните оставшиеся 256-НУМРЕСЕРВЕД цвета логической палитры (в нашем примере — остальные 236 цвета) с цветами из DIB и установите флаг "СВЕРНУТЬ ПК" \_ на каждом из этих цветов.</span><span class="sxs-lookup"><span data-stu-id="6406a-122">Then fill in the remaining 256-NUMRESERVED colors of the logical palette (in our example, the remaining 236 colors) with colors from the DIB and set the PC\_NOCOLLAPSE flag on each of these colors.</span></span>

<span data-ttu-id="6406a-123">Дополнительные сведения о цветах и палитрах см. в разделе [цвета](colors.md).</span><span class="sxs-lookup"><span data-stu-id="6406a-123">For more information about color and palettes, see [Colors](colors.md).</span></span> <span data-ttu-id="6406a-124">Дополнительные сведения о растровых изображениях и операциях точечных рисунков см. в разделе [точечные рисунки](bitmaps.md).</span><span class="sxs-lookup"><span data-stu-id="6406a-124">For more information about bitmaps and bitmap operations, see [Bitmaps](bitmaps.md).</span></span>

 

 



