---
description: Система поддерживает системную палитру для каждого устройства, использующего палитры.
ms.assetid: 4c93ce8c-6b3a-4016-bb47-786c25b93374
title: Системная палитра
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6d8738cf63eef0b77f2d184f2cf95b6550b81053
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104997655"
---
# <a name="system-palette"></a><span data-ttu-id="6e4b4-103">Системная палитра</span><span class="sxs-lookup"><span data-stu-id="6e4b4-103">System Palette</span></span>

<span data-ttu-id="6e4b4-104">Система поддерживает *системную палитру* для каждого устройства, использующего палитры.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-104">The system maintains a *system palette* for each device that uses palettes.</span></span> <span data-ttu-id="6e4b4-105">Системная палитра содержит цветовые значения для всех цветов, которые в настоящее время могут быть отображены или выведены устройством.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-105">The system palette contains the color values for all colors that can currently be displayed or drawn by the device.</span></span> <span data-ttu-id="6e4b4-106">В отличие от просмотра содержимого системной палитры, приложения не могут напрямую получить доступ к системной палитре.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-106">Other than viewing the contents of the system palette, applications cannot access the system palette directly.</span></span> <span data-ttu-id="6e4b4-107">Вместо этого система имеет полный контроль над системной палитрой и разрешает доступ только с помощью логических палитр.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-107">Instead, the system has complete control of the system palette and permits access only through the use of logical palettes.</span></span>

<span data-ttu-id="6e4b4-108">Приложение может просматривать содержимое системной палитры с помощью функции [**жетсистемпалеттинтриес**](/windows/desktop/api/Wingdi/nf-wingdi-getsystempaletteentries) .</span><span class="sxs-lookup"><span data-stu-id="6e4b4-108">An application can view the contents of the system palette by using the [**GetSystemPaletteEntries**](/windows/desktop/api/Wingdi/nf-wingdi-getsystempaletteentries) function.</span></span> <span data-ttu-id="6e4b4-109">Эта функция получает содержимое одной или нескольких записей вплоть до общего числа записей в системной палитре.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-109">This function retrieves the contents of one or more entries, up to the total number of entries in the system palette.</span></span> <span data-ttu-id="6e4b4-110">Итог всегда равен числу, возвращенному для значения СИЗЕПАЛЕТТЕ функцией [**жетдевицекапс**](/windows/desktop/api/Wingdi/nf-wingdi-getdevicecaps) , и совпадает с максимальным размером для любой указанной логической палитры.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-110">The total is always equal to the number returned for the SIZEPALETTE value by the [**GetDeviceCaps**](/windows/desktop/api/Wingdi/nf-wingdi-getdevicecaps) function and is the same as the maximum size for any given logical palette.</span></span>

<span data-ttu-id="6e4b4-111">Хотя приложения не могут изменять цвета в системной палитре напрямую, они могут вызвать изменения при реализации логических палитр.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-111">Although applications cannot change colors in the system palette directly, they may cause changes when realizing logical palettes.</span></span> <span data-ttu-id="6e4b4-112">Чтобы реализовать палитру, система проверяет каждый запрошенный цвет и пытается найти в системной палитре запись, содержащую точное совпадение.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-112">To realize a palette, the system examines each requested color and attempts to find an entry in the system palette that contains an exact match.</span></span> <span data-ttu-id="6e4b4-113">Если система находит соответствующий цвет, она сопоставляет индекс логической палитры с соответствующим индексом системной палитры.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-113">If the system finds a matching color, it maps the logical palette index to the corresponding system palette index.</span></span> <span data-ttu-id="6e4b4-114">Если система не находит точное совпадение, то перед сопоставлением индексов копирует запрошенный цвет в неиспользуемую запись системной палитры.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-114">If the system does not find an exact match, it copies the requested color to an unused system palette entry before mapping the indexes.</span></span> <span data-ttu-id="6e4b4-115">Если все записи палитры системы используются, система сопоставляет индекс логической палитры с записью системной палитры, цвет которой наиболее полно соответствует запрошенному цвету.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-115">If all system palette entries are in use, the system maps the logical palette index to the system palette entry whose color most closely matches the requested color.</span></span> <span data-ttu-id="6e4b4-116">После установки этого сопоставления приложения не могут его переопределить.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-116">After this mapping is set, applications cannot override it.</span></span> <span data-ttu-id="6e4b4-117">Например, приложения не могут использовать индексы системной палитры для указания цветов. разрешены только индексы логической палитры.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-117">For example, applications cannot use system palette indexes to specify colors; only logical palette indexes are permitted.</span></span>

<span data-ttu-id="6e4b4-118">Приложения могут изменять способ сопоставления индексов, устанавливая для элемента **пефлагс** структуры [**палеттинтри**](/previous-versions//dd162769(v=vs.85)) значения, выбранные при создании логической палитры.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-118">Applications can modify the way indexes are mapped by setting the **peFlags** member of the [**PALETTEENTRY**](/previous-versions//dd162769(v=vs.85)) structure to selected values when creating the logical palette.</span></span> <span data-ttu-id="6e4b4-119">Например, \_ флаг "НЕсвернутый компьютер" направляет систему на немедленное копирование запрошенного цвета в неиспользуемую запись системной палитры независимо от того, содержит ли эта запись в системной палитре этот цвет.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-119">For example, the PC\_NOCOLLAPSE flag directs the system to immediately copy the requested color to an unused system palette entry regardless of whether a system palette entry already contains that color.</span></span> <span data-ttu-id="6e4b4-120">Кроме того, при явном \_ флаге ПК система сопоставляет логический индекс палитры с явно заданным индексом системной палитры.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-120">Also, the PC\_EXPLICIT flag directs the system to map the logical palette index to an explicitly given system palette index.</span></span> <span data-ttu-id="6e4b4-121">(Приложение предоставляет индекс системной палитры в младшем слове структуры **палеттинтри** .)</span><span class="sxs-lookup"><span data-stu-id="6e4b4-121">(The application gives the system palette index in the low-order word of the **PALETTEENTRY** structure.)</span></span>

<span data-ttu-id="6e4b4-122">Палитры можно реализовать в виде палитры фона или переднего плана, указав **true** или **false** соответственно для параметра *бфорцебаккграунд* в функции [**селектпалетте**](/windows/desktop/api/Wingdi/nf-wingdi-selectpalette) .</span><span class="sxs-lookup"><span data-stu-id="6e4b4-122">Palettes can be realized as either a background palette or a foreground palette by specifying **TRUE** or **FALSE** respectively for the *bForceBackground* parameter in the [**SelectPalette**](/windows/desktop/api/Wingdi/nf-wingdi-selectpalette) function.</span></span> <span data-ttu-id="6e4b4-123">В системе может быть только одна цветовая палитра.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-123">There can be only one foreground palette in the system at a time.</span></span> <span data-ttu-id="6e4b4-124">Если окно является активным в данный момент окном или потомком текущего активного окна, он может реализовать палитру переднего плана.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-124">If the window is the currently active window or a descendent of the currently active window, it can realize a foreground palette.</span></span> <span data-ttu-id="6e4b4-125">В противном случае палитра будет реализована как палитра фона независимо от значения параметра *бфорцебаккграунд* .</span><span class="sxs-lookup"><span data-stu-id="6e4b4-125">Otherwise the palette is realized as a background palette regardless of the value of the *bForceBackground* parameter.</span></span> <span data-ttu-id="6e4b4-126">Критическое свойство палитры переднего плана состоит в том, что при реализации она может перезаписывать все записи (за исключением статических записей) в системной палитре.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-126">The critical property of a foreground palette is that, when realized, it can overwrite all entries (except for the static entries) in the system palette.</span></span> <span data-ttu-id="6e4b4-127">Система выполняет эту задачу, помечая все записи, не являющиеся статическими в системной палитре, как неиспользуемые перед реализацией палитры переднего плана, тем самым исключая все используемые записи.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-127">The system accomplishes this by marking all of the entries that are not static in the system palette as unused before the realization of a foreground palette, thereby eliminating all of the used entries.</span></span> <span data-ttu-id="6e4b4-128">В системной палитре не выполняется предварительная обработка для реализации палитры фона.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-128">No preprocessing occurs on the system palette for a background palette realization.</span></span> <span data-ttu-id="6e4b4-129">В палитре переднего плана устанавливаются все возможные нестатические цвета.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-129">The foreground palette sets all of the possible nonstatic colors.</span></span> <span data-ttu-id="6e4b4-130">Фоновые палитры могут устанавливать только те, которые остаются открытыми и имеют приоритет по принципу «первым пришел».</span><span class="sxs-lookup"><span data-stu-id="6e4b4-130">Background palettes can set only what remains open and are prioritized in a first-come, first-serve manner.</span></span> <span data-ttu-id="6e4b4-131">Как правило, приложения используют фоновые палитры для дочерних окон, которые реализуют собственные отдельные палитры.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-131">Typically, applications use background palettes for child windows which realize their own individual palettes.</span></span> <span data-ttu-id="6e4b4-132">Это помогает снизить количество изменений, происходящих в системной палитре.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-132">This helps minimize the number of changes that occur to the system palette.</span></span>

<span data-ttu-id="6e4b4-133">Неиспользуемая запись системной палитры — это любая запись, которая не является зарезервированной и не содержит статического цвета.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-133">An unused system palette entry is any entry that is not reserved and does not contain a static color.</span></span> <span data-ttu-id="6e4b4-134">Зарезервированные записи явным образом помечаются \_ зарезервированным ЗНАЧЕНИЕМ ПК.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-134">Reserved entries are explicitly marked with the PC\_RESERVED value.</span></span> <span data-ttu-id="6e4b4-135">Эти записи создаются, когда приложение реализует логическую палитру для анимации палитры.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-135">These entries are created when an application realizes a logical palette for palette animation.</span></span> <span data-ttu-id="6e4b4-136">Статические записи цветов создаются системой и соответствуют цветам в палитре по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-136">Static color entries are created by the system and correspond to the colors in the default palette.</span></span> <span data-ttu-id="6e4b4-137">Функцию [**жетдевицекапс**](/windows/desktop/api/Wingdi/nf-wingdi-getdevicecaps) можно использовать для получения значения нумресервед, которое указывает количество записей системной палитры, зарезервированных для статических цветов.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-137">The [**GetDeviceCaps**](/windows/desktop/api/Wingdi/nf-wingdi-getdevicecaps) function can be used to retrieve the NUMRESERVED value, which specifies the number of system palette entries reserved for static colors.</span></span>

<span data-ttu-id="6e4b4-138">Так как системная палитра содержит ограниченное число записей, выбор и реализация логической палитры для конкретного устройства может повлиять на цвета, связанные с другими логическими палитрами для того же устройства.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-138">Because the system palette has a limited number of entries, selecting and realizing a logical palette for a given device may affect the colors associated with other logical palettes for the same device.</span></span> <span data-ttu-id="6e4b4-139">Эти изменения цвета особенно различны при возникновении на экране.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-139">These color changes are especially dramatic when they occur on the display.</span></span> <span data-ttu-id="6e4b4-140">Приложение может обеспечить использование разумных цветов для выбранной в данный момент логической палитры путем сброса палитры перед каждым использованием.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-140">An application can make sure that reasonable colors are used for its currently selected logical palette by resetting the palette before each use.</span></span> <span data-ttu-id="6e4b4-141">Приложение сбрасывает палитру, вызывая функции [**унреализеобжект**](/windows/desktop/api/Wingdi/nf-wingdi-unrealizeobject) и [**реализепалетте**](/windows/desktop/api/Wingdi/nf-wingdi-realizepalette) .</span><span class="sxs-lookup"><span data-stu-id="6e4b4-141">An application resets the palette by calling the [**UnrealizeObject**](/windows/desktop/api/Wingdi/nf-wingdi-unrealizeobject) and [**RealizePalette**](/windows/desktop/api/Wingdi/nf-wingdi-realizepalette) functions.</span></span> <span data-ttu-id="6e4b4-142">Использование этих функций приводит к тому, что система переназначит цвета логической палитры в разумные цвета в системной палитре.</span><span class="sxs-lookup"><span data-stu-id="6e4b4-142">Using these functions causes the system to remap the colors in the logical palette to reasonable colors in the system palette.</span></span>

 

 
