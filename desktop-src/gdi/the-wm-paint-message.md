---
description: Как правило, приложение рисует в окне в ответ на \_ сообщение WM Paint.
ms.assetid: b2317ce9-e775-450e-91f5-00f735f256a3
title: Сообщение WM_PAINT
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a69f7dab736972d8b7226890144efd8763de856a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104997927"
---
# <a name="the-wm_paint-message"></a><span data-ttu-id="cccdf-103">Сообщение WM \_ Paint</span><span class="sxs-lookup"><span data-stu-id="cccdf-103">The WM\_PAINT Message</span></span>

<span data-ttu-id="cccdf-104">Как правило, приложение рисует в окне в ответ на сообщение [**WM \_ Paint**](wm-paint.md) .</span><span class="sxs-lookup"><span data-stu-id="cccdf-104">Typically, an application draws in a window in response to a [**WM\_PAINT**](wm-paint.md) message.</span></span> <span data-ttu-id="cccdf-105">Система отправляет это сообщение в процедуру окна, когда изменения в окне изменили содержимое клиентской области.</span><span class="sxs-lookup"><span data-stu-id="cccdf-105">The system sends this message to a window procedure when changes to the window have altered the content of the client area.</span></span> <span data-ttu-id="cccdf-106">Система отправляет сообщение, только если в очереди сообщений приложения нет других сообщений.</span><span class="sxs-lookup"><span data-stu-id="cccdf-106">The system sends the message only if there are no other messages in the application message queue.</span></span>

<span data-ttu-id="cccdf-107">При получении сообщения [**WM \_ Paint**](wm-paint.md) приложение может вызвать [**бегинпаинт**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) , чтобы получить контекст отображаемого устройства для клиентской области и использовать его в вызовах функций GDI для выполнения любых операций рисования, необходимых для обновления клиентской области.</span><span class="sxs-lookup"><span data-stu-id="cccdf-107">Upon receiving a [**WM\_PAINT**](wm-paint.md) message, an application can call [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) to retrieve the display device context for the client area and use it in calls to GDI functions to carry out whatever drawing operations are necessary to update the client area.</span></span> <span data-ttu-id="cccdf-108">После завершения операций рисования приложение вызывает функцию [**ендпаинт**](/windows/desktop/api/Winuser/nf-winuser-endpaint) , чтобы освободить контекст устройства отображения.</span><span class="sxs-lookup"><span data-stu-id="cccdf-108">After completing the drawing operations, the application calls the [**EndPaint**](/windows/desktop/api/Winuser/nf-winuser-endpaint) function to release the display device context.</span></span>

<span data-ttu-id="cccdf-109">Перед тем как [**бегинпаинт**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) Возвращает контекст устройства вывода, система подготавливает контекст устройства для указанного окна.</span><span class="sxs-lookup"><span data-stu-id="cccdf-109">Before [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) returns the display device context, the system prepares the device context for the specified window.</span></span> <span data-ttu-id="cccdf-110">Сначала он задает область отсечения для контекста устройства, которая будет равна пересечению части окна, требующей обновления, и части, видимой пользователю.</span><span class="sxs-lookup"><span data-stu-id="cccdf-110">It first sets the clipping region for the device context to be equal to the intersection of the portion of the window that needs updating and the portion that is visible to the user.</span></span> <span data-ttu-id="cccdf-111">Перерисовывается только те части окна, которые были изменены.</span><span class="sxs-lookup"><span data-stu-id="cccdf-111">Only those portions of the window that have changed are redrawn.</span></span> <span data-ttu-id="cccdf-112">Попытки рисования за пределами этого региона обрезаются и не отображаются на экране.</span><span class="sxs-lookup"><span data-stu-id="cccdf-112">Attempts to draw outside this region are clipped and do not appear on the screen.</span></span>

<span data-ttu-id="cccdf-113">Система может также отправить сообщения [**WM \_ Нкпаинт**](wm-ncpaint.md) и [**WM \_ ерасебкгнд**](../winmsg/wm-erasebkgnd.md) в процедуру окна до возврата [**бегинпаинт**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) .</span><span class="sxs-lookup"><span data-stu-id="cccdf-113">The system can also send [**WM\_NCPAINT**](wm-ncpaint.md) and [**WM\_ERASEBKGND**](../winmsg/wm-erasebkgnd.md) messages to the window procedure before [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) returns.</span></span> <span data-ttu-id="cccdf-114">Эти сообщения направляют приложение для рисования области неклиентской и фонового фона окна.</span><span class="sxs-lookup"><span data-stu-id="cccdf-114">These messages direct the application to draw the nonclient area and window background.</span></span> <span data-ttu-id="cccdf-115">*Неклиентская область* — это часть окна, находящегося за пределами клиентской области.</span><span class="sxs-lookup"><span data-stu-id="cccdf-115">The *nonclient area* is the part of a window that is outside of the client area.</span></span> <span data-ttu-id="cccdf-116">Область включает такие функции, как заголовок окна, меню окно (также называемое **системным** меню) и полосы прокрутки.</span><span class="sxs-lookup"><span data-stu-id="cccdf-116">The area includes features such as the title bar, window menu (also known as the **System** menu), and scroll bars.</span></span> <span data-ttu-id="cccdf-117">Большинство приложений используют функцию окна по умолчанию [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca), чтобы нарисовать эту область и, следовательно, передать ей сообщение **WM \_ нкпаинт** в эту функцию.</span><span class="sxs-lookup"><span data-stu-id="cccdf-117">Most applications rely on the default window function, [**DefWindowProc**](/windows/desktop/api/winuser/nf-winuser-defwindowproca), to draw this area and therefore pass the **WM\_NCPAINT** message to this function.</span></span> <span data-ttu-id="cccdf-118">*Фон окна* — это цвет или шаблон, который заполняется окном до начала выполнения других операций рисования.</span><span class="sxs-lookup"><span data-stu-id="cccdf-118">The *window background* is the color or pattern that a window is filled with before other drawing operations begin.</span></span> <span data-ttu-id="cccdf-119">Фон охватывает все изображения, ранее находились в окне или на экране под окном.</span><span class="sxs-lookup"><span data-stu-id="cccdf-119">The background covers any images previously in the window or on the screen under the window.</span></span> <span data-ttu-id="cccdf-120">Если окно принадлежит классу окна, имеющему кисть фона класса, функция **дефвиндовпрок** автоматически рисует фон окна.</span><span class="sxs-lookup"><span data-stu-id="cccdf-120">If a window belongs to a window class having a class background brush, the **DefWindowProc** function draws the window background automatically.</span></span>

<span data-ttu-id="cccdf-121">[**Бегинпаинт**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) заполняет структуру [**PAINTSTRUCT**](/windows/win32/api/winuser/ns-winuser-paintstruct) данными, например измерениями обновляемой части окна, и флагом, указывающим, нарисован ли фон окна.</span><span class="sxs-lookup"><span data-stu-id="cccdf-121">[**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) fills a [**PAINTSTRUCT**](/windows/win32/api/winuser/ns-winuser-paintstruct) structure with information such as the dimensions of the portion of the window to be updated and a flag indicating whether the window background has been drawn.</span></span> <span data-ttu-id="cccdf-122">Приложение может использовать эти сведения для оптимизации рисования.</span><span class="sxs-lookup"><span data-stu-id="cccdf-122">The application can use this information to optimize drawing.</span></span> <span data-ttu-id="cccdf-123">Например, он может использовать измерения области обновления, заданные элементом **члене rcpaint структуры** , чтобы ограничить рисование только теми частями окна, которые требуют обновления.</span><span class="sxs-lookup"><span data-stu-id="cccdf-123">For example, it can use the dimensions of the update region, specified by the **rcPaint** member, to limit drawing to only those portions of the window that need updating.</span></span> <span data-ttu-id="cccdf-124">Если приложение имеет очень простой вывод, оно может игнорировать регион обновления и рисовать во всем окне, полагаться на то, что система будет отклонять (обрезать) все ненужные выходные данные.</span><span class="sxs-lookup"><span data-stu-id="cccdf-124">If an application has very simple output, it can ignore the update region and draw in the entire window, relying on the system to discard (clip) any unneeded output.</span></span> <span data-ttu-id="cccdf-125">Так как рисунки, выходящие за пределы вырезанной области, отображаются на экране, отображается только прорисовка, находящаяся в области обновления.</span><span class="sxs-lookup"><span data-stu-id="cccdf-125">Because the system clips drawing that extends outside the clipping region, only drawing that is in the update region is visible.</span></span>

<span data-ttu-id="cccdf-126">[**Бегинпаинт**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) задает для области обновления окна **значение NULL**.</span><span class="sxs-lookup"><span data-stu-id="cccdf-126">[**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) sets the update region of a window to **NULL**.</span></span> <span data-ttu-id="cccdf-127">Это очищает область, предотвращая создание последующих сообщений [**WM \_ Paint**](wm-paint.md) .</span><span class="sxs-lookup"><span data-stu-id="cccdf-127">This clears the region, preventing it from generating subsequent [**WM\_PAINT**](wm-paint.md) messages.</span></span> <span data-ttu-id="cccdf-128">Если приложение обрабатывает сообщение **WM \_ Paint** , но не вызывает **бегинпаинт** или иным образом очищает регион обновления, приложение по---получит сообщения **WM \_ Paint** , пока регион не пуст.</span><span class="sxs-lookup"><span data-stu-id="cccdf-128">If an application processes a **WM\_PAINT** message but does not call **BeginPaint** or otherwise clear the update region, the application continues to receive **WM\_PAINT** messages as long as the region is not empty.</span></span> <span data-ttu-id="cccdf-129">Во всех случаях приложение должно очистить область обновления перед возвратом из сообщения **WM \_ Paint** .</span><span class="sxs-lookup"><span data-stu-id="cccdf-129">In all cases, an application must clear the update region before returning from the **WM\_PAINT** message.</span></span>

<span data-ttu-id="cccdf-130">После завершения рисования приложение должно вызвать [**ендпаинт**](/windows/desktop/api/Winuser/nf-winuser-endpaint).</span><span class="sxs-lookup"><span data-stu-id="cccdf-130">After the application finishes drawing, it should call [**EndPaint**](/windows/desktop/api/Winuser/nf-winuser-endpaint).</span></span> <span data-ttu-id="cccdf-131">В большинстве окон **ендпаинт** освобождает контекст устройства вывода, делая его доступным для других окон.</span><span class="sxs-lookup"><span data-stu-id="cccdf-131">For most windows, **EndPaint** releases the display device context, making it available to other windows.</span></span> <span data-ttu-id="cccdf-132">**Ендпаинт** также показывает курсор, если он ранее был скрыт [**бегинпаинт**](/windows/desktop/api/Winuser/nf-winuser-beginpaint).</span><span class="sxs-lookup"><span data-stu-id="cccdf-132">**EndPaint** also shows the caret, if it was previously hidden by [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint).</span></span> <span data-ttu-id="cccdf-133">**Бегинпаинт** скрывает курсор, чтобы избежать повреждения операций рисования.</span><span class="sxs-lookup"><span data-stu-id="cccdf-133">**BeginPaint** hides the caret to prevent drawing operations from corrupting it.</span></span>

-   [<span data-ttu-id="cccdf-134">Регион обновления</span><span class="sxs-lookup"><span data-stu-id="cccdf-134">The Update Region</span></span>](the-update-region.md)
-   [<span data-ttu-id="cccdf-135">Идет непроверка и проверка региона обновления</span><span class="sxs-lookup"><span data-stu-id="cccdf-135">Invalidating and Validating the Update Region</span></span>](invalidating-and-validating-the-update-region.md)
-   [<span data-ttu-id="cccdf-136">Получение региона обновления</span><span class="sxs-lookup"><span data-stu-id="cccdf-136">Retrieving the Update Region</span></span>](retrieving-the-update-region.md)
-   [<span data-ttu-id="cccdf-137">Исключение региона обновления</span><span class="sxs-lookup"><span data-stu-id="cccdf-137">Excluding the Update Region</span></span>](excluding-the-update-region.md)
-   [<span data-ttu-id="cccdf-138">Синхронное и асинхронное Рисование</span><span class="sxs-lookup"><span data-stu-id="cccdf-138">Synchronous and Asynchronous Drawing</span></span>](synchronous-and-asynchronous-drawing.md)

 

 
