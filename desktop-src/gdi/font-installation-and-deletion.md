---
description: Приложение может использовать шрифт для рисования текста только в том случае, если этот шрифт либо является резидентным на указанном устройстве, либо установлен в таблице системных шрифтов.
ms.assetid: b422b981-8760-4484-9965-f212287c421e
title: Установка и удаление шрифтов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0184054973c769462ed8c1620e5534ff909576ca
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104997378"
---
# <a name="font-installation-and-deletion"></a><span data-ttu-id="23a65-103">Установка и удаление шрифтов</span><span class="sxs-lookup"><span data-stu-id="23a65-103">Font Installation and Deletion</span></span>

<span data-ttu-id="23a65-104">Приложение может использовать шрифт для рисования текста только в том случае, если этот шрифт либо является резидентным на указанном устройстве, либо установлен в таблице системных шрифтов.</span><span class="sxs-lookup"><span data-stu-id="23a65-104">An application can use a font to draw text only if that font is either resident on a specified device or installed in the system font table.</span></span> <span data-ttu-id="23a65-105">Таблица Font является внутренним массивом, который определяет все шрифты, не являющиеся устройствами, доступные для приложения.</span><span class="sxs-lookup"><span data-stu-id="23a65-105">The font table is an internal array that identifies all nondevice fonts that are available to an application.</span></span> <span data-ttu-id="23a65-106">Приложение может извлекать имена шрифтов, установленных на устройстве или хранящихся во внутренней таблице шрифтов, вызывая функции [**EnumFontFamilies**](/windows/desktop/api/Wingdi/nf-wingdi-enumfontfamiliesa) или [**ChooseFont**](/previous-versions/windows/desktop/legacy/ms646914(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="23a65-106">An application can retrieve the names of fonts currently installed on a device or stored in the internal font table by calling the [**EnumFontFamilies**](/windows/desktop/api/Wingdi/nf-wingdi-enumfontfamiliesa) or [**ChooseFont**](/previous-versions/windows/desktop/legacy/ms646914(v=vs.85)) functions.</span></span>

<span data-ttu-id="23a65-107">Чтобы временно установить шрифт, вызовите [**аддфонтресаурце**](/windows/desktop/api/Wingdi/nf-wingdi-addfontresourcea) или [**аддфонтресаурцеекс**](/windows/desktop/api/Wingdi/nf-wingdi-addfontresourceexa).</span><span class="sxs-lookup"><span data-stu-id="23a65-107">To temporarily install a font, call [**AddFontResource**](/windows/desktop/api/Wingdi/nf-wingdi-addfontresourcea) or [**AddFontResourceEx**](/windows/desktop/api/Wingdi/nf-wingdi-addfontresourceexa).</span></span> <span data-ttu-id="23a65-108">Эти функции загружают шрифт, хранящийся в файле ресурсов шрифта.</span><span class="sxs-lookup"><span data-stu-id="23a65-108">These functions load a font that is stored in a font-resource file.</span></span> <span data-ttu-id="23a65-109">Однако это временная установка, так как после перезагрузки шрифт не будет присутствовать.</span><span class="sxs-lookup"><span data-stu-id="23a65-109">However, this is a temporary installation because after a reboot the font will not be present.</span></span>

<span data-ttu-id="23a65-110">Чтобы установить шрифт, который останется после перезагрузки системы, используйте один из следующих методов.</span><span class="sxs-lookup"><span data-stu-id="23a65-110">To install a font that will remain after the system is rebooted, use one of the following methods:</span></span>

-   <span data-ttu-id="23a65-111">Перейдите на панель управления, щелкните значок " **шрифты** " и выберите в меню " **файл** " пункт " **установить новые шрифты** ".</span><span class="sxs-lookup"><span data-stu-id="23a65-111">Go to the Control Panel, click the **Fonts** icon, and select **Install New Fonts** from the **File** menu.</span></span> <span data-ttu-id="23a65-112">Шрифт доступен для приложения даже перед перезагрузкой.</span><span class="sxs-lookup"><span data-stu-id="23a65-112">The font is available to an application even before the reboot.</span></span> <span data-ttu-id="23a65-113">Однако в случае сервера терминалов шрифт доступен для текущего сеанса, но недоступен для других сеансов до перезагрузки.</span><span class="sxs-lookup"><span data-stu-id="23a65-113">However, in a terminal server situation the font is available for the current session but is not available for other sessions until after a reboot.</span></span>
-   <span data-ttu-id="23a65-114">Скопируйте шрифт в папку% WINDIR% \\ Fonts.</span><span class="sxs-lookup"><span data-stu-id="23a65-114">Copy the font into the %windir%\\fonts folder.</span></span> <span data-ttu-id="23a65-115">Затем перейдите на панель управления и щелкните значок **шрифты** или вызовите [**аддфонтресаурце**](/windows/win32/api/wingdi/nf-wingdi-addfontresourcea) или [**аддфонтресаурцеекс**](/windows/win32/api/wingdi/nf-wingdi-addfontresourceexa).</span><span class="sxs-lookup"><span data-stu-id="23a65-115">Then, either go to the Control Panel and click the **Fonts** icon, or call [**AddFontResource**](/windows/win32/api/wingdi/nf-wingdi-addfontresourcea) or [**AddFontResourceEx**](/windows/win32/api/wingdi/nf-wingdi-addfontresourceexa).</span></span> <span data-ttu-id="23a65-116">Шрифт доступен для приложения даже перед перезагрузкой.</span><span class="sxs-lookup"><span data-stu-id="23a65-116">The font is available to an application even before the reboot.</span></span> <span data-ttu-id="23a65-117">Однако в случае сервера терминалов шрифт доступен для текущего сеанса, но недоступен для других сеансов до перезагрузки.</span><span class="sxs-lookup"><span data-stu-id="23a65-117">However, in a terminal server situation the font is available for the current session but is not available for other sessions until after a reboot.</span></span> <span data-ttu-id="23a65-118">Если скопировать шрифт в папку% WINDIR% \\ Fonts, шрифт будет доступен только после перезагрузки системы.</span><span class="sxs-lookup"><span data-stu-id="23a65-118">If you only copy the font into the %windir%\\fonts folder, the font will be available only after the system is rebooted.</span></span>

<span data-ttu-id="23a65-119">Когда приложение заканчивает использовать установленный шрифт, оно должно удалить этот шрифт, вызвав функцию [**ремовефонтресаурце**](/windows/desktop/api/Wingdi/nf-wingdi-removefontresourcea) .</span><span class="sxs-lookup"><span data-stu-id="23a65-119">When an application finishes using an installed font, it must remove that font by calling the [**RemoveFontResource**](/windows/desktop/api/Wingdi/nf-wingdi-removefontresourcea) function.</span></span>

<span data-ttu-id="23a65-120">Шрифт, установленный из расположения, отличного от папки% WINDIR% \\ Fonts, нельзя изменить при загрузке в любом активном сеансе, включая сеанс 0.</span><span class="sxs-lookup"><span data-stu-id="23a65-120">A font installed from a location other than the %windir%\\fonts folder cannot be modified when loaded in any active session, including session 0.</span></span> <span data-ttu-id="23a65-121">Любая попытка изменить, заменить или удалить, таким образом, будет заблокирована.</span><span class="sxs-lookup"><span data-stu-id="23a65-121">Any attempt to change, replace, or delete will, therefore, be blocked.</span></span> <span data-ttu-id="23a65-122">Если требуется изменение шрифта:</span><span class="sxs-lookup"><span data-stu-id="23a65-122">If modification to a font is necessary:</span></span>

-   <span data-ttu-id="23a65-123">*Временные шрифты* загружаются только в текущем сеансе.</span><span class="sxs-lookup"><span data-stu-id="23a65-123">*Temporary fonts* get loaded only in the current session.</span></span> <span data-ttu-id="23a65-124">Прежде чем пытаться внести изменения в шрифт, вызовите [**ремовефонтресаурце**](/windows/desktop/api/Wingdi/nf-wingdi-removefontresourcea) , чтобы принудительно выгрузить его в текущем сеансе.</span><span class="sxs-lookup"><span data-stu-id="23a65-124">Before attempting any font modifications, call [**RemoveFontResource**](/windows/desktop/api/Wingdi/nf-wingdi-removefontresourcea) to force the current session to unload the font.</span></span>
-   <span data-ttu-id="23a65-125">*Постоянные шрифты* остаются установленными после перезагрузки и загружаются всеми созданными сеансами.</span><span class="sxs-lookup"><span data-stu-id="23a65-125">*Permanent fonts* remain installed after reboot and are loaded by all created sessions.</span></span> <span data-ttu-id="23a65-126">Вызовите [**ремовефонтресаурце**](/windows/desktop/api/Wingdi/nf-wingdi-removefontresourcea) , чтобы принудительно выгрузить шрифт в текущем сеансе.</span><span class="sxs-lookup"><span data-stu-id="23a65-126">Call [**RemoveFontResource**](/windows/desktop/api/Wingdi/nf-wingdi-removefontresourcea) to force the current session to unload the font.</span></span> <span data-ttu-id="23a65-127">Затем в разделе реестра шрифтов (**hKey \_ Local \_ Machine \\ Software \\ Microsoft \\ Windows NT \\ CurrentVersion \\ шрифты**) найдите и удалите значение реестра, связанное со шрифтом.</span><span class="sxs-lookup"><span data-stu-id="23a65-127">Then, in the font registry key (**HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Fonts**) find and remove the registry value associated with the font.</span></span> <span data-ttu-id="23a65-128">Наконец, перезагрузите компьютер, чтобы шрифт не загружался ни в одном сеансе.</span><span class="sxs-lookup"><span data-stu-id="23a65-128">Finally, reboot the machine to ensure the font isn't loaded in any session.</span></span> <span data-ttu-id="23a65-129">После перезагрузки продолжите изменение или удаление шрифта.</span><span class="sxs-lookup"><span data-stu-id="23a65-129">After reboot, proceed with your font modification/deletion.</span></span>

<span data-ttu-id="23a65-130">Всякий раз, когда приложение вызывает функции, которые добавляют и удаляют ресурсы шрифта, оно должно также вызывать функцию [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) и передавать сообщение [**WM \_ фонтчанже**](wm-fontchange.md) всем окнам верхнего уровня в системе.</span><span class="sxs-lookup"><span data-stu-id="23a65-130">Whenever an application calls the functions that add and delete font resources, it should also call the [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) function and send a [**WM\_FONTCHANGE**](wm-fontchange.md) message to all top-level windows in the system.</span></span> <span data-ttu-id="23a65-131">Это сообщение уведомляет другие приложения о том, что внутренняя таблица шрифтов была изменена приложением, которое добавило или удалило шрифт.</span><span class="sxs-lookup"><span data-stu-id="23a65-131">This message notifies other applications that the internal font table has been altered by an application that added or removed a font.</span></span>

 

 
