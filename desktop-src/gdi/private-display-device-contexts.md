---
description: Частный контекст устройства позволяет приложению избежать извлечения и инициализации контекста экранного устройства каждый раз, когда приложение должно рисовать в окне.
ms.assetid: 8de5a14b-a8b3-42a5-81f3-bf3c357052cb
title: Контексты частных устройств просмотра
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 451dbd3c0a232610026740d0ea0fa817ea2034b8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104544407"
---
# <a name="private-display-device-contexts"></a>Контексты частных устройств просмотра

*Частный контекст устройства* позволяет приложению избежать извлечения и инициализации контекста экранного устройства каждый раз, когда приложение должно рисовать в окне. Частные контексты устройств полезны для Windows, для которых требуется много изменений значений атрибутов контекста устройства, чтобы подготовить его для рисования. Частные контексты устройств сокращают время, необходимое для подготовки контекста устройства, и, следовательно, время, необходимое для выполнения рисования в окне.

Приложение направляет систему на создание частного контекста устройства для окна, указав \_ стиль CS овндк в классе Window. Система создает уникальный контекст частного устройства каждый раз при создании нового окна, принадлежащего классу. Изначально контекст частного устройства имеет те же значения по умолчанию для атрибутов, что и общий контекст устройства, но приложение может изменить их в любое время. Система сохраняет изменения в контексте устройства на время существования окна или до тех пор, пока приложение не вносит дополнительные изменения.

Приложение может получить маркер закрытого контекста устройства с помощью функции [**GetDC**](/windows/desktop/api/Winuser/nf-winuser-getdc) в любое время после создания окна. Приложение должно получить этот обработчик только один раз. После этого он может удерживать и использовать этот обработчик любое количество раз. Так как частный контекст устройства не является частью кэша контекста устройства вывода, приложение не должно освобождать контекст устройства с помощью функции [**релеаседк**](/windows/desktop/api/Winuser/nf-winuser-releasedc) .

Система автоматически корректирует контекст устройства, чтобы отразить изменения в окне, например перемещение или изменение размера. Это гарантирует, что все перекрывающиеся окна всегда должны быть обрезаны правильно. Это значит, что приложению не требуется предпринимать никаких действий для обрезки. Однако система не изменяет контекст устройства, чтобы включить в него регион обновления. Поэтому при обработке сообщения [**WM \_ Paint**](wm-paint.md) приложение должно включать область обновления либо путем вызова [**бегинпаинт**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) , либо путем извлечения области обновления и ее пересечения с текущей областью отсечения. Если приложение не вызывает **бегинпаинт**, необходимо явно проверить область обновления с помощью функции [**валидатерект**](/windows/desktop/api/Winuser/nf-winuser-validaterect) или [**валидатергн**](/windows/desktop/api/Winuser/nf-winuser-validatergn) . Если приложение не проверяет регион обновления, окно получает бесконечную серию сообщений **WM \_ Paint** .

Так как [**бегинпаинт**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) скрывает курсор, если оно отображается в окне, приложение, вызывающее **бегинпаинт** , должно также вызывать функцию [**ендпаинт**](/windows/desktop/api/Winuser/nf-winuser-endpaint) для восстановления курсора. **Ендпаинт** не влияет на контекст частного устройства.

Хотя частный контекст устройства удобен в использовании, он требует интенсивного использования памяти с точки зрения системных ресурсов и требует 800 или более байт для хранения. Частные контексты устройств рекомендуются, когда в вопросах производительности перевешивается стоимость хранения.

Система включает частный контекст устройства при отправке сообщения [**WM \_ ерасебкгнд**](../winmsg/wm-erasebkgnd.md) приложению. Текущие параметры контекста закрытого устройства, включая режим сопоставления, действуют, когда приложение или система обрабатывает эти сообщения. Во избежание нежелательных последствий система использует логические координаты при стирании фона. Например, она использует функцию [**жетклипбокс**](/windows/desktop/api/Wingdi/nf-wingdi-getclipbox) для получения логических координат области для стирания и передает эти координаты в функцию [**филлрект**](/windows/desktop/api/Winuser/nf-winuser-fillrect) . Приложения, обрабатывающие эти сообщения, могут использовать аналогичные методы.

Приложение может использовать функцию [**жетдцекс**](/windows/desktop/api/Winuser/nf-winuser-getdcex) , чтобы заставить систему вернуть общий контекст устройства для окна с частным контекстом устройства. Это полезно для выполнения быстрого касания в окне без изменения текущих значений атрибутов закрытого контекста устройства.

 

 
