---
description: Частный контекст устройства позволяет приложению избежать извлечения и инициализации контекста экранного устройства каждый раз, когда приложение должно рисовать в окне.
ms.assetid: 8de5a14b-a8b3-42a5-81f3-bf3c357052cb
title: Контексты частных устройств просмотра
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 451dbd3c0a232610026740d0ea0fa817ea2034b8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104544407"
---
# <a name="private-display-device-contexts"></a><span data-ttu-id="059be-103">Контексты частных устройств просмотра</span><span class="sxs-lookup"><span data-stu-id="059be-103">Private Display Device Contexts</span></span>

<span data-ttu-id="059be-104">*Частный контекст устройства* позволяет приложению избежать извлечения и инициализации контекста экранного устройства каждый раз, когда приложение должно рисовать в окне.</span><span class="sxs-lookup"><span data-stu-id="059be-104">A *private device context* enables an application to avoid retrieving and initializing a display device context each time the application must draw in a window.</span></span> <span data-ttu-id="059be-105">Частные контексты устройств полезны для Windows, для которых требуется много изменений значений атрибутов контекста устройства, чтобы подготовить его для рисования.</span><span class="sxs-lookup"><span data-stu-id="059be-105">Private device contexts are useful for windows that require many changes to the values of the attributes of the device context to prepare it for drawing.</span></span> <span data-ttu-id="059be-106">Частные контексты устройств сокращают время, необходимое для подготовки контекста устройства, и, следовательно, время, необходимое для выполнения рисования в окне.</span><span class="sxs-lookup"><span data-stu-id="059be-106">Private device contexts reduce the time required to prepare the device context and therefore the time needed to carry out drawing in the window.</span></span>

<span data-ttu-id="059be-107">Приложение направляет систему на создание частного контекста устройства для окна, указав \_ стиль CS овндк в классе Window.</span><span class="sxs-lookup"><span data-stu-id="059be-107">An application directs the system to create a private device context for a window by specifying the CS\_OWNDC style in the window class.</span></span> <span data-ttu-id="059be-108">Система создает уникальный контекст частного устройства каждый раз при создании нового окна, принадлежащего классу.</span><span class="sxs-lookup"><span data-stu-id="059be-108">The system creates a unique private device context each time it creates a new window belonging to the class.</span></span> <span data-ttu-id="059be-109">Изначально контекст частного устройства имеет те же значения по умолчанию для атрибутов, что и общий контекст устройства, но приложение может изменить их в любое время.</span><span class="sxs-lookup"><span data-stu-id="059be-109">Initially, the private device context has the same default values for attributes as a common device context, but the application can modify these at any time.</span></span> <span data-ttu-id="059be-110">Система сохраняет изменения в контексте устройства на время существования окна или до тех пор, пока приложение не вносит дополнительные изменения.</span><span class="sxs-lookup"><span data-stu-id="059be-110">The system preserves changes to the device context for the life of the window or until the application makes additional changes.</span></span>

<span data-ttu-id="059be-111">Приложение может получить маркер закрытого контекста устройства с помощью функции [**GetDC**](/windows/desktop/api/Winuser/nf-winuser-getdc) в любое время после создания окна.</span><span class="sxs-lookup"><span data-stu-id="059be-111">An application can retrieve a handle to the private device context by using the [**GetDC**](/windows/desktop/api/Winuser/nf-winuser-getdc) function any time after the window is created.</span></span> <span data-ttu-id="059be-112">Приложение должно получить этот обработчик только один раз.</span><span class="sxs-lookup"><span data-stu-id="059be-112">The application must retrieve the handle only once.</span></span> <span data-ttu-id="059be-113">После этого он может удерживать и использовать этот обработчик любое количество раз.</span><span class="sxs-lookup"><span data-stu-id="059be-113">Thereafter, it can keep and use the handle any number of times.</span></span> <span data-ttu-id="059be-114">Так как частный контекст устройства не является частью кэша контекста устройства вывода, приложение не должно освобождать контекст устройства с помощью функции [**релеаседк**](/windows/desktop/api/Winuser/nf-winuser-releasedc) .</span><span class="sxs-lookup"><span data-stu-id="059be-114">Because a private device context is not part of the display device context cache, an application need never release the device context by using the [**ReleaseDC**](/windows/desktop/api/Winuser/nf-winuser-releasedc) function.</span></span>

<span data-ttu-id="059be-115">Система автоматически корректирует контекст устройства, чтобы отразить изменения в окне, например перемещение или изменение размера.</span><span class="sxs-lookup"><span data-stu-id="059be-115">The system automatically adjusts the device context to reflect changes to the window, such as moving or sizing.</span></span> <span data-ttu-id="059be-116">Это гарантирует, что все перекрывающиеся окна всегда должны быть обрезаны правильно. Это значит, что приложению не требуется предпринимать никаких действий для обрезки.</span><span class="sxs-lookup"><span data-stu-id="059be-116">This ensures that any overlapping windows are always properly clipped; that is, no action is required by the application to ensure clipping.</span></span> <span data-ttu-id="059be-117">Однако система не изменяет контекст устройства, чтобы включить в него регион обновления.</span><span class="sxs-lookup"><span data-stu-id="059be-117">However, the system does not revise the device context to include the update region.</span></span> <span data-ttu-id="059be-118">Поэтому при обработке сообщения [**WM \_ Paint**](wm-paint.md) приложение должно включать область обновления либо путем вызова [**бегинпаинт**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) , либо путем извлечения области обновления и ее пересечения с текущей областью отсечения.</span><span class="sxs-lookup"><span data-stu-id="059be-118">Therefore, when processing a [**WM\_PAINT**](wm-paint.md) message, the application must incorporate the update region either by calling [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) or by retrieving the update region and intersecting it with the current clipping region.</span></span> <span data-ttu-id="059be-119">Если приложение не вызывает **бегинпаинт**, необходимо явно проверить область обновления с помощью функции [**валидатерект**](/windows/desktop/api/Winuser/nf-winuser-validaterect) или [**валидатергн**](/windows/desktop/api/Winuser/nf-winuser-validatergn) .</span><span class="sxs-lookup"><span data-stu-id="059be-119">If the application does not call **BeginPaint**, it must explicitly validate the update region by using the [**ValidateRect**](/windows/desktop/api/Winuser/nf-winuser-validaterect) or [**ValidateRgn**](/windows/desktop/api/Winuser/nf-winuser-validatergn) function.</span></span> <span data-ttu-id="059be-120">Если приложение не проверяет регион обновления, окно получает бесконечную серию сообщений **WM \_ Paint** .</span><span class="sxs-lookup"><span data-stu-id="059be-120">If the application does not validate the update region, the window receives an endless series of **WM\_PAINT** messages.</span></span>

<span data-ttu-id="059be-121">Так как [**бегинпаинт**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) скрывает курсор, если оно отображается в окне, приложение, вызывающее **бегинпаинт** , должно также вызывать функцию [**ендпаинт**](/windows/desktop/api/Winuser/nf-winuser-endpaint) для восстановления курсора.</span><span class="sxs-lookup"><span data-stu-id="059be-121">Because [**BeginPaint**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) hides the caret if a window is showing it, an application that calls **BeginPaint** should also call the [**EndPaint**](/windows/desktop/api/Winuser/nf-winuser-endpaint) function to restore the caret.</span></span> <span data-ttu-id="059be-122">**Ендпаинт** не влияет на контекст частного устройства.</span><span class="sxs-lookup"><span data-stu-id="059be-122">**EndPaint** has no other effect on a private device context.</span></span>

<span data-ttu-id="059be-123">Хотя частный контекст устройства удобен в использовании, он требует интенсивного использования памяти с точки зрения системных ресурсов и требует 800 или более байт для хранения.</span><span class="sxs-lookup"><span data-stu-id="059be-123">Although a private device context is convenient to use, it is memory-intensive in terms of system resources, requiring 800 or more bytes to store.</span></span> <span data-ttu-id="059be-124">Частные контексты устройств рекомендуются, когда в вопросах производительности перевешивается стоимость хранения.</span><span class="sxs-lookup"><span data-stu-id="059be-124">Private device contexts are recommended when performance considerations outweigh storage costs.</span></span>

<span data-ttu-id="059be-125">Система включает частный контекст устройства при отправке сообщения [**WM \_ ерасебкгнд**](../winmsg/wm-erasebkgnd.md) приложению.</span><span class="sxs-lookup"><span data-stu-id="059be-125">The system includes the private device context when sending the [**WM\_ERASEBKGND**](../winmsg/wm-erasebkgnd.md) message to the application.</span></span> <span data-ttu-id="059be-126">Текущие параметры контекста закрытого устройства, включая режим сопоставления, действуют, когда приложение или система обрабатывает эти сообщения.</span><span class="sxs-lookup"><span data-stu-id="059be-126">The current selections of the private device context, including mapping mode, are in effect when the application or the system processes these messages.</span></span> <span data-ttu-id="059be-127">Во избежание нежелательных последствий система использует логические координаты при стирании фона. Например, она использует функцию [**жетклипбокс**](/windows/desktop/api/Wingdi/nf-wingdi-getclipbox) для получения логических координат области для стирания и передает эти координаты в функцию [**филлрект**](/windows/desktop/api/Winuser/nf-winuser-fillrect) .</span><span class="sxs-lookup"><span data-stu-id="059be-127">To avoid undesirable effects, the system uses logical coordinates when erasing the background; for example, it uses the [**GetClipBox**](/windows/desktop/api/Wingdi/nf-wingdi-getclipbox) function to retrieve the logical coordinates of the area to erase and passes these coordinates to the [**FillRect**](/windows/desktop/api/Winuser/nf-winuser-fillrect) function.</span></span> <span data-ttu-id="059be-128">Приложения, обрабатывающие эти сообщения, могут использовать аналогичные методы.</span><span class="sxs-lookup"><span data-stu-id="059be-128">Applications that process these messages can use similar techniques.</span></span>

<span data-ttu-id="059be-129">Приложение может использовать функцию [**жетдцекс**](/windows/desktop/api/Winuser/nf-winuser-getdcex) , чтобы заставить систему вернуть общий контекст устройства для окна с частным контекстом устройства.</span><span class="sxs-lookup"><span data-stu-id="059be-129">An application can use the [**GetDCEx**](/windows/desktop/api/Winuser/nf-winuser-getdcex) function to force the system to return a common device context for the window that has a private device context.</span></span> <span data-ttu-id="059be-130">Это полезно для выполнения быстрого касания в окне без изменения текущих значений атрибутов закрытого контекста устройства.</span><span class="sxs-lookup"><span data-stu-id="059be-130">This is useful for carrying out quick touch-ups to a window without changing the current values of the attributes of the private device context.</span></span>

 

 
