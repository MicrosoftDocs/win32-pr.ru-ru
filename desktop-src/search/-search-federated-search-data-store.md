---
description: в этой статье объясняется, как разрешить доступ к хранилищу данных с помощью веб-службы OpenSearch и как избежать потенциальных препятствий для этого.
ms.assetid: 27d7676c-f4e8-43b4-856b-826e07afcd78
title: включение хранилища данных в Windows федеративного поиска
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d26feb231f17dbaacb9656f2ef91e1cdb64bc598831a1e4808327dff7e5787bc
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119456763"
---
# <a name="enabling-your-data-store-in-windows-federated-search"></a>включение хранилища данных в Windows федеративного поиска

в этой статье объясняется, как разрешить доступ к хранилищу данных с помощью веб-службы [OpenSearch](https://github.com/dewitt/opensearch) и как избежать потенциальных препятствий для этого.

Этот раздел организован следующим образом:

-   [Условия принятия запроса поиска](#conditions-for-search-request-acceptance)
    -   [Поддерживаемый синтаксис запросов](#supported-query-syntax)
    -   [Поддерживаемые протоколы проверки подлинности](#supported-authentication-protocols)
-   [Отправка запросов и возврат результатов поиска в RSS или Atom](#sending-queries-and-returning-search-results-in-rss-or-atom)
    -   [Пример выходных данных RSS-канала](#example-of-an-rss-feed-output)
-   [автоматическое сопоставление со свойствами оболочки Windows](#automatic-mapping-to-windows-shell-properties)
-   [понимание того, как Карты Windows элементы в типы файлов](#understanding-how-windows-maps-items-to-file-types)
-   [Предотвращение потенциальных препятствий для включения хранилища данных](#avoiding-potential-barriers-to-enabling-a-data-store)
-   [Дополнительные ресурсы](#additional-resources)
-   [Связанные темы](#related-topics)

## <a name="conditions-for-search-request-acceptance"></a>Условия принятия запроса поиска

веб-служба [OpenSearch](https://github.com/dewitt/opensearch) , созданная на веб-сервере, **должна** удовлетворять следующим двум требованиям.

-   Возможность принимать `GET URL` запрос от клиента.
-   Позволяет внедрять условия поиска в URL-адрес.

    В следующем примере показано, как условие поиска может быть внедрено в URL-адрес.

    ```
    https://example.com/search.aspx?query=terms&param=mysearchword
    ```

    

> [!Note]  
> Федеративный поиск не поддерживает отправку `POST` запросов к веб-службе.

 

дополнительные сведения о создании url-адреса см. в разделе "параметры шаблона url-адреса" раздела [создание файла описания OpenSearch в Windows федеративного поиска](-search-federated-search-osdx-file.md).

### <a name="supported-query-syntax"></a>Поддерживаемый синтаксис запросов

в Windows 7 не ожидается специальный синтаксис запроса. поставщик OpenSearch принимает любые термины, введенные пользователем в поле ввода в обозревателе Windows, и кодирует его в URL-адрес. это делается в соответствии с шаблоном url-адреса, описанным в разделе "параметры шаблона url-адреса" раздела [создание файла описания OpenSearch в Windows федеративного поиска](-search-federated-search-osdx-file.md).

Пользователи предполагают, что отдельные термины рассматриваются как неявно and вместе. например, запрос "Microsoft Windows" должен возвращать только результаты, содержащие "Windows" и "Microsoft".

### <a name="supported-authentication-protocols"></a>Поддерживаемые протоколы проверки подлинности

Windows федеративный поиск поддерживает проверку подлинности на основе Windows и может предоставлять учетные данные веб-службам с помощью следующих протоколов:

-   NTLM.
-   Kerberos —
-   Basic (только по протоколу HTTPS).
-   другие поставщики поддержки безопасности (ssp), установленные на Windows, которые обеспечивают дополнительную производительность запросов. Сведения о потенциальном добавлении других SSP см. в документации по пакету SDK для [интерфейса SSP](../secauthn/sspi.md) .

## <a name="sending-queries-and-returning-search-results-in-rss-or-atom"></a>Отправка запросов и возврат результатов поиска в RSS или Atom

поставщик [OpenSearch](https://github.com/dewitt/opensearch) отвечает за сопоставление значений XML-элементов с Windows свойствами системы оболочки, которые могут использоваться приложениями Windows. но вы не ограничены сопоставлениями по умолчанию для стандартных элементов RSS или Atom и могут включать пользовательские XML-элементы в Windows пространство имен для каждого свойства. Например, можно добавить собственные пользовательские XML-элементы в элемент **Item** , чтобы предоставить дополнительные метаданные для Windows. Можно также сопоставлять элементы из других пространств имен XML, например iTunes

### <a name="example-of-an-rss-feed-output"></a>Пример выходных данных RSS-канала

Следующий пример вывода RSS-канала возвращает один элемент.


```
<rss version="2.0" xmlns:media="https://search.yahoo.com/mrss/" xmlns:example="https://example.com/namespace">
   <channel>
      <title>Search Results</title>
      <item>
         <title>An example result</title>
         <link>https://example.com/pictures.aspx?id=01</link>
         <description>This is a test of the emergency search results system. If this were a real emergency result, you'd be reading something more useful.</description>
         <pubDate>Wed, 1 Oct 2008 23:12:00 GMT</pubDate>
         <media:content url="https://example.com/pictures/picture01.jpg" fileSize="212889" type="image/jpeg" height="768" width="1024"/>
         <media:thumbnail url="https://example.com/thumbnails/picture01.jpg" height="120" width="160"/>
         <example:dateTaken>Mon, 22 Sep 2008 23:12:00 GMT</example:dateTaken>
      </item>
   </channel>
</rss>
```



дополнительные сведения о сопоставлении свойств см. в разделах "расширенные элементы в федеративного поиска WIndows" и "сопоставления настраиваемых свойств" раздела [создание файла описания OpenSearch в Windows федеративного поиска](-search-federated-search-osdx-file.md).

## <a name="automatic-mapping-to-windows-shell-properties"></a>автоматическое сопоставление со свойствами оболочки Windows

в элементах rss-канала можно выбрать включение других элементов XML, которые автоматически сопоставляются с Windows свойствами системы оболочки. для этого включите элемент с именем после свойства оболочки Windows и предваряйте его с помощью пространства имен системы оболочки Windows. В следующем примере показано объявление пространства имен `win=" http://schemas.microsoft.com/windows/2008/propertynamespace"` и включение элемента для сопоставления свойств `win:System.Contact.PrimaryEmailAddress` .


```
<rss version="2.0" xmlns:example="https://example.com/schema/2009" xmlns:win="http://schemas.microsoft.com/windows/2008/propertynamespace">
...
   <item>
      <title>Someone</title>
      <win:System.Contact.PrimaryEmailAddress>someone@example.com
   </win:System.Contact.PrimaryEmailAddress>
   </item>
```



Префикс пространства имен, используемый здесь ( `"win"` ), является предложением; можно использовать любой префикс. однако необходимо использовать точные имена свойств оболочки Windows и должны включать точный универсальный код ресурса (URI), как показано в следующем примере:


```
http://schemas.microsoft.com/windows/2008/propertynamespace
```



**сведения о свойствах системы оболочки Windows**

Windows определяет полный список [системных свойств](../properties/props.md) и формат типа значения, необходимый для каждого свойства. В документации для свойства оболочки [System. fileExtension](../properties/props-system-fileextension.md) указано, что значение должно содержать начальную точку (".docx", а не "docx").

**Значения даты и времени**

Предпочтительный формат даты и времени — ISO-8601, как показано в следующем примере:


```
2008-01-16T 19:20:30:.45+01:00
```



Разработчики .NET должны использовать класс DateTime с `ToString("R") ` для вывода правильного формата.

дополнительные сведения о сопоставлении свойств см. в разделе "расширенные элементы в Windows федеративного поиска" статьи [создание файла описания OpenSearch в Windows федеративного поиска](-search-federated-search-osdx-file.md).

## <a name="understanding-how-windows-maps-items-to-file-types"></a>понимание того, как Карты Windows элементы в типы файлов

поиск в пользовательском интерфейсе обозревателя Windows позволяет пользователям обрабатывать результаты в виде файлов, когда элемент RSS указывает на файл, хранящийся удаленно. пользователь может перетаскивать элементы на рабочий стол, а пользовательский интерфейс обозревателя Windows отображает правильный значок и предоставляет соответствующее контекстное меню. Если элемент RSS не указывает на удаленный файл, файл рассматривается как ссылка, и пользователи могут выполнять над ним такие действия, как создание ярлыка или открытие его в браузере.

в следующей блок-схеме показано, как Windows определяет тип файла элемента.

![Блок-схема, показывающая пути от элемента к решениям, которые обрабатывают его как элемент типа Web Link или как тип файла](images/determineanitemfiletype.png)

поставщик [OpenSearch](https://github.com/dewitt/opensearch) выполняет следующие действия по сопоставлению элемента с типом файла:

-   Определить, следует ли обрабатывать элемент как файл или как веб-ссылку.
-   Укажите правильное используемое расширение имени файла.

например, если у элемента есть URL-адрес ссылки, который использует путь к файловой системе (например `file:///\\server\share\etc\item.ext` ,), поставщик [OpenSearch](https://github.com/dewitt/opensearch) считает ссылку файлом и определяет тип по расширению имени файла, используемому в пути (. ext в этом примере).

если элемент использует стандартный RSS-корпус или **медиарсс media: content** , поставщик [OpenSearch](https://github.com/dewitt/opensearch) предполагает, что элемент является файлом, и определяет расширение имени файла следующим образом:

-   если для элемента было сопоставлено свойство оболочки [System. FileExtension](../properties/props-system-fileextension.md) Windows, поставщик использует это расширение имени файла.
-   если свойство оболочки [System. FileExtension](../properties/props-system-fileextension.md) Windows не сопоставлено, поставщик использует атрибут **Type** , указанный в элементе enclosure или content. Этот элемент должен содержать `MIMEType` строку, например `"image/jpeg"` . Если объект `MIMEType` связан с расширением имени файла, зарегистрированным на клиентском компьютере, элемент считается файлом этого типа. Если объект `MIMEType` не связан с расширением имени файла, зарегистрированным на клиентском компьютере, элемент рассматривается как тип веб-ссылки. поставщик [OpenSearch](https://github.com/dewitt/opensearch) не пытается проанализировать атрибут **Url-адреса** , чтобы определить расширение имени файла.
-   Если объект `MIMEType` связан с расширением имени файла, зарегистрированным на клиентском компьютере, поставщик определяет, является ли расширение имени файла известным типом веб-файла (.htm, .html,. ASP,. aspx,. php,. SWF,. stm). Если да, то тип файла рассматривается как тип веб-ссылки. в противном случае он рассматривается как тип файла. Например, если объект `MIMEType "text/html"` связан с расширением имени файла .htm, этот элемент рассматривается как веб-ссылка, а не как .htm тип файла.

## <a name="avoiding-potential-barriers-to-enabling-a-data-store"></a>Предотвращение потенциальных препятствий для включения хранилища данных

некоторые хранилища данных не предоставляют веб-службу, совместимую с [OpenSearch](https://github.com/dewitt/opensearch), но по-прежнему могут быть подключены к Windows федеративного поиска. К таким хранилищам данных относятся:

-   удаленные индексы с методами проверки подлинности, которые не поддерживаются в федеративной службе поиска Windows 7.

    Примеры включают проверку подлинности на основе форм и другие пользовательские методы проверки подлинности.

-   если общедоступное хранилище высокой ценности содержит общедоступные веб-api, любой пользователь может написать другую веб-службу, которая [OpenSearch](https://github.com/dewitt/opensearch)совместима и вызывает эти api в фоновом режиме.

    Примеры включают библиотеку Congress и базы данных медицинских исследований.

-   Частные хранилища данных предприятия или индексы, а также устаревшие хранилища управления содержимым, для которых невозможно реализовать внешний интерфейс.

Однако существуют альтернативные варианты, позволяющие избежать барьеров при включении хранилища данных. Ниже приведены некоторые из этих вариантов.

**Для создания веб-службы среднего звена, когда нельзя изменить веб-службу для существующего источника данных, или веб-служба предоставляет настраиваемый API:**

1.  напишите веб-службу среднего звена, которая может принимать запрос Windows 7.
2.  Подключение источнику данных и получить результаты запроса.
3.  Переформатируйте результаты в формате RSS или Atom.
4.  верните результаты в клиент Windows 7.
5.  Обратите внимание, что для служб корпоративных данных и многих служб данных Интернета может потребоваться передать учетные данные пользователя от имени веб-службы, чтобы выполнить усечение результатов на основе разрешений пользователя.

**Чтобы использовать существующую поисковую подсистему, если не удается включить общедоступное хранилище данных:**

1.  используйте общедоступную поисковую подсистему, которая уже поддерживает [OpenSearch](https://github.com/dewitt/opensearch) с RSS. Это можно сделать, предоставив пользователям файл с расширением OSDX-с шаблоном URL-адреса, который будет ограничивать результаты только теми, которые относятся к конкретному домену.
2.  см. следующий пример [OpenSearch](https://github.com/dewitt/opensearch) description для поиска только содержимого справки для Windows с помощью запроса к live.com.

    ```
    <?xml version="1.0" encoding="UTF-8"?>
    <OpenSearchDescription xmlns="https://a9.com/-/spec/opensearch/1.1/">
      <ShortName>Windows Help</ShortName>
      <Description>Search Windows Help using the live.com search engine</Description>
      <Language></Language>
      <Url type="text/html" template="https://windowshelp.microsoft.com/windows/search.aspx?=&amp;qu={searchTerms}"/>
      <Url type="application/rss+xml" template="https://api.search.live.com/rss.aspx?source=web&amp;query={searchTerms} site:windowshelp.microsoft.com&amp;web.count=50"/>
    </OpenSearchDescription>
    ```

    

**чтобы использовать существующий сервер индексирования, который поддерживает OpenSearch, если невозможно включить собственные корпоративные хранилища данных или индексы:**

1.  выберите существующий сервер индексирования, который поддерживает [OpenSearch](https://github.com/dewitt/opensearch) индексировать содержимое, например сервер поиска SharePoint.
2.  создайте файл с расширением osdx-, который будет ограничивать результаты SharePoint индекса только теми, которые относятся к серверу, используя синтаксис ключевых слов в шаблоне URL-адреса.

**Чтобы создать хранилище данных на стороне клиента, если не работает решение на стороне сервера:**

1.  напишите клиентский [OpenSearch](https://github.com/dewitt/opensearch) источник данных, расположенный между поставщиком Windows [OpenSearch](https://github.com/dewitt/opensearch) и внешним источником данных.
2.  используйте API [интерфейса иопенсеарчсаурце](/windows/win32/api/shobjidl_core/nn-shobjidl_core-iopensearchsource) в Windows SDK, чтобы создать соответствующий файл с расширением сеарчконнектор-ms, через который обозреватель Windows может вызвать реализацию с параметрами запроса. Затем ваша реализация может вернуть результаты в формате RSS или Atom. Это позволит вашей реализации предоставлять пользовательский пользовательский интерфейс проверки подлинности и подключаться к источнику данных с помощью собственного API-интерфейса.

> [!Note]  
> При открытии файла. OSDX-в каталоге% UserProfile%/сеарчес создается файл. сеарчконнектор-MS (соединитель поиска), который помещает ссылку на него в каталог% UserProfile%/Линкс.

 

## <a name="additional-resources"></a>Дополнительные ресурсы

дополнительные сведения о реализации федерации для поиска в удаленных хранилищах данных с помощью OpenSearch technologies в Windows 7 и более поздних версиях см. в разделе "дополнительные ресурсы" [федеративного поиска в Windows](/previous-versions//dd742958(v=vs.85)).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Федеративный поиск в Windows](-search-federated-search-overview.md)
</dt> <dt>

[начало работы с федеративными поиском в Windows](getting-started-with-federated-search-in-windows.md)
</dt> <dt>

[подключение веб-службы в Windows федеративного поиска](-search-federated-search-web-service.md)
</dt> <dt>

[создание файла описания OpenSearch в Windows федеративного поиска](-search-federated-search-osdx-file.md)
</dt> <dt>

[следующие рекомендации по Windows федеративного поиска](-search-fedsearch-best.md)
</dt> <dt>

[развертывание соединителей поиска в Windows федеративного поиска](-search-federated-search-deploying.md)
</dt> </dl>

 

 
