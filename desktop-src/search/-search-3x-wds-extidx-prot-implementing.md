---
description: Некоторые приложения хранят свои элементы в базах данных или пользовательских типах файлов.
ms.assetid: 0e2b7b4b-ae87-4092-b924-6191cdf42c9b
title: Основные сведения о обработчиках протоколов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 28c171c5790e47bbf624d9107a5ca5b3dc0b9fd4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105701406"
---
# <a name="understanding-protocol-handlers"></a><span data-ttu-id="a1123-103">Основные сведения о обработчиках протоколов</span><span class="sxs-lookup"><span data-stu-id="a1123-103">Understanding Protocol Handlers</span></span>

<span data-ttu-id="a1123-104">Некоторые приложения хранят свои элементы в базах данных или пользовательских типах файлов.</span><span class="sxs-lookup"><span data-stu-id="a1123-104">Some applications store their items in databases or custom file types.</span></span> <span data-ttu-id="a1123-105">Хотя Windows Search может индексировать имя и свойства файла, Windows не имеет сведений о содержимом файла.</span><span class="sxs-lookup"><span data-stu-id="a1123-105">While Windows Search can index the name and properties of the file, Windows has no knowledge of the content of the file.</span></span> <span data-ttu-id="a1123-106">В результате такие элементы не могут индексироваться или быть представлены в оболочке Windows.</span><span class="sxs-lookup"><span data-stu-id="a1123-106">As a result, such items cannot be indexed or exposed in the Windows Shell.</span></span> <span data-ttu-id="a1123-107">Создание обработчика протокола позволяет сделать эти элементы доступными для индексирования.</span><span class="sxs-lookup"><span data-stu-id="a1123-107">By creating a protocol handler you can make these items available for indexing.</span></span> <span data-ttu-id="a1123-108">Кроме того, можно индексировать формат составного файла, например ZIP-файл.</span><span class="sxs-lookup"><span data-stu-id="a1123-108">You can also index a compound file format such as a .zip file.</span></span>

<span data-ttu-id="a1123-109">Этот раздел организован следующим образом:</span><span class="sxs-lookup"><span data-stu-id="a1123-109">This topic is organized as follows:</span></span>

-   [<span data-ttu-id="a1123-110">Индексирование хранилищ данных с помощью обработчиков протоколов</span><span class="sxs-lookup"><span data-stu-id="a1123-110">Indexing Data Stores with Protocol Handlers</span></span>](#indexing-data-stores-with-protocol-handlers)
    -   [<span data-ttu-id="a1123-111">Хранилища данных оболочки</span><span class="sxs-lookup"><span data-stu-id="a1123-111">Shell Data Stores</span></span>](#shell-data-stores)
    -   [<span data-ttu-id="a1123-112">Обработчики протоколов</span><span class="sxs-lookup"><span data-stu-id="a1123-112">Protocol Handlers</span></span>](#protocol-handlers)
    -   [<span data-ttu-id="a1123-113">Фильтры и обработчики протоколов</span><span class="sxs-lookup"><span data-stu-id="a1123-113">Filters and Protocol Handlers</span></span>](#filters-and-protocol-handlers)
-   [<span data-ttu-id="a1123-114">Индексирование формата составного файла</span><span class="sxs-lookup"><span data-stu-id="a1123-114">Indexing a Compound File Format</span></span>](#indexing-a-compound-file-format)
-   [<span data-ttu-id="a1123-115">См. также</span><span class="sxs-lookup"><span data-stu-id="a1123-115">Related topics</span></span>](#related-topics)

## <a name="indexing-data-stores-with-protocol-handlers"></a><span data-ttu-id="a1123-116">Индексирование хранилищ данных с помощью обработчиков протоколов</span><span class="sxs-lookup"><span data-stu-id="a1123-116">Indexing Data Stores with Protocol Handlers</span></span>

<span data-ttu-id="a1123-117">Если пользователям требуется искать устаревшие базы данных, хранилища электронной почты или другие структуры данных, которые не поддерживаются службой поиска Windows, необходимо сначала определить, существует ли обработчик протокола для этого хранилища данных, возможно, для использования с другим приложением, например SharePoint Server.</span><span class="sxs-lookup"><span data-stu-id="a1123-117">When users need to search legacy databases, email stores or other data structures that are not supported by Windows Search, you should first determine whether a protocol handler already exists for that data store, perhaps for use with another application such as SharePoint Server.</span></span> <span data-ttu-id="a1123-118">В этом случае можно установить обработчик протокола в системе.</span><span class="sxs-lookup"><span data-stu-id="a1123-118">If so, you can install that protocol handler on the system.</span></span> <span data-ttu-id="a1123-119">Обработчики протоколов поиска Windows используют спецификации проектирования, аналогичные SharePoint Server, и часто взаимозаменяемы.</span><span class="sxs-lookup"><span data-stu-id="a1123-119">Windows Search protocol handlers use design specifications similar to SharePoint Server, and they can often be used interchangeably.</span></span>

<span data-ttu-id="a1123-120">Дополнительные сведения о развертывании сервера Search Server 2008 с помощью Office SharePoint Server 2007 см. в разделе [федеративный поисковый \[ сервер search Server 2008 \] ](/previous-versions/office/bb931109(v=office.14)).</span><span class="sxs-lookup"><span data-stu-id="a1123-120">For more information about Search Server 2008 deployment with Office SharePoint Server 2007, see [Federated Search \[Search Server 2008\]](/previous-versions/office/bb931109(v=office.14)).</span></span>

### <a name="shell-data-stores"></a><span data-ttu-id="a1123-121">Хранилища данных оболочки</span><span class="sxs-lookup"><span data-stu-id="a1123-121">Shell Data Stores</span></span>

<span data-ttu-id="a1123-122">Прежде чем сторонние разработчики новых форматов файлов и хранилищ данных смогут получить эти форматы и хранилища в результатах запроса в проводнике Windows, разработчик должен реализовать источник данных оболочки.</span><span class="sxs-lookup"><span data-stu-id="a1123-122">Before a third-party developer of new file formats and data stores can get those formats and stores to appear in query results in Windows Explorer, the developer must implement a Shell data source.</span></span> <span data-ttu-id="a1123-123">Источник данных оболочки — это компонент, который используется для расширения пространства имен оболочки и предоставления элементов в хранилище данных.</span><span class="sxs-lookup"><span data-stu-id="a1123-123">A Shell data source is a component that is used to extend the Shell namespace and expose items in a data store.</span></span> <span data-ttu-id="a1123-124">Хранилище данных — это репозиторий данных.</span><span class="sxs-lookup"><span data-stu-id="a1123-124">A data store is a repository of data.</span></span> <span data-ttu-id="a1123-125">Хранилище данных может быть предоставлено модели программирования оболочки в качестве контейнера, использующего источник данных оболочки.</span><span class="sxs-lookup"><span data-stu-id="a1123-125">A data store can be exposed to the Shell programming model as a container that uses a Shell data source.</span></span> <span data-ttu-id="a1123-126">Элементы в хранилище данных могут индексироваться системой поиска Windows с помощью обработчика протокола.</span><span class="sxs-lookup"><span data-stu-id="a1123-126">The items in a data store can be indexed by the Windows Search system using a protocol handler.</span></span> <span data-ttu-id="a1123-127">Обработчик протокола реализует протокол для доступа к источнику содержимого в собственном формате.</span><span class="sxs-lookup"><span data-stu-id="a1123-127">The protocol handler implements the protocol for accessing a content source in its native format.</span></span> <span data-ttu-id="a1123-128">Интерфейсы [**исеарчпротокол**](/windows/desktop/api/Searchapi/nn-searchapi-isearchprotocol) и [**ISearchProtocol2**](/windows/desktop/api/Searchapi/nn-searchapi-isearchprotocol2) используются для реализации пользовательского обработчика протокола, чтобы расширить источники данных, которые могут быть проиндексированы.</span><span class="sxs-lookup"><span data-stu-id="a1123-128">The [**ISearchProtocol**](/windows/desktop/api/Searchapi/nn-searchapi-isearchprotocol) and [**ISearchProtocol2**](/windows/desktop/api/Searchapi/nn-searchapi-isearchprotocol2) interfaces are used to implement a custom protocol handler to expand the data sources that can be indexed.</span></span>

<span data-ttu-id="a1123-129">Если требуется, чтобы результаты запроса отображались в проводнике Windows, необходимо реализовать источник данных оболочки, прежде чем можно будет создать обработчик протокола для расширения индекса.</span><span class="sxs-lookup"><span data-stu-id="a1123-129">If you want the query results to appear in Windows Explorer, you must implement a Shell data source before you can create a protocol handler to extend the index.</span></span> <span data-ttu-id="a1123-130">Однако, если все запросы будут программно (например, в OLE DB) и интерпретироваться кодом приложения, а не оболочкой, пространство имен оболочки, хотя и предпочтительнее, не является обязательным.</span><span class="sxs-lookup"><span data-stu-id="a1123-130">However, if all queries will be programmatic (through OLE DB for example) and interpreted by the application's code rather than the Shell, a Shell namespace while still preferred is not strictly required.</span></span>

> [!Note]  
> <span data-ttu-id="a1123-131">Источник данных оболочки иногда называют расширением пространства имен оболочки.</span><span class="sxs-lookup"><span data-stu-id="a1123-131">A Shell data source is sometimes known as a Shell namespace extension.</span></span> <span data-ttu-id="a1123-132">Обработчик иногда называют расширением оболочки или обработчиком расширения оболочки.</span><span class="sxs-lookup"><span data-stu-id="a1123-132">A handler is sometimes known as a Shell extension or a Shell extension handler.</span></span>

 

<span data-ttu-id="a1123-133">Если требуется, чтобы пользователи могли просматривать результаты поиска в проводнике Windows, необходимо создать обработчик протокола и одну или несколько из следующих надстроек:</span><span class="sxs-lookup"><span data-stu-id="a1123-133">If you want users to view their search results from within Windows Explorer, then you must create a protocol handler and one or more of the following add-ins:</span></span>

-   <span data-ttu-id="a1123-134">Обработчик контекстного меню</span><span class="sxs-lookup"><span data-stu-id="a1123-134">Shortcut menu handler</span></span>
-   <span data-ttu-id="a1123-135">Обработчик значков</span><span class="sxs-lookup"><span data-stu-id="a1123-135">Icon handler</span></span>
-   <span data-ttu-id="a1123-136">Другой тип обработчика файлов</span><span class="sxs-lookup"><span data-stu-id="a1123-136">Some other type of file handler</span></span>

<span data-ttu-id="a1123-137">Список обработчиков, определяемых сценарием разработчика, которые вы пытаетесь получить, см. в разделе «Обзор обработчиков» в [Windows Search как платформа разработки](-search-3x-wds-development-ovr.md).</span><span class="sxs-lookup"><span data-stu-id="a1123-137">For a list of handlers identified by the developer scenario you are trying to achieve, see "Overview of Handlers" in [Windows Search as a Development Platform](-search-3x-wds-development-ovr.md).</span></span> <span data-ttu-id="a1123-138">Сведения о создании обработчиков см. в разделе [Регистрация расширений оболочки](../shell/reg-shell-exts.md), [контекстного меню](/previous-versions/windows/desktop/legacy/cc144169(v=vs.85))и [обработчиков типов файлов](../shell/fa-file-extensions.md).</span><span class="sxs-lookup"><span data-stu-id="a1123-138">For information on creating handlers, see [Registering Shell Extensions](../shell/reg-shell-exts.md), [Context Menu](/previous-versions/windows/desktop/legacy/cc144169(v=vs.85)), and [File Type Handlers](../shell/fa-file-extensions.md).</span></span>

### <a name="protocol-handlers"></a><span data-ttu-id="a1123-139">Обработчики протоколов</span><span class="sxs-lookup"><span data-stu-id="a1123-139">Protocol Handlers</span></span>

<span data-ttu-id="a1123-140">Если хранилище данных также является контейнером (например, папкой файловой системы), необходимо реализовать фильтр для перечисления URL-адресов в контейнере.</span><span class="sxs-lookup"><span data-stu-id="a1123-140">If the data store is also a container (such as a file system folder), you must implement a filter to enumerate the URLs in the container.</span></span> <span data-ttu-id="a1123-141">Если хранилище данных содержит данные или типы файлов, отличные от одного из типов файлов 200, поддерживаемых службой поиска Windows, необходимо реализовать фильтр для доступа к содержимому элементов в хранилище и индексировать его.</span><span class="sxs-lookup"><span data-stu-id="a1123-141">If the data store contains data or file types other than one of the 200 file types supported by Windows Search, you must implement a filter to access and index the contents of items in the store.</span></span> <span data-ttu-id="a1123-142">В Windows Search используется обработчик протокола и технология [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) , аналогичные тем, что используются сервером SharePoint.</span><span class="sxs-lookup"><span data-stu-id="a1123-142">Windows Search uses protocol handler and [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) technology similar to that used by SharePoint Server.</span></span> <span data-ttu-id="a1123-143">Если у вас уже есть фильтры для определенного хранилища и типа файлов, установленных в индексируемой системе, Поиск Windows может использовать существующие интерфейсы для индексирования этих данных.</span><span class="sxs-lookup"><span data-stu-id="a1123-143">If you already have filters for a specific store and file type installed on the system being indexed, Windows Search may be able to use the existing interfaces to index this data.</span></span>

<span data-ttu-id="a1123-144">Общие сведения о процессе индексирования см. [в разделе процесс индексирования](-search-indexing-process-overview.md).</span><span class="sxs-lookup"><span data-stu-id="a1123-144">For an overview of the indexing process, see [The Indexing Process](-search-indexing-process-overview.md).</span></span> <span data-ttu-id="a1123-145">Основные сведения о обработчиках фильтров см. в разделе [Разработка обработчиков фильтров](-search-ifilter-conceptual.md).</span><span class="sxs-lookup"><span data-stu-id="a1123-145">For conceptual information on filter handlers, see [Developing Filter Handlers](-search-ifilter-conceptual.md).</span></span>

### <a name="filters-and-protocol-handlers"></a><span data-ttu-id="a1123-146">Фильтры и обработчики протоколов</span><span class="sxs-lookup"><span data-stu-id="a1123-146">Filters and Protocol Handlers</span></span>

<span data-ttu-id="a1123-147">Обработчики протоколов предоставляют индексатору поиска Windows доступ к хранилищам данных, позволяя индексатору выполнять обход узлов хранилища данных и извлекать соответствующие сведения для индексирования.</span><span class="sxs-lookup"><span data-stu-id="a1123-147">Protocol handlers give the Windows Search indexer access to data stores, enabling the indexer to crawl the nodes of a data store and extract relevant information to index.</span></span> <span data-ttu-id="a1123-148">Например, служба поиска Windows поставляется с обработчиками протоколов для хранилищ файловой системы и для некоторых версий обоих хранилищ данных Microsoft Outlook.</span><span class="sxs-lookup"><span data-stu-id="a1123-148">Windows Search, for example, ships with protocol handlers for file system stores and for some versions of both Microsoft Outlook data stores.</span></span> <span data-ttu-id="a1123-149">При индексировании электронной почты Outlook обработчик протокола выполняет сканирование всех сообщений в наборе папок Outlook и извлекает сведения из каждого сообщения и вложения.</span><span class="sxs-lookup"><span data-stu-id="a1123-149">When indexing Outlook email, the protocol handler crawls all messages in a set of Outlook folders and extracts information from each message and attachment.</span></span> <span data-ttu-id="a1123-150">Эти сведения передаются в индексатор для включения в каталог Windows Search.</span><span class="sxs-lookup"><span data-stu-id="a1123-150">This information is passed to the indexer for inclusion in the Windows Search catalog.</span></span>

<span data-ttu-id="a1123-151">Обзоры диспетчера каталогов и диспетчера области обхода содержимого (CSM) см. в разделе [Использование диспетчера каталогов](-search-3x-wds-mngidx-catalog-manager.md) и [диспетчера области сканирования](-search-3x-wds-extidx-csm.md).</span><span class="sxs-lookup"><span data-stu-id="a1123-151">For overviews of the Catalog Manager and Crawl Scope Manager (CSM), see [Using the Catalog Manager](-search-3x-wds-mngidx-catalog-manager.md) and [Using the Crawl Scope Manager](-search-3x-wds-extidx-csm.md).</span></span>

## <a name="indexing-a-compound-file-format"></a><span data-ttu-id="a1123-152">Индексирование формата составного файла</span><span class="sxs-lookup"><span data-stu-id="a1123-152">Indexing a Compound File Format</span></span>

<span data-ttu-id="a1123-153">Формат составного файла можно индексировать, чтобы отдельные элементы в файле можно было вернуть в виде отдельных результатов.</span><span class="sxs-lookup"><span data-stu-id="a1123-153">A compound file format can be indexed so that individual items in the file can can be returned as individual results.</span></span> <span data-ttu-id="a1123-154">Формат составного файла, например сжатый файл с расширением ZIP, по сути является хранилищем данных, и его можно рассматривать как таковое для целей индексирования.</span><span class="sxs-lookup"><span data-stu-id="a1123-154">A compound file format such as a compressed file with a .zip file name extension is essentially a data store and can be treated as such for indexing purposes.</span></span> <span data-ttu-id="a1123-155">В следующем примере показано, как отобразить ZIP-файл в пространстве имен файловой системы (FILE://c:/test/test.zip), в котором есть и вложенные папки, и отдельные элементы.</span><span class="sxs-lookup"><span data-stu-id="a1123-155">The following example displays a .zip file in the file system namespace (FILE://c:/test/test.zip) in which there are both subfolders and individual items.</span></span>

``` syntax
Test.zip 

    |-folder1 

    |    |-folder2 

    |           |- FileX.txt 

    |- FileY.doc
```

<span data-ttu-id="a1123-156">Обработчик протокола FILE обнаруживает, когда FILE://c:/test/test.zip изменения, отслеживая журналы изменений файловой системы, и вызывает [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) , зарегистрированный для ZIP-файлов в этом файле при изменении файла, но не имеет сведений о внутренней структуре самого ZIP-файла.</span><span class="sxs-lookup"><span data-stu-id="a1123-156">The FILE protocol handler discovers when FILE://c:/test/test.zip changes by monitoring file system change logs, and it will invoke an [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) registered for .zip files on that file when the file changes, but it has no knowledge of the internal structure of the .zip file itself.</span></span>

<span data-ttu-id="a1123-157">Необходимо сообщить индексатору, что формат составного файла является хранилищем данных.</span><span class="sxs-lookup"><span data-stu-id="a1123-157">You must inform the indexer that the compound file format is a data store.</span></span> <span data-ttu-id="a1123-158">Это необходимо сделать, чтобы отдельные элементы были проиндексированы и извлечены как уникальные сущности.</span><span class="sxs-lookup"><span data-stu-id="a1123-158">It is necessary to do so for individual items to be indexed and retrieved as unique entities.</span></span> <span data-ttu-id="a1123-159">После реализации источника данных оболочки и выполнения следующих действий у вас будет обработчик протокола, который может обрабатывать и предоставлять данные из формата составного файла (ZIP-файла) в качестве отдельных элементов.</span><span class="sxs-lookup"><span data-stu-id="a1123-159">After you have implemented a Shell data source and performed the following steps, you will have a protocol handler that can process and expose the data from a compound file format (a .zip file) as individual items.</span></span>

<span data-ttu-id="a1123-160">**Чтобы сообщить индексатору, что составной файл является хранилищем данных, сделайте следующее:**</span><span class="sxs-lookup"><span data-stu-id="a1123-160">**To inform the indexer that a compound file is a data store:**</span></span>

1.  <span data-ttu-id="a1123-161">Создайте обработчик протокола (с помощью [**исеарчпротокол**](/windows/desktop/api/Searchapi/nn-searchapi-isearchprotocol) или [**ISearchProtocol2**](/windows/desktop/api/Searchapi/nn-searchapi-isearchprotocol2)) для ZIP-файлов с возможностью привязки к исходному файлу.</span><span class="sxs-lookup"><span data-stu-id="a1123-161">Create a protocol handler (using [**ISearchProtocol**](/windows/desktop/api/Searchapi/nn-searchapi-isearchprotocol) or [**ISearchProtocol2**](/windows/desktop/api/Searchapi/nn-searchapi-isearchprotocol2)) for .zip files that has the ability bind to the source file.</span></span> <span data-ttu-id="a1123-162">Дополнительные сведения см. в разделе [Установка и регистрация обработчиков протоколов](-search-3x-wds-ph-install-registration.md).</span><span class="sxs-lookup"><span data-stu-id="a1123-162">For more information, see [Installing and Registering Protocol Handlers](-search-3x-wds-ph-install-registration.md).</span></span>

    <span data-ttu-id="a1123-163">Например, можно использовать экранированный путь к ZIP-файлу в качестве имени корневой папки, а затем использовать синтаксис иерархии, как любой другой формат файла.</span><span class="sxs-lookup"><span data-stu-id="a1123-163">For example, you could use an escaped path to the .zip file as the root folder name and then use a hierarchy syntax like any other file format.</span></span>

    ``` syntax
    .zip:///escapedPathTo.zipFile/.zipfolder/.../.zipfile
    ```

    <span data-ttu-id="a1123-164">Используя приведенный выше образец данных для c: \\ test \\test.zip, уникальные URL-адреса будут выглядеть следующим образом.</span><span class="sxs-lookup"><span data-stu-id="a1123-164">Using the above sample data for c:\\test\\test.zip, the unique URLs would be as follows.</span></span> <span data-ttu-id="a1123-165">С этими URL-адресами обработчик протокола имеет сведения, необходимые для привязки к ZIP-файлу, и перечисляет дочерние URL, включая внутренние файлы, чтобы их можно было привязать и индексировать с помощью фильтров. doc и. txt.</span><span class="sxs-lookup"><span data-stu-id="a1123-165">With these URLs the protocol handler has the information necessary to bind to the .zip file and enumerate the child URLs including the inner files so that they can be bound to and indexed by the .doc and .txt filters.</span></span>

    ``` syntax
      

    .zip:///FILE:%2f%2f%2fc:%2ftest%2ftest.zip/ 

    .zip:///FILE:%2f%2f%2fc:%2ftest%2ftest.zip/FileY.Doc 

    .zip:///FILE:%2f%2f%2fc:%2ftest%2ftest.zip/folder1 

    .zip:///FILE:%2f%2f%2fc:%2ftest%2ftest.zip/folder1/folder2 

    .zip:///FILE:%2f%2f%2fc:%2ftest%2ftest.zip/folder1/folder2/FileX.txt
    ```

2.  <span data-ttu-id="a1123-166">Убедитесь, что обработчик протокола удовлетворяет следующим двум условиям.</span><span class="sxs-lookup"><span data-stu-id="a1123-166">Ensure that your protocol handler meets the following two conditions:</span></span>
    -   <span data-ttu-id="a1123-167">Корневые URL-адреса для файла ZIP должны выдавать PKEY \_ Search \_ Исклоседдиректори ([System. Search. Исклоседдиректори](../properties/props-system-search-iscloseddirectory.md)) по URL-адресам корневых ZIP-файлов.</span><span class="sxs-lookup"><span data-stu-id="a1123-167">The root URLs for a .zip file should emit PKEY\_Search\_IsClosedDirectory ([System.Search.IsClosedDirectory](../properties/props-system-search-iscloseddirectory.md)) on the URLs that are the root .zip file URLs.</span></span> <span data-ttu-id="a1123-168">Например,. zip:///FILE:%2f%2f%2fc:%2ftest% 2ftest.zip/должен выдать Исклоседдиректори = **true**.</span><span class="sxs-lookup"><span data-stu-id="a1123-168">For example, .zip:///FILE:%2f%2f%2fc:%2ftest%2ftest.zip/ should emit IsClosedDirectory = **TRUE**.</span></span> <span data-ttu-id="a1123-169">Это указывает индексатору, что если дата на этом URL-адресе не изменилась, не нужно обрабатывать дочерние URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="a1123-169">This tells the indexer that if the date on this URL has not changed, it does not need to process any of the child URLs.</span></span>
    -   <span data-ttu-id="a1123-170">Каждый дочерний URL-адрес для этого URL-адреса должен порождать \_ \_ исфулликонтаинед поиска ([System. Search. исфулликонтаинед](../properties/props-system-search-isfullycontained.md)) в дочерних URL-адресах корневого. zip.</span><span class="sxs-lookup"><span data-stu-id="a1123-170">Every child URL for that URL should emit PKEY\_Search\_IsFullyContained ([System.Search.IsFullyContained](../properties/props-system-search-isfullycontained.md)) on the child URLs of the root .zip URL.</span></span> <span data-ttu-id="a1123-171">Как правило, в конце добавочного сканирования индексатор обрабатывает все Непосещенные URL-адреса как элементы, которые должны быть удалены.</span><span class="sxs-lookup"><span data-stu-id="a1123-171">Normally at the end of an incremental crawl, the indexer treats all unvisited URLs as items that should be deleted.</span></span> <span data-ttu-id="a1123-172">Но корневой ZIP-файл не должен обрабатывать корневые URL, так как ничего не изменилось.</span><span class="sxs-lookup"><span data-stu-id="a1123-172">But the root .zip file should not process root URLs because nothing has changed.</span></span> <span data-ttu-id="a1123-173">Порождение этого свойства как **true** сообщает индексатору, что если этот URL-адрес не был обработан в конце добавочного сканирования, его не следует удалять.</span><span class="sxs-lookup"><span data-stu-id="a1123-173">Emitting this property as **TRUE** tells the indexer that if this URL has not been processed at the end of an incremental crawl, it should not be deleted.</span></span> <span data-ttu-id="a1123-174">Он будет удален только в том случае, если корневой элемент изменился и он не будет посещен.</span><span class="sxs-lookup"><span data-stu-id="a1123-174">It will only be deleted if the root item has changed and it is not visited.</span></span>

<span data-ttu-id="a1123-175">Для службы поиска Windows требуется начальная страница для протокола, чтобы узнать, какие URL-адреса нужно просканировать постепенно, и какие URL-адреса следует игнорировать при их обнаружении.</span><span class="sxs-lookup"><span data-stu-id="a1123-175">Windows Search requires a start page for a protocol in order to know what URLs to crawl incrementally and which URLs should be ignored when they are found.</span></span> <span data-ttu-id="a1123-176">Но мы не можем начать с URL-адреса для каждого файла ZIP, так как мы не понимаем, где каждый ZIP-файл имеет значение.</span><span class="sxs-lookup"><span data-stu-id="a1123-176">But we can't start with a URL for each .zip file, because we don't know where each .zip file is.</span></span> <span data-ttu-id="a1123-177">Таким образом, URL-адрес начальной страницы обработчика протокола ZIP должен иметь возможность перечислить все в корне экранированных путей всех ZIP-файлов.</span><span class="sxs-lookup"><span data-stu-id="a1123-177">Hence, the .zip protocol handler's start page URL must be able to enumerate everything at the root of the escaped paths of all of the .zip files.</span></span> <span data-ttu-id="a1123-178">Эти ZIP-файлы не обязательно находятся в пространстве имен FILE: и могут представлять собой URL типа MAPI, указывающий на файл ZIP в качестве вложения, например.</span><span class="sxs-lookup"><span data-stu-id="a1123-178">Those .zip files are not necessarily in the FILE: namespace and could be a MAPI type URL that points to a .zip file as an attachment, for example.</span></span>

<span data-ttu-id="a1123-179">**Чтобы зарегистрировать корневой элемент в качестве начальной страницы, выполните следующие действия.**</span><span class="sxs-lookup"><span data-stu-id="a1123-179">**To register a root as a start page:**</span></span>

1.  <span data-ttu-id="a1123-180">Зарегистрируйте корневой элемент, например. zip:///, в качестве начальной страницы, чтобы все ZIP-файлы запускались в силе.</span><span class="sxs-lookup"><span data-stu-id="a1123-180">Register a root such as .zip:/// as a start page so that all .zip files start there, in effect.</span></span> <span data-ttu-id="a1123-181">При обработке корневого файла. zip: URL-адрес обработчик протокола должен создать список дочерних URL-адресов, которые будут выдаваться путем запроса поиска Windows для всех URL-адресов с помощью System. FileExtension = ". zip".</span><span class="sxs-lookup"><span data-stu-id="a1123-181">When processing the root .zip: URL, your protocol handler should generate the list of child URLs to emit by querying Windows Search for all of the URLs with System.FileExtension = ".zip".</span></span>
2.  <span data-ttu-id="a1123-182">Отмените эти URL-адреса, чтобы удалить косые черты и вернуть их в качестве дочерних URL-адресов.</span><span class="sxs-lookup"><span data-stu-id="a1123-182">Escape those URLs to remove the slashes and return them as child URLs.</span></span> <span data-ttu-id="a1123-183">Пример запроса для получения требуемых типов может выглядеть следующим образом.</span><span class="sxs-lookup"><span data-stu-id="a1123-183">An example query to retrieve the types you want might look as follows.</span></span>

    ``` syntax
    SELECT system.itemurl, System.DateModified FROM SystemIndex 
    WHERE System.FileExtension='.zip' OR System.MimeType='mimetypefor.zip'
    ```

3.  <span data-ttu-id="a1123-184">Когда система поиска Windows периодически выполняет добавочный обход содержимого корневого URL-адреса zip:///, необходимо отразить список URL-адресов, которые службы поиска Windows уже поддерживают, а именно — URL-адреса в формате ZIP.</span><span class="sxs-lookup"><span data-stu-id="a1123-184">When Windows Search periodically does an incremental crawl on your .zip:/// root URL, you must reflect back the list of URLs that Windows Search is already maintaining that are .zip URLs.</span></span> <span data-ttu-id="a1123-185">Если удаление обнаруживается в собственном хранилище, в котором хранится ZIP-файл, он не отображается в перечислении, и эта ветвь дерева в ZIP-файле удаляется.</span><span class="sxs-lookup"><span data-stu-id="a1123-185">If a deletion is discovered in the native store where the .zip file is stored, it does not appear in your enumeration, and that branch of the tree in the .zip is removed.</span></span>
4.  <span data-ttu-id="a1123-186">Чтобы выполнить привязку к данным. zip для другого обработчика протокола, в идеале следует пропускать [ишеллфолдер](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) для этого URL-адреса, чтобы выполнить привязку к хранилищу объекта, а не считать, что он всегда является файлом.</span><span class="sxs-lookup"><span data-stu-id="a1123-186">To bind to the .zip data for another protocol handler, you should ideally go through the [IShellFolder](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) for that URL to bind to the storage of the object, and not assume it is always a file.</span></span> <span data-ttu-id="a1123-187">Это обеспечивает гибкость работы с вложениями в хранилищах почты, например.</span><span class="sxs-lookup"><span data-stu-id="a1123-187">Doing so affords you the flexibility to work with attachments in mail stores, for example.</span></span>
5.  <span data-ttu-id="a1123-188">При выдаче дочерних URL-адресов для каждого файла. zip следует использовать PKEY \_ поиска \_ Урлтоиндексвисмодификатионтиме ([System. Search. урлтоиндексвисмодификатионтиме](../properties/props-system-search-urltoindexwithmodificationtime.md)), чтобы передать PKEY \_ DateModified ([System. DateModified](../properties/props-system-datemodified.md)) фактического ZIP-файла, чтобы индексатор обработал файл с расширением. zip только в том случае, если он был изменен.</span><span class="sxs-lookup"><span data-stu-id="a1123-188">When emitting child URLs for each .zip file, you should use PKEY\_Search\_UrlToIndexWithModificationTime ([System.Search.UrlToIndexWithModificationTime](../properties/props-system-search-urltoindexwithmodificationtime.md)) to pass PKEY\_DateModified ([System.DateModified](../properties/props-system-datemodified.md)) of the actual .zip file so that the indexer crawls the .zip file only if it has changed.</span></span>

<span data-ttu-id="a1123-189">Чтобы URL-адреса ZIP были индексированы сразу после создания или изменения, а также не нужно ждать, пока добавочное сканирование не обнаружит новое состояние, можно наблюдать за тем, чтобы файловая система выполняла изменения в файлах ZIP.</span><span class="sxs-lookup"><span data-stu-id="a1123-189">To have your .zip URLs indexed immediately after they are created or modified, and not have to wait for an incremental crawl to discover their new state, you could conceivably monitor the file system yourself for .zip file changes.</span></span> <span data-ttu-id="a1123-190">Однако такой подход не будет работать для других хранилищ данных, таких как MAPI.</span><span class="sxs-lookup"><span data-stu-id="a1123-190">However, such an approach would not work for other data stores such as MAPI.</span></span>

<span data-ttu-id="a1123-191">**Чтобы URL-адреса ZIP были индексированы при их создании или изменении, выполните следующие действия.**</span><span class="sxs-lookup"><span data-stu-id="a1123-191">**To have your .zip urls indexed when they are created or modified:**</span></span>

1.  <span data-ttu-id="a1123-192">Создайте фильтр (и реализацию интерфейса [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) ) для типа ZIP-файла.</span><span class="sxs-lookup"><span data-stu-id="a1123-192">Create a filter (and implementation of the [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) interface) for the .zip file type.</span></span> <span data-ttu-id="a1123-193">Дополнительные сведения см. в разделе [Разработка обработчиков свойств для службы поиска Windows](-search-3x-wds-extidx-propertyhandlers.md).</span><span class="sxs-lookup"><span data-stu-id="a1123-193">For more information, see [Developing Property Handlers for Windows Search](-search-3x-wds-extidx-propertyhandlers.md).</span></span>
2.  <span data-ttu-id="a1123-194">При вызове реализации [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) это происходит потому, что этот URL-адрес был обнаружен или изменен.</span><span class="sxs-lookup"><span data-stu-id="a1123-194">Whenever your [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) implementation is called, it is because that URL has been discovered or changed.</span></span> <span data-ttu-id="a1123-195">Затем создайте событие для URL-адреса ZIP, соответствующего URL-адресу источника, через интерфейс [**игасернотифинлине**](/previous-versions/windows/desktop/legacy/bb231470(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="a1123-195">Then, generate an event for the .zip URL appropriate for the source URL, through the [**IGatherNotifyInline**](/previous-versions/windows/desktop/legacy/bb231470(v=vs.85)) interface.</span></span> <span data-ttu-id="a1123-196">Это дает возможность немедленно сообщить индексатору, что новые данные будут индексироваться без ожидания добавочного сканирования.</span><span class="sxs-lookup"><span data-stu-id="a1123-196">Doing so gives you the ability to immediately tell the indexer that there is new data to be indexed without having to wait for the incremental crawl.</span></span>

## <a name="related-topics"></a><span data-ttu-id="a1123-197">См. также</span><span class="sxs-lookup"><span data-stu-id="a1123-197">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a1123-198">Разработка обработчиков протоколов</span><span class="sxs-lookup"><span data-stu-id="a1123-198">Developing Protocol Handlers</span></span>](-search-3x-wds-phaddins.md)
</dt> <dt>

[<span data-ttu-id="a1123-199">Установка и регистрация обработчиков протоколов</span><span class="sxs-lookup"><span data-stu-id="a1123-199">Installing and Registering Protocol Handlers</span></span>](-search-3x-wds-ph-install-registration.md)
</dt> <dt>

[<span data-ttu-id="a1123-200">Уведомление индекса изменений</span><span class="sxs-lookup"><span data-stu-id="a1123-200">Notifying the Index of Changes</span></span>](-search-3x-wds-notifyingofchanges.md)
</dt> <dt>

[<span data-ttu-id="a1123-201">Добавление значков и контекстных меню</span><span class="sxs-lookup"><span data-stu-id="a1123-201">Adding Icons and Context Menus</span></span>](-search-3x-wds-ph-ui-extensions.md)
</dt> <dt>

[<span data-ttu-id="a1123-202">Пример кода: расширения оболочки для обработчиков протоколов</span><span class="sxs-lookup"><span data-stu-id="a1123-202">Code Sample: Shell Extensions for Protocol Handlers</span></span>](-search-3x-wds-ph-ui-samplecode.md)
</dt> <dt>

[<span data-ttu-id="a1123-203">Установка и регистрация обработчиков протоколов</span><span class="sxs-lookup"><span data-stu-id="a1123-203">Installing and Registering Protocol Handlers</span></span>](-search-3x-wds-ph-install-registration.md)
</dt> <dt>

[<span data-ttu-id="a1123-204">Создание соединителя поиска для обработчика протокола</span><span class="sxs-lookup"><span data-stu-id="a1123-204">Creating a Search Connector for a Protocol Handler</span></span>](-search-3x-wds-ph-search-connector.md)
</dt> <dt>

[<span data-ttu-id="a1123-205">Обработчики протокола отладки</span><span class="sxs-lookup"><span data-stu-id="a1123-205">Debugging Protocol Handlers</span></span>](-search-ws-protocolhandlertesting.md)
</dt> </dl>

 

 
