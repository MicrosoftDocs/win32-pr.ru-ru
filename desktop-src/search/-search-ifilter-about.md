---
description: Обработчики фильтров, которые являются реализациями интерфейса IFilter, просматривают документы для текста и свойств.
ms.assetid: 2ee9ea19-ae03-4f14-8f06-f8aa670e204e
title: Основные сведения о обработчиках фильтров в поиске Windows
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e49cc1d3e479ae03645665618c60a33bdcfe19ba
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104540719"
---
# <a name="understanding-filter-handlers-in-windows-search"></a><span data-ttu-id="95bbf-103">Основные сведения о обработчиках фильтров в поиске Windows</span><span class="sxs-lookup"><span data-stu-id="95bbf-103">Understanding Filter Handlers in Windows Search</span></span>

<span data-ttu-id="95bbf-104">Обработчики фильтров, которые являются реализациями интерфейса [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) , просматривают документы для текста и свойств.</span><span class="sxs-lookup"><span data-stu-id="95bbf-104">Filter handlers, which are implementations of the [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) interface, scan documents for text and properties.</span></span> <span data-ttu-id="95bbf-105">Обработчики фильтров извлекают фрагменты текста из этих элементов, отфильтровывая внедренное форматирование и сохраняет информацию о положении текста.</span><span class="sxs-lookup"><span data-stu-id="95bbf-105">Filter handlers extract chunks of text from these items, filtering out embedded formatting and retaining information about the position of the text.</span></span> <span data-ttu-id="95bbf-106">Они также извлекают фрагменты значений, которые являются свойствами документа.</span><span class="sxs-lookup"><span data-stu-id="95bbf-106">They also extract chunks of values, which are document properties.</span></span> <span data-ttu-id="95bbf-107">**IFilter** — это основа для создания приложений более высокого уровня, таких как индексаторы документов и средства просмотра, независимые от приложений.</span><span class="sxs-lookup"><span data-stu-id="95bbf-107">**IFilter** is the foundation for building higher-level applications such as document indexers and application-independent viewers.</span></span>

<span data-ttu-id="95bbf-108">Этот раздел организован следующим образом:</span><span class="sxs-lookup"><span data-stu-id="95bbf-108">This topic is organized as follows:</span></span>

- [<span data-ttu-id="95bbf-109">Сведения об интерфейсе IFilter</span><span class="sxs-lookup"><span data-stu-id="95bbf-109">About the IFilter Interface</span></span>](#about-the-ifilter-interface)
  - [<span data-ttu-id="95bbf-110">Процесс изоляции</span><span class="sxs-lookup"><span data-stu-id="95bbf-110">Isolation Process</span></span>](#isolation-process)
  - [<span data-ttu-id="95bbf-111">Библиотеки DLL IFilter</span><span class="sxs-lookup"><span data-stu-id="95bbf-111">IFilter DLLs</span></span>](#ifilter-dlls)
  - [<span data-ttu-id="95bbf-112">Структура IFilter</span><span class="sxs-lookup"><span data-stu-id="95bbf-112">IFilter Structure</span></span>](#ifilter-structure)
  - [<span data-ttu-id="95bbf-113">Машинный код</span><span class="sxs-lookup"><span data-stu-id="95bbf-113">Native Code</span></span>](#native-code)
- [<span data-ttu-id="95bbf-114">Поиск идентификатора класса IFilter</span><span class="sxs-lookup"><span data-stu-id="95bbf-114">Finding the IFilter Class Identifier</span></span>](#finding-the-ifilter-class-identifier)
  - [<span data-ttu-id="95bbf-115">Идентификаторы кода IFilter:: и фрагмента и языкового стандарта</span><span class="sxs-lookup"><span data-stu-id="95bbf-115">IFilter::GetChunk and Locale Code Identifiers</span></span>](#ifiltergetchunk-and-locale-code-identifiers)
- [<span data-ttu-id="95bbf-116">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="95bbf-116">Additional Resources</span></span>](#additional-resources)
- [<span data-ttu-id="95bbf-117">См. также</span><span class="sxs-lookup"><span data-stu-id="95bbf-117">Related topics</span></span>](#related-topics)

## <a name="about-the-ifilter-interface"></a><span data-ttu-id="95bbf-118">Сведения об интерфейсе IFilter</span><span class="sxs-lookup"><span data-stu-id="95bbf-118">About the IFilter Interface</span></span>

<span data-ttu-id="95bbf-119">Microsoft Windows Search использует фильтры для извлечения содержимого элементов, включаемых в полнотекстовый индекс.</span><span class="sxs-lookup"><span data-stu-id="95bbf-119">Microsoft Windows Search uses filters to extract the content of items for inclusion in a full-text index.</span></span> <span data-ttu-id="95bbf-120">Можно расширить поиск Windows для индексации новых или собственных типов файлов, написав фильтры для извлечения содержимого и обработчики свойств для извлечения свойств файлов.</span><span class="sxs-lookup"><span data-stu-id="95bbf-120">You can extend Windows Search to index new or proprietary file types by writing filters to extract the content, and property handlers to extract the properties of files.</span></span>

<span data-ttu-id="95bbf-121">Интерфейс [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) предназначен для удовлетворения конкретных потребностей механизмов полнотекстового поиска.</span><span class="sxs-lookup"><span data-stu-id="95bbf-121">The [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) interface is designed to meet the specific needs of full-text search engines.</span></span> <span data-ttu-id="95bbf-122">Модули полнотекстового поиска, такие как Windows Search, вызывают методы **IFilter** для извлечения сведений о тексте и свойствах и их добавления в индекс.</span><span class="sxs-lookup"><span data-stu-id="95bbf-122">Full-text search engines like Windows Search call the **IFilter** methods to extract text and property information and add them to an index.</span></span> <span data-ttu-id="95bbf-123">Поиск Windows прерывает результаты возвращенного метода [**IFilter:: GetText**](/windows/win32/api/filter/nf-filter-ifilter-gettext) в словах, нормализует их и сохраняет в индексе.</span><span class="sxs-lookup"><span data-stu-id="95bbf-123">Windows Search breaks the results of the returned [**IFilter::GetText**](/windows/win32/api/filter/nf-filter-ifilter-gettext) method into words, normalizes them, and saves them in an index.</span></span> <span data-ttu-id="95bbf-124">Если он доступен, поисковая система использует идентификатор языка (LCID) текстового фрагмента для выполнения разбиения и нормализации слов, зависящих от языка.</span><span class="sxs-lookup"><span data-stu-id="95bbf-124">If available, the search engine uses the language code identifier (LCID) of a text chunk to perform language-specific word breaking and normalization.</span></span>

<span data-ttu-id="95bbf-125">Для доступа к зарегистрированным обработчикам фильтров (реализациям интерфейса [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) ) в Windows Search используются три функции, описанные в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="95bbf-125">Windows Search uses three functions, described in the following table, to access registered filter handlers (implementations of the [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) interface).</span></span> <span data-ttu-id="95bbf-126">Эти функции особенно полезны при загрузке и привязке к обработчику фильтра внедренного объекта.</span><span class="sxs-lookup"><span data-stu-id="95bbf-126">These functions are especially useful when loading and binding to an embedded object's filter handler.</span></span>

| <span data-ttu-id="95bbf-127">Функция</span><span class="sxs-lookup"><span data-stu-id="95bbf-127">Function</span></span>               | <span data-ttu-id="95bbf-128">Описание</span><span class="sxs-lookup"><span data-stu-id="95bbf-128">Description</span></span>                                                                                                                                                                                               |
|------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="95bbf-129">лоадифилтер</span><span class="sxs-lookup"><span data-stu-id="95bbf-129">LoadIFilter</span></span>            | <span data-ttu-id="95bbf-130">Возвращает указатель на [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) , который наиболее подходит для указанного типа содержимого.</span><span class="sxs-lookup"><span data-stu-id="95bbf-130">Gets a pointer to the [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) that is most suitable for the specified content type.</span></span>                                                                                            |
| <span data-ttu-id="95bbf-131">биндифилтерфромстораже</span><span class="sxs-lookup"><span data-stu-id="95bbf-131">BindIFilterFromStorage</span></span> | <span data-ttu-id="95bbf-132">Возвращает указатель на [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) , который наиболее подходит для содержимого, содержащегося в объекте [интерфейса IStorage](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="95bbf-132">Gets a pointer to the [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) that is most suitable for the content contained in an [IStorage Interface](/windows/win32/api/objidl/nn-objidl-istorage) object.</span></span> |
| <span data-ttu-id="95bbf-133">биндифилтерфромстреам</span><span class="sxs-lookup"><span data-stu-id="95bbf-133">BindIFilterFromStream</span></span>  | <span data-ttu-id="95bbf-134">Возвращает указатель на [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) , который наиболее подходит для указанного идентификатора класса (CLSID), полученного из переменной потока.</span><span class="sxs-lookup"><span data-stu-id="95bbf-134">Gets a pointer to the [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) that is most suitable for a specified class identifier (CLSID) retrieved from a stream variable.</span></span>                                                 |

<span data-ttu-id="95bbf-135">Интерфейс [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) имеет пять методов, описанных в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="95bbf-135">The [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) interface has five methods, described in the following table.</span></span>

| <span data-ttu-id="95bbf-136">Метод</span><span class="sxs-lookup"><span data-stu-id="95bbf-136">Method</span></span>                                                    | <span data-ttu-id="95bbf-137">Описание</span><span class="sxs-lookup"><span data-stu-id="95bbf-137">Description</span></span>                                                                                                        |
|-----------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="95bbf-138">**IFilter:: init**</span><span class="sxs-lookup"><span data-stu-id="95bbf-138">**IFilter::Init**</span></span>](/windows/win32/api/filter/nf-filter-ifilter-init)          | <span data-ttu-id="95bbf-139">Инициализирует сеанс фильтрации.</span><span class="sxs-lookup"><span data-stu-id="95bbf-139">Initializes a filtering session.</span></span>                                                                                   |
| [<span data-ttu-id="95bbf-140">**IFilter:: "блок"**</span><span class="sxs-lookup"><span data-stu-id="95bbf-140">**IFilter::GetChunk**</span></span>](/windows/win32/api/filter/nf-filter-ifilter-getchunk)     | <span data-ttu-id="95bbf-141">Позиции [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) в начале первого или следующего фрагмента и возвращают дескриптор.</span><span class="sxs-lookup"><span data-stu-id="95bbf-141">Positions [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) at the beginning of the first or next chunk and returns a descriptor.</span></span> |
| [<span data-ttu-id="95bbf-142">**IFilter:: GetText**</span><span class="sxs-lookup"><span data-stu-id="95bbf-142">**IFilter::GetText**</span></span>](/windows/win32/api/filter/nf-filter-ifilter-gettext)       | <span data-ttu-id="95bbf-143">Извлекает текст из текущего фрагмента.</span><span class="sxs-lookup"><span data-stu-id="95bbf-143">Retrieves text from the current chunk.</span></span>                                                                             |
| [<span data-ttu-id="95bbf-144">**IFilter:: GetValue**</span><span class="sxs-lookup"><span data-stu-id="95bbf-144">**IFilter::GetValue**</span></span>](/windows/win32/api/filter/nf-filter-ifilter-getvalue)     | <span data-ttu-id="95bbf-145">Извлекает значения из текущего фрагмента.</span><span class="sxs-lookup"><span data-stu-id="95bbf-145">Retrieves values from the current chunk.</span></span>                                                                           |
| [<span data-ttu-id="95bbf-146">**IFilter:: Биндрегион**</span><span class="sxs-lookup"><span data-stu-id="95bbf-146">**IFilter::BindRegion**</span></span>](/windows/win32/api/filter/nf-filter-ifilter-bindregion) | <span data-ttu-id="95bbf-147">Извлекает интерфейс, представляющий указанную часть объекта.</span><span class="sxs-lookup"><span data-stu-id="95bbf-147">Retrieves an interface representing the specified portion of object.</span></span> <span data-ttu-id="95bbf-148">Зарезервировано для последующего использования.</span><span class="sxs-lookup"><span data-stu-id="95bbf-148">Reserved for future use.</span></span>                      |

### <a name="isolation-process"></a><span data-ttu-id="95bbf-149">Процесс изоляции</span><span class="sxs-lookup"><span data-stu-id="95bbf-149">Isolation Process</span></span>

<span data-ttu-id="95bbf-150">Служба поиска Windows запускает фильтры IFilter в контексте безопасности локальной системы с ограниченными правами.</span><span class="sxs-lookup"><span data-stu-id="95bbf-150">Windows Search runs IFilters in the Local System security context with restricted rights.</span></span> <span data-ttu-id="95bbf-151">В этом процессе изоляции узла [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) удаляется ряд прав:</span><span class="sxs-lookup"><span data-stu-id="95bbf-151">In this [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) host isolation process, a number of rights are removed:</span></span>

- <span data-ttu-id="95bbf-152">Ограниченный код</span><span class="sxs-lookup"><span data-stu-id="95bbf-152">Restricted Code</span></span>
- <span data-ttu-id="95bbf-153">Все</span><span class="sxs-lookup"><span data-stu-id="95bbf-153">Everyone</span></span>
- <span data-ttu-id="95bbf-154">Локальная</span><span class="sxs-lookup"><span data-stu-id="95bbf-154">Local</span></span>
- <span data-ttu-id="95bbf-155">Интерактивно</span><span class="sxs-lookup"><span data-stu-id="95bbf-155">Interactive</span></span>
- <span data-ttu-id="95bbf-156">Прошедшие проверку пользователи</span><span class="sxs-lookup"><span data-stu-id="95bbf-156">Authenticated Users</span></span>
- <span data-ttu-id="95bbf-157">Встроенные пользователи</span><span class="sxs-lookup"><span data-stu-id="95bbf-157">Built-in Users</span></span>
- <span data-ttu-id="95bbf-158">Идентификатор безопасности (SID) пользователей</span><span class="sxs-lookup"><span data-stu-id="95bbf-158">Users' security identifier (SID)</span></span>

<span data-ttu-id="95bbf-159">Удаление этих прав означает, что интерфейс [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) не имеет доступа к дисковой системе или сети, а также к любым функциям пользовательского интерфейса или буфера обмена.</span><span class="sxs-lookup"><span data-stu-id="95bbf-159">The removal of these rights means the [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) interface does not have access to the disk system or network or to any user interface or clipboard functions.</span></span> <span data-ttu-id="95bbf-160">Более того, процесс изоляции выполняется в объекте задания, который предотвращает создание дочерних процессов и накладывает ограничение в 100 МБ на рабочий набор.</span><span class="sxs-lookup"><span data-stu-id="95bbf-160">Furthermore, the isolation process runs under a job object that prevents child processes from being created and imposes a 100 MB limit on the working set.</span></span> <span data-ttu-id="95bbf-161">процесс изоляции узла интерфейса **IFilter** повышает стабильность платформы индексирования из-за возможности неправильно реализованных фильтров сторонних производителей.</span><span class="sxs-lookup"><span data-stu-id="95bbf-161">the **IFilter** interface host isolation process increases the stability of the indexing platform, due to the possibility of incorrectly implemented third-party filters.</span></span>

> [!NOTE]  
> <span data-ttu-id="95bbf-162">Обработчики фильтров должны быть написаны для управления буферами и правильного стека.</span><span class="sxs-lookup"><span data-stu-id="95bbf-162">Filter handlers must be written to manage buffers, and stack correctly.</span></span> <span data-ttu-id="95bbf-163">Все копии строк должны иметь явные проверки для защиты от переполнения буфера.</span><span class="sxs-lookup"><span data-stu-id="95bbf-163">All string copies must have explicit checks to guard against buffer overruns.</span></span> <span data-ttu-id="95bbf-164">Всегда следует проверять выделенный размер буфера.</span><span class="sxs-lookup"><span data-stu-id="95bbf-164">You should always verify the allocated size of the buffer.</span></span> <span data-ttu-id="95bbf-165">Всегда следует проверять размер данных в соответствии с размером буфера.</span><span class="sxs-lookup"><span data-stu-id="95bbf-165">You should always test the size of the data against the size of the buffer.</span></span>

### <a name="ifilter-dlls"></a><span data-ttu-id="95bbf-166">Библиотеки DLL IFilter</span><span class="sxs-lookup"><span data-stu-id="95bbf-166">IFilter DLLs</span></span>

<span data-ttu-id="95bbf-167">[**Фильтр IFilter**](/windows/win32/api/filter/nn-filter-ifilter) Библиотеки DLL реализуют интерфейс **IFilter** , чтобы позволить клиенту извлекать данные текста и значений свойств из типа файла, класса или воспринимаемого типа.</span><span class="sxs-lookup"><span data-stu-id="95bbf-167">[**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) DLLs implement the **IFilter** interface to enable a client to extract text and property value information from a file type, class, or perceived type.</span></span> <span data-ttu-id="95bbf-168">Процесс фильтрации поиска Windows **SearchFilterHost.exe** привязывается к **IFilter** , зарегистрированному для класса, наблюдаемого типа или расширения имени элемента.</span><span class="sxs-lookup"><span data-stu-id="95bbf-168">The Windows Search filtering process **SearchFilterHost.exe** binds to the **IFilter** that is registered for the class, perceived type, or name extension of the item.</span></span>

### <a name="ifilter-structure"></a><span data-ttu-id="95bbf-169">Структура IFilter</span><span class="sxs-lookup"><span data-stu-id="95bbf-169">IFilter Structure</span></span>

<span data-ttu-id="95bbf-170">Каждый [**Фильтр IFilter**](/windows/win32/api/filter/nn-filter-ifilter) представляет собой DLL-файл, который реализует ВНУТРИПРОЦЕССНЫЙ сервер COM для предоставления указанных возможностей фильтрации.</span><span class="sxs-lookup"><span data-stu-id="95bbf-170">Each [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) is a DLL file that implements an in-process Component Object Model (COM) server to supply the specified filtering capabilities.</span></span> <span data-ttu-id="95bbf-171">На следующем рисунке показана общая структура типовых библиотек DLL **IFilter** .</span><span class="sxs-lookup"><span data-stu-id="95bbf-171">The following figure illustrates shows the overall structure of a typical **IFilter** DLLs.</span></span> <span data-ttu-id="95bbf-172">Более сложный пример может реализовать более одного класса **IFilter** .</span><span class="sxs-lookup"><span data-stu-id="95bbf-172">A more complex example could implement more than one **IFilter** class.</span></span>

![Схема структуры типичной библиотеки DLL IFilter](images/ifilter-structure.png)

### <a name="native-code"></a><span data-ttu-id="95bbf-174">Машинный код</span><span class="sxs-lookup"><span data-stu-id="95bbf-174">Native Code</span></span>

<span data-ttu-id="95bbf-175">Фильтры должны быть написаны в машинном коде из-за потенциальных проблем с управлением версиями среды CLR при работе нескольких надстроек.</span><span class="sxs-lookup"><span data-stu-id="95bbf-175">Filters must be written in native code due to potential common language runtime (CLR) versioning issues with the process that multiple add-ins run in.</span></span> <span data-ttu-id="95bbf-176">В Windows 7 и более поздних версиях фильтры, написанные в управляемом коде, явным образом блокируются.</span><span class="sxs-lookup"><span data-stu-id="95bbf-176">In Windows 7 and later and later, filters written in managed code are explicitly blocked.</span></span>

## <a name="finding-the-ifilter-class-identifier"></a><span data-ttu-id="95bbf-177">Поиск идентификатора класса IFilter</span><span class="sxs-lookup"><span data-stu-id="95bbf-177">Finding the IFilter Class Identifier</span></span>

<span data-ttu-id="95bbf-178">Класс DLL-библиотеки [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) регистрируется в разделе реестра персистенсандлер.</span><span class="sxs-lookup"><span data-stu-id="95bbf-178">The class of the [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) DLL is registered under the PersistentHandler registry key.</span></span> <span data-ttu-id="95bbf-179">В следующем примере для HTML-файлов показано, как найти библиотеку DLL **IFilter** для HTML-документа.</span><span class="sxs-lookup"><span data-stu-id="95bbf-179">The following example, for HTML files, illustrates how to find the **IFilter** DLL for an HTML document.</span></span> <span data-ttu-id="95bbf-180">В этом примере используется логика, аналогичная используемой системой для поиска **IFilter** , связанного с элементом.</span><span class="sxs-lookup"><span data-stu-id="95bbf-180">This example follows logic similar to that used by the system to find the **IFilter** associated with an item.</span></span>

1. <span data-ttu-id="95bbf-181">Проверьте, зарегистрировано ли расширение для типа файлов, зарегистрированных в фильтрах DLL, в записи реестра \\ hKey \_ Local \_ Machine \\ Software \\ Classes.</span><span class="sxs-lookup"><span data-stu-id="95bbf-181">Check whether the extension for the type of files that the DLL filters has a PersistentHandler registered under the registry entry \\HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Classes.</span></span> <span data-ttu-id="95bbf-182">Предоставьте этому ключу `Value1` .</span><span class="sxs-lookup"><span data-stu-id="95bbf-182">Let this key be `Value1`.</span></span> <span data-ttu-id="95bbf-183">Если эта запись уже существует, перейдите к шагу 4 этой процедуры и используйте ее `Value1` в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="95bbf-183">If that entry already exists, then skip to step 4 of this procedure and use `Value1` in that key.</span></span> <span data-ttu-id="95bbf-184">Значения имеют тип REG \_ SZ.</span><span class="sxs-lookup"><span data-stu-id="95bbf-184">The values are of type REG\_SZ.</span></span>

```
    \HKEY_LOCAL_MACHINE
       SOFTWARE
          Classes
             .htm
                PersistentHandler
                   {EEC97550-47A9-11CF-B952-00AA0051FE20}
```

2. <span data-ttu-id="95bbf-185">Кроме того, если для расширения не зарегистрирован Персистенсандлер, найдите идентификатор CLSID, связанный с типом документа, в записи реестра \\ hKey \_ Local \_ Machine \\ Software \\ Classes.</span><span class="sxs-lookup"><span data-stu-id="95bbf-185">Alternatively, if there is not a PersistentHandler registered for the extension, find the CLSID associated with the document type under the registry entry \\HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Classes.</span></span> <span data-ttu-id="95bbf-186">Предоставьте этому ключу `Value2` .</span><span class="sxs-lookup"><span data-stu-id="95bbf-186">Let this key be `Value2`.</span></span>

```
    \HKEY_LOCAL_MACHINE
       SOFTWARE
          Classes
             htmlfile
                 = Class for WWW HTML files
                CLSID
                   {25336920-03F9-11CF-8FD0-00AA00686F13}
```

3. <span data-ttu-id="95bbf-187">Определите, зарегистрирован ли Персистенсандлер для идентификатора CLSID.</span><span class="sxs-lookup"><span data-stu-id="95bbf-187">Determine whether a PersistentHandler is registered for the CLSID.</span></span> <span data-ttu-id="95bbf-188">Используя `Value2` определенную на шаге 2, найдите запись персистенсандлер для \\ \_ \_ \\ классов программного обеспечения для локального компьютера hKey \\ \\ CLSID \\ .</span><span class="sxs-lookup"><span data-stu-id="95bbf-188">Using `Value2` determined in step 2, find the PersistentHandler for the \\HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Classes\\CLSID\\Value2 entry.</span></span> <span data-ttu-id="95bbf-189">Предоставьте этому ключу `Value3` .</span><span class="sxs-lookup"><span data-stu-id="95bbf-189">Let this key be `Value3`.</span></span>

```
    \HKEY_LOCAL_MACHINE
       SOFTWARE
          Classes
             htmlfile
                 = Class for WWW HTML files
                PersistentHandler
                   {EEC97550-47A9-11CF-B952-00AA0051FE20}
```

4. <span data-ttu-id="95bbf-190">Определите GUID постоянного обработчика [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) .</span><span class="sxs-lookup"><span data-stu-id="95bbf-190">Determine the [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) persistent handler GUID.</span></span> <span data-ttu-id="95bbf-191">Используя `Value1` и `Value3` , найдите идентификатор GUID постоянного обработчика **IFilter** для типа документа.</span><span class="sxs-lookup"><span data-stu-id="95bbf-191">Using `Value1` and `Value3`, find the **IFilter** Persistent Handler GUID for the document type.</span></span> <span data-ttu-id="95bbf-192">Значение в записи реестра \\ hKey \_ Local \_ Machine \\ Software \\ Classes \\ CLSID \\ значение1 или 3 \\ персистентаддинсрегистеред \\ 89BCB740-6119-101A-BCB7-00DD010655AF "/> дает идентификатор GUID персистенсандлер **IFilter** для этого типа документа.</span><span class="sxs-lookup"><span data-stu-id="95bbf-192">The value under the registry entry \\HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Classes\\CLSID\\Value1 or 3\\PersistentAddinsRegistered\\ 89BCB740-6119-101A-BCB7-00DD010655AF"/> yields the **IFilter** PersistentHandler GUID for this document type.</span></span> <span data-ttu-id="95bbf-193">Предоставьте этому ключу `Value4` .</span><span class="sxs-lookup"><span data-stu-id="95bbf-193">Let this key be `Value4`.</span></span> <span data-ttu-id="95bbf-194">В этом примере GUID интерфейса **IFilter** — 89BCB740-6119-101A-BCB7-00DD010655AF.</span><span class="sxs-lookup"><span data-stu-id="95bbf-194">In this example, the **IFilter** interface GUID is 89BCB740-6119-101A-BCB7-00DD010655AF.</span></span>

```
    HKEY_LOCAL_MACHINE
       SOFTWARE
          Classes
             {EEC97550-47A9-11CF-B952-00AA0051FE20}
                 = HTML File Persistent Handler
                    Data type         REG_SZ
                        PersistentAddinsRegistered
                        {89BCB740-6119-101A-BCB7-00DD010655AF}

                    Data type         REG_SZ
                        default = {E0CA5340-4534-11CF-B952-00AA0051FE20}
```

> [!NOTE]  
> <span data-ttu-id="95bbf-195">В этом примере библиотека DLL [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) для HTML-документов nlhtml.dll.</span><span class="sxs-lookup"><span data-stu-id="95bbf-195">In this example, the [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) DLL for HTML documents is nlhtml.dll.</span></span>

### <a name="ifiltergetchunk-and-locale-code-identifiers"></a><span data-ttu-id="95bbf-196">Идентификаторы кода IFilter:: и фрагмента и языкового стандарта</span><span class="sxs-lookup"><span data-stu-id="95bbf-196">IFilter::GetChunk and Locale Code Identifiers</span></span>

<span data-ttu-id="95bbf-197">КОД языка текста может изменяться в пределах одного файла.</span><span class="sxs-lookup"><span data-stu-id="95bbf-197">The LCID of text can change within a single file.</span></span> <span data-ttu-id="95bbf-198">Например, текст инструкции может переноситься между английским языком (EN-US) и испанскими (ES), а текст может содержать одно слово на языке, отличном от основного.</span><span class="sxs-lookup"><span data-stu-id="95bbf-198">For example, the text of an instruction manual might alternate between English (en-us) and Spanish (es) or the text may include a single word in a language other than the primary language.</span></span> <span data-ttu-id="95bbf-199">В любом случае [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) должен начинать новый блок каждый раз при изменении кода языка.</span><span class="sxs-lookup"><span data-stu-id="95bbf-199">In either case, your [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) must begin a new chunk each time the LCID changes.</span></span> <span data-ttu-id="95bbf-200">Поскольку код языка используется для выбора соответствующего средство разбиения по словам, очень важно правильно его определить.</span><span class="sxs-lookup"><span data-stu-id="95bbf-200">Because the LCID is used to choose an appropriate word breaker, it is very important that you correctly identify it.</span></span> <span data-ttu-id="95bbf-201">Если **IFilter** не может определить языковой стандарт текста, он должен вернуть фрагмент кода, равный нулю.</span><span class="sxs-lookup"><span data-stu-id="95bbf-201">If the **IFilter** cannot determine the locale of the text, then it should return an LCID of zero with the chunk.</span></span> <span data-ttu-id="95bbf-202">Если значение LCID равно нулю, Поиск Windows будет использовать технологию автоматического определения языка (LAD) для определения идентификатора локали фрагмента.</span><span class="sxs-lookup"><span data-stu-id="95bbf-202">Returning an LCID of zero causes Windows Search to use Language Auto-Detection (LAD) technology to determine the locale ID of the chunk.</span></span> <span data-ttu-id="95bbf-203">Если поиск не находит совпадений, по умолчанию используется системный язык по умолчанию (путем вызова функции [функции жетсистемдефаултлокаленаме](/windows/win32/api/winnls/nf-winnls-getsystemdefaultlocalename) ).</span><span class="sxs-lookup"><span data-stu-id="95bbf-203">If Windows Search cannot find a match, it defaults to the system default locale (by calling the [GetSystemDefaultLocaleName Function](/windows/win32/api/winnls/nf-winnls-getsystemdefaultlocalename) function).</span></span> <span data-ttu-id="95bbf-204">Дополнительные сведения см. в разделе [**IFilter::**](/windows/win32/api/filter/nf-filter-ifilter-getchunk)бреактипе, [**блок \_**](/windows/win32/api/filter/ne-filter-chunk_breaktype), [**чункстате**](/windows/win32/api/filter/ne-filter-chunkstate)и [**stat \_**](/windows/win32/api/filter/ns-filter-stat_chunk).</span><span class="sxs-lookup"><span data-stu-id="95bbf-204">For more information, see [**IFilter::GetChunk**](/windows/win32/api/filter/nf-filter-ifilter-getchunk), [**CHUNK\_BREAKTYPE**](/windows/win32/api/filter/ne-filter-chunk_breaktype), [**CHUNKSTATE**](/windows/win32/api/filter/ne-filter-chunkstate), and [**STAT\_CHUNK**](/windows/win32/api/filter/ns-filter-stat_chunk).</span></span>

<span data-ttu-id="95bbf-205">Если вы управляете форматом файла и в настоящее время он не содержит сведений о языковых стандартах, необходимо добавить функцию пользователя, чтобы обеспечить правильную идентификацию языкового стандарта.</span><span class="sxs-lookup"><span data-stu-id="95bbf-205">If you control the file format and it currently does not contain locale information, you should add a user feature to enable proper locale identification.</span></span> <span data-ttu-id="95bbf-206">Использование несовпадающего средства разбиения по словам может привести к плохому использованию запросов пользователя.</span><span class="sxs-lookup"><span data-stu-id="95bbf-206">Using a mismatched word breaker can result in a poor query experience for the user.</span></span> <span data-ttu-id="95bbf-207">Дополнительные сведения см. в разделе [**ивордбреакер**](/windows/desktop/api/Indexsrv/nn-indexsrv-iwordbreaker).</span><span class="sxs-lookup"><span data-stu-id="95bbf-207">For more information, see [**IWordBreaker**](/windows/desktop/api/Indexsrv/nn-indexsrv-iwordbreaker).</span></span>

> [!NOTE]  
> <span data-ttu-id="95bbf-208">Фильтры связаны с типами файлов, как отмечены расширениями имен файлов, типами MIME или идентификаторами CLSID.</span><span class="sxs-lookup"><span data-stu-id="95bbf-208">Filters are associated with file types, as denoted by file name extensions, MIME types or CLSIDs.</span></span> <span data-ttu-id="95bbf-209">Хотя один фильтр может работать с несколькими типами файлов, каждый тип работает только с одним фильтром.</span><span class="sxs-lookup"><span data-stu-id="95bbf-209">While one filter can handle multiple file types, each type works with only one filter.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="95bbf-210">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="95bbf-210">Additional Resources</span></span>

- <span data-ttu-id="95bbf-211">Пример кода [ифилтерсампле](-search-sample-ifiltersample.md) , доступный на [GitHub](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/winui/WindowsSearch/IFilterSample7), демонстрирует создание базового класса IFilter для реализации интерфейса [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) .</span><span class="sxs-lookup"><span data-stu-id="95bbf-211">The [IFilterSample](-search-sample-ifiltersample.md) code sample, available on [GitHub](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/winui/WindowsSearch/IFilterSample7), demonstrates how to create an IFilter base class for implementing the [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) interface.</span></span>
- <span data-ttu-id="95bbf-212">Общие сведения о процессе индексирования см. [в разделе процесс индексирования](-search-indexing-process-overview.md).</span><span class="sxs-lookup"><span data-stu-id="95bbf-212">For an overview of the indexing process, see [The Indexing Process](-search-indexing-process-overview.md).</span></span>
- <span data-ttu-id="95bbf-213">Общие сведения о типах файлов см. в разделе [типы файлов](../shell/fa-file-types.md).</span><span class="sxs-lookup"><span data-stu-id="95bbf-213">For an overview of file types, see [File Types](../shell/fa-file-types.md).</span></span>
- <span data-ttu-id="95bbf-214">Сведения о запросе атрибутов сопоставления файлов для типа файлов см. в разделе [перцеиведтипес, системфилеассоЦиатионс и регистрация приложения](/previous-versions/windows/desktop/legacy/cc144150(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="95bbf-214">To query file association attributes for a file type, see [PerceivedTypes, SystemFileAssociations, and Application Registration](/previous-versions/windows/desktop/legacy/cc144150(v=vs.85)).</span></span>

## <a name="related-topics"></a><span data-ttu-id="95bbf-215">См. также</span><span class="sxs-lookup"><span data-stu-id="95bbf-215">Related topics</span></span>

[<span data-ttu-id="95bbf-216">Разработка обработчиков фильтров</span><span class="sxs-lookup"><span data-stu-id="95bbf-216">Developing Filter Handlers</span></span>](-search-ifilter-conceptual.md)

[<span data-ttu-id="95bbf-217">Рекомендации по созданию обработчиков фильтров в поиске Windows</span><span class="sxs-lookup"><span data-stu-id="95bbf-217">Best Practices for Creating Filter Handlers in Windows Search</span></span>](-search-3x-wds-extidx-filters.md)

[<span data-ttu-id="95bbf-218">Возвращение свойств из обработчика фильтра</span><span class="sxs-lookup"><span data-stu-id="95bbf-218">Returning Properties from a Filter Handler</span></span>](-search-ifilter-property-filtering.md)

[<span data-ttu-id="95bbf-219">Обработчики фильтров, поставляемые с Windows</span><span class="sxs-lookup"><span data-stu-id="95bbf-219">Filter Handlers that Ship with Windows</span></span>](-search-ifilter-implementations.md)

[<span data-ttu-id="95bbf-220">Реализация обработчиков фильтров в поиске Windows</span><span class="sxs-lookup"><span data-stu-id="95bbf-220">Implementing Filter Handlers in Windows Search</span></span>](-search-ifilter-constructing-filters.md)

[<span data-ttu-id="95bbf-221">Регистрация обработчиков фильтров</span><span class="sxs-lookup"><span data-stu-id="95bbf-221">Registering Filter Handlers</span></span>](-search-ifilter-registering-filters.md)

[<span data-ttu-id="95bbf-222">Тестирование обработчиков фильтров</span><span class="sxs-lookup"><span data-stu-id="95bbf-222">Testing Filter Handlers</span></span>](-search-ifilter-testing-filters.md)
