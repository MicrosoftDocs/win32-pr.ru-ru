---
description: диспетчер области обхода содержимого (CSM) позволяет определять правила области, включающие или исключающие url-адреса из области сканирования Windows поиска.
ms.assetid: 132a55f9-680d-438e-b983-f5ce4cf66a41
title: Управление правилами области
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 134e4241e9dcd66e468935ae56a4029a51a96c37
ms.sourcegitcommit: 61a4c522182aa1cacbf5669683d9570a3bf043b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2021
ms.locfileid: "122880216"
---
# <a name="managing-scope-rules"></a>Управление правилами области

диспетчер области обхода содержимого (CSM) позволяет определять правила области, включающие или исключающие url-адреса из области сканирования Windows поиска.

CSM позволяет выполнять следующие действия:

-   Добавить новые правила области в набор рабочих правил
-   Удалить существующие правила области
-   Перечислить правила области по умолчанию
-   Обнаружение того, включен ли определенный URL-адрес в область обхода содержимого или исключен из него, или имеет правило области действия "родитель" или "дочерняя"

 

В этом разделе рассматриваются следующие вопросы.

-   [О правилах области](#about-scope-rules)
-   [Перед началом](#before-you-begin)
-   [Добавление правил области](#adding-scope-rules)
    -   [Примечания к пользовательским правилам](#notes-on-user-rules)
-   [Удаление правил области](#removing-scope-rules)
-   [Возврат к правилам по умолчанию](#reverting-to-default-rules)
-   [Перечисление правил области](#enumerating-scope-rules)
-   [Правила области трассировки](#tracing-scope-rules)
-   [См. также](#related-topics)

## <a name="about-scope-rules"></a>О правилах области

Правило области — это правило, которое включает или исключает URL-адреса в корне поиска для обхода и индексирования. Правила включения приводят к тому, что индексатор включает этот URL-адрес в область скравл, а правила исключения приводят к тому, что индексатор исключит этот URL-адрес (и его дочерние элементы) из области сканирования.

Например, предположим, что вы установили новое приложение, файлы данных которого находятся в папке Ворктеама \\ ProjectFiles на локальном компьютере. Предположим, что вы хотите, чтобы все элементы в папке ProjectFiles были индексированы, за исключением элементов в прототипах вложенных папок. В этом случае вам потребуется правило включения для myPH:///C: \\ ворктеама \\ ProjectFiles \\ и правило исключения для MyPH:///C: \\ ворктеама \\ ProjectFiles \\ prototype \\ .

Существует три типа правил со следующим порядком приоритета.

1.  Правила групповая политика задаются администраторами и могут переопределять все остальные правила.
2.  пользовательские правила задаются пользователями, изменяющими область в пользовательском интерфейсе Windows параметров поиска. Пользователи или другие приложения могут удалить все правила пользователя и вернуться к правилам по умолчанию.
3.  Правила по умолчанию обычно задаются приложением для определения области по умолчанию. Например, правила по умолчанию могут быть установлены при добавлении нового обработчика протокола или контейнера в систему.

Вместе эти типы правил составляют *Рабочий набор правил* , из которого диспетчер области СКАНИРОВАНИЯ (CSM) создает полный список URL-адресов для обхода. Хотя правила по умолчанию могут быть переопределены правилами групповой политики и пользовательскими правилами, они сохраняются в собственном наборе правил по умолчанию, к которому можно вернуться в любое время. Индексатор обходит URL-адреса из набора рабочих правил и добавляет элементы, свойства и содержимое в каталог.

> [!Note]  
> Пользователи с доступом к панели управления могут изменять правила через этот интерфейс. Поэтому приложения, предлагающие Управление областью, должны всегда получать правила непосредственно из CSM с помощью методов перечисления, а не полагаться на сохраненную копию пользовательских правил.

 

Правила исключения могут определять URL-адреса шаблонов с подстановочным знаком " \* ", например: file:///C: \\ Project a \\ \* \\ . Правило исключения, использующее этот шаблон, запрещает индексатору выполнять обход содержимого папок в каталоге проекта. Для более сложного примера предположим, что существует правило включения для file:///C: \\ Project \\ а и правило шаблона исключения для file:///C: \\ \\ \* \\ данные проекта \\ \* . В этом случае индексатор будет выполнять обход элементов в:

-   C: \\ проект а\\
-   C: \\ Project a \\ **версии 1** \\ тестфилес\\
-   В. \\ проект a \\ **версии 1 \\ временные** \\ данные\\

Но индексатор не будет выполнять обход элементов в:

-   В. \\ проектная \\ **версии 1** \\ данных\\

 

## <a name="before-you-begin"></a>Перед началом

Прежде чем использовать любой из интерфейсов диспетчера области сканирования, необходимо выполнить следующие предварительные действия.

1.  Создайте объект **ксеарчманажер** и получите его интерфейс **исеарчманажер** .
2.  Вызовите **исеарчманажер:: catalog** для "системиндекс", чтобы получить экземпляр интерфейса **исеарчкаталогманажер** .
3.  Вызовите метод **исеарчкаталогманажер:: жеткравлскопеманажер** , чтобы получить экземпляр интерфейса **исеарчкравлскопеманажер** .

После внесения изменений в Диспетчер области обхода содержимого необходимо вызвать метод [**исеарчкравлскопеманажер:: савеалл**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-saveall) . Этот метод не принимает параметров и возвращает значение S \_ ОК в случае успеха.

 

## <a name="adding-scope-rules"></a>Добавление правил области

Рабочие правила, заданные для CSM, включают правила пользователя и по умолчанию, а также правила, принудительно применяемые групповой политикой. Пользовательские правила настраиваются пользователями в пользовательском интерфейсе, а правила по умолчанию могут быть установлены любым из следующих элементов:

-   Групповые политики, реализуемые системным администратором (не используют интерфейс [**исеарчкравлскопеманажер**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcrawlscopemanager) ).
-   установка или обновление приложения, например Windows поиск или обработчик протокола.
-   Приложение установки для добавления нового хранилища данных или контейнера

[**Исеарчкравлскопеманажер**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcrawlscopemanager) предоставляет два метода для добавления новых правил области, как описано в следующей таблице. Пути для правил включения файловой системы должны заканчиваться обратной косой чертой \\ (например, file:///C: \\ Files \\ ), а пути для правил исключения должны заканчиваться звездочкой (например, file:///c: \\ Files \\ \* ). Только правила исключения могут содержать URL-адреса шаблонов. Кроме того, рекомендуется включить в пути идентификаторы безопасности пользователей (SID) для повышения безопасности. Пути для каждого пользователя более безопасны, так как запросы будут выполняться в пользовательском процессе, гарантируя, что один пользователь не сможет видеть элементы, индексируемые из папки "Входящие" другого пользователя, например.

В следующей таблице описаны методы интерфейса Исеарчкравлскопеманажер, используемые для добавления новых правил области.



| Метод                                                                              | Описание                                                                                                                                                                                                                  |
|-------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**аддусерскоперуле**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-adduserscoperule)       | Добавляет правило для URL-адреса, указанного пользователем. Эти правила переопределяют правила по умолчанию. Используйте этот метод, если вы реализовали пользовательский интерфейс, позволяющий пользователям управлять собственными правилами области действия и URL-адресами.                         |
| [**адддефаултскоперуле**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-adddefaultscoperule) | Добавляет правило для URL-адреса в соответствии с указаниями другого приложения, например обработчика протокола. Используйте этот метод при реализации нового обработчика протокола или добавлении нового хранилища данных. Эти правила могут быть переопределены правилами пользователя. |



 

Каждый метод принимает URL-адрес индексируемого расположения и флаги, которые определяют, следует ли включать или исключать URL-адрес. Параметр *ффолловфлагс* зарезервирован для использования в будущем. Когда вы добавляете новое правило области, и Диспетчер области обхода содержимого определяет, что правило уже существует (в зависимости от указанного URL-адреса или шаблона), набор рабочих правил обновляется таким образом, что старое правило заменяется новым правилом, и (2) правила пользователя, противоречащие его удалению.

**Совет.** Хотя корневой элемент file://включен в область обхода содержимого по умолчанию, программные файлы не индексируются по умолчанию. Поэтому приложения с данными, сохраненными в каталоге программных файлов, должны добавить их расположение в качестве правила по умолчанию.

### <a name="notes-on-user-rules"></a>Примечания к пользовательским правилам

Если новое правило пользователя совпадает с существующим правилом по умолчанию, новое правило переопределяет правило по умолчанию в наборе рабочих правил. Если новое правило пользователя совпадает с существующим правилом пользователя, старое правило пользователя заменяется.

Установка флага *фоверридечилдрен* приводит к следующим результатам в рабочем наборе правил:

-   **Значение true** приводит к удалению всех дочерних правил из набора рабочих правил (правил пользователя и правил по умолчанию).
-   Значение FALSE приводит к повторному добавлению рабочих правил задает все правила по умолчанию, дочерние для нового правила пользователя. Если дочернее правило по умолчанию является включением, а новое правило пользователя является исключением, правило по умолчанию изменяется на правило включения пользователя.

 

## <a name="removing-scope-rules"></a>Удаление правил области

Вы можете использовать интерфейс [**исеарчкравлскопеманажер**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcrawlscopemanager) для удаления правила области из набора рабочих правил. Этот интерфейс предоставляет следующие два метода для удаления правил области.



| Метод                                                                                    | Описание                                                                                                                                                                                           |
|-------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**ремовескоперуле**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-removescoperule)               | Удаляет правило пользователя для указанного URL-адреса из набора рабочих правил. Если правило пользователя дублируется или переопределяет правило по умолчанию, правило по умолчанию остается в наборе рабочих правил.                  |
| [**ремоведефаултскоперуле**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-removedefaultscoperule) | Удаляет правило по умолчанию для указанного URL-адреса из набора рабочих правил и набора правил по умолчанию. После вызова этого метода вы не сможете вернуться к этому правилу по умолчанию с помощью Реверттодефаултскопес. |



 

Каждый метод принимает URL-адрес и флаг, указывающий, является ли удаляемое правило правилом включения или исключения. Эти методы возвращают ошибку, если не найдено правило с этим URL-адресом и флагом включения или исключения.

**Совет.** Если вы хотите полностью удалить область из области сканирования, используйте метод [**ремоверут**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-removeroot) , который удаляет корень поиска и все связанные правила области. Например, это рекомендуется сделать при удалении.

Кроме того, можно удалить все переопределения набора пользователей для корня поиска и вернуться к исходному диапазону поиска и правилам области по умолчанию. Дополнительные сведения см. в следующем разделе.

> [!Note]  
> в Windows Vista, если пользователи удаляются с помощью профилей пользователей на панели управления, CSM удаляет все правила и корни, включающие их идентификаторы безопасности, и удаляет их индексированные элементы из каталога. в Windows XP необходимо вручную удалить корни и правила пользователей.

 

 

## <a name="reverting-to-default-rules"></a>Возврат к правилам по умолчанию

При возврате к правилам по умолчанию удаляются все правила пользователя для URL-адреса или корня, а все правила по умолчанию восстанавливаются в набор рабочих правил. Однако он не удаляет правила, заданные групповой политикой. Метод [**реверттодефаултскопес**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-reverttodefaultscopes) не принимает параметров и возвращает код ошибки, если не удается вернуться к правилам по умолчанию.

 

## <a name="enumerating-scope-rules"></a>Перечисление правил области

CSM перечисляет правила области с помощью стандартного интерфейса перечислителя в стиле COM, [**иенумсеарчскоперулес**](/windows/desktop/api/Searchapi/nn-searchapi-ienumsearchscoperules) . Этот интерфейс можно использовать для перечисления правил области для нескольких целей. Например, может потребоваться отобразить весь набор рабочих правил в пользовательском интерфейсе или определить, находится ли правило или дочернее правило в области обхода содержимого.

 

## <a name="tracing-scope-rules"></a>Правила области трассировки

CSM также позволяет определить, включен ли указанный URL-адрес в область сканирования и имеет ли оно правило области действия "родитель" или "дочерняя". Кроме того, можно узнать, почему URL-адрес включен или исключен из области сканирования. Эти методы не предназначены для использования с URL-адресами шаблонов.

В следующей таблице описаны методы [**исеарчкравлскопеманажер**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcrawlscopemanager) , используемые для добавления новых правил области.



| Метод                                                                                      | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|---------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**жетпарентскопеверсионид**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-getparentscopeversionid) | Возвращает идентификатор версии родительского URL-адреса включения. С помощью этого метода можно узнать, изменилась ли родительская область со времени последней проверки.<br/> Пример. Если приложение электронной почты использует уведомления, управляемые поставщиком, оно может получить версию родительской области, прежде чем будет закрыто, и снова проверить версию при ее открытии. Затем приложение может определить, требуется ли отправлять в индексатор новый набор уведомлений.<br/> |
| [**хасчилдскоперуле**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-haschildscoperule)             | Возвращает **значение true** , если указанный URL-адрес имеет дочернее правило (правило, применяемое к дочернему элементу на любом уровне в иерархии URL-адресов). <br/> Пример. Если URL-адрес — file:///C: \\ Folder \\ , этот метод возвращает **значение true** , если CSM имеет правило области действия специально для \\ \\ вложенной папки File:///C: Folder \\ .<br/>                                                                                                                                              |
| [**хаспарентскоперуле**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-hasparentscoperule)           | Возвращает **значение true** , если указанный URL-адрес имеет родительское правило (правило применяется к родительскому элементу на любом уровне иерархии URL-адресов).<br/> Пример. Если URL-адрес является вложенной папкой file:///C: \\ Folder \\ , этот метод возвращает **значение true** , если CSM имеет правило области действия специально для file:///C: \\ Folder \\ .<br/>                                                                                                                                                   |
| [**инклудединкравлскопе**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-includedincrawlscope)       | Возвращает **значение true** , если указанный URL-адрес включен в область обхода содержимого.                                                                                                                                                                                                                                                                                                                                                                                  |
| [**инклудединкравлскопикс**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-includedincrawlscopeex)   | Возвращает значение из перечисления [**клусион \_ Reason**](/windows/win32/api/searchapi/ne-searchapi-clusion_reason) , объясняющее, почему URL-адрес включен в область сканирования или исключен из нее, и получает значение **true** , если URL-адрес включен в область сканирования. Этот метод помогает выявить конфликты в наборе рабочих правил.                                                                                                                                       |



 

 

> [!Note]  
> Методы [**инклудединкравлскопе**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-includedincrawlscope) и [**инклудединкравлскопикс**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-includedincrawlscopeex) определяют, будет ли выполняться обход содержимого URL-адреса только на основе правил в CSM. Есть и другие причины, по которым URL-адрес не обходится, например задается бит ФАНЦИ (т. е. пользователь запретил возможность быстрого индексирования в диалоговом окне Свойства папки).

 

Если вы считаете, что путь к файлу должен быть исключен, но указан как включенный, убедитесь, что правила исключения заканчиваются на " &lt; path &gt; \\ \* ". Если вы считаете, что файл или путь к файлу должны быть добавлены, но это не так, обязательно проверьте параметр ФАНЦИ bit для файла или пути. Для этого щелкните правой кнопкой мыши файл или путь к файлу и выберите пункт **Свойства**, а затем убедитесь, что установлен флажок **для быстрого поиска, разрешить индексировать службу индексирования для этой папки** . Если путь к файлу или файлу не помечен для индексирования, он не будет индексироваться, даже если он находится в правиле включения.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

**Reference**
</dt> <dt>

[**исеарчкравлскопеманажер**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcrawlscopemanager)
</dt> <dt>

[**ISearchCrawlScopeManager2**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcrawlscopemanager2)
</dt> <dt>

[**исеарчскоперуле**](/windows/desktop/api/Searchapi/nn-searchapi-isearchscoperule)
</dt> <dt>

[**иенумсеарчскоперулес**](/windows/desktop/api/Searchapi/nn-searchapi-ienumsearchscoperules)
</dt> <dt>

**Зрения**
</dt> <dt>

[Управление корнями поиска](-search-3x-wds-extidx-csm-searchroots.md)
</dt> </dl>

 

 




