---
description: В Windows 8 добавлена поддержка отражения модели представления и связанной с ней статистики в DXGI 1,2.
ms.assetid: E132DAF5-80B7-4C52-A760-3779CC140CE7
title: Модель перелистывания DXGI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 49ee82febd13a3b57a06d93fd01eb8d230d6b78a
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "103894757"
---
# <a name="dxgi-flip-model"></a><span data-ttu-id="85cb3-103">Модель перелистывания DXGI</span><span class="sxs-lookup"><span data-stu-id="85cb3-103">DXGI flip model</span></span>

<span data-ttu-id="85cb3-104">В Windows 8 добавлена поддержка отражения модели представления и связанной с ней статистики в DXGI 1,2.</span><span class="sxs-lookup"><span data-stu-id="85cb3-104">Windows 8 adds support for flip presentation model and its associated present statistics in DXGI 1.2.</span></span> <span data-ttu-id="85cb3-105">Модель эргономичного показа DXGI в Windows 8 аналогична презентации в [режиме эргономичного отражения Windows 7 Direct3D 9EX](../direct3darticles/direct3d-9ex-improvements.md).</span><span class="sxs-lookup"><span data-stu-id="85cb3-105">Windows 8’s DXGI flip presentation model is similar to Windows 7’s [Direct3D 9EX Flip Mode Presentation](../direct3darticles/direct3d-9ex-improvements.md).</span></span> <span data-ttu-id="85cb3-106">Приложения для показа видеоматериалов или частоты кадров, такие как игры, могут использовать больше преимуществ с помощью функции "отразить презентацию".</span><span class="sxs-lookup"><span data-stu-id="85cb3-106">Video or frame rate-based presentation apps such as games can benefit most by using flip presentation model.</span></span> <span data-ttu-id="85cb3-107">Приложения, использующие DXGI, переворачивают модель представления, уменьшают нагрузку на системные ресурсы и увеличивают производительность.</span><span class="sxs-lookup"><span data-stu-id="85cb3-107">Apps that use DXGI flip presentation model reduce the system resource load and increase performance.</span></span> <span data-ttu-id="85cb3-108">Приложения также могут использовать существующие улучшения статистики с функцией эргономичного представления, чтобы лучше управлять скоростью презентации, предоставляя механизмы обратной связи и исправления в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="85cb3-108">Apps can also use present statistics enhancements with flip presentation model to better control the rate of presentation by providing real-time feedback and correction mechanisms.</span></span>

-   [<span data-ttu-id="85cb3-109">Сравнение модели перелистывания DXGI и модели BitBlt</span><span class="sxs-lookup"><span data-stu-id="85cb3-109">Comparing the DXGI flip model and the BitBlt model</span></span>](#comparing-the-dxgi-flip-model-and-the-bitblt-model)
-   [<span data-ttu-id="85cb3-110">Использование модели перелистывания DXGI</span><span class="sxs-lookup"><span data-stu-id="85cb3-110">How to use DXGI flip model</span></span>](#how-to-use-dxgi-flip-model)
-   [<span data-ttu-id="85cb3-111">Синхронизация кадров для приложений модели перелистывания DXGI</span><span class="sxs-lookup"><span data-stu-id="85cb3-111">Frame synchronization of DXGI flip model apps</span></span>](#frame-synchronization-of-dxgi-flip-model-apps)
-   [<span data-ttu-id="85cb3-112">Предотвращение, обнаружение и восстановление после сбоев</span><span class="sxs-lookup"><span data-stu-id="85cb3-112">Avoiding, detecting, and recovering from glitches</span></span>](#avoiding-detecting-and-recovering-from-glitches)
-   [<span data-ttu-id="85cb3-113">См. также</span><span class="sxs-lookup"><span data-stu-id="85cb3-113">Related topics</span></span>](#related-topics)

## <a name="comparing-the-dxgi-flip-model-and-the-bitblt-model"></a><span data-ttu-id="85cb3-114">Сравнение модели перелистывания DXGI и модели BitBlt</span><span class="sxs-lookup"><span data-stu-id="85cb3-114">Comparing the DXGI flip model and the BitBlt model</span></span>

<span data-ttu-id="85cb3-115">Среда выполнения использует побитовую пересылку (BitBlt) и переворачивает модели представления, чтобы представить графическое содержимое на мониторах отображения.</span><span class="sxs-lookup"><span data-stu-id="85cb3-115">The runtime uses the bit-block transfer (bitblt) and flip presentation models to present graphics content on display monitors.</span></span> <span data-ttu-id="85cb3-116">Крупнейшим различием между BitBlt и отражением моделей представления является то, как содержимое заднего буфера передается в Windows 8 DWM для композиции.</span><span class="sxs-lookup"><span data-stu-id="85cb3-116">The biggest difference between bitblt and flip presentation models is how back-buffer contents get to the Windows 8 DWM for composition.</span></span> <span data-ttu-id="85cb3-117">В модели BitBlt содержимое заднего буфера копируется в поверхность перенаправления при каждом вызове [**IDXGISwapChain1::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1).</span><span class="sxs-lookup"><span data-stu-id="85cb3-117">In the bitblt model, contents of the back buffer are copied into the redirection surface on each call to [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1).</span></span> <span data-ttu-id="85cb3-118">В модели перелистывания все задние буферы совместно используются диспетчер окон рабочего стола (DWM).</span><span class="sxs-lookup"><span data-stu-id="85cb3-118">In the flip model, all back buffers are shared with the Desktop Window Manager (DWM).</span></span> <span data-ttu-id="85cb3-119">Таким образом, DWM может составляться непосредственно из этих задних буферов без каких бы то ни было дополнительных операций копирования.</span><span class="sxs-lookup"><span data-stu-id="85cb3-119">Therefore, the DWM can compose straight from those back buffers without any additional copy operations.</span></span> <span data-ttu-id="85cb3-120">Как правило, модель перелистывания более эффективна.</span><span class="sxs-lookup"><span data-stu-id="85cb3-120">In general, the flip model is more efficient.</span></span> <span data-ttu-id="85cb3-121">Модель перелистывания также предоставляет больше функций, таких как улучшенная статистика.</span><span class="sxs-lookup"><span data-stu-id="85cb3-121">The flip model also provides more features, such as enhanced present statistics.</span></span>

<span data-ttu-id="85cb3-122">Если у вас есть устаревшие компоненты, использующие Windows интерфейс графических устройств (GDI) для записи в [**HWND**](../winprog/windows-data-types.md) напрямую, используйте модель BitBlt.</span><span class="sxs-lookup"><span data-stu-id="85cb3-122">If you have legacy components that use Windows Graphics Device Interface (GDI) to write to an [**HWND**](../winprog/windows-data-types.md) directly, use the bitblt model.</span></span>

<span data-ttu-id="85cb3-123">Повышение производительности модели перелистывания DXGI имеет большое значение, если приложение находится в оконном режиме.</span><span class="sxs-lookup"><span data-stu-id="85cb3-123">Performance improvements of DXGI flip model are significant when the app is in windowed mode.</span></span> <span data-ttu-id="85cb3-124">Последовательность в этой таблице и иллюстрация Сравнение использования пропускной способности памяти и операций чтения и записи в оконных приложениях, в которых выбирается отразить модель относительно модели BitBlt.</span><span class="sxs-lookup"><span data-stu-id="85cb3-124">The sequence in this table and the illustration compare memory bandwidth usages and system reads and writes of windowed apps that choose flip model versus the bitblt model.</span></span>



| <span data-ttu-id="85cb3-125">Шаг</span><span class="sxs-lookup"><span data-stu-id="85cb3-125">Step</span></span> | <span data-ttu-id="85cb3-126">Модель BitBlt, представленная в DWM</span><span class="sxs-lookup"><span data-stu-id="85cb3-126">BitBlt model present to DWM</span></span>                                                                               | <span data-ttu-id="85cb3-127">Модель перелистывания DXGI, представленная в DWM</span><span class="sxs-lookup"><span data-stu-id="85cb3-127">DXGI flip model present to DWM</span></span>                                   |
|------|-----------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|
| <span data-ttu-id="85cb3-128">1.</span><span class="sxs-lookup"><span data-stu-id="85cb3-128">1.</span></span>   | <span data-ttu-id="85cb3-129">Приложение обновляет свой кадр (запись)</span><span class="sxs-lookup"><span data-stu-id="85cb3-129">The app updates its frame (Write)</span></span><br/>                                                              | <span data-ttu-id="85cb3-130">Приложение обновляет свой кадр (запись)</span><span class="sxs-lookup"><span data-stu-id="85cb3-130">The app updates its frame (Write)</span></span><br/>                     |
| <span data-ttu-id="85cb3-131">2.</span><span class="sxs-lookup"><span data-stu-id="85cb3-131">2.</span></span>   | <span data-ttu-id="85cb3-132">Среда выполнения Direct3D копирует содержимое поверхности в поверхность перенаправления DWM (чтение, запись)</span><span class="sxs-lookup"><span data-stu-id="85cb3-132">Direct3D runtime copies surface contents to a DWM redirection surface (Read, Write)</span></span><br/>            | <span data-ttu-id="85cb3-133">Среда выполнения Direct3D передает поверхность приложения в DWM</span><span class="sxs-lookup"><span data-stu-id="85cb3-133">Direct3D runtime passes the app surface to DWM</span></span><br/>        |
| <span data-ttu-id="85cb3-134">3.</span><span class="sxs-lookup"><span data-stu-id="85cb3-134">3.</span></span>   | <span data-ttu-id="85cb3-135">После завершения копирования в общей области DWM отображает поверхность приложения на экране (чтение, запись).</span><span class="sxs-lookup"><span data-stu-id="85cb3-135">After the shared surface copy completes, DWM renders the app surface onto screen (Read, Write)</span></span><br/> | <span data-ttu-id="85cb3-136">DWM отображает поверхность приложения на экране (чтение, запись)</span><span class="sxs-lookup"><span data-stu-id="85cb3-136">DWM renders the app surface onto screen (Read, Write)</span></span><br/> |



 

![Иллюстрация сравнения модели БЛТ и модели перелистывания](images/blt-flip-mode-present.png)

<span data-ttu-id="85cb3-138">Модель отражения уменьшает использование системной памяти за счет сокращения числа операций чтения и записи средой выполнения Direct3D для композиции оконных кадров с помощью DWM.</span><span class="sxs-lookup"><span data-stu-id="85cb3-138">Flip model reduces system memory usage by reducing the number of reads and writes by the Direct3D runtime for the windowed frame composition by DWM.</span></span>

## <a name="how-to-use-dxgi-flip-model"></a><span data-ttu-id="85cb3-139">Использование модели перелистывания DXGI</span><span class="sxs-lookup"><span data-stu-id="85cb3-139">How to use DXGI flip model</span></span>

<span data-ttu-id="85cb3-140">Приложения Direct3D 11,1, предназначенные для использования в Windows 8, используют модель перелистывания, создавая цепочку буферов с [**\_ \_ \_ отражением \_ последовательного**](/windows/desktop/api/DXGI/ne-dxgi-dxgi_swap_effect) перечисления, заданным в элементе **SwapEffect** в структуре [**\_ \_ \_ DESC1 цепи swap**](/windows/desktop/api/DXGI1_2/ns-dxgi1_2-dxgi_swap_chain_desc1) .</span><span class="sxs-lookup"><span data-stu-id="85cb3-140">Direct3D 11.1 apps that target Windows 8 use flip model by creating the swap chain with the [**DXGI\_SWAP\_EFFECT\_FLIP\_SEQUENTIAL**](/windows/desktop/api/DXGI/ne-dxgi-dxgi_swap_effect) enumeration value set in the **SwapEffect** member of the [**DXGI\_SWAP\_CHAIN\_DESC1**](/windows/desktop/api/DXGI1_2/ns-dxgi1_2-dxgi_swap_chain_desc1) structure.</span></span> <span data-ttu-id="85cb3-141">При установке **SwapEffect** в **\_ действие переключить \_ эффекты \_ \_ переключения DXGI** также установите для этих элементов **\_ цепочки подкачки DXGI \_ \_ DESC1** указанные значения:</span><span class="sxs-lookup"><span data-stu-id="85cb3-141">When you set **SwapEffect** to **DXGI\_SWAP\_EFFECT\_FLIP\_SEQUENTIAL**, also set these members of **DXGI\_SWAP\_CHAIN\_DESC1** to the indicated values:</span></span>

-   <span data-ttu-id="85cb3-142">**BufferCount** значение от 2 до 16, чтобы предотвратить снижение производительности в результате ожидания DWM для освобождения буфера представления.</span><span class="sxs-lookup"><span data-stu-id="85cb3-142">**BufferCount** to a value between 2 and 16 to prevent a performance penalty as a result of waiting on DWM to release the previous presentation buffer.</span></span>
-   <span data-ttu-id="85cb3-143">**Форматирование** в \_ формате DXGI \_ R16G16B16A16 \_ float, \_ \_ B8G8R8A8 \_ UNORM или DXGI \_ \_ R8G8B8A8 \_ UNORM</span><span class="sxs-lookup"><span data-stu-id="85cb3-143">**Format** to DXGI\_FORMAT\_R16G16B16A16\_FLOAT, DXGI\_FORMAT\_B8G8R8A8\_UNORM, or DXGI\_FORMAT\_R8G8B8A8\_UNORM</span></span>
-   <span data-ttu-id="85cb3-144">Элемент **Count** [**\_ образца \_ DESC**](/windows/desktop/api/dxgicommon/ns-dxgicommon-dxgi_sample_desc) структуры, в котором элемент **сампледеск** указывает на один и элемент **Quality** **\_ примера \_ DESC** равным нулю, так как несколько примеров сглаживания (MSAA) не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="85cb3-144">**Count** member of the [**DXGI\_SAMPLE\_DESC**](/windows/desktop/api/dxgicommon/ns-dxgicommon-dxgi_sample_desc) structure that the **SampleDesc** member specifies to one and the **Quality** member of **DXGI\_SAMPLE\_DESC** to zero because multiple sample antialiasing (MSAA) is not supported</span></span>

<span data-ttu-id="85cb3-145">При использовании [**\_ \_ \_ \_ перелистывания эффектов переключения DXGI**](/windows/desktop/api/DXGI/ne-dxgi-dxgi_swap_effect) в операционной системе Windows 7 или более ранней версии происходит сбой создания устройства.</span><span class="sxs-lookup"><span data-stu-id="85cb3-145">If you use [**DXGI\_SWAP\_EFFECT\_FLIP\_SEQUENTIAL**](/windows/desktop/api/DXGI/ne-dxgi-dxgi_swap_effect) on Windows 7 or earlier operating system, device creation fails.</span></span> <span data-ttu-id="85cb3-146">При использовании модели перелистывания можно использовать полноэкранный режим отображения статистики в оконном режиме.</span><span class="sxs-lookup"><span data-stu-id="85cb3-146">When you use flip model, you can use full-screen present statistics in windowed mode.</span></span> <span data-ttu-id="85cb3-147">Поведение в полноэкранном режиме не затрагивается.</span><span class="sxs-lookup"><span data-stu-id="85cb3-147">Full-screen behavior is not affected.</span></span> <span data-ttu-id="85cb3-148">Если передать **значение NULL** параметру *пфуллскриндеск* [**IDXGIFactory2:: креатесвапчаинфорхвнд**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgifactory2-createswapchainforhwnd) для цепочки оконных буферов и задать для **SwapEffect** **\_ \_ эффекты переключения \_ \_ DXGI**, среда выполнения создает один лишний обратный буфер и поворачивает каждый из них в буфер, который превращается в передний буфер во время презентации.</span><span class="sxs-lookup"><span data-stu-id="85cb3-148">If you pass **NULL** to the *pFullscreenDesc* parameter of [**IDXGIFactory2::CreateSwapChainForHwnd**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgifactory2-createswapchainforhwnd) for a windowed swap chain and set **SwapEffect** to **DXGI\_SWAP\_EFFECT\_FLIP\_SEQUENTIAL**, the runtime creates one extra back buffer and rotates whichever handle belongs to the buffer that becomes the front buffer at presentation time.</span></span>

<span data-ttu-id="85cb3-149">При использовании модели перелистывания рассмотрите следующие советы.</span><span class="sxs-lookup"><span data-stu-id="85cb3-149">When you use flip model, consider these tips:</span></span>

-   <span data-ttu-id="85cb3-150">Используйте одну цепочку перелистывания моделей для каждого [**HWND**](../winprog/windows-data-types.md).</span><span class="sxs-lookup"><span data-stu-id="85cb3-150">Use one flip model swap chain per [**HWND**](../winprog/windows-data-types.md).</span></span> <span data-ttu-id="85cb3-151">Не следует ориентироваться на несколько цепочек переключения моделей перелистывания в один и тот же **HWND**.</span><span class="sxs-lookup"><span data-stu-id="85cb3-151">Do not target multiple flip model swap chains to the same **HWND**.</span></span>
-   <span data-ttu-id="85cb3-152">Не используйте цепочку перелистывания моделей с функцией [**скроллвиндов**](/windows/win32/api/winuser/nf-winuser-scrollwindow) или [**скроллвиндовекс**](/windows/win32/api/winuser/nf-winuser-scrollwindowex) GDI.</span><span class="sxs-lookup"><span data-stu-id="85cb3-152">Do not use flip model swap chain with GDI's [**ScrollWindow**](/windows/win32/api/winuser/nf-winuser-scrollwindow) or [**ScrollWindowEx**](/windows/win32/api/winuser/nf-winuser-scrollwindowex) function.</span></span> <span data-ttu-id="85cb3-153">Некоторые приложения Direct3D используют функции **скроллвиндов** и **скроллвиндовекс** GDI для обновления содержимого окна после возникновения события прокрутки пользователем.</span><span class="sxs-lookup"><span data-stu-id="85cb3-153">Some Direct3D apps use GDI's **ScrollWindow** and **ScrollWindowEx** functions to update window contents after a user scroll event occurs.</span></span> <span data-ttu-id="85cb3-154">**Скроллвиндов** и **скроллвиндовекс** выполняют битблтс содержимое окна на экране при прокрутке окна пользователем.</span><span class="sxs-lookup"><span data-stu-id="85cb3-154">**ScrollWindow** and **ScrollWindowEx** perform bitblts of window contents on screen as the user scrolls a window.</span></span> <span data-ttu-id="85cb3-155">Эти функции также нуждаются в обновлениях модели BitBlt для содержимого GDI и Direct3D.</span><span class="sxs-lookup"><span data-stu-id="85cb3-155">These functions also require bitblt model updates for GDI and Direct3D content.</span></span> <span data-ttu-id="85cb3-156">Приложения, использующие какую-либо функцию, не обязательно будут отображать видимое содержимое окна при прокрутке экрана, когда приложение находится в оконном режиме.</span><span class="sxs-lookup"><span data-stu-id="85cb3-156">Apps that use either function will not necessarily display visible window contents scrolling on screen when the app is in windowed mode.</span></span> <span data-ttu-id="85cb3-157">Не рекомендуется использовать функции **скроллвиндов** и **скроллвиндовекс** GDI, а вместо этого перерисовывать содержимое GDI и Direct3D на экране в ответ на прокрутку.</span><span class="sxs-lookup"><span data-stu-id="85cb3-157">We recommend that you not use GDI's **ScrollWindow** and **ScrollWindowEx** functions, and instead redraw GDI and Direct3D contents on screen in response to scrolling.</span></span>
-   <span data-ttu-id="85cb3-158">Используйте в [**HWND**](../winprog/windows-data-types.md) модель отражения, которая не предназначена для других API, включая модель представления DXGI BitBlt, другие версии Direct3D или GDI.</span><span class="sxs-lookup"><span data-stu-id="85cb3-158">Use flip model in an [**HWND**](../winprog/windows-data-types.md) that is not also targeted by other APIs, including DXGI bitblt presentation model, other versions of Direct3D, or GDI.</span></span> <span data-ttu-id="85cb3-159">Так как модель BitBlt поддерживает дополнительную копию поверхности, вы можете добавить GDI и другое содержимое Direct3D в тот же **HWND** с помощью поэтапного обновления из Direct3D и GDI.</span><span class="sxs-lookup"><span data-stu-id="85cb3-159">Because bitblt model maintains an additional copy of the surface, you can add GDI and other Direct3D contents to the same **HWND** through piecemeal updates from Direct3D and GDI.</span></span> <span data-ttu-id="85cb3-160">Если используется модель перелистывания, видимы только содержимое Direct3D в цепочках перелистывания моделей, которые среда выполнения передает в DWM.</span><span class="sxs-lookup"><span data-stu-id="85cb3-160">When you use the flip model, only Direct3D content in flip model swap chains that the runtime passes to DWM are visible.</span></span> <span data-ttu-id="85cb3-161">Среда выполнения игнорирует все остальные обновления содержимого BitBlt модели Direct3D или GDI.</span><span class="sxs-lookup"><span data-stu-id="85cb3-161">The runtime ignores all other bitblt model Direct3D or GDI content updates.</span></span>

## <a name="frame-synchronization-of-dxgi-flip-model-apps"></a><span data-ttu-id="85cb3-162">Синхронизация кадров для приложений модели перелистывания DXGI</span><span class="sxs-lookup"><span data-stu-id="85cb3-162">Frame synchronization of DXGI flip model apps</span></span>

<span data-ttu-id="85cb3-163">Представленная статистика представляет собой сведения о времени кадров, которые используются приложениями мультимедиа для синхронизации видео-и звуковых потоков и восстановления после сбоев воспроизведения видео.</span><span class="sxs-lookup"><span data-stu-id="85cb3-163">Present statistics are frame-timing information that media apps use to synchronize video and audio streams and recover from video playback glitches.</span></span> <span data-ttu-id="85cb3-164">Приложения могут использовать сведения о времени кадров в представленной статистике, чтобы настроить интенсивность представления видеокадров для более гладких презентаций.</span><span class="sxs-lookup"><span data-stu-id="85cb3-164">Apps can use the frame-timing information in present statistics to adjust the presentation rate of their video frames for smoother presentation.</span></span> <span data-ttu-id="85cb3-165">Чтобы получить данные статистики, вызовите метод [**идксгисвапчаин:: жетфраместатистикс**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getframestatistics) , чтобы получить структуру [**\_ \_ статистики кадра DXGI**](/windows/desktop/api/DXGI/ns-dxgi-dxgi_frame_statistics) .</span><span class="sxs-lookup"><span data-stu-id="85cb3-165">To obtain present statistics information, call the [**IDXGISwapChain::GetFrameStatistics**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getframestatistics) method to obtain the [**DXGI\_FRAME\_STATISTICS**](/windows/desktop/api/DXGI/ns-dxgi-dxgi_frame_statistics) structure.</span></span> <span data-ttu-id="85cb3-166">**DXGI \_ \_Статистика по кадрам** содержит статистику о вызовах [**IDXGISwapChain1::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) .</span><span class="sxs-lookup"><span data-stu-id="85cb3-166">**DXGI\_FRAME\_STATISTICS** contains statistics about [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) calls.</span></span> <span data-ttu-id="85cb3-167">Цепочка перелистывания моделей предоставляет данные статистики как в оконном, так и в полноэкранном режиме.</span><span class="sxs-lookup"><span data-stu-id="85cb3-167">A flip model swap chain provides present statistics information in both windowed and full-screen modes.</span></span> <span data-ttu-id="85cb3-168">Для цепочек переключения моделей BitBlt в оконном режиме все **значения \_ \_ статистики кадров DXGI** являются нулями.</span><span class="sxs-lookup"><span data-stu-id="85cb3-168">For bitblt model swap chains in windowed mode, all **DXGI\_FRAME\_STATISTICS** values are zeroes.</span></span>

<span data-ttu-id="85cb3-169">Для статистики, представленной в модели отражения, [**идксгисвапчаин:: жетфраместатистикс**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getframestatistics) возвращает несвязанную **\_ \_ \_ статистику кадра \_ ошибок DXGI** в следующих ситуациях:</span><span class="sxs-lookup"><span data-stu-id="85cb3-169">For flip model present statistics, [**IDXGISwapChain::GetFrameStatistics**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getframestatistics) returns **DXGI\_ERROR\_FRAME\_STATISTICS\_DISJOINT** in these situations:</span></span>

-   <span data-ttu-id="85cb3-170">Первый вызов [**жетфраместатистикс**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getframestatistics), который указывает начало последовательности</span><span class="sxs-lookup"><span data-stu-id="85cb3-170">First call to [**GetFrameStatistics**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getframestatistics), which indicates the beginning of a sequence</span></span>
-   <span data-ttu-id="85cb3-171">Изменение режима: в оконном режиме на весь экран или из полноэкранного режима до полноэкранных переходов</span><span class="sxs-lookup"><span data-stu-id="85cb3-171">Mode change: either windowed mode to or from full screen or full screen to full screen transitions</span></span>

<span data-ttu-id="85cb3-172">Значения в **пресентрефрешкаунт**, **синкрефрешкаунт** и **синккпктиме** , входящие в [**\_ \_ статистику кадра DXGI**](/windows/desktop/api/DXGI/ns-dxgi-dxgi_frame_statistics) , имеют следующие характеристики.</span><span class="sxs-lookup"><span data-stu-id="85cb3-172">The values in **PresentRefreshCount**, **SyncRefreshCount**, and **SyncQPCTime** members of [**DXGI\_FRAME\_STATISTICS**](/windows/desktop/api/DXGI/ns-dxgi-dxgi_frame_statistics) have the following characteristics:</span></span>

-   <span data-ttu-id="85cb3-173">**Пресентрефрешкаунт** равно **синкрефрешкаунт** , когда приложение представлено на каждом вертикальной синхронизации.</span><span class="sxs-lookup"><span data-stu-id="85cb3-173">**PresentRefreshCount** is equal to **SyncRefreshCount** when the app presents on every vsync.</span></span>
-   <span data-ttu-id="85cb3-174">**Синкрефрешкаунт** получается в интервале вертикальной синхронизации, когда предпринята передача, **синккпктиме** приблизительно соответствует времени, связанному с интервалом вертикальной синхронизации.</span><span class="sxs-lookup"><span data-stu-id="85cb3-174">**SyncRefreshCount** is obtained on the vsync interval when the present was submitted, **SyncQPCTime** is approximately the time associated with the vsync interval.</span></span>

<span data-ttu-id="85cb3-175">Метод [**идксгисвапчаин:: жетластпресенткаунт**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getlastpresentcount) возвращает последнее текущее количество, то есть текущий идентификатор последнего успешного вызова [**IDXGISwapChain1::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) , сделанного устройством отображения, связанным с цепочкой буферов.</span><span class="sxs-lookup"><span data-stu-id="85cb3-175">The [**IDXGISwapChain::GetLastPresentCount**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getlastpresentcount) method returns the last present count, that is, the present ID of the last successful [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) call made by a display device that is associated with the swap chain.</span></span> <span data-ttu-id="85cb3-176">Этот идентификатор является значением элемента **пресенткаунт** в структуре [**\_ \_ статистики кадра DXGI**](/windows/desktop/api/DXGI/ns-dxgi-dxgi_frame_statistics) .</span><span class="sxs-lookup"><span data-stu-id="85cb3-176">This present ID is the value of the **PresentCount** member of the [**DXGI\_FRAME\_STATISTICS**](/windows/desktop/api/DXGI/ns-dxgi-dxgi_frame_statistics) structure.</span></span> <span data-ttu-id="85cb3-177">Для цепочек переключения модели BitBlt в оконном режиме все значения **\_ \_ статистики кадров DXGI** являются нулями.</span><span class="sxs-lookup"><span data-stu-id="85cb3-177">For bitblt model swap chains, while in windowed mode, all **DXGI\_FRAME\_STATISTICS** values are zeroes.</span></span>

## <a name="avoiding-detecting-and-recovering-from-glitches"></a><span data-ttu-id="85cb3-178">Предотвращение, обнаружение и восстановление после сбоев</span><span class="sxs-lookup"><span data-stu-id="85cb3-178">Avoiding, detecting, and recovering from glitches</span></span>

<span data-ttu-id="85cb3-179">Выполните следующие действия, чтобы избежать, обнаружить и восстановить данные о сбоях в кадре.</span><span class="sxs-lookup"><span data-stu-id="85cb3-179">Perform these steps to avoid, detect, and recover from glitches in frame presentation:</span></span>

1.  <span data-ttu-id="85cb3-180">Queue [**IDXGISwapChain1::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) вызовы (то есть вызывают **IDXGISwapChain1::P resent1** несколько раз, что приводит к их сопоставлению в очереди).</span><span class="sxs-lookup"><span data-stu-id="85cb3-180">Queue [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) calls (that is, call **IDXGISwapChain1::Present1** multiple times, which causes them to collect in a queue).</span></span>
2.  <span data-ttu-id="85cb3-181">Создайте структуру представления очереди для хранения всех успешно отправленных [**IDXGISwapChain1::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1)(возвращенных [**Идксгисвапчаин:: жетластпресенткаунт**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getlastpresentcount)) и связанных, вычисляемых/ожидаемых **пресентрефрешкаунт** значений.</span><span class="sxs-lookup"><span data-stu-id="85cb3-181">Create a present-queue structure to store all successfully submitted [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1)'s present ID (returned by [**IDXGISwapChain::GetLastPresentCount**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getlastpresentcount)) and associated, calculated/expected **PresentRefreshCount** values.</span></span>
3.  <span data-ttu-id="85cb3-182">Чтобы обнаружить сбой, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="85cb3-182">To detect a glitch:</span></span>

    -   <span data-ttu-id="85cb3-183">Вызовите [**идксгисвапчаин:: жетфраместатистикс**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getframestatistics).</span><span class="sxs-lookup"><span data-stu-id="85cb3-183">Call [**IDXGISwapChain::GetFrameStatistics**](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-getframestatistics).</span></span>
    -   <span data-ttu-id="85cb3-184">Для этого кадра получите текущий идентификатор (**пресенткаунт**) и число вертикальной синхронизации, где операционная система предвидит последний образ на мониторе (**пресентрефрешкаунт**).</span><span class="sxs-lookup"><span data-stu-id="85cb3-184">For this frame, get the present ID (**PresentCount**) and vsync count where the operating system presented the last image to the monitor (**PresentRefreshCount**).</span></span>
    -   <span data-ttu-id="85cb3-185">Получите ожидаемый **пресентрефрешкаунт** , связанный с текущим идентификатором и сохраненный ранее в структуре представления очереди.</span><span class="sxs-lookup"><span data-stu-id="85cb3-185">Retrieve the expected **PresentRefreshCount** that is associated with the present ID and that you previously stored in the present-queue structure.</span></span>
    -   <span data-ttu-id="85cb3-186">Если фактический **пресентрефрешкаунт** позже ожидаемого **пресентрефрешкаунт**, произошла ошибка.</span><span class="sxs-lookup"><span data-stu-id="85cb3-186">If the actual **PresentRefreshCount** is later than the expected **PresentRefreshCount**, a glitch has occurred.</span></span>

4.  <span data-ttu-id="85cb3-187">Чтобы устранить сбой, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="85cb3-187">To recover from the glitch:</span></span>

    -   <span data-ttu-id="85cb3-188">Вычислите количество кадров, которые нужно пропустить для восстановления после сбоя.</span><span class="sxs-lookup"><span data-stu-id="85cb3-188">Calculate the number of frames to skip to recover from the glitch.</span></span> <span data-ttu-id="85cb3-189">Например, если на шаге 3 показано, что ожидаемое число вертикальной синхронизации (**пресентрефрешкаунт**) для текущего идентификатора (**пресенткаунт**) равно 5, а фактическое число вертикальной синхронизации для текущего идентификатора равно 8, число кадров, которое нужно пропустить для восстановления после сбоя, равно трем кадрам.</span><span class="sxs-lookup"><span data-stu-id="85cb3-189">For example, if step 3 reveals that the expected vsync count (**PresentRefreshCount**) for a present ID (**PresentCount**) is 5 and the actual vsync count for the present ID is 8, the number of frames to skip to recover from the glitch is 3 frames.</span></span>
    -   <span data-ttu-id="85cb3-190">Передайте 0 в параметр *синЦинтервал* в этом количестве вызовов [**IDXGISwapChain1::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) для удаления и пропуска этого числа кадров.</span><span class="sxs-lookup"><span data-stu-id="85cb3-190">Pass 0 to the *SyncInterval* parameter in this number of calls to [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) to discard and skip this number of frames.</span></span>

        > [!Note]  
        > <span data-ttu-id="85cb3-191">Если сбой состоит из большого числа кадров, вызовите [**IDXGISwapChain1::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) с параметром *flags* , установленным в [**DXGI \_ Present \_ restart**](dxgi-present.md) для удаления и пропуска всех невыполненных операций в очереди.</span><span class="sxs-lookup"><span data-stu-id="85cb3-191">If the glitch consists of a large number of frames, call [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) with the *Flags* parameter set to [**DXGI\_PRESENT\_RESTART**](dxgi-present.md) to discard and skip all outstanding queued presents.</span></span>

         

<span data-ttu-id="85cb3-192">Ниже приведен пример сценария восстановления после сбоев в представлении кадров.</span><span class="sxs-lookup"><span data-stu-id="85cb3-192">Here is an example scenario of recovering from glitches in frame presentation:</span></span>

![Иллюстрация примера сценария восстановления после сбоев в представлении кадров](images/frame-sync-glitch-recover.png)

<span data-ttu-id="85cb3-194">В примере сценария предполагается, что кадр а переходит на экран с числом вертикальной синхронизации, равным 1.</span><span class="sxs-lookup"><span data-stu-id="85cb3-194">In the example scenario, you expect frame A to go on screen on a vsync count of 1.</span></span> <span data-ttu-id="85cb3-195">Но на самом деле вы обнаружите число вертикальной синхронизации, которое кадр A отобразит на экране как 4.</span><span class="sxs-lookup"><span data-stu-id="85cb3-195">But you actually detect the vsync count that frame A appears on screen as 4.</span></span> <span data-ttu-id="85cb3-196">Поэтому вы определяете, что произошел сбой.</span><span class="sxs-lookup"><span data-stu-id="85cb3-196">Therefore, you determine that a glitch occurred.</span></span> <span data-ttu-id="85cb3-197">Затем можно удалить 3 кадра, то есть можно передать значение 0 в параметр *синЦинтервал* в 3 вызовах [**IDXGISwapChain1::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1).</span><span class="sxs-lookup"><span data-stu-id="85cb3-197">You can then discard 3 frames, that is, you can pass 0 to the *SyncInterval* parameter in 3 calls to [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1).</span></span> <span data-ttu-id="85cb3-198">В предыдущем примере сценария для восстановления после сбоя необходимо всего 8 **IDXGISwapChain1::P resent1ных** вызовов.</span><span class="sxs-lookup"><span data-stu-id="85cb3-198">In the preceding example scenario, to recover from the glitch, you need a total of 8 **IDXGISwapChain1::Present1** calls.</span></span> <span data-ttu-id="85cb3-199">Затем 9-й кадр отображается в соответствии с предполагаемым числом вертикальной синхронизации.</span><span class="sxs-lookup"><span data-stu-id="85cb3-199">The 9th frame is then visible as per the vsync count that you expect.</span></span>

<span data-ttu-id="85cb3-200">Ниже приведена временная шкала событий презентации.</span><span class="sxs-lookup"><span data-stu-id="85cb3-200">Here's a time line of presentation events.</span></span> <span data-ttu-id="85cb3-201">Каждая вертикальная линия представляет вертикальной синхронизации.</span><span class="sxs-lookup"><span data-stu-id="85cb3-201">Each vertical line represents a vsync.</span></span> <span data-ttu-id="85cb3-202">Горизонтальное направление — время, которое увеличивается вправо.</span><span class="sxs-lookup"><span data-stu-id="85cb3-202">The horizontal direction is time, which increases to the right.</span></span> <span data-ttu-id="85cb3-203">Чтобы представить, как могут возникать проблемы, можно использовать рисунок.</span><span class="sxs-lookup"><span data-stu-id="85cb3-203">You can use the figure to imagine how glitches can occur.</span></span>

![Иллюстрация временной шкалы событий презентации](images/present-timeline.png)

<span data-ttu-id="85cb3-205">Эта последовательность показана на рисунке.</span><span class="sxs-lookup"><span data-stu-id="85cb3-205">The figure illustrates this sequence:</span></span>

1.  <span data-ttu-id="85cb3-206">Приложение выводится из спящего режима на вертикальной синхронизации, отображает синий, вызывает [**IDXGISwapChain1::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1), а затем возвращается в спящий режим.</span><span class="sxs-lookup"><span data-stu-id="85cb3-206">The app wakes up on vsync, renders blue, calls [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1), and then goes back to sleep.</span></span>
2.  <span data-ttu-id="85cb3-207">Графический процессор (GPU) выходит из режима простоя, выполняет визуализацию синим цветом, а затем возвращается в спящий режим.</span><span class="sxs-lookup"><span data-stu-id="85cb3-207">The graphics processing unit (GPU) wakes up from idle, performs the render to blue, and then goes back to sleep.</span></span>
3.  <span data-ttu-id="85cb3-208">DWM выходит из спящего режима в следующий вертикальной синхронизации, переводит синий в задний буфер, вызывает [**IDXGISwapChain1::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1), а затем возвращается в спящий режим.</span><span class="sxs-lookup"><span data-stu-id="85cb3-208">The DWM wakes up at the next vsync, composes blue into its back buffer, calls [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1), and then goes back to sleep.</span></span>
4.  <span data-ttu-id="85cb3-209">Приложение выходит из спящего режима, выводит зеленую сторону, вызывает [**IDXGISwapChain1::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1), а затем возвращается в спящий режим.</span><span class="sxs-lookup"><span data-stu-id="85cb3-209">The app wakes up, renders green, calls [**IDXGISwapChain1::Present1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1), and then goes back to sleep.</span></span>
    > [!Note]  
    > <span data-ttu-id="85cb3-210">Приложение выполняется параллельно, пока GPU выполняет композицию синего цвета.</span><span class="sxs-lookup"><span data-stu-id="85cb3-210">The app concurrently executes while the GPU performs the compose of blue.</span></span>

     

5.  <span data-ttu-id="85cb3-211">Затем GPU отображает зеленый цвет для приложения.</span><span class="sxs-lookup"><span data-stu-id="85cb3-211">Next, the GPU renders green for the app.</span></span>
6.  <span data-ttu-id="85cb3-212">Наконец, средство Digital to аналоговый Converter (DAC) отображает результаты композиции DWM на мониторе на следующем вертикальной синхронизации.</span><span class="sxs-lookup"><span data-stu-id="85cb3-212">Finally, the digital to analog converter (DAC) shows results of the DWM composition on the monitor on the next vsync.</span></span>

<span data-ttu-id="85cb3-213">С временной шкалы можно представить задержку представления статистики и способ возникновения сбоев.</span><span class="sxs-lookup"><span data-stu-id="85cb3-213">From the time line, you can imagine the latency of present statistics and how glitches can occur.</span></span> <span data-ttu-id="85cb3-214">Например, чтобы отобразить сбой DWM для зеленого цвета, отображаемого на экране, представьте расширяющее зеленое/красное поле таким образом, чтобы правая сторона зеленой/красной рамки совпадала с правой стороной фиолетового/красного прямоугольника.</span><span class="sxs-lookup"><span data-stu-id="85cb3-214">For example, to show a DWM glitch for the green color appearing on screen, imagine widening the green/red box so that the right side of the green/red box matches up to the right side of the purple/red box.</span></span> <span data-ttu-id="85cb3-215">В этом сценарии DAC отображает два фрагмента синего, а затем зеленый кадр.</span><span class="sxs-lookup"><span data-stu-id="85cb3-215">In this scenario, the DAC shows two frames of blue and then the green frame.</span></span> <span data-ttu-id="85cb3-216">Вы видите, что эта ошибка возникла при чтении текущей статистики.</span><span class="sxs-lookup"><span data-stu-id="85cb3-216">You can see that this glitch occurred from reading present statistics.</span></span>

## <a name="related-topics"></a><span data-ttu-id="85cb3-217">См. также</span><span class="sxs-lookup"><span data-stu-id="85cb3-217">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="85cb3-218">Улучшение представления с помощью модели перелистывания, "грязных" прямоугольников и областей с прокруткой</span><span class="sxs-lookup"><span data-stu-id="85cb3-218">Enhancing presentation with the flip model, dirty rectangles, and scrolled areas</span></span>](dxgi-1-2-presentation-improvements.md)
</dt> </dl>

 

 
