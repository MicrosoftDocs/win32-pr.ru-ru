---
description: В этом разделе содержатся следующие подразделы.
ms.assetid: 0522ccbf-e754-470a-8199-004fcbaa927d
title: Общие сведения о DXGI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 324a5be26aade17385a6ab0b7d347015497a2a3f
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104494568"
---
# <a name="dxgi-overview"></a><span data-ttu-id="2b38a-103">Общие сведения о DXGI</span><span class="sxs-lookup"><span data-stu-id="2b38a-103">DXGI overview</span></span>

<span data-ttu-id="2b38a-104">Графическая инфраструктура Microsoft DirectX (DXGI) распознает, что некоторые части графики развиваются медленнее, чем другие.</span><span class="sxs-lookup"><span data-stu-id="2b38a-104">Microsoft DirectX Graphics Infrastructure (DXGI) recognizes that some parts of graphics evolve more slowly than others.</span></span> <span data-ttu-id="2b38a-105">Основной целью DXGI является управление задачами низкого уровня, которые могут быть независимыми от среды DirectX Graphics.</span><span class="sxs-lookup"><span data-stu-id="2b38a-105">The primary goal of DXGI is to manage low-level tasks that can be independent of the DirectX graphics runtime.</span></span> <span data-ttu-id="2b38a-106">DXGI предоставляет общую платформу для будущих графических компонентов; Первый компонент, использующий версию DXGI, — это Microsoft Direct3D 10.</span><span class="sxs-lookup"><span data-stu-id="2b38a-106">DXGI provides a common framework for future graphics components; the first component that takes advantage of DXGI is Microsoft Direct3D 10.</span></span>

<span data-ttu-id="2b38a-107">В предыдущих версиях Direct3D задачи низкого уровня, такие как перечисление аппаратных устройств, отображение кадров в выход, контроль гаммы и управление полноэкранным переходом были добавлены в среду выполнения Direct3D.</span><span class="sxs-lookup"><span data-stu-id="2b38a-107">In previous versions of Direct3D, low-level tasks like enumeration of hardware devices, presenting rendered frames to an output, controlling gamma, and managing a full-screen transition were included in the Direct3D runtime.</span></span> <span data-ttu-id="2b38a-108">Эти задачи теперь реализуются в DXGI.</span><span class="sxs-lookup"><span data-stu-id="2b38a-108">These tasks are now implemented in DXGI.</span></span>

<span data-ttu-id="2b38a-109">Цель DXGI заключается в взаимодействии с драйвером режима ядра и аппаратным обеспечением системы, как показано на следующей схеме.</span><span class="sxs-lookup"><span data-stu-id="2b38a-109">DXGI's purpose is to communicate with the kernel mode driver and the system hardware, as shown in the following diagram.</span></span>

![Схема обмена данными между приложениями, DXGI, драйверами и оборудованием](images/dxgi-dll.png)

<span data-ttu-id="2b38a-111">Приложение может напрямую обращаться к DXGI или вызывать API-интерфейсы Direct3D в D3D11 \_ 1. h, D3D11. h, D3D10 \_ 1. h или D3D10. h, который обрабатывает обмен данными с DXGI.</span><span class="sxs-lookup"><span data-stu-id="2b38a-111">An application can access DXGI directly, or call the Direct3D APIs in D3D11\_1.h, D3D11.h, D3D10\_1.h, or D3D10.h, which handles the communications with DXGI for you.</span></span> <span data-ttu-id="2b38a-112">Вы можете работать с DXGI напрямую, если приложению требуется перечислить устройства или управлять способом представления данных для вывода.</span><span class="sxs-lookup"><span data-stu-id="2b38a-112">You may want to work with DXGI directly if your application needs to enumerate devices or control how data is presented to an output.</span></span>

<span data-ttu-id="2b38a-113">В этом разделе содержатся следующие подразделы.</span><span class="sxs-lookup"><span data-stu-id="2b38a-113">This topic contains the following sections.</span></span>

-   [<span data-ttu-id="2b38a-114">Перечисление адаптеров</span><span class="sxs-lookup"><span data-stu-id="2b38a-114">Enumerating Adapters</span></span>](#enumerating-adapters)
    -   [<span data-ttu-id="2b38a-115">Новые сведения о перечислении адаптеров для Windows 8</span><span class="sxs-lookup"><span data-stu-id="2b38a-115">New info about enumerating adapters for Windows 8</span></span>](#new-info-about-enumerating-adapters-for-windows-8)
-   [<span data-ttu-id="2b38a-116">Уровень представления</span><span class="sxs-lookup"><span data-stu-id="2b38a-116">Presentation</span></span>](#presentation)
    -   [<span data-ttu-id="2b38a-117">Создание цепочки буферов</span><span class="sxs-lookup"><span data-stu-id="2b38a-117">Create a Swap Chain</span></span>](#create-a-swap-chain)
    -   [<span data-ttu-id="2b38a-118">Отслеживание и подача цепочки буферов обмена</span><span class="sxs-lookup"><span data-stu-id="2b38a-118">Care and Feeding of the Swap Chain</span></span>](#care-and-feeding-of-the-swap-chain)
    -   [<span data-ttu-id="2b38a-119">Обработка изменения размера окна</span><span class="sxs-lookup"><span data-stu-id="2b38a-119">Handling Window Resizing</span></span>](#handling-window-resizing)
    -   [<span data-ttu-id="2b38a-120">Выбор выходных и размеров DXGI</span><span class="sxs-lookup"><span data-stu-id="2b38a-120">Choosing the DXGI Output and Size</span></span>](#choosing-the-dxgi-output-and-size)
    -   [<span data-ttu-id="2b38a-121">Отладка в режиме Full-Screen</span><span class="sxs-lookup"><span data-stu-id="2b38a-121">Debugging in Full-Screen Mode</span></span>](#debugging-in-full-screen-mode)
    -   [<span data-ttu-id="2b38a-122">Уничтожение цепочки буферов</span><span class="sxs-lookup"><span data-stu-id="2b38a-122">Destroying a Swap Chain</span></span>](#destroying-a-swap-chain)
    -   [<span data-ttu-id="2b38a-123">Использование повернутого монитора</span><span class="sxs-lookup"><span data-stu-id="2b38a-123">Using a Rotated Monitor</span></span>](#using-a-rotated-monitor)
    -   [<span data-ttu-id="2b38a-124">Переключение режимов</span><span class="sxs-lookup"><span data-stu-id="2b38a-124">Switching Modes</span></span>](#switching-modes)
    -   [<span data-ttu-id="2b38a-125">Советы по повышению производительности в полноэкранном режиме</span><span class="sxs-lookup"><span data-stu-id="2b38a-125">Full-Screen Performance Tip</span></span>](#full-screen-performance-tip)
    -   [<span data-ttu-id="2b38a-126">Вопросы многопоточности</span><span class="sxs-lookup"><span data-stu-id="2b38a-126">Multithread Considerations</span></span>](#multithread-considerations)
-   [<span data-ttu-id="2b38a-127">Ответы DXGI из DLLMain</span><span class="sxs-lookup"><span data-stu-id="2b38a-127">DXGI Responses from DLLMain</span></span>](#dxgi-responses-from-dllmain)
-   [<span data-ttu-id="2b38a-128">Изменения DXGI 1,1</span><span class="sxs-lookup"><span data-stu-id="2b38a-128">DXGI 1.1 Changes</span></span>](#dxgi-11-changes)
-   [<span data-ttu-id="2b38a-129">Изменения DXGI 1,2</span><span class="sxs-lookup"><span data-stu-id="2b38a-129">DXGI 1.2 Changes</span></span>](#dxgi-12-changes)
-   [<span data-ttu-id="2b38a-130">См. также</span><span class="sxs-lookup"><span data-stu-id="2b38a-130">Related topics</span></span>](#related-topics)

<span data-ttu-id="2b38a-131">Чтобы узнать, какие форматы поддерживаются оборудованием Direct3D 11:</span><span class="sxs-lookup"><span data-stu-id="2b38a-131">To see which formats are supported by Direct3D 11 hardware:</span></span>

-   [<span data-ttu-id="2b38a-132">Поддержка формата DXGI для оборудования уровня компонентов Direct3D 12,1</span><span class="sxs-lookup"><span data-stu-id="2b38a-132">DXGI Format Support for Direct3D Feature Level 12.1 Hardware</span></span>](hardware-support-for-direct3d-12-1-formats.md)
-   [<span data-ttu-id="2b38a-133">Поддержка формата DXGI для оборудования уровня компонентов Direct3D 12,0</span><span class="sxs-lookup"><span data-stu-id="2b38a-133">DXGI Format Support for Direct3D Feature Level 12.0 Hardware</span></span>](hardware-support-for-direct3d-12-0-formats.md)
-   [<span data-ttu-id="2b38a-134">Поддержка формата DXGI для оборудования уровня компонентов Direct3D 11,1</span><span class="sxs-lookup"><span data-stu-id="2b38a-134">DXGI Format Support for Direct3D Feature Level 11.1 Hardware</span></span>](format-support-for-direct3d-11-1-feature-level-hardware.md)
-   [<span data-ttu-id="2b38a-135">Поддержка формата DXGI для оборудования уровня компонентов Direct3D 11,0</span><span class="sxs-lookup"><span data-stu-id="2b38a-135">DXGI Format Support for Direct3D Feature Level 11.0 Hardware</span></span>](format-support-for-direct3d-11-0-feature-level-hardware.md)
-   <span data-ttu-id="2b38a-136">[Аппаратная поддержка форматов Direct3D 10Level9](/previous-versions//ff471324(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="2b38a-136">[Hardware Support for Direct3D 10Level9 Formats](/previous-versions//ff471324(v=vs.85))</span></span>
-   <span data-ttu-id="2b38a-137">[Аппаратная поддержка форматов Direct3D 10,1](/previous-versions//cc627091(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="2b38a-137">[Hardware Support for Direct3D 10.1 Formats](/previous-versions//cc627091(v=vs.85))</span></span>
-   <span data-ttu-id="2b38a-138">[Поддержка оборудования для форматов Direct3D 10](/previous-versions//cc627090(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="2b38a-138">[Hardware Support for Direct3D 10 Formats](/previous-versions//cc627090(v=vs.85))</span></span>

## <a name="enumerating-adapters"></a><span data-ttu-id="2b38a-139">Перечисление адаптеров</span><span class="sxs-lookup"><span data-stu-id="2b38a-139">Enumerating adapters</span></span>

<span data-ttu-id="2b38a-140">Адаптер представляет собой абстракцию оборудования и программного обеспечения компьютера.</span><span class="sxs-lookup"><span data-stu-id="2b38a-140">An adapter is an abstraction of the hardware and the software capability of your computer.</span></span> <span data-ttu-id="2b38a-141">На компьютере обычно используется множество адаптеров.</span><span class="sxs-lookup"><span data-stu-id="2b38a-141">There are generally many adapters on your machine.</span></span> <span data-ttu-id="2b38a-142">Некоторые устройства реализуются на оборудовании (например, на видеоадаптере), а некоторые — в программном обеспечении (например, средство программной прорисовки для Direct3D).</span><span class="sxs-lookup"><span data-stu-id="2b38a-142">Some devices are implemented in hardware (like your video card) and some are implemented in software (like the Direct3D reference rasterizer).</span></span> <span data-ttu-id="2b38a-143">Адаптеры реализуют функциональные возможности, используемые графическим приложением.</span><span class="sxs-lookup"><span data-stu-id="2b38a-143">Adapters implement functionality used by a graphic application.</span></span> <span data-ttu-id="2b38a-144">На следующей диаграмме показана система с одним компьютером, двумя адаптерами (видеоадаптеры) и тремя мониторами вывода.</span><span class="sxs-lookup"><span data-stu-id="2b38a-144">The following diagram shows a system with a single computer, two adapters (video cards), and three output monitors.</span></span>

![Схема компьютера с двумя видеоадаптерами и тремя мониторами](images/dxgi-terms.png)

<span data-ttu-id="2b38a-146">При перечислении этих компонентов оборудования DXGI создает интерфейс [**IDXGIOutput1**](/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgioutput1) для каждого вывода (или монитора) и интерфейса [**IDXGIAdapter2**](/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgiadapter2) для каждого видеоадаптера (даже если это видеоадаптер, встроенный в материнскую плату).</span><span class="sxs-lookup"><span data-stu-id="2b38a-146">When enumerating these pieces of hardware, DXGI creates an [**IDXGIOutput1**](/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgioutput1) interface for each output (or monitor) and an [**IDXGIAdapter2**](/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgiadapter2) interface for each video card (even if it is a video card built into a motherboard).</span></span> <span data-ttu-id="2b38a-147">Перечисление выполняется с помощью вызова интерфейса [**идксгифактори**](/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgifactory2) , [**Идксгифактори:: енумадаптерс**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory-enumadapters), чтобы получить набор интерфейсов [**идксгиадаптер**](/windows/win32/api/DXGI/nn-dxgi-idxgiadapter) , представляющих оборудование видео.</span><span class="sxs-lookup"><span data-stu-id="2b38a-147">Enumeration is done by using an [**IDXGIFactory**](/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgifactory2) interface call, [**IDXGIFactory::EnumAdapters**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory-enumadapters), to return a set of [**IDXGIAdapter**](/windows/win32/api/DXGI/nn-dxgi-idxgiadapter) interfaces that represent the video hardware.</span></span>

<span data-ttu-id="2b38a-148">В DXGI 1,1 добавлен интерфейс [**IDXGIFactory1**](/windows/win32/api/DXGI/nn-dxgi-idxgifactory1) .</span><span class="sxs-lookup"><span data-stu-id="2b38a-148">DXGI 1.1 added the [**IDXGIFactory1**](/windows/win32/api/DXGI/nn-dxgi-idxgifactory1) interface.</span></span> <span data-ttu-id="2b38a-149">[**IDXGIFactory1:: EnumAdapters1**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory1-enumadapters1) возвращает набор интерфейсов [**IDXGIAdapter1**](/windows/win32/api/DXGI/nn-dxgi-idxgiadapter1) , представляющих оборудование видео.</span><span class="sxs-lookup"><span data-stu-id="2b38a-149">[**IDXGIFactory1::EnumAdapters1**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory1-enumadapters1) returns a set of [**IDXGIAdapter1**](/windows/win32/api/DXGI/nn-dxgi-idxgiadapter1) interfaces that represents the video hardware.</span></span>

<span data-ttu-id="2b38a-150">Если вы хотите выбрать определенные возможности видеооборудования при использовании интерфейсов API Direct3D, мы рекомендуем итеративно вызывать функцию [**D3D11CreateDevice**](/windows/win32/api/d3d11/nf-d3d11-d3d11createdevice) или [**D3D11CreateDeviceAndSwapChain**](/windows/win32/api/d3d11/nf-d3d11-d3d11createdeviceandswapchain) с каждым маркером адаптера и возможным [уровнем компонентов](../direct3d11/overviews-direct3d-11-devices-downlevel-intro.md)оборудования.</span><span class="sxs-lookup"><span data-stu-id="2b38a-150">If you want to select specific video hardware capabilities when you use Direct3D APIs, we recommend that you iteratively call the [**D3D11CreateDevice**](/windows/win32/api/d3d11/nf-d3d11-d3d11createdevice) or [**D3D11CreateDeviceAndSwapChain**](/windows/win32/api/d3d11/nf-d3d11-d3d11createdeviceandswapchain) function with each adapter handle and possible hardware [feature level](../direct3d11/overviews-direct3d-11-devices-downlevel-intro.md).</span></span> <span data-ttu-id="2b38a-151">Эта функция будет выполнена, если уровень компонента поддерживается указанным адаптером.</span><span class="sxs-lookup"><span data-stu-id="2b38a-151">This function succeeds if the feature level is supported by the specified adapter.</span></span>

### <a name="new-info-about-enumerating-adapters-for-windows-8"></a><span data-ttu-id="2b38a-152">Новые сведения о перечислении адаптеров для Windows 8</span><span class="sxs-lookup"><span data-stu-id="2b38a-152">New info about enumerating adapters for Windows 8</span></span>

<span data-ttu-id="2b38a-153">Начиная с Windows 8, всегда имеется адаптер с именем "базовый драйвер подготовки отчетов (Майкрософт)".</span><span class="sxs-lookup"><span data-stu-id="2b38a-153">Starting with Windows 8, an adapter called the "Microsoft Basic Render Driver" is always present.</span></span> <span data-ttu-id="2b38a-154">Этот адаптер имеет идентификатор поставщика **0x1414** и идентификатор **0x8C**.</span><span class="sxs-lookup"><span data-stu-id="2b38a-154">This adapter has a VendorId of **0x1414** and a DeviceID of **0x8c**.</span></span> <span data-ttu-id="2b38a-155">Этот адаптер также содержит значение [**\_ \_ \_ программного обеспечения флага адаптера DXGI**](/windows/win32/api/dxgi/ne-dxgi-dxgi_adapter_flag) , заданное в элементе **flags** в структуре [**\_ \_ DESC2 адаптера DXGI**](/windows/win32/api/DXGI1_2/ns-dxgi1_2-dxgi_adapter_desc2) .</span><span class="sxs-lookup"><span data-stu-id="2b38a-155">This adapter also has the [**DXGI\_ADAPTER\_FLAG\_SOFTWARE**](/windows/win32/api/dxgi/ne-dxgi-dxgi_adapter_flag) value set in the **Flags** member of its [**DXGI\_ADAPTER\_DESC2**](/windows/win32/api/DXGI1_2/ns-dxgi1_2-dxgi_adapter_desc2) structure.</span></span> <span data-ttu-id="2b38a-156">Этот адаптер является устройством, предназначенным только для просмотра и не имеющим выходных данных вывода.</span><span class="sxs-lookup"><span data-stu-id="2b38a-156">This adapter is a render-only device that has no display outputs.</span></span> <span data-ttu-id="2b38a-157">DXGI никогда не [**возвращает \_ устройство ошибки DXGI, \_ \_ Удаленное**](dxgi-error.md) для этого адаптера.</span><span class="sxs-lookup"><span data-stu-id="2b38a-157">DXGI never returns [**DXGI\_ERROR\_DEVICE\_REMOVED**](dxgi-error.md) for this adapter.</span></span>

<span data-ttu-id="2b38a-158">Если видеодрайвер компьютера не работает или отключен, основной адаптер (**null**) компьютера также может называться "Microsoft базовый драйвер подготовки отчетов".</span><span class="sxs-lookup"><span data-stu-id="2b38a-158">If a computer's display driver is not functioning or is disabled, the computer's primary (**NULL**) adapter might also be called "Microsoft Basic Render Driver."</span></span> <span data-ttu-id="2b38a-159">Но этот адаптер содержит выходные данные и не имеет установленного [**\_ \_ \_ программного значения флага адаптера DXGI**](/windows/win32/api/dxgi/ne-dxgi-dxgi_adapter_flag) .</span><span class="sxs-lookup"><span data-stu-id="2b38a-159">But this adapter has outputs and doesn't have the [**DXGI\_ADAPTER\_FLAG\_SOFTWARE**](/windows/win32/api/dxgi/ne-dxgi-dxgi_adapter_flag) value set.</span></span> <span data-ttu-id="2b38a-160">По умолчанию этот адаптер используется операционной системой и приложениями.</span><span class="sxs-lookup"><span data-stu-id="2b38a-160">The operating system and apps use this adapter by default.</span></span> <span data-ttu-id="2b38a-161">Если драйвер экрана установлен или включен, приложения могут получать устройство с [**\_ ошибкой DXGI \_ , \_ удаленным**](dxgi-error.md) для этого адаптера, а затем повторно перечислять адаптеры.</span><span class="sxs-lookup"><span data-stu-id="2b38a-161">If a display driver is installed or enabled, apps can receive [**DXGI\_ERROR\_DEVICE\_REMOVED**](dxgi-error.md) for this adapter and then must re-enumerate adapters again.</span></span>

<span data-ttu-id="2b38a-162">Если основным видеоадаптером компьютера является адаптер Microsoft Basic (адаптер[деформации](../direct3d11/overviews-direct3d-11-devices-create-warp.md) ), этот компьютер также имеет второй адаптер.</span><span class="sxs-lookup"><span data-stu-id="2b38a-162">When a computer's primary display adapter is the "Microsoft Basic Display Adapter" ([WARP](../direct3d11/overviews-direct3d-11-devices-create-warp.md) adapter), that computer also has a second adapter.</span></span> <span data-ttu-id="2b38a-163">Второй адаптер — это устройство, доступное только для просмотра, не имеющее выходных данных и для которого не возвращается [**\_ \_ устройство \_ с ошибкой DXGI**](dxgi-error.md).</span><span class="sxs-lookup"><span data-stu-id="2b38a-163">This second adapter is the render-only device that has no display outputs and for which DXGI never returns [**DXGI\_ERROR\_DEVICE\_REMOVED**](dxgi-error.md).</span></span>

<span data-ttu-id="2b38a-164">Если вы хотите использовать ДЕФОРМАЦИЯ для отрисовки, вычислений или других длительных задач, рекомендуется использовать устройство, предназначенное только для просмотра.</span><span class="sxs-lookup"><span data-stu-id="2b38a-164">If you want to use WARP for rendering, compute, or other long running tasks, we recommend to use the render-only device.</span></span> <span data-ttu-id="2b38a-165">Чтобы получить указатель на устройство, поддерживающее рендеринг, можно вызвать метод [**IDXGIFactory1:: EnumAdapters1**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory1-enumadapters1) .</span><span class="sxs-lookup"><span data-stu-id="2b38a-165">You can obtain a pointer to the render-only device by calling the [**IDXGIFactory1::EnumAdapters1**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory1-enumadapters1) method.</span></span> <span data-ttu-id="2b38a-166">Кроме того, можно создать устройство, доступное только для просмотра, при указании  [**\_ \_ типа драйвера \_ D3D**](/windows/win32/api/d3dcommon/ne-d3dcommon-d3d_driver_type) в параметре дривертипе [**D3D11CreateDevice**](/windows/win32/api/d3d11/nf-d3d11-d3d11createdevice) , поскольку устройство деформации также использует адаптер искривления только для просмотра.</span><span class="sxs-lookup"><span data-stu-id="2b38a-166">You also create the render-only device when you specify [**D3D\_DRIVER\_TYPE\_WARP**](/windows/win32/api/d3dcommon/ne-d3dcommon-d3d_driver_type) in the *DriverType* parameter of [**D3D11CreateDevice**](/windows/win32/api/d3d11/nf-d3d11-d3d11createdevice) because the WARP device also uses the render-only WARP adapter.</span></span>

## <a name="presentation"></a><span data-ttu-id="2b38a-167">Уровень представления</span><span class="sxs-lookup"><span data-stu-id="2b38a-167">Presentation</span></span>

<span data-ttu-id="2b38a-168">Задание приложения состоит в отображении кадров и постановке DXGI для предоставления этих кадров выходным данным.</span><span class="sxs-lookup"><span data-stu-id="2b38a-168">Your application's job is to render frames and ask DXGI to present those frames to the output.</span></span> <span data-ttu-id="2b38a-169">Если у приложения есть два буфера, он может визуализировать один буфер, одновременно представляя еще один.</span><span class="sxs-lookup"><span data-stu-id="2b38a-169">If the application has two buffers available, it can render one buffer while presenting another one.</span></span> <span data-ttu-id="2b38a-170">Приложению может потребоваться более двух буферов в зависимости от времени, необходимого для отрисовки кадра или желаемой частоты кадров для представления.</span><span class="sxs-lookup"><span data-stu-id="2b38a-170">The application might require more than two buffers depending on the time it takes to render a frame or the desired frame rate for presentation.</span></span> <span data-ttu-id="2b38a-171">Набор созданных буферов называется цепочкой подкачки, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="2b38a-171">The set of buffers created is called a swap chain, as shown here.</span></span>

![Иллюстрация цепочки буферов обмена](images/dxgi-swap-chain.png)

-   [<span data-ttu-id="2b38a-173">Создание цепочки буферов</span><span class="sxs-lookup"><span data-stu-id="2b38a-173">Create a Swap Chain</span></span>](#create-a-swap-chain)
-   [<span data-ttu-id="2b38a-174">Отслеживание и подача цепочки буферов обмена</span><span class="sxs-lookup"><span data-stu-id="2b38a-174">Care and Feeding of the Swap Chain</span></span>](#care-and-feeding-of-the-swap-chain)
-   [<span data-ttu-id="2b38a-175">Обработка изменения размера окна</span><span class="sxs-lookup"><span data-stu-id="2b38a-175">Handling Window Resizing</span></span>](#handling-window-resizing)
-   [<span data-ttu-id="2b38a-176">Выбор выходных и размеров DXGI</span><span class="sxs-lookup"><span data-stu-id="2b38a-176">Choosing the DXGI Output and Size</span></span>](#choosing-the-dxgi-output-and-size)
-   [<span data-ttu-id="2b38a-177">Отладка в режиме Full-Screen</span><span class="sxs-lookup"><span data-stu-id="2b38a-177">Debugging in Full-Screen Mode</span></span>](#debugging-in-full-screen-mode)
-   [<span data-ttu-id="2b38a-178">Уничтожение цепочки буферов</span><span class="sxs-lookup"><span data-stu-id="2b38a-178">Destroying a Swap Chain</span></span>](#destroying-a-swap-chain)
-   [<span data-ttu-id="2b38a-179">Использование повернутого монитора</span><span class="sxs-lookup"><span data-stu-id="2b38a-179">Using a Rotated Monitor</span></span>](#using-a-rotated-monitor)
-   [<span data-ttu-id="2b38a-180">Переключение режимов</span><span class="sxs-lookup"><span data-stu-id="2b38a-180">Switching Modes</span></span>](#switching-modes)
-   [<span data-ttu-id="2b38a-181">Советы по повышению производительности в полноэкранном режиме</span><span class="sxs-lookup"><span data-stu-id="2b38a-181">Full-Screen Performance Tip</span></span>](#full-screen-performance-tip)
-   [<span data-ttu-id="2b38a-182">Вопросы многопоточности</span><span class="sxs-lookup"><span data-stu-id="2b38a-182">Multithread Considerations</span></span>](#multithread-considerations)

<span data-ttu-id="2b38a-183">Цепочка подкачки имеет один интерфейсный буфер и один или несколько задних буферов.</span><span class="sxs-lookup"><span data-stu-id="2b38a-183">A swap chain has one front buffer and one or more back buffers.</span></span> <span data-ttu-id="2b38a-184">Каждое приложение создает собственную цепочку буферов.</span><span class="sxs-lookup"><span data-stu-id="2b38a-184">Each application creates its own swap chain.</span></span> <span data-ttu-id="2b38a-185">Чтобы максимально увеличить скорость представления данных на выходе, цепочка подкачки почти всегда создается в памяти подсистемы отображения, которая показана на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="2b38a-185">To maximize the speed of the presentation of the data to an output, a swap chain is almost always created in the memory of a display sub-system, which is shown in the following illustration.</span></span>

![Иллюстрация подсистемы вывода](images/dxgi-adapter.png)

<span data-ttu-id="2b38a-187">Подсистема просмотра (которая часто является видеоадаптером, но может быть реализована на материнской плате) содержит графический процессор, цифровой и аналоговый конвертер (DAC) и память.</span><span class="sxs-lookup"><span data-stu-id="2b38a-187">The display sub-system (which is often a video card but could be implemented on a motherboard) contains a GPU, a digital to analog converter (DAC), and memory.</span></span> <span data-ttu-id="2b38a-188">Цепочка буферов выделяется в памяти, чтобы сделать презентацию очень быстрой.</span><span class="sxs-lookup"><span data-stu-id="2b38a-188">The swap chain is allocated within this memory to make presentation very fast.</span></span> <span data-ttu-id="2b38a-189">Подсистема отображения предоставляет данные из переднего буфера в выходные данные.</span><span class="sxs-lookup"><span data-stu-id="2b38a-189">The display sub-system presents the data in the front buffer to the output.</span></span>

<span data-ttu-id="2b38a-190">Цепочка подкачки настраивается на прорисовку в полноэкранном или оконном режиме, что позволяет избавиться от необходимости определить, является ли вывод оконным или полноэкранным.</span><span class="sxs-lookup"><span data-stu-id="2b38a-190">A swap chain is set up to draw in full-screen or windowed mode, this eliminates the need to know whether an output is windowed or full screen.</span></span> <span data-ttu-id="2b38a-191">Цепь подкачки в полноэкранном режиме может оптимизировать производительность, переключив разрешение экрана.</span><span class="sxs-lookup"><span data-stu-id="2b38a-191">A full-screen mode swap chain can optimize performance by switching the display resolution.</span></span>

### <a name="create-a-swap-chain"></a><span data-ttu-id="2b38a-192">Создание цепочки буферов</span><span class="sxs-lookup"><span data-stu-id="2b38a-192">Create a swap chain</span></span>

<table>
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="odd">
<td><span data-ttu-id="2b38a-193">Различия между Direct3D 9 и Direct3D 10: Direct3D 10 — это первый компонент графики для использования DXGI.</span><span class="sxs-lookup"><span data-stu-id="2b38a-193">Differences between Direct3D 9 and Direct3D 10: Direct3D 10 is the first graphics component to use DXGI.</span></span> <span data-ttu-id="2b38a-194">Для DXGI существует несколько различных поведений цепочки буферов.</span><span class="sxs-lookup"><span data-stu-id="2b38a-194">DXGI has some different swap chain behaviors.</span></span><br/>
<ul>
<li><span data-ttu-id="2b38a-195">В DXGI цепочка подкачки привязывается к окну при создании цепочки буфера обмена.</span><span class="sxs-lookup"><span data-stu-id="2b38a-195">In DXGI, a swap chain is tied to a window when the swap chain is created.</span></span> <span data-ttu-id="2b38a-196">Это изменение повышает производительность и экономит память.</span><span class="sxs-lookup"><span data-stu-id="2b38a-196">This change improves performance and saves memory.</span></span> <span data-ttu-id="2b38a-197">Предыдущие версии Direct3D позволяли цепи подкачки изменять окно, к которому привязана цепочка буферов.</span><span class="sxs-lookup"><span data-stu-id="2b38a-197">Previous versions of Direct3D allowed the swap chain to change the window that the swap chain is tied to.</span></span></li>
<li><span data-ttu-id="2b38a-198">В DXGI цепочка подкачки привязана к устройству отрисовки при создании.</span><span class="sxs-lookup"><span data-stu-id="2b38a-198">In DXGI, a swap chain is tied to a rendering device on creation.</span></span> <span data-ttu-id="2b38a-199">Объект устройства, возвращаемый функциями устройства Direct3D Create, реализует интерфейс <a href="/windows/win32/api/unknwn/nn-unknwn-iunknown"><strong>IUnknown</strong></a> .</span><span class="sxs-lookup"><span data-stu-id="2b38a-199">The device object that the Direct3D create device functions return implements the <a href="/windows/win32/api/unknwn/nn-unknwn-iunknown"><strong>IUnknown</strong></a> interface.</span></span> <span data-ttu-id="2b38a-200">Можно вызвать <a href="/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)"><strong>QueryInterface</strong></a> , чтобы запросить соответствующий интерфейс <a href="/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgidevice2"><strong>IDXGIDevice2</strong></a> для устройства.</span><span class="sxs-lookup"><span data-stu-id="2b38a-200">You can call <a href="/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)"><strong>QueryInterface</strong></a> to query for the device's corresponding <a href="/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgidevice2"><strong>IDXGIDevice2</strong></a> interface.</span></span> <span data-ttu-id="2b38a-201">Изменение устройства отрисовки требует повторного создания цепочки буфера обмена.</span><span class="sxs-lookup"><span data-stu-id="2b38a-201">A change to the rendering device requires the swap chain to be recreated.</span></span></li>
<li><p><span data-ttu-id="2b38a-202">В DXGI доступны эффекты переключения DXGI_SWAP_EFFECT_DISCARD и DXGI_SWAP_EFFECT_SEQUENTIAL.</span><span class="sxs-lookup"><span data-stu-id="2b38a-202">In DXGI, the swap effects available are DXGI_SWAP_EFFECT_DISCARD and DXGI_SWAP_EFFECT_SEQUENTIAL.</span></span> <span data-ttu-id="2b38a-203">Начиная с Windows 8 также доступен эффекты переключения DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL.</span><span class="sxs-lookup"><span data-stu-id="2b38a-203">Starting with Windows 8 the DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL swap effect is also available.</span></span> <span data-ttu-id="2b38a-204">В следующей таблице показано сопоставление Direct3D 9 и эффектов переключения DXGI.</span><span class="sxs-lookup"><span data-stu-id="2b38a-204">The following table shows a mapping of Direct3D 9 to DXGI swap effect defines.</span></span> </p>
<table>
<thead>
<tr class="header">
<th><span data-ttu-id="2b38a-205">D3D9 swap, результат</span><span class="sxs-lookup"><span data-stu-id="2b38a-205">D3D9 Swap Effect</span></span></th>
<th><span data-ttu-id="2b38a-206">Воздействие переключения на DXGI</span><span class="sxs-lookup"><span data-stu-id="2b38a-206">DXGI Swap Effect</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="2b38a-207">D3DSWAPEFFECT_DISCARD</span><span class="sxs-lookup"><span data-stu-id="2b38a-207">D3DSWAPEFFECT_DISCARD</span></span></td>
<td><span data-ttu-id="2b38a-208">DXGI_SWAP_EFFECT_DISCARD</span><span class="sxs-lookup"><span data-stu-id="2b38a-208">DXGI_SWAP_EFFECT_DISCARD</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="2b38a-209">D3DSWAPEFFECT_COPY</span><span class="sxs-lookup"><span data-stu-id="2b38a-209">D3DSWAPEFFECT_COPY</span></span></td>
<td><span data-ttu-id="2b38a-210">DXGI_SWAP_EFFECT_SEQUENTIAL с 1 буфером</span><span class="sxs-lookup"><span data-stu-id="2b38a-210">DXGI_SWAP_EFFECT_SEQUENTIAL with 1 buffer</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="2b38a-211">D3DSWAPEFFECT_FLIP</span><span class="sxs-lookup"><span data-stu-id="2b38a-211">D3DSWAPEFFECT_FLIP</span></span></td>
<td><span data-ttu-id="2b38a-212">DXGI_SWAP_EFFECT_SEQUENTIAL с 2 или более буферами</span><span class="sxs-lookup"><span data-stu-id="2b38a-212">DXGI_SWAP_EFFECT_SEQUENTIAL with 2 or more buffers</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="2b38a-213">D3DSWAPEFFECT_FLIPEX</span><span class="sxs-lookup"><span data-stu-id="2b38a-213">D3DSWAPEFFECT_FLIPEX</span></span></td>
<td><span data-ttu-id="2b38a-214">DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL с 2 или более буферами</span><span class="sxs-lookup"><span data-stu-id="2b38a-214">DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL with 2 or more buffers</span></span></td>
</tr>
</tbody>
</table>
<p></p>
<p> </p></li>
</ul></td>
</tr>
</tbody>
</table>



 

<span data-ttu-id="2b38a-215">Буферы цепочки перекачки создаются с определенным размером и в определенном формате.</span><span class="sxs-lookup"><span data-stu-id="2b38a-215">A swap chain's buffers are created at a particular size and in a particular format.</span></span> <span data-ttu-id="2b38a-216">Приложение задает эти значения (или можно наследовать размер из целевого окна) при запуске, а затем при необходимости может изменить их при изменении размера окна в ответ на пользовательские входные или программные события.</span><span class="sxs-lookup"><span data-stu-id="2b38a-216">The application specifies these values (or you can inherit the size from the target window) at startup, and can then optionally modify them as the window size changes in response to user input or program events.</span></span>

<span data-ttu-id="2b38a-217">После создания цепочки буферов, как правило, необходимо визуализировать изображения в нее.</span><span class="sxs-lookup"><span data-stu-id="2b38a-217">After you create the swap chain, you will typically want to render images into it.</span></span> <span data-ttu-id="2b38a-218">Ниже приведен фрагмент кода, который настраивает контекст Direct3D для отрисовки в цепочку буферов.</span><span class="sxs-lookup"><span data-stu-id="2b38a-218">Here's a code fragment that sets up a Direct3D context to render into a swap chain.</span></span> <span data-ttu-id="2b38a-219">Этот код извлекает из цепочки буфера обмена буфер, создает представление с целевым объектом рендеринга из этого буфера, а затем устанавливает его на устройстве:</span><span class="sxs-lookup"><span data-stu-id="2b38a-219">This code extracts a buffer from the swap chain, creates a render-target-view from that buffer, then sets it on the device:</span></span>


```
ID3D11Resource * pBB;
ThrowFailure( pSwapChain->GetBuffer(0, __uuidof(pBB),    
  reinterpret_cast<void**>(&pBB)), "Couldn't get back buffer");
ID3D11RenderTargetView * pView;
ThrowFailure( pD3D11Device->CreateRenderTargetView(pBB, NULL, &pView), 
  "Couldn't create view" );
pD3D11DeviceContext->OMSetRenderTargets(1, &pView, 0);
        
```



<span data-ttu-id="2b38a-220">После того как приложение отрисовывает кадр в буфер цепочки подкачки, вызовите [**IDXGISwapChain1::P resent1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1).</span><span class="sxs-lookup"><span data-stu-id="2b38a-220">After your application renders a frame into a swap-chain buffer, call [**IDXGISwapChain1::Present1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1).</span></span> <span data-ttu-id="2b38a-221">Затем приложение может выполнить визуализацию следующего изображения.</span><span class="sxs-lookup"><span data-stu-id="2b38a-221">The application can then go render the next image.</span></span>

### <a name="care-and-feeding-of-the-swap-chain"></a><span data-ttu-id="2b38a-222">Отслеживание и подача цепочки буферов обмена</span><span class="sxs-lookup"><span data-stu-id="2b38a-222">Care and feeding of the swap chain</span></span>

<span data-ttu-id="2b38a-223">После подготовки изображения вызовите метод [**IDXGISwapChain1::P resent1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) и перейдите к следующему изображению.</span><span class="sxs-lookup"><span data-stu-id="2b38a-223">After you render your image, call [**IDXGISwapChain1::Present1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) and go render the next image.</span></span> <span data-ttu-id="2b38a-224">Это область ответственности.</span><span class="sxs-lookup"><span data-stu-id="2b38a-224">That is the extent of your responsibility.</span></span>

<span data-ttu-id="2b38a-225">Если вы ранее вызывали [**идксгифактори:: макевиндовассоЦиатион**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory-makewindowassociation), пользователь может нажать сочетание клавиш Alt-Enter и DXGI, чтобы перевести приложение между оконным и полноэкранным режимом.</span><span class="sxs-lookup"><span data-stu-id="2b38a-225">If you previously called [**IDXGIFactory::MakeWindowAssociation**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory-makewindowassociation), the user can press the Alt-Enter key combination and DXGI will transition your application between windowed and full-screen mode.</span></span> <span data-ttu-id="2b38a-226">**Идксгифактори:: макевиндовассоЦиатион** рекомендуется, так как для пользователя настоятельно требуется стандартный механизм управления.</span><span class="sxs-lookup"><span data-stu-id="2b38a-226">**IDXGIFactory::MakeWindowAssociation** is recommended, because a standard control mechanism for the user is strongly desired.</span></span>

<span data-ttu-id="2b38a-227">Хотя вам не нужно писать какой-либо код, чем описано, несколько простых шагов могут сделать приложение более быстрым.</span><span class="sxs-lookup"><span data-stu-id="2b38a-227">While you don't have to write any more code than has been described, a few simple steps can make your application more responsive.</span></span> <span data-ttu-id="2b38a-228">Наиболее важным моментом является изменение размера буферов цепочки буфера обмена в ответ на изменение размера окна вывода.</span><span class="sxs-lookup"><span data-stu-id="2b38a-228">The most important consideration is the resizing of the swap chain's buffers in response to the resizing of the output window.</span></span> <span data-ttu-id="2b38a-229">Естественно, оптимальный маршрут приложения отвечает на \_ Размер WM и вызывает [**идксгисвапчаин:: ресизебуфферс**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers), передавая размер, содержащийся в параметрах сообщения.</span><span class="sxs-lookup"><span data-stu-id="2b38a-229">Naturally, the application's best route is to respond to WM\_SIZE, and call [**IDXGISwapChain::ResizeBuffers**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers), passing the size contained in the message's parameters.</span></span> <span data-ttu-id="2b38a-230">Очевидно, что приложение реагирует на пользователя, когда он перемещает границы окна, но в точности то, что обеспечивает плавное преобразование в полноэкранный режим.</span><span class="sxs-lookup"><span data-stu-id="2b38a-230">This behavior obviously makes your application respond well to the user when he or she drags the window's borders, but it is also exactly what enables a smooth full-screen transition.</span></span> <span data-ttu-id="2b38a-231">Окно получит \_ сообщение о размере WM всякий раз, когда происходит такой переход, и вызов **идксгисвапчаин:: ресизебуфферс** является шансом цепочки буферов для повторного выделения памяти хранилища для оптимального представления.</span><span class="sxs-lookup"><span data-stu-id="2b38a-231">Your window will receive a WM\_SIZE message whenever such a transition happens, and calling **IDXGISwapChain::ResizeBuffers** is the swap chain's chance to re-allocate the buffers' storage for optimal presentation.</span></span> <span data-ttu-id="2b38a-232">Именно поэтому приложение должно освобождать все ссылки на существующие буферы перед вызовом **идксгисвапчаин:: ресизебуфферс**.</span><span class="sxs-lookup"><span data-stu-id="2b38a-232">This is why the application is required to release any references it has on the existing buffers before it calls **IDXGISwapChain::ResizeBuffers**.</span></span>

<span data-ttu-id="2b38a-233">Сбой вызова [**идксгисвапчаин:: ресизебуфферс**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) в ответ на переключение в полноэкранный режим (в большинстве естественно, в ответ на размер WM \_ ) может привести к исключению оптимизации зеркального отображения, где DXGI может просто поменять местами отображаемый буфер, а не копировать данные, появляющиеся в полноэкранном режиме.</span><span class="sxs-lookup"><span data-stu-id="2b38a-233">Failure to call [**IDXGISwapChain::ResizeBuffers**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) in response to switching to full-screen mode (most naturally, in response to WM\_SIZE), can preclude the optimization of flipping, wherein DXGI can simply swap which buffer is being displayed, rather than copying a full screen's worth of data around.</span></span>

<span data-ttu-id="2b38a-234">[**IDXGISwapChain1::P resent1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) сообщит, будет ли окно вывода полностью перекрыто через **\_ \_ перекрыто состояния DXGI**.</span><span class="sxs-lookup"><span data-stu-id="2b38a-234">[**IDXGISwapChain1::Present1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) will inform you if your output window is entirely occluded via **DXGI\_STATUS\_OCCLUDED**.</span></span> <span data-ttu-id="2b38a-235">В этом случае мы рекомендуем, чтобы приложение перейдет в ждущий режим (вызвав **IDXGISwapChain1::P resent1** с **\_ \_ тестом DXGI Present**), так как ресурсы, используемые для отрисовки кадра, будут излишними.</span><span class="sxs-lookup"><span data-stu-id="2b38a-235">When this occurs, we recommended that your application go into standby mode (by calling **IDXGISwapChain1::Present1** with **DXGI\_PRESENT\_TEST**) since resources used to render the frame are wasted.</span></span> <span data-ttu-id="2b38a-236">Если вы используете **\_ \_ тест DXGI Present** , данные не будут представлены, пока выполняется проверка перекрытия.</span><span class="sxs-lookup"><span data-stu-id="2b38a-236">Using **DXGI\_PRESENT\_TEST** will prevent any data from being presented while still performing the occlusion check.</span></span> <span data-ttu-id="2b38a-237">После **IDXGISwapChain1::P resent1** возвращает " \_ ОК", необходимо выйти из режима ожидания; не используйте код возврата для переключения в режим ожидания, так как это может привести к выходу цепочки буферов на невозможность повторного полноэкранного режима.</span><span class="sxs-lookup"><span data-stu-id="2b38a-237">Once **IDXGISwapChain1::Present1** returns S\_OK, you should exit standby mode; do not use the return code to switch to standby mode as doing so can leave the swap chain unable to relinquish full-screen mode.</span></span>

<span data-ttu-id="2b38a-238">Среда выполнения Direct3D 11,1, которая доступна начиная с Windows 8, предоставляет цепочку пересчета перелистывания (то есть цепочку подкачки, в которой [**имеется \_ \_ \_ повернутое \_ последовательное**](/windows/win32/api/DXGI/ne-dxgi-dxgi_swap_effect) значение, заданное в элементе **SwapEffect** в [**\_ \_ цепочке обмена \_ DXGI**](/windows/win32/api/DXGI/ns-dxgi-dxgi_swap_chain_desc) , а также [**\_ \_ цепочке \_**](/windows/win32/api/DXGI1_2/ns-dxgi1_2-dxgi_swap_chain_desc1)подстановки DXGI DESC1).</span><span class="sxs-lookup"><span data-stu-id="2b38a-238">The Direct3D 11.1 runtime, which is available starting with Windows 8, provides a flip-model swap chain (that is, a swap chain that has the [**DXGI\_SWAP\_EFFECT\_FLIP\_SEQUENTIAL**](/windows/win32/api/DXGI/ne-dxgi-dxgi_swap_effect) value set in the **SwapEffect** member of [**DXGI\_SWAP\_CHAIN\_DESC**](/windows/win32/api/DXGI/ns-dxgi-dxgi_swap_chain_desc) or [**DXGI\_SWAP\_CHAIN\_DESC1**](/windows/win32/api/DXGI1_2/ns-dxgi1_2-dxgi_swap_chain_desc1)).</span></span> <span data-ttu-id="2b38a-239">При отображении кадров в выходных данных с помощью цепочки перелистывания моделей, DXGI отменяет привязку заднего буфера из всех расположений состояний конвейера, таких как целевой объект прорисовки выходных данных, для записи в задний буфер 0.</span><span class="sxs-lookup"><span data-stu-id="2b38a-239">When you present frames to an output with a flip-model swap chain, DXGI unbinds the back buffer from all pipeline state locations, like an output-merger render target, that write to back buffer 0.</span></span> <span data-ttu-id="2b38a-240">Поэтому рекомендуется вызывать метод [**ссылку ID3D11DeviceContext:: омсетрендертаржетс**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-omsetrendertargets) непосредственно перед отрисовкой в задний буфер.</span><span class="sxs-lookup"><span data-stu-id="2b38a-240">Therefore, we recommend that you call [**ID3D11DeviceContext::OMSetRenderTargets**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-omsetrendertargets) immediately before you render to the back buffer.</span></span> <span data-ttu-id="2b38a-241">Например, не вызывайте **омсетрендертаржетс** , а затем выполните действия COMPUTE Shader, которые не приводят к подготовке к ресурсу.</span><span class="sxs-lookup"><span data-stu-id="2b38a-241">For example, don't call **OMSetRenderTargets** and then perform compute shader work that doesn't end up rendering to the resource.</span></span> <span data-ttu-id="2b38a-242">Дополнительные сведения о цепочках перестановки перелистывания моделей и их преимуществах см. в разделе [модель перелистывания DXGI](dxgi-flip-model.md).</span><span class="sxs-lookup"><span data-stu-id="2b38a-242">For more info about flip-model swap chains and their benefits, see [DXGI Flip Model](dxgi-flip-model.md).</span></span>

> [!NOTE]  
> <span data-ttu-id="2b38a-243">В Direct3D 10 и Direct3D 11 не нужно вызывать [**идксгисвапчаин::-buffer**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-getbuffer) для получения заднего буфера 0 после вызова [**IDXGISwapChain1::P resent1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) , так как для удобства изменения идентификаторов задних буферов изменяются.</span><span class="sxs-lookup"><span data-stu-id="2b38a-243">In Direct3D 10 and Direct3D 11, you don't have to call [**IDXGISwapChain::GetBuffer**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-getbuffer) to retrieve back buffer 0 after you call [**IDXGISwapChain1::Present1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) because for convenience the identities of back buffers change.</span></span> <span data-ttu-id="2b38a-244">Это не происходит в Direct3D 12, и приложение вместо этого может вручную отслеживаниь индексов буфера.</span><span class="sxs-lookup"><span data-stu-id="2b38a-244">This doesn't happen in Direct3D 12, and your application must instead manually track back buffer indices.</span></span>

### <a name="handling-window-resizing"></a><span data-ttu-id="2b38a-245">Обработка изменения размера окна</span><span class="sxs-lookup"><span data-stu-id="2b38a-245">Handling window resizing</span></span>

<span data-ttu-id="2b38a-246">Для управления изменением размера окна можно использовать метод [**идксгисвапчаин:: ресизебуфферс**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) .</span><span class="sxs-lookup"><span data-stu-id="2b38a-246">You can use the [**IDXGISwapChain::ResizeBuffers**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) method to handle window resizing.</span></span> <span data-ttu-id="2b38a-247">Перед вызовом **ресизебуфферс** необходимо освободить все необработанные ссылки на буферы цепочки буфера обмена.</span><span class="sxs-lookup"><span data-stu-id="2b38a-247">Before you call **ResizeBuffers**, you must release all outstanding references to the swap chain's buffers.</span></span> <span data-ttu-id="2b38a-248">Объект, который обычно содержит ссылку на буфер цепочки буфера обмена, является представлением визуализации-Target-.</span><span class="sxs-lookup"><span data-stu-id="2b38a-248">The object that typically holds a reference to a swap chain's buffer is a render-target-view.</span></span>

<span data-ttu-id="2b38a-249">В следующем примере кода показано, как вызвать [**ресизебуфферс**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) из обработчика WindowProc для сообщений о \_ размере WM:</span><span class="sxs-lookup"><span data-stu-id="2b38a-249">The following example code shows how to call [**ResizeBuffers**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) from within the WindowProc handler for WM\_SIZE messages:</span></span>


```
    case WM_SIZE:
        if (g_pSwapChain)
        {
            g_pd3dDeviceContext->OMSetRenderTargets(0, 0, 0);

            // Release all outstanding references to the swap chain's buffers.
            g_pRenderTargetView->Release();

            HRESULT hr;
            // Preserve the existing buffer count and format.
            // Automatically choose the width and height to match the client rect for HWNDs.
            hr = g_pSwapChain->ResizeBuffers(0, 0, 0, DXGI_FORMAT_UNKNOWN, 0);
                                            
            // Perform error handling here!

            // Get buffer and create a render-target-view.
            ID3D11Texture2D* pBuffer;
            hr = g_pSwapChain->GetBuffer(0, __uuidof( ID3D11Texture2D),
                                         (void**) &pBuffer );
            // Perform error handling here!

            hr = g_pd3dDevice->CreateRenderTargetView(pBuffer, NULL,
                                                     &g_pRenderTargetView);
            // Perform error handling here!
            pBuffer->Release();

            g_pd3dDeviceContext->OMSetRenderTargets(1, &g_pRenderTargetView, NULL );

            // Set up the viewport.
            D3D11_VIEWPORT vp;
            vp.Width = width;
            vp.Height = height;
            vp.MinDepth = 0.0f;
            vp.MaxDepth = 1.0f;
            vp.TopLeftX = 0;
            vp.TopLeftY = 0;
            g_pd3dDeviceContext->RSSetViewports( 1, &vp );
        }
        return 1;
```



### <a name="choosing-the-dxgi-output-and-size"></a><span data-ttu-id="2b38a-250">Выбор выходных и размеров DXGI</span><span class="sxs-lookup"><span data-stu-id="2b38a-250">Choosing the DXGI output and size</span></span>

<span data-ttu-id="2b38a-251">По умолчанию DXGI выбирает выходные данные, которые содержат большую часть клиентской области окна.</span><span class="sxs-lookup"><span data-stu-id="2b38a-251">By default, DXGI chooses the output that contains most of the client area of the window.</span></span> <span data-ttu-id="2b38a-252">Это единственный вариант, доступный для DXGI, если он полностью отображается в ответ на нажатие клавиши ALT + ВВОД.</span><span class="sxs-lookup"><span data-stu-id="2b38a-252">This is the only option available to DXGI when it goes full-screen itself in response to alt-enter.</span></span> <span data-ttu-id="2b38a-253">Если приложение выбирает переход в полноэкранный режим самостоятельно, оно может вызвать [**идксгисвапчаин:: сетфуллскринстате**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-setfullscreenstate) и передать явное [**IDXGIOutput1**](/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgioutput1) (или **null**, если приложение позволяет разрешить DXGI).</span><span class="sxs-lookup"><span data-stu-id="2b38a-253">If the application chooses to go to full-screen mode by itself, then it can call [**IDXGISwapChain::SetFullscreenState**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-setfullscreenstate) and pass an explicit [**IDXGIOutput1**](/windows/win32/api/DXGI1_2/nn-dxgi1_2-idxgioutput1) (or **NULL**, if the application is happy to let DXGI decide).</span></span>

<span data-ttu-id="2b38a-254">Чтобы изменить размер выходных данных в полноэкранном или оконном режиме, рекомендуется вызвать [**идксгисвапчаин:: ресизетаржет**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizetarget), так как этот метод изменяет размер целевого окна.</span><span class="sxs-lookup"><span data-stu-id="2b38a-254">To resize the output while either full screen or windowed, we recommend to call [**IDXGISwapChain::ResizeTarget**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizetarget), since this method resizes the target window also.</span></span> <span data-ttu-id="2b38a-255">Так как размер целевого окна изменяется, операционная система отправляет **\_ Размер WM**, а код естественным образом вызывает [**идксгисвапчаин:: ресизебуфферс**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) в ответе.</span><span class="sxs-lookup"><span data-stu-id="2b38a-255">Since the target window is resized, the operating system sends **WM\_SIZE**, and your code will naturally call [**IDXGISwapChain::ResizeBuffers**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) in response.</span></span> <span data-ttu-id="2b38a-256">Таким результатом является некоторая трата усилий на изменение размера буферов и последующее изменение размера целевого объекта.</span><span class="sxs-lookup"><span data-stu-id="2b38a-256">It's thus a waste of effort to resize your buffers, and then subsequently resize the target.</span></span>

### <a name="debugging-in-full-screen-mode"></a><span data-ttu-id="2b38a-257">Отладка в полноэкранном режиме</span><span class="sxs-lookup"><span data-stu-id="2b38a-257">Debugging in full-screen mode</span></span>

<span data-ttu-id="2b38a-258">Цепочка подкачки DXGI освобождает полноэкранный режим только при крайней необходимости.</span><span class="sxs-lookup"><span data-stu-id="2b38a-258">A DXGI swap chain relinquishes full-screen mode only when absolutely necessary.</span></span> <span data-ttu-id="2b38a-259">Это означает, что можно выполнить отладку полноэкранного приложения с помощью нескольких мониторов, если окно отладки не пересекается с целевым окном цепочки буферов.</span><span class="sxs-lookup"><span data-stu-id="2b38a-259">This means that you can debug a full-screen application using multiple monitors, as long as the debug window doesn't overlap the swap chain's target window.</span></span> <span data-ttu-id="2b38a-260">Кроме того, можно полностью запретить переключение в режим, не установив **флаг \_ \_ \_ \_ \_ режима \_ разрешения цепочки DXGI** .</span><span class="sxs-lookup"><span data-stu-id="2b38a-260">Alternatively, you can prevent mode switching altogether by not setting the **DXGI\_SWAP\_CHAIN\_FLAG\_ALLOW\_MODE\_SWITCH** flag.</span></span>

<span data-ttu-id="2b38a-261">Если переключение режима разрешено, цепочка подкачки будет дополнять полноэкранный режим, когда окно вывода перекрытося другим окном.</span><span class="sxs-lookup"><span data-stu-id="2b38a-261">If mode switching is allowed, a swap chain will relinquish full-screen mode whenever its output window is occluded by another window.</span></span> <span data-ttu-id="2b38a-262">Проверка перекрытия выполняется во время [**IDXGISwapChain1::P resent1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1)или в отдельном потоке, цель которого — следить за тем, что приложение перестает отвечать (и больше не вызывает **IDXGISwapChain1::P resent1**).</span><span class="sxs-lookup"><span data-stu-id="2b38a-262">The occlusion check is performed during [**IDXGISwapChain1::Present1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1), or by a separate thread whose purpose is to watch to see if the application has becomes unresponsive (and no longer calls **IDXGISwapChain1::Present1**).</span></span> <span data-ttu-id="2b38a-263">Чтобы отключить возможность отдельного потока вызвать параметр, присвойте следующему разделу реестра любое ненулевое значение.</span><span class="sxs-lookup"><span data-stu-id="2b38a-263">To disable the ability of the separate thread to cause a switch, set the following registry key to any non-zero value.</span></span>

<span data-ttu-id="2b38a-264">**HKCU \\ программное обеспечение \\ Microsoft \\ DXGI \\ дисаблефуллскринватчдог**</span><span class="sxs-lookup"><span data-stu-id="2b38a-264">**HKCU\\Software\\Microsoft\\DXGI\\DisableFullscreenWatchdog**</span></span>

### <a name="destroying-a-swap-chain"></a><span data-ttu-id="2b38a-265">Уничтожение цепочки буферов</span><span class="sxs-lookup"><span data-stu-id="2b38a-265">Destroying a swap chain</span></span>

<span data-ttu-id="2b38a-266">Вы не можете освободить цепочку буферов в полноэкранном режиме, так как это может привести к конфликту потоков (что приведет к созданию исключения, которое будет вызываться DXGI).</span><span class="sxs-lookup"><span data-stu-id="2b38a-266">You may not release a swap chain in full-screen mode because doing so may create thread contention (which will cause DXGI to raise a non-continuable exception).</span></span> <span data-ttu-id="2b38a-267">Прежде чем выпустить цепочку буферов, сначала переключитесь в оконный режим (с помощью [**идксгисвапчаин:: сетфуллскринстате**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-setfullscreenstate)( **false**, **null** )), а затем вызовите [**IUnknown:: Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span><span class="sxs-lookup"><span data-stu-id="2b38a-267">Before releasing a swap chain, first switch to windowed mode (using [**IDXGISwapChain::SetFullscreenState**](/windows/win32/api/DXGI/nf-dxgi-idxgiswapchain-setfullscreenstate)( **FALSE**, **NULL** )) and then call [**IUnknown::Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span></span>

### <a name="using-a-rotated-monitor"></a><span data-ttu-id="2b38a-268">Использование повернутого монитора</span><span class="sxs-lookup"><span data-stu-id="2b38a-268">Using a rotated monitor</span></span>

<span data-ttu-id="2b38a-269">Приложению не нужно беспокоиться о ориентации монитора, DXGI при необходимости поворачивает буфер цепочки подкачки во время презентации.</span><span class="sxs-lookup"><span data-stu-id="2b38a-269">An application does not need to worry about monitor orientation, DXGI will rotate a swap-chain buffer during presentation, if necessary.</span></span> <span data-ttu-id="2b38a-270">Разумеется, это дополнительное вращение может повлиять на производительность.</span><span class="sxs-lookup"><span data-stu-id="2b38a-270">Of course, this additional rotation can impact performance.</span></span> <span data-ttu-id="2b38a-271">Для достижения оптимальной производительности выполните следующие действия в приложении.</span><span class="sxs-lookup"><span data-stu-id="2b38a-271">For best performance, take care of the rotation in your application by doing the following:</span></span>

-   <span data-ttu-id="2b38a-272">Используйте **\_ \_ флаг цепочки подкачки DXGI \_ \_ нонпреротатед**.</span><span class="sxs-lookup"><span data-stu-id="2b38a-272">Use the **DXGI\_SWAP\_CHAIN\_FLAG\_NONPREROTATED**.</span></span> <span data-ttu-id="2b38a-273">Это уведомление DXGI о том, что приложение будет создавать повернутое изображение (например, путем изменения его матрицы проекции).</span><span class="sxs-lookup"><span data-stu-id="2b38a-273">This notifies DXGI that the application will produce a rotated image (for example, by altering its projection matrix).</span></span> <span data-ttu-id="2b38a-274">Обратите внимание на то, что этот флаг допустим только в полноэкранном режиме.</span><span class="sxs-lookup"><span data-stu-id="2b38a-274">One thing to note, this flag is only valid while in full-screen mode.</span></span>
-   <span data-ttu-id="2b38a-275">Выделите каждый буфер цепочки подкачки в его повернутом размере.</span><span class="sxs-lookup"><span data-stu-id="2b38a-275">Allocate each swap-chain buffer in its rotated size.</span></span> <span data-ttu-id="2b38a-276">При необходимости используйте [**идксгиаутпут:: DESC**](/windows/win32/api/DXGI/nf-dxgi-idxgioutput-getdesc) для получения этих значений.</span><span class="sxs-lookup"><span data-stu-id="2b38a-276">Use [**IDXGIOutput::GetDesc**](/windows/win32/api/DXGI/nf-dxgi-idxgioutput-getdesc) to get these values, if necessary.</span></span>

<span data-ttu-id="2b38a-277">Выполняя вращение в приложении, DXGI просто выполнит копирование вместо копирования и поворота.</span><span class="sxs-lookup"><span data-stu-id="2b38a-277">By performing the rotation in your application, DXGI will simply do a copy instead of a copy and a rotate.</span></span>

<span data-ttu-id="2b38a-278">Среда выполнения Direct3D 11,1, которая доступна начиная с Windows 8, предоставляет цепочку пересчета перелистывания (то есть цепочку подкачки с отправкой [**\_ \_ \_ \_ последовательного**](/windows/win32/api/DXGI/ne-dxgi-dxgi_swap_effect) значения, заданной в элементе **SwapEffect** в [**\_ \_ цепочке \_ DESC1 среды DXGI**](/windows/win32/api/DXGI1_2/ns-dxgi1_2-dxgi_swap_chain_desc1).</span><span class="sxs-lookup"><span data-stu-id="2b38a-278">The Direct3D 11.1 runtime, which is available starting with Windows 8, provides a flip-model swap chain (that is, a swap chain that has the [**DXGI\_SWAP\_EFFECT\_FLIP\_SEQUENTIAL**](/windows/win32/api/DXGI/ne-dxgi-dxgi_swap_effect) value set in the **SwapEffect** member of [**DXGI\_SWAP\_CHAIN\_DESC1**](/windows/win32/api/DXGI1_2/ns-dxgi1_2-dxgi_swap_chain_desc1)).</span></span> <span data-ttu-id="2b38a-279">Чтобы максимально увеличить возможности оптимизации представления в цепочке перелистывания моделей, рекомендуется сделать приложения ориентированными на содержимое, чтобы оно соответствовало определенному выходу, на котором находится содержимое, когда содержимое полностью занимает выходные данные.</span><span class="sxs-lookup"><span data-stu-id="2b38a-279">To maximize the presentation optimizations available with a flip-model swap chain, we recommend that you make your applications orient content to match the particular output on which the content resides when that content fully occupies the output.</span></span> <span data-ttu-id="2b38a-280">Дополнительные сведения о цепочках перестановки перелистывания моделей и их преимуществах см. в разделе [модель перелистывания DXGI](dxgi-flip-model.md).</span><span class="sxs-lookup"><span data-stu-id="2b38a-280">For more info about flip-model swap chains and their benefits, see [DXGI Flip Model](dxgi-flip-model.md).</span></span>

### <a name="switching-modes"></a><span data-ttu-id="2b38a-281">Переключение режимов</span><span class="sxs-lookup"><span data-stu-id="2b38a-281">Switching modes</span></span>

<span data-ttu-id="2b38a-282">Цепочка подкачки DXGI может изменить режим отображения выходных данных при выполнении полноэкранного перехода.</span><span class="sxs-lookup"><span data-stu-id="2b38a-282">The DXGI swap chain might change the display mode of an output when making a full-screen transition.</span></span> <span data-ttu-id="2b38a-283">Чтобы включить автоматическое изменение режима экрана, необходимо указать в описании цепочки подкачки **\_ \_ \_ \_ \_ \_ переключатель режим разрешения цепочки** для переключения режима ожидания.</span><span class="sxs-lookup"><span data-stu-id="2b38a-283">To enable the automatic display mode change, you must specify **DXGI\_SWAP\_CHAIN\_FLAG\_ALLOW\_MODE\_SWITCH** in the swap-chain description.</span></span> <span data-ttu-id="2b38a-284">При автоматическом изменении режима показа DXGI выберет самый небольшой режим (размер и разрешение не изменятся, а глубина цвета может быть изменена).</span><span class="sxs-lookup"><span data-stu-id="2b38a-284">If the display mode automatically changes, DXGI will choose the most modest mode (size and resolution will not change, but the color depth may).</span></span> <span data-ttu-id="2b38a-285">Изменение размера буферов цепочки подкачки не приведет к переключению в режим.</span><span class="sxs-lookup"><span data-stu-id="2b38a-285">Resizing swap chain buffers will not cause a mode switch.</span></span> <span data-ttu-id="2b38a-286">Цепочка обмена делает неявным обещанием, что при выборе заднего буфера, который точно соответствует режиму отображения, поддерживаемому целевым выходом, то при входе в полноэкранный режим будет переключен на этот режим отображения.</span><span class="sxs-lookup"><span data-stu-id="2b38a-286">The swap chain makes an implicit promise that if you choose a back buffer that exactly matches a display mode supported by the target output, then it will switch to that display mode when entering full-screen mode on that output.</span></span> <span data-ttu-id="2b38a-287">Следовательно, выберите режим экрана, выбрав размер и формат заднего буфера.</span><span class="sxs-lookup"><span data-stu-id="2b38a-287">Consequently, you choose a display mode by choosing your back buffer size and format.</span></span>

### <a name="full-screen-performance-tip"></a><span data-ttu-id="2b38a-288">Советы по повышению производительности в полноэкранном режиме</span><span class="sxs-lookup"><span data-stu-id="2b38a-288">Full-screen performance tip</span></span>

<span data-ttu-id="2b38a-289">При вызове [**IDXGISwapChain1::P resent1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) в полноэкранном приложении цепочка обмена переворачивается (а не блитс) содержимое заднего буфера в передний буфер.</span><span class="sxs-lookup"><span data-stu-id="2b38a-289">When you call [**IDXGISwapChain1::Present1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) on a full-screen application, the swap chain flips (as opposed to blits) the contents of the back buffer to the front buffer.</span></span> <span data-ttu-id="2b38a-290">Для этого требуется, чтобы цепочка буферов была создана с помощью перечисленного режима просмотра (указанного в [**\_ \_ цепочке \_ DESC1**](/windows/win32/api/DXGI1_2/ns-dxgi1_2-dxgi_swap_chain_desc1)).</span><span class="sxs-lookup"><span data-stu-id="2b38a-290">This requires that the swap chain was created by using an enumerated display mode (specified in [**DXGI\_SWAP\_CHAIN\_DESC1**](/windows/win32/api/DXGI1_2/ns-dxgi1_2-dxgi_swap_chain_desc1)).</span></span> <span data-ttu-id="2b38a-291">Если не удается перечислить режимы дисплея или неправильно указать режим экрана в описании, то цепочка буфера обмена может выполнить перенаправление на блок-блокировку (BitBlt).</span><span class="sxs-lookup"><span data-stu-id="2b38a-291">If you fail to enumerate display modes, or incorrectly specify the display mode in the description, the swap chain may perform a bit-block transfer (bitblt) instead.</span></span> <span data-ttu-id="2b38a-292">BitBlt вызывает дополнительную растягивание, а также увеличение использования видеопамяти и трудно обнаружить.</span><span class="sxs-lookup"><span data-stu-id="2b38a-292">The bitblt causes an extra stretching copy as well as some increased video memory usage, and is difficult to detect.</span></span> <span data-ttu-id="2b38a-293">Чтобы избежать этой проблемы, перечислите режимы экрана и инициализируйте Описание цепочки буфера обмена, прежде чем создавать цепочку буферов.</span><span class="sxs-lookup"><span data-stu-id="2b38a-293">To avoid this problem, enumerate display modes, and initialize the swap chain description correctly before you create the swap chain.</span></span> <span data-ttu-id="2b38a-294">Это обеспечит максимальную производительность при зеркальном отображении в полноэкранном режиме и позволяет избежать дополнительной нагрузки на память.</span><span class="sxs-lookup"><span data-stu-id="2b38a-294">This will ensure maximum performance when flipping in full-screen mode and avoid the extra memory overhead.</span></span>

### <a name="multithread-considerations"></a><span data-ttu-id="2b38a-295">Вопросы многопоточности</span><span class="sxs-lookup"><span data-stu-id="2b38a-295">Multithread considerations</span></span>

<span data-ttu-id="2b38a-296">При использовании DXGI в приложении с несколькими потоками необходимо избегать создания взаимоблокировок, в которых два разных потока ожидают завершения друг друга.</span><span class="sxs-lookup"><span data-stu-id="2b38a-296">When you use DXGI in an application with multiple threads, you need to be careful to avoid creating a deadlock, where two different threads are waiting on each other to complete.</span></span> <span data-ttu-id="2b38a-297">Это может произойти в двух ситуациях.</span><span class="sxs-lookup"><span data-stu-id="2b38a-297">There are two situations where this can occur.</span></span>

-   <span data-ttu-id="2b38a-298">Поток отрисовки не является потоком приема сообщений.</span><span class="sxs-lookup"><span data-stu-id="2b38a-298">The rendering thread is not the message-pump thread.</span></span>
-   <span data-ttu-id="2b38a-299">Поток, который исполняет API DXGI, не является тем же потоком, который создал окно.</span><span class="sxs-lookup"><span data-stu-id="2b38a-299">The thread executing a DXGI API is not the same thread that created the window.</span></span>

<span data-ttu-id="2b38a-300">Будьте внимательны, чтобы поток передачи сообщений не ждал в потоке отрисовки при использовании цепочек подкачки в полноэкранном режиме.</span><span class="sxs-lookup"><span data-stu-id="2b38a-300">Be careful that you never have the message-pump thread wait on the render thread when you use full-screen swap chains.</span></span> <span data-ttu-id="2b38a-301">Например, вызов [**IDXGISwapChain1::P resent1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) (из потока прорисовки) может привести к тому, что поток обработки сообщений будет ожидать поток насоса.</span><span class="sxs-lookup"><span data-stu-id="2b38a-301">For instance, calling [**IDXGISwapChain1::Present1**](/windows/win32/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) (from the render thread) may cause the render thread to wait on the message-pump thread.</span></span> <span data-ttu-id="2b38a-302">Если происходит изменение режима, этот сценарий возможен, если **Present1** вызывает:: SetWindowPos () или:: сетвиндовстиле () и любой из этих методов вызывает:: SendMessage ().</span><span class="sxs-lookup"><span data-stu-id="2b38a-302">When a mode change occurs, this scenario is possible if **Present1** calls ::SetWindowPos() or ::SetWindowStyle() and either of these methods call ::SendMessage().</span></span> <span data-ttu-id="2b38a-303">В этом сценарии, если поток приема сообщений имеет критически важный раздел, который защищает его или если поток прорисовки заблокирован, то эти два потока будут взаимоблокироваться.</span><span class="sxs-lookup"><span data-stu-id="2b38a-303">In this scenario, if the message-pump thread has a critical section guarding it or if the render thread is blocked, then the two threads will deadlock.</span></span>

<span data-ttu-id="2b38a-304">Дополнительные сведения об использовании DXGI с несколькими потоками см. в разделе [многопоточность и DXGI](../direct3d11/overviews-direct3d-11-render-multi-thread-intro.md).</span><span class="sxs-lookup"><span data-stu-id="2b38a-304">For more info about using DXGI with multiple threads, see [Multithreading and DXGI](../direct3d11/overviews-direct3d-11-render-multi-thread-intro.md).</span></span>

## <a name="dxgi-responses-from-dllmain"></a><span data-ttu-id="2b38a-305">Ответы DXGI из DLLMain</span><span class="sxs-lookup"><span data-stu-id="2b38a-305">DXGI responses from DLLMain</span></span>

<span data-ttu-id="2b38a-306">Поскольку функция [**DllMain**](../dlls/dllmain.md) не может гарантировать порядок загрузки и выгрузки библиотек DLL, рекомендуется, чтобы функция **DllMain** приложения не вызывала функции или методы Direct3D или DXGI, включая функции или методы, которые создают или освобождают объекты.</span><span class="sxs-lookup"><span data-stu-id="2b38a-306">Because a [**DllMain**](../dlls/dllmain.md) function can't guarantee the order in which it loads and unloads DLLs, we recommend that your app's **DllMain** function not call Direct3D or DXGI functions or methods, including functions or methods that create or release objects.</span></span> <span data-ttu-id="2b38a-307">Если функция **DllMain** приложения вызывает конкретный компонент, этот компонент может вызвать другую библиотеку DLL, которая отсутствует в операционной системе, что приводит к сбою операционной системы.</span><span class="sxs-lookup"><span data-stu-id="2b38a-307">If your app's **DllMain** function calls into a particular component, that component might call another DLL that isn't present on the operating system, which causes the operating system to crash.</span></span> <span data-ttu-id="2b38a-308">Direct3D и DXGI могут загружать набор библиотек DLL, как правило, набор драйверов, которые отличаются от компьютера к компьютеру.</span><span class="sxs-lookup"><span data-stu-id="2b38a-308">Direct3D and DXGI might load a set of DLLs, typically a set of drivers, that differs from computer to computer.</span></span> <span data-ttu-id="2b38a-309">Таким образом, даже если приложение не работает со сбоем на компьютерах разработки и тестирования, когда функция **DllMain** вызывает функции или методы Direct3D или DXGI, она может завершиться сбоем, если она выполняется на другом компьютере.</span><span class="sxs-lookup"><span data-stu-id="2b38a-309">Therefore, even if your app doesn t crash on your development and test computers when its **DllMain** function calls Direct3D or DXGI functions or methods, it might crash when it runs on another computer.</span></span>

<span data-ttu-id="2b38a-310">Чтобы предотвратить создание приложения, которое может привести к сбою операционной системы, DXGI предоставляет следующие ответы в указанных ситуациях.</span><span class="sxs-lookup"><span data-stu-id="2b38a-310">To prevent you from creating an app that might cause the operating system to crash, DXGI provides the following responses in the specified situations:</span></span>

-   <span data-ttu-id="2b38a-311">Если функция [**DllMain**](../dlls/dllmain.md) приложения освобождает последнюю ссылку на фабрику DXGI, DXGI создает исключение.</span><span class="sxs-lookup"><span data-stu-id="2b38a-311">If your app's [**DllMain**](../dlls/dllmain.md) function releases its last reference to a DXGI factory, DXGI raises an exception.</span></span>
-   <span data-ttu-id="2b38a-312">Если функция [**DllMain**](../dlls/dllmain.md) приложения создает фабрику DXGI, DXGI возвращает код ошибки.</span><span class="sxs-lookup"><span data-stu-id="2b38a-312">If your app's [**DllMain**](../dlls/dllmain.md) function creates a DXGI factory, DXGI returns an error code.</span></span>

## <a name="dxgi-11-changes"></a><span data-ttu-id="2b38a-313">Изменения DXGI 1,1</span><span class="sxs-lookup"><span data-stu-id="2b38a-313">DXGI 1.1 changes</span></span>

<span data-ttu-id="2b38a-314">Мы добавили в DXGI 1,1 следующие функциональные возможности.</span><span class="sxs-lookup"><span data-stu-id="2b38a-314">We added the following functionality in DXGI 1.1.</span></span>

-   <span data-ttu-id="2b38a-315">Поддержка синхронизированных общих поверхностей</span><span class="sxs-lookup"><span data-stu-id="2b38a-315">Synchronized Shared Surfaces Support</span></span>

    <span data-ttu-id="2b38a-316">Синхронизированные общие поверхности для Direct3D 10,1 и Direct3D 11 обеспечивают эффективное совместное использование поверхности чтения и записи между несколькими устройствами Direct3D (возможно совместное использование устройств Direct3D 10 и Direct3D 11).</span><span class="sxs-lookup"><span data-stu-id="2b38a-316">Synchronized shared surfaces for Direct3D 10.1 and Direct3D 11 enables efficient read and write surface sharing between multiple Direct3D devices (sharing between Direct3D 10 and Direct3D 11 devices is possible).</span></span> <span data-ttu-id="2b38a-317">См. раздел [**идксгикэйедмутекс:: аккуиресинк**](/windows/win32/api/DXGI/nf-dxgi-idxgikeyedmutex-acquiresync) and [**Идксгикэйедмутекс:: релеасесинк**](/windows/win32/api/DXGI/nf-dxgi-idxgikeyedmutex-releasesync).</span><span class="sxs-lookup"><span data-stu-id="2b38a-317">See [**IDXGIKeyedMutex::AcquireSync**](/windows/win32/api/DXGI/nf-dxgi-idxgikeyedmutex-acquiresync) and [**IDXGIKeyedMutex::ReleaseSync**](/windows/win32/api/DXGI/nf-dxgi-idxgikeyedmutex-releasesync).</span></span>

-   <span data-ttu-id="2b38a-318">Поддержка высокого цвета</span><span class="sxs-lookup"><span data-stu-id="2b38a-318">High Color Support</span></span>

    <span data-ttu-id="2b38a-319">Поддерживает формат DXGI \_ \_ R10G10B10 \_ XR \_ смещения \_ a2 \_ UNORM.</span><span class="sxs-lookup"><span data-stu-id="2b38a-319">Supports the DXGI\_FORMAT\_R10G10B10\_XR\_BIAS\_A2\_UNORM format.</span></span>

-   <span data-ttu-id="2b38a-320">[**IDXGIDevice1:: сетмаксимумфрамелатенци**](/windows/win32/api/DXGI/nf-dxgi-idxgidevice1-setmaximumframelatency) и [ **IDXGIDevice1:: жетмаксимумфрамелатенци**](/windows/win32/api/DXGI/nf-dxgi-idxgidevice1-getmaximumframelatency)</span><span class="sxs-lookup"><span data-stu-id="2b38a-320">[**IDXGIDevice1::SetMaximumFrameLatency**](/windows/win32/api/DXGI/nf-dxgi-idxgidevice1-setmaximumframelatency) and [**IDXGIDevice1::GetMaximumFrameLatency**](/windows/win32/api/DXGI/nf-dxgi-idxgidevice1-getmaximumframelatency)</span></span>
-   <span data-ttu-id="2b38a-321">[**IDXGIFactory1:: EnumAdapters1**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory1-enumadapters1) перечисляет локальные адаптеры без подключенных мониторов или выходных данных, а также адаптеры с присоединенными выходами.</span><span class="sxs-lookup"><span data-stu-id="2b38a-321">[**IDXGIFactory1::EnumAdapters1**](/windows/win32/api/DXGI/nf-dxgi-idxgifactory1-enumadapters1) enumerates local adapter(s) without any monitors or outputs attached, as well as adapters(s) with outputs attached.</span></span> <span data-ttu-id="2b38a-322">Первым возвращенным адаптером будет локальный адаптер, на котором отображается основной компьютер.</span><span class="sxs-lookup"><span data-stu-id="2b38a-322">The first adapter returned will be the local adapter on which the Desktop primary is displayed.</span></span>
-   <span data-ttu-id="2b38a-323">Поддержка формата BGRA</span><span class="sxs-lookup"><span data-stu-id="2b38a-323">BGRA format support</span></span>

    <span data-ttu-id="2b38a-324">\_Формат DXGI \_ B8G8R8A8 \_ UNORM и DXGI \_ \_ B8G8R8A8 \_ UNORM \_ sRGB, см. в разделе [**IDXGISurface1:: GetDC**](/windows/win32/api/DXGI/nf-dxgi-idxgisurface1-getdc) и [**IDXGISurface1:: релеаседк**](/windows/win32/api/DXGI/nf-dxgi-idxgisurface1-releasedc).</span><span class="sxs-lookup"><span data-stu-id="2b38a-324">DXGI\_FORMAT\_B8G8R8A8\_UNORM and DXGI\_FORMAT\_B8G8R8A8\_UNORM\_SRGB, see [**IDXGISurface1::GetDC**](/windows/win32/api/DXGI/nf-dxgi-idxgisurface1-getdc) and [**IDXGISurface1::ReleaseDC**](/windows/win32/api/DXGI/nf-dxgi-idxgisurface1-releasedc).</span></span>

## <a name="dxgi-12-changes"></a><span data-ttu-id="2b38a-325">Изменения DXGI 1,2</span><span class="sxs-lookup"><span data-stu-id="2b38a-325">DXGI 1.2 changes</span></span>

<span data-ttu-id="2b38a-326">Мы добавили в DXGI 1,2 следующие функциональные возможности.</span><span class="sxs-lookup"><span data-stu-id="2b38a-326">We added the following functionality in DXGI 1.2.</span></span>

-   <span data-ttu-id="2b38a-327">Цепочка стерео swap</span><span class="sxs-lookup"><span data-stu-id="2b38a-327">Stereo swap chain</span></span>
-   [<span data-ttu-id="2b38a-328">Цепочка перелистывания моделей</span><span class="sxs-lookup"><span data-stu-id="2b38a-328">Flip-model swap chain</span></span>](dxgi-flip-model.md)
-   <span data-ttu-id="2b38a-329">Оптимизированная презентация (прокрутка, "грязные" прямоугольники и вращение)</span><span class="sxs-lookup"><span data-stu-id="2b38a-329">Optimized presentation (scrolling, dirty rectangles, and rotation)</span></span>
-   <span data-ttu-id="2b38a-330">Улучшенные общие ресурсы и синхронизация</span><span class="sxs-lookup"><span data-stu-id="2b38a-330">Improved shared resources and synchronization</span></span>
-   [<span data-ttu-id="2b38a-331">Дублирование рабочего стола</span><span class="sxs-lookup"><span data-stu-id="2b38a-331">Desktop Duplication</span></span>](desktop-dup-api.md)
-   <span data-ttu-id="2b38a-332">Оптимизированное использование видеопамяти</span><span class="sxs-lookup"><span data-stu-id="2b38a-332">Optimized use of video memory</span></span>
-   <span data-ttu-id="2b38a-333">Поддержка 16 бит на пиксель (бит/с) ( \_ Формат DXGI \_ B5G6R5 \_ UNORM, \_ Формат DXGI \_ B5G5R5A1 \_ UNORM, \_ Формат DXGI \_ B4G4R4A4 \_ UNORM)</span><span class="sxs-lookup"><span data-stu-id="2b38a-333">Support for 16 bits per pixel (bpp) formats (DXGI\_FORMAT\_B5G6R5\_UNORM, DXGI\_FORMAT\_B5G5R5A1\_UNORM, DXGI\_FORMAT\_B4G4R4A4\_UNORM)</span></span>
-   <span data-ttu-id="2b38a-334">Отладка API</span><span class="sxs-lookup"><span data-stu-id="2b38a-334">Debugging APIs</span></span>

<span data-ttu-id="2b38a-335">Дополнительные сведения о DXGI 1,2 см. в разделе [улучшения dxgi 1,2](dxgi-1-2-improvements.md).</span><span class="sxs-lookup"><span data-stu-id="2b38a-335">For more info about DXGI 1.2, see [DXGI 1.2 Improvements](dxgi-1-2-improvements.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="2b38a-336">См. также</span><span class="sxs-lookup"><span data-stu-id="2b38a-336">Related topics</span></span>

[<span data-ttu-id="2b38a-337">Руководством по программированию для DXGI</span><span class="sxs-lookup"><span data-stu-id="2b38a-337">Programming Guide for DXGI</span></span>](dx-graphics-dxgi-overviews.md)
