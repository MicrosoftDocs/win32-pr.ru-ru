---
description: Гамма-коррекция или гамма для краткости — это имя нелинейной операции, используемой системами для кодирования и дешифрования значений пикселей в изображениях.
ms.assetid: 97ACDAE3-514E-4AAF-A27D-E5FFC162DB2A
title: Использование гамма-коррекции
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1c940db1a94fb41e9babecbeb3075aa9e01b3732
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104558043"
---
# <a name="using-gamma-correction"></a><span data-ttu-id="d4312-103">Использование гамма-коррекции</span><span class="sxs-lookup"><span data-stu-id="d4312-103">Using gamma correction</span></span>

<span data-ttu-id="d4312-104">Гамма-коррекция или гамма для краткости — это имя нелинейной операции, используемой системами для кодирования и дешифрования значений пикселей в изображениях.</span><span class="sxs-lookup"><span data-stu-id="d4312-104">Gamma correction, or gamma for short, is the name of a nonlinear operation that systems use to code and decode pixel values in images.</span></span>

-   [<span data-ttu-id="d4312-105">Что такое гамма и что это за?</span><span class="sxs-lookup"><span data-stu-id="d4312-105">What is gamma and what is it for?</span></span>](#what-is-gamma-and-what-is-it-for)
-   [<span data-ttu-id="d4312-106">Фон гаммы в Windows</span><span class="sxs-lookup"><span data-stu-id="d4312-106">Background of gamma on Windows</span></span>](#background-of-gamma-on-windows)
-   [<span data-ttu-id="d4312-107">Развитие аппаратного обеспечения экрана</span><span class="sxs-lookup"><span data-stu-id="d4312-107">Evolution of display hardware</span></span>](#evolution-of-display-hardware)
-   [<span data-ttu-id="d4312-108">Возможности управления гаммами в DXGI</span><span class="sxs-lookup"><span data-stu-id="d4312-108">Gamma control capabilities in DXGI</span></span>](#gamma-control-capabilities-in-dxgi)
-   [<span data-ttu-id="d4312-109">Установка элемента управления гамма с помощью DXGI</span><span class="sxs-lookup"><span data-stu-id="d4312-109">Setting gamma control with DXGI</span></span>](#setting-gamma-control-with-dxgi)
-   [<span data-ttu-id="d4312-110">Практические рекомендации по контролю гаммы</span><span class="sxs-lookup"><span data-stu-id="d4312-110">Gamma control practicalities</span></span>](#gamma-control-practicalities)
-   [<span data-ttu-id="d4312-111">См. также</span><span class="sxs-lookup"><span data-stu-id="d4312-111">Related topics</span></span>](#related-topics)

## <a name="what-is-gamma-and-what-is-it-for"></a><span data-ttu-id="d4312-112">Что такое гамма и что это за?</span><span class="sxs-lookup"><span data-stu-id="d4312-112">What is gamma and what is it for?</span></span>

<span data-ttu-id="d4312-113">В конце графического конвейера, когда изображение покидает компьютер, чтобы сделать его перемещение по кабелю монитора, существует небольшая часть оборудования, которая может преобразовывать значения пикселей на лету.</span><span class="sxs-lookup"><span data-stu-id="d4312-113">At the end of the graphics pipeline, just where the image leaves the computer to make its journey along the monitor cable, there is a small piece of hardware that can transform pixel values on the fly.</span></span> <span data-ttu-id="d4312-114">Это оборудование обычно использует таблицу подстановки для преобразования пикселов.</span><span class="sxs-lookup"><span data-stu-id="d4312-114">This hardware typically uses a lookup table to transform the pixels.</span></span> <span data-ttu-id="d4312-115">Это оборудование использует красные, зеленые и синие значения, которые поступают из поверхности, отображаемой для поиска скорректированных значений гаммы в таблице, а затем отправляет исправленные значения в монитор вместо фактических значений поверхности.</span><span class="sxs-lookup"><span data-stu-id="d4312-115">This hardware uses the red, green and blue values that come from the surface to be displayed to look up gamma-corrected values in the table and then sends the corrected values to the monitor instead of the actual surface values.</span></span> <span data-ttu-id="d4312-116">Таким образом, эту таблицу подстановки можно заменить любым другим цветом.</span><span class="sxs-lookup"><span data-stu-id="d4312-116">So, this lookup table is an opportunity to replace any color with any other color.</span></span> <span data-ttu-id="d4312-117">Хотя таблица имеет такой уровень мощности, типичное использование заключается в настройке изображений, чтобы компенсировать различия в ответе монитора.</span><span class="sxs-lookup"><span data-stu-id="d4312-117">While the table has that level of power, the typical usage is to tweak images subtly to compensate for differences in the monitor’s response.</span></span> <span data-ttu-id="d4312-118">Ответ монитора — это функция, которая связывает числовое значение красного, зеленого и синего компонентов пикселя с отображаемой яркостью этого пикселя.</span><span class="sxs-lookup"><span data-stu-id="d4312-118">The monitor’s response is the function that relates the numerical value of the red, green and blue components of a pixel with that pixel’s displayed brightness.</span></span>

<span data-ttu-id="d4312-119">Именно для этого предназначена эта таблица, но разработчикам игр было обнаружено творческих применений, например мигание всего экрана Красного для психологической.</span><span class="sxs-lookup"><span data-stu-id="d4312-119">That’s what this table was intended for, but game developers found creative uses for it, such as flashing the whole screen red for psychological effect.</span></span> <span data-ttu-id="d4312-120">В современных игровых приложениях в процессе последующей обработки каждого кадра мы обычно предоставляем другие способы выполнения таких задач.</span><span class="sxs-lookup"><span data-stu-id="d4312-120">In modern game apps, as part of the post-processing of each frame, we typically provide other ways to do such things.</span></span> <span data-ttu-id="d4312-121">На самом деле, рекомендуется оставить только таблицу гаммы, так как она может использоваться для калибровки ответа монитора, а оптовые изменения гамма-шкалы приуничтожить эту тщательную калибровку.</span><span class="sxs-lookup"><span data-stu-id="d4312-121">In fact, we recommend that you leave the gamma table alone because it might be in use to calibrate the monitor’s response, and wholesale changes to the gamma ramp will destroy this careful calibration.</span></span>

<span data-ttu-id="d4312-122">Науки об определении гамма-коррекции сложны и не представлено здесь, за исключением освещения, откуда поступило название «гамма».</span><span class="sxs-lookup"><span data-stu-id="d4312-122">The science of determining gamma correction is complex, and is not presented here, other than to illuminate where the name “gamma” came from.</span></span> <span data-ttu-id="d4312-123">CRT (т. е.) — это сложная функция, но физика этих мониторов означает, что они демонстрируют ответ, который может быть грубой, представленный этой функцией питания:</span><span class="sxs-lookup"><span data-stu-id="d4312-123">A CRT (that is, an old-fashioned glass) monitor’s response is a complex function, but the physics of these monitors mean that they exhibit a response that can be crudely represented by this power function:</span></span>

<span data-ttu-id="d4312-124">яркость (входные данные) =<sup>гамма</sup> ввода</span><span class="sxs-lookup"><span data-stu-id="d4312-124">brightness( input ) = input<sup>gamma</sup></span></span>

<span data-ttu-id="d4312-125">Значение гаммы обычно близко к значению 2,0.</span><span class="sxs-lookup"><span data-stu-id="d4312-125">The gamma value is typically close to a value of 2.0.</span></span> <span data-ttu-id="d4312-126">ЖК-мониторы и все остальные новые технологии специально разработаны для похожих ответов, поэтому для этих новых технологий не нужно повторно откалибровать все наши программы и образы.</span><span class="sxs-lookup"><span data-stu-id="d4312-126">LCD monitors and all other newer technologies are specifically engineered to exhibit a similar response so all our software and images don’t have to be recalibrated for those new technologies.</span></span> <span data-ttu-id="d4312-127">Стандарт sRGB объявляет, что это значение гаммы равно 2,2, а это значение стало широко реализованным стандартом.</span><span class="sxs-lookup"><span data-stu-id="d4312-127">The sRGB standard declares that this gamma value is exactly 2.2, and this value has become a widely implemented standard.</span></span>

<span data-ttu-id="d4312-128">Человеческий глаз также имеет функцию ответа, которая примерно инвертирует функцию CRT.</span><span class="sxs-lookup"><span data-stu-id="d4312-128">The human eye also has a response function which approximately inverts the CRT power function.</span></span> <span data-ttu-id="d4312-129">Это означает, что воспринимаемая яркость пикселя очень приблизительно соответствует значениям RGB в этом пикселе.</span><span class="sxs-lookup"><span data-stu-id="d4312-129">This means that the perceived brightness of a pixel goes up very roughly linearly with the RGB values in that pixel.</span></span>

<span data-ttu-id="d4312-130">Поскольку значение гаммы 2,2 становится стандартом де-факто, обычно нам не нужно беспокоиться о кривой гамма, закодированной в этой таблице, и оставить ее в виде линейного сопоставления "один к одному".</span><span class="sxs-lookup"><span data-stu-id="d4312-130">Because a gamma value of 2.2 has become a de-facto standard, we typically don’t need to worry too much about the gamma curve encoded in this table, and can leave it as a linear, one-to-one mapping.</span></span> <span data-ttu-id="d4312-131">Для правильного сопоставления цветов необходимо екскуисите с этой функцией, но это обсуждение выходит за рамки данного раздела.</span><span class="sxs-lookup"><span data-stu-id="d4312-131">Proper color matching does of course require exquisite care with this function, but that discussion is beyond the scope of this topic.</span></span> <span data-ttu-id="d4312-132">В Windows имеется средство, которое позволяет пользователям откалибровать экраны до гамма-2,2, а это средство использует оборудование таблицы подстановки для получения тщательно подобранной тонкой корректировки своих компьютеров.</span><span class="sxs-lookup"><span data-stu-id="d4312-132">Windows includes a tool that lets users calibrate their displays to gamma 2.2, and this tool uses the lookup table hardware to derive a carefully-chosen subtle tweak for their computers.</span></span> <span data-ttu-id="d4312-133">Пользователи могут запустить это средство, выполнив поиск по строке "Калибровка цвета".</span><span class="sxs-lookup"><span data-stu-id="d4312-133">Users can run this tool by searching for "calibrate color".</span></span> <span data-ttu-id="d4312-134">Для конкретных мониторов, автоматизирующих этот процесс, также определены четко определенные цветовые профили.</span><span class="sxs-lookup"><span data-stu-id="d4312-134">There are also well-defined color profiles for particular monitors that automate this process.</span></span> <span data-ttu-id="d4312-135">Инструмент «калибровка цвета» может обнаружить эти новые мониторы и информировать пользователей о том, что калибровка уже существует.</span><span class="sxs-lookup"><span data-stu-id="d4312-135">The "calibrate color" tool can detect these newer monitors, and inform users that calibration is already in place.</span></span>

<span data-ttu-id="d4312-136">Это понятие о кодировании закона по питанию в значениях цвета полезно в других местах графического конвейера, особенно в текстурах.</span><span class="sxs-lookup"><span data-stu-id="d4312-136">This notion of encoding a power law into color values is useful elsewhere in the graphics pipeline too, especially in textures.</span></span> <span data-ttu-id="d4312-137">Для текстур требуется больше точности на темных цветах из-за ответа от логарифмического глаз, о котором мы только что говорили.</span><span class="sxs-lookup"><span data-stu-id="d4312-137">For textures, you want more precision on darker colors because of the logarithmic human eye response we just talked about.</span></span> <span data-ttu-id="d4312-138">Тщательная обработка гаммы в этой части конвейера очень важна.</span><span class="sxs-lookup"><span data-stu-id="d4312-138">Careful handling of gamma in this part of the pipeline is important.</span></span> <span data-ttu-id="d4312-139">Дополнительные сведения см. [в разделе Преобразование данных для цветового пространства](converting-data-color-space.md).</span><span class="sxs-lookup"><span data-stu-id="d4312-139">For more info, see [Converting data for the color space](converting-data-color-space.md).</span></span>

<span data-ttu-id="d4312-140">Оставшаяся часть этого раздела посвящена только коррекции гаммы в последней части конвейера между данными буфера кадров и монитором.</span><span class="sxs-lookup"><span data-stu-id="d4312-140">The remainder of this topic focuses only on gamma correction in this last part of the pipeline, between the frame buffer data and the monitor.</span></span> <span data-ttu-id="d4312-141">Если вы хотите написать Мастер калибровки или создать специальные эффекты в полноэкранном приложении, где этап последующей обработки не является практичным, то необходимо выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="d4312-141">If you want to write a calibration wizard or to create special effects in a full-screen app where a post-processing step is not practical, here is the info you need.</span></span>

## <a name="background-of-gamma-on-windows"></a><span data-ttu-id="d4312-142">Фон гаммы в Windows</span><span class="sxs-lookup"><span data-stu-id="d4312-142">Background of gamma on Windows</span></span>

<span data-ttu-id="d4312-143">Компьютеры Windows обычно имеют таблицу гаммы, которая является таблицей подстановки, которая принимает Triplet байт и выводит Triplet байт.</span><span class="sxs-lookup"><span data-stu-id="d4312-143">Windows computers typically have a gamma table that is a lookup table that takes a triplet of bytes and outputs a triplet of bytes.</span></span> <span data-ttu-id="d4312-144">Эти триады 768 (256 x 3) байт ОЗУ.</span><span class="sxs-lookup"><span data-stu-id="d4312-144">These triplets are 768 (256 x 3) bytes of RAM.</span></span> <span data-ttu-id="d4312-145">Это нормально, если формат просмотра содержит Triplet значений RGB, но недостаточно выразительным для описания преобразований, которые могут потребоваться, если формат представления превышает значение \[ 0, 1 \] , например значения с плавающей запятой.</span><span class="sxs-lookup"><span data-stu-id="d4312-145">This is fine when your display format contains a triplet of RGB BYTE values but isn't expressive enough to describe the transformations that you might want when the display format has a greater range than \[0,1\], such as floating point values.</span></span> <span data-ttu-id="d4312-146">API-интерфейсы в Windows, контролирующие гамму, следуют эволюции, так как форматы вывода стали более сложными.</span><span class="sxs-lookup"><span data-stu-id="d4312-146">The APIs in Windows that control gamma have followed an evolution as display formats have become more complex.</span></span>

<span data-ttu-id="d4312-147">Первый интерфейс API Windows для предложения гамма-управления — это [**Сетдевицегаммарамп**](/windows/win32/api/wingdi/nf-wingdi-setdevicegammaramp) Windows интерфейс графических устройств (GDI) и [**жетдевицегаммарамп**](/windows/win32/api/wingdi/nf-wingdi-getdevicegammaramp).</span><span class="sxs-lookup"><span data-stu-id="d4312-147">The first Windows APIs to offer gamma control are Windows Graphics Device Interface (GDI)’s [**SetDeviceGammaRamp**](/windows/win32/api/wingdi/nf-wingdi-setdevicegammaramp) and [**GetDeviceGammaRamp**](/windows/win32/api/wingdi/nf-wingdi-getdevicegammaramp).</span></span> <span data-ttu-id="d4312-148">Эти API-интерфейсы работают с входными массивами слов 3 256, при этом каждое слово кодируется с нуля до одного, представленного значениями 0 и 65535.</span><span class="sxs-lookup"><span data-stu-id="d4312-148">These APIs work with three 256-entry arrays of WORDs, with each WORD encoding zero up to one, represented by WORD values 0 and 65535.</span></span> <span data-ttu-id="d4312-149">Очень точность слова, как правило, недоступна в реальных таблицах подстановки оборудования, но эти API-интерфейсы должны быть гибкими.</span><span class="sxs-lookup"><span data-stu-id="d4312-149">The extra precision of a WORD typically isn’t available in actual hardware lookup tables, but these APIs were intended to be flexible.</span></span> <span data-ttu-id="d4312-150">Эти API, в отличие от других, описанных далее в этом разделе, позволяют разрешить небольшое отклонение от функции IDENTITY.</span><span class="sxs-lookup"><span data-stu-id="d4312-150">These APIs, in contrast to the others described later in this section, allow only a small deviation from an identity function.</span></span> <span data-ttu-id="d4312-151">На самом деле любая запись в пандус должна быть в пределах 32768 значения идентификатора.</span><span class="sxs-lookup"><span data-stu-id="d4312-151">In fact, any entry in the ramp must be within 32768 of the identity value.</span></span> <span data-ttu-id="d4312-152">Это ограничение означает, что ни одно из приложений не может полностью черный экран или какой-либо другой нечитаемый цвет.</span><span class="sxs-lookup"><span data-stu-id="d4312-152">This restriction means that no app can turn the display completely black or to some other unreadable color.</span></span>

<span data-ttu-id="d4312-153">Следующий API — это [**Сетгаммарамп**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setgammaramp)Microsoft Direct3D 9, который соответствует тем же шаблону и формату данных, что и [**сетдевицегаммарамп**](/windows/win32/api/wingdi/nf-wingdi-setdevicegammaramp).</span><span class="sxs-lookup"><span data-stu-id="d4312-153">The next API is Microsoft Direct3D 9’s [**SetGammaRamp**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setgammaramp), which follows the same pattern and data format as [**SetDeviceGammaRamp**](/windows/win32/api/wingdi/nf-wingdi-setdevicegammaramp).</span></span> <span data-ttu-id="d4312-154">Значение по умолчанию гамма-шкалы Direct3D 9 не особенно полезно. Это кратность слов, инициализированных в 0-255, а не 0-65535, даже несмотря на то, что API определен с точки зрения 0-65535.</span><span class="sxs-lookup"><span data-stu-id="d4312-154">The default value of the Direct3D 9 gamma ramp is not particularly useful; it is a ramp of WORDs initialized to 0-255, not 0-65535, even though the API is defined in terms of 0-65535.</span></span>

<span data-ttu-id="d4312-155">Последняя версия API — [**идксгиаутпут:: сетгаммаконтрол**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-setgammacontrol).</span><span class="sxs-lookup"><span data-stu-id="d4312-155">The latest API is [**IDXGIOutput::SetGammaControl**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-setgammacontrol).</span></span> <span data-ttu-id="d4312-156">Этот API имеет более гибкую схему, чтобы выразить гамма-управление, так как увеличенный набор форматов экрана папке DXGI, включая десять целых бит на канал, 16-битные форматы с плавающей запятой и \_ формат расширенного диапазона смещения XR.</span><span class="sxs-lookup"><span data-stu-id="d4312-156">This API has a more flexible scheme to express gamma control, as befits DXGI’s increased set of display formats, including ten integer bits-per-channel, 16-bit float formats and the XR\_BIAS extended range format.</span></span>

<span data-ttu-id="d4312-157">Все эти API работают на одном и том же оборудовании и изменяют одни и те же значения.</span><span class="sxs-lookup"><span data-stu-id="d4312-157">All of these APIs operate on the same hardware, and change the same values.</span></span> <span data-ttu-id="d4312-158">API-интерфейсы Direct3D 9 и DXGI доступны только для записи.</span><span class="sxs-lookup"><span data-stu-id="d4312-158">The Direct3D 9 and DXGI APIs are “write only”.</span></span> <span data-ttu-id="d4312-159">Невозможно прочитать значение оборудования, изменить его, а затем задать.</span><span class="sxs-lookup"><span data-stu-id="d4312-159">You can't read the value of the hardware, modify it, and then set it.</span></span> <span data-ttu-id="d4312-160">Можно задать только пандус.</span><span class="sxs-lookup"><span data-stu-id="d4312-160">You can only set the ramp.</span></span> <span data-ttu-id="d4312-161">Кроме того, гамма может быть задана только при полноэкранном режиме приложения.</span><span class="sxs-lookup"><span data-stu-id="d4312-161">Furthermore, you can only set gamma when the app is full screen.</span></span> <span data-ttu-id="d4312-162">Это ограничение является еще одним способом гарантировать, что рабочий стол всегда читается.</span><span class="sxs-lookup"><span data-stu-id="d4312-162">This restriction is another way to guarantee that the desktop is always readable.</span></span> <span data-ttu-id="d4312-163">Это значит, что приложение может завладеть собственным экраном, но Windows восстановит предыдущую гамму-шкалу при потере приложением полного экрана (например, через Alt-Tab или Ctrl-Alt-Del).</span><span class="sxs-lookup"><span data-stu-id="d4312-163">That is, the app can disturb its own display, but Windows will restore the previous gamma ramp when the app loses full screen (for example, via alt-tab or ctrl-alt-del).</span></span>

## <a name="evolution-of-display-hardware"></a><span data-ttu-id="d4312-164">Развитие аппаратного обеспечения экрана</span><span class="sxs-lookup"><span data-stu-id="d4312-164">Evolution of display hardware</span></span>

<span data-ttu-id="d4312-165">Некоторые новые мониторы могут отображать широкий диапазон интенситиес.</span><span class="sxs-lookup"><span data-stu-id="d4312-165">Some newer monitors can display a wide range of intensities.</span></span> <span data-ttu-id="d4312-166">Однако, если формат отображения может представлять только значения от 0 до одного, то отображение должно отображать ноль в самом темном значении, а другое — в самом светлом значении.</span><span class="sxs-lookup"><span data-stu-id="d4312-166">But, when the display format can represent only values between zero and one, the display must map zero to its darkest value and one to its brightest value.</span></span> <span data-ttu-id="d4312-167">Это самое яркое значение может оказаться слишком ярким для удобного просмотра веб-страниц с черным текстом на белом фоне, но это замечательно для более ярких специальных эффектов, таких как просмотр солнечного света, глиттеринг с помощью Lake или молнии.</span><span class="sxs-lookup"><span data-stu-id="d4312-167">This brightest value might be far too bright for comfortable viewing of Web pages with black text on a white background but is wonderful for over-bright special effects, such as viewing sunlight glittering off of a lake or lightning forking the sky.</span></span> <span data-ttu-id="d4312-168">Поэтому нам нужен способ выразить эти более широкие диапазоны.</span><span class="sxs-lookup"><span data-stu-id="d4312-168">So, we need a way to express these wider ranges.</span></span> <span data-ttu-id="d4312-169">В DXGI 1,1 и более поздних версиях содержатся значения формата отображения, которые позволяют 1,0 представлять удобное значение белого и зарезервировать более широкие значения формата отображения для более яркого применения специальных эффектов.</span><span class="sxs-lookup"><span data-stu-id="d4312-169">DXGI 1.1 and later contains display format values that let 1.0 represent a comfortable white value and reserves wider display format values for over-bright special effects.</span></span> <span data-ttu-id="d4312-170">DXGI 1,1 поддерживает два формата экрана, которые могут выражать эти более широкие значения: \_ \_ R10G10B10 \_ XR \_ смещение \_ a2 \_ UNORM и 16-разрядный с плавающей запятой.</span><span class="sxs-lookup"><span data-stu-id="d4312-170">DXGI 1.1 supports two display formats that can express these wider values: DXGI\_FORMAT\_R10G10B10\_XR\_BIAS\_A2\_UNORM and 16-bit floating point.</span></span> <span data-ttu-id="d4312-171">Полное описание этих форматов см. [в разделе подробные сведения о расширенном формате](/windows-hardware/drivers/display/details-of-the-extended-format).</span><span class="sxs-lookup"><span data-stu-id="d4312-171">For a full discussion of these formats, see [Details of the Extended Format](/windows-hardware/drivers/display/details-of-the-extended-format).</span></span> <span data-ttu-id="d4312-172">Далее мы рассмотрим, почему в API-интерфейсе [**идксгиаутпут:: сетгаммаконтрол**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-setgammacontrol) для функции DXGI требуются значения пикселей, превышающие 1,0.</span><span class="sxs-lookup"><span data-stu-id="d4312-172">Next, we look at why DXGI’s [**IDXGIOutput::SetGammaControl**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-setgammacontrol) gamma API needs pixel values greater than 1.0.</span></span>

## <a name="gamma-control-capabilities-in-dxgi"></a><span data-ttu-id="d4312-173">Возможности управления гаммами в DXGI</span><span class="sxs-lookup"><span data-stu-id="d4312-173">Gamma control capabilities in DXGI</span></span>

<span data-ttu-id="d4312-174">Функция DXGI позволяет драйверу дисплея выражать свои элементы управления гамма в качестве пошаговой линейной функции.</span><span class="sxs-lookup"><span data-stu-id="d4312-174">DXGI lets the display driver express its gamma controls as a step-wise linear function.</span></span> <span data-ttu-id="d4312-175">Эта линейная функция, ориентированная на пошаговую функцию, определяется контрольными точками этой функции, диапазоном значений, в которые функция может преобразовать, и дополнительными дополнительными операциями масштабирования и смещения, которые можно применить после преобразования.</span><span class="sxs-lookup"><span data-stu-id="d4312-175">This step-wise linear function is defined by the control points of this function, the range of values the function can convert to, and an additional optional scale-and-offset operation that can be applied after conversion.</span></span> <span data-ttu-id="d4312-176">Приложение может вызвать метод [**идксгиаутпут:: жетгаммаконтролкапабилитиес**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-getgammacontrolcapabilities) для получения всех этих возможностей управления в структуре [**\_ \_ \_ возможностей управления "гамма DXGI**](/previous-versions/windows/desktop/legacy/bb173062(v=vs.85)) ".</span><span class="sxs-lookup"><span data-stu-id="d4312-176">An app can call the [**IDXGIOutput::GetGammaControlCapabilities**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-getgammacontrolcapabilities) method to retrieve all of these control capabilities in the [**DXGI\_GAMMA\_CONTROL\_CAPABILITIES**](/previous-versions/windows/desktop/legacy/bb173062(v=vs.85)) structure.</span></span>

<span data-ttu-id="d4312-177">На этом графике показана линейная функция с четырьмя контрольными точками.</span><span class="sxs-lookup"><span data-stu-id="d4312-177">This graph shows a linear function with just four control points.</span></span>

![линейная функция коррекции гаммы](images/gamma-linear-function.png)

<span data-ttu-id="d4312-179">DXGI определяет контрольные точки по их расположению вдоль цветовой оси поверхности.</span><span class="sxs-lookup"><span data-stu-id="d4312-179">DXGI defines control points by their location along the surface color axis.</span></span> <span data-ttu-id="d4312-180">На приведенном выше графике расположение контрольных точек равно 0, 0,5, 0,75 и 1,0.</span><span class="sxs-lookup"><span data-stu-id="d4312-180">In the preceding graph, the locations of the control points are 0, 0.5, 0.75 and 1.0.</span></span> <span data-ttu-id="d4312-181">Эти контрольные точки указывают на то, что оборудование может преобразовывать значения в диапазоне от 0 до 1,0.</span><span class="sxs-lookup"><span data-stu-id="d4312-181">These control points indicate that the hardware can convert values in the range 0 through 1.0.</span></span> <span data-ttu-id="d4312-182">DXGI перечисляет эти контрольные точки в элементе массива **контролпоинтпоситионс** в [**\_ \_ \_ возможностях контроля гаммы DXGI**](/previous-versions/windows/desktop/legacy/bb173062(v=vs.85)) и всегда объявляет их в порядке возрастания.</span><span class="sxs-lookup"><span data-stu-id="d4312-182">DXGI lists these control points in the **ControlPointPositions** array member of [**DXGI\_GAMMA\_CONTROL\_CAPABILITIES**](/previous-versions/windows/desktop/legacy/bb173062(v=vs.85)) and always declares them in increasing order.</span></span> <span data-ttu-id="d4312-183">Функция DXGI заполняет только первые элементы массива **контролпоинтпоситионс** и указывает количество элементов с элементом **нумгаммаконтролпоинтс** **\_ \_ \_ возможностей элемента управления "гамма DXGI**".</span><span class="sxs-lookup"><span data-stu-id="d4312-183">DXGI fills only the first elements of the **ControlPointPositions** array and indicates the number of elements with the **NumGammaControlPoints** member of **DXGI\_GAMMA\_CONTROL\_CAPABILITIES**.</span></span> <span data-ttu-id="d4312-184">Если **нумгаммаконтролпоинтс** меньше 1025, то DXGI оставляет остальные элементы **контролпоинтпоситионс** неопределенными.</span><span class="sxs-lookup"><span data-stu-id="d4312-184">If **NumGammaControlPoints** is less than 1025, DXGI leaves the rest of the **ControlPointPositions** elements undefined.</span></span>

<span data-ttu-id="d4312-185">Оборудование, представленное этим графом, может преобразовывать значения в диапазон от 0 до 1,25.</span><span class="sxs-lookup"><span data-stu-id="d4312-185">The hardware represented by this graph can convert values to a range of 0 through 1.25.</span></span> <span data-ttu-id="d4312-186">Таким образом, DXGI присваивает элементам **минконвертедвалуе** и **максконвертедвалуе** 0,0 f и 1,25 f соответственно.</span><span class="sxs-lookup"><span data-stu-id="d4312-186">So, DXGI sets the **MinConvertedValue** and **MaxConvertedValue** members to 0.0f and 1.25f respectively.</span></span>

<span data-ttu-id="d4312-187">DXGI задает элемент **скалеандоффсетсуппортед** в [**\_ \_ \_ возможностях гамма-управления DXGI**](/previous-versions/windows/desktop/legacy/bb173062(v=vs.85)) , чтобы указать, поддерживает ли оборудование возможность масштабирования и смещения.</span><span class="sxs-lookup"><span data-stu-id="d4312-187">DXGI sets the **ScaleAndOffsetSupported** member of [**DXGI\_GAMMA\_CONTROL\_CAPABILITIES**](/previous-versions/windows/desktop/legacy/bb173062(v=vs.85)) to indicate whether the hardware supports the scale-and-offset capability.</span></span> <span data-ttu-id="d4312-188">Если оборудование поддерживает масштабирование и смещение, оно сохраняет простую таблицу подстановки, но затем корректирует выходные данные таблицы для растяжения выходных данных в диапазон, превышающий \[ 0, 1 \] .</span><span class="sxs-lookup"><span data-stu-id="d4312-188">If hardware supports scale-and-offset, it keeps a simple one-to-one lookup table but then adjusts the output of the table to stretch the output to a range greater than \[0,1\].</span></span> <span data-ttu-id="d4312-189">Оборудование сначала Масштабирует значения, выходящие за пределы таблицы подстановки, а затем смещает их.</span><span class="sxs-lookup"><span data-stu-id="d4312-189">The hardware first scales the values that come out of the lookup table and then offsets them.</span></span>

> [!Note]  
> <span data-ttu-id="d4312-190">Различные мониторы, подключенные к одному и тому же компьютеру, могут иметь различные возможности управления гаммами.</span><span class="sxs-lookup"><span data-stu-id="d4312-190">Different monitors connected to the same computer might have different gamma control capabilities.</span></span> <span data-ttu-id="d4312-191">Более того, возможности управления гамма-контроля могут фактически изменяться в зависимости от режима вывода.</span><span class="sxs-lookup"><span data-stu-id="d4312-191">Moreover, the gamma control capabilities can in fact change depending on the display mode of the output.</span></span> <span data-ttu-id="d4312-192">Следовательно, рекомендуется всегда вызывать [**идксгиаутпут:: жетгаммаконтролкапабилитиес**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-getgammacontrolcapabilities) , чтобы запрашивать возможности управления гамма-функции, когда приложение переходит в полноэкранный режим.</span><span class="sxs-lookup"><span data-stu-id="d4312-192">Consequently, we recommend that you always call [**IDXGIOutput::GetGammaControlCapabilities**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-getgammacontrolcapabilities) to query gamma control capabilities after your app enters full-screen mode.</span></span>

 

<span data-ttu-id="d4312-193">Эти значения возможностей управления гаммами можно использовать для получения значений элементов управления, которые затем можно задать с помощью API [**идксгиаутпут:: сетгаммаконтрол**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-setgammacontrol) .</span><span class="sxs-lookup"><span data-stu-id="d4312-193">You can use these gamma control capability values to derive control values that you can then set by using the [**IDXGIOutput::SetGammaControl**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-setgammacontrol) API.</span></span>

## <a name="setting-gamma-control-with-dxgi"></a><span data-ttu-id="d4312-194">Установка элемента управления гамма с помощью DXGI</span><span class="sxs-lookup"><span data-stu-id="d4312-194">Setting gamma control with DXGI</span></span>

<span data-ttu-id="d4312-195">Чтобы установить элементы управления гаммы, передайте указатель на [**структуру \_ \_ управления гаммы DXGI**](/previous-versions/windows/desktop/legacy/bb173061(v=vs.85)) при вызове API [**идксгиаутпут:: сетгаммаконтрол**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-setgammacontrol) .</span><span class="sxs-lookup"><span data-stu-id="d4312-195">To set gamma controls, you pass a pointer to a [**DXGI\_GAMMA\_CONTROL**](/previous-versions/windows/desktop/legacy/bb173061(v=vs.85)) structure when you call the [**IDXGIOutput::SetGammaControl**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-setgammacontrol) API.</span></span>

<span data-ttu-id="d4312-196">Элементы **Scale** и **offset** [**\_ \_ элемента управления "гамма**](/previous-versions/windows/desktop/legacy/bb173061(v=vs.85)) " объекта DXGI задаются для указания значений масштаба и смещения, которые должны применяться оборудованием к значениям, получаемым из таблицы подстановки.</span><span class="sxs-lookup"><span data-stu-id="d4312-196">You set the **Scale** and **Offset** members of [**DXGI\_GAMMA\_CONTROL**](/previous-versions/windows/desktop/legacy/bb173061(v=vs.85)) to specify the scale and offset values that you want the hardware to apply to the values that you get from the lookup table.</span></span> <span data-ttu-id="d4312-197">Можно безопасно установить **масштаб** равным 1 и выполнить **смещение** до нуля (т. е. масштаб на один не влияет, а смещение от нуля не оказывает никакого влияния), если вы не хотите использовать функцию масштабирования и смещения, или если оборудование не имеет такой возможности.</span><span class="sxs-lookup"><span data-stu-id="d4312-197">You can safely set **Scale** to 1 and **Offset** to zero (that is, a scale by one has no effect and an offset of zero has no effect) if you don't want to use the scale-and-offset capability or if the hardware doesn't have that capability.</span></span>

<span data-ttu-id="d4312-198">Вы устанавливаете элемент массива **гаммакурве** в [**\_ \_ элементе управления "гамма-характеристики" DXGI**](/previous-versions/windows/desktop/legacy/bb173061(v=vs.85)) в список структур [**\_ RGB**](/previous-versions/windows/desktop/legacy/bb173071(v=vs.85)) в режиме DXGI для точек на кривой гаммы.</span><span class="sxs-lookup"><span data-stu-id="d4312-198">You set the **GammaCurve** array member of [**DXGI\_GAMMA\_CONTROL**](/previous-versions/windows/desktop/legacy/bb173061(v=vs.85)) to a list of [**DXGI\_RGB**](/previous-versions/windows/desktop/legacy/bb173071(v=vs.85)) structures for the points on the gamma curve.</span></span> <span data-ttu-id="d4312-199">Каждый **элемент \_ RGB в DXGI** определяет значения с плавающей запятой, представляющие красный, зеленый и синий компоненты для этой точки.</span><span class="sxs-lookup"><span data-stu-id="d4312-199">Each **DXGI\_RGB** element specifies the float values that represent the red, green, and blue components for that point.</span></span> <span data-ttu-id="d4312-200">Кривая гамма не использует альфа-значения.</span><span class="sxs-lookup"><span data-stu-id="d4312-200">The gamma curve doesn't use alpha values.</span></span> <span data-ttu-id="d4312-201">Для заполнения этого числа элементов в массиве **гаммакурве** используется число, полученное от **нумгаммаконтролпоинтс** элементов [**\_ управления "гамма-характеристики \_ \_**](/previous-versions/windows/desktop/legacy/bb173062(v=vs.85)) ".</span><span class="sxs-lookup"><span data-stu-id="d4312-201">You use the number that you obtained from **NumGammaControlPoints** of [**DXGI\_GAMMA\_CONTROL\_CAPABILITIES**](/previous-versions/windows/desktop/legacy/bb173062(v=vs.85)) to fill that number of elements in the **GammaCurve** array.</span></span> <span data-ttu-id="d4312-202">Каждый элемент, помещаемый в массив **гаммакурве** , является высотой каждой контрольной точки.</span><span class="sxs-lookup"><span data-stu-id="d4312-202">Each element that you place in the **GammaCurve** array is the height for each control point.</span></span>

<span data-ttu-id="d4312-203">Обратите внимание, что в приведенном выше графе теперь вы управляете вертикальным размещением каждой контрольной точки, и у вас есть отдельный элемент управления для красного, зеленого и синего.</span><span class="sxs-lookup"><span data-stu-id="d4312-203">Notice in the preceding graph that you now have control over the vertical placement of each control point, and you have separate control for red, green and blue.</span></span> <span data-ttu-id="d4312-204">Например, можно задать для всех зеленых и синих значений нулевое значение и установить для красного цвета в виде одной лестницы с нуля до одного.</span><span class="sxs-lookup"><span data-stu-id="d4312-204">For example, you can set all of the green and blue values to zero and set the red values to an ascending staircase from zero to one.</span></span> <span data-ttu-id="d4312-205">В этом случае отображаемое изображение отображает только красные части, синие и зеленые — черным цветом.</span><span class="sxs-lookup"><span data-stu-id="d4312-205">In this scenario, the displayed image shows only its red parts, with the blue and green appearing as black.</span></span> <span data-ttu-id="d4312-206">Можно также задать нисходящий лестницой для всех цветов, что приводит к инвертированному отображению.</span><span class="sxs-lookup"><span data-stu-id="d4312-206">You can also set a descending staircase for all colors, which results in an inverted display.</span></span> <span data-ttu-id="d4312-207">Любое значение, помещаемое в массив **гаммакурве** , должно быть инклюзивным в пределах значений, полученных из членов **минконвертедвалуе** и **максконвертедвалуе** [**\_ возможностей управления "гамма" \_ \_ функции DXGI**](/previous-versions/windows/desktop/legacy/bb173062(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="d4312-207">Any value you place in the **GammaCurve** array must be inclusively within the values you obtained from the **MinConvertedValue** and **MaxConvertedValue** members of [**DXGI\_GAMMA\_CONTROL\_CAPABILITIES**](/previous-versions/windows/desktop/legacy/bb173062(v=vs.85)).</span></span>

## <a name="gamma-control-practicalities"></a><span data-ttu-id="d4312-208">Практические рекомендации по контролю гаммы</span><span class="sxs-lookup"><span data-stu-id="d4312-208">Gamma control practicalities</span></span>

<span data-ttu-id="d4312-209">Элементы управления "гамма" для DXGI применяются только в том случае, если приложение находится во весь экран.</span><span class="sxs-lookup"><span data-stu-id="d4312-209">DXGI’s gamma controls apply only as long as the app is full screen.</span></span> <span data-ttu-id="d4312-210">Windows восстанавливает предыдущее состояние отображения, когда приложение завершает работу или возвращается в оконный режим.</span><span class="sxs-lookup"><span data-stu-id="d4312-210">Windows restores the previous state of the display when the app exits or returns to windowed mode.</span></span> <span data-ttu-id="d4312-211">Но Windows не восстанавливает состояние гаммы приложения, если приложение повторно входит в полноэкранный режим.</span><span class="sxs-lookup"><span data-stu-id="d4312-211">But Windows doesn’t restore your app’s gamma state if the app re-enters full-screen mode.</span></span> <span data-ttu-id="d4312-212">Приложение должно явно восстановить состояние гаммы при повторном входе в полноэкранный режим.</span><span class="sxs-lookup"><span data-stu-id="d4312-212">Your app must explicitly restore its gamma state when it re-enters full-screen mode.</span></span>

<span data-ttu-id="d4312-213">Не все адаптеры поддерживают гамма-управление.</span><span class="sxs-lookup"><span data-stu-id="d4312-213">Not all adapters support gamma control.</span></span> <span data-ttu-id="d4312-214">Если адаптер не поддерживает гамма-управление, он игнорирует вызовы для установки гамма-шкалы.</span><span class="sxs-lookup"><span data-stu-id="d4312-214">If an adapter doesn't support gamma control, it ignores calls to set a gamma ramp.</span></span>

<span data-ttu-id="d4312-215">Приложения, работающие под управлением удаленного рабочего стола, не могут управлять гаммой.</span><span class="sxs-lookup"><span data-stu-id="d4312-215">Apps that run under remote desktop can't control gamma at all.</span></span>

<span data-ttu-id="d4312-216">Курсор мыши, если он реализован в оборудовании (как и большинство), обычно не реагирует на параметр гаммы.</span><span class="sxs-lookup"><span data-stu-id="d4312-216">The mouse cursor, if it is implemented in hardware (as most are), typically doesn't respond to the gamma setting.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d4312-217">См. также</span><span class="sxs-lookup"><span data-stu-id="d4312-217">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d4312-218">Руководством по программированию для DXGI</span><span class="sxs-lookup"><span data-stu-id="d4312-218">Programming Guide for DXGI</span></span>](dx-graphics-dxgi-overviews.md)
</dt> </dl>

 

 
