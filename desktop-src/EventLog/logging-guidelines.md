---
description: Журналы событий хранят записи о значимых событиях от имени системы и приложений, выполняющихся в системе.
ms.assetid: 58a6569a-2775-4687-bf99-579fa4153191
title: Рекомендации по ведению журнала
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c1210757a7961d82d13d4887e40fbd3837b86138
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104156162"
---
# <a name="logging-guidelines"></a><span data-ttu-id="f9728-103">Рекомендации по ведению журнала</span><span class="sxs-lookup"><span data-stu-id="f9728-103">Logging Guidelines</span></span>

<span data-ttu-id="f9728-104">Журналы событий хранят записи о значимых событиях от имени системы и приложений, выполняющихся в системе.</span><span class="sxs-lookup"><span data-stu-id="f9728-104">Event logs store records of significant events on behalf of the system and applications running on the system.</span></span> <span data-ttu-id="f9728-105">Так как функции ведения журнала являются общим целям, необходимо решить, какие сведения поддаются журналу.</span><span class="sxs-lookup"><span data-stu-id="f9728-105">Because the logging functions are general purpose, you must decide what information is appropriate to log.</span></span> <span data-ttu-id="f9728-106">Как правило, следует заносить в журнал только те данные, которые могут оказаться полезными при диагностике проблем с оборудованием или программным обеспечением.</span><span class="sxs-lookup"><span data-stu-id="f9728-106">Generally, you should log only information that could be useful in diagnosing a hardware or software problem.</span></span> <span data-ttu-id="f9728-107">Ведение журнала событий не предназначено для использования в качестве средства трассировки.</span><span class="sxs-lookup"><span data-stu-id="f9728-107">Event logging is not intended to be used as a tracing tool.</span></span>

## <a name="choosing-events-to-log"></a><span data-ttu-id="f9728-108">Выбор событий для записи в журнал</span><span class="sxs-lookup"><span data-stu-id="f9728-108">Choosing Events to Log</span></span>

<span data-ttu-id="f9728-109">Ниже приведены примеры случаев, когда может быть полезно ведение журнала событий.</span><span class="sxs-lookup"><span data-stu-id="f9728-109">The following are examples of cases in which event logging can be helpful:</span></span>

-   <span data-ttu-id="f9728-110">Проблемы с ресурсами.</span><span class="sxs-lookup"><span data-stu-id="f9728-110">Resource problems.</span></span> <span data-ttu-id="f9728-111">Регистрация события предупреждения при сбое выделения памяти может помочь определить причину нехватки памяти.</span><span class="sxs-lookup"><span data-stu-id="f9728-111">Logging a Warning event when memory allocation fails can help indicate the cause of a low-memory situation.</span></span>
-   <span data-ttu-id="f9728-112">Проблемы оборудования.</span><span class="sxs-lookup"><span data-stu-id="f9728-112">Hardware problems.</span></span> <span data-ttu-id="f9728-113">Если драйвер устройства обнаруживает время ожидания контроллера диска, сбой питания в параллельном порте или ошибку данных из сетевой или последовательной карты, драйвер устройства может записывать сведения об этих событиях, чтобы помочь системному администратору диагностировать проблемы с оборудованием.</span><span class="sxs-lookup"><span data-stu-id="f9728-113">If a device driver encounters a disk controller time-out, a power failure in a parallel port, or a data error from a network or serial card, the device driver can log information about these events to help the system administrator diagnose hardware problems.</span></span>
-   <span data-ttu-id="f9728-114">Поврежденные сектора.</span><span class="sxs-lookup"><span data-stu-id="f9728-114">Bad sectors.</span></span> <span data-ttu-id="f9728-115">Если драйвер диска встречает поврежденный сектор, он может выполнить чтение или запись в сектор после повторного выполнения операции, но сектор будет неудачным.</span><span class="sxs-lookup"><span data-stu-id="f9728-115">If a disk driver encounters a bad sector, it may be able to read from or write to the sector after retrying the operation, but the sector will go bad eventually.</span></span> <span data-ttu-id="f9728-116">Если драйвер диска может продолжать работу, он должен заносить в журнал событие предупреждения; в противном случае он должен зарегистрировать событие ошибки.</span><span class="sxs-lookup"><span data-stu-id="f9728-116">If the disk driver can proceed, it should log a Warning event; otherwise, it should log an Error event.</span></span> <span data-ttu-id="f9728-117">Если драйвер файловой системы находит большое количество поврежденных секторов и устраняет их, администратор может определить, что диск может быть неудачным.</span><span class="sxs-lookup"><span data-stu-id="f9728-117">If a file system driver finds a large number of bad sectors and fixes them, logging Warning events might help an administrator determine that the disk may be about to fail.</span></span>
-   <span data-ttu-id="f9728-118">Информационные события.</span><span class="sxs-lookup"><span data-stu-id="f9728-118">Information events.</span></span> <span data-ttu-id="f9728-119">Серверное приложение (например, сервер базы данных) регистрирует вход пользователя в систему, открывает базу данных или запускает перенос файлов.</span><span class="sxs-lookup"><span data-stu-id="f9728-119">A server application (such as a database server) records a user logging on, opening a database, or starting a file transfer.</span></span> <span data-ttu-id="f9728-120">Сервер также может регистрировать другие события, такие как ошибки (доступ к файлу, хост-процесс отключен и т. д.), повреждение базы данных или успешное перемещение файла.</span><span class="sxs-lookup"><span data-stu-id="f9728-120">The server can also log other events such as errors (cannot access file, host process disconnected, and so on), database corruption, or whether a file transfer was successful.</span></span>

## <a name="writing-messages"></a><span data-ttu-id="f9728-121">Создание сообщений</span><span class="sxs-lookup"><span data-stu-id="f9728-121">Writing Messages</span></span>

<span data-ttu-id="f9728-122">Сообщения должны иметь смысл для администраторов и пользователей, пытающихся устранить проблему.</span><span class="sxs-lookup"><span data-stu-id="f9728-122">Messages should make sense to administrators and users who are trying to troubleshoot a problem.</span></span> <span data-ttu-id="f9728-123">Сообщение должно содержать всю информацию, необходимую для того, чтобы понять причину проблемы и способ ее устранения.</span><span class="sxs-lookup"><span data-stu-id="f9728-123">A message should contain all the information needed to understand what caused the problem and how to correct it.</span></span>

<span data-ttu-id="f9728-124">Не следует писать зашифрованное сообщение, например "Недопустимый пакет драйвера, полученный от подсистемы ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="f9728-124">Avoid writing a cryptic message such as "A driver packet received from the I/O subsystem was invalid.</span></span> <span data-ttu-id="f9728-125">Данные представляют собой пакет. Лучшее сообщение указывает на то, что рассматриваемый драйвер работает правильно, но записывает в журнал неправильно отформатированные пакеты.</span><span class="sxs-lookup"><span data-stu-id="f9728-125">The data is the packet."A better message would indicate that the driver in question is functioning properly, but is logging incorrectly formatted packets.</span></span> <span data-ttu-id="f9728-126">Можно сказать, что для устранения проблемы требуется версия драйвера для Юникода.</span><span class="sxs-lookup"><span data-stu-id="f9728-126">It could go on to say that a Unicode version of the driver is needed to correct the problem.</span></span> <span data-ttu-id="f9728-127">Дополнительные сведения о создании хороших сообщений об ошибках см. в разделе [рекомендации по сообщениям об ошибках](/windows/desktop/Debug/error-message-guidelines).</span><span class="sxs-lookup"><span data-stu-id="f9728-127">For more information about writing good error messages, see [Error Message Guidelines](/windows/desktop/Debug/error-message-guidelines).</span></span>

<span data-ttu-id="f9728-128">Не используйте в тексте сообщения символы табуляции и запятые, так как журналы событий могут быть сохранены в виде текстовых файлов с разделителями-запятыми или символами табуляции.</span><span class="sxs-lookup"><span data-stu-id="f9728-128">Do not use tabs or commas in the message text, because event logs can be saved as comma or tab-separated text files.</span></span> <span data-ttu-id="f9728-129">Во многих организациях эти файлы импортируются в базы данных, а для дополнительных символов форматирования потребуется ручная манипуляция.</span><span class="sxs-lookup"><span data-stu-id="f9728-129">Many organizations import these files into databases, and the extra formatting characters will require manual manipulation.</span></span>

<span data-ttu-id="f9728-130">При использовании имен UNC или других ссылок, содержащих пробелы, заключите имя в угловые скобки.</span><span class="sxs-lookup"><span data-stu-id="f9728-130">When using UNC names, or other links that contain spaces, enclose the name in angle brackets.</span></span> <span data-ttu-id="f9728-131">Например, <\\ \\ *ShareName* \\ *имя_сервера*>.</span><span class="sxs-lookup"><span data-stu-id="f9728-131">For example, <\\\\*sharename*\\*servername*>.</span></span> <span data-ttu-id="f9728-132">Можно записать URL-адрес в конец сообщения, указывающего на пользователя на связанный справочный материал.</span><span class="sxs-lookup"><span data-stu-id="f9728-132">You can write a URL to the end of the message that points the user to related help material.</span></span> <span data-ttu-id="f9728-133">URL-адрес должен быть полным именем узла DNS.</span><span class="sxs-lookup"><span data-stu-id="f9728-133">The URL must be a fully qualified DNS host name.</span></span> <span data-ttu-id="f9728-134">Например, можно добавить в сообщения следующий текст: "Дополнительные сведения об этом сообщении см. на сайте поддержки по адресу https://www.microsoft.com/Support/ProdRedirect/ContentSearch.asp ".</span><span class="sxs-lookup"><span data-stu-id="f9728-134">For example, you could append the following text to your messages: "For additional information on this message, please visit our support site at https://www.microsoft.com/Support/ProdRedirect/ContentSearch.asp."</span></span> <span data-ttu-id="f9728-135">Ссылка приведет к переходу на страницу ASP, которая перенаправляет пользователя к содержимому, связанному с сообщением об ошибке.</span><span class="sxs-lookup"><span data-stu-id="f9728-135">The link would lead to an ASP page that redirects the user to content relating to the error message.</span></span> <span data-ttu-id="f9728-136">Он будет анализировать дополнительные параметры (передаются при щелчке URL-адреса), чтобы определить, куда перенаправлять пользователя.</span><span class="sxs-lookup"><span data-stu-id="f9728-136">It would parse additional parameters (passed when the URL is clicked) to determine where to redirect the user.</span></span>

<span data-ttu-id="f9728-137">Аргументы, передаваемые в функцию [**репортевент**](/windows/desktop/api/Winbase/nf-winbase-reporteventa) , добавляются к URL-адресу следующим образом:</span><span class="sxs-lookup"><span data-stu-id="f9728-137">The arguments passed to the [**ReportEvent**](/windows/desktop/api/Winbase/nf-winbase-reporteventa) function are appended to the URL as follows:</span></span>

``` syntax
strHTTPQuery += L"?EvtSrc=" + _strEscapedSource;
strHTTPQuery += L"&EvtCat=" + _strEscapedCategory;
strHTTPQuery += L"&EvtID=" + _strEscapedEventID;
strHTTPQuery += L"&EvtCatID=" + _strEscapedCategoryID;
strHTTPQuery += L"&EvtType=" + _strEscapedType;
strHTTPQuery += L"&EvtTypeID=" + _strEscapedTypeID;
strHTTPQuery += L"&EvtRptTime=" + _strEscapedDateAndTime;
strHTTPQuery += L"&EvtTZBias=" + _strEscapedTimeZoneBias;
```

<span data-ttu-id="f9728-138">Если название компании, название продукта, версия продукта, имя файла и версия файла из заголовка DLL сообщения для источника событий являются допустимыми, они также добавляются к URL-адресу:</span><span class="sxs-lookup"><span data-stu-id="f9728-138">If the company name, product name, product version, file name, and file version from the message DLL header for the event source are valid, they are also appended to the URL:</span></span>

``` syntax
ADD_VER_STR(L"CoName",   _strEscapedCompanyName);
ADD_VER_STR(L"ProdName", _strEscapedProductName);
ADD_VER_STR(L"ProdVer",  _strEscapedProductVersion);
ADD_VER_STR(L"FileName", _strEscapedFileName);
ADD_VER_STR(L"FileVer",  _strEscapedFileVersion);
```

## <a name="reducing-overhead"></a><span data-ttu-id="f9728-139">Уменьшение издержек</span><span class="sxs-lookup"><span data-stu-id="f9728-139">Reducing Overhead</span></span>

<span data-ttu-id="f9728-140">Ведение журнала событий потребляет такие ресурсы, как место на диске и время процессора.</span><span class="sxs-lookup"><span data-stu-id="f9728-140">Event logging consumes resources such as disk space and processor time.</span></span> <span data-ttu-id="f9728-141">Объем места на диске, требуемый для журнала событий, и дополнительная нагрузка для приложения, в котором регистрируются события, зависят от объема данных, выбранных для записи в журнал.</span><span class="sxs-lookup"><span data-stu-id="f9728-141">The amount of disk space that an event log requires and the overhead for an application that logs events depend on how much information you choose to log.</span></span> <span data-ttu-id="f9728-142">Поэтому важно записывать только важные сведения.</span><span class="sxs-lookup"><span data-stu-id="f9728-142">This is why it is important to log only essential information.</span></span> <span data-ttu-id="f9728-143">Также рекомендуется размещать вызовы регистрации событий в пути ошибок в коде, а не в основном коде кода, что приведет к снижению производительности.</span><span class="sxs-lookup"><span data-stu-id="f9728-143">It is also good to place event logging calls in an error path in the code rather than in the main code path, which would reduce performance.</span></span>

<span data-ttu-id="f9728-144">Объем дискового пространства, необходимый для каждой записи журнала событий, включает элементы структуры [**EVENTLOGRECORD**](/windows/desktop/api/Winnt/ns-winnt-eventlogrecord) .</span><span class="sxs-lookup"><span data-stu-id="f9728-144">The amount of disk space required for each event log record includes the members of the [**EVENTLOGRECORD**](/windows/desktop/api/Winnt/ns-winnt-eventlogrecord) structure.</span></span> <span data-ttu-id="f9728-145">Это структура переменной длины; строки и двоичные данные хранятся после структуры.</span><span class="sxs-lookup"><span data-stu-id="f9728-145">This is a variable length structure; strings and binary data are stored following the structure.</span></span>

 

 
