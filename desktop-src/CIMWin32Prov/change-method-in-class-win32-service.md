---
description: Изменяет \_ службу Win32.
ms.assetid: b32753c5-8fcf-44ee-a95f-e4f6076e0f28
ms.tgt_platform: multiple
title: Метод Change класса Win32_Service (Мбнапи. h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- Win32_Service.Change
api_type:
- COM
api_location:
- CIMWin32.dll
ms.openlocfilehash: ca513a31eded5202639da13b8e9f2e817c9df336b227ba93d903e44068b98898
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119440194"
---
# <a name="change-method-of-the-win32_service-class-mbnapih"></a>Метод Change класса Win32_Service (Мбнапи. h)

Метод класса **Change** [WMI](/windows/desktop/WmiSdk/retrieving-a-class) изменяет [**\_ службу Win32**](win32-service.md).

В этом разделе используется синтаксис MOF-файл (MOF). Дополнительные сведения об использовании этого метода см. [в разделе вызов метода](/windows/desktop/WmiSdk/calling-a-method).

## <a name="syntax"></a>Синтаксис


```mof
uint32 Change(
  [in] string  DisplayName,
  [in] string  PathName,
  [in] uint32  ServiceType,
  [in] uint32  ErrorControl,
  [in] string  StartMode,
  [in] boolean DesktopInteract,
  [in] string  StartName,
  [in] string  StartPassword,
  [in] string  LoadOrderGroup,
  [in] string  LoadOrderGroupDependencies[],
  [in] string  ServiceDependencies[]
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*DisplayName* \[ окне\]
</dt> <dd>

Отображаемое имя для службы. Максимальная длина этой строки равна 256 символам. В диспетчере управления службами имя сохраняется с учетом регистра. В сравнениях *DisplayName* всегда учитывается регистр.

Ограничения: принимает то же значение, что и свойство **Name** .

Например, "Атдиск".

</dd> <dt>

*Путь к файлу* \[ окне\]
</dt> <dd>

Полный путь к исполняемому файлу, реализующему службу, например " \\ СистемныйКорневойКаталог \\ system32 \\ Drivers \\afd.sys".

</dd> <dt>

*ServiceType* \[ окне\]
</dt> <dd>

Тип служб, предоставляемых процессам, которые их вызывают.

<dt>

1 (0x1)
</dt> <dd>

Драйвер ядра

</dd> <dt>

2 (0x2)
</dt> <dd>

Драйвер файловой системы

</dd> <dt>

4 (0x4)
</dt> <dd>

Адаптер

</dd> <dt>

8 (0x8)
</dt> <dd>

Драйвер распознавателя

</dd> <dt>

16 (0x10)
</dt> <dd>

Собственный процесс

</dd> <dt>

32 (0x20)
</dt> <dd>

Общий процесс

</dd> <dt>

256 (0x100)
</dt> <dd>

Интерактивный процесс

</dd> </dl> </dd> <dt>

*ErrorControl* \[ окне\]
</dt> <dd>

Серьезность ошибки, если не удается запустить службу во время запуска. Значение указывает действие, предпринимаемое программой запуска, если происходит сбой. Все ошибки регистрируются системой.

<dt>

<span id="Ignore"></span><span id="ignore"></span><span id="IGNORE"></span>

<span id="Ignore"></span><span id="ignore"></span><span id="IGNORE"></span>**Игнорировать** (0)


</dt> <dd>

Пользователь не получает уведомление.

</dd> <dt>

<span id="Normal"></span><span id="normal"></span><span id="NORMAL"></span>

<span id="Normal"></span><span id="normal"></span><span id="NORMAL"></span>**Обычная** (1)


</dt> <dd>

Нормальный. Пользователь получает уведомление.

</dd> <dt>

<span id="Severe"></span><span id="severe"></span><span id="SEVERE"></span>

<span id="Severe"></span><span id="severe"></span><span id="SEVERE"></span>**Серьезная** (2)


</dt> <dd>

Система перезапускается с последней удачной конфигурацией.

</dd> <dt>

<span id="Critical"></span><span id="critical"></span><span id="CRITICAL"></span>

<span id="Critical"></span><span id="critical"></span><span id="CRITICAL"></span>**Критическая** (3)


</dt> <dd>

Попытка перезапустить систему в рабочей конфигурации.

</dd> </dl> </dd> <dt>

*StartMode* \[ окне\]
</dt> <dd>

режим запуска базовой службы Windows. Дополнительные сведения см. в разделе "Замечания".

<dt>

Загрузка
</dt> <dd>

Драйвер устройства запущен загрузчиком операционной системы. Это значение допустимо только для служб драйверов.

</dd> <dt>

Система
</dt> <dd>

Драйвер устройства запущен процессом инициализации операционной системы. Это значение допустимо только для служб драйверов.

</dd> <dt>

Автоматически
</dt> <dd>

Служба запускается автоматически диспетчером управления службами во время запуска системы.

</dd> <dt>

Вручную
</dt> <dd>

Служба, запускаемая диспетчером управления службами, когда процесс вызывает метод [**StartService**](startservice-method-in-class-win32-service.md) .

</dd> <dt>

Выключено
</dt> <dd>

Служба, которая больше не может быть запущена.

</dd> </dl> </dd> <dt>

*Десктопинтеракт* \[ окне\]
</dt> <dd>

Если **значение — true**, служба может создавать окно на рабочем столе или взаимодействовать с ним.

</dd> <dt>

*StartName* \[ окне\]
</dt> <dd>

Имя учетной записи, в которой выполняется служба. В зависимости от типа службы имя учетной записи может быть в формате имя_домена \\ имя пользователя или. \\ Имен. Процесс службы будет заноситься в журнал с использованием одной из этих двух форм при запуске. Если учетная запись принадлежит к встроенному домену,. \\ Можно указать имя пользователя. Если указано **значение NULL** , служба будет входить в систему как учетная запись LocalSystem. Для драйверов ядра или системного уровня *StartName* содержит имя объекта драйвера (то есть \\ FileSystem \\ RDR или \\ Driver \\ КСНС), которое используется системой ввода и вывода для загрузки драйвера устройства. Если указано **значение NULL** , драйвер запускается с именем объекта по умолчанию, созданным системой ввода-вывода на основе имени службы, например "двдом \\ Admin".

Можно также использовать формат имени участника-пользователя (UPN) для указания **StartName**, например *Username@DomainName* .

</dd> <dt>

*Стартпассворд* \[ окне\]
</dt> <dd>

Пароль к имени учетной записи, заданному параметром *StartName* . Если пароль не изменяется, укажите **значение NULL** . Если служба не имеет пароля, указывается пустая строка.

> [!Note]  
> При изменении службы с локальной системы на сеть или из сети в локальную систему *стартпассворд* должен быть пустой строкой (""), а не **null**.

 

</dd> <dt>

*Лоадордерграуп* \[ окне\]
</dt> <dd>

Имя группы, с которой она связана. Группы порядка загрузки содержатся в системном реестре и определяют последовательность, в которой службы загружаются в операционную систему. Если указатель равен **null** или указывает на пустую строку, служба не принадлежит группе. Дополнительные сведения см. в разделе "Замечания".

Зависимости между группами должны быть перечислены в параметре *лоадордерграупдепенденЦиес* . Сначала запускаются службы в списке группы упорядочения нагрузки, а затем — службы в группах, которые не входят в список групп порядка загрузки, за которыми следуют службы, не входящие в группу. Системный реестр содержит список групп упорядочения нагрузки, расположенных по адресу:

**HKey \_ \_** \\  \\  \\  \\ **ServiceGroupOrder** управления CurrentControlSet системы локального компьютера

</dd> <dt>

*ЛоадордерграупдепенденЦиес* \[ окне\]
</dt> <dd>

Список групп упорядочивания нагрузки, которые должны быть запущены перед запуском этой службы. Массив завершается двойным **нулем.** Если указатель имеет **значение NULL** или указывает на пустую строку, служба не имеет зависимостей. Имена групп должны быть префиксом **\_ \_ идентификатора группы SC** (определенного в файле винсвк. h), чтобы отличать их от имен служб, так как службы и группы служб используют одно и то же пространство имен. Зависимость от группы означает, что эту службу можно запустить, если хотя бы один член группы запущен после попытки запуска всех членов группы.

</dd> <dt>

*СервицедепенденЦиес* \[ окне\]
</dt> <dd>

Список, содержащий имена служб, которые должны быть запущены перед запуском этой службы. Массив завершается двойным **нулем.** Если указатель имеет **значение NULL** или указывает на пустую строку, служба не имеет зависимостей. Зависимость от службы указывает, что эта служба может выполняться, только если запущена служба, от которой она зависит.

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Возвращает одно из значений, перечисленных в следующем списке, или любое другое значение, указывающее на ошибку. Дополнительные коды ошибок см. в разделе [**константы WMI Error**](/windows/desktop/WmiSdk/wmi-error-constants) или [**вбемерроренум**](/windows/desktop/api/wbemdisp/ne-wbemdisp-wbemerrorenum). Общие значения **HRESULT** см. в разделе [коды системных ошибок](/windows/desktop/Debug/system-error-codes).

<dl> <dt>

**Успешно**
</dt> <dd>

0

Запрос принят.

</dd> <dt>

**Не поддерживается**
</dt> <dd>

1

Запрос не поддерживается.

</dd> <dt>

**Доступ запрещен**
</dt> <dd>

2

У пользователя нет необходимых прав доступа.

</dd> <dt>

**Работающие зависимые службы**
</dt> <dd>

3

Службу нельзя остановить, так как от нее зависят другие работающие службы.

</dd> <dt>

**Недопустимый элемент управления службой**
</dt> <dd>

4

Запрошенный управляющий код недопустим или неприемлем для данной службы.

</dd> <dt>

**Служба не может принять контроль**
</dt> <dd>

5

Запрошенный управляющий код не может быть отправлен в службу, так как это состояние службы ([**Win32 \_ басесервице**](win32-baseservice.md).**Свойство State** ) равно 0, 1 или 2.

</dd> <dt>

**Служба неактивна**
</dt> <dd>

6

Служба не запущена.

</dd> <dt>

**Время ожидания запроса на обслуживание**
</dt> <dd>

7

Служба не ответила на запрос запуска за отведенное время.

</dd> <dt>

**Неизвестный сбой**
</dt> <dd>

8

Неизвестный сбой при запуске службы.

</dd> <dt>

**Путь не найден**
</dt> <dd>

9

Не найден путь к каталогу исполняемого файла службы.

</dd> <dt>

**Служба уже запущена**
</dt> <dd>

10

Служба уже запущена.

</dd> <dt>

**База данных службы заблокирована**
</dt> <dd>

11

База данных для добавления новой службы заблокирована.

</dd> <dt>

**Зависимость службы удалена**
</dt> <dd>

12

Зависимость, от которой зависит эта служба, удалена из системы.

</dd> <dt>

**Сбой зависимости службы**
</dt> <dd>

13

Этой службе не удалось найти службу, которая необходима зависимой службе.

</dd> <dt>

**Служба отключена**
</dt> <dd>

14

Эта служба была отключена в системе.

</dd> <dt>

**Сбой при входе в службу**
</dt> <dd>

15

Эта служба не поддерживает проверку подлинности, необходимую для работы в системе.

</dd> <dt>

**Служба помечена для удаления**
</dt> <dd>

16

Эта служба удаляется из системы.

</dd> <dt>

**Служба без потока**
</dt> <dd>

17

Служба не имеет потока выполнения.

</dd> <dt>

**Состояние "циклическая зависимость"**
</dt> <dd>

18

Служба имеет циклические зависимости при запуске.

</dd> <dt>

**Состояние "повторяющееся имя"**
</dt> <dd>

19

Служба выполняется с тем же именем.

</dd> <dt>

**Состояние "Недопустимое имя"**
</dt> <dd>

20

Имя службы содержит недопустимые символы.

</dd> <dt>

**Недопустимый параметр Status**
</dt> <dd>

21

Службе переданы недопустимые параметры.

</dd> <dt>

**Недопустимое состояние учетной записи службы**
</dt> <dd>

22

Учетная запись, под которой работает эта служба, либо недопустима, либо не имеет разрешений на запуск службы.

</dd> <dt>

**Служба состояний существует**
</dt> <dd>

23

Служба существует в базе данных доступных в системе служб.

</dd> <dt>

**Служба уже приостановлена**
</dt> <dd>

24

Служба в данный момент приостановлена в системе.

</dd> <dt>

**Другое**
</dt> <dd>

25 4294967295

</dd> </dl>

## <a name="remarks"></a>Remarks

При запуске компьютера также запускаются все службы автозапуска. Иногда одна из этих служб может не запускаться вместе с компьютером. При сбое службы во время запуска системы компьютер принимает действия в соответствии со значением управляющего кода ошибки службы.

Большинство служб устанавливаются с помощью обычного управляющего кода ошибок. Некоторые исключения, которые устанавливаются с помощью команды игнорировать код ошибки, включают:

-   Служба репликации файлов
-   Смарт-карта
-   Вторичный вход в систему
-   WMI

Для служб, установленных с помощью команды игнорировать код ошибки, пользователю не выдается уведомление о том, что служба завершилась ошибкой. Если вы предпочитаете на экране уведомление о том, что не удалось запустить службу, можно использовать инструментарий WMI для изменения управляющего кода ошибки. Коды управления ошибками применяются только к загрузке компьютера; управляющие коды ошибок не используются, если вы останавливаете и попытаетесь перезапустить службу после запуска компьютера.

Иногда может потребоваться изменить учетную запись, под которой работает данная служба. Например, служба может запускаться под административной учетной записью. Поскольку это может привести к уязвимости системы безопасности, можно переключить службу на учетную запись с меньшим числом привилегий. Кроме того, могут быть запущены службы с учетной записью, которая будет удалена, или необходимо убедиться, что на всех серверах некоторые службы выполняются под определенными учетными записями. Можно использовать метод **Change** класса [**\_ службы Win32**](win32-service.md) , чтобы настроить службы для работы с указанной учетной записью пользователя. При выборе учетной записи учитывайте следующее.

-   Учетная запись, используемая в качестве учетной записи службы, должна иметь право на вход в качестве службы. Это право можно предоставить с помощью групповая политика.
-   Учетная запись, используемая как учетная запись службы, не должна быть членом локальной группы администраторов, домена или администратора предприятия.
-   Каждый экземпляр службы должен работать под уникальной учетной записью пользователя. Это обеспечивает дополнительную безопасность и включает аудит отдельных экземпляров службы.
-   Если служба является интерактивной, она должна работать под учетной записью LocalSystem.

    LocalSystem является обязательным, так как только одна Windows-станция (WinSta0) может быть видимой и интерактивной в каждый момент времени. Если служба выполняется под учетной записью, отличной от LocalSystem, она выполняется в окне Service-0x03e7 $ \\ Default Windows Station, которое является невидимым окном. Службы, работающие на этой экранной станции, не могут принимать входные данные и отображать выходные данные.

При назначении учетной записи службе SCM требует для этой учетной записи правильный пароль, прежде чем приступать к назначению. При указании неверного пароля SCM отклоняет учетную запись. Если вы настраиваете учетную запись службы с помощью учетной записи LocalSystem, LocalService или NetworkService, вам не нужно указывать пароль учетной записи, так как у этих учетных записей нет паролей.

SCM хранит пароль учетной записи в базе данных служб. Однако после назначения пароля SCM не гарантирует, что пароль, хранящийся в базе данных служб, и пароль, назначенный учетной записи пользователя в Active Directory, будут по-прежнему совпадать. Следовательно, может произойти ситуация, подобная следующей:

-   Служба настраивается для запуска от имени определенной учетной записи пользователя.
-   Служба запускается под этой учетной записью с использованием пароля текущей учетной записи.
-   Вы изменяете пароль для учетной записи пользователя.
-   Служба продолжит работу. Однако если служба остановлена, ее нельзя перезапустить, так как SCM продолжит использовать старый, недопустимый пароль. Изменение пароля в Active Directory не приводит к изменению пароля, хранящегося в базе данных служб.

При запуске служб с обычными учетными записями пользователей необходимо обновлять эти пароли служб при каждом изменении пароля учетной записи пользователя. Это может быть особенно трудоемким, если вы не уверены, какие службы выполняются под этой учетной записью или на каких компьютерах выполняются службы с этой учетной записью. К счастью, вы можете использовать инструментарий WMI для проверки учетных записей служб на всех компьютерах и при необходимости изменить пароль учетной записи службы.

Параметр [**Win32 \_ лоадордерграуп**](win32-loadordergroup.md) представляет группу системных служб, определяющих зависимости выполнения. Службы должны запускаться в порядке, указанном в группе порядок загрузки, так как службы зависят друг от друга. Для правильной работы этих зависимых служб требуется наличие предшествующих служб.

Чтобы изменить службу с сетевой службы на локальную систему, параметры *StartName* и *стартпассворд* должны иметь следующие значения:


```C++
StartName = "LocalSystem"
StartPassword = "" // - empty string, not NULL
```



Чтобы изменить службу с локальной системной службы на сеть, параметры *StartName* и *стартпассворд* должны иметь следующие значения:


```C++
StartName = "NT AUTHORITY\NetworkService"
StartPassword = "" // - empty string, not NULL
```



## <a name="examples"></a>Примеры

Следующая команда VBScript изменяет учетную запись службы для служб, выполняемых от имени указанной учетной записи пользователя, на LocalSystem.


```VB
strComputer = "."
Set objWMIService = GetObject("winmgmts:{impersonationLevel=impersonate}!\\" & strComputer & "\Root\CIMv2")
Set colServiceList = objWMIService.ExecQuery("SELECT * FROM Win32_Service WHERE StartName = '.\\NetSvc'")
For Each objService in colServices
 errServiceChange = objService.Change( , , , , , , ".\LocalSystem" , "")
Next
```



Следующая команда VBScript изменяет пароль учетной записи службы для всех сценариев, выполняемых в Нетсвк


```VB
strComputer = "."
Set objWMIService = GetObject("winmgmts:{impersonationLevel=impersonate}!\\" & strComputer & "\Root\CIMv2")
Set colServiceList = objWMIService.ExecQuery("SELECT * FROM Win32_Service WHERE StartName = '.\\NetSvc'")
For Each objservice in colServiceList
 errReturn = objService.Change( , , , , , , , "password")
Next
```



## <a name="requirements"></a>Requirements (Требования)



| Требование | Значение |
|-------------------------------------|-----------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows Vista<br/>                                                                |
| Минимальная версия сервера<br/> | Windows Server 2008<br/>                                                          |
| Пространство имен<br/>                | Корневой \\ CIMV2<br/>                                                                  |
| Header<br/>                   | <dl> <dt>Мбнапи. h</dt> </dl>     |
| MOF<br/>                      | <dl> <dt>CIMWin32. mof</dt> </dl> |
| DLL<br/>                      | <dl> <dt>CIMWin32.dll</dt> </dl> |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[Классы операционной системы](/previous-versions//aa392727(v=vs.85))
</dt> <dt>

[**\_Служба Win32**](win32-service.md)
</dt> <dt>

[Задачи WMI: службы](/windows/desktop/WmiSdk/wmi-tasks--services)
</dt> </dl>

 

