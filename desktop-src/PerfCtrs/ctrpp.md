---
description: Средство КТРПП — это предварительный процессор, который анализирует и проверяет манифест счетчиков.
ms.assetid: 3939f6a1-0a94-429d-a71e-b37f045fea13
title: CTRPP
ms.topic: reference
ms.date: 08/17/2020
topic_type:
- APIRef
- kbSyntax
api_name:
- CTRPP
api_type:
- NA
api_location: ''
ms.openlocfilehash: dce12de641dda7b07871a4447190772533598748
ms.sourcegitcommit: de72a1294df274b0a71dc0fdc42d757e5f6df0f3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "104351855"
---
# <a name="ctrpp"></a><span data-ttu-id="d4665-103">CTRPP</span><span class="sxs-lookup"><span data-stu-id="d4665-103">CTRPP</span></span>

<span data-ttu-id="d4665-104">Средство КТРПП — это предварительный процессор, который выполняет синтаксический анализ и проверку манифеста для поставщика v2.</span><span class="sxs-lookup"><span data-stu-id="d4665-104">The CTRPP tool is a pre-processor that parses and validates the manifest for your V2 provider.</span></span> <span data-ttu-id="d4665-105">Средство создает `.rc` ресурсы со строками, необходимыми для потребителей поставщика, и создает `.h` заголовок с кодом, который используется для предоставления данных счетчика.</span><span class="sxs-lookup"><span data-stu-id="d4665-105">The tool generates `.rc` resources with the strings needed by consumers of your provider, and it generates a `.h` header with code that you use to provide your counter data.</span></span> <span data-ttu-id="d4665-106">Средство КТРПП следует запускать во время сборки поставщика.</span><span class="sxs-lookup"><span data-stu-id="d4665-106">You should run the CTRPP tool during the build of your provider.</span></span> <span data-ttu-id="d4665-107">Созданный код следует использовать в качестве отправной точки при разработке поставщика вместо того, чтобы пытаться самостоятельно создавать этот код.</span><span class="sxs-lookup"><span data-stu-id="d4665-107">You should use the generated code as a starting point when developing your provider instead of trying to generate this code yourself.</span></span>

```syntax
ctrpp -o codeFile -rc rcFile [-legacy] [-MemoryRoutines] [-NotificationCallback] [-prefix prefix] [-ch symFile] [-backcompat] inputFile
```

## <a name="arguments"></a><span data-ttu-id="d4665-108">Аргументы</span><span class="sxs-lookup"><span data-stu-id="d4665-108">Arguments</span></span>

|<span data-ttu-id="d4665-109">Параметр</span><span class="sxs-lookup"><span data-stu-id="d4665-109">Option</span></span>              |<span data-ttu-id="d4665-110">Описание</span><span class="sxs-lookup"><span data-stu-id="d4665-110">Description</span></span>
|--------------------|-----------
|<span data-ttu-id="d4665-111">*inputFile*</span><span class="sxs-lookup"><span data-stu-id="d4665-111">*inputFile*</span></span>         |<span data-ttu-id="d4665-112">**Требуется:** Указывает имя `.man` файла (XML-манифеста), определяющего счетчики.</span><span class="sxs-lookup"><span data-stu-id="d4665-112">**Required:** Specifies the name of the `.man` (XML manifest) file that defines your counters.</span></span>
|<span data-ttu-id="d4665-113">**-o** *codeFile*</span><span class="sxs-lookup"><span data-stu-id="d4665-113">**-o** *codeFile*</span></span>   |<span data-ttu-id="d4665-114">**Требуется:** Указывает имя `.h` файла кода, создаваемого КТРПП.</span><span class="sxs-lookup"><span data-stu-id="d4665-114">**Required:** Specifies the name of the `.h` code file to be generated by CTRPP.</span></span> <span data-ttu-id="d4665-115">Этот файл будет содержать встроенные вспомогательные функции C/C++, которые упрощают инициализацию и отинициализацию поставщика.</span><span class="sxs-lookup"><span data-stu-id="d4665-115">This file will contain C/C++ inline helper functions that simplify initializing and uninitializing your provider.</span></span>
|<span data-ttu-id="d4665-116">**-RC** *rcFile*</span><span class="sxs-lookup"><span data-stu-id="d4665-116">**-rc** *rcFile*</span></span>    |<span data-ttu-id="d4665-117">**Требуется:** Указывает имя `.rc` (файла ресурсов), создаваемого КТРПП.</span><span class="sxs-lookup"><span data-stu-id="d4665-117">**Required:** Specifies the name of the `.rc` (resource file) to be generated by CTRPP.</span></span> <span data-ttu-id="d4665-118">Этот файл будет содержать таблицу строк поставщика.</span><span class="sxs-lookup"><span data-stu-id="d4665-118">This file will contain the provider's string table.</span></span>
|<span data-ttu-id="d4665-119">**-CH** *симфиле*</span><span class="sxs-lookup"><span data-stu-id="d4665-119">**-ch** *symFile*</span></span>   |<span data-ttu-id="d4665-120">Указывает имя необязательного `.h` файла символов, создаваемого КТРПП.</span><span class="sxs-lookup"><span data-stu-id="d4665-120">Specifies the name of the optional `.h` symbol file to be generated by CTRPP.</span></span> <span data-ttu-id="d4665-121">Этот файл будет содержать символы C/C++ для имен и идентификаторов GUID каждого набора счетчиков в поставщике.</span><span class="sxs-lookup"><span data-stu-id="d4665-121">This file will contain C/C++ symbols for the names and GUIDs of each counterset in the provider.</span></span>
|<span data-ttu-id="d4665-122">**— префикс префикса** </span><span class="sxs-lookup"><span data-stu-id="d4665-122">**-prefix** *prefix*</span></span>|<span data-ttu-id="d4665-123">Задает префикс, используемый для переменных и функций, определенных в создаваемом файле заголовка.</span><span class="sxs-lookup"><span data-stu-id="d4665-123">Specifies the prefix to use for the variables and functions defined in the generated header file.</span></span>
|<span data-ttu-id="d4665-124">**-Нотификатионкаллбакк**</span><span class="sxs-lookup"><span data-stu-id="d4665-124">**-NotificationCallback**</span></span>|<span data-ttu-id="d4665-125">Изменяет сигнатуру по умолчанию функции [**каунтеринитиализе**](counterinitialize.md) , чтобы она включала параметры для указания имени функций обратного вызова [*контролкаллбакк*](/windows/desktop/api/Perflib/nc-perflib-perflibrequest), [*аллокатемемори*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_alloc)и [*FreeMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_free) .</span><span class="sxs-lookup"><span data-stu-id="d4665-125">Changes the default signature of the [**CounterInitialize**](counterinitialize.md) function to include parameters for specifying the name of [*ControlCallback*](/windows/desktop/api/Perflib/nc-perflib-perflibrequest), [*AllocateMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_alloc), and [*FreeMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_free) callback functions.</span></span> <span data-ttu-id="d4665-126">Этот аргумент имеет тот же результат, что и включение `callback` атрибута в элемент [**provider**](/windows/desktop/PerfCtrs/performance-counters-provider--counters--element) .</span><span class="sxs-lookup"><span data-stu-id="d4665-126">This argument has the same effect as including the `callback` attribute in the [**provider**](/windows/desktop/PerfCtrs/performance-counters-provider--counters--element) element.</span></span>
|<span data-ttu-id="d4665-127">**— Перенос** *выходной_файл*</span><span class="sxs-lookup"><span data-stu-id="d4665-127">**-migrate** *outputFile*</span></span>|<span data-ttu-id="d4665-128">Вместо создания `.h` файлов и `.rc` обновляет манифест *inputFile* до последней версии и сохраняет его в файле *выходной_файл*.</span><span class="sxs-lookup"><span data-stu-id="d4665-128">Instead of generating `.h` and `.rc` files, upgrades the *inputFile* manifest to the latest version and saves it to *outputFile*.</span></span> <span data-ttu-id="d4665-129">Этот параметр нельзя использовать с другими параметрами.</span><span class="sxs-lookup"><span data-stu-id="d4665-129">This switch cannot be used with other switches.</span></span> <span data-ttu-id="d4665-130">Использование: `CTRPP -migrate NewFile.man OldFile.man`</span><span class="sxs-lookup"><span data-stu-id="d4665-130">Usage: `CTRPP -migrate NewFile.man OldFile.man`</span></span>
|<span data-ttu-id="d4665-131">**-Несовместимость**</span><span class="sxs-lookup"><span data-stu-id="d4665-131">**-BackCompat**</span></span>     |<span data-ttu-id="d4665-132">Не **рекомендуется:** Поддержка поставщиков режима ядра была добавлена в Windows 7.</span><span class="sxs-lookup"><span data-stu-id="d4665-132">**Deprecated:** Support for kernel-mode providers was added in Windows 7.</span></span> <span data-ttu-id="d4665-133">По умолчанию код, формируемый КТРПП для поставщиков режима ядра, будет несовместим с более ранними версиями Windows (драйвер не сможет загрузиться из-за отсутствия `Pcw***` API).</span><span class="sxs-lookup"><span data-stu-id="d4665-133">By default, the code generated by CTRPP for kernel-mode providers will be incompatible with earlier versions of Windows (driver will fail to load due to missing `Pcw***` APIs).</span></span> <span data-ttu-id="d4665-134">Установите этот параметр `-BackCompat` , чтобы обеспечить совместимость с более ранними версиями Windows.</span><span class="sxs-lookup"><span data-stu-id="d4665-134">Set `-BackCompat` to enable compatibility with earlier versions of Windows.</span></span> <span data-ttu-id="d4665-135">Драйвер динамически загрузит необходимые API, и созданный код автоматически отключит поставщик, если интерфейсы API недоступны.</span><span class="sxs-lookup"><span data-stu-id="d4665-135">The driver will dynamically load the necessary APIs and the generated code will silently disable the provider if the APIs are not available.</span></span>
|<span data-ttu-id="d4665-136">**-Меморираутинес**</span><span class="sxs-lookup"><span data-stu-id="d4665-136">**-MemoryRoutines**</span></span> |<span data-ttu-id="d4665-137">Не **рекомендуется:** При использовании с `-Legacy` параметром включает шаблоны для подпрограмм памяти в созданном коде.</span><span class="sxs-lookup"><span data-stu-id="d4665-137">**Deprecated:** When used with the `-Legacy` switch, includes templates for memory routines in the generated code.</span></span> <span data-ttu-id="d4665-138">В противном случае этот аргумент имеет тот же результат, что и `-NotificationCallback` параметр.</span><span class="sxs-lookup"><span data-stu-id="d4665-138">Otherwise, this argument has the same effect as the `-NotificationCallback` switch.</span></span>
|<span data-ttu-id="d4665-139">**-Legacy**</span><span class="sxs-lookup"><span data-stu-id="d4665-139">**-Legacy**</span></span>         |<span data-ttu-id="d4665-140">Не **рекомендуется:** Создает `*.h` `*.c` файлы,, `*.rc` и `*_r.h` с помощью шаблонов кода Windows Vista (создает перфаутоинитиализе и перфаутоклеануп вместо каунтеринитиализе и каунтерклеануп).</span><span class="sxs-lookup"><span data-stu-id="d4665-140">**Deprecated:** Generates `*.h`, `*.c`, `*.rc`, and `*_r.h` files using the Windows Vista code templates (generates PerfAutoInitialize and PerfAutoCleanup instead of CounterInitialize and CounterCleanup).</span></span> <span data-ttu-id="d4665-141">Этот параметр можно использовать с параметрами **-меморираутинес** и **-нотификатионкаллбакк** , но не может использоваться с другими параметрами.</span><span class="sxs-lookup"><span data-stu-id="d4665-141">This switch can be used with **-MemoryRoutines** and **-NotificationCallback** but cannot be used with any other switches.</span></span> <span data-ttu-id="d4665-142">Не используйте параметры **-o** или **-RC** с этим параметром.</span><span class="sxs-lookup"><span data-stu-id="d4665-142">Do not use the **-o** or **-rc** switches with this switch.</span></span> <span data-ttu-id="d4665-143">Создаваемые файлы будут называться на основе имени манифеста и будут записаны в каталог, содержащий манифест.</span><span class="sxs-lookup"><span data-stu-id="d4665-143">The generated files will be named based on the name of the manifest and will be written to the directory that contained the manifest.</span></span> <span data-ttu-id="d4665-144">Использование: `CTRPP -legacy OldFile.man`</span><span class="sxs-lookup"><span data-stu-id="d4665-144">Usage: `CTRPP -legacy OldFile.man`</span></span>

## <a name="remarks"></a><span data-ttu-id="d4665-145">Комментарии</span><span class="sxs-lookup"><span data-stu-id="d4665-145">Remarks</span></span>

<span data-ttu-id="d4665-146">Средство КТРПП создает `.h` файл кода, `.rc` файл ресурсов и при необходимости создает `.h` файл символов.</span><span class="sxs-lookup"><span data-stu-id="d4665-146">The CTRPP tool generates a `.h` code file, an `.rc` resource file, and optionally generates a `.h` symbol file.</span></span>

### <a name="using-the-generated-resource-file"></a><span data-ttu-id="d4665-147">Использование созданного файла ресурсов</span><span class="sxs-lookup"><span data-stu-id="d4665-147">Using the generated resource file</span></span>

<span data-ttu-id="d4665-148">Средство КТРПП создаст `.rc` файл ресурсов, содержащий локализуемые строки, необходимые потребителям каунтерсетс поставщика.</span><span class="sxs-lookup"><span data-stu-id="d4665-148">The CTRPP tool will generate a `.rc` resource file that contains the localizable strings needed by consumers of the provider's countersets.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d4665-149">Ресурсы из этого файла должны быть добавлены в двоичный файл поставщика, а полный путь к двоичному файлу поставщика должен быть зарегистрирован во время установки манифеста поставщика.</span><span class="sxs-lookup"><span data-stu-id="d4665-149">The resources from this file must be included into your provider binary and the full path to the provider binary must be registered during the installation of your provider's manifest.</span></span> <span data-ttu-id="d4665-150">Потребители, которым не удается нахождение и загрузка ресурсов, не смогут использовать каунтерсетс поставщика.</span><span class="sxs-lookup"><span data-stu-id="d4665-150">Consumers that are unable to locate and load the resources will be unable to use your provider's countersets.</span></span>

<span data-ttu-id="d4665-151">Строковые ресурсы должны обрабатываться следующим образом:</span><span class="sxs-lookup"><span data-stu-id="d4665-151">The string resources should be handled as follows:</span></span>

- <span data-ttu-id="d4665-152">Разработчик редактирует файл манифеста поставщика ( `.man` ), чтобы задать `applicationIdentity` атрибуту поставщика имя двоичного файла поставщика (. DLL,. SYS или. EXE), который будет содержать строковые ресурсы для поставщика и будет установлен в составе компонента поставщика.</span><span class="sxs-lookup"><span data-stu-id="d4665-152">The developer edits the provider manifest (`.man`) file to set the `applicationIdentity` attribute of the provider to the name of a provider binary (.DLL, .SYS, or .EXE) that will contain the string resources for the provider and will be installed as part of the provider component.</span></span>
- <span data-ttu-id="d4665-153">Средство КТРПП считывает манифест поставщика и создает `.rc` файл.</span><span class="sxs-lookup"><span data-stu-id="d4665-153">The CTRPP tool reads the provider manifest and generates an `.rc` file.</span></span>
- <span data-ttu-id="d4665-154">Средство [RC (Resource Compiler)](../menurc/resource-compiler.md) компилирует данные из файла, созданного КТРПП `.rc` , для создания `.res` файла, содержащего двоичные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="d4665-154">The [RC (resource compiler)](../menurc/resource-compiler.md) tool compiles the data from the CTRPP-generated `.rc` file to generate a `.res` file containing the binary resources.</span></span> <span data-ttu-id="d4665-155">Это можно сделать путем непосредственного компилирования созданного КТРПП `.rc` файла или путем компиляции другого `.rc` файла, который включает созданный КТРПП `.rc` файл с помощью `#include` директивы.</span><span class="sxs-lookup"><span data-stu-id="d4665-155">This can be done either by directly compiling the CTRPP-generated `.rc` file OR by compiling another `.rc` file that includes the CTRPP-generated `.rc` file via an `#include` directive.</span></span>
- <span data-ttu-id="d4665-156">Компоновщик внедряет данные из файла, созданного RC, `.res` в двоичный файл поставщика.</span><span class="sxs-lookup"><span data-stu-id="d4665-156">The linker embeds the data from the RC-generated `.res` file into the provider binary.</span></span>
- <span data-ttu-id="d4665-157">Во время установки двоичный файл поставщика копируется в систему пользователя, а манифест поставщика регистрируется с помощью [средства lodctr](/windows-server/administration/windows-commands/lodctr).</span><span class="sxs-lookup"><span data-stu-id="d4665-157">During installation, the provider binary is copied onto the user's system and the provider manifest is registered using the [lodctr tool](/windows-server/administration/windows-commands/lodctr).</span></span> <span data-ttu-id="d4665-158">Средство lodctr преобразует `applicationIdentity` атрибут манифеста поставщика в полный путь и записывает полный путь к двоичному файлу поставщика в реестре.</span><span class="sxs-lookup"><span data-stu-id="d4665-158">The lodctr tool converts the `applicationIdentity` attribute of the provider manifest into a full path and records the full path to the provider binary in the registry.</span></span>
  - <span data-ttu-id="d4665-159">Если двоичный файл поставщика находится в том же каталоге, что и манифест, используйте: `lodctr.exe /m:"C:\full\manifest\path\manifest.man"` .</span><span class="sxs-lookup"><span data-stu-id="d4665-159">If the provider binary is in the same directory as the manifest, use: `lodctr.exe /m:"C:\full\manifest\path\manifest.man"`.</span></span> <span data-ttu-id="d4665-160">lodctr объединяет указанный путь манифеста с атрибутом манифеста `applicationIdentity` для формирования полного пути.</span><span class="sxs-lookup"><span data-stu-id="d4665-160">lodctr will combine the specified manifest path with the manifest's `applicationIdentity` attribute to form the full path.</span></span>
  - <span data-ttu-id="d4665-161">В противном случае используйте коллекцию `lodctr.exe /m:"C:\full\manifest\path\manifest.man" "c:\full\binary\path"`.</span><span class="sxs-lookup"><span data-stu-id="d4665-161">Otherwise, use `lodctr.exe /m:"C:\full\manifest\path\manifest.man" "c:\full\binary\path"`.</span></span> <span data-ttu-id="d4665-162">lodctr объединяет указанный двоичный путь с атрибутом манифеста `applicationIdentity` для формирования полного пути.</span><span class="sxs-lookup"><span data-stu-id="d4665-162">lodctr will combine the specified binary path with the manifest's `applicationIdentity` attribute to form the full path.</span></span>
  - <span data-ttu-id="d4665-163">В целях диагностики можно проверить записанный полный путь, проверив `ApplicationIdentity` значение раздела реестра `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Perflib\_V2Providers\{<ProviderGuid>}` .</span><span class="sxs-lookup"><span data-stu-id="d4665-163">For diagnostic purposes, you can inspect the recorded full path by checking the `ApplicationIdentity` value of registry key `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Perflib\_V2Providers\{<ProviderGuid>}`.</span></span>
  - <span data-ttu-id="d4665-164">Если в двоичном файле используется MUI для локализации, скопируйте файл MUI вместе с двоичным файлом.</span><span class="sxs-lookup"><span data-stu-id="d4665-164">If the binary is using MUI for localization, be sure to copy the MUI file along with the binary.</span></span>
- <span data-ttu-id="d4665-165">Во время сбора набора счетчиков потребитель использует записанный полный путь к двоичному файлу поставщика для поиска и загрузки необходимых строк из ресурсов двоичного файла поставщика.</span><span class="sxs-lookup"><span data-stu-id="d4665-165">During counterset collection, the consumer uses the recorded full path to the provider binary to locate and load the necessary strings from the provider binary's resources.</span></span>

### <a name="using-the-generated-code-file-in-a-user-mode-provider"></a><span data-ttu-id="d4665-166">Использование созданного файла кода в поставщике пользовательского режима</span><span class="sxs-lookup"><span data-stu-id="d4665-166">Using the generated code file in a user-mode provider</span></span>

<span data-ttu-id="d4665-167">Средство КТРПП создаст `.h` файл кода C/C++.</span><span class="sxs-lookup"><span data-stu-id="d4665-167">The CTRPP tool will generate a `.h` C/C++ code file.</span></span> <span data-ttu-id="d4665-168">Если атрибут манифеста поставщика `providerType` имеет значение `userMode` , созданный файл кода будет содержать следующие определения, которые полезны при кодировании поставщика пользовательского режима.</span><span class="sxs-lookup"><span data-stu-id="d4665-168">If the provider manifest's `providerType` attribute is set to `userMode`, the generated code file will contain the following definitions that are helpful in coding a user-mode provider:</span></span>

- <span data-ttu-id="d4665-169">Функция инициализации поставщика с именем [ \* **prefix \* каунтеринитиализе**](counterinitialize.md).</span><span class="sxs-lookup"><span data-stu-id="d4665-169">An provider initialization function named [\***prefix\*CounterInitialize**](counterinitialize.md).</span></span>
- <span data-ttu-id="d4665-170">Функция очистки поставщика с именем [ \* **prefix \* каунтерклеануп**](countercleanup.md).</span><span class="sxs-lookup"><span data-stu-id="d4665-170">A provider cleanup function named [\***prefix\*CounterCleanup**](countercleanup.md).</span></span>
- <span data-ttu-id="d4665-171">Глобальная переменная \***provider** _, которая хранит обработчик поставщика, Открытый функцией _ \*_prefix_CounterInitialize\*\*.</span><span class="sxs-lookup"><span data-stu-id="d4665-171">A global ***provider** _ variable that stores the provider handle opened by the _ *_prefix_CounterInitialize** function.</span></span> <span data-ttu-id="d4665-172">Имя переменной является значением `symbol` атрибута `provider` элемента в манифесте.</span><span class="sxs-lookup"><span data-stu-id="d4665-172">The variable's name is the value of the `symbol` attribute of the `provider` element in the manifest.</span></span> <span data-ttu-id="d4665-173">Эта переменная должна использоваться в вызовах `PerfCreateInstance` , `PerfDeleteInstance` и других интерфейсах API для управления данными поставщика.</span><span class="sxs-lookup"><span data-stu-id="d4665-173">This variable should be used in calls to `PerfCreateInstance`, `PerfDeleteInstance`, and other APIs for controlling your provider's data.</span></span>
- <span data-ttu-id="d4665-174">Для каждого CounterSet — глобальная переменная \***CounterSet \* GUID** с идентификатором GUID CounterSet.</span><span class="sxs-lookup"><span data-stu-id="d4665-174">For each counterset, a global \***counterset\*GUID** variable with the counterset GUID.</span></span> <span data-ttu-id="d4665-175">Имя переменной — это значение `counterSet` `symbol` атрибута элемента плюс суффикс GUID, например `MyCounterSetGUID` .</span><span class="sxs-lookup"><span data-stu-id="d4665-175">The variable's name is the value of the `counterSet` element's `symbol` attribute plus the suffix "GUID", e.g. `MyCounterSetGUID`.</span></span> <span data-ttu-id="d4665-176">Эта переменная должна использоваться в вызовах `PerfCreateInstance` , `PerfDeleteInstance` и других интерфейсах API для управления данными поставщика.</span><span class="sxs-lookup"><span data-stu-id="d4665-176">This variable should be used in calls to `PerfCreateInstance`, `PerfDeleteInstance`, and other APIs for controlling your provider's data.</span></span>
- <span data-ttu-id="d4665-177">Для каждого счетчика это макрос ***счетчика*** со значением счетчика `id` .</span><span class="sxs-lookup"><span data-stu-id="d4665-177">For each counter, a ***counter*** macro with the counter's `id` value.</span></span> <span data-ttu-id="d4665-178">Имя макроса является значением `counter` `symbol` атрибута элемента.</span><span class="sxs-lookup"><span data-stu-id="d4665-178">The macro's name is the value of the `counter` element's `symbol` attribute.</span></span> <span data-ttu-id="d4665-179">Этот макрос следует использовать в вызовах `PerfSetCounterRefValue` , `PerfSetULongLongCounterValue` и других интерфейсах API для настройки данных поставщика.</span><span class="sxs-lookup"><span data-stu-id="d4665-179">This macro should be used in calls to `PerfSetCounterRefValue`, `PerfSetULongLongCounterValue`, and other APIs for setting your provider's data.</span></span>

<span data-ttu-id="d4665-180">В именах функций ***префикс*** ссылается на значение `-prefix` параметра командной строки.</span><span class="sxs-lookup"><span data-stu-id="d4665-180">In the function names, ***prefix*** refers to the value of the `-prefix` command-line parameter.</span></span> <span data-ttu-id="d4665-181">Если `-prefix` параметр не используется, функции будут называться `CounterInitialize` и `CounterCleanup` .</span><span class="sxs-lookup"><span data-stu-id="d4665-181">If the `-prefix` parameter is not used the functions will be named `CounterInitialize` and `CounterCleanup`.</span></span>

### <a name="using-the-generated-code-file-in-a-kernel-mode-provider"></a><span data-ttu-id="d4665-182">Использование созданного файла кода в поставщике режима ядра</span><span class="sxs-lookup"><span data-stu-id="d4665-182">Using the generated code file in a kernel-mode provider</span></span>

<span data-ttu-id="d4665-183">Средство КТРПП создаст `.h` файл кода C/C++.</span><span class="sxs-lookup"><span data-stu-id="d4665-183">The CTRPP tool will generate a `.h` C/C++ code file.</span></span> <span data-ttu-id="d4665-184">Если атрибут манифеста поставщика `providerType` имеет значение `kernelMode` , созданный файл кода будет содержать следующие определения, которые полезны при написании кода для каунтерсетс поставщика в режиме ядра:</span><span class="sxs-lookup"><span data-stu-id="d4665-184">If the provider manifest's `providerType` attribute is set to `kernelMode`, the generated code file will contain the following definitions that are helpful in coding a kernel-mode provider's countersets:</span></span>

- <span data-ttu-id="d4665-185">Функция инициализации CounterSet с именем <b> *prefix* Register</b>.</span><span class="sxs-lookup"><span data-stu-id="d4665-185">A counterset initialization function named <b>*prefix* Register *Counterset*</b>.</span></span> <span data-ttu-id="d4665-186">Эта функция заполняет [регинфо](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) структуру, затем вызывает [пкврегистер](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwregister), помещая полученный маркер регистрации CounterSet в глобальную переменную ***CounterSet*** .</span><span class="sxs-lookup"><span data-stu-id="d4665-186">This function fills in a [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) structure then invokes [PcwRegister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwregister), putting the resulting counterset registration handle into the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="d4665-187">Функция очистки счетчика с именем <b> *prefix* Отмена регистрации *счетчика*</b>.</span><span class="sxs-lookup"><span data-stu-id="d4665-187">A counterset cleanup function named <b>*prefix* Unregister *Counterset*</b>.</span></span> <span data-ttu-id="d4665-188">Эта функция вызывает [пквунрегистер](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwunregister) для маркера регистрации CounterSet в глобальной переменной ***CounterSet*** .</span><span class="sxs-lookup"><span data-stu-id="d4665-188">This function invokes [PcwUnregister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwunregister) on the counterset registration handle in the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="d4665-189">Функция создания экземпляра с именем <b> *prefix* создание *счетчика*</b>.</span><span class="sxs-lookup"><span data-stu-id="d4665-189">An instance creation function named <b>*prefix* Create *Counterset*</b>.</span></span> <span data-ttu-id="d4665-190">Эта функция заполняет массив структур [пквдата](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) , а затем вызывает [пквкреатеинстанце](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcreateinstance) , используя маркер регистрации CounterSet в глобальной переменной набора ***счетчиков*** .</span><span class="sxs-lookup"><span data-stu-id="d4665-190">This function fills in an array of [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) structures then invokes [PcwCreateInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcreateinstance) using the counterset registration handle in the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="d4665-191">Функция очистки экземпляра с именем <b> *prefix*, закрывающая набор *счетчиков*</b>.</span><span class="sxs-lookup"><span data-stu-id="d4665-191">An instance cleanup function named <b>*prefix* Close *Counterset*</b>.</span></span> <span data-ttu-id="d4665-192">Эта функция вызывает [пквклосеинстанце](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcloseinstance).</span><span class="sxs-lookup"><span data-stu-id="d4665-192">This function invokes [PcwCloseInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcloseinstance).</span></span>
- <span data-ttu-id="d4665-193">Экземпляр функции Reporting, именуемый <b> *prefix*, добавляет *CounterSet*</b> , используемый из функции обратного вызова CounterSet.</span><span class="sxs-lookup"><span data-stu-id="d4665-193">An instance reporting function named <b>*prefix* Add *Counterset*</b> to be used from the counterset callback function.</span></span> <span data-ttu-id="d4665-194">Эта функция заполняет массив структур [пквдата](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) , а затем вызывает [пкваддинстанце](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwaddinstance).</span><span class="sxs-lookup"><span data-stu-id="d4665-194">This function fills in an array of [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) structures then invokes [PcwAddInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwaddinstance).</span></span>
- <span data-ttu-id="d4665-195">**Windows SDK 20H1 и более поздних версий:** Функция инициализации Регинфо с именем <b> *prefix* инитрегистратионинформатион *CounterSet*</b> для использования в расширенных сценариях.</span><span class="sxs-lookup"><span data-stu-id="d4665-195">**Windows SDK 20H1 and later:** A RegInfo initialization function named <b>*prefix* InitRegistrationInformation *Counterset*</b> for use in advanced scenarios.</span></span> <span data-ttu-id="d4665-196">Эта функция заполняет структуру [регинфо](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) .</span><span class="sxs-lookup"><span data-stu-id="d4665-196">This function fills in a [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) structure.</span></span> <span data-ttu-id="d4665-197">Эта функция может использоваться в тех случаях, когда созданный набор <b>*счетчиков* регистров *префиксов*</b> не соответствует вашим потребностям, например, если необходимо настроить значения в структуре регинфо или сохранить возвращенный обработчик в другой переменной.</span><span class="sxs-lookup"><span data-stu-id="d4665-197">This function can be used in cases where the generated <b>*prefix* Register *Counterset*</b> does not meet your needs, e.g. when you want to customize the values in the RegInfo structure or when you want to store the returned handle in another variable.</span></span>

<span data-ttu-id="d4665-198">В именах функций ***префикс*** ссылается на значение `-prefix` параметра командной строки.</span><span class="sxs-lookup"><span data-stu-id="d4665-198">In the function names, ***prefix*** refers to the value of the `-prefix` command-line parameter.</span></span> <span data-ttu-id="d4665-199">Если `-prefix` параметр не используется, функции не имеют префикса.</span><span class="sxs-lookup"><span data-stu-id="d4665-199">If the `-prefix` parameter is not used the functions will have no prefix.</span></span>

> [!NOTE]
> <span data-ttu-id="d4665-200">При наличии обратного вызова CounterSet используется созданная функция <b> добавления *счетчика*</b> .</span><span class="sxs-lookup"><span data-stu-id="d4665-200">The generated <b>*prefix* Add *Counterset*</b> function is used when you have a counterset callback.</span></span> <span data-ttu-id="d4665-201">Созданный <b> *префикс* функции создания *счетчиков*</b> и <b> *префиксов* закрытия</b> используются при отсутствии обратного вызова CounterSet.</span><span class="sxs-lookup"><span data-stu-id="d4665-201">The generated <b>*prefix* Create *Counterset*</b> and <b>*prefix* Close *Counterset*</b> functions are used when you do not have a counterset callback.</span></span>

### <a name="using-the-generated-symbol-file"></a><span data-ttu-id="d4665-202">Использование созданного файла символов</span><span class="sxs-lookup"><span data-stu-id="d4665-202">Using the generated symbol file</span></span>

<span data-ttu-id="d4665-203">Если в командной строке указан параметр **-CH** , средство КТРПП создаст `.h` файл символов.</span><span class="sxs-lookup"><span data-stu-id="d4665-203">If the **-ch** parameter is specified on the command line, the CTRPP tool will generate a `.h` symbol file.</span></span> <span data-ttu-id="d4665-204">Этот файл содержит символы C/C++ для имен и идентификаторов GUID каждого набора счетчиков в поставщике.</span><span class="sxs-lookup"><span data-stu-id="d4665-204">This file contains the C/C++ symbols for the names and GUIDs of each counterset in the provider.</span></span> <span data-ttu-id="d4665-205">Символы могут использоваться при написании программ, жестко запрограммированных для использования данных из этого CounterSet, с помощью [пользовательских функций PerfLib версии 2](using-the-perflib-functions-to-consume-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="d4665-205">The symbols can be used when writing programs that are hard-coded to consume the data from this counterset using the [PerfLib V2 Consumer functions](using-the-perflib-functions-to-consume-counter-data.md).</span></span>

## <a name="requirements"></a><span data-ttu-id="d4665-206">Требования</span><span class="sxs-lookup"><span data-stu-id="d4665-206">Requirements</span></span>

|                         ||
|-------------------------|----
| <span data-ttu-id="d4665-207">Минимальная версия клиента</span><span class="sxs-lookup"><span data-stu-id="d4665-207">Minimum supported client</span></span>| <span data-ttu-id="d4665-208">Только для \[ классических приложений Windows Vista\]</span><span class="sxs-lookup"><span data-stu-id="d4665-208">Windows Vista \[desktop apps only\]</span></span>
| <span data-ttu-id="d4665-209">Минимальная версия сервера</span><span class="sxs-lookup"><span data-stu-id="d4665-209">Minimum supported server</span></span>| <span data-ttu-id="d4665-210">\[Только для настольных приложений Windows Server 2008\]</span><span class="sxs-lookup"><span data-stu-id="d4665-210">Windows Server 2008 \[desktop apps only\]</span></span>
