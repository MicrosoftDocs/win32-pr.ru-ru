---
description: Хотя поставщикам рекомендуется использовать уникальные имена экземпляров, не все поставщики.
ms.assetid: 3c8fcb8d-2ea4-4b24-b649-7bd375c1133d
title: Обработка повторяющихся имен экземпляров
ms.topic: article
ms.date: 08/17/2020
ms.openlocfilehash: 220e5d7d0181a79c1d1415486cc946d484e11952
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105663231"
---
# <a name="handling-duplicate-instance-names"></a><span data-ttu-id="1920b-103">Обработка повторяющихся имен экземпляров</span><span class="sxs-lookup"><span data-stu-id="1920b-103">Handling Duplicate Instance Names</span></span>

<span data-ttu-id="1920b-104">Хотя поставщики настоятельно рекомендуется использовать уникальные имена экземпляров, не все поставщики поддерживают.</span><span class="sxs-lookup"><span data-stu-id="1920b-104">Although providers are strongly encouraged to use unique instance names, not all providers do.</span></span> <span data-ttu-id="1920b-105">В соглашении для отображения повторяющихся имен экземпляров можно добавить `#` символ и серийный номер к имени экземпляра, за исключением первого вхождения имени.</span><span class="sxs-lookup"><span data-stu-id="1920b-105">The convention for displaying duplicate instance names is to append a `#` character and a serial number to the instance name, except for the first occurrence of the name.</span></span> <span data-ttu-id="1920b-106">Например, если в образце есть три экземпляра `svchost` , то эти три имени отображаются как `svchost` , `svchost#1` и `svchost#2` .</span><span class="sxs-lookup"><span data-stu-id="1920b-106">For example, if there are three instances of `svchost` in a sample, the three names are displayed as `svchost`, `svchost#1`, and `svchost#2`.</span></span>

<span data-ttu-id="1920b-107">К сожалению, это соглашение не позволяет полностью решить проблему.</span><span class="sxs-lookup"><span data-stu-id="1920b-107">Unfortunately, this convention does not completely resolve the issue.</span></span> <span data-ttu-id="1920b-108">Серийные номера назначаются на основе порядка, в котором конкретное имя экземпляра отображается в образце, и этот порядок может быть непоследовательным в образце для выборки.</span><span class="sxs-lookup"><span data-stu-id="1920b-108">Serial numbers are assigned based on the order in which a particular instance name appears in a sample, and this order may be inconsistent from sample to sample.</span></span> <span data-ttu-id="1920b-109">Например, пример A может видеть `svchost` (pid 100), `svchost#1` (PID 200) и `svchost#2` (PID 300).</span><span class="sxs-lookup"><span data-stu-id="1920b-109">For example, sample A might see `svchost` (PID 100), `svchost#1` (PID 200), and `svchost#2` (PID 300).</span></span> <span data-ttu-id="1920b-110">Затем, если процесс svchost с PID 100 завершает работу, в следующем примере будут отображаться `svchost` (pid 200) и `svchost#1` (PID 300).</span><span class="sxs-lookup"><span data-stu-id="1920b-110">Then if the svchost with PID 100 shuts down, the next sample would see `svchost` (PID 200) and `svchost#1` (PID 300).</span></span> <span data-ttu-id="1920b-111">Базовая логика сопоставления будет пытаться сопоставить пример `svchost#1` статистики A (от pid 200) с `svchost#1` статистикой образца б (с PID 300), что приведет к недопустимым результатам для примера б. ошибки возникают, когда новый неуникальный экземпляр отображается в выборке или когда неуникальный экземпляр останавливается в выборке (если только добавленный или удаленный экземпляр не был последним).</span><span class="sxs-lookup"><span data-stu-id="1920b-111">Basic matching logic would try to match sample A's `svchost#1` statistics (from PID 200) against sample B's `svchost#1` statistics (from PID 300), resulting in invalid results for sample B. Errors occur when a new non-unique instance shows up in a sample or when a non-unique instance stops showing up in a sample (unless the added/removed instance was the last one).</span></span>

## <a name="process-counterset"></a><span data-ttu-id="1920b-112">Набор счетчиков процессов</span><span class="sxs-lookup"><span data-stu-id="1920b-112">Process counterset</span></span>

<span data-ttu-id="1920b-113">Эта проблема особенно связана с набором `Process` счетчиков, поскольку в нем используется только имя EXE-файла процесса в качестве имени экземпляра, несмотря на то, что имя исполняемого файла не является уникальным.</span><span class="sxs-lookup"><span data-stu-id="1920b-113">This issue is especially problematic for the `Process` counterset because it uses only the process's EXE name as the instance name even though the EXE name is not unique.</span></span> <span data-ttu-id="1920b-114">Поведение по умолчанию для набора `Process` счетчиков в Windows не может быть изменено из-за проблем совместимости.</span><span class="sxs-lookup"><span data-stu-id="1920b-114">The default behavior of the `Process` counterset on Windows cannot be changed due to compatibility issues.</span></span>

<span data-ttu-id="1920b-115">Можно изменить поведение `Process` и `Thread` каунтерсетс, чтобы использовать уникальные имена экземпляров, задав `ProcessNameFormat` `ThreadNameFormat` значения реестра или в разделе `HKLM\System\CurrentControlSet\Services\Perfproc\Performance` реестра.</span><span class="sxs-lookup"><span data-stu-id="1920b-115">You can alter the behavior of the `Process` and `Thread` countersets to use unique instance names by setting the `ProcessNameFormat` or `ThreadNameFormat` registry values under the `HKLM\System\CurrentControlSet\Services\Perfproc\Performance` registry key.</span></span>

> [!CAUTION]
> <span data-ttu-id="1920b-116">Включение уникальных имен экземпляров для `Process` CounterSet может привести к неправильному выполнению некоторых программ, так как для многих программ требуется неуникальный шаблон именования.</span><span class="sxs-lookup"><span data-stu-id="1920b-116">Enabling unique instance names for the `Process` counterset may cause some programs to behave incorrectly, since many programs expect the non-unique naming pattern.</span></span> <span data-ttu-id="1920b-117">Например, программа, которая ищет экземпляр с указанным хорошо известным именем EXE-файла, больше не сможет найти этот экземпляр после включения уникальных имен экземпляров.</span><span class="sxs-lookup"><span data-stu-id="1920b-117">For example, a program that is looking for an instance with a specific well-known EXE name will no longer be able to find that instance after enabling unique instance names.</span></span>

<span data-ttu-id="1920b-118">Тип реестра для этих значений — `REG_DWORD` .</span><span class="sxs-lookup"><span data-stu-id="1920b-118">The registry type for these values is `REG_DWORD`.</span></span> <span data-ttu-id="1920b-119">Установка значения `2` добавляет идентификатор процесса (PID) в имя экземпляра процесса, а идентификатор потока (TID) — в имя экземпляра потока.</span><span class="sxs-lookup"><span data-stu-id="1920b-119">Setting the value to `2` appends the process identifier (PID) to the process instance name and the thread identifier (TID) to the thread instance name.</span></span> <span data-ttu-id="1920b-120">Чтобы отключить эту функцию, установите значение 1 или удалите значение.</span><span class="sxs-lookup"><span data-stu-id="1920b-120">To disable this feature, set the value to 1 or delete the value.</span></span>
