---
description: Счетчики используются для предоставления сведений о том, насколько хорошо работает операционная система или приложение, служба или драйвер.
ms.assetid: d172a131-61d3-4fc1-8e0c-b07b2bd34f80
title: Сведения о счетчиках производительности
ms.topic: article
ms.date: 08/17/2020
ms.openlocfilehash: dec7c71e99ab614ee64e3d1e8c9620f0be78c14a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103909755"
---
# <a name="about-performance-counters"></a><span data-ttu-id="6fc75-103">Сведения о счетчиках производительности</span><span class="sxs-lookup"><span data-stu-id="6fc75-103">About Performance Counters</span></span>

<span data-ttu-id="6fc75-104">Счетчики производительности Windows предоставляют высокоуровневый уровень абстракции с единообразным интерфейсом для сбора различных типов системных данных, таких как ЦП, память и статистика использования диска.</span><span class="sxs-lookup"><span data-stu-id="6fc75-104">Windows Performance Counters provide a high-level abstraction layer with a consistent interface for collecting various kinds of system data such as CPU, memory, and disk usage statistics.</span></span> <span data-ttu-id="6fc75-105">Системные администраторы используют счетчики производительности для наблюдения за проблемами производительности или поведения.</span><span class="sxs-lookup"><span data-stu-id="6fc75-105">System administrators use performance counters to monitor for performance or behavior problems.</span></span> <span data-ttu-id="6fc75-106">Разработчики программного обеспечения используют счетчики производительности для проверки использования ресурсов их компонентов.</span><span class="sxs-lookup"><span data-stu-id="6fc75-106">Software developers use performance counters to inspect the resource usage of their components.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6fc75-107">Счетчики производительности Windows оптимизированы для обнаружения и сбора данных по администрированию и диагностике.</span><span class="sxs-lookup"><span data-stu-id="6fc75-107">Windows Performance Counters are optimized for administrative/diagnostic data discovery and collection.</span></span> <span data-ttu-id="6fc75-108">Они не подходят для сбора данных с высокой частотой или для профилирования приложений, так как они не предназначены для сбора более одного раза в секунду.</span><span class="sxs-lookup"><span data-stu-id="6fc75-108">They are not appropriate for high-frequency data collection or for application profiling since they are not designed to be collected more than once per second.</span></span> <span data-ttu-id="6fc75-109">Для доступа к системной информации с более низкими издержками можно использовать более прямые API, такие как [**вспомогательное состояние процесса**](../psapi/process-status-helper.md), [**глобалмемористатусекс**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-globalmemorystatusex), [**жетсистемтимес**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getsystemtimes)или [**GetProcessTimes**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getprocesstimes).</span><span class="sxs-lookup"><span data-stu-id="6fc75-109">For lower-overhead access to system information, you might prefer more direct APIs such as [**Process Status Helper**](../psapi/process-status-helper.md), [**GlobalMemoryStatusEx**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-globalmemorystatusex), [**GetSystemTimes**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getsystemtimes), or [**GetProcessTimes**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getprocesstimes).</span></span> <span data-ttu-id="6fc75-110">Для профилирования можно выполнять сбор журналов ETW с данными профилирования системы с помощью [**tracelog.exe**](/windows-hardware/drivers/devtest/tracelog) с `-critsec` `-dpcisr` параметрами, `-eflag` или с `-ProfileSource` помощью [**профилирования счетчика оборудования**](/previous-versions/windows/desktop/hcp/hcp-reference).</span><span class="sxs-lookup"><span data-stu-id="6fc75-110">For profiling, you might collect ETW logs with system profiling data using [**tracelog.exe**](/windows-hardware/drivers/devtest/tracelog) with `-critsec`, `-dpcisr`, `-eflag`, or `-ProfileSource` options, or you might use [**Hardware Counter Profiling**](/previous-versions/windows/desktop/hcp/hcp-reference).</span></span>

> [!NOTE]
> <span data-ttu-id="6fc75-111">Не путайте счетчики производительности Windows с API [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) .</span><span class="sxs-lookup"><span data-stu-id="6fc75-111">Do not confuse Windows Performance Counters with the [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) API.</span></span> <span data-ttu-id="6fc75-112">Счетчики производительности Windows обеспечивают высокоуровневую абстракцию для многих типов системных данных.</span><span class="sxs-lookup"><span data-stu-id="6fc75-112">Windows Performance Counters provide a high-level abstraction for many kinds of system information.</span></span> <span data-ttu-id="6fc75-113">Функция QueryPerformanceCounter предоставляет оптимизированный доступ к метке времени с высокой точностью.</span><span class="sxs-lookup"><span data-stu-id="6fc75-113">The QueryPerformanceCounter function provides optimized access to a high-precision timestamp.</span></span>

## <a name="getting-started"></a><span data-ttu-id="6fc75-114">Приступая к работе</span><span class="sxs-lookup"><span data-stu-id="6fc75-114">Getting Started</span></span>

- <span data-ttu-id="6fc75-115">Используйте [средства счетчиков производительности](performance-counters-tools.md) , если требуется получить или просмотреть данные о производительности из системы.</span><span class="sxs-lookup"><span data-stu-id="6fc75-115">Use [Performance Counter Tools](performance-counters-tools.md) when you want to collect or view the performance data from a system.</span></span>
- <span data-ttu-id="6fc75-116">Используйте [API сбора счетчиков производительности](consuming-counter-data.md) , если требуется написать сценарий или программу, собирающую данные о производительности из локальной системы.</span><span class="sxs-lookup"><span data-stu-id="6fc75-116">Use [Performance Counter Collection APIs](consuming-counter-data.md) when you want to write a script or a program that collects performance data from the local system.</span></span>
- <span data-ttu-id="6fc75-117">Используйте [Классы счетчиков производительности WMI](/windows/desktop/WmiSdk/monitoring-performance-data) , если требуется получить данные о производительности из локальной или удаленной системы с помощью инструментария WMI.</span><span class="sxs-lookup"><span data-stu-id="6fc75-117">Use [WMI Performance Counter Classes](/windows/desktop/WmiSdk/monitoring-performance-data) when you want to collect performance data from a local or remote system using WMI.</span></span>
- <span data-ttu-id="6fc75-118">Используйте [API поставщика счетчиков производительности](providing-counter-data.md) , если требуется опубликовать данные о производительности из программного компонента.</span><span class="sxs-lookup"><span data-stu-id="6fc75-118">Use [Performance Counter Provider APIs](providing-counter-data.md) when you want to publish performance data from your software component.</span></span>

## <a name="concepts"></a><span data-ttu-id="6fc75-119">Основные понятия</span><span class="sxs-lookup"><span data-stu-id="6fc75-119">Concepts</span></span>

<span data-ttu-id="6fc75-120">Система счетчиков производительности Windows организована в виде **потребителей**, **поставщиков**, **каунтерсетс**, **счетчиков**, **экземпляров** и **значений счетчиков**.</span><span class="sxs-lookup"><span data-stu-id="6fc75-120">The Windows Performance Counter system is organized into **consumers**, **providers**, **countersets**, **counters**, **instances**, and **counter values**.</span></span>

<span data-ttu-id="6fc75-121">**Потребитель** — это программный компонент, который использует данные о производительности.</span><span class="sxs-lookup"><span data-stu-id="6fc75-121">A **consumer** is a software component that makes use of performance data.</span></span> <span data-ttu-id="6fc75-122">Windows включает несколько [встроенных средств](performance-counters-tools.md) , которые используют данные о производительности.</span><span class="sxs-lookup"><span data-stu-id="6fc75-122">Windows includes several [built-in tools](performance-counters-tools.md) that make use of performance data.</span></span> <span data-ttu-id="6fc75-123">К ним относятся диспетчер задач, монитор ресурсов, монитор производительности, typeperf.exe, logman.exe и relog.exe.</span><span class="sxs-lookup"><span data-stu-id="6fc75-123">These include Task Manager, Resource Monitor, Performance Monitor, typeperf.exe, logman.exe, and relog.exe.</span></span> <span data-ttu-id="6fc75-124">Разработчики могут создавать сценарии и приложения, обращающиеся к счетчикам производительности через [API-интерфейсы счетчика производительности](consuming-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="6fc75-124">Developers can write scripts and applications that access performance counters via [performance counter APIs](consuming-counter-data.md).</span></span>

<span data-ttu-id="6fc75-125">**Поставщик** — это программный компонент, который [создает и публикует данные производительности](providing-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="6fc75-125">A **provider** is a software component that [generates and publishes performance data](providing-counter-data.md).</span></span> <span data-ttu-id="6fc75-126">Поставщик будет публиковать данные для одного или нескольких *каунтерсетс*.</span><span class="sxs-lookup"><span data-stu-id="6fc75-126">A provider will publish data for one or more *countersets*.</span></span> <span data-ttu-id="6fc75-127">Например, система базы данных может зарегистрироваться в качестве поставщика данных о производительности.</span><span class="sxs-lookup"><span data-stu-id="6fc75-127">For example, a database system might register itself as a performance data provider.</span></span>

- <span data-ttu-id="6fc75-128">**Поставщик v1** — это программный компонент, который публикует данные производительности с помощью [библиотеки DLL производительности](providing-counter-data-using-a-performance-dll.md) , которая выполняется в процессе потребителя.</span><span class="sxs-lookup"><span data-stu-id="6fc75-128">A **V1 provider** is a software component that publishes performance data via a [performance DLL](providing-counter-data-using-a-performance-dll.md) that runs in the process of the consumer.</span></span> <span data-ttu-id="6fc75-129">Поставщик v1 устанавливается на компьютере с помощью `.ini` файла.</span><span class="sxs-lookup"><span data-stu-id="6fc75-129">A V1 provider is installed onto a system via an `.ini` file.</span></span> <span data-ttu-id="6fc75-130">Архитектура поставщика v1 устарела.</span><span class="sxs-lookup"><span data-stu-id="6fc75-130">The V1 provider architecture is deprecated.</span></span> <span data-ttu-id="6fc75-131">Новые поставщики должны использовать архитектуру поставщика v2.</span><span class="sxs-lookup"><span data-stu-id="6fc75-131">New providers should use the V2 provider architecture.</span></span>
- <span data-ttu-id="6fc75-132">**Поставщик v2** — это программный компонент, который публикует данные производительности с помощью [API поставщика счетчиков производительности](providing-counter-data-using-version-2-0.md).</span><span class="sxs-lookup"><span data-stu-id="6fc75-132">A **V2 provider** is a software component that publishes performance data via the [performance counter provider APIs](providing-counter-data-using-version-2-0.md).</span></span> <span data-ttu-id="6fc75-133">Поставщик v2 устанавливается на систему через `.man` файл (XML-манифест).</span><span class="sxs-lookup"><span data-stu-id="6fc75-133">A V2 provider is installed onto a system via a `.man` (XML manifest) file.</span></span>

<span data-ttu-id="6fc75-134">Набор **счетчиков** — это группирование данных о производительности в поставщике.</span><span class="sxs-lookup"><span data-stu-id="6fc75-134">A **counterset** is a grouping of performance data within a provider.</span></span> <span data-ttu-id="6fc75-135">Набор счетчиков имеет имя и один или несколько *счетчиков*.</span><span class="sxs-lookup"><span data-stu-id="6fc75-135">A counterset has a name and one or more *counters*.</span></span> <span data-ttu-id="6fc75-136">Сбор данных из набора счетчиков возвращает число *экземпляров*.</span><span class="sxs-lookup"><span data-stu-id="6fc75-136">Collecting the data from a counterset returns a number of *instances*.</span></span> <span data-ttu-id="6fc75-137">В некоторых API-интерфейсах Windows каунтерсетс называются **объектами производительности**.</span><span class="sxs-lookup"><span data-stu-id="6fc75-137">In some Windows APIs, countersets are called **performance objects**.</span></span> <span data-ttu-id="6fc75-138">Например, поставщик данных производительности для системы базы данных может предоставлять набор счетчиков для статистики по базе данных.</span><span class="sxs-lookup"><span data-stu-id="6fc75-138">For example, a performance data provider for a database system might provide a counterset for per-database statistics.</span></span>

<span data-ttu-id="6fc75-139">**Счетчик** — это определение отдельной части данных о производительности.</span><span class="sxs-lookup"><span data-stu-id="6fc75-139">A **counter** is the definition of single piece of performance data.</span></span> <span data-ttu-id="6fc75-140">У счетчика есть имя и тип.</span><span class="sxs-lookup"><span data-stu-id="6fc75-140">A counter has a name and a type.</span></span> <span data-ttu-id="6fc75-141">Например, набор счетчиков «статистика по базе данных» может содержать счетчик с именем «транзакций в секунду» с типом `PERF_COUNTER_COUNTER` .</span><span class="sxs-lookup"><span data-stu-id="6fc75-141">For example, a "per-database statistics" counterset might contain a counter named "transactions per second" with type `PERF_COUNTER_COUNTER`.</span></span>

<span data-ttu-id="6fc75-142">**Экземпляр** — это сущность, в которой сообщается о данных о производительности.</span><span class="sxs-lookup"><span data-stu-id="6fc75-142">An **instance** is an entity about which performance data is reported.</span></span> <span data-ttu-id="6fc75-143">Экземпляр имеет имя (строка) и одно или несколько *значений счетчика*.</span><span class="sxs-lookup"><span data-stu-id="6fc75-143">An instance has a name (string) and one or more *counter values*.</span></span> <span data-ttu-id="6fc75-144">Например, набор счетчиков «статистика по базе данных» может содержать по одному экземпляру на базу данных.</span><span class="sxs-lookup"><span data-stu-id="6fc75-144">For example, a "per-database statistics" counterset might contain one instance per database.</span></span> <span data-ttu-id="6fc75-145">Имя экземпляра будет именем базы данных, а каждый экземпляр будет содержать значения счетчика для счетчиков "транзакций в секунду", "использование памяти" и "использование диска".</span><span class="sxs-lookup"><span data-stu-id="6fc75-145">The instance name would be the database name, and each instance would contain counter values for "transactions per second", "memory usage", and "disk usage" counters.</span></span>

<span data-ttu-id="6fc75-146">**Значение счетчика** — это значение одного элемента данных счетчика производительности.</span><span class="sxs-lookup"><span data-stu-id="6fc75-146">A **counter value** is the value of a single piece of performance counter data.</span></span> <span data-ttu-id="6fc75-147">Значение счетчика — это целое число без знака, 32-бит или 64-бит, в зависимости от типа соответствующего счетчика.</span><span class="sxs-lookup"><span data-stu-id="6fc75-147">A counter value is an unsigned integer, either 32-bit or 64-bit depending on the type of the corresponding counter.</span></span> <span data-ttu-id="6fc75-148">При разговоре об *экземпляре* *значение счетчика* иногда может называться *счетчиком* или *значением*.</span><span class="sxs-lookup"><span data-stu-id="6fc75-148">When talking about an *instance*, a *counter value* might sometimes be called a *counter* or a *value*.</span></span>

> [!TIP]
> <span data-ttu-id="6fc75-149">Может быть полезно связать термины счетчиков производительности с более привычными условиями электронной таблицы.</span><span class="sxs-lookup"><span data-stu-id="6fc75-149">It might be helpful to relate performance counter terms to more familiar spreadsheet terms.</span></span> <span data-ttu-id="6fc75-150">Набор **счетчиков** подобен таблице.</span><span class="sxs-lookup"><span data-stu-id="6fc75-150">A **counterset** is like a table.</span></span> <span data-ttu-id="6fc75-151">**Счетчик** похож на столбец.</span><span class="sxs-lookup"><span data-stu-id="6fc75-151">A **counter** is like a column.</span></span> <span data-ttu-id="6fc75-152">**Экземпляр** похож на строку.</span><span class="sxs-lookup"><span data-stu-id="6fc75-152">An **instance** is like a row.</span></span> <span data-ttu-id="6fc75-153">**Значение счетчика** похоже на ячейку в таблице.</span><span class="sxs-lookup"><span data-stu-id="6fc75-153">A **counter value** is like a cell in the table.</span></span>

<span data-ttu-id="6fc75-154">**Один экземпляр каунтерсетс** всегда содержит данные только для одного экземпляра.</span><span class="sxs-lookup"><span data-stu-id="6fc75-154">**Single-instance countersets** always contain data for exactly one instance.</span></span> <span data-ttu-id="6fc75-155">Это распространено для каунтерсетс, которые сообщают о глобальной системе статистики.</span><span class="sxs-lookup"><span data-stu-id="6fc75-155">This is common for countersets that report system-global statistics.</span></span> <span data-ttu-id="6fc75-156">Например, Windows имеет встроенный набор счетчиков с одним экземпляром "память", который сообщает об использовании глобальной памяти.</span><span class="sxs-lookup"><span data-stu-id="6fc75-156">For example, Windows has a built-in single-instance counterset named "Memory" that reports on global memory usage.</span></span>

<span data-ttu-id="6fc75-157">**Каунтерсетс с несколькими экземплярами** содержит данные для переменного числа экземпляров.</span><span class="sxs-lookup"><span data-stu-id="6fc75-157">**Multi-instance countersets** contain data for a variable number of instances.</span></span> <span data-ttu-id="6fc75-158">Это распространено для каунтерсетс, которые сообщают о сущностях в системе.</span><span class="sxs-lookup"><span data-stu-id="6fc75-158">This is common for countersets that report about entities within the system.</span></span> <span data-ttu-id="6fc75-159">Например, Windows имеет встроенный набор счетчиков с несколькими экземплярами "сведения о процессоре", который сообщает по одному экземпляру для каждого установленного ЦП.</span><span class="sxs-lookup"><span data-stu-id="6fc75-159">For example, Windows has a built-in multi-instance counterset named "Processor Information" that reports one instance for each installed CPU.</span></span>

<span data-ttu-id="6fc75-160">Потребители периодически собираются и записывают данные из CounterSet поставщика.</span><span class="sxs-lookup"><span data-stu-id="6fc75-160">Consumers will periodically collect and record the data from a provider's counterset.</span></span> <span data-ttu-id="6fc75-161">Например, потребитель может получать данные один раз в секунду или один раз в минуту.</span><span class="sxs-lookup"><span data-stu-id="6fc75-161">For example, the consumer might collect data once per second or once per minute.</span></span> <span data-ttu-id="6fc75-162">Собранные данные называются **примером**.</span><span class="sxs-lookup"><span data-stu-id="6fc75-162">The data collected is called a **sample**.</span></span> <span data-ttu-id="6fc75-163">Пример состоит из меток времени и данных для экземпляров набора счетчиков.</span><span class="sxs-lookup"><span data-stu-id="6fc75-163">A sample consists of timestamps along with the data for instances of the counterset.</span></span> <span data-ttu-id="6fc75-164">Данные для каждого экземпляра включают имя экземпляра (строку) и набор значений счетчика (целые числа, по одному значению для каждого счетчика в наборе счетчиков).</span><span class="sxs-lookup"><span data-stu-id="6fc75-164">The data for each instance includes the instance name (string) and a set of counter values (integers, one value for each counter in the counterset).</span></span>

<span data-ttu-id="6fc75-165">Имена экземпляров должны быть уникальными в образце, т. е. поставщик не должен возвращать два экземпляра с одним и тем же именем как часть одного примера.</span><span class="sxs-lookup"><span data-stu-id="6fc75-165">Instance names should normally be unique within a sample, i.e. a provider should not return two instances with the same name as part of a single sample.</span></span> <span data-ttu-id="6fc75-166">Некоторые старые поставщики не соответствуют этому правилу, поэтому [потребители должны иметь возможность допускать неуникальные имена экземпляров](handling-duplicate-instance-names.md).</span><span class="sxs-lookup"><span data-stu-id="6fc75-166">Some older providers do not follow this rule, so [consumers must be able to tolerate non-unique instance names](handling-duplicate-instance-names.md).</span></span> <span data-ttu-id="6fc75-167">Имена экземпляров не учитывают регистр, поэтому экземпляры не должны иметь имен, отличающихся только регистром.</span><span class="sxs-lookup"><span data-stu-id="6fc75-167">Instance names are not case-sensitive, so instances should not have names that differ only in case.</span></span>

> [!NOTE]
> <span data-ttu-id="6fc75-168">В целях обратной совместимости набор счетчиков "процесс" возвращает неуникальные имена экземпляров на основе имени файла EXE.</span><span class="sxs-lookup"><span data-stu-id="6fc75-168">For backwards-compatibility reasons, the "Process" counterset returns non-unique instance names based on the EXE filename.</span></span> <span data-ttu-id="6fc75-169">Это может привести к путанице в результатах, особенно при запуске или завершении процесса с неуникальным именем, так как это обычно приводит к сбою данных из-за неправильного соответствия имен экземпляров между выборками.</span><span class="sxs-lookup"><span data-stu-id="6fc75-169">This can cause confusing results, especially when a process with a non-unique name starts up or shuts down, as this will typically result in data glitches due to incorrect matching of instance names between samples.</span></span> <span data-ttu-id="6fc75-170">Потребители в наборе счетчиков "процесс" должны иметь возможность допускать эти неуникальные имена экземпляров и результирующие данные.</span><span class="sxs-lookup"><span data-stu-id="6fc75-170">Consumers of of the "Process" counterset must be able to tolerate these non-unique instance names and the resulting data glitches.</span></span>

<span data-ttu-id="6fc75-171">Имена экземпляров должны быть стабильными в образцах, т. е. поставщик должен использовать одно и то же имя экземпляра для одной и той же сущности каждый раз при сборе набора счетчиков.</span><span class="sxs-lookup"><span data-stu-id="6fc75-171">Instance names must be stable across samples, i.e. a provider should use the same instance name for the same entity each time the counterset is collected.</span></span>

<span data-ttu-id="6fc75-172">Каждый счетчик имеет тип.</span><span class="sxs-lookup"><span data-stu-id="6fc75-172">Each counter has a type.</span></span> <span data-ttu-id="6fc75-173">Тип счетчика указывает тип **необработанного значения** счетчика (беззнаковое 32-разрядное целое число или неподписанное 64-разрядное целое число).</span><span class="sxs-lookup"><span data-stu-id="6fc75-173">The counter type indicates the type of the counter's **raw value** (either unsigned 32-bit integer or unsigned 64-bit integer).</span></span> <span data-ttu-id="6fc75-174">Тип счетчика также указывает, что представляет собой необработанное значение счетчика, которое определяет, как обработанное значение должно обрабатываться для создания полезной статистики.</span><span class="sxs-lookup"><span data-stu-id="6fc75-174">The counter type also indicates what the counter's raw value represents, which determines how the raw value should be processed to generate useful statistics.</span></span>

<span data-ttu-id="6fc75-175">Хотя некоторые типы счетчиков просты и имеют необработанное значение, которое напрямую полезно, многие типы счетчиков нуждаются в [дополнительной обработке](calculating-counter-values.md) , чтобы создать полезное **отформатированное значение**.</span><span class="sxs-lookup"><span data-stu-id="6fc75-175">While some counter types are simple and have a raw value that is directly useful, many counter types require [additional processing](calculating-counter-values.md) to create a useful **formatted value**.</span></span> <span data-ttu-id="6fc75-176">Для создания форматированного значения некоторым типам счетчиков требуются необработанные значения из двух выборок, для некоторых типов счетчиков требуются метки времени, а для некоторых типов счетчиков требуются необработанные значения из нескольких счетчиков.</span><span class="sxs-lookup"><span data-stu-id="6fc75-176">To produce the formatted value, some counter types require raw values from two samples, some counter types require timestamps, and some counter types require raw values from multiple counters.</span></span> <span data-ttu-id="6fc75-177">Пример:</span><span class="sxs-lookup"><span data-stu-id="6fc75-177">For example:</span></span>

- <span data-ttu-id="6fc75-178">`PERF_COUNTER_LARGE_RAWCOUNT` — Это 64-разрядное необработанное значение, которое не требует никакой обработки.</span><span class="sxs-lookup"><span data-stu-id="6fc75-178">`PERF_COUNTER_LARGE_RAWCOUNT` is a 64-bit raw value that requires no processing to be useful.</span></span> <span data-ttu-id="6fc75-179">Он подходит для значений на момент времени, например "байт используемой памяти".</span><span class="sxs-lookup"><span data-stu-id="6fc75-179">It is appropriate for point-in-time values such as "Bytes of memory in use".</span></span>
- <span data-ttu-id="6fc75-180">`PERF_COUNTER_RAWCOUNT_HEX` — Это 32-разрядное необработанное значение, которое должно быть полезно только для простого шестнадцатеричного форматирования.</span><span class="sxs-lookup"><span data-stu-id="6fc75-180">`PERF_COUNTER_RAWCOUNT_HEX` is a 32-bit raw value that requires only simple hexadecimal formatting to be useful.</span></span> <span data-ttu-id="6fc75-181">Он подходит для получения точки во времени или идентификации, например "Flags" или "базовый адрес".</span><span class="sxs-lookup"><span data-stu-id="6fc75-181">It is appropriate for point-in-time or identifying information such as "Flags" or "Base Address".</span></span>
- <span data-ttu-id="6fc75-182">`PERF_COUNTER_BULK_COUNT` — Это 64-разрядное необработанное значение, указывающее количество событий и используемое для вычисления скорости возникновения событий.</span><span class="sxs-lookup"><span data-stu-id="6fc75-182">`PERF_COUNTER_BULK_COUNT` is a 64-bit raw value that indicates a count of events and is used to compute the rate at which the events occur.</span></span> <span data-ttu-id="6fc75-183">Чтобы быть полезным, для этого типа счетчика требуется два образца, которые были разделены по времени.</span><span class="sxs-lookup"><span data-stu-id="6fc75-183">To be useful, this counter type requires two samples that are separated in time.</span></span> <span data-ttu-id="6fc75-184">Отформатированное значение — это частота событий, т. е. количество событий, произошедших в секунду за интервал между двумя примерами.</span><span class="sxs-lookup"><span data-stu-id="6fc75-184">The formatted value is the event rate, i.e. the number of times the event occurred per second over the interval between the two samples.</span></span> <span data-ttu-id="6fc75-185">Учитывая два образца `s0` и `s1` , отформатированное значение (частота событий) будет вычисляться как `(s1.EventCount - s0.EventCount)/(s1.TimestampInSeconds - s0.TimestampInSeconds)` .</span><span class="sxs-lookup"><span data-stu-id="6fc75-185">Given two samples `s0` and `s1`, the formatted value (event rate) would be computed as `(s1.EventCount - s0.EventCount)/(s1.TimestampInSeconds - s0.TimestampInSeconds)`.</span></span>

<span data-ttu-id="6fc75-186">Предполагается, что поставщики ведут себя так, как если бы они не изменяют состояние, т. е. сбор данных из набора счетчиков не должен заметно влиять на состояние поставщика.</span><span class="sxs-lookup"><span data-stu-id="6fc75-186">Providers are expected to behave as if they are stateless, i.e. collecting data from a counterset should not visibly affect the state of the provider.</span></span> <span data-ttu-id="6fc75-187">Например, поставщик не должен сбрасывать значения счетчика в 0 при сборе набора счетчиков и не должен использовать отметку времени предыдущей коллекции для корректировки значений в текущей коллекции.</span><span class="sxs-lookup"><span data-stu-id="6fc75-187">For example, a provider should not reset counter values to 0 when a counterset is collected and it should not use the timestamp of a previous collection to adjust the values in the current collection.</span></span> <span data-ttu-id="6fc75-188">Вместо этого он должен предоставлять простые необработанные значения счетчиков с точными типами, чтобы потребитель мог вычислить полезную статистику на основе необработанных значений и их меток времени.</span><span class="sxs-lookup"><span data-stu-id="6fc75-188">Instead, it should provide simple raw counter values with accurate types so that the consumer can compute useful statistics based on the raw values and their timestamps.</span></span>

## <a name="performance-api-architecture"></a><span data-ttu-id="6fc75-189">Архитектура API производительности</span><span class="sxs-lookup"><span data-stu-id="6fc75-189">Performance API Architecture</span></span>

![Приложения счетчиков производительности вызывают API Windows, которые вызывают поставщиков для получения данных о производительности.](images/architecture.png)

<span data-ttu-id="6fc75-191">Потребители счетчиков производительности включают:</span><span class="sxs-lookup"><span data-stu-id="6fc75-191">Performance counter consumers include:</span></span>

- <span data-ttu-id="6fc75-192">[Приложения, предоставляемые корпорацией Майкрософт](performance-counters-tools.md) , такие как диспетчер задач, монитор ресурсов, монитор производительности и typeperf.exe.</span><span class="sxs-lookup"><span data-stu-id="6fc75-192">[Microsoft-provided applications](performance-counters-tools.md) such as Task Manager, Resource Monitor, Performance Monitor, and typeperf.exe.</span></span>
- <span data-ttu-id="6fc75-193">Предоставляемые корпорацией Майкрософт высокоуровневые поверхности API, которые предоставляют данные счетчиков производительности, такие как [классы производительности WMI](/windows/desktop/WmiSdk/monitoring-performance-data).</span><span class="sxs-lookup"><span data-stu-id="6fc75-193">Microsoft-provided high-level API surfaces that expose performance counter data such as [WMI Performance Classes](/windows/desktop/WmiSdk/monitoring-performance-data).</span></span>
- <span data-ttu-id="6fc75-194">Собственные приложения или скрипты, использующие [API-интерфейсы потребителя счетчика производительности](consuming-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="6fc75-194">Your own applications or scripts that use [performance counter consumer APIs](consuming-counter-data.md).</span></span>

<span data-ttu-id="6fc75-195">Большинство потребителей счетчиков производительности используют API из [PDH.dll](using-the-pdh-functions-to-consume-counter-data.md) для получения данных о производительности.</span><span class="sxs-lookup"><span data-stu-id="6fc75-195">Most performance counter consumers use APIs from [PDH.dll](using-the-pdh-functions-to-consume-counter-data.md) to collect performance data.</span></span> <span data-ttu-id="6fc75-196">PDH управляет множеством сложных аспектов сбора счетчиков производительности, таких как анализ запросов, сопоставление экземпляров по нескольким примерам и вычисление форматированных значений из необработанных данных счетчиков.</span><span class="sxs-lookup"><span data-stu-id="6fc75-196">PDH manages many complex aspects of gathering performance counters such as parsing queries, matching up instances across multiple samples, and computing formatted values from the raw counter data.</span></span> <span data-ttu-id="6fc75-197">Реализация PDH использует API реестра при использовании данных от поставщика v1 и использует API-интерфейсы потребителя v2 При использовании данных от поставщика v2.</span><span class="sxs-lookup"><span data-stu-id="6fc75-197">The PDH implementation uses the registry APIs when consuming data from a V1 provider and uses the V2 consumer APIs when consuming data from a V2 provider.</span></span>

<span data-ttu-id="6fc75-198">Некоторые старые получатели счетчиков производительности используют [API реестра](using-the-registry-functions-to-consume-counter-data.md) для получения данных о производительности из специального `HKEY_PERFORMANCE_DATA` раздела реестра.</span><span class="sxs-lookup"><span data-stu-id="6fc75-198">Some older performance counter consumers use the [registry APIs](using-the-registry-functions-to-consume-counter-data.md) to collect performance data from the special `HKEY_PERFORMANCE_DATA` registry key.</span></span> <span data-ttu-id="6fc75-199">Это не рекомендуется для нового кода, поскольку обработка данных из реестра является сложной и подвержена ошибкам.</span><span class="sxs-lookup"><span data-stu-id="6fc75-199">This is not recommended for new code because processing the data from the registry is complex and error-prone.</span></span> <span data-ttu-id="6fc75-200">Реализация API реестра напрямую поддерживает сбор данных от поставщиков v1.</span><span class="sxs-lookup"><span data-stu-id="6fc75-200">The registry API implementation directly supports collecting data from V1 providers.</span></span> <span data-ttu-id="6fc75-201">Он косвенно поддерживает сбор данных от поставщиков v2 через слой перевода, использующий API-интерфейсы потребителя версии 2.</span><span class="sxs-lookup"><span data-stu-id="6fc75-201">It indirectly supports collecting data from V2 providers through a translation layer that uses the V2 consumer APIs.</span></span>

<span data-ttu-id="6fc75-202">Некоторые потребители счетчиков производительности используют [функции-потребители версии PerfLib v2](using-the-perflib-functions-to-consume-counter-data.md) для прямого доступа к данным из поставщиков v2.</span><span class="sxs-lookup"><span data-stu-id="6fc75-202">Some performance counter consumers use the [PerfLib V2 Consumer functions](using-the-perflib-functions-to-consume-counter-data.md) to directly access data from V2 providers.</span></span> <span data-ttu-id="6fc75-203">Это сложнее, чем использование данных с помощью интерфейсов API PDH, но этот подход может быть полезен, если интерфейсы API PDH не могут быть использованы из-за проблем с производительностью или зависимостями.</span><span class="sxs-lookup"><span data-stu-id="6fc75-203">This is more complex than consuming data using the PDH APIs, but this approach can be useful if PDH APIs cannot be used due to performance or dependency concerns.</span></span> <span data-ttu-id="6fc75-204">Реализация PerfLib v2 напрямую поддерживает сбор данных от поставщиков v2.</span><span class="sxs-lookup"><span data-stu-id="6fc75-204">The PerfLib V2 implementation directly supports collecting data from V2 providers.</span></span> <span data-ttu-id="6fc75-205">Он не поддерживает сбор данных от поставщиков v1.</span><span class="sxs-lookup"><span data-stu-id="6fc75-205">It does not support collecting data from V1 providers.</span></span>

> [!NOTE]
> <span data-ttu-id="6fc75-206">Windows OneCore не включает PDH.dll и не поддерживает использование данных счетчиков производительности с помощью API-интерфейсов реестра.</span><span class="sxs-lookup"><span data-stu-id="6fc75-206">Windows OneCore does not include PDH.dll and does not include support for consuming performance counter data via the registry APIs.</span></span> <span data-ttu-id="6fc75-207">Потребители, работающие в OneCore, должны использовать функции-потребители версии PerfLib v2.</span><span class="sxs-lookup"><span data-stu-id="6fc75-207">Consumers running on OneCore must use the PerfLib V2 Consumer functions.</span></span>

<span data-ttu-id="6fc75-208">Поставщики v1 реализуются как библиотека DLL поставщика, которая загружается в процесс потребителя.</span><span class="sxs-lookup"><span data-stu-id="6fc75-208">V1 providers are implemented as a provider DLL that is loaded into the consumer process.</span></span> <span data-ttu-id="6fc75-209">Реализация API реестра управляет загрузкой библиотеки DLL поставщика, вызовом библиотеки DLL для получения данных о производительности и выгрузкой библиотеки DLL соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="6fc75-209">The registry API implementation manages loading the provider DLL, calling into the DLL to collect performance data, and unloading the DLL as appropriate.</span></span> <span data-ttu-id="6fc75-210">Библиотека DLL поставщика отвечает за [сбор данных о производительности по мере необходимости](communicating-with-your-application.md), например с помощью обычных API Windows, RPC, именованных каналов, общей памяти или других механизмов взаимодействия между процессами.</span><span class="sxs-lookup"><span data-stu-id="6fc75-210">The provider DLL is responsible for [collecting performance data as appropriate](communicating-with-your-application.md), e.g. by using normal Windows APIs, RPC, named pipes, shared memory, or other interprocess communication mechanisms.</span></span>

<span data-ttu-id="6fc75-211">Поставщики v2 реализуются как программа пользовательского режима (часто это служба Windows) или драйвер режима ядра.</span><span class="sxs-lookup"><span data-stu-id="6fc75-211">V2 providers are implemented as either a user-mode program (often a Windows service) or a kernel-mode driver.</span></span> <span data-ttu-id="6fc75-212">Обычно код поставщика данных о производительности интегрируется непосредственно в существующий компонент (т. е. драйвер или служба сообщает о своей статистике).</span><span class="sxs-lookup"><span data-stu-id="6fc75-212">Usually the performance data provider code is integrated directly into an existing component (i.e. the driver or service is reporting statistics about itself).</span></span> <span data-ttu-id="6fc75-213">Реализация PerfLib v2 управляет запросами и ответами с помощью расширения ядра PCW.sys, поэтому поставщику обычно не требуется реализовывать взаимодействие между процессами для предоставления данных о производительности.</span><span class="sxs-lookup"><span data-stu-id="6fc75-213">The PerfLib V2 implementation manages requests and responses via the PCW.sys kernel extension so the provider usually does not need to implement any interprocess communication to provide the performance data.</span></span>

> [!NOTE]
> <span data-ttu-id="6fc75-214">API и средства счетчика производительности Windows включают ограниченную поддержку доступа к счетчикам производительности с других компьютеров с помощью удаленного реестра (для поставщиков v1) и RPC (для поставщиков v2).</span><span class="sxs-lookup"><span data-stu-id="6fc75-214">Windows Performance Counter APIs and tools include limited support for accessing performance counters from other machines via Remote Registry (for V1 providers) and RPC (for V2 providers).</span></span> <span data-ttu-id="6fc75-215">Эту поддержку часто трудно использовать в терминах элементов управления проверки подлинности (средства и API-интерфейсы могут проходить проверку подлинности только в качестве текущего пользователя), а также в плане [конфигурации системы](accessing-remote-counter-data.md) (необходимые конечные точки и службы отключены по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="6fc75-215">This support is often hard to use in terms of authentication controls (the tools and APIs can only authenticate as the current user) as well as in terms of [system configuration](accessing-remote-counter-data.md) (the necessary endpoints and services are disabled by default).</span></span> <span data-ttu-id="6fc75-216">Во многих случаях лучше обращаться к счетчикам производительности удаленных систем через [инструментарий WMI](/windows/desktop/WmiSdk/monitoring-performance-data) , а не через встроенную поддержку удаленного доступа.</span><span class="sxs-lookup"><span data-stu-id="6fc75-216">In many cases, it is better to access the performance counters of remote systems via [WMI](/windows/desktop/WmiSdk/monitoring-performance-data) rather than via the built-in remote access support.</span></span>

## <a name="developer-audience"></a><span data-ttu-id="6fc75-217">Аудитория разработчиков</span><span class="sxs-lookup"><span data-stu-id="6fc75-217">Developer audience</span></span>

<span data-ttu-id="6fc75-218">Счетчики производительности часто используются администраторами для определения проблем с производительностью или аномального поведения систем, разработчиками, которые могут изучить использование ресурсов программных компонентов, и отдельных пользователей, чтобы понять, как программы работают в своей системе.</span><span class="sxs-lookup"><span data-stu-id="6fc75-218">Performance counters are often consumed by administrators to identify performance issues or abnormal behavior of systems, by developers to study resource usage of software components, and by individual users to understand how programs are behaving on their system.</span></span> <span data-ttu-id="6fc75-219">Использование может осуществляться с помощью графических средств графического интерфейса, таких как диспетчер задач или системный монитор, средства командной строки, такие как typeperf.exe или logman.exe, с помощью сценариев с помощью WMI и PowerShell, а также через API-интерфейсы C/C++ и .NET.</span><span class="sxs-lookup"><span data-stu-id="6fc75-219">Usage may occur via GUI tools like Task Manager or Performance Monitor, command-line tools like typeperf.exe or logman.exe, via scripting via WMI and PowerShell, or through C/C++ and .NET APIs.</span></span>

<span data-ttu-id="6fc75-220">Поставщики счетчиков производительности обычно реализуются как драйверы режима ядра или службы пользовательского режима.</span><span class="sxs-lookup"><span data-stu-id="6fc75-220">Performance counter providers are usually implemented as kernel-mode drivers or user-mode services.</span></span> <span data-ttu-id="6fc75-221">Поставщики счетчиков производительности обычно пишутся на C или C++.</span><span class="sxs-lookup"><span data-stu-id="6fc75-221">Performance counter providers are usually written in C or C++.</span></span>

## <a name="run-time-requirements"></a><span data-ttu-id="6fc75-222">Требования к среде выполнения</span><span class="sxs-lookup"><span data-stu-id="6fc75-222">Run-time requirements</span></span>

<span data-ttu-id="6fc75-223">Сведения о требованиях времени выполнения для определенного программного элемента см. в разделе "требования" на странице справочника по этому элементу.</span><span class="sxs-lookup"><span data-stu-id="6fc75-223">For information about run-time requirements for a particular programming element, see the Requirements section of the reference page for that element.</span></span>

<span data-ttu-id="6fc75-224">Журнал версий см. в разделе [новые](performance-counters-what-s-new.md)возможности.</span><span class="sxs-lookup"><span data-stu-id="6fc75-224">For version history, see [What's New](performance-counters-what-s-new.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="6fc75-225">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="6fc75-225">See also</span></span>

[<span data-ttu-id="6fc75-226">Использование счетчиков производительности</span><span class="sxs-lookup"><span data-stu-id="6fc75-226">Using Performance Counters</span></span>](using-performance-counters.md)

[<span data-ttu-id="6fc75-227">Справочник по счетчикам производительности</span><span class="sxs-lookup"><span data-stu-id="6fc75-227">Performance Counters Reference</span></span>](performance-counters-reference.md)
