---
description: Чтобы открыть файл журнала для чтения, вызовите Пдхопенкуери и укажите путь к файлу журнала.
ms.assetid: 1d8f8662-df1f-4f84-8b65-c152f79cc5c6
title: Работа с файлами журналов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ba2032b90036f8f58c07d8c7e80e7e7ac2b2701c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105663142"
---
# <a name="working-with-log-files"></a><span data-ttu-id="58b82-103">Работа с файлами журналов</span><span class="sxs-lookup"><span data-stu-id="58b82-103">Working with Log Files</span></span>

<span data-ttu-id="58b82-104">Чтобы открыть файл журнала для чтения, вызовите [**пдхопенкуери**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) и укажите путь к файлу журнала.</span><span class="sxs-lookup"><span data-stu-id="58b82-104">To open a log file for reading, call [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) and specify a path to the log file.</span></span> <span data-ttu-id="58b82-105">Чтобы открыть файл журнала для записи, необходимо вызвать [**пдхопенлог**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga).</span><span class="sxs-lookup"><span data-stu-id="58b82-105">To open a log file for writing, you must call [**PdhOpenLog**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga).</span></span> <span data-ttu-id="58b82-106">Чтобы закрыть файл журнала, вызовите либо [**пдхклосекуери**](/windows/desktop/api/Pdh/nf-pdh-pdhclosequery) , либо [**пдхклоселог**](/windows/desktop/api/Pdh/nf-pdh-pdhcloselog) в зависимости от того, какая функция использовалась для открытия файла журнала.</span><span class="sxs-lookup"><span data-stu-id="58b82-106">To close a log file, call either [**PdhCloseQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhclosequery) or [**PdhCloseLog**](/windows/desktop/api/Pdh/nf-pdh-pdhcloselog) depending on which function you used to open the log file.</span></span>

## <a name="reading-from-a-log-file"></a><span data-ttu-id="58b82-107">Чтение из файла журнала</span><span class="sxs-lookup"><span data-stu-id="58b82-107">Reading from a log file</span></span>

<span data-ttu-id="58b82-108">Чтение данных о производительности из файла журнала аналогично чтению данных из источника в режиме реального времени — вы открываете запрос, добавляете к запросу счетчики и вызываете [**пдхколлекткуеридата**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata) для получения образца из файла журнала.</span><span class="sxs-lookup"><span data-stu-id="58b82-108">Reading performance data from a log file is the same as reading data from a real time source—you open a query, add counters to the query and call [**PdhCollectQueryData**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata) to collect a sample from the log file.</span></span> <span data-ttu-id="58b82-109">**Пдхколлекткуеридата** возвращает PDH \_ больше \_ \_ данных при достижении конца файла журнала.</span><span class="sxs-lookup"><span data-stu-id="58b82-109">**PdhCollectQueryData** returns PDH\_NO\_MORE\_DATA when you reach the end of the log file.</span></span>

<span data-ttu-id="58b82-110">Каждый пример в файле журнала содержит метку времени, когда она была первоначально собрана и записана в файл журнала.</span><span class="sxs-lookup"><span data-stu-id="58b82-110">Each sample in the log file contains a time stamp for when it was originally collected and written to the log file.</span></span> <span data-ttu-id="58b82-111">Чтобы получить метку времени для первой и последней выборки в файле журнала, вызовите функцию [**пдхжетдатасаурцетимеранже**](/windows/desktop/api/Pdh/nf-pdh-pdhgetdatasourcetimerangea) .</span><span class="sxs-lookup"><span data-stu-id="58b82-111">To retrieve the time stamp for the first and last sample in the log file, call the [**PdhGetDataSourceTimeRange**](/windows/desktop/api/Pdh/nf-pdh-pdhgetdatasourcetimerangea) function.</span></span> <span data-ttu-id="58b82-112">Если требуется ограничить выборки, считанные из журнала, на конкретный диапазон времени, см. раздел [Настройка диапазона времени для запроса](setting-a-time-range-for-a-query.md).</span><span class="sxs-lookup"><span data-stu-id="58b82-112">If you want to limit the samples that you read from the log to a specific time range, see [Setting a Time Range for a Query](setting-a-time-range-for-a-query.md).</span></span>

<span data-ttu-id="58b82-113">Если неизвестно, какие объекты производительности и счетчики существуют в файле журнала, можно вызвать [**пдхенумобжектс**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectsa) , чтобы определить список объектов.</span><span class="sxs-lookup"><span data-stu-id="58b82-113">If you do not know which performance objects and counters exist in the log file, you can call [**PdhEnumObjects**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectsa) to determine the list of objects.</span></span> <span data-ttu-id="58b82-114">При наличии объекта можно вызвать либо [**пдхенумобжектитемс**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa) , либо [**пдхекспандвилдкардпас**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha) , чтобы получить список экземпляров объекта и счетчиков, содержащихся в файле журнала.</span><span class="sxs-lookup"><span data-stu-id="58b82-114">Given an object, you can call either [**PdhEnumObjectItems**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa) or [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha) to retrieve a list of the object's instances and counters contained in the log file.</span></span>

<span data-ttu-id="58b82-115">При вызове [**пдхенумобжектитемс**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa)используйте списки экземпляров и счетчиков, чтобы создать путь для каждого возможного сочетания экземпляра и счетчика.</span><span class="sxs-lookup"><span data-stu-id="58b82-115">If you call [**PdhEnumObjectItems**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa), use the instance and counter lists to create a path for each possible combination of instance and counter.</span></span> <span data-ttu-id="58b82-116">При вызове [**пдхаддкаунтер**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) для добавления счетчика в запрос функция завершится ошибкой, если файл журнала не содержит данное сочетание.</span><span class="sxs-lookup"><span data-stu-id="58b82-116">When you call [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) to add the counter to the query, the function will fail if the log file does not contain the given combination.</span></span>

<span data-ttu-id="58b82-117">При использовании [**пдхекспандвилдкардпас**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha)можно создать путь, содержащий подстановочный знак для имени экземпляра и счетчика, например \\ Object ( \* ) \\ \* .</span><span class="sxs-lookup"><span data-stu-id="58b82-117">If you use [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha), you can create a path that contains a wildcard for the instance name and counter, for example, \\object(\*)\\\*.</span></span> <span data-ttu-id="58b82-118">Функция возвращает \_ Недопустимый \_ путь PDH, если объект не содержит экземпляр.</span><span class="sxs-lookup"><span data-stu-id="58b82-118">The function returns PDH\_INVALID\_PATH if the object does not contain an instance.</span></span> <span data-ttu-id="58b82-119">В этом случае вызовите **пдхекспандвилдкардпас** , используя подстановочный знак только для счетчика, например \\ Object \\ \* .</span><span class="sxs-lookup"><span data-stu-id="58b82-119">In this case, call **PdhExpandWildCardPath** using a wildcard for counter only, for example, \\object\\\*.</span></span>

<span data-ttu-id="58b82-120">Более новые операционные системы могут считывать файлы журналов, созданные в более старых операционных системах. Однако файлы журналов, созданные в Windows Vista и более поздних операционных системах, не могут быть прочитаны в более ранних операционных системах.</span><span class="sxs-lookup"><span data-stu-id="58b82-120">Newer operating systems can read log files that were generated on older operating systems; however, log files that were created on Windows Vista and later operating systems cannot be read on earlier operating systems.</span></span>

<span data-ttu-id="58b82-121">Пример, считывающий данные из файла журнала, см. в разделе [Чтение данных о производительности из файла журнала](reading-performance-data-from-a-log-file.md).</span><span class="sxs-lookup"><span data-stu-id="58b82-121">For an example that reads data from a log file, see [Reading Performance Data from a Log File](reading-performance-data-from-a-log-file.md).</span></span>

## <a name="reading-from-multiple-log-files"></a><span data-ttu-id="58b82-122">Чтение из нескольких файлов журнала</span><span class="sxs-lookup"><span data-stu-id="58b82-122">Reading from multiple log files</span></span>

<span data-ttu-id="58b82-123">Если необходимо создать запрос, считывающий данные из нескольких файлов журнала, вызовите [**пдхбиндинпутдатасаурце**](/windows/desktop/api/Pdh/nf-pdh-pdhbindinputdatasourcea) , чтобы привязать файлы журнала друг к другу.</span><span class="sxs-lookup"><span data-stu-id="58b82-123">If you need to create a query that reads from several log files, call the [**PdhBindInputDataSource**](/windows/desktop/api/Pdh/nf-pdh-pdhbindinputdatasourcea) to bind the log files together.</span></span> <span data-ttu-id="58b82-124">Затем необходимо использовать функции PDH, заканчивающиеся на H, например [**пдхопенкуерих**](/windows/desktop/api/Pdh/nf-pdh-pdhopenqueryh).</span><span class="sxs-lookup"><span data-stu-id="58b82-124">You then need to use PDH functions that end in 'H', for example, [**PdhOpenQueryH**](/windows/desktop/api/Pdh/nf-pdh-pdhopenqueryh).</span></span>

## <a name="writing-to-a-log-file"></a><span data-ttu-id="58b82-125">Запись в файл журнала</span><span class="sxs-lookup"><span data-stu-id="58b82-125">Writing to a log file</span></span>

<span data-ttu-id="58b82-126">Перед записью в файл журнала вызовите [**пдхопенкуери**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) , чтобы создать запрос и указать источник данных о производительности: данные в реальном времени или файл журнала.</span><span class="sxs-lookup"><span data-stu-id="58b82-126">Before writing to a log file, call [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) to create a query and specify the source of the performance data, either real time data or a log file.</span></span> <span data-ttu-id="58b82-127">Затем добавьте счетчики, которые необходимо запросить.</span><span class="sxs-lookup"><span data-stu-id="58b82-127">Then, add the counters that you want to query.</span></span>

<span data-ttu-id="58b82-128">Чтобы открыть файл назначения, вызовите [**пдхопенлог**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga).</span><span class="sxs-lookup"><span data-stu-id="58b82-128">To open the destination file, call [**PdhOpenLog**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga).</span></span> <span data-ttu-id="58b82-129">Укажите запрос при открытии файла журнала.</span><span class="sxs-lookup"><span data-stu-id="58b82-129">Specify the query when you open the log file.</span></span> <span data-ttu-id="58b82-130">Чтобы получить данные о производительности и записать их в файл журнала, вызовите [**пдхупдателог**](/windows/desktop/api/Pdh/nf-pdh-pdhupdateloga).</span><span class="sxs-lookup"><span data-stu-id="58b82-130">To collect the performance data and write it to the log file, call [**PdhUpdateLog**](/windows/desktop/api/Pdh/nf-pdh-pdhupdateloga).</span></span>

<span data-ttu-id="58b82-131">Если данные счетчика записываются в файл журнала с разделителями-запятыми (CSV) или с разделителями-табуляциями (. TSV), а путь содержит экземпляр с подстановочными знаками, путь разворачивается и в файл журнала включаются только те экземпляры, которые существуют в момент развертывания пути.</span><span class="sxs-lookup"><span data-stu-id="58b82-131">If the counter data is being written to comma-delimited (.csv) or tab-delimited (.tsv) log file and the path contains a wildcard instance, the path is expanded and only those instances that exist at the time the path is expanded are included in the log file.</span></span> <span data-ttu-id="58b82-132">Однако для двоичного файла (BLG) или файлов журнала SQL подстановочный знак не разворачивается, чтобы файл журнала содержал экземпляры, создаваемые во время ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="58b82-132">However, for binary (.blg) or SQL log files, the wildcard is not expanded so that the log file contains instances that are created during logging.</span></span>

<span data-ttu-id="58b82-133">Пример, в котором данные записываются в файл журнала, см. [в разделе запись данных о производительности в файл журнала](writing-performance-data-to-a-log-file.md).</span><span class="sxs-lookup"><span data-stu-id="58b82-133">For an example that writes data to a log file, see [Writing Performance Data to a Log File](writing-performance-data-to-a-log-file.md).</span></span>

## <a name="compressing-a-log-file"></a><span data-ttu-id="58b82-134">Сжатие файла журнала</span><span class="sxs-lookup"><span data-stu-id="58b82-134">Compressing a log file</span></span>

<span data-ttu-id="58b82-135">Для сжатия файла журнала можно использовать функцию [**пдхкомпутекаунтерстатистикс**](/windows/desktop/api/Pdh/nf-pdh-pdhcomputecounterstatistics) .</span><span class="sxs-lookup"><span data-stu-id="58b82-135">You can use the [**PdhComputeCounterStatistics**](/windows/desktop/api/Pdh/nf-pdh-pdhcomputecounterstatistics) function to compress a log file.</span></span> <span data-ttu-id="58b82-136">Например, прочитайте десять записей из файла журнала, вызовите **пдхкомпутекаунтерстатистикс** , чтобы вычислить среднее значение, а затем записать среднее значение в выходной файл журнала.</span><span class="sxs-lookup"><span data-stu-id="58b82-136">For example, read ten records from a log file, call **PdhComputeCounterStatistics** to compute the mean value and then write the mean value to an output log file.</span></span>

<span data-ttu-id="58b82-137">В следующем разделе приводятся дополнительные сведения об использовании файла журнала.</span><span class="sxs-lookup"><span data-stu-id="58b82-137">The following topic provides additional information on using a log file.</span></span>

-   [<span data-ttu-id="58b82-138">Получение размера файла журнала</span><span class="sxs-lookup"><span data-stu-id="58b82-138">Getting the Size of a Log File</span></span>](getting-the-size-of-a-log-file.md)

 

 



