---
description: Клиентские приложения, вызывающие интерфейсы WMI, могут управлять уровнями безопасности своих процессов.
ms.assetid: 790b4e40-9b92-464a-a774-dec0b75cedee
ms.tgt_platform: multiple
title: Настройка безопасности процесса клиентского приложения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8bfa0a42390ffa433cff01300b0976d40553665c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104265368"
---
# <a name="setting-client-application-process-security"></a><span data-ttu-id="59abf-103">Настройка безопасности процесса клиентского приложения</span><span class="sxs-lookup"><span data-stu-id="59abf-103">Setting Client Application Process Security</span></span>

<span data-ttu-id="59abf-104">Клиентские приложения, вызывающие интерфейсы WMI, могут управлять уровнями безопасности своих процессов.</span><span class="sxs-lookup"><span data-stu-id="59abf-104">Client applications that call WMI interfaces can control the security levels of their processes.</span></span> <span data-ttu-id="59abf-105">Все приложения WMI обращаются к WMI через COM, и вы можете вызвать функцию COM [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) , чтобы настроить безопасность для процессов.</span><span class="sxs-lookup"><span data-stu-id="59abf-105">All WMI applications access WMI through COM, and you can call the COM function [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) to set security for your processes.</span></span> <span data-ttu-id="59abf-106">Приложения, которые выполняют асинхронные вызовы к WMI и приложениям, зарегистрированным в качестве потребителей событий, устанавливают уровни безопасности для вызова в WMI.</span><span class="sxs-lookup"><span data-stu-id="59abf-106">Applications that make asynchronous calls to WMI and applications that register as event consumers set security levels on the call into WMI.</span></span>

<span data-ttu-id="59abf-107">Если не выполнить явный вызов [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity), COM вызывает его неявно с использованием значений из реестра.</span><span class="sxs-lookup"><span data-stu-id="59abf-107">If you do not make an explicit call to [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity), COM calls it implicitly with values from the registry.</span></span> <span data-ttu-id="59abf-108">Однако значения в реестре могут иметь более низкие параметры для олицетворения и проверки подлинности, которые не обеспечивают безопасность, необходимую для инструментария WMI.</span><span class="sxs-lookup"><span data-stu-id="59abf-108">However, the registry values may have lower settings for impersonation and authentication that do not provide the security required for WMI.</span></span> <span data-ttu-id="59abf-109">Дополнительные сведения см. [в разделе Задание уровня безопасности процесса по умолчанию с помощью C++](setting-the-default-process-security-level-using-c-.md).</span><span class="sxs-lookup"><span data-stu-id="59abf-109">For more information, see [Setting the Default Process Security Level Using C++](setting-the-default-process-security-level-using-c-.md).</span></span>

<span data-ttu-id="59abf-110">Асинхронный доступ к инструментарию WMI не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="59abf-110">Asynchronous access to WMI is not recommended.</span></span> <span data-ttu-id="59abf-111">Асинхронный обратный вызов позволяет пользователю без проверки подлинности предоставлять данные в приемник.</span><span class="sxs-lookup"><span data-stu-id="59abf-111">An asynchronous callback allows a non-authenticated user to provide data to the sink.</span></span> <span data-ttu-id="59abf-112">Это создает угрозы безопасности для сценариев и приложений.</span><span class="sxs-lookup"><span data-stu-id="59abf-112">This poses security risks to your scripts and applications.</span></span> <span data-ttu-id="59abf-113">Чтобы устранить риски, используйте семисинчронаус или синхронное взаимодействие или выполните соответствующие проверки доступа в клиентском приложении.</span><span class="sxs-lookup"><span data-stu-id="59abf-113">To eliminate the risks, use semisynchronous or synchronous communication, or perform proper access checks in your client application.</span></span> <span data-ttu-id="59abf-114">Дополнительные сведения см. [в разделе вызов метода](calling-a-method.md).</span><span class="sxs-lookup"><span data-stu-id="59abf-114">For more information, see [Calling a Method](calling-a-method.md).</span></span>

<span data-ttu-id="59abf-115">При вызове любого из WMI-прокси ([**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices), [**иенумвбемклассобжект**](/windows/desktop/api/Wbemcli/nn-wbemcli-ienumwbemclassobject),[**ивбемкаллресулт**](/windows/desktop/api/Wbemcli/nn-wbemcli-iwbemcallresult)или [**ивбемрефрешер**](/windows/desktop/api/Wbemcli/nn-wbemcli-iwbemrefresher)) используется необработанный указатель.</span><span class="sxs-lookup"><span data-stu-id="59abf-115">Calls to any of the WMI proxies ([**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices), [**IEnumWbemClassObject**](/windows/desktop/api/Wbemcli/nn-wbemcli-ienumwbemclassobject),[**IWbemCallResult**](/windows/desktop/api/Wbemcli/nn-wbemcli-iwbemcallresult), or [**IWbemRefresher**](/windows/desktop/api/Wbemcli/nn-wbemcli-iwbemrefresher)) use an out-of-process pointer.</span></span> <span data-ttu-id="59abf-116">Дополнительные сведения о значениях по умолчанию и рекомендациях см. в разделе [Настройка параметров безопасности для IWbemServices и других учетных записей-посредников](setting-the-security-on-iwbemservices-and-other-proxies.md).</span><span class="sxs-lookup"><span data-stu-id="59abf-116">For more information about the defaults and recommendations, see [Setting the Security on IWbemServices and Other Proxies](setting-the-security-on-iwbemservices-and-other-proxies.md).</span></span>

<span data-ttu-id="59abf-117">Следующая процедура описывает шаги, которые необходимо выполнить, чтобы настроить безопасность для WMI в процессе приложения.</span><span class="sxs-lookup"><span data-stu-id="59abf-117">The following procedure describes the steps you must perform to set the security for WMI on your application process.</span></span>

<span data-ttu-id="59abf-118">**Настройка безопасности для WMI в процессе приложения**</span><span class="sxs-lookup"><span data-stu-id="59abf-118">**To set security for WMI on your application process**</span></span>

1.  <span data-ttu-id="59abf-119">Определите уровни безопасности, необходимые для операционных систем Windows, на которых выполняется клиентское приложение.</span><span class="sxs-lookup"><span data-stu-id="59abf-119">Determine the security levels required for the Windows operating systems on which your client application runs.</span></span>
2.  <span data-ttu-id="59abf-120">Вызовите функцию COM [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) , чтобы задать параметры безопасности по умолчанию для процесса, в котором выполняется клиентское приложение.</span><span class="sxs-lookup"><span data-stu-id="59abf-120">Call the COM [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) function to set the default security for the process in which the client application runs.</span></span> <span data-ttu-id="59abf-121">Здесь объявляется, какой объем безопасности требуется для доступа к процессу, в котором выполняется приложение.</span><span class="sxs-lookup"><span data-stu-id="59abf-121">This declares how much security other applications require to access the process in which your application runs.</span></span>
3.  <span data-ttu-id="59abf-122">Если необходимо изменить безопасность на отдельном прокси-сервере, например в другом вызове [**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices), вызовите метод [**CoSetProxyBlanket**](/windows/win32/api/combaseapi/nf-combaseapi-cosetproxyblanket).</span><span class="sxs-lookup"><span data-stu-id="59abf-122">If you need to change the security on an individual proxy, for example on another call to [**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices), call [**CoSetProxyBlanket**](/windows/win32/api/combaseapi/nf-combaseapi-cosetproxyblanket).</span></span>
4.  <span data-ttu-id="59abf-123">Если необходимо управлять удаленным оборудованием или системным объектом, которым требуются дополнительные привилегии, используйте функцию [**AdjustTokenPrivileges**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-adjusttokenprivileges) , чтобы включить необходимые привилегии.</span><span class="sxs-lookup"><span data-stu-id="59abf-123">If you need to control remote hardware or a system object that requires more privilege, use the [**AdjustTokenPrivileges**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-adjusttokenprivileges) function to enable the necessary privileges.</span></span> <span data-ttu-id="59abf-124">Обратите внимание, что нельзя включить привилегию, которой не назначен процесс.</span><span class="sxs-lookup"><span data-stu-id="59abf-124">Note that you cannot enable a privilege that the process does not already have assigned to it.</span></span> <span data-ttu-id="59abf-125">Дополнительные сведения см. [в разделе Проверка доступа к частным объектам](/windows/desktop/SecAuthZ/checking-access-to-private-objects).</span><span class="sxs-lookup"><span data-stu-id="59abf-125">For more information, see [Checking Access to Private Objects](/windows/desktop/SecAuthZ/checking-access-to-private-objects).</span></span>

<span data-ttu-id="59abf-126">Дополнительные сведения о настройке уровня безопасности процесса по умолчанию см. в разделе [Настройка уровня безопасности процесса по умолчанию с помощью C++](setting-the-default-process-security-level-using-c-.md) и [Задание уровня безопасности процесса по умолчанию с помощью VBScript](setting-the-default-process-security-level-using-vbscript.md).</span><span class="sxs-lookup"><span data-stu-id="59abf-126">For further information about setting the default process security level, see [Setting the Default Process Security Level Using C++](setting-the-default-process-security-level-using-c-.md) and [Setting the Default Process Security Level Using VBScript](setting-the-default-process-security-level-using-vbscript.md).</span></span>

 

 
