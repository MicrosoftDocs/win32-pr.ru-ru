---
description: Можно запретить неавторизованным пользователям получать события, к которым у них нет доступа.
ms.assetid: 59788643-f57d-458f-91ab-26552218523b
ms.tgt_platform: multiple
title: Безопасное предоставление событий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d2c92ed1de08dde4891365440f559544a0b26de5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104265879"
---
# <a name="providing-events-securely"></a><span data-ttu-id="d5e34-103">Безопасное предоставление событий</span><span class="sxs-lookup"><span data-stu-id="d5e34-103">Providing Events Securely</span></span>

<span data-ttu-id="d5e34-104">Можно запретить неавторизованным пользователям получать события, к которым у них нет доступа.</span><span class="sxs-lookup"><span data-stu-id="d5e34-104">You can prevent unauthorized users from receiving events to which they should not have access.</span></span> <span data-ttu-id="d5e34-105">Поставщик событий может предоставлять экземпляры собственных классов событий, так же как [поставщик системного реестра](/previous-versions/windows/desktop/regprov/system-registry-provider) предоставляет такие классы, как [**регистрикэйчанжеевент**](/previous-versions/windows/desktop/regprov/registrykeychangeevent).</span><span class="sxs-lookup"><span data-stu-id="d5e34-105">Your event provider can supply instances of its own event classes, just as the [System Registry Provider](/previous-versions/windows/desktop/regprov/system-registry-provider) supplies classes such as [**RegistryKeyChangeEvent**](/previous-versions/windows/desktop/regprov/registrykeychangeevent).</span></span> <span data-ttu-id="d5e34-106">Поставщик событий может также предоставлять внутренние события, такие как [**\_ \_ инстанцекреатионевент**](--instancecreationevent.md).</span><span class="sxs-lookup"><span data-stu-id="d5e34-106">Your event provider can also deliver intrinsic events such as [**\_\_InstanceCreationEvent**](--instancecreationevent.md).</span></span> <span data-ttu-id="d5e34-107">Дополнительные сведения см. в разделе [запись поставщика событий](writing-an-event-provider.md).</span><span class="sxs-lookup"><span data-stu-id="d5e34-107">For more information, see [Writing an Event Provider](writing-an-event-provider.md).</span></span>

<span data-ttu-id="d5e34-108">Поставщик событий может контролировать доступ к получателям событий следующими способами.</span><span class="sxs-lookup"><span data-stu-id="d5e34-108">An event provider can control access to event recipients in the following ways:</span></span>

-   <span data-ttu-id="d5e34-109">Использование контроля доступа путем реализации [**ивбемевентпровидерсекурити:: AccessCheck**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovidersecurity) является наиболее эффективным способом.</span><span class="sxs-lookup"><span data-stu-id="d5e34-109">Using access control by implementing [**IWbemEventProviderSecurity::AccessCheck**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovidersecurity) is the most efficient way.</span></span>

    <span data-ttu-id="d5e34-110">Поставщик определяет, имеет ли потребитель права на получение запрошенного события.</span><span class="sxs-lookup"><span data-stu-id="d5e34-110">The provider determines whether the consumer has privileges to receive a requested event.</span></span> <span data-ttu-id="d5e34-111">Если потребитель не имеет достаточных привилегий для регистрации, Инструментарий WMI возвращает ошибку отказа в доступе.</span><span class="sxs-lookup"><span data-stu-id="d5e34-111">If the consumer lacks sufficient privileges to register, WMI returns an access denied error.</span></span> <span data-ttu-id="d5e34-112">Используйте этот режим, если поставщик может принять решение о том, кто может принимать события.</span><span class="sxs-lookup"><span data-stu-id="d5e34-112">Use this mode when the provider can make the decision about who can receive events.</span></span> <span data-ttu-id="d5e34-113">Например, поставщик может предоставлять события, связанные с безопасностью, и может требовать, чтобы потребитель имел права администратора с включенным привилегиями **SeSecurityPrivilege** .</span><span class="sxs-lookup"><span data-stu-id="d5e34-113">For example, a provider may supply security related events and can require that the consumer have administrator privileges with the **SeSecurityPrivilege** privilege enabled.</span></span>

-   <span data-ttu-id="d5e34-114">Реализация [**ивбемевентсинк:: сетсинксекурити**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-setsinksecurity) в приемнике, используемом для вызова событий, позволяет установить дескриптор безопасности (SD) в приемнике для всех событий, передаваемых через.</span><span class="sxs-lookup"><span data-stu-id="d5e34-114">Implementing [**IWbemEventSink::SetSinkSecurity**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-setsinksecurity) on the sink used to raise events allows the setting of a security descriptor (SD) on a sink for all the events passing through.</span></span>

    <span data-ttu-id="d5e34-115">Инструментарий WMI выполняет проверки доступа на основе SD.</span><span class="sxs-lookup"><span data-stu-id="d5e34-115">WMI performs access checks based on the SD.</span></span> <span data-ttu-id="d5e34-116">Используйте этот режим, если поставщик не может принять решение о том, кому разрешено использовать события, но может выбрать SD для определенного приемника.</span><span class="sxs-lookup"><span data-stu-id="d5e34-116">Use this mode when the provider cannot make the decision regarding who is allowed to consume its events, but can decide on an SD for a specific sink.</span></span> <span data-ttu-id="d5e34-117">Например, используйте [**ивбемевентсинк:: сетсинксекурити**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-setsinksecurity) , если поставщик событий получил несколько приемников путем вызова [**Ивбемевентсинк:: жетрестриктедсинк**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-getrestrictedsink) и требуется дескриптор безопасности для каждого приемника.</span><span class="sxs-lookup"><span data-stu-id="d5e34-117">For example, use [**IWbemEventSink::SetSinkSecurity**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-setsinksecurity) if your event provider obtained several sinks by calls to [**IWbemEventSink::GetRestrictedSink**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-getrestrictedsink) and you want a security descriptor for each sink.</span></span>

-   <span data-ttu-id="d5e34-118">Установка свойства **\_ дескриптора безопасности** события позволяет настроить SD для каждого события.</span><span class="sxs-lookup"><span data-stu-id="d5e34-118">Setting the **SECURITY\_DESCRIPTOR** property of an event allows for the setting of an SD for each event.</span></span>

    <span data-ttu-id="d5e34-119">Используйте этот подход, если каждое событие, доставленное в приемник, может иметь разные дескрипторы безопасности.</span><span class="sxs-lookup"><span data-stu-id="d5e34-119">Use this approach when each event delivered to the sink can have different security descriptors.</span></span> <span data-ttu-id="d5e34-120">Чтобы использовать этот подход, необходимо получить все внешние классы событий, определенные поставщиком, из [**\_ \_ события**](--event.md) или [**\_ \_ екстринсицевент**](--extrinsicevent.md) , чтобы класс содержал свойство **\_ дескриптора безопасности** .</span><span class="sxs-lookup"><span data-stu-id="d5e34-120">To use this approach, derive any of the extrinsic event classes defined by your provider from [**\_\_Event**](--event.md) or [**\_\_ExtrinsicEvent**](--extrinsicevent.md) so that your class contains the **SECURITY\_DESCRIPTOR** property.</span></span> <span data-ttu-id="d5e34-121">Например, поставщик событий может публиковать как безопасные, так и обычные события через приемник.</span><span class="sxs-lookup"><span data-stu-id="d5e34-121">For example, your event provider may publish both secure and normal events through a sink.</span></span> <span data-ttu-id="d5e34-122">В этом случае используйте дескриптор безопасности учетной записи администратора для безопасных событий и **нулевой** дескриптор безопасности для обычных событий, которые могут быть получены любым пользователем.</span><span class="sxs-lookup"><span data-stu-id="d5e34-122">In this case, use the Administrators account security descriptor for secure events and a **NULL** security descriptor for normal events that can be received by anyone.</span></span>

## <a name="securing-events-by-decoupled-event-providers"></a><span data-ttu-id="d5e34-123">Защита событий по несвязанным поставщикам событий</span><span class="sxs-lookup"><span data-stu-id="d5e34-123">Securing Events by Decoupled Event Providers</span></span>

<span data-ttu-id="d5e34-124">Несвязанные поставщики событий отличаются от поставщиков неразделенных событий тем, как они регистрируются в WMI.</span><span class="sxs-lookup"><span data-stu-id="d5e34-124">Decoupled event providers differ from nondecoupled event providers in the way that they register with WMI.</span></span> <span data-ttu-id="d5e34-125">Вызов [**ивбемевентпровидерсекурити:: AccessCheck**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventprovidersecurity-accesscheck) для событий из несвязанного поставщика никогда не распространяет маркер доступа клиента.</span><span class="sxs-lookup"><span data-stu-id="d5e34-125">The call to [**IWbemEventProviderSecurity::AccessCheck**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventprovidersecurity-accesscheck) for events from a decoupled provider never propagates the client access token.</span></span> <span data-ttu-id="d5e34-126">Инструментарий WMI обрабатывает управление доступом так же, как и для взаимосвязанных поставщиков событий.</span><span class="sxs-lookup"><span data-stu-id="d5e34-126">WMI handles the access control in the same manner as for nondecoupled event providers.</span></span> <span data-ttu-id="d5e34-127">Дополнительные сведения о создании несвязанного поставщика см. в разделе [Включение поставщика в приложение](incorporating-a-provider-in-an-application.md).</span><span class="sxs-lookup"><span data-stu-id="d5e34-127">For more information about writing a decoupled provider, see [Incorporating a Provider in an Application](incorporating-a-provider-in-an-application.md).</span></span>

<span data-ttu-id="d5e34-128">Только администраторы с правами **полного \_** доступа на запись в **элементе управления WMI** **панели управления** могут создавать события для пространства имен.</span><span class="sxs-lookup"><span data-stu-id="d5e34-128">Only administrators with the **FULL\_WRITE** privilege set in **WMI Control** of the **Control Panel** are allowed to raise events for a namespace.</span></span> <span data-ttu-id="d5e34-129">Дополнительные сведения см. [в разделе Настройка безопасности пространства имен с помощью элемента управления WMI](setting-namespace-security-with-the-wmi-control.md).</span><span class="sxs-lookup"><span data-stu-id="d5e34-129">For more information, see [Setting Namespace Security with the WMI Control](setting-namespace-security-with-the-wmi-control.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="d5e34-130">См. также</span><span class="sxs-lookup"><span data-stu-id="d5e34-130">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d5e34-131">Защита событий WMI</span><span class="sxs-lookup"><span data-stu-id="d5e34-131">Securing WMI Events</span></span>](securing-wmi-events.md)
</dt> </dl>

 

 
