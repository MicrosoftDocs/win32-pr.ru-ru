---
description: Иногда может потребоваться обновить только часть экземпляра.
ms.assetid: c92bf8f9-9cac-4cf0-a45d-f60aee5a9ec2
ms.tgt_platform: multiple
title: Обновление части экземпляра
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4eaf58bfc151358a2b4f282815769d1b19c068f7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105701934"
---
# <a name="updating-part-of-an-instance"></a>Обновление части экземпляра

Иногда может потребоваться обновить только часть экземпляра. Например, некоторые экземпляры имеют большое количество свойств. Если вам пришлось обновлять большое количество этих экземпляров, производительность системы может снизиться. Таким образом, можно обновить только часть экземпляра и, таким образом, сократить объем информации, которую необходимо отправить и получить из WMI. Однако Инструментарий WMI напрямую не поддерживает операции с частичным экземпляром и большинство поставщиков. Таким образом, при написании приложения, использующего операции с частичным экземпляром, необходимо подготовиться к сбою вызовов с помощью **\_ \_ \_ неподдерживаемого** поставщика WBEM e или WBEM e, не **\_ \_ \_ \_ поддерживающего** код ошибки в C++. В языках сценариев коды ошибок могут быть либо **вбемеррпровидерноткапабле** , либо **вбемеррнотсуппортед**.

В сценариях эта операция необходима только для повышения производительности при обновлении одного или двух записываемых свойств в очень большом количестве объектов на предприятии. В противном случае стандартный вызов VBScript к [**SWbemObject. \_**](swbemobject-put-.md) WHERE или [**SWbemObject. \_ путасинк**](swbemobject-putasync-.md), в то время как записывает весь объект, фактически обновляет только те свойства, для которых у поставщика есть доступ на запись.

Следующая процедура описывает, как запросить обновление частичного экземпляра с помощью PowerShell.

**Запрос обновления частичного экземпляра с помощью PowerShell**

1.  Получите путь к объекту, который вы хотите обновить.

    Путь можно описать вручную или, в противном случае, запросить объект и получить свойство **\_ \_ path** .

    ```PowerShell
    $myWMIDrivePath = (get-wmiObject Win32_LogicalDisk -filter "Name = 'C:'").__Path
    #or
    $myWmiDrivePath = \\myComputer\root\cimv2:Win32_LogicalDisk.DeviceID="C:"
    ```

    

2.  Настройте хэш-таблицу, в которой перечислены имена обновляемых свойств, и используйте эту хэш-таблицу в вызове [Set-WmiInstance](/powershell/module/microsoft.powershell.management/set-wmiinstance?view=powershell-5.1&preserve-view=true).

    ```PowerShell
    $newDriveName = @{VolumeName = "OSDisk"}
    Set-WmiInstance -Path $myWMIDrivePath -Arguments $newDriveName
    ```

    

Следующая процедура описывает, как запросить обновление частичного экземпляра с помощью C#.

> [!Note]  
> **System. Management** является исходным пространством имен .NET, используемым для доступа к WMI; Однако интерфейсы API в этом пространстве имен обычно выполняются медленнее и не масштабируются по сравнению с более современными аналогами **Microsoft. Management. Infrastructure** .

 

**Запрос обновления частичного экземпляра с помощью C #**

1.  Создайте новый объект [ManagementObject](/dotnet/api/system.management.managementobject) , представляющий конкретный экземпляр для обновления.

    ```PowerShell
    using System.Management;
    ...
    ManagementObject myDisk = new ManagementObject("Win32_LogicalDisk.DeviceID='C:'");
    ```

    

2.  Задайте значение свойства с помощью вызова [ManagementObject. сетпропертивалуе](/dotnet/api/system.management.managementbaseobject.setpropertyvalue#System_Management_ManagementBaseObject_SetPropertyValue_System_String_System_Object_).

    ```CSharp
    myDisk.SetPropertyValue("VolumeName", "OSDisk");
    ```

    

Следующая процедура описывает, как запросить обновление частичного экземпляра с помощью VBScript.

**Запрос обновления частичного экземпляра с помощью VBScript**

1.  Создайте объект контекста [**свбемнамедвалуесет**](swbemnamedvalueset.md) .

    ```VB
    Set objwbemNamedValueSet = CreateObject ("WbemScripting.SWbemNamedValueSet")
    ```

    

2.  Добавьте значения расширения " \_ \_ Размещение \_ расширений" и " \_ \_ разместить запрос на \_ \_ клиенте ext \_ " в объект контекста с помощью метода [**свбемнамедвалуесет. Add**](swbemnamedvalueset-add.md) .

    ```VB
    objwbemNamedValueSet.Add "__PUT_EXTENSIONS", True
    objwbemNamedValueSet.Add "__PUT_EXT_CLIENT_REQUEST", True
    ```

    

3.  Настройте массив, в котором перечислены имена обновляемых свойств, и добавьте этот массив в объект контекста [**свбемнамедвалуесет**](swbemnamedvalueset.md) с помощью параметра размещения расширения " \_ \_ Вставить \_ ext \_ Properties".

    ```VB
    arProperties = Array("propertyname1", "propertyname2") 
    objwbemNamedValueSet.Add "__PUT_EXT_PROPERTIES", arProperties
    ```

    

4.  Задайте параметр *ифлагс* вызова [**SWbemObject \_ .**](swbemobject-put-.md) Set в **вбемчанжефлагупдатеонли**. Без этого флага вызов завершится ошибкой с недопустимым контекстом.

5.  Передайте объект флага и контекст поставщику в параметре *обжвбемнамедвалуесет* либо [**SWbemObject \_ .**](swbemobject-put-.md) WHERE, либо [**SWbemObject. путасинк \_**](swbemobject-putasync-.md).

    ```VB
    call objSystem.put_( wbemChangeFlagUpdateOnly, objwbemNamedValueSet)
    ```

    

Следующая процедура описывает, как запросить обновление частичного экземпляра с помощью C++.

**Запрос обновления частичного экземпляра с помощью C++**

1.  Создайте объект [**ивбемконтекст**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemcontext) с вызовом [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance).

    Объект контекста — это объект, который WMI использует для передачи дополнительных сведений поставщику WMI. В этом случае вы используете объект [**ивбемконтекст**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemcontext) , чтобы дать поставщику возможность принимать обновления частичного экземпляра.

2.  Добавьте \_ \_ \_ именованные значения "помещает расширения" и " \_ \_ поместить \_ ext \_ Client \_ request" в объект [**ивбемконтекст**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemcontext) с помощью вызова [**ивбемконтекст:: SetValue**](/windows/desktop/api/WbemCli/nf-wbemcli-iwbemcontext-setvalue).

    В следующей таблице перечислены значения " \_ \_ Размещение \_ расширений" и " \_ \_ Размещение \_ ext \_ \_ WebRequest Client".

    

    | Именованное значение                     | Описание                                                                                                                                                                                                                                             |
    |---------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | " \_ \_ Размещение \_ расширений"           | **VT \_ Для BOOL** задано значение **Variant \_ true**. Значение, указывающее, что было указано одно или несколько других значений контекста. Это позволяет быстро проверить объект контекста в поставщике, чтобы определить, используются ли обновления частичного экземпляра. |
    | " \_ \_ Размещение \_ ext \_ Client \_ request" | **VT \_ Для BOOL** задано значение **Variant \_ true**. Задается клиентом во время первоначального запроса. Это значение используется для предотвращения ошибок повторного входа.                                                                                                                   |

    

     

3.  Добавьте к \_ \_ \_ \_ \_ \_ \_ \_ \_ \_ \_ \_ \_ объекту [**ивбемконтекст**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemcontext) в любом сочетании с другим вызовом метода [**ивбемконтекст:: SetValue**](/windows/desktop/api/WbemCli/nf-wbemcli-iwbemcontext-setvalue), добавить свойства "поместить ext", "разместить ВДЛ", "вставить ext" или "вставить ext Atomic".

    В следующей таблице перечислены значения именованных значений.

    

    | Именованное значение                   | Описание                                                                                                                                                                                                                                   |
    |-------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | " \_ \_ поставьте \_ ext в \_ \_ значения NULL" | **VT \_ Для BOOL** задано значение **Variant \_ true**. Указывает, что клиент намеренно установил свойства **VT \_ null** и ждет, что операция записи будет выполнена успешно. Если поставщик не может присвоить значения **null**, следует сообщить об ошибке. |
    | " \_ \_ Вставить \_ ext \_ Properties"    | [**SAFEARRAY**](/windows/win32/api/oaidl/ns-oaidl-safearray) строк, содержащих список обновляемых имен свойств. Может использоваться отдельно или в сочетании со \_ \_ \_ свойством "вставить ext \_ ". Значения находятся в записываемом экземпляре.                           |
    | " \_ \_ помещает \_ ext \_ Atomic"        | **VT \_ Для BOOL** задано значение **Variant \_ true**. Указывает, что все обновления должны выполняться одновременно (атомарная семантика) или поставщик должен вернуться обратно. Частичный результат не может быть успешным. Может использоваться отдельно или в сочетании с другими флагами.     |

    

     

4.  Установите параметр *ифлагс* в значение **\_ \_ \_ только обновление флагов WBEM**. Без этого флага вызов завершится ошибкой с недопустимым контекстом.
5.  Передайте объект контекста [**ивбемконтекст**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemcontext) в любые вызовы [**IWbemServices::P утинстанце**](/windows/desktop/api/WbemCli/nf-wbemcli-iwbemservices-putinstance) или [**IWbemServices::P утинстанцеасинк**](/windows/desktop/api/WbemCli/nf-wbemcli-iwbemservices-putinstanceasync) в параметре *пкткс* .

    Передача объекта [**ивбемконтекст**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemcontext) дает поставщику разрешение на обновление частичного экземпляра. В обновлении с полным экземпляром необходимо установить *пкткс* в **значение NULL**.

    Поставщик может записать все необходимые свойства, если объект контекста, находящиеся в вызове, не содержит " \_ \_ размещать \_ расширения". Если \_ \_ \_ в объекте контекста есть "постановка расширений", Инструментарий WMI требует, чтобы поставщик либо приложил к семантике операции точно, либо в случае сбоя вызова. Дополнительные сведения см. [в разделе Обработка сообщений с запретом доступа в поставщике](impersonating-a-client.md).

 

 
