---
description: Классы C++ с WMI, которые являются частью платформы поставщика WMI, больше не рекомендуются для использования.
ms.assetid: d2414a72-3435-4035-bcd9-b3ec87f5709c
ms.tgt_platform: multiple
title: Вспомогательные классы инфраструктуры поставщика
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cab09c99fe2597cacd81e55a4ed18bd4e286ff16
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105703189"
---
# <a name="provider-framework-utility-classes"></a><span data-ttu-id="d9768-103">Вспомогательные классы инфраструктуры поставщика</span><span class="sxs-lookup"><span data-stu-id="d9768-103">Provider Framework Utility Classes</span></span>

<span data-ttu-id="d9768-104">\[Классы C++ с WMI, которые являются частью платформы поставщика WMI, которая теперь считается окончательным состоянием, и дальнейшая разработка, улучшения и обновления не будут доступны для проблем, связанных с безопасностью, затрагивающих эти библиотеки.</span><span class="sxs-lookup"><span data-stu-id="d9768-104">\[WMI C++ classes that are part of the WMI Provider Framework which is now considered in final state, and no further development, enhancements, or updates will be available for non-security related issues affecting these libraries.</span></span> <span data-ttu-id="d9768-105">[API MI](/previous-versions/windows/desktop/wmi_v2/windows-management-infrastructure) следует использовать для всех новых разработок.\]</span><span class="sxs-lookup"><span data-stu-id="d9768-105">The [MI APIs](/previous-versions/windows/desktop/wmi_v2/windows-management-infrastructure) should be used for all new development.\]</span></span>

<span data-ttu-id="d9768-106">Библиотеки инфраструктуры поставщика Framedyd.dll (отладочная версия) и Framedyn.dll (версия выпуска) реализуют несколько вспомогательных классов поставщика.</span><span class="sxs-lookup"><span data-stu-id="d9768-106">The provider framework libraries Framedyd.dll (debug version) and Framedyn.dll (release version) implement several provider helper classes.</span></span> <span data-ttu-id="d9768-107">Некоторые функции в Framedyn.dll были удалены из файлов заголовков.</span><span class="sxs-lookup"><span data-stu-id="d9768-107">Some functions in Framedyn.dll have been removed from the header files.</span></span> <span data-ttu-id="d9768-108">Чтобы продолжить использовать эти функции, добавьте `#define FRAMEWORK_ALLOW_DEPRECATED` в код, прежде чем включать фвкоммон. h.</span><span class="sxs-lookup"><span data-stu-id="d9768-108">To continue to use these functions, add `#define FRAMEWORK_ALLOW_DEPRECATED` to your code before including Fwcommon.h.</span></span>

<span data-ttu-id="d9768-109">Вы можете выгрузить отдельных поставщиков, которые больше не требуются.</span><span class="sxs-lookup"><span data-stu-id="d9768-109">You can unload individual providers that are no longer required.</span></span>

<span data-ttu-id="d9768-110">Чтобы использовать эту возможность, необходимо внести три следующих изменения в поставщик в Маиндлл. cpp:</span><span class="sxs-lookup"><span data-stu-id="d9768-110">To use this capability, you must make the three following changes to your provider in MainDll.cpp:</span></span>

-   <span data-ttu-id="d9768-111">В функции **DllMain** , в которой вызывается [**Квбемпровидерглуе:: фрамеворклогиндлл**](/windows/desktop/api/WbemGlue/nf-wbemglue-cwbemproviderglue-frameworklogindll(lpcwstr_plong)), необходимо добавить второй параметр, который является указателем на Long.</span><span class="sxs-lookup"><span data-stu-id="d9768-111">In the function **DllMain** where you call [**CWbemProviderGlue::FrameworkLoginDLL**](/windows/desktop/api/WbemGlue/nf-wbemglue-cwbemproviderglue-frameworklogindll(lpcwstr_plong)), you must add a second parameter which is a pointer to a long.</span></span>
-   <span data-ttu-id="d9768-112">В функции **DllCanUnloadNow** , где вызывается [**Квбемпровидерглуе:: фрамеворклогоффдлл**](/windows/desktop/api/WbemGlue/nf-wbemglue-cwbemproviderglue-frameworklogoffdll(lpcwstr_plong)), необходимо добавить второй параметр, который является указателем на Long.</span><span class="sxs-lookup"><span data-stu-id="d9768-112">In the function **DllCanUnloadNow** where you call [**CWbemProviderGlue::FrameworkLogoffDLL**](/windows/desktop/api/WbemGlue/nf-wbemglue-cwbemproviderglue-frameworklogoffdll(lpcwstr_plong)), you must add a second parameter which is a pointer to a long.</span></span>
-   <span data-ttu-id="d9768-113">В функции **DllGetClassObject** , где создается экземпляр **квбемглуефактори**, необходимо добавить параметр, который является указателем на Long.</span><span class="sxs-lookup"><span data-stu-id="d9768-113">In the function **DllGetClassObject** where you create an instance of **CWbemGlueFactory**, you must add a parameter which is a pointer to a long.</span></span>

<span data-ttu-id="d9768-114">Во всех трех случаях указатель на Long должен быть одним и тем же указателем.</span><span class="sxs-lookup"><span data-stu-id="d9768-114">In all three cases, the pointer to a long must be the same pointer.</span></span>

> [!Note]  
> <span data-ttu-id="d9768-115">В подпрограммых Маиндлл. cpp, **DllGetClassObject**, **DllCanUnloadNow**, **DllRegisterServer**, **DllUnregisterServer** и **DllMain** должны быть заключены в блок try/catch.</span><span class="sxs-lookup"><span data-stu-id="d9768-115">In Maindll.cpp, **DllGetClassObject**, **DllCanUnloadNow**, **DllRegisterServer**, **DllUnregisterServer** and **DllMain** routines must be wrapped in a try/catch block.</span></span>

 

> [!Caution]  
> <span data-ttu-id="d9768-116">Ссылка на сборки отладки поставщика с помощью Фрамедид. lib для Framedyd.dll.</span><span class="sxs-lookup"><span data-stu-id="d9768-116">Provider debug builds link with Framedyd.lib for Framedyd.dll.</span></span> <span data-ttu-id="d9768-117">Framedyd.dll находится в каталоге bin пакета средств разработки программного обеспечения Microsoft Windows (SDK) \\ , который не входит в системный путь.</span><span class="sxs-lookup"><span data-stu-id="d9768-117">Framedyd.dll is in the Microsoft Windows Software Development Kit (SDK) \\bin directory which is not included in the system path.</span></span> <span data-ttu-id="d9768-118">При тестировании отладочной сборки поставщика с помощью службы управления Windows поставщик платформы не сможет загрузиться, так как Framedyd.dll или одна из ее зависимостей не будет найдена.</span><span class="sxs-lookup"><span data-stu-id="d9768-118">When a debug build of a provider is tested with the Windows Management service, the framework provider will fail to load because Framedyd.dll or one of its dependencies will not be located.</span></span> <span data-ttu-id="d9768-119">Поэтому необходимо либо скопировать Framedyd.dll из \\ каталога Windows SDK bin в \\ \\ каталог System32 WBEM, либо добавить Windows SDK \\ каталог bin в путь поиска системы.</span><span class="sxs-lookup"><span data-stu-id="d9768-119">Therefore, you must either copy Framedyd.dll from the Windows SDK \\bin directory to the \\system32\\wbem directory or add the Windows SDK \\bin directory to the system search path.</span></span>

 

<span data-ttu-id="d9768-120">В следующей таблице перечислены классы служебной программы платформы поставщика.</span><span class="sxs-lookup"><span data-stu-id="d9768-120">The following table lists the provider framework utility classes.</span></span>



| <span data-ttu-id="d9768-121">Класс Utility</span><span class="sxs-lookup"><span data-stu-id="d9768-121">Utility class</span></span>                                          | <span data-ttu-id="d9768-122">Описание</span><span class="sxs-lookup"><span data-stu-id="d9768-122">Description</span></span>                                                                                                                     |
|--------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="d9768-123">**чстринг**</span><span class="sxs-lookup"><span data-stu-id="d9768-123">**CHString**</span></span>](chstring.md)                           | <span data-ttu-id="d9768-124">Предоставляет функции сравнения строк и управления для WMI.</span><span class="sxs-lookup"><span data-stu-id="d9768-124">Provides string comparison and manipulation functions for WMI.</span></span>                                                                  |
| [<span data-ttu-id="d9768-125">**чстрингаррай**</span><span class="sxs-lookup"><span data-stu-id="d9768-125">**CHStringArray**</span></span>](/windows/desktop/api/ChStrArr/nl-chstrarr-chstringarray)                 | <span data-ttu-id="d9768-126">Содержит для создания массивов Чстринг и управления ими.</span><span class="sxs-lookup"><span data-stu-id="d9768-126">Contains for creating and manipulating arrays of CHString.</span></span>                                                                      |
| [<span data-ttu-id="d9768-127">**трефпоинтерколлектион**</span><span class="sxs-lookup"><span data-stu-id="d9768-127">**TRefPointerCollection**</span></span>](/windows/desktop/api/RefPtrCo/nl-refptrco-trefpointercollection) | <span data-ttu-id="d9768-128">Предоставляет доступ к классу контейнера для указателей.</span><span class="sxs-lookup"><span data-stu-id="d9768-128">Grants access to a container class for pointers.</span></span>                                                                                |
| [<span data-ttu-id="d9768-129">**вбемтиме**</span><span class="sxs-lookup"><span data-stu-id="d9768-129">**WBEMTime**</span></span>](wbemtime.md)                           | <span data-ttu-id="d9768-130">Упрощает преобразование между различными форматами времени выполнения Windows и ANSI C.</span><span class="sxs-lookup"><span data-stu-id="d9768-130">Facilitates conversions between various Windows and ANSI C run-time time formats.</span></span>                                               |
| [<span data-ttu-id="d9768-131">**вбемтимеспан**</span><span class="sxs-lookup"><span data-stu-id="d9768-131">**WBEMTimeSpan**</span></span>](/windows/desktop/api/WbemTime/nl-wbemtime-wbemtimespan)                   | <span data-ttu-id="d9768-132">Содержит вспомогательные функции, используемые для вычисления и удержания разницы временного интервала между двумя объектами [**вбемтиме**](wbemtime.md) .</span><span class="sxs-lookup"><span data-stu-id="d9768-132">Contains helper functions used to calculate and hold the time span difference between two [**WBEMTime**](wbemtime.md) objects.</span></span> |



 

> [!Note]  
> <span data-ttu-id="d9768-133">Классы [**чстринг**](chstring.md) и [**чстрингаррай**](/windows/desktop/api/ChStrArr/nl-chstrarr-chstringarray) ПОХОЖИ на Microsoft Foundation Classes (MFC) **CString** и **кстрингаррай**.</span><span class="sxs-lookup"><span data-stu-id="d9768-133">The [**CHString**](chstring.md) and [**CHStringArray**](/windows/desktop/api/ChStrArr/nl-chstrarr-chstringarray) classes are similar to the Microsoft Foundation Classes (MFC) **CString** and **CStringArray**.</span></span> <span data-ttu-id="d9768-134">Версии WMI существуют, чтобы разработчики могли обращаться к методам обработки строк и сравнения без доступа к MFC.</span><span class="sxs-lookup"><span data-stu-id="d9768-134">The WMI versions exist so that developers can access to string manipulation and comparison methods without having to access MFC.</span></span> <span data-ttu-id="d9768-135">Классы [**вбемтиме**](wbemtime.md) и [**вбемтимеспан**](/windows/desktop/api/WbemTime/nl-wbemtime-wbemtimespan) также похожи на классы **CTime** и **ктимеспан** MFC.</span><span class="sxs-lookup"><span data-stu-id="d9768-135">The [**WBEMTime**](wbemtime.md) and [**WBEMTimeSpan**](/windows/desktop/api/WbemTime/nl-wbemtime-wbemtimespan) classes are also similar to the MFC **CTime** and **CTimeSpan** classes.</span></span> <span data-ttu-id="d9768-136">Версии инструментария WMI способны хранить время до наносекунд, а также выполнять преобразование в **BSTR** и обратно.</span><span class="sxs-lookup"><span data-stu-id="d9768-136">The WMI versions are capable of storing time to nanosecond accuracy, and can also convert to and from **BSTR**.</span></span> <span data-ttu-id="d9768-137">Дополнительные сведения о классах CString, Кстрингаррай, CTime и Ктимеспан см. [Microsoft Foundation Classes](https://msdn.microsoft.com/library/d06h2x6e(VS.71).aspx) на сайте MSDN.</span><span class="sxs-lookup"><span data-stu-id="d9768-137">For more information about the CString, CStringArray, CTime, and CTimeSpan classes, see the [Microsoft Foundation Classes](https://msdn.microsoft.com/library/d06h2x6e(VS.71).aspx) on MSDN.</span></span>

 

<span data-ttu-id="d9768-138">Значения **BSTR** , возвращаемые методами [**Вбемтиме**](wbemtime.md) , имеют [Формат даты и времени](date-and-time-format.md): "yyyymmddHHMMSS. ммммммсууу"</span><span class="sxs-lookup"><span data-stu-id="d9768-138">**BSTR** values returned by [**WBEMTime**](wbemtime.md) methods are in [Date and Time Format](date-and-time-format.md): "yyyymmddHHMMSS.mmmmmmsUUU"</span></span>

<span data-ttu-id="d9768-139">Значения **BSTR** , возвращаемые методами [**Вбемтимеспан**](/windows/desktop/api/WbemTime/nl-wbemtime-wbemtimespan) , имеют [Формат интервала](interval-format.md): "ддддддддххммсс. мммммм: 000"</span><span class="sxs-lookup"><span data-stu-id="d9768-139">**BSTR** values returned by [**WBEMTimeSpan**](/windows/desktop/api/WbemTime/nl-wbemtime-wbemtimespan) methods are in [Interval Format](interval-format.md): "ddddddddHHMMSS.mmmmmm:000"</span></span>

<span data-ttu-id="d9768-140">Хотя время и диапазоны времени хранятся внутренне как наносекундах, они не обязательно хранятся с точностью до наносекунд.</span><span class="sxs-lookup"><span data-stu-id="d9768-140">Although times and time spans are stored internally as nanoseconds, they are not necessarily stored with nanosecond accuracy.</span></span> <span data-ttu-id="d9768-141">Это обусловлено тем, что объекты [**вбемтиме**](wbemtime.md) могут быть созданы с использованием форматов времени, которые являются точными для секунды (**Структура TM** и **время \_ t**).</span><span class="sxs-lookup"><span data-stu-id="d9768-141">This is because [**WBEMTime**](wbemtime.md) objects can be constructed using time formats that are accurate to a second (**struct tm**, and **time\_t**).</span></span> <span data-ttu-id="d9768-142">Добавление искусственных десятичных разрядов не приводит к повышению точности.</span><span class="sxs-lookup"><span data-stu-id="d9768-142">Adding artificial decimal places does not increase the accuracy.</span></span>

 

 
