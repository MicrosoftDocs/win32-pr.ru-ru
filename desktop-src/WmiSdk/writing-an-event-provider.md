---
description: Поставщик событий — это COM-объект, предоставляющий инструментарий WMI с уведомлениями о внутренних и внешних событиях.
ms.assetid: 075bdc65-4ea3-4f91-9823-1d2d0dc13423
ms.tgt_platform: multiple
title: Создание поставщика событий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bb118d89f214e9fc651c1c9d93abfcfe43f49fc7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105711720"
---
# <a name="writing-an-event-provider"></a><span data-ttu-id="f7f67-103">Создание поставщика событий</span><span class="sxs-lookup"><span data-stu-id="f7f67-103">Writing an Event Provider</span></span>

<span data-ttu-id="f7f67-104">Поставщик событий — это COM-объект, предоставляющий инструментарий WMI с уведомлениями о внутренних и внешних событиях.</span><span class="sxs-lookup"><span data-stu-id="f7f67-104">An event provider is a COM object that supplies WMI with notifications of intrinsic and extrinsic events.</span></span> <span data-ttu-id="f7f67-105">Внутреннее событие сообщает о внутреннем изменении данных в WMI, а внешнее событие сообщает о определяемом пользователем событии, не описанном внутренним событием.</span><span class="sxs-lookup"><span data-stu-id="f7f67-105">An intrinsic event reports an internal data change to WMI, while an extrinsic event reports a user-defined event not described by an intrinsic event.</span></span> <span data-ttu-id="f7f67-106">Например, событие в ответ на изменения, создание или удаление класса [**Win32 \_ LogicalDisk**](/windows/desktop/CIMWin32Prov/win32-logicaldisk) будет классифицироваться как внутреннее событие.</span><span class="sxs-lookup"><span data-stu-id="f7f67-106">For example, an event in response to changes, creation, or deletion of the [**Win32\_LogicalDisk**](/windows/desktop/CIMWin32Prov/win32-logicaldisk) class would classify as an intrinsic event.</span></span> <span data-ttu-id="f7f67-107">Событие, формируемое на основе чего-либо, отличного от изменения, создания или удаления существующего объекта WMI, является событием внешнего вида.</span><span class="sxs-lookup"><span data-stu-id="f7f67-107">An event that is generated on the basis of something other than the modification, creation, or deletion of an existing WMI object is an extrinsic event.</span></span> <span data-ttu-id="f7f67-108">Независимо от поддерживаемого класса, можно реализовать все поставщики событий таким же образом.</span><span class="sxs-lookup"><span data-stu-id="f7f67-108">Regardless of the supported class, you can implement all event providers in the same manner.</span></span>

<span data-ttu-id="f7f67-109">В следующей процедуре описывается реализация поставщика событий.</span><span class="sxs-lookup"><span data-stu-id="f7f67-109">The following procedure describes how to implement an event provider.</span></span>

<span data-ttu-id="f7f67-110">**Реализация поставщика событий**</span><span class="sxs-lookup"><span data-stu-id="f7f67-110">**To implement an event provider**</span></span>

1.  <span data-ttu-id="f7f67-111">Разработка и регистрация поставщика классов с помощью инструментария WMI.</span><span class="sxs-lookup"><span data-stu-id="f7f67-111">Design and register your class provider with WMI.</span></span>

    <span data-ttu-id="f7f67-112">Поставщики классов регистрируются в WMI путем создания экземпляра [**\_ \_ Win32Provider**](--win32provider.md) и класса [**\_ \_ евентпровидеррегистратион**](--eventproviderregistration.md) .</span><span class="sxs-lookup"><span data-stu-id="f7f67-112">Class providers register with WMI by creating a [**\_\_Win32Provider**](--win32provider.md) instance and an [**\_\_EventProviderRegistration**](--eventproviderregistration.md) class.</span></span> <span data-ttu-id="f7f67-113">Дополнительные сведения см. в разделе [Регистрация поставщика событий](registering-an-event-provider.md).</span><span class="sxs-lookup"><span data-stu-id="f7f67-113">For more information, see [Registering an Event Provider](registering-an-event-provider.md).</span></span>

2.  <span data-ttu-id="f7f67-114">Реализуйте интерфейс [**ивбемпровидеринит**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) для поставщика.</span><span class="sxs-lookup"><span data-stu-id="f7f67-114">Implement the [**IWbemProviderInit**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) interface for your provider.</span></span>

    <span data-ttu-id="f7f67-115">Интерфейс [**ивбемпровидеринит**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) — это общий интерфейс WMI, который используется для загрузки и инициализации всех поставщиков.</span><span class="sxs-lookup"><span data-stu-id="f7f67-115">The [**IWbemProviderInit**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) interface is a common interface WMI uses to load and initialize all providers.</span></span> <span data-ttu-id="f7f67-116">Дополнительные сведения см. [в разделе Инициализация поставщика](initializing-a-provider.md).</span><span class="sxs-lookup"><span data-stu-id="f7f67-116">For more information, see [Initializing a Provider](initializing-a-provider.md).</span></span>

3.  <span data-ttu-id="f7f67-117">Реализуйте [**ивбемевентпровидер**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) в качестве основного интерфейса для поставщика.</span><span class="sxs-lookup"><span data-stu-id="f7f67-117">Implement the [**IWbemEventProvider**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) as the primary interface for your provider.</span></span>

    <span data-ttu-id="f7f67-118">Интерфейс [**ивбемевентпровидер**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) использует метод **провидеревентс** для предоставления событий WMI.</span><span class="sxs-lookup"><span data-stu-id="f7f67-118">The [**IWbemEventProvider**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) interface uses the **ProviderEvents** method to supply events to WMI.</span></span> <span data-ttu-id="f7f67-119">Дополнительные сведения см. [в разделе Реализация основного интерфейса для поставщика событий](implementing-the-primary-interface-for-an-event-provider.md).</span><span class="sxs-lookup"><span data-stu-id="f7f67-119">For more information, see [Implementing the Primary Interface for an Event Provider](implementing-the-primary-interface-for-an-event-provider.md).</span></span>

    > [!Note]  
    > <span data-ttu-id="f7f67-120">Поставщики событий должны использовать модель многопоточности "both".</span><span class="sxs-lookup"><span data-stu-id="f7f67-120">Event providers must use the multithreading model "Both".</span></span>

     

4.  <span data-ttu-id="f7f67-121">При необходимости можно также реализовать интерфейс [**ивбемевентпровидеркуерисинк**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink) для повышения производительности поставщика событий.</span><span class="sxs-lookup"><span data-stu-id="f7f67-121">Optionally, you may also implement the [**IWbemEventProviderQuerySink**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink) interface to increase the performance of your event provider.</span></span>

    <span data-ttu-id="f7f67-122">Интерфейс [**ивбемевентпровидеркуерисинк**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink) позволяет поставщику оптимизировать запросы перед отправкой ответа инструментарию WMI и наиболее полезен для поставщика, предоставляющего события нескольких типов и требующих выполнения максимально допустимого количества внутренних оптимизаций.</span><span class="sxs-lookup"><span data-stu-id="f7f67-122">The [**IWbemEventProviderQuerySink**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink) interface allows the provider to optimize queries before sending a response to WMI, and is most useful for a provider that supplies events of multiple types and that needs to perform as many internal optimizations as possible.</span></span> <span data-ttu-id="f7f67-123">Дополнительные сведения см. в разделе [Оптимизация поставщика событий](optimizing-an-event-provider.md).</span><span class="sxs-lookup"><span data-stu-id="f7f67-123">For more information, see [Optimizing an Event Provider](optimizing-an-event-provider.md).</span></span>

5.  <span data-ttu-id="f7f67-124">Реализуйте интерфейс [**ивбемевентпровидерсекурити**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovidersecurity) , чтобы ограничить потребителей определенными идентификаторами безопасности (SID) или реализуйте [**Ивбемевентсинк:: сетсинксекурити**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-setsinksecurity) для защиты самого приемника.</span><span class="sxs-lookup"><span data-stu-id="f7f67-124">Implement the [**IWbemEventProviderSecurity**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovidersecurity) interface to limit consumers to certain security identifiers (SIDs) or implement [**IWbemEventSink::SetSinkSecurity**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-setsinksecurity) to secure the sink itself.</span></span> <span data-ttu-id="f7f67-125">Поставщик также может установить свойство **\_ дескриптора безопасности** в классе событий для защиты отдельных событий в MOF-коде.</span><span class="sxs-lookup"><span data-stu-id="f7f67-125">The provider can also set the **SECURITY\_DESCRIPTOR** property in the event class to secure individual events in the MOF code.</span></span> <span data-ttu-id="f7f67-126">Дополнительные сведения см. в разделе [Защита событий WMI](securing-wmi-events.md).</span><span class="sxs-lookup"><span data-stu-id="f7f67-126">For more information, see [Securing WMI Events](securing-wmi-events.md).</span></span>
6.  <span data-ttu-id="f7f67-127">Добавьте дополнительный код, необходимый для поставщика.</span><span class="sxs-lookup"><span data-stu-id="f7f67-127">Add any additional code necessary for your provider.</span></span>

    <span data-ttu-id="f7f67-128">При проектировании поставщика вам, скорее всего, придется вызывать интерфейсы WMI.</span><span class="sxs-lookup"><span data-stu-id="f7f67-128">When designing your provider, you most likely need to call WMI interfaces.</span></span> <span data-ttu-id="f7f67-129">Дополнительные сведения см. [в разделе вызов метода](calling-a-method.md).</span><span class="sxs-lookup"><span data-stu-id="f7f67-129">For more information, see [Calling a Method](calling-a-method.md).</span></span>

    <span data-ttu-id="f7f67-130">При получении сведений для клиента может потребоваться доступ к уровням безопасности для этого клиента.</span><span class="sxs-lookup"><span data-stu-id="f7f67-130">When retrieving information for a client, you may need to access the security levels for that client.</span></span> <span data-ttu-id="f7f67-131">Дополнительные сведения см. в разделе [олицетворение клиента](impersonating-a-client.md).</span><span class="sxs-lookup"><span data-stu-id="f7f67-131">For more information, see [Impersonating a Client](impersonating-a-client.md).</span></span>

7.  <span data-ttu-id="f7f67-132">Замените имеющийся поставщик новым кодом.</span><span class="sxs-lookup"><span data-stu-id="f7f67-132">Replace the preexisting provider with your new code.</span></span>

    <span data-ttu-id="f7f67-133">Вам не нужно выполнять этот шаг, если у вас нет уже существующего поставщика для копирования.</span><span class="sxs-lookup"><span data-stu-id="f7f67-133">You do not need to perform this step if you do not have a preexisting provider to copy over.</span></span> <span data-ttu-id="f7f67-134">Дополнительные сведения см. [в разделе Обновление поставщика](updating-a-provider.md).</span><span class="sxs-lookup"><span data-stu-id="f7f67-134">For more information, see [Updating a Provider](updating-a-provider.md).</span></span>

<span data-ttu-id="f7f67-135">Клиентское приложение может запросить событие, зарегистрировав его в WMI как потребитель события.</span><span class="sxs-lookup"><span data-stu-id="f7f67-135">A client application can request an event by registering itself with WMI as an event consumer.</span></span> <span data-ttu-id="f7f67-136">Дополнительные сведения см. [в разделе Получение WMI-события](receiving-a-wmi-event.md).</span><span class="sxs-lookup"><span data-stu-id="f7f67-136">For more information, see [Receiving a WMI Event](receiving-a-wmi-event.md).</span></span>

 

 
