---
description: Поставщик событий может посвятить много времени созданию событий.
ms.assetid: 5cf414f0-b3a8-4623-9aaa-08e2a28b40c0
ms.tgt_platform: multiple
title: Оптимизация поставщика событий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 70eaabfbbd462b831059b10590d7959bdef05cbc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105703116"
---
# <a name="optimizing-an-event-provider"></a><span data-ttu-id="e9215-103">Оптимизация поставщика событий</span><span class="sxs-lookup"><span data-stu-id="e9215-103">Optimizing an Event Provider</span></span>

<span data-ttu-id="e9215-104">Поставщик событий может посвятить много времени созданию событий.</span><span class="sxs-lookup"><span data-stu-id="e9215-104">An event provider may devote a great deal of time to creating events.</span></span> <span data-ttu-id="e9215-105">Если ни одно из клиентских приложений не использует созданные события, поставщик затратит системные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="e9215-105">If no client applications use the created events, then the provider is wasting system resources.</span></span> <span data-ttu-id="e9215-106">Кроме того, Инструментарий WMI тратит значительный объем ресурсов на синтаксический анализ и отправку сложных запросов соответствующему поставщику.</span><span class="sxs-lookup"><span data-stu-id="e9215-106">Further, WMI spends a considerable amount of resources parsing and sending complex queries to the appropriate provider.</span></span> <span data-ttu-id="e9215-107">Чтобы избежать траты системных ресурсов и повышения производительности поставщика событий, можно реализовать интерфейс [**ивбемевентпровидеркуерисинк**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink) .</span><span class="sxs-lookup"><span data-stu-id="e9215-107">To avoid the waste of system resources and to improve the performance of your event provider, you can implement the [**IWbemEventProviderQuerySink**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink) interface.</span></span> <span data-ttu-id="e9215-108">**Ивбемевентпровидеркуерисинк** отслеживает запросы, регистрируемые клиентскими приложениями в WMI с помощью методов [**невкуери**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventproviderquerysink-newquery) и [**канцелкуери**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventproviderquerysink-cancelquery) .</span><span class="sxs-lookup"><span data-stu-id="e9215-108">**IWbemEventProviderQuerySink** monitors the queries that client applications register with WMI by using the [**NewQuery**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventproviderquerysink-newquery) and [**CancelQuery**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventproviderquerysink-cancelquery) methods.</span></span> <span data-ttu-id="e9215-109">Отслеживая зарегистрированные запросы клиентов, поставщик может определить, какие сообщения должны отправляться в WMI.</span><span class="sxs-lookup"><span data-stu-id="e9215-109">By monitoring the registered client queries, your provider can determine what if any messages must be sent to WMI.</span></span>

<span data-ttu-id="e9215-110">Инструментарий WMI вызывает [**невкуери**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventproviderquerysink-newquery) в поставщике событий, когда потребитель клиента регистрирует запрос фильтра событий, содержащий ссылки на события, поддерживаемые этим поставщиком событий.</span><span class="sxs-lookup"><span data-stu-id="e9215-110">WMI calls [**NewQuery**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventproviderquerysink-newquery) on an event provider when a client consumer registers an event filter query that contains references to events supported by that event provider.</span></span> <span data-ttu-id="e9215-111">Поэтому поставщик событий, ответственный за события изменения экземпляра для класса **емаилкласс** , можно настроить для создания уведомлений только для **отправителя**.</span><span class="sxs-lookup"><span data-stu-id="e9215-111">So the event provider responsible for instance modification events for the **EmailClass** class can be set up to generate notifications only for **sender**.</span></span> <span data-ttu-id="e9215-112">Когда поставщик получает запрос, запрашивающий уведомления об изменениях свойства **subject** , поставщик может приступить к формированию этих уведомлений.</span><span class="sxs-lookup"><span data-stu-id="e9215-112">When the provider receives a query requesting notification of changes to the **subject** property, the provider can start generating those notifications.</span></span> <span data-ttu-id="e9215-113">В этом сценарии Инструментарий WMI не требуется для отмены уведомлений, которые только изменяют **получатель** отчета.</span><span class="sxs-lookup"><span data-stu-id="e9215-113">In this scenario, WMI is not required to discard the notifications that report **recipient** changes only.</span></span>

<span data-ttu-id="e9215-114">Аналогичным образом, Инструментарий WMI вызывает [**канцелкуери**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventproviderquerysink-cancelquery) в поставщике событий, когда потребитель клиента отменяет регистрацию запроса фильтра событий, содержащего ссылки на события, поддерживаемые поставщиком событий.</span><span class="sxs-lookup"><span data-stu-id="e9215-114">Similarly, WMI calls [**CancelQuery**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventproviderquerysink-cancelquery) on an event provider when a client consumer deregisters an event filter query that contains references to events supported by the event provider.</span></span> <span data-ttu-id="e9215-115">Целью **канцелкуери** является то, что поставщик событий обновляет список событий, которые должны быть отправлены.</span><span class="sxs-lookup"><span data-stu-id="e9215-115">The purpose of **CancelQuery** is for the event provider to update the list of what events should be sent out.</span></span>

> [!Note]  
> <span data-ttu-id="e9215-116">Если поставщик поддерживает как [**ивбемевентпровидер**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) , так и [**ивбемевентпровидеркуерисинк**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink), убедитесь, что реализация метода **IUnknown:: QueryInterface** Возвращает указатели на оба интерфейса.</span><span class="sxs-lookup"><span data-stu-id="e9215-116">If your provider supports both [**IWbemEventProvider**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) and [**IWbemEventProviderQuerySink**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink), ensure that your implementation of the **IUnknown::QueryInterface** method returns pointers to both interfaces.</span></span>

 

 

 



