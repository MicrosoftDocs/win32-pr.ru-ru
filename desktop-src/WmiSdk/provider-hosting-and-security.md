---
description: Указывает модель размещения поставщика. Установка этого свойства приводит к тому, что поставщик загружается в общий хост-процесс с указанным уровнем привилегий.
ms.assetid: 1e5c778d-cd29-449b-88e2-fe0c90d0edcd
ms.tgt_platform: multiple
title: Размещение и безопасность поставщика
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: db6b88a5727f34fbb76baf62dcdf0488e5eb9eb7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105702834"
---
# <a name="provider-hosting-and-security"></a><span data-ttu-id="c9a8d-104">Размещение и безопасность поставщика</span><span class="sxs-lookup"><span data-stu-id="c9a8d-104">Provider Hosting and Security</span></span>

<span data-ttu-id="c9a8d-105">Свойство [**хостингмодел**](--win32provider.md) в экземпляре **\_ \_ Win32Provider** , представляющем поставщик, указывает модель размещения поставщика.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-105">The [**HostingModel**](--win32provider.md) property in the **\_\_Win32Provider** instance that represents your provider specifies the provider hosting model.</span></span> <span data-ttu-id="c9a8d-106">Установка этого свойства приводит к тому, что поставщик загружается в общий хост-процесс с указанным уровнем привилегий.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-106">Setting this property causes the provider to be loaded into a shared host process that has a specified level of privilege.</span></span>

## <a name="shared-provider-host-process"></a><span data-ttu-id="c9a8d-107">Процесс узла общего поставщика</span><span class="sxs-lookup"><span data-stu-id="c9a8d-107">Shared Provider Host Process</span></span>

<span data-ttu-id="c9a8d-108">Инструментарий WMI находится в узле общей службы с несколькими другими службами.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-108">WMI resides in a shared service host with several other services.</span></span> <span data-ttu-id="c9a8d-109">Чтобы избежать остановки всех служб при сбое поставщика, поставщики загружаются в отдельный ведущий процесс с именем "Wmiprvse.exe".</span><span class="sxs-lookup"><span data-stu-id="c9a8d-109">To avoid stopping all the services when a provider fails, providers are loaded into a separate host process named "Wmiprvse.exe".</span></span> <span data-ttu-id="c9a8d-110">Может выполняться более одного процесса с таким именем.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-110">More than one process with this name can be running.</span></span> <span data-ttu-id="c9a8d-111">Каждый из них может выполняться под другой учетной записью с различными уровнями безопасности.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-111">Each can run under a different account with varying security.</span></span> <span data-ttu-id="c9a8d-112">Помните, что, начиная с Windows Vista, используйте команду [**Winmgmt**](winmgmt.md) для запуска инструментария WMI в отдельном процессе, используя фиксированный порт.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-112">Be aware that, starting with Windows Vista, use the [**winmgmt**](winmgmt.md) command to run WMI in a separate process by itself using a fixed port.</span></span> <span data-ttu-id="c9a8d-113">Дополнительные сведения см. [в статье удаленное подключение к WMI, начиная с ОС Vista](connecting-to-wmi-remotely-starting-with-vista.md).</span><span class="sxs-lookup"><span data-stu-id="c9a8d-113">For more information, see [Connecting to WMI Remotely Starting with Vista](connecting-to-wmi-remotely-starting-with-vista.md).</span></span>

<span data-ttu-id="c9a8d-114">Общий узел может быть запущен с одной из следующих системных учетных записей в процессе Wmiprvse.exe узла:</span><span class="sxs-lookup"><span data-stu-id="c9a8d-114">The shared host can run under one of the following system accounts in a Wmiprvse.exe host process:</span></span>

-   [<span data-ttu-id="c9a8d-115">локальная система;</span><span class="sxs-lookup"><span data-stu-id="c9a8d-115">LocalSystem</span></span>](/windows/desktop/Services/localsystem-account)
-   [<span data-ttu-id="c9a8d-116">сетевая служба;</span><span class="sxs-lookup"><span data-stu-id="c9a8d-116">NetworkService</span></span>](/windows/desktop/Services/networkservice-account)
-   [<span data-ttu-id="c9a8d-117">локальная служба.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-117">LocalService</span></span>](/windows/desktop/Services/localservice-account)

<span data-ttu-id="c9a8d-118">Поставщик может также быть локальным сервером COM (. exe) или самостоятельным размещением, для которого не требуется узел поставщика WMI.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-118">A provider can also be a local COM server (.exe), or self-hosted, which does not require a WMI provider host.</span></span>

## <a name="setting-the-hosting-model"></a><span data-ttu-id="c9a8d-119">Настройка модели размещения</span><span class="sxs-lookup"><span data-stu-id="c9a8d-119">Setting the Hosting Model</span></span>

<span data-ttu-id="c9a8d-120">Так как LocalSystem является привилегированной учетной записью, рекомендуется установить [**хостингмодел**](--win32provider.md) в значение **нетворксервицехост** , когда поставщик выполняется в процессе Wmiprvse.exe.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-120">Because LocalSystem is a privileged account, it is recommended that you set [**HostingModel**](--win32provider.md) to **NetworkServiceHost** when a provider is running in a Wmiprvse.exe process.</span></span> <span data-ttu-id="c9a8d-121">Учетная запись Нетворксервицехост предназначена для служб, которым не требуются широкие привилегии, но требуется удаленно взаимодействовать с другими системами.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-121">NetworkServiceHost account is for services that do not require extensive privileges, but do need to communicate remotely with other systems.</span></span>

<span data-ttu-id="c9a8d-122">Если не задать значение для свойства [**хостингмодел**](--win32provider.md) , Инструментарий WMI установит значение по умолчанию **нетворксервицехосторселфхост**.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-122">If you do not set a value for the [**HostingModel**](--win32provider.md) property, WMI will set a default value of **NetworkServiceHostOrSelfHost**.</span></span> <span data-ttu-id="c9a8d-123">Если для параметра **хостингмодел** задано значение **локалсистемхост**, WMI использует трассировку для создания событий 5603 и 5604 в журнале событий Windows.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-123">If the **HostingModel** value is set to **LocalSystemHost**, WMI uses tracing to generate events 5603 and 5604 in the Windows Event Log.</span></span> <span data-ttu-id="c9a8d-124">Так как локальная учетная запись [LocalSystem](/windows/desktop/Services/localsystem-account) имеет высокий уровень привилегий, этот параметр не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-124">Because the local [LocalSystem](/windows/desktop/Services/localsystem-account) account is highly privileged, this setting is not recommended.</span></span> <span data-ttu-id="c9a8d-125">Эти события можно просмотреть в **Просмотр событий**.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-125">You can view these events in the **Event Viewer**.</span></span> <span data-ttu-id="c9a8d-126">Дополнительные сведения см. в разделе [Трассировка действия WMI](tracing-wmi-activity.md).</span><span class="sxs-lookup"><span data-stu-id="c9a8d-126">For more information, see [Tracing WMI Activity](tracing-wmi-activity.md).</span></span>

<span data-ttu-id="c9a8d-127">Установите свойство [**хостингмодел**](--win32provider.md) для несвязанных поставщиков как "несвязанный: com".</span><span class="sxs-lookup"><span data-stu-id="c9a8d-127">Set the [**HostingModel**](--win32provider.md) property for decoupled providers as "Decoupled:Com".</span></span> <span data-ttu-id="c9a8d-128">Поставщики, созданные путем добавления классов инструментирования из [**Microsoft. Management. Infrastructure**](/previous-versions//hh872326(v=vs.85)) в платформа .NET Framework, являются несвязанными поставщиками.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-128">Providers created by adding instrumentation classes from [**Microsoft.Management.Infrastructure**](/previous-versions//hh872326(v=vs.85)) in the .NET Framework are decoupled providers.</span></span> <span data-ttu-id="c9a8d-129">(**System. Management. Instrumentation** больше не поддерживается.) Дополнительные сведения о создании несвязанного поставщика см. в разделе [Включение поставщика в приложение](incorporating-a-provider-in-an-application.md).</span><span class="sxs-lookup"><span data-stu-id="c9a8d-129">(**System.Management.Instrumentation** is no longer supported.) For more information about creating a decoupled provider, see [Incorporating a Provider in an Application](incorporating-a-provider-in-an-application.md).</span></span>

<span data-ttu-id="c9a8d-130">Модель размещения указывается в свойстве [**хостингмодел**](--win32provider.md) в экземпляре **\_ \_ Win32Provider** , представляющем поставщик.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-130">The hosting model is specified in the [**HostingModel**](--win32provider.md) property in the **\_\_Win32Provider** instance that represents your provider.</span></span>

<span data-ttu-id="c9a8d-131">**Задание модели размещения для поставщика**</span><span class="sxs-lookup"><span data-stu-id="c9a8d-131">**To set the hosting model for a provider**</span></span>

1.  <span data-ttu-id="c9a8d-132">В MOF-файле, определяющем поставщик, создайте экземпляр [**\_ \_ Win32Provider**](--win32provider.md).</span><span class="sxs-lookup"><span data-stu-id="c9a8d-132">In the MOF file that defines your provider, create an instance of [**\_\_Win32Provider**](--win32provider.md).</span></span>
2.  <span data-ttu-id="c9a8d-133">Назначьте поставщику имя в свойстве **Name** и назначьте идентификатор класса (CLSID) COM-объекта поставщика свойству **CLSID** .</span><span class="sxs-lookup"><span data-stu-id="c9a8d-133">Assign a name to the provider in the **Name** property and assign the class identifier (CLSID) of the provider COM object to the **Clsid** property.</span></span>

    <span data-ttu-id="c9a8d-134">Следующий пример кода присваивает свойству **Name** имя и КСЛИД COM-объекта поставщика свойству **CLSID** .</span><span class="sxs-lookup"><span data-stu-id="c9a8d-134">The following code example assigns a name to the **Name** property and the CSLID of the provider COM object to the **Clsid** property.</span></span>

    ``` syntax
    Instance of __Win32Provider as $NewProvider
    {
        Name = "MyProvider";
        Clsid = "{.......}";
    }
    ```

3.  <span data-ttu-id="c9a8d-135">Назначьте соответствующее значение общего узла свойству [**хостингмодел**](--win32provider.md) .</span><span class="sxs-lookup"><span data-stu-id="c9a8d-135">Assign the appropriate shared host value to the [**HostingModel**](--win32provider.md) property.</span></span> <span data-ttu-id="c9a8d-136">Значения общего узла, такие как "Нетворксервицехост", определяются в свойстве **хостингспеЦификатион** класса [**\_ поставщиков MSFT**](/previous-versions/windows/desktop/wmisystemprov/msft-providers) .</span><span class="sxs-lookup"><span data-stu-id="c9a8d-136">Shared host values such as "NetworkServiceHost" are defined in the **HostingSpecification** property of [**MSFT\_Providers**](/previous-versions/windows/desktop/wmisystemprov/msft-providers) class.</span></span>

    <span data-ttu-id="c9a8d-137">В следующем примере кода значение общего узла присваивается свойству [**хостингмодел**](--win32provider.md) .</span><span class="sxs-lookup"><span data-stu-id="c9a8d-137">The following code example assigns a shared host value to the [**HostingModel**](--win32provider.md) property.</span></span>

    ``` syntax
    HostingModel = "NetworkServiceHost";
    ```

<span data-ttu-id="c9a8d-138">В следующем примере кода показано, как зарегистрировать поставщик в Нетворксервицехост.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-138">The following code example shows how to register a provider in NetworkServiceHost.</span></span>

``` syntax
Instance of __Win32Provider as $NewProvider
{
    Name = "MyProvider";
    Clsid = "{.......}";
    HostingModel = "NetworkServiceHost";
}
```

<span data-ttu-id="c9a8d-139">Если у вас есть несколько поставщиков, их можно сгруппировать в конкретный узел службы, зарегистрировав поставщик, чтобы он настроился в определенном экземпляре.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-139">If you have multiple providers, you can group them into a specific service host by registering your provider so that it resides in the specific instance.</span></span>

<span data-ttu-id="c9a8d-140">В следующем примере кода также регистрируется поставщик в Нетворксервицехост.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-140">The following code example also registers a provider in NetworkServiceHost.</span></span> <span data-ttu-id="c9a8d-141">Класс [**\_ поставщиков MSFT**](/previous-versions/windows/desktop/wmisystemprov/msft-providers) определяет значения для двух значений, которые комбинируются для создания свойства **хостингмодел** [**\_ \_ Win32Provider**](--win32provider.md) .</span><span class="sxs-lookup"><span data-stu-id="c9a8d-141">The [**MSFT\_Providers**](/previous-versions/windows/desktop/wmisystemprov/msft-providers) class defines values for the two values that combine to create the [**\_\_Win32Provider**](--win32provider.md) **HostingModel** property.</span></span> <span data-ttu-id="c9a8d-142">В этом примере значение "Нетворксервицехост" берется из свойства **хостингспеЦификатион** **\_ поставщиков MSFT** , а "Локалсервицехост" — из свойства **хостингграуп** .</span><span class="sxs-lookup"><span data-stu-id="c9a8d-142">In the example, "NetworkServiceHost" value comes from the **HostingSpecification** property of **MSFT\_Providers** and "LocalServiceHost" comes from the **HostingGroup** property.</span></span>

``` syntax
Instance of __Win32Provider as $NewProvider
{
    Name = "MyProvider";
    Clsid = "{.......}";
    HostingModel = "NetworkServiceHost:MySharedHost";
}
```

<span data-ttu-id="c9a8d-143">Существуют специальные проблемы разработки для поставщиков, которые не связаны и размещаются в процессе Wmiprvse.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-143">Special development issues exist for providers that are not decoupled and are hosted in the Wmiprvse process.</span></span> <span data-ttu-id="c9a8d-144">Дополнительные сведения см. в разделе [службы отладки](debugging-providers.md).</span><span class="sxs-lookup"><span data-stu-id="c9a8d-144">For more information, see [Debugging Providers](debugging-providers.md).</span></span>

<span data-ttu-id="c9a8d-145">При создании поставщика, который содержит регистрацию свойств или поставщиков классов, не все модели потоков работают.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-145">If you are writing a provider that contains property or class provider registration, not all threading models work.</span></span> <span data-ttu-id="c9a8d-146">Дополнительные сведения см. в разделе [Выбор правильной регистрации](choosing-correct-registration.md).</span><span class="sxs-lookup"><span data-stu-id="c9a8d-146">For more information, see [Choosing Correct Registration](choosing-correct-registration.md).</span></span>

## <a name="hostingmodel-values-for-in-process-providers"></a><span data-ttu-id="c9a8d-147">Значения Хостингмодел для поставщиков In-Process</span><span class="sxs-lookup"><span data-stu-id="c9a8d-147">HostingModel Values for In-Process Providers</span></span>

<span data-ttu-id="c9a8d-148">В следующем списке перечислены значения модели размещения поставщика, используемые в экземпляре [**\_ \_ Win32Provider**](--win32provider.md) для поставщиков, которые выполняются в процессе Wmiprvse.exe.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-148">The following list lists the provider hosting model values to use in the [**\_\_Win32Provider**](--win32provider.md) instance for providers that run in a Wmiprvse.exe process.</span></span>



| <span data-ttu-id="c9a8d-149">Значение в [ **\_ \_ Win32Provider. хостингмодел**](--win32provider.md)</span><span class="sxs-lookup"><span data-stu-id="c9a8d-149">Value in [**\_\_Win32Provider.HostingModel**](--win32provider.md)</span></span> | <span data-ttu-id="c9a8d-150">Описание</span><span class="sxs-lookup"><span data-stu-id="c9a8d-150">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|--------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="c9a8d-151">**Резидент**</span><span class="sxs-lookup"><span data-stu-id="c9a8d-151">**SelfHost**</span></span>                                                       | <span data-ttu-id="c9a8d-152">Поставщик начинает использовать реализацию локального сервера вместо внутрипроцессного.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-152">The provider starts using the local server implementation instead of in-process.</span></span> <span data-ttu-id="c9a8d-153">Контекст безопасности процесса, в котором запускается поставщик, определяет контекст безопасности поставщика.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-153">The security context of the process in which the provider runs determines the provider security context.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <span data-ttu-id="c9a8d-154">**локалсистемхост**</span><span class="sxs-lookup"><span data-stu-id="c9a8d-154">**LocalSystemHost**</span></span>                                                | <span data-ttu-id="c9a8d-155">Поставщик, если он реализован как внутрипроцессный, загружается в узел общего поставщика, работающий в контексте [LocalSystem](/windows/desktop/Services/localsystem-account) .</span><span class="sxs-lookup"><span data-stu-id="c9a8d-155">The provider, if implemented as in-process, is loaded into a shared provider host running under [LocalSystem](/windows/desktop/Services/localsystem-account) context.</span></span> <span data-ttu-id="c9a8d-156">Начиная с Windows Vista, **локалсистемхост** больше не является моделью размещения по умолчанию, если [**хостингмодел**](--win32provider.md) поставщика WMI (**\_ \_ Win32Provider**.**Свойство Хостингмодел** ) не задано.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-156">Starting with Windows Vista, **LocalSystemHost** is no longer the default hosting model if the [**HostingModel**](--win32provider.md) of a WMI provider (**\_\_Win32Provider**.**HostingModel** property) is unspecified.</span></span> <span data-ttu-id="c9a8d-157">Дополнительные сведения см. в разделе [безопасность моделей размещения](#provider-hosting-and-security).</span><span class="sxs-lookup"><span data-stu-id="c9a8d-157">For more information, see [Security of Hosting Models](#provider-hosting-and-security).</span></span>                                                                                                                                                                                                                                                                               |
| <span data-ttu-id="c9a8d-158">**локалсистемхосторселфхост**</span><span class="sxs-lookup"><span data-stu-id="c9a8d-158">**LocalSystemHostOrSelfHost**</span></span>                                      | <span data-ttu-id="c9a8d-159">Поставщик самомещается или загружается в Wmiprvse.exe процесс, работающий под учетной записью [LocalSystem](/windows/desktop/Services/localsystem-account) .</span><span class="sxs-lookup"><span data-stu-id="c9a8d-159">The provider is self-hosted or loaded into the Wmiprvse.exe process running under the [LocalSystem](/windows/desktop/Services/localsystem-account) account.</span></span> <span data-ttu-id="c9a8d-160">Так как LocalSystem является учетной записью с высоким уровнем привилегий, в журнале событий NT безопасности создается запись для уведомления администраторов поставщика, работающего в состоянии доверия.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-160">Because LocalSystem is a highly privileged account, an entry is generated in the Security NT Event Log to notify administrators of a provider running in this trusted status.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                              |
| <span data-ttu-id="c9a8d-161">**нетворксервицехост**</span><span class="sxs-lookup"><span data-stu-id="c9a8d-161">**NetworkServiceHost**</span></span>                                             | <span data-ttu-id="c9a8d-162">Поставщик, если он реализован как внутрипроцессный, загружается в Wmiprvse.exe процесс, работающий под учетной записью [NetworkService](/windows/desktop/Services/networkservice-account) .</span><span class="sxs-lookup"><span data-stu-id="c9a8d-162">The provider, if implemented as in-process, is loaded into the Wmiprvse.exe process running under [NetworkService](/windows/desktop/Services/networkservice-account) account.</span></span> <span data-ttu-id="c9a8d-163">Начиная с Windows Vista, это модель размещения по умолчанию, если [**хостингмодел**](--win32provider.md) поставщика WMI (**\_ \_ Win32Provider**.**Свойство Хостингмодел** ) не задано.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-163">Starting with Windows Vista, this is the default hosting model if the [**HostingModel**](--win32provider.md) of a WMI provider (**\_\_Win32Provider**.**HostingModel** property) is unspecified.</span></span> <span data-ttu-id="c9a8d-164">Дополнительные сведения см. в разделе [безопасность моделей размещения](#provider-hosting-and-security).</span><span class="sxs-lookup"><span data-stu-id="c9a8d-164">For more information, see [Security of Hosting Models](#provider-hosting-and-security).</span></span><br/> <span data-ttu-id="c9a8d-165">**Нетворксервицехост** имеет ограниченные привилегии и, таким образом, снижает вероятность атаки с повышенными правами доступа.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-165">**NetworkServiceHost** has limited privileges and therefore reduces the possibility of an elevation of privilege attack.</span></span> <span data-ttu-id="c9a8d-166">Если поставщик работает только на локальном компьютере, установите для свойства [**хостингмодел**](--win32provider.md) значение **локалсервицехост**.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-166">If the provider only operates within the local computer, then set the [**HostingModel**](--win32provider.md) property to **LocalServiceHost**.</span></span><br/> |
| <span data-ttu-id="c9a8d-167">**нетворксервицехосторселфхост**</span><span class="sxs-lookup"><span data-stu-id="c9a8d-167">**NetworkServiceHostOrSelfHost**</span></span>                                   | <span data-ttu-id="c9a8d-168">Поставщик самомещается или загружается в WmiPrvse.exe процесс, работающий под учетной записью [NetworkService](/windows/desktop/Services/networkservice-account) .</span><span class="sxs-lookup"><span data-stu-id="c9a8d-168">The provider is self-hosted or loaded into the WmiPrvse.exe process running under the [NetworkService](/windows/desktop/Services/networkservice-account) account.</span></span> <span data-ttu-id="c9a8d-169">**Нетворксервицехосторселфхост** является конфигурацией по умолчанию, если свойство [**хостингмодел**](--win32provider.md) в **\_ \_ Win32Provider** имеет **значение NULL**.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-169">**NetworkServiceHostOrSelfHost** is the default configuration when the [**HostingModel**](--win32provider.md) property in **\_\_Win32Provider** is **NULL**.</span></span> <span data-ttu-id="c9a8d-170">Поскольку **нетворксервицехосторселфхост** является значением по умолчанию, поставщики из предыдущих операционных систем могут продолжать работать в Windows Vista, windows Server 2008 и более поздних операционных системах.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-170">Because **NetworkServiceHostOrSelfHost** is the default, providers from earlier operating systems can continue to work in Windows Vista, Windows Server 2008, and later operating systems.</span></span>                                                                                                                                                                                                                                             |
| <span data-ttu-id="c9a8d-171">**локалсервицехост**</span><span class="sxs-lookup"><span data-stu-id="c9a8d-171">**LocalServiceHost**</span></span>                                               | <span data-ttu-id="c9a8d-172">Поставщик, если он реализован как внутрипроцессный, загружается в Wmiprvse.exe процесс, работающий под учетной записью [LocalService](/windows/desktop/Services/localservice-account) .</span><span class="sxs-lookup"><span data-stu-id="c9a8d-172">The provider, if implemented as in-process, is loaded into the Wmiprvse.exe process running under the [LocalService](/windows/desktop/Services/localservice-account) account.</span></span> <span data-ttu-id="c9a8d-173">Это рекомендуемая модель размещения для служб, так как LocalService имеет ограниченные привилегии.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-173">This is the recommended hosting model for services because LocalService has limited privileges.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |



 

## <a name="hostingmodel-values-for-decoupled-providers"></a><span data-ttu-id="c9a8d-174">Значения Хостингмодел для несвязанных поставщиков</span><span class="sxs-lookup"><span data-stu-id="c9a8d-174">HostingModel Values for Decoupled Providers</span></span>

<span data-ttu-id="c9a8d-175">В следующем списке перечислены значения модели размещения поставщика для несвязанных поставщиков.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-175">The following list lists the provider hosting model values for decoupled providers.</span></span>

<dl> <dt>

<span data-ttu-id="c9a8d-176"><span id="Decoupled_Com"></span><span id="decoupled_com"></span><span id="DECOUPLED_COM"></span>**Отделено: com**</span><span class="sxs-lookup"><span data-stu-id="c9a8d-176"><span id="Decoupled_Com"></span><span id="decoupled_com"></span><span id="DECOUPLED_COM"></span>**Decoupled:Com**</span></span>
</dt> <dd>

<span data-ttu-id="c9a8d-177">Поставщик — это отделенный поставщик, размещенный в отдельном процессе, который является клиентом для WMI.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-177">The provider is a decoupled provider hosted in a separate process that is a client to WMI.</span></span>

<span data-ttu-id="c9a8d-178">В следующем примере показан спецификатор Фолдидентити для свойства [**хостингмодел**](--win32provider.md) , установленного в **значение false**, которое позволяет поставщику олицетворять клиента.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-178">The following example shows the FoldIdentity specifier for the [**HostingModel**](--win32provider.md) property set to **FALSE**, which allows the provider to impersonate the client.</span></span>

``` syntax
Decoupled:Com:FoldIdentity(FALSE)
```

<span data-ttu-id="c9a8d-179">Если Фолдидентити не указан, значение Фолдидентити по умолчанию равно **true** .</span><span class="sxs-lookup"><span data-stu-id="c9a8d-179">If FoldIdentity is not specified, the FoldIdentity value is set to **TRUE** by default.</span></span> <span data-ttu-id="c9a8d-180">По соображениям безопасности не рекомендуется указывать Фолдидентити (FALSE), так как фальшивое приложение с олицетворением делегата может повлиять на весь домен.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-180">For security reasons, it is recommended that you not specify FoldIdentity(FALSE) since a rogue application with impersonation of Delegate can affect an entire domain.</span></span>

<span data-ttu-id="c9a8d-181">В следующем примере показано свойство [**хостингмодел**](--win32provider.md) , заданное в рекомендуемом способе, эквивалентном заданию ФОЛДИДЕНТИТИ (true).</span><span class="sxs-lookup"><span data-stu-id="c9a8d-181">The following example shows the [**HostingModel**](--win32provider.md) property set in the recommended manner that is equivalent to setting FoldIdentity(TRUE).</span></span>

``` syntax
Decoupled:Com
```

</dd> <dt>

<span data-ttu-id="c9a8d-182"><span id="Decoupled_Noncom"></span><span id="decoupled_noncom"></span><span id="DECOUPLED_NONCOM"></span>**С несвязанным: Нонком**</span><span class="sxs-lookup"><span data-stu-id="c9a8d-182"><span id="Decoupled_Noncom"></span><span id="decoupled_noncom"></span><span id="DECOUPLED_NONCOM"></span>**Decoupled:Noncom**</span></span>
</dt> <dd>

<span data-ttu-id="c9a8d-183">Только для внутреннего использования.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-183">For internal use only.</span></span> <span data-ttu-id="c9a8d-184">Не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-184">Not supported.</span></span>

</dd> </dl>

## <a name="security-of-hosting-models"></a><span data-ttu-id="c9a8d-185">Безопасность моделей размещения</span><span class="sxs-lookup"><span data-stu-id="c9a8d-185">Security of Hosting Models</span></span>

<span data-ttu-id="c9a8d-186">В большинстве случаев **LocalSystem** не нужен, а контекст **нетворксервицехост** является более подходящим.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-186">For most situations, **LocalSystem** is unnecessary and the **NetworkServiceHost** context is more appropriate.</span></span> <span data-ttu-id="c9a8d-187">Большинство поставщиков WMI должны олицетворять контекст безопасности клиента для выполнения запрошенных операций от имени клиента WMI.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-187">Most WMI Providers must impersonate the client security context to perform requested operations on behalf of the WMI client.</span></span> <span data-ttu-id="c9a8d-188">Начиная с Windows Vista, поставщик WMI, в котором отсутствует определение модели размещения и выполняется, как если бы он работал под **локальной** системой, не будет работать должным образом.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-188">Starting with Windows Vista, a WMI provider that lacks a hosting model definition and executes as if it is running under **LocalSystem** will not run properly.</span></span> <span data-ttu-id="c9a8d-189">Чтобы исправить эту ситуацию, измените ожидаемую модель размещения и убедитесь, что код поставщика WMI выполняет операции в контексте Client Security, олицетворяя клиент WMI.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-189">To correct this situation, change the expected hosting model and ensure that the WMI provider code performs the operations in the client security context by impersonating the WMI client.</span></span> <span data-ttu-id="c9a8d-190">LocalSystem редко является обязательным требованием.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-190">LocalSystem is rarely an requirement.</span></span> <span data-ttu-id="c9a8d-191">Если поставщик должен иметь такой уровень привилегий, укажите модель размещения с помощью следующей инструкции в MOF-файле.</span><span class="sxs-lookup"><span data-stu-id="c9a8d-191">If your provider must have that level of privilege, specify the hosting model with the following statement in the MOF file.</span></span>

``` syntax
HostingModel=LocalSystemHost
```

## <a name="related-topics"></a><span data-ttu-id="c9a8d-192">См. также</span><span class="sxs-lookup"><span data-stu-id="c9a8d-192">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c9a8d-193">Выбор правильной регистрации</span><span class="sxs-lookup"><span data-stu-id="c9a8d-193">Choosing Correct Registration</span></span>](choosing-correct-registration.md)
</dt> <dt>

[<span data-ttu-id="c9a8d-194">Доступ к пространствам имен WMI</span><span class="sxs-lookup"><span data-stu-id="c9a8d-194">Access to WMI Namespaces</span></span>](access-to-wmi-namespaces.md)
</dt> <dt>

[<span data-ttu-id="c9a8d-195">Защита пространств имен WMI</span><span class="sxs-lookup"><span data-stu-id="c9a8d-195">Securing WMI Namespaces</span></span>](securing-wmi-namespaces.md)
</dt> <dt>

[<span data-ttu-id="c9a8d-196">Классы для настройки и устранения неполадок поставщика</span><span class="sxs-lookup"><span data-stu-id="c9a8d-196">Provider Configuration and Troubleshooting Classes</span></span>](provider-configuration-and-troubleshooting-classes.md)
</dt> <dt>

[<span data-ttu-id="c9a8d-197">**\_Поставщики MSFT**</span><span class="sxs-lookup"><span data-stu-id="c9a8d-197">**MSFT\_Providers**</span></span>](/previous-versions/windows/desktop/wmisystemprov/msft-providers)
</dt> <dt>

[<span data-ttu-id="c9a8d-198">Поддержание безопасности WMI</span><span class="sxs-lookup"><span data-stu-id="c9a8d-198">Maintaining WMI Security</span></span>](maintaining-wmi-security.md)
</dt> </dl>

 

