---
description: Может потребоваться написать приложение, которое может реагировать на события в любое время.
ms.assetid: 475dca47-b1e5-4362-ab00-9ab9383e92f9
ms.tgt_platform: multiple
title: Получение событий в любое время
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5559068e1e108c6f4185c31f8858a9e4169c50c9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104344732"
---
# <a name="receiving-events-at-all-times"></a><span data-ttu-id="48967-103">Получение событий в любое время</span><span class="sxs-lookup"><span data-stu-id="48967-103">Receiving Events at All Times</span></span>

<span data-ttu-id="48967-104">Может потребоваться написать приложение, которое может реагировать на события в любое время.</span><span class="sxs-lookup"><span data-stu-id="48967-104">You may want to write an application that can react to events at any time.</span></span> <span data-ttu-id="48967-105">Например, администратор может захотеть получить сообщение электронной почты, когда определенные меры производительности отклоняются на сетевых серверах.</span><span class="sxs-lookup"><span data-stu-id="48967-105">For example, an administrator may want to receive an email message when specific performance measures decline on network servers.</span></span> <span data-ttu-id="48967-106">В этом случае приложение должно выполняться в любое время.</span><span class="sxs-lookup"><span data-stu-id="48967-106">In this case, your application should run at all times.</span></span> <span data-ttu-id="48967-107">Однако запуск приложения непрерывно не является эффективным использованием системных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="48967-107">However, running an application continuously is not an efficient use of system resources.</span></span> <span data-ttu-id="48967-108">Вместо этого инструментарий WMI позволяет создать постоянный потребитель событий.</span><span class="sxs-lookup"><span data-stu-id="48967-108">Instead, WMI allows you to create a permanent event consumer.</span></span> <span data-ttu-id="48967-109">Постоянные потребители событий должны соответствовать особым требованиям безопасности.</span><span class="sxs-lookup"><span data-stu-id="48967-109">Permanent event consumers must meet special security requirements.</span></span> <span data-ttu-id="48967-110">Дополнительные сведения см. в разделе [Защита событий WMI](securing-wmi-events.md).</span><span class="sxs-lookup"><span data-stu-id="48967-110">For more information, see [Securing WMI Events](securing-wmi-events.md).</span></span>

<span data-ttu-id="48967-111">Постоянный потребитель событий получает события до тех пор, пока регистрация не будет явно отменена.</span><span class="sxs-lookup"><span data-stu-id="48967-111">A permanent event consumer receives events until its registration is explicitly canceled.</span></span>

<span data-ttu-id="48967-112">Постоянный потребитель событий — это сочетание следующих классов WMI, фильтров и COM-объектов, которые находятся в системе:</span><span class="sxs-lookup"><span data-stu-id="48967-112">A permanent event consumer is a combination of the following WMI classes, filters, and COM objects that reside on your system:</span></span>

-   <span data-ttu-id="48967-113">COM-объект, называемый физическим потребителем.</span><span class="sxs-lookup"><span data-stu-id="48967-113">A COM object called a physical consumer.</span></span> <span data-ttu-id="48967-114">Инструментарий WMI предоставляет несколько стандартных постоянных потребителей.</span><span class="sxs-lookup"><span data-stu-id="48967-114">WMI supplies several standard permanent consumers.</span></span> <span data-ttu-id="48967-115">Например, объект-получатель события активного скрипта [выполняет скрипт при возникновении события](running-a-script-based-on-an-event.md).</span><span class="sxs-lookup"><span data-stu-id="48967-115">For example, the Active Script Event consumer [runs a script when an event occurs](running-a-script-based-on-an-event.md).</span></span>
-   <span data-ttu-id="48967-116">Новый постоянный класс потребителя.</span><span class="sxs-lookup"><span data-stu-id="48967-116">A new permanent consumer class.</span></span>
-   <span data-ttu-id="48967-117">Экземпляр постоянного класса потребителя, называемый логическим потребителем.</span><span class="sxs-lookup"><span data-stu-id="48967-117">An instance of the permanent consumer class called a logical consumer.</span></span>
-   <span data-ttu-id="48967-118">Фильтр, содержащий запрос для событий.</span><span class="sxs-lookup"><span data-stu-id="48967-118">A filter that contains the query for events.</span></span>
-   <span data-ttu-id="48967-119">Связь между потребителем и фильтром.</span><span class="sxs-lookup"><span data-stu-id="48967-119">A linkage between the consumer and the filter.</span></span>

<span data-ttu-id="48967-120">Свойства логического потребителя событий указывают действия, выполняемые при уведомлении о событии, но не определяют запросы событий, с которыми они связаны.</span><span class="sxs-lookup"><span data-stu-id="48967-120">The properties of a logical event consumer specify the actions to perform when notified of an event, but do not define the event queries with which they are associated.</span></span> <span data-ttu-id="48967-121">При получении сигнала WMI автоматически загружает COM-объект, представляющий постоянного потребителя событий, в активную память.</span><span class="sxs-lookup"><span data-stu-id="48967-121">When signaled, WMI automatically loads the COM object that represents the permanent event consumer into active memory.</span></span> <span data-ttu-id="48967-122">Как правило, это происходит во время запуска или в ответ на событие, вызывающее срабатывание.</span><span class="sxs-lookup"><span data-stu-id="48967-122">Typically, this occurs during startup or in response to a triggering event.</span></span> <span data-ttu-id="48967-123">После активации постоянный потребитель событий выступает в качестве обычного потребителя событий, но остается до тех пор, пока не выгружается операционной системой.</span><span class="sxs-lookup"><span data-stu-id="48967-123">After being activated, the permanent event consumer acts as a normal event consumer, but remains until specifically unloaded by the operating system.</span></span>

<span data-ttu-id="48967-124">Вы можете создать собственный постоянный потребитель событий или использовать предустановленные [стандартные классы потребителей](standard-consumer-classes.md)WMI, такие как [**активескриптевентконсумер**](activescripteventconsumer.md).</span><span class="sxs-lookup"><span data-stu-id="48967-124">You can write your own permanent event consumer or use the WMI preinstalled [Standard Consumer Classes](standard-consumer-classes.md), such as [**ActiveScriptEventConsumer**](activescripteventconsumer.md).</span></span> <span data-ttu-id="48967-125">Дополнительные сведения см. в статьях [стандартные классы потребителей](standard-consumer-classes.md), [мониторинг и реагирование на события с помощью стандартных потребителей](monitoring-and-responding-to-events-with-standard-consumers.md)и [наблюдение за событиями](monitoring-events.md).</span><span class="sxs-lookup"><span data-stu-id="48967-125">For more information, see [Standard Consumer Classes](standard-consumer-classes.md), [Monitoring and Responding to Events with Standard Consumers](monitoring-and-responding-to-events-with-standard-consumers.md), and [Monitoring Events](monitoring-events.md).</span></span>

<span data-ttu-id="48967-126">В следующей процедуре описывается создание собственного постоянного потребителя событий.</span><span class="sxs-lookup"><span data-stu-id="48967-126">The following procedure describes how to create your own permanent event consumer.</span></span>

<span data-ttu-id="48967-127">**Создание собственного постоянного потребителя событий**</span><span class="sxs-lookup"><span data-stu-id="48967-127">**To create your own permanent event consumer**</span></span>

1.  <span data-ttu-id="48967-128">Определите тип событий, которые вы хотите получить.</span><span class="sxs-lookup"><span data-stu-id="48967-128">Determine what kind of events you want to receive.</span></span>

    <span data-ttu-id="48967-129">Инструментарий WMI поддерживает внутренние и внешние события.</span><span class="sxs-lookup"><span data-stu-id="48967-129">WMI supports intrinsic and extrinsic events.</span></span> <span data-ttu-id="48967-130">Внутреннее событие — это событие, предопределенное WMI, в то время как внешнее событие является событием, определенным сторонним поставщиком.</span><span class="sxs-lookup"><span data-stu-id="48967-130">An intrinsic event is an event predefined by WMI, whereas an extrinsic event is an event defined by a third party provider.</span></span> <span data-ttu-id="48967-131">Дополнительные сведения см. [в разделе Определение типа получаемого события](determining-the-type-of-event-to-receive.md).</span><span class="sxs-lookup"><span data-stu-id="48967-131">For more information, see [Determining the Type of Event to Receive](determining-the-type-of-event-to-receive.md).</span></span>

2.  <span data-ttu-id="48967-132">[Реализация физического потребителя](implementing-a-physical-consumer.md).</span><span class="sxs-lookup"><span data-stu-id="48967-132">[Implement a physical consumer](implementing-a-physical-consumer.md).</span></span>

    <span data-ttu-id="48967-133">Основное различие между приложением управления и [*физическим потребителем*](gloss-p.md) заключается в том, что пользователь загружает и выгружает приложение управления, тогда как инструментарий WMI загружает и выгружает физического потребителя.</span><span class="sxs-lookup"><span data-stu-id="48967-133">The main difference between a management application and a [*physical consumer*](gloss-p.md) is that a user loads and unloads a management application, whereas WMI loads and unloads a physical consumer.</span></span> <span data-ttu-id="48967-134">Большая часть кода должна быть в физическом потребителе.</span><span class="sxs-lookup"><span data-stu-id="48967-134">Most of your coding should be in the physical consumer.</span></span>

    > [!Note]  
    > <span data-ttu-id="48967-135">Этот шаг является первым в процедуре для простоты объяснения.</span><span class="sxs-lookup"><span data-stu-id="48967-135">This step is first in the procedure for ease of explanation.</span></span> <span data-ttu-id="48967-136">С точки зрения программирования, необходимо создать физический потребитель.</span><span class="sxs-lookup"><span data-stu-id="48967-136">In terms of coding, you should actually create the physical consumer last.</span></span> <span data-ttu-id="48967-137">Таким образом вы сможете разместить параметры и логику для постоянного поставщика событий, прежде чем начать длинное программирование.</span><span class="sxs-lookup"><span data-stu-id="48967-137">That way you can lay out your parameters and logic for your permanent event provider before you start lengthy coding.</span></span> <span data-ttu-id="48967-138">Однако сначала нет ограничений на написание физического потребителя.</span><span class="sxs-lookup"><span data-stu-id="48967-138">However, there is no restriction against writing the physical consumer first.</span></span>

     

3.  <span data-ttu-id="48967-139">[Создайте новый класс-получатель, описывающий физического потребителя](creating-a-new-permanent-event-consumer-class.md).</span><span class="sxs-lookup"><span data-stu-id="48967-139">[Create a new consumer class describing the physical consumer](creating-a-new-permanent-event-consumer-class.md).</span></span>

    <span data-ttu-id="48967-140">Как и любой класс, класс-потребитель описывает общие параметры постоянного потребителя событий для WMI.</span><span class="sxs-lookup"><span data-stu-id="48967-140">Like any class, the consumer class describes the general parameters of a permanent event consumer to WMI.</span></span>

4.  <span data-ttu-id="48967-141">[Создайте экземпляр класса-получателя](creating-a-logical-consumer.md).</span><span class="sxs-lookup"><span data-stu-id="48967-141">[Create an instance of the consumer class](creating-a-logical-consumer.md).</span></span>

    <span data-ttu-id="48967-142">Как и любой другой класс WMI, необходимо создать экземпляр класса-получателя, если требуется реализовать класс.</span><span class="sxs-lookup"><span data-stu-id="48967-142">Like any other WMI class, you must create an instance of the consumer class if you want to implement the class.</span></span> <span data-ttu-id="48967-143">Экземпляр класса-получателя также известен как [*логический потребитель*](gloss-l.md).</span><span class="sxs-lookup"><span data-stu-id="48967-143">An instance of a consumer class is also known as a [*logical consumer*](gloss-l.md).</span></span> <span data-ttu-id="48967-144">Логический потребитель представляет физического потребителя в WMI.</span><span class="sxs-lookup"><span data-stu-id="48967-144">The logical consumer represents the physical consumer to WMI.</span></span>

5.  <span data-ttu-id="48967-145">[Создайте фильтр событий](creating-an-event-filter.md).</span><span class="sxs-lookup"><span data-stu-id="48967-145">[Create an event filter](creating-an-event-filter.md).</span></span>

    <span data-ttu-id="48967-146">Запросы событий, активирующие постоянные потребители событий, называются [*фильтрами событий*](gloss-e.md).</span><span class="sxs-lookup"><span data-stu-id="48967-146">The event queries that activate permanent event consumers are called [*event filters*](gloss-e.md).</span></span> <span data-ttu-id="48967-147">Один фильтр событий может быть связан с несколькими потребителями логических событий.</span><span class="sxs-lookup"><span data-stu-id="48967-147">A single event filter can be associated with multiple logical event consumers.</span></span> <span data-ttu-id="48967-148">Более того, с одним потребителем логического события можно связать несколько фильтров событий.</span><span class="sxs-lookup"><span data-stu-id="48967-148">Furthermore, multiple event filters can be associated with a single logical event consumer.</span></span> <span data-ttu-id="48967-149">Фильтр является экземпляром [**\_ \_ EventFilter**](--eventfilter.md).</span><span class="sxs-lookup"><span data-stu-id="48967-149">The filter is an instance of [**\_\_EventFilter**](--eventfilter.md).</span></span>

    <span data-ttu-id="48967-150">Событие журнала NT создается при сбое запроса непостоянного потребителя событий.</span><span class="sxs-lookup"><span data-stu-id="48967-150">An NT Log event is generated when a permanent event consumer's query fails.</span></span> <span data-ttu-id="48967-151">Источник события — WinMgmt, идентификатор события — 10, а тип события — ошибка.</span><span class="sxs-lookup"><span data-stu-id="48967-151">The event's source is WinMgmt, the event ID is 10, and the event type is Error.</span></span>

6.  <span data-ttu-id="48967-152">[Свяжите фильтр событий с логическим потребителем](binding-an-event-filter-with-a-logical-consumer.md).</span><span class="sxs-lookup"><span data-stu-id="48967-152">[Link the event filter to the logical consumer](binding-an-event-filter-with-a-logical-consumer.md).</span></span>

    <span data-ttu-id="48967-153">Связывая фильтр событий с логическим потребителем, вы указываете инструментарию WMI о том, какой фильтр событий принадлежит логическому потребителю.</span><span class="sxs-lookup"><span data-stu-id="48967-153">By linking the event filter to the logical consumer, you instruct WMI about which event filter belongs to which logical consumer.</span></span> <span data-ttu-id="48967-154">Логические потребители событий и фильтры событий связаны экземпляром класса Association объекта [**\_ \_ филтертоконсумербиндинг**](--filtertoconsumerbinding.md).</span><span class="sxs-lookup"><span data-stu-id="48967-154">Logical event consumers and event filters are linked by an association class instance of [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md).</span></span> <span data-ttu-id="48967-155">Когда получено событие, совпадающее с запросом события, описанным в фильтре событий, Инструментарий WMI находит связанный объект-получатель логического события, просмотрев экземпляр класса Association.</span><span class="sxs-lookup"><span data-stu-id="48967-155">When an event is received that matches an event query described in an event filter, WMI finds the associated logical event consumer by looking at the association class instance.</span></span> <span data-ttu-id="48967-156">После обнаружения экземпляра потребителя логических событий Инструментарий WMI использует экземпляр класса [**\_ \_ евентконсумерпровидеррегистратион**](--eventconsumerproviderregistration.md) для поиска и запуска физического потребителя событий, связанного с этим экземпляром.</span><span class="sxs-lookup"><span data-stu-id="48967-156">After the logical event consumer instance is located, WMI uses an instance of the [**\_\_EventConsumerProviderRegistration**](--eventconsumerproviderregistration.md) class to locate and run the physical event consumer associated with this instance.</span></span>

7.  <span data-ttu-id="48967-157">[Написание поставщика потребителей событий](writing-an-event-consumer-provider.md).</span><span class="sxs-lookup"><span data-stu-id="48967-157">[Writing an event consumer provider](writing-an-event-consumer-provider.md).</span></span>

    <span data-ttu-id="48967-158">Поставщик потребителей событий — это COM-объект, который находит физического потребителя для WMI.</span><span class="sxs-lookup"><span data-stu-id="48967-158">The event consumer provider is a COM object that locates the physical consumer for WMI.</span></span>

 

 



