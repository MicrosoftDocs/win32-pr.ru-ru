---
description: Чтобы создать поставщик классов WMI, необходимо зарегистрировать \_ \_ экземпляр Win32Provider, представляющий поставщика, с помощью экземпляра \_ \_ класспровидеррегистратион.
ms.assetid: ed834969-47e9-47df-9db8-c805b2eb71da
ms.tgt_platform: multiple
title: Регистрация поставщика класса
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7bc15893e654f96f8c4e476219389a1f8f2c464a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103991518"
---
# <a name="registering-a-class-provider"></a><span data-ttu-id="1a551-103">Регистрация поставщика класса</span><span class="sxs-lookup"><span data-stu-id="1a551-103">Registering a Class Provider</span></span>

<span data-ttu-id="1a551-104">Чтобы создать поставщик классов WMI, необходимо зарегистрировать экземпляр [**\_ \_ Win32Provider**](--win32provider.md) , представляющий поставщика, с помощью экземпляра [**\_ \_ класспровидеррегистратион**](--classproviderregistration.md).</span><span class="sxs-lookup"><span data-stu-id="1a551-104">To create a WMI class provider you must register the [**\_\_Win32Provider**](--win32provider.md) instance that represents your provider using an instance of [**\_\_ClassProviderRegistration**](--classproviderregistration.md).</span></span> <span data-ttu-id="1a551-105">В качестве COM-объекта поставщик должен зарегистрироваться в операционной системе и инструментарии WMI.</span><span class="sxs-lookup"><span data-stu-id="1a551-105">As a COM object, your provider must register with the operating system and WMI.</span></span> <span data-ttu-id="1a551-106">В следующей процедуре предполагается, что вы уже реализовали процесс регистрации, как описано в статье [Регистрация поставщика](registering-a-provider.md).</span><span class="sxs-lookup"><span data-stu-id="1a551-106">The following procedure assumes that you have already implemented the registration process as described in [Registering a Provider](registering-a-provider.md).</span></span> <span data-ttu-id="1a551-107">Если поставщик хранит большинство данных в репозитории WMI и эти данные обновляются только при инициализации WMI, зарегистрируйте свой класс как поставщик класса push-уведомлений.</span><span class="sxs-lookup"><span data-stu-id="1a551-107">If your provider stores most data in the WMI repository and that data is updated only on WMI initialization, then register your class as a push class provider.</span></span> <span data-ttu-id="1a551-108">Если данные, которые вы предоставляете, часто изменяются и динамически извлекаются в коде при каждом запросе от WMI, зарегистрируйте поставщик в качестве поставщика опрашивающего класса.</span><span class="sxs-lookup"><span data-stu-id="1a551-108">If the data you are providing changes frequently and is retrieved dynamically by your code on every request from WMI, then register your provider as a pull class provider.</span></span>

<span data-ttu-id="1a551-109">В следующей процедуре описывается регистрация поставщика класса push-уведомлений.</span><span class="sxs-lookup"><span data-stu-id="1a551-109">The following procedure describes how to register a push class provider.</span></span>

<span data-ttu-id="1a551-110">**Регистрация поставщика класса push-уведомлений**</span><span class="sxs-lookup"><span data-stu-id="1a551-110">**To register a push class provider**</span></span>

-   <span data-ttu-id="1a551-111">Задайте для свойства **интерактионтипе** экземпляра [**\_ \_ класспровидеррегистратион**](--classproviderregistration.md) значение 1.</span><span class="sxs-lookup"><span data-stu-id="1a551-111">Set the **InteractionType** property of the [**\_\_ClassProviderRegistration**](--classproviderregistration.md) instance to 1.</span></span>

    <span data-ttu-id="1a551-112">Создание экземпляра [**\_ \_ класспровидеррегистратион**](--classproviderregistration.md) является частью процесса регистрации.</span><span class="sxs-lookup"><span data-stu-id="1a551-112">Creating an instance of [**\_\_ClassProviderRegistration**](--classproviderregistration.md) is part of the registration process.</span></span>

<span data-ttu-id="1a551-113">В следующей процедуре описывается регистрация поставщика опрашивающего класса.</span><span class="sxs-lookup"><span data-stu-id="1a551-113">The following procedure describes how to register a pull class provider.</span></span>

<span data-ttu-id="1a551-114">**Регистрация поставщика опрашивающего класса**</span><span class="sxs-lookup"><span data-stu-id="1a551-114">**To register a pull class provider**</span></span>

1.  <span data-ttu-id="1a551-115">Создайте экземпляр класса [**\_ \_ Win32Provider**](--win32provider.md) , который описывает поставщик.</span><span class="sxs-lookup"><span data-stu-id="1a551-115">Create an instance of the [**\_\_Win32Provider**](--win32provider.md) class that describes the provider.</span></span>
2.  <span data-ttu-id="1a551-116">Создайте экземпляр класса [**\_ \_ класспровидеррегистратион**](--classproviderregistration.md) , описывающий набор функций поставщика.</span><span class="sxs-lookup"><span data-stu-id="1a551-116">Create an instance of the [**\_\_ClassProviderRegistration**](--classproviderregistration.md) class that describes the feature set of the provider.</span></span>

    <span data-ttu-id="1a551-117">В экземпляре [**\_ \_ класспровидеррегистратион**](--classproviderregistration.md) :</span><span class="sxs-lookup"><span data-stu-id="1a551-117">Within the [**\_\_ClassProviderRegistration**](--classproviderregistration.md) instance:</span></span>

    1.  <span data-ttu-id="1a551-118">Задайте свойство **интерактионтипе** , чтобы указать, является ли поставщик поставщиком Push или Pull.</span><span class="sxs-lookup"><span data-stu-id="1a551-118">Set the **InteractionType** property to indicate whether the provider is a push or pull provider.</span></span>
    2.  <span data-ttu-id="1a551-119">Пометьте класс как как [**динамический**](standard-wmi-qualifiers.md) , так и квалификатор [**поставщика**](/windows/desktop/api/Provider/nl-provider-provider) .</span><span class="sxs-lookup"><span data-stu-id="1a551-119">Tag the class with both the [**Dynamic**](standard-wmi-qualifiers.md) and [**Provider**](/windows/desktop/api/Provider/nl-provider-provider) qualifiers.</span></span>

        <span data-ttu-id="1a551-120">[**Динамический**](standard-wmi-qualifiers.md) квалификатор сигнализирует, что инструментарий WMI должен использовать поставщик для получения экземпляров класса.</span><span class="sxs-lookup"><span data-stu-id="1a551-120">The [**Dynamic**](standard-wmi-qualifiers.md) qualifier signals that WMI should use a provider to retrieve the class instances.</span></span> <span data-ttu-id="1a551-121">Квалификатор [**поставщика**](/windows/desktop/api/Provider/nl-provider-provider) указывает имя поставщика, который должен использовать WMI.</span><span class="sxs-lookup"><span data-stu-id="1a551-121">The [**Provider**](/windows/desktop/api/Provider/nl-provider-provider) qualifier specifies the name of the provider that WMI should use.</span></span>

    3.  <span data-ttu-id="1a551-122">Определите свойства **ресултсеткуериес**, **референцедсеткуериес** и **унсуппортедкуериес** .</span><span class="sxs-lookup"><span data-stu-id="1a551-122">Define the **ResultSetQueries**, **ReferencedSetQueries**, and **UnsupportedQueries** properties.</span></span>

        <span data-ttu-id="1a551-123">Эти свойства запроса описывают подробные сведения о поддерживаемом классе.</span><span class="sxs-lookup"><span data-stu-id="1a551-123">These query properties describe detailed information about the supported class.</span></span>

<span data-ttu-id="1a551-124">Кроме описания различных поддерживаемых методов класса, класс [**\_ \_ класспровидеррегистратион**](--classproviderregistration.md) также имеет три свойства, описывающих последовательность запросов.</span><span class="sxs-lookup"><span data-stu-id="1a551-124">In addition to describing the various supported methods of a class, the [**\_\_ClassProviderRegistration**](--classproviderregistration.md) class also has three properties that describe a series of queries.</span></span> <span data-ttu-id="1a551-125">При совместном использовании эти три свойства описывают весь диапазон классов, предоставляемых поставщиком классов.</span><span class="sxs-lookup"><span data-stu-id="1a551-125">When used together, these three properties describe the entire range of classes supplied by the class provider.</span></span> <span data-ttu-id="1a551-126">Каждое свойство запроса содержит инструкцию WQL SELECT, называемую "запрос схемы", для указания типов поддерживаемых классов.</span><span class="sxs-lookup"><span data-stu-id="1a551-126">Each query property contains a WQL SELECT statement, called a "schema query," to specify the types of supported classes.</span></span> <span data-ttu-id="1a551-127">Запросы схемы указывают специальное имя класса, называемое meta \_ Class.</span><span class="sxs-lookup"><span data-stu-id="1a551-127">Schema queries specify a special class name called meta\_class.</span></span> <span data-ttu-id="1a551-128">В следующей таблице перечислены свойства запроса.</span><span class="sxs-lookup"><span data-stu-id="1a551-128">The following table lists the query properties.</span></span>



| <span data-ttu-id="1a551-129">Свойство</span><span class="sxs-lookup"><span data-stu-id="1a551-129">Property</span></span>                 | <span data-ttu-id="1a551-130">Описание</span><span class="sxs-lookup"><span data-stu-id="1a551-130">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|--------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="1a551-131">**ресултсеткуериес**</span><span class="sxs-lookup"><span data-stu-id="1a551-131">**ResultSetQueries**</span></span>     | <span data-ttu-id="1a551-132">Содержит сведения о результирующем наборе, предоставленном поставщиком.</span><span class="sxs-lookup"><span data-stu-id="1a551-132">Contains information about the result set the provider supplies.</span></span> <span data-ttu-id="1a551-133">Инструментарий WMI использует эти сведения, чтобы определить, следует ли вызывать поставщик для удовлетворения запроса из приложения.</span><span class="sxs-lookup"><span data-stu-id="1a551-133">WMI uses the information to determine whether to invoke the provider to satisfy a query from an application.</span></span> <span data-ttu-id="1a551-134">Это свойство описывает либо набор всех классов, которые может предоставить поставщик, либо надмножество доступных классов, но никогда не является подмножеством.</span><span class="sxs-lookup"><span data-stu-id="1a551-134">This property describes either the set of all classes that the provider can supply or a superset of the available classes, but never a subset.</span></span> <span data-ttu-id="1a551-135">Инструментарий WMI требует, чтобы поставщик указал хотя бы один запрос в этом свойстве.</span><span class="sxs-lookup"><span data-stu-id="1a551-135">WMI requires a provider to specify at least one query in this property.</span></span><br/> <span data-ttu-id="1a551-136">В следующем примере показано, как задать **ресултсеткуериес** , когда поставщик предоставляет класс ассоциации, который ссылается на класс [**Win32 \_ LogicalDisk**](/windows/desktop/CIMWin32Prov/win32-logicaldisk) .</span><span class="sxs-lookup"><span data-stu-id="1a551-136">The following example shows how to set **ResultSetQueries** when a provider supplies an association class that references the [**Win32\_LogicalDisk**](/windows/desktop/CIMWin32Prov/win32-logicaldisk) class.</span></span><br/> `SELECT * FROM meta_class WHERE __Class = "Win32_LogicalDisk"`<br/> <span data-ttu-id="1a551-137">В следующем примере показано, как задать общий запрос, когда поставщик предоставляет классы, ссылающиеся на другие неизвестные классы.</span><span class="sxs-lookup"><span data-stu-id="1a551-137">The following example shows how to specify a general query when a provider supplies classes that reference other unknown classes.</span></span><br/> `SELECT * FROM meta_class`<br/> <span data-ttu-id="1a551-138">В следующем примере показано, как задать **ресултсеткуериес** , когда поставщик предоставляет только подклассы, но не родительский класс данного класса.</span><span class="sxs-lookup"><span data-stu-id="1a551-138">The following example shows how to set **ResultSetQueries** when a provider supplies only subclasses, but not the parent class of a given class.</span></span><br/> `SELECT * FROM meta_class WHERE __Dynasty = "MyClass"`<br/> <span data-ttu-id="1a551-139">В следующем примере показано, как использовать специальное \_ \_ свойство и Set **ресултсеткуериес** , если поставщик предоставляет все классы и подклассы.</span><span class="sxs-lookup"><span data-stu-id="1a551-139">The following example shows how to use the special \_\_this property and set **ResultSetQueries** when a provider supplies all class and subclasses.</span></span><br/> `SELECT * FROM meta_class WHERE __this ISA "MyClass"`<br/> |
| <span data-ttu-id="1a551-140">**референцедсеткуериес**</span><span class="sxs-lookup"><span data-stu-id="1a551-140">**ReferencedSetQueries**</span></span> | <span data-ttu-id="1a551-141">Определяет, следует ли обходить поставщик в запросах схемы, где запрашиваются ассоциации и ссылки.</span><span class="sxs-lookup"><span data-stu-id="1a551-141">Determines whether to bypass the provider in schema queries where associations and references are being requested.</span></span> <span data-ttu-id="1a551-142">Поставщики, которые могут предоставлять классы ассоциаций, должны содержать по крайней мере один запрос в своем свойстве **референцедсеткуериес** .</span><span class="sxs-lookup"><span data-stu-id="1a551-142">Providers that can supply association classes must include at least one query in their **ReferencedSetQueries** property.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| <span data-ttu-id="1a551-143">**унсуппортедкуериес**</span><span class="sxs-lookup"><span data-stu-id="1a551-143">**UnsupportedQueries**</span></span>   | <span data-ttu-id="1a551-144">Содержит сведения о результирующем наборе, который не предоставляется поставщиком класса.</span><span class="sxs-lookup"><span data-stu-id="1a551-144">Contains information about the result set that a class provider does not supply.</span></span> <span data-ttu-id="1a551-145">Инструментарий WMI использует это свойство для вычитания из набора классов, подразумеваемых **ресултсеткуериес**.</span><span class="sxs-lookup"><span data-stu-id="1a551-145">WMI uses this property to subtract from the set of classes implied by **ResultSetQueries**.</span></span> <span data-ttu-id="1a551-146">Например, поставщик класса может указать в **ресултсеткуериес** support для всех классов, производных от MyClass, и указать в **унсуппортедкуериес** отсутствие поддержки для одного конкретного производного класса.</span><span class="sxs-lookup"><span data-stu-id="1a551-146">For example, a class provider can specify in **ResultSetQueries** support for all classes derived from MyClass and specify in **UnsupportedQueries** a lack of support for one particular derived class.</span></span><br/> <span data-ttu-id="1a551-147">Чем больше информации поставщик может зарегистрировать о своих возможностях обработки запросов, тем быстрее она выполняется.</span><span class="sxs-lookup"><span data-stu-id="1a551-147">The more information that a provider can register about its query processing capabilities, the faster it runs.</span></span> <span data-ttu-id="1a551-148">Ввод одного или нескольких запросов в свойстве **унсуппортедкуериес** является одним из способов, которые особенно важны, когда поставщик использует класс, который он не предоставляет.</span><span class="sxs-lookup"><span data-stu-id="1a551-148">Entering one or more queries in the **UnsupportedQueries** property is one way to be specific and is particularly important when a provider relies on a class that it does not supply.</span></span> <span data-ttu-id="1a551-149">При запросе к классу, указанному в запросе в свойстве **унсуппортедкуериес** , Инструментарий WMI может предоставить сам класс или вызвать альтернативный поставщик, чтобы предоставить его.</span><span class="sxs-lookup"><span data-stu-id="1a551-149">When a request is made for a class that is listed in a query in the **UnsupportedQueries** property, WMI can supply the class itself or invoke an alternate provider to supply it.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                             |



 

<span data-ttu-id="1a551-150">Поскольку Инструментарий WMI не поддерживает предложение OR, необходимо создать отдельный запрос для каждого класса.</span><span class="sxs-lookup"><span data-stu-id="1a551-150">Because WMI does not support the OR clause, you must create a separate query for each class.</span></span>

<span data-ttu-id="1a551-151">Следующие запросы указываются в **ресултсеткуериес** , когда поставщик класса предоставляет MyClass1, MyClass2 и MyClass3.</span><span class="sxs-lookup"><span data-stu-id="1a551-151">The following queries are specified in **ResultSetQueries** when a class provider supplies MyClass1, MyClass2, and MyClass3.</span></span>


```sql
SELECT * FROM meta_class WHERE __Class = "MyClass1"
SELECT * FROM meta_class WHERE __Class = "MyClass2"
SELECT * FROM meta_class WHERE __Class = "MyClass3"
```



<span data-ttu-id="1a551-152">Только администраторы могут регистрировать или удалять поставщик, создавая экземпляр [**\_ \_ Win32Provider**](--win32provider.md) и [**\_ \_ класспровидеррегистратион**](--classproviderregistration.md).</span><span class="sxs-lookup"><span data-stu-id="1a551-152">Only administrators can register or delete a provider by creating an instance of [**\_\_Win32Provider**](--win32provider.md) and [**\_\_ClassProviderRegistration**](--classproviderregistration.md).</span></span>

 

