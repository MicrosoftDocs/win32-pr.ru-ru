---
title: Взаимодействие с IMAPI
description: Следующие шаги описывают типичное взаимодействие между приложением и IMAPI.
ms.assetid: e57a86c4-7e27-40cf-a9c1-081b3f20d9d9
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3e68bee24cfe0724ed14d439b0789f5023338853
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "103986547"
---
# <a name="interacting-with-imapi"></a><span data-ttu-id="98d6b-103">Взаимодействие с IMAPI</span><span class="sxs-lookup"><span data-stu-id="98d6b-103">Interacting with IMAPI</span></span>

<span data-ttu-id="98d6b-104">Следующие шаги описывают типичное взаимодействие между приложением и IMAPI.</span><span class="sxs-lookup"><span data-stu-id="98d6b-104">The following steps describe a typical interaction between an application and IMAPI.</span></span>

1.  <span data-ttu-id="98d6b-105">Создайте экземпляр **мсдискмастеробж** (с помощью **CoCreateInstance**, смарт-указателей из импорта и т. д.) и запросите интерфейс [**идискмастер**](/windows/desktop/api/Imapi/nn-imapi-idiscmaster) .</span><span class="sxs-lookup"><span data-stu-id="98d6b-105">Create an instance of the **MSDiscMasterObj** (using **CoCreateInstance**, smart pointers from an import, and so on) and request the [**IDiscMaster**](/windows/desktop/api/Imapi/nn-imapi-idiscmaster) interface.</span></span>
2.  <span data-ttu-id="98d6b-106">Получите доступ к IMAPI, вызвав [**идискмастер:: Open**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-open).</span><span class="sxs-lookup"><span data-stu-id="98d6b-106">Acquire access to IMAPI by calling [**IDiscMaster::Open**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-open).</span></span> <span data-ttu-id="98d6b-107">При успешном вызове приложение получает полный доступ ко всем интерфейсам и методам, реализованным в **мсдискмастеробж**.</span><span class="sxs-lookup"><span data-stu-id="98d6b-107">If this call succeeds, the application has full access to all the interfaces and methods implemented in **MSDiscMasterObj**.</span></span>
3.  <span data-ttu-id="98d6b-108">Получите перечислитель формата мастера дисков с помощью [**енумдискмастерформатс**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-enumdiscmasterformats).</span><span class="sxs-lookup"><span data-stu-id="98d6b-108">Retrieve the disc master format enumerator using [**EnumDiscMasterFormats**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-enumdiscmasterformats).</span></span> <span data-ttu-id="98d6b-109">Перечисляет набор форматов, поддерживаемых главным объектом диска, а затем выберите активный формат.</span><span class="sxs-lookup"><span data-stu-id="98d6b-109">Enumerate the set of formats that the disc master object supports, then select the active format.</span></span> <span data-ttu-id="98d6b-110">Форматы, возвращаемые из перечислителя, являются идентификаторов IID интерфейсов для [**ижолиетдискмастер**](/windows/desktop/api/Imapi/nn-imapi-ijolietdiscmaster) и [**иредбукдискмастер**](/windows/desktop/api/Imapi/nn-imapi-iredbookdiscmaster).</span><span class="sxs-lookup"><span data-stu-id="98d6b-110">The formats returned from the enumerator are the IIDs of the interfaces for [**IJolietDiscMaster**](/windows/desktop/api/Imapi/nn-imapi-ijolietdiscmaster) and [**IRedbookDiscMaster**](/windows/desktop/api/Imapi/nn-imapi-iredbookdiscmaster).</span></span>
4.  <span data-ttu-id="98d6b-111">Получите перечислитель записи на диск с помощью [**енумдискрекордерс**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-enumdiscrecorders).</span><span class="sxs-lookup"><span data-stu-id="98d6b-111">Retrieve the disc recorder enumerator using [**EnumDiscRecorders**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-enumdiscrecorders).</span></span> <span data-ttu-id="98d6b-112">Перечислите список поддерживаемых средств записи дисков (для конкретного активного формата), а затем выберите активный объект записи.</span><span class="sxs-lookup"><span data-stu-id="98d6b-112">Enumerate the list of supported disc recorders (specific to the active format), then select the active recorder.</span></span> <span data-ttu-id="98d6b-113">Интерфейс [**идискрекордер**](/windows/desktop/api/Imapi/nn-imapi-idiscrecorder) представляет физическое устройство.</span><span class="sxs-lookup"><span data-stu-id="98d6b-113">The [**IDiscRecorder**](/windows/desktop/api/Imapi/nn-imapi-idiscrecorder) interface represents a physical device.</span></span>
5.  <span data-ttu-id="98d6b-114">Используйте [**идискмастер::P рогрессадвисе**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-progressadvise) , чтобы зарегистрировать обратные вызовы хода выполнения.</span><span class="sxs-lookup"><span data-stu-id="98d6b-114">Use [**IDiscMaster::ProgressAdvise**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-progressadvise) to register for progress callbacks.</span></span>
6.  <span data-ttu-id="98d6b-115">Для создания содержимого используйте интерфейс для выбранного формата.</span><span class="sxs-lookup"><span data-stu-id="98d6b-115">Use the interface for the selected format to build up content.</span></span> <span data-ttu-id="98d6b-116">Содержимое строится постепенно, поэтому дорожки или содержимое папки можно добавить на диск в части.</span><span class="sxs-lookup"><span data-stu-id="98d6b-116">Content builds incrementally, so tracks or folder contents can be added to a disc piece by piece.</span></span> <span data-ttu-id="98d6b-117">Создание этого содержимого называется *промежуточной настройкой образа*.</span><span class="sxs-lookup"><span data-stu-id="98d6b-117">Building up this content is called *staging an image*.</span></span> <span data-ttu-id="98d6b-118">Содержимое промежуточного образа не может быть постепенно удалено (нельзя удалить добавленную запись), но можно очистить содержимое промежуточного образа, чтобы промежуточное хранение можно было запустить снова.</span><span class="sxs-lookup"><span data-stu-id="98d6b-118">The contents of the staged image cannot be incrementally deleted (you cannot remove a track that has been added), but it is possible to clear the contents of a staged image so that staging can start again.</span></span> <span data-ttu-id="98d6b-119">Используйте [**идискмастер:: клеарформатконтент**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-clearformatcontent) для перезапуска промежуточного хранения.</span><span class="sxs-lookup"><span data-stu-id="98d6b-119">Use [**IDiscMaster::ClearFormatContent**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-clearformatcontent) to restart staging.</span></span>

<span data-ttu-id="98d6b-120">**Для аудио:  **</span><span class="sxs-lookup"><span data-stu-id="98d6b-120">**For Audio:  **</span></span>

1.  <span data-ttu-id="98d6b-121">Используйте [**иредбукдискмастер:: креатеаудиотракк**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-createaudiotrack) , чтобы указать, что на диске начинается новая звуковая дорожка.</span><span class="sxs-lookup"><span data-stu-id="98d6b-121">Use [**IRedbookDiscMaster::CreateAudioTrack**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-createaudiotrack) to indicate a new audio track is being started on the disc.</span></span>
2.  <span data-ttu-id="98d6b-122">Используйте [**иредбукдискмастер:: аддаудиотраккблоккс**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-addaudiotrackblocks) для добавления необработанных аудио-данных в дорожку. Приложение может использовать [**жетаваилаблеаудиотраккблоккс**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-getavailableaudiotrackblocks), [**жеттоталаудиоблоккс**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-gettotalaudioblocks)и [**жетуседаудиоблоккс**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-getusedaudioblocks) для получения статистических данных.</span><span class="sxs-lookup"><span data-stu-id="98d6b-122">Use [**IRedbookDiscMaster::AddAudioTrackBlocks**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-addaudiotrackblocks) to add raw audio data to a track. The application can use [**GetAvailableAudioTrackBlocks**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-getavailableaudiotrackblocks), [**GetTotalAudioBlocks**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-gettotalaudioblocks), and [**GetUsedAudioBlocks**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-getusedaudioblocks) to retrieve statistical information.</span></span>
3.  <span data-ttu-id="98d6b-123">Чтобы закрыть звуковую дорожку, используйте [**иредбукдискмастер:: клосеаудиотракк**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-closeaudiotrack) .</span><span class="sxs-lookup"><span data-stu-id="98d6b-123">Use [**IRedbookDiscMaster::CloseAudioTrack**](/windows/desktop/api/Imapi/nf-imapi-iredbookdiscmaster-closeaudiotrack) to close an audio track.</span></span>
4.  <span data-ttu-id="98d6b-124">Повторите шаги 1-3, пока не освободится место или не будут записаны все звуковые дорожки.</span><span class="sxs-lookup"><span data-stu-id="98d6b-124">Repeat steps 1-3 until out of space or all audio tracks have been written.</span></span>

<span data-ttu-id="98d6b-125">**Для данных:  **</span><span class="sxs-lookup"><span data-stu-id="98d6b-125">**For Data:  **</span></span>

1.  <span data-ttu-id="98d6b-126">Чтобы добавить содержимое папки в образ, используйте [**ижолиетдискмастер:: адддата**](/windows/desktop/api/Imapi/nf-imapi-ijolietdiscmaster-adddata) .</span><span class="sxs-lookup"><span data-stu-id="98d6b-126">Use [**IJolietDiscMaster::AddData**](/windows/desktop/api/Imapi/nf-imapi-ijolietdiscmaster-adddata) to add the contents of a folder to the image.</span></span> <span data-ttu-id="98d6b-127">Элементы в папке помещаются в корневую папку файла изображения.</span><span class="sxs-lookup"><span data-stu-id="98d6b-127">The items within a folder are placed in the root of the image file.</span></span> <span data-ttu-id="98d6b-128">Для получения статистических данных используйте [**жеттоталдатаблоккс**](/windows/desktop/api/Imapi/nf-imapi-ijolietdiscmaster-gettotaldatablocks) и [**жетуседдатаблоккс**](/windows/desktop/api/Imapi/nf-imapi-ijolietdiscmaster-getuseddatablocks) .</span><span class="sxs-lookup"><span data-stu-id="98d6b-128">Use [**GetTotalDataBlocks**](/windows/desktop/api/Imapi/nf-imapi-ijolietdiscmaster-gettotaldatablocks) and [**GetUsedDataBlocks**](/windows/desktop/api/Imapi/nf-imapi-ijolietdiscmaster-getuseddatablocks) to retrieve statistical information.</span></span>
2.  <span data-ttu-id="98d6b-129">Повторите описанный выше шаг, пока не освободится место или не будут добавлены все данные.</span><span class="sxs-lookup"><span data-stu-id="98d6b-129">Repeat the above step until out of space or all data has been added.</span></span>

<span data-ttu-id="98d6b-130">**Для всех дисков:  **</span><span class="sxs-lookup"><span data-stu-id="98d6b-130">**For All Discs:  **</span></span>

1.  <span data-ttu-id="98d6b-131">Используйте [**идискмастер:: рекорддиск**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-recorddisc) для записи диска.</span><span class="sxs-lookup"><span data-stu-id="98d6b-131">Use [**IDiscMaster::RecordDisc**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-recorddisc) to record the disc.</span></span>
2.  <span data-ttu-id="98d6b-132">Закройте сеанс IMAPI с помощью [**идискмастер:: Close**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-close).</span><span class="sxs-lookup"><span data-stu-id="98d6b-132">Close the IMAPI session using [**IDiscMaster::Close**](/windows/desktop/api/Imapi/nf-imapi-idiscmaster-close).</span></span> <span data-ttu-id="98d6b-133">Закрытие сеанса очищает содержимое образа диска.</span><span class="sxs-lookup"><span data-stu-id="98d6b-133">Closing the session clears the contents of the disc stash.</span></span>

 

 




