---
title: Реализация механизма LEAP для EAPHost
description: Описывает механизм EAPHost, позволяющий сторонним лицам писать модули LEAP для Windows.
ms.assetid: d17a99cb-4a43-4719-984e-b742c9518f52
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dc50cda8d32cc26dd81af5733345deebb579c792
ms.sourcegitcommit: 773fa6257ead6c74154ad3cf46d21e49adc900aa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/09/2020
ms.locfileid: "104134742"
---
# <a name="implementing-the-eaphost-leap-mechanism"></a><span data-ttu-id="53a29-103">Реализация механизма LEAP для EAPHost</span><span class="sxs-lookup"><span data-stu-id="53a29-103">Implementing the EAPHost LEAP Mechanism</span></span>

<span data-ttu-id="53a29-104">В этом разделе описывается механизм EAPHost, позволяющий сторонним лицам писать модули LEAP для Windows.</span><span class="sxs-lookup"><span data-stu-id="53a29-104">This topic describes the EAPHost mechanism that allows third parties to write Lightweight Extensible Authentication Protocol (LEAP) modules for Windows.</span></span> <span data-ttu-id="53a29-105">LEAP — это устаревший метод проверки подлинности, созданный компанией Cisco в соответствии с [RFC 3748](https://go.microsoft.com/fwlink/p/?linkid=84016).</span><span class="sxs-lookup"><span data-stu-id="53a29-105">LEAP is a legacy authentication method, created by Cisco, as per [RFC 3748](https://go.microsoft.com/fwlink/p/?linkid=84016).</span></span> <span data-ttu-id="53a29-106">Дополнительные сведения о LEAP см. [в статье Cisco LEAP Q&A](https://go.microsoft.com/fwlink/p/?linkid=84018).</span><span class="sxs-lookup"><span data-stu-id="53a29-106">For more information about LEAP, see [Cisco LEAP Q&A](https://go.microsoft.com/fwlink/p/?linkid=84018).</span></span>

## <a name="eaphost-authentication-process"></a><span data-ttu-id="53a29-107">Процесс проверки подлинности EAPHost</span><span class="sxs-lookup"><span data-stu-id="53a29-107">EAPHost Authentication Process</span></span>

<span data-ttu-id="53a29-108">Обычный процесс проверки подлинности EAPHost выполняется следующим образом.</span><span class="sxs-lookup"><span data-stu-id="53a29-108">The regular EAPHost authentication process occurs as follows:</span></span>

-   <span data-ttu-id="53a29-109">Средство проверки подлинности отправляет запрос на проверку подлинности однорангового узла.</span><span class="sxs-lookup"><span data-stu-id="53a29-109">The authenticator sends a Request to authenticate the peer.</span></span> <span data-ttu-id="53a29-110">Например, приложение вызывает [**еафостпирбегинсессион**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerbeginsession) с конфигурацией EAPHost и данными пользователя.</span><span class="sxs-lookup"><span data-stu-id="53a29-110">For example, the application calls [**EapHostPeerBeginSession**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerbeginsession) with EAPHost configuration and user data.</span></span>
-   <span data-ttu-id="53a29-111">Одноранговый узел отправляет ответный пакет в ответ на допустимый запрос.</span><span class="sxs-lookup"><span data-stu-id="53a29-111">The peer sends a Response packet in reply to a valid Request.</span></span> <span data-ttu-id="53a29-112">Например, успешный вызов возвращает обработчик сеанса **EAP \_ \_** .</span><span class="sxs-lookup"><span data-stu-id="53a29-112">For example, a successful call returns an **EAP\_SESSION\_HANDLE** session handle.</span></span>
-   <span data-ttu-id="53a29-113">Средство проверки подлинности отправляет дополнительный пакет запроса, а одноранговый узел отвечает с ответом.</span><span class="sxs-lookup"><span data-stu-id="53a29-113">The authenticator sends an additional Request packet, and the peer replies with a Response.</span></span> <span data-ttu-id="53a29-114">Например, приложение вызывает [**еафостпиржетсендпаккет**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeergetsendpacket) для получения пакетов EAP, полученных EAPHost во время сеанса.</span><span class="sxs-lookup"><span data-stu-id="53a29-114">For example, the application calls [**EapHostPeerGetSendPacket**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeergetsendpacket) to obtain EAP packets received by EAPHost throughout the session.</span></span> <span data-ttu-id="53a29-115">Каждый пакет обрабатывается вызовом [**еафостпирпроцессрецеиведпаккет**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerprocessreceivedpacket).</span><span class="sxs-lookup"><span data-stu-id="53a29-115">Each packet is processed by a call to [**EapHostPeerProcessReceivedPacket**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerprocessreceivedpacket).</span></span>
-   <span data-ttu-id="53a29-116">[**Еафостпирпроцессрецеиведпаккет**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerprocessreceivedpacket) всегда будет возвращать код действия.</span><span class="sxs-lookup"><span data-stu-id="53a29-116">[**EapHostPeerProcessReceivedPacket**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerprocessreceivedpacket) will always return an action code.</span></span> <span data-ttu-id="53a29-117">Затем запрашивающий объект должен вызвать функцию, соответствующую коду действия.</span><span class="sxs-lookup"><span data-stu-id="53a29-117">The supplicant must then call the function corresponding to the action code.</span></span>
-   <span data-ttu-id="53a29-118">Последовательность запросов и ответов продолжится при необходимости.</span><span class="sxs-lookup"><span data-stu-id="53a29-118">The sequence of Requests and Responses continues as long as needed.</span></span> <span data-ttu-id="53a29-119">Например, приложение может вызвать [**еафостпиржетреспонсеаттрибутес**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeergetresponseattributes) для запроса доступных атрибутов EAP, а одноранговый узел будет отвечать на [**еафостпирсетреспонсеаттрибутес**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeersetresponseattributes) , чтобы вернуть их.</span><span class="sxs-lookup"><span data-stu-id="53a29-119">For example, the application can call [**EapHostPeerGetResponseAttributes**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeergetresponseattributes) to request available EAP attributes, and the peer responds with [**EapHostPeerSetResponseAttributes**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeersetresponseattributes) to return them.</span></span>
-   <span data-ttu-id="53a29-120">После первоначального запроса невозможно отправить новый запрос, пока не будет получен допустимый ответ.</span><span class="sxs-lookup"><span data-stu-id="53a29-120">After an initial Request, a new Request cannot be sent until a valid Response is received.</span></span>
-   <span data-ttu-id="53a29-121">Диалог будет продолжен до тех пор, пока не будет выполнена проверка подлинности однорангового узла. в этом случае реализация средства проверки подлинности должна передать сбой EAP.</span><span class="sxs-lookup"><span data-stu-id="53a29-121">The conversation continues until the authenticator cannot authenticate the peer, in which case the authenticator implementation must transmit an EAP Failure.</span></span> <span data-ttu-id="53a29-122">Например, неприемлемые ответы на один или несколько запросов приведут к тому, что средство проверки подлинности передаст код 4 сбой EAP.</span><span class="sxs-lookup"><span data-stu-id="53a29-122">For example, unacceptable Responses to one or more Requests would cause the authenticator to transmit a Code 4 EAP Failure.</span></span>
-   <span data-ttu-id="53a29-123">Кроме того, сеанс проверки подлинности может продолжаться до тех пор, пока средство проверки подлинности не определит, что была выполнена успешная аутентификация. в этом случае средство проверки подлинности должно передать успешное выполнение EAP (код 3</span><span class="sxs-lookup"><span data-stu-id="53a29-123">Alternatively, the authentication conversation can continue until the authenticator determines that successful authentication has occurred, in which case the authenticator must transmit an EAP Success (Code 3).</span></span>
-   <span data-ttu-id="53a29-124">Если результат указывает на успешное выполнение или сбой, приложение вызывает [**еафостпирендсессион**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerendsession) для завершения сеанса.</span><span class="sxs-lookup"><span data-stu-id="53a29-124">Whether the result indicates success or failure, the application calls [**EapHostPeerEndSession**](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerendsession) to terminate the session.</span></span> <span data-ttu-id="53a29-125">В случае сбоя можно выполнить повторную проверку подлинности, открыв другой сеанс с EAPHost и указав то же или новое удостоверение.</span><span class="sxs-lookup"><span data-stu-id="53a29-125">In the case of failure, re-authentication can be attempted by opening another session with EAPHost and providing either the same or a new identity.</span></span>

### <a name="leap-authentication-process"></a><span data-ttu-id="53a29-126">Процесс проверки подлинности LEAP</span><span class="sxs-lookup"><span data-stu-id="53a29-126">LEAP Authentication Process</span></span>

<span data-ttu-id="53a29-127">Процесс проверки подлинности LEAP отличается от обычного процесса проверки подлинности EAPhost следующим образом.</span><span class="sxs-lookup"><span data-stu-id="53a29-127">The LEAP authentication process differs from the regular EAPhost authentication process as follows:</span></span>

-   <span data-ttu-id="53a29-128">Проверка подлинности EAP инициируется сервером (Authenticator).</span><span class="sxs-lookup"><span data-stu-id="53a29-128">EAP authentication is initiated by the server (authenticator).</span></span> <span data-ttu-id="53a29-129">LEAP, напротив, инициируется клиентом (одноранговым).</span><span class="sxs-lookup"><span data-stu-id="53a29-129">LEAP, in contrast, is initiated by the client (peer).</span></span>
    -   <span data-ttu-id="53a29-130">Поэтому при написании модуля LEAP всегда необходимо убедиться, что пакет запроса на выходящий запрос от однорангового метода и ответ EAP от сервера EAP всегда должны иметь тот же идентификатор пакета, что и пакет EAP Success на сервере.</span><span class="sxs-lookup"><span data-stu-id="53a29-130">Therefore, when writing a LEAP module you must always ensure that the Challenge Request packet from the peer method and the EAP Response from the EAP server must always have the same packet ID as that of the EAP Success packet from the server.</span></span>

    <!-- -->

    -   <span data-ttu-id="53a29-131">В отличие от них, у всех пакетов запросов и ответов EAPHost, как правило, есть разные идентификаторы.</span><span class="sxs-lookup"><span data-stu-id="53a29-131">In contrast, EAPHost Request and Response and Success packets typically all have different IDs.</span></span>
        > [!Note]  
        > <span data-ttu-id="53a29-132">Каждый запрос EAP имеет поле типа для указания того, что запрашивается.</span><span class="sxs-lookup"><span data-stu-id="53a29-132">Every EAP Request has a Type field to indicate what is being requested.</span></span> <span data-ttu-id="53a29-133">Как и в случае с пакетом запроса, каждый пакет ответа EAP содержит поле типа, соответствующее полю типа запроса.</span><span class="sxs-lookup"><span data-stu-id="53a29-133">As with the Request packet, every EAP Response packet contains a Type field, which corresponds to the Type field of the Request.</span></span> <span data-ttu-id="53a29-134">Примеры включают в себя запросы на идентификацию и запросы запросов.</span><span class="sxs-lookup"><span data-stu-id="53a29-134">Examples include Identity Request and Challenge Request packets.</span></span>

         

-   <span data-ttu-id="53a29-135">В случае сбоя с EAPHost можно выполнить повторную проверку подлинности, открыв другой сеанс с EAPHost и указав то же удостоверение или новое удостоверение.</span><span class="sxs-lookup"><span data-stu-id="53a29-135">In the case of failure with EAPHost, re-authentication can be attempted by opening another session with EAPHost and providing either the same identity or a new identity.</span></span>

### <a name="leap-authenticator-method-implementation"></a><span data-ttu-id="53a29-136">Реализация метода средства проверки подлинности LEAP</span><span class="sxs-lookup"><span data-stu-id="53a29-136">LEAP Authenticator Method Implementation</span></span>

<span data-ttu-id="53a29-137">При разработке метода проверки подлинности LEAP необходимо убедиться в следующем:</span><span class="sxs-lookup"><span data-stu-id="53a29-137">When developing a LEAP authenticator method, please ensure the following:</span></span>

-   <span data-ttu-id="53a29-138">Методы проверки подлинности LEAP должны возвращать код действия [**\_ \_ \_ \_ отправки ответа метода проверки**](/windows/desktop/api/EapAuthenticatorActionDefine/ne-eapauthenticatoractiondefine-eap_method_authenticator_response_action) подлинности в ответ на первый этап аутентификации (одноранговая проверка подлинности).</span><span class="sxs-lookup"><span data-stu-id="53a29-138">LEAP authenticator methods must return the [**EAP\_METHOD\_AUTHENTICATOR\_RESPONSE\_SEND**](/windows/desktop/api/EapAuthenticatorActionDefine/ne-eapauthenticatoractiondefine-eap_method_authenticator_response_action) action code after the 1st phase of authentication (peer authentication) is successful.</span></span> <span data-ttu-id="53a29-139">Затем, когда вызывается [**еапмесодаусентикаторсендпаккет**](/previous-versions/windows/desktop/api/eapmethodauthenticatorapis/nf-eapmethodauthenticatorapis-eapmethodauthenticatorsendpacket) , он должен вернуть допустимый [**ЕАППАККЕТ**](/windows/win32/api/eapmethodtypes/ns-eapmethodtypes-eappacket) с кодом EAP [**еапкодесукцесс**](/windows/win32/api/eapmethodtypes/ne-eapmethodtypes-eapcode).</span><span class="sxs-lookup"><span data-stu-id="53a29-139">Then when [**EapMethodAuthenticatorSendPacket**](/previous-versions/windows/desktop/api/eapmethodauthenticatorapis/nf-eapmethodauthenticatorapis-eapmethodauthenticatorsendpacket) is called, it should return a valid [**EapPacket**](/windows/win32/api/eapmethodtypes/ns-eapmethodtypes-eappacket) with an EAP code of [**EapCodeSuccess**](/windows/win32/api/eapmethodtypes/ne-eapmethodtypes-eapcode).</span></span>
-   <span data-ttu-id="53a29-140">Методы проверки подлинности LEAP должны возвращать код действия [**\_ \_ \_ \_ результата ответа метода проверки**](/windows/desktop/api/EapAuthenticatorActionDefine/ne-eapauthenticatoractiondefine-eap_method_authenticator_response_action) подлинности EAP, если 1-й этап одноранговой проверки подлинности не выполнен.</span><span class="sxs-lookup"><span data-stu-id="53a29-140">LEAP authenticator methods should return the [**EAP\_METHOD\_AUTHENTICATOR\_RESPONSE\_RESULT**](/windows/desktop/api/EapAuthenticatorActionDefine/ne-eapauthenticatoractiondefine-eap_method_authenticator_response_action) action code if the 1st phase of peer authentication is unsuccessful.</span></span>
-   <span data-ttu-id="53a29-141">Методы проверки подлинности LEAP должны возвращать окончательный ответный пакет с кодом действия [**\_ \_ \_ \_ результата ответа метода EAP**](/windows/desktop/api/EapAuthenticatorActionDefine/ne-eapauthenticatoractiondefine-eap_method_authenticator_response_action) при вызове [**еапмесодаусентикаторсендпаккет**](/previous-versions/windows/desktop/api/eapmethodauthenticatorapis/nf-eapmethodauthenticatorapis-eapmethodauthenticatorsendpacket) .</span><span class="sxs-lookup"><span data-stu-id="53a29-141">LEAP authenticator methods must return the final authentication response packet with the [**EAP\_METHOD\_AUTHENTICATOR\_RESPONSE\_RESULT**](/windows/desktop/api/EapAuthenticatorActionDefine/ne-eapauthenticatoractiondefine-eap_method_authenticator_response_action) action code when [**EapMethodAuthenticatorSendPacket**](/previous-versions/windows/desktop/api/eapmethodauthenticatorapis/nf-eapmethodauthenticatorapis-eapmethodauthenticatorsendpacket) is called.</span></span> <span data-ttu-id="53a29-142">Затем в последующих вызовах [**еапмесодаусентикаторжетресулт**](/previous-versions/windows/desktop/api/eapmethodauthenticatorapis/nf-eapmethodauthenticatorapis-eapmethodauthenticatorgetresult) для обнаружения сеанса с проверкой подлинности должен возвращаться **\_ \_ обработчик сеанса EAP** .</span><span class="sxs-lookup"><span data-stu-id="53a29-142">Then in subsequent calls to [**EapMethodAuthenticatorGetResult**](/previous-versions/windows/desktop/api/eapmethodauthenticatorapis/nf-eapmethodauthenticatorapis-eapmethodauthenticatorgetresult) the **EAP\_SESSION\_HANDLE** must be returned to identify the authenticated session.</span></span>
-   

### <a name="leap-peer-method-implementation"></a><span data-ttu-id="53a29-143">Реализация однорангового метода LEAP</span><span class="sxs-lookup"><span data-stu-id="53a29-143">LEAP Peer Method Implementation</span></span>

<span data-ttu-id="53a29-144">При разработке метода LEAP убедитесь в следующем.</span><span class="sxs-lookup"><span data-stu-id="53a29-144">When developing a LEAP peer method, please ensure the following</span></span>

-   <span data-ttu-id="53a29-145">Методы однорангового узла LEAP должны возвращать код действия [**еаппирмесодреспонсеактионсенд**](/windows/win32/api/eapauthenticatoractiondefine/ne-eapauthenticatoractiondefine-eappeermethodresponseaction) после успешного завершения первого этапа проверки подлинности (одноранговая проверка подлинности).</span><span class="sxs-lookup"><span data-stu-id="53a29-145">LEAP peer methods should return the [**EapPeerMethodResponseActionSend**](/windows/win32/api/eapauthenticatoractiondefine/ne-eapauthenticatoractiondefine-eappeermethodresponseaction) action code after the 1st phase of authentication (peer authentication) is successful.</span></span>
-   <span data-ttu-id="53a29-146">Методы однорангового узла LEAP должны возвращать код действия [**еаппирмесодреспонсеактионресулт**](/windows/win32/api/eapauthenticatoractiondefine/ne-eapauthenticatoractiondefine-eappeermethodresponseaction) после успешного выполнения второго этапа проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="53a29-146">LEAP peer methods should return the [**EapPeerMethodResponseActionResult**](/windows/win32/api/eapauthenticatoractiondefine/ne-eapauthenticatoractiondefine-eappeermethodresponseaction) action code after the 2nd phase of authentication is successful.</span></span>

## <a name="related-topics"></a><span data-ttu-id="53a29-147">См. также</span><span class="sxs-lookup"><span data-stu-id="53a29-147">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="53a29-148">Последовательность вызовов EAPHost</span><span class="sxs-lookup"><span data-stu-id="53a29-148">EAPHost Call Sequence</span></span>](about-eaphost-call-sequences.md)
</dt> <dt>

[<span data-ttu-id="53a29-149">Использование EAPHost</span><span class="sxs-lookup"><span data-stu-id="53a29-149">Using EAPHost</span></span>](using-eap-host.md)
</dt> </dl>

 

 




