---
title: Таблицы сочетаний клавиш
description: Таблицы сочетаний клавиш
ms.assetid: 4F2CFD7C-90D3-4C3F-9A42-05B915914EF6
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2951ee99a31a977e0909de5639fa3110cea10e0b
ms.sourcegitcommit: 95685061d5b0333bbf9e6ebd208dde8190f97005
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2021
ms.locfileid: "108090822"
---
# <a name="accelerator-tables"></a>Таблицы сочетаний клавиш

Приложения часто определяют сочетания клавиш, например CTRL + O для команды File Open. Можно реализовать сочетания клавиш, обрабатывая отдельные сообщения [**WM \_ KeyDown**](/windows/desktop/inputdev/wm-keydown) , но таблицы ускорителей обеспечивают лучшее решение, которое:

-   Требует меньше кода.
-   Объединяет все сочетания клавиш в один файл данных.
-   Поддерживает локализацию на другие языки.
-   Позволяет сочетаниям клавиш и команд меню использовать одну и ту же логику приложения.

*Таблица сочетаний клавиш* — это ресурс данных, который сопоставляет сочетания клавиш, такие как CTRL + O, с командами приложения. Прежде чем мы увидим, как использовать таблицу сочетаний клавиш, нам потребуются краткие сведения о ресурсах. *Ресурс* — это большой двоичный объект данных, встроенный в двоичный файл приложения (exe или DLL). Ресурсы хранят данные, необходимые для приложения, такие как меню, курсоры, значки, изображения, текстовые строки или любые пользовательские данные приложения. Приложение загружает данные ресурсов из двоичного файла во время выполнения. Чтобы включить ресурсы в двоичный файл, выполните следующие действия.

1.  Создайте файл определения ресурса (RC). Этот файл определяет типы ресурсов и их идентификаторов. Файл определения ресурсов может содержать ссылки на другие файлы. Например, ресурс значка объявляется в RC-файле, но изображение значка хранится в отдельном файле.
2.  Используйте компилятор ресурсов Microsoft Windows (RC) для компиляции файла определения ресурса в скомпилированный файл ресурсов (с расширением RES). Компилятор RC поставляется с Visual Studio, а также с Windows SDK.
3.  Свяжите скомпилированный файл ресурсов с двоичным файлом.

Эти шаги примерно эквивалентны процессу компиляции и компоновки файлов кода. Visual Studio предоставляет набор редакторов ресурсов, которые упрощают создание и изменение ресурсов. (Эти средства недоступны в выпусках Visual Studio Express.) Но RC-файл — это просто текстовый файл, а синтаксис описан на сайте MSDN, поэтому можно создать RC-файл в любом текстовом редакторе. Дополнительные сведения см. в разделе [о файлах ресурсов](/windows/desktop/menurc/about-resource-files).

## <a name="defining-an-accelerator-table"></a>Определение таблицы сочетаний клавиш

Таблица сочетаний клавиш — это таблица сочетаний клавиш. Каждое сочетание клавиш определяется следующим образом:

-   Числовой идентификатор. Этот номер идентифицирует команду приложения, которая будет вызываться ярлыком.
-   Символ ASCII или код виртуального ключа ярлыка.
-   Необязательные клавиши модификатора: ALT, SHIFT или CTRL.

Сама таблица сочетаний клавиш имеет числовой идентификатор, который определяет таблицу в списке ресурсов приложения. Давайте создадим таблицу сочетаний клавиш для простой программы рисования. Эта программа будет иметь два режима, режим рисования и режим выбора. В режиме рисования пользователь может рисовать фигуры. В режиме выбора пользователь может выбрать фигуры. Для этой программы мы хотим определить следующие сочетания клавиш.



| Сочетание клавиш | Команда                   |
|----------|---------------------------|
| CTRL+M   | Переключение между режимами.     |
| F1       | Переключиться в режим рисования.      |
| F2       | Переключиться в режим выбора. |



 

Сначала определите числовые идентификаторы для таблицы и для команд приложения. Эти значения являются произвольными. Для идентификаторов можно назначить символьные константы, определив их в файле заголовка. Пример:


```C++
#define IDR_ACCEL1                      101
#define ID_TOGGLE_MODE                40002
#define ID_DRAW_MODE                  40003
#define ID_SELECT_MODE                40004
```



В этом примере значение `IDR_ACCEL1` идентифицирует таблицу сочетаний клавиш, а следующие три константы определяют команды приложения. По соглашению файл заголовка, определяющий константы ресурсов, часто называется Resource. h. В следующем листинге показан файл определения ресурса.


```C++
#include "resource.h"

IDR_ACCEL1 ACCELERATORS
{
    0x4D,   ID_TOGGLE_MODE, VIRTKEY, CONTROL    // ctrl-M
    0x70,   ID_DRAW_MODE, VIRTKEY               // F1
    0x71,   ID_SELECT_MODE, VIRTKEY             // F2
}
```



Сочетания клавиш определяются в фигурных скобках. Каждый ярлык содержит следующие записи.

-   Код виртуального ключа или символ ASCII, который вызывает ярлык.
-   Команда приложения. Обратите внимание, что в примере используются символьные константы. Файл определения ресурса включает Resource. h, где определены эти константы.
-   Ключевое слово **VIRTKEY** означает, что первая запись является кодом виртуального ключа. Другой вариант — использовать символы ASCII.
-   Необязательные модификаторы: ALT, CONTROL или SHIFT.

Если для ярлыков используются символы ASCII, то символ нижнего регистра будет отличаться от сочетания символов в верхнем регистре. (Например, ввод "a" может вызвать другую команду, чем ввод "A".) Это может запутать пользователей, поэтому для сочетаний клавиш лучше использовать коды виртуальных клавиш, а не символы ASCII.

## <a name="loading-the-accelerator-table"></a>Загрузка таблицы сочетаний клавиш

Ресурс для таблицы сочетаний клавиш должен быть загружен, прежде чем программа сможет ее использовать. Чтобы загрузить таблицу сочетаний клавиш, вызовите функцию [**лоадакцелераторс**](/windows/desktop/api/winuser/nf-winuser-loadacceleratorsa) .


```C++
    HACCEL hAccel = LoadAccelerators(hInstance, MAKEINTRESOURCE(IDR_ACCEL1));
```



Вызовите эту функцию перед входом в цикл обработки сообщений. Первый параметр — это обработчик для модуля. (Этот параметр передается функции [**WinMain**](/windows/desktop/api/winbase/nf-winbase-winmain) . Дополнительные сведения см. [в разделе WinMain: точка входа приложения](winmain--the-application-entry-point.md). Вторым параметром является идентификатор ресурса. Функция возвращает маркер ресурса. Помните, что handle является непрозрачным типом, который ссылается на объект, управляемый системой. Если функция завершается ошибкой, возвращается **значение NULL**.

Вы можете освободить таблицу сочетаний клавиш, вызвав [**дестройакцелератортабле**](/windows/desktop/api/winuser/nf-winuser-destroyacceleratortable). Однако система автоматически освобождает таблицу при выходе из программы, поэтому эту функцию нужно вызывать только при замене одной таблицы другой. В разделе, посвященном [созданию редактируемых пользователем ускорителей](/windows/desktop/menurc/using-keyboard-accelerators), есть интересный пример.

## <a name="translating-key-strokes-into-commands"></a>Преобразование ключевых штрихов в команды

Таблица сочетаний клавиш работает путем преобразования ключевых штрихов в сообщения [**\_ командной строки WM**](/windows/desktop/menurc/wm-command) . Параметр *wParam* **\_ команды WM** содержит числовой идентификатор команды. Например, при использовании приведенной выше таблицы сочетание клавиш CTRL + M преобразуется в сообщение **\_ команды WM** со значением `ID_TOGGLE_MODE` . Чтобы это произошло, измените цикл обработки сообщений следующим образом:


```C++
    MSG msg;
    while (GetMessage(&msg, NULL, 0, 0))
    {
        if (!TranslateAccelerator(win.Window(), hAccel, &msg))
        {
            TranslateMessage(&msg);
            DispatchMessage(&msg);
        }
    }
```



Этот код добавляет вызов функции [**TranslateAccelerator**](/windows/desktop/api/winuser/nf-winuser-translateacceleratora) в цикле обработки сообщений. Функция **TranslateAccelerator** проверяет каждое сообщение окна, выполняя поиск сообщений о ключах. Если пользователь нажимает одну из сочетаний клавиш, перечисленных в таблице сочетаний клавиш, **TranslateAccelerator** отправляет [**\_ командное сообщение WM**](/windows/desktop/menurc/wm-command) в окно. Функция отправляет **\_ команду WM** , напрямую вызывая процедуру окна. Когда **TranslateAccelerator** успешно переводит нажатие клавиши, функция возвращает ненулевое значение, что означает, что следует пропустить нормальную обработку сообщения. В противном случае **TranslateAccelerator** возвращает ноль. В этом случае передайте сообщение окна в [**TranslateMessage**](/windows/desktop/api/winuser/nf-winuser-translatemessage) и [**DispatchMessage**](/windows/desktop/api/winuser/nf-winuser-dispatchmessage)в нормальном режиме.

Вот как программа рисования может работать с [**\_ командным**](/windows/desktop/menurc/wm-command) сообщением WM:


```C++
    case WM_COMMAND:
        switch (LOWORD(wParam))
        {
        case ID_DRAW_MODE:
            SetMode(DrawMode);
            break;

        case ID_SELECT_MODE:
            SetMode(SelectMode);
            break;

        case ID_TOGGLE_MODE:
            if (mode == DrawMode)
            {
                SetMode(SelectMode);
            }
            else
            {
                SetMode(DrawMode);
            }
            break;
        }
        return 0;

```



В этом коде предполагается, что `SetMode` — это функция, определенная приложением для переключения между двумя режимами. Сведения о том, как можно было бы справиться с выполнением команды, зависят от программы.

## <a name="next"></a>Следующая

[Установка изображения курсора](setting-the-cursor-image.md)

 

 
