---
description: Служба (или любой процесс, выполняющийся в другом контексте безопасности), который должен получить доступ к удаленному ресурсу, должен использовать имя UNC для доступа к ресурсу.
ms.assetid: 2582259d-077c-4089-9a87-1a377994f0bd
title: Службы и перенаправленные диски
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a3b1435e69ded3bf13a0869a0b9ad2b90bb4682c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103999388"
---
# <a name="services-and-redirected-drives"></a><span data-ttu-id="397b5-103">Службы и перенаправленные диски</span><span class="sxs-lookup"><span data-stu-id="397b5-103">Services and Redirected Drives</span></span>

<span data-ttu-id="397b5-104">Служба (или любой процесс, выполняющийся в другом контексте безопасности), который должен получить доступ к удаленному ресурсу, должен использовать имя UNC для доступа к ресурсу.</span><span class="sxs-lookup"><span data-stu-id="397b5-104">A service (or any process running in a different security context) that must access a remote resource should use the Universal Naming Convention (UNC) name to access the resource.</span></span> <span data-ttu-id="397b5-105">Служба должна иметь соответствующие привилегии для доступа к ресурсу.</span><span class="sxs-lookup"><span data-stu-id="397b5-105">The service must have appropriate privileges to access the resource.</span></span> <span data-ttu-id="397b5-106">Если служба на стороне сервера использует RPC-подключение, на удаленном сервере должно быть включено делегирование.</span><span class="sxs-lookup"><span data-stu-id="397b5-106">If a server-side service uses an RPC connection, delegation must be enabled on the remote server.</span></span>

<span data-ttu-id="397b5-107">Буквы дисков не являются глобальными для системы.</span><span class="sxs-lookup"><span data-stu-id="397b5-107">Drive letters are not global to the system.</span></span> <span data-ttu-id="397b5-108">Каждый сеанс входа в систему получает собственный набор букв диска от A до Z. Таким образом, перенаправляемые диски не могут совместно использоваться процессами под разными учетными записями пользователей.</span><span class="sxs-lookup"><span data-stu-id="397b5-108">Each logon session receives its own set of drive letters from A to Z. Therefore, redirected drives cannot be shared between processes running under different user accounts.</span></span> <span data-ttu-id="397b5-109">Более того, служба (или любой процесс, работающий в собственном сеансе) не может получить доступ к буквам дисков, которые были установлены в другом сеансе входа в систему.</span><span class="sxs-lookup"><span data-stu-id="397b5-109">Moreover, a service (or any process running within its own logon session) cannot access the drive letters that were established within a different logon session.</span></span>

<span data-ttu-id="397b5-110">Служба не должна напрямую обращаться к локальным или сетевым ресурсам через подключенные буквы дисков, а также не должна вызывать команду **net use** для сопоставления букв диска во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="397b5-110">A service should not directly access local or network resources through mapped drive letters, nor should it call the **net use** command to map drive letters at run time.</span></span> <span data-ttu-id="397b5-111">Команда **net use** не рекомендуется по нескольким причинам:</span><span class="sxs-lookup"><span data-stu-id="397b5-111">The **net use** command is not recommended for several reasons:</span></span>

-   <span data-ttu-id="397b5-112">Сопоставления дисков существуют во всех контекстах входа, поэтому если приложение выполняется в контексте [учетной записи LocalService](localservice-account.md), то любая другая служба, работающая в этом контексте, может иметь доступ к подключенному диску.</span><span class="sxs-lookup"><span data-stu-id="397b5-112">Drive mappings exist across logon contexts, so if an application is running in the context of the [LocalService account](localservice-account.md), then any other service running in that context may have access to the mapped drive.</span></span>
-   <span data-ttu-id="397b5-113">Если служба предоставляет явные учетные данные для команды **net use** , эти учетные данные могут быть случайно предоставлены за пределами границ службы.</span><span class="sxs-lookup"><span data-stu-id="397b5-113">If the service provides explicit credentials to a **net use** command, those credentials might be inadvertently shared outside of the service boundaries.</span></span> <span data-ttu-id="397b5-114">Вместо этого служба должна использовать [олицетворение клиента](/windows/desktop/SecAuthZ/client-impersonation) для олицетворения пользователя.</span><span class="sxs-lookup"><span data-stu-id="397b5-114">Instead, the service should use [client impersonation](/windows/desktop/SecAuthZ/client-impersonation) to impersonate the user.</span></span>
-   <span data-ttu-id="397b5-115">Несколько служб, работающих в одном контексте, могут помешать друг другу.</span><span class="sxs-lookup"><span data-stu-id="397b5-115">Multiple services running in the same context may interfere with each other.</span></span> <span data-ttu-id="397b5-116">Если обе службы выполняют явное **Использование net use** и одновременно предоставляют одни и те же учетные данные, одна служба завершится ошибкой с "уже подключенным".</span><span class="sxs-lookup"><span data-stu-id="397b5-116">If both services perform an explicit **net use** and provide the same credentials at the same time, one service will fail with an "already connected" error.</span></span>

<span data-ttu-id="397b5-117">Кроме того, служба не должна использовать [сетевые функции Windows](/windows/desktop/WNet/windows-networking-functions) для управления буквами подключенных дисков.</span><span class="sxs-lookup"><span data-stu-id="397b5-117">Additionally, a service should not use the [Windows Networking Functions](/windows/desktop/WNet/windows-networking-functions) to manage mapped drive letters.</span></span> <span data-ttu-id="397b5-118">Хотя функции Внет могут успешно возвращаться, результирующее поведение не так преднамеренно.</span><span class="sxs-lookup"><span data-stu-id="397b5-118">Although the WNet functions may return successfully, the resulting behavior is not as intended.</span></span> <span data-ttu-id="397b5-119">Когда система устанавливает перенаправленный диск, она хранится отдельно для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="397b5-119">When the system establishes a redirected drive, it is stored on a per-user basis.</span></span> <span data-ttu-id="397b5-120">Только пользователь может управлять перенаправленным диском.</span><span class="sxs-lookup"><span data-stu-id="397b5-120">Only the user is able to manage the redirected drive.</span></span> <span data-ttu-id="397b5-121">Система отслеживает перенаправляемые диски на основе идентификатора безопасности входа пользователя (SID).</span><span class="sxs-lookup"><span data-stu-id="397b5-121">The system keeps track of redirected drives based on the user's logon security identifier (SID).</span></span> <span data-ttu-id="397b5-122">Идентификатор безопасности входа — это уникальный идентификатор для сеанса входа пользователя.</span><span class="sxs-lookup"><span data-stu-id="397b5-122">The logon SID is a unique identifier for the user's logon session.</span></span> <span data-ttu-id="397b5-123">Один пользователь может иметь несколько одновременных сеансов входа в систему.</span><span class="sxs-lookup"><span data-stu-id="397b5-123">A single user can have multiple, simultaneous logon sessions on the system.</span></span>

<span data-ttu-id="397b5-124">Если служба настроена для работы под учетной записью пользователя, система всегда создает новый сеанс входа для пользователя и запускает службу в этом новом сеансе входа.</span><span class="sxs-lookup"><span data-stu-id="397b5-124">If a service is configured to run under a user account, the system always creates a new logon session for the user and starts the service in that new logon session.</span></span> <span data-ttu-id="397b5-125">Таким образом, служба не может управлять сопоставлениями дисков, установленными в других сеансах пользователя.</span><span class="sxs-lookup"><span data-stu-id="397b5-125">Therefore, a service cannot manage the drive mappings established within the user's other sessions.</span></span>

<span data-ttu-id="397b5-126">**Windows Server 2003:** На компьютере с несколькими сетевыми интерфейсами (т. е. многосетевым компьютером) задержка до 60 секунд может возникнуть при использовании UNC-путей для доступа к файлам, хранящимся на удаленном сервере SMB.</span><span class="sxs-lookup"><span data-stu-id="397b5-126">**Windows Server 2003:** On a computer that has multiple network interfaces (that is, a multihomed computer), delays up to 60 seconds may occur when using UNC paths to access files that are stored on a remote server message block (SMB) server.</span></span> <span data-ttu-id="397b5-127">Дополнительные сведения см. в [статье 890553](https://support.microsoft.com/kb/890553) базы знаний справки и поддержки.</span><span class="sxs-lookup"><span data-stu-id="397b5-127">For more information, see [article 890553](https://support.microsoft.com/kb/890553) in the Help and Support Knowledge Base.</span></span>

 

 
