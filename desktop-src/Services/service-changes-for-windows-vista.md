---
description: Для повышения производительности, надежности, безопасности, управления и администрирования служб были внесены значительные изменения в модель служб.
ms.assetid: b1c09468-51e1-4ffd-bf07-6faa9f9336dd
title: Изменения служб для Windows Vista
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e6ba96cc0c69e2bda4e19e7d093098c578e31c4b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103897154"
---
# <a name="service-changes-for-windows-vista"></a>Изменения служб для Windows Vista

Для повышения производительности, надежности, безопасности, управления и администрирования служб были внесены значительные изменения в модель служб.

В следующей таблице перечислены улучшения служб для Windows Vista.



| Расширение                                                                                                                                                                                                  | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="Delayed_Auto-Start"></span><span id="delayed_auto-start"></span><span id="DELAYED_AUTO-START"></span>Отложенный автоматический запуск<br/>                                                                 | Службы с отложенным автозапуском запускаются вскоре после запуска системы. Это повышает производительность при запуске системы и по-прежнему обеспечивает автоматический запуск этих служб. Чтобы установить флаг отложенного автоматического запуска, вызовите функцию [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) с **\_ \_ отложенным \_ \_ автозапуском \_ конфигурации службы**.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| <span id="Failure_Detection_and_Recovery"></span><span id="failure_detection_and_recovery"></span><span id="FAILURE_DETECTION_AND_RECOVERY"></span>Обнаружение и восстановление сбоев<br/>                 | В случае сбоя службы диспетчер управления службами (SCM) может выполнить действие сбоя, например перезапустить службу при попытке восстановления после сбоя. Чтобы настроить действие при сбое, вызовите [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) с **\_ \_ \_ действиями сбоя конфигурации службы**.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| <span id="Preshutdown_Notifications"></span><span id="preshutdown_notifications"></span><span id="PRESHUTDOWN_NOTIFICATIONS"></span>Уведомления о предзавершении работы<br/>                                     | Служба может зарегистрироваться для получения уведомления о предварительном **\_ \_ завершении управления службой** в своей функции [*хандлерекс*](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex) перед получением фактического уведомления о завершении работы. Это обеспечивает более длительное завершение работы служб с продолжительной процедурой завершения работы. Чтобы задать значение времени ожидания, вызовите [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) со **\_ \_ \_ сведениями о предварительном завершении настройки службы**.<br/>                                                                                                                                                                                                                                                                                                                                                                                                      |
| <span id="Restricted_Network_Access"></span><span id="restricted_network_access"></span><span id="RESTRICTED_NETWORK_ACCESS"></span>Ограниченный доступ к сети<br/>                                     | Идентификаторы безопасности службы можно использовать для ограничения доступа к портам, протоколам или направлению сетевого трафика. Чтобы ограничить доступ службы к сети, используйте интерфейс [**инетфвсервицерестриктион**](/windows/desktop/api/netfw/nn-netfw-inetfwservicerestriction) .<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span id="Running_with_Least_Privilege"></span><span id="running_with_least_privilege"></span><span id="RUNNING_WITH_LEAST_PRIVILEGE"></span>Запуск с минимальными привилегиями<br/>                         | Службы могут работать под любой учетной записью, содержащей необходимые привилегии (LocalService, NetworkService, LocalSystem, учетная запись домена или локальная учетная запись), и указывать необходимые привилегии путем вызова [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) с указанием **\_ \_ необходимых \_ привилегий \_ для настройки службы**. SCM удаляет все ненужные привилегии.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| <span id="Service_Isolation"></span><span id="service_isolation"></span><span id="SERVICE_ISOLATION"></span>Изоляция служб<br/>                                                                     | Служба может изолировать объекты, такие как файлы или ключи реестра, для его монопольного использования, защищая их с помощью записи управления доступом, содержащей идентификатор безопасности службы. После назначения этого идентификатора безопасности службе владелец службы может изменить списки управления доступом объектов, чтобы предоставить доступ к идентификатору безопасности. Это позволяет службе получать доступ к конкретным объектам, не запускаясь с учетной записью с высоким уровнем привилегий или снижая безопасность объектов. Чтобы задать идентификатор безопасности службы, вызовите [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) с **\_ \_ \_ ИД безопасности службы \_ конфигурации службы**.<br/>                                                                                                                                                                                                                                     |
| <span id="Service_State_Change_Notifications"></span><span id="service_state_change_notifications"></span><span id="SERVICE_STATE_CHANGE_NOTIFICATIONS"></span>Уведомления об изменении состояния службы<br/> | Службы могут регистрироваться, чтобы получать уведомления при создании, удалении или изменении состояния службы с помощью функции [**NotifyServiceStatusChange**](/windows/desktop/api/Winsvc/nf-winsvc-notifyservicestatuschangea) . Это более эффективно, чем вызов функции [**куерисервицестатусекс**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicestatusex) в цикле для опроса состояния.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span id="Session_0_Isolation"></span><span id="session_0_isolation"></span><span id="SESSION_0_ISOLATION"></span>Изоляция сеанса 0<br/>                                                             | Службы всегда запускаются в сеансе 0. До выхода Windows Vista первый пользователь, который входит в систему, также был назначен сеансу 0. Теперь сеанс 0 зарезервирован исключительно для служб и других приложений, не связанных с интерактивным сеансом пользователя. (Первый пользователь, который должен войти в систему, подключен к сеансу 1, второй пользователь, который входит в систему, подключен к сеансу 2 и т. д.) Сеанс 0 не поддерживает процессы, взаимодействующие с пользователем.<br/> Это изменение означает, что служба не может публиковать или отправлять сообщения в приложение, а приложение не может отправлять или публиковать сообщения в службе. Кроме того, службы не могут отображать элемент пользовательского интерфейса, например диалоговое окно, напрямую. Служба может использовать функцию [**втссендмессаже**](/windows/desktop/api/wtsapi32/nf-wtsapi32-wtssendmessagea) для вывода диалогового окна в другом сеансе.<br/> |



 

## <a name="related-topics"></a>См. также

<dl> <dt>

[Службы](services.md)
</dt> </dl>

 

