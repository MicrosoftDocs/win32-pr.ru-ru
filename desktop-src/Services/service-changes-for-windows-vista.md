---
description: Для повышения производительности, надежности, безопасности, управления и администрирования служб были внесены значительные изменения в модель служб.
ms.assetid: b1c09468-51e1-4ffd-bf07-6faa9f9336dd
title: Изменения служб для Windows Vista
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e6ba96cc0c69e2bda4e19e7d093098c578e31c4b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103897154"
---
# <a name="service-changes-for-windows-vista"></a><span data-ttu-id="83d46-103">Изменения служб для Windows Vista</span><span class="sxs-lookup"><span data-stu-id="83d46-103">Service Changes for Windows Vista</span></span>

<span data-ttu-id="83d46-104">Для повышения производительности, надежности, безопасности, управления и администрирования служб были внесены значительные изменения в модель служб.</span><span class="sxs-lookup"><span data-stu-id="83d46-104">There have been significant changes to the services model to improve performance, reliability, security, management, and administration of services.</span></span>

<span data-ttu-id="83d46-105">В следующей таблице перечислены улучшения служб для Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="83d46-105">The following table summarizes the enhancements to services for Windows Vista.</span></span>



| <span data-ttu-id="83d46-106">Расширение</span><span class="sxs-lookup"><span data-stu-id="83d46-106">Enhancement</span></span>                                                                                                                                                                                                  | <span data-ttu-id="83d46-107">Описание</span><span class="sxs-lookup"><span data-stu-id="83d46-107">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="83d46-108"><span id="Delayed_Auto-Start"></span><span id="delayed_auto-start"></span><span id="DELAYED_AUTO-START"></span>Отложенный автоматический запуск</span><span class="sxs-lookup"><span data-stu-id="83d46-108"><span id="Delayed_Auto-Start"></span><span id="delayed_auto-start"></span><span id="DELAYED_AUTO-START"></span>Delayed Auto-Start</span></span><br/>                                                                 | <span data-ttu-id="83d46-109">Службы с отложенным автозапуском запускаются вскоре после запуска системы.</span><span class="sxs-lookup"><span data-stu-id="83d46-109">Delayed auto-start services are started shortly after the system has started.</span></span> <span data-ttu-id="83d46-110">Это повышает производительность при запуске системы и по-прежнему обеспечивает автоматический запуск этих служб.</span><span class="sxs-lookup"><span data-stu-id="83d46-110">This improves system startup performance while still providing automatic startup for these services.</span></span> <span data-ttu-id="83d46-111">Чтобы установить флаг отложенного автоматического запуска, вызовите функцию [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) с **\_ \_ отложенным \_ \_ автозапуском \_ конфигурации службы**.</span><span class="sxs-lookup"><span data-stu-id="83d46-111">To set the delayed auto-start flag, call the [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) function with **SERVICE\_CONFIG\_DELAYED\_AUTO\_START\_INFO**.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| <span data-ttu-id="83d46-112"><span id="Failure_Detection_and_Recovery"></span><span id="failure_detection_and_recovery"></span><span id="FAILURE_DETECTION_AND_RECOVERY"></span>Обнаружение и восстановление сбоев</span><span class="sxs-lookup"><span data-stu-id="83d46-112"><span id="Failure_Detection_and_Recovery"></span><span id="failure_detection_and_recovery"></span><span id="FAILURE_DETECTION_AND_RECOVERY"></span>Failure Detection and Recovery</span></span><br/>                 | <span data-ttu-id="83d46-113">В случае сбоя службы диспетчер управления службами (SCM) может выполнить действие сбоя, например перезапустить службу при попытке восстановления после сбоя.</span><span class="sxs-lookup"><span data-stu-id="83d46-113">If a service fails, the service control manager (SCM) can perform a failure action, such as restarting the service in an attempt to recover from that failure.</span></span> <span data-ttu-id="83d46-114">Чтобы настроить действие при сбое, вызовите [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) с **\_ \_ \_ действиями сбоя конфигурации службы**.</span><span class="sxs-lookup"><span data-stu-id="83d46-114">To configure a failure action, call [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) with **SERVICE\_CONFIG\_FAILURE\_ACTIONS**.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| <span data-ttu-id="83d46-115"><span id="Preshutdown_Notifications"></span><span id="preshutdown_notifications"></span><span id="PRESHUTDOWN_NOTIFICATIONS"></span>Уведомления о предзавершении работы</span><span class="sxs-lookup"><span data-stu-id="83d46-115"><span id="Preshutdown_Notifications"></span><span id="preshutdown_notifications"></span><span id="PRESHUTDOWN_NOTIFICATIONS"></span>Preshutdown Notifications</span></span><br/>                                     | <span data-ttu-id="83d46-116">Служба может зарегистрироваться для получения уведомления о предварительном **\_ \_ завершении управления службой** в своей функции [*хандлерекс*](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex) перед получением фактического уведомления о завершении работы.</span><span class="sxs-lookup"><span data-stu-id="83d46-116">A service can register to receive a **SERVICE\_CONTROL\_PRESHUTDOWN** notification in its [*HandlerEx*](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex) function before it receives the actual shutdown notification.</span></span> <span data-ttu-id="83d46-117">Это обеспечивает более длительное завершение работы служб с продолжительной процедурой завершения работы.</span><span class="sxs-lookup"><span data-stu-id="83d46-117">This provides services with a lengthy shutdown procedure more time to shut down gracefully.</span></span> <span data-ttu-id="83d46-118">Чтобы задать значение времени ожидания, вызовите [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) со **\_ \_ \_ сведениями о предварительном завершении настройки службы**.</span><span class="sxs-lookup"><span data-stu-id="83d46-118">To set the time-out value, call [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) with **SERVICE\_CONFIG\_PRESHUTDOWN\_INFO**.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                      |
| <span data-ttu-id="83d46-119"><span id="Restricted_Network_Access"></span><span id="restricted_network_access"></span><span id="RESTRICTED_NETWORK_ACCESS"></span>Ограниченный доступ к сети</span><span class="sxs-lookup"><span data-stu-id="83d46-119"><span id="Restricted_Network_Access"></span><span id="restricted_network_access"></span><span id="RESTRICTED_NETWORK_ACCESS"></span>Restricted Network Access</span></span><br/>                                     | <span data-ttu-id="83d46-120">Идентификаторы безопасности службы можно использовать для ограничения доступа к портам, протоколам или направлению сетевого трафика.</span><span class="sxs-lookup"><span data-stu-id="83d46-120">You can use service SIDs to restrict access to ports, protocols, or the direction of network traffic.</span></span> <span data-ttu-id="83d46-121">Чтобы ограничить доступ службы к сети, используйте интерфейс [**инетфвсервицерестриктион**](/windows/desktop/api/netfw/nn-netfw-inetfwservicerestriction) .</span><span class="sxs-lookup"><span data-stu-id="83d46-121">To restrict a service's access to the network, use the [**INetFwServiceRestriction**](/windows/desktop/api/netfw/nn-netfw-inetfwservicerestriction) interface.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span data-ttu-id="83d46-122"><span id="Running_with_Least_Privilege"></span><span id="running_with_least_privilege"></span><span id="RUNNING_WITH_LEAST_PRIVILEGE"></span>Запуск с минимальными привилегиями</span><span class="sxs-lookup"><span data-stu-id="83d46-122"><span id="Running_with_Least_Privilege"></span><span id="running_with_least_privilege"></span><span id="RUNNING_WITH_LEAST_PRIVILEGE"></span>Running with Least Privilege</span></span><br/>                         | <span data-ttu-id="83d46-123">Службы могут работать под любой учетной записью, содержащей необходимые привилегии (LocalService, NetworkService, LocalSystem, учетная запись домена или локальная учетная запись), и указывать необходимые привилегии путем вызова [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) с указанием **\_ \_ необходимых \_ привилегий \_ для настройки службы**.</span><span class="sxs-lookup"><span data-stu-id="83d46-123">Services can run under any account that contains the required privileges (LocalService, NetworkService, LocalSystem, a domain account, or a local account) and indicate the required privileges by calling [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) with **SERVICE\_CONFIG\_REQUIRED\_PRIVILEGES\_INFO**.</span></span> <span data-ttu-id="83d46-124">SCM удаляет все ненужные привилегии.</span><span class="sxs-lookup"><span data-stu-id="83d46-124">The SCM removes any privileges that are not required.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| <span data-ttu-id="83d46-125"><span id="Service_Isolation"></span><span id="service_isolation"></span><span id="SERVICE_ISOLATION"></span>Изоляция служб</span><span class="sxs-lookup"><span data-stu-id="83d46-125"><span id="Service_Isolation"></span><span id="service_isolation"></span><span id="SERVICE_ISOLATION"></span>Service Isolation</span></span><br/>                                                                     | <span data-ttu-id="83d46-126">Служба может изолировать объекты, такие как файлы или ключи реестра, для его монопольного использования, защищая их с помощью записи управления доступом, содержащей идентификатор безопасности службы.</span><span class="sxs-lookup"><span data-stu-id="83d46-126">A service can isolate objects, such as files or registry keys, for its exclusive use by securing them with an access control entry that contains a service SID.</span></span> <span data-ttu-id="83d46-127">После назначения этого идентификатора безопасности службе владелец службы может изменить списки управления доступом объектов, чтобы предоставить доступ к идентификатору безопасности.</span><span class="sxs-lookup"><span data-stu-id="83d46-127">After this SID has been assigned to a service, the service owner can modify the objects' access control lists to grant access to the SID.</span></span> <span data-ttu-id="83d46-128">Это позволяет службе получать доступ к конкретным объектам, не запускаясь с учетной записью с высоким уровнем привилегий или снижая безопасность объектов.</span><span class="sxs-lookup"><span data-stu-id="83d46-128">This enables a service to access specific objects without running under a high-privilege account or lowering the security on the objects.</span></span> <span data-ttu-id="83d46-129">Чтобы задать идентификатор безопасности службы, вызовите [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) с **\_ \_ \_ ИД безопасности службы \_ конфигурации службы**.</span><span class="sxs-lookup"><span data-stu-id="83d46-129">To set the service SID, call [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) with **SERVICE\_CONFIG\_SERVICE\_SID\_INFO**.</span></span><br/>                                                                                                                                                                                                                                     |
| <span data-ttu-id="83d46-130"><span id="Service_State_Change_Notifications"></span><span id="service_state_change_notifications"></span><span id="SERVICE_STATE_CHANGE_NOTIFICATIONS"></span>Уведомления об изменении состояния службы</span><span class="sxs-lookup"><span data-stu-id="83d46-130"><span id="Service_State_Change_Notifications"></span><span id="service_state_change_notifications"></span><span id="SERVICE_STATE_CHANGE_NOTIFICATIONS"></span>Service State Change Notifications</span></span><br/> | <span data-ttu-id="83d46-131">Службы могут регистрироваться, чтобы получать уведомления при создании, удалении или изменении состояния службы с помощью функции [**NotifyServiceStatusChange**](/windows/desktop/api/Winsvc/nf-winsvc-notifyservicestatuschangea) .</span><span class="sxs-lookup"><span data-stu-id="83d46-131">Services can register to be notified when a service is created, deleted, or has a change in status by using the [**NotifyServiceStatusChange**](/windows/desktop/api/Winsvc/nf-winsvc-notifyservicestatuschangea) function.</span></span> <span data-ttu-id="83d46-132">Это более эффективно, чем вызов функции [**куерисервицестатусекс**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicestatusex) в цикле для опроса состояния.</span><span class="sxs-lookup"><span data-stu-id="83d46-132">This is more efficient than calling the [**QueryServiceStatusEx**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicestatusex) function in a loop to poll for status.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="83d46-133"><span id="Session_0_Isolation"></span><span id="session_0_isolation"></span><span id="SESSION_0_ISOLATION"></span>Изоляция сеанса 0</span><span class="sxs-lookup"><span data-stu-id="83d46-133"><span id="Session_0_Isolation"></span><span id="session_0_isolation"></span><span id="SESSION_0_ISOLATION"></span>Session 0 Isolation</span></span><br/>                                                             | <span data-ttu-id="83d46-134">Службы всегда запускаются в сеансе 0.</span><span class="sxs-lookup"><span data-stu-id="83d46-134">Services have always run in session 0.</span></span> <span data-ttu-id="83d46-135">До выхода Windows Vista первый пользователь, который входит в систему, также был назначен сеансу 0.</span><span class="sxs-lookup"><span data-stu-id="83d46-135">Before Windows Vista, the first user to log on was also assigned to session 0.</span></span> <span data-ttu-id="83d46-136">Теперь сеанс 0 зарезервирован исключительно для служб и других приложений, не связанных с интерактивным сеансом пользователя.</span><span class="sxs-lookup"><span data-stu-id="83d46-136">Now, session 0 is reserved exclusively for services and other applications not associated with an interactive user session.</span></span> <span data-ttu-id="83d46-137">(Первый пользователь, который должен войти в систему, подключен к сеансу 1, второй пользователь, который входит в систему, подключен к сеансу 2 и т. д.) Сеанс 0 не поддерживает процессы, взаимодействующие с пользователем.</span><span class="sxs-lookup"><span data-stu-id="83d46-137">(The first user to log on is connected to session 1, the second user to log on is connected to session 2, and so on.) Session 0 does not support processes that interact with the user.</span></span><br/> <span data-ttu-id="83d46-138">Это изменение означает, что служба не может публиковать или отправлять сообщения в приложение, а приложение не может отправлять или публиковать сообщения в службе.</span><span class="sxs-lookup"><span data-stu-id="83d46-138">This change means that a service cannot post or send a message to an application and an application cannot send or post a message to a service.</span></span> <span data-ttu-id="83d46-139">Кроме того, службы не могут отображать элемент пользовательского интерфейса, например диалоговое окно, напрямую.</span><span class="sxs-lookup"><span data-stu-id="83d46-139">In addition, services cannot display a user interface item such as a dialog box directly.</span></span> <span data-ttu-id="83d46-140">Служба может использовать функцию [**втссендмессаже**](/windows/desktop/api/wtsapi32/nf-wtsapi32-wtssendmessagea) для вывода диалогового окна в другом сеансе.</span><span class="sxs-lookup"><span data-stu-id="83d46-140">A service can use the [**WTSSendMessage**](/windows/desktop/api/wtsapi32/nf-wtsapi32-wtssendmessagea) function to display a dialog box in another session.</span></span><br/> |



 

## <a name="related-topics"></a><span data-ttu-id="83d46-141">См. также</span><span class="sxs-lookup"><span data-stu-id="83d46-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="83d46-142">Службы</span><span class="sxs-lookup"><span data-stu-id="83d46-142">Services</span></span>](services.md)
</dt> </dl>

 

