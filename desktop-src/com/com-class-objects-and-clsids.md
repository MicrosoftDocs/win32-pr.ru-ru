---
title: Объекты COM-классов и CLSID
description: COM-сервер реализуется как класс COM.
ms.assetid: 0073acdf-38a8-4f1a-aa26-379456a95fca
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1bbfde2f379c4c7589db4cde283c8c67d720b21d
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "105710389"
---
# <a name="com-class-objects-and-clsids"></a><span data-ttu-id="79d76-103">Объекты COM-классов и CLSID</span><span class="sxs-lookup"><span data-stu-id="79d76-103">COM Class Objects and CLSIDs</span></span>

<span data-ttu-id="79d76-104">COM-сервер реализуется как класс COM.</span><span class="sxs-lookup"><span data-stu-id="79d76-104">A COM server is implemented as a COM class.</span></span> <span data-ttu-id="79d76-105">*Класс COM* является реализацией группы интерфейсов в коде, который выполняется при каждом взаимодействии с данным объектом.</span><span class="sxs-lookup"><span data-stu-id="79d76-105">A *COM class* is an implementation of a group of interfaces in code executed whenever you interact with a given object.</span></span> <span data-ttu-id="79d76-106">Существует важное различие между классом C++ и классом COM: в C++ класс является типом, а класс COM — просто определением объекта и не несет типа, хотя программист C++ может реализовать его с помощью класса C++.</span><span class="sxs-lookup"><span data-stu-id="79d76-106">There is an important distinction between a C++ class and a COM class: In C++, a class is a type, while a COM class is simply a definition of the object and carries no type, although a C++ programmer might implement it by using a C++ class.</span></span> <span data-ttu-id="79d76-107">Модель COM предназначена для того, чтобы класс можно было использовать в различных приложениях, включая приложения, написанные без знания существования этого конкретного класса.</span><span class="sxs-lookup"><span data-stu-id="79d76-107">COM is designed to allow a class to be used by different applications, including applications written without knowledge of that particular class's existence.</span></span> <span data-ttu-id="79d76-108">Таким образом, код класса для данного типа объекта существует либо в динамической связанной библиотеке (DLL), либо в другом исполняемом приложении (EXE).</span><span class="sxs-lookup"><span data-stu-id="79d76-108">Therefore, class code for a given type of object exists either in a dynamic linked library (DLL) or in another executable application (EXE).</span></span>

<span data-ttu-id="79d76-109">Каждый класс COM определяется *идентификатором CLSID*, уникальным 128-РАЗРЯДным идентификатором GUID, который сервер должен зарегистрировать.</span><span class="sxs-lookup"><span data-stu-id="79d76-109">Each COM class is identified by a *CLSID*, a unique 128-bit GUID, which the server must register.</span></span> <span data-ttu-id="79d76-110">COM использует этот идентификатор CLSID в запросе клиента, чтобы связать определенные данные с библиотекой DLL или EXE, содержащей код, реализующий класс, создавая экземпляр объекта.</span><span class="sxs-lookup"><span data-stu-id="79d76-110">COM uses this CLSID, at the request of a client, to associate specific data with the DLL or EXE containing the code that implements the class, thus creating an instance of the object.</span></span>

<span data-ttu-id="79d76-111">Для клиентов и серверов на одном компьютере идентификатором CLSID сервера является все, что требуется клиенту.</span><span class="sxs-lookup"><span data-stu-id="79d76-111">For clients and servers on the same computer, the CLSID of the server is all the client ever needs.</span></span> <span data-ttu-id="79d76-112">На каждом компьютере COM поддерживает базу данных (она использует системный реестр на платформах Microsoft Windows и Macintosh) всех идентификаторов CLSID для серверов, установленных в системе.</span><span class="sxs-lookup"><span data-stu-id="79d76-112">On each computer, COM maintains a database (it makes use of the system registry on Microsoft Windows and Macintosh platforms) of all the CLSIDs for the servers installed on the system.</span></span> <span data-ttu-id="79d76-113">Это сопоставление между каждым идентификатором CLSID и расположением библиотеки DLL или EXE, в котором находится код для этого идентификатора CLSID.</span><span class="sxs-lookup"><span data-stu-id="79d76-113">This is a mapping between each CLSID and the location of the DLL or EXE that houses the code for that CLSID.</span></span> <span data-ttu-id="79d76-114">COM обращается к этой базе данных каждый раз, когда клиент хочет создать экземпляр класса COM и использовать его службы, чтобы клиент никогда не знал о абсолютном расположении кода на компьютере.</span><span class="sxs-lookup"><span data-stu-id="79d76-114">COM consults this database whenever a client wants to create an instance of a COM class and use its services, so the client never needs to know the absolute location of the code on the computer.</span></span>

<span data-ttu-id="79d76-115">Для распределенных систем COM предоставляет записи реестра, позволяющие удаленному серверу регистрировать себя для использования клиентом.</span><span class="sxs-lookup"><span data-stu-id="79d76-115">For distributed systems, COM provides registry entries that allow a remote server to register itself for use by a client.</span></span> <span data-ttu-id="79d76-116">Хотя приложениям требуется знать только CLSID сервера, поскольку они могут полагаться на реестр для определения сервера, COM позволяет клиентам переопределять записи реестра и указывать расположения серверов, чтобы использовать все преимущества сети.</span><span class="sxs-lookup"><span data-stu-id="79d76-116">While applications need know only a server's CLSID, because they can rely on the registry to locate the server, COM allows clients to override registry entries and to specify server locations, to take full advantage of the network.</span></span> <span data-ttu-id="79d76-117">(См. раздел [Поиск удаленного объекта](locating-a-remote-object.md).)</span><span class="sxs-lookup"><span data-stu-id="79d76-117">(See [Locating a Remote Object](locating-a-remote-object.md).)</span></span>

<span data-ttu-id="79d76-118">Базовый способ создания экземпляра класса — через *объект класса* com.</span><span class="sxs-lookup"><span data-stu-id="79d76-118">The basic way to create an instance of a class is through a COM *class object*.</span></span> <span data-ttu-id="79d76-119">Это просто промежуточный объект, который поддерживает функции, общие для создания новых экземпляров данного класса.</span><span class="sxs-lookup"><span data-stu-id="79d76-119">This is simply an intermediate object that supports functions common to creating new instances of a given class.</span></span> <span data-ttu-id="79d76-120">Большинство объектов классов, используемых для создания объектов из CLSID, поддерживают интерфейс [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory) — интерфейс, который включает важный метод [**CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance) .</span><span class="sxs-lookup"><span data-stu-id="79d76-120">Most class objects used to create objects from a CLSID support the [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory) interface, an interface that includes the important [**CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance) method.</span></span> <span data-ttu-id="79d76-121">Для каждого класса объекта, для которого создается экземпляр, реализуется интерфейс **IClassFactory** .</span><span class="sxs-lookup"><span data-stu-id="79d76-121">You implement an **IClassFactory** interface for each class of object that you offer to be instantiated.</span></span> <span data-ttu-id="79d76-122">(Дополнительные сведения о реализации **IClassFactory** см. в разделе [Реализация IClassFactory](implementing-iclassfactory.md).)</span><span class="sxs-lookup"><span data-stu-id="79d76-122">(For more information about implementing **IClassFactory**, see [Implementing IClassFactory](implementing-iclassfactory.md).)</span></span>

> [!Note]  
> <span data-ttu-id="79d76-123">Серверы, поддерживающие другой настраиваемый интерфейс фабрики класса, не должны поддерживать [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory) специально.</span><span class="sxs-lookup"><span data-stu-id="79d76-123">Servers that support some other custom class factory interface are not required to support [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory) specifically.</span></span> <span data-ttu-id="79d76-124">Однако для вызовов функций активации, отличных от [**кожетклассобжект**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject) (например, [**кокреатеинстанцеекс**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstanceex)), требуется, чтобы сервер поддерживал **IClassFactory**.</span><span class="sxs-lookup"><span data-stu-id="79d76-124">However, calls to activation functions other than [**CoGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject) (such as [**CoCreateInstanceEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstanceex)) require that the server support **IClassFactory**.</span></span>

 

<span data-ttu-id="79d76-125">Когда клиент хочет создать экземпляр объекта сервера, он использует CLSID требуемого объекта в вызове [**кожетклассобжект**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject).</span><span class="sxs-lookup"><span data-stu-id="79d76-125">When a client wants to create an instance of the server's object, it uses the desired object's CLSID in a call to [**CoGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject).</span></span> <span data-ttu-id="79d76-126">(Этот вызов может быть прямым или неявным с помощью одной из вспомогательных функций создания объекта.) Эта функция находит код, связанный с идентификатором CLSID, создает объект класса и предоставляет указатель на запрошенный интерфейс.</span><span class="sxs-lookup"><span data-stu-id="79d76-126">(This call can be either direct or implicit, through one of the object creation helper functions.) This function locates the code associated with the CLSID, and creates a class object, and supplies a pointer to the interface requested.</span></span> <span data-ttu-id="79d76-127">(**Кожетклассобжект** принимает параметр *riid* , указывающий нужный указатель на интерфейс клиента.)</span><span class="sxs-lookup"><span data-stu-id="79d76-127">(**CoGetClassObject** takes a *riid* param that specifies the client's desired interface pointer.)</span></span>

> [!Note]  
> <span data-ttu-id="79d76-128">Модель COM содержит всего несколько функций, с которыми строится множество других.</span><span class="sxs-lookup"><span data-stu-id="79d76-128">COM has just a few functions upon which many of the others are built.</span></span> <span data-ttu-id="79d76-129">Наиболее важным из них, вероятно, является [**кожетклассобжект**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject), который опирается на все функции создания экземпляра.</span><span class="sxs-lookup"><span data-stu-id="79d76-129">The most important of these is probably [**CoGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject), which underlies all of the instance creation functions.</span></span>

 

<span data-ttu-id="79d76-130">С помощью этого указателя вызывающий объект может создать экземпляр объекта и получить указатель на запрошенный интерфейс для объекта.</span><span class="sxs-lookup"><span data-stu-id="79d76-130">With this pointer, the caller can create an instance of the object and retrieve a pointer to a requested interface on the object.</span></span> <span data-ttu-id="79d76-131">Обычно это интерфейс инициализации, используемый для активации объекта (перевода его в состояние выполнения), чтобы клиент мог выполнять любые действия с объектом, который ему нужен.</span><span class="sxs-lookup"><span data-stu-id="79d76-131">This is usually an initialization interface, used to activate the object (put it in the running state) so that the client can do whatever work with the object that it wants to.</span></span> <span data-ttu-id="79d76-132">С помощью основных функций COM клиент должен также отпустить все указатели на объекты.</span><span class="sxs-lookup"><span data-stu-id="79d76-132">Using COM's basic functions, the client must also take care to release all object pointers.</span></span>

<span data-ttu-id="79d76-133">Еще один механизм активации экземпляров объектов — это моникер класса.</span><span class="sxs-lookup"><span data-stu-id="79d76-133">Another mechanism for activating object instances is through the class moniker.</span></span> <span data-ttu-id="79d76-134">Моникеры класса привязываются к объекту класса класса, для которого они созданы.</span><span class="sxs-lookup"><span data-stu-id="79d76-134">Class monikers bind to the class object of the class for which they are created.</span></span> <span data-ttu-id="79d76-135">Дополнительные сведения см. в разделе [моникеры класса](class-monikers.md).</span><span class="sxs-lookup"><span data-stu-id="79d76-135">For more information, see [Class Monikers](class-monikers.md).</span></span>

<span data-ttu-id="79d76-136">COM предоставляет несколько вспомогательных функций, которые снижают объем работ по созданию экземпляров объектов.</span><span class="sxs-lookup"><span data-stu-id="79d76-136">COM provides several helper functions that reduce the work of creating object instances.</span></span> <span data-ttu-id="79d76-137">Они описаны в [вспомогательных функциях создания экземпляров](instance-creation-helper-functions.md).</span><span class="sxs-lookup"><span data-stu-id="79d76-137">These are described in [Instance Creation Helper Functions](instance-creation-helper-functions.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="79d76-138">См. также</span><span class="sxs-lookup"><span data-stu-id="79d76-138">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="79d76-139">Создание объекта через объект класса</span><span class="sxs-lookup"><span data-stu-id="79d76-139">Creating an Object Through a Class Object</span></span>](creating-an-object-through-a-class-object.md)
</dt> </dl>

 

 