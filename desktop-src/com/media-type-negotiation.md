---
title: Согласование Media-Type
description: Многие протоколы Интернета уровня приложения основаны на обмене сообщениями в простом и гибком формате, называемом многоцелевыми расширениями электронной почты Интернета (MIME).
ms.assetid: 7a2c9d8f-639a-4865-a62b-63330175f5f0
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cb145fa3a76da6574172ddd24888f3b5da7ad85e
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "104413849"
---
# <a name="media-type-negotiation"></a><span data-ttu-id="2cd63-103">Согласование Media-Type</span><span class="sxs-lookup"><span data-stu-id="2cd63-103">Media-Type Negotiation</span></span>

<span data-ttu-id="2cd63-104">Многие протоколы Интернета уровня приложения основаны на обмене сообщениями в простом и гибком формате, называемом многоцелевыми расширениями электронной почты Интернета (MIME).</span><span class="sxs-lookup"><span data-stu-id="2cd63-104">Many application-layer Internet protocols are based on the exchange of messages in a simple, flexible format called Multipurpose Internet Mail Extensions (MIME).</span></span> <span data-ttu-id="2cd63-105">Несмотря на то, что MIME является стандартом для обмена электронными сообщениями электронной почты, он используется в самых разных приложениях для указания взаимопонятных форматов данных в формате MIME или мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="2cd63-105">Although MIME originated as a standard for exchanging electronic mail messages, it is used today by a wide variety of applications to specify mutually understood data formats as MIME, or media, types.</span></span> <span data-ttu-id="2cd63-106">Процесс называется *согласованием типа мультимедиа*.</span><span class="sxs-lookup"><span data-stu-id="2cd63-106">The process is called *media-type negotiation*.</span></span>

<span data-ttu-id="2cd63-107">Типы мультимедиа — это простые строки, которые обозначают тип и подтип (например, "text/plain" или "Text/HTML").</span><span class="sxs-lookup"><span data-stu-id="2cd63-107">Media types are simple strings that denote a type and subtype (such as "text/plain" or "text/HTML").</span></span> <span data-ttu-id="2cd63-108">Они используются для пометки данных или определения запроса.</span><span class="sxs-lookup"><span data-stu-id="2cd63-108">They are used to label data or qualify a request.</span></span> <span data-ttu-id="2cd63-109">Веб-браузер, например, в составе HTTP-запроса или запроса-сведения указывает, что он запрашивает типы мультимедиа "image/gif" или "Image/JPEG", к которым веб-сервер отвечает, возвращая соответствующий тип носителя и, если вызов был запросом данных, данные в запрошенном формате.</span><span class="sxs-lookup"><span data-stu-id="2cd63-109">A Web browser, for example, as part of an HTTP request-for-data or request-for-info, specifies that it is requesting "image/gif" or "image/jpeg" Media Types, to which a web server responds by returning the appropriate media type and, if the call was a request-for-data, the data itself in the requested format.</span></span>

<span data-ttu-id="2cd63-110">Согласование типа носителя часто аналогично тому, как существующие настольные приложения согласовываются с системным буфером обмена, чтобы определить, какой формат данных следует вставить, когда пользователь выбирает режим редактирования/вставки или запросы для форматирования при получении указателя [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) во время операции перетаскивания.</span><span class="sxs-lookup"><span data-stu-id="2cd63-110">Media-type negotiation is often similar to how existing desktop applications negotiate with the system clipboard to determine which data format to paste when a user chooses Edit/Paste or queries for formats when receiving an [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) pointer during a drag-and-drop operation.</span></span> <span data-ttu-id="2cd63-111">Незаметное различие в согласовании типа носителя HTTP заключается в том, что клиент не знает заранее, какие форматы доступны для сервера.</span><span class="sxs-lookup"><span data-stu-id="2cd63-111">The subtle difference in HTTP media-type negotiation is that the client does not know ahead of time which formats the server has available.</span></span> <span data-ttu-id="2cd63-112">Таким образом, клиент указывает, какие типы носителей он поддерживает, в порядке наивысшей точности, и сервер отвечает наилучшим из доступных форматов.</span><span class="sxs-lookup"><span data-stu-id="2cd63-112">Therefore, the client specifies up-front the media types it supports, in order of greatest fidelity, and the server responds with the best available format.</span></span>

<span data-ttu-id="2cd63-113">Моникеры URL-адресов поддерживают согласование типов мультимедиа как способ, которым клиенты и серверы Интернета могут согласовать форматы, используемые при загрузке данных в операциях [**биндтостораже**](/windows/desktop/api/ObjIdl/nf-objidl-imoniker-bindtostorage) .</span><span class="sxs-lookup"><span data-stu-id="2cd63-113">URL monikers support media-type negotiation as a way for Internet clients and servers to agree upon formats to be used when downloading data in [**BindToStorage**](/windows/desktop/api/ObjIdl/nf-objidl-imoniker-bindtostorage) operations.</span></span> <span data-ttu-id="2cd63-114">Для поддержки согласования типа мультимедиа клиент реализует интерфейс [**иенумформатетк**](/windows/desktop/api/ObjIdl/nn-objidl-ienumformatetc) и вызывает функцию [**регистерформатенумератор**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775116(v=vs.85)) , чтобы зарегистрировать ее в контексте привязки.</span><span class="sxs-lookup"><span data-stu-id="2cd63-114">To support media-type negotiation, a client implements the [**IEnumFORMATETC**](/windows/desktop/api/ObjIdl/nn-objidl-ienumformatetc) interface and calls the [**RegisterFormatEnumerator**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775116(v=vs.85)) function to register it with the bind context.</span></span> <span data-ttu-id="2cd63-115">Перечислитель формата перечисляет форматы, которые может принимать клиент.</span><span class="sxs-lookup"><span data-stu-id="2cd63-115">The format enumerator lists the formats the client can accept.</span></span> <span data-ttu-id="2cd63-116">Моникер URL преобразует эти форматы в типы мультимедиа при привязке к URL-адресам HTTP.</span><span class="sxs-lookup"><span data-stu-id="2cd63-116">A URL moniker translates these formats into media types when binding to HTTP URLs.</span></span>

<span data-ttu-id="2cd63-117">Возможные типы носителей, запрошенные клиентом, представлены в виде моникеров URL-адресов через структуры [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) , доступные из перечислителя [**иенумформатетк**](/windows/desktop/api/ObjIdl/nn-objidl-ienumformatetc) , зарегистрированного вызывающим объектом в контексте привязки: каждый **форматетк** указывает формат буфера обмена, определяющий тип носителя.</span><span class="sxs-lookup"><span data-stu-id="2cd63-117">The possible media types requested by the client are represented to URL monikers through [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structures available from the [**IEnumFORMATETC**](/windows/desktop/api/ObjIdl/nn-objidl-ienumformatetc) enumerator registered by the caller on the bind context: Each **FORMATETC** specifies a clipboard format identifying the media type.</span></span> <span data-ttu-id="2cd63-118">Например, следующий фрагмент кода указывает, что тип носителя — PostScript.</span><span class="sxs-lookup"><span data-stu-id="2cd63-118">For example, the following code fragment specifies that the media type is PostScript.</span></span>

``` syntax
FORMATETC fmtetc;
fmtetc.cfFormat = RegisterClipboardFormat(CF_MIME_POSTSCRIPT);
. . .
```

<span data-ttu-id="2cd63-119">Клиент может задать для формата буфера обмена Специальный тип носителя CF \_ null, чтобы указать, что необходимо извлечь тип носителя по умолчанию ресурса, на который указывает URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="2cd63-119">A client can set the clipboard format to the special media type CF\_NULL to indicate that the default media type of the resource pointed to by the URL should be retrieved.</span></span> <span data-ttu-id="2cd63-120">Этот формат обычно является последним, в котором заинтересован клиент.</span><span class="sxs-lookup"><span data-stu-id="2cd63-120">This format is usually the last one in which the client is interested.</span></span> <span data-ttu-id="2cd63-121">Если в контексте привязки не зарегистрирован перечислитель, моникер URL-адреса работает так же, как если бы перечислитель, содержащий один [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) с **кфформат**= CF \_ null, был доступен, автоматически скачивает тип носителя по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="2cd63-121">When no enumerator is registered with the bind context, a URL moniker works as if an enumerator containing a single [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) with **cfFormat**=CF\_NULL is available, automatically downloading the default media-type.</span></span>

<span data-ttu-id="2cd63-122">Какой бы тип носителя использовать, клиент получает извещение о выборе с помощью аргумента *пформатетк* в своем методе [**метода интерфейса IBindStatusCallback:: ондатааваилабле**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775061(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="2cd63-122">Whatever media type is to be used, the client is notified of the choice by means of the *pformatetc* argument on its [**IBindStatusCallback::OnDataAvailable**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775061(v=vs.85)) method.</span></span> <span data-ttu-id="2cd63-123">Обратный вызов происходит в контексте вызова клиента в [**биндтостораже**](/windows/desktop/api/ObjIdl/nf-objidl-imoniker-bindtostorage).</span><span class="sxs-lookup"><span data-stu-id="2cd63-123">The callback occurs within the context of the client's call to [**BindToStorage**](/windows/desktop/api/ObjIdl/nf-objidl-imoniker-bindtostorage).</span></span>

> [!Note]  
> <span data-ttu-id="2cd63-124">Если полученное содержимое имеет неизвестный тип носителя, клиент автоматически вызывает [**регистермедиатипес**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775118(v=vs.85)) для регистрации нового типа.</span><span class="sxs-lookup"><span data-stu-id="2cd63-124">If received content is of an unrecognized media-type, the client automatically calls [**RegisterMediaTypes**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775118(v=vs.85)) to register the new type.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="2cd63-125">См. также</span><span class="sxs-lookup"><span data-stu-id="2cd63-125">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2cd63-126">Моникеры URL-адресов</span><span class="sxs-lookup"><span data-stu-id="2cd63-126">URL Monikers</span></span>](url-monikers.md)
</dt> </dl>

 

 