---
title: Согласование Media-Type
description: Многие протоколы Интернета уровня приложения основаны на обмене сообщениями в простом и гибком формате, называемом многоцелевыми расширениями электронной почты Интернета (MIME).
ms.assetid: 7a2c9d8f-639a-4865-a62b-63330175f5f0
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cb145fa3a76da6574172ddd24888f3b5da7ad85e
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "104413849"
---
# <a name="media-type-negotiation"></a>Согласование Media-Type

Многие протоколы Интернета уровня приложения основаны на обмене сообщениями в простом и гибком формате, называемом многоцелевыми расширениями электронной почты Интернета (MIME). Несмотря на то, что MIME является стандартом для обмена электронными сообщениями электронной почты, он используется в самых разных приложениях для указания взаимопонятных форматов данных в формате MIME или мультимедиа. Процесс называется *согласованием типа мультимедиа*.

Типы мультимедиа — это простые строки, которые обозначают тип и подтип (например, "text/plain" или "Text/HTML"). Они используются для пометки данных или определения запроса. Веб-браузер, например, в составе HTTP-запроса или запроса-сведения указывает, что он запрашивает типы мультимедиа "image/gif" или "Image/JPEG", к которым веб-сервер отвечает, возвращая соответствующий тип носителя и, если вызов был запросом данных, данные в запрошенном формате.

Согласование типа носителя часто аналогично тому, как существующие настольные приложения согласовываются с системным буфером обмена, чтобы определить, какой формат данных следует вставить, когда пользователь выбирает режим редактирования/вставки или запросы для форматирования при получении указателя [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) во время операции перетаскивания. Незаметное различие в согласовании типа носителя HTTP заключается в том, что клиент не знает заранее, какие форматы доступны для сервера. Таким образом, клиент указывает, какие типы носителей он поддерживает, в порядке наивысшей точности, и сервер отвечает наилучшим из доступных форматов.

Моникеры URL-адресов поддерживают согласование типов мультимедиа как способ, которым клиенты и серверы Интернета могут согласовать форматы, используемые при загрузке данных в операциях [**биндтостораже**](/windows/desktop/api/ObjIdl/nf-objidl-imoniker-bindtostorage) . Для поддержки согласования типа мультимедиа клиент реализует интерфейс [**иенумформатетк**](/windows/desktop/api/ObjIdl/nn-objidl-ienumformatetc) и вызывает функцию [**регистерформатенумератор**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775116(v=vs.85)) , чтобы зарегистрировать ее в контексте привязки. Перечислитель формата перечисляет форматы, которые может принимать клиент. Моникер URL преобразует эти форматы в типы мультимедиа при привязке к URL-адресам HTTP.

Возможные типы носителей, запрошенные клиентом, представлены в виде моникеров URL-адресов через структуры [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) , доступные из перечислителя [**иенумформатетк**](/windows/desktop/api/ObjIdl/nn-objidl-ienumformatetc) , зарегистрированного вызывающим объектом в контексте привязки: каждый **форматетк** указывает формат буфера обмена, определяющий тип носителя. Например, следующий фрагмент кода указывает, что тип носителя — PostScript.

``` syntax
FORMATETC fmtetc;
fmtetc.cfFormat = RegisterClipboardFormat(CF_MIME_POSTSCRIPT);
. . .
```

Клиент может задать для формата буфера обмена Специальный тип носителя CF \_ null, чтобы указать, что необходимо извлечь тип носителя по умолчанию ресурса, на который указывает URL-адрес. Этот формат обычно является последним, в котором заинтересован клиент. Если в контексте привязки не зарегистрирован перечислитель, моникер URL-адреса работает так же, как если бы перечислитель, содержащий один [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) с **кфформат**= CF \_ null, был доступен, автоматически скачивает тип носителя по умолчанию.

Какой бы тип носителя использовать, клиент получает извещение о выборе с помощью аргумента *пформатетк* в своем методе [**метода интерфейса IBindStatusCallback:: ондатааваилабле**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775061(v=vs.85)) . Обратный вызов происходит в контексте вызова клиента в [**биндтостораже**](/windows/desktop/api/ObjIdl/nf-objidl-imoniker-bindtostorage).

> [!Note]  
> Если полученное содержимое имеет неизвестный тип носителя, клиент автоматически вызывает [**регистермедиатипес**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775118(v=vs.85)) для регистрации нового типа.

 

## <a name="related-topics"></a>См. также

<dl> <dt>

[Моникеры URL-адресов](url-monikers.md)
</dt> </dl>

 

 