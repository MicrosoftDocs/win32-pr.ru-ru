---
title: Правила проектирования интерфейсов
description: В этом разделе приведены краткие сведения о правилах и рекомендациях по проектированию интерфейсов.
ms.assetid: c43fc385-bcd6-45fc-91b2-ad9827fdb15c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5c1cde73527ac79a2e4442910e3053ed96748337
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "104134618"
---
# <a name="interface-design-rules"></a>Правила проектирования интерфейсов

В этом разделе приведены краткие сведения о правилах и рекомендациях по проектированию интерфейсов. Некоторые из этих правил относятся к архитектуре COM, а другие — к ограничениям, накладываемым языком разработки интерфейса MIDL. Дополнительные сведения о проектировании COM-интерфейса см. в разделе [Анатомия файла IDL](anatomy-of-an-idl-file.md).

По определению объект не является COM-объектом, если он не реализует интерфейс [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) или интерфейс, производный от **IUnknown**. Кроме того, следующие правила применяются ко всем интерфейсам, реализованным в COM-объекте:

-   Они должны иметь уникальный идентификатор интерфейса (IID).
-   Они должны быть неизменяемыми. После создания и публикации не может измениться ни одна часть определения.
-   Все методы интерфейса должны возвращать значение **HRESULT** , чтобы части системы, обрабатывающие удаленную обработку, могли сообщать об ошибках RPC.
-   Все строковые параметры в методах интерфейса должны быть в Юникоде.
-   Типы данных должны поддерживать удаленное взаимодействие. Если невозможно преобразовать тип данных в тип, поддерживающий удаленное взаимодействие, необходимо создать собственные подпрограммы маршалинга и распаковки. Кроме того, **лпвоид** или **void \*** не имеет смысла на удаленном компьютере. При необходимости используйте указатель на [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown).

> [!Note]  
> Текущая реализация MIDL не поддерживает перегрузку функций или множественное наследование.

 

## <a name="other-interface-design-considerations"></a>Другие рекомендации по проектированию интерфейса

Очень аккуратно Используйте указатели на данные. Чтобы повторно создать данные в адресном пространстве вызываемого процесса, время выполнения RPC должно точно соответствовать размеру данных. Если, например, параметр **char \*** указывает на буфер символов, а не на один символ, данные не могут быть правильно созданы повторно. Используйте синтаксис, доступный в MIDL, чтобы точно описать структуры данных, представленные определениями типов.

Инициализация необходима для указателей, которые внедряются в массивы и структуры и передаются через границы процесса. Неинициализированные указатели могут работать при передаче в программу в одном пространстве процесса, но прокси-серверы и заглушки предполагают, что все указатели инициализированы допустимыми адресами или имеют значение null.

Будьте внимательны при присвоении псевдонимам указателей (что позволяет указателям указывать на один и тот же участок памяти). Если Присвоение псевдонимов преднамерено, эти указатели должны быть объявлены в IDL-файле как псевдонимы. Указатели, объявленные как непсевдонимы, не должны быть псевдонимами друг друга.

Обратите особое внимание на то, как выделяется и освобождается память. Помните, что, если вы явно не указываете COM-объект (с помощью атрибута [**выделения**](/windows/desktop/Midl/allocate) ) не освобождаете структуру данных, созданную во время внешнего вызова, эта структура будет уничтожена после завершения вызова. Кроме того, учитывайте потенциально разрушительные издержки, созданные неэффективным выделением структур данных, которые теперь необходимо маршалировать и распаковать.

И, наконец, будьте внимательны при определении возвращаемых значений **HRESULT** , чтобы не создавать коды ошибок, которые конфликтуют с кодами ИТФ, ОПРЕДЕЛЯЕМЫМИ моделью COM \_ (значения между Символ 0x0000 и 0x01FF зарезервированы) или конфликтуют с другими значениями **HRESULT** с тем же значением. Везде, где это возможно, используйте универсальные возвращаемые значения успеха и ошибки COM и используйте [**выходной**](/windows/desktop/Midl/out-idl) параметр вместо **HRESULT**, чтобы получить сведения, относящиеся к вызову функции.

Дополнительные сведения см. в следующих разделах:

-   [Проектирование удаленных интерфейсов](designing-remotable-interfaces.md)
-   [Использование COM-интерфейса](using-a-com-interface.md)

## <a name="related-topics"></a>См. также

<dl> <dt>

[Определения интерфейсов и библиотеки типов](/windows/desktop/Midl/interface-definitions-and-type-libraries)
</dt> </dl>

 

 