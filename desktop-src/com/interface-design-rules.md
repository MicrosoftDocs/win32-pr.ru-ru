---
title: Правила проектирования интерфейсов
description: В этом разделе приведены краткие сведения о правилах и рекомендациях по проектированию интерфейсов.
ms.assetid: c43fc385-bcd6-45fc-91b2-ad9827fdb15c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5c1cde73527ac79a2e4442910e3053ed96748337
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "104134618"
---
# <a name="interface-design-rules"></a><span data-ttu-id="0cbbc-103">Правила проектирования интерфейсов</span><span class="sxs-lookup"><span data-stu-id="0cbbc-103">Interface Design Rules</span></span>

<span data-ttu-id="0cbbc-104">В этом разделе приведены краткие сведения о правилах и рекомендациях по проектированию интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-104">This section provides a short summary of interface design rules and guidelines.</span></span> <span data-ttu-id="0cbbc-105">Некоторые из этих правил относятся к архитектуре COM, а другие — к ограничениям, накладываемым языком разработки интерфейса MIDL.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-105">Some of these rules are specific to the COM architecture, while others are restrictions imposed by the interface design language, MIDL.</span></span> <span data-ttu-id="0cbbc-106">Дополнительные сведения о проектировании COM-интерфейса см. в разделе [Анатомия файла IDL](anatomy-of-an-idl-file.md).</span><span class="sxs-lookup"><span data-stu-id="0cbbc-106">For details of COM interface design, see [Anatomy of an IDL File](anatomy-of-an-idl-file.md).</span></span>

<span data-ttu-id="0cbbc-107">По определению объект не является COM-объектом, если он не реализует интерфейс [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) или интерфейс, производный от **IUnknown**.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-107">By definition, an object is not a COM object unless it implements either the [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) interface or an interface that is derived from **IUnknown**.</span></span> <span data-ttu-id="0cbbc-108">Кроме того, следующие правила применяются ко всем интерфейсам, реализованным в COM-объекте:</span><span class="sxs-lookup"><span data-stu-id="0cbbc-108">In addition, the following rules apply to all interfaces implemented on a COM object:</span></span>

-   <span data-ttu-id="0cbbc-109">Они должны иметь уникальный идентификатор интерфейса (IID).</span><span class="sxs-lookup"><span data-stu-id="0cbbc-109">They must have a unique interface identifier (IID).</span></span>
-   <span data-ttu-id="0cbbc-110">Они должны быть неизменяемыми.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-110">They must be immutable.</span></span> <span data-ttu-id="0cbbc-111">После создания и публикации не может измениться ни одна часть определения.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-111">Once they are created and published, no part of their definition may change.</span></span>
-   <span data-ttu-id="0cbbc-112">Все методы интерфейса должны возвращать значение **HRESULT** , чтобы части системы, обрабатывающие удаленную обработку, могли сообщать об ошибках RPC.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-112">All interface methods must return an **HRESULT** value so that the portions of the system that handle remote processing can report RPC errors.</span></span>
-   <span data-ttu-id="0cbbc-113">Все строковые параметры в методах интерфейса должны быть в Юникоде.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-113">All string parameters in interface methods must be Unicode.</span></span>
-   <span data-ttu-id="0cbbc-114">Типы данных должны поддерживать удаленное взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-114">Your data types must be remotable.</span></span> <span data-ttu-id="0cbbc-115">Если невозможно преобразовать тип данных в тип, поддерживающий удаленное взаимодействие, необходимо создать собственные подпрограммы маршалинга и распаковки.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-115">If you cannot convert a data type to a remotable type, you will have to create your own marshaling and unmarshaling routines.</span></span> <span data-ttu-id="0cbbc-116">Кроме того, **лпвоид** или **void \*** не имеет смысла на удаленном компьютере.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-116">Also, **LPVOID**, or **void \***, has no meaning on a remote computer.</span></span> <span data-ttu-id="0cbbc-117">При необходимости используйте указатель на [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown).</span><span class="sxs-lookup"><span data-stu-id="0cbbc-117">Use a pointer to [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown), if necessary.</span></span>

> [!Note]  
> <span data-ttu-id="0cbbc-118">Текущая реализация MIDL не поддерживает перегрузку функций или множественное наследование.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-118">The current implementation of MIDL does not handle function overloading or multiple inheritance.</span></span>

 

## <a name="other-interface-design-considerations"></a><span data-ttu-id="0cbbc-119">Другие рекомендации по проектированию интерфейса</span><span class="sxs-lookup"><span data-stu-id="0cbbc-119">Other Interface Design Considerations</span></span>

<span data-ttu-id="0cbbc-120">Очень аккуратно Используйте указатели на данные.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-120">Use pointers to data very carefully.</span></span> <span data-ttu-id="0cbbc-121">Чтобы повторно создать данные в адресном пространстве вызываемого процесса, время выполнения RPC должно точно соответствовать размеру данных.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-121">To re-create the data in the address space of the process that is called, the RPC run time must know the exact size of the data.</span></span> <span data-ttu-id="0cbbc-122">Если, например, параметр **char \*** указывает на буфер символов, а не на один символ, данные не могут быть правильно созданы повторно.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-122">If, for example, a **CHAR \*** parameter points to a buffer of characters rather than to a single character, the data cannot be correctly re-created.</span></span> <span data-ttu-id="0cbbc-123">Используйте синтаксис, доступный в MIDL, чтобы точно описать структуры данных, представленные определениями типов.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-123">Use the syntax available with MIDL to accurately describe the data structures represented by your type definitions.</span></span>

<span data-ttu-id="0cbbc-124">Инициализация необходима для указателей, которые внедряются в массивы и структуры и передаются через границы процесса.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-124">Initialization is essential for pointers that are embedded in arrays and structures and passed across process boundaries.</span></span> <span data-ttu-id="0cbbc-125">Неинициализированные указатели могут работать при передаче в программу в одном пространстве процесса, но прокси-серверы и заглушки предполагают, что все указатели инициализированы допустимыми адресами или имеют значение null.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-125">Uninitialized pointers may work when passed to a program in the same process space, but proxies and stubs assume that all pointers are initialized with valid addresses or are null.</span></span>

<span data-ttu-id="0cbbc-126">Будьте внимательны при присвоении псевдонимам указателей (что позволяет указателям указывать на один и тот же участок памяти).</span><span class="sxs-lookup"><span data-stu-id="0cbbc-126">Be careful when aliasing pointers (allowing pointers to point to the same piece of memory).</span></span> <span data-ttu-id="0cbbc-127">Если Присвоение псевдонимов преднамерено, эти указатели должны быть объявлены в IDL-файле как псевдонимы.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-127">If the aliasing is intentional, these pointers should be declared aliased in the IDL file.</span></span> <span data-ttu-id="0cbbc-128">Указатели, объявленные как непсевдонимы, не должны быть псевдонимами друг друга.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-128">Pointers declared as nonaliased should never alias each other.</span></span>

<span data-ttu-id="0cbbc-129">Обратите особое внимание на то, как выделяется и освобождается память.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-129">Pay attention to how you allocate and free memory.</span></span> <span data-ttu-id="0cbbc-130">Помните, что, если вы явно не указываете COM-объект (с помощью атрибута [**выделения**](/windows/desktop/Midl/allocate) ) не освобождаете структуру данных, созданную во время внешнего вызова, эта структура будет уничтожена после завершения вызова.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-130">Remember that, unless you explicitly tell a COM object (by using the [**allocate**](/windows/desktop/Midl/allocate) attribute) not to free a data structure that was created during an out-of-process call, that structure will be destroyed when the call completes.</span></span> <span data-ttu-id="0cbbc-131">Кроме того, учитывайте потенциально разрушительные издержки, созданные неэффективным выделением структур данных, которые теперь необходимо маршалировать и распаковать.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-131">Also, consider the potentially destructive overhead created by inefficient allocation of data structures that now need to be marshaled and unmarshaled.</span></span>

<span data-ttu-id="0cbbc-132">И, наконец, будьте внимательны при определении возвращаемых значений **HRESULT** , чтобы не создавать коды ошибок, которые конфликтуют с кодами ИТФ, ОПРЕДЕЛЯЕМЫМИ моделью COM \_ (значения между Символ 0x0000 и 0x01FF зарезервированы) или конфликтуют с другими значениями **HRESULT** с тем же значением.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-132">Finally, be careful when defining your **HRESULT** return values so that you don't create error codes that conflict with COM-defined FACILITY\_ITF codes (values between 0x0000 and 0x01FF are reserved) or that conflict with other **HRESULT** values with the same value.</span></span> <span data-ttu-id="0cbbc-133">Везде, где это возможно, используйте универсальные возвращаемые значения успеха и ошибки COM и используйте [**выходной**](/windows/desktop/Midl/out-idl) параметр вместо **HRESULT**, чтобы получить сведения, относящиеся к вызову функции.</span><span class="sxs-lookup"><span data-stu-id="0cbbc-133">Whenever possible, use the universal COM success and failure return values, and use an [**out**](/windows/desktop/Midl/out-idl) parameter, rather than an **HRESULT**, to return information specific to the function call.</span></span>

<span data-ttu-id="0cbbc-134">Дополнительные сведения см. в следующих разделах:</span><span class="sxs-lookup"><span data-stu-id="0cbbc-134">For more information, see the following topics:</span></span>

-   [<span data-ttu-id="0cbbc-135">Проектирование удаленных интерфейсов</span><span class="sxs-lookup"><span data-stu-id="0cbbc-135">Designing Remotable Interfaces</span></span>](designing-remotable-interfaces.md)
-   [<span data-ttu-id="0cbbc-136">Использование COM-интерфейса</span><span class="sxs-lookup"><span data-stu-id="0cbbc-136">Using a COM Interface</span></span>](using-a-com-interface.md)

## <a name="related-topics"></a><span data-ttu-id="0cbbc-137">См. также</span><span class="sxs-lookup"><span data-stu-id="0cbbc-137">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="0cbbc-138">Определения интерфейсов и библиотеки типов</span><span class="sxs-lookup"><span data-stu-id="0cbbc-138">Interface Definitions and Type Libraries</span></span>](/windows/desktop/Midl/interface-definitions-and-type-libraries)
</dt> </dl>

 

 