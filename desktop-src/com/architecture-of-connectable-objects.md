---
title: Архитектура подключаемых объектов
description: Архитектура подключаемых объектов
ms.assetid: 69949a3b-3ab8-4054-84d8-9256fbf39c7b
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1e9d8d2909942d1c04aed972e7891a6f4ae3f730
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/03/2021
ms.locfileid: "105713224"
---
# <a name="architecture-of-connectable-objects"></a><span data-ttu-id="d000e-103">Архитектура подключаемых объектов</span><span class="sxs-lookup"><span data-stu-id="d000e-103">Architecture of Connectable Objects</span></span>

<span data-ttu-id="d000e-104">Подключаемый объект — это только один элемент общей архитектуры подключаемых объектов.</span><span class="sxs-lookup"><span data-stu-id="d000e-104">The connectable object is only one piece of the overall architecture of connectable objects.</span></span> <span data-ttu-id="d000e-105">Эта технология включает следующие элементы:</span><span class="sxs-lookup"><span data-stu-id="d000e-105">This technology includes the following elements:</span></span>

-   <span data-ttu-id="d000e-106">**Подключаемый объект.**</span><span class="sxs-lookup"><span data-stu-id="d000e-106">**Connectable object.**</span></span> <span data-ttu-id="d000e-107">Реализует интерфейс [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) ; создает по крайней мере один объект точки подключения; Определяет исходящий интерфейс для клиента.</span><span class="sxs-lookup"><span data-stu-id="d000e-107">Implements the [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) interface; creates at least one connection point object; defines an outgoing interface for the client.</span></span>
-   <span data-ttu-id="d000e-108">**Компьютера.**</span><span class="sxs-lookup"><span data-stu-id="d000e-108">**Client.**</span></span> <span data-ttu-id="d000e-109">Запрашивает объект для [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) , чтобы определить, является ли объект подсоединенным; Создает объект приемника для реализации исходящего интерфейса, определенного объектом, который можно подключить.</span><span class="sxs-lookup"><span data-stu-id="d000e-109">Queries the object for [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) to determine whether the object is connectable; creates a sink object to implement the outgoing interface defined by the connectable object.</span></span>
-   <span data-ttu-id="d000e-110">**Объект приемника.**</span><span class="sxs-lookup"><span data-stu-id="d000e-110">**Sink object.**</span></span> <span data-ttu-id="d000e-111">Реализует исходящий интерфейс; используется для установления соединения с объектом, который можно подключить.</span><span class="sxs-lookup"><span data-stu-id="d000e-111">Implements the outgoing interface; used to establish a connection to the connectable object.</span></span>
-   <span data-ttu-id="d000e-112">**Объект точки подключения.**</span><span class="sxs-lookup"><span data-stu-id="d000e-112">**Connection point object.**</span></span> <span data-ttu-id="d000e-113">Реализует интерфейс [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint) и управляет подключением к приемнику клиента.</span><span class="sxs-lookup"><span data-stu-id="d000e-113">Implements the [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint) interface and manages connection with the client's sink.</span></span>

<span data-ttu-id="d000e-114">Отношения между клиентом, подключаемым объектом, точкой подключения и приемником показаны на следующей схеме:</span><span class="sxs-lookup"><span data-stu-id="d000e-114">The relationships between client, connectable object, a connection point, and a sink are illustrated in the following diagram:</span></span>

![Схема, на которой показаны точки соединения между клиентом и подключенным объектом.](images/1cd44fec-5d2c-4427-846b-ccab7ec0b08a.png)

<span data-ttu-id="d000e-116">Перед тем как объект точки подключения вызывает методы в интерфейсе приемника на шаге 3 на предыдущей схеме, он должен иметь значение [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) для конкретного интерфейса, даже если указатель уже был передан в шаге 2 вызова метода [**advise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) .</span><span class="sxs-lookup"><span data-stu-id="d000e-116">Before the connection point object calls methods in the sink interface in step 3 in the preceding diagram, it must [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) for the specific interface required, even if the pointer was already passed in the step 2 call to the [**Advise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) method.</span></span>

<span data-ttu-id="d000e-117">В этой архитектуре также участвуют два объекта перечислителя, но не показаны на рисунке.</span><span class="sxs-lookup"><span data-stu-id="d000e-117">Two enumerator objects are also involved in this architecture though not shown in the illustration.</span></span> <span data-ttu-id="d000e-118">Один из них создается методом в [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) для перечисления точек соединения в объекте, доступном для соединения.</span><span class="sxs-lookup"><span data-stu-id="d000e-118">One is created by a method in [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) to enumerate the connection points within the connectable object.</span></span> <span data-ttu-id="d000e-119">Другой объект создается методом [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint) для перечисления соединений, установленных в данный момент с этой точкой соединения.</span><span class="sxs-lookup"><span data-stu-id="d000e-119">The other is created by a method in [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint) to enumerate the connections currently established to that connection point.</span></span> <span data-ttu-id="d000e-120">Одна точка соединения может поддерживать несколько подключенных интерфейсов приемников, и она должна выполнять итерацию по списку подключений каждый раз, когда он вызывает метод для этого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="d000e-120">One connection point can support multiple connected sink interfaces, and it should iterate through the list of connections each time it makes a method call on that interface.</span></span> <span data-ttu-id="d000e-121">Этот процесс называется многоадресным.</span><span class="sxs-lookup"><span data-stu-id="d000e-121">This process is known as multicasting.</span></span>

<span data-ttu-id="d000e-122">При работе с подключаемыми объектами важно понимать, что подключаемый объект, каждая точка подключения, каждый приемник и все перечислители являются отдельными объектами с отдельными реализациями [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) , отдельными счетчиками ссылок и отдельными жизненными циклами.</span><span class="sxs-lookup"><span data-stu-id="d000e-122">When working with connectable objects, it is important to understand that the connectable object, each connection point, each sink, and all enumerators are separate objects with separate [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) implementations, separate reference counts, and separate lifetimes.</span></span> <span data-ttu-id="d000e-123">Клиент, использующий эти объекты, всегда отвечает за освобождение всех счетчиков ссылок, которыми он владеет.</span><span class="sxs-lookup"><span data-stu-id="d000e-123">A client using these objects is always responsible for releasing all reference counts it owns.</span></span>

> [!Note]  
> <span data-ttu-id="d000e-124">Объект, который можно подключить, поддерживает несколько клиентов и может поддерживать несколько приемников в пределах одного клиента.</span><span class="sxs-lookup"><span data-stu-id="d000e-124">A connectable object can support more than one client and can support multiple sinks within a client.</span></span> <span data-ttu-id="d000e-125">Аналогичным образом приемник может быть подключен к более чем одному подключаемому объекту.</span><span class="sxs-lookup"><span data-stu-id="d000e-125">Likewise, a sink can be connected to more than one connectable object.</span></span>

 

<span data-ttu-id="d000e-126">Ниже приведены действия по установлению соединения между клиентом и подключаемым объектом.</span><span class="sxs-lookup"><span data-stu-id="d000e-126">The steps for establishing a connection between a client and a connectable object are as follows:</span></span>

1.  <span data-ttu-id="d000e-127">Клиент запрашивает [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) для объекта, чтобы определить, является ли объект подсоединенным.</span><span class="sxs-lookup"><span data-stu-id="d000e-127">The client queries for [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) on the object to determine whether the object is connectable.</span></span> <span data-ttu-id="d000e-128">Если этот вызов выполнен успешно, клиент содержит указатель на интерфейс **IConnectionPointContainer** в доступном для соединения объекте, а счетчик ссылки на объект, который можно подключить, был увеличен.</span><span class="sxs-lookup"><span data-stu-id="d000e-128">If this call is successful, the client holds a pointer to the **IConnectionPointContainer** interface on the connectable object and the connectable object reference counter has been incremented.</span></span> <span data-ttu-id="d000e-129">В противном случае объект не подключается и не поддерживает исходящие интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="d000e-129">Otherwise, the object is not connectable and does not support outgoing interfaces.</span></span>
2.  <span data-ttu-id="d000e-130">Если объект является подсоединенным, клиент затем пытается получить указатель на интерфейс [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint) в точке соединения в объекте, доступном для соединения.</span><span class="sxs-lookup"><span data-stu-id="d000e-130">If the object is connectable, the client next tries to obtain a pointer to the [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint) interface on a connection point within the connectable object.</span></span> <span data-ttu-id="d000e-131">Существует два метода получения этого указателя — в [**IConnectionPointContainer:: финдконнектионпоинт**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpointcontainer-findconnectionpoint) и в [**IConnectionPointContainer:: енумконнектионпоинтс**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpointcontainer-enumconnectionpoints).</span><span class="sxs-lookup"><span data-stu-id="d000e-131">There are two methods for obtaining this pointer, both in [**IConnectionPointContainer::FindConnectionPoint**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpointcontainer-findconnectionpoint) and in [**IConnectionPointContainer::EnumConnectionPoints**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpointcontainer-enumconnectionpoints).</span></span> <span data-ttu-id="d000e-132">Если используется **енумконнектионпоинтс** , необходимо выполнить несколько дополнительных действий.</span><span class="sxs-lookup"><span data-stu-id="d000e-132">There are a few additional steps needed if **EnumConnectionPoints** is used.</span></span> <span data-ttu-id="d000e-133">(Дополнительные сведения см. [в разделе Использование IConnectionPointContainer](using-iconnectionpointcontainer.md) .) В случае успеха подключаемый объект и клиент поддерживают один и тот же исходящий интерфейс.</span><span class="sxs-lookup"><span data-stu-id="d000e-133">(See [Using IConnectionPointContainer](using-iconnectionpointcontainer.md) for more information.) If successful, the connectable object and the client both support the same outgoing interface.</span></span> <span data-ttu-id="d000e-134">Подключаемый объект определяет его и вызывает его, и клиент реализует его.</span><span class="sxs-lookup"><span data-stu-id="d000e-134">The connectable object defines it and calls it, and the client implements it.</span></span> <span data-ttu-id="d000e-135">Затем клиент может взаимодействовать через точку подключения в объекте, доступном для подключения.</span><span class="sxs-lookup"><span data-stu-id="d000e-135">The client can then communicate through the connection point within the connectable object.</span></span>
3.  <span data-ttu-id="d000e-136">Затем клиент вызывает в точке подключения предложение [**advise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) , чтобы установить соединение между интерфейсом приемника и точкой соединения объекта.</span><span class="sxs-lookup"><span data-stu-id="d000e-136">The client then calls [**Advise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) on the connection point to establish a connection between its sink interface and the object's connection point.</span></span> <span data-ttu-id="d000e-137">После этого вызова точка соединения объекта содержит указатель на исходящий интерфейс в приемнике.</span><span class="sxs-lookup"><span data-stu-id="d000e-137">After this call, the object's connection point holds a pointer to the outgoing interface on the sink.</span></span>
4.  <span data-ttu-id="d000e-138">Код внутри метода [**advise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) вызывает [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) в переданном переданном указателе интерфейса и запрашивает конкретный идентификатор интерфейса, к которому он подключается.</span><span class="sxs-lookup"><span data-stu-id="d000e-138">The code inside [**Advise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) calls [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) on the interface pointer that is passed in, asking for the specific interface identifier to which it connects.</span></span>
5.  <span data-ttu-id="d000e-139">Объект вызывает методы в интерфейсе приемника по мере необходимости, используя указатель, удерживаемый его точкой соединения.</span><span class="sxs-lookup"><span data-stu-id="d000e-139">The object calls methods on the sink's interface as needed, using the pointer held by its connection point.</span></span>
6.  <span data-ttu-id="d000e-140">Клиент вызывает [**unadvise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-unadvise) для завершения подключения.</span><span class="sxs-lookup"><span data-stu-id="d000e-140">The client calls [**Unadvise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-unadvise) to terminate the connection.</span></span> <span data-ttu-id="d000e-141">Затем клиент вызывает метод **IConnectionPoint:: Release** , чтобы освободить место на точке подключения, и, следовательно, главный объект, который можно подключить.</span><span class="sxs-lookup"><span data-stu-id="d000e-141">Then the client calls **IConnectionPoint::Release** to free its hold on the connection point and, therefore, the main connectable object also.</span></span> <span data-ttu-id="d000e-142">Клиент должен также вызвать метод **IConnectionPointContainer:: Release** , чтобы освободить его на основном подключаемом объекте.</span><span class="sxs-lookup"><span data-stu-id="d000e-142">The client must also call **IConnectionPointContainer::Release** to free its hold on the main connectable object.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d000e-143">См. также</span><span class="sxs-lookup"><span data-stu-id="d000e-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d000e-144">Подключаемые интерфейсы объектов</span><span class="sxs-lookup"><span data-stu-id="d000e-144">Connectable Object Interfaces</span></span>](connectable-object-interfaces.md)
</dt> </dl>

 

 




