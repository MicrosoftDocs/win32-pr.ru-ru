---
title: Когда следует использовать глобальную таблицу интерфейса
description: Когда следует использовать глобальную таблицу интерфейса
ms.assetid: def8f7f8-9d0d-49a4-9d5c-40233903eea5
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f89bbd7437b65c85abe89e8d647cbd73555c2d6a
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "104070665"
---
# <a name="when-to-use-the-global-interface-table"></a>Когда следует использовать глобальную таблицу интерфейса

Если вы размаршалирует указатель интерфейса несколько раз между апартаментами в процессе, то можете использовать интерфейс [**иглобалинтерфацетабле**](/windows/desktop/api/ObjIdl/nn-objidl-iglobalinterfacetable) . При использовании других методов пришлось бы перемаршалировать каждый раз.

> [!Note]  
> Если указатель интерфейса выполняется только один раз, может потребоваться использовать функцию [**комаршалинтерсреадинтерфацеинстреам**](/windows/desktop/api/combaseapi/nf-combaseapi-comarshalinterthreadinterfaceinstream) . Он также может использоваться для передачи указателя интерфейса из одного потока в другой поток в том же процессе.

 

Интерфейс [**иглобалинтерфацетабле**](/windows/desktop/api/ObjIdl/nn-objidl-iglobalinterfacetable) также упрощает для программиста еще и более простую задачу. Эта проблема возникает при выполнении следующих условий.

-   Внутрипроцессный объект Agile выполняет статистическую обработку свободных потоков.
-   Этот же гибкий объект также содержит указатели интерфейсов (в виде переменных-членов) на другие объекты, которые не являются гибкими и не выполняют статистическую обработку для модуля упаковки с произвольным потоком.

В такой ситуации, если внешний объект маршалируется в другое подразделение и приложение вызывает его, и объект пытается вызвать для любого из его указателей интерфейса переменной-члена, которые не являются потокобезопасными или являются прокси для объектов в других подразделениях, может получить неверные результаты или ошибку RPC \_ E \_ неправильный \_ поток. Эта ошибка возникает из-за того, что внутренний интерфейс предназначен для вызываемого только из апартамента, в котором он был первоначально сохранен в переменной-члене.

Чтобы решить эту проблему, внешний объект, который выполняет статистическую обработку свободных потоков, должен вызвать [**иглобалинтерфацетабле:: регистеринтерфацеинглобал**](/windows/win32/api/objidl/nf-objidl-iglobalinterfacetable-registerinterfaceinglobal) во внутреннем интерфейсе и сохранить полученный файл cookie в его переменной-члене вместо того, чтобы хранить фактический указатель интерфейса. Когда внешний объект хочет вызвать указатель интерфейса внутреннего объекта, он должен вызвать [**иглобалинтерфацетабле:: жетинтерфацефромглобал**](/windows/win32/api/objidl/nf-objidl-iglobalinterfacetable-getinterfacefromglobal), использовать возвращаемый указатель интерфейса, а затем освободить его. Когда внешний объект исчезает, он должен вызвать метод [**иглобалинтерфацетабле:: ревокеинтерфацефромглобал**](/windows/win32/api/objidl/nf-objidl-iglobalinterfacetable-revokeinterfacefromglobal) , чтобы удалить интерфейс из глобальной таблицы интерфейса.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Создание глобальной таблицы интерфейса](creating-the-global-interface-table.md)
</dt> </dl>

 

 