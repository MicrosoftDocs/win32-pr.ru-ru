---
title: Навигация по QueryInterface в объекте
description: Навигация по QueryInterface в объекте
ms.assetid: 7dec015f-7609-40eb-a71e-f6e9c9b9f8ff
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3dbd44d200bf0a992f47bc375d0782bdadacf6a3
ms.sourcegitcommit: 85688bbfbe5b121bc05ddf112d54c23a469dfbc0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2020
ms.locfileid: "104336062"
---
# <a name="queryinterface-navigating-in-an-object"></a><span data-ttu-id="22888-103">QueryInterface: Навигация в объекте</span><span class="sxs-lookup"><span data-stu-id="22888-103">QueryInterface: Navigating in an Object</span></span>

<span data-ttu-id="22888-104">После получения исходного указателя на интерфейс в объекте COM имеет очень простой механизм, позволяющий определить, поддерживает ли объект другой конкретный интерфейс и, если это так, получить указатель на него.</span><span class="sxs-lookup"><span data-stu-id="22888-104">After you have an initial pointer to an interface on an object, COM has a very simple mechanism to find out whether the object supports another specific interface and, if so, to get a pointer to it.</span></span> <span data-ttu-id="22888-105">(Дополнительные сведения о получении исходного указателя на интерфейс объекта см. в разделе [Получение указателя на объект](getting-a-pointer-to-an-object.md).) Этот механизм является методом [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) интерфейса [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) .</span><span class="sxs-lookup"><span data-stu-id="22888-105">(For information about getting an initial pointer to an interface on an object, see [Getting a Pointer to an Object](getting-a-pointer-to-an-object.md).) This mechanism is the [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) method of the [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) interface.</span></span> <span data-ttu-id="22888-106">Если объект поддерживает запрошенный интерфейс, метод должен вернуть указатель на этот интерфейс.</span><span class="sxs-lookup"><span data-stu-id="22888-106">If the object supports the requested interface, the method must return a pointer to that interface.</span></span> <span data-ttu-id="22888-107">Это позволяет объекту свободно перемещаться по интерфейсам, которые поддерживает объект.</span><span class="sxs-lookup"><span data-stu-id="22888-107">This permits an object to navigate freely through the interfaces that an object supports.</span></span> <span data-ttu-id="22888-108">**QueryInterface** разделяет запрос "поддерживается ли данный контракт?"</span><span class="sxs-lookup"><span data-stu-id="22888-108">**QueryInterface** separates the request "Do you support a given contract?"</span></span> <span data-ttu-id="22888-109">от высокопроизводительного использования этого контракта после успешного согласования.</span><span class="sxs-lookup"><span data-stu-id="22888-109">from the high-performance use of that contract once negotiations have been successful.</span></span>

<span data-ttu-id="22888-110">Когда клиент изначально получает доступ к объекту, этот клиент получает по крайней мере указатель интерфейса [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) (самый фундаментальный интерфейс), с помощью которого он может управлять временем существования объекта, путем указания объекта, когда он выполняется с помощью объекта, и вызова [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)).</span><span class="sxs-lookup"><span data-stu-id="22888-110">When a client initially gains access to an object, that client will receive, at a minimum, an [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) interface pointer (the most fundamental interface) through which it can control the lifetime of the object—by telling the object when it is done using the object—and invoke [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)).</span></span> <span data-ttu-id="22888-111">Клиент программируется на запрос каждого управляемого объекта для выполнения некоторых операций, но интерфейс **IUnknown** не имеет функций для этих операций.</span><span class="sxs-lookup"><span data-stu-id="22888-111">The client is programmed to ask each object it manages to perform some operations, but the **IUnknown** interface has no functions for those operations.</span></span> <span data-ttu-id="22888-112">Вместо этого эти операции выражаются через другие интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="22888-112">Instead, those operations are expressed through other interfaces.</span></span> <span data-ttu-id="22888-113">Поэтому клиент запрограммирован на согласование с объектами для этих интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="22888-113">The client is thus programmed to negotiate with objects for those interfaces.</span></span> <span data-ttu-id="22888-114">В частности, клиент вызывает **QueryInterface** , чтобы запросить объект для интерфейса, через который клиент может вызывать нужные операции.</span><span class="sxs-lookup"><span data-stu-id="22888-114">Specifically, the client will call **QueryInterface** to ask an object for an interface through which the client may invoke the desired operations.</span></span>

<span data-ttu-id="22888-115">Поскольку объект реализует [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)), он может принимать или отклонять запрос.</span><span class="sxs-lookup"><span data-stu-id="22888-115">Because the object implements [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)), it has the ability to accept or reject the request.</span></span> <span data-ttu-id="22888-116">Если объект принимает клиентский запрос, **QueryInterface** возвращает новый указатель на запрошенный интерфейс клиенту.</span><span class="sxs-lookup"><span data-stu-id="22888-116">If the object accepts the client's request, **QueryInterface** returns a new pointer to the requested interface to the client.</span></span> <span data-ttu-id="22888-117">Через этот указатель интерфейса клиент имеет доступ к методам этого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="22888-117">Through that interface pointer, the client has access to the methods of that interface.</span></span> <span data-ttu-id="22888-118">С другой стороны, если объект отклоняет клиентский запрос, **QueryInterface** возвращает пустой указатель (Error), а клиент не имеет указателя, через который вызываются нужные функции.</span><span class="sxs-lookup"><span data-stu-id="22888-118">If, on the other hand, the object rejects the client's request, **QueryInterface** returns a null pointer—an error—and the client has no pointer through which to call the desired functions.</span></span> <span data-ttu-id="22888-119">В этом случае клиент должен корректно работать с этой возможностью.</span><span class="sxs-lookup"><span data-stu-id="22888-119">In this case, the client must deal gracefully with that possibility.</span></span> <span data-ttu-id="22888-120">Например, предположим, что клиент имеет указатель на интерфейс а в объекте и запрашивает интерфейсы B и C. Предположим также, что объект поддерживает интерфейс B, но не поддерживает интерфейс C. В результате объект возвращает указатель на B и сообщает, что C не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="22888-120">For example, suppose a client has a pointer to interface A on an object and asks for interfaces B and C. Suppose also that the object supports interface B but does not support interface C. The result is that the object returns a pointer to B and reports that C is not supported.</span></span>

<span data-ttu-id="22888-121">Ключевой момент заключается в том, что когда объект отклоняет вызов [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)), клиент не может запросить объект для выполнения операций, выраженных через запрошенный интерфейс.</span><span class="sxs-lookup"><span data-stu-id="22888-121">A key point is that when an object rejects a call to [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)), it is impossible for the client to ask the object to perform the operations expressed through the requested interface.</span></span> <span data-ttu-id="22888-122">Клиент должен иметь указатель интерфейса для вызова методов в этом интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="22888-122">A client must have an interface pointer to invoke methods in that interface.</span></span> <span data-ttu-id="22888-123">Если объект отказывается предоставить запрошенный указатель, клиент должен быть готов к выполнению без выполнения действий, не выполняя ни то ни было, что было предназначено для этого объекта, или попытайтесь вернуться на другой, возможно, менее мощный интерфейс.</span><span class="sxs-lookup"><span data-stu-id="22888-123">If the object refuses to provide the requested pointer, the client must be prepared to do without, either by not doing whatever it had intended to do with that object or by attempting to fall back on another, perhaps less powerful, interface.</span></span> <span data-ttu-id="22888-124">Эта функция COM-функций хорошо работает в сравнении с другими объектно-ориентированными системами, в которых невозможно определить, будет ли работать функция до тех пор, пока вы не выберете эту функцию, а также не уверены в том, что ошибка обработки не определена.</span><span class="sxs-lookup"><span data-stu-id="22888-124">This feature of COM functionality works well in comparison with other object-oriented systems in which you cannot know whether a function will work until you call that function, and even then, handling failure is uncertain.</span></span> <span data-ttu-id="22888-125">**QueryInterface** предоставляет надежный и согласованный способ определить, поддерживает ли объект интерфейс перед попыткой вызова его методов.</span><span class="sxs-lookup"><span data-stu-id="22888-125">**QueryInterface** provides a reliable and consistent way to know whether an object supports an interface before attempting to call its methods.</span></span>

<span data-ttu-id="22888-126">Метод [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) также обеспечивает надежный и надежный способ указания того, что объект не поддерживает данный контракт.</span><span class="sxs-lookup"><span data-stu-id="22888-126">The [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) method also provides a robust and reliable way for an object to indicate that it does not support a given contract.</span></span> <span data-ttu-id="22888-127">То есть, если при вызове **QueryInterface** один из них запрашивает "старый" объект, независимо от того, поддерживает ли он новый интерфейс (например, он был сформирован после доставки старого объекта), старый объект будет надежно, не вызывая сбоя, и ответить "нет".</span><span class="sxs-lookup"><span data-stu-id="22888-127">That is, if in a call to **QueryInterface** one asks an "old" object whether it supports a "new" interface (one, for example, that was invented after the old object had been shipped), the old object will reliably, without causing a crash, answer "no."</span></span> <span data-ttu-id="22888-128">Технология, которая поддерживает это, — это алгоритм, по которому выделяются идентификаторов IID.</span><span class="sxs-lookup"><span data-stu-id="22888-128">The technology that supports this is the algorithm by which IIDs are allocated.</span></span> <span data-ttu-id="22888-129">Хотя это может показаться небольшой точкой, очень важно, чтобы общая архитектура системы, а также возможность запроса устаревших элементов о новых функциях, в удивлении, не содержится в большинстве других архитектур объектов.</span><span class="sxs-lookup"><span data-stu-id="22888-129">While this may seem like a small point, it is extremely important to the overall architecture of the system, and the ability to inquire of legacy elements about new functionality is, surprisingly, a feature not present in most other object architectures.</span></span>

## <a name="related-topics"></a><span data-ttu-id="22888-130">См. также</span><span class="sxs-lookup"><span data-stu-id="22888-130">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="22888-131">Использование и реализация IUnknown</span><span class="sxs-lookup"><span data-stu-id="22888-131">Using and Implementing IUnknown</span></span>](using-and-implementing-iunknown.md)
</dt> </dl>

 

 




