---
title: Интерфейсы сохраняемости
description: Интерфейсы сохраняемости
ms.assetid: a93582b3-bdbf-430d-b4a6-c0df7bc35dc0
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c2e1acbd1074fd5fa4e87e571a1e21ab48d5d075
ms.sourcegitcommit: f848119a8faa29b27585f4df53f6e50ee9666684
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2021
ms.locfileid: "110550509"
---
# <a name="persistence-interfaces"></a><span data-ttu-id="2ff11-103">Интерфейсы сохраняемости</span><span class="sxs-lookup"><span data-stu-id="2ff11-103">Persistence Interfaces</span></span>

<span data-ttu-id="2ff11-104">Объекты, имеющие постоянное состояние любого типа, должны реализовывать по крайней мере один \* интерфейс IPersist и, что предпочтительнее, несколько интерфейсов, чтобы предоставить контейнеру наиболее гибкий способ сохранения состояния элемента управления.</span><span class="sxs-lookup"><span data-stu-id="2ff11-104">Objects that have a persistent state of any kind must implement at least one IPersist\* interface, and preferably multiple interfaces, in order to provide the container with the most flexible choice of how it wishes to save a control's state.</span></span>

<span data-ttu-id="2ff11-105">Если у элемента управления есть устойчивое состояние, он должен как минимум реализовать либо [**IPersistStream**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststream) , либо [**иперсистстреаминит**](/windows/desktop/api/OCIdl/nn-ocidl-ipersiststreaminit) (два являются взаимоисключающими и не должны реализовываться в большинстве случаев).</span><span class="sxs-lookup"><span data-stu-id="2ff11-105">If a control has any persistent state whatsoever, it must, as a minimum, implement either [**IPersistStream**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststream) or [**IPersistStreamInit**](/windows/desktop/api/OCIdl/nn-ocidl-ipersiststreaminit) (the two are mutually exclusive and shouldn't be implemented together for the most part).</span></span> <span data-ttu-id="2ff11-106">Второй вариант используется, когда элемент управления должен иметь представление о создании нового, а не на перезагрузку из существующего постоянного состояния (в **IPersistStream** нет созданной новой возможности).</span><span class="sxs-lookup"><span data-stu-id="2ff11-106">The latter is used when a control wishes to know when it is created new as opposed to reloaded from an existing persistent state (**IPersistStream** does not have the created new capability).</span></span> <span data-ttu-id="2ff11-107">Существование любого интерфейса указывает, что элемент управления может сохранить и загрузить его постоянное состояние в поток, то есть экземпляр [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream).</span><span class="sxs-lookup"><span data-stu-id="2ff11-107">The existence of either interface indicates that the control can save and load its persistent state into a stream, that is, an instance of [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream).</span></span>

<span data-ttu-id="2ff11-108">Помимо этих двух интерфейсов, основанных на потоках, интерфейсы IPersist, \* перечисленные в следующей таблице, можно дополнительно предоставить для поддержки сохранения в расположениях, отличных от развертываемого [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream).</span><span class="sxs-lookup"><span data-stu-id="2ff11-108">Beyond these two stream-based interfaces, the IPersist\* interfaces listed in the following table can be optionally provided in order to support persistence to locations other than an expandable [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream).</span></span>

<span data-ttu-id="2ff11-109">Определен набор категорий компонентов, чтобы охватить поддержку интерфейсов сохраняемости, см. [категории компонентов](component-categories.md).</span><span class="sxs-lookup"><span data-stu-id="2ff11-109">A set of component categories is identified to cover the support for persistency interfaces see [Component Categories](component-categories.md).</span></span>



| <span data-ttu-id="2ff11-110">Интерфейс</span><span class="sxs-lookup"><span data-stu-id="2ff11-110">Interface</span></span>                                                              | <span data-ttu-id="2ff11-111">Использование</span><span class="sxs-lookup"><span data-stu-id="2ff11-111">Usage</span></span>                                                                                                                                                                                                                                                                                                                                                       |
|------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="2ff11-112">[**иперсистмемори**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768210(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="2ff11-112">[**IPersistMemory**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768210(v=vs.85))</span></span><br/>           | <span data-ttu-id="2ff11-113">Объект может сохранять и загружать свое состояние в последовательный массив байтов фиксированной длины (в памяти).</span><span class="sxs-lookup"><span data-stu-id="2ff11-113">The object can save and load its state into a fixed-length sequential byte array (in memory).</span></span><br/>                                                                                                                                                                                                                                                    |
| [<span data-ttu-id="2ff11-114">**иперсистстораже**</span><span class="sxs-lookup"><span data-stu-id="2ff11-114">**IPersistStorage**</span></span>](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststorage)<br/>                  | <span data-ttu-id="2ff11-115">Объект может сохранить и загрузить его состояние в экземпляр [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="2ff11-115">The object can save and load its state into an [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) instance.</span></span> <span data-ttu-id="2ff11-116">Элементы управления, которые необходимо пометить как вставляемые как другие объекты составного документа (для вставки в контейнеры, не поддерживающие управление), должны поддерживать этот интерфейс.</span><span class="sxs-lookup"><span data-stu-id="2ff11-116">Controls that wish to be marked Insertable as other compound document objects (for insertion into non-control aware containers) must support this interface.</span></span><br/>                                                                                               |
| [<span data-ttu-id="2ff11-117">**IPersistPropertyBag**</span><span class="sxs-lookup"><span data-stu-id="2ff11-117">**IPersistPropertyBag**</span></span>](/windows/win32/api/ocidl/nn-ocidl-ipersistpropertybag)<br/> | <span data-ttu-id="2ff11-118">Объект может сохранять и загружать свое состояние как отдельные свойства, записываемые в Ипропертибаг, реализуемые контейнером.</span><span class="sxs-lookup"><span data-stu-id="2ff11-118">The object can save and load its state as individual properties written to IPropertyBag which the container implements.</span></span> <span data-ttu-id="2ff11-119">Он используется для функции Сохранить как текст в некоторых контейнерах.</span><span class="sxs-lookup"><span data-stu-id="2ff11-119">This is used for Save As Text functionality in some containers.</span></span><br/>                                                                                                                                                          |
| <span data-ttu-id="2ff11-120">[**иперсистмоникер**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="2ff11-120">[**IPersistMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85))</span></span><br/>  | <span data-ttu-id="2ff11-121">Объект может сохранять и загружать свое состояние в расположение с именем моникера.</span><span class="sxs-lookup"><span data-stu-id="2ff11-121">The object can save and load its state to a location named by a moniker.</span></span> <span data-ttu-id="2ff11-122">Элемент управления вызывает [**IMoniker:: биндтостораже**](/windows/desktop/api/ObjIdl/nf-objidl-imoniker-bindtostorage) для получения требуемого интерфейса хранилища, например [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage), [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream), [**ILockBytes**](/windows/desktop/api/objidl/nn-objidl-ilockbytes), [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject)и т. д.</span><span class="sxs-lookup"><span data-stu-id="2ff11-122">The control calls [**IMoniker::BindToStorage**](/windows/desktop/api/ObjIdl/nf-objidl-imoniker-bindtostorage) to retrieve the storage interface it requires, such as [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage), [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream), [**ILockBytes**](/windows/desktop/api/objidl/nn-objidl-ilockbytes), [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject), etc.</span></span><br/> |



 

<span data-ttu-id="2ff11-123">Хотя поддержка [**IPersistPropertyBag**](/windows/win32/api/ocidl/nn-ocidl-ipersistpropertybag) является необязательной, настоятельно рекомендуется использовать ее в качестве оптимизации для контейнеров с функциями "Сохранить как текст", например Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="2ff11-123">While support for [**IPersistPropertyBag**](/windows/win32/api/ocidl/nn-ocidl-ipersistpropertybag) is optional, it is strongly recommended as an optimization for containers with Save As Text features, such as Visual Basic.</span></span>

<span data-ttu-id="2ff11-124">За исключением [**IPersistStream:: жетсиземакс**](/windows/desktop/api/ObjIdl/nf-objidl-ipersiststream-getsizemax), [**Иперсистстреаминит:: жетсиземакс**](/windows/desktop/api/OCIdl/nf-ocidl-ipersiststreaminit-getsizemax)и [**иперсистмемори:: жетсиземакс**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768208(v=vs.85)), все методы каждого интерфейса должны быть полностью реализованы.</span><span class="sxs-lookup"><span data-stu-id="2ff11-124">With the exception of [**IPersistStream::GetSizeMax**](/windows/desktop/api/ObjIdl/nf-objidl-ipersiststream-getsizemax), [**IPersistStreamInit::GetSizeMax**](/windows/desktop/api/OCIdl/nf-ocidl-ipersiststreaminit-getsizemax), and [**IPersistMemory::GetSizeMax**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768208(v=vs.85)), all methods of each interface must be fully implemented.</span></span>

## <a name="related-topics"></a><span data-ttu-id="2ff11-125">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="2ff11-125">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2ff11-126">Элементы управления</span><span class="sxs-lookup"><span data-stu-id="2ff11-126">Controls</span></span>](controls.md)
</dt> </dl>

 

