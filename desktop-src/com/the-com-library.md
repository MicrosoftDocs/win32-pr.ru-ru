---
title: Библиотека COM
description: Библиотека COM
ms.assetid: 51d4db4a-ad88-4627-8140-2f7906945752
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a285a89ca659907c37f92b7d00f3e3e04d0acf51
ms.sourcegitcommit: 307b14e9847ced354a52a1ac12d7f659722d99bb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2020
ms.locfileid: "103987257"
---
# <a name="the-com-library"></a><span data-ttu-id="63751-103">Библиотека COM</span><span class="sxs-lookup"><span data-stu-id="63751-103">The COM Library</span></span>

<span data-ttu-id="63751-104">Любой процесс, использующий COM, должен инициализировать и деинициализировать библиотеку COM.</span><span class="sxs-lookup"><span data-stu-id="63751-104">Any process that uses COM must both initialize and uninitialize the COM library.</span></span> <span data-ttu-id="63751-105">Помимо спецификации, COM также реализует некоторые важные службы в этой библиотеке.</span><span class="sxs-lookup"><span data-stu-id="63751-105">In addition to being a specification, COM also implements some important services in this library.</span></span> <span data-ttu-id="63751-106">Библиотека COM, предоставляемая в качестве набора библиотек DLL и exe (в основном Ole32.dll и Rpcss.exe) в Microsoft Windows, включает в себя следующее:</span><span class="sxs-lookup"><span data-stu-id="63751-106">Provided as a set of DLLs and EXEs (primarily Ole32.dll and Rpcss.exe) in Microsoft Windows, the COM library includes the following:</span></span>

-   <span data-ttu-id="63751-107">Небольшое количество фундаментальных функций, упрощающих создание приложений COM, как клиента, так и сервера.</span><span class="sxs-lookup"><span data-stu-id="63751-107">A small number of fundamental functions that facilitate the creation of COM applications, both client and server.</span></span> <span data-ttu-id="63751-108">Для клиентов COM предоставляет базовые функции для создания объектов.</span><span class="sxs-lookup"><span data-stu-id="63751-108">For clients, COM supplies basic functions for creating objects.</span></span> <span data-ttu-id="63751-109">Для серверов COM предоставляет средства предоставления своих объектов.</span><span class="sxs-lookup"><span data-stu-id="63751-109">For servers, COM supplies the means of exposing their objects.</span></span>

-   <span data-ttu-id="63751-110">Службы локатора, с помощью которых определяется COM, от уникального идентификатора класса (CLSID), на котором сервер реализует этот класс и где расположен этот сервер.</span><span class="sxs-lookup"><span data-stu-id="63751-110">Implementation-locator services through which COM determines, from a unique class identifier (CLSID), which server implements that class and where that server is located.</span></span> <span data-ttu-id="63751-111">Эта служба включает поддержку уровня косвенного обращения, обычно системного реестра, между удостоверением класса объекта и упаковкой реализации, чтобы клиенты не зависели от упаковки, что может измениться в будущем.</span><span class="sxs-lookup"><span data-stu-id="63751-111">This service includes support for a level of indirection, usually a system registry, between the identity of an object class and the packaging of the implementation so that clients are independent of the packaging, which can change in the future.</span></span>

-   <span data-ttu-id="63751-112">Прозрачные удаленные вызовы процедур, когда объект выполняется на локальном или удаленном сервере.</span><span class="sxs-lookup"><span data-stu-id="63751-112">Transparent remote procedure calls when an object is running in a local or remote server.</span></span>

-   <span data-ttu-id="63751-113">Стандартный механизм, позволяющий приложению управлять распределением памяти внутри процесса, в частности, память, которая должна передаваться между соработаными объектами, чтобы ее можно было освободить правильно.</span><span class="sxs-lookup"><span data-stu-id="63751-113">A standard mechanism to allow an application to control how memory is allocated within its process, particularly memory that needs to be passed between cooperating objects so that it can be freed properly.</span></span>

<span data-ttu-id="63751-114">Для использования базовых служб COM все COM-потоки выполнения на клиентах и серверах вне обработки должны вызывать функцию [**CoInitialize**](/windows/desktop/api/Objbase/nf-objbase-coinitialize) или [**CoInitializeEx**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializeex) перед вызовом любой другой функции COM, за исключением вызовов выделения памяти.</span><span class="sxs-lookup"><span data-stu-id="63751-114">To use basic COM services, all COM threads of execution in clients and out-of-process servers must call either the [**CoInitialize**](/windows/desktop/api/Objbase/nf-objbase-coinitialize) or the [**CoInitializeEx**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializeex) function before calling any other COM function except memory allocation calls.</span></span> <span data-ttu-id="63751-115">**CoInitializeEx** заменяет другую функцию, добавляя параметр, который позволяет указать потоковую модель потока: потоковое или беспотокное.</span><span class="sxs-lookup"><span data-stu-id="63751-115">**CoInitializeEx** replaces the other function, adding a parameter that allows you to specify the threading model of the thread: either apartment-threaded or free-threaded.</span></span> <span data-ttu-id="63751-116">Вызов функции **CoInitialize** просто устанавливает потоковую модель в потоковое подразделение.</span><span class="sxs-lookup"><span data-stu-id="63751-116">A call to **CoInitialize** simply sets the threading model to apartment-threaded.</span></span>

<span data-ttu-id="63751-117">Приложения составного документа OLE вызывают функцию [**олеинитиализе**](/windows/desktop/api/Ole2/nf-ole2-oleinitialize) , которая вызывает [**CoInitializeEx**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializeex) , а также выполняет некоторую инициализацию, необходимую для составных документов.</span><span class="sxs-lookup"><span data-stu-id="63751-117">OLE compound document applications call the [**OleInitialize**](/windows/desktop/api/Ole2/nf-ole2-oleinitialize) function, which calls [**CoInitializeEx**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializeex) and also does some initialization required for compound documents.</span></span> <span data-ttu-id="63751-118">Таким образом, потоки, вызывающие **олеинитиализе** , не могут быть свободными потоками.</span><span class="sxs-lookup"><span data-stu-id="63751-118">Therefore, threads that call **OleInitialize** cannot be free-threaded.</span></span> <span data-ttu-id="63751-119">Сведения о потоках в клиентах и серверах см. в разделе [процессы, потоки и подразделения](processes--threads--and-apartments.md).</span><span class="sxs-lookup"><span data-stu-id="63751-119">For information on threading in clients and servers, see [Processes, Threads, and Apartments](processes--threads--and-apartments.md).</span></span>

<span data-ttu-id="63751-120">Внутрипроцессный сервер не вызывает функции инициализации, так как они загружаются в процесс, который уже сделал это.</span><span class="sxs-lookup"><span data-stu-id="63751-120">In-process servers do not call the initialization functions because they are being loaded into a process that has already done so.</span></span> <span data-ttu-id="63751-121">В результате внутрипроцессный серверы должны задать свою потоковую модель в реестре в разделе [InprocServer32](inprocserver32.md) Key.</span><span class="sxs-lookup"><span data-stu-id="63751-121">As a result, in-process servers must set their threading model in the registry under the [InprocServer32](inprocserver32.md) key.</span></span> <span data-ttu-id="63751-122">Подробные сведения о проблемах с потоками в внутрипроцессного серверах см. в разделе [проблемы потоковой обработки на сервере](in-process-server-threading-issues.md).</span><span class="sxs-lookup"><span data-stu-id="63751-122">For detailed information on threading issues in in-process servers, see [In-Process Server Threading Issues](in-process-server-threading-issues.md).</span></span>

<span data-ttu-id="63751-123">Также важно отменить инициализацию библиотеки.</span><span class="sxs-lookup"><span data-stu-id="63751-123">It is also important to uninitialize the library.</span></span> <span data-ttu-id="63751-124">Для каждого вызова [**CoInitialize**](/windows/desktop/api/Objbase/nf-objbase-coinitialize) или [**CoInitializeEx**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializeex)должен быть соответствующий вызов [**CoUninitialize**](/windows/desktop/api/combaseapi/nf-combaseapi-couninitialize).</span><span class="sxs-lookup"><span data-stu-id="63751-124">For each call to [**CoInitialize**](/windows/desktop/api/Objbase/nf-objbase-coinitialize) or [**CoInitializeEx**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializeex), there must be a corresponding call to [**CoUninitialize**](/windows/desktop/api/combaseapi/nf-combaseapi-couninitialize).</span></span> <span data-ttu-id="63751-125">Для каждого вызова [**олеинитиализе**](/windows/desktop/api/Ole2/nf-ole2-oleinitialize)должен быть соответствующий вызов [**олеунинитиализе**](/windows/desktop/api/Ole2/nf-ole2-oleuninitialize).</span><span class="sxs-lookup"><span data-stu-id="63751-125">For each call to [**OleInitialize**](/windows/desktop/api/Ole2/nf-ole2-oleinitialize), there must be a corresponding call to [**OleUninitialize**](/windows/desktop/api/Ole2/nf-ole2-oleuninitialize).</span></span>

<span data-ttu-id="63751-126">Внутрипроцессный сервер может предположить, что процесс, в который они загружаются, уже выполнил эти действия.</span><span class="sxs-lookup"><span data-stu-id="63751-126">In-process servers can assume that the process they are being loaded into has already performed these steps.</span></span>

## <a name="related-topics"></a><span data-ttu-id="63751-127">См. также</span><span class="sxs-lookup"><span data-stu-id="63751-127">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="63751-128">Модель COM</span><span class="sxs-lookup"><span data-stu-id="63751-128">The Component Object Model</span></span>](the-component-object-model.md)
</dt> </dl>

 

 




