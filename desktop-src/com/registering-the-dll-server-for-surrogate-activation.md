---
title: Регистрация сервера DLL для активации суррогатных символов
description: Регистрация сервера DLL для активации суррогатных символов
ms.assetid: 7133daa4-43b2-402e-a8ac-b357bea745d9
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0ca0af764bebf54590442f87f0b4ffdb1a681012
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "103793999"
---
# <a name="registering-the-dll-server-for-surrogate-activation"></a>Регистрация сервера DLL для активации суррогатных символов

Сервер DLL будет загружен в суррогатный процесс при следующих условиях:

-   В ключе CLSID в реестре должно быть указано значение AppID и соответствующий ключ [AppID](appid-key.md) .
-   При вызове активации устанавливается бит [**\_ локального \_ сервера клскткс**](/windows/win32/api/wtypesbase/ne-wtypesbase-clsctx) , а в ключе CLSID не указывается [LocalServer32](localserver32.md), [локалсервер](localserver.md)или [LocalService](localservice.md). Если заданы другие биты **клскткс** , то следует соблюдать [**алгоритм обработки**](/windows/win32/api/wtypesbase/ne-wtypesbase-clsctx)для флагов внутрипроцессного, локального или удаленного выполнения.
-   Ключ CLSID содержит подраздел [InprocServer32](inprocserver32.md) .
-   Прокси-Библиотека DLL или заглушка, указанная в ключе **InprocServer32** , существует.
-   Значение [дллсуррогате](dllsurrogate.md) существует в ключе **AppID** .

Если имеется **локалсервер**, **LocalServer32** или **LocalService**, указывающий на существование exe-файла, то сервер или служба exe всегда будут запускаться в предпочтение для загрузки сервера DLL в суррогатный процесс.

Для выполнения суррогатной активации необходимо указать **дллсуррогате** именованное значение. Активация относится к вызовам любой из следующих функций активации:

-   [**кожетклассобжект**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject)
-   [**кокреатеинстанцеекс**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstanceex)
-   [**кожетинстанцефромфиле**](/windows/desktop/api/Objbase/nf-objbase-cogetinstancefromfile)
-   [**кожетинстанцефромистораже**](/windows/desktop/api/Objbase/nf-objbase-cogetinstancefromistorage)
-   [**IMoniker:: Биндтубжект**](/windows/desktop/api/ObjIdl/nf-objidl-imoniker-bindtoobject)

Чтобы запустить экземпляр заданного системой суррогата, установите значение **дллсуррогате** либо в пустую строку, либо в **null**. Чтобы указать запуск пользовательского суррогата, задайте в качестве значения путь к суррогату.

Если для одного и того же AppID указаны оба [ремотесервернаме](remoteservername.md) и **Дллсуррогате** , значение **ремотесервернаме** игнорируется, а значение **дллсуррогате** вызывает активацию на локальном компьютере. Для удаленной суррогатной активации укажите **ремотесервернаме** , но не **дллсуррогате** на клиенте и укажите **дллсуррогате** на сервере.

Сервер DLL, предназначенный для постоянного запуска в собственном суррогатном процессе, лучше настроить с AppID, равным его CLSID. В разделе **AppID** просто укажите **дллсуррогате** именованное значение с пустым строковым значением.

Лучше всего настроить сервер DLL, предназначенный для работы в собственном суррогатном процессе, а также для обслуживания нескольких клиентов в сети с использованием значения [runas](runas.md) , указанного в разделе реестра **AppID** . Указывает, определяет ли **runas** "Интерактивный пользователь" или конкретное удостоверение пользователя, зависит от пользовательского интерфейса, безопасности и других требований к серверу. Если указано значение **runas** , то для обслуживания всех клиентов загружается только один экземпляр сервера, независимо от удостоверения клиента. С другой стороны, не настраивайте сервер с помощью **runas** , если требуется, чтобы один экземпляр сервера DLL, выполняющийся в суррогате, выполнял обслуживание каждого удаленного клиента.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Требования к серверу DLL](dll-server-requirements.md)
</dt> <dt>

[Общий доступ к суррогатам](surrogate-sharing.md)
</dt> </dl>

 

 