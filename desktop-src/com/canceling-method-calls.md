---
title: Отмена вызовов метода
description: С появлением распределенных и веб-приложений некоторые вызовы методов могут занимать неприемлемые длительное время.
ms.assetid: 18228ff1-8c1c-430a-ae5f-0e9a56b0fe3c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d2e2a78f042e528036135df4865e8a454cd687da
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "105710375"
---
# <a name="canceling-method-calls"></a>Отмена вызовов метода

С появлением распределенных и веб-приложений некоторые вызовы методов могут занимать неприемлемые длительное время. Задержка сетевого подключения может быть высокой, компьютер сервера может обслуживать много клиентов, или серверный компонент может передавать большой объем данных, например файл мультимедиа. Пользователи должны иметь возможность отменить запрос, который занимает слишком много времени, и приложение должно иметь возможность обрабатывать запросы отмены и продолжать работу. В модели COM можно использовать интерфейс [**IMessageFilter**](/windows/desktop/api/ObjIdl/nn-objidl-imessagefilter) для отмены ожидающего вызова, полученного из однопотокового подразделения.

При маршалировании вызова прокси-сервер создает объект Cancel, который реализует интерфейс [**иканцелмесодкаллс**](/windows/win32/api/objidlbase/nn-objidlbase-icancelmethodcalls) . Объект Cancel связан с вызовом и потоком, в котором ожидается вызов.

Чтобы отменить отложенный вызов, клиент передает запрос на отмену через объект Cancel, который обрабатывает сведения об уведомлении объекта сервера о том, что вызов был отменен. Если вызванный метод не возвращает, объект сервера, при обнаружении запроса на отмену, очищает все выделенные ресурсы программы и уведомляет его клиента, возвращая соответствующее значение **HRESULT** , после чего выполнение вызова отменяется. Если вызванный метод уже был возвращен, объект Cancel уведомляет клиента. В любом случае клиентский поток разблокируется и может продолжать обработку.

Ответ серверного объекта на запрос отмены — это на усмотрение разработчиков сервера, но вызывающий поток на клиенте всегда будет разблокирован и будет игнорировать все результаты, которые сервер пытается передать в него. Объекты Cancel предоставляют средства для запроса на отмену выполнения текущего метода, но нет никакой гарантии, что объект сервера прекратит обработку вызова. Например, вызов может быть уже возвращен, или серверный объект не поддерживает отмену объектов.

COM автоматически предоставляет стандартную реализацию отмены объектов для клиентских объектов и интерфейсов, использующих стандартную упаковку. Для объектов и интерфейсов, использующих настраиваемое маршалирование, необходимо реализовать собственный объект Cancel.

В настоящее время объекты отмены обрабатывают только синхронные вызовы.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Отмена асинхронного вызова](canceling-an-asynchronous-call.md)
</dt> <dt>

[**кожетканцелобжект**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetcancelobject)
</dt> <dt>

[**косетканцелобжект**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetcancelobject)
</dt> <dt>

[**котестканцел**](/windows/desktop/api/combaseapi/nf-combaseapi-cotestcancel)
</dt> </dl>

 

 