---
title: Просмотр кэширования
description: Просмотр кэширования
ms.assetid: d19c111c-1367-43a2-97a9-35dc0ff5dcc8
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 592c5bc2555e907cdc4e600465b807387c3a5548
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "104413797"
---
# <a name="view-caching"></a><span data-ttu-id="8c822-103">Просмотр кэширования</span><span class="sxs-lookup"><span data-stu-id="8c822-103">View Caching</span></span>

<span data-ttu-id="8c822-104">Приложение-контейнер должно иметь возможность получить представление объекта в целях отображения или печати для пользователей, если документ открыт, но серверное приложение этого объекта не работает или не установлено на компьютере пользователя.</span><span class="sxs-lookup"><span data-stu-id="8c822-104">A container application must be able to obtain a presentation of an object for the purpose of displaying or printing it for users when the document is open but the object's server application is not running or is not installed on the user's machine.</span></span> <span data-ttu-id="8c822-105">Тем не менее, предположим, что серверы для всех объектов, которые могут быть найдены в документе, установлены на каждом компьютере пользователя и всегда могут выполняться по требованию — нереалистичные.</span><span class="sxs-lookup"><span data-stu-id="8c822-105">To assume, however, that the servers for all the objects that might conceivably be found in a document are installed on every user's machine and can always run on demand is unrealistic.</span></span> <span data-ttu-id="8c822-106">Обработчик объектов по умолчанию, который доступен в любое время, решает эту дилеммой путем кэширования презентаций объектов в хранилище документа и манипулирования этими презентациями на любой платформе независимо от ущерба объекта сервера при любой конкретной установке контейнера.</span><span class="sxs-lookup"><span data-stu-id="8c822-106">The default object handler, which is available at all times, solves this dilemma by caching object presentations in the document's storage and manipulating these presentations on any platform regardless of the availablility of the object server on any particular installation of the container.</span></span>

<span data-ttu-id="8c822-107">Контейнеры могут поддерживать Рисование презентаций для одного или нескольких конкретных целевых устройств в дополнение к тому, которое требуется для обслуживания объекта на экране.</span><span class="sxs-lookup"><span data-stu-id="8c822-107">Containers can maintain drawing presentations for one or more specific target devices in addition to the one required to maintain the object on screen.</span></span> <span data-ttu-id="8c822-108">Более того, при переносе объекта с одной платформы на другую OLE автоматически преобразует форматы данных объекта в объекты, поддерживаемые на новой платформе.</span><span class="sxs-lookup"><span data-stu-id="8c822-108">Moreover, if you port the object from one platform to another, OLE automatically converts the object's data formats to ones supported on the new platform.</span></span> <span data-ttu-id="8c822-109">Например, если вы перемещаете объект из Windows на Macintosh, то OLE преобразует свои презентации метафайлов в форматы PICT.</span><span class="sxs-lookup"><span data-stu-id="8c822-109">For example, if you move an object from Windows to the Macintosh, OLE will convert its metafile presentations to PICT formats.</span></span>

<span data-ttu-id="8c822-110">Чтобы представить пользователю точное представление о внедренном объекте, приложение-контейнер объекта запускает диалоговое окно с обработчиком объекта, запрашивая данные и инструкции по рисованию.</span><span class="sxs-lookup"><span data-stu-id="8c822-110">In order to present an accurate representation of an embedded object to the user, the object's container application initiates a dialog with the object handler, requesting data and drawing instructions.</span></span> <span data-ttu-id="8c822-111">Для выполнения запросов контейнера обработчик должен реализовать интерфейсы [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject), [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2)и [**иолекаче**](/windows/desktop/api/OleIdl/nn-oleidl-iolecache) .</span><span class="sxs-lookup"><span data-stu-id="8c822-111">To be able to fulfill the container's requests, the handler must implement the [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject), [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2), and [**IOleCache**](/windows/desktop/api/OleIdl/nn-oleidl-iolecache) interfaces.</span></span>

<span data-ttu-id="8c822-112">[**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) позволяет приложению контейнера OLE получать данные из внедренных или связанных объектов и передавать их в них.</span><span class="sxs-lookup"><span data-stu-id="8c822-112">[**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) enables an OLE container application to get data from and send data to its embedded or linked objects.</span></span> <span data-ttu-id="8c822-113">При изменении данных в объекте этот интерфейс предоставляет объекту возможность сделать свои новые данные доступными для контейнера и предоставляет контейнеру способ обновления данных в своей копии объекта.</span><span class="sxs-lookup"><span data-stu-id="8c822-113">When data changes in an object, this interface provides a way for the object to make its new data available to its container and provides the container with a way to update the data in its copy of the object.</span></span> <span data-ttu-id="8c822-114">(Обсуждение передаваемых данных в целом см. в главе 4 Передача данных.)</span><span class="sxs-lookup"><span data-stu-id="8c822-114">(For a discussion of data transfer in general, see Chapter 4, Data Transfer.)</span></span>

<span data-ttu-id="8c822-115">Интерфейс [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2) очень похож на интерфейс [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) , за исключением того, что он запрашивает у объекта прорисовку себя в контексте устройства, таком как экран, изображение или метафайл, вместо того, чтобы перемещать или копировать данные в память или другой носитель передачи.</span><span class="sxs-lookup"><span data-stu-id="8c822-115">The [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2) interface is very much like the [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) interface except that it asks an object to draw itself on a device context, such as a screen, printer, or metafile, rather than move or copy its data to memory or some other transfer medium.</span></span> <span data-ttu-id="8c822-116">Этот интерфейс предназначен для того, чтобы контейнер OLE получал альтернативные виде рисунков представления своих внедренных объектов, чьи данные уже существуют, тем самым избегая издержек на перемещение совершенно новых экземпляров одних и тех же объектов данных просто для получения новых инструкций рисования.</span><span class="sxs-lookup"><span data-stu-id="8c822-116">The purpose of the interface is to enable an OLE container to obtain alternative pictorial representations of its embedded objects, whose data it already has, thereby avoiding the overhead of having to transfer entirely new instances of the same data objects simply to obtain new drawing instructions.</span></span> <span data-ttu-id="8c822-117">Вместо этого интерфейс **IViewObject2** позволяет контейнеру запрашивать объект для предоставления собственного виде рисунков представления путем рисования в контексте устройства, заданном в контейнере.</span><span class="sxs-lookup"><span data-stu-id="8c822-117">Instead, the **IViewObject2** interface enables the container to ask an object to provide a pictorial representation of itself by drawing on a device context specified by the container.</span></span>

<span data-ttu-id="8c822-118">При вызове интерфейса [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2) приложение-контейнер может также указать, что объект рисует себя на целевом устройстве, отличном от того, на котором оно будет фактически подготовлено к просмотру.</span><span class="sxs-lookup"><span data-stu-id="8c822-118">When calling the [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2) interface, a container application can also specify that the object draw itself on a target device different than the one on which it will actually be rendered.</span></span> <span data-ttu-id="8c822-119">Это позволяет контейнеру при необходимости формировать различные рендерингы из одного объекта.</span><span class="sxs-lookup"><span data-stu-id="8c822-119">This enables the container, as needed, to generate different renderings from a single object.</span></span> <span data-ttu-id="8c822-120">Например, вызывающая сторона может попросить объект создать себя для принтера, даже если итоговый рисунок будет отображен на экране.</span><span class="sxs-lookup"><span data-stu-id="8c822-120">For example, the caller could ask the object to compose itself for a printer even though the resulting drawing will be rendered on screen.</span></span> <span data-ttu-id="8c822-121">Результатом, конечно, будет предварительный просмотр объекта.</span><span class="sxs-lookup"><span data-stu-id="8c822-121">The result, of course, would be a print-preview of the object.</span></span>

<span data-ttu-id="8c822-122">Интерфейс [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2)также предоставляет методы, позволяющие регистрировать в контейнерах уведомления об изменениях представления.</span><span class="sxs-lookup"><span data-stu-id="8c822-122">The [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2)interface also provides methods that enable containers to register for view-change notifications.</span></span> <span data-ttu-id="8c822-123">Как и в случае с данными и рекомендациями OLE, соединение с советами по представлениям позволяет контейнеру обновлять его отрисовку объекта на свое удобство, а не в ответ на вызов из объекта.</span><span class="sxs-lookup"><span data-stu-id="8c822-123">As with data and OLE advisories, a view advisory connection enables a container to update its renderings of an object at its own convenience rather than in response to a call from the object.</span></span> <span data-ttu-id="8c822-124">Например, если новая версия серверного приложения объекта предложит дополнительные представления одних и тех же данных, обработчик по умолчанию объекта вызовет реализацию [**иадвисесинк:: онвиевчанже**](/windows/desktop/api/ObjIdl/nf-objidl-iadvisesink-onviewchange) каждого контейнера, чтобы сообщить им о том, что новые презентации были доступны.</span><span class="sxs-lookup"><span data-stu-id="8c822-124">For example, if a new version of an object's server application were to offer additional views of the same data, the object's default handler would call each container's implementation of [**IAdviseSink::OnViewChange**](/windows/desktop/api/ObjIdl/nf-objidl-iadvisesink-onviewchange) to let them know that the new presentations were available.</span></span> <span data-ttu-id="8c822-125">Контейнер будет извлекать эти сведения из приемника уведомлений только при необходимости.</span><span class="sxs-lookup"><span data-stu-id="8c822-125">The container would retrieve this information from the advise sink only when needed.</span></span>

<span data-ttu-id="8c822-126">Поскольку контексты устройств Windows имеют значение только в пределах одного процесса, нельзя передавать [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2) указатели между процессами.</span><span class="sxs-lookup"><span data-stu-id="8c822-126">Because Windows device contexts have meaning only within a single process, you cannot pass [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2) pointers across process boundaries.</span></span> <span data-ttu-id="8c822-127">Как следствие, для реализации интерфейса на локальном и удаленном серверах OLE не требуется никакой конкретной работы, даже если бы они не работали должным образом.</span><span class="sxs-lookup"><span data-stu-id="8c822-127">As a result, OLE local and remote servers have no need whatsoever to implement the interface, which wouldn't work properly even if they did.</span></span> <span data-ttu-id="8c822-128">Интерфейс **IViewObject2** реализует только обработчики объектов и внутрипроцессный сервер.</span><span class="sxs-lookup"><span data-stu-id="8c822-128">Only object handlers and in-process servers implement the **IViewObject2** interface.</span></span> <span data-ttu-id="8c822-129">OLE предоставляет реализацию по умолчанию, которую можно использовать в собственных серверах обработки и обработчиках объектов OLE, просто выполнив статистическую обработку обработчика OLE по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="8c822-129">OLE provides a default implementation, which you can use in your own OLE in-process servers and object handlers simply by aggregating the OLE default handler.</span></span> <span data-ttu-id="8c822-130">Или можно написать собственную реализацию **IViewObject2**.</span><span class="sxs-lookup"><span data-stu-id="8c822-130">Or you can write your own implementation of **IViewObject2**.</span></span>

<span data-ttu-id="8c822-131">Объект реализует интерфейс [**иолекаче**](/windows/desktop/api/OleIdl/nn-oleidl-iolecache) , чтобы обработчик мог узнать, какие возможности он должен кэшировать.</span><span class="sxs-lookup"><span data-stu-id="8c822-131">An object implements the [**IOleCache**](/windows/desktop/api/OleIdl/nn-oleidl-iolecache) interface in order to let the handler know what capabilities it should cache.</span></span> <span data-ttu-id="8c822-132">Обработчик объектов также владеет кэшем и гарантирует актуальность.</span><span class="sxs-lookup"><span data-stu-id="8c822-132">The object handler also owns the cache and ensures it is kept up to date.</span></span> <span data-ttu-id="8c822-133">Когда внедренный объект переходит в состояние выполнения, обработчик настраивает соответствующие советы в отношении серверного объекта с самого себя в качестве приемника.</span><span class="sxs-lookup"><span data-stu-id="8c822-133">As the embedded object enters the running state, the handler sets up appropriate advisory connections on the server object, with itself acting as the sink.</span></span> <span data-ttu-id="8c822-134">Реализации интерфейса [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) и [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2)исполняют данные, кэшированные на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="8c822-134">The [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) and [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2)interface implementations operate out of data cached on the client side.</span></span> <span data-ttu-id="8c822-135">Реализация **IViewObject2** в обработчике отвечает за определение того, какие форматы данных кэшировать для удовлетворения запросов рисования клиента.</span><span class="sxs-lookup"><span data-stu-id="8c822-135">The handler's implementation of **IViewObject2** is responsible for determining what data formats to cache in order to satisfy client draw requests.</span></span> <span data-ttu-id="8c822-136">Реализация интерфейса **IDataObject** в обработчике отвечает за получение данных в различных форматах и т. д. между памятью и базовым экземпляром [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) внедренного объекта.</span><span class="sxs-lookup"><span data-stu-id="8c822-136">The handler's implementation of **IDataObject** is responsible for getting data in various formats, etc., between memory and the underlying [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) instance of the embedded object.</span></span> <span data-ttu-id="8c822-137">Пользовательские обработчики могут использовать эти реализации путем статистической обработки в обработчике по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="8c822-137">Custom handlers can use these implementations by aggregating on the default handler.</span></span>

> [!Note]  
> <span data-ttu-id="8c822-138">Интерфейс [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2) — это простое функциональное расширение [**ивиевобжект**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject) , которое следует реализовать вместо последнего интерфейса, который теперь устарел.</span><span class="sxs-lookup"><span data-stu-id="8c822-138">The [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2) interface is a simple functional extension of [**IViewObject**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject) and should be implemented instead of the latter interface, which is now obsolete.</span></span> <span data-ttu-id="8c822-139">В дополнение к методам **ивиевобжект** , интерфейс **IViewObject2** предоставляет один дополнительный [**член, GetObject, который**](/windows/desktop/api/OleIdl/nf-oleidl-iviewobject2-getextent)позволяет приложению-контейнеру получить размер представления объекта из кэша без предварительного перемещения объекта в состояние выполнения с вызовом [**иолеобжект::**](/windows/desktop/api/OleIdl/nf-oleidl-ioleobject-getextent)GetObject.</span><span class="sxs-lookup"><span data-stu-id="8c822-139">In addition to providing the **IViewObject** methods, the **IViewObject2** interface provides a single additional member, [**GetExtent**](/windows/desktop/api/OleIdl/nf-oleidl-iviewobject2-getextent), which enables a container application to get the size of an object's presentation from the cache without first having to move the object into the running state with a call to [**IOleObject::GetExtent**](/windows/desktop/api/OleIdl/nf-oleidl-ioleobject-getextent).</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="8c822-140">См. также</span><span class="sxs-lookup"><span data-stu-id="8c822-140">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8c822-141">Составные документы</span><span class="sxs-lookup"><span data-stu-id="8c822-141">Compound Documents</span></span>](compound-documents.md)
</dt> </dl>

 

 