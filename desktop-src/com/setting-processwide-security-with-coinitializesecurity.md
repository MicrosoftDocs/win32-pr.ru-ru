---
title: Настройка безопасности Process-Wide с помощью CoInitializeSecurity
description: Функция CoInitializeSecurity позволяет управлять сложными сценариями безопасности, устанавливая параметры безопасности приложения программным способом.
ms.assetid: 20b66868-fb9a-489f-97a2-59a8a825c8d9
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 567a6dfaf47dbd278fc248558cd25969c733b24a
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "104413853"
---
# <a name="setting-process-wide-security-with-coinitializesecurity"></a><span data-ttu-id="0f57d-103">Настройка безопасности Process-Wide с помощью CoInitializeSecurity</span><span class="sxs-lookup"><span data-stu-id="0f57d-103">Setting Process-Wide Security with CoInitializeSecurity</span></span>

<span data-ttu-id="0f57d-104">Функция [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) позволяет управлять сложными сценариями безопасности, устанавливая параметры безопасности приложения программным способом.</span><span class="sxs-lookup"><span data-stu-id="0f57d-104">The [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) function allows you to control complex security scenarios by setting security for an application programmatically.</span></span> <span data-ttu-id="0f57d-105">В этом разделе описываются сценарии использования **CoInitializeSecurity** и приводятся некоторые сведения об их использовании.</span><span class="sxs-lookup"><span data-stu-id="0f57d-105">This topic describes scenarios when you might use **CoInitializeSecurity** and provides some details on how you use it.</span></span>

<span data-ttu-id="0f57d-106">Существует несколько причин, по которым может потребоваться использовать [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) для установки безопасности на уровне процесса в рамках программы.</span><span class="sxs-lookup"><span data-stu-id="0f57d-106">There are several reasons why you might want to use [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) to set process-wide security within your program.</span></span> <span data-ttu-id="0f57d-107">Например, можно задать уровень проверки подлинности и разрешения на доступ к приложению с помощью dcomcnfg.exe. уровень олицетворения по умолчанию для компьютера может быть не тем, который вы хотите использовать для процесса.</span><span class="sxs-lookup"><span data-stu-id="0f57d-107">For example, although you can set the authentication level and the access permissions for the application using dcomcnfg.exe, the default impersonation level for the computer might not be the one you want for your process.</span></span> <span data-ttu-id="0f57d-108">Единственный способ изменить этот параметр для процесса — вызвать **CoInitializeSecurity**.</span><span class="sxs-lookup"><span data-stu-id="0f57d-108">The only way to change this setting for your process is to call **CoInitializeSecurity**.</span></span>

<span data-ttu-id="0f57d-109">Если вы хотите использовать поставщик безопасности SChannel, необходимо указать его в качестве службы проверки подлинности в вызове [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity).</span><span class="sxs-lookup"><span data-stu-id="0f57d-109">If you want to use the Schannel security provider, you must specify it as an authentication service in a call to [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity).</span></span>

<span data-ttu-id="0f57d-110">Другой распространенный сценарий, в котором безопасность на уровне процесса можно установить программно, — когда необходимо установить безопасность по умолчанию для всего процесса, но имеется один или несколько объектов в этом процессе, которые предоставляют интерфейсы с особыми требованиями к безопасности.</span><span class="sxs-lookup"><span data-stu-id="0f57d-110">Another common scenario in which you might set process-wide security programmatically is when you would like to set default security for the entire process but you have one or more objects within that process that expose interfaces with special security requirements.</span></span> <span data-ttu-id="0f57d-111">В этом случае можно вызвать [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) , чтобы настроить безопасность для процесса, позволяя COM обрабатывать большинство проверок безопасности, а также вызывать другие методы для настройки безопасности объектов с особыми требованиями к безопасности.</span><span class="sxs-lookup"><span data-stu-id="0f57d-111">In this case, you can call [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) to set security for the process, allowing COM to handle most of the security checks, and you can call other methods to set security for the objects with special security needs.</span></span> <span data-ttu-id="0f57d-112">Вызов этих методов и функций описывается в разделе [Настройка безопасности на уровне прокси-сервера интерфейса](setting-security-at-the-interface-proxy-level.md).</span><span class="sxs-lookup"><span data-stu-id="0f57d-112">Calling these methods and functions is described in [Setting Security at the Interface Proxy Level](setting-security-at-the-interface-proxy-level.md).</span></span>

<span data-ttu-id="0f57d-113">Если приложение имеет очень специализированные требования к безопасности, такие как предоставление определенным группам доступа к различным объектам в зависимости от времени суток, может потребоваться программно управлять всей безопасностью, гарантируя, что COM не будет выполнять автоматическую проверку.</span><span class="sxs-lookup"><span data-stu-id="0f57d-113">If your application has very specialized security requirements, such as allowing certain groups access to different objects depending on the time of day, you might want to handle all of your security programmatically, ensuring that COM does no automatic checking for you at all.</span></span> <span data-ttu-id="0f57d-114">Для этого необходимо вызвать [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), присвоив параметру *двауснлевел* значение None, а параметр *pVoid* — **значение NULL**.</span><span class="sxs-lookup"><span data-stu-id="0f57d-114">To do this, you must call [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), setting the *dwAuthnLevel* parameter to none and the *pVoid* parameter to **NULL**.</span></span> <span data-ttu-id="0f57d-115">При наличии собственного пакета безопасности его также необходимо зарегистрировать в параметре *пауснсвк* .</span><span class="sxs-lookup"><span data-stu-id="0f57d-115">If you have your own security package you would also need to register it in the *pAuthnSvc* parameter.</span></span> <span data-ttu-id="0f57d-116">Затем вы можете управлять всеми собственными средствами безопасности с помощью вызовов интерфейса уровня прокси-сервера и функций, описанных в разделе [Настройка безопасности на уровне прокси интерфейса](setting-security-at-the-interface-proxy-level.md).</span><span class="sxs-lookup"><span data-stu-id="0f57d-116">Then you can handle all of your own security programmatically through calls to the proxy-level interface and functions described in [Setting Security at the Interface Proxy Level](setting-security-at-the-interface-proxy-level.md).</span></span>

<span data-ttu-id="0f57d-117">[**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) предлагает широкий набор возможностей.</span><span class="sxs-lookup"><span data-stu-id="0f57d-117">[**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) offers a rich set of capabilities.</span></span> <span data-ttu-id="0f57d-118">При вызове **CoInitializeSecurity** значения реестра игнорируются, а вместо них используются значения инициализации безопасности, передаваемые в вызов.</span><span class="sxs-lookup"><span data-stu-id="0f57d-118">If you call **CoInitializeSecurity**, the registry values are ignored and the security initialization values you pass in to the call are used instead.</span></span> <span data-ttu-id="0f57d-119">В зависимости от нужного результата первый параметр, *pVoid*, может указывать на три различных типа значений: [**\_ дескриптор безопасности**](/windows/desktop/api/winnt/ns-winnt-security_descriptor) , объект [**иакцессконтрол**](/windows/desktop/api/IAccess/nn-iaccess-iaccesscontrol) или указатель на AppID.</span><span class="sxs-lookup"><span data-stu-id="0f57d-119">Depending on the result you want, the first parameter, *pVoid*, can point to three different types of values: a [**SECURITY\_DESCRIPTOR**](/windows/desktop/api/winnt/ns-winnt-security_descriptor) , an [**IAccessControl**](/windows/desktop/api/IAccess/nn-iaccess-iaccesscontrol) object, or a pointer to an AppID.</span></span> <span data-ttu-id="0f57d-120">В большинстве случаев для создания **\_ дескриптора безопасности** , который будет указывать *pVoid* , будут использоваться функции Windows.</span><span class="sxs-lookup"><span data-stu-id="0f57d-120">In most cases, you will use Windows functions to create a **SECURITY\_DESCRIPTOR** that *pVoid* will point to.</span></span>

<span data-ttu-id="0f57d-121">Однако *pVoid* также может указывать на объект [**иакцессконтрол**](/windows/desktop/api/IAccess/nn-iaccess-iaccesscontrol) .</span><span class="sxs-lookup"><span data-stu-id="0f57d-121">However, *pVoid* can also point to an [**IAccessControl**](/windows/desktop/api/IAccess/nn-iaccess-iaccesscontrol) object.</span></span>

<span data-ttu-id="0f57d-122">Чтобы указать [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) , что объект [**иакцессконтрол**](/windows/desktop/api/IAccess/nn-iaccess-iaccesscontrol) передается *pVoid*, необходимо передать \_ значение управления доступом еоак в \_ параметр *двкапабилитиес* .</span><span class="sxs-lookup"><span data-stu-id="0f57d-122">To indicate to [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) that you are passing an [**IAccessControl**](/windows/desktop/api/IAccess/nn-iaccess-iaccesscontrol) object to *pVoid*, you must pass the EOAC\_ACCESS\_CONTROL value to the *dwCapabilities* parameter.</span></span> <span data-ttu-id="0f57d-123">Так как **CoInitializeSecurity** кэширует результаты проверок доступа, список управления доступом не должен изменяться после вызова **CoInitializeSecurity**.</span><span class="sxs-lookup"><span data-stu-id="0f57d-123">Since **CoInitializeSecurity** caches the results of access checks, the access control list must not be changed after calling **CoInitializeSecurity**.</span></span>

<span data-ttu-id="0f57d-124">Другой тип значения, который можно передать в параметр *pVoid* , — это указатель на идентификатор GUID, который является идентификатором приложения.</span><span class="sxs-lookup"><span data-stu-id="0f57d-124">Another type of value you can pass to the *pVoid* parameter is a pointer to a GUID, which is the AppID of your application.</span></span> <span data-ttu-id="0f57d-125">Если *pVoid* является указателем на AppID, необходимо указать еоак \_ AppID в параметре *пкапабилитиес* , чтобы функция знала, какое значение должно быть в *pVoid*.</span><span class="sxs-lookup"><span data-stu-id="0f57d-125">If *pVoid* is a pointer to an AppID, you must specify EOAC\_APPID in the *pCapabilities* parameter so that the function knows what value to expect in *pVoid*.</span></span> <span data-ttu-id="0f57d-126">Если *pVoid* указывает на AppID, [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) использует только реестр для значений проверки подлинности и игнорирует все остальные параметры до **CoInitializeSecurity**.</span><span class="sxs-lookup"><span data-stu-id="0f57d-126">If *pVoid* points to an AppID, [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) uses only the registry for authentication values and ignores all other parameters to **CoInitializeSecurity**.</span></span>

## <a name="related-topics"></a><span data-ttu-id="0f57d-127">См. также</span><span class="sxs-lookup"><span data-stu-id="0f57d-127">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="0f57d-128">Настройка безопасности Process-Wide</span><span class="sxs-lookup"><span data-stu-id="0f57d-128">Setting Process-Wide Security</span></span>](setting-processwide-security.md)
</dt> </dl>

 

 