---
title: Сохраняемость
description: Сохраняемость
ms.assetid: 4916ea52-a21c-4938-81cb-392b5ca1f6c1
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c6cffab1c9a0f2746e57e356a90698caf9903deb
ms.sourcegitcommit: f848119a8faa29b27585f4df53f6e50ee9666684
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2021
ms.locfileid: "110549289"
---
# <a name="persistence"></a><span data-ttu-id="bf890-103">Сохраняемость</span><span class="sxs-lookup"><span data-stu-id="bf890-103">Persistence</span></span>

<span data-ttu-id="bf890-104">Элемент управления реализует один или несколько интерфейсов сохраняемости для поддержки сохранения состояния.</span><span class="sxs-lookup"><span data-stu-id="bf890-104">A control implements one or more of several persistence interfaces to support persistence of its state.</span></span> <span data-ttu-id="bf890-105">Например, интерфейс [**иперсистстреаминит**](/windows/desktop/api/OCIdl/nn-ocidl-ipersiststreaminit) поддерживает сохраняемость состояния элемента управления на основе потока.</span><span class="sxs-lookup"><span data-stu-id="bf890-105">For example, the [**IPersistStreamInit**](/windows/desktop/api/OCIdl/nn-ocidl-ipersiststreaminit) interface supports stream-based persistence of the control's state.</span></span> <span data-ttu-id="bf890-106">**Иперсистстреаминит** является заменой для [**IPersistStream**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststream) и добавляет метод инициализации [**InitNew**](/windows/desktop/api/OCIdl/nf-ocidl-ipersiststreaminit-initnew).</span><span class="sxs-lookup"><span data-stu-id="bf890-106">**IPersistStreamInit** is a replacement for [**IPersistStream**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststream) and adds an initialization method, [**InitNew**](/windows/desktop/api/OCIdl/nf-ocidl-ipersiststreaminit-initnew).</span></span> <span data-ttu-id="bf890-107">Другие методы одинаковы в обоих интерфейсах.</span><span class="sxs-lookup"><span data-stu-id="bf890-107">The other methods are the same in both interfaces.</span></span> <span data-ttu-id="bf890-108">**Иперсистстреаминит** не является производным от **IPersistStream**; объект поддерживает только один из двух интерфейсов в зависимости от того, требует ли он возможности инициализировать новые экземпляры.</span><span class="sxs-lookup"><span data-stu-id="bf890-108">**IPersistStreamInit** is not derived from **IPersistStream**; an object supports only one of the two interfaces based on whether it requires the ability to initialize new instances of itself.</span></span>

<span data-ttu-id="bf890-109">Другие интерфейсы сохраняемости, которые может предложить элемент управления, включают: [**иперсистстораже**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststorage), [**иперсистмемори**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768210(v=vs.85)), [**IPersistPropertyBag**](/windows/win32/api/ocidl/nn-ocidl-ipersistpropertybag), [**иперсистмоникер**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="bf890-109">Other persistence interfaces that a control can offer include: [**IPersistStorage**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststorage), [**IPersistMemory**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768210(v=vs.85)), [**IPersistPropertyBag**](/windows/win32/api/ocidl/nn-ocidl-ipersistpropertybag), [**IPersistMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85)).</span></span> <span data-ttu-id="bf890-110">Разработчик элемента управления должен решить, какие типы сохраняемости наиболее важны, и реализовать соответствующие интерфейсы сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="bf890-110">The control implementer must decide what kinds of persistence are most important and implement the appropriate persistence interfaces.</span></span> <span data-ttu-id="bf890-111">Разработчик элемента управления также решает, что сохранять.</span><span class="sxs-lookup"><span data-stu-id="bf890-111">The control implementer also decides what to save.</span></span> <span data-ttu-id="bf890-112">Например, элемент управления может сохранять текущие значения его свойств, а также его расположение и размер в пределах контейнера.</span><span class="sxs-lookup"><span data-stu-id="bf890-112">For example, a control can save the current values of its properties or its location and size within its container.</span></span> <span data-ttu-id="bf890-113">Клиент решает, какой интерфейс предпочтительнее использовать.</span><span class="sxs-lookup"><span data-stu-id="bf890-113">The client decides which interface it prefers to use.</span></span>

<span data-ttu-id="bf890-114">Перед загрузкой элемента управления из его постоянного состояния клиент может проверить флаг ОЛЕМИСК \_ сетклиентситефирст, чтобы определить, поддерживает ли элемент управления получение его клиентского сайта и внешних свойств перед загрузкой его постоянного состояния.</span><span class="sxs-lookup"><span data-stu-id="bf890-114">Before loading a control from its persistent state, a client can check the OLEMISC\_SETCLIENTSITEFIRST flag to determine if the control supports getting its client site and ambient properties before loading its persistent state.</span></span> <span data-ttu-id="bf890-115">Такая оптимизация позволяет экономить время при создании экземпляра элемента управления, так как после этого элемент управления может игнорировать его постоянные значения, а не загружать их только для того, чтобы они переопределялись внешними свойствами, предоставленными клиентом.</span><span class="sxs-lookup"><span data-stu-id="bf890-115">This optimization can save time when instantiating a control since the control is then free to ignore its persistent values rather than loading them only to have them overridden by ambient properties supplied by the client.</span></span>

<span data-ttu-id="bf890-116">Элемент управления может также поддерживать сохранение и восстановление его состояния в наборе свойств OLE, набор идентификаторов и значений в указанном формате.</span><span class="sxs-lookup"><span data-stu-id="bf890-116">A control can also support saving and restoring its state in an OLE property set, a set of identifiers and values in a specified format.</span></span> <span data-ttu-id="bf890-117">Эта функция может быть полезна для контейнеров, таких как Visual Basic, которые сохраняют свои программы в текстовой форме.</span><span class="sxs-lookup"><span data-stu-id="bf890-117">This feature can be useful with containers such as Visual Basic, which saves its programs in a textual form.</span></span> <span data-ttu-id="bf890-118">Элемент управления, который хочет поддерживать эту функцию, реализует интерфейс [**IDataObject:: GetData**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-getdata) и [**IDataObject:: SetData**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-setdata) для передачи его значений свойств в контейнер и из контейнера соответственно.</span><span class="sxs-lookup"><span data-stu-id="bf890-118">A control that wants to support this feature implements [**IDataObject::GetData**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-getdata) and [**IDataObject::SetData**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-setdata) to pass its property values to and from the container, respectively.</span></span> <span data-ttu-id="bf890-119">Это задание контейнера для преобразования этих данных в текст и их сохранения.</span><span class="sxs-lookup"><span data-stu-id="bf890-119">It is the container's job to convert this information to text and save it.</span></span> <span data-ttu-id="bf890-120">Идентификаторы, используемые элементом управления, соответствуют именам и значениям свойств элемента управления.</span><span class="sxs-lookup"><span data-stu-id="bf890-120">The identifiers used by the control correspond to the control's property names and the values.</span></span> <span data-ttu-id="bf890-121">Определение этого набора свойств см. в разделе OLE CDK.</span><span class="sxs-lookup"><span data-stu-id="bf890-121">See the OLE CDK for the definition of this property set.</span></span>

## <a name="related-topics"></a><span data-ttu-id="bf890-122">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="bf890-122">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="bf890-123">Элементы управления ActiveX</span><span class="sxs-lookup"><span data-stu-id="bf890-123">ActiveX Controls</span></span>](activex-controls.md)
</dt> </dl>

 

 