---
description: Сокеты Windows 2 предлагают расширенный набор операций, которые могут возникать коинЦидент для установления подключения через сокет. Требования к поставщику услуг для реализации этих функций описаны ниже.
ms.assetid: fbc7055e-ea25-4d17-8039-f0fef300353c
title: Улучшенная функциональность во время подключения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d33c6d7ee928fe7e97f535363e9e842285eef7fe
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104145076"
---
# <a name="enhanced-functionality-at-connect-time"></a><span data-ttu-id="5041e-104">Улучшенная функциональность во время подключения</span><span class="sxs-lookup"><span data-stu-id="5041e-104">Enhanced Functionality at Connect Time</span></span>

<span data-ttu-id="5041e-105">Сокеты Windows 2 предлагают расширенный набор операций, которые могут возникать коинЦидент для установления подключения через сокет.</span><span class="sxs-lookup"><span data-stu-id="5041e-105">Windows Sockets 2 offers an expanded set of operations that can occur coincident to establishing a socket connection.</span></span> <span data-ttu-id="5041e-106">Требования к поставщику услуг для реализации этих функций описаны ниже.</span><span class="sxs-lookup"><span data-stu-id="5041e-106">The service provider requirements for implementing these features are described below.</span></span>

## <a name="conditional-acceptance"></a><span data-ttu-id="5041e-107">Условное принятие</span><span class="sxs-lookup"><span data-stu-id="5041e-107">Conditional Acceptance</span></span>

<span data-ttu-id="5041e-108">Как было сказано ранее, [**вспакцепт**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept) вызывает предоставляемую клиентом функцию условия, которая использует входные параметры для предоставления сведений о ожидающем запросе на подключение.</span><span class="sxs-lookup"><span data-stu-id="5041e-108">As described previously, [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept) invokes a client-supplied condition function that uses input parameters to supply information about the pending connection request.</span></span> <span data-ttu-id="5041e-109">Эта информация может использоваться клиентом для принятия или отклонения запроса на подключение на основе информации вызывающего объекта, такой как идентификатор вызывающего объекта, качество обслуживания и т. д. Если функция условия возвращает параметр CF \_ Accept, то создается новый сокет с теми же свойствами, что и у прослушивающего сокета, и возвращается новый обработчик для нового сокета.</span><span class="sxs-lookup"><span data-stu-id="5041e-109">This information can be used by the client to accept or reject a connection request based on caller information such as caller identifier, QoS, etc. If the condition function returns CF\_ACCEPT, a new socket is created with the same properties as the listening socket, and a handle to the new socket is returned.</span></span> <span data-ttu-id="5041e-110">Если функция условия возвращает значение CF \_ Reject, запрос на соединение должен быть отклонен.</span><span class="sxs-lookup"><span data-stu-id="5041e-110">If the condition function returns CF\_REJECT, the connection request should be rejected.</span></span> <span data-ttu-id="5041e-111">Если функция условия возвращает значение CF \_ , принятие или отклонение не может быть сделано немедленно, и поставщик услуг должен оставить запрос на соединение в очереди невыполненной работы.</span><span class="sxs-lookup"><span data-stu-id="5041e-111">If the condition function returns CF\_DEFER, the accept/reject decision cannot be made immediately, and the service provider must leave the connection request on the backlog queue.</span></span> <span data-ttu-id="5041e-112">Клиент должен вызвать **вспакцепт** снова, когда он готов принять решение, и организовать функцию условия, чтобы она возвращала либо \_ отклонить CF Accept, либо CF \_ .</span><span class="sxs-lookup"><span data-stu-id="5041e-112">The client must call **WSPAccept** again, when it is ready to make a decision, and arrange for the condition function to return either CF\_ACCEPT or CF\_REJECT.</span></span> <span data-ttu-id="5041e-113">Хотя отложенный запрос на подключение находится в верхней части очереди невыполненной работы, поставщик услуг не выдает никаких дальнейших указаний для ожидающих запросов на подключение.</span><span class="sxs-lookup"><span data-stu-id="5041e-113">While a deferred connection request is at the top of the backlog queue, the service provider does not issue any further indications for pending connection requests.</span></span>

## <a name="exchanging-user-data-at-connect-time"></a><span data-ttu-id="5041e-114">Обмен данными пользователя во время подключения</span><span class="sxs-lookup"><span data-stu-id="5041e-114">Exchanging User Data at Connect Time</span></span>

<span data-ttu-id="5041e-115">Некоторые протоколы позволяют обмениваться небольшим количеством пользовательских данных во время подключения.</span><span class="sxs-lookup"><span data-stu-id="5041e-115">Some protocols allow a small amount of user data to be exchanged at connect time.</span></span> <span data-ttu-id="5041e-116">Если эти данные были получены с подключенного узла, они помещаются в буфер поставщика услуг, а указатель на этот буфер вместе со значением длины передается клиенту Winsock SPI посредством входных параметров функции условия [**вспакцепт**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept) .</span><span class="sxs-lookup"><span data-stu-id="5041e-116">If such data has been received from the connecting host, it is placed in a service provider buffer, and a pointer to this buffer along with a length value are supplied to the Winsock SPI client through input parameters to the [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept) condition function.</span></span> <span data-ttu-id="5041e-117">Если клиент Winsock SPI имеет ответные данные для возврата к узлу подключения, он может скопировать его в буфер, предоставленный поставщиком услуг.</span><span class="sxs-lookup"><span data-stu-id="5041e-117">If the Winsock SPI client has response data to return to the connecting host, it may copy this into a buffer that is supplied by the service provider.</span></span> <span data-ttu-id="5041e-118">Указатель на этот буфер и целое число, указывающие размер буфера, также предоставляются в качестве входных параметров функции условия (если поддерживается протоколом).</span><span class="sxs-lookup"><span data-stu-id="5041e-118">A pointer to this buffer and an integer indicating buffer size are also supplied as condition function input parameters (if supported by the protocol).</span></span>

## <a name="establishing-socket-groups"></a><span data-ttu-id="5041e-119">Установка групп сокетов</span><span class="sxs-lookup"><span data-stu-id="5041e-119">Establishing Socket Groups</span></span>

<span data-ttu-id="5041e-120">Все использование групп сокетов зарезервировано.</span><span class="sxs-lookup"><span data-stu-id="5041e-120">All use of socket groups is reserved.</span></span>

 

 



