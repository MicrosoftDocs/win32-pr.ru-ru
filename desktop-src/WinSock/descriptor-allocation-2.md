---
description: Хотя поставщики услуг Windows Sockets рекомендуется применять в качестве объектов устанавливаемой файловой системы (IFS), архитектура Winsock также поддерживает поставщики услуг, чьи дескрипторы сокетов не являются объектами IFS.
ms.assetid: ed5e10f4-fa17-4a07-9cac-43767915b8e9
title: Распределение дескрипторов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 095301798eb850fc4eb63e1939712379b5ead85e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105701545"
---
# <a name="descriptor-allocation"></a><span data-ttu-id="73bbb-103">Распределение дескрипторов</span><span class="sxs-lookup"><span data-stu-id="73bbb-103">Descriptor Allocation</span></span>

<span data-ttu-id="73bbb-104">Хотя поставщики услуг Windows Sockets рекомендуется применять в качестве объектов устанавливаемой файловой системы (IFS), архитектура Winsock также поддерживает поставщики услуг, чьи дескрипторы сокетов не являются объектами IFS.</span><span class="sxs-lookup"><span data-stu-id="73bbb-104">While Windows Sockets service providers are encouraged to implement sockets as installable file system (IFS) objects, the Winsock architecture also accommodates service providers whose socket handles are not IFS objects.</span></span> <span data-ttu-id="73bbb-105">Поставщики с дескрипторами IFS указывают на это с \_ помощью \_ бита атрибута XP1 IFS в [**структуре \_ info всапротокол**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) .</span><span class="sxs-lookup"><span data-stu-id="73bbb-105">Providers with IFS handles indicate this through the XP1\_IFS\_HANDLES attribute bit in the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure.</span></span> <span data-ttu-id="73bbb-106">(Примечание. XP1 \_ \_Двоичные атрибуты дескрипторов IFS не включены в выпуск 2.0.8 спецификации API, но были добавлены с момента появления ошибки в механизме.) Клиенты Winsock SPI могут воспользоваться преимуществами поставщиков, дескрипторы сокетов которых представляют собой обработчики IFS с помощью этих дескрипторов со стандартными средствами ввода-вывода Windows, такими как [ReadFile](/windows/win32/api/fileapi/nf-fileapi-readfile) и [WriteFile](/windows/win32/api/fileapi/nf-fileapi-writefile).</span><span class="sxs-lookup"><span data-stu-id="73bbb-106">(Note: the XP1\_IFS\_HANDLES attribute bit was not included in release 2.0.8 of the API specification, but has since been added through the errata mechanism.) Winsock SPI clients may take advantage of providers whose socket descriptors are IFS handles by using these descriptors with standard Windows I/O facilities, such as [ReadFile](/windows/win32/api/fileapi/nf-fileapi-readfile) and [WriteFile](/windows/win32/api/fileapi/nf-fileapi-writefile).</span></span>

<span data-ttu-id="73bbb-107">Каждый раз, когда поставщик IFS создает новый дескриптор сокета, необходимо, чтобы поставщик вызывал [**впумодифифшандле**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle) перед предоставлением нового дескриптора клиенту SPI Windows Sockets.</span><span class="sxs-lookup"><span data-stu-id="73bbb-107">Whenever an IFS provider creates a new socket descriptor, it is mandatory that the provider call [**WPUModifyIFSHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle) prior to supplying the new handle to a Windows Sockets SPI client.</span></span> <span data-ttu-id="73bbb-108">Эта функция принимает идентификатор поставщика и предложенный обработчик IFS от поставщика в качестве входных данных и возвращает (возможно) измененный обработчик.</span><span class="sxs-lookup"><span data-stu-id="73bbb-108">This function takes a provider identifier and a proposed IFS handle from the provider as input and returns a (possibly) modified handle.</span></span> <span data-ttu-id="73bbb-109">Поставщик IFS должен предоставлять клиенту только измененный обработчик, и все запросы клиента будут ссылаться только на этот измененный обработчик.</span><span class="sxs-lookup"><span data-stu-id="73bbb-109">The IFS provider must supply only the modified handle to its client, and all requests from the client will reference only this modified handle.</span></span> <span data-ttu-id="73bbb-110">Измененный маркер является неразличимым от предложенного маркера, который касается операционной системы.</span><span class="sxs-lookup"><span data-stu-id="73bbb-110">The modified handle is guaranteed to be indistinguishable from the proposed handle as far as the operating system is concerned.</span></span> <span data-ttu-id="73bbb-111">Таким образом, в большинстве случаев поставщик услуг будет просто выбирать только измененный маркер во всей своей внутренней обработке.</span><span class="sxs-lookup"><span data-stu-id="73bbb-111">Thus in most instances, the service provider will simply choose to use only the modified handle in all of its internal processing.</span></span> <span data-ttu-id="73bbb-112">Эта функция изменения позволяет \_32.dll Ws2 значительно упростить процесс идентификации поставщика услуг, связанного с данным сокетом.</span><span class="sxs-lookup"><span data-stu-id="73bbb-112">The purpose of this modification function is to allow the Ws2\_32.dll to greatly streamline the process of identifying the service provider associated with a given socket.</span></span>

<span data-ttu-id="73bbb-113">Поставщики, не возвращающие дескрипторы IFS, должны получить допустимый дескриптор от \_32.dll Ws2 через вызов [**впукреатесоккесандле**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle) .</span><span class="sxs-lookup"><span data-stu-id="73bbb-113">Providers that do not return IFS handles must obtain a valid handle from the Ws2\_32.dll via the [**WPUCreateSocketHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle) call.</span></span> <span data-ttu-id="73bbb-114">Поставщик Нонифс должен предоставлять клиенту только 2.DLL сокетов Windows, и все запросы клиента будут ссылаться только на эти дескрипторы.</span><span class="sxs-lookup"><span data-stu-id="73bbb-114">The nonIFS provider must offer only a Windows Sockets 2.DLL-supplied handle to its client, and all requests from the client will reference only these handles.</span></span> <span data-ttu-id="73bbb-115">Для удобства реализации поставщика услуг одним из входных параметров, предоставляемых поставщиком в **впукреатесоккесандле** , является значение DWORD context.</span><span class="sxs-lookup"><span data-stu-id="73bbb-115">As a convenience to service provider implementers, one of the input parameters supplied by a provider in **WPUCreateSocketHandle** is a DWORD context value.</span></span> <span data-ttu-id="73bbb-116">Ws2 \_32.dll связывает это значение контекста с выделенным маркером сокета и позволяет поставщику услуг получить значение контекста в любое время через вызов [**впукуерисоккесандлеконтекст**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuquerysockethandlecontext) .</span><span class="sxs-lookup"><span data-stu-id="73bbb-116">The Ws2\_32.dll associates this context value with the allocated socket handle and allows a service provider to retrieve the context value at any time through the [**WPUQuerySocketHandleContext**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuquerysockethandlecontext) call.</span></span> <span data-ttu-id="73bbb-117">Обычно это значение контекста используется для хранения указателя на структуру данных, поддерживаемую поставщиком услуг, которая используется для хранения сведений о состоянии сокета.</span><span class="sxs-lookup"><span data-stu-id="73bbb-117">A typical use for this context value would be to store a pointer to a service provider maintained data structure used to store socket state information.</span></span>

 

 
