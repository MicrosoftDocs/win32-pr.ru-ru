---
description: Чтобы транспортный протокол был доступен через сокеты Windows, он должен быть правильно установлен в системе и зарегистрирован с помощью сокетов Windows.
ms.assetid: 0f0b22e4-81b7-43a7-bc2f-7124fa32d925
title: Настройка и установка транспорта
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ea980740f727e39338c7568f4cc30a961b5484df
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105701496"
---
# <a name="transport-configuration-and-installation"></a><span data-ttu-id="dc4e4-103">Настройка и установка транспорта</span><span class="sxs-lookup"><span data-stu-id="dc4e4-103">Transport Configuration and Installation</span></span>

<span data-ttu-id="dc4e4-104">Чтобы транспортный протокол был доступен через сокеты Windows, он должен быть правильно установлен в системе и зарегистрирован с помощью сокетов Windows.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-104">In order for a transport protocol to be accessible through Windows Sockets it must be properly installed on the system and registered with Windows Sockets.</span></span> <span data-ttu-id="dc4e4-105">При установке поставщика транспортной службы путем вызова программы установки поставщика необходимо добавить сведения о конфигурации в базу данных конфигурации, чтобы предоставить Ws2 \_32.dll необходимые сведения о поставщике услуг.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-105">When a transport service provider is installed by invoking a vendor's installation program, configuration information must be added to a configuration database to give the Ws2\_32.dll required information regarding the service provider.</span></span> <span data-ttu-id="dc4e4-106">Ws2 \_32.dll экспортирует несколько функций установки, [**ВсЦинсталлпровидер**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallprovider) и [**всЦинсталлпровидерандчаинс**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallproviderandchains), для программы установки поставщика, чтобы предоставить соответствующие сведения о устанавливаемом поставщике услуг.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-106">The Ws2\_32.dll exports several installation functions, [**WSCInstallProvider**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallprovider) and [**WSCInstallProviderAndChains**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallproviderandchains), for the vendor's installation program to supply the relevant information about the service provider to be installed.</span></span> <span data-ttu-id="dc4e4-107">Эти сведения включают, например, имя и путь к библиотеке DLL поставщика службы и список структур [**всапротокол \_ info**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) , которые может поддерживать этот поставщик.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-107">This information includes, for example, the name and path to the service provider DLL and a list of [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structures that this provider can support.</span></span> <span data-ttu-id="dc4e4-108">32.dll Ws2 \_ также предоставляет функцию [**вскдеинсталлпровидер**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscdeinstallprovider)для программы удаления поставщика, которая удаляет всю необходимую информацию из базы данных конфигурации, поддерживаемой \_32.dllом Ws2.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-108">The Ws2\_32.dll also provides a function, [**WSCDeinstallProvider**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscdeinstallprovider), for a vendor's deinstallation program to remove all the relevant information from the configuration database maintained by the Ws2\_32.dll.</span></span> <span data-ttu-id="dc4e4-109">Точное расположение и формат этих сведений о конфигурации являются частными для32.dll Ws2 \_ и могут управляться только описанными выше функциями.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-109">The exact location and format of this configuration information is private to the Ws2\_32.dll, and can only be manipulated by the above-mentioned functions.</span></span>

<span data-ttu-id="dc4e4-110">На 64-разрядных платформах существуют аналогичные функции, которые работают с каталогами с 32 и 64-bit.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-110">On 64-bit platforms, there are similar functions that operate on a 32-bit and 64-bit catalogs.</span></span> <span data-ttu-id="dc4e4-111">К этим функциям относятся [**WSCInstallProvider64 \_ 32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallprovider64_32), [**WSCInstallProviderAndChains64 \_ 32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallproviderandchains64_32)и [**WSCDeinstallProvider32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscdeinstallprovider32).</span><span class="sxs-lookup"><span data-stu-id="dc4e4-111">These functions include [**WSCInstallProvider64\_32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallprovider64_32), [**WSCInstallProviderAndChains64\_32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallproviderandchains64_32), and [**WSCDeinstallProvider32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscdeinstallprovider32).</span></span>

<span data-ttu-id="dc4e4-112">Порядок, в котором изначально устанавливаются поставщики транспортной службы, управляет порядком перечисления с помощью [**всценумпротоколс**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscenumprotocols) и [**WSCEnumProtocols32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscenumprotocols32) в интерфейсе поставщика услуг или через [**всаенумпротоколс**](/windows/desktop/api/Winsock2/nf-winsock2-wsaenumprotocolsa) в интерфейсе приложения.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-112">The order in which transport service providers are initially installed governs the order in which they are enumerated through [**WSCEnumProtocols**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscenumprotocols) and [**WSCEnumProtocols32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscenumprotocols32) at the service provider interface, or through [**WSAEnumProtocols**](/windows/desktop/api/Winsock2/nf-winsock2-wsaenumprotocolsa) at the application interface.</span></span> <span data-ttu-id="dc4e4-113">Что более важно, этот порядок также управляет порядком, в котором протоколы и поставщики услуг рассматриваются, когда клиент запрашивает создание сокета на основе его семейства адресов, типа и идентификатора протокола.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-113">More importantly, this order also governs the order in which protocols and service providers are considered when a client requests creation of a socket based on its address family, type, and protocol identifier.</span></span> <span data-ttu-id="dc4e4-114">Сокеты Windows 2 включают приложение с именем Sporder.exe, которое позволяет интерактивно изменять каталог установленных протоколов после установки уже установленных протоколов.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-114">Windows Sockets 2 includes an applet called Sporder.exe that allows the catalog of installed protocols to be reordered interactively after protocols have already been installed.</span></span> <span data-ttu-id="dc4e4-115">Сокеты Windows 2 также включают вспомогательную библиотеку DLL, Sporder.dll, которая экспортирует процедурный интерфейс для переупорядочения протоколов.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-115">Windows Sockets 2 also includes an auxiliary DLL, Sporder.dll, that exports a procedural interface for reordering protocols.</span></span> <span data-ttu-id="dc4e4-116">Этот процедурный интерфейс состоит из одной процедуры, именуемой [**всквритепровидерордер**](/windows/desktop/api/Sporder/nf-sporder-wscwriteproviderorder).</span><span class="sxs-lookup"><span data-stu-id="dc4e4-116">This procedural interface consists of a single procedure called [**WSCWriteProviderOrder**](/windows/desktop/api/Sporder/nf-sporder-wscwriteproviderorder).</span></span>

## <a name="installing-layered-protocols-and-protocol-chains"></a><span data-ttu-id="dc4e4-117">Установка многоуровневых протоколов и цепочек протоколов</span><span class="sxs-lookup"><span data-stu-id="dc4e4-117">Installing Layered Protocols and Protocol Chains</span></span>

<span data-ttu-id="dc4e4-118">Структура [**\_ сведений всапротокол**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) , предоставляемая для каждого устанавливаемого протокола, указывает, является ли протокол базовым протоколом, многоуровневый протоколом или цепочкой протоколов.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-118">The [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure supplied with each protocol to be installed indicates whether the protocol is a base protocol, layered protocol, or protocol chain.</span></span> <span data-ttu-id="dc4e4-119">Значение параметра *протоколчаин. чаинлен* интерпретируется, как показано в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-119">The value of the *ProtocolChain.ChainLen* parameter is interpreted as shown in the following table.</span></span>

| <span data-ttu-id="dc4e4-120">Значение</span><span class="sxs-lookup"><span data-stu-id="dc4e4-120">Value</span></span> | <span data-ttu-id="dc4e4-121">Значение</span><span class="sxs-lookup"><span data-stu-id="dc4e4-121">Meaning</span></span>                                           |
|-------|---------------------------------------------------|
| <span data-ttu-id="dc4e4-122">0</span><span class="sxs-lookup"><span data-stu-id="dc4e4-122">0</span></span>     | <span data-ttu-id="dc4e4-123">Многоуровневый протокол.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-123">Layered protocol.</span></span>                                 |
| <span data-ttu-id="dc4e4-124">1</span><span class="sxs-lookup"><span data-stu-id="dc4e4-124">1</span></span>     | <span data-ttu-id="dc4e4-125">Базовый протокол (или цепочка с одним компонентом).</span><span class="sxs-lookup"><span data-stu-id="dc4e4-125">Base protocol (or chain with only one component).</span></span> |
| <span data-ttu-id="dc4e4-126">>1</span><span class="sxs-lookup"><span data-stu-id="dc4e4-126">>1</span></span> | <span data-ttu-id="dc4e4-127">Цепочка протоколов.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-127">Protocol chain.</span></span>                                   |



 

<span data-ttu-id="dc4e4-128">Установка цепочек протоколов может происходить только после успешной установки всех составляющих компонентов (базовых протоколов и многоуровневых протоколов).</span><span class="sxs-lookup"><span data-stu-id="dc4e4-128">Installation of protocol chains can only occur after successful installation of all of the constituent components (base protocols and layered protocols).</span></span> <span data-ttu-id="dc4e4-129">Структура [**\_ сведений о всапротокол**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) для цепочки протоколов использует параметр *протоколчаин* для описания длины цепочки и удостоверения каждого компонента.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-129">The [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure for a protocol chain uses the *ProtocolChain* parameter to describe the length of the chain and the identity of each component.</span></span> <span data-ttu-id="dc4e4-130">Отдельные протоколы, составляющие цепочку, перечислены по порядку в массиве Протоколчаин. Чаинентриес с элементом начальном массива, соответствующим первому многоуровневый поставщику.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-130">The individual protocols that make up a chain are listed in order in the ProtocolChain.ChainEntries array, with the zeroth element of the array corresponding to the first layered provider.</span></span> <span data-ttu-id="dc4e4-131">Протоколы идентифицируются по значениям *каталожентрид* , которые назначаются Ws2 \_32.dll в процессе установки протокола, и их можно найти в структуре **\_ сведений о всапротокол** для каждого протокола.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-131">Protocols are identified by their *CatalogEntryID* values, which are assigned by the Ws2\_32.dll at protocol installation time, and can be found in the **WSAPROTOCOL\_INFO** structure for each protocol.</span></span>

<span data-ttu-id="dc4e4-132">Значения для остальных параметров в структуре протокола [**всапротокол \_ info**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) должны быть выбраны для отражения атрибутов и идентификаторов, которые лучше всего характеризуют цепочку протоколов в целом.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-132">The values for the remaining parameters in the protocol chain's [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure should be chosen to reflect the attributes and identifiers that best characterize the protocol chain as a whole.</span></span> <span data-ttu-id="dc4e4-133">При выборе этих значений разработчики должны учитывать, что обмен данными через цепочки протоколов может происходить только в том случае, если на обеих конечных точках установлены совместимые цепочки протоколов, и эти приложения должны иметь возможность распознать соответствующую структуру **всапротокол \_ info** .</span><span class="sxs-lookup"><span data-stu-id="dc4e4-133">When selecting these values, developers should bear in mind that communications over protocol chains can only occur when both endpoints have compatible protocol chains installed, and that applications must be able to recognize the corresponding **WSAPROTOCOL\_INFO** structure.</span></span>

<span data-ttu-id="dc4e4-134">При установке базового протокола нет необходимости делать записи в массиве *протоколчаин. чаинентриес* .</span><span class="sxs-lookup"><span data-stu-id="dc4e4-134">When a base protocol is installed, it is not necessary to make any entries in the *ProtocolChain.ChainEntries* array.</span></span> <span data-ttu-id="dc4e4-135">Неявно понимается, что единственный компонент этой цепочки уже определен в параметре *каталожентрид* той же структуры [**всапротокол \_ info**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) .</span><span class="sxs-lookup"><span data-stu-id="dc4e4-135">It is implicitly understood that the sole component of this chain is already identified in the *CatalogEntryID* parameter of the same [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure.</span></span> <span data-ttu-id="dc4e4-136">Также обратите внимание, что цепочки протоколов не могут включать несколько экземпляров одного многоуровневого протокола.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-136">Also note that protocol chains may not include multiple instances of the same layered protocol.</span></span>

 

 
