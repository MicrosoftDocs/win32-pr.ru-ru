---
description: Как упоминалось ранее, функция Всажоинлеаф используется для присоединение конечного узла к сеансу MultiPoint.
ms.assetid: eaa1593a-36eb-4d92-a3d9-91566fc0216b
title: Использование Всажоинлеаф
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 027262a117edc5541a4809481aa4607837343b4f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103910299"
---
# <a name="using-wsajoinleaf"></a><span data-ttu-id="ae58e-103">Использование Всажоинлеаф</span><span class="sxs-lookup"><span data-stu-id="ae58e-103">Using WSAJoinLeaf</span></span>

<span data-ttu-id="ae58e-104">Как упоминалось ранее, функция [**всажоинлеаф**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) используется для присоединение конечного узла к сеансу MultiPoint.</span><span class="sxs-lookup"><span data-stu-id="ae58e-104">As mentioned previously, the function [**WSAJoinLeaf**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) is used to join a leaf node into a multipoint session.</span></span> <span data-ttu-id="ae58e-105">**Всажоинлеаф** имеет те же параметры и семантику, что и [**всаконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) , за исключением того, что она возвращает дескриптор сокета (как в [**всаакцепт**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept)) и имеет дополнительный параметр *dwFlags* .</span><span class="sxs-lookup"><span data-stu-id="ae58e-105">**WSAJoinLeaf** has the same parameters and semantics as [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) except that it returns a socket descriptor (as in [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept)), and it has an additional *dwFlags* parameter.</span></span>

<span data-ttu-id="ae58e-106">Параметр *dwFlags* используется для указания того, будет ли сокет действовать только как отправитель, только как получатель или как и то, и другое.</span><span class="sxs-lookup"><span data-stu-id="ae58e-106">The *dwFlags* parameter is used to indicate whether the socket will be acting only as a sender, only as a receiver, or both.</span></span> <span data-ttu-id="ae58e-107">*В этой* функции для входных параметров можно использовать только сокеты MultiPoint.</span><span class="sxs-lookup"><span data-stu-id="ae58e-107">Only multipoint sockets may be used for input parameter *s* in this function.</span></span> <span data-ttu-id="ae58e-108">Если сокет MultiPoint находится в неблокирующем режиме, возвращаемый дескриптор сокета не может использоваться до тех пор, пока \_ не будет получено соответствующее указание на подключение фильтра.</span><span class="sxs-lookup"><span data-stu-id="ae58e-108">If the multipoint socket is in nonblocking mode, the returned socket descriptor is not usable until after a corresponding FD\_CONNECT indication is received.</span></span> <span data-ttu-id="ae58e-109">Корневое приложение в сеансе MultiPoint может вызвать [**всажоинлеаф**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) один или несколько раз, чтобы добавить несколько конечных узлов, однако одновременно может выполняться не более одного запроса на подключение MultiPoint.</span><span class="sxs-lookup"><span data-stu-id="ae58e-109">A root application in a multipoint session may call [**WSAJoinLeaf**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) one or more times in order to add a number of leaf nodes, however at most one multipoint connection request may be outstanding at a time.</span></span>

<span data-ttu-id="ae58e-110">Дескриптор сокета, возвращаемый функцией [**всажоинлеаф**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) , зависит от того, является ли дескриптор входного сокета, корнем *c,* \_ или \_ конечным листом c.</span><span class="sxs-lookup"><span data-stu-id="ae58e-110">The socket descriptor returned by [**WSAJoinLeaf**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) differs depending on whether the input socket descriptor, *s*, is a c\_root or a c\_leaf.</span></span> <span data-ttu-id="ae58e-111">При использовании с \_ корневым сокетом c параметр *Name* обозначает добавляемый конечный узел, а возвращаемый дескриптор сокета — конечный сокет c, \_ соответствующий вновь добавленному конечному узлу.</span><span class="sxs-lookup"><span data-stu-id="ae58e-111">When used with a c\_root socket, the *name* parameter designates a particular leaf node to be added and the returned socket descriptor is a c\_leaf socket corresponding to the newly added leaf node.</span></span> <span data-ttu-id="ae58e-112">Он не предназначен для использования в обмене данными MultiPoint, но используется для получения появления "демо \_ -# xxx" (например, \_ "Демон закрытия") для соединения, которое существует для конкретного листа c \_ .</span><span class="sxs-lookup"><span data-stu-id="ae58e-112">It is not intended to be used for the exchange of multipoint data, but rather it is used to receive FD\_XXX indications (for example, FD\_CLOSE) for the connection that exists to the particular c\_leaf.</span></span> <span data-ttu-id="ae58e-113">Некоторые реализации MultiPoint также могут разрешить использование этого сокета для побочных сеансов между корнем и отдельным конечным узлом.</span><span class="sxs-lookup"><span data-stu-id="ae58e-113">Some multipoint implementations may also allow this socket to be used for side chats between the root and an individual leaf node.</span></span> <span data-ttu-id="ae58e-114">\_Для этого сокета получено уведомление о закрытии, если соответствующий конечный узел вызывает [**функции closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) для удаления сеанса MultiPoint.</span><span class="sxs-lookup"><span data-stu-id="ae58e-114">An FD\_CLOSE indication is received for this socket if the corresponding leaf node calls [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) to drop out of the multipoint session.</span></span> <span data-ttu-id="ae58e-115">В симметричном виде вызов **функции closesocket** на \_ оконечном сокете c, возвращенном из **всажоинлеаф** , приводит к тому, что сокет в соответствующем конечном узле получает \_ уведомление о закрытии демона.</span><span class="sxs-lookup"><span data-stu-id="ae58e-115">Symmetrically, invoking **closesocket** on the c\_leaf socket returned from **WSAJoinLeaf** causes the socket in the corresponding leaf node to get an FD\_CLOSE notification.</span></span>

<span data-ttu-id="ae58e-116">При вызове [**всажоинлеаф**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) с \_ конечным сокетом c параметр *Name* содержит адрес корневого приложения (для схемы корневого элемента управления) или существующий сеанс MultiPoint (неадминистративная схема управления), а возвращаемый дескриптор сокета совпадает с дескриптором входного сокета.</span><span class="sxs-lookup"><span data-stu-id="ae58e-116">When [**WSAJoinLeaf**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) is invoked with a c\_leaf socket, the *name* parameter contains the address of the root application (for a rooted control scheme) or an existing multipoint session (nonrooted control scheme), and the returned socket descriptor is the same as the input socket descriptor.</span></span> <span data-ttu-id="ae58e-117">В схеме с корневым контролем корневое приложение помещает свой \_ корневой сокет c в режим прослушивания, вызывая [**Listen**](/windows/desktop/api/Winsock2/nf-winsock2-listen).</span><span class="sxs-lookup"><span data-stu-id="ae58e-117">In a rooted control scheme, the root application puts its c\_root socket in listening mode by calling [**listen**](/windows/desktop/api/Winsock2/nf-winsock2-listen).</span></span> <span data-ttu-id="ae58e-118">Стандартное \_ уведомление о принятии запроса на выступающий доставляется, когда конечный узел запрашивает присоединение к сеансу MultiPoint.</span><span class="sxs-lookup"><span data-stu-id="ae58e-118">The standard FD\_ACCEPT notification is delivered when the leaf node requests to join itself to the multipoint session.</span></span> <span data-ttu-id="ae58e-119">Корневое приложение использует обычные функции [**Accept**](/windows/desktop/api/Winsock2/nf-winsock2-accept) / [**всаакцепт**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) , чтобы признать новый конечный узел.</span><span class="sxs-lookup"><span data-stu-id="ae58e-119">The root application uses the usual [**accept**](/windows/desktop/api/Winsock2/nf-winsock2-accept)/[**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) functions to admit the new leaf node.</span></span> <span data-ttu-id="ae58e-120">Значение, возвращаемое либо **Accept** , либо **всаакцепт** , является также \_ дескриптором конечного сокета c, как и возвращенные из **всажоинлеаф**.</span><span class="sxs-lookup"><span data-stu-id="ae58e-120">The value returned from either **accept** or **WSAAccept** is also a c\_leaf socket descriptor just like those returned from **WSAJoinLeaf**.</span></span> <span data-ttu-id="ae58e-121">Для размещения схем MultiPoint, которые допускают соединения, инициированные как с помощью корневого, так и для конечной точки, допускается \_ Использование корневого сокета c, который уже находится в режиме прослушивания, в качестве входных данных для **всажоинлеаф**.</span><span class="sxs-lookup"><span data-stu-id="ae58e-121">To accommodate multipoint schemes that allow both root-initiated and leaf-initiated joins, it is acceptable for a c\_root socket that is already in listening mode to be used as input to **WSAJoinLeaf**.</span></span>

<span data-ttu-id="ae58e-122">Корневое приложение MultiPoint обычно отвечает за упорядоченный дисмантлинг сеанса MultiPoint.</span><span class="sxs-lookup"><span data-stu-id="ae58e-122">A multipoint root application is generally responsible for the orderly dismantling of a multipoint session.</span></span> <span data-ttu-id="ae58e-123">Такое приложение может использовать [**Shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown) или [**функции closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) на \_ корневом сокете c для выполнения всех связанных \_ конечных сокетов c, включая те, которые были возвращены из [**всажоинлеаф**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) и соответствующих \_ конечных сокетов c в удаленных КОНЕЧных узлах для получения \_ уведомления о закрытии демона.</span><span class="sxs-lookup"><span data-stu-id="ae58e-123">Such an application may use [**shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown) or [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) on a c\_root socket to cause all of the associated c\_leaf sockets, including those returned from [**WSAJoinLeaf**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) and their corresponding c\_leaf sockets in the remote leaf nodes, to get FD\_CLOSE notification.</span></span>

 

 



