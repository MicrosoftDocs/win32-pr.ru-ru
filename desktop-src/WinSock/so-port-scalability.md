---
description: Включает масштабируемость локального порта для сокета.
ms.assetid: c5142baf-9e2d-4c06-8719-9090fd2d9487
title: SO_PORT_SCALABILITY (Ws2def. h)
ms.topic: reference
ms.date: 05/31/2018
ms.openlocfilehash: 565caeb472ac5cb15061d32b47a048a9a210885e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104144956"
---
# <a name="so_port_scalability"></a>Итак \_ , \_ масштабируемость портов

Параметр сокета **\_ \_ масштабируемости для порта** обеспечивает масштабируемость локальных портов для сокета.

<dl> <dt>

<span id="SO_PORT_SCALABILITY"></span><span id="so_port_scalability"></span>**Итак \_ , \_ масштабируемость портов**
</dt> <dd> <dl> <dt>

0x3006
</dt> <dt>



Параметр сокета **\_ \_ масштабируемости** "на уровень" обеспечивает масштабируемость локального порта, позволяя максимально увеличить выделение портов, выделяя порты с подстановочными знаками несколько раз для разных пар портов локальных адресов на локальном компьютере.


</dt> </dl> </dd> </dl>

## <a name="remarks"></a>Комментарии

Примечание. на платформах, где \_ \_ поддерживаются как настолько масштабируемые, так и \_ многократно используемые \_ уникастпорт, предпочтительнее использовать для \_ повторного использования \_ уникастпорт.

В средах прокси-сервера имеются проблемы масштабируемости, так как доступность локального порта ограничена. Одним из способов решения этой проблемы является добавление на компьютер дополнительных IP-адресов. Однако по умолчанию для портов с подстановочными знаками, используемых с функцией [**BIND**](/windows/desktop/api/winsock/nf-winsock-bind) , ограничен размер динамического диапазона портов на локальном компьютере (до 64 000 портов, но обычно меньше), независимо от количества IP-адресов на локальном компьютере. Для решения этой проблемы приложение должно поддерживать собственный пул портов с резервированием портов или с помощью эвристики.

Чтобы не допустить наличия всех приложений, требующих масштабируемости, управлять собственным пулом портов и обеспечить более высокую масштабируемость при обеспечении совместимости приложений, в Windows Server 2008 появился вариант сокета **\_ \_ масштабируемости** , позволяющий максимально увеличить выделение портов по шаблону. Выделение портов разворачивается, позволяя приложению распределять порты с подстановочными знаками для каждого уникального локального адреса и пары портов. Таким образом, если на локальном компьютере есть четыре IP-адреса, то для запросов функций [**привязки**](/windows/desktop/api/winsock/nf-winsock-bind) с подстановочными знаками можно выделить до 256 Кбайт портов с подстановочными знаками (64 k портов × 4).

Если для сокета установлен параметр Socket **\_ \_ масштабируемости** , а вызов функции [**BIND**](/windows/desktop/api/winsock/nf-winsock-bind) выполняется для указанного адреса и порта с подстановочными знаками (для параметра *Name* задан определенный адрес и порт 0), то Winsock выделяет порт для указанного адреса. Это выделение будет основано на всех возможных IP-адресах и портах/на адрес на локальном компьютере. Если порт с подстановочными знаками запрашивается с помощью параметра **для обеспечения \_ \_ масштабируемости порта** , этот порт не может быть выделен другим сокетом без параметра **для обеспечения \_ \_ масштабируемости порта** . Это ограничение используется, чтобы избежать проблем с обратной совместимостью приложений, которые предполагают, что локальный порт с подстановочными знаками нельзя использовать повторно. Обратите внимание, что это означает, что приложения, которые запрашивают большое количество портов, использующих такую **\_ \_ масштабируемость портов,** могут разгрузить устаревшие приложения портов. Если все доступные временные порты были получены по крайней мере для одного адреса с **таким \_ уровнем \_ масштабируемости** , то больше не может использоваться выделение портов с подстановочными знаками без параметра Socket.

Чтобы обеспечить любой результат, перед вызовом функции [**BIND**](/windows/desktop/api/winsock/nf-winsock-bind) необходимо установить параметр для **обеспечения \_ \_ масштабируемости порта** . Ниже приведен пример того, как это будет использоваться на компьютере с двумя адресами:

-   Функция [**сокета**](/windows/desktop/api/Winsock2/nf-winsock2-socket) вызывается процессом для создания сокета.
-   Функция [**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt) вызывается для включения параметра so-Socket **\_ \_ масштабируемости** для только что созданного сокета.
-   Функция [**BIND**](/windows/desktop/api/winsock/nf-winsock-bind) вызывается для выполнения привязки на одном из IP-адресов локального компьютера и порта 0.
-   Затем вызывается функция [**Connect**](/windows/desktop/api/Winsock2/nf-winsock2-connect) для подключения к УДАЛЕННОМУ IP-адресу. При необходимости сокет используется приложением.
-   Функция [**сокета**](/windows/desktop/api/Winsock2/nf-winsock2-socket) вызывается тем же процессом (возможно, другим потоком) для создания второго сокета.
-   Функция [**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt) вызывается для включения параметра so-Socket **\_ \_ масштабируемости** для вновь созданного второго сокета.
-   Функция [**BIND**](/windows/desktop/api/winsock/nf-winsock-bind) вызывается с вторым IP-адресом и портом 0 локального компьютера. Даже если все порты были предварительно выделены, этот вызов выполняется успешно, так как на локальном компьютере доступно несколько IP-адресов, а для обоих сокетов в одном процессе установлен параметр Socket **\_ \_ масштабируемости Port** .
-   Затем вызывается функция [**Connect**](/windows/desktop/api/Winsock2/nf-winsock2-connect) для подключения к УДАЛЕННОМУ IP-адресу. При необходимости второй сокет используется приложением.

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|-------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Ни одна версия не поддерживается<br/>                                                           |
| Минимальная версия сервера<br/> | \[Только для настольных приложений Windows Server 2008\]<br/>                                |
| Header<br/>                   | <dl> <dt>Ws2def. h</dt> </dl> |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt)
</dt> <dt>

[**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt)
</dt> <dt>

[**\_Параметры сокета сокета Sol**](sol-socket-socket-options.md)
</dt> <dt>

[**Параметры сокета**](socket-options.md)
</dt> </dl>

 

 




