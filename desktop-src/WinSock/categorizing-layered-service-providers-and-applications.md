---
title: Категоризация многоуровневых поставщиков услуг и приложений
description: Winsock 2 поддерживает многоуровневые протоколы.
ms.assetid: 1c5efd2e-1b42-4c20-a4da-b81a5fc4243c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a966d54da0be26f75a074de18abe1b9e080c0c9f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105701554"
---
# <a name="categorizing-layered-service-providers-and-apps"></a><span data-ttu-id="60ca4-103">Категоризация многоуровневых поставщиков услуг и приложений</span><span class="sxs-lookup"><span data-stu-id="60ca4-103">Categorizing layered service providers and apps</span></span>

> [!Note]  
> <span data-ttu-id="60ca4-104">Многоуровневые поставщики служб являются устаревшими.</span><span class="sxs-lookup"><span data-stu-id="60ca4-104">Layered Service Providers are deprecated.</span></span> <span data-ttu-id="60ca4-105">Начиная с Windows 8 и Windows Server 2012, используйте [платформу фильтрации Windows](../fwp/windows-filtering-platform-start-page.md).</span><span class="sxs-lookup"><span data-stu-id="60ca4-105">Starting with Windows 8 and Windows Server 2012, use [Windows Filtering Platform](../fwp/windows-filtering-platform-start-page.md).</span></span>

 

<span data-ttu-id="60ca4-106">Winsock 2 поддерживает многоуровневые протоколы.</span><span class="sxs-lookup"><span data-stu-id="60ca4-106">Winsock 2 accommodates layered protocols.</span></span> <span data-ttu-id="60ca4-107">Многоуровневый протокол реализует только функции обмена данными более высокого уровня, в то же время полагается на базовый стек транспорта для фактического обмена данными с удаленной конечной точкой.</span><span class="sxs-lookup"><span data-stu-id="60ca4-107">A layered protocol is one that implements only higher level communications functions, while relying on an underlying transport stack for the actual exchange of data with a remote endpoint.</span></span> <span data-ttu-id="60ca4-108">Примером многоуровневого протокола или поставщика многоуровневой службы будет уровень безопасности, который добавляет протокол к процессу установки соединения для выполнения проверки подлинности и установки взаимно согласованной схемы шифрования.</span><span class="sxs-lookup"><span data-stu-id="60ca4-108">An example of a layered protocol or layered service provider would be a security layer that adds protocol to the connection establishment process in order to perform authentication and to establish a mutually agreed upon encryption scheme.</span></span> <span data-ttu-id="60ca4-109">Такой протокол безопасности, как правило, требует наличия служб базового надежного транспортного протокола, такого как TCP или SPX.</span><span class="sxs-lookup"><span data-stu-id="60ca4-109">Such a security protocol would generally require the services of an underlying reliable transport protocol such as TCP or SPX.</span></span> <span data-ttu-id="60ca4-110">Термин базовый протокол, реализуемый базовым поставщиком, относится к поставщику Winsock, который реализует протокол, например TCP или SPX, который способен выполнять обмен данными с удаленной конечной точкой.</span><span class="sxs-lookup"><span data-stu-id="60ca4-110">The term base protocol implemented by base provider refers to a Winsock provider that implements a protocol such as TCP or SPX which is capable of performing data communications with a remote endpoint.</span></span> <span data-ttu-id="60ca4-111">Термин многоуровневый протокол используется для описания протокола, который не может быть изолирован.</span><span class="sxs-lookup"><span data-stu-id="60ca4-111">The term layered protocol is used to describe a protocol that cannot stand alone.</span></span> <span data-ttu-id="60ca4-112">Эти многоуровневые протоколы устанавливаются как поставщики многоуровневых служб Winsock (LSP).</span><span class="sxs-lookup"><span data-stu-id="60ca4-112">These layered protocols are installed as Winsock Layered Service Providers (LSPs).</span></span>

<span data-ttu-id="60ca4-113">Примером LSP является поставщик клиентских служб межсетевого экрана Майкрософт, установленный как часть Internet Секутити and Authentication Server (ISA) на клиентах.</span><span class="sxs-lookup"><span data-stu-id="60ca4-113">An example of an LSP is the Microsoft Firewall Client Service Provider installed as part of the Internet Secutity and Authentication Server (ISA) on clients.</span></span> <span data-ttu-id="60ca4-114">Поставщик клиентских служб межсетевого экрана (Майкрософт) устанавливается через базовые поставщики Winsock для TCP и UDP.</span><span class="sxs-lookup"><span data-stu-id="60ca4-114">The Microsoft Firewall Client Service Provider installs over the Winsock base providers for TCP and UDP.</span></span> <span data-ttu-id="60ca4-115">Библиотека динамической компоновки (DLL) в клиентском программном обеспечении брандмауэра ISA превращается в многоуровневый поставщик услуг Winsock, который все приложения Winsock используют прозрачно.</span><span class="sxs-lookup"><span data-stu-id="60ca4-115">A dynamic-link library (DLL) in the ISA Firewall Client software becomes a Winsock layered service provider that all Winsock applications use transparently.</span></span> <span data-ttu-id="60ca4-116">Таким образом, клиентский пакет брандмауэра ISA может перехватывать вызовы функций Winsock из клиентских приложений, а затем перенаправлять запрос к исходному базовому поставщику службы, если место назначения является локальным, или со службой брандмауэра на компьютере ISA Server, если назначением является Remote.</span><span class="sxs-lookup"><span data-stu-id="60ca4-116">This way, the ISA Firewall Client LSP can intercept Winsock function calls from client applications and then route a request to the original underlying base service provider if the destination is local or to the Firewall service on an ISA Server computer if the destination is remote.</span></span> <span data-ttu-id="60ca4-117">Аналогичный LSP устанавливается как часть службы брандмауэра Microsoft Forefront и клиента шлюза управления угрозами (TMG) на клиентах.</span><span class="sxs-lookup"><span data-stu-id="60ca4-117">A similar LSP is installed as part of the Microsoft Forefront Firewall Service and the Threat Management Gateway (TMG) Client on clients.</span></span>

<span data-ttu-id="60ca4-118">Во время инициализации LSP LSP должен предоставлять указатели на несколько функций интерфейса поставщика услуг Winsock (SPI).</span><span class="sxs-lookup"><span data-stu-id="60ca4-118">During LSP initialization, the LSP must provide pointers to a number of Winsock Service Provider Interface (SPI) functions.</span></span> <span data-ttu-id="60ca4-119">Эти функции будут вызываться во время нормальной обработки слоя непосредственно над LSP (другой LSP или Ws2 \_32.DLL).</span><span class="sxs-lookup"><span data-stu-id="60ca4-119">These functions will be called during normal processing by the layer directly above the LSP (either another LSP or Ws2\_32.DLL).</span></span>

<span data-ttu-id="60ca4-120">Можно определить категории LSP на основе подмножества функций SPI, реализуемых LSP, и природы дополнительной обработки, выполняемой для каждой из этих функций.</span><span class="sxs-lookup"><span data-stu-id="60ca4-120">It is possible to define LSP categories based upon the subset of SPI functions an LSP implements and the nature of the extra processing performed for each of those functions.</span></span> <span data-ttu-id="60ca4-121">Классификация LSP, а также классификация приложений, использующих сокеты Winsock, позволяет выборочно определить, следует ли использовать LSP в процессе во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="60ca4-121">By classifying LSPs, as well as classifying applications which use Winsock sockets, it becomes possible to selectively determine if an LSP should be involved in a given process at runtime.</span></span>

<span data-ttu-id="60ca4-122">В Windows Vista и более поздних версиях предлагается новый метод для категоризации поставщиков многоуровневых служб и приложений Winsock, чтобы загружались только определенные LSP.</span><span class="sxs-lookup"><span data-stu-id="60ca4-122">On Windows Vista and later, a new method is provided for categorizing both Winsock Layered Service Providers and applications so that only certain LSPs will be loaded.</span></span> <span data-ttu-id="60ca4-123">Существует несколько причин для добавления этих функций.</span><span class="sxs-lookup"><span data-stu-id="60ca4-123">There are several reasons for adding these features.</span></span>

<span data-ttu-id="60ca4-124">Одна из основных причин состоит в том, что некоторые критические системные процессы, такие как Winlogon и LSASS, создают сокеты, но эти процессы не используют эти сокеты для отправки трафика в сети.</span><span class="sxs-lookup"><span data-stu-id="60ca4-124">One of the primary reasons is that certain system critical processes such as winlogon and lsass create sockets, but these processes do not use these sockets to send any traffic on the network.</span></span> <span data-ttu-id="60ca4-125">Поэтому большинство LSP не должны загружаться в эти процессы.</span><span class="sxs-lookup"><span data-stu-id="60ca4-125">So most LSPs should not be loaded into these processes.</span></span> <span data-ttu-id="60ca4-126">Также были описаны некоторые случаи, в которых ошибками LSP может привести к сбою *lsass.exe* .</span><span class="sxs-lookup"><span data-stu-id="60ca4-126">A number of cases have also been documented where buggy LSPs can cause *lsass.exe* to crash.</span></span> <span data-ttu-id="60ca4-127">В случае сбоя LSASS система принудительно завершает работу.</span><span class="sxs-lookup"><span data-stu-id="60ca4-127">If lsass crashes, the system forces a shutdown.</span></span> <span data-ttu-id="60ca4-128">Побочная часть влияния этих системных процессов на загрузку LSP заключается в том, что эти процессы никогда не завершаются, поэтому при установке или удалении LSP-файла требуется перезагрузка.</span><span class="sxs-lookup"><span data-stu-id="60ca4-128">A side affect of these system processes loading LSPs is that these processes never exit so when an LSP is installed or removed, a reboot is required.</span></span>

<span data-ttu-id="60ca4-129">Дополнительная причина заключается в том, что в некоторых случаях приложения могут не загружать определенные LSP.</span><span class="sxs-lookup"><span data-stu-id="60ca4-129">A secondary reason is that there are some cases where applications may not want to load certain LSPs.</span></span> <span data-ttu-id="60ca4-130">Например, некоторым приложениям не требуется загружать криптографические LSP, которые могут препятствовать взаимодействию приложения с другими системами, на которых не установлен LSP циптографик.</span><span class="sxs-lookup"><span data-stu-id="60ca4-130">For example, some applications may not want to load cryptographic LSPs which could prevent the application from communicating with other systems that do not have the cyptographic LSP installed.</span></span>

<span data-ttu-id="60ca4-131">Наконец, категории LSP могут использоваться другими LSP, чтобы определить, где в цепочке протокола Winsock они должны устанавливаться самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="60ca4-131">Finally, LSP categories can be used by other LSPs to determine where in the Winsock protocol chain they should install themselves.</span></span> <span data-ttu-id="60ca4-132">В течение многих лет у различных разработчиков-LSP было желание узнать, как будет вести себя LSP.</span><span class="sxs-lookup"><span data-stu-id="60ca4-132">For years, various LSP developers have wanted a way of knowing how an LSP will behave.</span></span> <span data-ttu-id="60ca4-133">Например, LSP, проверяющий поток данных, должен быть выше LSP, который шифрует данные.</span><span class="sxs-lookup"><span data-stu-id="60ca4-133">For example, an LSP that inspects the data stream would want to be above an LSP that encrypts the data.</span></span> <span data-ttu-id="60ca4-134">Разумеется, этот способ классификации «LSP» не является доказательством, так как он полагается на сторонние LSP, чтобы классифицировать себя соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="60ca4-134">Of course, this method of LSP categorization isn't fool proof since it relies on third-party LSPs to categorize themselves appropriately.</span></span>

<span data-ttu-id="60ca4-135">Функции классификации и других улучшений безопасности в Windows Vista и более поздних версий предназначены для предотвращения непреднамеренной установки вредоносных LSP.</span><span class="sxs-lookup"><span data-stu-id="60ca4-135">The LSP categorization and other security enhancements in Windows Vista and later are designed to help prevent users from unintentionally installing malicious LSPs.</span></span>

## <a name="lsp-categories"></a><span data-ttu-id="60ca4-136">Категории LSP</span><span class="sxs-lookup"><span data-stu-id="60ca4-136">LSP Categories</span></span>

<span data-ttu-id="60ca4-137">В Windows Vista и более поздних версиях LSP может классифицироваться в зависимости от того, как он взаимодействует с вызовами и данными сокетов Windows.</span><span class="sxs-lookup"><span data-stu-id="60ca4-137">On Windows Vista and later, an LSP can be classified based on how it interacts with Windows Sockets calls and data.</span></span> <span data-ttu-id="60ca4-138">Категория LSP — это идентифицируемая группа поведений для подмножества функций Winsock SPI.</span><span class="sxs-lookup"><span data-stu-id="60ca4-138">An LSP category is an identifiable group of behaviors on a subset of Winsock SPI functions.</span></span> <span data-ttu-id="60ca4-139">Например, фильтр содержимого HTTP будет классифицироваться как инспектор данных ( \_ Категория инспектора LSP).</span><span class="sxs-lookup"><span data-stu-id="60ca4-139">For example, an HTTP content filter would be categorized as a data inspector (the LSP\_INSPECTOR category).</span></span> <span data-ttu-id="60ca4-140">\_Категория инспектора LSP будет проверять параметры (но не изменять) для функций SPI для обмена данными.</span><span class="sxs-lookup"><span data-stu-id="60ca4-140">The LSP\_INSPECTOR category will inspect (but not alter) parameters to data transfer SPI functions.</span></span> <span data-ttu-id="60ca4-141">Приложение может запрашивать категорию LSP и выбирать, следует ли не загружать LSP на основе категории LSP и набора разрешенных категорий LSP приложения.</span><span class="sxs-lookup"><span data-stu-id="60ca4-141">An application can query for the category of an LSP and choose to not load the LSP based on the LSP category and the application's set of permitted LSP categories.</span></span>

<span data-ttu-id="60ca4-142">В следующей таблице перечислены категории, в которые можно классифицировать LSP.</span><span class="sxs-lookup"><span data-stu-id="60ca4-142">The following table lists categories that an LSP can be classified into.</span></span>

| <span data-ttu-id="60ca4-143">Категория LSP</span><span class="sxs-lookup"><span data-stu-id="60ca4-143">LSP Category</span></span>              | <span data-ttu-id="60ca4-144">Описание</span><span class="sxs-lookup"><span data-stu-id="60ca4-144">Description</span></span>                                                     |
|---------------------------|-----------------------------------------------------------------|
| <span data-ttu-id="60ca4-145">**Подпрограмма \_ \_ сжатия LSP**</span><span class="sxs-lookup"><span data-stu-id="60ca4-145">**LSP\_CRYPTO\_COMPRESS**</span></span> | <span data-ttu-id="60ca4-146">LSP является поставщиком шифрования или сжатия данных.</span><span class="sxs-lookup"><span data-stu-id="60ca4-146">The LSP is a cryptography or data compression provider.</span></span>         |
| <span data-ttu-id="60ca4-147">**LSP — \_ брандмауэр**</span><span class="sxs-lookup"><span data-stu-id="60ca4-147">**LSP\_FIREWALL**</span></span>         | <span data-ttu-id="60ca4-148">LSP является поставщиком брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="60ca4-148">The LSP is a firewall provider.</span></span>                                 |
| <span data-ttu-id="60ca4-149">**BSP — \_ локальный \_ кэш**</span><span class="sxs-lookup"><span data-stu-id="60ca4-149">**LSP\_LOCAL\_CACHE**</span></span>     | <span data-ttu-id="60ca4-150">LSP является поставщиком локального кэша.</span><span class="sxs-lookup"><span data-stu-id="60ca4-150">The LSP is a local cache provider.</span></span>                              |
| <span data-ttu-id="60ca4-151">**\_исходящее \_ изменение LSP**</span><span class="sxs-lookup"><span data-stu-id="60ca4-151">**LSP\_INBOUND\_MODIFY**</span></span>  | <span data-ttu-id="60ca4-152">BSP изменяет входящие данные.</span><span class="sxs-lookup"><span data-stu-id="60ca4-152">The LSP modifies inbound data.</span></span>                                  |
| <span data-ttu-id="60ca4-153">**\_инспектор LSP**</span><span class="sxs-lookup"><span data-stu-id="60ca4-153">**LSP\_INSPECTOR**</span></span>        | <span data-ttu-id="60ca4-154">LSP проверяет или фильтрует данные.</span><span class="sxs-lookup"><span data-stu-id="60ca4-154">The LSP inspects or filters data.</span></span>                               |
| <span data-ttu-id="60ca4-155">**\_исходящее \_ изменение LSP**</span><span class="sxs-lookup"><span data-stu-id="60ca4-155">**LSP\_OUTBOUND\_MODIFY**</span></span> | <span data-ttu-id="60ca4-156">LSP изменяет исходящие данные.</span><span class="sxs-lookup"><span data-stu-id="60ca4-156">The LSP modifies outbound data.</span></span>                                 |
| <span data-ttu-id="60ca4-157">**\_прокси-сервер LSP**</span><span class="sxs-lookup"><span data-stu-id="60ca4-157">**LSP\_PROXY**</span></span>            | <span data-ttu-id="60ca4-158">LSP выступает в качестве прокси и перенаправляет пакеты.</span><span class="sxs-lookup"><span data-stu-id="60ca4-158">The LSP acts as a proxy and redirects packets.</span></span>                  |
| <span data-ttu-id="60ca4-159">**Перенаправление LSP \_**</span><span class="sxs-lookup"><span data-stu-id="60ca4-159">**LSP\_REDIRECTOR**</span></span>       | <span data-ttu-id="60ca4-160">LSP — это перенаправитель сети.</span><span class="sxs-lookup"><span data-stu-id="60ca4-160">The LSP is a network redirector.</span></span>                                |
| <span data-ttu-id="60ca4-161">**LSPная \_ система**</span><span class="sxs-lookup"><span data-stu-id="60ca4-161">**LSP\_SYSTEM**</span></span>           | <span data-ttu-id="60ca4-162">LSP является приемлемым для использования в службах и системных процессах.</span><span class="sxs-lookup"><span data-stu-id="60ca4-162">The LSP is acceptable for use in services and system processes.</span></span> |



 

<span data-ttu-id="60ca4-163">LSP может принадлежать к более чем одной категории.</span><span class="sxs-lookup"><span data-stu-id="60ca4-163">An LSP may belong to more than one category.</span></span> <span data-ttu-id="60ca4-164">Например, LSP "брандмауэр/безопасность" может принадлежать к категориям инспектора (**\_ инспектора LSP**) и брандмауэра (**LSP \_**) брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="60ca4-164">For example, a firewall/security LSP could belong to both the inspector (**LSP\_INSPECTOR**) and firewall (**LSP\_FIREWALL**) categories.</span></span>

<span data-ttu-id="60ca4-165">Если для LSP не задана Категория, он считается включенным в категорию все остальные.</span><span class="sxs-lookup"><span data-stu-id="60ca4-165">If an LSP does not have a category set, it is considered to be in the All Other category.</span></span> <span data-ttu-id="60ca4-166">Эта категория LSP не будет загружена в службы или системные процессы (например, LSASS, Winlogon и многие процессы svchost).</span><span class="sxs-lookup"><span data-stu-id="60ca4-166">This LSP category will not be loaded in services or system processes (for example, lsass, winlogon, and many svchost processes).</span></span>

## <a name="categorizing-lsps"></a><span data-ttu-id="60ca4-167">Категоризация LSP</span><span class="sxs-lookup"><span data-stu-id="60ca4-167">Categorizing LSPs</span></span>

<span data-ttu-id="60ca4-168">В Windows Vista и более поздних версиях доступны несколько новых функций для категоризации LSP:</span><span class="sxs-lookup"><span data-stu-id="60ca4-168">Several new functions are available on Windows Vista and later for categorizing an LSP:</span></span>

-   [<span data-ttu-id="60ca4-169">**вскжетпровидеринфо**</span><span class="sxs-lookup"><span data-stu-id="60ca4-169">**WSCGetProviderInfo**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo)
-   [<span data-ttu-id="60ca4-170">**WSCGetProviderInfo32**</span><span class="sxs-lookup"><span data-stu-id="60ca4-170">**WSCGetProviderInfo32**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo32)
-   [<span data-ttu-id="60ca4-171">**всксетпровидеринфо**</span><span class="sxs-lookup"><span data-stu-id="60ca4-171">**WSCSetProviderInfo**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo)
-   [<span data-ttu-id="60ca4-172">**WSCSetProviderInfo32**</span><span class="sxs-lookup"><span data-stu-id="60ca4-172">**WSCSetProviderInfo32**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo32)

<span data-ttu-id="60ca4-173">Для категоризации LSP-функции вызывается функция [**всксетпровидеринфо**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo) или [**WSCSetProviderInfo32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo32) с идентификатором GUID для обозначения скрытой записи LSP, класс сведений, заданный для этой записи протокола LSP, и набор флагов, используемых для изменения поведения функции.</span><span class="sxs-lookup"><span data-stu-id="60ca4-173">In order to categorize an LSP, the [**WSCSetProviderInfo**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo) or [**WSCSetProviderInfo32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo32) function is called with a GUID to identify the LSP hidden entry, the information class to be set for this LSP protocol entry, and a set of flags used to modify the behavior of the function.</span></span>

<span data-ttu-id="60ca4-174">Функция [**вскжетпровидеринфо**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo) или [**WSCGetProviderInfo32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo32) используется аналогичным образом для получения данных, связанных с классом сведений для LSP.</span><span class="sxs-lookup"><span data-stu-id="60ca4-174">The [**WSCGetProviderInfo**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo) or [**WSCGetProviderInfo32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo32) function is similarly used to retrieve the data associated with an information class for an LSP.</span></span>

## <a name="categorizing-applications"></a><span data-ttu-id="60ca4-175">Классификация приложений</span><span class="sxs-lookup"><span data-stu-id="60ca4-175">Categorizing Applications</span></span>

<span data-ttu-id="60ca4-176">В Windows Vista и более поздних версиях для категоризации приложения доступны несколько новых функций:</span><span class="sxs-lookup"><span data-stu-id="60ca4-176">Several new functions are available on Windows Vista and later for categorizing an application:</span></span>

-   [<span data-ttu-id="60ca4-177">**вскжетаппликатионкатегори**</span><span class="sxs-lookup"><span data-stu-id="60ca4-177">**WSCGetApplicationCategory**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetapplicationcategory)
-   [<span data-ttu-id="60ca4-178">**всксетаппликатионкатегори**</span><span class="sxs-lookup"><span data-stu-id="60ca4-178">**WSCSetApplicationCategory**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetapplicationcategory)

<span data-ttu-id="60ca4-179">Чтобы классифицировать приложение, функция [**всксетаппликатионкатегори**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetapplicationcategory) вызывается с путем загрузки к исполняемому образу для указания приложения, аргументов командной строки, используемых при запуске приложения, и категорий LSP, которые разрешены для всех экземпляров этого приложения.</span><span class="sxs-lookup"><span data-stu-id="60ca4-179">In order to categorize an application, the [**WSCSetApplicationCategory**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetapplicationcategory) function is called with the load path to the executable image to identify the application, the command line arguments used when starting the application, and the LSP categories which are permitted for all instances of this application.</span></span>

<span data-ttu-id="60ca4-180">Функция [**вскжетаппликатионкатегори**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetapplicationcategory) также используется для получения категорий многоуровневых поставщиков служб (LSP), связанных с приложением.</span><span class="sxs-lookup"><span data-stu-id="60ca4-180">The [**WSCGetApplicationCategory**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetapplicationcategory) function is similarly used to retrieve the layered service provider (LSP) categories associated with an application.</span></span>

## <a name="determining-which-lsps-get-loaded"></a><span data-ttu-id="60ca4-181">Определение загружаемого LSP</span><span class="sxs-lookup"><span data-stu-id="60ca4-181">Determining Which LSPs Get Loaded</span></span>

<span data-ttu-id="60ca4-182">Последняя часть «LSP» классификации определяет, какие LSP будут загружены в процессы.</span><span class="sxs-lookup"><span data-stu-id="60ca4-182">The final part of LSP categorization is determining which LSPs will be loaded into which processes.</span></span> <span data-ttu-id="60ca4-183">Когда процесс загружает Winsock, выполняются следующие сравнения категорий приложений и категории LSP для всех установленных LSP:</span><span class="sxs-lookup"><span data-stu-id="60ca4-183">When a process loads Winsock, the following comparisons are made of the application category and the LSP categories for all installed LSPs:</span></span>

-   <span data-ttu-id="60ca4-184">Если приложение не разбито на категории, разрешите загрузку всех LSP в процесс.</span><span class="sxs-lookup"><span data-stu-id="60ca4-184">If the application is not categorized, allow all LSPs to be loaded into the process.</span></span>
-   <span data-ttu-id="60ca4-185">Если для приложения и LSP назначены категории, должны выполняться все следующие условия.</span><span class="sxs-lookup"><span data-stu-id="60ca4-185">If both the application and the LSP have assigned categories, all of the following must be true:</span></span> <dl> <span data-ttu-id="60ca4-186">По крайней мере одна из категорий LSP имеется в указанных категориях приложения.</span><span class="sxs-lookup"><span data-stu-id="60ca4-186">At least one of the LSP categories is present in the application's specified categories.</span></span>  
    <span data-ttu-id="60ca4-187">В категориях LSP указаны только категории, указанные в указанных категориях приложения.</span><span class="sxs-lookup"><span data-stu-id="60ca4-187">Only categories specified in the application's specified categories are specified in the LSPs categories.</span></span> <span data-ttu-id="60ca4-188">Например, если приложение указывает категорию, она должна находиться в категории LSP.</span><span class="sxs-lookup"><span data-stu-id="60ca4-188">For example, if the application specifies a category it must be in the LSP's category.</span></span>  
    <span data-ttu-id="60ca4-189">Если \_ в категории приложения содержится системная Категория LSP, она должна присутствовать в категориях LSP.</span><span class="sxs-lookup"><span data-stu-id="60ca4-189">If the LSP\_SYSTEM category is present in the application's category, it must be present in the LSP's categories.</span></span>  
    </dl>

> [!Note]  
> <span data-ttu-id="60ca4-190">Если значение LSP не относится к категории, его категория фактически не равна нулю.</span><span class="sxs-lookup"><span data-stu-id="60ca4-190">If an LSP is not categorized, its category is effectively zero.</span></span> <span data-ttu-id="60ca4-191">Для совпадения все указанные категории LSP должны присутствовать в категориях приложения (категории приложения должны быть надмножеством категорий LSP) с учетом представим, что при \_ наличии в категории приложения LSP-системы она также должна присутствовать в категории LSP.</span><span class="sxs-lookup"><span data-stu-id="60ca4-191">For a match to occur, all the LSP's specified categories must be present in the application's categories (the application's categories must be a superset of the LSP's categories) with the caveat that if LSP\_SYSTEM is present in the application's category it must also be present in the LSP's category.</span></span>

 

<span data-ttu-id="60ca4-192">Рассмотрим следующий пример.</span><span class="sxs-lookup"><span data-stu-id="60ca4-192">Consider the following example:</span></span>

<span data-ttu-id="60ca4-193">*Foo.exeное* приложение классифицируется как LSP- \_ система + LSP \_ Firewall + LSP \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="60ca4-193">The *Foo.exe* application is categorized as LSP\_SYSTEM + LSP\_FIREWALL + LSP\_CRYPTO\_COMPRESS.</span></span> <span data-ttu-id="60ca4-194">*Bar.exe* приложения разделены на категории LSP \_ Firewall + LSP \_ Crypto \_ .</span><span class="sxs-lookup"><span data-stu-id="60ca4-194">The application *Bar.exe* is categorized as LSP\_FIREWALL + LSP\_CRYPTO\_COMPRESS.</span></span> <span data-ttu-id="60ca4-195">В системе установлено четыре LSP:</span><span class="sxs-lookup"><span data-stu-id="60ca4-195">There are four LSPs installed on the system:</span></span>

-   <span data-ttu-id="60ca4-196">LSP1 установил категорию LSP- \_ системы.</span><span class="sxs-lookup"><span data-stu-id="60ca4-196">LSP1 has set a category of LSP\_SYSTEM.</span></span>
-   <span data-ttu-id="60ca4-197">Для LSP2 не заданы категории, поэтому ее категория равна нулю.</span><span class="sxs-lookup"><span data-stu-id="60ca4-197">LSP2 is not categories set, so its category is zero.</span></span>
-   <span data-ttu-id="60ca4-198">LSP3 установил категорию LSP- \_ брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="60ca4-198">LSP3 has set a category of LSP\_FIREWALL.</span></span>
-   <span data-ttu-id="60ca4-199">LSP4 установил категории "LSP" системы и "LSP", \_ \_ брандмауэр и \_ LSP \_ \_</span><span class="sxs-lookup"><span data-stu-id="60ca4-199">LSP4 has set categories of LSP\_SYSTEM + LSP\_FIREWALL + LSP\_CRYPTO\_COMPRESS + LSP\_INSPECTOR</span></span>

<span data-ttu-id="60ca4-200">В этом примере *Foo.exe* приложение будет загружать только LSP1, а *Bar.exe* приложение загрузит LSP3.</span><span class="sxs-lookup"><span data-stu-id="60ca4-200">In this example, the *Foo.exe* application would only load LSP1, while the *Bar.exe* application would load LSP3.</span></span>

## <a name="determining-winsock-providers-installed"></a><span data-ttu-id="60ca4-201">Определение установленных поставщиков Winsock</span><span class="sxs-lookup"><span data-stu-id="60ca4-201">Determining Winsock Providers Installed</span></span>

<span data-ttu-id="60ca4-202">Пакет средств разработки программного обеспечения Microsoft Windows (SDK) включает пример программы Winsock, который можно использовать для определения поставщиков транспорта Winsock, установленных на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="60ca4-202">The Microsoft Windows Software Development Kit (SDK) includes a sample Winsock program that can be used to determine the Winsock transport providers installed on a local computer.</span></span> <span data-ttu-id="60ca4-203">По умолчанию исходный код для этого примера Winsock устанавливается в следующий каталог Windows SDK для Windows 7:</span><span class="sxs-lookup"><span data-stu-id="60ca4-203">By default, the source code for this Winsock sample is installed in the following directory of the Windows SDK for Windows 7:</span></span>

<span data-ttu-id="60ca4-204">*C: \\ Program Files \\ Microsoft SDK \\ Windows \\ v 7.0 \\ Samples \\ нетдс \\ Winsock \\ LSP*</span><span class="sxs-lookup"><span data-stu-id="60ca4-204">*C:\\Program Files\\Microsoft SDKs\\Windows\\v7.0\\Samples\\NetDs\\winsock\\LSP*</span></span>

<span data-ttu-id="60ca4-205">Этот пример представляет собой служебную программу для установки и тестирования многоуровневых поставщиков служб.</span><span class="sxs-lookup"><span data-stu-id="60ca4-205">This sample is a utility for installing and testing layered service providers.</span></span> <span data-ttu-id="60ca4-206">Но он также может использоваться для программного получения подробных сведений из каталога Winsock на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="60ca4-206">But it can also be used to programmatically collect detailed information from the Winsock catalog on a local computer.</span></span> <span data-ttu-id="60ca4-207">Чтобы получить список всех текущих поставщиков Winsock, включая базовые поставщики и поставщиков служб слоя, создайте этот пример библиотеки Winsock и выполните следующую команду консоли:</span><span class="sxs-lookup"><span data-stu-id="60ca4-207">To list all of the current Winsock providers including both base providers and layer service providers, build this Winsock sample and execute the following console command:</span></span>

<span data-ttu-id="60ca4-208">**инстлсп-p**</span><span class="sxs-lookup"><span data-stu-id="60ca4-208">**instlsp -p**</span></span>

<span data-ttu-id="60ca4-209">Выходные данные будут представлять собой список поставщиков Winsock, установленных на локальном компьютере, включая поставщиков многоуровневых служб.</span><span class="sxs-lookup"><span data-stu-id="60ca4-209">The output will be a list of Winsock providers installed on the local computer including layered service providers.</span></span> <span data-ttu-id="60ca4-210">Выходные данные содержат идентификатор каталога и имя строки для поставщика Winsock.</span><span class="sxs-lookup"><span data-stu-id="60ca4-210">The output lists the catalog ID and the string name for the Winsock provider</span></span>

<span data-ttu-id="60ca4-211">Чтобы получить более подробные сведения обо всех поставщиках Winsock, выполните следующую команду консоли:</span><span class="sxs-lookup"><span data-stu-id="60ca4-211">To collect more detailed information on all Winsock providers, execute the following console command:</span></span>

<span data-ttu-id="60ca4-212">**инстлсп-p-v**</span><span class="sxs-lookup"><span data-stu-id="60ca4-212">**instlsp -p -v**</span></span>

<span data-ttu-id="60ca4-213">Выходные данные будут представлять собой список структур [**всапротокол \_ info**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) , поддерживаемых на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="60ca4-213">The output will be a list [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structures supported on the local computer.</span></span>

<span data-ttu-id="60ca4-214">Чтобы получить список только многоуровневых поставщиков служб, установленных на локальном компьютере, выполните следующую команду консоли:</span><span class="sxs-lookup"><span data-stu-id="60ca4-214">For a list of only layered service providers installed on the local computer, execute the following console command:</span></span>

<span data-ttu-id="60ca4-215">**инстлсп-l**</span><span class="sxs-lookup"><span data-stu-id="60ca4-215">**instlsp -l**</span></span>

<span data-ttu-id="60ca4-216">Чтобы отобразить структуру LSP, выполните следующую команду консоли:</span><span class="sxs-lookup"><span data-stu-id="60ca4-216">To map the LSP structure, execute the following console command:</span></span>

<span data-ttu-id="60ca4-217">**инстлсп-m**</span><span class="sxs-lookup"><span data-stu-id="60ca4-217">**instlsp -m**</span></span>

> [!Note]  
> <span data-ttu-id="60ca4-218">Функция TDI является устаревшей и будет удалена в будущих версиях Microsoft Windows.</span><span class="sxs-lookup"><span data-stu-id="60ca4-218">The TDI feature is deprecated and will be removed in future versions of Microsoft Windows.</span></span> <span data-ttu-id="60ca4-219">В зависимости от того, как используется TDI, используйте либо ядро Winsock (WSK), либо платформу фильтрации Windows (WFP).</span><span class="sxs-lookup"><span data-stu-id="60ca4-219">Depending on how you use TDI, use either the Winsock Kernel (WSK) or Windows Filtering Platform (WFP).</span></span> <span data-ttu-id="60ca4-220">Дополнительные сведения о WFP и WSK см. в разделе [платформа фильтрации Windows](../fwp/windows-filtering-platform-start-page.md) и [ядро Winsock](/windows-hardware/drivers/ddi/_netvista/).</span><span class="sxs-lookup"><span data-stu-id="60ca4-220">For more information about WFP and WSK, see [Windows Filtering Platform](../fwp/windows-filtering-platform-start-page.md) and [Winsock Kernel](/windows-hardware/drivers/ddi/_netvista/).</span></span> <span data-ttu-id="60ca4-221">Запись блога о сети Windows Core о WSK и TDI см. [в статье Введение в Winsock Kernel (WSK)](/archive/blogs/wndp/).</span><span class="sxs-lookup"><span data-stu-id="60ca4-221">For a Windows Core Networking blog entry about WSK and TDI, see [Introduction to Winsock Kernel (WSK)](/archive/blogs/wndp/).</span></span>

 

 

 
