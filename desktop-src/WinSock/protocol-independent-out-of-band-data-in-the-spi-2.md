---
description: Нестандартные данные (OOB) — это логически независимый канал передачи, связанный с парой сокетов подключенных потоков.
ms.assetid: 30f667cd-5be9-45f2-9d55-bff04834078f
title: Независимые от протокола данные о независимых аппаратных единицах в SPI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b53e5c7c5c8c8ad7a5985ec101dd157370c5f32f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104541511"
---
# <a name="protocol-independentout-of-band-data-in-the-spi"></a><span data-ttu-id="efac5-103">Независимые от протокола данные о независимых аппаратных единицах в SPI</span><span class="sxs-lookup"><span data-stu-id="efac5-103">Protocol IndependentOut-of-Band Data in the SPI</span></span>

<span data-ttu-id="efac5-104">Нестандартные данные (OOB) — это логически независимый канал передачи, связанный с парой сокетов подключенных потоков.</span><span class="sxs-lookup"><span data-stu-id="efac5-104">Out-of-Band (OOB) data is a logically independent transmission channel associated with a pair of connected stream sockets.</span></span> <span data-ttu-id="efac5-105">Данные OOB могут быть переданы пользователю независимо от обычных данных.</span><span class="sxs-lookup"><span data-stu-id="efac5-105">OOB data may be delivered to the user independently of normal data.</span></span> <span data-ttu-id="efac5-106">Абстракция определяет, что средства данных OOB должны поддерживать надежную доставку по крайней мере одного блока данных OOB за раз.</span><span class="sxs-lookup"><span data-stu-id="efac5-106">The abstraction defines that the OOB data facilities must support the reliable delivery of at least one OOB data block at a time.</span></span> <span data-ttu-id="efac5-107">Этот блок данных может содержать по крайней мере один байт данных, и по крайней мере один блок данных OOB может быть отложенной доставкой пользователя в любой момент времени.</span><span class="sxs-lookup"><span data-stu-id="efac5-107">This data block may contain at least one byte of data, and at least one OOB data block may be pending delivery to the user at any one time.</span></span> <span data-ttu-id="efac5-108">Для протоколов связи, которые поддерживают аппаратный сигнал (то есть TCP, где срочные данные поступают последовательно с обычными данными), система обычно извлекает данные OOB из потока обычных данных и сохраняет их отдельно (при этом пропуска в обычном потоке данных).</span><span class="sxs-lookup"><span data-stu-id="efac5-108">For communications protocols which support in-band signaling (that is, TCP, where the urgent data is delivered in sequence with the normal data), the system normally extracts the OOB data from the normal data stream and stores it separately (leaving a gap in the normal data stream).</span></span> <span data-ttu-id="efac5-109">Это позволяет пользователям выбирать между получением данных OOB по порядку и их получением из последовательности без необходимости буферизации всех промежуточных данных.</span><span class="sxs-lookup"><span data-stu-id="efac5-109">This allows users to choose between receiving the OOB data in order and receiving it out of sequence without having to buffer all the intervening data.</span></span> <span data-ttu-id="efac5-110">Можно просматривать данные OOB.</span><span class="sxs-lookup"><span data-stu-id="efac5-110">It is possible to peek at OOB data.</span></span>

<span data-ttu-id="efac5-111">Пользователь может определить, ожидают ли какие-либо данные OOB, ожидающие чтения, с помощью функции [**вспиоктл**](/previous-versions/windows/hardware/network/ff566296(v=vs.85)) (сиокатмарк).</span><span class="sxs-lookup"><span data-stu-id="efac5-111">A user can determine if there is any OOB data waiting to be read using the [**WSPIoctl**](/previous-versions/windows/hardware/network/ff566296(v=vs.85)) (SIOCATMARK) function.</span></span> <span data-ttu-id="efac5-112">Для протоколов, в которых понятие положения блока данных OOB в обычных потоках данных имеет смысл (т. е. TCP), поставщик услуг Windows Sockets будет поддерживать концептуальный маркер, указывающий позицию последнего байта данных OOB в потоке обычных данных.</span><span class="sxs-lookup"><span data-stu-id="efac5-112">For protocols where the concept of the position of the OOB data block within the normal data stream is meaningful (that is, TCP), a Windows Sockets service provider will maintain a conceptual marker indicating the position of the last byte of OOB data within the normal data stream.</span></span> <span data-ttu-id="efac5-113">Это не является обязательным для реализации функции **вспиоктл** (сиокатмарк) — требуется только присутствие или отсутствие данных OOB.</span><span class="sxs-lookup"><span data-stu-id="efac5-113">This is not necessary for the implementation of the **WSPIoctl** (SIOCATMARK) functionality — the presence or absence of OOB data is all that is required.</span></span>

<span data-ttu-id="efac5-114">Для протоколов, в которых концепция положения блока данных OOB в нормальных потоках данных имеет смысл, приложение может предпочесть обрабатывать нестандартные данные встроенным образом как часть обычного потока данных.</span><span class="sxs-lookup"><span data-stu-id="efac5-114">For protocols where the concept of the position of the OOB data block within the normal data stream is meaningful an application may prefer to process out-of-band data inline, as part of the normal data stream.</span></span> <span data-ttu-id="efac5-115">Это достигается путем установки параметра сокета \_ убинлине (см. раздел [**вспиоктл**](/previous-versions/windows/hardware/network/ff566296(v=vs.85))).</span><span class="sxs-lookup"><span data-stu-id="efac5-115">This is achieved by setting the socket option SO\_OOBINLINE (see section [**WSPIoctl**](/previous-versions/windows/hardware/network/ff566296(v=vs.85))).</span></span> <span data-ttu-id="efac5-116">Для других протоколов, в которых блоки данных OOB действительно не зависят от обычного потока данных, попытка установки \_ убинлине приведет к ошибке.</span><span class="sxs-lookup"><span data-stu-id="efac5-116">For other protocols where the OOB data blocks are truly independent of the normal data stream, attempting to set SO\_OOBINLINE will result in an error.</span></span> <span data-ttu-id="efac5-117">Приложение может использовать команду СИОКАТМАРК Вспиоктл, чтобы определить наличие непрочтенных данных OOB, предшествующих метке.</span><span class="sxs-lookup"><span data-stu-id="efac5-117">An application can use the SIOCATMARK WSPIoctl command to determine whether there is any unread OOB data preceding the mark.</span></span> <span data-ttu-id="efac5-118">Например, он может использовать его для повторной синхронизации с одноранговым узлом, гарантируя, что все данные в потоке данных будут отброшены при необходимости.</span><span class="sxs-lookup"><span data-stu-id="efac5-118">For example, it might use this to resynchronize with its peer by ensuring that all data up to the mark in the data stream is discarded when appropriate.</span></span>

<span data-ttu-id="efac5-119">WITH \_ убинлине Disabled (по умолчанию):</span><span class="sxs-lookup"><span data-stu-id="efac5-119">With SO\_OOBINLINE disabled (by default):</span></span>

-   <span data-ttu-id="efac5-120">Поставщик услуг Winsock уведомляет клиента о событии с ДЕМОном \_ OOB, если клиент, зарегистрированный для уведомления с [**вспасинкселект**](/previous-versions/windows/desktop/legacy/ms742267(v=vs.85)), точно так же, как и \_ прочитанный, используется для уведомления о присутствии обычных данных.</span><span class="sxs-lookup"><span data-stu-id="efac5-120">The Winsock service provider notifies a client of an FD\_OOB event, if the client registered for notification with [**WSPAsyncSelect**](/previous-versions/windows/desktop/legacy/ms742267(v=vs.85)), in exactly the same way FD\_READ is used to notify of the presence of normal data.</span></span> <span data-ttu-id="efac5-121">Это значит, что демон \_ OOB публикуется, когда приводятся данные OOB, а данные OOB ранее не помещаются в очередь, а также когда данные считываются с помощью \_ флага OOB, а некоторые данные OOB остаются для чтения после возврата операции чтения.</span><span class="sxs-lookup"><span data-stu-id="efac5-121">That is, FD\_OOB is posted when OOB data arrives and there was no OOB data previously queued, and also when data is read using the MSG\_OOB flag, and some OOB data remains to be read after the read operation has returned.</span></span> <span data-ttu-id="efac5-122">Сообщения ДЕМОна \_ чтения не размещаются для данных OOB.</span><span class="sxs-lookup"><span data-stu-id="efac5-122">FD\_READ messages are not posted for OOB data.</span></span>
-   <span data-ttu-id="efac5-123">Поставщик службы Winsock возвращает из [**вспселект**](/previous-versions/windows/desktop/legacy/ms742289(v=vs.85)) с соответствующим набором сокетов *ексцептфдс* , если данные OOB поставлены в очередь на сокете.</span><span class="sxs-lookup"><span data-stu-id="efac5-123">The Winsock service provider returns from [**WSPSelect**](/previous-versions/windows/desktop/legacy/ms742289(v=vs.85)) with the appropriate *exceptfds* socket set if OOB data is queued on the socket.</span></span>
-   <span data-ttu-id="efac5-124">Клиент может вызвать [**вспрекв**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) с сообщением \_ OOB для чтения блока срочных данных в любое время.</span><span class="sxs-lookup"><span data-stu-id="efac5-124">The client can call [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) with MSG\_OOB to read the urgent data block at any time.</span></span> <span data-ttu-id="efac5-125">Блок данных OOB переходит в очередь.</span><span class="sxs-lookup"><span data-stu-id="efac5-125">The block of OOB data jumps the queue.</span></span>
-   <span data-ttu-id="efac5-126">Клиент может вызвать [**вспрекв**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) без сообщения \_ OOB для чтения потока обычных данных.</span><span class="sxs-lookup"><span data-stu-id="efac5-126">The client can call [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) without MSG\_OOB to read the normal data stream.</span></span> <span data-ttu-id="efac5-127">Блок данных OOB не будет отображаться в потоке данных с обычными данными.</span><span class="sxs-lookup"><span data-stu-id="efac5-127">The OOB data block will not appear in the data stream with normal data.</span></span> <span data-ttu-id="efac5-128">Если данные OOB остаются после любого вызова **вспрекв**, поставщик услуг уведомляет клиента с помощью демона \_ OOB или *ексцептфдс* при использовании [**вспселект**](/previous-versions/windows/desktop/legacy/ms742289(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="efac5-128">If OOB data remains after any call to **WSPRecv**, the service provider notifies the client with FD\_OOB or through *exceptfds* when using [**WSPSelect**](/previous-versions/windows/desktop/legacy/ms742289(v=vs.85)).</span></span>
-   <span data-ttu-id="efac5-129">Для протоколов, в которых данные OOB имеют позицию в потоке обычных данных, одна операция [**вспрекв**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) не будет охватывать эту позицию.</span><span class="sxs-lookup"><span data-stu-id="efac5-129">For protocols where the OOB data has a position within the normal data stream, a single [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) operation will not span that position.</span></span> <span data-ttu-id="efac5-130">Один **вспрекв** вернет обычные данные перед меткой, а второй **вспрекв** — для начала чтения данных после метки.</span><span class="sxs-lookup"><span data-stu-id="efac5-130">One **WSPRecv** will return the normal data before the mark, and a second **WSPRecv** is required to begin reading data after the mark.</span></span>

<span data-ttu-id="efac5-131">При \_ включенном убинлине:</span><span class="sxs-lookup"><span data-stu-id="efac5-131">With SO\_OOBINLINE enabled:</span></span>

-   <span data-ttu-id="efac5-132">\_Стандартные сообщения OOB не отправляются для данных OOB. для функций [**Вспселект**](/previous-versions/windows/desktop/legacy/ms742289(v=vs.85)) и [**вспасинкселект**](/previous-versions/windows/desktop/legacy/ms742267(v=vs.85)) данные OOB обрабатываются как обычные данные и указываются путем установки сокета в *реадфдс* или путем отправки сообщения об прочитанном экземпляре фильтра \_ соответственно.</span><span class="sxs-lookup"><span data-stu-id="efac5-132">FD\_OOB messages are not posted for OOB data — for the purpose of the [**WSPSelect**](/previous-versions/windows/desktop/legacy/ms742289(v=vs.85)) and [**WSPAsyncSelect**](/previous-versions/windows/desktop/legacy/ms742267(v=vs.85)) functions, OOB data is treated as normal data, and indicated by setting the socket in *readfds* or by sending an FD\_READ message respectively.</span></span>
-   <span data-ttu-id="efac5-133">Клиент может не вызывать [**вспрекв**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) с \_ флагом сообщения OOB, установленным для чтения блока данных OOB — код ошибки всаеинвал будет возвращен.</span><span class="sxs-lookup"><span data-stu-id="efac5-133">The client may not call [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) with the MSG\_OOB flag set to read the OOB data block — the error code WSAEINVAL will be returned.</span></span>
-   <span data-ttu-id="efac5-134">Клиент может вызвать [**вспрекв**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) без \_ установленного флага OOB.</span><span class="sxs-lookup"><span data-stu-id="efac5-134">The client can call [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) without the MSG\_OOB flag set.</span></span> <span data-ttu-id="efac5-135">Все данные OOB будут доставляться в правильном порядке в потоке обычных данных.</span><span class="sxs-lookup"><span data-stu-id="efac5-135">Any OOB data will be delivered in its correct order within the normal data stream.</span></span> <span data-ttu-id="efac5-136">Данные OOB никогда не будут смешиваться с обычными данными — для получения данных OOB необходимо три запроса на чтение.</span><span class="sxs-lookup"><span data-stu-id="efac5-136">OOB data will never be mixed with normal data — there must be three read requests to get past the OOB data.</span></span> <span data-ttu-id="efac5-137">Первый возвращает обычные данные до блока данных OOB, второй возвращает данные OOB, третий — обычные данные, следующие за данными OOB.</span><span class="sxs-lookup"><span data-stu-id="efac5-137">The first returns the normal data prior to the OOB data block, the second returns the OOB data, the third returns the normal data following the OOB data.</span></span> <span data-ttu-id="efac5-138">Иными словами, границы блоков данных OOB сохраняются.</span><span class="sxs-lookup"><span data-stu-id="efac5-138">In other words, the OOB data block boundaries are preserved.</span></span>

<span data-ttu-id="efac5-139">Подпрограммы [**вспасинкселект**](/previous-versions/windows/desktop/legacy/ms742267(v=vs.85)) особенно хорошо подходят для обработки уведомлений о присутствии данных OOB, когда убинлине отключен \_ .</span><span class="sxs-lookup"><span data-stu-id="efac5-139">The [**WSPAsyncSelect**](/previous-versions/windows/desktop/legacy/ms742267(v=vs.85)) routine is particularly well suited to handling notification of the presence of OOB data when SO\_OOBINLINE is off.</span></span>

 

 
