---
description: В этом разделе приводятся общие сведения о делении ответственности между Ws2 \_32.dll и поставщиками транспортной службы.
ms.assetid: e1ea1e99-a2bc-4e76-91f6-e388c39dfbbb
title: Распределение обязанностей между библиотекой DLL и поставщиками услуг
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 142ac98c95e95c310c2eefb7bfdaf1f70a03bf28
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105693388"
---
# <a name="transport-division-of-responsibilities-between-dll-and-service-providers"></a><span data-ttu-id="b4d62-103">Распределение обязанностей между библиотекой DLL и поставщиками услуг</span><span class="sxs-lookup"><span data-stu-id="b4d62-103">Transport Division of Responsibilities Between DLL and Service Providers</span></span>

<span data-ttu-id="b4d62-104">В этом разделе приводятся общие сведения о делении ответственности между Ws2 \_32.dll и поставщиками транспортной службы.</span><span class="sxs-lookup"><span data-stu-id="b4d62-104">This section provides an overview of the division of responsibility between the Ws2\_32.dll and transport service providers.</span></span>

## <a name="ws2_32dll-functionality-for-transport"></a><span data-ttu-id="b4d62-105">\_Функции32.dll Ws2 для транспорта</span><span class="sxs-lookup"><span data-stu-id="b4d62-105">Ws2\_32.dll Functionality for Transport</span></span>

<span data-ttu-id="b4d62-106">Основная задача транспортной части Ws2 \_32.dll — служить диспетчером трафика между поставщиками услуг и приложениями.</span><span class="sxs-lookup"><span data-stu-id="b4d62-106">The major task of the data transport portion of the Ws2\_32.dll is to serve as traffic manager between service providers and applications.</span></span> <span data-ttu-id="b4d62-107">При наличии нескольких разных поставщиков служб, взаимодействующих с одним и тем же приложением, каждый поставщик служб взаимодействует строго с \_32.dll Ws2.</span><span class="sxs-lookup"><span data-stu-id="b4d62-107">With several different service providers interacting with the same application, each service provider interacts strictly with the Ws2\_32.dll.</span></span> <span data-ttu-id="b4d62-108">Библиотека DLL принимает следующие меры.</span><span class="sxs-lookup"><span data-stu-id="b4d62-108">The DLL takes care of:</span></span>

-   <span data-ttu-id="b4d62-109">Выбор подходящего поставщика услуг для создания сокетов на основе описания протокола.</span><span class="sxs-lookup"><span data-stu-id="b4d62-109">Selecting an appropriate service provider for creating sockets based on a protocol description.</span></span>
-   <span data-ttu-id="b4d62-110">Пересылка вызовов процедур приложений, включающих сокет, к соответствующему поставщику услуг, который создал или управляет этим сокетом.</span><span class="sxs-lookup"><span data-stu-id="b4d62-110">Forwarding application procedure calls involving a socket to the appropriate service provider that created or controls that socket.</span></span> <span data-ttu-id="b4d62-111">Поставщики услуг не знают, что происходит любое из этих ситуаций.</span><span class="sxs-lookup"><span data-stu-id="b4d62-111">Service providers are unaware that any of this is happening.</span></span>

<span data-ttu-id="b4d62-112">Им не нужно беспокоиться о взаимодействии друг с другом или даже о существовании других поставщиков услуг.</span><span class="sxs-lookup"><span data-stu-id="b4d62-112">They do not need to be concerned about the details of cooperating with one another or even the existence of other service providers.</span></span> <span data-ttu-id="b4d62-113">Путем абстракции поставщиков служб в согласованный интерфейс DLL и выполнения этой функции автоматической маршрутизации трафика Ws2 \_32.dll позволяет приложениям взаимодействовать с различными поставщиками, не требуя от приложений подсчета подразделений между поставщиками, где установлены разные поставщики.</span><span class="sxs-lookup"><span data-stu-id="b4d62-113">By abstracting the service providers into a consistent DLL interface and performing this automatic traffic routing function, the Ws2\_32.dll allows applications to interact with a variety of providers without requiring the applications to be aware of the divisions between providers, where different providers are installed.</span></span>

<span data-ttu-id="b4d62-114">Ws2 \_32.dll полагается на параметры функций создания сокетов API ( [**Socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) и [**всасоккет**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa)), чтобы определить, какой поставщик услуг использовать.</span><span class="sxs-lookup"><span data-stu-id="b4d62-114">The Ws2\_32.dll relies on the parameters of the API socket creation functions ( [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) and [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa)) to determine which service provider to utilize.</span></span> <span data-ttu-id="b4d62-115">Выбранный поставщик транспортной службы будет вызываться с помощью функции [**вспсоккет**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) .</span><span class="sxs-lookup"><span data-stu-id="b4d62-115">The selected transport service provider will be invoked through the [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) function.</span></span> <span data-ttu-id="b4d62-116">В случае функции **сокета** Ws2 \_32.dll находит первую запись в наборе структур [**всапротокол \_ info**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) , соответствующих значениям в кортеже, сформированном параметрами (*семейство адресов*, *тип сокета*, *протокол*).</span><span class="sxs-lookup"><span data-stu-id="b4d62-116">In the case of the **socket** function, the Ws2\_32.dll finds the first entry in the set of installed [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structures that matches the values supplied in the tuple formed by the (*address family*, *socket type*, *protocol*) parameters.</span></span> <span data-ttu-id="b4d62-117">Чтобы сохранить обратную совместимость, Ws2 \_32.dll считает нулевое значение для *семейства адресов* или *типа сокета* как значение с подстановочным знаком.</span><span class="sxs-lookup"><span data-stu-id="b4d62-117">To preserve backward compatibility, the Ws2\_32.dll treats the value of zero for either *address family* or *socket type* as a wildcard value.</span></span> <span data-ttu-id="b4d62-118">Нулевое значение для протокола не считается подстановочным значением32.dll Ws2, \_ если такое поведение не указано для конкретного протокола, так как в \_ \_ \_ структуре **\_ сведений всапротокол** установлен флаг PFL, соответствующий протоколу 0.</span><span class="sxs-lookup"><span data-stu-id="b4d62-118">The value of zero for protocol is not considered a wildcard value by the Ws2\_32.dll unless such behavior is indicated for a particular protocol by having the PFL\_MATCHES\_PROTOCOL\_ZERO flag set in the **WSAPROTOCOL\_INFO** structure.</span></span>

<span data-ttu-id="b4d62-119">Для функции [**всасоккет**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) , если для *лппротоколинфо* задано значение null, поведение будет точно так же, как было описано для [**сокета**](/windows/desktop/api/Winsock2/nf-winsock2-socket).</span><span class="sxs-lookup"><span data-stu-id="b4d62-119">For the [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) function, if null is supplied for *lpProtocolInfo*, the behavior is exactly as just described for [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket).</span></span> <span data-ttu-id="b4d62-120">Однако если [**ссылка \_ на структуру всапротокол**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) указана, то Ws2 \_32.dll не выполняет ни одной функции сопоставления, но немедленно передает запрос на создание сокета поставщику службы транспорта, связанному с указанной структурой **\_ сведений о всапротокол** .</span><span class="sxs-lookup"><span data-stu-id="b4d62-120">If a [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure is referenced, however, the Ws2\_32.dll does not perform any matching function but immediately relays the socket creation request to the transport service provider associated with the indicated **WSAPROTOCOL\_INFO** structure.</span></span> <span data-ttu-id="b4d62-121">Значения для кортежей (*семейство адресов,* *тип сокета,*) предоставляются поставщиком услуг в функции [**вспсоккет**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) .</span><span class="sxs-lookup"><span data-stu-id="b4d62-121">The values for the (*address family,* *socket type,*) tuple are supplied intact to the service provider in the [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) function.</span></span> <span data-ttu-id="b4d62-122">Поставщики услуг можно игнорировать или обратить внимание на значения параметров (*семейство адресов,* *тип сокета,*), так как это уместно, но они не должны указывать на ошибку, если значение *семейства адресов* или *типа сокета* равно нулю.</span><span class="sxs-lookup"><span data-stu-id="b4d62-122">Service providers are free to ignore or pay attention to the values of the (*address family,* *socket type,*) parameters as is appropriate, but they must not indicate an error condition when the value of either *address family* or *socket type* is zero.</span></span> <span data-ttu-id="b4d62-123">Кроме того, поставщики услуг не должны указывать на ошибку, если константа манифеста \_ из \_ сведений о протоколе содержится в любом из параметров (*семейство адресов,* *тип сокета,*).</span><span class="sxs-lookup"><span data-stu-id="b4d62-123">In addition, service providers must not indicate an error condition when the manifest constant FROM\_PROTOCOL\_INFO is contained in any of the (*address family,* *socket type,*) parameters.</span></span> <span data-ttu-id="b4d62-124">Это значение просто указывает, что приложение должно использовать значения, находящиеся в соответствующих параметрах структуры **всапротокол \_ info** : (**иаддрессфамили**, **исоккеттипе**, **ипротокол**).</span><span class="sxs-lookup"><span data-stu-id="b4d62-124">This value simply indicates that the application wishes to use the values found in the corresponding parameters of the **WSAPROTOCOL\_INFO** structure: (**iAddressFamily**, **iSocketType**, **iProtocol**).</span></span>

<span data-ttu-id="b4d62-125">В рамках создания сокета поставщик услуг информирует Ws2 \_32.dll о взаимосвязи между собой и новым сокетом с помощью параметров, передаваемых [**Впукреатесоккесандле**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle) или [**впумодифифшандле**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle).</span><span class="sxs-lookup"><span data-stu-id="b4d62-125">As part of socket creation, a service provider informs the Ws2\_32.dll about the association between itself and the new socket by means of parameters passed to [**WPUCreateSocketHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle) or [**WPUModifyIFSHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle).</span></span> <span data-ttu-id="b4d62-126">Ws2 \_32.dll отслеживает эту связь между дескрипторами сокетов и конкретными поставщиками услуг.</span><span class="sxs-lookup"><span data-stu-id="b4d62-126">The Ws2\_32.dll keeps track of this association between socket handles and particular service providers.</span></span> <span data-ttu-id="b4d62-127">При вызове функции интерфейса приложения, ссылающейся на маркер сокета, Ws2 \_32.dll ищет ассоциацию и вызывает соответствующую функцию интерфейса поставщика услуг соответствующего поставщика услуг.</span><span class="sxs-lookup"><span data-stu-id="b4d62-127">Whenever an application interface function that refers to a socket handle is called, the Ws2\_32.dll looks up the association and calls the corresponding service provider interface function of the appropriate service provider.</span></span>

<span data-ttu-id="b4d62-128">Помимо основной службы маршрутизации трафика Ws2 \_32.dll предоставляет ряд других служб, таких как перечисление протоколов, управление дескрипторами сокетов (выделение, освобождение и сопоставление значений контекста) для поставщиков служб, не использующих системные системы, Блокировка управления обработчиками для каждого потока, служебные программы для обмена байтами, очередь вызовов асинхронных процедур (APC) для упрощения вызова подподпрограмм завершения ввода-вывода и согласования версий между приложениями и \_32.dll Ws2, а также между Ws2 \_32.dll и поставщиками служб.</span><span class="sxs-lookup"><span data-stu-id="b4d62-128">In addition to its major traffic routing service, the Ws2\_32.dll provides a number of other services such as protocol enumeration, socket descriptor management (allocation, deallocation, and context value association) for nonfile-system service providers, blocking hook management on a per-thread basis, byte-swapping utilities, queuing of asynchronous procedure calls (APCs) to facilitate invocation of I/O completion routines, and version negotiation between applications and the Ws2\_32.dll, as well as between the Ws2\_32.dll and service providers.</span></span>

## <a name="transport-service-provider-functionality"></a><span data-ttu-id="b4d62-129">Функциональные возможности поставщика услуг транспорта</span><span class="sxs-lookup"><span data-stu-id="b4d62-129">Transport Service Provider Functionality</span></span>

<span data-ttu-id="b4d62-130">Поставщики услуг реализуют фактический транспортный протокол, который включает такие функции, как Настройка подключений, передача данных, применение управления потоком, Управление ошибками и т. д.32.dll Ws2 \_ не имеет сведений о том, как реализуются запросы к поставщикам услуг; это относится к реализации поставщика услуг.</span><span class="sxs-lookup"><span data-stu-id="b4d62-130">Service providers implement the actual transport protocol which includes such functions as setting up connections, transferring data, exercising flow control and error control, etc. The Ws2\_32.dll has no knowledge about how requests to service providers are realized; this is up to the service provider implementation.</span></span> <span data-ttu-id="b4d62-131">Реализация таких функций может сильно отличаться от одного поставщика к другому.</span><span class="sxs-lookup"><span data-stu-id="b4d62-131">The implementation of such functions may differ greatly from one provider to another.</span></span> <span data-ttu-id="b4d62-132">Поставщики услуг скрывают сведения, относящиеся к реализации, о том, как выполняются сетевые операции.</span><span class="sxs-lookup"><span data-stu-id="b4d62-132">Service providers hide the implementation-specific details of how network operations are accomplished.</span></span>

<span data-ttu-id="b4d62-133">Поставщики транспортной службы можно разделить на две категории: те, у которых дескрипторы сокетов являются реальными дескрипторами файловой системы (и которые в дальнейшем называются поставщиками устанавливаемой файловой системы (IFS); остальные называются поставщиками, не являющимися файлами IFS.</span><span class="sxs-lookup"><span data-stu-id="b4d62-133">Transport service providers can be broadly divided into two categories: those whose socket descriptors are real file system handles (and are hereafter referred to as Installable File System (IFS) providers; the remainder are referred to as non-IFS providers.</span></span> <span data-ttu-id="b4d62-134">Ws2 \_32.dll всегда передает дескриптор сокета поставщика транспортного приложения в приложение Windows Sockets, поэтому приложения могут использовать преимущества дескрипторов сокетов, которые обрабатываются в файловой системе, если это так.</span><span class="sxs-lookup"><span data-stu-id="b4d62-134">The Ws2\_32.dll always passes the transport service provider's socket descriptor on up to the Windows Sockets application, so applications are free to take advantage of socket descriptors that are file system handles if they so choose.</span></span>

<span data-ttu-id="b4d62-135">Итоги. поставщики служб реализуют низкоуровневые сетевые протоколы.</span><span class="sxs-lookup"><span data-stu-id="b4d62-135">To summarize: service providers implement the low-level network-specific protocols.</span></span> <span data-ttu-id="b4d62-136">Ws2 \_32.dll обеспечивает управление трафиком на среднем уровне, которое позволяет подключать эти транспортные протоколы к приложениям.</span><span class="sxs-lookup"><span data-stu-id="b4d62-136">The Ws2\_32.dll provides the medium-level traffic management that interconnects these transport protocols with applications.</span></span> <span data-ttu-id="b4d62-137">Приложения, в свою очередь, предоставляют политику того, как потоки трафика и операции, связанные с сетью, используются для выполнения нужных пользователю функций.</span><span class="sxs-lookup"><span data-stu-id="b4d62-137">Applications in turn provide the policy of how these traffic streams and network-specific operations are used to accomplish the functions desired by the user.</span></span>

 

 
