---
description: Средства отладки и трассировки и сокеты Windows 2.
ms.assetid: eb29fc21-92d6-4471-860a-fd1c531686f6
title: Средства отладки и трассировки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7288c6b4d72a7a375ee16da23a25b0a04a46df91
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692293"
---
# <a name="debug-and-trace-facilities"></a><span data-ttu-id="2a099-103">Средства отладки и трассировки</span><span class="sxs-lookup"><span data-stu-id="2a099-103">Debug and Trace Facilities</span></span>

<span data-ttu-id="2a099-104">Разработчикам приложений Windows Sockets 2 необходимо изолировать ошибки в:</span><span class="sxs-lookup"><span data-stu-id="2a099-104">Windows Sockets 2 application developers need to isolate bugs in:</span></span>

-   <span data-ttu-id="2a099-105">Приложение.</span><span class="sxs-lookup"><span data-stu-id="2a099-105">The application.</span></span>
-   <span data-ttu-id="2a099-106">*\_32.dllWs2* или одна из библиотек DLL оболочки совместимости.</span><span class="sxs-lookup"><span data-stu-id="2a099-106">The *Ws2\_32.dll* or one of the compatibility shim DLLs.</span></span>
-   <span data-ttu-id="2a099-107">Поставщик службы.</span><span class="sxs-lookup"><span data-stu-id="2a099-107">The service provider.</span></span>

<span data-ttu-id="2a099-108">Windows Sockets 2 устраняет эту потребность с помощью нескольких компонентов и функций:</span><span class="sxs-lookup"><span data-stu-id="2a099-108">Windows Sockets 2 addresses this need through several components and features:</span></span>

-   <span data-ttu-id="2a099-109">Интегрированная поддержка трассировки Winsock в Windows Vista и более поздних версиях.</span><span class="sxs-lookup"><span data-stu-id="2a099-109">Integrated support for Winsock tracing on Windows Vista and later.</span></span>
-   <span data-ttu-id="2a099-110">Специально исправленная отладочная версия *\_32.dllWs2* в Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="2a099-110">A specially devised debug version of the *Ws2\_32.dll* on Windows Vista.</span></span>
-   <span data-ttu-id="2a099-111">Отдельные простые средства отладки и трассировки для использования в Windows Server 2003 и Windows XP.</span><span class="sxs-lookup"><span data-stu-id="2a099-111">A separate primitive debug and trace facility for use on Windows Server 2003 and Windows XP.</span></span>

## <a name="winsock-tracing-using-event-tracing-for-windows"></a><span data-ttu-id="2a099-112">Трассировка Winsock с помощью трассировки событий для Windows</span><span class="sxs-lookup"><span data-stu-id="2a099-112">Winsock Tracing using Event Tracing for Windows</span></span>

<span data-ttu-id="2a099-113">Интегрированная поддержка трассировки Winsock с помощью трассировки событий Windows (ETW) включена в Windows Vista и более поздние версии.</span><span class="sxs-lookup"><span data-stu-id="2a099-113">Integrated support for Winsock tracing using Event Tracing for Windows (ETW) is included on Windows Vista and later.</span></span> <span data-ttu-id="2a099-114">Это предпочтительный метод для трассировки вызовов Winsock в Windows Vista и более поздних версиях.</span><span class="sxs-lookup"><span data-stu-id="2a099-114">This is the preferred method for tracing Winsock calls on Windows Vista and later.</span></span> <span data-ttu-id="2a099-115">Трассировка Winsock с использованием ETW является облегченной и работает в розничных версиях Windows.</span><span class="sxs-lookup"><span data-stu-id="2a099-115">Winsock tracing using ETW is lightweight and works on retail versions of Windows.</span></span> <span data-ttu-id="2a099-116">Дополнительное программное обеспечение или компоненты не требуются.</span><span class="sxs-lookup"><span data-stu-id="2a099-116">No additional software or components are required.</span></span> <span data-ttu-id="2a099-117">Эта функция должна быть включена только в Windows Vista и более поздних версиях.</span><span class="sxs-lookup"><span data-stu-id="2a099-117">This feature just needs to be enabled on Windows Vista and later.</span></span> <span data-ttu-id="2a099-118">Дополнительные сведения см. в разделах, посвященных [трассировке Winsock](winsock-tracing.md) .</span><span class="sxs-lookup"><span data-stu-id="2a099-118">For more detailed information, see the [Winsock Tracing](winsock-tracing.md) topics.</span></span>

## <a name="using-a-debug-version-of-ws2_32dll"></a><span data-ttu-id="2a099-119">Использование отладочной версии Ws2 \_32.dll</span><span class="sxs-lookup"><span data-stu-id="2a099-119">Using a Debug Version of Ws2\_32.dll</span></span>

<span data-ttu-id="2a099-120">Сочетание отладочной версии *\_32.dllWs2* в Windows Vista и трассировке Winsock позволяет отслеживать все вызовы процедур через API Windows Sockets 2 или SPI и, в некоторой степени, управлять ими.</span><span class="sxs-lookup"><span data-stu-id="2a099-120">The combination of a debug version of the *Ws2\_32.dll* on Windows Vista and Winsock tracing allows all procedure calls across the Windows Sockets 2 API or SPI to be monitored and, to some extent, controlled.</span></span>

<span data-ttu-id="2a099-121">Если версия пакета средств разработки программного обеспечения Microsoft Windows (SDK) для Windows Vista установлена в расположение по умолчанию, отладочные версии *\_32.dllWs2* для различных архитектур находятся в следующей папке:</span><span class="sxs-lookup"><span data-stu-id="2a099-121">If a version of the Microsoft Windows Software Development Kit (SDK) for Windows Vista is installed to the default location, debug versions of the *Ws2\_32.dll* for various architectures are located under the following folder:</span></span>

<span data-ttu-id="2a099-122">**C: \\ Program Files \\ Microsoft SDK \\ Windows \\ v 6.0 \\ норедист**</span><span class="sxs-lookup"><span data-stu-id="2a099-122">**C:\\Program Files\\Microsoft SDKs\\Windows\\v6.0\\NoRedist**</span></span>

<span data-ttu-id="2a099-123">Следует использовать проверенную версию *\_32.dllWs2* , соответствующую версии Windows и пакету обновления, на котором выполняется тестирование.</span><span class="sxs-lookup"><span data-stu-id="2a099-123">A checked version of the *Ws2\_32.dll* that matches the version of Windows and the Service Pack you are testing on should be used.</span></span> <span data-ttu-id="2a099-124">Имейте в виду, что были применены исправления безопасности, обновленные *\_32.dllWs2* в тестовой системе.</span><span class="sxs-lookup"><span data-stu-id="2a099-124">Be aware that security patches may have been applied that updated the *Ws2\_32.dll* on your test system.</span></span> <span data-ttu-id="2a099-125">Windows SDK для Windows Vista и драйверов DVD/CD пакета средств разработки программного обеспечения (SDK) на платформе более ранней версии включают проверенные сборки для различных версий Windows.</span><span class="sxs-lookup"><span data-stu-id="2a099-125">The Windows SDK for Windows Vista and the earlier Platform Software Development Kit (SDK) DVD/CD subscriptions include checked builds for the various versions of Windows.</span></span> <span data-ttu-id="2a099-126">Следует использовать ту же проверенную версию *Ws2 \_32.dll* в качестве розничной версии, которая использовалась в тестируемой системе.</span><span class="sxs-lookup"><span data-stu-id="2a099-126">You should use the same checked version of the *Ws2\_32.dll* as the retail version that was used on the system being tested.</span></span> <span data-ttu-id="2a099-127">Обратите внимание, что поведение, выполняемое в проверенной сборке, не будет совпадать с запуском в розничной сборке.</span><span class="sxs-lookup"><span data-stu-id="2a099-127">Note also that behavior running under a checked build will not be the same as running with a retail build.</span></span>

<span data-ttu-id="2a099-128">**Примечание**  .  Windows SDK для Windows Server 2008 и более поздних версий больше не включает специальные отладочные *версии \_32.dllWs2*.</span><span class="sxs-lookup"><span data-stu-id="2a099-128">**Note**  The Windows SDK for Windows Server 2008 and later no longer includes special debug versions of the *Ws2\_32.dll*.</span></span> <span data-ttu-id="2a099-129">Вместо этого для разработчиков следует использовать трассировку Winsock с помощью ETW, так как эта функция не требует отладочных сборок.</span><span class="sxs-lookup"><span data-stu-id="2a099-129">Developers should use Winsock tracing using ETW instead, since this feature does not require debug builds.</span></span>

## <a name="winsock-debug-and-trace-facility-on-windows-server-2003-and-windows-xp"></a><span data-ttu-id="2a099-130">Отладка и трассировка Winsock в Windows Server 2003 и Windows XP</span><span class="sxs-lookup"><span data-stu-id="2a099-130">Winsock Debug and Trace Facility on Windows Server 2003 and Windows XP</span></span>

<span data-ttu-id="2a099-131">Более старые версии Windows до Windows 8 и Windows Server 2012 поддерживают отдельное средство отладки и трассировки, которое входит в состав примера с Windows SDK и пакетом SDK для платформы предыдущих версий.</span><span class="sxs-lookup"><span data-stu-id="2a099-131">Older versions of Windows prior to Windows 8 and Windows Server 2012 support a separate primitive debug and trace facility that is included as a sample with the Windows SDK and the older Platform SDK.</span></span> <span data-ttu-id="2a099-132">Средство отладки и трассировки следует использовать только в Windows Server 2003 и Windows XP, где трассировка Winsock не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="2a099-132">The debug/trace facility should only be used on Windows Server 2003 and Windows XP where Winsock tracing is not supported.</span></span>

<span data-ttu-id="2a099-133">Если Windows SDK для Windows 7 установлена в расположение по умолчанию, эта функция трассировки Winsock устанавливается в следующую папку:</span><span class="sxs-lookup"><span data-stu-id="2a099-133">If the Windows SDK for Windows 7 is installed to the default location, this primitive Winsock tracing feature is installed in the following folder:</span></span>

<span data-ttu-id="2a099-134">**C: \\ Program Files \\ Microsoft SDK \\ Windows \\ v 7.0 \\ Samples \\ нетдс \\ библиотека Winsock \\ DT \_ DLL**</span><span class="sxs-lookup"><span data-stu-id="2a099-134">**C:\\Program Files\\Microsoft SDKs\\Windows\\v7.0\\Samples\\NetDs\\winsock\\dt\_dll**</span></span>

<span data-ttu-id="2a099-135">Файл *DbgSpec.doc* в этой папке содержит документацию по этому примитиву трассировки.</span><span class="sxs-lookup"><span data-stu-id="2a099-135">The *DbgSpec.doc* file in this folder provides documentation on this primitive trace facility.</span></span> <span data-ttu-id="2a099-136">Пример кода в \_ папке DLL DT должен быть скомпилирован для использования этого средства.</span><span class="sxs-lookup"><span data-stu-id="2a099-136">The sample code in the dt\_dll folder needs to be compiled to use this facility.</span></span> <span data-ttu-id="2a099-137">Разработчики могут использовать исходный код для разработки версий библиотеки DLL отладки и трассировки, которые отвечают определенным потребностям.</span><span class="sxs-lookup"><span data-stu-id="2a099-137">Developers are free to use the source code to develop versions of the debug/trace DLL that meet their specific needs.</span></span>

<span data-ttu-id="2a099-138">Обратите внимание, что этот примитив функции трассировки Winsock будет работать только с отладочной версией *Ws2 \_32.dll* установлен.</span><span class="sxs-lookup"><span data-stu-id="2a099-138">Note that this primitive Winsock trace feature will only work with the debug version of *Ws2\_32.dll* installed.</span></span> <span data-ttu-id="2a099-139">Поэтому необходимо получить установленную версию *Ws2 \_32.dll* , соответствующую версии Windows и пакета обновления, на котором выполняется тестирование.</span><span class="sxs-lookup"><span data-stu-id="2a099-139">So you will need to get a checked version of the *Ws2\_32.dll* that matches the version of Windows and the Service Pack you are testing on.</span></span>

<span data-ttu-id="2a099-140">Ограничение этого примитива \_ трассировки DLL-библиотеки DT состоит в том, что в примере кода используется глобальная блокировка (критический раздел) для каждого вызова функции Winsock.</span><span class="sxs-lookup"><span data-stu-id="2a099-140">A limitation of this primitive dt\_dll trace facility is that the sample code uses a global lock (critical section) for each Winsock function call.</span></span> <span data-ttu-id="2a099-141">Поэтому этот механизм не полезен при работе с условиями гонки.</span><span class="sxs-lookup"><span data-stu-id="2a099-141">So this facility is not useful in dealing with race conditions.</span></span> <span data-ttu-id="2a099-142">Пример кода должен быть значительно переписан, чтобы сделать этот механизм трассировки полезным для решения большинства реальных проблем с Winsock (замена глобальных блокировок).</span><span class="sxs-lookup"><span data-stu-id="2a099-142">The sample code would need to be substantially rewritten to make this trace facility useful for dealing with most real Winsock problems (replacing the global locks).</span></span> <span data-ttu-id="2a099-143">Этот пример кода позволяет разработчикам отслеживать вызовы процедур, возвраты процедур, значения параметров и возвращаемые значения.</span><span class="sxs-lookup"><span data-stu-id="2a099-143">This sample code does allow developers to trace the procedure calls, procedure returns, parameter values, and return values.</span></span>

<span data-ttu-id="2a099-144">Разработчики могут использовать этот механизм примитива для трассировки вызовов процедур, возврата процедур, значений параметров и возвращаемых значений.</span><span class="sxs-lookup"><span data-stu-id="2a099-144">Developers can use this primitive mechanism to trace procedure calls, procedure returns, parameter values, and return values.</span></span> <span data-ttu-id="2a099-145">Значения параметров и возвращаемые значения можно изменить при вызове процедуры или возврате процедуры.</span><span class="sxs-lookup"><span data-stu-id="2a099-145">Parameter values and return values can be altered on procedure call or procedure return.</span></span> <span data-ttu-id="2a099-146">При необходимости вызов процедуры можно запретить или перенаправить.</span><span class="sxs-lookup"><span data-stu-id="2a099-146">If desired, a procedure call can be prevented or redirected.</span></span> <span data-ttu-id="2a099-147">Благодаря доступу к этому уровню информации и контроля разработчик лучше может изолировать проблему в приложении, *Ws2 \_32.dll* или поставщике услуг.</span><span class="sxs-lookup"><span data-stu-id="2a099-147">With access to this level of information and control, a developer is better able to isolate a problem in the application, *Ws2\_32.dll*, or service provider.</span></span>

## <a name="related-topics"></a><span data-ttu-id="2a099-148">См. также</span><span class="sxs-lookup"><span data-stu-id="2a099-148">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2a099-149">Трассировка Winsock</span><span class="sxs-lookup"><span data-stu-id="2a099-149">Winsock Tracing</span></span>](winsock-tracing.md)
</dt> </dl>

 

 



