---
description: Запрашивает, как сетевой стек должен обрабатывать определенные поведения, для которых по умолчанию обработка поведения может отличаться в разных версиях Windows.
ms.assetid: 9574e21f-5ac4-4210-8031-2f3b07416813
title: Код элемента управления SIO_SET_COMPATIBILITY_MODE
ms.topic: reference
ms.date: 05/20/2019
req.target-min-winverclnt: Windows Vista [desktop apps only]
req.target-min-winversvr: Windows Server 2008 [desktop apps only]
api_location:
- mstcpip.h
ms.openlocfilehash: 58972595adb71a30728cb4817a80814cd987a6de
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105719340"
---
# <a name="sio_set_compatibility_mode-control-code"></a><span data-ttu-id="61364-103">Код элемента управления SIO_SET_COMPATIBILITY_MODE</span><span class="sxs-lookup"><span data-stu-id="61364-103">SIO_SET_COMPATIBILITY_MODE Control Code</span></span>

## <a name="description"></a><span data-ttu-id="61364-104">Описание</span><span class="sxs-lookup"><span data-stu-id="61364-104">Description</span></span>

<span data-ttu-id="61364-105">Управляющий код, заданный в **\_ \_ \_ режиме совместимости** , запрашивает, как сетевой стек должен обрабатывать определенные поведения, для которых поведение по умолчанию может различаться в разных версиях Windows.</span><span class="sxs-lookup"><span data-stu-id="61364-105">The **SIO\_SET\_COMPATIBILITY\_MODE** control code requests how the networking stack should handle certain behaviors for which the default way of handling the behavior may differ across Windows versions.</span></span>

<span data-ttu-id="61364-106">Чтобы выполнить эту операцию, вызовите функцию [**всаиоктл**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) или **вспиоктл** со следующими параметрами.</span><span class="sxs-lookup"><span data-stu-id="61364-106">To perform this operation, call the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function with the following parameters.</span></span>

```cpp
int WSAIoctl(
  (socket) s,             // descriptor identifying a socket
  SIO_SET_COMPATIBILITY_MODE, // dwIoControlCode
  (LPVOID) lpvInBuffer,    // pointer to WSA_COMPATIBILITY_MODE struct
  (DWORD) cbInBuffer,      // length of input buffer
  NULL,         // output buffer
  0,       // size of output buffer
  (LPDWORD) lpcbBytesReturned,    // number of bytes returned
  (LPWSAOVERLAPPED) lpOverlapped,   // OVERLAPPED structure
  (LPWSAOVERLAPPED_COMPLETION_ROUTINE) lpCompletionRoutine,  // completion routine
);
```

```cpp
int WSPIoctl(
  (socket) s,             // descriptor identifying a socket
  SIO_SET_COMPATIBILITY_MODE, // dwIoControlCode
  (LPVOID) lpvInBuffer,    // pointer to WSA_COMPATIBILITY_MODE struct
  (DWORD) cbInBuffer,      // length of input buffer
  NULL,         // output buffer
  0,       // size of output buffer
  (LPDWORD) lpcbBytesReturned,    // number of bytes returned
  (LPWSAOVERLAPPED) lpOverlapped,   // OVERLAPPED structure
  (LPWSAOVERLAPPED_COMPLETION_ROUTINE) lpCompletionRoutine,  // completion routine
  (LPWSATHREADID) lpThreadId,   // a WSATHREADID structure
  (LPINT) lpErrno   // a pointer to the error code.
);
```

## <a name="parameters"></a><span data-ttu-id="61364-107">Параметры</span><span class="sxs-lookup"><span data-stu-id="61364-107">Parameters</span></span>

### <a name="s"></a><span data-ttu-id="61364-108">s</span><span class="sxs-lookup"><span data-stu-id="61364-108">s</span></span>

<span data-ttu-id="61364-109">Дескриптор, идентифицирующий сокет.</span><span class="sxs-lookup"><span data-stu-id="61364-109">A descriptor identifying a socket.</span></span>

### <a name="dwiocontrolcode"></a><span data-ttu-id="61364-110">двиоконтролкоде</span><span class="sxs-lookup"><span data-stu-id="61364-110">dwIoControlCode</span></span>

<span data-ttu-id="61364-111">Управляющий код для операции.</span><span class="sxs-lookup"><span data-stu-id="61364-111">The control code for the operation.</span></span>
<span data-ttu-id="61364-112">Используйте для этой операции **SIO для \_ установки \_ \_ режима совместимости** .</span><span class="sxs-lookup"><span data-stu-id="61364-112">Use **SIO\_SET\_COMPATIBILITY\_MODE** for this operation.</span></span>

### <a name="lpvinbuffer"></a><span data-ttu-id="61364-113">лпвинбуффер</span><span class="sxs-lookup"><span data-stu-id="61364-113">lpvInBuffer</span></span>

<span data-ttu-id="61364-114">Указатель на входной буфер.</span><span class="sxs-lookup"><span data-stu-id="61364-114">A pointer to the input buffer.</span></span>
<span data-ttu-id="61364-115">Этот параметр должен указывать на структуру **\_ \_ режима совместимости WSA** .</span><span class="sxs-lookup"><span data-stu-id="61364-115">This parameter should point to a **WSA\_COMPATIBILITY\_MODE** structure.</span></span>

### <a name="cbinbuffer"></a><span data-ttu-id="61364-116">кбинбуффер</span><span class="sxs-lookup"><span data-stu-id="61364-116">cbInBuffer</span></span>

<span data-ttu-id="61364-117">Размер входного буфера в байтах.</span><span class="sxs-lookup"><span data-stu-id="61364-117">The size, in bytes, of the input buffer.</span></span>
<span data-ttu-id="61364-118">Этот параметр должен быть больше или равен размеру структуры **\_ \_ режима совместимости WSA** , на которую указывает параметр *лпвинбуффер* .</span><span class="sxs-lookup"><span data-stu-id="61364-118">This parameter should equal to or greater than the size of the **WSA\_COMPATIBILITY\_MODE** structure pointed to by the *lpvInBuffer* parameter.</span></span>

### <a name="lpvoutbuffer"></a><span data-ttu-id="61364-119">лпваутбуффер</span><span class="sxs-lookup"><span data-stu-id="61364-119">lpvOutBuffer</span></span>

<span data-ttu-id="61364-120">Указатель на выходной буфер.</span><span class="sxs-lookup"><span data-stu-id="61364-120">A pointer to the output buffer.</span></span>
<span data-ttu-id="61364-121">Этот параметр не используется для этой операции.</span><span class="sxs-lookup"><span data-stu-id="61364-121">This parameter is unused for this operation.</span></span>

### <a name="cboutbuffer"></a><span data-ttu-id="61364-122">кбаутбуффер</span><span class="sxs-lookup"><span data-stu-id="61364-122">cbOutBuffer</span></span>

<span data-ttu-id="61364-123">Размер выходного буфера в байтах.</span><span class="sxs-lookup"><span data-stu-id="61364-123">The size, in bytes, of the output buffer.</span></span>
<span data-ttu-id="61364-124">Этот параметр должен иметь значение 0.</span><span class="sxs-lookup"><span data-stu-id="61364-124">This parameter must be set to zero.</span></span>

### <a name="lpcbbytesreturned"></a><span data-ttu-id="61364-125">лпкббитесретурнед</span><span class="sxs-lookup"><span data-stu-id="61364-125">lpcbBytesReturned</span></span>

<span data-ttu-id="61364-126">Указатель на переменную, которая получает размер данных, хранящихся в выходном буфере, в байтах.</span><span class="sxs-lookup"><span data-stu-id="61364-126">A pointer to a variable that receives the size, in bytes, of the data stored in the output buffer.</span></span>
<span data-ttu-id="61364-127">Этот возвращаемый параметр указывает на значение **DWORD** , равное нулю, для этой операции, так как выходные данные отсутствуют.</span><span class="sxs-lookup"><span data-stu-id="61364-127">This returned parameter points to a **DWORD** value of zero for this operation, since there is no output.</span></span>

### <a name="lpvoverlapped"></a><span data-ttu-id="61364-128">лпвоверлаппед</span><span class="sxs-lookup"><span data-stu-id="61364-128">lpvOverlapped</span></span>

<span data-ttu-id="61364-129">Указатель на структуру [**всаоверлаппед**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) .</span><span class="sxs-lookup"><span data-stu-id="61364-129">A pointer to a [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) structure.</span></span>

<span data-ttu-id="61364-130">Если *сокеты были созданы* без атрибута OVERLAPPED, параметр *лповерлаппед* игнорируется.</span><span class="sxs-lookup"><span data-stu-id="61364-130">If socket *s* was created without the overlapped attribute, the *lpOverlapped* parameter is ignored.</span></span>

<span data-ttu-id="61364-131">Если *конструктор* был открыт с атрибутом OVERLAPPED и параметр *Лповерлаппед* не равен **null**, операция выполняется как перекрытый (асинхронная) операция.</span><span class="sxs-lookup"><span data-stu-id="61364-131">If *s* was opened with the overlapped attribute and the *lpOverlapped* parameter is not **NULL**, the operation is performed as an overlapped (asynchronous) operation.</span></span>
<span data-ttu-id="61364-132">В этом случае параметр *лповерлаппед* должен указывать на допустимую структуру [**всаоверлаппед**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) .</span><span class="sxs-lookup"><span data-stu-id="61364-132">In this case, *lpOverlapped* parameter must point to a valid [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) structure.</span></span>

<span data-ttu-id="61364-133">Для операций с перекрытием функция [**всаиоктл**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) или **вспиоктл** возвращает значение немедленно, и соответствующий метод завершения получает сигнал о завершении операции.</span><span class="sxs-lookup"><span data-stu-id="61364-133">For overlapped operations, the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function returns immediately, and the appropriate completion method is signaled when the operation has been completed.</span></span>
<span data-ttu-id="61364-134">В противном случае функция не возвращает значение до тех пор, пока операция не будет завершена или произойдет ошибка.</span><span class="sxs-lookup"><span data-stu-id="61364-134">Otherwise, the function does not return until the operation has been completed or an error occurs.</span></span>

### <a name="lpcompletionroutine"></a><span data-ttu-id="61364-135">лпкомплетионраутине</span><span class="sxs-lookup"><span data-stu-id="61364-135">lpCompletionRoutine</span></span>

<span data-ttu-id="61364-136">Тип: \_ In_opt \_ [ **LPWSAOVERLAPPED_COMPLETION_ROUTINE**](/windows/win32/api/winsock2/nc-winsock2-lpwsaoverlapped_completion_routine)</span><span class="sxs-lookup"><span data-stu-id="61364-136">Type: \_In_opt\_ [**LPWSAOVERLAPPED_COMPLETION_ROUTINE**](/windows/win32/api/winsock2/nc-winsock2-lpwsaoverlapped_completion_routine)</span></span>

<span data-ttu-id="61364-137">Указатель на подпрограммы завершения, вызываемую при завершении операции (игнорируется для сокетов без перекрытия).</span><span class="sxs-lookup"><span data-stu-id="61364-137">A pointer to the completion routine called when the operation has been completed (ignored for non-overlapped sockets).</span></span>

### <a name="lpthreadid"></a><span data-ttu-id="61364-138">лпсреадид</span><span class="sxs-lookup"><span data-stu-id="61364-138">lpThreadId</span></span>

<span data-ttu-id="61364-139">Указатель на структуру [**всасреадид**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) , которая будет использоваться поставщиком при последующем вызове [**впукуеуеапк**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc).</span><span class="sxs-lookup"><span data-stu-id="61364-139">A pointer to a [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) structure to be used by the provider in a subsequent call to [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc).</span></span>
<span data-ttu-id="61364-140">Поставщик должен хранить указанную [**всасреадид**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) структуру (а не указатель на то же значение) до тех пор, пока функция [**впукуеуеапк**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc) не вернет значение.</span><span class="sxs-lookup"><span data-stu-id="61364-140">The provider should store the referenced [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) structure (not the pointer to same) until after the [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc) function returns.</span></span>

<span data-ttu-id="61364-141">**Примечание**  .  Этот параметр применяется только к функции **вспиоктл** .</span><span class="sxs-lookup"><span data-stu-id="61364-141">**Note**  This parameter applies only to the **WSPIoctl** function.</span></span>

### <a name="lperrno"></a><span data-ttu-id="61364-142">лперрно</span><span class="sxs-lookup"><span data-stu-id="61364-142">lpErrno</span></span>

<span data-ttu-id="61364-143">Указатель на код ошибки.</span><span class="sxs-lookup"><span data-stu-id="61364-143">A pointer to the error code.</span></span>

<span data-ttu-id="61364-144">**Примечание**  .  Этот параметр применяется только к функции **вспиоктл** .</span><span class="sxs-lookup"><span data-stu-id="61364-144">**Note**  This parameter applies only to the **WSPIoctl** function.</span></span>

## <a name="return-value"></a><span data-ttu-id="61364-145">Возвращаемое значение</span><span class="sxs-lookup"><span data-stu-id="61364-145">Return value</span></span>

<span data-ttu-id="61364-146">Если операция завершается успешно, функция [**всаиоктл**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) или **вспиоктл** возвращает ноль.</span><span class="sxs-lookup"><span data-stu-id="61364-146">If the operation completes successfully, the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function returns zero.</span></span>

<span data-ttu-id="61364-147">Если операция завершается ошибкой или находится в состоянии ожидания, функция [**всаиоктл**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) или **Вспиоктл** возвращает **\_ ошибку сокета**.</span><span class="sxs-lookup"><span data-stu-id="61364-147">If the operation fails or is pending, the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function returns **SOCKET\_ERROR**.</span></span>
<span data-ttu-id="61364-148">Чтобы получить расширенные сведения об ошибке, вызовите [**всажетластеррор**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror).</span><span class="sxs-lookup"><span data-stu-id="61364-148">To get extended error information, call [**WSAGetLastError**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror).</span></span>

| <span data-ttu-id="61364-149">Код ошибки</span><span class="sxs-lookup"><span data-stu-id="61364-149">Error code</span></span> | <span data-ttu-id="61364-150">Значение</span><span class="sxs-lookup"><span data-stu-id="61364-150">Meaning</span></span> |
|------------|---------|
| <span data-ttu-id="61364-151">**\_ожидается ввод-вывод WSA \_**</span><span class="sxs-lookup"><span data-stu-id="61364-151">**WSA\_IO\_PENDING**</span></span> | <span data-ttu-id="61364-152">Операция перекрытия успешно инициирована, и ее завершение будет указано позже.</span><span class="sxs-lookup"><span data-stu-id="61364-152">An overlapped operation was successfully initiated and completion will be indicated at a later time.</span></span> |
| <span data-ttu-id="61364-153">**\_Операция WSA \_ прервана**</span><span class="sxs-lookup"><span data-stu-id="61364-153">**WSA\_OPERATION\_ABORTED**</span></span> | <span data-ttu-id="61364-154">Перекрывающаяся операция была отменена из-за закрытия сокета или выполнения команды ioctl **\_ flush суперконтроллера** ввода/вывода.</span><span class="sxs-lookup"><span data-stu-id="61364-154">An overlapped operation was canceled due to the closure of the socket or the execution of the **SIO\_FLUSH** IOCTL command.</span></span> |
| <span data-ttu-id="61364-155">**WSAEFAULT**</span><span class="sxs-lookup"><span data-stu-id="61364-155">**WSAEFAULT**</span></span> | <span data-ttu-id="61364-156">Параметр *лповерлаппед* или *лпкомплетионраутине* не полностью содержится в допустимой части адресного пространства пользователя.</span><span class="sxs-lookup"><span data-stu-id="61364-156">The *lpOverlapped* or *lpCompletionRoutine* parameter is not totally contained in a valid part of the user address space.</span></span> |
| <span data-ttu-id="61364-157">**всаеинпрогресс**</span><span class="sxs-lookup"><span data-stu-id="61364-157">**WSAEINPROGRESS**</span></span> | <span data-ttu-id="61364-158">Функция вызывается при выполнении обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="61364-158">The function is invoked when a callback is in progress.</span></span> |
| <span data-ttu-id="61364-159">**всаеинтр**</span><span class="sxs-lookup"><span data-stu-id="61364-159">**WSAEINTR**</span></span> | <span data-ttu-id="61364-160">Операция блокирования была прервана.</span><span class="sxs-lookup"><span data-stu-id="61364-160">A blocking operation was interrupted.</span></span> |
| <span data-ttu-id="61364-161">**всаеинвал**</span><span class="sxs-lookup"><span data-stu-id="61364-161">**WSAEINVAL**</span></span> | <span data-ttu-id="61364-162">Параметр *двиоконтролкоде* не является допустимой командой, или указан недопустимый входной параметр, либо команда неприменима к указанному типу сокета.</span><span class="sxs-lookup"><span data-stu-id="61364-162">The *dwIoControlCode* parameter is not a valid command, or a specified input parameter is not acceptable, or the command is not applicable to the type of socket specified.</span></span> <span data-ttu-id="61364-163">Эта ошибка возвращается, если параметр *кбинбуффер* меньше структуры **\_ \_ режима совместимости WSA** .</span><span class="sxs-lookup"><span data-stu-id="61364-163">This error is returned if the *cbInBuffer* parameter is less than the sizeof the **WSA\_COMPATIBILITY\_MODE** structure.</span></span>
| <span data-ttu-id="61364-164">**WSAENETDOWN**</span><span class="sxs-lookup"><span data-stu-id="61364-164">**WSAENETDOWN**</span></span> | <span data-ttu-id="61364-165">Сбой сетевой подсистемы.</span><span class="sxs-lookup"><span data-stu-id="61364-165">The network subsystem has failed.</span></span> |
| <span data-ttu-id="61364-166">**всаенопротупт**</span><span class="sxs-lookup"><span data-stu-id="61364-166">**WSAENOPROTOOPT**</span></span> | <span data-ttu-id="61364-167">Параметр сокета не поддерживается для указанного протокола.</span><span class="sxs-lookup"><span data-stu-id="61364-167">The socket option is not supported on the specified protocol.</span></span> |
| <span data-ttu-id="61364-168">**WSAENOTCONN**</span><span class="sxs-lookup"><span data-stu-id="61364-168">**WSAENOTCONN**</span></span> | <span data-ttu-id="61364-169">Сокеты не подключены.</span><span class="sxs-lookup"><span data-stu-id="61364-169">The socket s is not connected.</span></span> |
| <span data-ttu-id="61364-170">**всаенотсокк**</span><span class="sxs-lookup"><span data-stu-id="61364-170">**WSAENOTSOCK**</span></span> | <span data-ttu-id="61364-171">Дескриптор *s* не является сокетом.</span><span class="sxs-lookup"><span data-stu-id="61364-171">The descriptor *s* is not a socket.</span></span> |
| <span data-ttu-id="61364-172">**всаеопнотсупп**</span><span class="sxs-lookup"><span data-stu-id="61364-172">**WSAEOPNOTSUPP**</span></span> | <span data-ttu-id="61364-173">Указанная команда IOCTL не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="61364-173">The specified IOCTL command is not supported.</span></span> <span data-ttu-id="61364-174">Эта ошибка возвращается, если для поставщика транспорта не поддерживается **\_ \_ \_ режим совместимости, установленный SIO** .</span><span class="sxs-lookup"><span data-stu-id="61364-174">This error is returned if the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL is not supported by the transport provider.</span></span> <span data-ttu-id="61364-175">Эта ошибка также возвращается при попытке использовать **\_ \_ \_ режим совместимости с набором SIO** на сокете датаграммы.</span><span class="sxs-lookup"><span data-stu-id="61364-175">This error is also returned when an attempt to use the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL is made on a datagram socket.</span></span> |

## <a name="remarks"></a><span data-ttu-id="61364-176">Комментарии</span><span class="sxs-lookup"><span data-stu-id="61364-176">Remarks</span></span>

<span data-ttu-id="61364-177">запрос **ioctl \_ Set \_ в \_ режиме совместимости** запрашивает, как сетевой стек должен обрабатывать определенные поведения, для которых поведение по умолчанию может различаться в разных версиях Windows.</span><span class="sxs-lookup"><span data-stu-id="61364-177">the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL requests how the networking stack should handle certain behaviors for which the default way of handling the behavior may differ across Windows versions.</span></span>
<span data-ttu-id="61364-178">Структура входных аргументов для **\_ \_ \_ режима совместимости с набором SIO** задается в структуре **\_ \_ режима совместимости WSA** , определенной в файле заголовка *мсвсоккдеф. h* .</span><span class="sxs-lookup"><span data-stu-id="61364-178">The input argument structure for **SIO\_SET\_COMPATIBILITY\_MODE** is specified in the **WSA\_COMPATIBILITY\_MODE** structure defined in the *Mswsockdef.h* header file.</span></span>
<span data-ttu-id="61364-179">Указатель на структуру **\_ \_ режима совместимости WSA** передается в параметр *кбинбуффер* .</span><span class="sxs-lookup"><span data-stu-id="61364-179">A pointer to the **WSA\_COMPATIBILITY\_MODE** structure is passed in the *cbInBuffer* parameter.</span></span>
<span data-ttu-id="61364-180">Эта структура определяется следующим образом:</span><span class="sxs-lookup"><span data-stu-id="61364-180">This structure is defined as follows:</span></span>

```cpp
// Need to #include <mswsock.h>

/* Argument structure for SIO_SET_COMPATIBILITY_MODE */
typedef struct _WSA_COMPATIBILITY_MODE {
    WSA_COMPATIBILITY_BEHAVIOR_ID BehaviorId;
    ULONG TargetOsVersion;
} WSA_COMPATIBILITY_MODE, *PWSA_COMPATIBILITY_MODE;
```

<span data-ttu-id="61364-181">Значение, указанное в элементе **бехавиорид** , указывает на запрошенное поведение.</span><span class="sxs-lookup"><span data-stu-id="61364-181">The value specified in the **BehaviorId** member indicates the behavior requested.</span></span>
<span data-ttu-id="61364-182">Значение, указанное в элементе **TargetOsVersion** , указывает версию Windows, запрашиваемую для поведения.</span><span class="sxs-lookup"><span data-stu-id="61364-182">The value specified in the **TargetOsVersion** member indicates the Windows version that is being requested for the behavior.</span></span>

<span data-ttu-id="61364-183">Элемент **бехавиорид** может быть одним из значений типа перечисления " **\_ \_ \_ идентификатор действия совместимости WSA** ", определенного в файле заголовка *мсвсоккдеф. h* .</span><span class="sxs-lookup"><span data-stu-id="61364-183">The **BehaviorId** member can be one of the values from the **WSA\_COMPATIBILITY\_BEHAVIOR\_ID** enumeration type defined in the *Mswsockdef.h* header file.</span></span>
<span data-ttu-id="61364-184">Ниже приведены возможные значения для элемента **бехавиорид** .</span><span class="sxs-lookup"><span data-stu-id="61364-184">The possible values for the **BehaviorId** member are as follows:</span></span>

| <span data-ttu-id="61364-185">Термин</span><span class="sxs-lookup"><span data-stu-id="61364-185">Term</span></span> | <span data-ttu-id="61364-186">Описание</span><span class="sxs-lookup"><span data-stu-id="61364-186">Description</span></span> |
|------|-------------|
| <span data-ttu-id="61364-187">всабехавиоралл</span><span class="sxs-lookup"><span data-stu-id="61364-187">WsaBehaviorAll</span></span> | <span data-ttu-id="61364-188">Это эквивалентно запросу всех возможных совместимых вариантов поведения, определенных для **\_ \_ \_ идентификатора режима совместимости WSA**.</span><span class="sxs-lookup"><span data-stu-id="61364-188">This is equivalent to requesting all of the possible compatible behaviors defined for **WSA\_COMPATIBILITY\_BEHAVIOR\_ID**.</span></span> |
| <span data-ttu-id="61364-189">всабехавиоррецеивебуфферинг</span><span class="sxs-lookup"><span data-stu-id="61364-189">WsaBehaviorReceiveBuffering</span></span> | <span data-ttu-id="61364-190">Если для элемента **TargetOsVersion** задано значение Windows Vista или более поздней версии, уменьшение размера буфера приема TCP на этом сокете с помощью параметра **so \_ рквбуф** может быть даже после установления TCP-подключения.</span><span class="sxs-lookup"><span data-stu-id="61364-190">When the **TargetOsVersion** member is set to a value for Windows Vista or later, reductions to the TCP receive buffer size on this socket using the **SO\_RCVBUF** socket option are allowed even after a TCP connection has been establishment.</span></span> <span data-ttu-id="61364-191">Если для элемента **TargetOsVersion** задано значение, предшествующее Windows Vista, уменьшение размера буфера приема TCP на этом сокете с помощью параметра **so \_ рквбуф** не допускается после установки соединения.</span><span class="sxs-lookup"><span data-stu-id="61364-191">When the **TargetOsVersion** member is set to a value earlier than Windows Vista, reductions to the TCP receive buffer size on this socket using the **SO\_RCVBUF** socket option are not allowed after connection establishment.</span></span> |
| <span data-ttu-id="61364-192">всабехавиораутотунинг</span><span class="sxs-lookup"><span data-stu-id="61364-192">WsaBehaviorAutoTuning</span></span> | <span data-ttu-id="61364-193">Если для элемента **TargetOsVersion** задано значение Windows Vista или более поздней версии, автоматическая настройка окна приема включена, а коэффициент МАСШТАБИРОВАНИЯ окна TCP уменьшается до 2 из значения по умолчанию 8.</span><span class="sxs-lookup"><span data-stu-id="61364-193">When the **TargetOsVersion** member is set to a value for Windows Vista or later, receive window auto-tuning is enabled and the TCP window scale factor is reduced to 2 from the default value of 8.</span></span> <span data-ttu-id="61364-194">Если для **TargetOsVersion** задано значение, предшествующее Windows Vista, автоматическая настройка окна приема отключена.</span><span class="sxs-lookup"><span data-stu-id="61364-194">When the **TargetOsVersion** is set to a value earlier than Windows Vista, receive window auto-tuning is disabled.</span></span> <span data-ttu-id="61364-195">Параметр масштабирования окна TCP также отключается, и максимальный размер окна приема ограничен 65 535 байт.</span><span class="sxs-lookup"><span data-stu-id="61364-195">The TCP window scaling option is also disabled and the maximum true receive window size is limited to 65,535 bytes.</span></span> <span data-ttu-id="61364-196">Параметр масштабирования окна TCP не может быть согласован в соединении, даже если для этого сокета был вызван параметр **so \_ рквбуф** , указывающий значение более 65 535 байт до установки соединения.</span><span class="sxs-lookup"><span data-stu-id="61364-196">The TCP window scaling option can't be negotiated on the connection even if the **SO\_RCVBUF** socket option was called on this socket specifying a value greater than 65,535 bytes before the connection was established.</span></span> |

<span data-ttu-id="61364-197">Элемент **TargetOsVersion** может быть одной из КОНСТАНТ версии нтдди, определенных в файле заголовка *Sdkddkver. h* .</span><span class="sxs-lookup"><span data-stu-id="61364-197">The **TargetOsVersion** member can be one of the NTDDI version constants defined in the *Sdkddkver.h* header file.</span></span>
<span data-ttu-id="61364-198">Ниже приведены некоторые возможные значения для элемента **TargetOsVersion** .</span><span class="sxs-lookup"><span data-stu-id="61364-198">Some of the possible values for the **TargetOsVersion** member are as follows:</span></span>

| <span data-ttu-id="61364-199">Термин</span><span class="sxs-lookup"><span data-stu-id="61364-199">Term</span></span> | <span data-ttu-id="61364-200">Описание</span><span class="sxs-lookup"><span data-stu-id="61364-200">Description</span></span> |
|------|-------------|
| <span data-ttu-id="61364-201">НТДДИ \_ LONGHORN</span><span class="sxs-lookup"><span data-stu-id="61364-201">NTDDI\_LONGHORN</span></span> | <span data-ttu-id="61364-202">По умолчанию для Windows Vista используется целевое поведение.</span><span class="sxs-lookup"><span data-stu-id="61364-202">The target behavior is the default for Windows Vista.</span></span> |
| <span data-ttu-id="61364-203">НТДДИ \_ WS03</span><span class="sxs-lookup"><span data-stu-id="61364-203">NTDDI\_WS03</span></span> | <span data-ttu-id="61364-204">По умолчанию для Windows Server 2003 используется целевое поведение.</span><span class="sxs-lookup"><span data-stu-id="61364-204">The target behavior is the default for Windows Server 2003.</span></span> |
| <span data-ttu-id="61364-205">НТДДИ \_ WinXP</span><span class="sxs-lookup"><span data-stu-id="61364-205">NTDDI\_WINXP</span></span> | <span data-ttu-id="61364-206">По умолчанию для Windows XP используется целевое поведение.</span><span class="sxs-lookup"><span data-stu-id="61364-206">The target behavior is the default for Windows XP.</span></span> |
| <span data-ttu-id="61364-207">НТДДИ \_ Win2k</span><span class="sxs-lookup"><span data-stu-id="61364-207">NTDDI\_WIN2K</span></span> | <span data-ttu-id="61364-208">Целевое поведение является значением по умолчанию для Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="61364-208">The target behavior is the default for Windows 2000.</span></span> |

<span data-ttu-id="61364-209">Основным влиянием элемента **TargetOsVersion** является то, что для этого элемента задано значение, равное или больше **нтдди \_ LONGHORN**.</span><span class="sxs-lookup"><span data-stu-id="61364-209">The primary impact of the **TargetOsVersion** member is whether this member is set to a value equal or greater than **NTDDI\_LONGHORN**.</span></span>

<span data-ttu-id="61364-210">Производительность TCP зависит не только от скорости передачи данных, но и от произведения скорости передачи и времени задержки приема.</span><span class="sxs-lookup"><span data-stu-id="61364-210">TCP performance depends not only on the transfer rate itself, but rather on the product of the transfer rate and the round-trip delay time.</span></span>
<span data-ttu-id="61364-211">Этот продукт задержки пропускной способности измеряет объем данных, заполняющий канал.</span><span class="sxs-lookup"><span data-stu-id="61364-211">This bandwidth-delay product measures the amount of data that would "fill the pipe".</span></span>
<span data-ttu-id="61364-212">Этот продукт задержки пропускной способности — это место в буфере, необходимое для отправителя и получателя, чтобы получить максимальную пропускную способность подключения по протоколу TCP по пути.</span><span class="sxs-lookup"><span data-stu-id="61364-212">This bandwidth-delay product is the buffer space required at sender and receiver to obtain maximum throughput on the TCP connection over the path.</span></span>
<span data-ttu-id="61364-213">Это место в буфере представляет объем неподтвержденных данных, которые должны быть обработаны TCP, чтобы обеспечить заполнение конвейера.</span><span class="sxs-lookup"><span data-stu-id="61364-213">This buffer space represents the amount of unacknowledged data that TCP must handle in order to keep the pipeline full.</span></span>
<span data-ttu-id="61364-214">Проблемы с производительностью TCP возникают, если размер продукта задержки пропускной способности велик.</span><span class="sxs-lookup"><span data-stu-id="61364-214">TCP performance problems arise when the bandwidth-delay product is large.</span></span>
<span data-ttu-id="61364-215">Сетевой путь, работающий в этих условиях, часто называется "длинным каналом FAT".</span><span class="sxs-lookup"><span data-stu-id="61364-215">A network path operating under these conditions is often called a "long, fat pipe".</span></span>
<span data-ttu-id="61364-216">К примерам относятся ссылки на высокопроизводительные пакеты с высокой емкостью, высокоскоростные беспроводные каналы и наземноголись оптические каналы на больших расстояниях.</span><span class="sxs-lookup"><span data-stu-id="61364-216">Examples include high-capacity packet satellite links, high-speed wireless links, and terrestrial fiber-optical links over long distances.</span></span>

<span data-ttu-id="61364-217">Заголовок TCP использует 16-битное поле данных (поле окна в заголовке пакета TCP) для сообщения о размере окна приема отправителю.</span><span class="sxs-lookup"><span data-stu-id="61364-217">The TCP header uses a 16-bit data field (the Window field in the TCP packet header) to report the receive window size to the sender.</span></span>
<span data-ttu-id="61364-218">Таким образом, самым большим окном, которое можно использовать, является 65 535 байт.</span><span class="sxs-lookup"><span data-stu-id="61364-218">Therefore, the largest window that can be used is 65,535 bytes.</span></span>
<span data-ttu-id="61364-219">Чтобы обойти это ограничение, для высокопроизводительных протоколов TCP был добавлен параметр расширения TCP, который позволяет увеличить размер Windows, превышающий 65 535 байт.</span><span class="sxs-lookup"><span data-stu-id="61364-219">To circumvent this limitation a TCP extension option, TCP Window Scale, was added for high-performance TCP to allow windows larger than 65,535 bytes.</span></span>
<span data-ttu-id="61364-220">Параметр масштабирования окна TCP (Всопт) определен в документе RFC 1323, который доступен на [веб-сайте IETF](https://www.ietf.org/rfc/rfc1122.txt).</span><span class="sxs-lookup"><span data-stu-id="61364-220">The TCP Window Scale option (WSopt) is defined in RFC 1323 available at the [IETF website](https://www.ietf.org/rfc/rfc1122.txt).</span></span>
<span data-ttu-id="61364-221">Расширение Всопт расширяет определение окна TCP до 32 бит с помощью коэффициента однобайтовой логарифмической шкалы для расширения 16-разрядного поля окна в заголовке TCP.</span><span class="sxs-lookup"><span data-stu-id="61364-221">The WSopt extension expands the definition of the TCP window to 32 bits using a one-byte logarithmic scale factor to extend the 16-bit Window field in the TCP header.</span></span>
<span data-ttu-id="61364-222">Расширение Всопт определяет неявный коэффициент масштабирования (от 2 до некоторой степени), который используется для умножения значения размера окна, найденного в заголовке TCP, для получения истинного размера окна.</span><span class="sxs-lookup"><span data-stu-id="61364-222">The WSopt extension defines an implicit scale factor (2 to some power), which is used to multiply the window size value found in a TCP header to obtain the true window size.</span></span>
<span data-ttu-id="61364-223">Поэтому масштаб окна, равный 8, приведет к тому, что размер окна будет равным значению поля Window в заголовке TCP, умноженному на 2 ^ 8 или 256.</span><span class="sxs-lookup"><span data-stu-id="61364-223">So a window scale factor of 8 would result in a true window size equal to the value in the Window field in the TCP header multiplied by 2^8 or 256.</span></span>
<span data-ttu-id="61364-224">Таким образом, если в поле окна в заголовке TCP было установлено максимальное значение 65 535 байта, а коэффициент масштабирования Всопт был согласован со значением 8, то истинный размер окна будет равен 16 776 960 байт.</span><span class="sxs-lookup"><span data-stu-id="61364-224">So if the Window field in the TCP header was set to the maximum value of 65,535 bytes and the WSopt scale factor was negotiated to a value of 8, the true window size would be 16,776,960 bytes.</span></span>

<span data-ttu-id="61364-225">Истинный размер окна приема, и, следовательно, коэффициент масштабирования определяется максимальным размером буферного пространства приема.</span><span class="sxs-lookup"><span data-stu-id="61364-225">The true receive window size and therefore the scale factor is determined by the maximum receive buffer space.</span></span>
<span data-ttu-id="61364-226">Это максимальное место в буфере — это объем данных, который TCP-получатель разрешает отправить отправителю, прежде чем ждать подтверждения.</span><span class="sxs-lookup"><span data-stu-id="61364-226">This maximum buffer space is the amount of data that a TCP receiver allows a TCP sender to send before having to wait for an acknowledgement.</span></span>
<span data-ttu-id="61364-227">После установления соединения размер окна приема объявляется в каждом сегменте TCP (поле окна в заголовке TCP).</span><span class="sxs-lookup"><span data-stu-id="61364-227">After the connection is established, the receive window size is advertised in each TCP segment (the Window field in the TCP header).</span></span>
<span data-ttu-id="61364-228">Объявление максимального объема данных, отправляемых отправителем, — это механизм управления потоком на стороне получателя, который не позволяет отправителю отправлять данные, которые получатель не может сохранить.</span><span class="sxs-lookup"><span data-stu-id="61364-228">Advertising the maximum amount of data that the sender can send is a receiver-side flow control mechanism that prevents the sender from sending data that the receiver cannot store.</span></span>
<span data-ttu-id="61364-229">Отправляющий узел может отправлять только максимальный объем данных, объявленных получателем до ожидания подтверждения и обновления размера окна приема.</span><span class="sxs-lookup"><span data-stu-id="61364-229">A sending host can only send the maximum amount of data advertised by the receiver before waiting for an acknowledgment and a receive window size update.</span></span>

<span data-ttu-id="61364-230">В Windows Server 2003 и Windows XP максимальное место в буфере приема, которое представляет размер окна приема для стека TCP/IP, имеет значение по умолчанию, основанное на скорости связи отправляющего интерфейса.</span><span class="sxs-lookup"><span data-stu-id="61364-230">On Windows Server 2003 and Windows XP, the maximum receive buffer space which represents the receive window size for the TCP/IP stack has a default value based on the link speed of the sending interface.</span></span>
<span data-ttu-id="61364-231">Фактическое значение автоматически изменяется на даже приращение максимального размера сегмента (MSS), согласованного во время установки подключения TCP.</span><span class="sxs-lookup"><span data-stu-id="61364-231">The actual value automatically adjusts to even increments of the maximum segment size (MSS) negotiated during TCP connection establishment.</span></span>
<span data-ttu-id="61364-232">Таким образом, для ссылки 10 Мбит/с размер окна приема по умолчанию обычно задается 16 КБ байт, а в связи 100 Мбит/с размер окна приема по умолчанию будет равен 65 535 байт.</span><span class="sxs-lookup"><span data-stu-id="61364-232">So for a 10 Mbit/sec link, the default receive window size would normally be set to 16K bytes, while on a 100 MBit/sec link the default receive window size would be set to 65,535 bytes.</span></span>

<span data-ttu-id="61364-233">В Windows Server 2003 и Windows XP истинный максимальный размер окна приема для стека TCP/IP можно настроить вручную, используя следующие значения реестра для определенного интерфейса или для всей системы:</span><span class="sxs-lookup"><span data-stu-id="61364-233">On Windows Server 2003 and Windows XP, the true maximum receive window size for the TCP/IP stack can be manually configured using the following registry values on a specific interface or for the entire system:</span></span>

`HKEY_LOCAL_MACHINE\SYSTEM\Current Control Set\Services\Tcpip\Parameters\TCPWindowSize`

`HKEY_LOCAL_MACHINE\SYSTEM\Current Control Set\Services\Tcpip\Parameters\Interface\TCPWindowSize`

<span data-ttu-id="61364-234">Значение реестра для **TcpWindowSize** можно задать не более 65 535 байт, если не используется расширение всопт или не более 1 073 741 823 байт при использовании расширения всопт (поддерживается максимальный масштаб 4).</span><span class="sxs-lookup"><span data-stu-id="61364-234">The registry value for **TCPWindowSize** can be set to a maximum of 65,535 bytes when not using the WSopt extension or a maximum of 1,073,741,823 bytes when the WSopt extension is used (a maximum scale factor of 4 is supported).</span></span>
<span data-ttu-id="61364-235">Без масштабирования окна приложение может достичь пропускной способности примерно 5 мегабит в секунду (Мбит/с) в пути с циклическим временем в 100 миллисекунд, независимо от пропускной способности пути.</span><span class="sxs-lookup"><span data-stu-id="61364-235">Without window scaling, an application can only achieve a throughput of approximately 5 megabits per second (Mbps) on a path with a 100 millisecond round-trip time (RTT), regardless of the path bandwidth.</span></span>
<span data-ttu-id="61364-236">Эту пропускную способность можно масштабировать до гигабита в секунду (Гбит/с) с масштабированием окна, что позволяет протоколу TCP согласовать коэффициент масштабирования для размера окна во время установки соединения.</span><span class="sxs-lookup"><span data-stu-id="61364-236">This throughput can be scaled to over a gigabit per second (Gbps) with window scaling, which allows TCP to negotiate the scaling factor for the window size during connection establishment.</span></span>

<span data-ttu-id="61364-237">В Windows Server 2003 и Windows XP расширение Всопт можно включить, задав следующее значение реестра.</span><span class="sxs-lookup"><span data-stu-id="61364-237">On Windows Server 2003 and Windows XP, the WSopt extension can be enabled by setting the following registry value.</span></span>

`HKEY_LOCAL_MACHINE\SYSTEM\Current Control Set\Services\Tcpip\Parameters\Tcp1323Opts`

<span data-ttu-id="61364-238">Параметр реестра **Tcp1323Opts** имеет кодировку **DWORD** , так что если задан бит 0, расширение TCP всопт включено.</span><span class="sxs-lookup"><span data-stu-id="61364-238">The **Tcp1323Opts** registry value is a **DWORD** encoded such that when bit 0 is set, TCP WSopt extension is enabled.</span></span>
<span data-ttu-id="61364-239">Если задан бит 1, то параметр TCP timestamp (Тсопт), определенный в RFC 1323, включен.</span><span class="sxs-lookup"><span data-stu-id="61364-239">When bit 1 is set, the TCP Timestamp option (TSopt) defined in RFC 1323 is enabled.</span></span>
<span data-ttu-id="61364-240">Таким образом, значение 1 или 3 включит расширение Всопт.</span><span class="sxs-lookup"><span data-stu-id="61364-240">So a value of either 1 or 3 will enable the WSopt extension.</span></span>

<span data-ttu-id="61364-241">В Windows Server 2003 и Windows XP по умолчанию значения реестра TCPWindowSize и Tcp1323Opts не создаются.</span><span class="sxs-lookup"><span data-stu-id="61364-241">On Windows Server 2003 and Windows XP, the default is that the TCPWindowSize and the Tcp1323Opts registry values are not created.</span></span>
<span data-ttu-id="61364-242">Поэтому по умолчанию расширение Всопт отключено, а размер окна приема TCP задается системой для максимального значения до 65 535 байт в зависимости от скорости связи.</span><span class="sxs-lookup"><span data-stu-id="61364-242">So the default is that the WSopt extension is disabled and the TCP receive window size is set by the system to maximum value of up to 65,535 bytes based on the link speed.</span></span>
<span data-ttu-id="61364-243">Если масштабирование окна включено в Windows Server 2003 и Windows XP путем установки значения реестра Tcp1323Opts, масштабирование окна по TCP-соединению все равно используется, только если отправитель и получатель включают параметр масштабирования окна TCP в сегмент Synchronize (SYN), отправляемого друг другу для согласования коэффициента масштабирования окна.</span><span class="sxs-lookup"><span data-stu-id="61364-243">When window scaling is enabled on Windows Server 2003 and Windows XP by setting the Tcp1323Opts registry value, window scaling on a TCP connection is still only used when both the sender and receiver include a TCP window scale option in the synchronize (SYN) segment sent to each other to negotiate a window scale factor.</span></span>
<span data-ttu-id="61364-244">Когда для соединения используется масштабирование окна, поле Window в заголовке TCP устанавливается в 65 535 байт, а коэффициент масштабирования окна используется для корректировки истинного размера окна приема, которое согласовывается коэффициентом масштабирования окна, согласованным при установке соединения.</span><span class="sxs-lookup"><span data-stu-id="61364-244">When window scaling is used on a connection, the Window field in the TCP header is set to 65,535 bytes and the window scale factor is used to adjust the true receive window size upward by the window scale factor negotiated when the connection is established.</span></span>

<span data-ttu-id="61364-245">Приложение может указать размер окна приема TCP для подключения с помощью параметра **\_ рквбуф** Socket.</span><span class="sxs-lookup"><span data-stu-id="61364-245">An application can specify the TCP receive window size for a connection by using the **SO\_RCVBUF** socket option.</span></span>
<span data-ttu-id="61364-246">Размер окна приема TCP для сокета можно увеличить в любое время с помощью **\_ рквбуф**, но его можно только уменьшить до установления соединения.</span><span class="sxs-lookup"><span data-stu-id="61364-246">The TCP receive window size for a socket can be increased at any time using **SO\_RCVBUF**, but it can only be decreased prior to establishing a connection.</span></span>
<span data-ttu-id="61364-247">Чтобы использовать масштабирование окна, приложение должно указать размер окна больше 65 535 байт при использовании параметра **so \_ рквбуф** , прежде чем устанавливать соединение.</span><span class="sxs-lookup"><span data-stu-id="61364-247">In order to use window scaling, an application must specify a window size larger than 65,535 bytes when using the **SO\_RCVBUF** socket option before the connection is established.</span></span>

<span data-ttu-id="61364-248">Оптимальное значение размера окна приема TCP часто сложно определить.</span><span class="sxs-lookup"><span data-stu-id="61364-248">The ideal value for the TCP receive window size is often difficult to determine.</span></span>
<span data-ttu-id="61364-249">Для заполнения емкости сети между отправителем и получателем размер окна приема должен быть установлен в значение «задержка пропускной способности» для подключения, что является пропускной способностью, умноженной на время приема-передачи.</span><span class="sxs-lookup"><span data-stu-id="61364-249">In order to fill the capacity of the network between the sender and receiver, the receive window size should be set to the bandwidth-delay product for the connection, which is the bandwidth multiplied by the round-trip time.</span></span>
<span data-ttu-id="61364-250">Даже если приложение может правильно определить задержку пропускной способности, оно по-прежнему неизвестно, как быстро получающее приложение будет получать данные из входящего буфера данных (скорость извлечения приложения).</span><span class="sxs-lookup"><span data-stu-id="61364-250">Even if an application can correctly determine the bandwidth-delay product, it is still not known how quickly the receiving application will retrieve data from the incoming data buffer (the application retrieve rate).</span></span>
<span data-ttu-id="61364-251">Несмотря на поддержку масштабирования окна TCP, максимальный размер окна приема в Windows Server 2003 и Windows XP по-прежнему может ограничить пропускную способность, так как это фиксированный максимальный размер для всех подключений TCP (если не указано в приложении с помощью **\_ рквбуф**), что может повысить пропускную способность для некоторых подключений и снизить пропускную способность для других.</span><span class="sxs-lookup"><span data-stu-id="61364-251">Despite the support for TCP window scaling, the maximum receive window size in Windows Server 2003 and Windows XP can still limit throughput because it is a fixed maximum size for all TCP connections (unless specified per application using **SO\_RCVBUF**), which can enhance throughput for some connections and decrease throughput for others.</span></span>
<span data-ttu-id="61364-252">Кроме того, фиксированный максимальный размер окна приема для TCP-соединения не зависит от изменения условий сети.</span><span class="sxs-lookup"><span data-stu-id="61364-252">Additionally, the fixed maximum receive window size for a TCP connection does not vary with changing network conditions.</span></span>

<span data-ttu-id="61364-253">Чтобы решить проблему правильного определения значения максимального размера окна приема для TCP-подключения на основе текущих условий сети, стек TCP/IP в Windows Vista поддерживает функцию автоматической настройки окна приема.</span><span class="sxs-lookup"><span data-stu-id="61364-253">To solve the problem of correctly determining the value of the maximum receive window size for a TCP connection based on the current conditions of the network, the TCP/IP stack in Windows Vista supports a receive window auto-tuning feature.</span></span>
<span data-ttu-id="61364-254">Если эта функция включена, автоматическая настройка окна приема непрерывно определяет оптимальный размер окна приема, измеряя продукт задержки при пропускной способности и частоту извлечения приложений, и корректирует истинный максимальный размер окна приема на основе измененных условий сети.</span><span class="sxs-lookup"><span data-stu-id="61364-254">When this feature is enabled, receive window auto-tuning continually determines the optimal true receive window size by measuring the bandwidth-delay product and the application retrieve rate, and adjusts the true maximum receive window size based on changing network conditions.</span></span>
<span data-ttu-id="61364-255">Автоматическая настройка окна приема включает расширение TCP Всопт по умолчанию, позволяя до 16 776 960 байт для истинного размера окна.</span><span class="sxs-lookup"><span data-stu-id="61364-255">Receive window auto-tuning enables the TCP WSopt extension by default, allowing up to 16,776,960 bytes for the true window size.</span></span>
<span data-ttu-id="61364-256">Когда данные проходят через соединение, стек TCP/IP наблюдает за подключением, измеряет текущий продукт задержки пропускной способности для подключения и скорость получения приложения и корректирует фактический размер окна приема для оптимизации пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="61364-256">As the data flows over the connection, the TCP/IP stack monitors the connection, measures the current bandwidth-delay product for the connection and the application receive rate, and adjusts the actual receive window size to optimize throughput.</span></span>
<span data-ttu-id="61364-257">Стек TCP/IP изменяет значение поля окна в заголовке TCP на основе условий сети, так как коэффициент масштабирования Всопт фиксирован при первом установлении соединения.</span><span class="sxs-lookup"><span data-stu-id="61364-257">The TCP/IP stack changes the value of the Window field in the TCP header based on network conditions, since the WSopt scale factor is fixed when the connection is first established.</span></span>

<span data-ttu-id="61364-258">Стек TCP/IP в Windows Vista больше не использует значения реестра **TcpWindowSize** .</span><span class="sxs-lookup"><span data-stu-id="61364-258">The TCP/IP stack in Windows Vista no longer uses the **TCPWindowSize** registry values.</span></span>
<span data-ttu-id="61364-259">При повышении пропускной способности между узлами TCP использование пропускной способности сети увеличивается во время передачи данных.</span><span class="sxs-lookup"><span data-stu-id="61364-259">With better throughput between TCP peers, the utilization of network bandwidth increases during data transfer.</span></span>
<span data-ttu-id="61364-260">Если все приложения оптимизированы для приема данных по протоколу TCP, общее использование сети может значительно увеличиться, так как использование качества обслуживания (QoS) важнее в сетях, которые работают в рамках емкости.</span><span class="sxs-lookup"><span data-stu-id="61364-260">If all the applications are optimized to receive TCP data, then the overall utilization of the network can increase substantially, making the use of Quality of Service (QoS) more important on networks that are operating at or near capacity.</span></span>

<span data-ttu-id="61364-261">Поведение по умолчанию в Windows Vista для получения буферизации в том случае, если не задан **\_ \_ \_ режим совместимости суперконтроллера** ввода/с параметром **всабехавиоррецеивебуфферинг** , то после установления соединения не будет разрешено уменьшить размер окна приема с помощью **этого параметра \_ рквбуф** Socket.</span><span class="sxs-lookup"><span data-stu-id="61364-261">The default behavior on Windows Vista for receive buffering when **SIO\_SET\_COMPATIBILITY\_MODE** is not specified using **WsaBehaviorReceiveBuffering** is that no receive window size reductions using **SO\_RCVBUF** socket option are allowed after a connection is established.</span></span>

<span data-ttu-id="61364-262">Поведение по умолчанию в Windows Vista для автоматической настройки в том случае, если **\_ \_ \_ режим совместимости набора SIO** не указан с помощью **всабехавиораутотунинг** , то стек будет выполнять автоматическую настройку окна приема с использованием коэффициента масштабирования окна 8.</span><span class="sxs-lookup"><span data-stu-id="61364-262">The default behavior on Windows Vista for auto-tuning when **SIO\_SET\_COMPATIBILITY\_MODE** is not specified using **WsaBehaviorAutoTuning** is that the stack will do receive window auto-tuning using a window scale factor of 8.</span></span>
<span data-ttu-id="61364-263">Обратите внимание, что если приложение устанавливает допустимый размер окна приема с параметром **\_ рквбуф** Socket, стек будет использовать указанный размер, а функция автонастройки получения окон будет отключена.</span><span class="sxs-lookup"><span data-stu-id="61364-263">Note that if an application sets a valid receive window size with the **SO\_RCVBUF** socket option, the stack will use the size specified and window receive auto-tuning will disabled.</span></span>
<span data-ttu-id="61364-264">Автоматическая настройка Windows может также быть полностью отключена с помощью следующей команды, `netsh interface tcp set global autotuninglevel=disabled` в этом случае указание **всабехавиораутотунинг** не повлияет на.</span><span class="sxs-lookup"><span data-stu-id="61364-264">Windows autotuning may also be disabled completely using the following command, `netsh interface tcp set global autotuninglevel=disabled`, in which case specifying **WsaBehaviorAutoTuning** will have no affect.</span></span>
<span data-ttu-id="61364-265">Автоматическая настройка приема окна также может быть отключена на основе групповой политики, установленной в Windows Server 2008.</span><span class="sxs-lookup"><span data-stu-id="61364-265">Window receive autotuning can also be disabled based on group policy set on Windows Server 2008.</span></span>

<span data-ttu-id="61364-266">Параметр **всабехавиораутотунинг** необходим в Windows Vista для некоторых устройств шлюза Интернета и брандмауэров, которые неправильно поддерживают потоки данных для TCP-подключений, использующих расширение всопт и коэффициент масштабирования Windows.</span><span class="sxs-lookup"><span data-stu-id="61364-266">The **WsaBehaviorAutoTuning** option is needed on Windows Vista for some Internet gateway devices and firewalls that do not correctly support data flows for TCP connections that use the WSopt extension and a windows scale factor.</span></span>
<span data-ttu-id="61364-267">В Windows Vista получатель по умолчанию согласовывает коэффициент масштабирования окна, равный 8, для максимального истинного размера окна (16 776 960 байт).</span><span class="sxs-lookup"><span data-stu-id="61364-267">On Windows Vista, a receiver by default negotiates a window scale factor of 8 for a maximum true window size of 16,776,960 bytes.</span></span>
<span data-ttu-id="61364-268">Когда данные начинают передаваться по быстрой ссылке, Windows изначально начинает с 64 кбит/с истинным размером окна, устанавливая для поля Window заголовка TCP значение 256 и установив для коэффициента масштабирования окна значение 8 в параметрах TCP (256 \* 2 ^ 8 = 64 КБ).</span><span class="sxs-lookup"><span data-stu-id="61364-268">When data begins to flow on a fast link, Windows initially starts with a 64 Kilobyte true window size by setting the Window field of the TCP header to 256 and setting the window scale factor to 8 in the TCP options (256\*2^8=64KB).</span></span>
<span data-ttu-id="61364-269">Некоторые устройства и брандмауэры шлюза Интернета игнорируют коэффициент масштабирования окна и изменяют поле объявленного окна в заголовке TCP, заданном как 256, и удаляют входящие пакеты для подключения, которые содержат более 256 байт данных TCP.</span><span class="sxs-lookup"><span data-stu-id="61364-269">Some Internet gateway devices and firewalls ignore the window scale factor and only look at the advertised Window field in the TCP header specified as 256, and drop incoming packets for the connection that contain more than 256 bytes of TCP data.</span></span>
<span data-ttu-id="61364-270">Для поддержки масштабирования окна приема TCP устройство шлюза или брандмауэр должны отслеживать подтверждение TCP и отслеживать согласованный коэффициент масштабирования окна как часть данных подключения TCP.</span><span class="sxs-lookup"><span data-stu-id="61364-270">To support TCP receive window scaling, a gateway device or firewall must monitor the TCP handshake and track the negotiated window scale factor as part of the TCP connection data.</span></span>
<span data-ttu-id="61364-271">Кроме того, некоторые приложения и реализации стека TCP на других платформах игнорируют расширение TCP Всопт и коэффициент масштабирования окна.</span><span class="sxs-lookup"><span data-stu-id="61364-271">Also some applications and TCP stack implementations on other platforms ignore the TCP WSopt extension and the window scaling factor.</span></span>
<span data-ttu-id="61364-272">Поэтому удаленный узел, отправляющий данные, может отправлять данные с частотой, объявленной в поле Window заголовка TCP (256 байт).</span><span class="sxs-lookup"><span data-stu-id="61364-272">So the remote host sending the data may send data at the rate advertised in the Window field of the TCP header (256 bytes).</span></span>
<span data-ttu-id="61364-273">Это может привести к слишком медленному получению данных получателем.</span><span class="sxs-lookup"><span data-stu-id="61364-273">This can result in data being received very slowly by the receiver.</span></span>

<span data-ttu-id="61364-274">Установка для элемента **бехавиорид** значения **Всабехавиораутотунинг** , а **TargetOsVersion** в Windows Vista сокращает коэффициент масштабирования окна до 2, поэтому поле Window в заголовке TCP изначально устанавливается в 16 384 байт, а коэффициент масштабирования окна устанавливается равным 2 для начального размера получаемого окна (64 байта).</span><span class="sxs-lookup"><span data-stu-id="61364-274">Setting the **BehaviorId** member to **WsaBehaviorAutoTuning** and the **TargetOsVersion** to Windows Vista reduces the window scale factor to 2, so the Window field in the TCP header is initially set to 16,384 bytes and the window scale factor is set to 2 for an initial true window receive size of 64K bytes.</span></span>
<span data-ttu-id="61364-275">Функция автоматической настройки окна может затем увеличить истинный размер получаемого окна до 262 140 байт, установив для поля Window в заголовке TCP значение 65 535 байт.</span><span class="sxs-lookup"><span data-stu-id="61364-275">The window auto-tuning feature can then increase the true window receive size up to 262,140 bytes by setting the Window field in the TCP header to 65,535 bytes.</span></span>
<span data-ttu-id="61364-276">Приложение должно установить **\_ \_ \_ режим совместимости** с параметром SIO, как только будет создан сокет, поскольку этот вариант не имеет смысла или не применяется после отправки SYN.</span><span class="sxs-lookup"><span data-stu-id="61364-276">An application should set the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL as soon as a socket is created, since this option doesn't make sense or apply after a SYN is sent.</span></span>
<span data-ttu-id="61364-277">Установка этого параметра оказывает то же воздействие, что и Следующая команда: `netsh interface tcp set global autotuninglevel=highlyrestricted`</span><span class="sxs-lookup"><span data-stu-id="61364-277">Setting this option has the same impact as the following command: `netsh interface tcp set global autotuninglevel=highlyrestricted`</span></span>

<span data-ttu-id="61364-278">Обратите внимание, что заголовочный файл *мсвсоккдеф. h* автоматически включается в *мсвсокк. h* или *нетиодеф. h* и не должен использоваться напрямую.</span><span class="sxs-lookup"><span data-stu-id="61364-278">Note that the *Mswsockdef.h* header file is automatically included in *Mswsock.h* or *Netiodef.h*, and should not be used directly.</span></span>

## <a name="see-also"></a><span data-ttu-id="61364-279">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="61364-279">See also</span></span>

[<span data-ttu-id="61364-280">**фиксатор**</span><span class="sxs-lookup"><span data-stu-id="61364-280">**socket**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-socket)

[<span data-ttu-id="61364-281">**всажетластеррор**</span><span class="sxs-lookup"><span data-stu-id="61364-281">**WSAGetLastError**</span></span>](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror)

[<span data-ttu-id="61364-282">**всажетоверлаппедресулт**</span><span class="sxs-lookup"><span data-stu-id="61364-282">**WSAGetOverlappedResult**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsagetoverlappedresult)

[<span data-ttu-id="61364-283">**всаиоктл**</span><span class="sxs-lookup"><span data-stu-id="61364-283">**WSAIoctl**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl)

[<span data-ttu-id="61364-284">**всаоверлаппед**</span><span class="sxs-lookup"><span data-stu-id="61364-284">**WSAOVERLAPPED**</span></span>](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped)

[<span data-ttu-id="61364-285">**всасоккета**</span><span class="sxs-lookup"><span data-stu-id="61364-285">**WSASocketA**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsasocketa)

[<span data-ttu-id="61364-286">**всасоккетв**</span><span class="sxs-lookup"><span data-stu-id="61364-286">**WSASocketW**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsasocketw)
