---
description: Структура ВСАКУЕРИСЕТ используется для формирования запросов функции Нсплукупсервицебегин и используется для доставки результатов запроса функции Нсплукупсервиценекст.
ms.assetid: 017b5828-bc6e-42b7-aba7-21648b2dd707
title: Query-Related структур данных в SPI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 57ce5a7016bd2ad96f464137177036b470c64a95
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104562468"
---
# <a name="query-related-data-structures-in-the-spi"></a><span data-ttu-id="bc3f7-103">Query-Related структур данных в SPI</span><span class="sxs-lookup"><span data-stu-id="bc3f7-103">Query-Related Data Structures in the SPI</span></span>

<span data-ttu-id="bc3f7-104">Структура [**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) используется для формирования запросов к [**нсплукупсервицебегин**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicebegin)и используется для доставки результатов запроса [**нсплукупсервиценекст**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext).</span><span class="sxs-lookup"><span data-stu-id="bc3f7-104">The [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) structure is used to form queries for [**NSPLookupServiceBegin**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicebegin), and used to deliver query results for [**NSPLookupServiceNext**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext).</span></span> <span data-ttu-id="bc3f7-105">Это сложная структура, так как она содержит указатели на несколько других структур, некоторые из которых ссылаются еще на другие структуры.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-105">It is a complex structure because it contains pointers to several other structures, some of which reference still other structures.</span></span> <span data-ttu-id="bc3f7-106">Связь между **всакуерисет** и структурами, на которые она ссылается, показана ниже.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-106">The relationship between **WSAQUERYSET** and the structures it references is illustrated as follows:</span></span>

![структуры всакуерисет](images/ovrvw3-2.png)

<span data-ttu-id="bc3f7-108">В структуре [**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) большинство участников говорят сами за себя, но некоторые из них заслуживают дополнительных пояснений.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-108">Within the [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) structure, most of the members are self explanatory, but some deserve additional explanation.</span></span> <span data-ttu-id="bc3f7-109">**Двсизе** будет заполняться с помощью sizeof ( **всакуерисет**) и может использоваться поставщиками пространств имен для обнаружения и адаптации к различным версиям структуры **всакуерисет** , которые могут появиться.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-109">The **dwSize** will be filled in with sizeof( **WSAQUERYSET**), and can be used by namespace providers to detect and adapt to different versions of the **WSAQUERYSET** structure that may appear.</span></span>

<span data-ttu-id="bc3f7-110">Элемент **дваутпутфлагс** используется поставщиком пространства имен для предоставления дополнительных данных о результатах запроса.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-110">The **dwOutputFlags** member is used by a namespace provider to provide additional data about query results.</span></span> <span data-ttu-id="bc3f7-111">Дополнительные сведения см. в разделе [**нсплукупсервиценекст**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext).</span><span class="sxs-lookup"><span data-stu-id="bc3f7-111">For more information, see [**NSPLookupServiceNext**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext).</span></span>

<span data-ttu-id="bc3f7-112">Структура [**всаекомпаратор**](/windows/desktop/api/Winsock2/ne-winsock2-wsaecomparator) , на которую ссылается **лпверсион** , используется как для ограничения запроса, так и для результатов.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-112">The [**WSAECOMPARATOR**](/windows/desktop/api/Winsock2/ne-winsock2-wsaecomparator) structure referenced by **lpversion** is used for both query constraint and results.</span></span> <span data-ttu-id="bc3f7-113">Для запросов элемент **двверсион** указывает требуемую версию службы.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-113">For queries, the **dwVersion** member indicates the desired version of the service.</span></span> <span data-ttu-id="bc3f7-114">Элемент **ечов** является перечислимым типом, который указывает, как будет выполняться сравнение.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-114">The **ecHow** member is an enumerated type which specifies how the comparison will be made.</span></span> <span data-ttu-id="bc3f7-115">Возможные варианты: COMP \_ Equals, для которых требуется точное совпадение в версии, или Comp \_ нотлесс, указывающий, что номер версии службы не должен быть меньше значения **двверсион**.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-115">The choices are COMP\_EQUALS which requires that an exact match in version occurs, or COMP\_NOTLESS which specifies that the service's version number be no less than the value of **dwVersion**.</span></span>

<span data-ttu-id="bc3f7-116">Интерпретация **двнамеспаце** и **лпнспровидерид** зависит от того, как используется структура и описывается далее в отдельных описаниях функций, использующих эту структуру.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-116">The interpretation of **dwNameSpace** and **lpNSProviderId** depends upon how the structure is being used and is described further in the individual function descriptions that utilize this structure.</span></span>

<span data-ttu-id="bc3f7-117">Элемент **лпсзконтекст** применяется к иерархическим пространствам имен и задает начальную точку запроса или расположение в иерархии, где находится служба.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-117">The **lpszContext** member applies to hierarchical namespaces, and specifies the starting point of a query or the location within the hierarchy where the service resides.</span></span> <span data-ttu-id="bc3f7-118">Общие правила</span><span class="sxs-lookup"><span data-stu-id="bc3f7-118">The general rules are:</span></span>

-   <span data-ttu-id="bc3f7-119">Значение **null**, пустое ("") запустит Поиск в контексте по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-119">A value of **NULL**, blank ("") will start the search at the default context.</span></span>
-   <span data-ttu-id="bc3f7-120">Значение " \\ " запускает поиск в верхней части пространства имен.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-120">A value of "\\" starts the search at the top of the namespace.</span></span>
-   <span data-ttu-id="bc3f7-121">Любое другое значение начинает поиск с указанной точки.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-121">Any other value starts the search at the designated point.</span></span>

<span data-ttu-id="bc3f7-122">Поставщики, не поддерживающие включение, могут возвращать ошибку, если указано любое значение, отличное от "" или " \\ ".</span><span class="sxs-lookup"><span data-stu-id="bc3f7-122">Providers that do not support containment may return an error if anything other than "" or "\\" is specified.</span></span> <span data-ttu-id="bc3f7-123">Поставщики, поддерживающие ограниченное включение, например группы, должны принимать "", " \\ " или определенную точку.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-123">Providers that support limited containment, such as groups, should accept "", '\\", or a designated point.</span></span> <span data-ttu-id="bc3f7-124">Контексты зависят от пространства имен.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-124">Contexts are namespace specific.</span></span> <span data-ttu-id="bc3f7-125">Если **двнамеспаце** имеет значение NS \_ , то в качестве контекста следует передавать только "" или " \\ ", так как они распознаются всеми пространствами имен.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-125">If **dwNameSpace** is NS\_ALL, then only "" or "\\" should be passed as the context because these are recognized by all namespaces.</span></span>

<span data-ttu-id="bc3f7-126">Элемент **лпсзкуеристринг** используется для предоставления дополнительных сведений о запросе, относящихся к пространству имен, таких как строка, описывающая известное имя службы и транспортного протокола, например "FTP/TCP".</span><span class="sxs-lookup"><span data-stu-id="bc3f7-126">The **lpszQueryString** member is used to supply additional, namespace-specific query information such as a string describing a well-known service and transport protocol name, as in "ftp/tcp".</span></span>

<span data-ttu-id="bc3f7-127">Структура [**афпротоколс**](/windows/desktop/api/Winsock2/ns-winsock2-afprotocols) , на которую ссылается **лпафппротоколс** , используется только в целях запроса и предоставляет список протоколов для ограничения запроса.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-127">The [**AFPROTOCOLS**](/windows/desktop/api/Winsock2/ns-winsock2-afprotocols) structure referenced by **lpafpProtocols** is used for query purposes only, and supplies a list of protocols to constrain the query.</span></span> <span data-ttu-id="bc3f7-128">Эти протоколы представляются в виде пар (семейств адресов, протоколов), поскольку значения протокола имеют только значение в контексте семейства адресов.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-128">These protocols are represented as (address family, protocol) pairs, because protocol values only have meaning within the context of an address family.</span></span>

<span data-ttu-id="bc3f7-129">Массив структуры [**\_ сведений о ксаддр**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) , на который ссылается **лпксабуффер** , содержит все сведения, необходимые для использования службой при установлении прослушивания, или клиент, используемый для установления соединения со службой.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-129">The array of [**CSADDR\_INFO**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) structure referenced by **lpcsaBuffer** contains all of the information required for either a service to use in establishing a listen, or a client to use in establishing a connection to the service.</span></span> <span data-ttu-id="bc3f7-130">Члены **локаладдр** и **ремотеаддр** непосредственно содержат структуру [**\_ адресов сокетов**](/windows/desktop/api/Ws2def/ns-ws2def-socket_address) .</span><span class="sxs-lookup"><span data-stu-id="bc3f7-130">The **LocalAddr** and **RemoteAddr** members both directly contain a [**SOCKET\_ADDRESS**](/windows/desktop/api/Ws2def/ns-ws2def-socket_address) structure.</span></span> <span data-ttu-id="bc3f7-131">Служба создает сокет с помощью кортежа (Локаладдр. Лпсоккаддр->\_ семейства SA, исоккеттипе, ипротокол).</span><span class="sxs-lookup"><span data-stu-id="bc3f7-131">A service would create a socket using the tuple (LocalAddr.lpSockaddr->sa\_family, iSocketType, iProtocol).</span></span> <span data-ttu-id="bc3f7-132">Он привязывает сокет к локальному адресу с помощью Локаладдр. Лпсоккаддр и Локаладдр. Лпсоккаддрленгс.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-132">It would bind the socket to a local address using LocalAddr.lpSockaddr, and LocalAddr.lpSockaddrLength.</span></span> <span data-ttu-id="bc3f7-133">Клиент создает сокет с кортежем (Ремотеаддр. Лпсоккаддр->\_ семейства SA, исоккеттипе, ипротокол) и использует сочетание ремотеаддр. лпсоккаддр и ремотеаддр. лпсоккаддрленгс при создании удаленного подключения.</span><span class="sxs-lookup"><span data-stu-id="bc3f7-133">The client creates its socket with the tuple (RemoteAddr.lpSockaddr->sa\_family, iSocketType, iProtocol), and uses the combination of RemoteAddr.lpSockaddr, and RemoteAddr.lpSockaddrLength when making a remote connection.</span></span>

 

 
