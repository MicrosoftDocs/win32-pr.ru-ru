---
description: Эта конфигурация создает сопоставление безопасности (SA) IPsec между двумя узлами в одной подсети для выполнения проверки подлинности с помощью заголовка проверки подлинности (AH) и алгоритма хэширования Message Digest 5 (MD5).
ms.assetid: ed88d8ee-ac65-4310-a988-ead50ff743fd
title: Конфигурация 3. использование IPsec между двумя узлами локальной связи
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b72485db34e8ff2c4e29a201df258dfb9d2ab9a00717ab515cda982e7ea867dc
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120121434"
---
# <a name="configuration-3-using-ipsec-between-two-local-link-hosts"></a>Конфигурация 3. использование IPsec между двумя узлами локальной связи

Эта конфигурация создает сопоставление безопасности (SA) IPsec между двумя узлами в одной подсети для выполнения проверки подлинности с помощью заголовка проверки подлинности (AH) и алгоритма хэширования Message Digest 5 (MD5). В этом примере показанная конфигурация защищает весь трафик между двумя соседними узлами: узел 1 с адресом локальной ссылки FE80:: 2AA: FF: FE53: A92C и узлом 2 с адресом локальной ссылки FE80:: 2AA: FF: FE92: D0F1.

**Использование IPsec между двумя узлами локальной связи**

1.  На узле 1 Создайте пустые файлы сопоставления безопасности (SAD) и политики безопасности (SPD) с помощью команды ipsec6 c. В этом примере команда Ipsec6.exe ipsec6 Test c. При этом создаются два файла для ручной настройки сопоставлений безопасности (Test. sad) и политик безопасности (Test. SPD).
2.  На узле 1 измените файл SPD, добавив политику безопасности, которая защищает весь трафик между узлом 1 и узлом 2.

    В следующей таблице показана политика безопасности, добавленная в файл Test. SPD перед первой записью в этом примере (первая запись в файле Test. SPD не была изменена).

    | Имя поля в файле SPD | Пример значения              |
    |---------------------|----------------------------|
    | **Политика**          | 2                          |
    | **ремотеипаддр**    | **FE80:: 2AA: FF: FE92: D0F1** |
    | **локалипаддр**     | \*                         |
    | **RemotePort**      | \*                         |
    | **протокол**;        | \*                         |
    | **LocalPort**       | \*                         |
    | **ипсекпротокол**   | **ЗАГОЛОВКИ**                     |
    | **ипсекмоде**       | **ПЕРЕМЕЩЕНИЯ**              |
    | **ремотегвипаддр**  | \*                         |
    | **сабундлеиндекс**   | **NONE**                   |
    | **Направление**       | **бидирект**               |
    | **Действие**          | **КАСАТЬСЯ**                  |
    | **InterfaceIndex**  | 0                          |

    

     

    Поместите точку с запятой в конце строки, которая настраивает эту политику безопасности. Записи политики должны быть помещены по убыванию числового порядка.

3.  На узле 1 измените файл SAD, добавив записи SA, чтобы защитить весь трафик между узлом 1 и узлом 2. Необходимо создать два сопоставления безопасности: один для трафика на узел 2 и один для трафика с узла 2.

    В следующей таблице показана первая запись SA, добавленная в файл Test. sad для этого примера (для трафика на узел 2).

    | Имя поля SAD в файле | Пример значения              |
    |---------------------|----------------------------|
    | **саентри**         | 2                          |
    | **SPI**             | 3001                       |
    | **садестипаддр**    | **FE80:: 2AA: FF: FE92: D0F1** |
    | **дестипаддр**      | **ПОЛИТИКА**                 |
    | **срЦипаддр**       | **ПОЛИТИКА**                 |
    | **протокол**;        | **ПОЛИТИКА**                 |
    | **DestPort**        | **ПОЛИТИКА**                 |
    | **сркпорт**         | **ПОЛИТИКА**                 |
    | **аусалг**         | **HMAC-MD5**               |
    | **KeyFile**         | **Тест. ключ**               |
    | **Направление**       | **ХОДЯЩУЮ**               |
    | **секполицииндекс**  | 2                          |

    

     

    Поместите точку с запятой в конце строки, которая настраивает это сопоставление безопасности.

    В следующей таблице показана вторая запись SA, добавленная в файл Test. sad для этого примера (для трафика с узла 2).

    | Имя поля SAD в файле | Пример значения              |
    |---------------------|----------------------------|
    | **саентри**         | 1                          |
    | **SPI**             | 3000                       |
    | **садестипаддр**    | **FE80:: 2AA: FF: FE53: A92C** |
    | **дестипаддр**      | **ПОЛИТИКА**                 |
    | **срЦипаддр**       | **ПОЛИТИКА**                 |
    | **протокол**;        | **ПОЛИТИКА**                 |
    | **DestPort**        | **ПОЛИТИКА**                 |
    | **сркпорт**         | **ПОЛИТИКА**                 |
    | **аусалг**         | **HMAC-MD5**               |
    | **KeyFile**         | **Тест. ключ**               |
    | **Направление**       | **ТРАФИКА**                |
    | **секполицииндекс**  | 2                          |

    

     

    Поместите точку с запятой в конце строки, которая настраивает это сопоставление безопасности. Записи SA должны быть помещены в порядке убывания числовых значений.

4.  На узле 1 Создайте текстовый файл, содержащий текстовую строку, используемую для проверки подлинности SAs, созданной с помощью узла 2. В этом примере создается файл Test. Key с содержимым «это тест». Чтобы ключ можно было прочитать с помощью средства Ipsec6, необходимо добавить ключ в двойные кавычки.

    Предварительная версия Microsoft IPv6 Technology Preview поддерживает только вручную настроенные ключи для проверки подлинности SAs IPsec. Ключи вручную настраиваются путем создания текстовых файлов, содержащих текстовую строку ключа вручную. В этом примере один и тот же ключ для SAs используется в обоих направлениях. Вы можете использовать разные ключи для входящей и исходящей SAs, создав разные файлы ключей и ссылаясь на них с помощью поля KeyFile в файле SAD.

5.  На узле 2 создайте пустые файлы сопоставления безопасности (SAD) и политики безопасности (SPD) с помощью команды ipsec6 c. В этом примере команда Ipsec6.exe ipsec6 Test c. При этом создаются два файла с пустыми записями для ручной настройки сопоставлений безопасности (Test. sad) и политик безопасности (Test. SPD).

    Для упрощения примера на узле 2 используются те же имена файлов для файлов SAD и SPD. На каждом узле можно использовать разные имена файлов.

6.  На узле 2 Измените файл SPD, добавив политику безопасности, которая защищает весь трафик между узлом 2 и узлом 1.

    В следующей таблице показана запись политики безопасности, добавленная перед первой записью в файл Test. SPD для этого примера (первая запись в файле Test. SPD не была изменена).

    | Имя поля в файле SPD | Пример значения              |
    |---------------------|----------------------------|
    | **Политика**          | 2                          |
    | **ремотеипаддр**    | **FE80:: 2AA: FF: FE53: A92C** |
    | **локалипаддр**     | \*                         |
    | **RemotePort**      | \*                         |
    | **протокол**;        | \*                         |
    | **LocalPort**       | \*                         |
    | **ипсекпротокол**   | **ЗАГОЛОВКИ**                     |
    | **ипсекмоде**       | **ПЕРЕМЕЩЕНИЯ**              |
    | **ремотегвипаддр**  | \*                         |
    | **сабундлеиндекс**   | **NONE**                   |
    | **Направление**       | **бидирект**               |
    | **Действие**          | **КАСАТЬСЯ**                  |
    | **InterfaceIndex**  | 0                          |

    

     

    Поместите точку с запятой в конце строки, которая настраивает эту политику безопасности. Записи политики должны быть помещены по убыванию числового порядка.

7.  На узле 2 Измените файл SAD, добавив записи SA, чтобы защитить весь трафик между узлом 2 и узлом 1. Необходимо создать два сопоставления безопасности — один для трафика на узел 1 и один для трафика от узла 1.

    В следующей таблице показано первое сопоставление SA, добавленное в файл Test. SAD, для этого примера (для трафика с узла 1).

    | Имя поля SAD в файле | Пример значения              |
    |---------------------|----------------------------|
    | **саентри**         | 2                          |
    | **SPI**             | 3001                       |
    | **садестипаддр**    | **FE80:: 2AA: FF: FE92: D0F1** |
    | **дестипаддр**      | **ПОЛИТИКА**                 |
    | **срЦипаддр**       | **ПОЛИТИКА**                 |
    | **протокол**;        | **ПОЛИТИКА**                 |
    | **DestPort**        | **ПОЛИТИКА**                 |
    | **сркпорт**         | **ПОЛИТИКА**                 |
    | **аусалг**         | **HMAC-MD5**               |
    | **KeyFile**         | **Тест. ключ**               |
    | **Направление**       | **ТРАФИКА**                |
    | **секполицииндекс**  | 2                          |

    

     

    Поместите точку с запятой в конце строки, которая настраивает это сопоставление безопасности.

    В следующей таблице показана вторая запись SA, добавленная в файл Test. sad для этого примера (для трафика на узел 1).

    | Имя поля SAD в файле | Пример значения              |
    |---------------------|----------------------------|
    | **саентри**         | 1                          |
    | **SPI**             | 3000                       |
    | **садестипаддр**    | **FE80:: 2AA: FF: FE53: A92C** |
    | **дестипаддр**      | **ПОЛИТИКА**                 |
    | **срЦипаддр**       | **ПОЛИТИКА**                 |
    | **протокол**;        | **ПОЛИТИКА**                 |
    | **DestPort**        | **ПОЛИТИКА**                 |
    | **сркпорт**         | **ПОЛИТИКА**                 |
    | **аусалг**         | **HMAC-MD5**               |
    | **KeyFile**         | **Тест. ключ**               |
    | **Направление**       | **ХОДЯЩУЮ**               |
    | **секполицииндекс**  | 2                          |

    

     

    Поместите точку с запятой в конце строки, которая настраивает это сопоставление безопасности. Записи SA должны быть помещены в порядке убывания числовых значений.

8.  На узле 2 Создайте текстовый файл, содержащий текстовую строку, используемую для проверки подлинности SAs, созданной с помощью узла 1. В этом примере создается файл Test. Key с содержимым «это тест». Чтобы ключ можно было прочитать с помощью средства Ipsec6, необходимо добавить ключ в двойные кавычки.
9.  На узле 1 Добавьте настроенные политики безопасности и SAs из файлов SPD и SAD с помощью команды ipsec6. В этом примере на узле 1 выполняется команда TEST ipsec6.
10. На узле 2 Добавьте настроенные политики безопасности и SAs из файлов SPD и SAD с помощью команды ipsec6. В этом примере на узле 2 выполняется команда ipsec6.
11. Проверка связи с узлом 1 с узла 2 с помощью команды ping6.

    Если вы захватываете трафик с помощью Microsoft Network Monitor или другого средства прослушивания пакетов, вы должны увидеть обмен сообщениями эхо-запроса ICMPv6 и эхо-ответа с заголовком проверки подлинности между заголовком IPv6 и заголовком ICMPv6.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Рекомендуемые конфигурации для IPv6](recommended-configurations-2.md)
</dt> <dt>

[Одна подсеть с адресами локальной связи](configuration-1-single-subnet-with-link-local-addresses-2.md)
</dt> <dt>

[Трафик IPv6 между узлами в разных подсетях объединенной сети IPv4 (6to4)](configuration-2-ipv6-traffic-between-nodes-on-different-subnets-of-an-ipv4-internetwork-6to4--2.md)
</dt> </dl>

 

 



