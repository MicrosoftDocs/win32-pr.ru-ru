---
description: В следующих таблицах описаны \_ Параметры IP-сокета иппрото, применяемые к сокетам, созданным для семейства IPv4-адресов (AF \_ iNet). Дополнительные сведения о получении и настройке параметров сокета см. на страницах справочника по функциям жетсоккопт и сетсоккопт.
ms.assetid: 6b06a29e-59cd-4446-bd2f-131dc25bf571
title: Параметры сокета IPPROTO_IP
ms.topic: article
ms.date: 10/02/2019
ms.openlocfilehash: b4c8daa18e7bd60e61473bdda1c885bbd163f0b4
ms.sourcegitcommit: c8ec1ded1ffffc364d3c4f560bb2171da0dc5040
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "105704239"
---
# <a name="ipproto_ip-socket-options"></a>\_Параметры IP-сокета иппрото

В следующих таблицах описываются параметры сокетов **IPPROTO_IP** , которые применяются к сокетам, созданным для семейства IPv4-адресов (AF \_ iNet). Дополнительные сведения о получении и настройке параметров сокета см. на страницах справочника по функциям [**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt) и [**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt) .

Для перечисления протоколов и обнаружения поддерживаемых свойств для каждого установленного протокола используйте функцию [**всаенумпротоколс**](/windows/desktop/api/Winsock2/nf-winsock2-wsaenumprotocolsa), [**всценумпротоколс**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscenumprotocols)или [**WSCEnumProtocols32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscenumprotocols32) .

Для некоторых параметров сокета требуется больше объяснений, чем может передать таблица. такие параметры содержат ссылки на дополнительные страницы.

## <a name="options"></a>Параметры

| Параметр | Получить | Присвойте параметру | Тип оптвал | Описание |
|-|-|-|-|-|
| IP_ADD_IFLIST | | да | DWORD (IF_INDEX) | Добавляет индекс интерфейса в ИФЛИСТ, связанный с параметром **IP_IFLIST** . |
| IP_ADD_MEMBERSHIP | | да | [**ip_mreq**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq) | Присоедините сокет к указанной группе многоадресной рассылки в указанном интерфейсе. |
| IP_ADD_SOURCE_MEMBERSHIP | | да | [**Источник IP- \_ мрек \_**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq_source) | Присоедините указанную группу многоадресной рассылки к заданному интерфейсу и примите данные, источником которых является указанный адрес источника. |
| Источник IP- \_ блока \_ | | да | [**Источник IP- \_ мрек \_**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq_source) | Удаляет данный источник в качестве отправителя для указанной группы многоадресной рассылки и интерфейса. |
| IP_DEL_IFLIST | | да | DWORD (IF_INDEX) | Удаляет индекс интерфейса из ИФЛИСТ, связанного с параметром **IP_IFLIST** . Записи могут быть удалены только приложением, поэтому имейте в виду, что записи могут стать устаревшими после удаления интерфейса. |
| IP- \_ донтфрагмент | да | да | DWORD (логическое значение) | Указывает, что данные не следует фрагментировать независимо от локального MTU. Действует только для протоколов, ориентированных на сообщения. Поставщики Microsoft TCP/IP используют этот параметр для UDP и ICMP. |
| членство в IP-адресе \_ \_ | | да | [**IP- \_ мрек**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq) | Оставляет указанную группу многоадресной рассылки с указанного интерфейса. Поставщики услуг должны поддерживать этот параметр, если поддерживается многоадресная рассылка. Поддержка указывается в структуре [**всапротокол \_ info**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) , возвращаемой вызовом функции [**ВСАЕНУМПРОТОКОЛС**](/windows/desktop/api/Winsock2/nf-winsock2-wsaenumprotocolsa) следующим образом: КСПИ \_ поддерживает \_ MULTIPOINT = 1, XP1 \_ MULTIPOINT \_ \_ плоскость управления = 0, XP1 \_ MultiPoint \_ \_ плоскость данных = 0. |
| \_членство в \_ источнике IP-адресов \_ | | да | [**Источник IP- \_ мрек \_**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq_source) | Удаляет членство в указанной группе многоадресной рассылки, интерфейсе и исходном адресе. |
| IP_GET_IFLIST | да | | DWORD [] (IF_INDEX []) | Возвращает текущую ИФЛИСТ, связанную с параметром **IP_IFLIST** . Возвращает ошибку, если **IP_IFLIST** не включена. |
| IP- \_ хдринкл | да | да | DWORD (логическое значение) | Если задано **значение true**, то указывает, что приложение предоставляет заголовок IP. Применяется только к Сокк \_ необработанным сокетам. Поставщик услуг TCP/IP может задать поле ID, если значение, предоставленное приложением, равно нулю.  Параметр IP \_ хдринкл применяется только к \_ типу протокола Сокк RAW. Поставщик услуг TCP/IP, поддерживающий Сокк \_ RAW, также должен поддерживать IP- \_ хдринкл.  |
| IP_IFLIST | да | да | DWORD (логическое значение) | Возвращает или задает **IP_IFLISTное** состояние сокета. Если этот параметр имеет значение true, получение датаграммы ограничено интерфейсами, которые находятся в ИФЛИСТ. Датаграммы, полученные в других интерфейсах, игнорируются. ИФЛИСТ начинает быть пустым. Для изменения ИФЛИСТ используйте **IP_ADD_IFLIST** и **IP_DEL_IFLIST** . |
| MTU IP-адресов \_ | да | | DWORD | Возвращает оценку системы по пути MTU. Сокет должен быть подключен. |
| Обнаружение IP- \_ MTU \_ | да | да | DWORD (**\_ состояние пмтуд**) | Возвращает или задает состояние обнаружения MTU пути для сокета. Значение по умолчанию — **IP- \_ пмтудиск \_ не \_ задано**. Для сокетов потока **\_ \_ не \_ задан IP-Пмтудиск** , и **IP- \_ пмтудиск \_** выполняет обнаружение PMTU. **IP-адрес \_ ПМТУДИСК \_ не** and **IP \_ ПМТУДИСК \_ зонд** отключит обнаружение MTU пути. Для сокетов датаграмм **IP- \_ пмтудиск \_** вынуждает все исходящие пакеты установить бит DF, и попытка отправить пакеты, превышающие MTU, приведет к ошибке. **IP-адрес \_ ПМТУДИСК \_ не** приведет к тому, что для всех исходящих пакетов не будет ЗАДАН бит DF, а пакеты будут фрагментироваться в соответствии с MTU интерфейса. **IP-адрес \_ Проверка \_ пмтудиск** принудительно заставит для всех исходящих пакетов установленный бит DF, а попытка отправки пакетов, превышающих MTU интерфейса, приведет к ошибке. |
| \_многоадресная рассылка IP-адресов \_ | да | да | DWORD | Возвращает или задает исходящий интерфейс для отправки многоадресного трафика IPv4. Этот параметр не изменяет интерфейс по умолчанию для получения многоадресного трафика IPv4.  Входное значение для установки этого параметра представляет собой 4-байтовый адрес IPv4 в порядке сетевого байта. Этот параметр DWORD также может быть индексом интерфейса в сетевом байтовом порядке. Любой IP-адрес в блоке 0. x. x. x (первый октет 0), за исключением IPv4-адреса 0.0.0.0, рассматривается как индекс интерфейса. Индекс интерфейса — это 24-разрядное число, а блок IPv4-адресов (0.0.0.0/8) не используется (этот диапазон зарезервирован). Индекс интерфейса можно использовать для указания интерфейса по умолчанию для многоадресного трафика для IPv4. Если *оптвал* равен нулю, для отправки многоадресного трафика указывается интерфейс по умолчанию для получения многоадресной рассылки.  При получении этого параметра *оптвал* возвращает текущий индекс интерфейса по умолчанию для отправки многоадресного IPv4-трафика в порядке байтов узла. |
| \_цикл многоадресной IP-рассылки \_ | да | да | DWORD (логическое значение) | Определяет, будут ли данные, отправляемые приложением на локальном компьютере (не обязательное одним сокетом) в сеансе многоадресной рассылки, приниматься сокетом, присоединенным к группе назначения многоадресной рассылки через интерфейс замыкания на себя. Значение **true** приводит к тому, что данные многоадресной рассылки, отправляемые приложением на локальном компьютере, доставляются в Прослушивающий сокет через интерфейс замыкания на себя. Значение **false** указывает, что данные многоадресной рассылки, отправляемые приложением на локальном компьютере, не доставляются в Прослушивающий сокет через интерфейс замыкания на себя. По умолчанию **\_ \_ петлевой IP-адрес** включен. |
| \_TTL многоадресной IP-рассылки \_ | да | да | DWORD | Задание/получение значения TTL, связанного с многоадресным IP-трафиком на сокете. |
| параметры IP-адреса \_ | да | да | типа \[\] | Указывает параметры IP для вставки в исходящие пакеты. При настройке новых параметров перезаписываются все ранее указанные параметры. При установке оптвал в ноль удаляются все ранее указанные параметры. Поддержка параметров IP-адресов \_ не требуется; чтобы проверить \_ , поддерживаются ли параметры IP-адресов, используйте [**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt) для получения текущих параметров. В случае сбоя **жетсоккопт** параметры IP-адресов \_ не поддерживаются. |
| \_исходное поступление IP-адресов, \_ \_ Если | да | да | DWORD (логическое значение) | Указывает, должна ли функция [**LPFN_WSARECVMSG (всареквмсг)**](/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg) возвращать необязательные данные элемента управления, содержащие интерфейс прибытия, где пакет был получен для сокетов датаграмм. Этот параметр позволяет вернуть в структуру [**всамсг**](/windows/desktop/api/Ws2def/ns-ws2def-wsamsg) интерфейс IPv4, где был получен пакет.  Этот параметр допустим только для датаграмм и необработанных сокетов (тип сокета должен быть Сокк \_ дграм или Сокк \_ RAW). |
| [IP- \_ пктинфо](ip-pktinfo.md) | да | да | DWORD | Указывает, что сведения о пакете должны возвращаться функцией **всареквмсг** . |
| IP-адрес \_ получения \_ широковещательной рассылки | да | да | DWORD (логическое значение) | Разрешает или блокирует получение широковещательных пакетов. |
| IP- \_ реквиф | да | да | DWORD (логическое значение) | Указывает, должен ли стек IP-адресов заполнять буфер управления сведениями о том, какой интерфейс получил пакет с сокетом датаграммы. Если это значение равно true, функция [**LPFN_WSARECVMSG (всареквмсг)**](/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg) вернет необязательные данные элемента управления, содержащие интерфейс, в котором пакет был получен для сокетов датаграмм. Этот параметр позволяет вернуть в структуру [**всамсг**](/windows/desktop/api/Ws2def/ns-ws2def-wsamsg) интерфейс IPv4, где был получен пакет.  Этот параметр допустим только для датаграмм и необработанных сокетов (тип сокета должен быть Сокк \_ дграм или Сокк \_ RAW). |
| IP- \_ реквтос | да | да | DWORD (логическое значение) | Указывает, должен ли стек IP-адресов заполнять буфер управления сообщением, содержащим поле заголовка IPv4 типа службы (TOS) в полученной датаграмме. Если это значение равно true, функция [**LPFN_WSARECVMSG (всареквмсг)**](/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg) вернет необязательные данные элемента управления, содержащие значение поля заголовка IPv4 для полученной датаграммы.  Этот параметр позволяет возвратить поле заголовка IPv4 для полученной датаграммы в структуру [**всамсг**](/windows/desktop/api/Ws2def/ns-ws2def-wsamsg) . Тип возвращаемого сообщения будет IP- \_ TOS. Будут возвращены все биты DSCP и ECN поля TOS.  Этот параметр допустим только для сокетов датаграмм (тип сокета должен быть Сокк \_ дграм).  |
| IP- \_ реквттл | да | да | DWORD (логическое значение) | Указывает, что сведения о прыжке (TTL) должны возвращаться в функции [**LPFN_WSARECVMSG (всареквмсг)**](/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg) . Если *оптвал* имеет значение **1** при вызове [**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt), этот параметр включен. Если задано значение **0**, параметр отключен.  Этот параметр допустим только для датаграмм и необработанных сокетов (тип сокета должен быть Сокк \_ дграм или Сокк \_ RAW). |
| IP- \_ TOS | да | да | DWORD (логическое значение) | Не используйте. Параметры типа службы (TOS) следует задавать только с помощью API качества службы. Дополнительные сведения см. [Приоритизированные службы](/previous-versions/windows/desktop/qos/differentiated-services) в разделе качество обслуживания пакета Platform SDK. |
| \_срок жизни IP | да | да | DWORD (логическое значение) | Изменяет значение по умолчанию, заданное поставщиком услуг TCP/IP, в поле TTL заголовка IP в исходящих датаграммах. \_Поддержка IP TTL не требуется; чтобы проверить \_ , поддерживается ли IP TTL, используйте [**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt) для получения текущих параметров. Если **жетсоккопт** завершается СБОЕМ, IP \_ TTL не поддерживается. |
| \_источник разблокировки IP-адреса \_ | | да | [**Источник IP- \_ мрек \_**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-ip_mreq_source) | Добавляет данный источник в качестве отправителя в указанную группу многоадресной рассылки и интерфейс. |
| IP- \_ адрес рассылки, \_ Если | да | да | DWORD (если \_ индекс) | Возвращает или задает исходящий интерфейс для отправки IPv4-трафика. Этот параметр не изменяет интерфейс по умолчанию для приема трафика IPv4. Этот параметр важен для многосетевых компьютеров.  Входное значение для установки этого параметра представляет собой 4-байтовый адрес IPv4 в порядке сетевого байта. Этот параметр DWORD должен быть индексом интерфейса в сетевой последовательности байтов. Любой IP-адрес в блоке 0. x. x. x (первый октет 0), за исключением IPv4-адреса 0.0.0.0, рассматривается как индекс интерфейса. Индекс интерфейса — это 24-разрядное число, а блок IPv4-адресов (0.0.0.0/8) не используется (этот диапазон зарезервирован). Индекс интерфейса можно использовать для указания интерфейса по умолчанию для отправки трафика для IPv4. Для получения сведений об индексе интерфейса можно использовать функцию [**жетадаптерсаддрессес**](/windows/win32/api/iphlpapi/nf-iphlpapi-getadaptersaddresses) . Если *оптвал* равен нулю, интерфейс по умолчанию для отправки трафика устанавливается в значение не указано.  При получении этого параметра *оптвал* возвращает текущий индекс интерфейса по умолчанию для отправки IPv4-трафика в порядке байтов узла. |
| IP_USER_MTU | да | да | DWORD | Возвращает или задает верхнюю границу на уровне IP MTU (в байтах) для данного сокета. Если значение превышает оценку MTU для пути (которое можно получить на подключенном сокете путем запроса параметра **IP_MTU** Socket), то параметр не действует. Если значение меньше, то исходящие пакеты, превышающие это, будут фрагментированы или не будут отправлены в зависимости от значения **IP_DONTFRAGMENT**. Значение по умолчанию — **IP_UNSPECIFIED_USER_MTU** (максулонг). Для обеспечения безопасности типов следует использовать функции [**всажетипусермту**](/windows/win32/api/ws2tcpip/nf-ws2tcpip-wsagetipusermtu) и [**всасетипусермту**](/windows/win32/api/ws2tcpip/nf-ws2tcpip-wsasetipusermtu) вместо прямого использования параметра сокета. |
| \_ \_ контекст перенаправления WFP IP \_ | да | да | ВСАКМСГХДР с данными управления | Вспомогательный тип данных сокета датаграмм ( \_ тип КМСГ), указывающий контекст перенаправления для сокета UDP, используемого службой перенаправления платформы фильтрации Windows (WFP) в пользовательском режиме. |
| \_ \_ записи перенаправления WFP IP-адресов \_ | да | да | ВСАКМСГХДР с данными управления | Вспомогательный тип данных сокета датаграмм ( \_ тип КМСГ) для указания записи перенаправления для UDP-сокета, используемого службой перенаправления платформы фильтрации Windows (WFP) в пользовательском режиме. |

## <a name="windows-support-for-ip_proto-options"></a>Поддержка Windows для параметров IP-адреса \_

| Параметр | Windows 10 | Windows 8 | Windows Server 2012 | Windows 7 | Windows Server 2008 | Windows Vista |
|-|-|-|-|-|-|-|
| IP_ADD_IFLIST | Начиная с Windows 10, версия 1803 | | | | | |
| \_Добавление \_ ЧЛЕНСТВА в IP | x | x | x | x | x | x |
| IP- \_ Добавление членства в \_ источнике \_ | x | x | x | x | x | x |
| Источник IP- \_ блока \_ | x | x | x | x | x | x |
| IP_DEL_IFLIST | Начиная с Windows 10, версия 1803 | | | | | |
| IP- \_ донтфрагмент | x | x | x | x | x | x |
| членство в IP-адресе \_ \_ | x | x | x | x | x | x |
| \_членство в \_ источнике IP-адресов \_ | x | x | x | x | x | x |
| IP_GET_IFLIST | Начиная с Windows 10, версия 1803 | | | | | |
| IP- \_ хдринкл | x | x | x | x | x | x |
| IP_IFLIST | Начиная с Windows 10, версия 1803 | | | | | |
| \_многоадресная рассылка IP-адресов \_ | x | x | x | x | x | x |
| \_цикл многоадресной IP-рассылки \_ | x | x | x | x | x | x |
| \_TTL многоадресной IP-рассылки \_ | x | x | x | x | x | x |
| параметры IP-адреса \_ | x | x | x | x | x | x |
| \_исходное поступление IP-адресов, \_ \_ Если | x | x | x | x | | |
| IP- \_ пктинфо | x | x | x | x | x | x |
| IP-адрес \_ получения \_ широковещательной рассылки | x | x | x | x | x | x |
| IP- \_ реквиф | Начиная с Windows 10, версия 1703 | x | x | x | x | x |
| IP- \_ реквттл | x | | | | | |
| IP- \_ TOS | x | x | x | | | |
| \_срок жизни IP | x | x | x | x | x | x |
| \_источник разблокировки IP-адреса \_ | x | x | x | x | x | x |
| IP- \_ адрес рассылки, \_ Если | x | x | x | x | x | x |
| \_ \_ контекст перенаправления WFP IP \_ | x | x | x | | | |
| \_ \_ записи перенаправления WFP IP-адресов \_ | x | x | x | | | |

<br/>

| Параметр | Windows Server 2003 | Windows XP |
|-|-|-|
| IP_ADD_IFLIST | | |
| \_Добавление \_ ЧЛЕНСТВА в IP | x | x |
| IP- \_ Добавление членства в \_ источнике \_ | x | x |
| Источник IP- \_ блока \_ | x | x |
| IP_DEL_IFLIST | | |
| IP- \_ донтфрагмент | x | x |
| членство в IP-адресе \_ \_ | x | x |
| \_членство в \_ источнике IP-адресов \_ | x | x |
| IP_GET_IFLIST | | |
| IP- \_ хдринкл | x | x |
| IP_IFLIST | | |
| \_многоадресная рассылка IP-адресов \_ | x | x |
| \_цикл многоадресной IP-рассылки \_ | x | x |
| \_TTL многоадресной IP-рассылки \_ | x | x |
| параметры IP-адреса \_ | x | x |
| \_исходное поступление IP-адресов, \_ \_ Если | | |
| IP- \_ пктинфо | x | x |
| IP-адрес \_ получения \_ широковещательной рассылки | x | x |
| IP- \_ реквиф | | |
| IP- \_ реквттл | | |
| IP- \_ TOS | | |
| \_срок жизни IP | x | x |
| \_источник разблокировки IP-адреса \_ | x | x |
| IP- \_ адрес рассылки, \_ Если | | |
| \_ \_ контекст перенаправления WFP IP \_ | | |
| \_ \_ записи перенаправления WFP IP-адресов \_ | | |

## <a name="remarks"></a>Комментарии

В пакете средств разработки программного обеспечения Microsoft Windows (SDK), выпущенном для Windows Vista и более поздних версий, Организация файлов заголовков изменилась, а **иппрото уровень \_ IP-адресов** определен в файле заголовка *Ws2def. h* , который автоматически включается в заголовочный файл *Winsock2. h* . Некоторые параметры **\_ IP-** сокета иппрото определены в файле заголовка *Ws2ipdef. h* , который автоматически включается в заголовочный файл *Ws2tcpip. h* . Остальные параметры **\_ IP-** сокета иппрото определены в файле заголовка *Wsipv6ok. h* , который автоматически включается в заголовочный файл *Winsock2. h* . Файлы заголовков *Ws2def. h*, *Ws2ipdef. h* и *Wsipv6ok. h* никогда не следует использовать напрямую.

В пакете SDK для платформы, выпущенном для Windows Server 2003 и Windows XP, уровень **\_ IP-адреса иппрото** определяется в файле заголовка *Winsock2. h* . Некоторые параметры **\_ IP-** сокета иппрото определены в файле заголовка *Ws2tcpip. h* . Остальные параметры **\_ IP-** сокета иппрото определены в файле заголовка *Wsipv6ok. h* , который автоматически включается в заголовочный файл *Winsock2. h* . Файл заголовка *Wsipv6ok. h* никогда не должен использоваться напрямую.

## <a name="requirements"></a>Требования

| Требование | Значение |
|-|-|
| Header | <dl> <dt>Ws2def. h (включает Winsock2. h); </dt> <dt>Ws2ipdef. h (включает Ws2tcpip. h); </dt> <dt>Wsipv6ok. h (включение Winsock2. h)</dt> </dl> |
