---
description: Использование служебной программы Checkv4.exe для изменения приложения IPv4 для поддержки IPv6.
ms.assetid: 36b72e4f-133d-4d96-a3c9-86a852d3a479
title: Использование служебной программы Checkv4.exe
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2fc9eca96b2138f9950b157a4b7690dc382f273e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104570806"
---
# <a name="using-the-checkv4exe-utility"></a>Использование служебной программы Checkv4.exe

> [!IMPORTANT]
> Служебная программа *Checkv4.exe* не поставляется в комплекте средств разработки программного обеспечения (SDK) для Windows 8, а также в более поздних версиях Windows SDK.

Служебная программа *Checkv4.exe* предназначена для предоставления партнеру по переносу кода; Программа, которая посвящена вашей базе кода, выявляет потенциальные проблемы или выделяет код, который может выиграть от функций и структур, поддерживающих IPv6, и дает рекомендации. С помощью служебной программы Checkv4.exe задача изменения существующего приложения IPv4 для поддержки IPv6 становится намного проще.

Программа *Checkv4.exe* устанавливается как часть пакета средств разработки программного обеспечения Microsoft Windows (SDK), выпущенного для Windows Vista и более поздних пакетов SDK (до, но не включая пакет средств разработки программного обеспечения Windows (SDK) для Windows 8).

Более ранняя версия служебной программы *Checkv4.exe* с более ограниченными функциями была также выпущена в рамках предыдущей предварительной версии технологии IPv6 Microsoft для Windows 2000.

В следующих разделах описывается использование служебной программы *Checkv4.exe* , а затем объясняется рекомендуемый подход к изменению существующего приложения IPv4 для поддержки IPv6.

## <a name="recommendations-for-running-checkv4exe"></a>Рекомендации по выполнению Checkv4.exe

-   Программа *Checkv4.exe* проста. Просто выполните *Checkv4.exe* в командной строке с именем файла, который требуется проверить в качестве параметра. *Checkv4.exe* анализирует файл и предоставляет отзыв о том, где в этом файле существуют проблемы с IPv6-портами. Размещение *Checkv4.exe* в пути компьютера значительно упрощает запуск служебной программы *Checkv4.exe* из любого места в структуре каталога с исходным кодом. Например, размещение *Checkv4.exe* в% WINDIR% позволяет запускать *Checkv4.exe* из любого каталога на компьютере без включения пути.

-   Выполните следующую команду в командной строке, чтобы проанализировать файл Симплек. c:

    **Checkv4 симплек. c**

    Обратите внимание, что некоторые рекомендации, выполняемые служебной программой *Checkv4.exe* , должны иметь структуры, доступные только в последних версиях файла заголовков *Ws2tcpip. h* , например в структуре **SOCKADDR \_ IN6** . Эти файлы заголовков включены в Windows SDK, выпущенные для Windows Vista и более поздних версий. Эти файлы заголовков также включены в пакет SDK для платформы более ранних версий, выпущенный для Windows Server 2003. Эти файлы заголовков также входят в состав подписки MSDN или по загрузке.

    На следующем снимке экрана показаны результаты использования служебной программы *Checkv4.exe* в файле симплек. c, включенном в приложение а.

    ![checkv4.exe сообщает о несовместимости IPv6 в файле симплек. c](images/portingguide002.jpg)

    На следующем снимке экрана показаны результаты использования служебной программы *Checkv4.exe* в файле Simple. c, который также включен в приложение а.

    ![checkv4.exe сообщает о несовместимости IPv6 в файле Simple. c](images/portingguide003.jpg)

## <a name="the-application-modification-process-where-to-start"></a>Процесс изменения приложения: с чего начать

Существует рекомендуемая процедура, связанная с добавлением возможностей IPv6 в приложения. Эта последовательность является полезной, поскольку она позволяет разработчикам убедиться, что все шаги, необходимые для изменения существующего приложения IPv4 для поддержки IPv6, выполнены. Некоторые приложения могут потребовать более тщательного внимания к одной из этих последовательностей; Например, системная служба, скорее всего, будет иметь меньше проблем с интерфейсом пользователя, чем графическая программа для обмена файлами (FTP).

**Изменение приложений IPv4 для поддержки IPv6**

1.  Исправьте структуры и объявления, чтобы включить совместимость IPv6 и IPv4.
2.  Измените вызовы функций, чтобы воспользоваться преимуществами функций, поддерживающих протокол IPv6, таких как функции [**функцию getaddrinfo**](/windows/desktop/api/Ws2tcpip/nf-ws2tcpip-getaddrinfo) и [**жетнамеинфо**](/windows/desktop/api/Ws2tcpip/nf-ws2tcpip-getnameinfo) .
3.  Проверьте исходный код на использование жестко запрограммированных IPv4-адресов, таких как петлевой адрес, или использование других строковых литералов.
4.  Тщательное изучение пользовательского интерфейса, включая информационные диалоговые окна. Подумали, подходит ли он для приложений с поддержкой IPv6 для указания или предоставления информации на основе IP-адресов.
5.  Определите, полагается ли ваше приложение на базовые протоколы, такие как RPC, и внесите соответствующие программные изменения в обработку IPv6-адресов.
6.  Используйте флаг времени компиляции IPV6STRICT при компиляции приложений в Windows XP и более поздних версиях. Этот флаг приводит к невозможности компиляции несовместимого кода следующим образом:

    Приложения Windows Sockets 1. x с несовместимым кодом не компилируются и возвращают сообщение об ошибке «требуется WINSOCK2».

    Приложения Windows Sockets 2. x с несовместимым кодом вызывают ошибку времени компиляции для каждого экземпляра несовместимого кода. Сообщение об ошибке создается в следующем формате:

    `[file name] ([line number]) : [error message] '[symbol]_IPV6INCOMPATIBLE'`

    Пример:

    `sample.c(8) : error C2065: 'gethostbyaddr_IPV6INCOMPATIBLE' : undeclared identifier`

 

 



