---
description: Чтобы получать уведомления о недействительных логических сетях, используйте функцию Всанспиоктл для регистрации событий изменения сетевого расположения.
ms.assetid: 531b6269-5f35-44c1-ad0f-c5f103029893
title: Запрос NLA
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0ac7a4f57e14bb967b04d3a9fd6fe66717da3878
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105702103"
---
# <a name="querying-nla"></a><span data-ttu-id="74d2b-103">Запрос NLA</span><span class="sxs-lookup"><span data-stu-id="74d2b-103">Querying NLA</span></span>

<span data-ttu-id="74d2b-104">Чтобы получать уведомления о недействительных логических сетях, используйте функцию [**всанспиоктл**](/windows/desktop/api/Winsock2/nf-winsock2-wsanspioctl) для регистрации событий изменения сетевого расположения.</span><span class="sxs-lookup"><span data-stu-id="74d2b-104">To obtain notification of invalidated logical networks, use the [**WSANSPIoctl**](/windows/desktop/api/Winsock2/nf-winsock2-wsanspioctl) function to register for network location change events.</span></span> <span data-ttu-id="74d2b-105">Можно использовать два метода, чтобы определить, стало ли ранее допустимое сетевое расположение недопустимым: методы опроса или уведомление с помощью перекрывающихся операций ввода-вывода или обмена сообщениями Windows.</span><span class="sxs-lookup"><span data-stu-id="74d2b-105">Two methods can be used to determine whether a previously valid network location has become invalid: polling methods, or notification using overlapped I/O or Windows messaging.</span></span>

<span data-ttu-id="74d2b-106">Запросы формируются с помощью функций [**всалукупсервицебегин**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina), [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) и [**всалукупсервицеенд**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupserviceend) для перечисления всех доступных логических сетей.</span><span class="sxs-lookup"><span data-stu-id="74d2b-106">Queries are formed using the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina), [**WSALookupServiceNext,**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) and [**WSALookupServiceEnd**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupserviceend) functions to enumerate all available logical networks.</span></span> <span data-ttu-id="74d2b-107">Использование каждой из этих функций объясняется по отдельности в оставшейся части этого раздела, начиная с функции **всалукупсервицебегин** .</span><span class="sxs-lookup"><span data-stu-id="74d2b-107">The use of each of these functions is explained individually throughout the remainder of this section, beginning with the **WSALookupServiceBegin** function.</span></span>

> [!Note]  
> <span data-ttu-id="74d2b-108">NLA требует файл заголовка Мсвсокк. h, который по умолчанию не включен в файл Winsock2. h.</span><span class="sxs-lookup"><span data-stu-id="74d2b-108">NLA requires the Mswsock.h header file, which by default is not included in the Winsock2.h file.</span></span>

 

## <a name="step-1-initiate-the-query"></a><span data-ttu-id="74d2b-109">Шаг 1. Инициация запроса</span><span class="sxs-lookup"><span data-stu-id="74d2b-109">Step 1: Initiate the Query</span></span>

<span data-ttu-id="74d2b-110">Для краткого справочника функция [**всалукупсервицебегин**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) имеет следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="74d2b-110">For quick reference, the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) function has the following syntax:</span></span>

``` syntax
INT WSALookupServiceBegin(
  LPWSAQUERYSET lpqsRestrictions,
  DWORD dwControlFlags,
  LPHANDLE lphLookup
);
```

<span data-ttu-id="74d2b-111">NLA поддерживает следующие флаги поиска *двконтролфлагс* :</span><span class="sxs-lookup"><span data-stu-id="74d2b-111">NLA supports the following *dwControlFlags* lookup flags:</span></span>

<dl> <span data-ttu-id="74d2b-112">\_имя возврата \_ Луп</span><span class="sxs-lookup"><span data-stu-id="74d2b-112">LUP\_RETURN\_NAME</span></span>  
<span data-ttu-id="74d2b-113">\_Комментарий возврата \_ Луп</span><span class="sxs-lookup"><span data-stu-id="74d2b-113">LUP\_RETURN\_COMMENT</span></span>  
<span data-ttu-id="74d2b-114">\_возвращаемый \_ BLOB-объект Луп</span><span class="sxs-lookup"><span data-stu-id="74d2b-114">LUP\_RETURN\_BLOB</span></span>  
<span data-ttu-id="74d2b-115">ЛУП \_ возвратить \_ все</span><span class="sxs-lookup"><span data-stu-id="74d2b-115">LUP\_RETURN\_ALL</span></span>  
<span data-ttu-id="74d2b-116">ЛУП \_</span><span class="sxs-lookup"><span data-stu-id="74d2b-116">LUP\_DEEP</span></span>  
</dl>

<span data-ttu-id="74d2b-117">Эти флаги ограничивают результирующие наборы, возвращаемые при последующих вызовах функции [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta), к сетям, содержащим поля указанного типа.</span><span class="sxs-lookup"><span data-stu-id="74d2b-117">These flags restrict the result sets returned in subsequent calls to the [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta), function to networks that contain fields of the specified type.</span></span> <span data-ttu-id="74d2b-118">Например, указание ЛУП \_ возвращаемого \_ большого двоичного объекта в параметре *Двконтролфлагс* вызова функции [**всалукупсервицебегин**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) позволяет ограничивать результирующие наборы от последующих вызовов **всалукупсервиценекст** до сетей, содержащих данные большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="74d2b-118">For example, specifying LUP\_RETURN\_BLOB in the *dwControlFlags* parameter of the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) function call restricts result sets from subsequent calls to **WSALookupServiceNext**, to networks that contain BLOB information.</span></span> <span data-ttu-id="74d2b-119">Использование \_ \_ флага возврата ALL Луп эквивалентно указанию \_ возвращаемого \_ имени Луп, ЛУП \_ return \_ комментария и Луп \_ возвращают \_ большой двоичный объект, но не Луп \_ .</span><span class="sxs-lookup"><span data-stu-id="74d2b-119">Using the LUP\_RETURN\_ALL flag is equivalent to specifying LUP\_RETURN\_NAME, LUP\_RETURN\_COMMENT, and LUP\_RETURN\_BLOB, but not LUP\_DEEP.</span></span>

<span data-ttu-id="74d2b-120">Описание этих флагов поиска см. на странице справки по функциям [**всалукупсервицебегин**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) .</span><span class="sxs-lookup"><span data-stu-id="74d2b-120">For an explanation of these lookup flags, consult the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) function reference page.</span></span>

<span data-ttu-id="74d2b-121">Маркер поиска, возвращенный NLA в параметре *лфлукуп* , является частным для NLA и не должен изменяться.</span><span class="sxs-lookup"><span data-stu-id="74d2b-121">The lookup handle returned by NLA in the *lphLookup* parameter is private to NLA, and should not be modified.</span></span> <span data-ttu-id="74d2b-122">Так как возвращенный маркер является частным для NLA, такие функции, как [**всажетоверлаппедресулт**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetoverlappedresult) , недоступны.</span><span class="sxs-lookup"><span data-stu-id="74d2b-122">Since the returned handle is private to NLA, functions such as [**WSAGetOverlappedResult**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetoverlappedresult) are not available.</span></span>

<span data-ttu-id="74d2b-123">NLA возвращает ноль после успешного завершения, как определено на странице справочника по функциям [**всалукупсервицебегин**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) .</span><span class="sxs-lookup"><span data-stu-id="74d2b-123">NLA returns zero upon successful completion, as defined in the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) function reference page.</span></span> <span data-ttu-id="74d2b-124">В противном случае NLA поддерживает следующие коды ошибок.</span><span class="sxs-lookup"><span data-stu-id="74d2b-124">Otherwise, NLA supports the following error codes.</span></span>

| <span data-ttu-id="74d2b-125">Ошибка</span><span class="sxs-lookup"><span data-stu-id="74d2b-125">Error</span></span>                    | <span data-ttu-id="74d2b-126">Значение</span><span class="sxs-lookup"><span data-stu-id="74d2b-126">Meaning</span></span>                                                                                                                                                     |
|--------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="74d2b-127">WSANOTINITIALISED</span><span class="sxs-lookup"><span data-stu-id="74d2b-127">WSANOTINITIALISED</span></span>        | <span data-ttu-id="74d2b-128">Успешный вызов функции [**сбой WSAStartup**](/windows/desktop/api/winsock/nf-winsock-wsastartup) для инициализации NLA не выполнялся.</span><span class="sxs-lookup"><span data-stu-id="74d2b-128">A successful call to the [**WSAStartup**](/windows/desktop/api/winsock/nf-winsock-wsastartup) function to initialize NLA was not performed.</span></span>                                                   |
| <span data-ttu-id="74d2b-129">всаеинвал</span><span class="sxs-lookup"><span data-stu-id="74d2b-129">WSAEINVAL</span></span>                | <span data-ttu-id="74d2b-130">Один или несколько параметров являются недопустимыми, или параметры, указанные в вызове функции, применяются к протоколам, отличным от IP.</span><span class="sxs-lookup"><span data-stu-id="74d2b-130">One or more parameters were invalid, or parameters specified in the function call apply to protocols other than IP.</span></span>                                         |
| <span data-ttu-id="74d2b-131">ВСАСЕРВИЦЕ \_ не \_ найден</span><span class="sxs-lookup"><span data-stu-id="74d2b-131">WSASERVICE\_NOT\_FOUND</span></span>   | <span data-ttu-id="74d2b-132">Параметр *лпсервицеклассид* структуры [**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) , переданный в параметре *лпксрестриктионс* , содержит недопустимый GUID.</span><span class="sxs-lookup"><span data-stu-id="74d2b-132">The *lpServiceClassId* parameter of the [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) structure passed in the *lpqsRestrictions* parameter contains an invalid GUID.</span></span> |
| <span data-ttu-id="74d2b-133">\_данные всано</span><span class="sxs-lookup"><span data-stu-id="74d2b-133">WSANO\_DATA</span></span>              | <span data-ttu-id="74d2b-134">\_Флаг контейнеров Луп был указан в параметре *двконтролфлагс* .</span><span class="sxs-lookup"><span data-stu-id="74d2b-134">The LUP\_CONTAINERS flag was specified in *dwControlFlags* parameter.</span></span>                                                                                       |
| <span data-ttu-id="74d2b-135">WSAEFAULT</span><span class="sxs-lookup"><span data-stu-id="74d2b-135">WSAEFAULT</span></span>                | <span data-ttu-id="74d2b-136">Нарушение прав доступа при попытке доступа к параметрам, предоставляемым пользователем.</span><span class="sxs-lookup"><span data-stu-id="74d2b-136">An access violation occurred when attempting to access user-supplied parameters.</span></span>                                                                            |
| <span data-ttu-id="74d2b-137">всасиснотреади</span><span class="sxs-lookup"><span data-stu-id="74d2b-137">WSASYSNOTREADY</span></span>           | <span data-ttu-id="74d2b-138">Служба NLA недоступна для обработки запроса.</span><span class="sxs-lookup"><span data-stu-id="74d2b-138">The NLA service is unavailable to process the request.</span></span>                                                                                                      |
| <span data-ttu-id="74d2b-139">WSA \_ не \_ хватает \_ памяти</span><span class="sxs-lookup"><span data-stu-id="74d2b-139">WSA\_NOT\_ENOUGH\_MEMORY</span></span> | <span data-ttu-id="74d2b-140">NLA или службе NLA не удалось выделить достаточно памяти для обработки этого запроса.</span><span class="sxs-lookup"><span data-stu-id="74d2b-140">NLA or the NLA service was unable to allocate enough memory to process this request.</span></span>                                                                        |



 

## <a name="step-2-perform-the-query"></a><span data-ttu-id="74d2b-141">Шаг 2. выполнение запроса</span><span class="sxs-lookup"><span data-stu-id="74d2b-141">Step 2: Perform the Query</span></span>

<span data-ttu-id="74d2b-142">Для следующего шага при запросе NLA необходимо использовать функцию [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) .</span><span class="sxs-lookup"><span data-stu-id="74d2b-142">The next step in querying NLA requires use of the [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) function.</span></span> <span data-ttu-id="74d2b-143">Для краткого справочника функция **всалукупсервиценекст** имеет следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="74d2b-143">For quick reference, the **WSALookupServiceNext**, function has the following syntax:</span></span>

``` syntax
INT WSALookupServiceNext(
  HANDLE hLookup,
  DWORD dwControlFlags,
  LPDWORD lpdwBufferLength,
  LPWSAQUERYSET lpqsResults
);
```

<span data-ttu-id="74d2b-144">Параметр *ллукуп* — это маркер уточняющего запроса, возвращенный из предыдущего вызова функции [**всалукупсервицебегин**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) .</span><span class="sxs-lookup"><span data-stu-id="74d2b-144">The *lLookup* parameter is the lookup handle returned from the previous call to the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) function.</span></span>

<span data-ttu-id="74d2b-145">Параметр *двконтролфлагс* поддерживает следующие флаги:</span><span class="sxs-lookup"><span data-stu-id="74d2b-145">The *dwControlFlags* parameter supports the following flags:</span></span>

<dl> <span data-ttu-id="74d2b-146">\_имя возврата \_ Луп</span><span class="sxs-lookup"><span data-stu-id="74d2b-146">LUP\_RETURN\_NAME</span></span>  
<span data-ttu-id="74d2b-147">\_Комментарий возврата \_ Луп</span><span class="sxs-lookup"><span data-stu-id="74d2b-147">LUP\_RETURN\_COMMENT</span></span>  
<span data-ttu-id="74d2b-148">\_возвращаемый \_ BLOB-объект Луп</span><span class="sxs-lookup"><span data-stu-id="74d2b-148">LUP\_RETURN\_BLOB</span></span>  
<span data-ttu-id="74d2b-149">ЛУП \_ возвратить \_ все</span><span class="sxs-lookup"><span data-stu-id="74d2b-149">LUP\_RETURN\_ALL</span></span>  
<span data-ttu-id="74d2b-150">ЛУП \_ флушпревиаус</span><span class="sxs-lookup"><span data-stu-id="74d2b-150">LUP\_FLUSHPREVIOUS</span></span>  
</dl>

<span data-ttu-id="74d2b-151">Эти флаги не зависят от флагов, поддерживаемых в вызове функции [**всалукупсервицебегин**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) .</span><span class="sxs-lookup"><span data-stu-id="74d2b-151">These flags are independent of the flags supported in the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) function call.</span></span> <span data-ttu-id="74d2b-152">Обратите внимание, что все ограничения, указанные в предыдущем вызове функции **всалукупсервицебегин** , ограничивают Уточняющий запрос. Добавление флагов с помощью функции [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) в попытке расширить запрос за пределами ограничений, заданных в вызове **всалукупсервицебегин** , не пропускается автоматически.</span><span class="sxs-lookup"><span data-stu-id="74d2b-152">Note that any constraints specified in the previous call to the **WSALookupServiceBegin** function constrain the lookup; adding flags with the [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) function in an attempt to broaden the query beyond the constraints specified in the **WSALookupServiceBegin** call are silently ignored.</span></span> <span data-ttu-id="74d2b-153">Однако при указании более неопределенного набора флагов, указанного в вызове **всалукупсервицебегин** , допускается.</span><span class="sxs-lookup"><span data-stu-id="74d2b-153">Specifying a more restrictive set of flags than that specified in the **WSALookupServiceBegin** call, however, is allowed.</span></span>

<span data-ttu-id="74d2b-154">Если сеть, описанная в *лпксресултс* , является активной сетью, к ней добавляется ряд структур **\_ больших двоичных объектов NLA** , как указано в **лпблоб** элемента структуры [**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) , возвращенной в *лпксресултс*.</span><span class="sxs-lookup"><span data-stu-id="74d2b-154">If the network detailed in *lpqsResults* is an active network, a series of **NLA\_BLOB** structures is appended as specified in the **lpBlob** member of the [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) structure returned in *lpqsResults*.</span></span> <span data-ttu-id="74d2b-155">Эти **структуры \_ больших двоичных объектов NLA** могут быть объединены в цепочку, и их можно перечислить путем прохода по списку, в то время как NLA \_ BLOB. Header. некстоффсет не равно нулю.</span><span class="sxs-lookup"><span data-stu-id="74d2b-155">These **NLA\_BLOB** structures may be chained, and can be enumerated by traversing the list while NLA\_BLOB.header.nextOffset is nonzero.</span></span> <span data-ttu-id="74d2b-156">Чтобы получить результаты для всех сведений о сетевом расположении, продолжайте вызывать [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta)до тех пор, пока \_ \_ не \_ будет возвращена ошибка WSA E, как описано на справочной странице **всалукупсервиценекст**.</span><span class="sxs-lookup"><span data-stu-id="74d2b-156">To obtain results for all network location information, continue calling the [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta), function until the WSA\_E\_NO\_MORE error is returned, as explained in the **WSALookupServiceNext**, reference page.</span></span>

<span data-ttu-id="74d2b-157">Функция [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) также используется вместе с функцией [**всанспиоктл**](/windows/desktop/api/Winsock2/nf-winsock2-wsanspioctl) для получения уведомлений об изменениях в сети.</span><span class="sxs-lookup"><span data-stu-id="74d2b-157">The [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) function is also used in conjunction with the [**WSANSPIoctl**](/windows/desktop/api/Winsock2/nf-winsock2-wsanspioctl) function to receive notification of network changes.</span></span> <span data-ttu-id="74d2b-158">Дополнительные сведения см. [в разделе уведомление от NLA](notification-from-nla-2.md) .</span><span class="sxs-lookup"><span data-stu-id="74d2b-158">See [Notification from NLA](notification-from-nla-2.md) for more information.</span></span>

<span data-ttu-id="74d2b-159">NLA возвращает ноль после успешного завершения.</span><span class="sxs-lookup"><span data-stu-id="74d2b-159">NLA returns zero upon successful completion.</span></span> <span data-ttu-id="74d2b-160">Клиенты NLA должны продолжать вызывать [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta), вызывая функцию до тех пор, пока \_ \_ не \_ вернется WSA E, что означает, что возвращаются все сведения о доступных сетях.</span><span class="sxs-lookup"><span data-stu-id="74d2b-160">Clients of NLA should continue calling the [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta), function until WSA\_E\_NO\_MORE is returned, indicating that all of the information about available networks has been returned.</span></span>

<span data-ttu-id="74d2b-161">В противном случае вызов функции [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta), функция для NLA, поддерживает следующие коды ошибок.</span><span class="sxs-lookup"><span data-stu-id="74d2b-161">Otherwise, calling the [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta), function for NLA supports the following error codes.</span></span>

| <span data-ttu-id="74d2b-162">Ошибка</span><span class="sxs-lookup"><span data-stu-id="74d2b-162">Error</span></span>                    | <span data-ttu-id="74d2b-163">Значение</span><span class="sxs-lookup"><span data-stu-id="74d2b-163">Meaning</span></span>                                                                                                                                                                                                                                                                                                                                                                                                     |
|--------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="74d2b-164">WSANOTINITIALISED</span><span class="sxs-lookup"><span data-stu-id="74d2b-164">WSANOTINITIALISED</span></span>        | <span data-ttu-id="74d2b-165">Успешный вызов функции [**сбой WSAStartup**](/windows/desktop/api/winsock/nf-winsock-wsastartup) , инициализированной NLA, не выполнялся.</span><span class="sxs-lookup"><span data-stu-id="74d2b-165">A successful call to the [**WSAStartup**](/windows/desktop/api/winsock/nf-winsock-wsastartup) function that initialized NLA was not performed.</span></span>                                                                                                                                                                                                                                                                                                |
| <span data-ttu-id="74d2b-166">\_Недопустимый \_ маркер WSA</span><span class="sxs-lookup"><span data-stu-id="74d2b-166">WSA\_INVALID\_HANDLE</span></span>     | <span data-ttu-id="74d2b-167">Маркер поиска, указанный в параметре *ГПР* , не является допустимым обработчиком SP NLA.</span><span class="sxs-lookup"><span data-stu-id="74d2b-167">The lookup handle provided in the *hLookup* parameter was not a valid NLA SP handle.</span></span> <span data-ttu-id="74d2b-168">Чтобы получить результаты запроса, клиенты должны сначала вызвать функцию [**всалукупсервицебегин**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) и получить допустимый обработчик SP NLA.</span><span class="sxs-lookup"><span data-stu-id="74d2b-168">Clients must first call the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) function and receive a valid NLA SP handle to obtain query results.</span></span>                                                                                                                                                               |
| <span data-ttu-id="74d2b-169">всаесиснотреади</span><span class="sxs-lookup"><span data-stu-id="74d2b-169">WSAESYSNOTREADY</span></span>          | <span data-ttu-id="74d2b-170">Служба NLA недоступна для обработки этого запроса.</span><span class="sxs-lookup"><span data-stu-id="74d2b-170">The NLA service is unavailable to process this request.</span></span>                                                                                                                                                                                                                                                                                                                                                     |
| <span data-ttu-id="74d2b-171">WSAEFAULT</span><span class="sxs-lookup"><span data-stu-id="74d2b-171">WSAEFAULT</span></span>                | <span data-ttu-id="74d2b-172">Размер буфера, указанный в параметре *лпдвбуфферленгс* , недостаточно для хранения результатов, на которые указывает *лпксресултс*.</span><span class="sxs-lookup"><span data-stu-id="74d2b-172">The buffer size specified in the *lpdwBufferLength* parameter was insufficient to hold the results pointed to by *lpqsResults*.</span></span> <span data-ttu-id="74d2b-173">Требуемый буфер указан в *лпдвбуфферленгс*; Если клиент не может предоставить достаточно большой буфер, клиент может вызвать функцию [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) с параметром *двконтролфлагс* , для которого задано значение Луп \_ флушпревиаус, чтобы пропустить запись.</span><span class="sxs-lookup"><span data-stu-id="74d2b-173">The required buffer is specified in *lpdwBufferLength*; if the client cannot supply a sufficiently large buffer, the client can call the [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) function with *dwControlFlags* set to LUP\_FLUSHPREVIOUS to skip the entry.</span></span> |
| <span data-ttu-id="74d2b-174">WSA \_ не \_ хватает \_ памяти</span><span class="sxs-lookup"><span data-stu-id="74d2b-174">WSA\_NOT\_ENOUGH\_MEMORY</span></span> | <span data-ttu-id="74d2b-175">NLA не удалось получить сетевую информацию от системной службы NLA из-за нехватки памяти в вызывающем процессе.</span><span class="sxs-lookup"><span data-stu-id="74d2b-175">NLA is unable to obtain network information from the NLA system service due to insufficient memory in the calling process.</span></span>                                                                                                                                                                                                                                                                                  |
| <span data-ttu-id="74d2b-176">WSA \_ E \_ больше \_</span><span class="sxs-lookup"><span data-stu-id="74d2b-176">WSA\_E\_NO\_MORE</span></span>         | <span data-ttu-id="74d2b-177">Нет дополнительных сетей для перечисления для запроса.</span><span class="sxs-lookup"><span data-stu-id="74d2b-177">There are no additional networks to enumerate for the query.</span></span>                                                                                                                                                                                                                                                                                                                                                |



 

## <a name="step-3-terminate-the-query"></a><span data-ttu-id="74d2b-178">Шаг 3. завершение запроса</span><span class="sxs-lookup"><span data-stu-id="74d2b-178">Step 3: Terminate the Query</span></span>

<span data-ttu-id="74d2b-179">Когда все запросы к NLA завершены и приложению больше не требуется использовать NLA, следует выполнить вызов функции [**всалукупсервицеенд**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupserviceend) .</span><span class="sxs-lookup"><span data-stu-id="74d2b-179">When all queries to NLA are complete and an application no longer requires use of NLA, a call to the [**WSALookupServiceEnd**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupserviceend) function should be made.</span></span> <span data-ttu-id="74d2b-180">Не вызывайте **всалукупсервицеенд** , если приложение получит уведомление об изменении на основе отправленного запроса.</span><span class="sxs-lookup"><span data-stu-id="74d2b-180">Do not call **WSALookupServiceEnd** if the application will receive change notification based on the submitted query.</span></span> <span data-ttu-id="74d2b-181">Дополнительные сведения о получении уведомления см. в разделе [уведомление от NLA](notification-from-nla-2.md) .</span><span class="sxs-lookup"><span data-stu-id="74d2b-181">See [Notification from NLA](notification-from-nla-2.md) for more information on receiving notification.</span></span> <span data-ttu-id="74d2b-182">Как и большинство поставщиков услуг сокетов Windows, NLA поддерживает подсчет ссылок для своих клиентов.</span><span class="sxs-lookup"><span data-stu-id="74d2b-182">Like most Windows Sockets service providers, NLA maintains a reference count for its clients.</span></span> <span data-ttu-id="74d2b-183">Вызов функции **всалукупсервицеенд** при завершении запросов NLA позволяет освободить системные ресурсы, которые больше не требуются для освобождения NLA.</span><span class="sxs-lookup"><span data-stu-id="74d2b-183">Calling the **WSALookupServiceEnd** function when queries to NLA are completed enables system resources no longer required by NLA to be freed.</span></span>

<span data-ttu-id="74d2b-184">NLA поддерживает следующие коды ошибок для вызовов функций [**всалукупсервицеенд**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupserviceend) .</span><span class="sxs-lookup"><span data-stu-id="74d2b-184">NLA supports the following error codes for [**WSALookupServiceEnd**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupserviceend) function calls.</span></span>

| <span data-ttu-id="74d2b-185">Ошибка</span><span class="sxs-lookup"><span data-stu-id="74d2b-185">Error</span></span>                | <span data-ttu-id="74d2b-186">Значение</span><span class="sxs-lookup"><span data-stu-id="74d2b-186">Meaning</span></span>                                                                                                   |
|----------------------|-----------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="74d2b-187">WSANOTINITIALISED</span><span class="sxs-lookup"><span data-stu-id="74d2b-187">WSANOTINITIALISED</span></span>    | <span data-ttu-id="74d2b-188">Успешный вызов функции [**сбой WSAStartup**](/windows/desktop/api/winsock/nf-winsock-wsastartup) для инициализации NLA не выполнялся.</span><span class="sxs-lookup"><span data-stu-id="74d2b-188">A successful call to the [**WSAStartup**](/windows/desktop/api/winsock/nf-winsock-wsastartup) function to initialize NLA was not performed.</span></span> |
| <span data-ttu-id="74d2b-189">\_Недопустимый \_ маркер WSA</span><span class="sxs-lookup"><span data-stu-id="74d2b-189">WSA\_INVALID\_HANDLE</span></span> | <span data-ttu-id="74d2b-190">Маркер, указанный в параметре *ГПР* , не является допустимым обработчиком SP NLA.</span><span class="sxs-lookup"><span data-stu-id="74d2b-190">The handle provided in the *hLookup* parameter was not a valid NLA SP handle.</span></span>                             |



 

 

 



