---
description: 'Существует несколько параметров, позволяющих принимать указания по завершению, таким образом предоставляя приложения с соответствующими уровнями гибкости. К ним относятся: ожидание (или блокировка) объектов событий, опрос объектов событий и подпрограммы завершения ввода-вывода сокета.'
ms.assetid: 071cf198-6b4c-445e-9bd9-044f57f994a3
title: Получение обработок завершения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cd05d8297af17c26393b5db113fac283b39fcbb3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105702888"
---
# <a name="receiving-completion-indications"></a><span data-ttu-id="acc6b-104">Получение обработок завершения</span><span class="sxs-lookup"><span data-stu-id="acc6b-104">Receiving Completion Indications</span></span>

<span data-ttu-id="acc6b-105">Существует несколько параметров, позволяющих принимать указания по завершению, таким образом предоставляя приложения с соответствующими уровнями гибкости.</span><span class="sxs-lookup"><span data-stu-id="acc6b-105">Several options are available for receiving completion indications, thus providing applications with appropriate levels of flexibility.</span></span> <span data-ttu-id="acc6b-106">К ним относятся: ожидание (или блокировка) объектов событий, опрос объектов событий и подпрограммы завершения ввода-вывода сокета.</span><span class="sxs-lookup"><span data-stu-id="acc6b-106">These include: waiting (or blocking) on event objects, polling event objects, and socket I/O completion routines.</span></span>

## <a name="blocking-and-waiting-for-completion-indication"></a><span data-ttu-id="acc6b-107">Блокировка и ожидание индикации завершения</span><span class="sxs-lookup"><span data-stu-id="acc6b-107">Blocking and Waiting for Completion Indication</span></span>

<span data-ttu-id="acc6b-108">Приложения могут блокироваться при ожидании установки одного или нескольких объектов событий с помощью функции [**всаваитформултипливентс**](/windows/desktop/api/Winsock2/nf-winsock2-wsawaitformultipleevents) .</span><span class="sxs-lookup"><span data-stu-id="acc6b-108">Applications can block while waiting for one or more event objects to become set using the [**WSAWaitForMultipleEvents**](/windows/desktop/api/Winsock2/nf-winsock2-wsawaitformultipleevents) function.</span></span> <span data-ttu-id="acc6b-109">В реализациях Windows процесс или поток действительно блокируется.</span><span class="sxs-lookup"><span data-stu-id="acc6b-109">In Windows implementations, the process or thread truly blocks.</span></span> <span data-ttu-id="acc6b-110">Так как объекты событий Windows Sockets 2 реализуются как события Windows, для этой цели также можно использовать собственную функцию Windows, [**WaitForMultipleObjects**](/windows/win32/api/synchapi/nf-synchapi-waitformultipleobjects) .</span><span class="sxs-lookup"><span data-stu-id="acc6b-110">Since Windows Sockets 2 event objects are implemented as Windows events, the native Windows function, [**WaitForMultipleObjects**](/windows/win32/api/synchapi/nf-synchapi-waitformultipleobjects) can also be used for this purpose.</span></span> <span data-ttu-id="acc6b-111">Это особенно удобно, если поток должен ожидать как сокеты, так и события, не связанные с сокетами.</span><span class="sxs-lookup"><span data-stu-id="acc6b-111">This is especially useful if the thread needs to wait on both socket and nonsocket events.</span></span>

## <a name="polling-for-completion-indication"></a><span data-ttu-id="acc6b-112">Опрос по индикатору завершения</span><span class="sxs-lookup"><span data-stu-id="acc6b-112">Polling for Completion Indication</span></span>

<span data-ttu-id="acc6b-113">Приложения, которые предпочитает не блокировать блокировку, могут использовать функцию [**всажетоверлаппедресулт**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetoverlappedresult) для опроса состояния завершения, связанного с конкретным объектом события.</span><span class="sxs-lookup"><span data-stu-id="acc6b-113">Applications that prefer not to block can use the [**WSAGetOverlappedResult**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetoverlappedresult) function to poll for the completion status associated with any particular event object.</span></span> <span data-ttu-id="acc6b-114">Эта функция указывает, завершена ли операция перекрытия, и, если она завершена, упорядочивает функцию [**всажетластеррор**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror) для получения состояния ошибки перекрывающейся операции.</span><span class="sxs-lookup"><span data-stu-id="acc6b-114">This function indicates whether or not the overlapped operation has completed, and if completed, arranges for the [**WSAGetLastError**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror) function to retrieve the error status of the overlapped operation.</span></span>

## <a name="using-socket-io-completion-routines"></a><span data-ttu-id="acc6b-115">Использование подпрограмм завершения ввода-вывода сокета</span><span class="sxs-lookup"><span data-stu-id="acc6b-115">Using Socket I/O Completion Routines</span></span>

<span data-ttu-id="acc6b-116">Функции, используемые для инициирования перекрывающихся операций ввода-вывода ( [**всасенд**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend), [**всасендто**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto), [**всарекв**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv), [**всареквфром**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom)), принимают *лпкомплетионраутине* в качестве необязательного входного параметра.</span><span class="sxs-lookup"><span data-stu-id="acc6b-116">The functions used to initiate overlapped I/O ( [**WSASend**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend), [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto), [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv), [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom)) all take *lpCompletionRoutine* as an optional input parameter.</span></span> <span data-ttu-id="acc6b-117">Это указатель на функцию для конкретного приложения, которая вызывается после успешного завершения успешно инициированной операции перекрывающегося ввода-вывода (успешно или иным образом).</span><span class="sxs-lookup"><span data-stu-id="acc6b-117">This is a pointer to an application-specific function that is called after a successfully initiated overlapped I/O operation completes (successfully or otherwise).</span></span> <span data-ttu-id="acc6b-118">В подпрограммы завершения следуют те же правила, что и для подпрограмм завершения файлового ввода-вывода Windows.</span><span class="sxs-lookup"><span data-stu-id="acc6b-118">The completion routine follows the same rules as stipulated for Windows file I/O completion routines.</span></span> <span data-ttu-id="acc6b-119">Это значит, что подсистема завершения не вызывается до тех пор, пока поток не пойдет в состояние ожидания с предупреждением, например при вызове функции [**всаваитформултипливентс**](/windows/desktop/api/Winsock2/nf-winsock2-wsawaitformultipleevents) с `fAlertable` установленным флагом.</span><span class="sxs-lookup"><span data-stu-id="acc6b-119">That is, the completion routine is not invoked until the thread is in an alertable wait state, such as when the function [**WSAWaitForMultipleEvents**](/windows/desktop/api/Winsock2/nf-winsock2-wsawaitformultipleevents) is invoked with the `fAlertable` flag set.</span></span> <span data-ttu-id="acc6b-120">Приложение, использующее параметр подпрограммы завершения для определенного перекрывающегося запроса ввода-вывода, может не использовать параметр wait параметра [**всажетоверлаппедресулт**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetoverlappedresult) для этого же перекрывающегося запроса ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="acc6b-120">An application that uses the completion routine option for a particular overlapped I/O request may not use the wait option of [**WSAGetOverlappedResult**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetoverlappedresult) for that same overlapped I/O request.</span></span>

<span data-ttu-id="acc6b-121">Транспорты позволяют приложению вызывать операции Send и Receive из контекста подпрограммы завершения ввода-вывода сокета и гарантируют, что для конкретного сокета подпрограммы завершения ввода-вывода не будут вложены.</span><span class="sxs-lookup"><span data-stu-id="acc6b-121">The transports allow an application to invoke send and receive operations from within the context of the socket I/O completion routine and guarantee that, for a given socket, I/O completion routines will not be nested.</span></span> <span data-ttu-id="acc6b-122">Это позволяет полностью выполнять передачу данных с учетом времени в контексте с вытеснением.</span><span class="sxs-lookup"><span data-stu-id="acc6b-122">This permits time-sensitive data transmissions to occur entirely within a preemptive context.</span></span>

## <a name="summary-of-overlapped-completion-indication-mechanisms"></a><span data-ttu-id="acc6b-123">Сводка механизмов индикации завершения с перекрытием</span><span class="sxs-lookup"><span data-stu-id="acc6b-123">Summary of Overlapped Completion Indication Mechanisms</span></span>

<span data-ttu-id="acc6b-124">Определенное перекрытое указание завершения ввода-вывода, используемое для данной операции перекрытия, определяется тем, предоставляет ли приложение указатель на функцию завершения, является ли ссылка на структуру [**всаоверлаппед**](/windows/desktop/api/Winsock2/ns-winsock2-wsaoverlapped) , а также значение элемента **Хевент** в структуре **всаоверлаппед** (если оно предоставлено).</span><span class="sxs-lookup"><span data-stu-id="acc6b-124">The particular overlapped I/O completion indication to be used for a given overlapped operation is determined by whether the application supplies a pointer to a completion function, whether a [**WSAOVERLAPPED**](/windows/desktop/api/Winsock2/ns-winsock2-wsaoverlapped) structure is referenced, and by the value of the **hEvent** member within the **WSAOVERLAPPED** structure (if supplied).</span></span> <span data-ttu-id="acc6b-125">В следующей таблице приведена сводка семантики завершения для перекрывающихся сокетов и показаны различные сочетания *лповерлаппед*, **Хевент** и *лпкомплетионраутине*:</span><span class="sxs-lookup"><span data-stu-id="acc6b-125">The following table summarizes the completion semantics for an overlapped socket and shows the various combinations of *lpOverlapped*, **hEvent**, and *lpCompletionRoutine*:</span></span>

| <span data-ttu-id="acc6b-126">*лповерлаппед*</span><span class="sxs-lookup"><span data-stu-id="acc6b-126">*lpOverlapped*</span></span> | <span data-ttu-id="acc6b-127">хевент</span><span class="sxs-lookup"><span data-stu-id="acc6b-127">hEvent</span></span>         | <span data-ttu-id="acc6b-128">*лпкомплетионраутине*</span><span class="sxs-lookup"><span data-stu-id="acc6b-128">*lpCompletionRoutine*</span></span> | <span data-ttu-id="acc6b-129">Индикатор завершения</span><span class="sxs-lookup"><span data-stu-id="acc6b-129">Completion indication</span></span>                                                                                                                                                                                                    |
|----------------|----------------|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="acc6b-130">NULL</span><span class="sxs-lookup"><span data-stu-id="acc6b-130">NULL</span></span>           | <span data-ttu-id="acc6b-131">Неприменимо</span><span class="sxs-lookup"><span data-stu-id="acc6b-131">Not applicable</span></span> | <span data-ttu-id="acc6b-132">Не учитывается</span><span class="sxs-lookup"><span data-stu-id="acc6b-132">Ignored</span></span>               | <span data-ttu-id="acc6b-133">Операция завершается синхронно.</span><span class="sxs-lookup"><span data-stu-id="acc6b-133">Operation completes synchronously.</span></span> <span data-ttu-id="acc6b-134">Он ведет себя так, как если бы он был ноноверлаппед сокетом.</span><span class="sxs-lookup"><span data-stu-id="acc6b-134">It behaves as if it were a nonoverlapped socket.</span></span>                                                                                                                                      |
| <span data-ttu-id="acc6b-135">! ЗАКАНЧИВАЮЩ</span><span class="sxs-lookup"><span data-stu-id="acc6b-135">!NULL</span></span>          | <span data-ttu-id="acc6b-136">NULL</span><span class="sxs-lookup"><span data-stu-id="acc6b-136">NULL</span></span>           | <span data-ttu-id="acc6b-137">NULL</span><span class="sxs-lookup"><span data-stu-id="acc6b-137">NULL</span></span>                  | <span data-ttu-id="acc6b-138">Операция завершается перекрытием, но механизм завершения, поддерживаемый Windows Sockets 2, отсутствует.</span><span class="sxs-lookup"><span data-stu-id="acc6b-138">Operation completes overlapped, but there is no Windows Sockets 2-supported completion mechanism.</span></span> <span data-ttu-id="acc6b-139">В этом случае можно использовать механизм порта завершения (если поддерживается).</span><span class="sxs-lookup"><span data-stu-id="acc6b-139">The completion port mechanism (if supported) can be used in this case.</span></span> <span data-ttu-id="acc6b-140">В противном случае уведомление о завершении отсутствует.</span><span class="sxs-lookup"><span data-stu-id="acc6b-140">Otherwise, there is no completion notification.</span></span> |
| <span data-ttu-id="acc6b-141">! ЗАКАНЧИВАЮЩ</span><span class="sxs-lookup"><span data-stu-id="acc6b-141">!NULL</span></span>          | <span data-ttu-id="acc6b-142">! ЗАКАНЧИВАЮЩ</span><span class="sxs-lookup"><span data-stu-id="acc6b-142">!NULL</span></span>          | <span data-ttu-id="acc6b-143">NULL</span><span class="sxs-lookup"><span data-stu-id="acc6b-143">NULL</span></span>                  | <span data-ttu-id="acc6b-144">Операция завершает перекрытие, уведомление по сигнальному объекту события.</span><span class="sxs-lookup"><span data-stu-id="acc6b-144">Operation completes overlapped, notification by signaling event object.</span></span>                                                                                                                                                  |
| <span data-ttu-id="acc6b-145">! ЗАКАНЧИВАЮЩ</span><span class="sxs-lookup"><span data-stu-id="acc6b-145">!NULL</span></span>          | <span data-ttu-id="acc6b-146">Не учитывается</span><span class="sxs-lookup"><span data-stu-id="acc6b-146">Ignored</span></span>        | <span data-ttu-id="acc6b-147">! ЗАКАНЧИВАЮЩ</span><span class="sxs-lookup"><span data-stu-id="acc6b-147">!NULL</span></span>                 | <span data-ttu-id="acc6b-148">Операция завершает перекрытие, уведомление по плану завершения.</span><span class="sxs-lookup"><span data-stu-id="acc6b-148">Operation completes overlapped, notification by scheduling completion routine.</span></span>                                                                                                                                           |



 

 

 
