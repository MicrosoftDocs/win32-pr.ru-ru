---
description: NLA может предоставлять своим клиентам уведомления об изменениях сетевого расположения. Механизм, используемый для запроса уведомлений о событиях изменения, представляет собой сочетание функций Всалукупсервицебегин, Всанспиоктл и Всалукупсервиценекст.
ms.assetid: fed5a90d-0bc5-46e7-b3d3-edc4b303d305
title: Уведомление от NLA
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 13ee0ad0530725db27c8f5df39b6fc573f7e97c4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104541527"
---
# <a name="notification-from-nla"></a><span data-ttu-id="9ac80-104">Уведомление от NLA</span><span class="sxs-lookup"><span data-stu-id="9ac80-104">Notification from NLA</span></span>

<span data-ttu-id="9ac80-105">NLA может предоставлять своим клиентам уведомления об изменениях сетевого расположения.</span><span class="sxs-lookup"><span data-stu-id="9ac80-105">NLA is capable of providing its clients with notification of network location changes.</span></span> <span data-ttu-id="9ac80-106">Механизм, используемый для запроса уведомлений о событиях изменения, представляет собой сочетание функций [**всалукупсервицебегин**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina), [**всанспиоктл**](/windows/desktop/api/Winsock2/nf-winsock2-wsanspioctl)и [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) .</span><span class="sxs-lookup"><span data-stu-id="9ac80-106">The mechanism used to request notification of change events is a combination of the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina), [**WSANSPIoctl**](/windows/desktop/api/Winsock2/nf-winsock2-wsanspioctl), and [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) functions.</span></span>

<span data-ttu-id="9ac80-107">Чтобы получать уведомления об изменениях от NLA, клиент должен сначала вызвать [**всалукупсервицебегин**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) , чтобы получить допустимый маркер поиска SP в NLA.</span><span class="sxs-lookup"><span data-stu-id="9ac80-107">In order to receive change notification from NLA, a client must first call the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) to obtain a valid NLA SP lookup handle.</span></span> <span data-ttu-id="9ac80-108">Затем клиент может вызвать [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) или [**всанспиоктл**](/windows/desktop/api/Winsock2/nf-winsock2-wsanspioctl) в любом порядке. чтобы зарегистрироваться для получения уведомлений, вызовите функцию **всанспиоктл** с \_ \_ контрольным кодом SIO NSP notify, \_ заданным в параметре *двконтролкоде* .</span><span class="sxs-lookup"><span data-stu-id="9ac80-108">Next, the client can call [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) or [**WSANSPIoctl**](/windows/desktop/api/Winsock2/nf-winsock2-wsanspioctl) in any order; to register for notification, call the **WSANSPIoctl** function with the SIO\_NSP\_NOTIFY\_CHANGE control code set in the *dwControlCode* parameter.</span></span>

<span data-ttu-id="9ac80-109">Функция [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) возвращает WSA \_ E в \_ \_ качестве разделителя множеств.</span><span class="sxs-lookup"><span data-stu-id="9ac80-109">The [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) function returns WSA\_E\_NO\_MORE as a set delimiter.</span></span> <span data-ttu-id="9ac80-110">Если клиент зарегистрировался для уведомления с помощью функции [**всанспиоктл**](/windows/desktop/api/Winsock2/nf-winsock2-wsanspioctl) , а **ВСАЛУКУПСЕРВИЦЕНЕКСТ** возвращает значение \_ WSA \_ E \_ , вызов **всалукупсервиценекст** снова показывает, произошло ли изменение:</span><span class="sxs-lookup"><span data-stu-id="9ac80-110">When a client has registered for notification using the [**WSANSPIoctl**](/windows/desktop/api/Winsock2/nf-winsock2-wsanspioctl) function and **WSALookupServiceNext** returns WSA\_E\_NO\_MORE, calling **WSALookupServiceNext** again reveals whether a change has occurred:</span></span>

-   <span data-ttu-id="9ac80-111">Если изменения не происходили с момента предыдущего WSA \_ \_ , то \_ WSA e больше \_ не \_ \_ возвращается.</span><span class="sxs-lookup"><span data-stu-id="9ac80-111">If no changes have occurred since the previous WSA\_E\_NO\_MORE, WSA\_E\_NO\_MORE is returned.</span></span>
-   <span data-ttu-id="9ac80-112">Если произошло изменение или произошло изменение и выполняется вызов опроса, вызов функции [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) возвращает сети в виде структур [**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) с одним из следующих флагов, заданных в элементе **дваутпутфлагс** :</span><span class="sxs-lookup"><span data-stu-id="9ac80-112">If a change has occurred, or if a change has occurred and a polling call is made, the [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) function call returns networks as [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) structures, with one of the following flags set in its **dwOutputFlags** member:</span></span>

    <dl> <span data-ttu-id="9ac80-113">Результат \_ \_ добавлен</span><span class="sxs-lookup"><span data-stu-id="9ac80-113">RESULT\_IS\_ADDED</span></span>  
    <span data-ttu-id="9ac80-114">Результат \_ \_ изменен</span><span class="sxs-lookup"><span data-stu-id="9ac80-114">RESULT\_IS\_CHANGED</span></span>  
    <span data-ttu-id="9ac80-115">Результат \_ \_ удален</span><span class="sxs-lookup"><span data-stu-id="9ac80-115">RESULT\_IS\_DELETED</span></span>  
    </dl>

<span data-ttu-id="9ac80-116">Уведомление об изменении предоставляется для всех полей, измененных с момента получения маркера поиска NLA с помощью вызова функции [**всалукупсервицебегин**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) , или с момента последнего перечисления, которое привело к \_ \_ \_ ошибке WSA E.</span><span class="sxs-lookup"><span data-stu-id="9ac80-116">Change notification is provided for any fields that changed since the NLA lookup handle was obtained with the [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina) function call, or since the last enumeration that resulted in the WSA\_E\_NO\_MORE error.</span></span> <span data-ttu-id="9ac80-117">Когда предоставляются все измененные сведения о сетевом расположении, WSA \_ E больше \_ не \_ возвращается.</span><span class="sxs-lookup"><span data-stu-id="9ac80-117">When all changed network location information is provided, WSA\_E\_NO\_MORE is returned.</span></span> <span data-ttu-id="9ac80-118">Клиенты могут в любой момент повторно выдавать вызов функции [**всанспиоктл**](/windows/desktop/api/Winsock2/nf-winsock2-wsanspioctl) для одного и того же обработчика запроса, по одному, с \_ \_ \_ установленным флагом изменения уведомления SIO NSP.</span><span class="sxs-lookup"><span data-stu-id="9ac80-118">Clients can reissue a [**WSANSPIoctl**](/windows/desktop/api/Winsock2/nf-winsock2-wsanspioctl) function call on the same query handle at any time, one at a time, with the SIO\_NSP\_NOTIFY\_CHANGE flag set.</span></span> <span data-ttu-id="9ac80-119">Эта возможность позволяет клиенту перезапускать обработчик запросов на постоянной основе, тем самым освобождая разработчика клиенту от необходимости поддерживать информацию о состоянии изменений самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="9ac80-119">This capability enables a client to recycle the query handle on an ongoing basis, thereby relieving the client from having to maintain change-state information on its own.</span></span> <span data-ttu-id="9ac80-120">Когда клиенту больше не требуются уведомления об изменениях, он должен закрыть обработчик запроса с помощью функции [**всалукупсервицеенд**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupserviceend) .</span><span class="sxs-lookup"><span data-stu-id="9ac80-120">Once a client no longer needs change notifications, it should close the query handle using the [**WSALookupServiceEnd**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupserviceend) function.</span></span>

 

 



