---
description: Основы протоколов Всплистен, Вспакцепт и Вспконнект для установления подключения через сокет к сокетам Windows (Winsock).
ms.assetid: b1b4d6b9-36db-4000-9c6b-662765b6d091
title: 'Основные сведения об протоколе: прослушивание, подключение, принятие'
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d62ef290d71e571154b4d022c24c7e21f8fffa1c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104144977"
---
# <a name="protocol-basics-listen-connect-accept"></a><span data-ttu-id="a11bf-103">Основные сведения об протоколе: прослушивание, подключение, принятие</span><span class="sxs-lookup"><span data-stu-id="a11bf-103">Protocol Basics: Listen, Connect, Accept</span></span>

<span data-ttu-id="a11bf-104">Основные операции, связанные с установлением подключения к сокету, могут быть наиболее подробно описаны в плане клиент-серверной концепции.</span><span class="sxs-lookup"><span data-stu-id="a11bf-104">The basic operations involved with establishing a socket connection can be most conveniently explained in terms of the client-server paradigm.</span></span>

<span data-ttu-id="a11bf-105">На стороне сервера сначала создается сокет, привязывается к хорошо известному локальному адресу (чтобы клиент мог его найти) и переведите сокет в режим прослушивания через [**всплистен**](/previous-versions/windows/hardware/network/ff566297(v=vs.85)), чтобы подготовиться к любому входящему запросу подключения и указать длину очереди невыполненной работы подключения.</span><span class="sxs-lookup"><span data-stu-id="a11bf-105">The server side will first create a socket, bind it to a well known local address (so that the client can find it), and put the socket in listening mode, through [**WSPListen**](/previous-versions/windows/hardware/network/ff566297(v=vs.85)), in order to prepare for any incoming connection requests and to specify the length of the connection backlog queue.</span></span> <span data-ttu-id="a11bf-106">Поставщики услуг хранят ожидающие запросы на подключение в очереди невыполненной работы до тех пор, пока клиент не закончит работу с сервером или не будет отозван (из-за истечения времени ожидания).</span><span class="sxs-lookup"><span data-stu-id="a11bf-106">Service providers hold pending connection requests in a backlog queue until they are acted upon by the server or are withdrawn (due to a time-out) by the client.</span></span> <span data-ttu-id="a11bf-107">Поставщик услуг может без вмешательства пользователя игнорировать запросы на увеличение размера очереди невыполненной работы за пределы заданного поставщиком верхнего предела.</span><span class="sxs-lookup"><span data-stu-id="a11bf-107">A service provider may silently ignore requests to extend the size of the backlog queue beyond a provider-defined upper limit.</span></span>

<span data-ttu-id="a11bf-108">На этом этапе, если используется Блокирующий сокет, серверная часть может немедленно вызвать [**вспакцепт**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept) , который будет заблокирован, пока запрос на подключение не будет завершен.</span><span class="sxs-lookup"><span data-stu-id="a11bf-108">At this point, if a blocking socket is being used, the server side may immediately call [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept) which will block until a connection request is pending.</span></span> <span data-ttu-id="a11bf-109">И наоборот, сервер может также использовать один из описанных выше механизмов сетевых индикаторов событий для упорядочения уведомлений о входящих запросах на подключение.</span><span class="sxs-lookup"><span data-stu-id="a11bf-109">Conversely, the server may also use one of the network event indication mechanisms discussed previously to arrange for notification of incoming connection requests.</span></span> <span data-ttu-id="a11bf-110">В зависимости от выбранного механизма уведомления поставщик либо выдает сообщение Windows, либо сообщает объекту события о появлении запросов на подключение.</span><span class="sxs-lookup"><span data-stu-id="a11bf-110">Depending on the notification mechanism selected, the provider will either issue a Windows message or signal an event object when connection requests arrive.</span></span> <span data-ttu-id="a11bf-111">См. раздел [уведомление о событиях сети](notification-of-network-events-2.md) , чтобы узнать, как выполнить регистрацию для события «демон по \_ допуску».</span><span class="sxs-lookup"><span data-stu-id="a11bf-111">See [Notification of Network Events](notification-of-network-events-2.md) for how to register for the FD\_ACCEPT network event.</span></span>

<span data-ttu-id="a11bf-112">На стороне клиента будет создан соответствующий сокет и инициировано подключение путем вызова [**вспконнект**](/previous-versions/windows/hardware/network/ff566275(v=vs.85))с указанием известного адреса сервера.</span><span class="sxs-lookup"><span data-stu-id="a11bf-112">The client side will create an appropriate socket, and initiate the connection by calling [**WSPConnect**](/previous-versions/windows/hardware/network/ff566275(v=vs.85)), specifying the known server address.</span></span> <span data-ttu-id="a11bf-113">Обычно клиенты не выполняют явную операцию [**привязки**](/windows/desktop/api/winsock/nf-winsock-bind) перед инициализацией соединения, позволяя поставщику служб выполнять неявную привязку от своего имени.</span><span class="sxs-lookup"><span data-stu-id="a11bf-113">Clients usually do not perform an explicit [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) operation prior to initiating a connection, allowing the service provider to perform an implicit bind on their behalf.</span></span> <span data-ttu-id="a11bf-114">Если сокет находится в блокирующем режиме, **вспконнект** будет блокироваться до тех пор, пока сервер не получит запрос на соединение (или пока не истечет время ожидания).</span><span class="sxs-lookup"><span data-stu-id="a11bf-114">If the socket is in blocking mode, **WSPConnect** will block until the server has received and acted upon the connection request (or until a time-out occurs).</span></span> <span data-ttu-id="a11bf-115">В противном случае клиент должен использовать один из описанных выше механизмов сетевого обозначения событий для упорядочения уведомления о новом установленном подключении.</span><span class="sxs-lookup"><span data-stu-id="a11bf-115">Otherwise, the client should use one of the network event indication mechanisms discussed previously to arrange for notification of a new connection being established.</span></span> <span data-ttu-id="a11bf-116">В зависимости от выбранного механизма уведомления поставщик будет указывать это либо через сообщение Windows, либо с помощью сигнализации объекта события.</span><span class="sxs-lookup"><span data-stu-id="a11bf-116">Depending on the notification mechanism selected, the provider will indicate this either through a Windows message or by signaling an event object.</span></span>

<span data-ttu-id="a11bf-117">Когда сервер вызывает [**вспакцепт**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept), поставщик услуг вызывает функцию, предоставляемую приложением, используя параметры функции для передачи сведений о сервере из верхней записи в очереди невыполненной работы запроса на подключение.</span><span class="sxs-lookup"><span data-stu-id="a11bf-117">When the server side invokes [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept), the service provider calls the application-supplied condition function, using function parameters to pass into the server information from the top entry in the connection request backlog queue.</span></span> <span data-ttu-id="a11bf-118">Эти сведения включают в себя адрес узла подключения, любые доступные данные пользователя и любые доступные сведения о QoS.</span><span class="sxs-lookup"><span data-stu-id="a11bf-118">This information includes such things as address of connecting host, any available user data, and any available QoS information.</span></span> <span data-ttu-id="a11bf-119">Используя эти сведения, функция условия сервера определяет, следует ли принять запрос, отклонить запрос или отложить принятие решения до последующего.</span><span class="sxs-lookup"><span data-stu-id="a11bf-119">Using this information the server's condition function determines whether to accept the request, reject the request, or defer making a decision until later.</span></span> <span data-ttu-id="a11bf-120">Это решение указывается с помощью возвращаемого значения функции Condition.</span><span class="sxs-lookup"><span data-stu-id="a11bf-120">This decision is indicated through the return value of the condition function.</span></span> <span data-ttu-id="a11bf-121">См. раздел [уведомление о событиях сети](notification-of-network-events-2.md) , чтобы узнать, как выполнить регистрацию для события демона \_ подключения к сети.</span><span class="sxs-lookup"><span data-stu-id="a11bf-121">See [Notification of Network Events](notification-of-network-events-2.md) for how to register for the FD\_CONNECT network event.</span></span>

<span data-ttu-id="a11bf-122">Если сервер принимает решение принять запрос, поставщик должен создать новый сокет со всеми теми же атрибутами и регистрациями событий, что и у прослушивающего сокета.</span><span class="sxs-lookup"><span data-stu-id="a11bf-122">If the server decides to accept the request, the provider must create a new socket with all of the same attributes and event registrations as the listening socket.</span></span> <span data-ttu-id="a11bf-123">Исходный сокет остается в состоянии прослушивания, поэтому могут быть получены последующие запросы на подключение.</span><span class="sxs-lookup"><span data-stu-id="a11bf-123">The original socket remains in the listening state so that subsequent connection requests can be received.</span></span> <span data-ttu-id="a11bf-124">С помощью выходных параметров функции условия сервер может также предоставлять любые данные пользователя ответа и назначать параметры QoS (при условии, что эти операции поддерживаются поставщиком услуг).</span><span class="sxs-lookup"><span data-stu-id="a11bf-124">Through output parameters of the condition function, the server may also supply any response user data and assign QoS parameters (assuming that these operations are supported by the service provider).</span></span>

 

 
