---
description: Структуры данных разрешения имен в сокетах Windows (Winsock).
ms.assetid: 87c54141-41e2-4eaa-ae3b-84598e8281d9
title: Структуры данных разрешения имен
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bf1f76607ade81503a1057dc21890ac38d5ec265
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104569526"
---
# <a name="name-resolution-data-structures"></a>Структуры данных разрешения имен

Существует несколько важных структур данных, которые широко используются во всех функциях разрешения имен.

## <a name="query-related-data-structures"></a>Query-Related структуры данных

Структура [**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) используется для формирования запросов к [**всалукупсервицебегин**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina)и используется для доставки результатов запроса [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta). Это сложная структура, так как она содержит указатели на несколько других структур, некоторые из которых ссылаются еще на другие структуры. Связь между структурой [**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) и структурами, на которые она ссылается, показана ниже.

![отношение между всакуерисет и связанными с ним структурами](images/ovrvw3-2.png)

В структуре [**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) большинство участников говорят сами за себя, но некоторые заслуживают дополнительного объяснения. Элемент **двсизе** всегда должен быть заполнен с помощью sizeof (**всакуерисет**), так как он используется поставщиками пространств имен для обнаружения и адаптации к различным версиям структуры **всакуерисет** , которые могут отображаться с течением времени.

Элемент **дваутпутфлагс** используется поставщиком пространства имен для предоставления дополнительных сведений о результатах запроса. Дополнительные сведения см. в описании функции [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) .

Структура [**всаекомпаратор**](/windows/desktop/api/Winsock2/ne-winsock2-wsaecomparator) , на которую ссылается элемент **лпверсион** , используется как для ограничения запроса, так и для результатов. Для запросов элемент **двверсион** указывает требуемую версию службы. Элемент **ечов** является перечислимым типом, который указывает, как можно выполнить сравнение. Возможные варианты: COMP \_ Equals, для которых требуется точное совпадение в версии, или Comp \_ нотлесс, которая указывает, что номер версии службы не должен быть меньше значения элемента **двверсион** .

Интерпретация **двнамеспаце** и **лпнспровидерид** зависит от того, как используется структура и описывается далее в отдельных описаниях функций, использующих эту структуру.

Элемент **лпсзконтекст** применяется к иерархическим пространствам имен и задает начальную точку запроса или расположение в иерархии, где находится служба. Общие правила

-   Значение **null**, пустое ("") запускает поиск в контексте по умолчанию.
-   Значение " \\ " запускает поиск в верхней части пространства имен.
-   Любое другое значение начинает поиск с указанной точки.

Поставщики, не поддерживающие включение, могут возвращать ошибку, если указано любое значение, отличное от "" или " \\ ". Поставщики, поддерживающие ограниченное включение, например группы, должны принимать "", " \\ " или определенную точку. Контексты зависят от пространства имен. Если элемент **двнамеспаце** имеет значение NS \_ ALL, то в качестве контекста следует передавать только "" или " \\ ", так как они распознаются всеми пространствами имен.

Элемент **лпсзкуеристринг** используется для предоставления дополнительных сведений о запросе, относящихся к пространству имен, таких как строка, описывающая известное имя службы и транспортного протокола, например "FTP/TCP".

Структура [**афпротоколс**](/windows/desktop/api/Winsock2/ns-winsock2-afprotocols) , на которую ссылается элемент **лпафппротоколс** , используется только для запросов и предоставляет список протоколов для ограничения запроса. Эти протоколы представляются парами (семейство адресов, протокол), поскольку значения протокола имеют только значение в контексте семейства адресов.

Массив структуры [**\_ сведений о ксаддр**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) , на который ссылается элемент **лпксабуффер** , содержит всю информацию, необходимую службе для использования при установлении прослушивания, или для клиента, используемого для установления соединения со службой. Члены **локаладдр** и **ремотеаддр** непосредственно содержат структуру [**\_ адресов сокетов**](/windows/desktop/api/Ws2def/ns-ws2def-socket_address) .

Служба создает сокет, вызывая функцию [**Socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) или [**всасоккет**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) , используя кортеж из *\_ семейства локаладдр. лпсоккаддр->SA*, *исоккеттипе* и *ипротокол* в качестве параметров. Служба привязывает сокет к локальному адресу, вызывая функцию [**BIND**](/windows/desktop/api/winsock/nf-winsock-bind) , используя *локаладдр. лпсоккаддр* и *локаладдр. лпсоккаддрленгс* в качестве параметров.

Клиент создает сокет, вызывая функцию [**Socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) или [**всасоккет**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) , используя кортеж из *\_ семейства локаладдр. лпсоккаддр->SA*, *исоккеттипе* и *ипротокол* в качестве параметров. Клиент использует сочетание *ремотеаддр. лпсоккаддр* и *ремотеаддр. лпсоккаддрленгс* в качестве параметров при создании удаленного подключения с помощью функции [**Connect**](/windows/desktop/api/Winsock2/nf-winsock2-connect), [**коннектекс**](/windows/desktop/api/Mswsock/nc-mswsock-lpfn_connectex)или [**всаконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) .

## <a name="service-class-data-structures"></a>Структуры данных класса службы

При установке нового класса службы необходимо подготовить и предоставить структуру [**всасервицеклассинфо**](/windows/desktop/api/Winsock2/ns-winsock2-wsaserviceclassinfow) . Эта структура также состоит из подструктур, содержащих ряд членов, которые применяются к конкретным пространствам имен. Структура данных класса info выглядит следующим образом:

![архитектура структур данных класса службы](images/ovrvw3-3.png)

Для каждого класса службы существует одна структура [**всасервицеклассинфо**](/windows/desktop/api/Winsock2/ns-winsock2-wsaserviceclassinfow) . В структуре [**всасервицеклассинфо**](/windows/desktop/api/Winsock2/ns-winsock2-wsaserviceclassinfow) уникальный идентификатор класса службы содержится в члене **лпсервицеклассид** , а связанная отображаемая строка ссылается на элемент **лпсервицекласснаме** . Это строка, возвращаемая функцией [**всажетсервицекласснамебиклассид**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetserviceclassnamebyclassida) .

Элемент **лпклассинфос** в структуре [**всасервицеклассинфо**](/windows/desktop/api/Winsock2/ns-winsock2-wsaserviceclassinfow) ссылается на массив структур **всансклассинфо** , каждый из которых предоставляет именованный и типизированный член, который применяется к указанному пространству имен. Примеры значений для элемента **лпсзнаме** : "SAPID", "TcpPort", "удппорт" и т. д. Эти строки обычно относятся к пространству имен, определенному в элементе **двнамеспаце** . Типичными значениями для элемента **дввалуетипе** могут быть REG \_ DWORD, REG \_ SZ и т. д. Элемент **дввалуесизе** указывает длину элемента данных, на который указывает **лпвалуе**.

Вся коллекция данных, представленная в структуре **всасервицеклассинфо** , предоставляется каждому поставщику пространства имен при вызове функции [**всаинсталлсервицекласс**](/windows/desktop/api/Winsock2/nf-winsock2-wsainstallserviceclassa) . Затем каждый отдельный поставщик пространства имен сифтс через список структур **всансклассинфо** и оставляет сведения, применимые к нему.

## <a name="related-topics"></a>См. также

<dl> <dt>

[**афпротоколс**](/windows/desktop/api/Winsock2/ns-winsock2-afprotocols)
</dt> <dt>

[**\_сведения о ксаддр**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info)
</dt> <dt>

[Модель разрешения имен](name-resolution-model-2.md)
</dt> <dt>

[Разрешение имен, не зависящее от протокола](protocol-independent-name-resolution-2.md)
</dt> <dt>

[Регистрация и разрешение имен](registration-and-name-resolution-2.md)
</dt> <dt>

[**адрес СОКЕТа \_**](/windows/desktop/api/Ws2def/ns-ws2def-socket_address)
</dt> <dt>

[Общие сведения о функциях разрешения имен](summary-of-name-resolution-functions-2.md)
</dt> <dt>

[**всаекомпаратор**](/windows/desktop/api/Winsock2/ne-winsock2-wsaecomparator)
</dt> <dt>

[**всажетсервицекласснамебиклассид**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetserviceclassnamebyclassida)
</dt> <dt>

[**всаинсталлсервицекласс**](/windows/desktop/api/Winsock2/nf-winsock2-wsainstallserviceclassa)
</dt> <dt>

[**всалукупсервицебегин**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina)
</dt> <dt>

[**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw)
</dt> <dt>

[**всасервицеклассинфо**](/windows/desktop/api/Winsock2/ns-winsock2-wsaserviceclassinfow)
</dt> </dl>

 

 
