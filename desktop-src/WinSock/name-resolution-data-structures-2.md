---
description: Структуры данных разрешения имен в сокетах Windows (Winsock).
ms.assetid: 87c54141-41e2-4eaa-ae3b-84598e8281d9
title: Структуры данных разрешения имен
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bf1f76607ade81503a1057dc21890ac38d5ec265
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104569526"
---
# <a name="name-resolution-data-structures"></a><span data-ttu-id="2855c-103">Структуры данных разрешения имен</span><span class="sxs-lookup"><span data-stu-id="2855c-103">Name Resolution Data Structures</span></span>

<span data-ttu-id="2855c-104">Существует несколько важных структур данных, которые широко используются во всех функциях разрешения имен.</span><span class="sxs-lookup"><span data-stu-id="2855c-104">There are several important data structures that are used extensively throughout the name resolution functions.</span></span>

## <a name="query-related-data-structures"></a><span data-ttu-id="2855c-105">Query-Related структуры данных</span><span class="sxs-lookup"><span data-stu-id="2855c-105">Query-Related Data Structures</span></span>

<span data-ttu-id="2855c-106">Структура [**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) используется для формирования запросов к [**всалукупсервицебегин**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina)и используется для доставки результатов запроса [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta).</span><span class="sxs-lookup"><span data-stu-id="2855c-106">The [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) structure is used to form queries for [**WSALookupServiceBegin**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina), and used to deliver query results for [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta).</span></span> <span data-ttu-id="2855c-107">Это сложная структура, так как она содержит указатели на несколько других структур, некоторые из которых ссылаются еще на другие структуры.</span><span class="sxs-lookup"><span data-stu-id="2855c-107">It is a complex structure since it contains pointers to several other structures, some of which reference still other structures.</span></span> <span data-ttu-id="2855c-108">Связь между структурой [**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) и структурами, на которые она ссылается, показана ниже.</span><span class="sxs-lookup"><span data-stu-id="2855c-108">The relationship between the [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) structure and the structures it references is illustrated as follows.</span></span>

![отношение между всакуерисет и связанными с ним структурами](images/ovrvw3-2.png)

<span data-ttu-id="2855c-110">В структуре [**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) большинство участников говорят сами за себя, но некоторые заслуживают дополнительного объяснения.</span><span class="sxs-lookup"><span data-stu-id="2855c-110">Within the [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) structure, most of the member are self explanatory, but some deserve additional explanation.</span></span> <span data-ttu-id="2855c-111">Элемент **двсизе** всегда должен быть заполнен с помощью sizeof (**всакуерисет**), так как он используется поставщиками пространств имен для обнаружения и адаптации к различным версиям структуры **всакуерисет** , которые могут отображаться с течением времени.</span><span class="sxs-lookup"><span data-stu-id="2855c-111">The **dwSize** member must always be filled in with sizeof(**WSAQUERYSET**), as this is used by namespace providers to detect and adapt to different versions of the **WSAQUERYSET** structure that may appear over time.</span></span>

<span data-ttu-id="2855c-112">Элемент **дваутпутфлагс** используется поставщиком пространства имен для предоставления дополнительных сведений о результатах запроса.</span><span class="sxs-lookup"><span data-stu-id="2855c-112">The **dwOutputFlags** member is used by a namespace provider to provide additional information about query results.</span></span> <span data-ttu-id="2855c-113">Дополнительные сведения см. в описании функции [**всалукупсервиценекст**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) .</span><span class="sxs-lookup"><span data-stu-id="2855c-113">For details, see the [**WSALookupServiceNext**](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicenexta) function.</span></span>

<span data-ttu-id="2855c-114">Структура [**всаекомпаратор**](/windows/desktop/api/Winsock2/ne-winsock2-wsaecomparator) , на которую ссылается элемент **лпверсион** , используется как для ограничения запроса, так и для результатов.</span><span class="sxs-lookup"><span data-stu-id="2855c-114">The [**WSAECOMPARATOR**](/windows/desktop/api/Winsock2/ne-winsock2-wsaecomparator) structure referenced by the **lpversion** member is used for both query constraint and results.</span></span> <span data-ttu-id="2855c-115">Для запросов элемент **двверсион** указывает требуемую версию службы.</span><span class="sxs-lookup"><span data-stu-id="2855c-115">For queries, the **dwVersion** member indicates the desired version of the service.</span></span> <span data-ttu-id="2855c-116">Элемент **ечов** является перечислимым типом, который указывает, как можно выполнить сравнение.</span><span class="sxs-lookup"><span data-stu-id="2855c-116">The **ecHow** member is an enumerated type which specifies how the comparison can be made.</span></span> <span data-ttu-id="2855c-117">Возможные варианты: COMP \_ Equals, для которых требуется точное совпадение в версии, или Comp \_ нотлесс, которая указывает, что номер версии службы не должен быть меньше значения элемента **двверсион** .</span><span class="sxs-lookup"><span data-stu-id="2855c-117">The choices are COMP\_EQUALS which requires that an exact match in version occurs, or COMP\_NOTLESS which specifies that the service's version number be no less than the value of the **dwVersion** member.</span></span>

<span data-ttu-id="2855c-118">Интерпретация **двнамеспаце** и **лпнспровидерид** зависит от того, как используется структура и описывается далее в отдельных описаниях функций, использующих эту структуру.</span><span class="sxs-lookup"><span data-stu-id="2855c-118">The interpretation of **dwNameSpace** and **lpNSProviderId** depends upon how the structure is being used and is described further in the individual function descriptions that utilize this structure.</span></span>

<span data-ttu-id="2855c-119">Элемент **лпсзконтекст** применяется к иерархическим пространствам имен и задает начальную точку запроса или расположение в иерархии, где находится служба.</span><span class="sxs-lookup"><span data-stu-id="2855c-119">The **lpszContext** member applies to hierarchical namespaces, and specifies the starting point of a query or the location within the hierarchy where the service resides.</span></span> <span data-ttu-id="2855c-120">Общие правила</span><span class="sxs-lookup"><span data-stu-id="2855c-120">The general rules are:</span></span>

-   <span data-ttu-id="2855c-121">Значение **null**, пустое ("") запускает поиск в контексте по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="2855c-121">A value of **NULL**, blank ("") starts the search at the default context.</span></span>
-   <span data-ttu-id="2855c-122">Значение " \\ " запускает поиск в верхней части пространства имен.</span><span class="sxs-lookup"><span data-stu-id="2855c-122">A value of "\\" starts the search at the top of the namespace.</span></span>
-   <span data-ttu-id="2855c-123">Любое другое значение начинает поиск с указанной точки.</span><span class="sxs-lookup"><span data-stu-id="2855c-123">Any other value starts the search at the designated point.</span></span>

<span data-ttu-id="2855c-124">Поставщики, не поддерживающие включение, могут возвращать ошибку, если указано любое значение, отличное от "" или " \\ ".</span><span class="sxs-lookup"><span data-stu-id="2855c-124">Providers that do not support containment may return an error if anything other than "" or "\\" is specified.</span></span> <span data-ttu-id="2855c-125">Поставщики, поддерживающие ограниченное включение, например группы, должны принимать "", " \\ " или определенную точку.</span><span class="sxs-lookup"><span data-stu-id="2855c-125">Providers that support limited containment, such as groups, should accept "", '\\", or a designated point.</span></span> <span data-ttu-id="2855c-126">Контексты зависят от пространства имен.</span><span class="sxs-lookup"><span data-stu-id="2855c-126">Contexts are namespace specific.</span></span> <span data-ttu-id="2855c-127">Если элемент **двнамеспаце** имеет значение NS \_ ALL, то в качестве контекста следует передавать только "" или " \\ ", так как они распознаются всеми пространствами имен.</span><span class="sxs-lookup"><span data-stu-id="2855c-127">If the **dwNameSpace** member is NS\_ALL, then only "" or "\\" should be passed as the context since these are recognized by all namespaces.</span></span>

<span data-ttu-id="2855c-128">Элемент **лпсзкуеристринг** используется для предоставления дополнительных сведений о запросе, относящихся к пространству имен, таких как строка, описывающая известное имя службы и транспортного протокола, например "FTP/TCP".</span><span class="sxs-lookup"><span data-stu-id="2855c-128">The **lpszQueryString** member is used to supply additional, namespace-specific query information such as a string describing a well-known service and transport protocol name, as in "FTP/TCP".</span></span>

<span data-ttu-id="2855c-129">Структура [**афпротоколс**](/windows/desktop/api/Winsock2/ns-winsock2-afprotocols) , на которую ссылается элемент **лпафппротоколс** , используется только для запросов и предоставляет список протоколов для ограничения запроса.</span><span class="sxs-lookup"><span data-stu-id="2855c-129">The [**AFPROTOCOLS**](/windows/desktop/api/Winsock2/ns-winsock2-afprotocols) structure referenced by the **lpafpProtocols** member is used for query purposes only, and supplies a list of protocols to constrain the query.</span></span> <span data-ttu-id="2855c-130">Эти протоколы представляются парами (семейство адресов, протокол), поскольку значения протокола имеют только значение в контексте семейства адресов.</span><span class="sxs-lookup"><span data-stu-id="2855c-130">These protocols are represented as (address family, protocol) pairs, since protocol values only have meaning within the context of an address family.</span></span>

<span data-ttu-id="2855c-131">Массив структуры [**\_ сведений о ксаддр**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) , на который ссылается элемент **лпксабуффер** , содержит всю информацию, необходимую службе для использования при установлении прослушивания, или для клиента, используемого для установления соединения со службой.</span><span class="sxs-lookup"><span data-stu-id="2855c-131">The array of the [**CSADDR\_INFO**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) structure referenced by the **lpcsaBuffer** member contain all of the information needed for either a service to use in establishing a listen, or for a client to use in establishing a connection to the service.</span></span> <span data-ttu-id="2855c-132">Члены **локаладдр** и **ремотеаддр** непосредственно содержат структуру [**\_ адресов сокетов**](/windows/desktop/api/Ws2def/ns-ws2def-socket_address) .</span><span class="sxs-lookup"><span data-stu-id="2855c-132">The **LocalAddr** and **RemoteAddr** members both directly contain a [**SOCKET\_ADDRESS**](/windows/desktop/api/Ws2def/ns-ws2def-socket_address) structure.</span></span>

<span data-ttu-id="2855c-133">Служба создает сокет, вызывая функцию [**Socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) или [**всасоккет**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) , используя кортеж из *\_ семейства локаладдр. лпсоккаддр->SA*, *исоккеттипе* и *ипротокол* в качестве параметров.</span><span class="sxs-lookup"><span data-stu-id="2855c-133">A service would create a socket by calling the [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) or [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) function using the tuple of *LocalAddr.lpSockaddr->sa\_family*, *iSocketType*, and *iProtocol* as parameters.</span></span> <span data-ttu-id="2855c-134">Служба привязывает сокет к локальному адресу, вызывая функцию [**BIND**](/windows/desktop/api/winsock/nf-winsock-bind) , используя *локаладдр. лпсоккаддр* и *локаладдр. лпсоккаддрленгс* в качестве параметров.</span><span class="sxs-lookup"><span data-stu-id="2855c-134">A service would bind the socket to a local address by calling the [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) function using *LocalAddr.lpSockaddr* and *LocalAddr.lpSockaddrLength* as parameters.</span></span>

<span data-ttu-id="2855c-135">Клиент создает сокет, вызывая функцию [**Socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) или [**всасоккет**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) , используя кортеж из *\_ семейства локаладдр. лпсоккаддр->SA*, *исоккеттипе* и *ипротокол* в качестве параметров.</span><span class="sxs-lookup"><span data-stu-id="2855c-135">A client creates its socket by calling the [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) or [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) function using the tuple of *LocalAddr.lpSockaddr->sa\_family*, *iSocketType*, and *iProtocol* as parameters.</span></span> <span data-ttu-id="2855c-136">Клиент использует сочетание *ремотеаддр. лпсоккаддр* и *ремотеаддр. лпсоккаддрленгс* в качестве параметров при создании удаленного подключения с помощью функции [**Connect**](/windows/desktop/api/Winsock2/nf-winsock2-connect), [**коннектекс**](/windows/desktop/api/Mswsock/nc-mswsock-lpfn_connectex)или [**всаконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) .</span><span class="sxs-lookup"><span data-stu-id="2855c-136">A client uses the combination of *RemoteAddr.lpSockaddr* and *RemoteAddr.lpSockaddrLength* as parameters when making a remote connection using the [**connect**](/windows/desktop/api/Winsock2/nf-winsock2-connect), [**ConnectEx**](/windows/desktop/api/Mswsock/nc-mswsock-lpfn_connectex), or [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) function.</span></span>

## <a name="service-class-data-structures"></a><span data-ttu-id="2855c-137">Структуры данных класса службы</span><span class="sxs-lookup"><span data-stu-id="2855c-137">Service Class Data Structures</span></span>

<span data-ttu-id="2855c-138">При установке нового класса службы необходимо подготовить и предоставить структуру [**всасервицеклассинфо**](/windows/desktop/api/Winsock2/ns-winsock2-wsaserviceclassinfow) .</span><span class="sxs-lookup"><span data-stu-id="2855c-138">When a new service class is installed, a [**WSASERVICECLASSINFO**](/windows/desktop/api/Winsock2/ns-winsock2-wsaserviceclassinfow) structure must be prepared and supplied.</span></span> <span data-ttu-id="2855c-139">Эта структура также состоит из подструктур, содержащих ряд членов, которые применяются к конкретным пространствам имен.</span><span class="sxs-lookup"><span data-stu-id="2855c-139">This structure also consists of substructures that contain a series of members that apply to specific namespaces.</span></span> <span data-ttu-id="2855c-140">Структура данных класса info выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="2855c-140">A class info data structure is as follows:</span></span>

![архитектура структур данных класса службы](images/ovrvw3-3.png)

<span data-ttu-id="2855c-142">Для каждого класса службы существует одна структура [**всасервицеклассинфо**](/windows/desktop/api/Winsock2/ns-winsock2-wsaserviceclassinfow) .</span><span class="sxs-lookup"><span data-stu-id="2855c-142">For each service class, there is a single [**WSASERVICECLASSINFO**](/windows/desktop/api/Winsock2/ns-winsock2-wsaserviceclassinfow) structure.</span></span> <span data-ttu-id="2855c-143">В структуре [**всасервицеклассинфо**](/windows/desktop/api/Winsock2/ns-winsock2-wsaserviceclassinfow) уникальный идентификатор класса службы содержится в члене **лпсервицеклассид** , а связанная отображаемая строка ссылается на элемент **лпсервицекласснаме** .</span><span class="sxs-lookup"><span data-stu-id="2855c-143">Within the [**WSASERVICECLASSINFO**](/windows/desktop/api/Winsock2/ns-winsock2-wsaserviceclassinfow) structure, the service class' unique identifier is contained in the **lpServiceClassId** member, and an associated display string is referenced by the **lpServiceClassName** member.</span></span> <span data-ttu-id="2855c-144">Это строка, возвращаемая функцией [**всажетсервицекласснамебиклассид**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetserviceclassnamebyclassida) .</span><span class="sxs-lookup"><span data-stu-id="2855c-144">This is the string that is returned by the [**WSAGetServiceClassNameByClassId**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetserviceclassnamebyclassida) function.</span></span>

<span data-ttu-id="2855c-145">Элемент **лпклассинфос** в структуре [**всасервицеклассинфо**](/windows/desktop/api/Winsock2/ns-winsock2-wsaserviceclassinfow) ссылается на массив структур **всансклассинфо** , каждый из которых предоставляет именованный и типизированный член, который применяется к указанному пространству имен.</span><span class="sxs-lookup"><span data-stu-id="2855c-145">The **lpClassInfos** member in the [**WSASERVICECLASSINFO**](/windows/desktop/api/Winsock2/ns-winsock2-wsaserviceclassinfow) structure references an array of **WSANSCLASSINFO** structures, each of which supplies a named and typed member that applies to a specified namespace.</span></span> <span data-ttu-id="2855c-146">Примеры значений для элемента **лпсзнаме** : "SAPID", "TcpPort", "удппорт" и т. д. Эти строки обычно относятся к пространству имен, определенному в элементе **двнамеспаце** .</span><span class="sxs-lookup"><span data-stu-id="2855c-146">Examples of values for the **lpszName** member include: "SapId", "TcpPort", "UdpPort", etc. These strings are generally specific to the namespace identified in the **dwNameSpace** member.</span></span> <span data-ttu-id="2855c-147">Типичными значениями для элемента **дввалуетипе** могут быть REG \_ DWORD, REG \_ SZ и т. д. Элемент **дввалуесизе** указывает длину элемента данных, на который указывает **лпвалуе**.</span><span class="sxs-lookup"><span data-stu-id="2855c-147">Typical values for the **dwValueType** member might be REG\_DWORD, REG\_SZ, etc. The **dwValueSize** member indicates the length of the data item pointed to by **lpValue**.</span></span>

<span data-ttu-id="2855c-148">Вся коллекция данных, представленная в структуре **всасервицеклассинфо** , предоставляется каждому поставщику пространства имен при вызове функции [**всаинсталлсервицекласс**](/windows/desktop/api/Winsock2/nf-winsock2-wsainstallserviceclassa) .</span><span class="sxs-lookup"><span data-stu-id="2855c-148">The entire collection of data represented in a **WSASERVICECLASSINFO** structure is provided to each namespace provider when the [**WSAInstallServiceClass**](/windows/desktop/api/Winsock2/nf-winsock2-wsainstallserviceclassa) function is invoked.</span></span> <span data-ttu-id="2855c-149">Затем каждый отдельный поставщик пространства имен сифтс через список структур **всансклассинфо** и оставляет сведения, применимые к нему.</span><span class="sxs-lookup"><span data-stu-id="2855c-149">Each individual namespace provider then sifts through the list of **WSANSCLASSINFO** structures and retains the information applicable to it.</span></span>

## <a name="related-topics"></a><span data-ttu-id="2855c-150">См. также</span><span class="sxs-lookup"><span data-stu-id="2855c-150">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2855c-151">**афпротоколс**</span><span class="sxs-lookup"><span data-stu-id="2855c-151">**AFPROTOCOLS**</span></span>](/windows/desktop/api/Winsock2/ns-winsock2-afprotocols)
</dt> <dt>

[<span data-ttu-id="2855c-152">**\_сведения о ксаддр**</span><span class="sxs-lookup"><span data-stu-id="2855c-152">**CSADDR\_INFO**</span></span>](/windows/win32/api/ws2def/ns-ws2def-csaddr_info)
</dt> <dt>

[<span data-ttu-id="2855c-153">Модель разрешения имен</span><span class="sxs-lookup"><span data-stu-id="2855c-153">Name Resolution Model</span></span>](name-resolution-model-2.md)
</dt> <dt>

[<span data-ttu-id="2855c-154">Разрешение имен, не зависящее от протокола</span><span class="sxs-lookup"><span data-stu-id="2855c-154">Protocol-Independent Name Resolution</span></span>](protocol-independent-name-resolution-2.md)
</dt> <dt>

[<span data-ttu-id="2855c-155">Регистрация и разрешение имен</span><span class="sxs-lookup"><span data-stu-id="2855c-155">Registration and Name Resolution</span></span>](registration-and-name-resolution-2.md)
</dt> <dt>

[<span data-ttu-id="2855c-156">**адрес СОКЕТа \_**</span><span class="sxs-lookup"><span data-stu-id="2855c-156">**SOCKET\_ADDRESS**</span></span>](/windows/desktop/api/Ws2def/ns-ws2def-socket_address)
</dt> <dt>

[<span data-ttu-id="2855c-157">Общие сведения о функциях разрешения имен</span><span class="sxs-lookup"><span data-stu-id="2855c-157">Summary of Name Resolution Functions</span></span>](summary-of-name-resolution-functions-2.md)
</dt> <dt>

[<span data-ttu-id="2855c-158">**всаекомпаратор**</span><span class="sxs-lookup"><span data-stu-id="2855c-158">**WSAECOMPARATOR**</span></span>](/windows/desktop/api/Winsock2/ne-winsock2-wsaecomparator)
</dt> <dt>

[<span data-ttu-id="2855c-159">**всажетсервицекласснамебиклассид**</span><span class="sxs-lookup"><span data-stu-id="2855c-159">**WSAGetServiceClassNameByClassId**</span></span>](/windows/desktop/api/Winsock2/nf-winsock2-wsagetserviceclassnamebyclassida)
</dt> <dt>

[<span data-ttu-id="2855c-160">**всаинсталлсервицекласс**</span><span class="sxs-lookup"><span data-stu-id="2855c-160">**WSAInstallServiceClass**</span></span>](/windows/desktop/api/Winsock2/nf-winsock2-wsainstallserviceclassa)
</dt> <dt>

[<span data-ttu-id="2855c-161">**всалукупсервицебегин**</span><span class="sxs-lookup"><span data-stu-id="2855c-161">**WSALookupServiceBegin**</span></span>](/windows/desktop/api/Winsock2/nf-winsock2-wsalookupservicebegina)
</dt> <dt>

[<span data-ttu-id="2855c-162">**всакуерисет**</span><span class="sxs-lookup"><span data-stu-id="2855c-162">**WSAQUERYSET**</span></span>](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw)
</dt> <dt>

[<span data-ttu-id="2855c-163">**всасервицеклассинфо**</span><span class="sxs-lookup"><span data-stu-id="2855c-163">**WSASERVICECLASSINFO**</span></span>](/windows/desktop/api/Winsock2/ns-winsock2-wsaserviceclassinfow)
</dt> </dl>

 

 
