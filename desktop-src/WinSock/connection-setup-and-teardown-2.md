---
description: Функция Всаакцепт позволяет приложению получать сведения о вызывающем объекте, такие как идентификатор вызывающего объекта и качество обслуживания, прежде чем принимать решение о принятии входящего запроса на подключение.
ms.assetid: 65883556-6890-4d0a-8c7f-c4ff68642caf
title: Установка и уничтожение подключений
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f9c4ac1f32524d097e11825f8104eb41fee3c528
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692296"
---
# <a name="connection-setup-and-teardown"></a><span data-ttu-id="12cf8-103">Установка и уничтожение подключений</span><span class="sxs-lookup"><span data-stu-id="12cf8-103">Connection Setup and Teardown</span></span>

<span data-ttu-id="12cf8-104">Функция [**всаакцепт**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) позволяет приложению получать сведения о вызывающем объекте, такие как идентификатор вызывающего объекта и качество обслуживания, прежде чем принимать решение о принятии входящего запроса на подключение.</span><span class="sxs-lookup"><span data-stu-id="12cf8-104">The [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) function lets an application obtain caller information such as caller identifier and Quality of Service before deciding whether to accept an incoming connection request.</span></span> <span data-ttu-id="12cf8-105">Это делается с помощью обратного вызова к функции условия, предоставляемой приложением.</span><span class="sxs-lookup"><span data-stu-id="12cf8-105">This is done with a callback to an application-supplied condition function.</span></span>

<span data-ttu-id="12cf8-106">Данные пользователя на пользователя, указанные параметрами в функции [**всаконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) и функцией Condition объекта [**всаакцепт**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) , можно передать на одноранговый узел во время установки соединения, если эта функция поддерживается поставщиком услуг.</span><span class="sxs-lookup"><span data-stu-id="12cf8-106">User-to-user data specified by parameters in the [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) function and the condition function of [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) can be transferred to the peer during connection establishment, provided this feature is supported by the service provider.</span></span>

<span data-ttu-id="12cf8-107">Кроме того, можно (для протоколов, поддерживающих эту возможность) обмениваться данными пользователей между конечными точками во время уничтожения соединения.</span><span class="sxs-lookup"><span data-stu-id="12cf8-107">It is also possible (for protocols that support this) to exchange user data between the endpoints at connection teardown time.</span></span> <span data-ttu-id="12cf8-108">Конец, инициирующий уничтожение, может вызвать функцию [**всасенддисконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) , чтобы указать, что больше данных не нужно отправлять и инициировать последовательность разрывов соединения.</span><span class="sxs-lookup"><span data-stu-id="12cf8-108">The end that initiates the teardown can call the [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) function to indicate that no more data be sent and to initiate the connection teardown sequence.</span></span> <span data-ttu-id="12cf8-109">Для некоторых протоколов часть демонтажа — это доставка данных об отключении от инициатора уничтожения.</span><span class="sxs-lookup"><span data-stu-id="12cf8-109">For certain protocols, part of teardown is the delivery of disconnect data from the teardown initiator.</span></span> <span data-ttu-id="12cf8-110">После получения уведомления о том, что удаленное окончание инициировало уничтожение (как правило, с помощью \_ указания по закрытию демона), функцию [**всареквдисконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) можно вызвать для получения данных об отключении, если они есть.</span><span class="sxs-lookup"><span data-stu-id="12cf8-110">After receiving notice that the remote end has initiated teardown (typically by the FD\_CLOSE indication), the [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) function can be called to receive the disconnect data, if any.</span></span>

<span data-ttu-id="12cf8-111">Чтобы продемонстрировать, как можно использовать данные об отключении, рассмотрим следующий сценарий.</span><span class="sxs-lookup"><span data-stu-id="12cf8-111">To illustrate how disconnect data can be used, consider the following scenario.</span></span> <span data-ttu-id="12cf8-112">Клиентская часть приложения клиента/сервера отвечает за завершение подключения к сокету.</span><span class="sxs-lookup"><span data-stu-id="12cf8-112">The client half of a client/server application is responsible for terminating a socket connection.</span></span> <span data-ttu-id="12cf8-113">КоинЦидент с завершением работы, он предоставляет (с помощью отключения данных) общее число транзакций, обработанных сервером.</span><span class="sxs-lookup"><span data-stu-id="12cf8-113">Coincident with the termination, it provides (using disconnect data) the total number of transactions it processed with the server.</span></span> <span data-ttu-id="12cf8-114">Сервер, в свою очередь, отвечает совокупному объему транзакций, обработанных всеми клиентами.</span><span class="sxs-lookup"><span data-stu-id="12cf8-114">The server in turn responds with the cumulative total of transactions that it has processed with all clients.</span></span> <span data-ttu-id="12cf8-115">Последовательность вызовов и указаний может быть следующей:</span><span class="sxs-lookup"><span data-stu-id="12cf8-115">The sequence of calls and indications might occur as follows:</span></span>

| <span data-ttu-id="12cf8-116">На стороне клиента</span><span class="sxs-lookup"><span data-stu-id="12cf8-116">Client side</span></span>                                                                                                              | <span data-ttu-id="12cf8-117">На сервере</span><span class="sxs-lookup"><span data-stu-id="12cf8-117">Server side</span></span>                                                                                                                                                                                                                   |
|--------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="12cf8-118">(1) вызовите [**всасенддисконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) , чтобы завершить сеанс и указать общую сумму транзакции.</span><span class="sxs-lookup"><span data-stu-id="12cf8-118">(1) Invoke [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) to conclude session and supply transaction total.</span></span>            |                                                                                                                                                                                                                               |
|                                                                                                                          | <span data-ttu-id="12cf8-119">(2) получите демо-фильтра \_ , [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) с возвращаемым нулевым значением или [Всаедискон](windows-sockets-error-codes-2.md) ошибку возврата из [**всарекв**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) , что означает, что выполняется корректное завершение работы.</span><span class="sxs-lookup"><span data-stu-id="12cf8-119">(2) Get FD\_CLOSE, [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) with a return value of zero, or [WSAEDISCON](windows-sockets-error-codes-2.md) error return from [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) indicating graceful shutdown in progress.</span></span> |
|                                                                                                                          | <span data-ttu-id="12cf8-120">(3) вызовите [**всареквдисконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) , чтобы получить общую сумму транзакции клиента.</span><span class="sxs-lookup"><span data-stu-id="12cf8-120">(3) Invoke [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) to get client's transaction total.</span></span>                                                                                                                                |
|                                                                                                                          | <span data-ttu-id="12cf8-121">(4) вычисление совокупного общего итога по всем транзакциям.</span><span class="sxs-lookup"><span data-stu-id="12cf8-121">(4) Compute cumulative grand total of all transactions.</span></span>                                                                                                                                                                       |
|                                                                                                                          | <span data-ttu-id="12cf8-122">(5) чтобы передать общий итог, вызовите [**всасенддисконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) .</span><span class="sxs-lookup"><span data-stu-id="12cf8-122">(5) Invoke [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) to transmit grand total.</span></span>                                                                                                                                          |
| <span data-ttu-id="12cf8-123">(6) получить сведения о закрытии для демо-фильтра \_ .</span><span class="sxs-lookup"><span data-stu-id="12cf8-123">(6) Receive FD\_CLOSE indication.</span></span>                                                                                        | <span data-ttu-id="12cf8-124">(5a) вызовите [**функции closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span><span class="sxs-lookup"><span data-stu-id="12cf8-124">(5a) Invoke [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span></span>                                                                                                                                                                             |
| <span data-ttu-id="12cf8-125">(7) вызовите [**всареквдисконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) для получения и хранения совокупного общего итога транзакций.</span><span class="sxs-lookup"><span data-stu-id="12cf8-125">(7) Invoke [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) to receive and store cumulative grand total of transactions.</span></span> |                                                                                                                                                                                                                               |
| <span data-ttu-id="12cf8-126">(8) вызов [ **функции closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket)</span><span class="sxs-lookup"><span data-stu-id="12cf8-126">(8) Invoke [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket)</span></span>                                                                          |                                                                                                                                                                                                                               |



 

<span data-ttu-id="12cf8-127">Обратите внимание, что шаг (5a) должен следовать за шагом (5), но не имеет отношения времени к шагу (6), (7) или (8).</span><span class="sxs-lookup"><span data-stu-id="12cf8-127">Note that step (5a) must follow step (5), but has no timing relationship with step (6), (7), or (8).</span></span>

 

 



