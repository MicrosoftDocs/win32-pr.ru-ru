---
description: В этом разделе описываются рекомендации по переносу широковещательного приложения IPv6 в возможности многоадресной рассылки, доступные с помощью сокетов Windows.
ms.assetid: 12e491fd-650f-43b4-afa1-9f37b1c30240
title: Перенос широковещательных приложений на IPv6
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b9f7dce09db6822a6f9b0a61873ca6bbff5a256b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104497442"
---
# <a name="porting-broadcast-applications-to-ipv6"></a><span data-ttu-id="e4098-103">Перенос широковещательных приложений на IPv6</span><span class="sxs-lookup"><span data-stu-id="e4098-103">Porting Broadcast Applications to IPv6</span></span>

<span data-ttu-id="e4098-104">В этом разделе описываются рекомендации по переносу широковещательного приложения IPv6 в возможности многоадресной рассылки, доступные с помощью сокетов Windows.</span><span class="sxs-lookup"><span data-stu-id="e4098-104">This section describes best practices for porting an IPv6 broadcast application to the multicast capabilities available with Windows Sockets.</span></span>

## <a name="comparing-ipv4-to-ipv6"></a><span data-ttu-id="e4098-105">Сравнение IPv4 и IPv6</span><span class="sxs-lookup"><span data-stu-id="e4098-105">Comparing IPv4 to IPv6</span></span>

<span data-ttu-id="e4098-106">Наиболее важным моментом при подготовке широковещательного приложения IPv4 к IPv6 является следующее: в протоколе IPv6 не реализована концепция вещания.</span><span class="sxs-lookup"><span data-stu-id="e4098-106">The most notable consideration when preparing to port an IPv4 broadcast application to IPv6 is this: IPv6 has no implemented concept of broadcast.</span></span> <span data-ttu-id="e4098-107">Вместо этого протокол IPv6 использует многоадресную рассылку.</span><span class="sxs-lookup"><span data-stu-id="e4098-107">Instead, IPv6 uses multicast.</span></span>

<span data-ttu-id="e4098-108">Многоадресная рассылка для IPv6 может эмулировать традиционные возможности вещания, доступные в IPv4.</span><span class="sxs-lookup"><span data-stu-id="e4098-108">Multicast for IPv6 can emulate traditional broadcast capabilities found in IPv4.</span></span> <span data-ttu-id="e4098-109">Настройка параметра сокета [ \_ добавления \_ членства в IPv6](ipproto-ipv6-socket-options.md) с IPv6-адресом, установленным в область локальной связи все узлы адрес (FF02:: 1), эквивалентен широковещательной рассылке широковещательных адресов IPv4 с помощью параметра [so \_ широковещания](socket-options.md) Socket.</span><span class="sxs-lookup"><span data-stu-id="e4098-109">Setting the [IPV6\_ADD\_MEMBERSHIP](ipproto-ipv6-socket-options.md) socket option with the IPv6 address set to the link-local scope all nodes address (FF02::1) is equivalent to broadcasting on IPv4 broadcast addresses using the [SO\_BROADCAST](socket-options.md) socket option.</span></span> <span data-ttu-id="e4098-110">Этот адрес иногда называют *многоузловой группой многоадресной рассылки*.</span><span class="sxs-lookup"><span data-stu-id="e4098-110">This address is sometimes called the *all-nodes multicast group*.</span></span> <span data-ttu-id="e4098-111">Для приложений, которые просто хотят эмулировать вещание для IPv6, этот подход является эквивалентным.</span><span class="sxs-lookup"><span data-stu-id="e4098-111">For applications that simply want broadcast emulation for IPv6, that approach is operationally equivalent.</span></span> <span data-ttu-id="e4098-112">Однако одно важное отличие от протокола IPv6 состоит в том, что многоадресность групп многоадресной рассылки по умолчанию не принимается (широковещательные пакеты IPv4 принимаются по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="e4098-112">One notable difference with IPv6, however, is that multicasts on the all-nodes multicast group address are not received by default (IPv4 broadcasts are received by default).</span></span> <span data-ttu-id="e4098-113">Программисты приложений должны использовать \_ \_ параметр сокета добавления членства IPv6, чтобы обеспечить многоадресную рассылку из любого источника, включая адрес многоузловой группы многоадресной рассылки.</span><span class="sxs-lookup"><span data-stu-id="e4098-113">Application programmers must use the IPV6\_ADD\_MEMBERSHIP socket option to enable multicast reception from any source, including the all-nodes multicast group address.</span></span>

> [!Note]  
> <span data-ttu-id="e4098-114">В IPv6 выбор интерфейса указывается в структуре аргумента, передаваемой параметру сокета многоадресной рассылки или IOCTL.</span><span class="sxs-lookup"><span data-stu-id="e4098-114">In IPv6, interface selection is specified in the argument structure passed to the multicast socket option or IOCTL.</span></span>

 

<span data-ttu-id="e4098-115">Но для более мощных, более надежных, более избирательных и более управляемых передач на нескольких узлах разработчики приложений должны рассмотреть возможность перехода на модель многоадресной рассылки.</span><span class="sxs-lookup"><span data-stu-id="e4098-115">But for richer, more robust, more selective and more manageable transmissions to multiple hosts, application developers should consider moving to a multicast model.</span></span>

## <a name="moving-to-multicast"></a><span data-ttu-id="e4098-116">Переход на многоадресную рассылку</span><span class="sxs-lookup"><span data-stu-id="e4098-116">Moving to Multicast</span></span>

<span data-ttu-id="e4098-117">При использовании многоадресной рассылки программисты приложений могут выборочно выбирать отдельную пару «источник-группа», что позволяет использовать модель выборочного приема.</span><span class="sxs-lookup"><span data-stu-id="e4098-117">With multicast, application programmers can selectively choose a particular source/group pair, enabling a selective reception model.</span></span> <span data-ttu-id="e4098-118">Обнаружение многоадресного прослушивателя (MLD) на IPv6 и версия 3 протокола управления группами Интернета (IGMPv3) в IPv4 поддерживают программирование многоадресной рассылки.</span><span class="sxs-lookup"><span data-stu-id="e4098-118">The Multicast Listener Discovery (MLD) on IPv6 and version 3 of the Internet Group Management Protocol (IGMPv3) on IPv4 support multicasting programming.</span></span> <span data-ttu-id="e4098-119">Кроме того, многоадресная рассылка позволяет приложениям специально блокировать (или разблокировать) отправители в группе, а также дополнительно защищать приложения от мошеннических вещательных систем.</span><span class="sxs-lookup"><span data-stu-id="e4098-119">In addition, multicast enables applications to specifically block (or unblock) senders within a group, further protecting applications from rogue broadcasters.</span></span> <span data-ttu-id="e4098-120">Эта возможность доступна для IPv4 (требуется IGMPv3), а также для IPv6 (требуется MLDv2).</span><span class="sxs-lookup"><span data-stu-id="e4098-120">This capability is available for IPv4 (requires IGMPv3) as well as IPv6 (requires MLDv2).</span></span>

<span data-ttu-id="e4098-121">Существует два основных сценария для программистов приложений, использующих многоадресную рассылку: перенос из широковещательных (или многоадресных) приложений в IPv6 и создание новых многоадресных приложений IPv6.</span><span class="sxs-lookup"><span data-stu-id="e4098-121">There are two primary scenarios for application programmers using multicast: those porting from IPv4 broadcast (or multicast) applications to IPv6, and those creating new IPv6 multicast applications.</span></span>

<span data-ttu-id="e4098-122">Для переноса существующих приложений существует два варианта перехода на многоадресную рассылку IPv6: с помощью параметров сокета и с помощью IOCTL.</span><span class="sxs-lookup"><span data-stu-id="e4098-122">For porting existing applications, there are two options to move to IPv6 multicast: using socket options and using IOCTLs.</span></span>

-   <span data-ttu-id="e4098-123">Использование параметров сокета — это подход на основе изменений, который позволяет разработчикам изменять свойства сокета по мере необходимости (например, блокировать или разблокирование отправителя, Добавление нового источника и т. д.).</span><span class="sxs-lookup"><span data-stu-id="e4098-123">Using socket options is a change-based approach, which enables developers to change the socket properties as required (such as blocking or unblocking a sender, adding a new source, and so on).</span></span> <span data-ttu-id="e4098-124">Этот подход более интуитивен и является рекомендуемым подходом.</span><span class="sxs-lookup"><span data-stu-id="e4098-124">This approach is more intuitive and the recommended approach.</span></span> <span data-ttu-id="e4098-125">Дополнительные сведения о подходе на основе изменений к многоадресному программированию см. в разделе [MLD и IGMP с использованием сокетов Windows](igmp-and-windows-sockets.md).</span><span class="sxs-lookup"><span data-stu-id="e4098-125">For more information on the change-based approach to multicast programming, see [MLD and IGMP Using Windows Sockets](igmp-and-windows-sockets.md).</span></span>
-   <span data-ttu-id="e4098-126">Использование IOCTL — это подход на основе финального состояния, поскольку он позволяет разработчикам предоставлять полностью настроенное состояние сокета, включая списки включения и исключения, с одним вызовом.</span><span class="sxs-lookup"><span data-stu-id="e4098-126">Using IOCTLs is a final-state based approach, because it enables developers to provide a fully-configured socket state, including inclusion and exclusion lists, with one call.</span></span> <span data-ttu-id="e4098-127">Дополнительные сведения о подходе на основе финального состояния см. в разделе [многоадресное программирование на основе финального состояния](final-state-based-multicast-programming.md).</span><span class="sxs-lookup"><span data-stu-id="e4098-127">For more information on the final-state based approach, see [Final-State-Based Multicast Programming](final-state-based-multicast-programming.md).</span></span>

<span data-ttu-id="e4098-128">Для тех, кто создает новые многоадресные приложения IPv6, рекомендуется использовать параметры сокета вместо использования IOCTL.</span><span class="sxs-lookup"><span data-stu-id="e4098-128">For those creating new IPv6 multicast applications, the recommended practice is to use socket options, rather than using IOCTLs.</span></span>

<span data-ttu-id="e4098-129">Существует еще один подход к созданию многоадресных приложений с использованием протокола IPv6, что влечет за собой использование функции [**всажоинлеаф**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) .</span><span class="sxs-lookup"><span data-stu-id="e4098-129">There is one other approach to creating multicast applications with IPv6, and that entails using the [**WSAJoinLeaf**](/windows/desktop/api/Winsock2/nf-winsock2-wsajoinleaf) function.</span></span> <span data-ttu-id="e4098-130">Хотя использование функции **всажоинлеаф** не рекомендуется, существуют ситуации, которые могут надиктовать ее использование.</span><span class="sxs-lookup"><span data-stu-id="e4098-130">While using the **WSAJoinLeaf** function is not the recommended practice, there are situations that may dictate its use.</span></span> <span data-ttu-id="e4098-131">Например, один недостаток использования параметров сокета в Windows Server 2003 и более ранних версий заключается в том, что они относятся к версии протокола IP.</span><span class="sxs-lookup"><span data-stu-id="e4098-131">For example, one drawback to using socket options on Windows Server 2003 and earlier is that they are IP version specific.</span></span> <span data-ttu-id="e4098-132">В этих старых версиях Windows параметры разных сокетов должны быть для IPv6 и IPv4.</span><span class="sxs-lookup"><span data-stu-id="e4098-132">On these older versions of Windows, different sockets options must be for IPv6 and IPv4.</span></span> <span data-ttu-id="e4098-133">В Windows Vista и более поздних версиях поддерживаются новые варианты сокетов, которые можно использовать как с IPv4, так и с IPv6.</span><span class="sxs-lookup"><span data-stu-id="e4098-133">On Windows Vista and later, new socket options are supported that can be used with both IPv4 and IPv6.</span></span> <span data-ttu-id="e4098-134">Функция **всажоинлеаф** , напротив, является версией протокола IP и протоколом, а значит, может быть полезным подходом к созданию приложения, которое должно работать с несколькими версиями IP-адресов в Windows Server 2003 и более ранних версиях.</span><span class="sxs-lookup"><span data-stu-id="e4098-134">The **WSAJoinLeaf** function, in contrast, is IP version and protocol agnostic, and therefore it can be a useful approach for building an application that must work with multiple IP versions on Windows Server 2003 and earlier.</span></span> <span data-ttu-id="e4098-135">Использование функции **всажоинлеаф** может быть более подходящим в некоторых ситуациях, когда требуется протокол и независимый от IP-версии.</span><span class="sxs-lookup"><span data-stu-id="e4098-135">Using the **WSAJoinLeaf** function may be more appropriate in certain situations where protocol and IP-version agnosticism is required.</span></span>

 

 



