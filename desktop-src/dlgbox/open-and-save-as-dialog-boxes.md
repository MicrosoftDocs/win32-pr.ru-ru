---
title: Открытие и сохранение диалоговых окон
description: Диалоговое окно Открыть позволяет пользователю указать диск, каталог и имя файла или набора файлов, которые нужно открыть.
ms.assetid: 5676ca9d-daca-40bf-8881-def2ff841c58
keywords:
- Библиотека общих диалоговых окон
- Общие диалоговые окна
- Диалоговое окно “Открыть”
- диалоговое окно «Сохранить как»
- Настройка диалогового окна «открыть»
- Настройка диалогового окна «Сохранить как»
- Открытые диалоговые окна
- диалоговые окна, сохранить как
ms.topic: article
ms.date: 05/31/2018
ms.custom: project-verbatim
ms.openlocfilehash: bc2977a5f91abde32a78c722a7a7c7b6b4a23ffd
ms.sourcegitcommit: af120ad5c30da2fc5eb717ca2a1c4c45878efd71
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2021
ms.locfileid: "105694373"
---
# <a name="open-and-save-as-dialog-boxes"></a><span data-ttu-id="568ff-111">Открытие и сохранение диалоговых окон</span><span class="sxs-lookup"><span data-stu-id="568ff-111">Open and Save As Dialog Boxes</span></span>

> [!NOTE]
> <span data-ttu-id="568ff-112">Функция [**GetOpenFilename**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) показана в файле, который используется в качестве [примера](https://github.com/microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/winui/shell/appplatform/fileisinuse).</span><span class="sxs-lookup"><span data-stu-id="568ff-112">The [**GetOpenFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) function is demonstrated in the [File is in use sample](https://github.com/microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/winui/shell/appplatform/fileisinuse).</span></span>

<span data-ttu-id="568ff-113">\[Начиная с Windows Vista, диалоговые окна " **Открыть** " и " **Сохранить как** " были заменены [диалоговым окном общих элементов](/previous-versions/windows/desktop/legacy/bb776913(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="568ff-113">\[Starting with Windows Vista, the **Open** and **Save As** common dialog boxes have been superseded by the [Common Item Dialog](/previous-versions/windows/desktop/legacy/bb776913(v=vs.85)).</span></span> <span data-ttu-id="568ff-114">Рекомендуется использовать API-интерфейс общего элемента, а не эти диалоговые окна из библиотеки общих диалоговых окон.\]</span><span class="sxs-lookup"><span data-stu-id="568ff-114">We recommended that you use the Common Item Dialog API instead of these dialog boxes from the Common Dialog Box Library.\]</span></span>

<span data-ttu-id="568ff-115">Диалоговое окно **Открыть** позволяет пользователю указать диск, каталог и имя файла или набора файлов, которые нужно открыть.</span><span class="sxs-lookup"><span data-stu-id="568ff-115">The **Open** dialog box lets the user specify the drive, directory, and the name of a file or set of files to open.</span></span> <span data-ttu-id="568ff-116">Вы создаете и отображаете **открытое** диалоговое окно, инициализируя структуру [**OpenFileName**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) и передавая структуру в функцию [**GetOpenFilename**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) .</span><span class="sxs-lookup"><span data-stu-id="568ff-116">You create and display an **Open** dialog box by initializing an [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure and passing the structure to the [**GetOpenFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) function.</span></span>

<span data-ttu-id="568ff-117">Диалоговое окно **Сохранить как** позволяет пользователю указать диск, каталог и имя сохраняемого файла.</span><span class="sxs-lookup"><span data-stu-id="568ff-117">The **Save As** dialog box lets the user specify the drive, directory, and name of a file to save.</span></span> <span data-ttu-id="568ff-118">Вы создаете и отображаете диалоговое окно **Сохранить как** , инициализируя структуру [**OpenFileName**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) и передавая структуру в функцию [**жетсавефиленаме**](/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea) .</span><span class="sxs-lookup"><span data-stu-id="568ff-118">You create and display a **Save As** dialog box by initializing an [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure and passing the structure to the [**GetSaveFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea) function.</span></span>

<span data-ttu-id="568ff-119">В диалоговых окнах " **Открыть** " и " **Сохранить как** " обозревателя представлены функции пользовательского интерфейса, аналогичные проводнику Windows.</span><span class="sxs-lookup"><span data-stu-id="568ff-119">Explorer-style **Open** and **Save As** dialog boxes provide user-interface features that are similar to the Windows Explorer.</span></span> <span data-ttu-id="568ff-120">Однако система по-прежнему поддерживает диалоговые окна **открытия** и **сохранения** старого стиля для приложений, которые должны быть совместимы с пользовательским интерфейсом старого стиля.</span><span class="sxs-lookup"><span data-stu-id="568ff-120">However, the system continues to support old-style **Open** and **Save As** dialog boxes for applications that must be consistent with the old-style user interface.</span></span>

<span data-ttu-id="568ff-121">В дополнение к различиям в внешнем виде диалоговые окна в стиле обозревателя и старого стиля отличаются использованием пользовательских шаблонов и процедур подключения для настройки диалоговых окон.</span><span class="sxs-lookup"><span data-stu-id="568ff-121">In addition to the difference in appearance, the Explorer-style and old-style dialog boxes differ in their use of custom templates and hook procedures for customizing the dialog boxes.</span></span> <span data-ttu-id="568ff-122">Однако диалоговые окна в стиле обозревателя и старого стиля имеют одинаковое поведение для большинства основных операций, таких как указание фильтра имен файлов, проверка вводимых пользователем данных и получение имени файла, указанного пользователем.</span><span class="sxs-lookup"><span data-stu-id="568ff-122">However, the Explorer-style and old-style dialog boxes have the same behavior for most basic operations, such as specifying a file name filter, validating the user's input, and getting the file name specified by the user.</span></span> <span data-ttu-id="568ff-123">Дополнительные сведения о диалоговых окнах «Обозреватель-стиль» и «старый стиль» см. в разделе [Настройка диалоговых окон «Открыть» и «сохранить как](#open-and-save-as-dialog-box-customization)».</span><span class="sxs-lookup"><span data-stu-id="568ff-123">For more information about the Explorer-style and old-style dialog boxes, see [Open and Save As Dialog Box Customization](#open-and-save-as-dialog-box-customization).</span></span>

<span data-ttu-id="568ff-124">На следующем рисунке показано типичное диалоговое окно « **Открыть** в стиле обозревателя».</span><span class="sxs-lookup"><span data-stu-id="568ff-124">The following illustration shows a typical Explorer-style **Open** dialog box.</span></span>

![диалоговое окно «Открытие файла»](images/opendialogboxxp.png)

<span data-ttu-id="568ff-126">На следующем рисунке показано типичное диалоговое окно « **Сохранение в** стиле обозревателя».</span><span class="sxs-lookup"><span data-stu-id="568ff-126">The following illustration shows a typical Explorer-style **Save As** dialog box.</span></span>

![диалоговое окно «Сохранение файла»](images/saveasdialogboxxp.png)

<span data-ttu-id="568ff-128">Если пользователь задает имя файла и нажимает кнопку **ОК** , [**GetOpenFilename**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) или [**жетсавефиленаме**](/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea) возвращает **значение true**.</span><span class="sxs-lookup"><span data-stu-id="568ff-128">If the user specifies a file name and clicks the **OK** button, [**GetOpenFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) or [**GetSaveFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea) returns **TRUE**.</span></span> <span data-ttu-id="568ff-129">Буфер, на который указывает член **указанный** структуры [**OpenFileName**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) , содержит полный путь и имя файла, указанные пользователем.</span><span class="sxs-lookup"><span data-stu-id="568ff-129">The buffer pointed to by the **lpstrFile** member of the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure contains the full path and file name specified by the user.</span></span>

<span data-ttu-id="568ff-130">Если пользователь отменяет диалоговое окно **Открыть** или **Сохранить как** или возникает ошибка, функция возвращает **значение false**.</span><span class="sxs-lookup"><span data-stu-id="568ff-130">If the user cancels the **Open** or **Save As** dialog box or an error occurs, the function returns **FALSE**.</span></span> <span data-ttu-id="568ff-131">Чтобы определить причину ошибки, вызовите функцию [**коммдлжекстендедеррор**](/windows/desktop/api/Commdlg/nf-commdlg-commdlgextendederror) , чтобы получить расширенное значение ошибки.</span><span class="sxs-lookup"><span data-stu-id="568ff-131">To determine the cause of the error, call the [**CommDlgExtendedError**](/windows/desktop/api/Commdlg/nf-commdlg-commdlgextendederror) function to retrieve the extended error value.</span></span> <span data-ttu-id="568ff-132">Если буфер **указанный** слишком мал для получения полного имени, **коммдлжекстендедеррор** возвращает **фнерр \_ буффертусмалл** , а первые 2 байта буфера, на который указывает элемент **указанный** , устанавливаются в целочисленное значение, определяющее размер, необходимый для получения полного имени.</span><span class="sxs-lookup"><span data-stu-id="568ff-132">If the **lpstrFile** buffer is too small to receive the full name, **CommDlgExtendedError** returns **FNERR\_BUFFERTOOSMALL** and the first 2 bytes of the buffer pointed to by the **lpstrFile** member are set to an integer value specifying the size required to receive the full name.</span></span>

<span data-ttu-id="568ff-133">В этом разделе рассматриваются следующие темы.</span><span class="sxs-lookup"><span data-stu-id="568ff-133">The following topics are discussed in this section.</span></span>

-   [<span data-ttu-id="568ff-134">Имена файлов и каталоги</span><span class="sxs-lookup"><span data-stu-id="568ff-134">File Names and Directories</span></span>](#file-names-and-directories)
-   [<span data-ttu-id="568ff-135">Фильтры</span><span class="sxs-lookup"><span data-stu-id="568ff-135">Filters</span></span>](#filters)
-   [<span data-ttu-id="568ff-136">Проверка файлов и каталогов</span><span class="sxs-lookup"><span data-stu-id="568ff-136">File and Directory Validation</span></span>](#file-and-directory-validation)
-   [<span data-ttu-id="568ff-137">Настройка диалогового окна "открыть и сохранить как"</span><span class="sxs-lookup"><span data-stu-id="568ff-137">Open and Save As Dialog Box Customization</span></span>](#open-and-save-as-dialog-box-customization)
-   [<span data-ttu-id="568ff-138">Процедуры-обработчики в стиле обозревателя</span><span class="sxs-lookup"><span data-stu-id="568ff-138">Explorer-Style Hook Procedures</span></span>](#explorer-style-hook-procedures)
-   [<span data-ttu-id="568ff-139">Пользовательские шаблоны в стиле обозревателя</span><span class="sxs-lookup"><span data-stu-id="568ff-139">Explorer-Style Custom Templates</span></span>](#explorer-style-custom-templates)
-   [<span data-ttu-id="568ff-140">Идентификаторы элементов управления в стиле обозревателя</span><span class="sxs-lookup"><span data-stu-id="568ff-140">Explorer-Style Control Identifiers</span></span>](#explorer-style-control-identifiers)
-   [<span data-ttu-id="568ff-141">Настройка диалоговых окон Old-Style</span><span class="sxs-lookup"><span data-stu-id="568ff-141">Customizing Old-Style Dialog Boxes</span></span>](#customizing-old-style-dialog-boxes)

## <a name="file-names-and-directories"></a><span data-ttu-id="568ff-142">Имена файлов и каталоги</span><span class="sxs-lookup"><span data-stu-id="568ff-142">File Names and Directories</span></span>

<span data-ttu-id="568ff-143">Сведения в этом разделе относятся к диалоговым окнам **Открыть** и **Сохранить как** в стиле обозревателя, так и в старом стиле.</span><span class="sxs-lookup"><span data-stu-id="568ff-143">The information in this section applies to both Explorer-style and old-style **Open** and **Save As** dialog boxes.</span></span>

<span data-ttu-id="568ff-144">Перед вызовом функций [**GetOpenFilename**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) или [**жетсавефиленаме**](/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea) элемент **указанный** структуры [**OpenFileName**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) должен указывать на буфер для получения имени файла.</span><span class="sxs-lookup"><span data-stu-id="568ff-144">Before calling the [**GetOpenFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) or [**GetSaveFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea) functions, the **lpstrFile** member of the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure must point to the buffer to receive the file name.</span></span> <span data-ttu-id="568ff-145">Элемент **нмаксфиле** должен указывать размер буфера **указанный** в символах.</span><span class="sxs-lookup"><span data-stu-id="568ff-145">The **nMaxFile** member must specify the size, in characters, of the **lpstrFile** buffer.</span></span> <span data-ttu-id="568ff-146">Для функции ANSI это число байтов, но для функции Юникода это число символов.</span><span class="sxs-lookup"><span data-stu-id="568ff-146">For an ANSI function this is the number of bytes, but for a Unicode function this is the number of characters.</span></span>

<span data-ttu-id="568ff-147">Если пользователь задает имя файла и нажимает кнопку **ОК** , диалоговое окно копирует выбранный диск, каталог и имя файла в буфер **указанный** .</span><span class="sxs-lookup"><span data-stu-id="568ff-147">If the user specifies a file name and clicks the **OK** button, the dialog box copies the selected drive, directory, and file name to the **lpstrFile** buffer.</span></span> <span data-ttu-id="568ff-148">Функция также задает для элементов **нфилеоффсет** и **нфиликстенсион** смещения (в символах) от начала буфера до имени файла и расширения имени файла соответственно.</span><span class="sxs-lookup"><span data-stu-id="568ff-148">The function also sets the **nFileOffset** and **nFileExtension** members to the offsets, in characters, from the start of the buffer to the file name and to the file name extension, respectively.</span></span>

<span data-ttu-id="568ff-149">Чтобы получить только имя файла и расширение, установите элемент **лпстрфилетитле** , чтобы он указывал на буфер, и задайте для элемента **нмаксфилетитле** размер (в символах) буфера.</span><span class="sxs-lookup"><span data-stu-id="568ff-149">To retrieve just the file name and extension, set the **lpstrFileTitle** member to point to a buffer and set the **nMaxFileTitle** member to the size, in characters, of the buffer.</span></span> <span data-ttu-id="568ff-150">Кроме того, можно передать буфер **указанный** в вызове функции [**жетфилетитле**](/windows/desktop/api/Commdlg/nf-commdlg-getfiletitlea) , чтобы получить отображаемое имя выбранного файла.</span><span class="sxs-lookup"><span data-stu-id="568ff-150">Alternatively, you can pass the **lpstrFile** buffer in a call to the [**GetFileTitle**](/windows/desktop/api/Commdlg/nf-commdlg-getfiletitlea) function to get the display name of the selected file.</span></span> <span data-ttu-id="568ff-151">Однако обратите внимание, что имя файла, возвращаемое **жетфилетитле** , включает расширение, только если это пользовательская предпочтение для отображения имен файлов.</span><span class="sxs-lookup"><span data-stu-id="568ff-151">Note, however, that the file name that **GetFileTitle** returns includes an extension only if that is the user's preference for displaying file names.</span></span>

<span data-ttu-id="568ff-152">В диалоговом окне используется текущий каталог для вызывающего процесса в качестве исходного каталога, из которого должны отображаться файлы и каталоги.</span><span class="sxs-lookup"><span data-stu-id="568ff-152">The dialog box uses the current directory for the calling process as the initial directory from which to display files and directories.</span></span> <span data-ttu-id="568ff-153">Используйте функции [**GetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-getcurrentdirectory) и [**сеткуррентдиректори**](/windows/desktop/api/winbase/nf-winbase-setcurrentdirectory) для получения и изменения текущего каталога процесса.</span><span class="sxs-lookup"><span data-stu-id="568ff-153">Use the [**GetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-getcurrentdirectory) and [**SetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-setcurrentdirectory) functions to get and change the current directory of a process.</span></span> <span data-ttu-id="568ff-154">Чтобы указать другой исходный каталог без изменения текущего каталога, используйте член **лпстринитиалдир** , чтобы указать имя каталога.</span><span class="sxs-lookup"><span data-stu-id="568ff-154">To specify a different initial directory without changing your current directory, use the **lpstrInitialDir** member to specify the name of a directory.</span></span> <span data-ttu-id="568ff-155">Диалоговое окно автоматически изменяет текущий каталог, когда пользователь выбирает другой диск или каталог.</span><span class="sxs-lookup"><span data-stu-id="568ff-155">The dialog box automatically changes your current directory when the user selects a different drive or directory.</span></span> <span data-ttu-id="568ff-156">Чтобы предотвратить изменение текущего каталога в диалоговом окне, установите флаг **ОФН \_ ночанжедир** .</span><span class="sxs-lookup"><span data-stu-id="568ff-156">To prevent the dialog box from changing your current directory, set the **OFN\_NOCHANGEDIR** flag.</span></span> <span data-ttu-id="568ff-157">Этот флаг не запрещает пользователю изменять каталоги для поиска файла.</span><span class="sxs-lookup"><span data-stu-id="568ff-157">This flag does not prevent the user from changing directories to find a file.</span></span>

<span data-ttu-id="568ff-158">Чтобы указать расширение имени файла по умолчанию, используйте элемент **лпстрдефекст** .</span><span class="sxs-lookup"><span data-stu-id="568ff-158">To specify a default file name extension, use the **lpstrDefExt** member.</span></span> <span data-ttu-id="568ff-159">Если пользователь указывает имя файла, у которого нет расширения, в диалоговом окне добавляется расширение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="568ff-159">If the user specifies a file name that does not have an extension, the dialog box adds your default extension.</span></span> <span data-ttu-id="568ff-160">Если задано расширение по умолчанию и пользователь указывает имя файла с другим расширением, то в диалоговом окне устанавливается флаг **ОФН \_ екстенсиондифферент** .</span><span class="sxs-lookup"><span data-stu-id="568ff-160">If you specify a default extension and the user specifies a file name with a different extension, the dialog box sets the **OFN\_EXTENSIONDIFFERENT** flag.</span></span>

<span data-ttu-id="568ff-161">Чтобы позволить пользователю выбрать более одного файла из каталога, установите флаг **ОФН \_ алловмултиселект** .</span><span class="sxs-lookup"><span data-stu-id="568ff-161">To let the user select more than one file from a directory, set the **OFN\_ALLOWMULTISELECT** flag.</span></span> <span data-ttu-id="568ff-162">Для совместимости с более старыми приложениями в диалоговом окне множественный выбор по умолчанию используется пользовательский интерфейс старого стиля.</span><span class="sxs-lookup"><span data-stu-id="568ff-162">For compatibility with older applications, the default multiple selection dialog box uses the old-style user interface.</span></span> <span data-ttu-id="568ff-163">Для вывода диалогового окна «Выбор нескольких вариантов в стиле обозревателя» необходимо также установить **флаг \_ обозревателя ОФН** .</span><span class="sxs-lookup"><span data-stu-id="568ff-163">To display an Explorer-style multiple selection dialog box, you must also set the **OFN\_EXPLORER** flag.</span></span>

<span data-ttu-id="568ff-164">Если пользователь выбирает более одного файла, буфер, на который указывает член **указанный** , возвращает путь к текущему каталогу, за которым следуют имена файлов выбранных файлов.</span><span class="sxs-lookup"><span data-stu-id="568ff-164">If the user selects more than one file, the buffer pointed to by the **lpstrFile** member returns the path to the current directory followed by the file names of the selected files.</span></span> <span data-ttu-id="568ff-165">Элемент **нфилеоффсет** является смещением к первому имени файла, а член **нфиликстенсион** не используется.</span><span class="sxs-lookup"><span data-stu-id="568ff-165">The **nFileOffset** member is the offset to the first file name, and the **nFileExtension** member is not used.</span></span> <span data-ttu-id="568ff-166">В следующей таблице описывается различие между диалоговыми окнами в стиле обозревателя и старого стиля при возврате нескольких имен файлов.</span><span class="sxs-lookup"><span data-stu-id="568ff-166">The following table describes the difference between Explorer-style and old-style dialog boxes in returning multiple file names.</span></span>



| <span data-ttu-id="568ff-167">Стиль диалогового окна</span><span class="sxs-lookup"><span data-stu-id="568ff-167">Dialog box style</span></span>            | <span data-ttu-id="568ff-168">Описание</span><span class="sxs-lookup"><span data-stu-id="568ff-168">Description</span></span>                                                                                                                                                                                                               |
|-----------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="568ff-169">Диалоговые окна в стиле обозревателя</span><span class="sxs-lookup"><span data-stu-id="568ff-169">Explorer-style dialog boxes</span></span> | <span data-ttu-id="568ff-170">Строки имени файла и каталога с разделителями **null** разделяются символом **null** после последнего имени файла.</span><span class="sxs-lookup"><span data-stu-id="568ff-170">The directory and file name strings are **NULL** separated, with an extra **NULL** character after the last file name.</span></span> <span data-ttu-id="568ff-171">Этот формат позволяет диалоговым окнам в стиле обозревателя возвращать длинные имена файлов, содержащие пробелы.</span><span class="sxs-lookup"><span data-stu-id="568ff-171">This format enables the Explorer-style dialog boxes to return long file names that include spaces.</span></span> |
| <span data-ttu-id="568ff-172">Диалоговые окна старого стиля</span><span class="sxs-lookup"><span data-stu-id="568ff-172">Old-style dialog boxes</span></span>      | <span data-ttu-id="568ff-173">Строки имен файлов и каталогов разделяются пробелами.</span><span class="sxs-lookup"><span data-stu-id="568ff-173">The directory and file name strings are separated by spaces.</span></span> <span data-ttu-id="568ff-174">Для имен файлов с пробелами функция использует короткие имена файлов.</span><span class="sxs-lookup"><span data-stu-id="568ff-174">For file names with spaces, the function uses short file names.</span></span>                                                                                              |



 

<span data-ttu-id="568ff-175">Функцию [**FindFirstFile**](/windows/desktop/api/fileapi/nf-fileapi-findfirstfilea) можно использовать для преобразования между длинными и короткими именами файлов.</span><span class="sxs-lookup"><span data-stu-id="568ff-175">You can use the [**FindFirstFile**](/windows/desktop/api/fileapi/nf-fileapi-findfirstfilea) function to convert between long and short file names.</span></span>

<span data-ttu-id="568ff-176">Если указать **ОФН \_ алловмултиселект** и пользователь выбрал только один файл, то в строке **указанный** не будет разделителя между путем и именем файла.</span><span class="sxs-lookup"><span data-stu-id="568ff-176">If you specify **OFN\_ALLOWMULTISELECT** and the user selects only one file, the **lpstrFile** string does not have a separator between the path and file name.</span></span>

## <a name="filters"></a><span data-ttu-id="568ff-177">фильтры;</span><span class="sxs-lookup"><span data-stu-id="568ff-177">Filters</span></span>

<span data-ttu-id="568ff-178">Сведения в этом разделе относятся к диалоговым окнам «обозреватель-стиль» и « **старый стиль»** и « **Сохранить как** ».</span><span class="sxs-lookup"><span data-stu-id="568ff-178">The information in this section applies to both Explorer-style and old style **Open** and **Save As** dialog boxes.</span></span>

<span data-ttu-id="568ff-179">Можно указать фильтры имен файлов, чтобы помочь пользователю в ограничении имен файлов, отображаемых в диалоговом окне.</span><span class="sxs-lookup"><span data-stu-id="568ff-179">You can provide file name filters to assist the user in limiting the file names that the dialog box displays.</span></span> <span data-ttu-id="568ff-180">Фильтр имен файлов состоит из пары строк, завершающихся нулем, описания и шаблона, Объединенных в другой.</span><span class="sxs-lookup"><span data-stu-id="568ff-180">A file name filter consists of a pair of null-terminated strings, a description and a pattern, one concatenated to the other.</span></span> <span data-ttu-id="568ff-181">В диалоговом окне отображается описание, позволяющее пользователю выбрать используемый фильтр. и использует шаблон для выбора файлов для вывода.</span><span class="sxs-lookup"><span data-stu-id="568ff-181">The dialog box displays the description to let the user pick which filter to use; and it uses the pattern to select the files to display.</span></span>

<span data-ttu-id="568ff-182">Чтобы указать фильтры, установите элемент **лпстрфилтер** структуры [**OpenFileName**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) , чтобы он указывал на буфер, содержащий массив пар строк фильтра.</span><span class="sxs-lookup"><span data-stu-id="568ff-182">To specify the filters, set the **lpstrFilter** member of the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure to point to a buffer that contains an array of filter string pairs.</span></span> <span data-ttu-id="568ff-183">За последней строкой в массиве должен следовать дополнительный символ null.</span><span class="sxs-lookup"><span data-stu-id="568ff-183">The last string in the array must be followed by an extra null character.</span></span>

<span data-ttu-id="568ff-184">Строка шаблона может представлять собой сочетание допустимых символов имени файла и звездочки ( \* ).</span><span class="sxs-lookup"><span data-stu-id="568ff-184">A pattern string can be a combination of valid file name characters and the asterisk (\*).</span></span> <span data-ttu-id="568ff-185">Звездочка — это подстановочный знак, который представляет любое сочетание допустимых символов имени файла.</span><span class="sxs-lookup"><span data-stu-id="568ff-185">The asterisk is a wildcard that represents any combination of valid file name characters.</span></span> <span data-ttu-id="568ff-186">В диалоговом окне отображаются только те файлы, которые соответствуют шаблону.</span><span class="sxs-lookup"><span data-stu-id="568ff-186">The dialog box displays only those files that match the pattern.</span></span> <span data-ttu-id="568ff-187">Чтобы указать несколько шаблонов для одного описания, необходимо использовать точку с запятой (;) для разделения шаблонов.</span><span class="sxs-lookup"><span data-stu-id="568ff-187">To specify multiple patterns for the same description, you must use a semicolon (;) to separate the patterns.</span></span> <span data-ttu-id="568ff-188">Обратите внимание, что пробелы в строке шаблона могут привести к непредвиденным результатам.</span><span class="sxs-lookup"><span data-stu-id="568ff-188">Note that space characters in the pattern string can produce unexpected results.</span></span>

<span data-ttu-id="568ff-189">В следующем фрагменте кода указываются два фильтра.</span><span class="sxs-lookup"><span data-stu-id="568ff-189">The following code fragment specifies two filters.</span></span> <span data-ttu-id="568ff-190">Фильтр с описанием "источник" имеет два шаблона.</span><span class="sxs-lookup"><span data-stu-id="568ff-190">The filter with the "Source" description has two patterns.</span></span> <span data-ttu-id="568ff-191">Если пользователь выбирает этот фильтр, в диалоговом окне отображаются только файлы с. C и. Расширения CXX.</span><span class="sxs-lookup"><span data-stu-id="568ff-191">If the user selects this filter, the dialog box displays only files that have the .C and .CXX extensions.</span></span> <span data-ttu-id="568ff-192">Обратите внимание, что в языке программирования C строка, заключенная в двойные кавычки, завершается нулем.</span><span class="sxs-lookup"><span data-stu-id="568ff-192">Note, in the C programming language, a string enclosed in double quotes is null-terminated.</span></span>


```
OPENFILENAME ofn;       // common dialog box structure

ofn.lpstrFilter = "Source\0*.C;*.CXX\0All\0*.*\0"
ofn.nFilterIndex = 1;
```



<span data-ttu-id="568ff-193">Элемент **нфилтериндекс** структуры [**OpenFileName**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) задает индекс, который указывает, какой фильтр используется в первоначальном диалоговом окне.</span><span class="sxs-lookup"><span data-stu-id="568ff-193">The **nFilterIndex** member of the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure specifies an index that indicates which filter the dialog box initially uses.</span></span> <span data-ttu-id="568ff-194">Первый фильтр в буфере имеет индекс 1, второй 2 и т. д.</span><span class="sxs-lookup"><span data-stu-id="568ff-194">The first filter in the buffer has index 1, the second 2, and so on.</span></span> <span data-ttu-id="568ff-195">Если пользователь изменяет фильтр при использовании диалогового окна, для элемента **нфилтериндекс** задается индекс выбранного фильтра в поле Return.</span><span class="sxs-lookup"><span data-stu-id="568ff-195">If the user changes the filter while using the dialog box, the **nFilterIndex** member is set to the index of the selected filter on return.</span></span>

<span data-ttu-id="568ff-196">Можно создать настраиваемый фильтр, задав для элемента **лпстркустомфилтер** адрес буфера, содержащего один фильтр, и установив для элемента **нмакскустфилтер** размер буфера в символах или байтах.</span><span class="sxs-lookup"><span data-stu-id="568ff-196">You can create a custom filter by setting the **lpstrCustomFilter** member to the address of a buffer that contains a single filter, and by setting the **nMaxCustFilter** member to the size of the buffer, in characters or bytes.</span></span> <span data-ttu-id="568ff-197">В диалоговом окне Пользовательский фильтр всегда помещается в начало списка фильтров, а в случае возврата всегда обновляет часть шаблона фильтра с помощью шаблона из фильтра, выбранного пользователем.</span><span class="sxs-lookup"><span data-stu-id="568ff-197">The dialog box always places the custom filter at the beginning of the list of filters and, on return, always updates the pattern part of the filter with the pattern from the filter selected by the user.</span></span>

<span data-ttu-id="568ff-198">Для диалоговых окон в стиле обозревателя расширение по умолчанию может измениться, если пользователь выбирает другой фильтр.</span><span class="sxs-lookup"><span data-stu-id="568ff-198">For Explorer-style dialog boxes, the default extension may change if the user selects a different filter.</span></span> <span data-ttu-id="568ff-199">Если пользователь выбирает фильтр, первый шаблон которого имеет форму \* .*XXX* (т. е. расширение не содержит подстановочный знак), в диалоговом окне в качестве расширения по умолчанию используется *xxx* .</span><span class="sxs-lookup"><span data-stu-id="568ff-199">If the user selects a filter whose first pattern is of the form \*.*xxx* (that is, the extension does not include a wildcard character), the dialog box uses *xxx* as the default extension.</span></span> <span data-ttu-id="568ff-200">Это происходит только в том случае, если в элементе **лпстрдефекст** структуры [**OpenFileName**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) указано расширение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="568ff-200">This occurs only if you specified a default extension in the **lpstrDefExt** member of the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure.</span></span> <span data-ttu-id="568ff-201">Например, если пользователь выбирает «source \\ 0» \* . C; \* . CXX \\ 0 "фильтр, расширение по умолчанию изменяется на" C ".</span><span class="sxs-lookup"><span data-stu-id="568ff-201">For example, if the user selects the "Source\\0\*.C;\*.CXX\\0" filter, the default extension changes to "C".</span></span> <span data-ttu-id="568ff-202">Однако, если фильтр был определен как «Source 0» \\ \* . \* \\ В C 0 "расширение по умолчанию не изменится, так как расширение содержит подстановочный знак.</span><span class="sxs-lookup"><span data-stu-id="568ff-202">However, if you had defined the filter as "Source\\0\*.C\*\\0", the default extension would not change because the extension includes a wildcard.</span></span>

<span data-ttu-id="568ff-203">Сообщение [**уведомления \_ инклудеитем CDN**](cdn-includeitem.md) предоставляет другой способ фильтрации имен, отображаемых в диалоговом окне.</span><span class="sxs-lookup"><span data-stu-id="568ff-203">The [**CDN\_INCLUDEITEM**](cdn-includeitem.md) notification message provides another way to filter the names that the dialog box displays.</span></span> <span data-ttu-id="568ff-204">Чтобы использовать это сообщение, укажите процедуру-обработчик [**офнхукпрок**](/windows/win32/api/commdlg/nc-commdlg-lpofnhookproc) и укажите флаг **ОФН \_ енаблеинклуденотифи** в структуре [**OpenFileName**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) при создании этого диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-204">To use this message, provide an [**OFNHookProc**](/windows/win32/api/commdlg/nc-commdlg-lpofnhookproc) hook procedure and specify the **OFN\_ENABLEINCLUDENOTIFY** flag in the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure when you create the dialog box.</span></span> <span data-ttu-id="568ff-205">Каждый раз, когда пользователь открывает папку, диалоговое окно отправляет в процедуру подключения уведомление **\_ инклудеитем CDN** для каждого элемента во вновь открытой папке.</span><span class="sxs-lookup"><span data-stu-id="568ff-205">Each time the user opens a folder, the dialog box sends a **CDN\_INCLUDEITEM** notification to your hook procedure for each item in the newly opened folder.</span></span> <span data-ttu-id="568ff-206">Возвращаемое значение процедуры-обработчика указывает, должно ли диалоговое окно отображать элемент в списке элементов папки.</span><span class="sxs-lookup"><span data-stu-id="568ff-206">The return value of the hook procedure indicates whether the dialog box should display the item in the folder's item list.</span></span>

## <a name="file-and-directory-validation"></a><span data-ttu-id="568ff-207">Проверка файлов и каталогов</span><span class="sxs-lookup"><span data-stu-id="568ff-207">File and Directory Validation</span></span>

<span data-ttu-id="568ff-208">Если не указано иное, сведения в этом разделе применяются к диалоговым окнам **Открыть** и **Сохранить как** в стиле обозревателя, так и в старом стиле.</span><span class="sxs-lookup"><span data-stu-id="568ff-208">Except as noted, the information in this section applies to both Explorer-style and old-style **Open** and **Save As** dialog boxes.</span></span>

<span data-ttu-id="568ff-209">Диалоговое окно автоматически проверяет имена файлов, введенные пользователем, чтобы гарантировать, что имена содержат только допустимые символы.</span><span class="sxs-lookup"><span data-stu-id="568ff-209">The dialog box automatically validates file names typed by the user to ensure that the names contain only valid characters.</span></span> <span data-ttu-id="568ff-210">Чтобы переопределить проверку символа имени файла, установите флаг **ОФН. \_**</span><span class="sxs-lookup"><span data-stu-id="568ff-210">To override the file name character validation, set the **OFN\_NOVALIDATE** flag.</span></span>

<span data-ttu-id="568ff-211">Чтобы заставить диалоговое окно подтвердить, что пользователь указал имя существующего файла, установите флаг **ОФН \_ выполнить операцию filemustexist** .</span><span class="sxs-lookup"><span data-stu-id="568ff-211">To force the dialog box to verify that the user specified the name of an existing file, set the **OFN\_FILEMUSTEXIST** flag.</span></span> <span data-ttu-id="568ff-212">Чтобы принудительно выполнить проверку того, что указанный путь существует, установите флаг **ОФН \_ пасмустексист** .</span><span class="sxs-lookup"><span data-stu-id="568ff-212">To force verification that the specified path exists, set the **OFN\_PATHMUSTEXIST** flag.</span></span> <span data-ttu-id="568ff-213">Если установлен флаг **ОФН \_ креатепромпт** , то диалоговое окно запрашивает у пользователя разрешение на создание несуществующего файла.</span><span class="sxs-lookup"><span data-stu-id="568ff-213">If you set the **OFN\_CREATEPROMPT** flag, the dialog box prompts the user for permission to create a nonexistent file.</span></span> <span data-ttu-id="568ff-214">Если этот флаг установлен и пользователь выбирает создание нового файла, диалоговое окно закрывается, а функция возвращает указанное имя.</span><span class="sxs-lookup"><span data-stu-id="568ff-214">If this flag is set and the user chooses to create a new file, the dialog box closes, and the function returns the specified name.</span></span> <span data-ttu-id="568ff-215">В противном случае диалоговое окно остается открытым.</span><span class="sxs-lookup"><span data-stu-id="568ff-215">Otherwise, the dialog box remains open.</span></span>

<span data-ttu-id="568ff-216">При использовании диалогового окна **Сохранить как** можно направлять диалоговое окно, предлагающее пользователю запросить разрешение на перезапись существующего файла, установив флаг **ОФН \_ овервритепромпт** .</span><span class="sxs-lookup"><span data-stu-id="568ff-216">When using the **Save As** dialog box, you can direct the dialog box to prompt the user for permission to overwrite an existing file by setting the **OFN\_OVERWRITEPROMPT** flag.</span></span>

<span data-ttu-id="568ff-217">По умолчанию диалоговое окно создает тестовый файл нулевой длины, чтобы определить, можно ли создать новый файл в выбранном каталоге.</span><span class="sxs-lookup"><span data-stu-id="568ff-217">By default, the dialog box creates a zero-length test file to determine whether a new file can be created in the selected directory.</span></span> <span data-ttu-id="568ff-218">Чтобы предотвратить создание этого тестового файла, установите флаг **ОФН \_ нотестфилекреате** .</span><span class="sxs-lookup"><span data-stu-id="568ff-218">To prevent the creation of this test file, set the **OFN\_NOTESTFILECREATE** flag.</span></span>

<span data-ttu-id="568ff-219">При включении процедуры-обработчика диалоговое окно уведомляет процедуру-обработчик о том, что для имени файла, указанного пользователем, возникает нарушение общего доступа к сети.</span><span class="sxs-lookup"><span data-stu-id="568ff-219">If you enable a hook procedure, the dialog box notifies your hook procedure when a network sharing violation occurs for the file name specified by the user.</span></span> <span data-ttu-id="568ff-220">Если установлен флаг **\_ обозревателя ОФН** , то диалоговое окно отправляет сообщение [**CDN \_ шаревиолатион**](cdn-shareviolation.md) в процедуру обработки.</span><span class="sxs-lookup"><span data-stu-id="568ff-220">If you set the **OFN\_EXPLORER** flag, the dialog box sends the [**CDN\_SHAREVIOLATION**](cdn-shareviolation.md) message to the hook procedure.</span></span> <span data-ttu-id="568ff-221">Если не задать **ОФН \_ Explorer**, диалоговое окно отправляет в процедуру обработчика зарегистрированное [**шаревистринг**](sharevistring.md) сообщение.</span><span class="sxs-lookup"><span data-stu-id="568ff-221">If you do not set **OFN\_EXPLORER**, the dialog box sends the [**SHAREVISTRING**](sharevistring.md) registered message to the hook procedure.</span></span> <span data-ttu-id="568ff-222">Чтобы запретить диалоговому окну отправлять уведомления о нарушениях общего доступа, установите флаг **ОФН \_ шареаваре** .</span><span class="sxs-lookup"><span data-stu-id="568ff-222">To prevent the dialog box from sending any notifications for sharing violations, set the **OFN\_SHAREAWARE** flag.</span></span>

<span data-ttu-id="568ff-223">Если пользователь устанавливает флажок только для чтения, то диалоговое окно устанавливает флаг **ОФН \_ ReadOnly** для возврата.</span><span class="sxs-lookup"><span data-stu-id="568ff-223">If the user selects the read-only check box, the dialog box sets the **OFN\_READONLY** flag on return.</span></span> <span data-ttu-id="568ff-224">Чтобы скрыть флажок **Открыть как только для чтения** , установите флаг **ОФН \_ хидереадонли** .</span><span class="sxs-lookup"><span data-stu-id="568ff-224">To hide the **Open As Read Only** check box, set the **OFN\_HIDEREADONLY** flag.</span></span> <span data-ttu-id="568ff-225">Чтобы диалоговое окно не возвращало имена существующих файлов с атрибутом только для чтения, установите флаг **ОФН \_ нореадонлиретурн** .</span><span class="sxs-lookup"><span data-stu-id="568ff-225">To prevent the dialog box from returning names of existing files that have the read-only attribute, set the **OFN\_NOREADONLYRETURN** flag.</span></span>

<span data-ttu-id="568ff-226">Чтобы запретить диалоговому окну отменять ссылки на файлы ссылок, задайте значение **ОФН \_ нодереференцелинкс** .</span><span class="sxs-lookup"><span data-stu-id="568ff-226">To prevent the dialog box from dereferencing link files, set the **OFN\_NODEREFERENCELINKS** value.</span></span> <span data-ttu-id="568ff-227">В этом случае диалоговое окно возвращает имя файла ссылки, а не имя файла, на который ссылается файл ссылки.</span><span class="sxs-lookup"><span data-stu-id="568ff-227">In this case, the dialog box returns the name of the link file rather than the name of the file referenced by the link file.</span></span>

## <a name="open-and-save-as-dialog-box-customization"></a><span data-ttu-id="568ff-228">Настройка диалогового окна "открыть и сохранить как"</span><span class="sxs-lookup"><span data-stu-id="568ff-228">Open and Save As Dialog Box Customization</span></span>

<span data-ttu-id="568ff-229">Диалоговое окно **Открыть** или **Сохранить как** можно настроить, предоставив процедуру-обработчик, пользовательский шаблон или и то, и другое.</span><span class="sxs-lookup"><span data-stu-id="568ff-229">You can customize an **Open** or **Save As** dialog box by providing a hook procedure, a custom template, or both.</span></span> <span data-ttu-id="568ff-230">Однако версии диалоговых окон в стиле обозревателя и старого стиля отличаются использованием пользовательских шаблонов и процедур-обработчиков.</span><span class="sxs-lookup"><span data-stu-id="568ff-230">However, the Explorer-style and old-style versions of the dialog boxes differ in their use of custom templates and hook procedures.</span></span>

<span data-ttu-id="568ff-231">Сведения о настройке диалогового окна в стиле обозревателя см. в разделе [процедуры-обработчики](#explorer-style-hook-procedures)в стиле обозревателя, [пользовательские шаблоны в стиле обозревателя](#explorer-style-custom-templates)и [идентификаторы элементов управления в стиле обозревателя](#explorer-style-control-identifiers).</span><span class="sxs-lookup"><span data-stu-id="568ff-231">For information about customizing an Explorer-style dialog box, see [Explorer-Style Hook Procedures](#explorer-style-hook-procedures), [Explorer-Style Custom Templates](#explorer-style-custom-templates), and [Explorer-Style Control Identifiers](#explorer-style-control-identifiers).</span></span> <span data-ttu-id="568ff-232">Сведения о настройке диалогового окна старого стиля см. в разделе [Настройка диалоговых окон Old-Style](#customizing-old-style-dialog-boxes).</span><span class="sxs-lookup"><span data-stu-id="568ff-232">For information about customizing an old-style dialog box, see [Customizing Old-Style Dialog Boxes](#customizing-old-style-dialog-boxes).</span></span>

<span data-ttu-id="568ff-233">В следующей таблице приведены различия между двумя стилями.</span><span class="sxs-lookup"><span data-stu-id="568ff-233">The following table summarizes the differences between the two styles.</span></span>



| <span data-ttu-id="568ff-234">Настройка</span><span class="sxs-lookup"><span data-stu-id="568ff-234">Customization</span></span>                  | <span data-ttu-id="568ff-235">Описание</span><span class="sxs-lookup"><span data-stu-id="568ff-235">Description</span></span>                                                                                                                                                                                                                                                                          |
|--------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="568ff-236">Процедура обработчика в стиле обозревателя</span><span class="sxs-lookup"><span data-stu-id="568ff-236">Explorer-style Hook procedure</span></span>  | <span data-ttu-id="568ff-237">Процедура-обработчик получает сообщения уведомления, отправленные из общего диалогового окна, и сообщения для любых дополнительных элементов управления, определенных с помощью шаблона дочернего диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-237">The hook procedure receives notification messages sent from the common dialog box and messages for any additional controls that you defined by specifying a child dialog template.</span></span> <span data-ttu-id="568ff-238">Процедура-обработчик не получает сообщения для стандартных элементов управления диалогового окна по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="568ff-238">The hook procedure does not receive messages for the standard controls of the default dialog box.</span></span> |
| <span data-ttu-id="568ff-239">Пользовательский шаблон в стиле обозревателя</span><span class="sxs-lookup"><span data-stu-id="568ff-239">Explorer-style Custom template</span></span> | <span data-ttu-id="568ff-240">Система использует пользовательский шаблон для создания дочернего диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-240">The system uses the custom template to create a child dialog box.</span></span> <span data-ttu-id="568ff-241">Шаблон может определять дополнительные элементы управления, а также указывать расположение кластера стандартных элементов управления.</span><span class="sxs-lookup"><span data-stu-id="568ff-241">The template can define additional controls, and can specify the location of the cluster of standard controls.</span></span> <span data-ttu-id="568ff-242">Пользовательский шаблон не заменяет шаблон по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="568ff-242">The custom template does not replace the default template.</span></span>                                          |
| <span data-ttu-id="568ff-243">Процедура обработчика старого стиля</span><span class="sxs-lookup"><span data-stu-id="568ff-243">Old-style Hook procedure</span></span>       | <span data-ttu-id="568ff-244">Процедура-обработчик получает все сообщения, отправленные в диалоговое окно, включая сообщения для стандартных элементов управления и пользовательских элементов управления.</span><span class="sxs-lookup"><span data-stu-id="568ff-244">The hook procedure receives all messages sent to the dialog box, including messages for the standard controls and any custom controls.</span></span> <span data-ttu-id="568ff-245">Процедура-ловушка также получает зарегистрированные сообщения, отправленные из общего диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-245">The hook procedure also receives registered messages sent from the common dialog box.</span></span>                                                         |
| <span data-ttu-id="568ff-246">Пользовательский шаблон старого стиля</span><span class="sxs-lookup"><span data-stu-id="568ff-246">Old-style Custom template</span></span>      | <span data-ttu-id="568ff-247">Пользовательский шаблон заменяет шаблон по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="568ff-247">The custom template replaces the default template.</span></span> <span data-ttu-id="568ff-248">Создайте пользовательский шаблон, изменив шаблон по умолчанию, указанный в файле FileOpen. DLG.</span><span class="sxs-lookup"><span data-stu-id="568ff-248">Create the custom template by modifying the default template specified in the Fileopen.dlg file.</span></span>                                                                                                                                  |



 

<span data-ttu-id="568ff-249">Заголовок по умолчанию для диалоговых окон как в стиле обозревателя, так и в старом стиле — "**Открыть**" или "**Сохранить как**".</span><span class="sxs-lookup"><span data-stu-id="568ff-249">The default title for both Explorer-style and old-style dialog boxes is either "**Open**" or "**Save As**."</span></span> <span data-ttu-id="568ff-250">Чтобы изменить заголовок, укажите новый заголовок в элементе **лпстртитле** структуры [**OpenFileName**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) .</span><span class="sxs-lookup"><span data-stu-id="568ff-250">To change the title, specify the new title in the **lpstrTitle** member of the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure.</span></span>

<span data-ttu-id="568ff-251">Куст реестра **hKey для \_ текущего \_ пользователя** , содержащийся в разделе, может содержать значения, которые настраивают содержимое диалоговых окон « **Открытие** » и « **Сохранение** » в стиле обозревателя.</span><span class="sxs-lookup"><span data-stu-id="568ff-251">A user's **HKEY\_CURRENT\_USER** registry hive can contain values that customize the contents of the Explorer-style **Open** and **Save As** dialog boxes.</span></span> <span data-ttu-id="568ff-252">Эти записи реестра затрагивают только диалоговые окна, отображаемые для пользователя, связанного с кустом реестра.</span><span class="sxs-lookup"><span data-stu-id="568ff-252">These registry entries affect only the dialog boxes displayed for the user associated with the registry hive.</span></span>

<span data-ttu-id="568ff-253">Чтобы скрыть возможности диалоговых окон « **Открыть** » и « **Сохранить как** » в стиле обозревателя, администратор может задать значения в следующей таблице в этом подразделе:</span><span class="sxs-lookup"><span data-stu-id="568ff-253">To hide features of Explorer-style **Open** and **Save As** dialog boxes, an administrator can set the values in the following table under this subkey:</span></span>

```
HKEY_CURRENT_USER
   Software
      Microsoft
         Windows
            CurrentVersion
               Policies
                  Comdlg32
```



| <span data-ttu-id="568ff-254">Имя значения</span><span class="sxs-lookup"><span data-stu-id="568ff-254">Value name</span></span>       | <span data-ttu-id="568ff-255">Значение</span><span class="sxs-lookup"><span data-stu-id="568ff-255">Value</span></span> | <span data-ttu-id="568ff-256">Значение</span><span class="sxs-lookup"><span data-stu-id="568ff-256">Meaning</span></span>                                  |
|------------------|-------|------------------------------------------|
| <span data-ttu-id="568ff-257">**ноплацесбар**</span><span class="sxs-lookup"><span data-stu-id="568ff-257">**NoPlacesBar**</span></span>  | <span data-ttu-id="568ff-258">1</span><span class="sxs-lookup"><span data-stu-id="568ff-258">1</span></span>     | <span data-ttu-id="568ff-259">Скрывает панель мест.</span><span class="sxs-lookup"><span data-stu-id="568ff-259">Hides the places bar.</span></span>                    |
| <span data-ttu-id="568ff-260">**нофилемру**</span><span class="sxs-lookup"><span data-stu-id="568ff-260">**NoFileMRU**</span></span>    | <span data-ttu-id="568ff-261">1</span><span class="sxs-lookup"><span data-stu-id="568ff-261">1</span></span>     | <span data-ttu-id="568ff-262">Скрывает список недавно использованных (MRU) списков.</span><span class="sxs-lookup"><span data-stu-id="568ff-262">Hides the Most Recently Used (MRU) list.</span></span> |
| <span data-ttu-id="568ff-263">**нобаккбуттон**</span><span class="sxs-lookup"><span data-stu-id="568ff-263">**NoBackButton**</span></span> | <span data-ttu-id="568ff-264">1</span><span class="sxs-lookup"><span data-stu-id="568ff-264">1</span></span>     | <span data-ttu-id="568ff-265">Скрывает кнопку " **назад** ".</span><span class="sxs-lookup"><span data-stu-id="568ff-265">Hides the **Back** button.</span></span>               |



 

<span data-ttu-id="568ff-266">Содержимое панели **мест** определяется содержимым следующего подраздела:</span><span class="sxs-lookup"><span data-stu-id="568ff-266">The contents of the **Places** bar are determined by the contents of the following subkey:</span></span>

```
HKEY_CURRENT_USER
   Software
      Microsoft
         Windows
            CurrentVersion
               Policies
                  Comdlg32
                     Placesbar
```

<span data-ttu-id="568ff-267">В настоящее время в этом ключе может быть только пять записей, а индекс значения или имени — от нуля.</span><span class="sxs-lookup"><span data-stu-id="568ff-267">Currently, there can only be five entries under this key, and the value/name index is zero-based.</span></span> <span data-ttu-id="568ff-268">Имена записей должны быть Place0, Place1, Place2, Place3 и Place4.</span><span class="sxs-lookup"><span data-stu-id="568ff-268">The names for the entries should be Place0, Place1, Place2,Place3, and Place4.</span></span> <span data-ttu-id="568ff-269">Значения записей могут быть значениями **reg \_ DWORD**, **reg \_ SZ** или **reg \_ expand \_ SZ** , которые указывают расположения для включения в панель мест.</span><span class="sxs-lookup"><span data-stu-id="568ff-269">The values of the entries can be **REG\_DWORD**, **REG\_SZ**, or **REG\_EXPAND\_SZ** values that identify locations to include in the places bar.</span></span>



| <span data-ttu-id="568ff-270">Тип значения</span><span class="sxs-lookup"><span data-stu-id="568ff-270">Value type</span></span>                         | <span data-ttu-id="568ff-271">Значение</span><span class="sxs-lookup"><span data-stu-id="568ff-271">Meaning</span></span>                                                                                                   |
|------------------------------------|-----------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="568ff-272">**REG \_ DWORD**</span><span class="sxs-lookup"><span data-stu-id="568ff-272">**REG\_DWORD**</span></span>                     | <span data-ttu-id="568ff-273">Значение CSID, идентифицирующее папку.</span><span class="sxs-lookup"><span data-stu-id="568ff-273">A CSIDL value that identifies a folder.</span></span> <span data-ttu-id="568ff-274">Список значений CSID см. в разделе [**значения CSid**](../shell/csidl.md).</span><span class="sxs-lookup"><span data-stu-id="568ff-274">For a list of CSIDL values, see [**CSIDL values**](../shell/csidl.md).</span></span> |
| <span data-ttu-id="568ff-275">**Reg \_ SZ** или **reg \_ expand \_ SZ**</span><span class="sxs-lookup"><span data-stu-id="568ff-275">**REG\_SZ** or **REG\_EXPAND\_SZ**</span></span> | <span data-ttu-id="568ff-276">Строка, завершающаяся нулем и указывающая допустимый путь.</span><span class="sxs-lookup"><span data-stu-id="568ff-276">A null-terminated string that specifies a valid path.</span></span>                                                     |



 

## <a name="explorer-style-hook-procedures"></a><span data-ttu-id="568ff-277">Explorer-Style процедуры-обработчики</span><span class="sxs-lookup"><span data-stu-id="568ff-277">Explorer-Style Hook Procedures</span></span>

<span data-ttu-id="568ff-278">Можно настроить диалоговое окно **Открытие** или **Сохранение в** стиле обозревателя, предоставив процедуру-обработчик, пользовательский шаблон или и то, и другое.</span><span class="sxs-lookup"><span data-stu-id="568ff-278">You can customize an Explorer-style **Open** or **Save As** dialog box by providing a hook procedure, a custom template, or both.</span></span> <span data-ttu-id="568ff-279">При предоставлении процедуры-обработчика для диалогового окна в стиле обозревателя система создает диалоговое окно, которое является дочерним по отношению к диалоговому окну по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="568ff-279">If you provide a hook procedure for an Explorer-style dialog box, the system creates a dialog box that is a child of the default dialog box.</span></span> <span data-ttu-id="568ff-280">Процедура-обработчик выступает в качестве процедуры диалогового окна для дочернего диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-280">The hook procedure acts as the dialog procedure for the child dialog box.</span></span> <span data-ttu-id="568ff-281">Это дочернее диалоговое окно основано на пользовательском шаблоне или в шаблоне по умолчанию, если он не указан.</span><span class="sxs-lookup"><span data-stu-id="568ff-281">This child dialog box is based on the custom template, or on a default template if none is provided.</span></span> <span data-ttu-id="568ff-282">Дополнительные сведения см. в разделе [пользовательские шаблоны в стиле обозревателя](#explorer-style-custom-templates).</span><span class="sxs-lookup"><span data-stu-id="568ff-282">For more information, see [Explorer-Style Custom Templates](#explorer-style-custom-templates).</span></span>

<span data-ttu-id="568ff-283">Чтобы включить процедуру-обработчик для диалогового окна « **Открыть** » или « **Сохранить как** » в стиле обозревателя, используйте структуру [**OpenFileName**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) при создании диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-283">To enable a hook procedure for an Explorer-style **Open** or **Save As** dialog box, use the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure when you create the dialog box.</span></span> <span data-ttu-id="568ff-284">Задайте флаги **ОФН \_ Енаблехук** и **ОФН \_ Explorer** в элементе **flags** и укажите адрес процедуры-обработчика [**офнхукпрок**](/windows/win32/api/commdlg/nc-commdlg-lpofnhookproc) в элементе **лпфнхук** .</span><span class="sxs-lookup"><span data-stu-id="568ff-284">Set the **OFN\_ENABLEHOOK** and **OFN\_EXPLORER** flags in the **Flags** member and specify the address of an [**OFNHookProc**](/windows/win32/api/commdlg/nc-commdlg-lpofnhookproc) hook procedure in the **lpfnHook** member.</span></span> <span data-ttu-id="568ff-285">При предоставлении процедуры-обработчика и пропущении флага **\_ обозревателя ОФН** необходимо использовать процедуру-обработчик [**офнхукпроколдстиле**](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)) , и вы получите пользовательский интерфейс старого стиля.</span><span class="sxs-lookup"><span data-stu-id="568ff-285">If you provide a hook procedure and omit the **OFN\_EXPLORER** flag, you must use an [**OFNHookProcOldStyle**](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)) hook procedure and you will get the old-style user-interface.</span></span> <span data-ttu-id="568ff-286">Дополнительные сведения см. в разделе [Настройка диалоговых окон Old-Style](#customizing-old-style-dialog-boxes).</span><span class="sxs-lookup"><span data-stu-id="568ff-286">For more information, see [Customizing Old-Style Dialog Boxes](#customizing-old-style-dialog-boxes).</span></span>

<span data-ttu-id="568ff-287">При открытии диалогового окна процедура обработчика в стиле обозревателя получает разнообразные сообщения.</span><span class="sxs-lookup"><span data-stu-id="568ff-287">An Explorer-style hook procedure receives a variety of messages while the dialog box is open.</span></span> <span data-ttu-id="568ff-288">следующие основные параметры.</span><span class="sxs-lookup"><span data-stu-id="568ff-288">These include the following:</span></span>

-   <span data-ttu-id="568ff-289">Сообщение [**WM \_ инитдиалог**](wm-initdialog.md) и другие стандартные сообщения диалогового окна, такие как сообщение цвета элемента управления [**WM \_ ктлколордлг**](wm-ctlcolordlg.md) .</span><span class="sxs-lookup"><span data-stu-id="568ff-289">The [**WM\_INITDIALOG**](wm-initdialog.md) message and other standard dialog box messages such as the [**WM\_CTLCOLORDLG**](wm-ctlcolordlg.md) control color message.</span></span>
-   <span data-ttu-id="568ff-290">Набор сообщений уведомления [**WM \_ Notify**](../controls/wm-notify.md) , указывающий действия, выполняемые пользователем или другим событием диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-290">A set of [**WM\_NOTIFY**](../controls/wm-notify.md) notification messages indicating actions taken by the user or other dialog box events.</span></span>
-   <span data-ttu-id="568ff-291">Сообщения для любых дополнительных элементов управления, определенных путем указания дочернего шаблона диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-291">Messages for any additional controls that you defined by specifying a child dialog template.</span></span>

<span data-ttu-id="568ff-292">Кроме того, существует набор сообщений, которые можно отправить в диалоговое окно в стиле обозревателя для получения сведений или управления поведением и внешним видом диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-292">In addition, there is a set of messages that you can send to an Explorer-style dialog box to get information or to control the behavior and appearance of the dialog box.</span></span>

<span data-ttu-id="568ff-293">При предоставлении процедуры-обработчика для диалогового окна в стиле обозревателя процедура диалогового окна по умолчанию создает дочернее диалоговое окно, когда процедура диалогового окна по умолчанию обрабатывает сообщение [**WM \_ инитдиалог**](wm-initdialog.md) .</span><span class="sxs-lookup"><span data-stu-id="568ff-293">If you provide a hook procedure for an Explorer-style dialog box, the default dialog box procedure creates a child dialog box when the default dialog procedure is processing its [**WM\_INITDIALOG**](wm-initdialog.md) message.</span></span> <span data-ttu-id="568ff-294">Процедура-обработчик выступает в качестве процедуры диалогового окна для дочернего диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-294">The hook procedure acts as the dialog procedure for the child dialog box.</span></span> <span data-ttu-id="568ff-295">В настоящее время процедура-обработчик получает собственное сообщение **WM \_ инитдиалог** с параметром *lParam* , равным адресу структуры [**OpenFileName**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) , используемой для инициализации диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-295">At this time, the hook procedure receives its own **WM\_INITDIALOG** message with the *lParam* parameter set to the address of the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure used to initialize the dialog box.</span></span> <span data-ttu-id="568ff-296">После того как дочерний диалог завершает обработку своего сообщения **\_ инитдиалог WM** , процедура диалогового окна по умолчанию при необходимости перемещает стандартные элементы управления, чтобы освободить место для любых дополнительных элементов управления дочернего диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-296">After the child dialog finishes processing its own **WM\_INITDIALOG** message, the default dialog procedure moves the standard controls, if necessary, to make room for any additional controls of the child dialog box.</span></span> <span data-ttu-id="568ff-297">Затем процедура диалогового окна по умолчанию отправляет сообщение уведомления [**CDN \_ инитдоне**](cdn-initdone.md) в процедуру-обработчик.</span><span class="sxs-lookup"><span data-stu-id="568ff-297">The default dialog procedure then sends the [**CDN\_INITDONE**](cdn-initdone.md) notification message to the hook procedure.</span></span>

<span data-ttu-id="568ff-298">Процедура-обработчик получает уведомления [**WM \_ Notify**](../controls/wm-notify.md) , указывающие действия, выполняемые пользователем в диалоговом окне.</span><span class="sxs-lookup"><span data-stu-id="568ff-298">The hook procedure receives [**WM\_NOTIFY**](../controls/wm-notify.md) notification messages indicating actions taken by the user in the dialog box.</span></span> <span data-ttu-id="568ff-299">Некоторые из этих сообщений можно использовать для управления поведением диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-299">You can use some of these messages to control the behavior of the dialog box.</span></span> <span data-ttu-id="568ff-300">Например, процедура-обработчик получает сообщение [**\_ филеок CDN**](cdn-fileok.md) , когда пользователь выбирает имя файла и нажимает кнопку **ОК** .</span><span class="sxs-lookup"><span data-stu-id="568ff-300">For example, the hook procedure receives the [**CDN\_FILEOK**](cdn-fileok.md) message when the user chooses a file name and clicks the **OK** button.</span></span> <span data-ttu-id="568ff-301">В ответ на это сообщение процедура-обработчик может использовать функцию [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga) , чтобы отклонить выбранное имя и принудительно оставить диалоговое окно открытым.</span><span class="sxs-lookup"><span data-stu-id="568ff-301">In response to this message, the hook procedure can use the [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga) function to reject the selected name and force the dialog box to remain open.</span></span>

<span data-ttu-id="568ff-302">Параметр *lParam* для каждого сообщения [**с \_ уведомлением WM**](../controls/wm-notify.md) — это указатель на структуру [**офнотифи**](/windows/desktop/api/Commdlg/ns-commdlg-ofnotifya) или [**офнотифекс**](/windows/desktop/api/Commdlg/ns-commdlg-ofnotifyexa) , определяющую действие.</span><span class="sxs-lookup"><span data-stu-id="568ff-302">The *lParam* parameter for each [**WM\_NOTIFY**](../controls/wm-notify.md) message is a pointer to an [**OFNOTIFY**](/windows/desktop/api/Commdlg/ns-commdlg-ofnotifya) or [**OFNOTIFYEX**](/windows/desktop/api/Commdlg/ns-commdlg-ofnotifyexa) structure that defines the action.</span></span> <span data-ttu-id="568ff-303">Элемент **Code** в заголовке этой структуры содержит одно из следующих сообщений уведомления.</span><span class="sxs-lookup"><span data-stu-id="568ff-303">The **code** member in the header of this structure contains one of the following notification messages.</span></span>



| <span data-ttu-id="568ff-304">Сообщение</span><span class="sxs-lookup"><span data-stu-id="568ff-304">Message</span></span>                                           | <span data-ttu-id="568ff-305">Значение</span><span class="sxs-lookup"><span data-stu-id="568ff-305">Meaning</span></span>                                                                                                                                                                                                                                                                                        |
|---------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="568ff-306">**\_ФИЛЕОК CDN**</span><span class="sxs-lookup"><span data-stu-id="568ff-306">**CDN\_FILEOK**</span></span>](cdn-fileok.md)                 | <span data-ttu-id="568ff-307">Пользователь нащелкнул кнопку **ОК** ; диалоговое окно скоро закроется.</span><span class="sxs-lookup"><span data-stu-id="568ff-307">The user clicked the **OK** button; the dialog box is about to close.</span></span>                                                                                                                                                                                                                          |
| [<span data-ttu-id="568ff-308">**\_ФОЛДЕРЧАНЖЕ CDN**</span><span class="sxs-lookup"><span data-stu-id="568ff-308">**CDN\_FOLDERCHANGE**</span></span>](cdn-folderchange.md)     | <span data-ttu-id="568ff-309">Пользователь открыл новую папку или каталог.</span><span class="sxs-lookup"><span data-stu-id="568ff-309">The user opened a new folder or directory.</span></span>                                                                                                                                                                                                                                                     |
| [<span data-ttu-id="568ff-310">**\_Справка CDN**</span><span class="sxs-lookup"><span data-stu-id="568ff-310">**CDN\_HELP**</span></span>](cdn-help.md)                     | <span data-ttu-id="568ff-311">Пользователь щелкнул кнопку **Справка** .</span><span class="sxs-lookup"><span data-stu-id="568ff-311">The user clicked the **Help** button.</span></span>                                                                                                                                                                                                                                                          |
| [<span data-ttu-id="568ff-312">**\_ИНКЛУДЕИТЕМ CDN**</span><span class="sxs-lookup"><span data-stu-id="568ff-312">**CDN\_INCLUDEITEM**</span></span>](cdn-includeitem.md)       | <span data-ttu-id="568ff-313">Определяет, должен ли отображаться элемент.</span><span class="sxs-lookup"><span data-stu-id="568ff-313">Determines whether an item should be displayed.</span></span> <span data-ttu-id="568ff-314">Когда пользователь открывает новую папку или каталог, система отправляет это уведомление для каждого элемента в папке или каталоге.</span><span class="sxs-lookup"><span data-stu-id="568ff-314">When the user opens a new folder or directory, the system sends this notification for each item in the folder or directory.</span></span> <span data-ttu-id="568ff-315">Система отправляет это уведомление только в том случае, если установлен флаг **ОФН \_ енаблеинклуденотифи** .</span><span class="sxs-lookup"><span data-stu-id="568ff-315">The system sends this notification only if the **OFN\_ENABLEINCLUDENOTIFY** flag was set.</span></span>                          |
| [<span data-ttu-id="568ff-316">**\_ИНИТДОНЕ CDN**</span><span class="sxs-lookup"><span data-stu-id="568ff-316">**CDN\_INITDONE**</span></span>](cdn-initdone.md)             | <span data-ttu-id="568ff-317">Система завершила инициализацию диалогового окна, и диалоговое окно завершило обработку сообщения [**WM \_ инитдиалог**](wm-initdialog.md) .</span><span class="sxs-lookup"><span data-stu-id="568ff-317">The system has finished initializing the dialog box, and the dialog box has finished processing the [**WM\_INITDIALOG**](wm-initdialog.md) message.</span></span> <span data-ttu-id="568ff-318">Кроме того, система завершила компоновку элементов управления в общем диалоговом окне, чтобы освободить место для элементов управления дочернего диалогового окна (если оно есть).</span><span class="sxs-lookup"><span data-stu-id="568ff-318">Also, the system has finished arranging controls in the common dialog box to make room for the controls of the child dialog box (if any).</span></span> |
| [<span data-ttu-id="568ff-319">**\_СЕЛЧАНЖЕ CDN**</span><span class="sxs-lookup"><span data-stu-id="568ff-319">**CDN\_SELCHANGE**</span></span>](cdn-selchange.md)           | <span data-ttu-id="568ff-320">Пользователь выбрал новый файл или папку из списка файлов.</span><span class="sxs-lookup"><span data-stu-id="568ff-320">The user selected a new file or folder from the file list.</span></span>                                                                                                                                                                                                                                     |
| [<span data-ttu-id="568ff-321">**\_ШАРЕВИОЛАТИОН CDN**</span><span class="sxs-lookup"><span data-stu-id="568ff-321">**CDN\_SHAREVIOLATION**</span></span>](cdn-shareviolation.md) | <span data-ttu-id="568ff-322">В общем диалоговом окне произошло нарушение совместного доступа к файлу, который должен быть возвращен.</span><span class="sxs-lookup"><span data-stu-id="568ff-322">The common dialog box encountered a sharing violation on the file about to be returned.</span></span>                                                                                                                                                                                                        |
| [<span data-ttu-id="568ff-323">**\_ТИПЕЧАНЖЕ CDN**</span><span class="sxs-lookup"><span data-stu-id="568ff-323">**CDN\_TYPECHANGE**</span></span>](cdn-typechange.md)         | <span data-ttu-id="568ff-324">Пользователь выбрал новый тип файла из списка типов файлов.</span><span class="sxs-lookup"><span data-stu-id="568ff-324">The user selected a new file type from the list of file types.</span></span>                                                                                                                                                                                                                                 |



 

<span data-ttu-id="568ff-325">Эти [**сообщения WM \_ Notify**](../controls/wm-notify.md) заменяют зарегистрированные сообщения [**филеокстринг**](fileokstring.md), [**лбселчстринг**](lbselchstring.md), [**шаревистринг**](sharevistring.md)и [**хелпмсгстринг**](helpmsgstring.md) , используемые предыдущими версиями диалоговых окон **Открыть** и **Сохранить как** .</span><span class="sxs-lookup"><span data-stu-id="568ff-325">These [**WM\_NOTIFY**](../controls/wm-notify.md) messages supersede the [**FILEOKSTRING**](fileokstring.md), [**LBSELCHSTRING**](lbselchstring.md), [**SHAREVISTRING**](sharevistring.md), and [**HELPMSGSTRING**](helpmsgstring.md) registered messages used by previous versions of the **Open** and **Save As** dialog boxes.</span></span> <span data-ttu-id="568ff-326">Однако процедура-ловушка также получает заменяемое сообщение после сообщения **WM \_ Notify** , если обработка **\_ уведомления WM** не использует [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga) для установки ненулевого значения **\_ мсгресулт DWL** .</span><span class="sxs-lookup"><span data-stu-id="568ff-326">However, the hook procedure also receives the superseded message after the **WM\_NOTIFY** message if the **WM\_NOTIFY** processing does not use [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga) to set a nonzero **DWL\_MSGRESULT** value.</span></span>

<span data-ttu-id="568ff-327">Чтобы получить сведения о состоянии диалогового окна или управлении поведением и внешним видом диалогового окна, процедура-обработчик может отправить в диалоговое окно следующие сообщения.</span><span class="sxs-lookup"><span data-stu-id="568ff-327">To retrieve information about the status of the dialog box or to control the behavior and appearance of the dialog box, the hook procedure can send the following messages to the dialog box.</span></span>



| <span data-ttu-id="568ff-328">Сообщение</span><span class="sxs-lookup"><span data-stu-id="568ff-328">Message</span></span>                                             | <span data-ttu-id="568ff-329">Значение</span><span class="sxs-lookup"><span data-stu-id="568ff-329">Meaning</span></span>                                                                                                                                                                                                                  |
|-----------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="568ff-330">**CDM. \_ FilePath**</span><span class="sxs-lookup"><span data-stu-id="568ff-330">**CDM\_GETFILEPATH**</span></span>](cdm-getfilepath.md)         | <span data-ttu-id="568ff-331">Извлекает путь и имя выбранного файла.</span><span class="sxs-lookup"><span data-stu-id="568ff-331">Retrieves the path and file name of the selected file.</span></span>                                                                                                                                                                   |
| [<span data-ttu-id="568ff-332">**CDM \_ жетфолдеридлист**</span><span class="sxs-lookup"><span data-stu-id="568ff-332">**CDM\_GETFOLDERIDLIST**</span></span>](cdm-getfolderidlist.md) | <span data-ttu-id="568ff-333">Извлекает список идентификаторов элементов, соответствующий текущей папке, открытой в этом диалоговом окне.</span><span class="sxs-lookup"><span data-stu-id="568ff-333">Retrieves the item identifier list corresponding to the current folder that the dialog box has open.</span></span> <span data-ttu-id="568ff-334">Дополнительные сведения о списках идентификаторов элементов см. в разделе [Введение в пространство имен оболочки](/windows/desktop/shell/namespace-intro).</span><span class="sxs-lookup"><span data-stu-id="568ff-334">For more information about item identifier lists, see [Introduction to the Shell Namespace](/windows/desktop/shell/namespace-intro).</span></span> |
| [<span data-ttu-id="568ff-335">**CDM \_ GETFOLDERPATH**</span><span class="sxs-lookup"><span data-stu-id="568ff-335">**CDM\_GETFOLDERPATH**</span></span>](cdm-getfolderpath.md)     | <span data-ttu-id="568ff-336">Возвращает путь к текущей папке или каталогу для диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-336">Retrieves the path of the current folder or directory for the dialog box.</span></span>                                                                                                                                                |
| [<span data-ttu-id="568ff-337">**CDMая \_ Спецификация**</span><span class="sxs-lookup"><span data-stu-id="568ff-337">**CDM\_GETSPEC**</span></span>](cdm-getspec.md)                 | <span data-ttu-id="568ff-338">Извлекает имя файла (не включая путь) файла, выбранного в данный момент в диалоговом окне.</span><span class="sxs-lookup"><span data-stu-id="568ff-338">Retrieves the file name (not including the path) of the file currently selected in the dialog box.</span></span>                                                                                                                       |
| [<span data-ttu-id="568ff-339">**CDM \_ хидеконтрол**</span><span class="sxs-lookup"><span data-stu-id="568ff-339">**CDM\_HIDECONTROL**</span></span>](cdm-hidecontrol.md)         | <span data-ttu-id="568ff-340">Скрывает указанный элемент управления.</span><span class="sxs-lookup"><span data-stu-id="568ff-340">Hides the specified control.</span></span>                                                                                                                                                                                             |
| [<span data-ttu-id="568ff-341">**CDM \_ сетконтролтекст**</span><span class="sxs-lookup"><span data-stu-id="568ff-341">**CDM\_SETCONTROLTEXT**</span></span>](cdm-setcontroltext.md)   | <span data-ttu-id="568ff-342">Задает текст в указанном элементе управления.</span><span class="sxs-lookup"><span data-stu-id="568ff-342">Sets the text in the specified control.</span></span>                                                                                                                                                                                  |
| [<span data-ttu-id="568ff-343">**CDM \_ сетдефекст**</span><span class="sxs-lookup"><span data-stu-id="568ff-343">**CDM\_SETDEFEXT**</span></span>](cdm-setdefext.md)             | <span data-ttu-id="568ff-344">Задает расширение имени файла по умолчанию для диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-344">Sets the default file name extension for the dialog box.</span></span>                                                                                                                                                                 |



 

## <a name="explorer-style-custom-templates"></a><span data-ttu-id="568ff-345">Explorer-Style пользовательских шаблонов</span><span class="sxs-lookup"><span data-stu-id="568ff-345">Explorer-Style Custom Templates</span></span>

<span data-ttu-id="568ff-346">Чтобы определить дополнительные элементы управления для диалогового окна **Открытие** или **Сохранение в** стиле обозревателя, используйте структуру [**OpenFileName**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) , чтобы указать шаблон для дочернего диалогового окна, содержащего дополнительные элементы управления.</span><span class="sxs-lookup"><span data-stu-id="568ff-346">To define additional controls for an Explorer-style **Open** or **Save As** dialog box, use the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure to specify a template for a child dialog box that contains the additional controls.</span></span> <span data-ttu-id="568ff-347">Если ваш дочерний шаблон диалогового окна является ресурсом в приложении или библиотеке динамической компоновки, установите флаг **ОФН \_ енаблетемплате** в элементе **flags** и используйте элементы **HINSTANCE** и **лптемплатенаме** структуры, чтобы определить имя модуля и ресурса.</span><span class="sxs-lookup"><span data-stu-id="568ff-347">If your child dialog template is a resource in an application or dynamic-link library, set the **OFN\_ENABLETEMPLATE** flag in the **Flags** member and use the **hInstance** and **lpTemplateName** members of the structure to identify the module and resource name.</span></span> <span data-ttu-id="568ff-348">Если шаблон уже находится в памяти, установите флаг **ОФН \_ енаблетемплатехандле** и используйте элемент **HINSTANCE** , чтобы определить объект памяти, содержащий шаблон.</span><span class="sxs-lookup"><span data-stu-id="568ff-348">If the template is already in memory, set the **OFN\_ENABLETEMPLATEHANDLE** flag and use the **hInstance** member to identify the memory object that contains the template.</span></span> <span data-ttu-id="568ff-349">При предоставлении шаблона диалогового окна для диалогового окна в стиле обозревателя необходимо также установить флаг **\_ обозревателя ОФН** . в противном случае система предполагает, что вы предоставляли шаблон замены для диалогового окна старого стиля.</span><span class="sxs-lookup"><span data-stu-id="568ff-349">When providing a child dialog template for an Explorer-style dialog box, you must also set the **OFN\_EXPLORER** flag; otherwise, the system assumes you are providing a replacement template for an old-style dialog box.</span></span> <span data-ttu-id="568ff-350">Как правило, при предоставлении дополнительных элементов управления необходимо также предоставить [процедуру обработчика в стиле обозревателя](#explorer-style-hook-procedures) для обработки сообщений для новых элементов управления.</span><span class="sxs-lookup"><span data-stu-id="568ff-350">Typically, if you provide additional controls, you must also provide an [Explorer-style hook procedure](#explorer-style-hook-procedures) to process messages for the new controls.</span></span>

<span data-ttu-id="568ff-351">Вы можете создать свой дочерний шаблон диалогового окна, как и любой другой шаблон, за исключением того, что необходимо указать стили **WS \_ Child** и **WS \_ клипсиблингс** и указать стили **DS \_ 3DLOOK** и **\_ управления DS** .</span><span class="sxs-lookup"><span data-stu-id="568ff-351">You can create your child dialog box template as you do any other template, except that you must specify the **WS\_CHILD** and **WS\_CLIPSIBLINGS** styles and should specify the **DS\_3DLOOK** and **DS\_CONTROL** styles.</span></span> <span data-ttu-id="568ff-352">Для работы системы требуется **стиль \_ дочернего элемента WS** , так как шаблон определяет дочернее диалоговое окно **открытия** или **сохранения** по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="568ff-352">The system requires the **WS\_CHILD** style because your template defines a child dialog of the default **Open** or **Save As** dialog box.</span></span> <span data-ttu-id="568ff-353">Стиль **WS \_ клипсиблингс** гарантирует, что дочернее диалоговое окно не будет перерисовываться над любыми элементами управления в диалоговом окне по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="568ff-353">The **WS\_CLIPSIBLINGS** style ensures that the child dialog box does not paint over any of the controls in the default dialog box.</span></span> <span data-ttu-id="568ff-354">Стиль **\_ 3DLOOK в DS** гарантирует, что внешний вид элементов управления в дочернем диалоговом окне будет соответствовать элементам управления в диалоговом окне по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="568ff-354">The **DS\_3DLOOK** style makes sure that the appearance of the controls in the child dialog box is consistent with the controls in the default dialog box.</span></span> <span data-ttu-id="568ff-355">Стиль **\_ элемента управления DS** гарантирует, что пользователь может использовать вкладку и другие клавиши навигации для перемещения между всеми элементами управления, по умолчанию или пользовательскими, в диалоговом окне настроено.</span><span class="sxs-lookup"><span data-stu-id="568ff-355">The **DS\_CONTROL** style makes sure that the user can use the TAB and other navigation keys to move between all controls, default or custom, in the customized dialog box.</span></span>

<span data-ttu-id="568ff-356">Чтобы освободить место для новых элементов управления, система раскрывает диалоговое окно по умолчанию по ширине и высоте пользовательского диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-356">To make room for the new controls, the system expands the default dialog box by the width and height of the custom dialog box.</span></span> <span data-ttu-id="568ff-357">По умолчанию все элементы управления из пользовательского диалогового окна располагаются под элементами управления в диалоговом окне по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="568ff-357">By default, all controls from the custom dialog box are positioned below the controls in the default dialog box.</span></span> <span data-ttu-id="568ff-358">Однако можно переопределить это положение по умолчанию, включив Статический элемент управления "текст" в пользовательский шаблон диалогового окна и назначив ему значение идентификатора элемента управления **stc32**.</span><span class="sxs-lookup"><span data-stu-id="568ff-358">However, you can override this default positioning by including a static text control in your custom dialog box template and assigning it the control identifier value of **stc32**.</span></span> <span data-ttu-id="568ff-359">(Это значение определено в файле заголовка Длгс. h.) В этом случае система использует элемент управления в качестве точки ссылки для определения места размещения новых элементов управления.</span><span class="sxs-lookup"><span data-stu-id="568ff-359">(This value is defined in the Dlgs.h header file.) In this case, the system uses the control as the point of reference for determining where to position the new controls.</span></span> <span data-ttu-id="568ff-360">Все новые элементы управления, расположенные выше и слева от элемента управления **stc32** , располагаются в том же размере, что и слева от элементов управления в диалоговом окне по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="568ff-360">All new controls above and to the left of the **stc32** control are positioned the same amount above and to the left of the controls in the default dialog box.</span></span> <span data-ttu-id="568ff-361">Новые элементы управления, расположенные ниже и справа от элемента управления **stc32** , располагаются ниже и справа от элементов управления по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="568ff-361">New controls below and to the right of the **stc32** control are positioned below and to the right of the default controls.</span></span> <span data-ttu-id="568ff-362">Как правило, каждый новый элемент управления размещается так, чтобы его расположение совпадало с элементами управления по умолчанию, как и в элементе управления **stc32** .</span><span class="sxs-lookup"><span data-stu-id="568ff-362">In general, each new control is positioned so that it has the same position relative to the default controls as it had to the **stc32** control.</span></span> <span data-ttu-id="568ff-363">Чтобы освободить место для этих новых элементов управления, система добавляет пробелы в левую, правую, нижнюю и верхнюю часть диалогового окна по умолчанию по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="568ff-363">To make room for these new controls, the system adds space to the left, right, bottom, and top of the default dialog box as needed.</span></span>

<span data-ttu-id="568ff-364">Система требует, чтобы процедура обработчика обрабатывала все сообщения, предназначенные для пользовательского диалогового окна, и, таким образом, отправляет те же сообщения окна процедуре обработки, что и любые другие диалоговые окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-364">The system requires the hook procedure to process all messages intended for the custom dialog box and therefore sends the same window messages to the hook procedure as to any other dialog box procedure.</span></span> <span data-ttu-id="568ff-365">Например, процедура-обработчик принимает сообщения [**\_ команды WM**](/windows/desktop/menurc/wm-command) , когда пользователь щелкает элемент управления "Кнопка" в пользовательском диалоговом окне.</span><span class="sxs-lookup"><span data-stu-id="568ff-365">For example, the hook procedure receives [**WM\_COMMAND**](/windows/desktop/menurc/wm-command) messages when the user clicks on button controls in the custom dialog box.</span></span> <span data-ttu-id="568ff-366">Процедура-ловушка отвечает за инициализацию этих элементов управления и получение значений из элементов управления при закрытии диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-366">The hook procedure is responsible for initializing these controls and retrieving values from the controls when the dialog box is closed.</span></span> <span data-ttu-id="568ff-367">Обратите внимание, что когда процедура-обработчик получает сообщение [**WM \_ инитдиалог**](wm-initdialog.md) , система еще не переместила элементы управления на свои конечные позиции.</span><span class="sxs-lookup"><span data-stu-id="568ff-367">Note that when the hook procedure receives the [**WM\_INITDIALOG**](wm-initdialog.md) message, the system has not yet moved the controls to their final positions.</span></span>

<span data-ttu-id="568ff-368">Процедура диалогового окна по умолчанию обрабатывает сообщения для всех элементов управления в диалоговом окне по умолчанию, но процедура-обработчик принимает сообщения уведомления для действий пользователя с этими элементами управления, как описано в разделе [процедуры обработчика в стиле обозревателя](#explorer-style-hook-procedures).</span><span class="sxs-lookup"><span data-stu-id="568ff-368">The default dialog box procedure handles messages for all the controls in the default dialog box, but the hook procedure receives the notification messages for user actions on these controls as described in [Explorer-Style Hook Procedures](#explorer-style-hook-procedures).</span></span>

## <a name="explorer-style-control-identifiers"></a><span data-ttu-id="568ff-369">Идентификаторы элементов управления Explorer-Style</span><span class="sxs-lookup"><span data-stu-id="568ff-369">Explorer-Style Control Identifiers</span></span>

<span data-ttu-id="568ff-370">Пакет средств разработки программного обеспечения (SDK) для Windows предоставляет шаблон диалогового окна по умолчанию для диалоговых окон старого стиля, но не включает шаблон по умолчанию для диалоговых окон в стиле обозревателя.</span><span class="sxs-lookup"><span data-stu-id="568ff-370">The Windows Software Development Kit (SDK) provides the default dialog box template for the old-style dialog boxes, but does not include the default template for the Explorer-style dialog boxes.</span></span> <span data-ttu-id="568ff-371">Это связано с тем, что диалоговые окна в стиле обозревателя позволяют добавлять собственные элементы управления, но не поддерживают изменение шаблона для стандартных элементов управления.</span><span class="sxs-lookup"><span data-stu-id="568ff-371">This is because the Explorer-style dialog boxes allow you to add your own controls but do not support modifying the template for the standard controls.</span></span> <span data-ttu-id="568ff-372">Однако в некоторых случаях может потребоваться знать идентификаторы элементов управления, используемые в шаблонах по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="568ff-372">However, in some cases, you may need to know the control identifiers used in the default templates.</span></span> <span data-ttu-id="568ff-373">Например, для сообщений [**CDM \_ Хидеконтрол**](cdm-hidecontrol.md) и [**CDM \_ сетконтролтекст**](cdm-setcontroltext.md) требуется идентификатор элемента управления.</span><span class="sxs-lookup"><span data-stu-id="568ff-373">For example, the [**CDM\_HIDECONTROL**](cdm-hidecontrol.md) and [**CDM\_SETCONTROLTEXT**](cdm-setcontroltext.md) messages require a control identifier.</span></span>

<span data-ttu-id="568ff-374">В следующей таблице показаны идентификаторы стандартных элементов управления в диалоговых окнах **Открытие** и **Сохранение** в стиле обозревателя.</span><span class="sxs-lookup"><span data-stu-id="568ff-374">The following table shows the identifiers of the standard controls in the Explorer-style **Open** and **Save As** dialog boxes.</span></span> <span data-ttu-id="568ff-375">Идентификаторы — это константы, определенные в Длгс. h и Winuser. h.</span><span class="sxs-lookup"><span data-stu-id="568ff-375">The identifiers are constants defined in Dlgs.h and Winuser.h.</span></span>



| <span data-ttu-id="568ff-376">Идентификатор элемента управления</span><span class="sxs-lookup"><span data-stu-id="568ff-376">Control identifier</span></span> | <span data-ttu-id="568ff-377">Описание элемента управления</span><span class="sxs-lookup"><span data-stu-id="568ff-377">Control description</span></span>                                                                                                                                                                                                                                                                        |
|--------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="568ff-378">**chx1**</span><span class="sxs-lookup"><span data-stu-id="568ff-378">**chx1**</span></span>           | <span data-ttu-id="568ff-379">Флажок только для чтения</span><span class="sxs-lookup"><span data-stu-id="568ff-379">The read-only check box</span></span>                                                                                                                                                                                                                                                                    |
| <span data-ttu-id="568ff-380">**cmb1**</span><span class="sxs-lookup"><span data-stu-id="568ff-380">**cmb1**</span></span>           | <span data-ttu-id="568ff-381">Раскрывающееся поле со списком, в котором отображается список фильтров типов файлов</span><span class="sxs-lookup"><span data-stu-id="568ff-381">Drop-down combo box that displays the list of file type filters</span></span>                                                                                                                                                                                                                            |
| <span data-ttu-id="568ff-382">**stc2**</span><span class="sxs-lookup"><span data-stu-id="568ff-382">**stc2**</span></span>           | <span data-ttu-id="568ff-383">Метка для поля со списком **cmb1**</span><span class="sxs-lookup"><span data-stu-id="568ff-383">Label for the **cmb1** combo box</span></span>                                                                                                                                                                                                                                                           |
| <span data-ttu-id="568ff-384">**cmb2**</span><span class="sxs-lookup"><span data-stu-id="568ff-384">**cmb2**</span></span>           | <span data-ttu-id="568ff-385">Раскрывающийся список, отображающий текущий диск или папку, который позволяет пользователю выбрать диск или папку для открытия</span><span class="sxs-lookup"><span data-stu-id="568ff-385">Drop-down combo box that displays the current drive or folder, and that allows the user to select a drive or folder to open</span></span>                                                                                                                                                                |
| <span data-ttu-id="568ff-386">**stc4**</span><span class="sxs-lookup"><span data-stu-id="568ff-386">**stc4**</span></span>           | <span data-ttu-id="568ff-387">Метка для поля со списком **cmb2**</span><span class="sxs-lookup"><span data-stu-id="568ff-387">Label for the **cmb2** combo box</span></span>                                                                                                                                                                                                                                                           |
| <span data-ttu-id="568ff-388">**cmb13**</span><span class="sxs-lookup"><span data-stu-id="568ff-388">**cmb13**</span></span>          | <span data-ttu-id="568ff-389">Раскрывающийся список, отображающий имя текущего файла, позволяет пользователю ввести имя открываемого файла и выбрать файл, который был открыт или сохранен недавно.</span><span class="sxs-lookup"><span data-stu-id="568ff-389">Drop-down combo box that displays the name of the current file, allows the user to type the name of a file to open, and select a file that has been opened or saved recently.</span></span> <span data-ttu-id="568ff-390">Это предназначено для ранее совместимых с обозревателем приложений без обработчика или шаблона диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-390">This is for earlier Explorer-compatible applications without hook or dialog template.</span></span> <span data-ttu-id="568ff-391">Сравните с **edt1**.</span><span class="sxs-lookup"><span data-stu-id="568ff-391">Compare with **edt1**.</span></span> |
| <span data-ttu-id="568ff-392">**edt1**</span><span class="sxs-lookup"><span data-stu-id="568ff-392">**edt1**</span></span>           | <span data-ttu-id="568ff-393">Элемент управления "поле ввода", который отображает имя текущего файла, или позволяет пользователю ввести имя открываемого файла.</span><span class="sxs-lookup"><span data-stu-id="568ff-393">Edit control that displays the name of the current file, or allows the user to type the name of the file to open.</span></span> <span data-ttu-id="568ff-394">Сравните с **cmb13**.</span><span class="sxs-lookup"><span data-stu-id="568ff-394">Compare with **cmb13**.</span></span>                                                                                                                                                  |
| <span data-ttu-id="568ff-395">**stc3**</span><span class="sxs-lookup"><span data-stu-id="568ff-395">**stc3**</span></span>           | <span data-ttu-id="568ff-396">Метка для поля со списком **cmb13** и элемента управления Edit edt1</span><span class="sxs-lookup"><span data-stu-id="568ff-396">Label for the **cmb13** combo box and the edt1 edit control</span></span>                                                                                                                                                                                                                                |
| <span data-ttu-id="568ff-397">**lst1**</span><span class="sxs-lookup"><span data-stu-id="568ff-397">**lst1**</span></span>           | <span data-ttu-id="568ff-398">Список, отображающий содержимое текущего диска или папки</span><span class="sxs-lookup"><span data-stu-id="568ff-398">List box that displays the contents of the current drive or folder</span></span>                                                                                                                                                                                                                         |
| <span data-ttu-id="568ff-399">**stc1**</span><span class="sxs-lookup"><span data-stu-id="568ff-399">**stc1**</span></span>           | <span data-ttu-id="568ff-400">Метка для списка **lst1**</span><span class="sxs-lookup"><span data-stu-id="568ff-400">Label for the **lst1** list box</span></span>                                                                                                                                                                                                                                                            |
| <span data-ttu-id="568ff-401">**IDOK**</span><span class="sxs-lookup"><span data-stu-id="568ff-401">**IDOK**</span></span>           | <span data-ttu-id="568ff-402">Кнопка « **ОК** » (кнопка «Отправить»)</span><span class="sxs-lookup"><span data-stu-id="568ff-402">The **OK** command button (push button)</span></span>                                                                                                                                                                                                                                                    |
| <span data-ttu-id="568ff-403">**IDCANCEL**</span><span class="sxs-lookup"><span data-stu-id="568ff-403">**IDCANCEL**</span></span>       | <span data-ttu-id="568ff-404">Кнопка **"Отмена"** (кнопка "Отправить")</span><span class="sxs-lookup"><span data-stu-id="568ff-404">The **Cancel** command button (push button)</span></span>                                                                                                                                                                                                                                                |
| <span data-ttu-id="568ff-405">**пшхелп**</span><span class="sxs-lookup"><span data-stu-id="568ff-405">**pshHelp**</span></span>        | <span data-ttu-id="568ff-406">Кнопка « **Справка** » (кнопка «Отправить»)</span><span class="sxs-lookup"><span data-stu-id="568ff-406">The **Help** command button (push button)</span></span>                                                                                                                                                                                                                                                  |



 

## <a name="customizing-old-style-dialog-boxes"></a><span data-ttu-id="568ff-407">Настройка диалоговых окон Old-Style</span><span class="sxs-lookup"><span data-stu-id="568ff-407">Customizing Old-Style Dialog Boxes</span></span>

<span data-ttu-id="568ff-408">Можно настроить диалоговое окно **Открытие** или **Сохранение в** старом стиле, предоставив процедуру-обработчик [*офнхукпроколдстиле*](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)) , которая получает сообщения или уведомления, предназначенные для процедуры диалогового окна по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="568ff-408">You can customize an old-style **Open** or **Save As** dialog box by providing an [*OFNHookProcOldStyle*](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)) hook procedure that receives messages or notifications intended for the default dialog box procedure.</span></span> <span data-ttu-id="568ff-409">Можно также указать пользовательский шаблон, который будет использоваться вместо шаблона по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="568ff-409">You can also provide a custom template to use in place of the default template.</span></span> <span data-ttu-id="568ff-410">Процедуры-ловушки и шаблоны, используемые с диалоговыми окнами старого стиля, похожи на те, которые используются в других общих диалоговых окнах.</span><span class="sxs-lookup"><span data-stu-id="568ff-410">The hook procedures and templates used with the old-style dialog boxes are similar to those used with the other common dialog boxes.</span></span> <span data-ttu-id="568ff-411">Дополнительные сведения см. в разделе [процедуры-обработчики для общих диалоговых](customizing-common-dialog-boxes.md) окон и [пользовательских шаблонов](customizing-common-dialog-boxes.md).</span><span class="sxs-lookup"><span data-stu-id="568ff-411">For more information, see [Hook Procedures for Common Dialog Boxes](customizing-common-dialog-boxes.md) and [Custom Templates](customizing-common-dialog-boxes.md).</span></span>

<span data-ttu-id="568ff-412">Чтобы включить процедуру-обработчик для диалогового окна **Открытие** или **Сохранение в** старом стиле, используйте структуру [**OpenFileName**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) при создании диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-412">To enable a hook procedure for an old-style **Open** or **Save As** dialog box, use the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure when you create the dialog box.</span></span> <span data-ttu-id="568ff-413">Установите флаг **ОФН \_ енаблехук** в элементе **flags** и укажите адрес процедуры-обработчика [*офнхукпроколдстиле*](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)) в элементе **лпфнхук** .</span><span class="sxs-lookup"><span data-stu-id="568ff-413">Set the **OFN\_ENABLEHOOK** flag in the **Flags** member and specify the address of an [*OFNHookProcOldStyle*](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)) hook procedure in the **lpfnHook** member.</span></span> <span data-ttu-id="568ff-414">Процедура диалогового окна отправляет в процедуру-обработчику сообщение [**WM \_ инитдиалог**](wm-initdialog.md) с параметром *param* , которому задан адрес структуры **OpenFileName** , используемой для инициализации диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="568ff-414">The dialog box procedure sends a [**WM\_INITDIALOG**](wm-initdialog.md) message to the hook procedure with the *Param* parameter set to the address of the **OPENFILENAME** structure used to initialize the dialog box.</span></span>

<span data-ttu-id="568ff-415">Структуру [**OpenFileName**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) можно использовать для указания пользовательского шаблона для диалогового окна **Открыть** или **Сохранить как** , используемого вместо шаблона по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="568ff-415">You can use the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure to specify a custom template for the **Open** or **Save As** dialog box to use in place of the default template.</span></span> <span data-ttu-id="568ff-416">Если пользовательский шаблон является ресурсом в приложении или библиотеке динамической компоновки, установите флаг **ОФН \_ енаблетемплате** в элементе **flags** и используйте элементы **HINSTANCE** и **лптемплатенаме** структуры для обозначения имени модуля и ресурса.</span><span class="sxs-lookup"><span data-stu-id="568ff-416">If your custom template is a resource in an application or dynamic-link library, set the **OFN\_ENABLETEMPLATE** flag in the **Flags** member and use the **hInstance** and **lpTemplateName** members of the structure to identify the module and resource name.</span></span> <span data-ttu-id="568ff-417">Если пользовательский шаблон уже находится в памяти, установите флаг **ОФН \_ енаблетемплатехандле** и используйте элемент **HINSTANCE** , чтобы определить объект памяти, содержащий шаблон.</span><span class="sxs-lookup"><span data-stu-id="568ff-417">If your custom template is already in memory, set the **OFN\_ENABLETEMPLATEHANDLE** flag and use the **hInstance** member to identify the memory object that contains the template.</span></span> <span data-ttu-id="568ff-418">Создайте пользовательский шаблон, изменив шаблон по умолчанию, указанный в файле FileOpen. DLG.</span><span class="sxs-lookup"><span data-stu-id="568ff-418">Create the custom template by modifying the default template specified in the Fileopen.dlg file.</span></span> <span data-ttu-id="568ff-419">Идентификаторы элементов управления, используемые в шаблонах диалоговых окон поиска и замены по умолчанию, определяются в файле Длгс. h.</span><span class="sxs-lookup"><span data-stu-id="568ff-419">The control identifiers used in the default Find and Replace dialog templates are defined in the Dlgs.h file.</span></span>

<span data-ttu-id="568ff-420">По умолчанию функции [**GetOpenFilename**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) и [**жетсавефиленаме**](/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea) отображают диалоговые окна в стиле обозревателя.</span><span class="sxs-lookup"><span data-stu-id="568ff-420">By default, the [**GetOpenFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea) and [**GetSaveFileName**](/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea) functions display the Explorer-style dialog boxes.</span></span> <span data-ttu-id="568ff-421">Если требуется отобразить диалоговое окно старого стиля, необходимо предоставить процедуру-обработчик [**офнхукпроколдстиле**](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)) и убедиться, что флаг **ОФН \_ Explorer** не установлен в элементе **flags** структуры [**OpenFileName**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) .</span><span class="sxs-lookup"><span data-stu-id="568ff-421">If you want to display an old-style dialog box, you must provide an [**OFNHookProcOldStyle**](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)) hook procedure and ensure that the **OFN\_EXPLORER** flag is not set in the **Flags** member of the [**OPENFILENAME**](/windows/win32/api/commdlg/ns-commdlg-openfilenamea) structure.</span></span>

<span data-ttu-id="568ff-422">Если установлен флаг **\_ обозревателя ОФН** , система рассматривает процедуру-обработчик или пользовательский шаблон как настройку в стиле обозревателя.</span><span class="sxs-lookup"><span data-stu-id="568ff-422">If you set the **OFN\_EXPLORER** flag, the system treats a hook procedure or custom template as an Explorer-style customization.</span></span> <span data-ttu-id="568ff-423">Сведения о настройке диалогового окна в стиле обозревателя см. в разделе [пользовательские шаблоны в стиле обозревателя](#explorer-style-custom-templates).</span><span class="sxs-lookup"><span data-stu-id="568ff-423">For information about customizing an Explorer-style dialog box, see [Explorer-Style Custom Templates](#explorer-style-custom-templates).</span></span>

## <a name="see-also"></a><span data-ttu-id="568ff-424">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="568ff-424">See also</span></span>

* [<span data-ttu-id="568ff-425">Файл используется в качестве примера</span><span class="sxs-lookup"><span data-stu-id="568ff-425">File is in use sample</span></span>](https://github.com/microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/winui/shell/appplatform/fileisinuse)
