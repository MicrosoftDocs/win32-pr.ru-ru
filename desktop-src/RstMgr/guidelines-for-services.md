---
title: Рекомендации для служб
description: Службы должны соблюдать эти рекомендации, чтобы диспетчер перезапуска мог завершить работу и перезапустить службы, если это необходимо для установки обновлений. Приложения могут использовать рекомендации, описанные в разделе рекомендации для приложений.
ms.assetid: 69a98f82-71bb-4780-8a3f-294cc5629900
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 51374c0a4c6fc561b8259aadf15e3d5487e12483
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104070345"
---
# <a name="guidelines-for-services"></a><span data-ttu-id="78e4e-104">Рекомендации для служб</span><span class="sxs-lookup"><span data-stu-id="78e4e-104">Guidelines for Services</span></span>

<span data-ttu-id="78e4e-105">Службы должны соблюдать эти рекомендации, чтобы диспетчер перезапуска мог завершить работу и перезапустить службы, если это необходимо для установки обновлений.</span><span class="sxs-lookup"><span data-stu-id="78e4e-105">Services should adhere to these guidelines to ensure that the Restart Manager can shut down and restart services if necessary to install updates.</span></span> <span data-ttu-id="78e4e-106">Приложения могут использовать рекомендации, описанные в разделе [рекомендации для приложений](guidelines-for-applications.md).</span><span class="sxs-lookup"><span data-stu-id="78e4e-106">Applications can use the guidelines that are described in [Guidelines for Applications](guidelines-for-applications.md).</span></span>

-   <span data-ttu-id="78e4e-107">Службы должны быть способны завершить работу и перезапуститься с помощью [диспетчера управления службами](/windows/desktop/Services/service-control-manager) без перезагрузки системы.</span><span class="sxs-lookup"><span data-stu-id="78e4e-107">Services should be capable of being shut down and restarted using the [Service Control Manager](/windows/desktop/Services/service-control-manager) without requiring a system restart.</span></span> <span data-ttu-id="78e4e-108">Исключениями из этого правила являются критические системные процессы, выполняемые в контексте lsass.exe или services.exe.</span><span class="sxs-lookup"><span data-stu-id="78e4e-108">The exceptions to this guideline are critical system processes that run in the context of lsass.exe or services.exe.</span></span>
-   <span data-ttu-id="78e4e-109">Диспетчер перезапуска учитывает зависимости служб.</span><span class="sxs-lookup"><span data-stu-id="78e4e-109">Restart Manager honors service dependencies.</span></span> <span data-ttu-id="78e4e-110">После завершения работы и перезапуска службы зависимые службы будут выключены и перезапущены.</span><span class="sxs-lookup"><span data-stu-id="78e4e-110">When a service is shut down and restarted, its dependent services are shut down and restarted.</span></span>
-   <span data-ttu-id="78e4e-111">Службы должны указывать интервал восстановления и сбросить период в [диспетчере управления службами (SCM)](/windows/desktop/Services/service-control-manager).</span><span class="sxs-lookup"><span data-stu-id="78e4e-111">Services should specify the recovery interval and reset period in the [Service Control Manager (SCM)](/windows/desktop/Services/service-control-manager).</span></span> <span data-ttu-id="78e4e-112">Интервал восстановления — это время (в мс) после последней ошибки, которое SCM ожидает перед выполнением действия восстановления.</span><span class="sxs-lookup"><span data-stu-id="78e4e-112">The recovery interval is the time, in msecs, after the last failure that the SCM waits before taking the recovery action.</span></span> <span data-ttu-id="78e4e-113">Период сброса — это время в секундах после последнего сбоя, которое диспетчер управления службами ожидает до сброса счетчика ошибок в 0.</span><span class="sxs-lookup"><span data-stu-id="78e4e-113">The reset period is the time, in seconds, after the last failure that the Service Control Manager waits before resetting the failure count to 0.</span></span> <span data-ttu-id="78e4e-114">Службы могут использовать функцию [**ChangeServiceConfig2**](/windows/desktop/api/winsvc/nf-winsvc-changeserviceconfig2a) для изменения параметров конфигурации.</span><span class="sxs-lookup"><span data-stu-id="78e4e-114">Services can use [**ChangeServiceConfig2**](/windows/desktop/api/winsvc/nf-winsvc-changeserviceconfig2a) function to change the configuration settings.</span></span>

    <span data-ttu-id="78e4e-115">[Критические службы](critical-system-services.md) должны использовать следующие параметры восстановления, чтобы указать, что служба должна перезапуститься через одну минуту после первого сбоя при перезапуске службы, перезапуститься через две минуты после второй ошибки и перезагрузить компьютер через одну минуту после третьего сбоя.</span><span class="sxs-lookup"><span data-stu-id="78e4e-115">[Critical services](critical-system-services.md) should use the following recovery settings to specify that the service be restarted one minute after the first failure to restart the service, restarted two minutes after the second failure, and that the computer be restarted one minute after the third failure.</span></span> <span data-ttu-id="78e4e-116">После 300 секунд счетчик ошибок сбрасывается в 0.</span><span class="sxs-lookup"><span data-stu-id="78e4e-116">The failure count is reset to 0 after 300 seconds.</span></span>

    <dl> <span data-ttu-id="78e4e-117">Действия восстановления: Restart/60000/Restart/120000/reboot/60000 & сброс = 300</span><span class="sxs-lookup"><span data-stu-id="78e4e-117">Recovery Actions: Restart/60000/Restart/120000/Reboot/60000 & Reset =300</span></span>  
    </dl>

    <span data-ttu-id="78e4e-118">[Критические службы](critical-system-services.md) должны запускаться до некритических служб.</span><span class="sxs-lookup"><span data-stu-id="78e4e-118">[Critical services](critical-system-services.md) should be started before non-critical services.</span></span> <span data-ttu-id="78e4e-119">Службы, которые не являются важными службами, должны использовать следующие параметры восстановления, чтобы указать, что служба должна перезапуститься через две минуты после первого сбоя при перезапуске службы.</span><span class="sxs-lookup"><span data-stu-id="78e4e-119">Services that are not critical services should use the following recovery settings to specify that the service be restarted two minutes after the first failure to restart the service.</span></span> <span data-ttu-id="78e4e-120">После второй ошибки служба не перезапускается, и в этом случае необходимо иметь права администратора.</span><span class="sxs-lookup"><span data-stu-id="78e4e-120">The service is not restarted after the second failure, and an administrator would need to intervene in this case.</span></span> <span data-ttu-id="78e4e-121">После 900 секунд счетчик ошибок сбрасывается в 0.</span><span class="sxs-lookup"><span data-stu-id="78e4e-121">The failure count is reset to 0 after 900 seconds.</span></span>

    <dl> <span data-ttu-id="78e4e-122">Действия восстановления: Restart/120000/Restart/300000/None/0 & Reset = 900</span><span class="sxs-lookup"><span data-stu-id="78e4e-122">Recovery Actions: Restart/120000/Restart/300000/None/0 & Reset = 900</span></span>  
    </dl>

 

 