---
title: Использование диспетчера перезапуска с основным установщиком
description: В следующей процедуре описывается, как с помощью диспетчера перезапуска завершить работу и перезапустить приложения и службы. При использовании диспетчера перезапуска с одним установщиком этот установщик также является основным установщиком, который управляет пользовательским интерфейсом.
ms.assetid: 8d2b4129-c595-4b11-9771-6dc953f4db40
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 38956ee8d04bc377809e93579080d9b767c3da3a
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "103986302"
---
# <a name="using-restart-manager-with-a-primary-installer"></a><span data-ttu-id="41738-104">Использование диспетчера перезапуска с основным установщиком</span><span class="sxs-lookup"><span data-stu-id="41738-104">Using Restart Manager with a Primary Installer</span></span>

<span data-ttu-id="41738-105">В следующей процедуре описывается, как с помощью диспетчера перезапуска завершить работу и перезапустить приложения и службы.</span><span class="sxs-lookup"><span data-stu-id="41738-105">The following procedure describes how to use the Restart Manager to shutdown and restart applications and services.</span></span> <span data-ttu-id="41738-106">При использовании диспетчера перезапуска с одним установщиком этот установщик также является основным установщиком, который управляет пользовательским интерфейсом.</span><span class="sxs-lookup"><span data-stu-id="41738-106">When using the Restart Manager with a single installer, this installer is also the primary installer that controls the user interface.</span></span>

<span data-ttu-id="41738-107">**Использование диспетчера перезапуска с основным установщиком**</span><span class="sxs-lookup"><span data-stu-id="41738-107">**To use the Restart Manager with a primary installer**</span></span>

1.  <span data-ttu-id="41738-108">Установщик вызывает функцию [**RmStartSession**](/windows/desktop/api/RestartManager/nf-restartmanager-rmstartsession) для запуска сеанса диспетчера перезапуска и получения маркера сеанса и ключа.</span><span class="sxs-lookup"><span data-stu-id="41738-108">The installer calls the [**RmStartSession**](/windows/desktop/api/RestartManager/nf-restartmanager-rmstartsession) function to start the Restart Manager session and obtain a session handle and key.</span></span>
2.  <span data-ttu-id="41738-109">Установщик вызывает функцию [**RmRegisterResources**](/windows/desktop/api/RestartManager/nf-restartmanager-rmregisterresources) для регистрации ресурсов.</span><span class="sxs-lookup"><span data-stu-id="41738-109">The installer calls the [**RmRegisterResources**](/windows/desktop/api/RestartManager/nf-restartmanager-rmregisterresources) function to register resources.</span></span> <span data-ttu-id="41738-110">Диспетчер перезапуска может использовать зарегистрированные ресурсы только для определения того, какие приложения и службы должны быть выключены и перезапущены.</span><span class="sxs-lookup"><span data-stu-id="41738-110">The Restart Manager can only use registered resources to determine which applications and services must be shut down and restarted.</span></span> <span data-ttu-id="41738-111">Все ресурсы, на которые может повлиять установка, должны быть зарегистрированы в сеансе.</span><span class="sxs-lookup"><span data-stu-id="41738-111">All resources that can be affected by the installation should be registered with the session.</span></span> <span data-ttu-id="41738-112">Ресурсы можно идентифицировать по имени файла, краткому имени службы или структуре [**\_ уникального \_ процесса RM**](/windows/desktop/api/RestartManager/ns-restartmanager-rm_unique_process) .</span><span class="sxs-lookup"><span data-stu-id="41738-112">Resources can be identified by filename, service short name, or an [**RM\_UNIQUE\_PROCESS**](/windows/desktop/api/RestartManager/ns-restartmanager-rm_unique_process) structure.</span></span>
3.  <span data-ttu-id="41738-113">Установщик вызывает функцию [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) для получения массива структур [**\_ \_ сведений о процессе RM**](/windows/desktop/api/RestartManager/ns-restartmanager-rm_process_info) , в котором перечислены все приложения и службы, которые должны быть выключены и перезапущены.</span><span class="sxs-lookup"><span data-stu-id="41738-113">The installer calls the [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) function to obtain an array of [**RM\_PROCESS\_INFO**](/windows/desktop/api/RestartManager/ns-restartmanager-rm_process_info) structures that lists all applications and services that must be shut down and restarted.</span></span>

    <span data-ttu-id="41738-114">Если значение параметра *лпдвребутреасон* , возвращаемое функцией [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) , не равно нулю, диспетчеру перезапуска не удается освободить зарегистрированный ресурс при завершении работы приложения или службы.</span><span class="sxs-lookup"><span data-stu-id="41738-114">If the value of the *lpdwRebootReason* parameter that is returned by the [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) function is nonzero, the Restart Manager is unable to free a registered resource by the shutdown of an application or service.</span></span> <span data-ttu-id="41738-115">В этом случае для продолжения установки требуется завершение работы системы и перезапуск.</span><span class="sxs-lookup"><span data-stu-id="41738-115">In this case, a system shutdown and restart is required to continue the installation.</span></span> <span data-ttu-id="41738-116">Установщик должен запрашивать у пользователя действие, прекращать работу программ или служб или запланировать завершение работы и перезагрузку системы.</span><span class="sxs-lookup"><span data-stu-id="41738-116">The installer should prompt the user for an action, stop programs or services, or schedule a system shutdown and restart.</span></span>

    <span data-ttu-id="41738-117">Если значение параметра *лпдвребутреасон* , возвращаемое функцией [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) , равно нулю, установщик должен вызвать функцию [**рмшутдовн**](/windows/desktop/api/RestartManager/nf-restartmanager-rmshutdown) .</span><span class="sxs-lookup"><span data-stu-id="41738-117">If the value of the *lpdwRebootReason* parameter that is returned by the [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) function is zero, the installer should call the [**RmShutdown**](/windows/desktop/api/RestartManager/nf-restartmanager-rmshutdown) function.</span></span> <span data-ttu-id="41738-118">При этом службы и приложения, использующие зарегистрированные ресурсы, завершаются.</span><span class="sxs-lookup"><span data-stu-id="41738-118">This shuts down the services and applications that are using registered resources.</span></span> <span data-ttu-id="41738-119">Затем установщик должен выполнить системные изменения, необходимые для завершения установки.</span><span class="sxs-lookup"><span data-stu-id="41738-119">The installer should then perform system modifications that are required to complete the installation.</span></span> <span data-ttu-id="41738-120">Наконец, установщик должен вызвать функцию [**рмрестарт**](/windows/desktop/api/RestartManager/nf-restartmanager-rmrestart) , чтобы диспетчер перезапуска мог перезапустить приложения, работа которых была завершена и которые были зарегистрированы для перезапуска.</span><span class="sxs-lookup"><span data-stu-id="41738-120">Finally, the installer should call the [**RmRestart**](/windows/desktop/api/RestartManager/nf-restartmanager-rmrestart) function so that the Restart Manager can restart the applications it has shut down and that have been registered for a restart.</span></span>

4.  <span data-ttu-id="41738-121">Установщик может использовать функцию [**рмаддфилтер**](/windows/desktop/api/RestartManager/nf-restartmanager-rmaddfilter) для предотвращения завершения или перезапуска определенных приложений и служб с помощью операций диспетчера перезапуска.</span><span class="sxs-lookup"><span data-stu-id="41738-121">The installer can use the [**RmAddFilter**](/windows/desktop/api/RestartManager/nf-restartmanager-rmaddfilter) function to prevent specified applications and services from being shutdown or restarted by Restart Manager operations.</span></span> <span data-ttu-id="41738-122">Функция [**рмжетфилтерлист**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetfilterlist) возвращает список приложений и служб, для которых необходимо выполнить фильтрацию после завершения работы и перезапуска.</span><span class="sxs-lookup"><span data-stu-id="41738-122">The [**RmGetFilterList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetfilterlist) function returns a list of the applications and services to be filtered from shutdown and restart.</span></span> <span data-ttu-id="41738-123">Функция [**рмремовефилтер**](/windows/desktop/api/RestartManager/nf-restartmanager-rmremovefilter) удаляет фильтр.</span><span class="sxs-lookup"><span data-stu-id="41738-123">The [**RmRemoveFilter**](/windows/desktop/api/RestartManager/nf-restartmanager-rmremovefilter) function removes a filter.</span></span>
5.  <span data-ttu-id="41738-124">Установщик вызывает функцию [**рмендсессион**](/windows/desktop/api/RestartManager/nf-restartmanager-rmendsession) , чтобы закрыть сеанс диспетчера перезапуска.</span><span class="sxs-lookup"><span data-stu-id="41738-124">The installer calls the [**RmEndSession**](/windows/desktop/api/RestartManager/nf-restartmanager-rmendsession) function to close the Restart Manager session.</span></span>

<span data-ttu-id="41738-125">Пример фрагмента кода, демонстрирующий запуск и использование сеанса диспетчера перезапуска с помощью основного установщика и последующего присоединения дополнительного установщика к существующему сеансу, см. в разделе [Использование диспетчера перезапуска с дополнительным установщиком](using-restart-manager-with-a-secondary-installer.md).</span><span class="sxs-lookup"><span data-stu-id="41738-125">For an example code snippet that shows starting and using a Restart Manager session by using a primary installer and then joining a secondary installer to the existing session, see [Using Restart Manager with a Secondary Installer](using-restart-manager-with-a-secondary-installer.md).</span></span>

 

 




