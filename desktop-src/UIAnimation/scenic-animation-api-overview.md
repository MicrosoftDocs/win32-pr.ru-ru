---
title: Общие сведения о анимации Windows
description: В этом обзоре представлено введение в диспетчер анимации Windows и основное внимание уделяется основным компонентам и концепциям.
ms.assetid: de1380c9-6801-4178-9281-a23af7d71d77
keywords:
- Анимация Windows для анимации Windows, обзор
- Анимация Windows объектов диспетчера анимации, описание
- Анимация Windows, описание переменных анимации
- Анимация объектов таймера Windows, описание
- Анимация системы управления временем Windows
- контекстно-зависимая длительность анимации Windows
- Анимация Windows, соответствующая скорости
- Анимация Windows для управления состязаниями
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6a60b02b29d8d434cc93420f36c3cdca4428f94c
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104070103"
---
# <a name="windows-animation-overview"></a>Общие сведения о анимации Windows

В этом обзоре представлено введение в диспетчер анимации Windows и основное внимание уделяется основным компонентам и концепциям. Дополнительные сведения о раскадровках и переходах см. в разделе [Общие сведения о раскадровке](storyboard-construction.md).

В этом разделе содержатся следующие подразделы.

-   [Основные понятия](#basic-concepts)
-   [Компоненты анимации Windows](#components-of-windows-animation)
-   [API анимации Windows](#the-windows-animation-api)
-   [Конфигурации](#configurations)
    -   [Управляемая приложением анимация](#application-driven-animation)
    -   [Управляемая таймером анимация](#timer-driven-animation)
-   [Дополнительные функции](#advanced-features)
    -   [Управление состязанием](#contention-management)
-   [См. также](#related-topics)

## <a name="basic-concepts"></a>Основные понятия

*Анимация* — это последовательность последовательных изображений, которые создают иллюзию движения при воспроизведении. Использование интерактивной анимации в пользовательском интерфейсе может дать приложению уникальную личность, а также улучшить взаимодействие с пользователем. Анимация может помочь в обмене основными изменениями состояния в пользовательском интерфейсе и помочь в управлении сложностью пользовательского интерфейса. Кроме того, анимация может добавлять пользователя к восприятию качества приложения.

Например, анимация Windows используется на панели задач для управления файлами и программами и доступа к ним, а также с помощью экранной лупы для увеличения различных частей экрана, чтобы облегчить пользователям доступ к ним.

Фундаментальными единицами анимации являются характеристики визуального элемента, который будет анимирован, и описание способа изменения этой характеристики с течением времени. Приложение может анимировать разнообразные характеристики, такие как расположение, цвет, размер, поворот, контрастность и непрозрачность.

В анимации Windows *переменная анимации* представляет характеристики для анимации. *Переход* описывает, как происходит изменение значения этой переменной анимации при анимации. Например, визуальный элемент может иметь переменную анимации, указывающую ее непрозрачность, а пользовательское действие может создать переход, который принимает эту непрозрачность из значения 50 в 100, представляющего анимацию с полупрозрачной на полностью непрозрачный.

*Раскадровка* — это набор переходов, применяемых к одной или нескольким переменным анимации с течением времени. Приложение отображает анимацию, создавая и проигрывать раскадровки, а затем рисуя последовательности дискретных кадров по мере изменения значений переменных анимации со временем.

## <a name="components-of-windows-animation"></a>Компоненты анимации Windows

Анимация Windows состоит из следующих компонентов:

<dl> <dt>

<span id="animation_manager"></span><span id="ANIMATION_MANAGER"></span>диспетчер анимации
</dt> <dd>

Приложения используют объект диспетчера анимации для создания переменных и раскадровок анимации, планирования и управления анимацией, а также обновления сведений о состоянии до того, как приложение рисует каждый кадр. Один объект диспетчера анимации обычно управляет всеми анимациями в приложении и, таким образом, обладает глобальным контролем над всеми запланированными раскадровкой.

</dd> <dt>

<span id="animation_variables"></span><span id="ANIMATION_VARIABLES"></span>переменные анимации
</dt> <dd>

Перед запуском анимации приложению необходимо создать объекты переменных анимации. Переменная анимации представляет один аспект визуального элемента для анимации. Переменная является скалярным значением с плавающей запятой, хотя значение может быть округлено до целого значения.

Переменная анимации обычно имеет то же время существования, что и визуальный элемент, предназначенный для анимации. Начальное значение переменной анимации указывается при создании переменной. После этого его значение нельзя изменить напрямую. его необходимо обновить с помощью диспетчера анимации.

Переменная анимации может быть идентифицирована с помощью *тега*, который представляет собой пару целочисленных идентификаторов с указателем на COM-объект. Тег не должен быть уникальным, если только приложение не использует его для поиска переменной. По умолчанию у переменной анимации отсутствует тег, и любые попытки чтения тега будут завершаться ошибкой, пока не будет задан другой.

</dd> <dt>

<span id="timing_system"></span><span id="TIMING_SYSTEM"></span>система управления временем
</dt> <dd>

Анимация Windows включает систему времени, позволяющую обеспечить визуализацию анимации по частоте кадров, которая является гладким и последовательным, а также сокращает использование системных ресурсов для отрисовки при занятости системы. *Таймер* помогает управлять отрисовкой анимации, автоматически указывая на небольшую единицу времени, называемую *тактовой*. Система управления временем отслеживает общую производительность отрисовки системы и *регулирует* анимацию за счет динамического увеличения или уменьшения частоты тактов. Приложения могут позволить устройству таймера использовать диспетчер анимации и регистрировать обработчик, который должен получать уведомления до и после обновления руководителя для каждого такта. Приложения могут задавать минимально приемлемую частоту кадров анимации для таймера и получать уведомления, если фактическая частота кадров анимации падает ниже этой скорости.

Для экономии системных ресурсов таймер можно настроить на отключение самого себя, если анимация не выполняется.

</dd> </dl>

## <a name="the-windows-animation-api"></a>API анимации Windows

API анимации Windows — это однопотоковый API на основе COM, который предоставляет разработчикам следующие возможности:

-   Объект диспетчера анимации [**уианиматионманажер**](/previous-versions/windows/desktop/legacy/dd317019(v=vs.85))для создания объектов анимации и управления анимациями
-   Переменные и раскадровки анимации
-   Базовая библиотека, [**уианиматионтранситионлибрари**](/previous-versions/windows/desktop/legacy/dd317028(v=vs.85)), готовые к использованию переходы
-   Объект Timer, [**уианиматионтимер**](/previous-versions/windows/desktop/legacy/dd317021(v=vs.85)), для определения текущего времени и (необязательно) для анимации движения.
-   Обработчики событий для наблюдения за состоянием и ходом выполнения анимации

Полный справочник по API см. в [справочнике по анимации Windows](windows-animation-reference.md). Пример кода см. в разделе [задачи анимации Windows](using-windows-animation.md) и [примеры анимации Windows](windows-animation-samples.md).

## <a name="configurations"></a>Конфигурации

Перед планированием новой анимации приложения должны получить текущее время. Ниже приведены механизмы синхронизации, поддерживаемые анимацией Windows.

-   [Управляемая приложением анимация](#application-driven-animation)
-   [Управляемая таймером анимация](#timer-driven-animation)

### <a name="application-driven-animation"></a>Анимация Application-Driven

Приложения, использующие графический API с аппаратным ускорением, могут синхронизироваться с частотой обновления монитора для отрисовки гладких анимаций. Кроме того, приложение может использовать собственный механизм управления временем, чтобы определить, когда следует рисовать каждый кадр анимации. В любом случае приложение сообщит диспетчеру анимации о необходимости обновления своего состояния. Таймер анимации по-прежнему можно использовать для определения текущего времени с высокой точностью в единицах, необходимых для диспетчера анимации.

На следующей диаграмме показано взаимодействие между приложением и компонентами анимации Windows, когда приложение непосредственно изменяет анимацию.

![Схема, показывающая взаимодействие между приложением и компонентами анимации Windows, когда приложение перемещает обновления анимации напрямую.](images/animationupdates.png)

В простейшей конфигурации приложение будет перерисовывать все при каждом обновлении экрана, даже если анимация не воспроизводится. Чтобы избежать излишней работы, приложение может зарегистрировать обработчик событий руководителя, чтобы получать уведомления о запланированных анимациях, а также определить, когда расписание пусто, чтобы его можно было переустановить.

### <a name="timer-driven-animation"></a>Анимация Timer-Driven

Вместо непосредственного обновления диспетчера анимации приложения могут позволить таймеру анимации сообщить диспетчеру анимации о необходимости обновления его состояния и просто получать уведомления о каждом обновлении. Этот подход рекомендуется для более старых графических API. В общем случае, если можно выполнить синхронизацию с частотой обновления монитора, лучше сделать это и использовать управляемую приложением анимацию.

На следующей диаграмме показано взаимодействие между приложением и компонентами анимации Windows, когда таймер анимации управляет обновлением анимации.

![Схема, показывающая взаимодействие между приложением и компонентами анимации Windows, когда таймер анимации управляет обновлением анимации.](images/animationtimerupdates.png)

Таймер можно настроить так, чтобы он выполнялся только при планировании анимации. Это позволяет просто передать определенный параметр при подключении таймера и диспетчера анимации.

## <a name="advanced-features"></a>Дополнительные функции

Помимо базовой основы для поддержки анимации, в Windows анимация включена поддержка нескольких улучшенных методик анимации, включая:

<dl> <dt>

<span id="context-sensitive_duration"></span><span id="CONTEXT-SENSITIVE_DURATION"></span>*Длительность, зависящая от контекста*
</dt> <dd>

Длительность перехода не требует исправления; его можно определить на основе значения и скорости анимированной переменной при начале перехода.

</dd> <dt>

<span id="velocity_matching"></span><span id="VELOCITY_MATCHING"></span>*Сопоставление скорости*
</dt> <dd>

Движение, как правило, более привлекательно для глаза, если расположение и скорость перемещаемого объекта не переходят между значениями. При прерывании новой раскадровки, которая сейчас воспроизводится, новая раскадровка обеспечивает бесперебойную работу, где закончилась Предыдущая.

</dd> <dt>

<span id="contention_management"></span><span id="CONTENTION_MANAGEMENT"></span>*Управление состязанием*
</dt> <dd>

Если две раскадровки нуждаются в одновременном обновлении одной и той же переменной анимации, возникает конфликт планирования. Вместо того чтобы требовать определенного числового приоритета для каждой раскадровки, анимация Windows позволяет приложению определять относительные приоритеты любых двух раскадровок.

</dd> </dl>

### <a name="contention-management"></a>Управление состязанием

Разработчики могут реализовать обратный вызов *сравнения приоритетов* , чтобы сравнить приоритет раскадровки, для которой выполняется планирование, и раскадровки, которая уже находится в расписании. Приложение, реализующее сравнение приоритетов, может использовать любую предпочтительную логику, чтобы определить, когда раскадровка емптс другой. Чтобы устранить конфликт планирования, анимация Windows запрашивает у приложения, какое из этих действий может быть выполнено, в следующем порядке:

-   **Отмена запланированной раскадровки.** Если запланированная раскадровка еще не началась для воспроизведения, она может быть отменена и сразу же удалена из расписания.
-   **Обрезать запланированную раскадровку.** Когда новая раскадровка обрезает запланированную раскадровку, запланированная раскадровка перестает влиять на переменную, как только новая раскадровка начинает ее анимировать. Скоростей сопоставляются, что позволяет новой раскадровки восприниматься, когда предыдущая из них была отключена.
-   **Заключение запланированной раскадровки.** Раскадровка может быть выполнена только в том случае, если она содержит цикл, повторяемый неограниченное время. Если раскадровка находится в таком цикле по завершении, текущее повторение завершается, а оставшаяся часть раскадровки воспроизводится. Если цикл еще не начался при завершении раскадровки, цикл пропускается полностью.
-   **Сжатие раскадровки по расписанию.** Если усечение или отмена запланированной раскадровки не является параметром, раскадровка может быть завершена. В Windows Animation появилась возможность сжатия времени, доступного для запланированной раскадровки (и всех раскадровок, запланированных до него), поэтому переменные достигают их окончательное состояние быстрее. При применении сжатия время временно ускоряется для затронутых раскадровок, поэтому они воспроизводятся быстрее.

Если ни одно из указанных выше действий не разрешено зарегистрированными объектами сравнения приоритетов, попытка запланировать новую раскадровку завершится ошибкой. По умолчанию все раскадровки могут быть обрезаны, завершены или сжаты для предотвращения сбоев, но их нельзя отменить.

На следующей диаграмме показан жизненный цикл раскадровки с использованием состояний, определенных в перечислении [**\_ \_ \_ состояния раскадровки анимации пользовательского интерфейса**](/windows/win32/api/uianimation/ne-uianimation-ui_animation_storyboard_status) . Приложения используют API анимации Windows для создания раскадровки и их отправки для планирования. Диспетчер анимации планирует раскадровку и управляет анимацией.

![Схема, показывающая, как диспетчер анимации планирует раскадровку и управляет анимацией.](images/statediagram.png)

Дополнительные сведения о планировании и управлении раскадровкой см. в разделе [Общие сведения о раскадровке](storyboard-construction.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Справочник по анимации Windows](windows-animation-reference.md)
</dt> <dt>

[Примеры анимации Windows](windows-animation-samples.md)
</dt> <dt>

[Задачи анимации Windows](using-windows-animation.md)
</dt> </dl>

 

 