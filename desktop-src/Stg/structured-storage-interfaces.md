---
title: Структурированные интерфейсы хранения
description: Структурированные службы хранилища организованы в три категории интерфейсов.
ms.assetid: a4281f07-eae4-4bcb-8d16-b6c0bd3c5b21
keywords:
- Структурированные интерфейсы хранения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0010a0d4dec4908111c8a5bb939f795f0a2b2eb3
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105661750"
---
# <a name="structured-storage-interfaces"></a>Структурированные интерфейсы хранения

Структурированные службы хранилища организованы в три категории [интерфейсов](interfaces.md). Каждый набор представляет последовательный уровень косвенного обращения или абстракции между составным файлом, содержащимся в нем объектами и физическим носителем, в котором хранятся эти отдельные компоненты.

Первая категория интерфейсов состоит из [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage), [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream)и [**ирутстораже**](/windows/desktop/api/Objidl/nn-objidl-irootstorage). Первые два интерфейса определяют, как объекты хранятся в составном файле. Эти интерфейсы предоставляют методы для открытия элементов хранилища, фиксации и возврата изменений, копирования и перемещения элементов, а затем чтения и записи потоков. Эти интерфейсы не распознают собственные форматы данных отдельных объектов и, следовательно, не имеют методов для сохранения этих объектов в постоянное хранилище. Интерфейс **ирутстораже** имеет один метод для связывания составного документа с базовым именем файловой системы. Клиенты должны реализовать эти интерфейсы для их составных файлов.

Вторая категория интерфейсов состоит из интерфейсов [**IPersist**](/windows/win32/api/objidl/nn-objidl-ipersist) , которые реализуются объектами для управления их постоянными данными. Эти интерфейсы предоставляют методы для чтения форматов данных отдельных объектов и, следовательно, их хранения. Объекты отвечают за реализацию этих интерфейсов, так как клиенты не узнают собственные форматы данных своих вложенных объектов. Однако эти интерфейсы не имеют сведений о конкретном носителе физического хранилища.

Третья категория состоит из одного интерфейса [**ILockBytes**](/windows/desktop/api/Objidl/nn-objidl-ilockbytes), который предоставляет методы для записи файлов на конкретный физический носитель, например жесткий диск или ленточный накопитель. Однако большинство приложений не будут реализовывать интерфейс **ILockBytes** , так как com уже предоставляет реализации для двух наиболее распространенных ситуаций, которые являются реализацией на основе файлов и реализацией на основе памяти. Объект хранилища составных файлов вызывает методы **ILockBytes** , которые не вызываются напрямую в реализации.

## <a name="compound-file-implementation-limits"></a>Ограничения реализации составных файлов

Реализация структурированной архитектуры хранилища COM называется *составными файлами*. Объекты хранилища, реализованные в составных файлах, включают реализацию интерфейсов [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) и [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) .

Указатели на реализацию составных файлов этих интерфейсов получаются путем вызова функции [**стгкреатесторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) для создания нового объекта составного файла или [**стгопенсторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) для открытия ранее созданного составного файла.

Альтернативный способ получения указателя на реализацию составного файла этих интерфейсов заключается в вызове более старой и более ограниченной функции [**стгкреатедокфиле**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile) или [**стгопенстораже**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorage) . Все четыре функции обрабатываются как реализации составных файлов.

Реализация составного файла может быть настроена на использование секторов 512 или 4096 байт, как определено в структуре [**стгоптионс**](/windows/win32/api/coml2api/ns-coml2api-stgoptions) .

Реализация составного файла для составных файлов подчиняется следующим ограничениям реализации.



| Ограничение                                           | Составной файл                                                                                                                                                                      |
|-------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Ограничения размера файлов:                               | 512:2 гигабайта (ГБ) 4096: до ограничений файловой системы<br/>                                                                                                                    |
| Максимальный размер кучи, необходимый для открытых элементов:   | 512:4 мегабайта (МБ) 4096: пределы виртуальной памяти<br/>                                                                                                                 |
| Параллельное корневое открытие (открытие того же файла): | Если \_ заданы стгм Read и стгм \_ Share \_ Deny \_ Write, ограничения определяются ограничениями файловой системы. В противном случае существует ограничение в 20 параллельных корневых папок одного и того же файла. |
| Число элементов в файле:                   | 512: не ограничено, но производительность может снизиться, если число элементов в тысячах 4096: неограниченное<br/>                                                                         |



 

Из-за ограничения размера кучи 4 МБ число открытых элементов в режиме транзакций обычно ограничено несколькими тысячами элементов.

 

