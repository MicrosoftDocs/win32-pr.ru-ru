---
title: Реализация файла IPropertySetStorage-Compound
description: Реализация объекта хранилища составных файлов COM включает реализацию Ипропертистораже, интерфейс, управляющий одним набором постоянных свойств, и IPropertySetStorage, интерфейс, который управляет группами постоянных наборов свойств.
ms.assetid: de2cb778-c6eb-4487-996b-87405674f603
keywords:
- IPropertySetStorage Стрктд STG, реализации, составной файл
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9053a7cf6bf1ae7e4230b15eb0117c428acb08da
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103792961"
---
# <a name="ipropertysetstorage-compound-file-implementation"></a><span data-ttu-id="68127-104">Реализация файла IPropertySetStorage-Compound</span><span class="sxs-lookup"><span data-stu-id="68127-104">IPropertySetStorage-Compound File Implementation</span></span>

<span data-ttu-id="68127-105">[Реализация объекта хранилища составных файлов com](ipropertystorage-compound-file-implementation.md) включает реализацию [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage), интерфейс, управляющий одним набором постоянных свойств, и [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage), интерфейс, который управляет группами постоянных наборов свойств.</span><span class="sxs-lookup"><span data-stu-id="68127-105">The [COM compound file storage object implementation](ipropertystorage-compound-file-implementation.md) includes an implementation of both [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage), the interface that manages a single persistent property set, and [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage), the interface that manages groups of persistent property sets.</span></span>

<span data-ttu-id="68127-106">Чтобы получить указатель на реализацию составного файла [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage), укажите определенное в заголовке имя идентификатора IID \_ IStorage в качестве параметра *riid* или используйте функции [**стгкреатесторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) или [**стгопенсторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) .</span><span class="sxs-lookup"><span data-stu-id="68127-106">To get a pointer to the compound file implementation of [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage), specify the header-defined name for the identifier IID\_IStorage as the *riid* parameter, or use the [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) or [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) functions.</span></span> <span data-ttu-id="68127-107">В обоих случаях укажите хранилище СТГФМТ в \_ качестве параметра *стгфмт* .</span><span class="sxs-lookup"><span data-stu-id="68127-107">In both cases, specify STGFMT\_STORAGE as the *stgfmt* parameter.</span></span> <span data-ttu-id="68127-108">(СТГФМТ \_ Можно также указать ANY в случае **стгопенсторажеекс**.) Кроме того, укажите определенное заголовком Имя идентификатора интерфейса (IID) IID \_ IPropertySetStorage в качестве параметра *riid* .</span><span class="sxs-lookup"><span data-stu-id="68127-108">(STGFMT\_ANY can alternatively be specified in the case of **StgOpenStorageEx**.) Also, specify the header-defined name for the interface identifier (IID) IID\_IPropertySetStorage as the *riid* parameter.</span></span> <span data-ttu-id="68127-109">Обе функции предоставляют указатель на интерфейс **IPropertySetStorage** объекта.</span><span class="sxs-lookup"><span data-stu-id="68127-109">Both functions supply a pointer to the object **IPropertySetStorage** interface.</span></span>

<span data-ttu-id="68127-110">Другим способом получения указателя на реализацию составного файла является указание определенного по заголовку имени для идентификатора IID \_ IStorage в качестве параметра *riid* или использование функций [**стгкреатедокфиле**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile) или [**стгопенстораже**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorage) .</span><span class="sxs-lookup"><span data-stu-id="68127-110">Another way to get a pointer to the compound file implementation is to specify the header-defined name for the identifier IID\_IStorage as the *riid* parameter, or to use the [**StgCreateDocfile**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile) or [**StgOpenStorage**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorage) functions.</span></span> <span data-ttu-id="68127-111">При этом будет предоставлен указатель на интерфейс [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) объекта.</span><span class="sxs-lookup"><span data-stu-id="68127-111">This will supply a pointer to the object [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="68127-112">Если вы хотите работать с постоянными наборами свойств, вызовите метод [**IStorage:: QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) для интерфейса [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) .</span><span class="sxs-lookup"><span data-stu-id="68127-112">When you want to deal with persistent property sets, call [**IStorage::QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) for the [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) interface.</span></span>

## <a name="when-to-use-ipropertysetstorage"></a><span data-ttu-id="68127-113">Когда следует использовать IPropertySetStorage</span><span class="sxs-lookup"><span data-stu-id="68127-113">When to Use IPropertySetStorage</span></span>

<span data-ttu-id="68127-114">Вызовите методы [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) , чтобы создавать, открывать или удалять наборы свойств в текущем составном наборе свойств, заданных в хранилище.</span><span class="sxs-lookup"><span data-stu-id="68127-114">Call the methods of [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) to create, open, or delete property sets in the current compound-file property set storage.</span></span> <span data-ttu-id="68127-115">Существует также метод [**IPropertySetStorage:: Enum**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-enum), который предоставляет указатель на перечислитель, который можно использовать для перечисления наборов свойств в хранилище.</span><span class="sxs-lookup"><span data-stu-id="68127-115">There is also a method, [**IPropertySetStorage::Enum**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-enum), that supplies a pointer to an enumerator that can be used to enumerate the property sets in the storage.</span></span>

## <a name="methods"></a><span data-ttu-id="68127-116">Методы</span><span class="sxs-lookup"><span data-stu-id="68127-116">Methods</span></span>

[<span data-ttu-id="68127-117">**IPropertySetStorage:: Create**</span><span class="sxs-lookup"><span data-stu-id="68127-117">**IPropertySetStorage::Create**</span></span>](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create)

<span data-ttu-id="68127-118">Создает новое свойство, установленное в текущем хранилище составных файлов, а при возвращении предоставляет указатель интерфейса на реализацию составного файла [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) .</span><span class="sxs-lookup"><span data-stu-id="68127-118">Creates a new property set in the current compound file storage and, on return, supplies an interface pointer to the [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) compound-file implementation.</span></span> <span data-ttu-id="68127-119">В этой реализации наборы свойств могут быть транзакционными, только если \_ указано пропсетфлаг непростое.</span><span class="sxs-lookup"><span data-stu-id="68127-119">In this implementation, property sets may be transacted only if PROPSETFLAG\_NONSIMPLE is specified.</span></span> <span data-ttu-id="68127-120">Для этого метода требуется, чтобы режим общего доступа, заданный в параметре *грфмоде* , был стгм \_ \_ монопольно, а режим доступа — стгм \_ Read или стгм \_ ReadWrite (стгм \_ Write Mode не поддерживается).</span><span class="sxs-lookup"><span data-stu-id="68127-120">This method requires that the sharing mode specified in the *grfMode* parameter be STGM\_SHARE\_EXCLUSIVE, and that the access mode be either STGM\_READ or STGM\_READWRITE (STGM\_WRITE mode is not supported).</span></span>

[<span data-ttu-id="68127-121">**IPropertySetStorage:: Open**</span><span class="sxs-lookup"><span data-stu-id="68127-121">**IPropertySetStorage::Open**</span></span>](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open)

<span data-ttu-id="68127-122">Открывает существующее свойство, установленное в текущем хранилище свойств.</span><span class="sxs-lookup"><span data-stu-id="68127-122">Opens an existing property set in the current property storage.</span></span> <span data-ttu-id="68127-123">При возврате он предоставляет указатель интерфейса для реализации составного файла, [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage).</span><span class="sxs-lookup"><span data-stu-id="68127-123">On return, it supplies an interface pointer to the compound file implementation of [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage).</span></span> <span data-ttu-id="68127-124">Для этого метода требуется, чтобы режим общего доступа, заданный в параметре *грфмоде* , был стгм \_ \_ монопольно, а режим доступа — стгм \_ Read или стгм \_ ReadWrite (стгм \_ Write не поддерживается).</span><span class="sxs-lookup"><span data-stu-id="68127-124">This method requires that the sharing mode specified in the *grfMode* parameter be STGM\_SHARE\_EXCLUSIVE, and that the access mode be either STGM\_READ or STGM\_READWRITE (STGM\_WRITE is not supported).</span></span>

[<span data-ttu-id="68127-125">**IPropertySetStorage::D удалить**</span><span class="sxs-lookup"><span data-stu-id="68127-125">**IPropertySetStorage::Delete**</span></span>](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-delete)

<span data-ttu-id="68127-126">Удаляет свойство, заданное в этом хранилище свойств.</span><span class="sxs-lookup"><span data-stu-id="68127-126">Deletes a property set in this property storage.</span></span>

[<span data-ttu-id="68127-127">**IPropertySetStorage:: Enum**</span><span class="sxs-lookup"><span data-stu-id="68127-127">**IPropertySetStorage::Enum**</span></span>](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-enum)

<span data-ttu-id="68127-128">Создает объект, используемый для перечисления структур [**статпропсетстг**](/windows/win32/api/propidlbase/nn-propidlbase-ienumstatpropsetstg) .</span><span class="sxs-lookup"><span data-stu-id="68127-128">Creates an object used to enumerate [**STATPROPSETSTG**](/windows/win32/api/propidlbase/nn-propidlbase-ienumstatpropsetstg) structures.</span></span> <span data-ttu-id="68127-129">Каждая структура **статпропсетстг** предоставляет данные об отдельном наборе свойств.</span><span class="sxs-lookup"><span data-stu-id="68127-129">Each **STATPROPSETSTG** structure provides data about a single property set.</span></span>

## <a name="remarks"></a><span data-ttu-id="68127-130">Комментарии</span><span class="sxs-lookup"><span data-stu-id="68127-130">Remarks</span></span>

<span data-ttu-id="68127-131">Начиная с Windows 2000, реализация составного файла [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) поддерживает простой режим.</span><span class="sxs-lookup"><span data-stu-id="68127-131">Starting with Windows 2000, the compound-file implementation of [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) supports simple mode.</span></span> <span data-ttu-id="68127-132">Простой режим обозначается указанием \_ простого флага стгм для функций [**Стгкреатесторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) и [**стгопенсторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) .</span><span class="sxs-lookup"><span data-stu-id="68127-132">Simple mode is indicated by specifying the STGM\_SIMPLE flag for the [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) and [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) functions.</span></span> <span data-ttu-id="68127-133">Если составной файл открыт в простом режиме, связанная реализация **IPropertySetStorage** ограничена следующим образом:</span><span class="sxs-lookup"><span data-stu-id="68127-133">If the compound file is opened in simple mode, the associated **IPropertySetStorage** implementation is limited as follows:</span></span>

-   <span data-ttu-id="68127-134">Можно создавать только простые наборы свойств.</span><span class="sxs-lookup"><span data-stu-id="68127-134">Only simple property sets can be created.</span></span> <span data-ttu-id="68127-135">Это значит, что при указании \_ НЕпростого значения пропсетфлаг в параметре *грффлагс* для метода [**IPropertySetStorage:: Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) возникает ошибка.</span><span class="sxs-lookup"><span data-stu-id="68127-135">That is, specifying the PROPSETFLAG\_NONSIMPLE value in the *grfFlags* parameter for the [**IPropertySetStorage::Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) method results in an error.</span></span>
-   <span data-ttu-id="68127-136">После создания составного файла с помощью [**стгкреатесторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) с использованием стгм \_ Simple и запроса к интерфейсу [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) можно вызвать [**IPropertySetStorage:: Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) один раз.</span><span class="sxs-lookup"><span data-stu-id="68127-136">After you create a compound file with [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) using STGM\_SIMPLE and query for the [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) interface, you can only call [**IPropertySetStorage::Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) once.</span></span> <span data-ttu-id="68127-137">Затем необходимо освободить интерфейс [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) перед повторным вызовом метода **CREATE** .</span><span class="sxs-lookup"><span data-stu-id="68127-137">Then you must release the [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) interface before calling the **Create** method again.</span></span> <span data-ttu-id="68127-138">Дополнительные сведения о режиме Simple см. в разделе [**константы стгм**](stgm-constants.md).</span><span class="sxs-lookup"><span data-stu-id="68127-138">For more information about simple mode, see [**STGM Constants**](stgm-constants.md).</span></span>
-   <span data-ttu-id="68127-139">Метод [**IPropertySetStorage:: Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) нельзя использовать для открытия набора свойств после использования [**стгкреатесторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) для создания объекта хранилища.</span><span class="sxs-lookup"><span data-stu-id="68127-139">You cannot use the [**IPropertySetStorage::Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) method to open a property set after using [**StgCreateStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) to create the storage object.</span></span> <span data-ttu-id="68127-140">Вместо этого необходимо использовать [**стгопенсторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) перед запросом на [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) и вызовом метода **Open** .</span><span class="sxs-lookup"><span data-stu-id="68127-140">Instead you must use [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) before querying for [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) and calling the **Open** method.</span></span>
-   <span data-ttu-id="68127-141">После открытия составного файла с [**стгопенсторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) с помощью \_ флага стгм Simple и запроса к интерфейсу [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) можно открыть по одному набору свойств за раз с помощью [**IPropertySetStorage:: Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open).</span><span class="sxs-lookup"><span data-stu-id="68127-141">After you open a compound file with [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) using the STGM\_SIMPLE flag and query for the [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) interface, you can open one property set at a time using [**IPropertySetStorage::Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open).</span></span> <span data-ttu-id="68127-142">Кроме того, при открытом наборе свойств может быть невозможно увеличить общий размер набора свойств.</span><span class="sxs-lookup"><span data-stu-id="68127-142">Also, it may not be possible for the total size of the property set to be increased while the property set is open.</span></span>

<span data-ttu-id="68127-143">Простые наборы свойств не могут быть транзакционными.</span><span class="sxs-lookup"><span data-stu-id="68127-143">Simple property sets cannot be transacted.</span></span> <span data-ttu-id="68127-144">Нельзя указать СТГМ \_ в транзакции в параметре *Грфмоде* методов [**CREATE**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) и [**Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) , если в \_ параметре *грффлагс* не указано пропсетфлаг неsimple.</span><span class="sxs-lookup"><span data-stu-id="68127-144">You cannot specify STGM\_TRANSACTED in the *grfmode* parameter of the [**Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) and [**Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) methods unless you also specify PROPSETFLAG\_NONSIMPLE in the *grfFlags* parameter.</span></span> <span data-ttu-id="68127-145">Имейте в виду, что простые и непростые наборы свойств не связаны с наборами свойств простого режима, описанными выше.</span><span class="sxs-lookup"><span data-stu-id="68127-145">Be aware that simple and non-simple property sets are unrelated to the simple-mode property sets described above.</span></span> <span data-ttu-id="68127-146">Дополнительные сведения о простых и непростых наборах свойств см. [в разделе объекты хранилища и потока для набора свойств](storage-vs--stream-for-a-property-set.md).</span><span class="sxs-lookup"><span data-stu-id="68127-146">For more information about simple and nonsimple property sets, see [Storage and Stream Objects for a Property Set](storage-vs--stream-for-a-property-set.md).</span></span>

> [!Note]  
> <span data-ttu-id="68127-147">Наборы свойств Документсуммаринформатион и Пользователяопределенные являются уникальными в том, что они могут иметь два раздела набора свойств.</span><span class="sxs-lookup"><span data-stu-id="68127-147">The DocumentSummaryInformation and UserDefined property sets are unique in that they may have two property set sections.</span></span> <span data-ttu-id="68127-148">Дополнительные сведения см. в описании [наборов свойств документсуммаринформатион и пользователяопределенные](the-documentsummaryinformation-and-userdefined-property-sets.md).</span><span class="sxs-lookup"><span data-stu-id="68127-148">For more information, see [The DocumentSummaryInformation and UserDefined Property Sets](the-documentsummaryinformation-and-userdefined-property-sets.md).</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="68127-149">См. также</span><span class="sxs-lookup"><span data-stu-id="68127-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="68127-150">Ипропертистораже — реализация составного файла</span><span class="sxs-lookup"><span data-stu-id="68127-150">IPropertyStorage - Compound File Implementation</span></span>](ipropertystorage-compound-file-implementation.md)
</dt> <dt>

[<span data-ttu-id="68127-151">**IPropertySetStorage**</span><span class="sxs-lookup"><span data-stu-id="68127-151">**IPropertySetStorage**</span></span>](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage)
</dt> <dt>

[<span data-ttu-id="68127-152">**ипропертистораже**</span><span class="sxs-lookup"><span data-stu-id="68127-152">**IPropertyStorage**</span></span>](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage)
</dt> <dt>

[<span data-ttu-id="68127-153">**IStorage:: Енумелементс**</span><span class="sxs-lookup"><span data-stu-id="68127-153">**IStorage::EnumElements**</span></span>](/windows/desktop/api/Objidl/nf-objidl-istorage-enumelements)
</dt> <dt>

[<span data-ttu-id="68127-154">**Константы ПРОПСЕТФЛАГ**</span><span class="sxs-lookup"><span data-stu-id="68127-154">**PROPSETFLAG Constants**</span></span>](propsetflag-constants.md)
</dt> <dt>

[<span data-ttu-id="68127-155">**статпропсетстг**</span><span class="sxs-lookup"><span data-stu-id="68127-155">**STATPROPSETSTG**</span></span>](/windows/win32/api/propidlbase/nn-propidlbase-ienumstatpropsetstg)
</dt> </dl>

 

 