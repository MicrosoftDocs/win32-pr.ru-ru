---
title: Обзор Стосерве
description: В примере кода Стосерве показано, как использовать структурированные службы хранилища, как указано в реализации составных файлов. Ниже описывается использование стандартных интерфейсов IStorage и IStream.
ms.assetid: 41ccd333-15c8-46b2-91c6-3e1929f7198c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9c0c8325fbc20d4917785d0b83ca70bffa996824
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104338537"
---
# <a name="stoserve-overview"></a>Обзор Стосерве

## <a name="purpose"></a>Назначение

Основное внимание в этом примере кода заключается в использовании структурированных служб хранилища, предоставляемых в реализации составных файлов. Ниже описывается использование стандартных интерфейсов [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) и [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) . **Стосерве** работает с примером кода [стоклиен](structured-storage-client-sample--stoclien-.md) , чтобы продемонстрировать совместное использование составного хранилища файлов клиентом и сервером.

## <a name="functionality"></a>Функциональность

В примере **стосерве** представлен объект COM для сопечатной бумаги, который, в своюмся, представляет пустой лист бумаги.

Объекты-рисунки предоставляют набор функций для рисования произвольной формы на бумаге с использованием рукописного ввода заданного цвета и ширины. Эти функции похожи на примеры учебников «Scribble» во многих версиях Microsoft Visual C++. Разница в примерах **стосерве** / **стоклиен** основана на архитектуре, в основном основанной на технологии COM. Электронные документы с электронными рисунками доступны клиентам через пользовательский интерфейс [**ипапер**](ipaper-methods.md) . Собумага реализует интерфейс **ипапер** . Между клиентом и сервером хранится четкое различие в архитектуре. Графический пользовательский интерфейс (GUI) не предоставляется собумагами. Структура объекта собумага зависит от клиента для всех поведений графического пользовательского интерфейса. Собумага инкапсулирует только серверную запись и хранение созданных рукописных данных.

Рукописные данные, отображаемые на контактной поверхности, могут храниться и загружаться из составных файлов. Методы [**ипапер**](ipaper-methods.md), [**Save**](ipaper--save.md) и [**Load**](ipaper--load.md) принимают указатель интерфейса [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) . Собумага использует этот предоставляемый клиентом интерфейс **IStorage** для хранения данных рисования.

Собумага размещается на внутреннем сервере и становится общедоступной в виде пользовательского COM-компонента. Аналогично другим серверам в этой серии руководств Стосерве — это самостоятельная регистрация сервера COM. Он делает тип объекта кодокумент доступным для клиентов в качестве компонента Дллпапер, используя \_ регистрацию ДЛЛПАПЕР CLSID в реестре.

Как и в предыдущих поддерживаемых серверах, функции подключения объекта поддерживаются в соотношении. Интерфейс [**IConnectionPointContainer**](/windows/win32/api/ocidl/nn-ocidl-iconnectionpointcontainer) предоставляется и реализуется соответствующая точка соединения. В этом контексте объявляется исходящий пользовательский интерфейс Ипаперсинк для использования при отправке уведомлений клиенту.

Два настраиваемых интерфейса [**ипапер**](ipaper-methods.md) и [**ипаперсинк**](ipapersink-methods.md) объявляются в ипапер. H, расположенный в каталоге общего родственного \\ каталога Inc. Идентификаторы GUID для интерфейсов и объектов определяются в ПАПГУИДС. H, расположенный в том же общем каталоге Include.

Механизм Ксреадед в АППУТИЛ используется **стосерве** для обеспечения потокобезопасности, как это было в примере фресерве. Объекты собумаги являются производными от класса Ксреадед и наследуют свои методы Овнсис и Уновнсис. Эти методы позволяют только одному потоку за раз получать доступ к серверу **стосерве** и к сопечатным объектам, управляемым сервером.

## <a name="copaper-com-object"></a>COM-объект собумаги

COM-объект собумаги является типом одного объекта, управляемого этим **стосерве** внутрипроцессного сервера. Собумага создается как подключаемый COM-объект с реализацией стандартного интерфейса [**IConnectionPointContainer**](/windows/win32/api/ocidl/nn-ocidl-iconnectionpointcontainer) и реализацией пользовательского интерфейса [**ипапер**](ipaper-methods.md) . Собумага предоставляет интерфейс **ипапер** , чтобы клиенты могли выполнять небольшой набор операций с электронными бумагами на экземпляре собумаги. Основными операциями являются запуск последовательности рукописного ввода, рисование рукописных данных в виртуальной области бумаги и завершение последовательности рукописного рисования. В этой схеме предполагается, что клиент является приложением с графическим интерфейсом, управляемым мышью или планшетным устройством. Клиент отвечает за преобразование движений мыши в запросы к собумагам, что сохраняет эти запросы как рукописные данные.

Существует два уровня рукописных данных, сохраняемых в содокументе. Собумага сохраняет рукописные данные в массиве, основанном на ОЗУ, который представляет текущий рисунок, а собумага постоянно сохраняет весь рисунок в составной файл. Методы в интерфейсе [**ипапер**](ipaper-methods.md) выполняют оба действия.

Поскольку клиент не управляет выписанными данными бумаги, но отвечает за визуализацию изображения на экране, реализация [**ипапер**](ipaper-methods.md) в соавторе должна предоставлять метод, позволяющий клиенту получать данные рисования. Для этой цели используется технология Connected Object в содокументе. \_Точка соединения коннпоинт паперсинк реализуется Собумагами, поэтому клиент может подключаться к Собумагам, чтобы получить рукописные данные для рисования. Клиент сначала вызывает метод [ипапер:: Redraw](ipaper--redraw.md) объекта, чтобы запросить все рукописные данные текущего документа. После этого реализация перерисовки с помощью клиента использует клиентскую реализацию [**ипаперсинк**](ipapersink-methods.md) для передачи данных клиенту.

По мере того, как пользователь в интерактивном режиме рисуется на клиенте, данные немедленно рисуются на экране, а также отправляются в собумагу для сохранения. Когда клиенту требуется перерисовка экрана, он вызывает метод [перерисовки](ipaper--redraw.md) . Такое перерисовка часто встречается в приложениях. Например, перерисовка происходит, когда окно клиента перемещается другим окном приложения. У клиента имеется растровое изображение, отображаемое на изображении, но точечный рисунок легко теряется и часто требуется перерисовать. Клиент использует собумагу на сервере для рукописных данных, необходимых для перерисовки.

Это общая часть работы клиента/сервера. Это особенно уместно, если требуется, чтобы несколько клиентов совместно используют данные. Собумага кодируется для реализации этой возможности. Он использует средство АППУТИЛ Ксреадед для обеспечения потокобезопасности. Приложение, которое может использовать эту архитектуру, является общим приложением для доски, где несколько клиентов могут участвовать в просмотре. Поддержка DCOM для распределенного COM-порта поддерживает этот тип использования приложений рабочей группы в сети. Дополнительные сведения см. в предыдущем примере РЕМКЛИЕН.

Более неограниченное использование схемы «клиент/сервер» заключается в интеграции поведения для объектов, реализованных в различных приложениях на одном компьютере. В этом случае клиенты могут быть контейнером ActiveX в отдельных приложениях, совместно использующих данные, управляемые одним и тем же объектом. Эти данные могут не быть данными рисования рукописных данных, которые поддерживает компонент Дллпапер. **Стосерве** можно использовать в качестве начальной платформы для программных компонентов, которые управляют другими типами общих данных.

## <a name="support-information"></a>Данные поддержки

Файл Makefile **стосерве** регистрирует COM-компонент **стосерве** дллпапер в реестре. Этот компонент должен быть зарегистрирован до того, как **стосерве** будет доступен внешним клиентам COM в качестве сервера для этого компонента. Эта самостоятельная регистрация выполняется с помощью служебной программы Register.exe, встроенной в пример регистрации. Чтобы создать или запустить **стосерве**, сначала создайте пример кода регистрации.

Дополнительные сведения о настройке системы для создания и тестирования примеров кода в этой серии руководств по COM см. в разделе [Создание образцов](how-to-build-samples.md). Указанный файл Makefile (MAKEFILE) совместим с Microsoft NMAKE. Чтобы создать отладочную сборку, выполните команду NMAKE в окне командной строки.

Для удобства использования в Microsoft Visual Studio для каждого примера предоставляется файл проекта. Чтобы загрузить проект для примера **стосерве** , можно запустить Visual Studio из командной строки в каталоге Samples следующим образом:

МСДЕВ СТОСЕРВЕ. DSP

Можно также дважды щелкнуть файл Стосерве. DSP в проводнике Windows, чтобы загрузить пример проекта в Visual Studio. В Visual Studio можно просмотреть классы C++ образца источника и, как правило, выполнить другие операции Edit-Compile-Debug.

> [!Note]  
> При компиляции этих примеров из Visual Studio в составе пакета SDK для платформы требуется правильная настройка путей к каталогам в Visual Studio. Дополнительные сведения см. [в разделе Создание образцов](how-to-build-samples.md).

 

 

 