---
title: Рекомендации по хранению свойств
description: Ипропертистораже Реадмултипле считывает столько свойств, сколько указано в массиве ргпспек, как и в наборе свойств.
ms.assetid: 7540966f-a3b2-46c9-9e04-b15133a517eb
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2aad6aabf8b22a7c01f91a090136e6cc8156c791
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105661735"
---
# <a name="property-storage-considerations"></a><span data-ttu-id="c3a40-103">Рекомендации по хранению свойств</span><span class="sxs-lookup"><span data-stu-id="c3a40-103">Property Storage Considerations</span></span>

<span data-ttu-id="c3a40-104">[**Ипропертистораже:: реадмултипле**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) считывает столько свойств, сколько указано в массиве *ргпспек* , как и в наборе свойств.</span><span class="sxs-lookup"><span data-stu-id="c3a40-104">[**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) reads as many of the properties specified in the *rgpspec* array as are found in the property set.</span></span> <span data-ttu-id="c3a40-105">Пока выполняется чтение любого запрошенного свойства, запрос на получение несуществующего свойства не является ошибкой.</span><span class="sxs-lookup"><span data-stu-id="c3a40-105">As long as any of the properties requested is read, a request to retrieve a property that does not exist is not an error.</span></span> <span data-ttu-id="c3a40-106">Вместо этого это должно привести к тому, \_ что VT Empty будет записан для этого свойства в массив *ргвар* \[ \] при возврате.</span><span class="sxs-lookup"><span data-stu-id="c3a40-106">Instead, this must cause VT\_EMPTY to be written for that property to the *rgvar*\[\] array on return.</span></span> <span data-ttu-id="c3a40-107">Если ни одно из запрошенных свойств не существует, метод должен вернуть \_ значение false и установить VT \_ Empty в каждом [**пропвариант**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant).</span><span class="sxs-lookup"><span data-stu-id="c3a40-107">When none of the requested properties exist, the method should return S\_FALSE, and set VT\_EMPTY in each [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant).</span></span> <span data-ttu-id="c3a40-108">Если возвращается любая другая ошибка, значения свойств не извлекаются, и вызывающему объекту не нужно беспокоиться об их освобождении.</span><span class="sxs-lookup"><span data-stu-id="c3a40-108">If any other error is returned, no property values are retrieved, and the caller need not worry about releasing them.</span></span>

<span data-ttu-id="c3a40-109">Параметр *ргпспек* — это массив структур [**пропспек**](/windows/win32/api/propidlbase/ns-propidlbase-propspec) , которые указывают для каждого свойства либо идентификатор его свойства, либо значение, если оно назначено, строковый идентификатор.</span><span class="sxs-lookup"><span data-stu-id="c3a40-109">The *rgpspec* parameter is an array of [**PROPSPEC**](/windows/win32/api/propidlbase/ns-propidlbase-propspec) structures, which specify for each property either its property identifier or, if one is assigned, a string identifier.</span></span> <span data-ttu-id="c3a40-110">Можно сопоставлять строку с идентификатором свойства, вызвав [**ипропертистораже:: вритепропертинамес**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writepropertynames).</span><span class="sxs-lookup"><span data-stu-id="c3a40-110">You can map a string to a property identifier by calling [**IPropertyStorage::WritePropertyNames**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writepropertynames).</span></span> <span data-ttu-id="c3a40-111">Однако использование идентификаторов свойств, скорее всего, будет значительно более эффективным, чем использование строк.</span><span class="sxs-lookup"><span data-stu-id="c3a40-111">The use of property identifiers is, however, likely to be significantly more efficient than the use of strings.</span></span>

<span data-ttu-id="c3a40-112">Свойства, запрашиваемые строковым именем (ПРСПЕК \_ LPWSTR), сопоставляются без учета регистра с идентификаторами свойств (ID), так как они указаны в текущем наборе свойств (и в соответствии с текущей национальной настройкой системы).</span><span class="sxs-lookup"><span data-stu-id="c3a40-112">Properties that are requested by string name (PRSPEC\_LPWSTR) are mapped case-insensitively to property identifiers (IDs) as they are specified in the current property set (and according to the current system locale).</span></span>

<span data-ttu-id="c3a40-113">Если тип свойства — VT \_ LPSTR и свойство считывается из набора свойств ANSI, то есть кодовая страница для набора свойств задается не в Юникоде, а значение свойства использует ту же кодовую страницу, что и набор свойств.</span><span class="sxs-lookup"><span data-stu-id="c3a40-113">When the property type is VT\_LPSTR and the property is read from an ANSI property set, that is, the code page for the property set is set to something other than Unicode, the value of the property uses the same code page as the property set.</span></span> <span data-ttu-id="c3a40-114">Если свойство VT \_ LPSTR считывается из набора свойств Юникода, то значение свойства использует текущую системную кодовую страницу ANSI по умолчанию, то есть кодовую страницу, возвращаемую функцией **жетакп** .</span><span class="sxs-lookup"><span data-stu-id="c3a40-114">When a VT\_LPSTR property is read from a Unicode property set, the value of the property uses the system's current default ANSI code page, that is, the code page returned from the **GetACP** function.</span></span>

<span data-ttu-id="c3a40-115">[**Пропвариант**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant), за исключением тех, которые являются указателями на потоки и хранилища, называется простым **пропвариант**.</span><span class="sxs-lookup"><span data-stu-id="c3a40-115">A [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant), except for those that are pointers to streams and storages, is called a simple **PROPVARIANT**.</span></span> <span data-ttu-id="c3a40-116">Эти простые **пропвариант** получают данные по значению, поэтому вызов [**Ипропертистораже:: реадмултипле**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) предоставляет копию данных, которой владеет вызывающий объект.</span><span class="sxs-lookup"><span data-stu-id="c3a40-116">These simple **PROPVARIANT** s receive data by value, so a call to [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) supplies a copy of the data that the caller then owns.</span></span> <span data-ttu-id="c3a40-117">Чтобы создать или обновить эти свойства, вызовите метод [**ипропертистораже:: вритемултипле**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span><span class="sxs-lookup"><span data-stu-id="c3a40-117">To create or update these properties, call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span></span>

<span data-ttu-id="c3a40-118">Напротив, типы Variant VT \_ Stream, \_ потоковый объект VT, \_ \_ хранилище VT и \_ объект VT \_ являются непростыми свойствами, поскольку вместо предоставления значения метод получает указатель на указанный интерфейс, из которого данные можно считывать.</span><span class="sxs-lookup"><span data-stu-id="c3a40-118">In contrast, the variant types VT\_STREAM, VT\_STREAMED\_OBJECT, VT\_STORAGE, and VT\_STORED\_OBJECT are non-simple properties, because rather than supplying a value, the method retrieves a pointer to the indicated interface, from which the data can then be read.</span></span> <span data-ttu-id="c3a40-119">Эти типы допускают хранение больших объемов информации с помощью одного свойства.</span><span class="sxs-lookup"><span data-stu-id="c3a40-119">These types permit the storage of large amounts of information through a single property.</span></span> <span data-ttu-id="c3a40-120">Существует несколько проблем, возникающих при использовании непростых свойств.</span><span class="sxs-lookup"><span data-stu-id="c3a40-120">There are several issues that arise in using nonsimple properties.</span></span>

<span data-ttu-id="c3a40-121">Чтобы создать эти свойства, как и для других свойств, вызовите [**ипропертистораже:: вритемултипле**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span><span class="sxs-lookup"><span data-stu-id="c3a40-121">To create these properties, as for the other properties, call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span></span> <span data-ttu-id="c3a40-122">Однако, вместо вызова того же метода для обновления, более эффективно сначала вызывается метод [**ипропертистораже:: реадмултипле**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) , чтобы получить указатель интерфейса на поток или хранилище, а затем запишите данные с помощью методов [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) или [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="c3a40-122">Rather than calling the same method to update, however, it is more efficient to first call [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) to get the interface pointer to the stream or storage, then write data using the [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) or [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) methods.</span></span> <span data-ttu-id="c3a40-123">Поток или хранилище, открытые с помощью свойства, всегда открываются в прямом режиме, поэтому дополнительный уровень вложенной транзакции не вводится.</span><span class="sxs-lookup"><span data-stu-id="c3a40-123">A stream or storage opened through a property is always opened in direct mode, so an additional level of nested transaction is not introduced.</span></span> <span data-ttu-id="c3a40-124">Тем не менее, в зависимости от того, как оно было открыто или создано с помощью [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage), все еще может быть транзакцией в наборе свойств в целом.</span><span class="sxs-lookup"><span data-stu-id="c3a40-124">There may, however, still be a transaction on the property set as a whole, depending on how it was opened or created through [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage).</span></span> <span data-ttu-id="c3a40-125">Кроме того, Теги режима доступа и совместного использования, указанные при открытии или создании набора свойств, передаются в потоки или хранилища на основе свойств.</span><span class="sxs-lookup"><span data-stu-id="c3a40-125">Further, the access and share mode tags specified when the property set is opened or created, are passed to property-based streams or storages.</span></span>

<span data-ttu-id="c3a40-126">Время существования потока на основе свойств или указателей хранилища, хотя теоретически не зависит от связанных указателей [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) и [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) , фактически зависит от них.</span><span class="sxs-lookup"><span data-stu-id="c3a40-126">The lifetimes of property-based stream or storage pointers, although theoretically independent of their associated [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) and [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) pointers, in fact, effectively depend on them.</span></span> <span data-ttu-id="c3a40-127">Данные, видимые в потоке или хранилище, связаны с транзакцией в объекте хранилища свойств, откуда они извлекаются, так же как и для объекта хранилища (поддерживающего [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage)) с вложенными объектами Stream и Storage.</span><span class="sxs-lookup"><span data-stu-id="c3a40-127">The data visible through the stream or storage is related to the transaction on the property storage object from which it is retrieved, just as for a storage object (supporting [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage)) with contained stream and storage sub-objects.</span></span> <span data-ttu-id="c3a40-128">Если транзакция в родительском объекте прервана, существующие указатели [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) и **IStorage** , подчиненные этому объекту, становятся недоступными.</span><span class="sxs-lookup"><span data-stu-id="c3a40-128">If the transaction on the parent object is aborted, existing [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) and **IStorage** pointers subordinate to that object are no longer accessible.</span></span> <span data-ttu-id="c3a40-129">Поскольку **ипропертистораже** является единственным интерфейсом в объекте хранилища свойств, полезное время существования содержащихся в них указателей **IStream** и **IStorage** ограничивается временем существования интерфейса **ипропертистораже** .</span><span class="sxs-lookup"><span data-stu-id="c3a40-129">Because **IPropertyStorage** is the only interface on the property storage object, the useful lifetime of the contained **IStream** and **IStorage** pointers is bounded by the lifetime of the **IPropertyStorage** interface.</span></span>

<span data-ttu-id="c3a40-130">Реализация также должна иметь дело с ситуацией, когда одно и то же свойство потока или значение с хранилищем запрашивается несколько раз с помощью одного экземпляра интерфейса [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) .</span><span class="sxs-lookup"><span data-stu-id="c3a40-130">The implementation must also deal with the situation where the same stream- or storage-valued property is requested multiple times through the same [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) interface instance.</span></span> <span data-ttu-id="c3a40-131">Например, в реализации составного файла COM открытие будет успешным или неудачным в зависимости от того, открыто ли это свойство.</span><span class="sxs-lookup"><span data-stu-id="c3a40-131">For example, in the COM compound file implementation, the open will succeed or fail depending on whether or not the property is already open.</span></span>

<span data-ttu-id="c3a40-132">Другой проблемой является несколько открытий в режиме транзакций.</span><span class="sxs-lookup"><span data-stu-id="c3a40-132">Another issue is multiple opens in transacted mode.</span></span> <span data-ttu-id="c3a40-133">Результат зависит от уровня изоляции, который был указан с помощью вызова методов [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) (метод [**открытия**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) или [**создания**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) с помощью флагов стгм) на момент открытия хранилища свойств.</span><span class="sxs-lookup"><span data-stu-id="c3a40-133">The result depends on the isolation level that was specified through a call to [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) methods, (either the [**Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) or [**Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) method, through the STGM flags) at the time that the property storage was opened.</span></span>

<span data-ttu-id="c3a40-134">Если вызов для открытия набора свойств указывает доступ на чтение и запись, то свойства [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) и [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream)всегда открываются с доступом на чтение и запись.</span><span class="sxs-lookup"><span data-stu-id="c3a40-134">If the call to open the property set specifies read-write access, [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) and [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream)-valued properties are always opened with read-write access.</span></span> <span data-ttu-id="c3a40-135">Затем данные можно записать с помощью этих интерфейсов, изменив значение свойства, которое является наиболее эффективным способом обновления этих свойств.</span><span class="sxs-lookup"><span data-stu-id="c3a40-135">Data can then be written through these interfaces, changing the value of the property, which is the most efficient way to update these properties.</span></span> <span data-ttu-id="c3a40-136">Само значение свойства не имеет дополнительного уровня вложенности транзакций, поэтому изменения зависят от транзакции (при ее наличии) в объекте хранилища свойств.</span><span class="sxs-lookup"><span data-stu-id="c3a40-136">The property value itself does not have an additional level of transaction nesting, so changes are scoped under the transaction (if any) on the property storage object.</span></span>

## <a name="storage-and-stream-properties"></a><span data-ttu-id="c3a40-137">Свойства хранилища и потока</span><span class="sxs-lookup"><span data-stu-id="c3a40-137">Storage and Stream Properties</span></span>

<span data-ttu-id="c3a40-138">Чтобы записать поток или объект хранилища в набор свойств, набор свойств должен быть создан как непростой.</span><span class="sxs-lookup"><span data-stu-id="c3a40-138">To write a stream or storage object to a property set, the property set must have been created as nonsimple.</span></span> <span data-ttu-id="c3a40-139">Дополнительные сведения о простых и непростых наборах свойств см. в разделе [объект хранилища и объекты потока для набора свойств](storage-vs--stream-for-a-property-set.md).</span><span class="sxs-lookup"><span data-stu-id="c3a40-139">For more information on simple and nonsimple property sets, see the section titled [Storage and Stream Objects for a Property Set](storage-vs--stream-for-a-property-set.md).</span></span> <span data-ttu-id="c3a40-140">Следующие типы свойств, как указано в поле *VT* элементов массива *ргвар* , являются потоками или типами хранения: VT \_ Stream, VT \_ , VT, \_ потоковый \_ объект VT \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="c3a40-140">The following property types, as specified in the *vt* field of the *rgvar* array elements, are stream or storage types: VT\_STREAM, VT\_STORAGE, VT\_STREAMED\_OBJECT, VT\_STORED\_OBJECT.</span></span>

<span data-ttu-id="c3a40-141">Чтобы записать поток или объект хранилища в качестве свойства в непростом наборе свойств, вызовите метод [**ипропертистораже:: вритемултипле**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span><span class="sxs-lookup"><span data-stu-id="c3a40-141">To write a stream or storage object as a property in a non-simple property set, call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span></span> <span data-ttu-id="c3a40-142">Хотя этот метод также вызывается для обновления простых свойств, он не является эффективным способом обновления потоков и объектов хранения в наборе свойств.</span><span class="sxs-lookup"><span data-stu-id="c3a40-142">While you would also call this method to update simple properties, it is not an efficient way to update stream and storage objects in a property set.</span></span> <span data-ttu-id="c3a40-143">Это связано с тем, что обновление одного из этих свойств с помощью вызова **вритемултипле** в объекте хранилища свойств копирует данные переданных, а указатели [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) и [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) не сохраняются за время этого вызова.</span><span class="sxs-lookup"><span data-stu-id="c3a40-143">This is because updating one of these properties through a call to **WriteMultiple** creates in the property storage object a copy of the passed-in data, and the [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) or [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) pointers are not retained beyond the duration of this call.</span></span> <span data-ttu-id="c3a40-144">Обычно более эффективно обновлять поток или объекты хранилища напрямую, вызывая метод [**ипропертистораже:: реадмултипле**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) , чтобы получить указатель интерфейса на поток или хранилище, а затем записать данные с помощью методов **IStream** или **IStorage** .</span><span class="sxs-lookup"><span data-stu-id="c3a40-144">It is usually more efficient to update stream or storage objects directly by first calling [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) to get the interface pointer to the stream or storage, then writing data through the **IStream** or **IStorage** methods.</span></span>

<span data-ttu-id="c3a40-145">Например, можно вызвать [**ипропертистораже:: вритемултипле**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) для записи **пустого** потока или объекта хранилища.</span><span class="sxs-lookup"><span data-stu-id="c3a40-145">For example, you can call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) to write a **NULL** stream or storage object.</span></span> <span data-ttu-id="c3a40-146">Реализация создаст пустой объект в наборе свойств.</span><span class="sxs-lookup"><span data-stu-id="c3a40-146">The implementation will then create an empty object in the property set.</span></span> <span data-ttu-id="c3a40-147">Затем можно получить доступ к этому объекту, вызвав [**ипропертистораже:: реадмултипле**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple).</span><span class="sxs-lookup"><span data-stu-id="c3a40-147">You can then get access to this object by calling [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple).</span></span> <span data-ttu-id="c3a40-148">После завершения обновления этого объекта его не нужно записывать в набор свойств, так как обновления находились непосредственно в наборе свойств.</span><span class="sxs-lookup"><span data-stu-id="c3a40-148">When you finish updating this object you need not write it to the property set, as your updates were going directly into the property set.</span></span>

<span data-ttu-id="c3a40-149">Поток или хранилище, открытые с помощью свойства, всегда открываются в прямом режиме, поэтому дополнительный уровень вложенной транзакции не вводится.</span><span class="sxs-lookup"><span data-stu-id="c3a40-149">A stream or storage opened through a property is always opened in direct mode, so an additional level of nested transaction is not introduced.</span></span> <span data-ttu-id="c3a40-150">По-прежнему может существовать транзакция над свойством, заданным в целом.</span><span class="sxs-lookup"><span data-stu-id="c3a40-150">There still may be a transaction on the property set as a whole.</span></span> <span data-ttu-id="c3a40-151">(Например, если [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) был получен вызовом [**IPropertySetStorage:: Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) с стгм \_ Флаг транзакций, заданный в параметре *грфмоде* .) Кроме того, поток или хранилище на основе свойств открывается в режиме чтения и записи, если это возможно, учитывая режим набора свойств. в противном случае используется режим чтения.</span><span class="sxs-lookup"><span data-stu-id="c3a40-151">(For example, if the [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) was obtained by calling [**IPropertySetStorage::Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) with the STGM\_TRANSACTED flag set in the *grfmode* parameter.) Further, a property-based stream or storage is opened in read-write mode, if possible, given the mode on the property set; otherwise, read mode is used.</span></span>

<span data-ttu-id="c3a40-152">Как упоминалось ранее, при записи потока или объекта хранилища в свойство, заданное с помощью метода [**вритемултипле**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) , создается копия объекта.</span><span class="sxs-lookup"><span data-stu-id="c3a40-152">As mentioned earlier, when a stream or storage object is written to a property set with the [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) method, a copy of the object is made.</span></span> <span data-ttu-id="c3a40-153">Если такая копия выполняется в объекте потока, операция копирования начинается с текущей позиции поиска источника.</span><span class="sxs-lookup"><span data-stu-id="c3a40-153">When such a copy is made on a stream object, the copy operation starts at the current seek position of the source.</span></span> <span data-ttu-id="c3a40-154">Положение поиска не определено при сбое, но в случае успеха он находится в конце потока; указатель поиска не восстанавливается в исходное положение.</span><span class="sxs-lookup"><span data-stu-id="c3a40-154">The seek position is undefined on failure, but on success it is at the end of the stream; the seek pointer is not restored to its original position.</span></span>

<span data-ttu-id="c3a40-155">Если поток или свойство хранилища было считано из свойства, установленного с помощью [**реадмултипле**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple), по-прежнему удерживается открытым и последующий вызов [**вритемултипле**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) для того же свойства, операция **вритемултипле** будет выполнена успешно.</span><span class="sxs-lookup"><span data-stu-id="c3a40-155">If a stream or storage property has been read from a property set with [**ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple), is still held open, and a subsequent call to [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) for the same property is made, the **WriteMultiple** operation will succeed.</span></span> <span data-ttu-id="c3a40-156">Ранее открытый поток или свойство хранилища помещается в отмененное состояние (все вызовы будут возвращать \_ ошибку STG E \_ reverted).</span><span class="sxs-lookup"><span data-stu-id="c3a40-156">The previously opened stream or storage property is placed in the reverted state (all calls to it will return STG\_E\_REVERTED error).</span></span>

<span data-ttu-id="c3a40-157">Если метод [**вритемултипле**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) возвращает ошибку при записи массива свойств или даже отдельных непростых свойств, фактически записанный объем данных не определен.</span><span class="sxs-lookup"><span data-stu-id="c3a40-157">If the [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) method returns an error when writing an array of properties, or even individual non-simple properties, the amount of data actually written is undefined.</span></span>

## <a name="reference-properties"></a><span data-ttu-id="c3a40-158">Свойства ссылки</span><span class="sxs-lookup"><span data-stu-id="c3a40-158">Reference Properties</span></span>

<span data-ttu-id="c3a40-159">Если указанная структура [**пропвариант**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) включает флаг VT \_ ByRef в его члене **VT** , то связанное свойство является ссылочным свойством.</span><span class="sxs-lookup"><span data-stu-id="c3a40-159">If a specified [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) structure includes the VT\_BYREF flag in its **vt** member, the associated property is a reference property.</span></span> <span data-ttu-id="c3a40-160">Перед записью значения в набор свойств ссылочное свойство автоматически удаляется из ссылки.</span><span class="sxs-lookup"><span data-stu-id="c3a40-160">A reference property is automatically dereferenced before writing the value to the property set.</span></span> <span data-ttu-id="c3a40-161">Например, если элемент **VT** в структуре **пропвариант** указывает значение типа VT \_ ByRef \| VT \_ I4, фактическое значение записано как \_ Тип VT i4.</span><span class="sxs-lookup"><span data-stu-id="c3a40-161">For example, if the **vt** member of the **PROPVARIANT** structure specifies a value of type VT\_BYREF \| VT\_I4, the actual value written is a VT\_I4 type.</span></span> <span data-ttu-id="c3a40-162">При последующем вызове метода [**ипропертистораже:: реадмултипле**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) возвращается значение VT \_ i4.</span><span class="sxs-lookup"><span data-stu-id="c3a40-162">A subsequent call to the [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) method returns a value as VT\_I4.</span></span> <span data-ttu-id="c3a40-163">Использование свойств ссылок аналогично вызову функции [варианткопинд](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) .</span><span class="sxs-lookup"><span data-stu-id="c3a40-163">Using reference properties is similar to calling the [VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) function.</span></span> <span data-ttu-id="c3a40-164">[Варианткопинд](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) освобождает целевой вариант и создает копию исходного VARIANTARG, выполняя необходимое косвенное обращение, если источник указан как VT \_ ByRef.</span><span class="sxs-lookup"><span data-stu-id="c3a40-164">[VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) frees the destination variant and makes a copy of the source VARIANTARG, performing the necessary indirection if the source is specified to be VT\_BYREF.</span></span> <span data-ttu-id="c3a40-165">Эта функция полезна, если требуется копия варианта и гарантировать, что она не является VT \_ ByRef, например при обработке аргументов в реализации [**IDispatch:: Invoke**](/windows/win32/api/oaidl/nf-oaidl-idispatch-invoke).</span><span class="sxs-lookup"><span data-stu-id="c3a40-165">This function is useful when a copy of a variant is needed, and to guarantee that it is not VT\_BYREF, for example when handling arguments in an implementation of [**IDispatch::Invoke**](/windows/win32/api/oaidl/nf-oaidl-idispatch-invoke).</span></span>

## <a name="notes-to-callers"></a><span data-ttu-id="c3a40-166">Примечания для тех, кто вызывает этот метод</span><span class="sxs-lookup"><span data-stu-id="c3a40-166">Notes to Callers</span></span>

<span data-ttu-id="c3a40-167">Рекомендуется создавать наборы свойств в Юникоде, не устанавливая \_ флаг ANSI пропсетфлаг в параметре *Грффлагс* объекта [**IPropertySetStorage:: Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create).</span><span class="sxs-lookup"><span data-stu-id="c3a40-167">It is recommended that property sets be created as Unicode, by not setting the PROPSETFLAG\_ANSI flag in the *grfFlags* parameter of [**IPropertySetStorage::Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create).</span></span> <span data-ttu-id="c3a40-168">Также рекомендуется избегать использования \_ значений VT LPSTR и использовать \_ вместо них значения VT LPWSTR.</span><span class="sxs-lookup"><span data-stu-id="c3a40-168">It is also recommended that you avoid using VT\_LPSTR values, and use VT\_LPWSTR values instead.</span></span> <span data-ttu-id="c3a40-169">Если кодовая страница набора свойств — Unicode, \_ строковые значения VT LPSTR преобразуются в Юникод при сохранении и возвращаются в многобайтовые строковые значения при извлечении.</span><span class="sxs-lookup"><span data-stu-id="c3a40-169">When the property set code page is Unicode, VT\_LPSTR string values are converted to Unicode when stored, and back to multibyte string values when retrieved.</span></span> <span data-ttu-id="c3a40-170">Если кодовая страница набора свойств не является Юникодом, имена свойств, строки VT \_ и непростые значения свойств преобразуются в многобайтовые строки при сохранении и преобразуются обратно в Юникод при извлечении, то все используют текущую системную кодовую страницу ANSI.</span><span class="sxs-lookup"><span data-stu-id="c3a40-170">When the code page of the property set is not Unicode, property names, VT\_BSTR strings, and non-simple property values are converted to multibyte strings when stored, and converted back to Unicode when retrieved, all using the current system ANSI code page.</span></span>

## <a name="notes-to-implementers"></a><span data-ttu-id="c3a40-171">Примечания для тех, кто реализует этот метод</span><span class="sxs-lookup"><span data-stu-id="c3a40-171">Notes to Implementers</span></span>

<span data-ttu-id="c3a40-172">При выделении идентификатора свойства реализация может выбрать любое значение, которое не используется в данный момент в свойстве, заданном для идентификатора свойства, если оно не равно 0 или 1 или больше 0x80000000, все из которых являются зарезервированными значениями.</span><span class="sxs-lookup"><span data-stu-id="c3a40-172">When allocating a property identifier, the implementation can choose any value not currently in use in the property set for a property identifier, as long as it is not 0 or 1 or greater than 0x80000000, all of which are reserved values.</span></span> <span data-ttu-id="c3a40-173">Параметр *пропиднамефирст* устанавливает минимальное значение для идентификаторов свойств в наборе и должно быть больше 1 и меньше 0x80000000.</span><span class="sxs-lookup"><span data-stu-id="c3a40-173">The *propidNameFirst* parameter establishes a minimum value for property identifiers within the set, and must be greater than 1 and less than 0x80000000.</span></span> <span data-ttu-id="c3a40-174">См. раздел "Примечания" выше.</span><span class="sxs-lookup"><span data-stu-id="c3a40-174">See Remarks section above.</span></span>

## <a name="related-topics"></a><span data-ttu-id="c3a40-175">См. также</span><span class="sxs-lookup"><span data-stu-id="c3a40-175">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c3a40-176">Ипропертистораже — реализация составного файла</span><span class="sxs-lookup"><span data-stu-id="c3a40-176">IPropertyStorage-Compound File Implementation</span></span>](ipropertystorage-compound-file-implementation.md)
</dt> <dt>

[<span data-ttu-id="c3a40-177">Ипропертистораже — реализация файловой системы NTFS</span><span class="sxs-lookup"><span data-stu-id="c3a40-177">IPropertyStorage-NTFS File System Implementation</span></span>](ipropertystorage-ntfs-file-system-implementation.md)
</dt> <dt>

[<span data-ttu-id="c3a40-178">Ипропертистораже — изолированная реализация</span><span class="sxs-lookup"><span data-stu-id="c3a40-178">IPropertyStorage-Stand-alone Implementation</span></span>](ipropertystorage-stand-alone-implementation.md)
</dt> </dl>

 

 