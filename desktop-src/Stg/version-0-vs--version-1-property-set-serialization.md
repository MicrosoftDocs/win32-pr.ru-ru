---
title: Сериализация набора свойств
description: Существует две версии формата сериализации набора свойств.
ms.assetid: 10544118-5e80-47e2-b75b-c1a43be15b2e
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 49c635728e169cdddb20437323a49a18496b3459
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104260932"
---
# <a name="property-set-serialization"></a><span data-ttu-id="2d426-103">Сериализация набора свойств</span><span class="sxs-lookup"><span data-stu-id="2d426-103">Property Set Serialization</span></span>

<span data-ttu-id="2d426-104">Существует две версии формата сериализации набора свойств.</span><span class="sxs-lookup"><span data-stu-id="2d426-104">There are two versions of the property set serialization format.</span></span> <span data-ttu-id="2d426-105">Исходная спецификация описывает версию 0 формата.</span><span class="sxs-lookup"><span data-stu-id="2d426-105">The original specification describes version 0 of the format.</span></span> <span data-ttu-id="2d426-106">Дополнительные сведения см. в разделе [Формат версии](format-version.md) .</span><span class="sxs-lookup"><span data-stu-id="2d426-106">See [Format Version](format-version.md) for more information.</span></span> <span data-ttu-id="2d426-107">Версия 1 расширяет исходную версию.</span><span class="sxs-lookup"><span data-stu-id="2d426-107">Version 1 extends the original version.</span></span> <span data-ttu-id="2d426-108">Все наборы свойств версии 0 допустимы как наборы свойств версии 1.</span><span class="sxs-lookup"><span data-stu-id="2d426-108">All version 0 property sets are valid as version 1 property sets.</span></span> <span data-ttu-id="2d426-109">В поле **версия формата** в заголовке сериализованного набора свойств указывается версия.</span><span class="sxs-lookup"><span data-stu-id="2d426-109">The **Format Version** field in the header of a serialized property set indicates the version.</span></span>

<span data-ttu-id="2d426-110">Следующие элементы указывают различия между свойствами версий 0 и 1, заданных в форматах сериализации.</span><span class="sxs-lookup"><span data-stu-id="2d426-110">The following items identify the differences between version 0 and version 1 property set serialization formats.</span></span>

-   <span data-ttu-id="2d426-111">Поддержка новых значений **VarType** .</span><span class="sxs-lookup"><span data-stu-id="2d426-111">Support for new **VARTYPE** values.</span></span> <span data-ttu-id="2d426-112">Дополнительные сведения о значениях **VarType** и способах их использования см. в разделе [типы данных и структуры IDispatch]( /previous-versions/ms221600(v=vs.100)) и структура [**пропвариант**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) .</span><span class="sxs-lookup"><span data-stu-id="2d426-112">For more information about **VARTYPE** values and how to use them, see the topic [IDispatch Data Types and Structures]( /previous-versions/ms221600(v=vs.100)) and the [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) structure.</span></span>

    <span data-ttu-id="2d426-113">Следующие значения **VarType** не поддерживаются в наборах свойств версии 0, но поддерживаются в версии 1:</span><span class="sxs-lookup"><span data-stu-id="2d426-113">The following **VARTYPE** values are not supported in version 0 property sets, but are supported in version 1:</span></span>

    <span data-ttu-id="2d426-114">VT \_ I1</span><span class="sxs-lookup"><span data-stu-id="2d426-114">VT\_I1</span></span>

    <span data-ttu-id="2d426-115">VT \_ вектор \| VT \_ I1</span><span class="sxs-lookup"><span data-stu-id="2d426-115">VT\_VECTOR \| VT\_I1</span></span>

    <span data-ttu-id="2d426-116">VT \_ int</span><span class="sxs-lookup"><span data-stu-id="2d426-116">VT\_INT</span></span>

    <span data-ttu-id="2d426-117">VT \_ uint</span><span class="sxs-lookup"><span data-stu-id="2d426-117">VT\_UINT</span></span>

    <span data-ttu-id="2d426-118">VT \_ Decimal</span><span class="sxs-lookup"><span data-stu-id="2d426-118">VT\_DECIMAL</span></span>

    <span data-ttu-id="2d426-119">Кроме того, SafeArray можно сериализовать в наборе свойств.</span><span class="sxs-lookup"><span data-stu-id="2d426-119">Additionally, SafeArrays can be serialized in a property set.</span></span> <span data-ttu-id="2d426-120">Наличие массива SafeArray указывается в \_ сочетании с массивом VT, используя операцию **or** с элементами массива в элементе **VT** структуры [**пропвариант**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) .</span><span class="sxs-lookup"><span data-stu-id="2d426-120">The presence of a SafeArray is indicated by the VT\_ARRAY bit combined, using an **OR** operation, with the array elements in the **vt** member of the [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) structure.</span></span> <span data-ttu-id="2d426-121">Например, массив SafeArray с 4-байтовыми целыми числами со знаком имеет тип VT, \_ \| VT \_ .</span><span class="sxs-lookup"><span data-stu-id="2d426-121">For example, a SafeArray of 4-byte signed integers has a type of VT\_ARRAY \| VT\_I4.</span></span>

    <span data-ttu-id="2d426-122">Следующие типы элементов допустимы для SafeArray в сериализованном наборе свойств:</span><span class="sxs-lookup"><span data-stu-id="2d426-122">The following element types are valid for a SafeArray in a serialized property set:</span></span>



|             |          |             |           |
|-------------|----------|-------------|-----------|
| <span data-ttu-id="2d426-123">VT \_ I1</span><span class="sxs-lookup"><span data-stu-id="2d426-123">VT\_I1</span></span>      | <span data-ttu-id="2d426-124">VT \_ UI1</span><span class="sxs-lookup"><span data-stu-id="2d426-124">VT\_UI1</span></span>  | <span data-ttu-id="2d426-125">VT \_ I2</span><span class="sxs-lookup"><span data-stu-id="2d426-125">VT\_I2</span></span>      | <span data-ttu-id="2d426-126">VT \_ UI2</span><span class="sxs-lookup"><span data-stu-id="2d426-126">VT\_UI2</span></span>   |
| <span data-ttu-id="2d426-127">VT \_ I4</span><span class="sxs-lookup"><span data-stu-id="2d426-127">VT\_I4</span></span>      | <span data-ttu-id="2d426-128">VT \_ UI4</span><span class="sxs-lookup"><span data-stu-id="2d426-128">VT\_UI4</span></span>  | <span data-ttu-id="2d426-129">VT \_ int</span><span class="sxs-lookup"><span data-stu-id="2d426-129">VT\_INT</span></span>     | <span data-ttu-id="2d426-130">VT \_ uint</span><span class="sxs-lookup"><span data-stu-id="2d426-130">VT\_UINT</span></span>  |
| <span data-ttu-id="2d426-131">VT \_ R4</span><span class="sxs-lookup"><span data-stu-id="2d426-131">VT\_R4</span></span>      | <span data-ttu-id="2d426-132">VT \_ R8</span><span class="sxs-lookup"><span data-stu-id="2d426-132">VT\_R8</span></span>   | <span data-ttu-id="2d426-133">VT \_ CY</span><span class="sxs-lookup"><span data-stu-id="2d426-133">VT\_CY</span></span>      | <span data-ttu-id="2d426-134">\_Дата VT</span><span class="sxs-lookup"><span data-stu-id="2d426-134">VT\_DATE</span></span>  |
| <span data-ttu-id="2d426-135">VT \_ BSTR</span><span class="sxs-lookup"><span data-stu-id="2d426-135">VT\_BSTR</span></span>    | <span data-ttu-id="2d426-136">Логическое значение VT \_</span><span class="sxs-lookup"><span data-stu-id="2d426-136">VT\_BOOL</span></span> | <span data-ttu-id="2d426-137">VT \_ Decimal</span><span class="sxs-lookup"><span data-stu-id="2d426-137">VT\_DECIMAL</span></span> | <span data-ttu-id="2d426-138">\_Ошибка VT</span><span class="sxs-lookup"><span data-stu-id="2d426-138">VT\_ERROR</span></span> |
| <span data-ttu-id="2d426-139">\_вариант VT</span><span class="sxs-lookup"><span data-stu-id="2d426-139">VT\_VARIANT</span></span> |          |             |           |



 

<span data-ttu-id="2d426-140">Если \_ указан тип данных VT Variant, он указывает, что массив SafeArray содержит структуры [**пропвариант**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) .</span><span class="sxs-lookup"><span data-stu-id="2d426-140">When the VT\_VARIANT data type is specified, it indicates that the SafeArray itself holds [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) structures.</span></span> <span data-ttu-id="2d426-141">Типы этих элементов должны быть из предыдущего списка, за исключением того, что они не могут содержать вложенные \_ типы Variant VT.</span><span class="sxs-lookup"><span data-stu-id="2d426-141">The types for these elements must be from the preceding list, except they cannot contain nested VT\_VARIANT types.</span></span>

<span data-ttu-id="2d426-142">Обратите внимание, что реализации [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) должны иметь возможность корректного восстановления, возвращая ошибку при обнаружении нового типа. Например, типы VARENUM.</span><span class="sxs-lookup"><span data-stu-id="2d426-142">Note that implementations of [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) must be able to recover gracefully by returning an error when a new type is encountered; for example, VARENUM types.</span></span>

-   <span data-ttu-id="2d426-143">Имена свойств с учетом регистра.</span><span class="sxs-lookup"><span data-stu-id="2d426-143">Case sensitive property names.</span></span> <span data-ttu-id="2d426-144">Имена свойств, например указанные в методе [**ипропертистораже:: вритепропертинамес**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writepropertynames) , не учитывают регистр в наборах свойств версии 0.</span><span class="sxs-lookup"><span data-stu-id="2d426-144">Property names, for example those specified in the [**IPropertyStorage::WritePropertyNames**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writepropertynames) method, are not case sensitive in version 0 property sets.</span></span> <span data-ttu-id="2d426-145">В наборах свойств версии 1 имена свойств могут быть чувствительны к регистру в зависимости от значения нового свойства поведения.</span><span class="sxs-lookup"><span data-stu-id="2d426-145">In version 1 property sets, property names can be case-sensitive depending on the value of the new Behavior property.</span></span>

    <span data-ttu-id="2d426-146">Свойство Behavior имеет значение [ID свойства 0x80000003](/windows/desktop/Stg/reserved-property-identifiers) с типом VT \_ UI4.</span><span class="sxs-lookup"><span data-stu-id="2d426-146">The Behavior property is [Property ID 0x80000003](/windows/desktop/Stg/reserved-property-identifiers) with a type of VT\_UI4.</span></span> <span data-ttu-id="2d426-147">Если задан наименьший бит этого значения, в именах наборов свойств учитывается регистр.</span><span class="sxs-lookup"><span data-stu-id="2d426-147">If the lowest bit of this value is set, the property set names are case sensitive.</span></span> <span data-ttu-id="2d426-148">Установите \_ \_ флаг с учетом регистра пропсетфлаг в параметре *грффлагс* метода [**IPropertySetStorage:: Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) , чтобы указать набор свойств с учетом регистра.</span><span class="sxs-lookup"><span data-stu-id="2d426-148">Set the PROPSETFLAG\_CASE\_SENSITIVE flag in the *grfFlags* parameter of the [**IPropertySetStorage::Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) method to specify a case-sensitive property set.</span></span>

-   <span data-ttu-id="2d426-149">Длинные имена свойств.</span><span class="sxs-lookup"><span data-stu-id="2d426-149">Long property names.</span></span> <span data-ttu-id="2d426-150">Имена свойств для наборов свойств версии 0 должны быть меньше или равными 256 символам, включая признак конца строки, для наборов свойств в кодовой странице Юникода.</span><span class="sxs-lookup"><span data-stu-id="2d426-150">Property names for version 0 property sets must be less than or equal to 256 characters, including the string terminator, for property sets in the Unicode code page.</span></span> <span data-ttu-id="2d426-151">Если не находится на кодовой странице Юникода, они должны быть менее 256 байт.</span><span class="sxs-lookup"><span data-stu-id="2d426-151">If not in the Unicode code page, they must be less than 256 bytes.</span></span> <span data-ttu-id="2d426-152">С другой стороны, наборы свойств версии 1 могут иметь имена свойств неограниченной длины, хотя они по-прежнему ограничены общим ограничением размера набора свойств 256 килобайт (КБ).</span><span class="sxs-lookup"><span data-stu-id="2d426-152">Version 1 property sets, on the other hand, can have property names of unlimited length, although they are still limited by the overall property set size limit of 256 kilobytes (KB).</span></span>

<span data-ttu-id="2d426-153">Рекомендуется, чтобы реализации [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) по умолчанию создали и поддерживали наборы свойств версии 0.</span><span class="sxs-lookup"><span data-stu-id="2d426-153">It is recommended that implementations of [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) create and maintain version 0 property sets by default.</span></span> <span data-ttu-id="2d426-154">Если вызывающий объект в дальнейшем запрашивает функцию, относящуюся к формату версии 1, то только после этого должна быть обновлена версия набора свойств.</span><span class="sxs-lookup"><span data-stu-id="2d426-154">If a caller subsequently requests a feature specific to the version 1 format, only then should the version of the property set be updated.</span></span> <span data-ttu-id="2d426-155">Например, если \_ записывается свойство типа массива VT или записывается длинное имя свойства, то реализация должна обновить формат набора свойств до версии 1.</span><span class="sxs-lookup"><span data-stu-id="2d426-155">For example, if a property of type VT\_ARRAY is written or if a long property name is written, then the implementation should update the property set format to version 1.</span></span> <span data-ttu-id="2d426-156">Одно исключение из этой рекомендации возникает, если \_ значение перечисления, чувствительное к регистру пропсетфлаг, \_ указано в вызове [**IPropertySetStorage:: Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create).</span><span class="sxs-lookup"><span data-stu-id="2d426-156">One exception to this guideline occurs if the PROPSETFLAG\_CASE\_SENSITIVE enumeration value is specified in the call to [**IPropertySetStorage::Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create).</span></span> <span data-ttu-id="2d426-157">В этом случае набор свойств должен быть создан как набор свойств версии 1.</span><span class="sxs-lookup"><span data-stu-id="2d426-157">In this case, the property set must be created as a version 1 property set.</span></span>

 

 