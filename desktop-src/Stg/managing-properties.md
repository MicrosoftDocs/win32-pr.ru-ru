---
title: Управление свойствами
description: Каждое свойство состоит из идентификатора свойства (уникального в пределах набора свойств), тега типа Variant (VT или VarType), представляющего тип значения, и самого значения.
ms.assetid: d220ecb4-b014-4ac9-a636-9a493187cc87
keywords:
- Структурированное хранилище Стрктд STG, использование, Управление свойствами
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 10dd78a1f8a8484090728dba6fe149840e940461
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103890772"
---
# <a name="managing-properties"></a><span data-ttu-id="4b669-104">Управление свойствами</span><span class="sxs-lookup"><span data-stu-id="4b669-104">Managing Properties</span></span>

<span data-ttu-id="4b669-105">Каждое свойство состоит из *идентификатора свойства* (уникального в пределах набора свойств), *тега типа Variant (VT или VarType)* , представляющего тип значения, и самого *значения* .</span><span class="sxs-lookup"><span data-stu-id="4b669-105">Every property consists of a *property identifier* (unique within its property set), a *variant type (VT or VarType) tag* that represents the type of a value, and the *value* itself.</span></span> <span data-ttu-id="4b669-106">Тег типа Variant описывает представление данных в значении.</span><span class="sxs-lookup"><span data-stu-id="4b669-106">The variant type tag describes the representation of the data in the value.</span></span> <span data-ttu-id="4b669-107">Кроме того, свойству также может быть присвоено *строковое имя* , которое можно использовать для идентификации свойства, вместо использования обязательного числового свойства (ID).</span><span class="sxs-lookup"><span data-stu-id="4b669-107">In addition, a property may also be assigned a *string name* that can be used to identify the property, rather than using the required numerical property identifier (ID).</span></span> <span data-ttu-id="4b669-108">Для создания свойств и управления ими COM определяет интерфейс [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) .</span><span class="sxs-lookup"><span data-stu-id="4b669-108">To create and manage properties, COM defines the [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) interface.</span></span>

<span data-ttu-id="4b669-109">Интерфейс [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) включает методы для чтения и записи массивов свойств или имен свойств.</span><span class="sxs-lookup"><span data-stu-id="4b669-109">The [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) interface includes methods to read and write arrays of either properties or property names.</span></span> <span data-ttu-id="4b669-110">Интерфейс включает методы [**commit**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-commit) и [**revert**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-revert) , аналогичные методам [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) с тем же именем.</span><span class="sxs-lookup"><span data-stu-id="4b669-110">The interface includes [**Commit**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-commit) and [**Revert**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-revert) methods that are similar to [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) methods of the same name.</span></span> <span data-ttu-id="4b669-111">Существуют служебные методы, позволяющие задать идентификатор класса (CLSID) набора свойств, задать время, связанное с набором, и получить статистику по набору свойств.</span><span class="sxs-lookup"><span data-stu-id="4b669-111">There are utility methods that allow you to set the class identifier (CLSID) of the property set, set the times associated with the set, and get statistics about the property set.</span></span> <span data-ttu-id="4b669-112">Наконец, метод [**enum**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-enum) создает перечислитель и возвращает указатель на его интерфейс [**иенумстатпропстг**](/windows/win32/api/propidlbase/nn-propidlbase-ienumstatpropstg) .</span><span class="sxs-lookup"><span data-stu-id="4b669-112">Finally, the [**Enum**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-enum) method creates an enumerator and returns a pointer to its [**IEnumSTATPROPSTG**](/windows/win32/api/propidlbase/nn-propidlbase-ienumstatpropstg) interface.</span></span> <span data-ttu-id="4b669-113">Можно вызывать методы этого интерфейса для перечисления структур [**статпропстг**](/windows/win32/api/propidlbase/nn-propidlbase-ienumstatpropstg) в объекте, которые будут предоставлять сведения обо всех свойствах в текущем наборе свойств.</span><span class="sxs-lookup"><span data-stu-id="4b669-113">You can call the methods of this interface to enumerate [**STATPROPSTG**](/windows/win32/api/propidlbase/nn-propidlbase-ienumstatpropstg) structures on your object, which will provide information about all of the properties in the current property set.</span></span>

<span data-ttu-id="4b669-114">Ниже приведен пример представления свойств.</span><span class="sxs-lookup"><span data-stu-id="4b669-114">The following is an example of how properties are represented.</span></span> <span data-ttu-id="4b669-115">Если конкретное свойство в наборе свойств содержит экспоненциальное имя животного, это имя можно сохранить как строку, завершающуюся нулем.</span><span class="sxs-lookup"><span data-stu-id="4b669-115">If a specific property in a property set holds an animal's scientific name, that name could be stored as a zero-terminated string.</span></span> <span data-ttu-id="4b669-116">Хранимая вместе с именем — это признак типа, указывающий, что значение является строкой, завершающейся нулем.</span><span class="sxs-lookup"><span data-stu-id="4b669-116">Stored along with the name would be a type indicator to indicate that the value is a zero-terminated string.</span></span> <span data-ttu-id="4b669-117">Эти свойства могут иметь следующие характеристики.</span><span class="sxs-lookup"><span data-stu-id="4b669-117">These properties might have the following characteristics:</span></span>



| <span data-ttu-id="4b669-118">Идентификатор свойства</span><span class="sxs-lookup"><span data-stu-id="4b669-118">Property ID</span></span> | <span data-ttu-id="4b669-119">Идентификатор строки</span><span class="sxs-lookup"><span data-stu-id="4b669-119">String identifier</span></span> | <span data-ttu-id="4b669-120">Индикатор типа</span><span class="sxs-lookup"><span data-stu-id="4b669-120">Type indicator</span></span> | <span data-ttu-id="4b669-121">Представленное значение</span><span class="sxs-lookup"><span data-stu-id="4b669-121">Value represented</span></span>              |
|-------------|-------------------|----------------|--------------------------------|
| <span data-ttu-id="4b669-122">02</span><span class="sxs-lookup"><span data-stu-id="4b669-122">02</span></span>          | <span data-ttu-id="4b669-123">Идентификатор процесса \_ анималнаме</span><span class="sxs-lookup"><span data-stu-id="4b669-123">PID\_ANIMALNAME</span></span>   | <span data-ttu-id="4b669-124">VT \_ LPWSTR</span><span class="sxs-lookup"><span data-stu-id="4b669-124">VT\_LPWSTR</span></span>     | <span data-ttu-id="4b669-125">Строка Юникода, заканчивающаяся нулем</span><span class="sxs-lookup"><span data-stu-id="4b669-125">Zero-terminated Unicode string</span></span> |
| <span data-ttu-id="4b669-126">03</span><span class="sxs-lookup"><span data-stu-id="4b669-126">03</span></span>          | <span data-ttu-id="4b669-127">Идентификатор процесса \_ легкаунт</span><span class="sxs-lookup"><span data-stu-id="4b669-127">PID\_LEGCOUNT</span></span>     | <span data-ttu-id="4b669-128">VT \_ I2</span><span class="sxs-lookup"><span data-stu-id="4b669-128">VT\_I2</span></span>         | <span data-ttu-id="4b669-129">WORD</span><span class="sxs-lookup"><span data-stu-id="4b669-129">WORD</span></span>                           |



 

<span data-ttu-id="4b669-130">Любое приложение, которое распознает формат набора свойств, определяя его с помощью идентификатора формата (FMTID), может просматривать свойство с идентификатором PID \_ анималнаме, определять, что это строка с нулевым нулем, а также считывать и записывать значение.</span><span class="sxs-lookup"><span data-stu-id="4b669-130">Any application that recognizes the property set format—identifying it through its format identifier (FMTID)—can look at the property with an identifier of PID\_ANIMALNAME, determine that it is a zero-terminated string, and read and write the value.</span></span> <span data-ttu-id="4b669-131">Несмотря на то, что приложение может вызывать [**ипропертистораже:: реадмултипле**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) для чтения любого или всех наборов свойств (сначала получил указатель), приложение должно знать, как интерпретировать набор свойств.</span><span class="sxs-lookup"><span data-stu-id="4b669-131">Although the application can call [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) to read any or all of a property set (having first obtained a pointer), the application must know how to interpret the property set.</span></span>

<span data-ttu-id="4b669-132">Значение свойства передается через интерфейсы свойств в качестве экземпляра типа [**пропвариант**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant).</span><span class="sxs-lookup"><span data-stu-id="4b669-132">A property value is passed through property interfaces as an instance of the type [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant).</span></span>

<span data-ttu-id="4b669-133">Важно различать эти хранимые (постоянные) свойства и свойства времени выполнения.</span><span class="sxs-lookup"><span data-stu-id="4b669-133">It is important to distinguish between these stored (persistent) properties, and run-time properties.</span></span> <span data-ttu-id="4b669-134">Константы значений типа Variant имеют имена, начинающиеся с VT \_ .</span><span class="sxs-lookup"><span data-stu-id="4b669-134">Variant-type value constants have names beginning with VT\_.</span></span> <span data-ttu-id="4b669-135">Однако набор допустимых Пропвариантс не полностью эквивалентен набору вариантов, используемых в автоматизации и элементах управления ActiveX.</span><span class="sxs-lookup"><span data-stu-id="4b669-135">The set of valid PROPVARIANTs is, however, not entirely equivalent to the set of VARIANTs used in Automation and ActiveX controls.</span></span>

<span data-ttu-id="4b669-136">Единственное различие между двумя структурами — это допустимый набор \_ тегов VT (типа Variant или VarType) в каждом из них.</span><span class="sxs-lookup"><span data-stu-id="4b669-136">The only difference between the two structures is the allowable set of VT\_ (Variant Type / VarType) tags in each.</span></span> <span data-ttu-id="4b669-137">Если определенный тип свойства может использоваться как в VARIANT, так и в ПРОПВАРИАНТ, тег типа ( \_ значение VT) всегда имеет идентичное значение.</span><span class="sxs-lookup"><span data-stu-id="4b669-137">Where a certain property type can be used in both a VARIANT and a PROPVARIANT, the type tag (the VT\_ value) always has an identical value.</span></span> <span data-ttu-id="4b669-138">Кроме того, для заданного \_ значения VT представление в памяти, используемое в вариантах и пропвариантс, идентично.</span><span class="sxs-lookup"><span data-stu-id="4b669-138">Further, for a given VT\_ value, the in-memory representation used in VARIANTs and PROPVARIANTs is identical.</span></span> <span data-ttu-id="4b669-139">В совокупности этот подход позволяет системе типов перехватывать запрещенные Теги типов, в то же время позволяя клиентам, которые получают знания, при необходимости реализовать приведение указателя.</span><span class="sxs-lookup"><span data-stu-id="4b669-139">Taken all together, this approach allows the type system to catch disallowed type tags, while at the same time allowing a knowledgeable client to implement a pointer cast when appropriate.</span></span>

<span data-ttu-id="4b669-140">Дополнительные сведения см. в следующем разделе, посвященном [вопросам хранения свойств](property-storage-considerations.md).</span><span class="sxs-lookup"><span data-stu-id="4b669-140">For more information, see the following section, [Property Storage Considerations](property-storage-considerations.md).</span></span>

 

 