---
title: Как служба регистрирует свои имена участников-служб
description: Прежде чем клиент сможет использовать имя субъекта-службы для проверки подлинности экземпляра службы, имя субъекта-службы должно быть зарегистрировано в учетной записи пользователя или компьютера, которую экземпляр службы будет использовать для входа в систему.
ms.assetid: 39712c1f-3a9a-4c98-a1cb-879ab0b4cb63
ms.tgt_platform: multiple
keywords:
- Как служба регистрирует свои имена участников-служб AD
- имя субъекта-службы AD, как служба регистрирует свои имена участников-служб
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 74410be3a024fc6accd1d8394e2ba8335be9f550
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "103887663"
---
# <a name="how-a-service-registers-its-spns"></a><span data-ttu-id="cc9d3-105">Как служба регистрирует свои имена участников-служб</span><span class="sxs-lookup"><span data-stu-id="cc9d3-105">How a Service Registers its SPNs</span></span>

<span data-ttu-id="cc9d3-106">Прежде чем клиент сможет использовать имя субъекта-службы для проверки подлинности экземпляра службы, имя субъекта-службы должно быть зарегистрировано в учетной записи пользователя или компьютера, которую экземпляр службы будет использовать для входа в систему.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-106">Before a client can use an SPN to authenticate an instance of a service, the SPN must be registered on the user or computer account that the service instance will use to log on.</span></span> <span data-ttu-id="cc9d3-107">Как правило, регистрация имени участника-службы выполняется программой установки службы, которая выполняется с правами администратора домена.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-107">Typically, SPN registration is done by a service installation program running with domain administrator privileges.</span></span>

<span data-ttu-id="cc9d3-108">Установщик службы, который устанавливает экземпляр службы на главном компьютере, обычно выполняет следующую процедуру.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-108">The service installer that installs a service instance on a host computer typically performs the following procedure.</span></span>

<span data-ttu-id="cc9d3-109">**Регистрация имен участников-служб для экземпляра службы**</span><span class="sxs-lookup"><span data-stu-id="cc9d3-109">**To register SPNs for a service instance**</span></span>

1.  <span data-ttu-id="cc9d3-110">Вызовите функцию [**дсжетспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) , чтобы создать один или несколько уникальных имен участников-служб для экземпляра службы.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-110">Call the [**DsGetSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) function to create one or more unique SPNs for the service instance.</span></span> <span data-ttu-id="cc9d3-111">Дополнительные сведения см. в разделе [форматы имен для уникальных имен участников-служб](name-formats-for-unique-spns.md).</span><span class="sxs-lookup"><span data-stu-id="cc9d3-111">For more information, see [Name Formats for Unique SPNs](name-formats-for-unique-spns.md).</span></span>
2.  <span data-ttu-id="cc9d3-112">Вызовите функцию [**дсвритеаккаунтспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) для регистрации имен в учетной записи входа службы.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-112">Call the [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) function to register the names on the service's logon account.</span></span>

<span data-ttu-id="cc9d3-113">[**Дсвритеаккаунтспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) регистрирует имена участников-служб в качестве свойства объекта учетной записи пользователя или компьютера в каталоге.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-113">[**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) registers SPNs as a property of a user or computer account object in the directory.</span></span> <span data-ttu-id="cc9d3-114">объекты **пользователей** и **компьютеров** имеют атрибут «переадресить», который является многозначным **атрибутом** для хранения всех имен участников-служб, связанных с учетной записью пользователя или компьютера.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-114">**user** and **computer** objects have a **servicePrincipalName** attribute, which is a multi-valued attribute for storing all the SPNs associated with a user or computer account.</span></span> <span data-ttu-id="cc9d3-115">Если служба выполняется под учетной записью пользователя, имена участников-служб хранятся **в атрибуте** «перечислить» этой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-115">If the service runs under a user account, the SPNs are stored in the **servicePrincipalName** attribute of that account.</span></span> <span data-ttu-id="cc9d3-116">Если служба выполняется в учетной записи LocalSystem, то имена участников-служб хранятся **в атрибуте** «перечислить» учетной записи главного компьютера службы.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-116">If the service runs in the LocalSystem account, the SPNs are stored in the **servicePrincipalName** attribute of the account of the service's host computer.</span></span> <span data-ttu-id="cc9d3-117">Вызывающий объект **дсвритеаккаунтспн** должен указывать различающееся имя объекта учетной записи, в котором хранятся имена участников-служб.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-117">The **DsWriteAccountSpn** caller must specify the distinguished name of the account object under which the SPNs are stored.</span></span>

<span data-ttu-id="cc9d3-118">Чтобы убедиться, что зарегистрированные имена участников-служб безопасны **, атрибут** переводится в непосредственный журнал. Он может быть написан только путем вызова [**дсвритеаккаунтспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span><span class="sxs-lookup"><span data-stu-id="cc9d3-118">To ensure that registered SPNs are secure, the **servicePrincipalName** attribute cannot be written directly; it can only be written by calling [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span></span> <span data-ttu-id="cc9d3-119">Вызывающий объект должен иметь доступ на запись к **атрибуту** "перечислить" целевой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-119">The caller must have write-access to the **servicePrincipalName** attribute of the target account.</span></span> <span data-ttu-id="cc9d3-120">Как правило, доступ на запись предоставляется по умолчанию только администраторам домена.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-120">Typically, write access is granted by default only to domain administrators.</span></span> <span data-ttu-id="cc9d3-121">Однако существует особый случай, когда система позволяет службе, работающей под учетной записью LocalSystem, зарегистрировать собственные имена участников-служб в учетной записи компьютера узла службы.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-121">However, there is a special case in which the system allows a service running under the LocalSystem account to register its own SPNs on the computer account of the service's host.</span></span> <span data-ttu-id="cc9d3-122">В этом случае записываемое имя участника-службы должно иметь форму " <service class> / <host> ", а " &lt; узел &gt; " — имя DNS локального компьютера.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-122">In this case, the SPN being written must have the form "<service class>/<host>" and "&lt;host&gt;" must be the DNS name of the local computer.</span></span>

<span data-ttu-id="cc9d3-123">[**Дсвритеаккаунтспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) также может удалять имена участников-служб из учетной записи.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-123">[**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) can also remove SPNs from an account.</span></span> <span data-ttu-id="cc9d3-124">Параметр операции указывает, следует ли добавлять имена участников-служб в учетную запись, удалять их из учетной записи или использовать для полной замены всех текущих имен участников-служб для учетной записи.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-124">An operation parameter indicates whether the SPNs are to be added to the account, removed from the account, or used to completely replace all current SPNs for the account.</span></span> <span data-ttu-id="cc9d3-125">При удалении экземпляра службы удалите все имена участников-служб, зарегистрированные для этого экземпляра.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-125">When a service instance is uninstalled, remove any SPNs registered for that instance.</span></span>

<span data-ttu-id="cc9d3-126">Дополнительные сведения и пример кода, который регистрирует или отменяет регистрацию имен участников службы, см. в разделе [Регистрация имен участников-служб для службы](registering-the-spns-for-a-service.md).</span><span class="sxs-lookup"><span data-stu-id="cc9d3-126">For more information and a code example that registers or unregisters a service's SPNs, see [Registering the SPNs for a Service](registering-the-spns-for-a-service.md).</span></span>

<span data-ttu-id="cc9d3-127">Службы на основе узла, использующие простой формат имени участника-службы <service class> / <host> (SPN), имеют возможность использовать функцию [**дссерверрегистерспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsserverregisterspna) , которая создает и регистрирует имена участников-служб для экземпляра службы.</span><span class="sxs-lookup"><span data-stu-id="cc9d3-127">Host-based services that use the simple SPN format "<service class>/<host>", have the option of using the [**DsServerRegisterSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsserverregisterspna) function, which both creates and registers SPNs for a service instance.</span></span> <span data-ttu-id="cc9d3-128">**Дссерверрегистерспн** — это вспомогательная функция, которая вызывает [**дсжетспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) и [**дсвритеаккаунтспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span><span class="sxs-lookup"><span data-stu-id="cc9d3-128">**DsServerRegisterSpn** is a helper function that calls [**DsGetSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) and [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span></span>

<span data-ttu-id="cc9d3-129">Дополнительные сведения см. в статье [учетные записи входа в службу](service-logon-accounts.md).</span><span class="sxs-lookup"><span data-stu-id="cc9d3-129">For more information, see [Service Logon Accounts](service-logon-accounts.md).</span></span>

 

 




