---
title: Реализация COM-объекта расширения создания объекта
description: Модуль создания объектов — это COM-объект, реализованный как внутрипроцессный сервер. В расширениях создания основного и дополнительного объектов должен быть реализован интерфейс Идсадминневобжекст.
ms.assetid: 0a8ed0ed-9dcb-4373-b549-7da3f3d9f641
ms.tgt_platform: multiple
keywords:
- Реализация объекта COM для расширения создания объекта
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 05c1a9da94caa300c1277cf6f6030357ca9d573d
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "104069763"
---
# <a name="implementing-the-object-creation-extension-com-object"></a><span data-ttu-id="3234c-105">Реализация COM-объекта расширения создания объекта</span><span class="sxs-lookup"><span data-stu-id="3234c-105">Implementing the Object Creation Extension COM Object</span></span>

<span data-ttu-id="3234c-106">Модуль создания объектов — это COM-объект, реализованный как внутрипроцессный сервер.</span><span class="sxs-lookup"><span data-stu-id="3234c-106">An object creation extension is a COM object implemented as an in-proc server.</span></span> <span data-ttu-id="3234c-107">В расширениях создания основного и дополнительного объектов должен быть реализован интерфейс [**идсадминневобжекст**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjext) .</span><span class="sxs-lookup"><span data-stu-id="3234c-107">Both primary and secondary object creation extensions must implement the [**IDsAdminNewObjExt**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjext) interface.</span></span>

## <a name="implementing-idsadminnewobjext"></a><span data-ttu-id="3234c-108">Реализация Идсадминневобжекст</span><span class="sxs-lookup"><span data-stu-id="3234c-108">Implementing IDsAdminNewObjExt</span></span>

<span data-ttu-id="3234c-109">После создания мастера создания объектов он инициализирует каждое расширение создания объекта, вызывая метод [**идсадминневобжекст:: Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize) расширения.</span><span class="sxs-lookup"><span data-stu-id="3234c-109">When the object creation wizard is created, it initializes each object creation extension by calling the extension's [**IDsAdminNewObjExt::Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize) method.</span></span> <span data-ttu-id="3234c-110">Метод **Initialize** предоставляет расширению сведения о контейнере, в котором создается объект, имя класса нового объекта и сведения о самом мастере.</span><span class="sxs-lookup"><span data-stu-id="3234c-110">The **Initialize** method supplies the extension with information about the container the object is being created in, the class name of the new object and information about the wizard itself.</span></span> <span data-ttu-id="3234c-111">Если запущен мастер создания объектов для создания нового объекта из существующего объекта, параметр *падскописаурце* не будет иметь **значение NULL**.</span><span class="sxs-lookup"><span data-stu-id="3234c-111">If the object creation wizard is started to create a new object from an existing object, the *pADsCopySource* parameter will not be **NULL**.</span></span> <span data-ttu-id="3234c-112">В этом случае расширение должно попытаться получить как можно больше данных из копируемого объекта.</span><span class="sxs-lookup"><span data-stu-id="3234c-112">In this case, the extension should attempt to obtain as much data from the object being copied as is feasible.</span></span>

<span data-ttu-id="3234c-113">После инициализации расширения вызывается метод [**идсадминневобжекст:: аддпажес**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-addpages) .</span><span class="sxs-lookup"><span data-stu-id="3234c-113">After the extension is initialized, the [**IDsAdminNewObjExt::AddPages**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-addpages) method is called.</span></span> <span data-ttu-id="3234c-114">Во время этого метода расширение должно добавить страницу или страницы в мастер.</span><span class="sxs-lookup"><span data-stu-id="3234c-114">The extension must add the page or pages to the wizard during this method.</span></span> <span data-ttu-id="3234c-115">Страница мастера создается путем заполнения структуры [**пропшитпаже**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) , а затем передачи этой структуры в функцию [**креатепропертишитпаже**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) .</span><span class="sxs-lookup"><span data-stu-id="3234c-115">A wizard page is created by filling in a [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure and then passing this structure to the [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) function.</span></span> <span data-ttu-id="3234c-116">Затем страница добавляется в мастер путем вызова функции обратного вызова, которая передается в **аддпажес** в параметре *лпфнаддпаже* .</span><span class="sxs-lookup"><span data-stu-id="3234c-116">The page is then added to the wizard by calling the callback function that is passed to **AddPages** in the *lpfnAddPage* parameter.</span></span>

<span data-ttu-id="3234c-117">Перед отображением страницы расширения вызывается [**идсадминневобжекст:: setObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) .</span><span class="sxs-lookup"><span data-stu-id="3234c-117">Before the extension page is displayed, [**IDsAdminNewObjExt::SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) is called.</span></span> <span data-ttu-id="3234c-118">Это обеспечивает расширение с помощью указателя интерфейса [**iAds**](/windows/desktop/api/iads/nn-iads-iads) для создаваемого объекта.</span><span class="sxs-lookup"><span data-stu-id="3234c-118">This supplies the extension with an [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface pointer for the object being created.</span></span>

<span data-ttu-id="3234c-119">Во время отображения страницы мастера страница должна обрабатывать все необходимые сообщения уведомлений мастера, такие как [**PSN \_ Сетактиве**](../controls/psn-setactive.md) и [**PSN \_ визнекст**](../controls/psn-wiznext.md), и отвечать на них.</span><span class="sxs-lookup"><span data-stu-id="3234c-119">While the wizard page is displayed, the page should handle and respond to any necessary wizard notification messages, such as [**PSN\_SETACTIVE**](../controls/psn-setactive.md) and [**PSN\_WIZNEXT**](../controls/psn-wiznext.md).</span></span>

<span data-ttu-id="3234c-120">Когда пользователь завершит работу со всеми страницами мастера, в мастере отобразится страница "Готово", в которой содержится сводка по указанным данным.</span><span class="sxs-lookup"><span data-stu-id="3234c-120">When the user completes all of the wizard pages, the wizard will display a "Finish" page that provides a summary of the data entered.</span></span> <span data-ttu-id="3234c-121">Мастер получает эти данные, вызывая метод [**идсадминневобжекст:: жетсуммаринфо**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-getsummaryinfo) для каждого из расширений.</span><span class="sxs-lookup"><span data-stu-id="3234c-121">The wizard obtains this data by calling the [**IDsAdminNewObjExt::GetSummaryInfo**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-getsummaryinfo) method for each of the extensions.</span></span> <span data-ttu-id="3234c-122">Метод **жетсуммаринфо** предоставляет **строку BSTR** , содержащую текстовые данные, отображаемые на странице "Готово".</span><span class="sxs-lookup"><span data-stu-id="3234c-122">The **GetSummaryInfo** method provides a **BSTR** that contains the text data displayed in the "Finish" page.</span></span> <span data-ttu-id="3234c-123">Модуль создания объектов не должен предоставлять сводные данные.</span><span class="sxs-lookup"><span data-stu-id="3234c-123">An object creation extension does not have to supply summary data.</span></span> <span data-ttu-id="3234c-124">В этом случае **жетсуммаринфо** должен вернуть **E \_ нотимпл**.</span><span class="sxs-lookup"><span data-stu-id="3234c-124">In this case, **GetSummaryInfo** should return **E\_NOTIMPL**.</span></span> <span data-ttu-id="3234c-125">**Жетсуммаринфо** вызывается один раз для каждого расширения, а не для каждой страницы, поэтому если модуль создания объектов добавляет более одной страницы, то расширение должно объединять сводные данные в одну строку.</span><span class="sxs-lookup"><span data-stu-id="3234c-125">**GetSummaryInfo** is only called one time for each extension, not per page, so if the object creation extension adds more than one page, the extension must combine the summary data into one string.</span></span>

<span data-ttu-id="3234c-126">Когда пользователь нажимает кнопку " **Готово** " на странице "Готово", Мастер вызывает каждый из методов расширения [**Идсадминневобжекст:: WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) , используя контекст **\_ \_ \_ предфиксации DSA NEWOBJ CTX** .</span><span class="sxs-lookup"><span data-stu-id="3234c-126">When the user clicks the **Finish** button in the "Finish" page, the wizard calls each of the extension's [**IDsAdminNewObjExt::WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) methods with the **DSA\_NEWOBJ\_CTX\_PRECOMMIT** context.</span></span> <span data-ttu-id="3234c-127">В этом случае расширение должно записать собранные данные в соответствующие свойства с помощью метода [**iAds::P UT**](/windows/desktop/api/iads/nf-iads-iads-put) или [**iAds::P утекс**](/windows/desktop/api/iads/nf-iads-iads-putex) .</span><span class="sxs-lookup"><span data-stu-id="3234c-127">When this occurs, the extension should write the gathered data into the appropriate properties using the [**IADs::Put**](/windows/desktop/api/iads/nf-iads-iads-put) or [**IADs::PutEx**](/windows/desktop/api/iads/nf-iads-iads-putex) method.</span></span> <span data-ttu-id="3234c-128">Интерфейс [**iAds**](/windows/desktop/api/iads/nn-iads-iads) предоставляется для расширения в методе [**Идсадминневобжекст:: setObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) .</span><span class="sxs-lookup"><span data-stu-id="3234c-128">The [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface is provided to the extension in the [**IDsAdminNewObjExt::SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) method.</span></span> <span data-ttu-id="3234c-129">Расширение не должно зафиксировать кэшированные свойства путем вызова метода [**iAds:: сетинфо**](/windows/desktop/api/iads/nf-iads-iads-setinfo).</span><span class="sxs-lookup"><span data-stu-id="3234c-129">The extension should not commit the cached properties by calling [**IADs::SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo).</span></span> <span data-ttu-id="3234c-130">Когда все свойства будут записаны, расширение создания первичного объекта фиксирует изменения, вызвав метод **iAds:: сетинфо**.</span><span class="sxs-lookup"><span data-stu-id="3234c-130">When all of the properties have been written, the primary object creation extension commits the changes by calling **IADs::SetInfo**.</span></span> <span data-ttu-id="3234c-131">Более подробно эти сведения рассматриваются ниже.</span><span class="sxs-lookup"><span data-stu-id="3234c-131">This is discussed in more detail below.</span></span>

<span data-ttu-id="3234c-132">При возникновении ошибки расширение будет уведомлено об ошибке и во время выполнения операции, возникшей при вызове метода [**идсадминневобжекст:: OnError**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-onerror) .</span><span class="sxs-lookup"><span data-stu-id="3234c-132">If an error occurs, the extension will be notified of the error and during which operation it occurred when the [**IDsAdminNewObjExt::OnError**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-onerror) method is called.</span></span>

## <a name="implementing-a-primary-object-creation-wizard"></a><span data-ttu-id="3234c-133">Реализация мастера создания основных объектов</span><span class="sxs-lookup"><span data-stu-id="3234c-133">Implementing a Primary Object Creation Wizard</span></span>

<span data-ttu-id="3234c-134">Реализация мастера создания основных объектов идентична мастеру создания дополнительного объекта, за исключением того, что мастер создания основного объекта должен выполнить еще несколько шагов.</span><span class="sxs-lookup"><span data-stu-id="3234c-134">The implementation of a primary object creation wizard is identical to a secondary object creation wizard, except that a primary object creation wizard must perform a few more steps.</span></span>

<span data-ttu-id="3234c-135">Перед закрытием первой страницы Мастер создания объектов должен создать временный объект каталога.</span><span class="sxs-lookup"><span data-stu-id="3234c-135">Prior to the first page being dismissed, the object creation wizard must create the temporary directory object.</span></span> <span data-ttu-id="3234c-136">Для этого вызовите метод [**идсадминневобжпримарисите:: CreateNew**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-createnew) .</span><span class="sxs-lookup"><span data-stu-id="3234c-136">To do this, call the [**IDsAdminNewObjPrimarySite::CreateNew**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-createnew) method.</span></span> <span data-ttu-id="3234c-137">Указатель на интерфейс [**идсадминневобжпримарисите**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjprimarysite) получается путем вызова [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) с **IID \_ идсадминневобжпримарисите** в интерфейсе [**идсадминневобж**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobj) , который передается в [**идсадминневобжекст:: Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize).</span><span class="sxs-lookup"><span data-stu-id="3234c-137">A pointer to the [**IDsAdminNewObjPrimarySite**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjprimarysite) interface is obtained by calling [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) with **IID\_IDsAdminNewObjPrimarySite** on the [**IDsAdminNewObj**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobj) interface that is passed to [**IDsAdminNewObjExt::Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize).</span></span> <span data-ttu-id="3234c-138">Метод **CreateNew** создает новый временный объект и вызывает [**Идсадминневобжекст:: setObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) для каждого расширения.</span><span class="sxs-lookup"><span data-stu-id="3234c-138">The **CreateNew** method creates a new temporary object and calls [**IDsAdminNewObjExt::SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) for each extension.</span></span>

<span data-ttu-id="3234c-139">Когда мастер создания объектов содержит более одной страницы, система реализует страницу "Готово", которая отображает сводку сведений об объекте, которые необходимо сохранить.</span><span class="sxs-lookup"><span data-stu-id="3234c-139">When an object creation wizard contains more than one page, the system implements a "Finish" page that displays a summary of the object information to be saved.</span></span> <span data-ttu-id="3234c-140">Когда вы наберете кнопку **Готово** на странице "Готово", система вызовет каждый из методов [**Идсадминневобжекст:: WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) расширения создания объекта и зафиксирует временный объект в постоянной памяти.</span><span class="sxs-lookup"><span data-stu-id="3234c-140">When the **Finish** button on the "Finish" page is clicked, the system will call each of the object creation extension's [**IDsAdminNewObjExt::WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) method and then commit the temporary object to persistent memory.</span></span> <span data-ttu-id="3234c-141">Однако если мастер создания объектов содержит только одну страницу, то страница будет содержать кнопки **ОК** и **Отмена** , а не кнопки **назад**, **Далее** и **Отмена** , как обычно в мастере, а страница "Готово" не предоставляется.</span><span class="sxs-lookup"><span data-stu-id="3234c-141">If, however, the object creation wizard only contains one page, the page will have **OK** and **Cancel** buttons instead of the **Back**, **Next** and **Cancel** buttons normally found in a wizard and no "Finish" page is provided.</span></span> <span data-ttu-id="3234c-142">Поэтому мастер расширения создания объектов с одной страницей должен вызвать [**идсадминневобжпримарисите:: Commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) для выполнения операций записи и сохранения.</span><span class="sxs-lookup"><span data-stu-id="3234c-142">Because of this, a single-page object creation extension wizard must call [**IDsAdminNewObjPrimarySite::Commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) to perform the write and save operations.</span></span> <span data-ttu-id="3234c-143">Расширение создания одностраничного первичного объекта должно вызывать **commit** в ответ на уведомление [**PSN \_ визфиниш**](../controls/psn-wizfinish.md) .</span><span class="sxs-lookup"><span data-stu-id="3234c-143">A single-page primary object creation extension should call **Commit** in response to the [**PSN\_WIZFINISH**](../controls/psn-wizfinish.md) notification.</span></span>

<span data-ttu-id="3234c-144">Поскольку другие модули создания объектов могут добавлять страницы в мастер, расширение создания основного объекта может не узнать, существует ли в мастере более одной страницы.</span><span class="sxs-lookup"><span data-stu-id="3234c-144">Because other object creation extensions can add pages to the wizard, the primary object creation extension may not know if there is more than one page in the wizard.</span></span> <span data-ttu-id="3234c-145">Это не является проблемой по двум причинам: во-первых, если система реализует страницу "Готово", модуль создания первичного объекта получит уведомление [**PSN \_ визнекст**](../controls/psn-wiznext.md) вместо уведомления **PSN \_ визнекст** .</span><span class="sxs-lookup"><span data-stu-id="3234c-145">This is not an issue for two reasons: First, if the system implements the "Finish" page, the primary object creation extension will receive the [**PSN\_WIZNEXT**](../controls/psn-wiznext.md) notification instead of the **PSN\_WIZNEXT** notification.</span></span> <span data-ttu-id="3234c-146">Во-вторых, [**commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) завершается сбоем, если мастер содержит более одной страницы.</span><span class="sxs-lookup"><span data-stu-id="3234c-146">Second, [**Commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) will fail harmlessly if the wizard contains more than one page.</span></span>

 

 