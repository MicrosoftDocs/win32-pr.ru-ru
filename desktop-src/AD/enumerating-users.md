---
title: Перечисление пользователей
description: В отличие от доменов Windows NT 4,0, пользователи Windows 2000 могут размещаться в любом контейнере или подразделении (OU) в домене, а также в корне домена.
ms.assetid: 4a35af7a-f43b-4cf9-a030-77f6c2518ae7
ms.tgt_platform: multiple
keywords:
- Перечисление пользователей AD
- Пользователи AD, перечисление пользователей
- Active Directory, использование, пользователи, перечисление пользователя
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e922d92f4313ed0238ff068f7ae1c0fbf693d497
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "105654303"
---
# <a name="enumerating-users"></a><span data-ttu-id="99fd9-106">Перечисление пользователей</span><span class="sxs-lookup"><span data-stu-id="99fd9-106">Enumerating Users</span></span>

<span data-ttu-id="99fd9-107">В отличие от доменов Windows NT 4,0, пользователи Windows 2000 могут размещаться в любом контейнере или подразделении (OU) в домене, а также в корне домена.</span><span class="sxs-lookup"><span data-stu-id="99fd9-107">Unlike Windows NT 4.0 domains, Windows 2000 users can be placed in any container or organizational unit (OU) in a domain as well as the root of the domain.</span></span> <span data-ttu-id="99fd9-108">Это означает, что пользователи могут находиться в нескольких местах иерархии каталогов.</span><span class="sxs-lookup"><span data-stu-id="99fd9-108">This means that users can be in numerous locations in the directory hierarchy.</span></span> <span data-ttu-id="99fd9-109">Таким образом, у вас есть два варианта перечисления пользователей:</span><span class="sxs-lookup"><span data-stu-id="99fd9-109">Therefore, you have two choices for enumerating users:</span></span>

-   <span data-ttu-id="99fd9-110">Перечисление пользователей, непосредственно содержащихся в контейнере, подразделении или в корне домена:</span><span class="sxs-lookup"><span data-stu-id="99fd9-110">Enumerate the users directly contained in a container, OU, or at the root of the domain:</span></span>

    <span data-ttu-id="99fd9-111">Явно привяжите к объекту-контейнеру, содержащему пользователей, которых нужно перечислить, задайте фильтр, содержащий "User", в качестве класса с помощью свойства [**иадсконтаинер. Filter**](/windows/desktop/ADSI/iadscontainer-property-methods) и используйте метод [**иадсконтаинер:: Get \_ \_ NewEnum**](/windows/desktop/api/iads/nf-iads-iadscontainer-get__newenum) , чтобы перечислить объекты пользователя.</span><span class="sxs-lookup"><span data-stu-id="99fd9-111">Explicitly bind to the container object that contains the users you are interested in enumerating, set a filter containing "user" as the class using the [**IADsContainer.Filter**](/windows/desktop/ADSI/iadscontainer-property-methods) property, and use the [**IADsContainer::get\_\_NewEnum**](/windows/desktop/api/iads/nf-iads-iadscontainer-get__newenum) method to enumerate the user objects.</span></span>

    <span data-ttu-id="99fd9-112">Этот метод можно использовать для перечисления пользователей, которые непосредственно содержатся в контейнере или объекте OU.</span><span class="sxs-lookup"><span data-stu-id="99fd9-112">This technique can be used to enumerate users that are directly contained in a container or OU object.</span></span> <span data-ttu-id="99fd9-113">Если контейнер содержит другие контейнеры, которые потенциально могут содержать других пользователей, необходимо выполнить привязку к этим контейнерам и рекурсивно перечислить пользователей в этих контейнерах.</span><span class="sxs-lookup"><span data-stu-id="99fd9-113">If the container contains other containers that can potentially contain other users, you must bind to those containers and recursively enumerate the users on those containers.</span></span> <span data-ttu-id="99fd9-114">Если не требуется манипулировать объектами пользователя и требуется только чтение конкретных свойств, используйте детальный поиск, описанный в варианте 2.</span><span class="sxs-lookup"><span data-stu-id="99fd9-114">If it is not required that you manipulate the user objects, and only need to read specific properties, use the deep search described in Option 2.</span></span>

    <span data-ttu-id="99fd9-115">Поскольку перечисление Возвращает указатели на COM-объекты ADSI, представляющие каждый объект пользователя, можно вызвать [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) , чтобы получить указатели интерфейса [**iAds**](/windows/desktop/api/iads/nn-iads-iads), [**IADsUser**](/windows/desktop/api/iads/nn-iads-iadsuser)и [**иадспропертилист**](/windows/desktop/api/iads/nn-iads-iadspropertylist) для объекта пользователя.</span><span class="sxs-lookup"><span data-stu-id="99fd9-115">Because enumeration returns pointers to ADSI COM objects representing each user object, you can call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) to get [**IADs**](/windows/desktop/api/iads/nn-iads-iads), [**IADsUser**](/windows/desktop/api/iads/nn-iads-iadsuser), and [**IADsPropertyList**](/windows/desktop/api/iads/nn-iads-iadspropertylist) interface pointers to the user object.</span></span> <span data-ttu-id="99fd9-116">Это означает, что вы можете получить указатели интерфейса для каждого перечислимого объекта-пользователя в контейнере, не прибегая к явной привязке к каждому объекту пользователя.</span><span class="sxs-lookup"><span data-stu-id="99fd9-116">This means you can get interface pointers to each enumerated user object in a container without having to explicitly bind to each user object.</span></span> <span data-ttu-id="99fd9-117">Для выполнения операций со всеми пользователями непосредственно в контейнере перечисление позволяет избежать привязки к каждому пользователю для вызова методов **iAds** или **IADsUser** .</span><span class="sxs-lookup"><span data-stu-id="99fd9-117">To perform operations on all the users directly within a container, enumeration avoids having to bind to each user in order to call **IADs** or **IADsUser** methods.</span></span> <span data-ttu-id="99fd9-118">Чтобы получить определенные свойства от пользователей, используйте [**IDirectorySearch**](/windows/desktop/api/iads/nn-iads-idirectorysearch) , как описано в варианте 2.</span><span class="sxs-lookup"><span data-stu-id="99fd9-118">To retrieve specific properties from users, use [**IDirectorySearch**](/windows/desktop/api/iads/nn-iads-idirectorysearch) as described in option 2.</span></span>

-   <span data-ttu-id="99fd9-119">Выполните глубокий поиск (& (objectClass = User) (objectCategory = Person)), чтобы найти всех пользователей в дереве.</span><span class="sxs-lookup"><span data-stu-id="99fd9-119">Perform a deep search for (&(objectClass=user)(objectCategory=person)) to find all users in a tree:</span></span>

    <span data-ttu-id="99fd9-120">Сначала выполните привязку к объекту контейнера, с которого начинается поиск.</span><span class="sxs-lookup"><span data-stu-id="99fd9-120">First, bind to the container object where to begin the search.</span></span> <span data-ttu-id="99fd9-121">Например, чтобы найти всех пользователей в домене, выполните привязку к корню домена. чтобы найти всех пользователей в лесу, выполните привязку к глобальному каталогу и выполните поиск из корня GC.</span><span class="sxs-lookup"><span data-stu-id="99fd9-121">For example, to find all users in a domain, bind to root of the domain; to find all users in the forest, bind to the global catalog and search from the root of the GC.</span></span>

    <span data-ttu-id="99fd9-122">Затем используйте [**IDirectorySearch**](/windows/desktop/api/iads/nn-iads-idirectorysearch) для запроса с помощью фильтра поиска, содержащего (& (objectClass = пользователь) (objectCategory = Person)), и предпочтения поиска \_ в \_ поддереве области объявлений.</span><span class="sxs-lookup"><span data-stu-id="99fd9-122">Then use [**IDirectorySearch**](/windows/desktop/api/iads/nn-iads-idirectorysearch) to query using a search filter containing (&(objectClass=user)(objectCategory=person)) and search preference of ADS\_SCOPE\_SUBTREE.</span></span>

    <span data-ttu-id="99fd9-123">Вы можете выполнить поиск с помощью предпочтения поиска \_ области объявлений \_ одноуровневой, чтобы ограничить поиск прямым содержимым объекта контейнера, к которому вы привязаны.</span><span class="sxs-lookup"><span data-stu-id="99fd9-123">You can perform a search with a search preference of ADS\_SCOPE\_ONELEVEL to limit the search to the direct contents of the container object that you bound to.</span></span>

    <span data-ttu-id="99fd9-124">[**IDirectorySearch**](/windows/desktop/api/iads/nn-iads-idirectorysearch) извлекает из пользователей только значения конкретных свойств.</span><span class="sxs-lookup"><span data-stu-id="99fd9-124">[**IDirectorySearch**](/windows/desktop/api/iads/nn-iads-idirectorysearch) retrieves only the values of specific properties from users.</span></span> <span data-ttu-id="99fd9-125">Чтобы получить значения, используйте **IDirectorySearch**.</span><span class="sxs-lookup"><span data-stu-id="99fd9-125">To retrieve values, use **IDirectorySearch**.</span></span> <span data-ttu-id="99fd9-126">Для управления объектами пользователя, возвращаемыми из поиска, то есть необходимо использовать методы [**iAds**](/windows/desktop/api/iads/nn-iads-iads) или [**IADsUser**](/windows/desktop/api/iads/nn-iads-iadsuser) , необходимо явно выполнить привязку к ним.</span><span class="sxs-lookup"><span data-stu-id="99fd9-126">To manipulate the user objects returned from a search, that is, you want to use [**IADs**](/windows/desktop/api/iads/nn-iads-iads) or [**IADsUser**](/windows/desktop/api/iads/nn-iads-iadsuser) methods, you must explicitly bind to them.</span></span> <span data-ttu-id="99fd9-127">Для этого укажите **distinguishedName** в качестве одного из свойств, возвращаемых при поиске, и используйте возвращенные различающиеся имена для привязки к каждому пользователю, возвращенному при поиске.</span><span class="sxs-lookup"><span data-stu-id="99fd9-127">To do this, specify **distinguishedName** as one of the properties to return from the search and use the returned distinguished names to bind to each user returned in the search.</span></span>

    <span data-ttu-id="99fd9-128">Извлекаются только определенные свойства.</span><span class="sxs-lookup"><span data-stu-id="99fd9-128">Only specific properties are retrieved.</span></span> <span data-ttu-id="99fd9-129">Невозможно получить все атрибуты без явного указания всех возможных атрибутов класса User.</span><span class="sxs-lookup"><span data-stu-id="99fd9-129">You cannot retrieve all attributes without explicitly specifying every possible attribute of the user class.</span></span>

 

 