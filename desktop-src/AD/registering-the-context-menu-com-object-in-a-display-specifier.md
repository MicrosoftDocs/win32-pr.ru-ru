---
title: Регистрация COM-объекта контекстного меню в спецификаторе экрана
description: В этом разделе показаны разделы реестра, которые необходимо изменить для регистрации COM-объекта контекстного меню.
ms.assetid: 389bc249-4849-4763-9d1b-b35598a51050
ms.tgt_platform: multiple
keywords:
- Регистрация COM-объекта контекстного меню в спецификаторе экрана
- контекстное меню COM-объект Active Directory, регистрация
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 62ae30c1a60a1a0bc5a8ec388a3578ab13829c95
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "104069751"
---
# <a name="registering-the-context-menu-com-object-in-a-display-specifier"></a><span data-ttu-id="dc2a6-105">Регистрация COM-объекта контекстного меню в спецификаторе экрана</span><span class="sxs-lookup"><span data-stu-id="dc2a6-105">Registering the Context Menu COM Object in a Display Specifier</span></span>

<span data-ttu-id="dc2a6-106">При использовании COM для создания библиотеки DLL расширения контекстного меню для службы Active Directory Directory, расширение должно быть зарегистрировано в реестре Windows и домен Active Directory служб, чтобы уведомить Active Directory административные оснастки MMC и оболочку Windows расширения.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-106">When you use COM to create a context menu extension DLL for an Active Directory directory service, the extension must be registered with the Windows registry and Active Directory Domain Services to notify the Active Directory administrative MMC snap-ins and the Windows shell of the extension.</span></span>

## <a name="registering-in-the-windows-registry"></a><span data-ttu-id="dc2a6-107">Регистрация в реестре Windows</span><span class="sxs-lookup"><span data-stu-id="dc2a6-107">Registering in the Windows Registry</span></span>

<span data-ttu-id="dc2a6-108">Как и все серверы COM, расширение контекстного меню должно быть зарегистрировано в реестре.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-108">Like all COM servers, a context menu extension must be registered in the registry.</span></span> <span data-ttu-id="dc2a6-109">Расширение регистрируется в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-109">The extension is registered under the following key.</span></span>

```
HKEY_CLASSES_ROOT
   CLSID
      <clsid>
```

<span data-ttu-id="dc2a6-110">*<clsid>* Строковое представление идентификатора CLSID, созданное функцией [**стрингфромклсид**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid) .</span><span class="sxs-lookup"><span data-stu-id="dc2a6-110">*<clsid>* is the string representation of the CLSID as produced by the [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid) function.</span></span> <span data-ttu-id="dc2a6-111">В *<clsid>* ключе имеется ключ **InprocServer32** , который идентифицирует объект как 32-разрядный сервер in-proc.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-111">Under the *<clsid>* key, there is an **InProcServer32** key that identifies the object as a 32-bit in-proc server.</span></span> <span data-ttu-id="dc2a6-112">В ключе **InprocServer32** расположение библиотеки DLL указывается в значении по умолчанию, а модель потоков указывается в значении **ThreadingModel** .</span><span class="sxs-lookup"><span data-stu-id="dc2a6-112">Under the **InProcServer32** key, the location of the DLL is specified in the default value and the threading model is specified in the **ThreadingModel** value.</span></span> <span data-ttu-id="dc2a6-113">Все расширения контекстного меню должны использовать потоковую модель "апартамента".</span><span class="sxs-lookup"><span data-stu-id="dc2a6-113">All context menu extension must use the "Apartment" threading model.</span></span>

## <a name="registering-with-active-directory-domain-services"></a><span data-ttu-id="dc2a6-114">Регистрация в домен Active Directory Services</span><span class="sxs-lookup"><span data-stu-id="dc2a6-114">Registering with Active Directory Domain Services</span></span>

<span data-ttu-id="dc2a6-115">Регистрация расширения контекстного меню зависит от одного языкового стандарта.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-115">Context menu extension registration is specific to one locale.</span></span> <span data-ttu-id="dc2a6-116">Если расширение контекстного меню применяется ко всем языкам, оно должно быть зарегистрировано в объекте [**дисплайспеЦифиер**](/windows/desktop/ADSchema/c-displayspecifier) класса объекта во всех вложенных компонентах языкового стандарта в контейнере описатели вывода.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-116">If the context menu extension applies to all locales, it must be registered in the object class [**displaySpecifier**](/windows/desktop/ADSchema/c-displayspecifier) object in all of the locale subcontainers in the Display Specifiers container.</span></span> <span data-ttu-id="dc2a6-117">Если расширение контекстного меню локализовано для определенного языкового стандарта, оно должно быть зарегистрировано в объекте **дисплайспеЦифиер** в подконтейнере этого языкового стандарта.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-117">If the context menu extension is localized for a certain locale, it must be registered in the **displaySpecifier** object in that locale's subcontainer.</span></span> <span data-ttu-id="dc2a6-118">Дополнительные сведения о контейнерах и языковых стандартах для описателей вывода см. в разделе [описатели](display-specifiers.md) и [контейнеры дисплайспеЦифиерс](displayspecifiers-container.md).</span><span class="sxs-lookup"><span data-stu-id="dc2a6-118">For more information about the Display Specifiers container and locales, see [Display Specifiers](display-specifiers.md) and [DisplaySpecifiers Container](displayspecifiers-container.md).</span></span>

<span data-ttu-id="dc2a6-119">Существует два атрибута спецификаторов вывода, которые могут быть зарегистрированы в элементе расширения контекстного меню.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-119">There are two display specifier attributes that a context menu extension item can be registered under.</span></span> <span data-ttu-id="dc2a6-120">Это [**админконтекстмену**](/windows/desktop/ADSchema/a-admincontextmenu) и [**шеллконтекстмену**](/windows/desktop/ADSchema/a-shellcontextmenu).</span><span class="sxs-lookup"><span data-stu-id="dc2a6-120">These are [**adminContextMenu**](/windows/desktop/ADSchema/a-admincontextmenu) and [**shellContextMenu**](/windows/desktop/ADSchema/a-shellcontextmenu).</span></span>

<span data-ttu-id="dc2a6-121">Атрибут [**админконтекстмену**](/windows/desktop/ADSchema/a-admincontextmenu) определяет административные контекстные меню, отображаемые в Active Directory административных оснастках. Контекстное меню появляется, когда пользователь отображает контекстное меню для объектов соответствующего класса в одной из оснасток Active Directory администрирования MMC.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-121">The [**adminContextMenu**](/windows/desktop/ADSchema/a-admincontextmenu) attribute identifies administrative context menus to display in Active Directory administrative snap-ins. The context menu appears when the user displays the context menu for objects of the appropriate class in one of the Active Directory administrative MMC snap-ins.</span></span>

<span data-ttu-id="dc2a6-122">Атрибут [**шеллконтекстмену**](/windows/desktop/ADSchema/a-shellcontextmenu) определяет контекстные меню конечных пользователей, отображаемых в оболочке Windows.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-122">The [**shellContextMenu**](/windows/desktop/ADSchema/a-shellcontextmenu) attribute identifies end-user context menus to display in the Windows shell.</span></span> <span data-ttu-id="dc2a6-123">Контекстное меню появляется, когда пользователь просматривает контекстное меню для объектов соответствующего класса в проводнике Windows.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-123">The context menu appears when the user views the context menu for objects of the appropriate class in the Windows Explorer.</span></span> <span data-ttu-id="dc2a6-124">Начиная с Windows Server 2003, оболочка Windows больше не отображает объекты служб домен Active Directory.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-124">Beginning with Windows Server 2003, the Windows shell no longer displays objects of Active Directory Domain Services.</span></span>

<span data-ttu-id="dc2a6-125">Все эти атрибуты являются многозначными.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-125">All of these attributes are multi-valued.</span></span>

<span data-ttu-id="dc2a6-126">При регистрации расширения контекстного меню значения для атрибутов [**админконтекстмену**](/windows/desktop/ADSchema/a-admincontextmenu) и [**шеллконтекстмену**](/windows/desktop/ADSchema/a-shellcontextmenu) должны иметь следующий формат.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-126">When registering a context menu extension, the values for the [**adminContextMenu**](/windows/desktop/ADSchema/a-admincontextmenu) and [**shellContextMenu**](/windows/desktop/ADSchema/a-shellcontextmenu) attributes require the following format.</span></span>


```C++
<order number>,<clsid>
```



<span data-ttu-id="dc2a6-127">&lt;Порядковый номер &gt; — это число без знака, представляющее позицию элемента в контекстном меню.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-127">The "&lt;order number&gt;" is an unsigned number that represents the item position in the context menu.</span></span> <span data-ttu-id="dc2a6-128">При отображении контекстного меню значения сортируются с помощью сравнения "номер заказа" каждого значения &lt; &gt; .</span><span class="sxs-lookup"><span data-stu-id="dc2a6-128">When a context menu is displayed, the values are sorted using a comparison of each value's "&lt;order number&gt;".</span></span> <span data-ttu-id="dc2a6-129">Если несколько значений имеют одинаковый &lt; порядковый номер, то &gt; расширения контекстного меню загружаются в том порядке, в котором они считываются с Active Directory сервера.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-129">If more than one value has the same "&lt;order number&gt;", those context menu extensions are loaded in the order they are read from the Active Directory server.</span></span> <span data-ttu-id="dc2a6-130">Если возможно, используйте несуществующий " &lt; номер заказа &gt; ", то есть тот, который не использовался другими значениями в свойстве.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-130">If possible, use a non-existing "&lt;order number&gt;", that is, one that has not been used by other values in the property.</span></span> <span data-ttu-id="dc2a6-131">В &lt; последовательности "номер заказа" не допускаются предписанные начальные положения и пробелы &gt; .</span><span class="sxs-lookup"><span data-stu-id="dc2a6-131">There is no prescribed starting position and gaps are allowed in the "&lt;order number&gt;" sequence.</span></span>

<span data-ttu-id="dc2a6-132">" &lt; CLSID &gt; " — это строковое представление идентификатора CLSID, созданное функцией [**стрингфромклсид**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid) .</span><span class="sxs-lookup"><span data-stu-id="dc2a6-132">The "&lt;clsid&gt;" is the string representation of the CLSID as produced by the [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid) function.</span></span>

<span data-ttu-id="dc2a6-133">В оболочке Windows поддерживаются элементы контекстного меню с множественным выбором.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-133">In the Windows shell, multiple-selection context menu items are supported.</span></span> <span data-ttu-id="dc2a6-134">В этом случае для каждого выбранного объекта вызывается расширение контекстного меню.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-134">In this case, the context menu extension is invoked for each selected object.</span></span> <span data-ttu-id="dc2a6-135">В Active Directory административные оснастки поддерживаются также элементы расширения контекстного меню с множественным выбором.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-135">In Active Directory administrative snap-ins, multiple-selection context menu extension items are also supported.</span></span> <span data-ttu-id="dc2a6-136">В этом случае структура [**дсобжектнамес**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) будет содержать структуру [**дсобжект**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) для каждого выбранного объекта каталога.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-136">In this case, the [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure will contain a [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) structure for each directory object selected.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="dc2a6-137">Для оболочки Windows сведения о спецификаторе экрана извлекаются при входе пользователя в систему и кэшируются для сеанса пользователя.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-137">For the Windows shell, display specifier information is retrieved at user logon and cached for the user's session.</span></span> <span data-ttu-id="dc2a6-138">Для административных оснасток данные описателя просмотра извлекаются при загрузке оснастки и кэшируются в течение этого процесса.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-138">For the administrative snap-ins, the display specifier data is retrieved when the snap-in is loaded and is cached for the duration of the process.</span></span> <span data-ttu-id="dc2a6-139">Для оболочки Windows это означает, что изменения описателей экрана вступают в силу после выхода пользователя из системы и обратного входа.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-139">For the Windows shell, this means changes to display specifiers take effect after a user logs off and back on again.</span></span> <span data-ttu-id="dc2a6-140">Для административных оснасток изменения вступают в силу при перезагрузке оснастки или файла консоли, то есть при запуске нового экземпляра файла консоли или нового экземпляра Mmc.exe и добавлении оснастки извлекаются последние данные описателя вывода.</span><span class="sxs-lookup"><span data-stu-id="dc2a6-140">For the administrative snap-ins, changes take effect when the snap-in or console file is reloaded, that is, if you start a new instance of the console file or new Mmc.exe instance and add the snap-in, the latest display specifier data is retrieved.</span></span>

 

<span data-ttu-id="dc2a6-141">Дополнительные сведения и пример кода реализации расширения контекстного меню см. в разделе [пример кода для реализации COM-объекта контекстного меню](example-code-for-implementation-of-the-context-menu-com-object.md).</span><span class="sxs-lookup"><span data-stu-id="dc2a6-141">For more information, and a code example of how to implement a context menu extension, see [Example Code for Implementation of the Context Menu COM Object](example-code-for-implementation-of-the-context-menu-com-object.md).</span></span>

 

 