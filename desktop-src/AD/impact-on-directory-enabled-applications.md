---
title: Влияние на Directory-Enabled приложения
description: В этом разделе описывается влияние на приложения с поддержкой каталогов, когда происходит отклонение версий, частичные обновления или конфликты.
ms.assetid: 0aec6fe3-7757-4472-bc18-add2327d4e1b
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 061818fc791e1c75d440d0c477a321b8c4e5edfb
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "103987327"
---
# <a name="impact-on-directory-enabled-applications"></a><span data-ttu-id="9b783-103">Влияние на Directory-Enabled приложения</span><span class="sxs-lookup"><span data-stu-id="9b783-103">Impact on Directory-Enabled Applications</span></span>

## <a name="version-skew"></a><span data-ttu-id="9b783-104">Отклонение версий</span><span class="sxs-lookup"><span data-stu-id="9b783-104">Version Skew</span></span>

<span data-ttu-id="9b783-105">Отклонение версий происходит, когда приложения считывают одни и те же объекты из разных реплик до репликации изменений.</span><span class="sxs-lookup"><span data-stu-id="9b783-105">Version skew occurs when applications read the same objects from different replicas before a change has replicated.</span></span> <span data-ttu-id="9b783-106">Приложения, считывающие удаленную реплику, распознают неизмененный объект.</span><span class="sxs-lookup"><span data-stu-id="9b783-106">Applications reading the remote replica recognize the unchanged object.</span></span> <span data-ttu-id="9b783-107">Отклонение версий является проблемой, когда конкретное приложение или набор приложений используют данные в каталоге для взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="9b783-107">Version skew is an issue when a given application or set of applications use the data in the directory to interoperate.</span></span>

<span data-ttu-id="9b783-108">Например, служба RPC может публиковать свои конечные точки в каталоге с помощью стандартных интерфейсов API RPC (например, [**рпкнсбиндинжекспорт**](/windows/desktop/api/rpcnsi/nf-rpcnsi-rpcnsbindingexporta)).</span><span class="sxs-lookup"><span data-stu-id="9b783-108">For example, an RPC Service can publish its endpoints in the directory using standard RPC APIs (such as [**RpcNsBindingExport**](/windows/desktop/api/rpcnsi/nf-rpcnsi-rpcnsbindingexporta)).</span></span> <span data-ttu-id="9b783-109">Клиенты подключаются к службе, ищут нужную конечную точку в каталоге ( [**рпкнсбиндинглукупбегин**](/windows/desktop/api/rpcnsi/nf-rpcnsi-rpcnsbindinglookupbegina), [**рпкнсбиндинглукупнекст**](/windows/desktop/api/rpcnsi/nf-rpcnsi-rpcnsbindinglookupnext)и т. д.) и привязывая к ней.</span><span class="sxs-lookup"><span data-stu-id="9b783-109">Clients connect to the service by looking up the desired endpoint in the directory ( [**RpcNsBindingLookupBegin**](/windows/desktop/api/rpcnsi/nf-rpcnsi-rpcnsbindinglookupbegina), [**RpcNsBindingLookupNext**](/windows/desktop/api/rpcnsi/nf-rpcnsi-rpcnsbindinglookupnext), and so on) and binding to it.</span></span>

<span data-ttu-id="9b783-110">Предположим, что служба RPC ₁ публикует конечную точку ES ₁, а затем переходит на другой компьютер.</span><span class="sxs-lookup"><span data-stu-id="9b783-110">Assume that an RPC Service S₁ publishes endpoint Eₛ₁ and subsequently moves to a different computer.</span></span> <span data-ttu-id="9b783-111">Исходная конечная точка ES ₁ изменена на E<sub>S2,</sub> отражающая адрес нового компьютера.</span><span class="sxs-lookup"><span data-stu-id="9b783-111">The original endpoint Eₛ₁ is changed to E<sub>s2,</sub> reflecting the new computer's address.</span></span> <span data-ttu-id="9b783-112">Клиенты, считывающие удаленные реплики службы каталогов, не могут подключиться к службе, пока не будет реплицирована обновленная конечная точка.</span><span class="sxs-lookup"><span data-stu-id="9b783-112">Clients reading remote replicas of the directory service are unable to connect to the service until the updated endpoint is replicated.</span></span> <span data-ttu-id="9b783-113">Однако перемещение службы с одного компьютера на другой является редким событием. Таким образом, такое прерывание или задержку следует использовать редко, особенно в том случае, если перемещение службы хорошо запланировано.</span><span class="sxs-lookup"><span data-stu-id="9b783-113">However, moving a service from one computer to another is a rare occurrence; therefore, this interruption/delay should rarely be encountered, especially if the movement of the service is well-planned.</span></span>

## <a name="partial-updates"></a><span data-ttu-id="9b783-114">Частичные обновления</span><span class="sxs-lookup"><span data-stu-id="9b783-114">Partial Updates</span></span>

<span data-ttu-id="9b783-115">Как правило, частичное обновление происходит, когда одно приложение считывает набор данных, в то время как другое приложение записывает данные в тот же набор данных.</span><span class="sxs-lookup"><span data-stu-id="9b783-115">In general, partial update occurs when one application is reading a set of data while another application is writing to that same set of data.</span></span> <span data-ttu-id="9b783-116">Это ситуация, которая может возникнуть в любом приложении в системе с несколькими хозяевами.</span><span class="sxs-lookup"><span data-stu-id="9b783-116">This is a situation that can occur with any application in a multi-mastered system.</span></span> <span data-ttu-id="9b783-117">Это может произойти в различных случаях.</span><span class="sxs-lookup"><span data-stu-id="9b783-117">There are many ways this can occur.</span></span> <span data-ttu-id="9b783-118">В один набор данных может быть записано несколько приложений одновременно.</span><span class="sxs-lookup"><span data-stu-id="9b783-118">You could have more than one application writing to the same data set at once.</span></span> <span data-ttu-id="9b783-119">Если взглянуть на этот способ, служба репликации каталогов — это просто другое приложение, которое потенциально может записываться в тот же набор данных, который может быть прочитан другим приложением.</span><span class="sxs-lookup"><span data-stu-id="9b783-119">If you look at it this way, the directory replication service is just another application that could potentially be writing to the same data set that another application may be reading.</span></span> <span data-ttu-id="9b783-120">Это может быть потенциальной проблемой для приложения.</span><span class="sxs-lookup"><span data-stu-id="9b783-120">This could be a potential problem for an application.</span></span> <span data-ttu-id="9b783-121">Однако окно времени, в течение которого частичное обновление может повлиять на приложение, относительно невелико.</span><span class="sxs-lookup"><span data-stu-id="9b783-121">However, the window of time in which a partial update can affect your application is relatively small.</span></span> <span data-ttu-id="9b783-122">Это должно быть нередко, если когда-либо возникает проблема в приложениях, которые не зависят от синхронизации нескольких объектов.</span><span class="sxs-lookup"><span data-stu-id="9b783-122">This should rarely if ever be an issue for applications that are not dependent on the synchronization of multiple objects.</span></span> <span data-ttu-id="9b783-123">Если приложение сильно зависит от синхронизации связанного набора объектов, следует учитывать последствия частичного обновления в структуре приложения.</span><span class="sxs-lookup"><span data-stu-id="9b783-123">If your application is highly dependent on the synchronization of a related set of objects, you should consider the effects of a partial update in your application design.</span></span>

<span data-ttu-id="9b783-124">С точки зрения репликации каталога происходит частичное обновление, когда приложения считывают один и тот же набор объектов из разных реплик, пока выполняется репликация.</span><span class="sxs-lookup"><span data-stu-id="9b783-124">In terms of the directory replication, partial update occurs when applications read the same set of objects from different replicas while replication is in progress.</span></span> <span data-ttu-id="9b783-125">Приложения на удаленной реплике видят некоторые, но не все изменения.</span><span class="sxs-lookup"><span data-stu-id="9b783-125">Applications at the remote replica see some, but not all, of the changes.</span></span>

> [!Note]  
> <span data-ttu-id="9b783-126">Окно, в котором частичное обновление может повлиять на приложение, невелико: приложение должно начать чтение объектов во время выполнения входящей репликации, после того как один или несколько связанных измененных объектов были получены, но до их получения.</span><span class="sxs-lookup"><span data-stu-id="9b783-126">The window in which partial update can affect an application is small: the application must start reading objects while inbound replication is in progress, after one or more of the related, changed objects have been received but before all have been received.</span></span> <span data-ttu-id="9b783-127">Время между обновлениями в исходной реплике непосредственно влияет на размер этого окна — обновления, которые происходят близко друг к другу во времени, реплицируются близко друг к другу вовремя.</span><span class="sxs-lookup"><span data-stu-id="9b783-127">The time between the updates at the source replica directly affects the size of this window—updates that occur close together in time are replicated close together in time.</span></span> <span data-ttu-id="9b783-128">Частичное обновление может быть проблемой, если приложение использует связанный набор объектов.</span><span class="sxs-lookup"><span data-stu-id="9b783-128">Partial update can be an issue when an application uses a related set of objects.</span></span>

 

<span data-ttu-id="9b783-129">Например, служба удаленного доступа может использовать каталог для хранения данных политики и профиля.</span><span class="sxs-lookup"><span data-stu-id="9b783-129">For example, a remote access service can use the directory to store policy and profile data.</span></span> <span data-ttu-id="9b783-130">Данные политики хранятся в одном наборе объектов, а профиль — в другом наборе.</span><span class="sxs-lookup"><span data-stu-id="9b783-130">The policy data is stored in one set of objects, and the profile in another set.</span></span> <span data-ttu-id="9b783-131">Когда пользователь подключается к службе удаленного доступа, служба удаленного доступа считывает политику, чтобы определить, разрешено ли пользователю подключаться и какой профиль применить к сеансу пользователя.</span><span class="sxs-lookup"><span data-stu-id="9b783-131">When a user connects to the remote access service, the remote access service reads the policy to determine whether the user is allowed to connect, and if so what profile to apply to the user session.</span></span> <span data-ttu-id="9b783-132">Частичное обновление может повлиять на службу удаленного доступа несколькими способами.</span><span class="sxs-lookup"><span data-stu-id="9b783-132">Partial update can affect the remote access service in several ways:</span></span>

-   <span data-ttu-id="9b783-133">Если политика является сложной и состоит из нескольких объектов, то служба удаленного доступа может считывать частично обновленную политику, что привело к неправильному отказу или предоставлению обслуживания пользователю, невозможности обработки политики из-за внутренней несогласованности и т. д.</span><span class="sxs-lookup"><span data-stu-id="9b783-133">If the policy is complex and consists of multiple objects, the remote access service might read a partially updated policy resulting in incorrect denial or granting of service to the user, inability to process the policy due to internal inconsistency, and so on.</span></span>
-   <span data-ttu-id="9b783-134">Если политики и профили были обновлены, служба может правильно обработать политику, но применить устаревший профиль, так как объекты политики реплицированы, но объекты профиля не имеют.</span><span class="sxs-lookup"><span data-stu-id="9b783-134">If both the policy and profiles have been updated, the service might correctly process the policy but apply a stale profile, because the policy objects have replicated but the profile objects have not.</span></span>
-   <span data-ttu-id="9b783-135">Если профиль является сложным и состоит из нескольких объектов, служба может правильно обработать политику, но применить частично обновленный профиль, так как объекты политики были реплицированы, но только некоторые объекты профиля сделали это.</span><span class="sxs-lookup"><span data-stu-id="9b783-135">If the profile is complex and consists of multiple objects, the service might correctly process the policy but apply a partially updated profile because the policy objects have replicated, but only some of the profile objects have done so.</span></span>

## <a name="collisions"></a><span data-ttu-id="9b783-136">Collisions</span><span class="sxs-lookup"><span data-stu-id="9b783-136">Collisions</span></span>

<span data-ttu-id="9b783-137">Конфликты возникают, когда одни и те же атрибуты двух или более реплик определенного объекта изменяются в течение одного интервала репликации.</span><span class="sxs-lookup"><span data-stu-id="9b783-137">Collisions occur when the same attributes of two or more replicas of a given object are changed during the same replication interval.</span></span> <span data-ttu-id="9b783-138">Процесс репликации согласовывает конфликт; из-за выверки пользователь или приложение могут видеть значение, отличное от того, которое они написали.</span><span class="sxs-lookup"><span data-stu-id="9b783-138">The replication process reconciles the collision; because of reconciliation a user or application may "see" a value other than the one they wrote.</span></span>

<span data-ttu-id="9b783-139">Простой пример — сведения об адресе пользователя: пользователь изменяет почтовый адрес в реплике R1, а администратор изменяет тот же почтовый адрес в реплике R2.</span><span class="sxs-lookup"><span data-stu-id="9b783-139">A simple example is user address information: A user changes a mailing address at replica R1 and an administrator changes the same mailing address at replica R2.</span></span> <span data-ttu-id="9b783-140">Записанное значение распространяется до тех пор, пока другое значение для этого значения не будет выбрано механизмом сверки конфликтов.</span><span class="sxs-lookup"><span data-stu-id="9b783-140">A written value propagates until another value is selected over that value by the collision reconciliation mechanism.</span></span> <span data-ttu-id="9b783-141">При условии, что значение "Win" отличается от других значений в процессе разрешения конфликтов, значение будет продолжать распространяться.</span><span class="sxs-lookup"><span data-stu-id="9b783-141">As long as a value continues to "win" against other values in the collision resolution process, the value continues to propagate.</span></span> <span data-ttu-id="9b783-142">В конечном счете, это "выигрышное" значение будет распространяться на R1, R2 и другие реплики, если другие изменения не вносятся.</span><span class="sxs-lookup"><span data-stu-id="9b783-142">Ultimately, this "winning" value will be propagated to R1,R2, and all other replicas if no other changes are made.</span></span>

<span data-ttu-id="9b783-143">Разрешение конфликтов является проблемой для приложений, которые делают предположения относительно внутренней согласованности объектов или наборов объектов.</span><span class="sxs-lookup"><span data-stu-id="9b783-143">Collision resolution is an issue for applications that make assumptions about the internal consistency of objects or sets of objects.</span></span> <span data-ttu-id="9b783-144">Например, служба управления распределением пропускной способности сети хранит данные пропускной способности сети для определенного сегмента сети в каталоге в объекте O1.</span><span class="sxs-lookup"><span data-stu-id="9b783-144">For example, a network bandwidth allocation management service stores network bandwidth data for a given network segment in the directory in an object O1.</span></span> <span data-ttu-id="9b783-145">Объект содержит пропускную способность, доступную в битах в секунду, и максимальную пропускную способность, которую может зарезервировать один пользователь.</span><span class="sxs-lookup"><span data-stu-id="9b783-145">The object contains the bandwidth available in bits-per-second and the maximum bandwidth any single user can reserve.</span></span> <span data-ttu-id="9b783-146">Служба ждет, что пропускная способность пользователя резервируемую всегда будет меньше или равна доступной пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="9b783-146">The service expects that the user reservable bandwidth will always be less than or equal to the bandwidth available.</span></span>

<span data-ttu-id="9b783-147">Рассмотрим следующую последовательность событий.</span><span class="sxs-lookup"><span data-stu-id="9b783-147">Consider the following sequence of events:</span></span>

-   <span data-ttu-id="9b783-148">Объект в начальном полностью реплицированном состоянии предоставляет доступную пропускную способность как 56 килобит в секунду, а пользователь резервируемую пропускную способность как 9 600 бит в секунду.</span><span class="sxs-lookup"><span data-stu-id="9b783-148">The object in the initial fully replicated state gives the available bandwidth as 56 kilobits-per-second, and the user reservable bandwidth as 9,600 bits-per-second.</span></span>
-   <span data-ttu-id="9b783-149">Администратор в реплике R ₁ изменяет значения на 64 КБ и 19 200 соответственно.</span><span class="sxs-lookup"><span data-stu-id="9b783-149">An administrator at replica R₁ changes the values to 64k and 19,200 respectively.</span></span>
-   <span data-ttu-id="9b783-150">Администратор в реплике R ₂ изменяет значения на 10 000 000 и 1 000 000 соответственно до появлении обновления от R ₁.</span><span class="sxs-lookup"><span data-stu-id="9b783-150">An administrator at replica R₂ changes the values to 10 million and 1 million respectively before the update from R₁ arrives.</span></span>

<span data-ttu-id="9b783-151">Предполагая, что рассматриваемые атрибуты имеют одинаковые номера версий при выполнении обновлений, существует небольшая, но реальная вероятность того, что объект будет иметь максимальную пропускную способность 64 КБ, а пользователь резервируемую не более 1 млн — если приложение выполняет обновления как отдельные операции записи.</span><span class="sxs-lookup"><span data-stu-id="9b783-151">Assuming the attributes in question have equal version numbers when the updates occur, there is a small, but real, possibility that the object will end up with a maximum bandwidth of 64k and a user reservable maximum of 1 million—if the application performs the updates as separate write operations.</span></span> <span data-ttu-id="9b783-152">Приложение всегда должно обновлять оба свойства в одной операции.</span><span class="sxs-lookup"><span data-stu-id="9b783-152">The application should always update both properties in a single operation.</span></span>

 

 