---
title: Уведомления об изменениях в службах домен Active Directory Services
description: Домен Active Directory Services предоставляют механизм, с помощью которого клиентское приложение регистрируется на контроллере домена для получения уведомлений об изменениях.
ms.assetid: 27f6c7c1-b32e-457a-9be5-47836d097ab1
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ee564727cfbcb2bfdb367f822fdc137bca7c4e37
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "104069814"
---
# <a name="change-notifications-in-active-directory-domain-services"></a><span data-ttu-id="b2e52-103">Уведомления об изменениях в службах домен Active Directory Services</span><span class="sxs-lookup"><span data-stu-id="b2e52-103">Change Notifications in Active Directory Domain Services</span></span>

<span data-ttu-id="b2e52-104">Домен Active Directory Services предоставляют механизм, с помощью которого клиентское приложение регистрируется на контроллере домена для получения уведомлений об изменениях.</span><span class="sxs-lookup"><span data-stu-id="b2e52-104">Active Directory Domain Services provide a mechanism for a client application to register with a domain controller to receive change notifications.</span></span> <span data-ttu-id="b2e52-105">Для этого клиент указывает управление уведомлением об изменениях LDAP в асинхронной операции поиска LDAP.</span><span class="sxs-lookup"><span data-stu-id="b2e52-105">To do this, the client specifies the LDAP change notification control in an asynchronous LDAP search operation.</span></span> <span data-ttu-id="b2e52-106">Клиент также задает следующие параметры поиска.</span><span class="sxs-lookup"><span data-stu-id="b2e52-106">The client also specifies the following search parameters.</span></span>



| <span data-ttu-id="b2e52-107">Параметр</span><span class="sxs-lookup"><span data-stu-id="b2e52-107">Parameter</span></span>             | <span data-ttu-id="b2e52-108">Описание</span><span class="sxs-lookup"><span data-stu-id="b2e52-108">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|-----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="b2e52-109">Область</span><span class="sxs-lookup"><span data-stu-id="b2e52-109">Scope</span></span><br/>      | <span data-ttu-id="b2e52-110">Укажите **\_ \_ базу области LDAP** для отслеживания только объекта или **\_ области LDAP \_ одноуровневой** , чтобы отслеживать непосредственные дочерние элементы объекта, не включая сам объект.</span><span class="sxs-lookup"><span data-stu-id="b2e52-110">Specify either **LDAP\_SCOPE\_BASE** to monitor just the object, or **LDAP\_SCOPE\_ONELEVEL** to monitor the immediate children of the object, not including the object itself.</span></span> <span data-ttu-id="b2e52-111">Не указывайте **\_ \_ поддерево области LDAP**.</span><span class="sxs-lookup"><span data-stu-id="b2e52-111">Do not specify **LDAP\_SCOPE\_SUBTREE**.</span></span> <span data-ttu-id="b2e52-112">Хотя область поддерева поддерживается, если базовый объект является корнем контекста именования, его использование может существенно повлиять на производительность сервера, так как при каждом изменении объекта в контексте именования создается сообщение с результатами поиска LDAP.</span><span class="sxs-lookup"><span data-stu-id="b2e52-112">Although the subtree scope is supported if the base object is the root of a naming context, its use can severely impact server performance, because it generates an LDAP search result message every time an object in the naming context is modified.</span></span> <span data-ttu-id="b2e52-113">Нельзя указать **\_ \_ поддерево области LDAP** для произвольного поддерева.</span><span class="sxs-lookup"><span data-stu-id="b2e52-113">You cannot specify **LDAP\_SCOPE\_SUBTREE** for an arbitrary subtree.</span></span><br/> |
| <span data-ttu-id="b2e52-114">Фильтр</span><span class="sxs-lookup"><span data-stu-id="b2e52-114">Filter</span></span><br/>     | <span data-ttu-id="b2e52-115">Укажите фильтр поиска "(objectClass = \* )", что означает получение уведомлений об изменениях любого объекта в указанной области.</span><span class="sxs-lookup"><span data-stu-id="b2e52-115">Specify a search filter of "(objectclass=\*)", which means you receive notifications for changes to any object in the specified scope.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                |
| <span data-ttu-id="b2e52-116">Атрибуты</span><span class="sxs-lookup"><span data-stu-id="b2e52-116">Attributes</span></span><br/> | <span data-ttu-id="b2e52-117">Укажите список атрибутов, возвращаемых при возникновении изменений.</span><span class="sxs-lookup"><span data-stu-id="b2e52-117">Specify a list of attributes to return when a change occurs.</span></span> <span data-ttu-id="b2e52-118">Имейте в виду, что вы получаете уведомления об изменении любого атрибута, а не только об указанных атрибутах.</span><span class="sxs-lookup"><span data-stu-id="b2e52-118">Be aware that you receive notifications when any attribute is modified, not just the specified attributes.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                               |



 

<span data-ttu-id="b2e52-119">Можно зарегистрировать до пяти запросов на уведомление по одному LDAP-соединению.</span><span class="sxs-lookup"><span data-stu-id="b2e52-119">You can register up to five notification requests on a single LDAP connection.</span></span> <span data-ttu-id="b2e52-120">Необходимо иметь выделенный поток, который ожидает уведомлений и быстро обрабатывает их.</span><span class="sxs-lookup"><span data-stu-id="b2e52-120">You must have a dedicated thread that waits for the notifications and processes them quickly.</span></span> <span data-ttu-id="b2e52-121">При вызове \_ функции поиска LDAP \_ для регистрации запроса на уведомление функция возвращает идентификатор сообщения, определяющий этот запрос.</span><span class="sxs-lookup"><span data-stu-id="b2e52-121">When you call the ldap\_search\_ext function to register a notification request, the function returns a message identifier that identifies that request.</span></span> <span data-ttu-id="b2e52-122">Затем используйте функцию [**\_ результат LDAP**](/previous-versions/windows/desktop/api/winldap/nf-winldap-ldap_result) для ожидания уведомлений об изменениях.</span><span class="sxs-lookup"><span data-stu-id="b2e52-122">You then use the [**ldap\_result**](/previous-versions/windows/desktop/api/winldap/nf-winldap-ldap_result) function to wait for change notifications.</span></span> <span data-ttu-id="b2e52-123">Когда происходит изменение, сервер отправляет сообщение LDAP, содержащее идентификатор сообщения для запроса уведомления, создавшего уведомление.</span><span class="sxs-lookup"><span data-stu-id="b2e52-123">When a change occurs, the server sends you an LDAP message that contains the message identifier for the notification request that generated the notification.</span></span> <span data-ttu-id="b2e52-124">Это приводит к возврату **\_ результирующей функции LDAP** с результатами поиска, которые обозначают измененный объект.</span><span class="sxs-lookup"><span data-stu-id="b2e52-124">This causes the **ldap\_result** function to return with search results that identify the object that changed.</span></span>

<span data-ttu-id="b2e52-125">Клиентское приложение должно определить начальное состояние наблюдаемого объекта.</span><span class="sxs-lookup"><span data-stu-id="b2e52-125">The client application must determine the initial state of the object monitored.</span></span> <span data-ttu-id="b2e52-126">Для этого необходимо сначала зарегистрировать запрос на уведомление, а затем прочитать текущее состояние.</span><span class="sxs-lookup"><span data-stu-id="b2e52-126">To do this, you must first register the notification request and then read the current state.</span></span>

<span data-ttu-id="b2e52-127">Клиентское приложение также должно определить причину изменения.</span><span class="sxs-lookup"><span data-stu-id="b2e52-127">The client application must also determine the cause of the change.</span></span> <span data-ttu-id="b2e52-128">При поиске на базовом уровне уведомление возникает при изменении любого атрибута или при удалении или перемещении объекта.</span><span class="sxs-lookup"><span data-stu-id="b2e52-128">For a base level search, a notification occurs when any attribute changes, or when the object is deleted or moved.</span></span> <span data-ttu-id="b2e52-129">Для одноуровневого поиска уведомление происходит при создании, удалении, перемещении или изменении дочернего объекта.</span><span class="sxs-lookup"><span data-stu-id="b2e52-129">For a one-level search, a notification occurs when a child object is created, deleted, moved, or modified.</span></span> <span data-ttu-id="b2e52-130">Имейте в виду, что перемещение или переименование объекта в иерархии выше целевого объекта не создает уведомление, даже если различающееся имя объекта изменилось в результате.</span><span class="sxs-lookup"><span data-stu-id="b2e52-130">Be aware that moving or renaming an object in the hierarchy above a target object does not generate a notification even though the distinguished name of the target changed as a result.</span></span> <span data-ttu-id="b2e52-131">Например, при наблюдении за изменениями дочерних объектов в контейнере уведомления не будут получаться, если контейнер перемещается или переименовывается.</span><span class="sxs-lookup"><span data-stu-id="b2e52-131">For example, if monitoring changes to the child objects in a container, you will not receive notifications if the container itself is moved or renamed.</span></span>

<span data-ttu-id="b2e52-132">Когда клиент обрабатывает результаты поиска, он может использовать \_ функцию LDAP Get DN, \_ чтобы получить различающееся имя измененного объекта.</span><span class="sxs-lookup"><span data-stu-id="b2e52-132">When the client processes the search results, it can use the ldap\_get\_dn function to get the distinguished name of the object that changed.</span></span> <span data-ttu-id="b2e52-133">Не полагайтесь на различающиеся имена, чтобы определить, какие объекты отслеживание, так как различающиеся имена могут измениться.</span><span class="sxs-lookup"><span data-stu-id="b2e52-133">Do not rely on distinguished names to identify the objects tracked, because distinguished names can change.</span></span> <span data-ttu-id="b2e52-134">Вместо этого включите атрибут **objectGUID** в список извлекаемых атрибутов.</span><span class="sxs-lookup"><span data-stu-id="b2e52-134">Instead, include the **objectGUID** attribute in the list of attributes to retrieve.</span></span> <span data-ttu-id="b2e52-135">**ObjectGUID** каждого объекта остается неизменным независимо от места перемещения объекта в корпоративном лесу.</span><span class="sxs-lookup"><span data-stu-id="b2e52-135">Each object's **objectGUID** remains unchanged regardless of where the object is moved within the enterprise forest.</span></span>

<span data-ttu-id="b2e52-136">Если объект в области поиска удаляется, клиент получает уведомление об изменении, а атрибут **IsDeleted** объекта — **значение true**.</span><span class="sxs-lookup"><span data-stu-id="b2e52-136">If an object within the search scope is deleted, the client receives a change notification and the **isDeleted** attribute of the object is set to **TRUE**.</span></span> <span data-ttu-id="b2e52-137">В этом случае результаты поиска сообщают о новом различающемся имени объекта в контейнере удаленные объекты его секции.</span><span class="sxs-lookup"><span data-stu-id="b2e52-137">In this case, the search results report the new distinguished name of the object in the Deleted Objects container of its partition.</span></span> <span data-ttu-id="b2e52-138">Нет необходимости указывать элемент управления "захоронение" ([LDAP \_ Server \_ Показывать \_ Удаленный \_ OID](/previous-versions/windows/desktop/ldap/ldap-server-show-deleted-oid)) для получения уведомлений об удалении объектов.</span><span class="sxs-lookup"><span data-stu-id="b2e52-138">It is not necessary to specify the tombstone control ([LDAP\_SERVER\_SHOW\_DELETED\_OID](/previous-versions/windows/desktop/ldap/ldap-server-show-deleted-oid)) to get notifications of object deletions.</span></span> <span data-ttu-id="b2e52-139">Дополнительные сведения см. в разделе [получение удаленных объектов](retrieving-deleted-objects.md).</span><span class="sxs-lookup"><span data-stu-id="b2e52-139">For more information, see [Retrieving Deleted Objects](retrieving-deleted-objects.md).</span></span>

<span data-ttu-id="b2e52-140">Когда клиент зарегистрировал запрос на уведомление, клиент продолжит получать уведомления до тех пор, пока соединение не будет разорвано или клиент не прекратит поиск, вызвав функцию LDAP No \_ .</span><span class="sxs-lookup"><span data-stu-id="b2e52-140">When a client has registered a notification request, the client continues to receive notifications until the connection is broken or the client abandons the search by calling the ldap\_abandon function.</span></span> <span data-ttu-id="b2e52-141">Если клиент или сервер отключается, например, при сбое сервера запрос уведомления прерывается.</span><span class="sxs-lookup"><span data-stu-id="b2e52-141">If the client or server disconnects, for example, if the server fails, the notification request is terminated.</span></span> <span data-ttu-id="b2e52-142">Когда клиент повторно подключится, он должен снова зарегистрироваться для получения уведомлений, а затем прочитать текущее состояние интересующих объектов, если во время отключения клиента были внесены изменения.</span><span class="sxs-lookup"><span data-stu-id="b2e52-142">When the client reconnects, it must register for notifications again, and then read the current state of the objects of interest in case there were changes while the client was disconnected.</span></span>

<span data-ttu-id="b2e52-143">Клиент может использовать значение атрибута **uSNChanged** объекта, чтобы определить, отражает ли текущее состояние объекта на сервере последние изменения, полученные клиентом.</span><span class="sxs-lookup"><span data-stu-id="b2e52-143">The client can use the value of an object's **uSNChanged** attribute to determine whether the current state of the object on the server reflects the latest changes that the client has received.</span></span> <span data-ttu-id="b2e52-144">Система увеличивает атрибут **uSNChanged** объекта при перемещении или изменении объекта.</span><span class="sxs-lookup"><span data-stu-id="b2e52-144">The system increases an object's **uSNChanged** attribute when the object is moved or modified.</span></span> <span data-ttu-id="b2e52-145">Например, если сервер завершается с ошибкой и раздел каталога восстанавливается из резервной копии, то реплика сервера объекта может не отражать ранее отправленные на клиент изменения, в этом случае значение **uSNChanged** на сервере будет меньше значения, хранящегося в клиенте.</span><span class="sxs-lookup"><span data-stu-id="b2e52-145">For example, if the server fails and the directory partition is restored from a backup, the server's replica of an object may not reflect changes previously reported to the client, in which case the **uSNChanged** value on the server will be lower than the value stored by the client.</span></span>

<span data-ttu-id="b2e52-146">Дополнительные сведения и пример кода, в котором используется элемент управления уведомлениями об изменениях LDAP в асинхронной операции поиска LDAP, см. в разделе [пример кода для получения уведомлений об изменениях](example-code-for-receiving-change-notifications.md).</span><span class="sxs-lookup"><span data-stu-id="b2e52-146">For more information and a code example that uses the LDAP change notification control in an asynchronous LDAP search operation, see [Example Code for Receiving Change Notifications](example-code-for-receiving-change-notifications.md).</span></span>

<span data-ttu-id="b2e52-147">Дополнительные сведения о том, когда следует использовать управление уведомлениями об изменениях LDAP, см. в разделе [Общие сведения о методах отслеживание изменений](overview-of-change-tracking-techniques.md).</span><span class="sxs-lookup"><span data-stu-id="b2e52-147">For more information about when to use the LDAP change notification control, see [Overview of Change Tracking Techniques](overview-of-change-tracking-techniques.md).</span></span>

 

