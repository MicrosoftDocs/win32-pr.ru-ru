---
title: Создание и удаление объектов в службах домен Active Directory Services
description: Процедура, используемая для программного создания и удаления объектов в домен Active Directory Services, зависит от используемой технологии программирования.
ms.assetid: 13f83aea-ad39-4737-af3c-24316a31046d
ms.tgt_platform: multiple
keywords:
- Создание и удаление Active Directory объектов Active Directory
- Active Directory домен Active Directory Services с помощью создания и удаления объектов
- объекты Active Directory, создание и удаление объектов домен Active Directory служб
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 11d3e85ef3c356978faeab059e3969bb657185bd
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "104487472"
---
# <a name="creating-and-deleting-objects-in-active-directory-domain-services"></a><span data-ttu-id="e4886-106">Создание и удаление объектов в службах домен Active Directory Services</span><span class="sxs-lookup"><span data-stu-id="e4886-106">Creating and Deleting Objects in Active Directory Domain Services</span></span>

<span data-ttu-id="e4886-107">Процедура, используемая для программного создания и удаления объектов в домен Active Directory Services, зависит от используемой технологии программирования.</span><span class="sxs-lookup"><span data-stu-id="e4886-107">The procedure used to programmatically create and delete objects in Active Directory Domain Services is dependent upon the programming technology used.</span></span> <span data-ttu-id="e4886-108">Дополнительные сведения о создании и удалении объектов в службах домен Active Directory с помощью определенной технологии программирования см. в разделах, перечисленных в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="e4886-108">For more information about creating and deleting objects in Active Directory Domain Services with a specific programming technology, see the topics listed in the following table.</span></span>



| <span data-ttu-id="e4886-109">Технология программирования</span><span class="sxs-lookup"><span data-stu-id="e4886-109">Programming technology</span></span>                                                                       | <span data-ttu-id="e4886-110">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="e4886-110">For more information</span></span>                                                            |
|----------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|
| [<span data-ttu-id="e4886-111">Интерфейсы служб Active Directory</span><span class="sxs-lookup"><span data-stu-id="e4886-111">Active Directory Service Interfaces</span></span>](/windows/desktop/ADSI/active-directory-service-interfaces-adsi)         | [<span data-ttu-id="e4886-112">Создание и удаление объектов</span><span class="sxs-lookup"><span data-stu-id="e4886-112">Creating and Deleting Objects</span></span>](/windows/desktop/ADSI/creating-and-deleting-objects)             |
| [<span data-ttu-id="e4886-113">протокол LDAP</span><span class="sxs-lookup"><span data-stu-id="e4886-113">Lightweight Directory Access Protocol</span></span>](/previous-versions/windows/desktop/ldap/lightweight-directory-access-protocol-ldap-api) | [<span data-ttu-id="e4886-114">Изменение записи каталога</span><span class="sxs-lookup"><span data-stu-id="e4886-114">Modifying a Directory Entry</span></span>](/previous-versions/windows/desktop/ldap/modifying-a-directory-entry)                 |
| [<span data-ttu-id="e4886-115">System.DirectoryServices</span><span class="sxs-lookup"><span data-stu-id="e4886-115">System.DirectoryServices</span></span>](/dotnet/api/system.directoryservices) | <span data-ttu-id="e4886-116">[Создание, удаление, переименование и перемещение объектов](https://msdn.microsoft.com/library/ms180850(v=VS.80).aspx)</span><span class="sxs-lookup"><span data-stu-id="e4886-116">[Create, Delete, Rename and Move Objects](https://msdn.microsoft.com/library/ms180850(v=VS.80).aspx)</span></span> |



 

## <a name="creating-an-object"></a><span data-ttu-id="e4886-117">Создание объекта</span><span class="sxs-lookup"><span data-stu-id="e4886-117">Creating an Object</span></span>

<span data-ttu-id="e4886-118">В целом, единственными атрибутами, необходимыми для создания объекта, являются атрибуты **CN** и **objectClass** .</span><span class="sxs-lookup"><span data-stu-id="e4886-118">In general, the only attributes required for an object to be created are the **cn** and **objectClass** attributes.</span></span> <span data-ttu-id="e4886-119">Однако только создание объекта не обязательно делает его функциональным объектом.</span><span class="sxs-lookup"><span data-stu-id="e4886-119">Just creating an object does not necessarily make it a functional object however.</span></span> <span data-ttu-id="e4886-120">Некоторые типы объектов, такие как пользователи и группы, имеют дополнительные необходимые атрибуты, чтобы сделать их функциональными.</span><span class="sxs-lookup"><span data-stu-id="e4886-120">Certain types of objects, such as users and groups, have additional required attributes to make them functional.</span></span> <span data-ttu-id="e4886-121">Дополнительные сведения о создании объектов определенного типа см. в разделе [Создание пользователя](creating-a-user.md) и [Создание групп в домене](creating-groups-in-a-domain.md).</span><span class="sxs-lookup"><span data-stu-id="e4886-121">For more information about creating specific types of objects, see [Creating a User](creating-a-user.md) and [Creating Groups in a Domain](creating-groups-in-a-domain.md).</span></span>

<span data-ttu-id="e4886-122">**Windows Server 2003:** Когда объект класса [**User**](/windows/desktop/ADSchema/c-user), [**Group**](/windows/desktop/ADSchema/c-group)или [**Computer**](/windows/desktop/ADSchema/c-computer) создается на контроллере домена, работающем на сервере ввиндовс 2003 или более поздней версии, контроллер домена автоматически устанавливает атрибут [**SamAccountName**](/windows/desktop/ADSchema/a-samaccountname) для объекта в уникальную строку, если она не указана.</span><span class="sxs-lookup"><span data-stu-id="e4886-122">**Windows Server 2003:** When an object of the [**user**](/windows/desktop/ADSchema/c-user), [**group**](/windows/desktop/ADSchema/c-group), or [**computer**](/windows/desktop/ADSchema/c-computer) class is created on a domain controller that is running on WWindows Server 2003 or later, the domain controller automatically sets the [**sAMAccountName**](/windows/desktop/ADSchema/a-samaccountname) attribute for the object to a unique string, if one is not specified.</span></span>

## <a name="deleting-an-object"></a><span data-ttu-id="e4886-123">Удаление объекта</span><span class="sxs-lookup"><span data-stu-id="e4886-123">Deleting an Object</span></span>

<span data-ttu-id="e4886-124">Сервер Active Directory выполняет следующие действия при удалении объекта:</span><span class="sxs-lookup"><span data-stu-id="e4886-124">The Active Directory server performs the following actions when an object is deleted:</span></span>

-   <span data-ttu-id="e4886-125">Атрибут **IsDeleted** удаленного объекта установлен в **значение true**.</span><span class="sxs-lookup"><span data-stu-id="e4886-125">The **isDeleted** attribute of the deleted object is set to **TRUE**.</span></span> <span data-ttu-id="e4886-126">Объекты с атрибутом **IsDeleted** , имеющим значение **true** , называются [*отметками полного удаления*](/previous-versions/windows/desktop/legacy/ms681941(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="e4886-126">Objects with an **isDeleted** attribute value set to **TRUE** are called [*tombstones*](/previous-versions/windows/desktop/legacy/ms681941(v=vs.85)).</span></span>
-   <span data-ttu-id="e4886-127">Удаленный объект перемещается в контейнер удаленных объектов для своего контекста именования.</span><span class="sxs-lookup"><span data-stu-id="e4886-127">The deleted object is moved to the Deleted Objects container for its naming context.</span></span> <span data-ttu-id="e4886-128">Если свойство объекта **systemFlags** содержит флаг 0x02000000, объект не перемещается в контейнер удаленные объекты.</span><span class="sxs-lookup"><span data-stu-id="e4886-128">If the object **systemFlags** property contains the 0x02000000 flag, the object is not moved to the Deleted Objects container.</span></span> <span data-ttu-id="e4886-129">Дополнительные сведения о привязке и перечислении содержимого контейнера удаленных объектов см. в разделе [получение удаленных объектов](retrieving-deleted-objects.md).</span><span class="sxs-lookup"><span data-stu-id="e4886-129">For more information about binding to and enumerating the contents of the Deleted Objects container, see [Retrieving Deleted Objects](retrieving-deleted-objects.md).</span></span>
-   <span data-ttu-id="e4886-130">Контейнер удаленных объектов является плоским, поэтому все объекты находятся на том же уровне в контейнере удаленных объектов.</span><span class="sxs-lookup"><span data-stu-id="e4886-130">The Deleted Objects container is flat, so all objects reside at the same level within the Deleted Objects container.</span></span> <span data-ttu-id="e4886-131">Таким словами, относительное различающееся имя удаленного объекта изменяется, чтобы гарантировать уникальность имени в контейнере удаленных объектов.</span><span class="sxs-lookup"><span data-stu-id="e4886-131">Thus, the relative distinguished name of the deleted object is changed to ensure that the name is unique within the Deleted Objects container.</span></span> <span data-ttu-id="e4886-132">Если исходное имя длиннее 75 символов, оно усекается до 75 символов.</span><span class="sxs-lookup"><span data-stu-id="e4886-132">If the original name is longer than 75 characters, it is truncated to 75 characters.</span></span> <span data-ttu-id="e4886-133">Затем к новому имени добавляются следующие имена:</span><span class="sxs-lookup"><span data-stu-id="e4886-133">The following are then appended to the new name:</span></span>
    1.  <span data-ttu-id="e4886-134">Символ 0x0A</span><span class="sxs-lookup"><span data-stu-id="e4886-134">A 0x0A character</span></span>
    2.  <span data-ttu-id="e4886-135">Строка "DEL:"</span><span class="sxs-lookup"><span data-stu-id="e4886-135">The string "DEL:"</span></span>
    3.  <span data-ttu-id="e4886-136">Форма строки уникального идентификатора GUID, например "947e3228-70c9-4311-8b7a-e5c9b5bd4432"</span><span class="sxs-lookup"><span data-stu-id="e4886-136">The string form of a unique GUID, such as "947e3228-70c9-4311-8b7a-e5c9b5bd4432"</span></span>

    <span data-ttu-id="e4886-137">Пример удаленного имени объекта:</span><span class="sxs-lookup"><span data-stu-id="e4886-137">An example of a deleted object name is:</span></span>
    ```C++
    Jeff Smith\0ADEL:947e3228-70c9-4311-8b7a-e5c9b5bd4432
    ```

    

-   <span data-ttu-id="e4886-138">Большинство значений атрибутов удаленного объекта удаляются.</span><span class="sxs-lookup"><span data-stu-id="e4886-138">Most attribute values for the deleted object are removed.</span></span> <span data-ttu-id="e4886-139">Следующие атрибуты сохраняются автоматически:</span><span class="sxs-lookup"><span data-stu-id="e4886-139">The following attributes are automatically retained:</span></span>

    -   <span data-ttu-id="e4886-140">**attributeID**</span><span class="sxs-lookup"><span data-stu-id="e4886-140">**attributeID**</span></span>
    -   <span data-ttu-id="e4886-141">**attributeSyntax**</span><span class="sxs-lookup"><span data-stu-id="e4886-141">**attributeSyntax**</span></span>
    -   <span data-ttu-id="e4886-142">**distinguishedName**</span><span class="sxs-lookup"><span data-stu-id="e4886-142">**distinguishedName**</span></span>
    -   <span data-ttu-id="e4886-143">**днреференцеупдате**</span><span class="sxs-lookup"><span data-stu-id="e4886-143">**dNReferenceUpdate**</span></span>
    -   <span data-ttu-id="e4886-144">**флатнаме**</span><span class="sxs-lookup"><span data-stu-id="e4886-144">**flatName**</span></span>
    -   <span data-ttu-id="e4886-145">**governsID**</span><span class="sxs-lookup"><span data-stu-id="e4886-145">**governsID**</span></span>
    -   <span data-ttu-id="e4886-146">**groupType**</span><span class="sxs-lookup"><span data-stu-id="e4886-146">**groupType**</span></span>
    -   <span data-ttu-id="e4886-147">**instanceType**</span><span class="sxs-lookup"><span data-stu-id="e4886-147">**instanceType**</span></span>
    -   <span data-ttu-id="e4886-148">**lDAPDisplayName**</span><span class="sxs-lookup"><span data-stu-id="e4886-148">**lDAPDisplayName**</span></span>
    -   <span data-ttu-id="e4886-149">**legacyExchangeDN**</span><span class="sxs-lookup"><span data-stu-id="e4886-149">**legacyExchangeDN**</span></span>
    -   <span data-ttu-id="e4886-150">**mS-DS-Креаторсид**</span><span class="sxs-lookup"><span data-stu-id="e4886-150">**mS-DS-CreatorSID**</span></span>
    -   <span data-ttu-id="e4886-151">**мсмковнерид**</span><span class="sxs-lookup"><span data-stu-id="e4886-151">**mSMQOwnerID**</span></span>
    -   <span data-ttu-id="e4886-152">**name**</span><span class="sxs-lookup"><span data-stu-id="e4886-152">**name**</span></span>
    -   <span data-ttu-id="e4886-153">**Параметрами**</span><span class="sxs-lookup"><span data-stu-id="e4886-153">**nCName**</span></span>
    -   <span data-ttu-id="e4886-154">**Атрибута**</span><span class="sxs-lookup"><span data-stu-id="e4886-154">**objectClass**</span></span>
    -   <span data-ttu-id="e4886-155">**objectGUID**</span><span class="sxs-lookup"><span data-stu-id="e4886-155">**objectGUID**</span></span>
    -   <span data-ttu-id="e4886-156">**objectSid**</span><span class="sxs-lookup"><span data-stu-id="e4886-156">**objectSid**</span></span>
    -   <span data-ttu-id="e4886-157">**oMSyntax**</span><span class="sxs-lookup"><span data-stu-id="e4886-157">**oMSyntax**</span></span>
    -   <span data-ttu-id="e4886-158">**проксиедобжектнаме**</span><span class="sxs-lookup"><span data-stu-id="e4886-158">**proxiedObjectName**</span></span>
    -   <span data-ttu-id="e4886-159">**реплпропертиметадата**</span><span class="sxs-lookup"><span data-stu-id="e4886-159">**replPropertyMetaData**</span></span>
    -   <span data-ttu-id="e4886-160">**sAMAccountName**</span><span class="sxs-lookup"><span data-stu-id="e4886-160">**sAMAccountName**</span></span>
    -   <span data-ttu-id="e4886-161">**securityIdentifier**</span><span class="sxs-lookup"><span data-stu-id="e4886-161">**securityIdentifier**</span></span>
    -   <span data-ttu-id="e4886-162">**subClassOf**</span><span class="sxs-lookup"><span data-stu-id="e4886-162">**subClassOf**</span></span>
    -   <span data-ttu-id="e4886-163">**systemFlags**</span><span class="sxs-lookup"><span data-stu-id="e4886-163">**systemFlags**</span></span>
    -   <span data-ttu-id="e4886-164">**трустаттрибутес**</span><span class="sxs-lookup"><span data-stu-id="e4886-164">**trustAttributes**</span></span>
    -   <span data-ttu-id="e4886-165">**трустдиректион**</span><span class="sxs-lookup"><span data-stu-id="e4886-165">**trustDirection**</span></span>
    -   <span data-ttu-id="e4886-166">**трустпартнер**</span><span class="sxs-lookup"><span data-stu-id="e4886-166">**trustPartner**</span></span>
    -   <span data-ttu-id="e4886-167">**трусттипе**</span><span class="sxs-lookup"><span data-stu-id="e4886-167">**trustType**</span></span>
    -   <span data-ttu-id="e4886-168">**userAccountControl**</span><span class="sxs-lookup"><span data-stu-id="e4886-168">**userAccountControl**</span></span>
    -   <span data-ttu-id="e4886-169">**uSNChanged**</span><span class="sxs-lookup"><span data-stu-id="e4886-169">**uSNChanged**</span></span>
    -   <span data-ttu-id="e4886-170">**uSNCreated**</span><span class="sxs-lookup"><span data-stu-id="e4886-170">**uSNCreated**</span></span>
    -   <span data-ttu-id="e4886-171">**whenCreated**</span><span class="sxs-lookup"><span data-stu-id="e4886-171">**whenCreated**</span></span>

    <span data-ttu-id="e4886-172">Также сохраняются другие атрибуты, имеющие значение атрибута **searchFlags** , которое содержит 0x00000008.</span><span class="sxs-lookup"><span data-stu-id="e4886-172">Other attributes that have a **searchFlags** attribute value that contains 0x00000008 are also retained.</span></span>

    <span data-ttu-id="e4886-173">Следующие значения атрибутов всегда удаляются из удаленного объекта:</span><span class="sxs-lookup"><span data-stu-id="e4886-173">The following attribute values are always removed from a deleted object:</span></span>

    -   <span data-ttu-id="e4886-174">**objectCategory**</span><span class="sxs-lookup"><span data-stu-id="e4886-174">**objectCategory**</span></span>
    -   <span data-ttu-id="e4886-175">**samAccountType**</span><span class="sxs-lookup"><span data-stu-id="e4886-175">**samAccountType**</span></span>

-   <span data-ttu-id="e4886-176">Дескриптор безопасности удаленного объекта сохраняется, и наследуемые записи управления доступом не распространяются.</span><span class="sxs-lookup"><span data-stu-id="e4886-176">The security descriptor of the deleted object is retained and inheritable access control entries are not propagated.</span></span> <span data-ttu-id="e4886-177">Дескриптор безопасности сохраняется как есть на момент удаления объекта.</span><span class="sxs-lookup"><span data-stu-id="e4886-177">The security descriptor is retained as-is at the time the object is deleted.</span></span>
-   <span data-ttu-id="e4886-178">Ссылки на удаленный объект и из него очищаются.</span><span class="sxs-lookup"><span data-stu-id="e4886-178">Links to and from the deleted object are cleared.</span></span> <span data-ttu-id="e4886-179">Это выполняется в фоновом режиме после удаления объекта.</span><span class="sxs-lookup"><span data-stu-id="e4886-179">This is performed in the background after the object is deleted.</span></span> <span data-ttu-id="e4886-180">Если удаленный объект будет восстановлен до очистки всех ссылок, будет получено сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="e4886-180">If the deleted object is restored before all of the links are cleared, an error will be received.</span></span>
-   <span data-ttu-id="e4886-181">Если объект удален на контроллере домена Windows Server 2003, атрибуту **lastKnownParent** удаленного объекта присваивается различающееся имя контейнера, в котором был удален объект.</span><span class="sxs-lookup"><span data-stu-id="e4886-181">If the object is deleted on a Windows Server 2003 domain controller, the **lastKnownParent** attribute of the deleted object is set to the distinguished name of the container where the object was contained when it was deleted.</span></span>

<span data-ttu-id="e4886-182">Удаленный объект остается в контейнере удаленных объектов в течение времени, известного как время *существования захоронения*.</span><span class="sxs-lookup"><span data-stu-id="e4886-182">The deleted object remains in the Deleted Objects container for a period of time known as the *tombstone lifetime*.</span></span> <span data-ttu-id="e4886-183">По умолчанию время жизни захоронения составляет 60 дней, но это значение может быть изменено системным администратором.</span><span class="sxs-lookup"><span data-stu-id="e4886-183">By default, the tombstone lifetime is 60 days, but this value can be changed by the system administrator.</span></span> <span data-ttu-id="e4886-184">По истечении времени существования захоронения объект удаляется из службы каталогов без возможности восстановления.</span><span class="sxs-lookup"><span data-stu-id="e4886-184">After the tombstone lifetime expires, the object is permanently removed from the Directory Service.</span></span> <span data-ttu-id="e4886-185">Чтобы избежать отсутствия операции удаления, приложение должно выполнять добавочную синхронизацию чаще, чем время существования захоронения.</span><span class="sxs-lookup"><span data-stu-id="e4886-185">To avoid missing a delete operation, an application must perform incremental synchronizations more frequently than the tombstone lifetime.</span></span>

<span data-ttu-id="e4886-186">В Windows Server 2003 добавлена возможность восстановления удаленных объектов.</span><span class="sxs-lookup"><span data-stu-id="e4886-186">Windows Server 2003 adds the ability to restore deleted objects.</span></span> <span data-ttu-id="e4886-187">Дополнительные сведения об восстановлении удаленных объектов см. в разделе [Восстановление удаленных объектов](restoring-deleted-objects.md).</span><span class="sxs-lookup"><span data-stu-id="e4886-187">For more information about deleted object restoration, see [Restoring Deleted Objects](restoring-deleted-objects.md).</span></span>

<span data-ttu-id="e4886-188">При удалении элемента ни один из атрибутов объекта изменить нельзя.</span><span class="sxs-lookup"><span data-stu-id="e4886-188">When an item is deleted, none of the attributes of the object can be modified.</span></span> <span data-ttu-id="e4886-189">В Windows Server 2003 можно изменить дескриптор безопасности (атрибут **нтсекуритидескриптор** ) на удаленном объекте.</span><span class="sxs-lookup"><span data-stu-id="e4886-189">In Windows Server 2003, it is possible to modify the security descriptor (the **ntSecurityDescriptor** attribute) on a deleted object.</span></span> <span data-ttu-id="e4886-190">Это позволяет восстановить объекты, когда пользователь, выполняющий восстановление объекта, не имеет разрешений на запись в обязательные атрибуты.</span><span class="sxs-lookup"><span data-stu-id="e4886-190">This is to allow restoration of objects when the person restoring the object does not have write permissions to mandatory attributes.</span></span> <span data-ttu-id="e4886-191">Для обновления дескриптора безопасности удаленного объекта вызывающий объект должен иметь право доступа "reanimate захоронения" в контексте именования в дополнение к обычной **записи \_ DAC** и доступу для **записи \_ владельца** .</span><span class="sxs-lookup"><span data-stu-id="e4886-191">To update the security descriptor on a deleted object, the caller must have the "Reanimate Tombstone" control access right on the naming context, in addition to regular **WRITE\_DAC** and **WRITE\_OWNER** access.</span></span> <span data-ttu-id="e4886-192">Даже если дескриптор безопасности является ограниченным, администратор может сначала стать владельцем объекта, предполагая, что администратор имеет привилегию **SE \_ Take \_ Ownership \_ Name** , а затем изменить дескриптор безопасности.</span><span class="sxs-lookup"><span data-stu-id="e4886-192">Even if the security descriptor is restrictive, the administrator can first take ownership of the object, assuming the administrator has the **SE\_TAKE\_OWNERSHIP\_NAME** privilege, and then modify the security descriptor.</span></span> <span data-ttu-id="e4886-193">Для этого используйте функцию [**LDAP \_ Modify \_ ext \_ s**](/previous-versions/windows/desktop/api/winldap/nf-winldap-ldap_modify_ext_s) с [**\_ сервером LDAP \_ отобразить \_ Удаленный \_**](/previous-versions/windows/desktop/ldap/ldap-server-show-deleted-oid) элемент управления OID.</span><span class="sxs-lookup"><span data-stu-id="e4886-193">To do this, use the [**ldap\_modify\_ext\_s**](/previous-versions/windows/desktop/api/winldap/nf-winldap-ldap_modify_ext_s) function with the [**LDAP\_SERVER\_SHOW\_DELETED\_OID**](/previous-versions/windows/desktop/ldap/ldap-server-show-deleted-oid) control.</span></span> <span data-ttu-id="e4886-194">Список изменений должен содержать одну замену атрибута **нтсекуритидескриптор** .</span><span class="sxs-lookup"><span data-stu-id="e4886-194">The modification list must contain a single attribute replacement for the **ntSecurityDescriptor** attribute.</span></span>

 

 