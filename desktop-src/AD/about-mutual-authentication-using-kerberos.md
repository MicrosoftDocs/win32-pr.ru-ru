---
title: О взаимной проверке подлинности с помощью Kerberos
description: При взаимной проверке подлинности клиент и служба перед выполнением функций приложения должны проверять свои идентификаторы друг на друга.
ms.assetid: 5ce923d6-bede-4acb-b297-e93f2f506ea9
ms.tgt_platform: multiple
keywords:
- О взаимной проверке подлинности с помощью Kerberos AD
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9685dad0bd20f233b8dcb0ecf12af338f318646f
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104067279"
---
# <a name="about-mutual-authentication-using-kerberos"></a><span data-ttu-id="3ef38-104">О взаимной проверке подлинности с помощью Kerberos</span><span class="sxs-lookup"><span data-stu-id="3ef38-104">About Mutual Authentication Using Kerberos</span></span>

<span data-ttu-id="3ef38-105">При взаимной проверке подлинности клиент и служба перед выполнением функций приложения должны проверять свои идентификаторы друг на друга.</span><span class="sxs-lookup"><span data-stu-id="3ef38-105">In mutual authentication, the client and service must verify their respective identities to each other before performing application functions.</span></span> <span data-ttu-id="3ef38-106">Ни одна из сторон не может выполнять операции с другими, пока не будет проверено удостоверение. то есть служба должна иметь возможность проверить клиент без запроса клиента, и клиент должен иметь возможность проверить службу без запроса к службе.</span><span class="sxs-lookup"><span data-stu-id="3ef38-106">Neither party can perform operations with the other until identity has been verified; that is, the service must be able to verify the client without querying the client and the client must be able to verify the service without querying the service.</span></span>

<span data-ttu-id="3ef38-107">Значение службы, которая может проверить подлинность клиента, хорошо известно.</span><span class="sxs-lookup"><span data-stu-id="3ef38-107">The value of a service that can authenticate a client is well-known.</span></span> <span data-ttu-id="3ef38-108">Например, Файловая служба олицетворяет клиента, чтобы определить, к каким файлам имеет доступ клиент.</span><span class="sxs-lookup"><span data-stu-id="3ef38-108">For example, a file service impersonates a client to determine which files the client can access.</span></span>

<span data-ttu-id="3ef38-109">Значение клиента, которое может проверить подлинность службы, менее понятно.</span><span class="sxs-lookup"><span data-stu-id="3ef38-109">The value of a client that can authenticate a service is less understood.</span></span> <span data-ttu-id="3ef38-110">Проверка подлинности службы позволяет клиенту доверять данным, которые он получает от службы, и обеспечить безопасность при отправке конфиденциальных данных в службу.</span><span class="sxs-lookup"><span data-stu-id="3ef38-110">Authenticating a service enables the client to trust the data that it gets from the service and to be secure in sending sensitive data to the service.</span></span> <span data-ttu-id="3ef38-111">Способность клиента проверять подлинность службы особенно важна в клиентских и сервисных приложениях, поддерживающих делегирование контекста безопасности клиента; то есть клиент авторизует службу, чтобы она действовала в качестве своего делегата при доступе к дополнительным службам или сетевым ресурсам.</span><span class="sxs-lookup"><span data-stu-id="3ef38-111">The ability of a client to authenticate a service is particularly important in client/service applications that support delegation of the client's security context; that is, the client authorizes the service to act as its delegate in accessing additional services or network resources.</span></span>

<span data-ttu-id="3ef38-112">Служба выполняет проверку подлинности клиента следующим образом: клиент устанавливает локальный контекст безопасности, выполняя в ранее установленном контексте, например в сеансе пользователя, выполнившего вход в систему, или явно выполняя учетные данные для базового поставщика безопасности.</span><span class="sxs-lookup"><span data-stu-id="3ef38-112">A service authenticates a client as follows: The client establishes a local security context either by executing in a previously established context, for example, in the session of a logged-in user, or by explicitly presenting credentials to the underlying security provider.</span></span> <span data-ttu-id="3ef38-113">Служба не может принимать подключения от любого клиента, не прошедшего проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="3ef38-113">The service cannot accept connections from any unauthenticated client.</span></span>

<span data-ttu-id="3ef38-114">Механизм Kerberos, с помощью которого клиент проходит проверку подлинности службы, работает следующим образом: при установке службы установщик службы, выполняющий права администратора, регистрирует один или несколько уникальных имен участников-служб для каждого экземпляра службы.</span><span class="sxs-lookup"><span data-stu-id="3ef38-114">The Kerberos mechanism by which a client authenticates a service works as follows: When a service is installed, a service installer, running with administrator privileges, registers one or more unique SPNs for each service instance.</span></span> <span data-ttu-id="3ef38-115">Имена регистрируются в контроллере домен Active Directory (DC) для объекта учетной записи пользователя или компьютера, который будет использоваться экземпляром службы для входа в систему.</span><span class="sxs-lookup"><span data-stu-id="3ef38-115">The names are registered in the Active Directory Domain Controller (DC) on the user or computer account object that the service instance will use to log on.</span></span> <span data-ttu-id="3ef38-116">Когда клиент запрашивает соединение со службой, он формирует имя участника-службы для экземпляра службы, используя известные данные или данные, предоставленные пользователем.</span><span class="sxs-lookup"><span data-stu-id="3ef38-116">When a client requests a connection to a service, it composes an SPN for a service instance, using known data or data provided by the user.</span></span> <span data-ttu-id="3ef38-117">Затем клиент использует пакет SSPI Negotiate, чтобы предоставить имя участника-службы центр распространения ключей (KDC) для учетной записи домена клиента.</span><span class="sxs-lookup"><span data-stu-id="3ef38-117">The client then uses the SSPI negotiate package to present the SPN to the Key Distribution Center (KDC) for the client domain account.</span></span> <span data-ttu-id="3ef38-118">KDC ищет в лесу учетную запись пользователя или компьютера, на котором зарегистрировано имя субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="3ef38-118">The KDC searches the forest for a user or computer account on which that SPN is registered.</span></span> <span data-ttu-id="3ef38-119">Если имя субъекта-службы зарегистрировано более чем в одной учетной записи, проверка подлинности завершается ошибкой.</span><span class="sxs-lookup"><span data-stu-id="3ef38-119">If the SPN is registered on more than one account, the authentication fails.</span></span> <span data-ttu-id="3ef38-120">В противном случае KDC шифрует сообщение, используя пароль учетной записи, в которой зарегистрировано имя субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="3ef38-120">Otherwise, the KDC encrypts a message using the password of the account on which the SPN was registered.</span></span> <span data-ttu-id="3ef38-121">KDC передает это зашифрованное сообщение клиенту, который, в свою очередь, передает его в экземпляр службы.</span><span class="sxs-lookup"><span data-stu-id="3ef38-121">The KDC passes this encrypted message to the client, which in turn passes it to the service instance.</span></span> <span data-ttu-id="3ef38-122">Служба использует пакет SSPI Negotiate для расшифровки сообщения, которое передается обратно клиенту и в KDC клиента.</span><span class="sxs-lookup"><span data-stu-id="3ef38-122">The service uses the SSPI negotiate package to decrypt the message, which it passes back to the client and on to the client's KDC.</span></span> <span data-ttu-id="3ef38-123">KDC проверяет подлинность службы, если расшифрованное сообщение соответствует его исходному сообщению.</span><span class="sxs-lookup"><span data-stu-id="3ef38-123">The KDC authenticates the service if the decrypted message matches its original message.</span></span>

-   <span data-ttu-id="3ef38-124">Дополнительные сведения о создании и регистрации имен участников-служб см. в разделе. [Имена субъектов-служб](service-principal-names.md)</span><span class="sxs-lookup"><span data-stu-id="3ef38-124">For more information about composing and registering SPNs, see .[Service Principal Names](service-principal-names.md)</span></span>
-   <span data-ttu-id="3ef38-125">Дополнительные сведения и пример кода, в котором создается имя участника-службы для службы Windows Sockets, которая публикует себя с точкой подключения службы, см. в разделе Создание [имен участников-служб для службы с SCP](composing-the-spns-for-a-service-with-an-scp.md).</span><span class="sxs-lookup"><span data-stu-id="3ef38-125">For more information and a code example that composes an SPN for a Windows Sockets service that publishes itself with a service connection point, see [Composing the SPNs for a Service with an SCP](composing-the-spns-for-a-service-with-an-scp.md).</span></span>
-   <span data-ttu-id="3ef38-126">Дополнительные сведения и пример кода, в котором создается имя субъекта-службы для сервиса RPC, см. в разделе Создание [имен участников](composing-spns-for-an-rpcns-service.md)-служб для службы рпкнс.</span><span class="sxs-lookup"><span data-stu-id="3ef38-126">For more information and a code example that composes an SPN for an RPC service, see [Composing SPNs for an RpcNs Service](composing-spns-for-an-rpcns-service.md).</span></span>

 

 




