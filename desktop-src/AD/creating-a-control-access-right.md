---
title: Создание права доступа к элементу управления
description: Чтобы добавить право управления доступом на сервер Active Directory, создайте объект Контролакцессригхт в контейнере Extended-Rights раздела конфигурации.
ms.assetid: dacd42c6-17d9-4dfe-8f51-e4a470766494
ms.tgt_platform: multiple
keywords:
- Создание элемента управления право доступа AD
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 11bdc764b09f0fe5bd165e87e23a89db7d368bfe
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "103789595"
---
# <a name="creating-a-control-access-right"></a><span data-ttu-id="90239-104">Создание права доступа к элементу управления</span><span class="sxs-lookup"><span data-stu-id="90239-104">Creating a Control Access Right</span></span>

<span data-ttu-id="90239-105">Чтобы добавить право управления доступом на сервер Active Directory, создайте объект [**контролакцессригхт**](/windows/desktop/ADSchema/c-controlaccessright) в контейнере Extended-Rights раздела конфигурации.</span><span class="sxs-lookup"><span data-stu-id="90239-105">To add a control access right to an Active Directory server, create a [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright) object in the Extended-Rights container of the Configuration partition.</span></span> <span data-ttu-id="90239-106">Дополнительные сведения и пример кода см. в разделе [пример кода для создания права доступа к управлению](example-code-for-creating-a-control-access-right.md).</span><span class="sxs-lookup"><span data-stu-id="90239-106">For more information and a code example, see [Example Code for Creating a Control Access Right](example-code-for-creating-a-control-access-right.md).</span></span> <span data-ttu-id="90239-107">Чтобы использовать право доступа Control, необходимо выполнить еще несколько действий в зависимости от того, является ли право доступа к элементу управления специальной операцией или набором свойств.</span><span class="sxs-lookup"><span data-stu-id="90239-107">To use the control access right, you must complete a few more steps, depending on whether the control access right is for a special operation or a property set.</span></span>

<span data-ttu-id="90239-108">Если вы определяете право доступа к элементу управления для набора свойств, используйте **ригхтсгуид** объекта [**контролакцессригхт**](/windows/desktop/ADSchema/c-controlaccessright) для определения свойств в наборе.</span><span class="sxs-lookup"><span data-stu-id="90239-108">If you define a control access right for a property set, use the **rightsGUID** of the [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright) object to identify the properties in the set.</span></span> <span data-ttu-id="90239-109">Каждое свойство определяется объектом [**attributeSchema**](/windows/desktop/ADSchema/c-attributeschema) в схеме Active Directory.</span><span class="sxs-lookup"><span data-stu-id="90239-109">Every property is defined by an [**attributeSchema**](/windows/desktop/ADSchema/c-attributeschema) object in the Active Directory schema.</span></span> <span data-ttu-id="90239-110">Свойство [**аттрибутесекуритигуид**](/windows/desktop/ADSchema/a-attributesecurityguid) объекта **attributeSchema** идентифицирует набор свойств (если таковое имеется), которому принадлежит свойство.</span><span class="sxs-lookup"><span data-stu-id="90239-110">The [**attributeSecurityGUID**](/windows/desktop/ADSchema/a-attributesecurityguid) property of an **attributeSchema** object identifies the property set, if any, that the property belongs to.</span></span> <span data-ttu-id="90239-111">Имейте в виду, что свойство **аттрибутесекуритигуид** является однозначным и сохраняет GUID в двоичном формате (синтаксис строки октета).</span><span class="sxs-lookup"><span data-stu-id="90239-111">Be aware that the **attributeSecurityGUID** property is single-valued and stores the GUID in binary format (octet string syntax).</span></span>

<span data-ttu-id="90239-112">Если вы определяете право доступа к элементу управления, чтобы ограничить доступ к определенной операции, приложение должно выполнить проверку доступа, когда пользователь попытается провести операцию.</span><span class="sxs-lookup"><span data-stu-id="90239-112">If you define a control access right to place restrictions on access to a particular operation, your application must perform the access check when a user attempts the operation.</span></span>

<span data-ttu-id="90239-113">**Настройка проверки доступа**</span><span class="sxs-lookup"><span data-stu-id="90239-113">**To set up access check**</span></span>

1.  <span data-ttu-id="90239-114">Создайте право доступа к управлению, определяющее тип доступа к приложению или службе.</span><span class="sxs-lookup"><span data-stu-id="90239-114">Create a control access right that defines the type of access to the application or service.</span></span> <span data-ttu-id="90239-115">Дополнительные сведения см. в следующем примере кода.</span><span class="sxs-lookup"><span data-stu-id="90239-115">For more information, see the following code example.</span></span>
2.  <span data-ttu-id="90239-116">Создайте объект домен Active Directory Services, представляющий приложение, службу или защищаемый ресурс.</span><span class="sxs-lookup"><span data-stu-id="90239-116">Create an Active Directory Domain Services object that represents the application, service, or resource that you are protecting.</span></span>
3.  <span data-ttu-id="90239-117">Добавьте ACE объекта в список DACL в дескрипторе безопасности объекта, чтобы предоставить или запретить пользователям или группам право доступа к этому объекту.</span><span class="sxs-lookup"><span data-stu-id="90239-117">Add object ACEs to the DACL in the object security descriptor to grant or deny users or groups the control access right on that object.</span></span> <span data-ttu-id="90239-118">Дополнительные сведения см. [в разделе Установка элемента управления право доступа ACE в ACL объекта](setting-a-control-access-right-ace-in-an-objectampaposs-acl.md).</span><span class="sxs-lookup"><span data-stu-id="90239-118">For more information, see [Setting a Control Access Right ACE in an Object's ACL](setting-a-control-access-right-ace-in-an-objectampaposs-acl.md).</span></span>
4.  <span data-ttu-id="90239-119">Когда пользователь пытается выполнить операцию, проверьте права пользователя, передав дескриптор безопасности объекта и маркер доступа пользователя в функцию [**акцессчеккбитипересултлист**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-accesscheckbytyperesultlist) .</span><span class="sxs-lookup"><span data-stu-id="90239-119">When a user attempts to perform the operation, verify the user rights by passing the object security descriptor and the user access token to the [**AccessCheckByTypeResultList**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-accesscheckbytyperesultlist) function.</span></span> <span data-ttu-id="90239-120">Дополнительные сведения см. [в разделе Проверка прав доступа к элементу управления в списке ACL объекта](checking-a-control-access-right-in-an-objectampaposs-acl.md).</span><span class="sxs-lookup"><span data-stu-id="90239-120">For more information, see [Checking a Control Access Right in an Object's ACL](checking-a-control-access-right-in-an-objectampaposs-acl.md).</span></span>

<span data-ttu-id="90239-121">В зависимости от результата проверки доступа к объекту приложение или служба могут разрешить или запретить пользователю доступ к приложению или службе.</span><span class="sxs-lookup"><span data-stu-id="90239-121">Based on the result of the access check on the object, the application or service can allow or deny the user access to the application or service.</span></span>

<span data-ttu-id="90239-122">При создании объекта [**контролакцессригхт**](/windows/desktop/ADSchema/c-controlaccessright) задайте атрибуты, перечисленные в следующей таблице, чтобы сделать объект допустимым правом доступа, распознаваемым службами домен Active Directory и системами безопасности Windows.</span><span class="sxs-lookup"><span data-stu-id="90239-122">When you create a [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright) object, set the attributes, listed in the following table, to make the object a legal control access right that is recognized by Active Directory Domain Services and the Windows security systems.</span></span>



| <span data-ttu-id="90239-123">attribute</span><span class="sxs-lookup"><span data-stu-id="90239-123">Attribute</span></span>                                     | <span data-ttu-id="90239-124">Описание</span><span class="sxs-lookup"><span data-stu-id="90239-124">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|-----------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="90239-125">**cn**</span><span class="sxs-lookup"><span data-stu-id="90239-125">**cn**</span></span>](/windows/desktop/ADSchema/a-cn)                       | <span data-ttu-id="90239-126">Однозначное свойство, которое является относительным различающимся именем объекта (RDN) в контейнере Extended-Rights.</span><span class="sxs-lookup"><span data-stu-id="90239-126">A single-valued property that is the object's relative distinguished name (RDN) in the Extended-Rights container.</span></span> <span data-ttu-id="90239-127">**CN** — это имя права доступа в домен Active Directory Services.</span><span class="sxs-lookup"><span data-stu-id="90239-127">The **cn** is the name of the access control right in Active Directory Domain Services.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| [<span data-ttu-id="90239-128">**appliesTo**</span><span class="sxs-lookup"><span data-stu-id="90239-128">**appliesTo**</span></span>](/windows/desktop/ADSchema/a-appliesto)         | <span data-ttu-id="90239-129">Многозначное свойство, содержащее список классов объектов, к которым применяется право на управление доступом.</span><span class="sxs-lookup"><span data-stu-id="90239-129">A multi-valued property that lists the object classes that the access control right applies to.</span></span> <span data-ttu-id="90239-130">Например, элемент управления доступом " [**Отправить как**](/windows/desktop/ADSchema/r-send-as) доступ" перечисляет классы [**пользовательских**](/windows/desktop/ADSchema/c-user) и [**компьютерных**](/windows/desktop/ADSchema/c-computer) объектов в свойстве **appliesTo** .</span><span class="sxs-lookup"><span data-stu-id="90239-130">For example, the [**Send-As**](/windows/desktop/ADSchema/r-send-as) access control right lists the [**user**](/windows/desktop/ADSchema/c-user) and [**computer**](/windows/desktop/ADSchema/c-computer) object classes in its **appliesTo** property.</span></span> <span data-ttu-id="90239-131">В списке каждый класс объекта определяется [**schemaIDGUID**](/windows/desktop/ADSchema/a-schemaidguid) объекта [**classSchema**](/windows/desktop/ADSchema/c-classschema) .</span><span class="sxs-lookup"><span data-stu-id="90239-131">In the list, each object class is identified by the [**schemaIDGUID**](/windows/desktop/ADSchema/a-schemaidguid) of its [**classSchema**](/windows/desktop/ADSchema/c-classschema) object.</span></span> <span data-ttu-id="90239-132">Идентификаторы GUID хранятся в виде строк в форме, созданной функцией [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) в библиотеке COM, но без начальной и завершающей фигурных скобок ({}).</span><span class="sxs-lookup"><span data-stu-id="90239-132">The GUIDs are stored as strings of the form produced by the [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) function in the COM library but without the starting and terminating braces ({ }).</span></span> <span data-ttu-id="90239-133">Например, следующий идентификатор GUID является **schemaIDGUID** для класса [**Computer**](/windows/desktop/ADSchema/c-computer) : bf967a86-0de6-11D0-a285-00aa003049e2.</span><span class="sxs-lookup"><span data-stu-id="90239-133">For example, the following GUID is the **schemaIDGUID** for the [**computer**](/windows/desktop/ADSchema/c-computer) class: bf967a86-0de6-11d0-a285-00aa003049e2.</span></span><br/> <span data-ttu-id="90239-134">Имейте в виду, что свойство [**schemaIDGUID**](/windows/desktop/ADSchema/a-schemaidguid) объекта [**classSchema**](/windows/desktop/ADSchema/c-classschema) хранится в виде двоичного идентификатора GUID с помощью синтаксиса строки октета.</span><span class="sxs-lookup"><span data-stu-id="90239-134">Be aware that the [**schemaIDGUID**](/windows/desktop/ADSchema/a-schemaidguid) property of a [**classSchema**](/windows/desktop/ADSchema/c-classschema) object is stored as a binary GUID using the octet string syntax.</span></span> <span data-ttu-id="90239-135">Чтобы преобразовать этот формат строки октета в формат строки, используемый в свойстве [**appliesTo**](/windows/desktop/ADSchema/a-appliesto) , используйте функцию [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) и Удалите фигурные скобки из возвращаемой строки.</span><span class="sxs-lookup"><span data-stu-id="90239-135">To convert this octet string format to the string format used in the [**appliesTo**](/windows/desktop/ADSchema/a-appliesto) property, use the [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) function and remove the braces from the returned string.</span></span><br/> <span data-ttu-id="90239-136">Дополнительные сведения о свойстве [**schemaIDGUID**](/windows/desktop/ADSchema/a-schemaidguid) одного из предопределенных классов объектов, таких как [**пользователь**](/windows/desktop/ADSchema/c-user) или [**компьютер**](/windows/desktop/ADSchema/c-computer), см. на странице справочника по классам в справочнике по схеме Active Directory в [справочнике по службам домен Active Directory](active-directory-domain-services-reference.md).</span><span class="sxs-lookup"><span data-stu-id="90239-136">For more information about the [**schemaIDGUID**](/windows/desktop/ADSchema/a-schemaidguid) property of one of the predefined object classes, such as [**user**](/windows/desktop/ADSchema/c-user) or [**computer**](/windows/desktop/ADSchema/c-computer), see the class reference page in the Active Directory Schema Reference in the [Active Directory Domain Services Reference](active-directory-domain-services-reference.md).</span></span> <span data-ttu-id="90239-137">Дополнительные сведения и пример кода, который извлекает **schemaIDGUID** из объекта classSchema, см. в разделе [чтение объектов attributeSchema и classSchema](reading-attributeschema-and-classschema-objects.md).</span><span class="sxs-lookup"><span data-stu-id="90239-137">For more information and a code example that retrieves a **schemaIDGUID** from a classSchema object, see [Reading attributeSchema and classSchema Objects](reading-attributeschema-and-classschema-objects.md).</span></span><br/> |
| [<span data-ttu-id="90239-138">**displayName**</span><span class="sxs-lookup"><span data-stu-id="90239-138">**displayName**</span></span>](/windows/desktop/ADSchema/a-displayname)     | <span data-ttu-id="90239-139">Строка, используемая для вывода прав на управление доступом в пользовательских интерфейсах, таких как страница свойств **Безопасность** и другие места в оснастке MMC "пользователи и компьютеры" Active Directory.</span><span class="sxs-lookup"><span data-stu-id="90239-139">The string used to display the access control right in user interfaces such as the **Security** property page and other places in the Active Directory Users and Computers MMC snap-in.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| [<span data-ttu-id="90239-140">**ригхтсгуид**</span><span class="sxs-lookup"><span data-stu-id="90239-140">**rightsGuid**</span></span>](/windows/desktop/ADSchema/a-rightsguid)       | <span data-ttu-id="90239-141">Идентификатор GUID, определяющий право доступа к элементу управления в записи ACE.</span><span class="sxs-lookup"><span data-stu-id="90239-141">A GUID that identifies the control access right in an ACE.</span></span> <span data-ttu-id="90239-142">Идентификатор GUID хранится в виде строки формы, созданной функцией [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) , но без начальной и завершающей фигурных скобок.</span><span class="sxs-lookup"><span data-stu-id="90239-142">The GUID is stored as a string of the form produced by the [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) function, but without the starting and terminating braces.</span></span> <span data-ttu-id="90239-143">Используйте Uuidgen.exe для другой служебной программы, чтобы создать идентификатор GUID для права доступа к элементу управления. При определении нового набора свойств используется [**ригхтсгуид**](/windows/desktop/ADSchema/a-rightsguid) объекта [**контролакцессригхт**](/windows/desktop/ADSchema/c-controlaccessright) для определения свойств в наборе.</span><span class="sxs-lookup"><span data-stu-id="90239-143">Use Uuidgen.exe for some other utility to generate a GUID for the control access right.If you define a new property set, you use the [**rightsGuid**](/windows/desktop/ADSchema/a-rightsguid) of the [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright) object to identify the properties in the set.</span></span> <span data-ttu-id="90239-144">Для каждого свойства в наборе свойств задайте значение [**аттрибутесекуритигуид**](/windows/desktop/ADSchema/a-attributesecurityguid) свойства равным значению **ригхтсгуид** набора свойств.</span><span class="sxs-lookup"><span data-stu-id="90239-144">For each property in the property set, set the property's [**attributeSecurityGUID**](/windows/desktop/ADSchema/a-attributesecurityguid) value to the value of the property set's **rightsGUID**.</span></span> <span data-ttu-id="90239-145">Значение свойства **аттрибутесекуритигуид** хранится в определении [**attributeSchema**](/windows/desktop/ADSchema/c-attributeschema) свойства в схеме Active Directory.</span><span class="sxs-lookup"><span data-stu-id="90239-145">A property's **attributeSecurityGUID** value is stored in the property's [**attributeSchema**](/windows/desktop/ADSchema/c-attributeschema) definition in the Active Directory schema.</span></span> <span data-ttu-id="90239-146">Свойство **аттрибутесекуритигуид** является однозначным и сохраняет GUID в двоичном формате (синтаксис строки октета).</span><span class="sxs-lookup"><span data-stu-id="90239-146">The **attributeSecurityGUID** property is single-valued and stores the GUID in binary format (octet string syntax).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| [<span data-ttu-id="90239-147">**Атрибута**</span><span class="sxs-lookup"><span data-stu-id="90239-147">**objectClass**</span></span>](/windows/desktop/ADSchema/a-objectclass)     | <span data-ttu-id="90239-148">Этот атрибут указывает [**контролакцессригхт**](/windows/desktop/ADSchema/c-controlaccessright) в качестве класса объекта.</span><span class="sxs-lookup"><span data-stu-id="90239-148">This attribute specifies [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright) as the object class.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| [<span data-ttu-id="90239-149">**валидакцессес**</span><span class="sxs-lookup"><span data-stu-id="90239-149">**validAccesses**</span></span>](/windows/desktop/ADSchema/a-validaccesses) | <span data-ttu-id="90239-150">Для наборов свойств присвойте этому атрибуту значение 0x30 (**ADS \_ справа \_ DS \_ Read \_ prop** Active Directory \| **\_ справа \_ DS \_ Write \_ prop**).</span><span class="sxs-lookup"><span data-stu-id="90239-150">For property sets, set this attribute to 0x30 (**ADS\_RIGHT\_DS\_READ\_PROP** \| **ADS\_RIGHT\_DS\_WRITE\_PROP**).</span></span> <span data-ttu-id="90239-151">Для прав доступа к управлению установите для этого атрибута значение 0x100 (**ADS \_ \_ Active Directory Rights \_ \_ Access Control**).</span><span class="sxs-lookup"><span data-stu-id="90239-151">For control access rights, set this attribute to 0x100 (**ADS\_RIGHT\_DS\_CONTROL\_ACCESS**).</span></span> <span data-ttu-id="90239-152">Страница свойств Безопасность распознает права доступа Control, только если для атрибута [**валидакцессес**](/windows/desktop/ADSchema/a-validaccesses) задано соответствующее значение.</span><span class="sxs-lookup"><span data-stu-id="90239-152">The security property page recognizes control access rights only if the [**validAccesses**](/windows/desktop/ADSchema/a-validaccesses) attribute is set to the appropriate value.</span></span> <span data-ttu-id="90239-153">Если значение равно нулю, право доступа к элементу управления игнорируется или не отображается на странице свойств безопасность.</span><span class="sxs-lookup"><span data-stu-id="90239-153">If zero, the control access right is ignored or not displayed by the security property page.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |



 

<span data-ttu-id="90239-154">Имейте в виду, что стандартные классы схемы используют атрибут **локализатиондисплайид** объекта [**контролакцессригхт**](/windows/desktop/ADSchema/c-controlaccessright) для указания идентификатора сообщения, используемого для получения локализованного отображаемого имени из Dssec.dll.</span><span class="sxs-lookup"><span data-stu-id="90239-154">Be aware that the predefined schema classes use the **localizationDisplayId** attribute of a [**controlAccessRight**](/windows/desktop/ADSchema/c-controlaccessright) object to specify a message identifier used to retrieve a localized display name from Dssec.dll.</span></span> <span data-ttu-id="90239-155">Не устанавливайте атрибут **локализатиондисплайид** при определении нового объекта **контролакцессригхт** .</span><span class="sxs-lookup"><span data-stu-id="90239-155">Do not set the **localizationDisplayId** attribute if you define a new **controlAccessRight** object.</span></span>

 

