---
title: Создание дескрипторов безопасности для новых объектов каталога
description: С помощью ADSI можно создать дескриптор безопасности и задать его в качестве свойства Нтсекуритидескриптор нового объекта или использовать его для замены свойства Нтсекуритидескриптор существующего объекта.
ms.assetid: b9ff626f-17f1-4fc1-9d6e-4f47e29a5aeb
ms.tgt_platform: multiple
keywords:
- Создание дескриптора безопасности для нового объекта каталога Active Directory
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78265d27c52023d669e27fc9890fd2d5273e2ffd
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "104487476"
---
# <a name="creating-security-descriptors-for-new-directory-objects"></a><span data-ttu-id="8a209-104">Создание дескрипторов безопасности для новых объектов каталога</span><span class="sxs-lookup"><span data-stu-id="8a209-104">Creating Security Descriptors for new directory objects</span></span>

<span data-ttu-id="8a209-105">С помощью ADSI можно создать дескриптор безопасности и задать его в качестве свойства **нтсекуритидескриптор** нового объекта или использовать его для замены свойства **нтсекуритидескриптор** существующего объекта.</span><span class="sxs-lookup"><span data-stu-id="8a209-105">You can use ADSI to create a security descriptor and set it as a new object's **nTSecurityDescriptor** property or use it to replace an existing object's **nTSecurityDescriptor** property.</span></span>

<span data-ttu-id="8a209-106">Чтобы создать дескриптор безопасности для объекта, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="8a209-106">To create a security descriptor for an object:</span></span>

1.  <span data-ttu-id="8a209-107">Используйте [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) для создания com-объекта ADSI для нового дескриптора безопасности и получения указателя интерфейса [**иадссекуритидескриптор**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) на этот объект.</span><span class="sxs-lookup"><span data-stu-id="8a209-107">Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the new security descriptor and get an [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) interface pointer to that object.</span></span> <span data-ttu-id="8a209-108">Имейте в виду, что ИДЕНТИФИКАТОРом класса является **CLSID \_ SecurityDescriptor**.</span><span class="sxs-lookup"><span data-stu-id="8a209-108">Be aware that the class ID is **CLSID\_SecurityDescriptor**.</span></span>
2.  <span data-ttu-id="8a209-109">Используйте метод [**иадссекуритидескриптор::p UT \_ owner**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) , чтобы задать владельца объекта.</span><span class="sxs-lookup"><span data-stu-id="8a209-109">Use the [**IADsSecurityDescriptor::put\_Owner**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the owner of the object.</span></span> <span data-ttu-id="8a209-110">Доверенное лицо — это пользователь, группа или другой субъект безопасности.</span><span class="sxs-lookup"><span data-stu-id="8a209-110">The trustee is a user, group, or other security principal.</span></span> <span data-ttu-id="8a209-111">Приложение должно использовать значение из соответствующего свойства из объекта пользователя или группы доверенного лица, к которому применяется ACE.</span><span class="sxs-lookup"><span data-stu-id="8a209-111">An application should use the value from the appropriate property from the user or group object of the trustee to which to apply the ACE.</span></span>
3.  <span data-ttu-id="8a209-112">Используйте метод [**\_ управления иадссекуритидескриптор::p UT**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) для управления наследованием DACL и SACL объектом из родительского контейнера.</span><span class="sxs-lookup"><span data-stu-id="8a209-112">Use the [**IADsSecurityDescriptor::put\_Control**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to control whether DACLs and SACLs are inherited by the object from its parent container.</span></span>
4.  <span data-ttu-id="8a209-113">Используйте [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) для создания com-объекта ADSI для списка DACL для нового дескриптора безопасности и получения указателя интерфейса [**иадсакцессконтроллист**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) на этот объект.</span><span class="sxs-lookup"><span data-stu-id="8a209-113">Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the DACL for the new security descriptor and get an [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) interface pointer to that object.</span></span> <span data-ttu-id="8a209-114">Имейте в виду, что ИДЕНТИФИКАТОРом класса является **CLSID \_ акцессконтроллист**.</span><span class="sxs-lookup"><span data-stu-id="8a209-114">Be aware that the class ID is **CLSID\_AccessControlList**.</span></span>
5.  <span data-ttu-id="8a209-115">Для каждого элемента ACE, добавляемого в список DACL, используйте [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) для создания com-объекта ADSI для нового элемента ACE и получения указателя интерфейса [**иадсакцессконтролентри**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) на этот объект.</span><span class="sxs-lookup"><span data-stu-id="8a209-115">For each ACE to add to the DACL, use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the new ACE and get an [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) interface pointer to that object.</span></span> <span data-ttu-id="8a209-116">Имейте в виду, что ИДЕНТИФИКАТОРом класса является CLSID \_ акцессконтролентри.</span><span class="sxs-lookup"><span data-stu-id="8a209-116">Be aware that the class ID is CLSID\_AccessControlEntry.</span></span>
6.  <span data-ttu-id="8a209-117">Для каждого элемента ACE, добавляемого в список DACL, задайте свойства элемента управления доступом с помощью методов свойств объекта [**ИАДСАКЦЕССКОНТРОЛЕНТРИ**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) ACE.</span><span class="sxs-lookup"><span data-stu-id="8a209-117">For each ACE to add to the DACL, set the properties of the ACE using the property methods of the ACE's [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) object.</span></span> <span data-ttu-id="8a209-118">Дополнительные сведения о свойствах, которые необходимо задать для записи ACE, см. [в разделе Установка прав доступа для объекта](setting-access-rights-on-an-object.md).</span><span class="sxs-lookup"><span data-stu-id="8a209-118">For more information about the properties to set on an ACE, see [Setting Access Rights on an Object](setting-access-rights-on-an-object.md).</span></span>
7.  <span data-ttu-id="8a209-119">Для каждого элемента ACE, добавляемого в список DACL, используйте метод **QueryInterface** объекта [**иадсакцессконтролентри**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) для получения указателя [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="8a209-119">For each ACE to add to the DACL, use the **QueryInterface** method on the [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) object to get an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="8a209-120">Для метода [**иадсакцессконтроллист:: аддаце**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) требуется указатель интерфейса **IDispatch** на элемент управления доступом.</span><span class="sxs-lookup"><span data-stu-id="8a209-120">The [**IADsAccessControlList::AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) method requires an **IDispatch** interface pointer to the ACE.</span></span>
8.  <span data-ttu-id="8a209-121">Для каждого элемента ACE, добавляемого в список DACL, используйте [**иадсакцессконтроллист:: аддаце**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) , чтобы добавить новый элемент управления доступом в список DACL.</span><span class="sxs-lookup"><span data-stu-id="8a209-121">For each ACE to add to the DACL, use [**IADsAccessControlList::AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) to add the new ACE to the DACL.</span></span> <span data-ttu-id="8a209-122">Имейте в виду, что порядок элементов ACE в списке ACL может повлиять на оценку доступа к объекту.</span><span class="sxs-lookup"><span data-stu-id="8a209-122">Be aware that the order of the ACEs within the ACL can affect the evaluation of access to the object.</span></span> <span data-ttu-id="8a209-123">Для правильного доступа к объекту может потребоваться создать новый список ACL, добавить записи ACE из существующего списка ACL в правильном порядке в новый список управления доступом, а затем заменить существующий список ACL в дескрипторе безопасности новым ACL.</span><span class="sxs-lookup"><span data-stu-id="8a209-123">The correct access to the object may require you to create a new ACL, add the ACEs from the existing ACL in the correct order to the new ACL, and then replace the existing ACL in the security descriptor with the new ACL.</span></span> <span data-ttu-id="8a209-124">Дополнительные сведения см. [в разделе порядок элементов ACE в списке DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).</span><span class="sxs-lookup"><span data-stu-id="8a209-124">For more information, see [Order of ACEs in a DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).</span></span>
9.  <span data-ttu-id="8a209-125">Выполните шаги 4-8, чтобы создать список SACL для нового дескриптора безопасности.</span><span class="sxs-lookup"><span data-stu-id="8a209-125">Follow Steps 4-8 to create the SACL for the new security descriptor.</span></span>
10. <span data-ttu-id="8a209-126">Чтобы задать список DACL, используйте метод [**иадссекуритидескриптор::p UT \_ дискретионарякл**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) .</span><span class="sxs-lookup"><span data-stu-id="8a209-126">Use the [**IADsSecurityDescriptor::put\_DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the DACL.</span></span> <span data-ttu-id="8a209-127">Дополнительные сведения о списках DACL см. в разделе пустые [списки DACL и пустой список DACL](null-dacls-and-empty-dacls.md).</span><span class="sxs-lookup"><span data-stu-id="8a209-127">For more information about DACLs, see [Null DACLs and Empty DACLs](null-dacls-and-empty-dacls.md).</span></span>
11. <span data-ttu-id="8a209-128">Чтобы задать список SACL, используйте метод [**иадссекуритидескриптор::p UT \_ системакл**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) .</span><span class="sxs-lookup"><span data-stu-id="8a209-128">Use the [**IADsSecurityDescriptor::put\_SystemAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the SACL.</span></span>
12. <span data-ttu-id="8a209-129">Преобразуйте объект [**иадссекуритидескриптор**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) в [**Variant**](/windows/win32/api/oaidl/ns-oaidl-variant) с помощью метода **QueryInterface** объекта **иадссекуритидескриптор** , чтобы получить интерфейс [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="8a209-129">Convert the [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) object to a [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant) by using the **QueryInterface** method of the **IADsSecurityDescriptor** object to obtain an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) interface.</span></span> <span data-ttu-id="8a209-130">Затем **установите для элемента** **VT** в качестве значения **VT \_ Dispatch** и задайте для элемента **пдиспвал** объекта **Variant** значение, равное указателю **IDispatch** .</span><span class="sxs-lookup"><span data-stu-id="8a209-130">Then set the **vt** member of the **VARIANT** to **VT\_DISPATCH** and set the **pdispVal** member of the **VARIANT** equal to the **IDispatch** pointer.</span></span>
13. <span data-ttu-id="8a209-131">Получите указатель интерфейса [**iAds**](/windows/desktop/api/iads/nn-iads-iads) для объекта.</span><span class="sxs-lookup"><span data-stu-id="8a209-131">Obtain an [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface pointer to the object.</span></span>
14. <span data-ttu-id="8a209-132">Используйте метод [**iAds::P UT**](/windows/desktop/api/iads/nf-iads-iads-put) с параметром "нтсекуритидескриптор" и [**вариантом**](/windows/win32/api/oaidl/ns-oaidl-variant) , созданным выше, чтобы записать новый дескриптор безопасности в кэш свойств.</span><span class="sxs-lookup"><span data-stu-id="8a209-132">Use the [**IADs::Put**](/windows/desktop/api/iads/nf-iads-iads-put) method with "nTSecurityDescriptor" and the [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant) created above to write the new security descriptor to the property cache.</span></span>
15. <span data-ttu-id="8a209-133">Используйте метод [**iAds:: сетинфо**](/windows/desktop/api/iads/nf-iads-iads-setinfo) , чтобы обновить свойство объекта в каталоге.</span><span class="sxs-lookup"><span data-stu-id="8a209-133">Use the [**IADs::SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) method to update the property on the object in the directory.</span></span>

 

 