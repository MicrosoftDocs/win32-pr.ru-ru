---
title: Функции службы каталогов (AD DS)
description: Функции службы каталогов предоставляют служебную программу для поиска контроллера домена в домене Windows NT или Windows 2000.
ms.assetid: 7b519c81-5a6c-470a-a525-1894efd53305
ms.tgt_platform: multiple
keywords:
- Функции службы каталогов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 75b071128806926e07cf61d62e53b823d8e7e1ac
ms.sourcegitcommit: 8ea1a82717bd3dbb3457be0697329aa37fb13f08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2019
ms.locfileid: "104069459"
---
# <a name="directory-service-functions-ad-ds"></a><span data-ttu-id="a0a2a-104">Функции службы каталогов (AD DS)</span><span class="sxs-lookup"><span data-stu-id="a0a2a-104">Directory Service Functions (AD DS)</span></span>

<span data-ttu-id="a0a2a-105">Функции службы каталогов предоставляют служебную программу для поиска контроллера домена в домене Windows NT или Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-105">The directory service functions provide a utility for locating a domain controller (DC) in a Windows NT or Windows 2000 domain.</span></span> <span data-ttu-id="a0a2a-106">Архитектура взаимодействует с клиентами, а также с серверами во всех версиях Windows NT и Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-106">The architecture interacts with clients as well as servers in all versions of Windows NT and Windows 2000.</span></span> <span data-ttu-id="a0a2a-107">Следующие функции позволяют разработчикам работать с контроллером домена и членством в домене в службе каталогов:</span><span class="sxs-lookup"><span data-stu-id="a0a2a-107">The following functions enable developers to work with the domain controller and domain membership in the directory service:</span></span>

-   [<span data-ttu-id="a0a2a-108">**дсаддресстоситенамес**</span><span class="sxs-lookup"><span data-stu-id="a0a2a-108">**DsAddressToSiteNames**</span></span>](/windows/desktop/api/Dsgetdc/nf-dsgetdc-dsaddresstositenamesa)
-   [<span data-ttu-id="a0a2a-109">**дсаддресстоситенамесекс**</span><span class="sxs-lookup"><span data-stu-id="a0a2a-109">**DsAddressToSiteNamesEx**</span></span>](/windows/desktop/api/Dsgetdc/nf-dsgetdc-dsaddresstositenamesexa)
-   [<span data-ttu-id="a0a2a-110">**дсдерегистердншострекордс**</span><span class="sxs-lookup"><span data-stu-id="a0a2a-110">**DsDeregisterDnsHostRecords**</span></span>](/windows/desktop/api/Dsgetdc/nf-dsgetdc-dsderegisterdnshostrecordsa)
-   [<span data-ttu-id="a0a2a-111">**дсенумератедомаинтрустс**</span><span class="sxs-lookup"><span data-stu-id="a0a2a-111">**DsEnumerateDomainTrusts**</span></span>](/windows/desktop/api/Dsgetdc/nf-dsgetdc-dsenumeratedomaintrustsa)
-   [<span data-ttu-id="a0a2a-112">**дсжетдкклосе**</span><span class="sxs-lookup"><span data-stu-id="a0a2a-112">**DsGetDcClose**</span></span>](/windows/desktop/api/Dsgetdc/nf-dsgetdc-dsgetdcclosew)
-   [<span data-ttu-id="a0a2a-113">**Процедуру**</span><span class="sxs-lookup"><span data-stu-id="a0a2a-113">**DsGetDcName**</span></span>](/windows/desktop/api/DsGetDC/nf-dsgetdc-dsgetdcnamea)
-   [<span data-ttu-id="a0a2a-114">**дсжетдкнекст**</span><span class="sxs-lookup"><span data-stu-id="a0a2a-114">**DsGetDcNext**</span></span>](/windows/desktop/api/Dsgetdc/nf-dsgetdc-dsgetdcnexta)
-   [<span data-ttu-id="a0a2a-115">**дсжетдкопен**</span><span class="sxs-lookup"><span data-stu-id="a0a2a-115">**DsGetDcOpen**</span></span>](/windows/desktop/api/Dsgetdc/nf-dsgetdc-dsgetdcopena)
-   [<span data-ttu-id="a0a2a-116">**дсжетдкситековераже**</span><span class="sxs-lookup"><span data-stu-id="a0a2a-116">**DsGetDcSiteCoverage**</span></span>](/windows/desktop/api/Dsgetdc/nf-dsgetdc-dsgetdcsitecoveragea)
-   [<span data-ttu-id="a0a2a-117">**дсжетфоресттрустинформатионв**</span><span class="sxs-lookup"><span data-stu-id="a0a2a-117">**DsGetForestTrustInformationW**</span></span>](/windows/desktop/api/Dsgetdc/nf-dsgetdc-dsgetforesttrustinformationw)
-   [<span data-ttu-id="a0a2a-118">**дсжетситенаме**</span><span class="sxs-lookup"><span data-stu-id="a0a2a-118">**DsGetSiteName**</span></span>](/windows/desktop/api/Dsgetdc/nf-dsgetdc-dsgetsitenamea)
-   [<span data-ttu-id="a0a2a-119">**дсмержефоресттрустинформатионв**</span><span class="sxs-lookup"><span data-stu-id="a0a2a-119">**DsMergeForestTrustInformationW**</span></span>](/windows/desktop/api/Dsgetdc/nf-dsgetdc-dsmergeforesttrustinformationw)
-   [<span data-ttu-id="a0a2a-120">**дсролефримемори**</span><span class="sxs-lookup"><span data-stu-id="a0a2a-120">**DsRoleFreeMemory**</span></span>](/windows/desktop/api/Dsrole/nf-dsrole-dsrolefreememory)
-   [<span data-ttu-id="a0a2a-121">**дсролежетпримаридомаининформатион**</span><span class="sxs-lookup"><span data-stu-id="a0a2a-121">**DsRoleGetPrimaryDomainInformation**</span></span>](/windows/desktop/api/Dsrole/nf-dsrole-dsrolegetprimarydomaininformation)
-   [<span data-ttu-id="a0a2a-122">**дсвалидатесубнетнаме**</span><span class="sxs-lookup"><span data-stu-id="a0a2a-122">**DsValidateSubnetName**</span></span>](/windows/desktop/api/Dsgetdc/nf-dsgetdc-dsvalidatesubnetnamea)

<span data-ttu-id="a0a2a-123">Указатель контроллера домена ( [**DsGetDcName**](/windows/desktop/api/DsGetDC/nf-dsgetdc-dsgetdcnamea)) реализуется службой Netlogon.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-123">The DC locator, [**DsGetDcName**](/windows/desktop/api/DsGetDC/nf-dsgetdc-dsgetdcnamea), is implemented by the Netlogon service.</span></span> <span data-ttu-id="a0a2a-124">Каждый контроллер домена регистрирует свое имя DNS на DNS-сервере и его NetBIOS-имя с помощью механизма, зависящего от транспорта, например, в службе WINS.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-124">Each DC registers its DNS name on the DNS server and its NetBIOS name using a transport-specific mechanism, for example, in WINS.</span></span> <span data-ttu-id="a0a2a-125">Локатор контроллера домена находит имя, затем отправляет датаграмму или проверку связи с контроллером домена, который зарегистрировал имя.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-125">The DC locator looks up the name, then sends a datagram to, or pings, the DC that registered the name.</span></span> <span data-ttu-id="a0a2a-126">Для NetBIOS-имен доменов датаграмма является сообщением в слоте.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-126">For NetBIOS domain names, the datagram is a mailslot message.</span></span> <span data-ttu-id="a0a2a-127">Для доменных имен DNS датаграмма — это поиск по протоколу LDAP.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-127">For DNS domain names, the datagram is an LDAP UDP search.</span></span> <span data-ttu-id="a0a2a-128">Каждый такой контроллер отвечает, указывая, что в настоящее время работает.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-128">Each such DC responds indicating that it is currently operational.</span></span> <span data-ttu-id="a0a2a-129">Первый отвечающий контроллер домена возвращается вызывающему объекту.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-129">The first DC to respond is returned to the caller.</span></span>

<span data-ttu-id="a0a2a-130">Возвращенный контроллер домена кэшируется, поэтому последующим вызывающим объектам не нужно повторять предыдущий алгоритм и, чтобы все вызывающие объекты использовали тот же контроллер домена.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-130">The returned DC is cached, so that subsequent callers need not repeat the preceding algorithm, and to encourage all callers to use that same DC.</span></span> <span data-ttu-id="a0a2a-131">Это гарантирует, что один клиент будет иметь единообразное представление содержимого контроллера домена.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-131">This ensures that a single client has a consistent view of the contents of the DC.</span></span>

<span data-ttu-id="a0a2a-132">При поиске контроллера домена по доменному имени DNS локатор контроллера домена пытается найти контроллер домена на "ближайшем" сайте.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-132">When searching for a DC by DNS domain name, the DC locator attempts to find a DC in the "closest" site.</span></span> <span data-ttu-id="a0a2a-133">Каждый контроллер домена регистрирует дополнительные записи DNS, указывающие, какой сайт входит в состав контроллера домена и какие сайты он включает.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-133">Each DC registers additional DNS records indicating what site that the DC is in and what sites the DC includes.</span></span> <span data-ttu-id="a0a2a-134">Локатор контроллера домена сначала ищет эту запись DNS для конкретного сайта перед поиском записи DNS, не относящейся к конкретному сайту, тем самым предоставляя контроллер домена на этом сайте.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-134">The DC locator first searches for this site-specific DNS record before searching for the DNS record that is not site-specific, thus preferring a DC in that site.</span></span> <span data-ttu-id="a0a2a-135">Когда локатор контроллера домена отправляет датаграмму на контроллер домена, контроллер домена ищет IP-адрес клиента в контейнере Configuration/Sites/Subnet в DS для поиска объекта подсети.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-135">When the DC locator sends a datagram to the DC, the DC looks up the IP address of the client in the Configuration/Sites/Subnet container of the DS to find a subnet object.</span></span> <span data-ttu-id="a0a2a-136">Свойство **ситеобжект** объекта Subnet определяет имя сайта, содержащего клиент.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-136">The **siteObject** property of the subnet object defines the name of the site that contains the client.</span></span> <span data-ttu-id="a0a2a-137">Контроллер домена отвечает на запрос проверки связи с именем сайта, содержащего клиент, а также указывает, охватывает ли контроллер домена этот сайт.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-137">The DC responds to the ping with the name of the site that contains the client, along with an indicator of whether this DC covers that site.</span></span> <span data-ttu-id="a0a2a-138">Если контроллер домена не включает этот сайт и локатор контроллеров домена еще не пытался найти контроллер домена на этом сайте, локатор контроллера домена пытается выполнить поиск контроллера домена на сайте.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-138">If the DC does not include that site and the DC locator has not yet attempted to find a DC in that site, the DC locator tries again to find a DC in the site.</span></span>

<span data-ttu-id="a0a2a-139">Чтобы найти имя сайта, содержащего клиент, используйте функцию [**дсжетситенаме**](/windows/desktop/api/Dsgetdc/nf-dsgetdc-dsgetsitenamea) .</span><span class="sxs-lookup"><span data-stu-id="a0a2a-139">To find the name of the site containing the client, use the [**DsGetSiteName**](/windows/desktop/api/Dsgetdc/nf-dsgetdc-dsgetsitenamea) function.</span></span> <span data-ttu-id="a0a2a-140">Имена объектов в контейнере Configuration/Sites/Subnet должны быть допустимыми именами подсетей.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-140">The names of the objects in the Configuration/Sites/Subnet container must be valid subnet names.</span></span> <span data-ttu-id="a0a2a-141">Функция [**дсвалидатесубнетнаме**](/windows/desktop/api/Dsgetdc/nf-dsgetdc-dsvalidatesubnetnamea) указывает, является ли указанное имя подсети допустимым.</span><span class="sxs-lookup"><span data-stu-id="a0a2a-141">The [**DsValidateSubnetName**](/windows/desktop/api/Dsgetdc/nf-dsgetdc-dsvalidatesubnetnamea) function indicates whether a specified subnet name is valid.</span></span>

 

 




