---
title: Чтение набора прав доступа к элементу управления в ACL объекта
description: Свойства интерфейса Иадсакцессконтролентри используются для предоставления или запрета прав на управление доступом.
ms.assetid: 2c6fef91-990e-4954-9aff-c9ec72d13972
ms.tgt_platform: multiple
keywords:
- Чтение набора прав доступа к элементу управления, заданного в списке ACL объекта Active Directory
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4877c96a95fc94095c79ad129e8a07b1c786abe1
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "104069755"
---
# <a name="reading-a-control-access-right-set-in-an-objects-acl"></a><span data-ttu-id="02a0a-104">Чтение набора прав доступа к элементу управления в ACL объекта</span><span class="sxs-lookup"><span data-stu-id="02a0a-104">Reading a Control Access Right Set in an Object's ACL</span></span>

<span data-ttu-id="02a0a-105">С помощью ADSI вы читаете элемент управления ACE Right, как и любой другой элемент ACE в списке ACL.</span><span class="sxs-lookup"><span data-stu-id="02a0a-105">Using ADSI, you read a control access right ACE just as you would any other ACE in an ACL.</span></span> <span data-ttu-id="02a0a-106">Имейте в виду, что для чтения списков управления доступом к объектам каталога можно также использовать API-интерфейсы безопасности Win32.</span><span class="sxs-lookup"><span data-stu-id="02a0a-106">Be aware that you can also use the Win32 security APIs to read ACLs on directory objects.</span></span> <span data-ttu-id="02a0a-107">Однако права доступа управления используют свойства интерфейса [**иадсакцессконтролентри**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) так, как это характерно для предоставления и запрета прав на доступ к управлению:</span><span class="sxs-lookup"><span data-stu-id="02a0a-107">However, control access rights use the properties of the [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) interface in a manner that is specific to granting and denying control access rights:</span></span>

-   <span data-ttu-id="02a0a-108">[**AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) должен содержать **рекламу \_ с \_ правом \_ \_ доступа к DS**.</span><span class="sxs-lookup"><span data-stu-id="02a0a-108">[**AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) must contain **ADS\_RIGHT\_DS\_CONTROL\_ACCESS**.</span></span>
-   <span data-ttu-id="02a0a-109">Значение [**флагов**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) имеет **\_ \_ тип объекта \_ \_ флага ADS**.</span><span class="sxs-lookup"><span data-stu-id="02a0a-109">[**Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) value is **ADS\_FLAG\_OBJECT\_TYPE\_PRESENT**.</span></span>
-   <span data-ttu-id="02a0a-110">[**ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) — это строковый формат атрибута **ригхтсгуид** права доступа к элементу управления.</span><span class="sxs-lookup"><span data-stu-id="02a0a-110">[**ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) is the string form of the **rightsGUID** attribute of the control access right.</span></span> <span data-ttu-id="02a0a-111">Строковый формат GUID имеет тот же формат строки, что и функция библиотеки COM [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) .</span><span class="sxs-lookup"><span data-stu-id="02a0a-111">The string format of the GUID is the same string format as the [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) COM Library function.</span></span>
-   <span data-ttu-id="02a0a-112">[**AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) — это **рекламное объявление \_ AceType \_ Access \_ Allowed \_ Object** , чтобы предоставить доверенному лицу доступ к элементу управления право доступа или **ADS \_ AceType \_ доступ \_ запрещен \_** , чтобы запретить доверенному лицу право доступа к элементу управления.</span><span class="sxs-lookup"><span data-stu-id="02a0a-112">[**AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) is either **ADS\_ACETYPE\_ACCESS\_ALLOWED\_OBJECT** to grant the trustee the control access right or **ADS\_ACETYPE\_ACCESS\_DENIED\_OBJECT** to deny the trustee the control access right.</span></span>
-   <span data-ttu-id="02a0a-113">[**Доверенное лицо**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) — это субъект безопасности; Это пользователь, группа, компьютер и т. д., к которым применяется ACE.</span><span class="sxs-lookup"><span data-stu-id="02a0a-113">[**Trustee**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) is the security principal; that is the user, group, computer, and so on, to which the ACE applies.</span></span>

<span data-ttu-id="02a0a-114">Используйте следующую процедуру, чтобы прочитать ACE для объекта ADSI.</span><span class="sxs-lookup"><span data-stu-id="02a0a-114">Use the following procedure to read an ACE for an ADSI object.</span></span> <span data-ttu-id="02a0a-115">Следующая процедура применима к приложениям C и C++.</span><span class="sxs-lookup"><span data-stu-id="02a0a-115">The following procedure applies to C and C++ applications.</span></span>

<span data-ttu-id="02a0a-116">**Чтение ACE для объекта ADSI**</span><span class="sxs-lookup"><span data-stu-id="02a0a-116">**To read an ACE for an ADSI object**</span></span>

1.  <span data-ttu-id="02a0a-117">Получите указатель интерфейса [**iAds**](/windows/desktop/api/iads/nn-iads-iads) для объекта.</span><span class="sxs-lookup"><span data-stu-id="02a0a-117">Get an [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface pointer to the object.</span></span>
2.  <span data-ttu-id="02a0a-118">Чтобы получить дескриптор безопасности объекта, используйте метод [**iAds:: Get**](/windows/desktop/api/iads/nf-iads-iads-get) .</span><span class="sxs-lookup"><span data-stu-id="02a0a-118">Use the [**IADs::Get**](/windows/desktop/api/iads/nf-iads-iads-get) method to get the security descriptor of the object.</span></span> <span data-ttu-id="02a0a-119">Имя свойства, содержащего дескриптор безопасности, — "Нтсекуритидескриптор".</span><span class="sxs-lookup"><span data-stu-id="02a0a-119">The name of the property that contains the security descriptor is "nTSecurityDescriptor".</span></span> <span data-ttu-id="02a0a-120">Свойство будет возвращено как **значение типа Variant** , содержащее указатель [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="02a0a-120">The property will be returned as a **VARIANT** that contains an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="02a0a-121">Имейте в виду, что элемент **VT** является компонентом **VT \_ Dispatch**.</span><span class="sxs-lookup"><span data-stu-id="02a0a-121">Be aware that the **vt** member is **VT\_DISPATCH**.</span></span> <span data-ttu-id="02a0a-122">Вызовите **QueryInterface** на этом указателе **IDispatch** , чтобы получить интерфейс [**иадссекуритидескриптор**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) , чтобы использовать методы этого интерфейса для доступа к ACL дескриптора безопасности.</span><span class="sxs-lookup"><span data-stu-id="02a0a-122">Call **QueryInterface** on that **IDispatch** pointer to get an [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) interface to use the methods on that interface to access the security descriptor ACL.</span></span>
3.  <span data-ttu-id="02a0a-123">Используйте метод [**иадссекуритидескриптор:: Get \_ дискретионарякл**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) для получения списка ACL.</span><span class="sxs-lookup"><span data-stu-id="02a0a-123">Use the [**IADsSecurityDescriptor::get\_DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to get the ACL.</span></span> <span data-ttu-id="02a0a-124">Метод возвращает указатель [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="02a0a-124">The method returns an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="02a0a-125">Вызовите метод **QueryInterface** для этого указателя **IDispatch** , чтобы получить интерфейс [**иадсакцессконтроллист**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) , чтобы использовать методы этого интерфейса для доступа к отдельным записям ACE в списке управления доступом.</span><span class="sxs-lookup"><span data-stu-id="02a0a-125">Call **QueryInterface** on that **IDispatch** pointer to get an [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) interface to use the methods on that interface to access the individual ACEs in the ACL.</span></span>
4.  <span data-ttu-id="02a0a-126">Используйте метод [**иадсакцессконтроллист:: Get \_ \_ NewEnum**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-get__newenum) для перечисления записей ACE.</span><span class="sxs-lookup"><span data-stu-id="02a0a-126">Use the [**IADsAccessControlList::get\_\_NewEnum**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-get__newenum) method to enumerate the ACEs.</span></span> <span data-ttu-id="02a0a-127">Метод возвращает указатель [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) .</span><span class="sxs-lookup"><span data-stu-id="02a0a-127">The method returns an [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer.</span></span> <span data-ttu-id="02a0a-128">Вызовите **QueryInterface** на этом указателе **IUnknown** , чтобы получить интерфейс [**IEnumVARIANT**](/windows/win32/api/oaidl/nn-oaidl-ienumvariant) .</span><span class="sxs-lookup"><span data-stu-id="02a0a-128">Call **QueryInterface** on that **IUnknown** pointer to get an [**IEnumVARIANT**](/windows/win32/api/oaidl/nn-oaidl-ienumvariant) interface.</span></span>
5.  <span data-ttu-id="02a0a-129">Используйте метод [**IEnumVARIANT:: Next**](/windows/win32/api/oaidl/nf-oaidl-ienumvariant-next) для перечисления записей ACE в списке ACL.</span><span class="sxs-lookup"><span data-stu-id="02a0a-129">Use the [**IEnumVARIANT::Next**](/windows/win32/api/oaidl/nf-oaidl-ienumvariant-next) method to enumerate the ACEs in the ACL.</span></span> <span data-ttu-id="02a0a-130">Свойство возвращается как **значение типа Variant** , содержащее указатель [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="02a0a-130">The property is returned as a **VARIANT** that contains an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="02a0a-131">Имейте в виду, что элемент **VT** является компонентом **VT \_ Dispatch**.</span><span class="sxs-lookup"><span data-stu-id="02a0a-131">Be aware that the **vt** member is **VT\_DISPATCH**.</span></span> <span data-ttu-id="02a0a-132">Вызовите метод **QueryInterface** для этого указателя **IDispatch** , чтобы получить интерфейс [**иадсакцессконтролентри**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) для чтения элемента управления доступом.</span><span class="sxs-lookup"><span data-stu-id="02a0a-132">Call **QueryInterface** on that **IDispatch** pointer to get an [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) interface to read the ACE.</span></span>
6.  <span data-ttu-id="02a0a-133">Вызовите [**метод иадсакцессконтролентри:: \_ Get AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) для получения значения **AccessMask** и убедитесь, что значение **AccessMask** для флага **\_ \_ \_ \_ доступа к AD DS right** .</span><span class="sxs-lookup"><span data-stu-id="02a0a-133">Call the [**IADsAccessControlEntry::get\_AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) method to get the **AccessMask** and verify that the **AccessMask** value for the **ADS\_RIGHT\_DS\_CONTROL\_ACCESS** flag.</span></span> <span data-ttu-id="02a0a-134">Если у него есть этот флаг, ACE содержит право доступа к элементу управления.</span><span class="sxs-lookup"><span data-stu-id="02a0a-134">If it has this flag, the ACE contains a control access right.</span></span>
7.  <span data-ttu-id="02a0a-135">Вызовите метод [**иадсакцессконтролентри:: Get \_ flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) , чтобы получить флаг для типа объекта.</span><span class="sxs-lookup"><span data-stu-id="02a0a-135">Call the [**IADsAccessControlEntry::get\_Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) method to get the flag for the object type.</span></span>
8.  <span data-ttu-id="02a0a-136">Флаг [**проверки значения флагов**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) для **\_ типа объекта флага объявлений \_ \_ \_ Present** .</span><span class="sxs-lookup"><span data-stu-id="02a0a-136">Check [**Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) value for **ADS\_FLAG\_OBJECT\_TYPE\_PRESENT** flag.</span></span> <span data-ttu-id="02a0a-137">Если для **флагов** задано значение **\_ \_ \_ тип объекта \_ флага ADS**, вызовите метод **иадсакцессконтролентри:: Get \_ ObjectType** , чтобы получить строку, содержащую ригхтсгуид элемента управления, к которому применяется ACE.</span><span class="sxs-lookup"><span data-stu-id="02a0a-137">If **Flags** is set to **ADS\_FLAG\_OBJECT\_TYPE\_PRESENT**, call the **IADsAccessControlEntry::get\_ObjectType** method to get a string that contains the rightsGUID of the control access right that the ACE applies to.</span></span>
9.  <span data-ttu-id="02a0a-138">Вызовите метод [**иадсакцессконтролентри:: Get \_ AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) , чтобы получить тип ACE.</span><span class="sxs-lookup"><span data-stu-id="02a0a-138">Call the [**IADsAccessControlEntry::get\_AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) method to get the ACE type.</span></span> <span data-ttu-id="02a0a-139">Тип будет представлять собой **баннер \_ ACETYPE \_ Access \_ Allowed \_ Object** , чтобы предоставить доверенному лицу доступ к объекту Control право доступа или **AD \_ ACETYPE \_ \_ Denied \_** для запрета права доступа к элементу управления.</span><span class="sxs-lookup"><span data-stu-id="02a0a-139">The type will be an **ADS\_ACETYPE\_ACCESS\_ALLOWED\_OBJECT** to grant the trustee the control access right or **ADS\_ACETYPE\_ACCESS\_DENIED\_OBJECT** to deny the control access right.</span></span>
10. <span data-ttu-id="02a0a-140">Вызовите метод [**иадсакцессконтролентри:: Get \_ для**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) получения субъекта безопасности, который является пользователем, группой, компьютером и т. д., к которому применяется ACE.</span><span class="sxs-lookup"><span data-stu-id="02a0a-140">Call the [**IADsAccessControlEntry::get\_Trustee**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) method to get the security principal; that is user, group, computer, and so on to which the ACE applies.</span></span>
11. <span data-ttu-id="02a0a-141">После завершения работы с строками [**ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) и **доверенного лица** используйте [**сисфристринг**](/windows/win32/api/oleauto/nf-oleauto-sysfreestring) , чтобы освободить память для этих строк.</span><span class="sxs-lookup"><span data-stu-id="02a0a-141">When finished with the [**ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) and **Trustee** strings, use [**SysFreeString**](/windows/win32/api/oleauto/nf-oleauto-sysfreestring) to free the memory for those strings.</span></span>
12. <span data-ttu-id="02a0a-142">После завершения работы с интерфейсами вызовите метод **Release** , чтобы уменьшить или освободить все ссылки на интерфейс.</span><span class="sxs-lookup"><span data-stu-id="02a0a-142">When finished with the interfaces, call **Release** to decrement or release all the interface references.</span></span>

 

 