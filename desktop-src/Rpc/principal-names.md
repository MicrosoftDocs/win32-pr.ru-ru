---
title: Имена участников
description: Чтобы клиент был создан с помощью серверной программы с взаимной проверкой подлинности, он должен предоставить ожидаемое имя участника сервера.
ms.assetid: 4d9977f8-0efb-4559-977e-3eba4e277bc0
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 554ffecff6eb019b4712e6b2d9f5c6319db492e7
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104486988"
---
# <a name="principal-names"></a><span data-ttu-id="ce51e-103">Имена участников</span><span class="sxs-lookup"><span data-stu-id="ce51e-103">Principal Names</span></span>

<span data-ttu-id="ce51e-104">Чтобы клиент был создан с помощью серверной программы с взаимной проверкой подлинности, он должен предоставить ожидаемое имя участника сервера.</span><span class="sxs-lookup"><span data-stu-id="ce51e-104">For a client to create a mutually authenticated session with a server program, it must provide the server's expected principal name.</span></span> <span data-ttu-id="ce51e-105">Для некоторых протоколов, таких как Kerberos, требуется правильное имя участника на сервере для любого сеанса, прошедшего проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="ce51e-105">Some protocols, such as Kerberos, require a correct server principal name for any authenticated session.</span></span> <span data-ttu-id="ce51e-106">Участник — это сущность, которую распознает система безопасности.</span><span class="sxs-lookup"><span data-stu-id="ce51e-106">A principal is an entity that the security system recognizes.</span></span> <span data-ttu-id="ce51e-107">Сюда входят пользователи и системные службы.</span><span class="sxs-lookup"><span data-stu-id="ce51e-107">This includes human users as well as system services.</span></span> <span data-ttu-id="ce51e-108">Все имена субъектов имеют одинаковый формат для заданного поставщика поддержки безопасности (SSP).</span><span class="sxs-lookup"><span data-stu-id="ce51e-108">All principal names take similar format for a given security support provider (SSP).</span></span> <span data-ttu-id="ce51e-109">SSP — это программный модуль, который выполняет проверку безопасности.</span><span class="sxs-lookup"><span data-stu-id="ce51e-109">An SSP is a software module that performs security validation.</span></span> <span data-ttu-id="ce51e-110">Дополнительные сведения см. в разделе [Обзор архитектуры SSPI](sspi-architectural-overview.md).</span><span class="sxs-lookup"><span data-stu-id="ce51e-110">For more information, see [SSPI Architectural Overview](sspi-architectural-overview.md).</span></span> <span data-ttu-id="ce51e-111">Чтобы обеспечить единообразие, поставщик безопасности обычно предоставляет системным службам аналогичные имена в качестве пользователей.</span><span class="sxs-lookup"><span data-stu-id="ce51e-111">To maintain uniformity, a security provider usually gives system services similar names as users.</span></span> <span data-ttu-id="ce51e-112">В некоторых поставщиках безопасности системные службы могут не иметь имени участника.</span><span class="sxs-lookup"><span data-stu-id="ce51e-112">Under some security providers, system services may not have a principal name.</span></span>

<span data-ttu-id="ce51e-113">Сервер регистрирует имя участника для поставщика безопасности с помощью функции [**рпксерверрегистераусинфо**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterauthinfo) .</span><span class="sxs-lookup"><span data-stu-id="ce51e-113">The server registers its principal name for the security provider using the [**RpcServerRegisterAuthInfo**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterauthinfo) function.</span></span> <span data-ttu-id="ce51e-114">Для каждого поставщика безопасности можно использовать только одно имя участника на сервере.</span><span class="sxs-lookup"><span data-stu-id="ce51e-114">Only one server principal name can be used for each security provider.</span></span> <span data-ttu-id="ce51e-115">Если зарегистрировано более одного имени, одно имя выбирается случайным образом и используется.</span><span class="sxs-lookup"><span data-stu-id="ce51e-115">If more than one name is registered, one name is randomly chosen and used.</span></span> <span data-ttu-id="ce51e-116">Поставщик общих служб определяет формат имени участника.</span><span class="sxs-lookup"><span data-stu-id="ce51e-116">The SSP dictates the format of the principal name.</span></span> <span data-ttu-id="ce51e-117">Например, SSP Kerberos/Negotiate для системной службы выглядит примерно следующим образом: \_ имя компьютера $ @childdomain.parentdomain1.parentdomain2.COM .</span><span class="sxs-lookup"><span data-stu-id="ce51e-117">For example, the Kerberos/Negotiate SSPs for a system service look approximately like the following: machine\_name$@childdomain.parentdomain1.parentdomain2.COM.</span></span>

<span data-ttu-id="ce51e-118">Рекомендуемой процедурой для создания имен участников является использование документированных API (например, функции **дсмакеспн** ), а не пиеЦинг вместе с именем участника из строк.</span><span class="sxs-lookup"><span data-stu-id="ce51e-118">The recommended procedure for generating principal names is to use documented APIs (such as the **DsMakeSpn** function), rather than piecing together the principal name from strings.</span></span> <span data-ttu-id="ce51e-119">Использование документированных API повышает переносимость между различными средами развертывания и устраняет вероятность ошибок.</span><span class="sxs-lookup"><span data-stu-id="ce51e-119">Using documented APIs increases portability between different deployment environments and eliminates the possibility for errors.</span></span>

<span data-ttu-id="ce51e-120">Указание неправильного имени участника может помешать клиенту и серверу устанавливать сеанс, прошедший проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="ce51e-120">Specifying an incorrect principal name may prevent the client and server from establishing an authenticated session.</span></span> <span data-ttu-id="ce51e-121">Поставщик услуг SCHANNEL использует имена участников в одной из двух форм:</span><span class="sxs-lookup"><span data-stu-id="ce51e-121">The SCHANNEL SSP takes principal names in either of two forms:</span></span>

-   <span data-ttu-id="ce51e-122">Первая форма имени участника SCHANNEL — это форма [*мсстд*](m-glos.md) .</span><span class="sxs-lookup"><span data-stu-id="ce51e-122">The first SCHANNEL principal name form is the [*msstd*](m-glos.md) form.</span></span> <span data-ttu-id="ce51e-123">Имена в мсстд Form обычно соответствуют шаблону msstd:servername@serverdomain.com .</span><span class="sxs-lookup"><span data-stu-id="ce51e-123">Names in msstd form generally follow the pattern msstd:servername@serverdomain.com.</span></span> <span data-ttu-id="ce51e-124">Это называется свойством имени электронной почты.</span><span class="sxs-lookup"><span data-stu-id="ce51e-124">This is referred to as an email name property.</span></span> <span data-ttu-id="ce51e-125">Если сертификат содержит свойство "имя электронной почты" и содержит символ "@", имя участника — мсстд: имя электронной почты.</span><span class="sxs-lookup"><span data-stu-id="ce51e-125">If the certificate contains an email name property, and it contains the at sign (@), the principal name is msstd:email name.</span></span> <span data-ttu-id="ce51e-126">В противном случае он должен содержать свойство Common Name.</span><span class="sxs-lookup"><span data-stu-id="ce51e-126">Otherwise it must contain the common name property.</span></span> <span data-ttu-id="ce51e-127">Внутренние обратные косые черты являются двойными, так же как и в строковых привязках.</span><span class="sxs-lookup"><span data-stu-id="ce51e-127">Internal backslashes are doubled, just as in string bindings.</span></span>
-   <span data-ttu-id="ce51e-128">Вторая форма имени участника SCHANNEL — это форма [*фуллсик*](f-glos.md) .</span><span class="sxs-lookup"><span data-stu-id="ce51e-128">The second SCHANNEL principal name form is the [*fullsic*](f-glos.md) form.</span></span> <span data-ttu-id="ce51e-129">Это ряд совместимых с RFC1779 имен, ограниченных угловыми скобками и разделенных символами обратной косой черты.</span><span class="sxs-lookup"><span data-stu-id="ce51e-129">This is a series of RFC1779-compliant names bounded by angle brackets and separated by backslashes.</span></span> <span data-ttu-id="ce51e-130">Обычно это следует шаблону фуллсик: \\ < \\ Authority \\ \\ ... \\ . Person> или фуллсик: \\ < \\ \\ подавтор полномочий \\ ... \\ .> Серверпрограм.</span><span class="sxs-lookup"><span data-stu-id="ce51e-130">It typically follows the pattern fullsic:\\<\\Authority\\SubAuthority\\.....\\Person> or fullsic:\\<\\Authority\\SubAuthority\\.....\\ServerProgram>.</span></span>

<span data-ttu-id="ce51e-131">Если имя не соответствует сертификату, возвращается сообщение об ошибке \_ отказа в доступе \_ .</span><span class="sxs-lookup"><span data-stu-id="ce51e-131">If the name does not match the certificate, ERROR\_ACCESS\_DENIED is returned.</span></span> <span data-ttu-id="ce51e-132">Если формат имени является недопустимым, поставщик услуг SCHANNEL (SSP) возвращает код ошибки \_ недопустимого \_ параметра.</span><span class="sxs-lookup"><span data-stu-id="ce51e-132">If the name format is invalid, SCHANNEL SSP returns the code ERROR\_INVALID\_PARAMETER.</span></span>

<span data-ttu-id="ce51e-133">Чтобы запросить имя участника сервера, приложения могут вызывать [**рпкмгмтинксерверпринкнаме**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname).</span><span class="sxs-lookup"><span data-stu-id="ce51e-133">To query for the server's principal name, applications can call [**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname).</span></span> <span data-ttu-id="ce51e-134">Он выделяет строку, завершающуюся нулем, для хранения имени участника.</span><span class="sxs-lookup"><span data-stu-id="ce51e-134">This allocates a null-terminated string to hold the principal name.</span></span> <span data-ttu-id="ce51e-135">Перед завершением работы приложение должно вызвать [**рпкстрингфри**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcstringfree) , чтобы освободить память, занимаемую этой строкой.</span><span class="sxs-lookup"><span data-stu-id="ce51e-135">Before it terminates, your application must invoke [**RpcStringFree**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcstringfree) to release the memory this string occupies.</span></span>

<span data-ttu-id="ce51e-136">Запрос имени сервера таким образом не является безопасным, и его следует избегать.</span><span class="sxs-lookup"><span data-stu-id="ce51e-136">Querying for the server name in this manner is not secure and should be avoided.</span></span> <span data-ttu-id="ce51e-137">Для проверки подлинности сервера клиентская программа должна быть в курсе, к какому серверу подключается, и следует создать имя участника-сервера с нуля.</span><span class="sxs-lookup"><span data-stu-id="ce51e-137">For server authentication, the client program should know which server it is connecting to and should create the server principal name from scratch.</span></span>

 

 




