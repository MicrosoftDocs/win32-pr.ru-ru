---
title: Сводка правил выделения памяти
description: В следующей таблице перечислены ключевые правила выделения памяти.
ms.assetid: 0c1f8398-75e6-45ec-a9f9-9dcdbe21c24d
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6f9403bb5057b2004d966c0634bc101a3282fe92
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104134242"
---
# <a name="summary-of-memory-allocation-rules"></a><span data-ttu-id="92bc6-103">Сводка правил выделения памяти</span><span class="sxs-lookup"><span data-stu-id="92bc6-103">Summary of Memory Allocation Rules</span></span>

<span data-ttu-id="92bc6-104">В следующей таблице перечислены ключевые правила выделения памяти.</span><span class="sxs-lookup"><span data-stu-id="92bc6-104">The following table summarizes key rules regarding memory allocation.</span></span>



| <span data-ttu-id="92bc6-105">MIDL, элемент</span><span class="sxs-lookup"><span data-stu-id="92bc6-105">MIDL element</span></span>                                                                                                                                           | <span data-ttu-id="92bc6-106">Описание</span><span class="sxs-lookup"><span data-stu-id="92bc6-106">Description</span></span>                                                                                                                                                           |
|--------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="92bc6-107">\[ [Ссылочные](/windows/desktop/Midl/ref) \] указатели верхнего уровня</span><span class="sxs-lookup"><span data-stu-id="92bc6-107">Top-level \[ [ref](/windows/desktop/Midl/ref)\] pointers</span></span>                                                                                                                | <span data-ttu-id="92bc6-108">Должны быть указатели, отличные от NULL.</span><span class="sxs-lookup"><span data-stu-id="92bc6-108">Must be non-null pointers.</span></span>                                                                                                                                            |
| <span data-ttu-id="92bc6-109">Возвращаемое значение функции</span><span class="sxs-lookup"><span data-stu-id="92bc6-109">Function return value</span></span>                                                                                                                                  | <span data-ttu-id="92bc6-110">Для возвращаемых значений указателей всегда выделяется новая память.</span><span class="sxs-lookup"><span data-stu-id="92bc6-110">New memory is always allocated for pointer return values.</span></span>                                                                                                             |
| <span data-ttu-id="92bc6-111">\[Указатель " [уникальный](/windows/desktop/Midl/unique)", " [out](/windows/desktop/Midl/out-idl) " \] или " \[ [ptr](/windows/desktop/Midl/ptr) \] "</span><span class="sxs-lookup"><span data-stu-id="92bc6-111">\[ [unique](/windows/desktop/Midl/unique), [out](/windows/desktop/Midl/out-idl)\] or \[ [ptr](/windows/desktop/Midl/ptr), out\] pointer</span></span>                                                                   | <span data-ttu-id="92bc6-112">Не разрешено MIDL.</span><span class="sxs-lookup"><span data-stu-id="92bc6-112">Not allowed by MIDL.</span></span>                                                                                                                                                  |
| <span data-ttu-id="92bc6-113">Не относящийся к верхнему уровню \[ [уникальный](/windows/desktop/Midl/unique), [в](/windows/desktop/Midl/in), [выходной](/windows/desktop/Midl/out-idl) \] или \[ [ptr](/windows/desktop/Midl/ptr)- \] указатель, изменяющий значение NULL на значение, отличное от NULL</span><span class="sxs-lookup"><span data-stu-id="92bc6-113">Non-top-level \[[unique](/windows/desktop/Midl/unique), [in](/windows/desktop/Midl/in), [out](/windows/desktop/Midl/out-idl)\] or \[[ptr](/windows/desktop/Midl/ptr), in, out\] pointer that changes from null to non-null</span></span> | <span data-ttu-id="92bc6-114">Клиентские заглушки выделяют новую память на стороне клиента при возврате.</span><span class="sxs-lookup"><span data-stu-id="92bc6-114">Client stubs allocate new memory on client on return.</span></span>                                                                                                                 |
| <span data-ttu-id="92bc6-115">Не относящийся к верхнему уровню \[ [уникальный](/windows/desktop/Midl/unique)указатель [](/windows/desktop/Midl/out-idl) [в](/windows/desktop/Midl/in), \] изменяющий значение, отличное от NULL, на null</span><span class="sxs-lookup"><span data-stu-id="92bc6-115">Non-top-level \[[unique](/windows/desktop/Midl/unique), [in](/windows/desktop/Midl/in), [out](/windows/desktop/Midl/out-idl)\] pointer that changes from non-null to null</span></span>                                 | <span data-ttu-id="92bc6-116">Память на клиенте потеряна. клиентское приложение отвечает за освобождение памяти и предотвращает утечки.</span><span class="sxs-lookup"><span data-stu-id="92bc6-116">Memory is orphaned on client; client application is responsible for freeing memory and preventing leaks.</span></span>                                                              |
| <span data-ttu-id="92bc6-117">Указатель на неверхний уровень \[ указателя [ptr](/windows/desktop/Midl/ptr), [в](/windows/desktop/Midl/in), [](/windows/desktop/Midl/out-idl) \] который изменяет значения, отличные от NULL, на null</span><span class="sxs-lookup"><span data-stu-id="92bc6-117">Non-top-level \[[ptr](/windows/desktop/Midl/ptr), [in](/windows/desktop/Midl/in), [out](/windows/desktop/Midl/out-idl)\] pointer that changes from non-null to null</span></span>                                       | <span data-ttu-id="92bc6-118">Память будет потеряна на стороне клиента, если она не имеет псевдонима. клиентское приложение отвечает за освобождение и предотвращение утечек памяти в этом случае.</span><span class="sxs-lookup"><span data-stu-id="92bc6-118">Memory will be orphaned on client if not aliased; client application is responsible for freeing and preventing memory leaks in this case.</span></span>                             |
| <span data-ttu-id="92bc6-119">\[[ссылка](/windows/desktop/Midl/ref) \] указател</span><span class="sxs-lookup"><span data-stu-id="92bc6-119">\[[ref](/windows/desktop/Midl/ref)\] pointers</span></span>                                                                                                                           | <span data-ttu-id="92bc6-120">Уровень клиент-приложение обычно выделяется.</span><span class="sxs-lookup"><span data-stu-id="92bc6-120">Client-application layer usually allocates.</span></span>                                                                                                                           |
| <span data-ttu-id="92bc6-121">Не равно NULL \[ [](/windows/desktop/Midl/in), [](/windows/desktop/Midl/out-idl) \] указатель</span><span class="sxs-lookup"><span data-stu-id="92bc6-121">Non-null \[[in](/windows/desktop/Midl/in), [out](/windows/desktop/Midl/out-idl)\] pointer</span></span>                                                                                                | <span data-ttu-id="92bc6-122">Заглушки пытаются выполнить запись в существующее хранилище на клиенте.</span><span class="sxs-lookup"><span data-stu-id="92bc6-122">Stubs attempt to write into existing storage on client.</span></span> <span data-ttu-id="92bc6-123">Если **\[ строка \]** и размер увеличиваются сверх размера, выделенного на клиенте, это вызовет сбой групповой политики при возврате.</span><span class="sxs-lookup"><span data-stu-id="92bc6-123">If **\[string\]** and size increases beyond size allocated on the client, it will cause a GP-fault on return.</span></span> |



 

<span data-ttu-id="92bc6-124">В следующей таблице приводится сводка влияния ключевых атрибутов IDL и ACF на управление памятью.</span><span class="sxs-lookup"><span data-stu-id="92bc6-124">The following table summarizes the effects of key IDL and ACF attributes on memory management.</span></span>



| <span data-ttu-id="92bc6-125">MIDL, функция</span><span class="sxs-lookup"><span data-stu-id="92bc6-125">MIDL feature</span></span>                                                                   | <span data-ttu-id="92bc6-126">Проблемы с клиентом</span><span class="sxs-lookup"><span data-stu-id="92bc6-126">Client issues</span></span>                                                                                                                                  | <span data-ttu-id="92bc6-127">Проблемы с сервером</span><span class="sxs-lookup"><span data-stu-id="92bc6-127">Server issues</span></span>                                                                                                                 |
|--------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="92bc6-128">\[[выделение](/windows/desktop/Midl/allocate)(один \_ узел) \] , \[ выделение (все \_ узлы)\]</span><span class="sxs-lookup"><span data-stu-id="92bc6-128">\[ [allocate](/windows/desktop/Midl/allocate)(single\_node)\], \[allocate(all\_nodes)\]</span></span>         | <span data-ttu-id="92bc6-129">Определяет, выполняется ли один или несколько вызовов функций памяти.</span><span class="sxs-lookup"><span data-stu-id="92bc6-129">Determines whether one or many calls are made to the memory functions.</span></span>                                                                         | <span data-ttu-id="92bc6-130">То же, что и клиент, за исключением частной памяти, часто можно использовать для выделения (одного \_ узла) \[ в \] \[ данных и в \] .</span><span class="sxs-lookup"><span data-stu-id="92bc6-130">Same as client, except private memory can often be used for allocate (single\_node) \[in\] and \[in,out\] data.</span></span>               |
| <span data-ttu-id="92bc6-131">\[выделение (бесплатное) \] или \[ выделение (не \_ бесплатное)\]</span><span class="sxs-lookup"><span data-stu-id="92bc6-131">\[allocate(free)\] or \[allocate(dont\_free)\]</span></span>                                 | <span data-ttu-id="92bc6-132">(Нет; влияет на сервер.)</span><span class="sxs-lookup"><span data-stu-id="92bc6-132">(None; affects server.)</span></span>                                                                                                                        | <span data-ttu-id="92bc6-133">Определяет, освобождается ли память на сервере после каждого вызова удаленной процедуры.</span><span class="sxs-lookup"><span data-stu-id="92bc6-133">Determines whether memory on the server is freed after each remote procedure call.</span></span>                                            |
| <span data-ttu-id="92bc6-134">атрибуты массива \[ [Max \_ имеют](/windows/desktop/Midl/max-is) \] \[ [размер \_ ](/windows/desktop/Midl/size-is) и\]</span><span class="sxs-lookup"><span data-stu-id="92bc6-134">array attributes \[ [max\_is](/windows/desktop/Midl/max-is)\] and \[ [size\_is](/windows/desktop/Midl/size-is)\]</span></span> | <span data-ttu-id="92bc6-135">(Нет; влияет на сервер.)</span><span class="sxs-lookup"><span data-stu-id="92bc6-135">(None; affects server.)</span></span>                                                                                                                        | <span data-ttu-id="92bc6-136">Определяет размер выделяемой памяти.</span><span class="sxs-lookup"><span data-stu-id="92bc6-136">Determines size of memory to be allocated.</span></span>                                                                                    |
| <span data-ttu-id="92bc6-137">\[[ \_ число байтов](/windows/desktop/Midl/byte-count)\]</span><span class="sxs-lookup"><span data-stu-id="92bc6-137">\[ [byte\_count](/windows/desktop/Midl/byte-count)\]</span></span>                                            | <span data-ttu-id="92bc6-138">Клиент должен выделить буфер; заглушки клиента не выделяются или освобождаются.</span><span class="sxs-lookup"><span data-stu-id="92bc6-138">Client must allocate buffer; not allocated or freed by client stubs.</span></span>                                                                           | <span data-ttu-id="92bc6-139">Атрибут параметра ACF определяет размер буфера, выделенного на сервере.</span><span class="sxs-lookup"><span data-stu-id="92bc6-139">ACF parameter attribute determines size of buffer allocated on server.</span></span>                                                        |
| <span data-ttu-id="92bc6-140">\[[включить \_ выделение](/windows/desktop/Midl/enable-allocate)\]</span><span class="sxs-lookup"><span data-stu-id="92bc6-140">\[ [enable\_allocate](/windows/desktop/Midl/enable-allocate)\]</span></span>                                  | <span data-ttu-id="92bc6-141">Обычно нет.</span><span class="sxs-lookup"><span data-stu-id="92bc6-141">Usually, none.</span></span> <span data-ttu-id="92bc6-142">Однако клиент может использовать другую среду управления памятью.</span><span class="sxs-lookup"><span data-stu-id="92bc6-142">However, the client may be using a different memory management environment.</span></span>                                                     | <span data-ttu-id="92bc6-143">Сервер использует другую среду управления памятью.</span><span class="sxs-lookup"><span data-stu-id="92bc6-143">Server uses a different memory management environment.</span></span> <span data-ttu-id="92bc6-144">[**Рпксмаллокате**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcsmallocate) следует использовать для выделения памяти.</span><span class="sxs-lookup"><span data-stu-id="92bc6-144">[**RpcSmAllocate**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcsmallocate) should be used for allocations.</span></span> |
| <span data-ttu-id="92bc6-145">\[[в](/windows/desktop/Midl/in) \] версию</span><span class="sxs-lookup"><span data-stu-id="92bc6-145">\[ [in](/windows/desktop/Midl/in)\]attribute</span></span>                                                    | <span data-ttu-id="92bc6-146">Клиентское приложение, ответственное за выделение памяти для данных.</span><span class="sxs-lookup"><span data-stu-id="92bc6-146">Client application responsible for allocating memory for data.</span></span>                                                                                 | <span data-ttu-id="92bc6-147">Выделено на сервере заглушками.</span><span class="sxs-lookup"><span data-stu-id="92bc6-147">Allocated on server by stubs.</span></span>                                                                                                 |
| <span data-ttu-id="92bc6-148">\[[исходящий трафик](/windows/desktop/Midl/out-idl) \] версию</span><span class="sxs-lookup"><span data-stu-id="92bc6-148">\[ [out](/windows/desktop/Midl/out-idl)\] attribute</span></span>                                             | <span data-ttu-id="92bc6-149">Выделено на стороне клиента заглушками.</span><span class="sxs-lookup"><span data-stu-id="92bc6-149">Allocated on client by stubs.</span></span>                                                                                                                  | <span data-ttu-id="92bc6-150">\[[исходящий трафик](/windows/desktop/Midl/out-idl) \] -Указатель должен быть \[ [](/windows/desktop/Midl/ref) \] указателем ref; выделен на сервере заглушками.</span><span class="sxs-lookup"><span data-stu-id="92bc6-150">\[[out](/windows/desktop/Midl/out-idl)\]-only pointer must be \[[ref](/windows/desktop/Midl/ref)\] pointer; allocated on server by stubs.</span></span>                       |
| <span data-ttu-id="92bc6-151">\[[ссылка](/windows/desktop/Midl/ref) \] версию</span><span class="sxs-lookup"><span data-stu-id="92bc6-151">\[ [ref](/windows/desktop/Midl/ref)\] attribute</span></span>                                                 | <span data-ttu-id="92bc6-152">Память, на которую ссылается указатель, должна быть выделена клиентским приложением.</span><span class="sxs-lookup"><span data-stu-id="92bc6-152">Memory referenced by pointer must be allocated by client application.</span></span>                                                                          | <span data-ttu-id="92bc6-153">Ссылочные указатели верхнего уровня и первого уровня, управляемые заглушками.</span><span class="sxs-lookup"><span data-stu-id="92bc6-153">Top-level and first-level reference pointers managed by stubs.</span></span>                                                                |
| <span data-ttu-id="92bc6-154">\[[уникальный](/windows/desktop/Midl/unique) \] версию</span><span class="sxs-lookup"><span data-stu-id="92bc6-154">\[ [unique](/windows/desktop/Midl/unique)\] attribute</span></span>                                           | <span data-ttu-id="92bc6-155">Значение null, отличное от NULL, может привести к потере памяти. значение null, отличное от NULL, приводит к тому, что клиентская заглушка вызывает [ \_ \_ выделять пользователю MIDL](/windows/desktop/Midl/midl-user-allocate-1).</span><span class="sxs-lookup"><span data-stu-id="92bc6-155">Non-null to null can result in orphaned memory; null to non-null causes client stub to call [midl\_user\_allocate](/windows/desktop/Midl/midl-user-allocate-1).</span></span> | <span data-ttu-id="92bc6-156">(Затрагивает клиент.)</span><span class="sxs-lookup"><span data-stu-id="92bc6-156">(Affects client.)</span></span>                                                                                                             |
| <span data-ttu-id="92bc6-157">\[[ptr](/windows/desktop/Midl/ptr) \] -записи версию</span><span class="sxs-lookup"><span data-stu-id="92bc6-157">\[ [ptr](/windows/desktop/Midl/ptr)\] attribute</span></span>                                                 | <span data-ttu-id="92bc6-158">(См \[ . [уникальный](/windows/desktop/Midl/unique) \] .)</span><span class="sxs-lookup"><span data-stu-id="92bc6-158">(See \[ [unique](/windows/desktop/Midl/unique)\].)</span></span>                                                                                                              | <span data-ttu-id="92bc6-159">(См \[ . [уникальный](/windows/desktop/Midl/unique) \] .)</span><span class="sxs-lookup"><span data-stu-id="92bc6-159">(See \[ [unique](/windows/desktop/Midl/unique)\].)</span></span>                                                                                             |



 

 

 