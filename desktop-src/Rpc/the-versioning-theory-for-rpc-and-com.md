---
title: Теория управления версиями для RPC и COM
description: Теория управления версиями для удаленного вызова процедур (RPC) и COM.
ms.assetid: c4df0a7b-e1be-481d-9149-317ffc9179b9
keywords:
- Удаленный вызов процедур RPC, рекомендации, управление версиями
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7e03b23c91bf69fbc3c4f72366b80812fd54330d
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104134351"
---
# <a name="the-versioning-theory-for-rpc-and-com"></a><span data-ttu-id="11b6d-104">Теория управления версиями для RPC и COM</span><span class="sxs-lookup"><span data-stu-id="11b6d-104">The Versioning Theory for RPC and COM</span></span>

<span data-ttu-id="11b6d-105">Только два метода, полностью защищенных методом, поддерживают новые функции без риска проблем с совместимостью сети:</span><span class="sxs-lookup"><span data-stu-id="11b6d-105">Only two completely foolproof methods support new functionality without risk of wire compatibility problems:</span></span>

-   <span data-ttu-id="11b6d-106">Измените версию интерфейса в соответствии с правилами. Это предотвращает взаимодействие новых клиентов со старым сервером, а также может препятствовать взаимодействию старого клиента с новым сервером.</span><span class="sxs-lookup"><span data-stu-id="11b6d-106">Change the interface version according to the rules; this prevents new clients from communicating with an old server, and may or may not prevent an old client from communicating with the new server.</span></span> <span data-ttu-id="11b6d-107">Это объясняется далее в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="11b6d-107">This is clarified later in this section.</span></span>
-   <span data-ttu-id="11b6d-108">Опишите другой интерфейс, посвященный новым функциональным возможностям.</span><span class="sxs-lookup"><span data-stu-id="11b6d-108">Introduce a different interface dealing with the new functionality.</span></span>

<span data-ttu-id="11b6d-109">Стандартный интерфейс RPC определяется с помощью комбинации GUID и номера версии. COM-интерфейс определяется по его идентификатору GUID.</span><span class="sxs-lookup"><span data-stu-id="11b6d-109">A standard RPC interface is identified by a GUID and version number combination; a COM interface is identified by its GUID.</span></span> <span data-ttu-id="11b6d-110">Версия состоит из основных и вспомогательных частей.</span><span class="sxs-lookup"><span data-stu-id="11b6d-110">The version consists of major and minor parts.</span></span> <span data-ttu-id="11b6d-111">Для стандартных интерфейсов с одним и тем же идентификатором GUID и разными номерами версий соединение может быть доступно только в том случае, если основная версия совпадает, а клиент не превышает дополнительный номер версии сервера.</span><span class="sxs-lookup"><span data-stu-id="11b6d-111">For standard interfaces with the same GUID and different version numbers, a connection is possible only when the major version is the same, and the client is not higher than the minor version of the server.</span></span>

<span data-ttu-id="11b6d-112">Следствием является то, что изменение GUID интерфейса RPC нарушает совместимость сети, а изменение имени интерфейса — нет.</span><span class="sxs-lookup"><span data-stu-id="11b6d-112">A consequence is that changing the RPC interface GUID breaks wire compatibility, while changing the interface name does not.</span></span>

<span data-ttu-id="11b6d-113">В стандартной RPC путь к обновлениям и расширениям определен правильно, и в основном требуется, чтобы новые методы были добавлены только в конце интерфейса, а новые типы использовались только в новых методах.</span><span class="sxs-lookup"><span data-stu-id="11b6d-113">In standard RPC, a path for upgrades and extensions is well defined, and basically requires that new methods only be added at the end of the interface, and new types be used only in the new methods.</span></span> <span data-ttu-id="11b6d-114">Если такие дополнения необходимы, необходимо увеличить дополнительный номер версии.</span><span class="sxs-lookup"><span data-stu-id="11b6d-114">If such additions are needed, the minor version must be increased.</span></span> <span data-ttu-id="11b6d-115">Любое другое изменение требует изменения в основной версии, так как программное обеспечение клиента и сервера будет несовместимо по сети.</span><span class="sxs-lookup"><span data-stu-id="11b6d-115">Any other change requires a change in the major version, because the client and server software would be incompatible on the wire.</span></span> <span data-ttu-id="11b6d-116">Соблюдение этих правил гарантирует, что при наличии соединения между новым клиентом и старым сервером, или наоборот, обе стороны полностью совместимы.</span><span class="sxs-lookup"><span data-stu-id="11b6d-116">Adhering to these rules assures whenever there is a connection between a new client and old server, or vice-versa, both sides are fully compatible.</span></span>

<span data-ttu-id="11b6d-117">Для COM-интерфейса нельзя использовать атрибут Version.</span><span class="sxs-lookup"><span data-stu-id="11b6d-117">For a COM interface, the version attribute cannot be used.</span></span> <span data-ttu-id="11b6d-118">Создание новых интерфейсов и наследование от старых интерфейсов эквивалентно управлению версией в RPC.</span><span class="sxs-lookup"><span data-stu-id="11b6d-118">Creating new interfaces and inheriting from the old interfaces is an equivalent of manipulating the version in RPC.</span></span> <span data-ttu-id="11b6d-119">Как правило, лучшим подходом в COM является создание нового интерфейса для расширенной функциональности.</span><span class="sxs-lookup"><span data-stu-id="11b6d-119">Typically, the best approach in COM is to create a new interface for the expanded functionality.</span></span> <span data-ttu-id="11b6d-120">Эквивалентом дополнительной версии является новый интерфейс, наследующий от старого.</span><span class="sxs-lookup"><span data-stu-id="11b6d-120">An equivalent of the minor version is the new interface inheriting from the old one.</span></span> <span data-ttu-id="11b6d-121">Для изменения старых методов или старых типов данных требуется совершенно новый COM-интерфейс — интерфейс, который не наследует от старого.</span><span class="sxs-lookup"><span data-stu-id="11b6d-121">Changing old methods or old data types requires an entirely new COM interface—an interface that does not inherit from the old one.</span></span>

<span data-ttu-id="11b6d-122">Для COM функция [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) — это установленный метод проверки того, поддерживает ли сервер интерфейс; Следовательно, ситуации, в которых клиент может взаимодействовать со старым или новой версией интерфейса, можно легко разрешить.</span><span class="sxs-lookup"><span data-stu-id="11b6d-122">For COM, the [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) function is an established method of checking whether a server supports an interface; hence, the situations where a client can talk to an old or a new version of an interface can be easily resolved.</span></span>

 

 