---
title: Олицетворение клиента (RPC)
description: Олицетворение полезно в распределенных вычислительных средах, когда серверы должны передавать клиентские запросы другим серверным процессам или к операционной системе.
ms.assetid: 49d833d8-c61c-4746-91cf-c0753847cd3d
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d03ad3b4d9e2984708e8b274ab9bc57c3235808b
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104134359"
---
# <a name="client-impersonation"></a><span data-ttu-id="7988e-103">Олицетворение клиента</span><span class="sxs-lookup"><span data-stu-id="7988e-103">Client Impersonation</span></span>

<span data-ttu-id="7988e-104">Олицетворение полезно в распределенных вычислительных средах, когда серверы должны передавать клиентские запросы другим серверным процессам или к операционной системе.</span><span class="sxs-lookup"><span data-stu-id="7988e-104">Impersonation is useful in a distributed computing environment when servers must pass client requests to other server processes or to the operating system.</span></span> <span data-ttu-id="7988e-105">В этом случае сервер олицетворяет контекст безопасности клиента.</span><span class="sxs-lookup"><span data-stu-id="7988e-105">In this case, a server impersonates the client's security context.</span></span> <span data-ttu-id="7988e-106">Затем другие серверные процессы могут обрабатывать запрос так, как если бы он был создан исходным клиентом.</span><span class="sxs-lookup"><span data-stu-id="7988e-106">Other server processes can then handle the request as if the original client made it.</span></span>

![сервер олицетворяет вызывающий клиент при последующих вызовах от имени клиента](images/impr.png)

<span data-ttu-id="7988e-108">Например, клиент выполняет запрос к серверу A. Если сервер A должен запрашивать сервер B для выполнения запроса, сервер A олицетворяет контекст безопасности клиента и выполняет запрос к серверу B от имени клиента.</span><span class="sxs-lookup"><span data-stu-id="7988e-108">For example, a client makes a request to Server A. If Server A must query Server B to complete the request, Server A impersonates the client security context and makes the request to Server B on behalf of the client.</span></span> <span data-ttu-id="7988e-109">Сервер B использует контекст безопасности исходного клиента вместо удостоверения безопасности для сервера а, чтобы определить, следует ли выполнить задачу.</span><span class="sxs-lookup"><span data-stu-id="7988e-109">Server B uses the original client's security context, instead of the security identity for Server A, to determine whether to complete the task.</span></span>

<span data-ttu-id="7988e-110">Сервер вызывает [**рпЦимперсонатеклиент**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcimpersonateclient) , чтобы перезаписать безопасность серверного потока с помощью контекста Client Security.</span><span class="sxs-lookup"><span data-stu-id="7988e-110">The server calls [**RpcImpersonateClient**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcimpersonateclient) to overwrite the security for the server thread with the client security context.</span></span> <span data-ttu-id="7988e-111">После завершения задачи сервер вызывает [**рпкреверттоселф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoself) или [**рпкреверттоселфекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoselfex) для восстановления контекста безопасности, определенного для потока сервера.</span><span class="sxs-lookup"><span data-stu-id="7988e-111">After the task is completed, the server calls [**RpcRevertToSelf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoself) or [**RpcRevertToSelfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoselfex) to restore the security context defined for the server thread.</span></span>

<span data-ttu-id="7988e-112">При привязке клиент может указать сведения о контроле качества обслуживания, которые указывают, как сервер может олицетворять клиента.</span><span class="sxs-lookup"><span data-stu-id="7988e-112">When binding, the client can specify quality-of-service information about security which specifies how the server can impersonate the client.</span></span> <span data-ttu-id="7988e-113">Например, один из параметров позволяет клиенту указать, что серверу не разрешено олицетворять его.</span><span class="sxs-lookup"><span data-stu-id="7988e-113">For example, one of the settings lets the client specify that the server is not allowed to impersonate it.</span></span> <span data-ttu-id="7988e-114">Дополнительные сведения см. в разделе [качество обслуживания](quality-of-service.md).</span><span class="sxs-lookup"><span data-stu-id="7988e-114">For more information, see [Quality of Service](quality-of-service.md).</span></span>

<span data-ttu-id="7988e-115">Возможность вызова других серверов при олицетворении исходного клиента называется *делегированием*.</span><span class="sxs-lookup"><span data-stu-id="7988e-115">The capability to call other servers while impersonating the original client is called *delegation*.</span></span> <span data-ttu-id="7988e-116">При использовании делегирования сервер, выполняющий олицетворение клиента, может вызвать другой сервер и выполнить сетевые вызовы с учетными данными клиента.</span><span class="sxs-lookup"><span data-stu-id="7988e-116">When delegation is used, a server impersonating a client can call another server, and can make network calls with the credentials of the client.</span></span> <span data-ttu-id="7988e-117">То есть с точки зрения второго сервера запросы, поступающие от первого сервера, не отличаются от запросов, поступающих от клиента.</span><span class="sxs-lookup"><span data-stu-id="7988e-117">That is, from the perspective of the second server, requests coming from the first server are indistinguishable from requests coming from the client.</span></span> <span data-ttu-id="7988e-118">Не все поставщики безопасности поддерживают делегирование.</span><span class="sxs-lookup"><span data-stu-id="7988e-118">Not all security providers support delegation.</span></span> <span data-ttu-id="7988e-119">Корпорация Майкрософт поставляется только с одним поставщиком безопасности, поддерживающим делегирование: Kerberos.</span><span class="sxs-lookup"><span data-stu-id="7988e-119">Microsoft ships only one security provider that supports delegation: Kerberos.</span></span>

<span data-ttu-id="7988e-120">Делегирование может быть опасной возможностью из-за привилегий, которые клиент предоставляет серверу во время удаленного вызова процедуры.</span><span class="sxs-lookup"><span data-stu-id="7988e-120">Delegation can be a dangerous capability due to the privileges the client gives the server during a remote procedure call.</span></span> <span data-ttu-id="7988e-121">Именно поэтому Kerberos разрешает вызовы с уровнем олицетворения делегирования только в том случае, если запрашивается взаимная проверка подлинности.</span><span class="sxs-lookup"><span data-stu-id="7988e-121">This is why Kerberos allows calls with the impersonation level of delegation only if mutual authentication is requested.</span></span> <span data-ttu-id="7988e-122">Администраторы домена могут ограничить компьютеры, на которых выполняется вызов с уровнем олицетворения делегирования, чтобы предотвратить неподозрительные клиенты от выполнения вызовов к серверам, которые могут привести к нарушению своих учетных данных.</span><span class="sxs-lookup"><span data-stu-id="7988e-122">Domain administrators can limit the computers to which calls with delegation impersonation level are made to prevent unsuspecting clients from making calls to servers that could abuse their credentials.</span></span>

<span data-ttu-id="7988e-123">Существует одно исключение из правила делегирования: вызовы с использованием [**нкалрпк**](/windows/desktop/Midl/ncalrpc).</span><span class="sxs-lookup"><span data-stu-id="7988e-123">One exception to the delegation rule exists: calls using [**ncalrpc**](/windows/desktop/Midl/ncalrpc).</span></span> <span data-ttu-id="7988e-124">Когда эти вызовы становятся доступными, сервер получает права на делегирование, даже если задан уровень олицетворения олицетворения.</span><span class="sxs-lookup"><span data-stu-id="7988e-124">When these calls are made the server gets delegation rights, even if an impersonation level of impersonate is specified.</span></span> <span data-ttu-id="7988e-125">То есть сервер может вызывать другие серверы от имени клиента.</span><span class="sxs-lookup"><span data-stu-id="7988e-125">That is, a server can call other servers on behalf of the client.</span></span> <span data-ttu-id="7988e-126">Это работает только для одного удаленного вызова.</span><span class="sxs-lookup"><span data-stu-id="7988e-126">This works for one remote call only.</span></span> <span data-ttu-id="7988e-127">Например, если клиент A вызывает Local Server фунтов с помощью **нкалрпк** Local Server фунтов, может олицетворять и вызывать удаленный сервер RB.</span><span class="sxs-lookup"><span data-stu-id="7988e-127">For example, if client A calls local server LB using **ncalrpc** local server LB can impersonate and call remote server RB.</span></span> <span data-ttu-id="7988e-128">RB сможет действовать от имени клиента а, но только на удаленном компьютере, на котором запущена программа RB.</span><span class="sxs-lookup"><span data-stu-id="7988e-128">RB will be able to act on behalf of client A, but only on the remote computer that RB is running on.</span></span> <span data-ttu-id="7988e-129">Он не может выполнить другой сетевой вызов на удаленном компьютере C, если не указан уровень олицетворения делегата при вызове RB.</span><span class="sxs-lookup"><span data-stu-id="7988e-129">It cannot make another network call to remote computer C unless LB specified an impersonation level of delegate when it called RB.</span></span>

> [!Note]  
> <span data-ttu-id="7988e-130">Термин *олицетворение* представляет два перекрывающихся значения.</span><span class="sxs-lookup"><span data-stu-id="7988e-130">The term *impersonation* represents two overlapping meanings.</span></span> <span data-ttu-id="7988e-131">Первое значение олицетворения — это общий процесс, действующий от имени клиента.</span><span class="sxs-lookup"><span data-stu-id="7988e-131">The first meaning of impersonation is the general process of acting on behalf of a client.</span></span> <span data-ttu-id="7988e-132">Второе значение — это конкретный уровень олицетворения, называемый олицетворением.</span><span class="sxs-lookup"><span data-stu-id="7988e-132">The second meaning is the specific impersonation level called impersonation.</span></span> <span data-ttu-id="7988e-133">Контекст текста обычно уточняет значение.</span><span class="sxs-lookup"><span data-stu-id="7988e-133">The context of the text generally clarifies the meaning.</span></span>

 

 

 