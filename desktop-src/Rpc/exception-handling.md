---
title: Обработка исключений (RPC)
description: RPC использует тот же подход к обработке исключений, что и Windows API.
ms.assetid: 7133d3f4-ed84-4cde-bc77-88e73ced9073
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 25de594a648cddb70f26b42e8b0dbf1d6a9dd51d
ms.sourcegitcommit: 8fa6614b715bddf14648cce36d2df22e5232801a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2020
ms.locfileid: "104488844"
---
# <a name="exception-handling-rpc"></a><span data-ttu-id="9f138-103">Обработка исключений (RPC)</span><span class="sxs-lookup"><span data-stu-id="9f138-103">Exception Handling (RPC)</span></span>

<span data-ttu-id="9f138-104">RPC использует тот же подход к обработке исключений, что и Windows API.</span><span class="sxs-lookup"><span data-stu-id="9f138-104">RPC uses the same approach to exception handling as the Windows API.</span></span>

<span data-ttu-id="9f138-105">Структура [**рпктрифиналли**](rpctryfinally.md)  /  [**рпкфиналли**](/previous-versions/aa375699(v=vs.80))  /  [**рпцендфиналли**](/previous-versions/aa375634(v=vs.80)) эквивалентна оператору Windows **try-finally** .</span><span class="sxs-lookup"><span data-stu-id="9f138-105">The [**RpcTryFinally**](rpctryfinally.md) / [**RpcFinally**](/previous-versions/aa375699(v=vs.80)) / [**RpcEndFinally**](/previous-versions/aa375634(v=vs.80)) structure is equivalent to the Windows **try-finally** statement.</span></span> <span data-ttu-id="9f138-106">Конструкция RPC Exception [**рпктрексцепт**](rpctryexcept.md)  /  [**рпцексцепт**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept)  /  [**рпцендексцепт**](/previous-versions/aa375629(v=vs.80)) эквивалентна инструкции **try, except** .</span><span class="sxs-lookup"><span data-stu-id="9f138-106">The RPC exception construct [**RpcTryExcept**](rpctryexcept.md) / [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) / [**RpcEndExcept**](/previous-versions/aa375629(v=vs.80)) is equivalent to the Windows **try-except** statement.</span></span>

<span data-ttu-id="9f138-107">При использовании обработчиков исключений RPC исходный код на стороне клиента является переносимым.</span><span class="sxs-lookup"><span data-stu-id="9f138-107">When you use the RPC exception handlers, your client-side source code is portable.</span></span> <span data-ttu-id="9f138-108">Различные файлы заголовков RPC, предоставляемые для каждой платформы, разрешают макросы **рпктри** и [**рпцексцепт**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) для каждой платформы.</span><span class="sxs-lookup"><span data-stu-id="9f138-108">The different RPC header files provided for each platform resolve the **RpcTry** and [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) macros for each platform.</span></span> <span data-ttu-id="9f138-109">В среде Windows эти макросы напрямую сопоставляются с инструкциями **try-finally** и **try-except** .</span><span class="sxs-lookup"><span data-stu-id="9f138-109">In the Windows environment, these macros map directly to the Windows **try-finally** and **try-except** statements.</span></span> <span data-ttu-id="9f138-110">В других средах эти макросы соответствуют другим реализациям обработчиков исключений для конкретной платформы.</span><span class="sxs-lookup"><span data-stu-id="9f138-110">In other environments, these macros map to other platform-specific implementations of exception handlers.</span></span>

<span data-ttu-id="9f138-111">Потенциальные исключения, создаваемые этими структурами, включают набор кодов ошибок, возвращаемых функциями RPC, с префиксами RPC \_ S \_ и RPC \_ X, а также набором исключений, возвращаемых Windows.</span><span class="sxs-lookup"><span data-stu-id="9f138-111">Potential exceptions raised by these structures include the set of error codes returned by the RPC functions with the prefixes RPC\_S\_ and RPC\_X and the set of exceptions returned by Windows.</span></span> <span data-ttu-id="9f138-112">Дополнительные сведения см. в разделе [возвращаемые значения RPC](rpc-return-values.md).</span><span class="sxs-lookup"><span data-stu-id="9f138-112">For details, see [RPC Return Values](rpc-return-values.md).</span></span>

<span data-ttu-id="9f138-113">Хотя макросы **рпктри** и [**рпцексцепт**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) предоставляют настраиваемую платформу для обработки исключений в Windows Vista и более поздних версиях Windows, [**рпцексцептионфилтер**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcexceptionfilter) является рекомендуемым способом обработки исключений.</span><span class="sxs-lookup"><span data-stu-id="9f138-113">While the **RpcTry** and [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) macros provide a customizable platform-agnostic way to handle exceptions, in Windows Vista and later versions of Windows, [**RpcExceptionFilter**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcexceptionfilter) is the recommended way of handling exceptions.</span></span> <span data-ttu-id="9f138-114">Для записи многих наиболее распространенных структурных исключений не требуется записывать пользовательские фильтры. Однако для пользовательских фильтров исключений по-прежнему требуется **рпцексцепт**.</span><span class="sxs-lookup"><span data-stu-id="9f138-114">It does not require custom filters to be written to capture many of the most common structured exceptions; however, custom exception filters still require **RpcExcept**.</span></span>

<span data-ttu-id="9f138-115">Исключения, возникающие в серверном приложении, заглушке сервера и библиотеке времени выполнения сервера (над транспортным уровнем), распространяются на клиент.</span><span class="sxs-lookup"><span data-stu-id="9f138-115">Exceptions that occur in the server application, server stub, and server run-time library (above the transport layer) are propagated to the client.</span></span> <span data-ttu-id="9f138-116">Исключения не распространяются с транспортного уровня сервера.</span><span class="sxs-lookup"><span data-stu-id="9f138-116">No exceptions are propagated from the server-transport level.</span></span> <span data-ttu-id="9f138-117">Рекомендуемым методом для серверной процедуры, возвращающей ошибки во время выполнения RPC, является исключение.</span><span class="sxs-lookup"><span data-stu-id="9f138-117">The recommended method for a server routine to return errors to the RPC run time is to throw an exception.</span></span> <span data-ttu-id="9f138-118">Серверная процедура может использовать любые методы, подходящие для обмена сообщениями между серверными процедурами, но если возникает ошибка, которая не позволяет ей выполнить удаленную процедуру, она должна вызвать исключение после очистки и перед возвратом к времени выполнения RPC, вместо того чтобы возвращать значение RPC, которое только серверная процедура распознает как ошибку.</span><span class="sxs-lookup"><span data-stu-id="9f138-118">A server routine can use whatever methods is appropriate for communicating errors between server routines, but if it encounters an error that prevents it from executing the remote procedure, it should raise an exception after cleaning up and before returning to the RPC run time, rather than returning a value to RPC that only the server routine recognizes as an error.</span></span>

<span data-ttu-id="9f138-119">На следующем рисунке показано, как исключения возвращаются с сервера клиенту.</span><span class="sxs-lookup"><span data-stu-id="9f138-119">The following figure shows how exceptions are returned from the server to the client.</span></span>

![исключения возвращаются с сервера клиенту через соответствующую среду выполнения RPC каждого компонента.](images/prog-a20.png)

<span data-ttu-id="9f138-121">Обработчики исключений RPC немного отличаются от открытых программных Foundation-Distributed вычислительной среды (использование-DCE), обрабатывающих исключения. **попробуйте**, **наконец** и **перехватите**.</span><span class="sxs-lookup"><span data-stu-id="9f138-121">The RPC exception handlers differ slightly from the Open Software Foundation-Distributed Computing Environment (OSF-DCE) exception-handling macros **TRY**, **FINALLY**, and **CATCH**.</span></span> <span data-ttu-id="9f138-122">Различные поставщики предоставляют включаемые файлы, которые сопоставляют функции использование-DCE RPC с функциями Microsoft RPC, включая **try**, **catch**, **catch** \_ и **ендтри**.</span><span class="sxs-lookup"><span data-stu-id="9f138-122">Various vendors provide include files that map the OSF-DCE RPC functions to the Microsoft RPC functions, including **TRY**, **CATCH**, **CATCH**\_**ALL**, and **ENDTRY**.</span></span> <span data-ttu-id="9f138-123">Эти файлы заголовков также сопоставляют \_ \_ \* коды ошибок RPC s с аналогами исключений использование-DCE, RPC \_ S \_ \* и сопоставляют \_ \_ \* коды ошибок RPC x с RPC \_ x \_ \* .</span><span class="sxs-lookup"><span data-stu-id="9f138-123">These header files also map the RPC\_S\_\* error codes onto the OSF-DCE exception counterparts, rpc\_s\_\*, and map RPC\_X\_\* error codes to rpc\_x\_\*.</span></span> <span data-ttu-id="9f138-124">Для переносимости использование-DCE используйте следующие включаемые файлы.</span><span class="sxs-lookup"><span data-stu-id="9f138-124">For OSF-DCE portability, use these include files.</span></span> <span data-ttu-id="9f138-125">Дополнительные сведения об обработчиках исключений RPC см. в разделе [**рпцексцептионфилтер**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcexceptionfilter), [**рпцексцепт**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept), [**рпкфиналли**](/previous-versions/aa375699(v=vs.80)).</span><span class="sxs-lookup"><span data-stu-id="9f138-125">For more information about the RPC exception handlers, see [**RpcExceptionFilter**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcexceptionfilter), [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept), [**RpcFinally**](/previous-versions/aa375699(v=vs.80)).</span></span> <span data-ttu-id="9f138-126">Дополнительные сведения об обработчиках исключений Windows см. в разделе [структурированная обработка исключений](/windows/desktop/Debug/structured-exception-handling).</span><span class="sxs-lookup"><span data-stu-id="9f138-126">For more information about the Windows exception handlers, see [Structured Exception Handling](/windows/desktop/Debug/structured-exception-handling).</span></span>

 

 
