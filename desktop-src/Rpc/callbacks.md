---
title: Обратные вызовы (RPC)
description: Часто модель программирования требует обратного вызова сервера клиенту через удаленный вызов процедур (RPC) или вызов клиента на недоверенный сервер. В этом разделе представлено множество потенциальных ловушек.
ms.assetid: a4f3ea26-ac4b-41e5-abde-96b4baedf2ae
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6260e2cff2cbaff86f210764e89d55859c4d33af
ms.sourcegitcommit: 8fa6614b715bddf14648cce36d2df22e5232801a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2020
ms.locfileid: "104071029"
---
# <a name="callbacks-rpc"></a><span data-ttu-id="febd3-104">Обратные вызовы (RPC)</span><span class="sxs-lookup"><span data-stu-id="febd3-104">Callbacks (RPC)</span></span>

<span data-ttu-id="febd3-105">Часто модель программирования требует обратного вызова сервера клиенту через удаленный вызов процедур (RPC) или вызов клиента на недоверенный сервер.</span><span class="sxs-lookup"><span data-stu-id="febd3-105">Often the programming model necessitates a server callback to a client through a remote procedure call (RPC), or client calls into an untrusted server.</span></span> <span data-ttu-id="febd3-106">В этом разделе представлено множество потенциальных ловушек.</span><span class="sxs-lookup"><span data-stu-id="febd3-106">This introduces many potential pitfalls.</span></span>

<span data-ttu-id="febd3-107">Во-первых, необходимо выполнить обратный вызов клиента с достаточно низким уровнем олицетворения.</span><span class="sxs-lookup"><span data-stu-id="febd3-107">First, callback to the client must be made with a sufficiently low impersonation level.</span></span> <span data-ttu-id="febd3-108">Если сервер является системной службой с высоким уровнем привилегий, то при обращении к локальному клиенту с уровнем олицетворения олицетворения или выше может быть обеспечен достаточный уровень привилегий для получения доступа к системе.</span><span class="sxs-lookup"><span data-stu-id="febd3-108">If the server is a highly privileged system service, calling back a local client with an impersonation level of impersonate or higher can provide the client with privileges sufficient to take over the system.</span></span> <span data-ttu-id="febd3-109">Обратный вызов удаленного клиента с более высоким уровнем олицетворения также может привести к нежелательным последствиям.</span><span class="sxs-lookup"><span data-stu-id="febd3-109">Calling back a remote client with higher impersonation level than necessary can also lead to undesirable consequences.</span></span>

<span data-ttu-id="febd3-110">Во-вторых, если злоумышленник запустит службу для выполнения обратного вызова, она может запустить то, что называется *черным отверстием*— атакой типа "отказ в обслуживании".</span><span class="sxs-lookup"><span data-stu-id="febd3-110">Second, if an attacker induces your service to perform a callback, it can launch what is called a *black hole*—denial of service attack.</span></span> <span data-ttu-id="febd3-111">Такие атаки не относятся к RPC; в этих атаках компьютер вызывает отправку на него трафика, но не отвечает на запросы.</span><span class="sxs-lookup"><span data-stu-id="febd3-111">Such attacks are not specific to RPC; in these attacks, a machine induces you to send traffic to it, but it does not respond to your requests.</span></span> <span data-ttu-id="febd3-112">Вы перейдете на все больше ресурсов, чтобы вызвать Черное отверстие, но они никогда не будут возвращаться.</span><span class="sxs-lookup"><span data-stu-id="febd3-112">You sink more and more resources into calling the black hole, but they never come back.</span></span> <span data-ttu-id="febd3-113">Одним из универсальных примеров такой атаки является атака на уровне TCP, называемая атакой TCP/IP SYN Flood.</span><span class="sxs-lookup"><span data-stu-id="febd3-113">One generic example of such an attack is a TCP-level attack called a TCP/IP SYN flood attack.</span></span>

<span data-ttu-id="febd3-114">На уровне RPC простая атака с черными отверстиями возникает, когда злоумышленник вызывает интерфейс, и запрашивает сервер для вызова интерфейса обратно.</span><span class="sxs-lookup"><span data-stu-id="febd3-114">On the RPC level, a simple black-hole attack occurs when an attacker calls an interface, and requests the server to call the interface back.</span></span> <span data-ttu-id="febd3-115">Интерфейс соответствует, но злоумышленник никогда не возвращает вызов: один поток на сервере связан.</span><span class="sxs-lookup"><span data-stu-id="febd3-115">The interface complies, but the attacker never returns the call: one thread on the server is tied up.</span></span> <span data-ttu-id="febd3-116">Злоумышленник выполняет это 100 раз, занимая 100 потоков на сервере.</span><span class="sxs-lookup"><span data-stu-id="febd3-116">The attacker does this 100 times, tying 100 threads on the server.</span></span> <span data-ttu-id="febd3-117">В конечном итоге на сервере заканчивается память.</span><span class="sxs-lookup"><span data-stu-id="febd3-117">Eventually the server runs out of memory.</span></span> <span data-ttu-id="febd3-118">Отладка сервера потенциально может раскрыть удостоверение вызывающего его черного, но часто сервер будет перезапущен без подозрения на Фаул Play, или может быть недостаточно знаний для определения злоумышленника.</span><span class="sxs-lookup"><span data-stu-id="febd3-118">Debugging the server can potentially reveal the identity of the black-hole caller, but often the server will be restarted without suspecting foul play, or there may not be enough expertise available to determine the attacker.</span></span>

<span data-ttu-id="febd3-119">Третья ловушка находится на клиенте.</span><span class="sxs-lookup"><span data-stu-id="febd3-119">The third pitfall is on the client.</span></span> <span data-ttu-id="febd3-120">Часто клиент выполняет вызов сервера, уведомляя сервер о том, как вызвать его обратно (обычно это привязка строки), а затем ожидает от сервера вызова, который не принимает все вызовы на этой конечной точке, которые поступают от сервера.</span><span class="sxs-lookup"><span data-stu-id="febd3-120">Often a client makes a call to the server informing the server how to call it back (usually a string binding), and then waits for a call from the server to arrive, blindly accepting any call on that endpoint that claims to come from the server.</span></span> <span data-ttu-id="febd3-121">Протокол обратного вызова от сервера к клиенту должен включать некоторый механизм проверки, чтобы гарантировать, что когда обратный вызов передается клиенту, он на самом деле поступает на сервер.</span><span class="sxs-lookup"><span data-stu-id="febd3-121">The callback protocol from the server to the client should include some verification mechanism to ensure that when the callback comes to the client, it actually originated on the server.</span></span>

 

 




