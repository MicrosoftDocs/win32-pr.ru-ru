---
title: Регистрация интерфейсов
description: Регистрация интерфейса удаленного вызова процедур (RPC).
ms.assetid: c22e3fa8-98be-461a-b06d-292d3f655ffc
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 30ea9e851e8c9663c8f66d983d3400b1ee398a9d
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104252749"
---
# <a name="registering-interfaces"></a><span data-ttu-id="daf41-103">Регистрация интерфейсов</span><span class="sxs-lookup"><span data-stu-id="daf41-103">Registering Interfaces</span></span>

<span data-ttu-id="daf41-104">В этом разделе представлено подробное описание процесса регистрации интерфейса RPC.</span><span class="sxs-lookup"><span data-stu-id="daf41-104">This section presents a detailed discussion of the process of registering an RPC interface.</span></span>

<span data-ttu-id="daf41-105">Сведения в этом разделе представлены в следующих разделах:</span><span class="sxs-lookup"><span data-stu-id="daf41-105">The information in this section is presented in the following topics:</span></span>

-   [<span data-ttu-id="daf41-106">Функции регистрации интерфейса</span><span class="sxs-lookup"><span data-stu-id="daf41-106">Interface Registration Functions</span></span>](#interface-registration-functions)
-   [<span data-ttu-id="daf41-107">Векторы точки входа</span><span class="sxs-lookup"><span data-stu-id="daf41-107">Entry-Point Vectors</span></span>](#entry-point-vectors)
-   [<span data-ttu-id="daf41-108">Епвс Manager</span><span class="sxs-lookup"><span data-stu-id="daf41-108">Manager EPVs</span></span>](#manager-epvs)
-   [<span data-ttu-id="daf41-109">Регистрация одной реализации интерфейса</span><span class="sxs-lookup"><span data-stu-id="daf41-109">Registering a Single Implementation of an Interface</span></span>](#registering-a-single-implementation-of-an-interface)
-   [<span data-ttu-id="daf41-110">Регистрация нескольких реализаций интерфейса</span><span class="sxs-lookup"><span data-stu-id="daf41-110">Registering Multiple Implementations of an Interface</span></span>](#registering-multiple-implementations-of-an-interface)
-   [<span data-ttu-id="daf41-111">Правила вызова подпрограмм диспетчера</span><span class="sxs-lookup"><span data-stu-id="daf41-111">Rules for Invoking Manager Routines</span></span>](#rules-for-invoking-manager-routines)
-   [<span data-ttu-id="daf41-112">Отправка удаленного вызова процедуры в Server-Manager подпрограммы</span><span class="sxs-lookup"><span data-stu-id="daf41-112">Dispatching a Remote Procedure Call to a Server-Manager Routine</span></span>](#dispatching-a-remote-procedure-call-to-a-server-manager-routine)
-   [<span data-ttu-id="daf41-113">Предоставление собственной функции Object-Inquiry</span><span class="sxs-lookup"><span data-stu-id="daf41-113">Supplying Your Own Object-Inquiry Function</span></span>](#supplying-your-own-object-inquiry-function)

## <a name="interface-registration-functions"></a><span data-ttu-id="daf41-114">Функции регистрации интерфейса</span><span class="sxs-lookup"><span data-stu-id="daf41-114">Interface Registration Functions</span></span>

<span data-ttu-id="daf41-115">Серверы регистрируют свои интерфейсы, вызывая функцию [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) .</span><span class="sxs-lookup"><span data-stu-id="daf41-115">Servers register their interfaces by calling the [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) function.</span></span> <span data-ttu-id="daf41-116">Сложные серверные программы часто поддерживают более одного интерфейса.</span><span class="sxs-lookup"><span data-stu-id="daf41-116">Complex server programs often support more than one interface.</span></span> <span data-ttu-id="daf41-117">Серверные приложения должны вызывать эту функцию один раз для каждого поддерживаемого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="daf41-117">Server applications must call this function once for each interface they support.</span></span>

<span data-ttu-id="daf41-118">Кроме того, серверы могут поддерживать несколько версий одного интерфейса, каждый из которых имеет собственную реализацию функций интерфейса.</span><span class="sxs-lookup"><span data-stu-id="daf41-118">Also, servers can support multiple versions of the same interface, each with its own implementation of the interface's functions.</span></span> <span data-ttu-id="daf41-119">Если серверная программа делает это, необходимо предоставить набор точек входа.</span><span class="sxs-lookup"><span data-stu-id="daf41-119">If your server program does this, it must provide a set of entry points.</span></span> <span data-ttu-id="daf41-120">Точка входа — это подпрограммы диспетчера, которая отправляет вызовы для версии интерфейса.</span><span class="sxs-lookup"><span data-stu-id="daf41-120">An entry point is a manager routine that dispatches calls for a version of an interface.</span></span> <span data-ttu-id="daf41-121">Для каждой версии интерфейса должна быть одна точка входа.</span><span class="sxs-lookup"><span data-stu-id="daf41-121">There must be one entry point for each version of the interface.</span></span> <span data-ttu-id="daf41-122">Группа точек входа называется вектором точки входа.</span><span class="sxs-lookup"><span data-stu-id="daf41-122">The group of entry points is called an entry point vector.</span></span> <span data-ttu-id="daf41-123">Дополнительные сведения см. в разделе [векторы точки входа](#entry-point-vectors).</span><span class="sxs-lookup"><span data-stu-id="daf41-123">For details, see [Entry-Point Vectors](#entry-point-vectors).</span></span>

<span data-ttu-id="daf41-124">Кроме стандартной функции [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), RPC также поддерживает другие функции регистрации интерфейса.</span><span class="sxs-lookup"><span data-stu-id="daf41-124">In addition to the standard function [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), RPC also supports other interface registration functions.</span></span> <span data-ttu-id="daf41-125">Функция [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) расширяет возможности **рпксерверрегистериф** , позволяя задавать набор флагов регистрации (см. раздел [флаги регистрации интерфейса](interface-registration-flags.md)), максимальное количество одновременных запросов удаленного вызова процедур, которые может принимать сервер, и максимальный размер входящих блоков данных в байтах.</span><span class="sxs-lookup"><span data-stu-id="daf41-125">The [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) function extends the capabilities of **RpcServerRegisterIf** by enabling you to specify a set of registration flags (see [Interface Registration Flags](interface-registration-flags.md)), the maximum number of concurrent remote procedure call requests the server can accept, and the maximum size in bytes of incoming data blocks.</span></span>

<span data-ttu-id="daf41-126">Библиотека RPC также содержит функцию с именем [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex).</span><span class="sxs-lookup"><span data-stu-id="daf41-126">The RPC library also contains a function called [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex).</span></span> <span data-ttu-id="daf41-127">Как и функция [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) , эта функция регистрирует интерфейс.</span><span class="sxs-lookup"><span data-stu-id="daf41-127">Like the [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) function, this function registers an interface.</span></span> <span data-ttu-id="daf41-128">Эта функция также может использоваться в серверной программе для указания набора флагов регистрации (см. раздел [флаги регистрации интерфейса](interface-registration-flags.md)), максимального числа одновременных запросов удаленного вызова процедур, которые может принимать сервер, и функции обратного вызова безопасности.</span><span class="sxs-lookup"><span data-stu-id="daf41-128">Your server program can also use this function to specify a set of registration flags (see [Interface Registration Flags](interface-registration-flags.md)), the maximum number of concurrent remote procedure call requests the server can accept, and a security callback function.</span></span>

<span data-ttu-id="daf41-129">Функции [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)и [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) задают значения в таблице реестра внутреннего интерфейса.</span><span class="sxs-lookup"><span data-stu-id="daf41-129">The [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), and [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) functions set values in the internal interface registry table.</span></span> <span data-ttu-id="daf41-130">Эта таблица используется для соотнесения UUID интерфейса и UUID объекта с ЕПВ Manager.</span><span class="sxs-lookup"><span data-stu-id="daf41-130">This table is used to map the interface UUID and object UUIDs to a manager EPV.</span></span> <span data-ttu-id="daf41-131">Диспетчер ЕПВ — это массив указателей функций, который содержит ровно один указатель на функцию для каждого прототипа функции в интерфейсе, указанном в IDL-файле.</span><span class="sxs-lookup"><span data-stu-id="daf41-131">The manager EPV is an array of function pointers that contains exactly one function pointer for each function prototype in the interface specified in the IDL file.</span></span>

<span data-ttu-id="daf41-132">Сведения о предоставлении нескольких Епвс для предоставления нескольких реализаций интерфейса см. в разделе [реализации нескольких интерфейсов](#registering-multiple-implementations-of-an-interface).</span><span class="sxs-lookup"><span data-stu-id="daf41-132">For information on supplying multiple EPVs to provide multiple implementations of the interface, see [Multiple Interface Implementations](#registering-multiple-implementations-of-an-interface).</span></span>

<span data-ttu-id="daf41-133">Библиотека времени выполнения использует таблицу реестра интерфейса (задается вызовами функции [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)) и таблицей реестра объектов (задается вызовами функции [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype)), чтобы сопоставлять идентификаторы UUID интерфейса и объекта с указателем на функцию.</span><span class="sxs-lookup"><span data-stu-id="daf41-133">The run-time library uses the interface registry table (set by calls to the function [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)) and the object registry table (set by calls to the function [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype)) to map interface and object UUIDs to the function pointer.</span></span>

<span data-ttu-id="daf41-134">Если необходимо, чтобы программа сервера удалила интерфейс из реестра библиотеки времени выполнения RPC, вызовите функцию [**рпксерверунрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverunregisterif) .</span><span class="sxs-lookup"><span data-stu-id="daf41-134">When you want your server program to remove an interface from the RPC run-time library registry, call the [**RpcServerUnregisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverunregisterif) function.</span></span> <span data-ttu-id="daf41-135">После удаления интерфейса из реестра библиотека времени выполнения RPC больше не будет принимать новые вызовы для этого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="daf41-135">After the interface is removed from the registry, the RPC run-time library will no longer accept new calls for that interface.</span></span>

## <a name="entry-point-vectors"></a><span data-ttu-id="daf41-136">Векторы точки входа</span><span class="sxs-lookup"><span data-stu-id="daf41-136">Entry-point Vectors</span></span>

<span data-ttu-id="daf41-137">Вектор точки входа диспетчера (ЕПВ) — это массив указателей функций, указывающий на реализации функций, указанных в IDL-файле.</span><span class="sxs-lookup"><span data-stu-id="daf41-137">The manager entry-point vector (EPV) is an array of function pointers that point to implementations of the functions specified in the IDL file.</span></span> <span data-ttu-id="daf41-138">Число элементов в массиве соответствует числу функций, указанных в IDL-файле.</span><span class="sxs-lookup"><span data-stu-id="daf41-138">The number of elements in the array corresponds to the number of functions specified in the IDL file.</span></span> <span data-ttu-id="daf41-139">RPC поддерживает несколько векторов точки входа, представляющих несколько реализаций функций, указанных в интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="daf41-139">RPC supports multiple entry-point vectors representing multiple implementations of the functions specified in the interface.</span></span>

<span data-ttu-id="daf41-140">Компилятор MIDL автоматически создает тип данных ЕПВ Manager для использования в конструкции Епвс Manager.</span><span class="sxs-lookup"><span data-stu-id="daf41-140">The MIDL compiler automatically generates a manager EPV data type for use in constructing manager EPVs.</span></span> <span data-ttu-id="daf41-141">Тип данных имеет имя \* if-Name \***\_ Server \_ ЕПВ**, где *If-Name* указывает идентификатор интерфейса в файле IDL.</span><span class="sxs-lookup"><span data-stu-id="daf41-141">The data type is named \*if-name\***\_SERVER\_EPV**, where *if-name* specifies the interface identifier in the IDL file.</span></span>

<span data-ttu-id="daf41-142">Компилятор MIDL автоматически создает и инициализирует диспетчер по умолчанию, ЕПВ по предположении, что для каждой процедуры в интерфейсе существует процедура управления с таким же именем и указана в IDL-файле.</span><span class="sxs-lookup"><span data-stu-id="daf41-142">The MIDL compiler automatically creates and initializes a default manager EPV on the assumption that a manager routine of the same name exists for each procedure in the interface and is specified in the IDL file.</span></span>

<span data-ttu-id="daf41-143">Если сервер предлагает несколько реализаций одного интерфейса, сервер должен создать один дополнительный диспетчер ЕПВ для каждой реализации.</span><span class="sxs-lookup"><span data-stu-id="daf41-143">When a server offers multiple implementations of the same interface, the server must create one additional manager EPV for each implementation.</span></span> <span data-ttu-id="daf41-144">Каждый ЕПВ должен содержать ровно одну точку входа (адрес функции) для каждой процедуры, определенной в IDL-файле.</span><span class="sxs-lookup"><span data-stu-id="daf41-144">Each EPV must contain exactly one entry point (address of a function) for each procedure defined in the IDL file.</span></span> <span data-ttu-id="daf41-145">Серверное приложение объявляет и инициализирует одну переменную ЕПВ Manager типа *If-Name \* \* \* \_ Server \_ ЕПВ*\* для каждой дополнительной реализации интерфейса.</span><span class="sxs-lookup"><span data-stu-id="daf41-145">The server application declares and initializes one manager EPV variable of type *if-name\*\*\*\_SERVER\_EPV*\* for each additional implementation of the interface.</span></span> <span data-ttu-id="daf41-146">Чтобы зарегистрировать Епвс, он вызывает [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) один раз для каждого поддерживаемого типа объекта.</span><span class="sxs-lookup"><span data-stu-id="daf41-146">To register the EPVs it calls [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) once for each object type it supports.</span></span>

<span data-ttu-id="daf41-147">Когда клиент выполняет удаленный вызов процедуры на сервере, ЕПВ, содержащий указатель на функцию, выбирается на основе идентификатора UUID интерфейса и типа объекта.</span><span class="sxs-lookup"><span data-stu-id="daf41-147">When the client makes a remote procedure call to the server, the EPV containing the function pointer is selected based on the interface UUID and the object type.</span></span> <span data-ttu-id="daf41-148">Тип объекта является производным от UUID объекта с помощью функции Object-запроса или сопоставления, управляемого табличным сопоставлением, управляемым [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype).</span><span class="sxs-lookup"><span data-stu-id="daf41-148">The object type is derived from the object UUID by the object-inquiry function or the table-driven mapping controlled by [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype).</span></span>

## <a name="manager-epvs"></a><span data-ttu-id="daf41-149">Епвс Manager</span><span class="sxs-lookup"><span data-stu-id="daf41-149">Manager EPVs</span></span>

<span data-ttu-id="daf41-150">По умолчанию компилятор MIDL использует имена процедур из IDL-файла интерфейса для создания диспетчера ЕПВ, который компилятор помещает непосредственно в серверную заглушку.</span><span class="sxs-lookup"><span data-stu-id="daf41-150">By default, the MIDL compiler uses the procedure names from an interface's IDL file to generate a manager EPV, which the compiler places directly into the server stub.</span></span> <span data-ttu-id="daf41-151">Этот ЕПВ по умолчанию статически инициализируется с помощью имен процедур, объявленных в определении интерфейса.</span><span class="sxs-lookup"><span data-stu-id="daf41-151">This default EPV is statically initialized using the procedure names declared in the interface definition.</span></span>

<span data-ttu-id="daf41-152">Чтобы зарегистрировать Диспетчер с помощью ЕПВ по умолчанию, укажите значение **null** в качестве значения параметра *мгрепв* в вызове функции [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) .</span><span class="sxs-lookup"><span data-stu-id="daf41-152">To register a manager using the default EPV, specify **NULL** as the value of the *MgrEpv* parameter in a call to either the [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) function.</span></span> <span data-ttu-id="daf41-153">Если имена подпрограмм, используемые диспетчером, соответствуют параметрам определения интерфейса, этот диспетчер можно зарегистрировать с помощью ЕПВ по умолчанию интерфейса, созданного компилятором MIDL.</span><span class="sxs-lookup"><span data-stu-id="daf41-153">If the routine names used by a manager correspond to those of the interface definition, you can register this manager using the default EPV of the interface generated by the MIDL compiler.</span></span> <span data-ttu-id="daf41-154">Вы также можете зарегистрировать менеджера с помощью ЕПВ, предоставляемого серверным приложением.</span><span class="sxs-lookup"><span data-stu-id="daf41-154">You can also register a manager using an EPV that the server application supplies.</span></span>

<span data-ttu-id="daf41-155">Сервер может (и иногда должен) создавать и регистрировать ЕПВ Manager, отличный от **null** , для интерфейса.</span><span class="sxs-lookup"><span data-stu-id="daf41-155">A server can (and sometimes must) create and register a non-**null** manager EPV for an interface.</span></span> <span data-ttu-id="daf41-156">Чтобы выбрать предоставленное серверное приложение ЕПВ, передайте адрес ЕПВ, значение которого было объявлено сервером в качестве значения параметра *мгрепв* a.</span><span class="sxs-lookup"><span data-stu-id="daf41-156">To select a server application–supplied EPV, pass the address of an EPV whose value has been declared by the server as the value of the *MgrEpv* a parameter.</span></span> <span data-ttu-id="daf41-157">Значение, отличное от **null** , для параметра *мгрепв* всегда переопределяет ЕПВ по умолчанию в заглушке сервера.</span><span class="sxs-lookup"><span data-stu-id="daf41-157">A non-**null** value for the *MgrEpv* a parameter always overrides a default EPV in the server stub.</span></span>

<span data-ttu-id="daf41-158">Компилятор MIDL автоматически создает тип данных ЕПВ диспетчера (RPC Manager \_ \_ ЕПВ) для серверного приложения, которое используется в конструировании диспетчера епвс.</span><span class="sxs-lookup"><span data-stu-id="daf41-158">The MIDL compiler automatically generates a manager EPV data type (RPC\_MGR\_EPV) for a server application to use in constructing manager EPVs.</span></span> <span data-ttu-id="daf41-159">ЕПВ Manager должен содержать ровно одну точку входа (адрес функции) для каждой процедуры, определенной в IDL-файле.</span><span class="sxs-lookup"><span data-stu-id="daf41-159">A manager EPV must contain exactly one entry point (function address) for each procedure defined in the IDL file.</span></span>

<span data-ttu-id="daf41-160">Сервер должен предоставить ЕПВ, не **равный null** , в следующих случаях:</span><span class="sxs-lookup"><span data-stu-id="daf41-160">A server must supply a non-**null** EPV in the following cases:</span></span>

-   <span data-ttu-id="daf41-161">Когда имена подпрограмм диспетчера отличаются от имен процедур, объявленных в определении интерфейса</span><span class="sxs-lookup"><span data-stu-id="daf41-161">When the names of manager routines differ from the procedure names declared in the interface definition</span></span>
-   <span data-ttu-id="daf41-162">Когда сервер использует ЕПВ по умолчанию для регистрации другой реализации интерфейса</span><span class="sxs-lookup"><span data-stu-id="daf41-162">When the server uses the default EPV for registering another implementation of the interface</span></span>

<span data-ttu-id="daf41-163">Сервер объявляет ЕПВ Manager, инициализируя переменную типа *If-Name \* \* \* \_ Server \_ ЕПВ*\* для каждой реализации интерфейса.</span><span class="sxs-lookup"><span data-stu-id="daf41-163">A server declares a manager EPV by initializing a variable of type *if-name\*\*\*\_SERVER\_EPV*\* for each implementation of the interface.</span></span>

## <a name="registering-a-single-implementation-of-an-interface"></a><span data-ttu-id="daf41-164">Регистрация одной реализации интерфейса</span><span class="sxs-lookup"><span data-stu-id="daf41-164">Registering a Single Implementation of an Interface</span></span>

<span data-ttu-id="daf41-165">Если сервер предлагает только одну реализацию интерфейса, сервер вызывает [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) только один раз.</span><span class="sxs-lookup"><span data-stu-id="daf41-165">When a server offers only one implementation of an interface, the server calls [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) only once.</span></span> <span data-ttu-id="daf41-166">В стандартном случае сервер использует диспетчер ЕПВ по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="daf41-166">In the standard case, the server uses the default manager EPV.</span></span> <span data-ttu-id="daf41-167">(Исключением является то, что диспетчер использует имена подпрограмм, отличающиеся от объявленных в интерфейсе.)</span><span class="sxs-lookup"><span data-stu-id="daf41-167">(The exception is when the manager uses routine names that differ from those declared in the interface.)</span></span>

<span data-ttu-id="daf41-168">В стандартном случае для вызовов [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)указываются следующие значения:</span><span class="sxs-lookup"><span data-stu-id="daf41-168">For the standard case, you supply the following values for calls to [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2):</span></span>

-   <span data-ttu-id="daf41-169">Епвс Manager</span><span class="sxs-lookup"><span data-stu-id="daf41-169">Manager EPVs</span></span>

    <span data-ttu-id="daf41-170">Чтобы использовать ЕПВ по умолчанию, укажите значение **null** для параметра *мгрепв* a.</span><span class="sxs-lookup"><span data-stu-id="daf41-170">To use the default EPV, specify a **null** value for the *MgrEpv* a parameter.</span></span>

-   <span data-ttu-id="daf41-171">UUID типа диспетчера</span><span class="sxs-lookup"><span data-stu-id="daf41-171">Manager type UUID</span></span>

    <span data-ttu-id="daf41-172">При использовании ЕПВ по умолчанию Зарегистрируйте интерфейс с ненулевым ИДЕНТИФИКАТОРом типа Manager, указав значение **null** или нуль-UUID для параметра *мгртипеууид* a.</span><span class="sxs-lookup"><span data-stu-id="daf41-172">When using the default EPV, register the interface with a nil manager type UUID by supplying either a **null** value or a nil UUID for the *MgrTypeUuid* a parameter.</span></span> <span data-ttu-id="daf41-173">В этом случае все удаленные вызовы процедур, независимо от UUID объекта в их маркере привязки, отправляются в ЕПВ по умолчанию, предполагая, что вызовы [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) не были выполнены.</span><span class="sxs-lookup"><span data-stu-id="daf41-173">In this case, all remote procedure calls, regardless of the object UUID in their binding handle, are dispatched to the default EPV, assuming no [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) calls have been made.</span></span>

    <span data-ttu-id="daf41-174">Можно также указать UUID типа, отличного от nil.</span><span class="sxs-lookup"><span data-stu-id="daf41-174">You can also provide a non-nil manager type UUID.</span></span> <span data-ttu-id="daf41-175">В этом случае необходимо также вызвать подпрограммы [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) .</span><span class="sxs-lookup"><span data-stu-id="daf41-175">In this case, you must also call the [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) routine.</span></span>

## <a name="registering-multiple-implementations-of-an-interface"></a><span data-ttu-id="daf41-176">Регистрация нескольких реализаций интерфейса</span><span class="sxs-lookup"><span data-stu-id="daf41-176">Registering Multiple Implementations of an Interface</span></span>

<span data-ttu-id="daf41-177">Можно указать несколько реализаций удаленных процедур, указанных в IDL-файле.</span><span class="sxs-lookup"><span data-stu-id="daf41-177">You can supply more than one implementation of the remote procedure(s) specified in the IDL file.</span></span> <span data-ttu-id="daf41-178">Серверное приложение вызывает [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) для сопоставления идентификаторов UUID объекта с типами UUID и вызывает [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RPCSERVERREGISTERIF2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) для связывания диспетчера епвс с типом UUID.</span><span class="sxs-lookup"><span data-stu-id="daf41-178">The server application calls [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) to map object UUIDs to type UUIDs and calls [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) to associate manager EPVs with a type UUID.</span></span> <span data-ttu-id="daf41-179">Когда удаленный вызов процедуры прибывает к объекту UUID, Библиотека времени выполнения RPC-сервера сопоставляет UUID объекта с типом UUID.</span><span class="sxs-lookup"><span data-stu-id="daf41-179">When a remote procedure call arrives with its object UUID, the RPC server run-time library maps the object UUID to a type UUID.</span></span> <span data-ttu-id="daf41-180">Затем серверное приложение использует тип UUID и UUID интерфейса, чтобы выбрать диспетчер ЕПВ.</span><span class="sxs-lookup"><span data-stu-id="daf41-180">The server application then uses the type UUID and the interface UUID to select the manager EPV.</span></span>

<span data-ttu-id="daf41-181">Можно также указать собственную функцию для разрешения сопоставления из UUID объекта с ИДЕНТИФИКАТОРом типа диспетчера.</span><span class="sxs-lookup"><span data-stu-id="daf41-181">You can also specify your own function to resolve the mapping from object UUID to manager type UUID.</span></span> <span data-ttu-id="daf41-182">Функция сопоставления указывается при вызове [**рпкобжектсетинкфн**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsetinqfn).</span><span class="sxs-lookup"><span data-stu-id="daf41-182">You specify the mapping function when you call [**RpcObjectSetInqFn**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsetinqfn).</span></span>

<span data-ttu-id="daf41-183">Чтобы предложить несколько реализаций интерфейса, сервер должен зарегистрировать каждую реализацию, вызвав [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) отдельно.</span><span class="sxs-lookup"><span data-stu-id="daf41-183">To offer multiple implementations of an interface, a server must register each implementation by calling [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) separately.</span></span> <span data-ttu-id="daf41-184">Для каждой реализации, зарегистрированной сервером, предоставляется тот же *ифспек* параметра, но другая пара *мгртипеууид* и *мгрепв* параметров.</span><span class="sxs-lookup"><span data-stu-id="daf41-184">For each implementation a server registers, it supplies the same *IfSpec* a parameter, but a different pair of *MgrTypeUuid* and *MgrEpv* a parameters.</span></span>

<span data-ttu-id="daf41-185">В случае с несколькими диспетчерами используйте [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) следующим образом:</span><span class="sxs-lookup"><span data-stu-id="daf41-185">In the case of multiple managers, use [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) as follows:</span></span>

-   <span data-ttu-id="daf41-186">Епвс Manager</span><span class="sxs-lookup"><span data-stu-id="daf41-186">Manager EPVs</span></span>

    <span data-ttu-id="daf41-187">Чтобы предложить несколько реализаций интерфейса, сервер должен:</span><span class="sxs-lookup"><span data-stu-id="daf41-187">To offer multiple implementations of an interface, a server must:</span></span>

    -   <span data-ttu-id="daf41-188">Создайте ЕПВ Manager, отличный от **null** , для каждой дополнительной реализации.</span><span class="sxs-lookup"><span data-stu-id="daf41-188">Create a non-**null** manager EPV for each additional implementation.</span></span>
    -   <span data-ttu-id="daf41-189">Укажите значение, отличное от **null** , для *параметра мгрепв* в [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2).</span><span class="sxs-lookup"><span data-stu-id="daf41-189">Specify a non-**null** value for the *MgrEpv* a parameter in [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2).</span></span>

    <span data-ttu-id="daf41-190">Обратите внимание, что сервер также может зарегистрироваться в ЕПВ Manager по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="daf41-190">Please note that the server can also register with the default manager EPV.</span></span>

-   <span data-ttu-id="daf41-191">UUID типа диспетчера</span><span class="sxs-lookup"><span data-stu-id="daf41-191">Manager type UUID</span></span>

    <span data-ttu-id="daf41-192">Укажите идентификатор типа менеджера для каждого ЕПВ интерфейса.</span><span class="sxs-lookup"><span data-stu-id="daf41-192">Provide a manager type UUID for each EPV of the interface.</span></span> <span data-ttu-id="daf41-193">Для одного из Епвс Manager может быть задан нулевой тип UUID (или значение **null** ) для параметра *мгртипеууид* .</span><span class="sxs-lookup"><span data-stu-id="daf41-193">The nil type UUID (or **null** value) for the *MgrTypeUuid* a parameter can be specified for one of the manager EPVs.</span></span> <span data-ttu-id="daf41-194">Каждый тип UUID должен быть разным.</span><span class="sxs-lookup"><span data-stu-id="daf41-194">Each type UUID must be different.</span></span>

## <a name="rules-for-invoking-manager-routines"></a><span data-ttu-id="daf41-195">Правила вызова подпрограмм диспетчера</span><span class="sxs-lookup"><span data-stu-id="daf41-195">Rules for Invoking Manager Routines</span></span>

<span data-ttu-id="daf41-196">Библиотека времени выполнения RPC отправляет входящий вызов удаленной процедуры диспетчеру, который предлагает запрошенный интерфейс RPC.</span><span class="sxs-lookup"><span data-stu-id="daf41-196">The RPC run-time library dispatches an incoming remote procedure call to a manager that offers the requested RPC interface.</span></span> <span data-ttu-id="daf41-197">Если для интерфейса зарегистрировано несколько руководителей, Библиотека времени выполнения RPC должна выбрать один из них.</span><span class="sxs-lookup"><span data-stu-id="daf41-197">When multiple managers are registered for an interface, the RPC run-time library must select one of them.</span></span> <span data-ttu-id="daf41-198">Чтобы выбрать руководителя, Библиотека времени выполнения RPC использует объект UUID, указанный в маркере привязки вызова.</span><span class="sxs-lookup"><span data-stu-id="daf41-198">To select a manager, the RPC run-time library uses the object UUID specified by the call's binding handle.</span></span>

<span data-ttu-id="daf41-199">Библиотека времени выполнения применяет следующие правила при интерпретации UUID объекта удаленного вызова процедуры:</span><span class="sxs-lookup"><span data-stu-id="daf41-199">The run-time library applies the following rules when interpreting the object UUID of a remote procedure call:</span></span>

-   <span data-ttu-id="daf41-200">Идентификаторы UUID объекта nil</span><span class="sxs-lookup"><span data-stu-id="daf41-200">Nil object UUIDs</span></span>

    <span data-ttu-id="daf41-201">UUID объекта nil автоматически назначается тип UUID типа nil (недопустимый идентификатор UUID объекта nil в подпрограммы [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) ).</span><span class="sxs-lookup"><span data-stu-id="daf41-201">A nil object UUID is automatically assigned the nil type UUID (it is illegal to specify a nil object UUID in the [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) routine).</span></span> <span data-ttu-id="daf41-202">Таким образом, удаленный вызов процедуры, маркер привязки которого содержит пустой идентификатор объекта nil, автоматически отправляется диспетчеру, зарегистрированному с помощью nil UUID типа, если таковой имеется.</span><span class="sxs-lookup"><span data-stu-id="daf41-202">Therefore, a remote procedure call whose binding handle contains a nil object UUID is automatically dispatched to the manager registered with the nil type UUID, if any.</span></span>

-   <span data-ttu-id="daf41-203">Идентификаторы UUID объекта, отличные от nil</span><span class="sxs-lookup"><span data-stu-id="daf41-203">Non-nil object UUIDs</span></span>

    <span data-ttu-id="daf41-204">В принципе, удаленный вызов процедуры, маркер привязки которого содержит ненулевой объект UUID, должен обрабатываться диспетчером, UUID типа которого соответствует типу UUID объекта.</span><span class="sxs-lookup"><span data-stu-id="daf41-204">In principle, a remote procedure call whose binding handle contains a non-nil object UUID should be processed by a manager whose type UUID matches the type of the object UUID.</span></span> <span data-ttu-id="daf41-205">Однако для определения правильного диспетчера необходимо, чтобы сервер указал тип UUID объекта, вызвав подпрограммы [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) .</span><span class="sxs-lookup"><span data-stu-id="daf41-205">However, identifying the correct manager requires that the server has specified the type of that object UUID by calling the [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) routine.</span></span>

    <span data-ttu-id="daf41-206">Если серверу не удается вызвать подпрограммы [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) для идентификатора UUID объекта, отличного от nil, удаленный вызов процедуры для этого UUID объекта перейдет к диспетчеру ЕПВ, который выполняет удаленный вызов процедур с ненулевым UUID объекта (т. е. UUID типа nil).</span><span class="sxs-lookup"><span data-stu-id="daf41-206">If a server fails to call the [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) routine for a non-nil object UUID, a remote procedure call for that object UUID goes to the manager EPV that services remote procedure calls with a nil object UUID (that is, the nil type UUID).</span></span>

    <span data-ttu-id="daf41-207">Удаленные вызовы процедур с UUID объекта, отличного от nil, в маркере привязки не могут быть выполнены, если серверу назначено значение UUID типа, отличное от nil, путем вызова подпрограммы [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) , но не зарегистрировали ЕПВ Manager для этого типа UUID, вызвав [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2).</span><span class="sxs-lookup"><span data-stu-id="daf41-207">Remote procedure calls with a non-nil object UUID in the binding handle cannot be executed if the server assigned that non-nil object UUID a type UUID by calling the [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) routine, but did not also register a manager EPV for that type UUID by calling [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2).</span></span>

<span data-ttu-id="daf41-208">В следующей таблице перечислены действия, которые библиотека времени выполнения использует для выбора подпрограммы диспетчера.</span><span class="sxs-lookup"><span data-stu-id="daf41-208">The following table summarizes the actions that the run-time library uses to select the manager routine.</span></span>



| <span data-ttu-id="daf41-209">UUID объекта Call</span><span class="sxs-lookup"><span data-stu-id="daf41-209">Object UUID of call</span></span> | <span data-ttu-id="daf41-210">Тип набора серверов для объекта UUID?</span><span class="sxs-lookup"><span data-stu-id="daf41-210">Server set type for object UUID?</span></span> | <span data-ttu-id="daf41-211">Зарегистрированный сервер тип ЕПВ?</span><span class="sxs-lookup"><span data-stu-id="daf41-211">Server registered EPV type?</span></span> | <span data-ttu-id="daf41-212">Действие диспетчеризации</span><span class="sxs-lookup"><span data-stu-id="daf41-212">Dispatching action</span></span>                                                                                                                                 |
|---------------------|----------------------------------|-----------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="daf41-213">Указатель</span><span class="sxs-lookup"><span data-stu-id="daf41-213">Nil</span></span>                 | <span data-ttu-id="daf41-214">Неприменимо</span><span class="sxs-lookup"><span data-stu-id="daf41-214">Not applicable</span></span>                   | <span data-ttu-id="daf41-215">Да</span><span class="sxs-lookup"><span data-stu-id="daf41-215">Yes</span></span>                         | <span data-ttu-id="daf41-216">Использует диспетчер с пустым типом UUID.</span><span class="sxs-lookup"><span data-stu-id="daf41-216">Uses the manager with the nil type UUID.</span></span>                                                                                                           |
| <span data-ttu-id="daf41-217">Указатель</span><span class="sxs-lookup"><span data-stu-id="daf41-217">Nil</span></span>                 | <span data-ttu-id="daf41-218">Неприменимо</span><span class="sxs-lookup"><span data-stu-id="daf41-218">Not applicable</span></span>                   | <span data-ttu-id="daf41-219">Нет</span><span class="sxs-lookup"><span data-stu-id="daf41-219">No</span></span>                          | <span data-ttu-id="daf41-220">Ошибка ( \_ \_ неподдерживаемый тип RPC S \_ ); отклоняет удаленный вызов процедуры.</span><span class="sxs-lookup"><span data-stu-id="daf41-220">Error (RPC\_S\_UNSUPPORTED\_TYPE); rejects the remote procedure call.</span></span>                                                                              |
| <span data-ttu-id="daf41-221">Не nil</span><span class="sxs-lookup"><span data-stu-id="daf41-221">Non-nil</span></span>             | <span data-ttu-id="daf41-222">Да</span><span class="sxs-lookup"><span data-stu-id="daf41-222">Yes</span></span>                              | <span data-ttu-id="daf41-223">Да</span><span class="sxs-lookup"><span data-stu-id="daf41-223">Yes</span></span>                         | <span data-ttu-id="daf41-224">Использует диспетчер с одинаковым UUID типа.</span><span class="sxs-lookup"><span data-stu-id="daf41-224">Uses the manager with the same type UUID.</span></span>                                                                                                          |
| <span data-ttu-id="daf41-225">Не nil</span><span class="sxs-lookup"><span data-stu-id="daf41-225">Non-nil</span></span>             | <span data-ttu-id="daf41-226">нет</span><span class="sxs-lookup"><span data-stu-id="daf41-226">No</span></span>                               | <span data-ttu-id="daf41-227">Не учитывается</span><span class="sxs-lookup"><span data-stu-id="daf41-227">Ignored</span></span>                     | <span data-ttu-id="daf41-228">Использует диспетчер с пустым типом UUID.</span><span class="sxs-lookup"><span data-stu-id="daf41-228">Uses the manager with the nil type UUID.</span></span> <span data-ttu-id="daf41-229">Если нет диспетчера с пустым типом UUID, ошибка (RPC \_ S \_ унсуппортедтипе); отклоняет удаленный вызов процедуры.</span><span class="sxs-lookup"><span data-stu-id="daf41-229">If no manager with the nil type UUID, error (RPC\_S\_UNSUPPORTEDTYPE); rejects the remote procedure call.</span></span> |
| <span data-ttu-id="daf41-230">Не nil</span><span class="sxs-lookup"><span data-stu-id="daf41-230">Non-nil</span></span>             | <span data-ttu-id="daf41-231">Да</span><span class="sxs-lookup"><span data-stu-id="daf41-231">Yes</span></span>                              | <span data-ttu-id="daf41-232">Нет</span><span class="sxs-lookup"><span data-stu-id="daf41-232">No</span></span>                          | <span data-ttu-id="daf41-233">Ошибка (RPC \_ S \_ унсуппортедтипе); отклоняет удаленный вызов процедуры.</span><span class="sxs-lookup"><span data-stu-id="daf41-233">Error (RPC\_S\_UNSUPPORTEDTYPE); rejects the remote procedure call.</span></span>                                                                                |



 

<span data-ttu-id="daf41-234">Идентификатором UUID вызова является объект UUID, обнаруженный в маркере привязки для удаленного вызова процедуры.</span><span class="sxs-lookup"><span data-stu-id="daf41-234">The object UUID of the call is the object UUID found in a binding handle for a remote procedure call.</span></span>

<span data-ttu-id="daf41-235">Сервер задает тип UUID объекта, вызывая [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) , чтобы указать тип UUID для объекта.</span><span class="sxs-lookup"><span data-stu-id="daf41-235">The server sets the type of the object UUID by calling [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) to specify the type UUID for an object.</span></span>

<span data-ttu-id="daf41-236">Сервер регистрирует тип для диспетчера ЕПВ, вызывая [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) , используя тот же тип UUID.</span><span class="sxs-lookup"><span data-stu-id="daf41-236">The server registers the type for the manager EPV by calling [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) using the same type UUID.</span></span>

> [!Note]  
> <span data-ttu-id="daf41-237">UUID объекта nil всегда автоматически назначается тип UUID типа nil.</span><span class="sxs-lookup"><span data-stu-id="daf41-237">The nil object UUID is always automatically assigned the nil type UUID.</span></span> <span data-ttu-id="daf41-238">Недопустимо указывать UUID объекта nil в подпрограммы [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) .</span><span class="sxs-lookup"><span data-stu-id="daf41-238">It is illegal to specify a nil object UUID in the [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) routine.</span></span>

 

## <a name="dispatching-a-remote-procedure-call-to-a-server-manager-routine"></a><span data-ttu-id="daf41-239">Отправка удаленного вызова процедуры в подпрограммы диспетчера сервера</span><span class="sxs-lookup"><span data-stu-id="daf41-239">Dispatching a Remote Procedure Call to a Server-manager Routine</span></span>

<span data-ttu-id="daf41-240">В следующих таблицах показаны действия, выполняемые библиотекой времени выполнения RPC для отправки удаленного вызова процедур в подпрограммы диспетчера сервера.</span><span class="sxs-lookup"><span data-stu-id="daf41-240">The following tables show the steps that the RPC run-time library takes to dispatch a remote procedure call to a server-manager routine.</span></span>

<span data-ttu-id="daf41-241">Простой случай, когда сервер регистрирует диспетчер по умолчанию ЕПВ, описан в следующих таблицах.</span><span class="sxs-lookup"><span data-stu-id="daf41-241">A simple case where the server registers the default manager EPV, is described in the following tables.</span></span>

<span data-ttu-id="daf41-242">**Таблица реестра интерфейса**</span><span class="sxs-lookup"><span data-stu-id="daf41-242">**Interface Registry Table**</span></span>



| <span data-ttu-id="daf41-243">UUID интерфейса</span><span class="sxs-lookup"><span data-stu-id="daf41-243">Interface UUID</span></span> | <span data-ttu-id="daf41-244">UUID типа диспетчера</span><span class="sxs-lookup"><span data-stu-id="daf41-244">Manager type UUID</span></span> | <span data-ttu-id="daf41-245">Вектор точки входа</span><span class="sxs-lookup"><span data-stu-id="daf41-245">Entry-point vector</span></span> |
|----------------|-------------------|--------------------|
| <span data-ttu-id="daf41-246">*uuid1*</span><span class="sxs-lookup"><span data-stu-id="daf41-246">*uuid1*</span></span>        | <span data-ttu-id="daf41-247">Указатель</span><span class="sxs-lookup"><span data-stu-id="daf41-247">Nil</span></span>               | <span data-ttu-id="daf41-248">ЕПВ по умолчанию</span><span class="sxs-lookup"><span data-stu-id="daf41-248">Default EPV</span></span>        |



 

<span data-ttu-id="daf41-249">**Таблица реестра объектов**</span><span class="sxs-lookup"><span data-stu-id="daf41-249">**Object Registry Table**</span></span>



| <span data-ttu-id="daf41-250">UUID объекта</span><span class="sxs-lookup"><span data-stu-id="daf41-250">Object UUID</span></span>             | <span data-ttu-id="daf41-251">Тип объекта</span><span class="sxs-lookup"><span data-stu-id="daf41-251">Object type</span></span> |
|-------------------------|-------------|
| <span data-ttu-id="daf41-252">Указатель</span><span class="sxs-lookup"><span data-stu-id="daf41-252">Nil</span></span>                     | <span data-ttu-id="daf41-253">Указатель</span><span class="sxs-lookup"><span data-stu-id="daf41-253">Nil</span></span>         |
| <span data-ttu-id="daf41-254">(Любой другой идентификатор объекта)</span><span class="sxs-lookup"><span data-stu-id="daf41-254">(Any other object UUID)</span></span> | <span data-ttu-id="daf41-255">Указатель</span><span class="sxs-lookup"><span data-stu-id="daf41-255">Nil</span></span>         |



 

<span data-ttu-id="daf41-256">**Сопоставление маркера привязки с вектором точки входа (ЕПВ)**</span><span class="sxs-lookup"><span data-stu-id="daf41-256">**Mapping the Binding Handle to an Entry-point Vector (EPV)**</span></span>



| <span data-ttu-id="daf41-257">UUID интерфейса (из клиентского маркера привязки)</span><span class="sxs-lookup"><span data-stu-id="daf41-257">Interface UUID (from client binding handle)</span></span> | <span data-ttu-id="daf41-258">UUID объекта (из клиентского маркера привязки)</span><span class="sxs-lookup"><span data-stu-id="daf41-258">Object UUID (from client binding handle)</span></span> | <span data-ttu-id="daf41-259">Тип объекта (из таблицы реестра объектов)</span><span class="sxs-lookup"><span data-stu-id="daf41-259">Object type (from object registry table)</span></span> | <span data-ttu-id="daf41-260">Диспетчер ЕПВ (из таблицы реестра интерфейса)</span><span class="sxs-lookup"><span data-stu-id="daf41-260">Manager EPV (from interface registry table)</span></span> |
|---------------------------------------------|------------------------------------------|------------------------------------------|---------------------------------------------|
| <span data-ttu-id="daf41-261">*uuid1*</span><span class="sxs-lookup"><span data-stu-id="daf41-261">*uuid1*</span></span>                                     | <span data-ttu-id="daf41-262">Указатель</span><span class="sxs-lookup"><span data-stu-id="daf41-262">Nil</span></span>                                      | <span data-ttu-id="daf41-263">Указатель</span><span class="sxs-lookup"><span data-stu-id="daf41-263">Nil</span></span>                                      | <span data-ttu-id="daf41-264">ЕПВ по умолчанию</span><span class="sxs-lookup"><span data-stu-id="daf41-264">Default EPV</span></span>                                 |
| <span data-ttu-id="daf41-265">То же, что и выше</span><span class="sxs-lookup"><span data-stu-id="daf41-265">Same as above</span></span>                               | <span data-ttu-id="daf41-266">*UUID*</span><span class="sxs-lookup"><span data-stu-id="daf41-266">*uuidA*</span></span>                                  | <span data-ttu-id="daf41-267">Указатель</span><span class="sxs-lookup"><span data-stu-id="daf41-267">Nil</span></span>                                      | <span data-ttu-id="daf41-268">ЕПВ по умолчанию</span><span class="sxs-lookup"><span data-stu-id="daf41-268">Default EPV</span></span>                                 |



 

<span data-ttu-id="daf41-269">Следующие шаги описывают действия, выполняемые библиотекой времени выполнения RPC-сервера, как показано в предыдущих таблицах, когда клиент с UUID интерфейса *uuid1* вызывает его.</span><span class="sxs-lookup"><span data-stu-id="daf41-269">The following steps describe the actions that the RPC server's run-time library take, as shown in the preceding tables, when a client with interface UUID *uuid1* calls it.</span></span>

1.  <span data-ttu-id="daf41-270">Сервер вызывает [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) , чтобы связать интерфейс, который он предлагает, с идентификатором UUID типа Manager и с созданным по умолчанию диспетчером MIDL ЕПВ.</span><span class="sxs-lookup"><span data-stu-id="daf41-270">The server calls [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) to associate an interface it offers with the nil manager type UUID and with the MIDL-generated default manager EPV.</span></span> <span data-ttu-id="daf41-271">Этот вызов добавляет запись в таблицу реестра интерфейса.</span><span class="sxs-lookup"><span data-stu-id="daf41-271">This call adds an entry in the interface registry table.</span></span> <span data-ttu-id="daf41-272">UUID интерфейса содержится в параметре *ифспек* .</span><span class="sxs-lookup"><span data-stu-id="daf41-272">The interface UUID is contained in the *IfSpec* a parameter.</span></span>
2.  <span data-ttu-id="daf41-273">По умолчанию таблица реестра объектов связывает все ИДЕНТИФИКАТОРы объектов с пустым типом UUID.</span><span class="sxs-lookup"><span data-stu-id="daf41-273">By default, the object registry table associates all object UUIDs with the nil type UUID.</span></span> <span data-ttu-id="daf41-274">В этом примере сервер не вызывает [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype).</span><span class="sxs-lookup"><span data-stu-id="daf41-274">In this example, the server does not call [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype).</span></span>
3.  <span data-ttu-id="daf41-275">Серверная библиотека времени выполнения получает код удаленной процедуры, содержащий UUID интерфейса, которому принадлежит вызов, и идентификатор UUID объекта из маркера привязки вызова.</span><span class="sxs-lookup"><span data-stu-id="daf41-275">The server run-time library receives a remote procedure code containing the interface UUID that the call belongs to and the object UUID from the call's binding handle.</span></span>

    <span data-ttu-id="daf41-276">Сведения о том, как идентификатор UUID объекта задается в маркере привязки, см. в следующих справочных записях по функциям:</span><span class="sxs-lookup"><span data-stu-id="daf41-276">See the following function reference entries for discussions of how an object UUID is set into a binding handle:</span></span>

    -   [<span data-ttu-id="daf41-277">**рпкнсбиндингимпортбегин**</span><span class="sxs-lookup"><span data-stu-id="daf41-277">**RpcNsBindingImportBegin**</span></span>](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindingimportbegina)
    -   [<span data-ttu-id="daf41-278">**рпкнсбиндинглукупбегин**</span><span class="sxs-lookup"><span data-stu-id="daf41-278">**RpcNsBindingLookupBegin**</span></span>](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindinglookupbegina)
    -   [<span data-ttu-id="daf41-279">**рпкбиндингфромстрингбиндинг**</span><span class="sxs-lookup"><span data-stu-id="daf41-279">**RpcBindingFromStringBinding**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingfromstringbinding)
    -   [<span data-ttu-id="daf41-280">**рпкбиндингсетобжект**</span><span class="sxs-lookup"><span data-stu-id="daf41-280">**RpcBindingSetObject**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetobject)

4.  <span data-ttu-id="daf41-281">Используя UUID интерфейса из удаленного вызова процедуры, Библиотека времени выполнения сервера находит идентификатор UUID интерфейса в таблице реестра Interface.</span><span class="sxs-lookup"><span data-stu-id="daf41-281">Using the interface UUID from the remote procedure call, the server's run-time library locates that interface UUID in the interface registry table.</span></span>

    <span data-ttu-id="daf41-282">Если сервер не зарегистрировал интерфейс с помощью [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2), удаленный вызов процедуры возвращает вызывающей стороне с RPC, \_ \_ неизвестным, \_ Если код состояния.</span><span class="sxs-lookup"><span data-stu-id="daf41-282">If the server did not register the interface using [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2), then the remote procedure call returns to the caller with an RPC\_S\_UNKNOWN\_IF status code.</span></span>

5.  <span data-ttu-id="daf41-283">Используя идентификатор UUID объекта из маркера привязки, Библиотека времени выполнения сервера находит этот идентификатор объекта в таблице реестра объектов.</span><span class="sxs-lookup"><span data-stu-id="daf41-283">Using the object UUID from the binding handle, the server's run-time library locates that object UUID in the object registry table.</span></span> <span data-ttu-id="daf41-284">В этом примере все ИДЕНТИФИКАТОРы объекта сопоставляются с типом объекта nil.</span><span class="sxs-lookup"><span data-stu-id="daf41-284">In this example, all object UUIDs map to the nil object type.</span></span>
6.  <span data-ttu-id="daf41-285">Библиотека времени выполнения сервера находит ненулевой тип диспетчера в таблице реестра Interface.</span><span class="sxs-lookup"><span data-stu-id="daf41-285">The server's run-time library locates the nil manager type in the interface registry table.</span></span>
7.  <span data-ttu-id="daf41-286">Сочетание UUID интерфейса и типа nil в таблице реестра Interface разрешается в ЕПВ по умолчанию, который содержит подпрограммы диспетчера сервера, выполняемые для идентификатора UUID интерфейса, найденного в удаленном вызове процедуры.</span><span class="sxs-lookup"><span data-stu-id="daf41-286">Combining the interface UUID and nil type in the interface registry table resolves to the default EPV, which contains the server-manager routines to be executed for the interface UUID found in the remote procedure call.</span></span>

<span data-ttu-id="daf41-287">Предположим, что сервер предлагает несколько интерфейсов и несколько реализаций каждого интерфейса, как описано в следующих таблицах.</span><span class="sxs-lookup"><span data-stu-id="daf41-287">Assume that the server offers multiple interfaces and multiple implementations of each interface, as described in the following tables.</span></span>

<span data-ttu-id="daf41-288">**Таблица реестра интерфейса**</span><span class="sxs-lookup"><span data-stu-id="daf41-288">**Interface Registry Table**</span></span>



| <span data-ttu-id="daf41-289">UUID интерфейса</span><span class="sxs-lookup"><span data-stu-id="daf41-289">Interface UUID</span></span> | <span data-ttu-id="daf41-290">Идентификатор UUID типа "руководитель"</span><span class="sxs-lookup"><span data-stu-id="daf41-290">Manager-type UUID</span></span> | <span data-ttu-id="daf41-291">Вектор точки входа</span><span class="sxs-lookup"><span data-stu-id="daf41-291">Entry-point vector</span></span> |
|----------------|-------------------|--------------------|
| <span data-ttu-id="daf41-292">*uuid1*</span><span class="sxs-lookup"><span data-stu-id="daf41-292">*uuid1*</span></span>        | <span data-ttu-id="daf41-293">Указатель</span><span class="sxs-lookup"><span data-stu-id="daf41-293">Nil</span></span>               | <span data-ttu-id="daf41-294">*epv1*</span><span class="sxs-lookup"><span data-stu-id="daf41-294">*epv1*</span></span>             |
| <span data-ttu-id="daf41-295">*uuid1*</span><span class="sxs-lookup"><span data-stu-id="daf41-295">*uuid1*</span></span>        | <span data-ttu-id="daf41-296">*uuid3*</span><span class="sxs-lookup"><span data-stu-id="daf41-296">*uuid3*</span></span>           | <span data-ttu-id="daf41-297">*epv4*</span><span class="sxs-lookup"><span data-stu-id="daf41-297">*epv4*</span></span>             |
| <span data-ttu-id="daf41-298">*uuid2*</span><span class="sxs-lookup"><span data-stu-id="daf41-298">*uuid2*</span></span>        | <span data-ttu-id="daf41-299">*uuid4*</span><span class="sxs-lookup"><span data-stu-id="daf41-299">*uuid4*</span></span>           | <span data-ttu-id="daf41-300">*epv2*</span><span class="sxs-lookup"><span data-stu-id="daf41-300">*epv2*</span></span>             |
| <span data-ttu-id="daf41-301">*uuid2*</span><span class="sxs-lookup"><span data-stu-id="daf41-301">*uuid2*</span></span>        | <span data-ttu-id="daf41-302">*uuid7*</span><span class="sxs-lookup"><span data-stu-id="daf41-302">*uuid7*</span></span>           | <span data-ttu-id="daf41-303">*epv3*</span><span class="sxs-lookup"><span data-stu-id="daf41-303">*epv3*</span></span>             |



 

<span data-ttu-id="daf41-304">**Таблица реестра объектов**</span><span class="sxs-lookup"><span data-stu-id="daf41-304">**Object Registry Table**</span></span>



| <span data-ttu-id="daf41-305">UUID объекта</span><span class="sxs-lookup"><span data-stu-id="daf41-305">Object UUID</span></span>      | <span data-ttu-id="daf41-306">Тип объекта</span><span class="sxs-lookup"><span data-stu-id="daf41-306">Object type</span></span> |
|------------------|-------------|
| <span data-ttu-id="daf41-307">*UUID*</span><span class="sxs-lookup"><span data-stu-id="daf41-307">*uuidA*</span></span>          | <span data-ttu-id="daf41-308">*uuid3*</span><span class="sxs-lookup"><span data-stu-id="daf41-308">*uuid3*</span></span>     |
| <span data-ttu-id="daf41-309">*ууидб*</span><span class="sxs-lookup"><span data-stu-id="daf41-309">*uuidB*</span></span>          | <span data-ttu-id="daf41-310">*uuid7*</span><span class="sxs-lookup"><span data-stu-id="daf41-310">*uuid7*</span></span>     |
| <span data-ttu-id="daf41-311">*ууидк*</span><span class="sxs-lookup"><span data-stu-id="daf41-311">*uuidC*</span></span>          | <span data-ttu-id="daf41-312">*uuid7*</span><span class="sxs-lookup"><span data-stu-id="daf41-312">*uuid7*</span></span>     |
| <span data-ttu-id="daf41-313">*с UUID*</span><span class="sxs-lookup"><span data-stu-id="daf41-313">*uuidD*</span></span>          | <span data-ttu-id="daf41-314">*uuid3*</span><span class="sxs-lookup"><span data-stu-id="daf41-314">*uuid3*</span></span>     |
| <span data-ttu-id="daf41-315">*UUID*</span><span class="sxs-lookup"><span data-stu-id="daf41-315">*uuidE*</span></span>          | <span data-ttu-id="daf41-316">*uuid3*</span><span class="sxs-lookup"><span data-stu-id="daf41-316">*uuid3*</span></span>     |
| <span data-ttu-id="daf41-317">*ууидф*</span><span class="sxs-lookup"><span data-stu-id="daf41-317">*uuidF*</span></span>          | <span data-ttu-id="daf41-318">*uuid8*</span><span class="sxs-lookup"><span data-stu-id="daf41-318">*uuid8*</span></span>     |
| <span data-ttu-id="daf41-319">Указатель</span><span class="sxs-lookup"><span data-stu-id="daf41-319">Nil</span></span>              | <span data-ttu-id="daf41-320">Указатель</span><span class="sxs-lookup"><span data-stu-id="daf41-320">Nil</span></span>         |
| <span data-ttu-id="daf41-321">(Любой другой UUID)</span><span class="sxs-lookup"><span data-stu-id="daf41-321">(Any other UUID)</span></span> | <span data-ttu-id="daf41-322">Указатель</span><span class="sxs-lookup"><span data-stu-id="daf41-322">Nil</span></span>         |



 

<span data-ttu-id="daf41-323">**Сопоставление маркера привязки с вектором точки входа**</span><span class="sxs-lookup"><span data-stu-id="daf41-323">**Mapping the Binding Handle to an Entry-point Vector**</span></span>



| <span data-ttu-id="daf41-324">UUID интерфейса (из клиентского маркера привязки)</span><span class="sxs-lookup"><span data-stu-id="daf41-324">Interface UUID (from client binding handle)</span></span> | <span data-ttu-id="daf41-325">UUID объекта (из клиентского маркера привязки)</span><span class="sxs-lookup"><span data-stu-id="daf41-325">Object UUID (from client binding handle)</span></span> | <span data-ttu-id="daf41-326">Тип объекта (из таблицы реестра объектов)</span><span class="sxs-lookup"><span data-stu-id="daf41-326">Object type (from object registry table)</span></span> | <span data-ttu-id="daf41-327">Диспетчер ЕПВ (из таблицы реестра интерфейса)</span><span class="sxs-lookup"><span data-stu-id="daf41-327">Manager EPV (from interface registry table)</span></span> |
|---------------------------------------------|------------------------------------------|------------------------------------------|---------------------------------------------|
| <span data-ttu-id="daf41-328">*uuid1*</span><span class="sxs-lookup"><span data-stu-id="daf41-328">*uuid1*</span></span>                                     | <span data-ttu-id="daf41-329">Указатель</span><span class="sxs-lookup"><span data-stu-id="daf41-329">Nil</span></span>                                      | <span data-ttu-id="daf41-330">Указатель</span><span class="sxs-lookup"><span data-stu-id="daf41-330">Nil</span></span>                                      | <span data-ttu-id="daf41-331">*epv1*</span><span class="sxs-lookup"><span data-stu-id="daf41-331">*epv1*</span></span>                                      |
| <span data-ttu-id="daf41-332">*uuid1*</span><span class="sxs-lookup"><span data-stu-id="daf41-332">*uuid1*</span></span>                                     | <span data-ttu-id="daf41-333">*UUID*</span><span class="sxs-lookup"><span data-stu-id="daf41-333">*uuidA*</span></span>                                  | <span data-ttu-id="daf41-334">*uuid3*</span><span class="sxs-lookup"><span data-stu-id="daf41-334">*uuid3*</span></span>                                  | <span data-ttu-id="daf41-335">*epv4*</span><span class="sxs-lookup"><span data-stu-id="daf41-335">*epv4*</span></span>                                      |
| <span data-ttu-id="daf41-336">*uuid1*</span><span class="sxs-lookup"><span data-stu-id="daf41-336">*uuid1*</span></span>                                     | <span data-ttu-id="daf41-337">*с UUID*</span><span class="sxs-lookup"><span data-stu-id="daf41-337">*uuidD*</span></span>                                  | <span data-ttu-id="daf41-338">*uuid3*</span><span class="sxs-lookup"><span data-stu-id="daf41-338">*uuid3*</span></span>                                  | <span data-ttu-id="daf41-339">*epv4*</span><span class="sxs-lookup"><span data-stu-id="daf41-339">*epv4*</span></span>                                      |
| <span data-ttu-id="daf41-340">*uuid1*</span><span class="sxs-lookup"><span data-stu-id="daf41-340">*uuid1*</span></span>                                     | <span data-ttu-id="daf41-341">*UUID*</span><span class="sxs-lookup"><span data-stu-id="daf41-341">*uuidE*</span></span>                                  | <span data-ttu-id="daf41-342">*uuid3*</span><span class="sxs-lookup"><span data-stu-id="daf41-342">*uuid3*</span></span>                                  | <span data-ttu-id="daf41-343">*epv4*</span><span class="sxs-lookup"><span data-stu-id="daf41-343">*epv4*</span></span>                                      |
| <span data-ttu-id="daf41-344">*uuid2*</span><span class="sxs-lookup"><span data-stu-id="daf41-344">*uuid2*</span></span>                                     | <span data-ttu-id="daf41-345">*ууидб*</span><span class="sxs-lookup"><span data-stu-id="daf41-345">*uuidB*</span></span>                                  | <span data-ttu-id="daf41-346">*uuid7*</span><span class="sxs-lookup"><span data-stu-id="daf41-346">*uuid7*</span></span>                                  | <span data-ttu-id="daf41-347">*epv3*</span><span class="sxs-lookup"><span data-stu-id="daf41-347">*epv3*</span></span>                                      |
| <span data-ttu-id="daf41-348">*uuid2*</span><span class="sxs-lookup"><span data-stu-id="daf41-348">*uuid2*</span></span>                                     | <span data-ttu-id="daf41-349">*ууидк*</span><span class="sxs-lookup"><span data-stu-id="daf41-349">*uuidC*</span></span>                                  | <span data-ttu-id="daf41-350">*uuid7*</span><span class="sxs-lookup"><span data-stu-id="daf41-350">*uuid7*</span></span>                                  | <span data-ttu-id="daf41-351">*epv3*</span><span class="sxs-lookup"><span data-stu-id="daf41-351">*epv3*</span></span>                                      |



 

<span data-ttu-id="daf41-352">Следующие шаги описывают действия, выполняемые библиотекой времени выполнения сервера, как показано в предыдущих таблицах, когда клиент с UUID интерфейса *uuid2* и UUID объекта *ууидк* вызывает его.</span><span class="sxs-lookup"><span data-stu-id="daf41-352">The following steps describe the actions that the server's run-time library take, as shown in the preceding tables when a client with interface UUID *uuid2* and object UUID *uuidC* calls it.</span></span>

1.  <span data-ttu-id="daf41-353">Сервер вызывает [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) для связывания предоставляемых им интерфейсов с разными епвс Manager.</span><span class="sxs-lookup"><span data-stu-id="daf41-353">The server calls [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) to associate the interfaces it offers with the different manager EPVs.</span></span> <span data-ttu-id="daf41-354">Записи в таблице реестра Interface отображают четыре вызова [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) для предложения двух интерфейсов с двумя реализациями (епвс) для каждого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="daf41-354">The entries in the interface registry table reflect four calls of [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) to offer two interfaces, with two implementations (EPVs) for each interface.</span></span>
2.  <span data-ttu-id="daf41-355">Сервер вызывает [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) , чтобы установить тип каждого предоставляемого им объекта.</span><span class="sxs-lookup"><span data-stu-id="daf41-355">The server calls [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) to establish the type of each object it offers.</span></span> <span data-ttu-id="daf41-356">В дополнение к сопоставлению по умолчанию объекта nil с пустым типом, все остальные ИДЕНТИФИКАТОРы объектов, не найденные явным образом в таблице реестра Object, также сопоставляются с пустым типом UUID.</span><span class="sxs-lookup"><span data-stu-id="daf41-356">In addition to the default association of the nil object to a nil type, all other object UUIDs not explicitly found in the object registry table also map to the nil type UUID.</span></span>

    <span data-ttu-id="daf41-357">В этом примере сервер вызывает подпрограммы [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) шесть раз.</span><span class="sxs-lookup"><span data-stu-id="daf41-357">In this example, the server calls the [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) routine six times.</span></span>

3.  <span data-ttu-id="daf41-358">Серверная библиотека времени выполнения получает удаленный вызов процедуры, содержащий UUID интерфейса, к которому принадлежит вызов, и идентификатор UUID объекта из маркера привязки вызова.</span><span class="sxs-lookup"><span data-stu-id="daf41-358">The server run-time library receives a remote procedure call containing the interface UUID that the call belongs to and an object UUID from the call's binding handle.</span></span>
4.  <span data-ttu-id="daf41-359">Используя UUID интерфейса из удаленного вызова процедуры, Библиотека времени выполнения сервера находит UUID интерфейса в таблице реестра Interface.</span><span class="sxs-lookup"><span data-stu-id="daf41-359">Using the interface UUID from the remote procedure call, the server's run-time library locates the interface UUID in the interface registry table.</span></span>
5.  <span data-ttu-id="daf41-360">Используя идентификатор UUID объекта *ууидк* из маркера привязки, Библиотека времени выполнения сервера находит идентификатор объекта в таблице реестра Object и обнаруживает, что он сопоставлен с типом *uuid7*.</span><span class="sxs-lookup"><span data-stu-id="daf41-360">Using the *uuidC* object UUID from the binding handle, the server's run-time library locates the object UUID in the object registry table and finds that it maps to type *uuid7*.</span></span>
6.  <span data-ttu-id="daf41-361">Чтобы узнать тип диспетчера, Библиотека времени выполнения сервера объединяет идентификатор UUID интерфейса *uuid2* и тип *uuid7* в таблице реестра Interface.</span><span class="sxs-lookup"><span data-stu-id="daf41-361">To locate the manager type, the server's run-time library combines the interface UUID, *uuid2*, and type *uuid7* in the interface registry table.</span></span> <span data-ttu-id="daf41-362">Это разрешается в *epv3*, который содержит подпрограммы диспетчера сервера, выполняемые для удаленного вызова процедуры.</span><span class="sxs-lookup"><span data-stu-id="daf41-362">This resolves to *epv3*, which contains the server manager routine to be executed for the remote procedure call.</span></span>

<span data-ttu-id="daf41-363">Подпрограммы в *epv2* никогда не будут выполняться, так как сервер не вызывал подсистему [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) для добавления объектов с типом UUID *uuid4* в таблицу реестра Object.</span><span class="sxs-lookup"><span data-stu-id="daf41-363">The routines in *epv2* will never be executed because the server has not called the [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) routine to add any objects with a type UUID of *uuid4* to the object registry table.</span></span>

<span data-ttu-id="daf41-364">Удаленный вызов процедур с UUID интерфейса *uuid2* и идентификатором UUID *ууидф* возвращает вызывающему объекту с \_ \_ кодом состояния "Неизвестный тип диспетчера RPC S" \_ \_ , так как сервер не вызывал [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) для регистрации интерфейса с типом диспетчера *uuid8*.</span><span class="sxs-lookup"><span data-stu-id="daf41-364">A remote procedure call with interface UUID *uuid2* and object UUID *uuidF* returns to the caller with an RPC\_S\_UNKNOWN\_MGR\_TYPE status code because the server did not call [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex), or [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) to register the interface with a manager type of *uuid8*.</span></span>

## <a name="return-values"></a><span data-ttu-id="daf41-365">Возвращаемые значения</span><span class="sxs-lookup"><span data-stu-id="daf41-365">Return Values</span></span>

<span data-ttu-id="daf41-366">Эта функция возвращает одно из следующих значений.</span><span class="sxs-lookup"><span data-stu-id="daf41-366">This function returns one of the following values.</span></span>



| <span data-ttu-id="daf41-367">Значение</span><span class="sxs-lookup"><span data-stu-id="daf41-367">Value</span></span>                             | <span data-ttu-id="daf41-368">Значение</span><span class="sxs-lookup"><span data-stu-id="daf41-368">Meaning</span></span>                      |
|-----------------------------------|------------------------------|
| <span data-ttu-id="daf41-369">RPC \_ S \_ OK</span><span class="sxs-lookup"><span data-stu-id="daf41-369">RPC\_S\_OK</span></span>                        | <span data-ttu-id="daf41-370">Успешно</span><span class="sxs-lookup"><span data-stu-id="daf41-370">Success</span></span>                      |
| <span data-ttu-id="daf41-371">\_тип RPC \_ S \_ уже \_ зарегистрирован</span><span class="sxs-lookup"><span data-stu-id="daf41-371">RPC\_S\_TYPE\_ALREADY\_REGISTERED</span></span> | <span data-ttu-id="daf41-372">UUID типа уже зарегистрирован</span><span class="sxs-lookup"><span data-stu-id="daf41-372">Type UUID already registered</span></span> |



 

## <a name="supplying-your-own-object-inquiry-function"></a><span data-ttu-id="daf41-373">Предоставление собственной функции Object-запроса</span><span class="sxs-lookup"><span data-stu-id="daf41-373">Supplying Your Own Object-inquiry Function</span></span>

<span data-ttu-id="daf41-374">Рассмотрим сервер, который управляет тысячами объектов различных типов.</span><span class="sxs-lookup"><span data-stu-id="daf41-374">Consider a server that manages thousands of objects of many different types.</span></span> <span data-ttu-id="daf41-375">При каждом запуске сервера серверное приложение должно вызывать функцию [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) для каждого объекта, даже несмотря на то, что клиенты могут ссылаться только на некоторые из них (или занимать много времени для обращения к ним).</span><span class="sxs-lookup"><span data-stu-id="daf41-375">Whenever the server started, the server application would have to call the function [**RpcObjectSetType**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) for every one of the objects, even though clients might refer to only a few of them (or take a long time to refer to them).</span></span> <span data-ttu-id="daf41-376">Эти тысячи объектов, вероятно, будут находиться на диске, поэтому получение их типов может занять много времени.</span><span class="sxs-lookup"><span data-stu-id="daf41-376">These thousands of objects are likely to be on disk, so retrieving their types would be time consuming.</span></span> <span data-ttu-id="daf41-377">Кроме того, внутренняя таблица, которая сопоставляет UUID объекта с ИДЕНТИФИКАТОРом типа диспетчера, фактически дублирует сопоставление, поддерживаемое объектами.</span><span class="sxs-lookup"><span data-stu-id="daf41-377">Also, the internal table that is mapping the object UUID to the manager type UUID would essentially duplicate the mapping maintained with the objects themselves.</span></span>

<span data-ttu-id="daf41-378">Для удобства набор функций RPC включает функцию [**рпкобжектсетинкфн**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsetinqfn).</span><span class="sxs-lookup"><span data-stu-id="daf41-378">For convenience, the RPC function set includes the function [**RpcObjectSetInqFn**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsetinqfn).</span></span> <span data-ttu-id="daf41-379">С помощью этой функции вы предоставляете собственную функцию Object-запроса.</span><span class="sxs-lookup"><span data-stu-id="daf41-379">With this function, you provide your own object-inquiry function.</span></span>

<span data-ttu-id="daf41-380">Например, вы можете указать собственную функцию Object-запроса при сопоставлении объектов 100 – 199 с типом Number 1, 200 – 299, типом Number 2 и т. д.</span><span class="sxs-lookup"><span data-stu-id="daf41-380">As an example, you can supply your own object-inquiry function when you map objects 100–199 to type number 1, 200–299 to type number 2, and so on.</span></span> <span data-ttu-id="daf41-381">Функцию запроса объекта также можно расширить на распределенную файловую систему, в которой серверное приложение не имеет списка всех доступных файлов (UUID объекта) или если идентификаторы UUID объекта имеют имена файлов в файловой системе и не хотят предварительно загружать все сопоставления между идентификаторами UUID объекта и UUID типа.</span><span class="sxs-lookup"><span data-stu-id="daf41-381">The object inquiry function can also be extended to a distributed file system, where the server application does not have a list of all the files (object UUIDs) available, or when object UUIDs name files in the file system and you do not want to preload all of the mappings between object UUIDs and type UUIDs.</span></span>

## <a name="related-topics"></a><span data-ttu-id="daf41-382">См. также</span><span class="sxs-lookup"><span data-stu-id="daf41-382">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="daf41-383">**рпкбиндингфромстрингбиндинг**</span><span class="sxs-lookup"><span data-stu-id="daf41-383">**RpcBindingFromStringBinding**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingfromstringbinding)
</dt> <dt>

[<span data-ttu-id="daf41-384">**рпкбиндингсетобжект**</span><span class="sxs-lookup"><span data-stu-id="daf41-384">**RpcBindingSetObject**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetobject)
</dt> <dt>

[<span data-ttu-id="daf41-385">**рпкнсбиндинжекспорт**</span><span class="sxs-lookup"><span data-stu-id="daf41-385">**RpcNsBindingExport**</span></span>](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindingexporta)
</dt> <dt>

[<span data-ttu-id="daf41-386">**рпкнсбиндингимпортбегин**</span><span class="sxs-lookup"><span data-stu-id="daf41-386">**RpcNsBindingImportBegin**</span></span>](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindingimportbegina)
</dt> <dt>

[<span data-ttu-id="daf41-387">**рпкнсбиндинглукупбегин**</span><span class="sxs-lookup"><span data-stu-id="daf41-387">**RpcNsBindingLookupBegin**</span></span>](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindinglookupbegina)
</dt> <dt>

[<span data-ttu-id="daf41-388">**рпкобжектсеттипе**</span><span class="sxs-lookup"><span data-stu-id="daf41-388">**RpcObjectSetType**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype)
</dt> <dt>

[<span data-ttu-id="daf41-389">**рпксерверрегистериф**</span><span class="sxs-lookup"><span data-stu-id="daf41-389">**RpcServerRegisterIf**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)
</dt> <dt>

[<span data-ttu-id="daf41-390">**RpcServerRegisterIf2**</span><span class="sxs-lookup"><span data-stu-id="daf41-390">**RpcServerRegisterIf2**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)
</dt> <dt>

[<span data-ttu-id="daf41-391">**рпксерверрегистерифекс**</span><span class="sxs-lookup"><span data-stu-id="daf41-391">**RpcServerRegisterIfEx**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)
</dt> <dt>

[<span data-ttu-id="daf41-392">**рпксерверунрегистериф**</span><span class="sxs-lookup"><span data-stu-id="daf41-392">**RpcServerUnregisterIf**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverunregisterif)
</dt> <dt>

[<span data-ttu-id="daf41-393">**рпксерверунрегистерифекс**</span><span class="sxs-lookup"><span data-stu-id="daf41-393">**RpcServerUnregisterIfEx**</span></span>](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverunregisterifex)
</dt> </dl>

 

 




