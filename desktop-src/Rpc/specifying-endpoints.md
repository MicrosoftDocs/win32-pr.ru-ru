---
title: Указание конечных точек
description: Указание хорошо известных и динамических конечных точек в удаленном вызове процедур (RPC).
ms.assetid: fc39b527-11e6-45a7-b3b5-8bcf469633d8
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 373fb2818dd14670f5a939aa524c81fcdb05e20b
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105650356"
---
# <a name="specifying-endpoints"></a>Указание конечных точек

Конечная точка — это сетевой адрес серверного процесса для удаленных вызовов процедур. Фактическое имя конечной точки зависит от используемой последовательности протоколов. Например, порты использования TCP, UDP и HTTP. Именованные каналы используют имя именованного канала. Клиентские и серверные приложения могут использовать хорошо известную конечную точку или динамическую конечную точку. В этом разделе представлены методы, используемые серверными программами для указания хорошо известных и динамических конечных точек. Сведения рассматриваются в следующих разделах:

-   [Указание хорошо известных конечных точек](#specifying-well-known-endpoints)
-   [Указание динамических конечных точек](#specifying-dynamic-endpoints)

## <a name="specifying-well-known-endpoints"></a>Указание хорошо известных конечных точек

Если сервер использует хорошо известную конечную точку, он может включать данные конечной точки как часть записи базы данных службы имен. Если это так, то маркер привязки клиента содержит полный адрес сервера, включающий известную конечную точку, когда клиент импортирует маркер привязки из записи сервера.

Серверная программа также может указывать хорошо известные конечные точки одновременно с указанием последовательностей протоколов. Вызовите функцию [**рпксерверусепротсекеп**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqep) или [**рпксерверусепротсекепекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex) . Различие между ними заключается в том, что последняя функция имеет дополнительный параметр, который сервер может использовать для управления динамическим выделением портов.

Если серверная программа указывает сведения о конечной точке таким образом, она также должна вызывать функцию [**рпцепрегистер**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcepregister) для регистрации конечной точки на карте конечных точек. Несмотря на то что конечная точка всегда одинакова, клиент может использовать карту конечных точек для поиска сервера.

Как и в случае с последовательностями протокола, приложение может указывать сведения о конечной точке в IDL-файле. Если это так, он должен одновременно регистрировать как последовательности протокола, так и конечные точки, вызывая функцию [**рпксерверусеаллпротсексиф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsif) или [**рпксерверусеаллпротсексифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsifex) . В этом случае клиент имеет доступ к сведениям о конечной точке через спецификацию интерфейса в IDL-файле. Поэтому нет необходимости вызывать функцию [**рпцепрегистер**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcepregister) .

## <a name="specifying-dynamic-endpoints"></a>Указание динамических конечных точек

Динамическая конечная точка — это конечная точка, которую компьютер узла сервера назначает при запуске сервера. Большинство серверных приложений используют динамические конечные точки, чтобы избежать конфликтов с другими программами по ограниченному числу портов, доступных на компьютере узла сервера. Однако программы, использующие именованные каналы или последовательность протокола [**нкалрпк**](/windows/desktop/Midl/ncalrpc) , имеют очень большое пространство имен конечных точек. Они получают меньше от динамических конечных точек, чем от программ, использующих другие транспорты.

Серверные программы регистрируют динамические конечные точки в базе данных карт конечных точек. Если вы хотите, чтобы сервер использовал любую доступную конечную точку, вызовите [**рпксерверусеаллпротсекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqs), [**рпксерверусеаллпротсексекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsex), [**рпксерверусепротсек**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseq) или [**рпксерверусепротсекекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqex). При этом в библиотеке времени выполнения RPC задается использование всех или одной допустимой последовательности протоколов с динамическими конечными точками. Затем сервер должен вызвать [**рпксерверинкбиндингс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverinqbindings) , чтобы получить набор допустимых дескрипторов привязки. Сервер передает набор дескрипторов привязки или вектора привязки в функцию [**рпцепрегистер**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcepregister) , чтобы зарегистрировать все подходящие конечные точки в карте конечных точек. Для каждого вызова, который выполняет сервер, **рпцепрегистер**, должен существовать соответствующий вызов [**рпкбиндингвекторфри**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingvectorfree) , чтобы освободить память, используемую вектором привязки.

Обратите внимание, что серверные программы могут использовать функцию [**рпцепрегистернореплаце**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcepregisternoreplace) , а не [**рпцепрегистер**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcepregister). Программы обычно используют **рпцепрегистернореплаце** , когда несколько копий серверной программы должны выполняться в системе узла сервера.

Функции [**рпцепрегистер**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcepregister) и [**рпцепрегистернореплаце**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcepregisternoreplace) добавляют интерфейсы и дескрипторы привязки сервера в базу данных сопоставителя конечных точек. Когда клиент выполняет удаленный вызов процедуры с помощью частично привязанного маркера, Библиотека времени выполнения клиента запрашивает сопоставитель конечной точки сервера для конечной точки совместимого экземпляра сервера. Клиентская библиотека предоставляет UUID интерфейса, последовательность протокола и, при наличии, идентификатор UUID объекта в маркере привязки клиента. Средство сопоставления конечных точек выполняет поиск записи базы данных, соответствующей клиентской информации. Идентификатор UUID интерфейса клиента/сервера, основная версия интерфейса и последовательность протокола должны полностью совпадать. Кроме того, дополнительный номер версии интерфейса сервера должен быть больше или равен дополнительному номеру версии клиента.

Если все тесты выполнены успешно, средство сопоставления конечных точек возвращает допустимую конечную точку, а библиотека времени выполнения клиента обновляет конечную точку в маркере привязки.

Динамические конечные точки автоматически очищаются из базы данных сопоставителя конечных точек при остановке серверного процесса. Можно либо удалить конечную точку из базы данных сопоставителя конечных точек перед завершением работы серверной программы с помощью функции [**рпцепунрегистер**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcepunregister) , либо разрешить автоматическую очистку для управления удалением конечной точки.

 

 