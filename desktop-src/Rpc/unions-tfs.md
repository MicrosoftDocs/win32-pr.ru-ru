---
title: Объединения RPC
description: Инкапсулированные и неинкапсулированные объединения и их формат с помощью удаленного вызова процедур (RPC).
ms.assetid: de13151a-f4a4-4440-b287-454df4a1e3e1
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f9f35f0ff23132705330bf1f8566443ac8aa81d3
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104487744"
---
# <a name="rpc-unions"></a>Объединения RPC

Как инкапсулированные, так и неинкапсулированные объединения имеют общий \_ \_ селектор<> :

``` syntax
union_arms<2>
arm1_case_value<4> offset_to_arm_description<2>
..
armN_case_value<4> offset_to_arm_description<2>
default_arm_description<2>
```

Поле Union \_ подлокотники<2> состоит из двух частей. Если объединение является объединением в стиле MIDL 1,0, верхние 4 бита содержат выравнивание линии объединения (выравнивание с наибольшим выровненным ARM). В противном случае верхние 4 бита равны нулю. Младшие 12 битов содержат число подлокотников в объединении. Другими словами:

``` syntax
alignment<highest nibble> arm_counter<three lower nibbles>
```

Смещение \_ для \_ описания ARM \_<2> поля содержат относительное смещение со знаком для описания типа ARM. Однако поле перегружается с оптимизацией для простых типов. Для этого смещение в верхнем байте этого поля смещения составляет FC \_ Magic \_ Union \_ Byte (0x80), а нижний байт короткого формата — фактический тип символа для ARM. Таким образом, для значений смещения существует два диапазона: "80 *XX*" означает, что *XX* является строкой формата типа; и все остальное в диапазоне (80 FF. 7F FF) означает фактическое смещение. Это делает смещение от диапазона <80 00.. 80 FF > недоступен в качестве смещений. Компилятор проверяет, что версия MIDL 5.1.164.

В \_ поле Описание ARM по умолчанию \_<2>а указывает тип ARM объединения для ARM по умолчанию (при наличии). Если для объединения не указана ARM по умолчанию, описание ARM по умолчанию \_ \_<2> поле имеет значение 0xFFFF, и возникает исключение, если параметр не \_ соответствует ни одному из значений варианта ARM. Если значение ARM по умолчанию указано, но пусто, то описание ARM по умолчанию \_ \_<2> поле равно нулю. В противном случае в \_ описании ARM по умолчанию \_<2> поле имеет ту же семантику, что и смещение \_ к \_ \_ описанию ARM<2> поля.

Ниже приведено краткое описание.

-   0 — пустое значение по умолчанию
-   FFFF — нет значения по умолчанию
-   80xx — простой тип
-   другое относительное смещение

## <a name="encapsulated-unions"></a>Инкапсулированные объединения

Инкапсулированное объединение поступает из специального синтаксиса UNION в IDL. Фактически инкапсулированное объединение — это структура пакета с полем discriminant в начале структуры, а объединение — единственным другим элементом.

``` syntax
FC_ENCAPSULATED_UNION switch_type<1> 
memory_size<2>
union_arm_selector<>
```

Тип переключателя инкапсулированного объединения \_<1> поле состоит из двух частей. В нижней части содержится фактический тип переключателя, а верхняя часть — это величина, на которую необходимо увеличить указатель памяти, чтобы пропустить переход за пределы \_ поля Switch, которое включает в себя любое заполнение между полем Switch — \_ () структуры, сформированной заглушкой, и фактическим полем объединения.

Размер памяти \_<2> поле имеет размер только для объединения и идентичен неинкапсулированным объединениям. Чтобы получить общий размер структуры, содержащей объединение, добавьте объем памяти \_<2> в шаг с обходом по шагам, то есть верхнюю часть типа переключателя \_<1> поле, а затем выровняйте по выравниванию, соответствующему инкременту.

## <a name="nonencapsulated-unions"></a>Неинкапсулированные объединения

Неинкапсулированное объединение — типичная ситуация, когда объединение является одним аргументом или полем, а параметр — другим аргументом или полем соответственно.

``` syntax
FC_NON_ENCAPSULATED_UNION switch_type<1> 
switch_is_description<>
offset_to_size_and_arm_description<2>
```

Где:

Тип переключателя \_<1> поле является символом формата для discriminant.

Параметр \_ является \_ дескриптором<> поле является дескриптором корреляции и имеет 4 или 6 байт в зависимости от того, используется ли [**/robust**](/windows/desktop/Midl/-robust) . Однако для параметра \_ \_ Description<>, если объединение внедрено в структуру, Поле Offset параметра \_ имеет значение Description, \_<> является смещением переключателя \_ от позиции объединения в структуре (а не от начала структуры).

Смещение \_ к \_ размеру \_ и \_ описание ARM \_<2> поле дает смещение для размера объединения и описания ARM, которые идентичны для инкапсулированных объединений и являются общими для всех неинкапсулированных объединений того же типа:

``` syntax
memory_size<2> 
union_arm_selector<>
```

 

 