---
title: Выбор параметров качества обслуживания для системы безопасности
description: Параметры качества обслуживания безопасности передаются как часть параметра Секуритикос, заданного функцией Рпкбиндингсетаусинфоекс. Используйте следующие рекомендации.
ms.assetid: 43befe3d-079a-4389-a1ff-6bda90935769
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8c286b516438eae78117ef8d73939c3b4bed396d
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105672391"
---
# <a name="choosing-security-qos-options"></a><span data-ttu-id="05319-104">Выбор параметров качества обслуживания для системы безопасности</span><span class="sxs-lookup"><span data-stu-id="05319-104">Choosing Security QOS Options</span></span>

<span data-ttu-id="05319-105">Параметры качества обслуживания безопасности передаются как часть параметра *секуритикос* , заданного функцией [**рпкбиндингсетаусинфоекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) .</span><span class="sxs-lookup"><span data-stu-id="05319-105">The security QOS options are passed as part of the *SecurityQOS* parameter given to the [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) function.</span></span> <span data-ttu-id="05319-106">Используйте следующие рекомендации.</span><span class="sxs-lookup"><span data-stu-id="05319-106">Use the following best practices.</span></span>

## <a name="use-mutual-authentication"></a><span data-ttu-id="05319-107">Использовать взаимную проверку подлинности</span><span class="sxs-lookup"><span data-stu-id="05319-107">Use Mutual Authentication</span></span>

<span data-ttu-id="05319-108">Истинная взаимная проверка подлинности доступна только для определенных поставщиков безопасности: согласование (при согласовании Kerberos), Kerberos и SChannel.</span><span class="sxs-lookup"><span data-stu-id="05319-108">True mutual authentication is available only for certain security providers: Negotiate (when it negotiates Kerberos), Kerberos, and Schannel.</span></span> <span data-ttu-id="05319-109">NTLM не поддерживает взаимную проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="05319-109">NTLM does not support mutual authentication.</span></span> <span data-ttu-id="05319-110">Для использования взаимной проверки подлинности необходимо указать правильно сформированное имя участника на сервере.</span><span class="sxs-lookup"><span data-stu-id="05319-110">Using mutual authentication requires that a well formed server principal name be provided.</span></span> <span data-ttu-id="05319-111">Многие разработчики используют следующий сбой безопасности: сервер вызывается для запроса имени участника ([**рпкмгмтинксерверпринкнаме**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname)), после чего он не запрашивает взаимную проверку подлинности с помощью имени участника.</span><span class="sxs-lookup"><span data-stu-id="05319-111">Many developers use the following faulty security practice: The server is called to ask for its principal name ([**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname)), and then they blindly ask for mutual authentication using that principal name.</span></span> <span data-ttu-id="05319-112">Этот подход нарушает всю идею взаимной проверки подлинности. идея взаимной проверки подлинности заключается в том, что вызываются только определенные серверы, так как они являются доверенными для анализа и обработки данных.</span><span class="sxs-lookup"><span data-stu-id="05319-112">This approach breaks the whole idea of mutual authentication; the idea of mutual authentication is that only certain servers are called because they are trusted to parse and handle your data.</span></span> <span data-ttu-id="05319-113">Используя только что описанную методику безопасности, разработчики применяют свои данные для того, чтобы они могли возвращать свое имя.</span><span class="sxs-lookup"><span data-stu-id="05319-113">Using the faulty security practice just described, developers give their data to anyone smart enough to return their name.</span></span>

<span data-ttu-id="05319-114">Например, если клиентское программное обеспечение должно вызывать только сервер, работающий под учетными записями Джо, Иван или Алисы, необходимо вызвать функцию [**рпкмгмтинксерверпринкнаме**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname) , а затем проверить возвращаемое имя.</span><span class="sxs-lookup"><span data-stu-id="05319-114">As an example, if the client software should call only a server running under Joe, Pete, or Alice's accounts, the [**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname) function should be called, and the name sent back should be checked.</span></span> <span data-ttu-id="05319-115">Если это Джо, Иван или Alice, то взаимная проверка подлинности должна быть запрошена с использованием имени участника на сервере.</span><span class="sxs-lookup"><span data-stu-id="05319-115">If it is Joe, Pete or Alice, mutual authentication should be requested using their server principal name.</span></span> <span data-ttu-id="05319-116">Это гарантирует, что обе половины диалога поступают к одному и тому же участнику.</span><span class="sxs-lookup"><span data-stu-id="05319-116">This ensures both halves of the conversation go to the same principal.</span></span>

<span data-ttu-id="05319-117">Если клиентское программное обеспечение должно вызывать службу, работающую только под учетной записью Джо, непосредственно создать имя участника-службы и выполнить вызов.</span><span class="sxs-lookup"><span data-stu-id="05319-117">If client software should call a service running under Joe's account only, directly compose Joe's server principal name and make the call.</span></span> <span data-ttu-id="05319-118">Если сервер не является Джо, вызов просто завершится ошибкой.</span><span class="sxs-lookup"><span data-stu-id="05319-118">If the server is not Joe, the call will simply fail.</span></span>

<span data-ttu-id="05319-119">Многие раз службы выполняются как системные службы Windows, что означает, что они выполняются под учетной записью компьютера.</span><span class="sxs-lookup"><span data-stu-id="05319-119">Many times, services run as Windows system services, which means they run under the machine account.</span></span> <span data-ttu-id="05319-120">Также рекомендуется взаимная проверка подлинности и создание имени участника-сервера.</span><span class="sxs-lookup"><span data-stu-id="05319-120">Mutual authentication and creation of a server principal name is still recommended.</span></span>

## <a name="use-the-lowest-impersonationtype-that-allows-the-call-to-go-through"></a><span data-ttu-id="05319-121">Используйте самый низкий Имперсонатионтипе, позволяющий вызвать Go</span><span class="sxs-lookup"><span data-stu-id="05319-121">Use the Lowest ImpersonationType that Allows the Call to Go Through</span></span>

<span data-ttu-id="05319-122">Эта рекомендация является довольно ясной.</span><span class="sxs-lookup"><span data-stu-id="05319-122">This Best Practice is fairly self explanatory.</span></span> <span data-ttu-id="05319-123">Даже если используется взаимная проверка подлинности, не выдайте серверу больше прав, чем требуется. законный сервер мог быть скомпрометирован, и несмотря на то, что отправленные данные попадают в неправильные руки в таких случаях, по крайней мере сервер не сможет получить доступ к другим данным в сети от вашего имени.</span><span class="sxs-lookup"><span data-stu-id="05319-123">Even if mutual authentication is used, do not give the server more rights than necessary; a legitimate server may have been compromised, and even though the data you send falls into the wrong hands in such cases, at least the server will not be able to access other data on the network on your behalf.</span></span> <span data-ttu-id="05319-124">Некоторые серверы ототклоняют вызов, который не имеет достаточных сведений для определения и, возможно, олицетворения вызывающего.</span><span class="sxs-lookup"><span data-stu-id="05319-124">Some servers will reject a call that does not have sufficient information to determine, and possibly impersonate, the caller.</span></span> <span data-ttu-id="05319-125">Кроме того, имейте в виду, что некоторые последовательности протоколов поддерживают безопасность на транспортном уровне ([**нкакн \_ NP**](/windows/desktop/Midl/ncacn-np) и [**нкалрпк**](/windows/desktop/Midl/ncalrpc)).</span><span class="sxs-lookup"><span data-stu-id="05319-125">Also, be aware that some protocol sequences support transport level security ([**ncacn\_np**](/windows/desktop/Midl/ncacn-np) and [**ncalrpc**](/windows/desktop/Midl/ncalrpc)).</span></span> <span data-ttu-id="05319-126">В таких случаях сервер всегда может олицетворять пользователя, если при создании маркера привязки указать достаточно высокий уровень олицетворения через параметр *нетворкоптионс* .</span><span class="sxs-lookup"><span data-stu-id="05319-126">In such cases, the server can always impersonate you if you specify a sufficiently high impersonation level through the *NetworkOptions* parameter when you create the binding handle.</span></span>

<span data-ttu-id="05319-127">Наконец, некоторые поставщики или транспорты безопасности могут прозрачно увеличить Имперсонатионтипе на более высокий уровень, чем указанный.</span><span class="sxs-lookup"><span data-stu-id="05319-127">Finally, some security providers or transports may transparently bump ImpersonationType to a higher level than that specified.</span></span> <span data-ttu-id="05319-128">При разработке программы убедитесь, что вы пытаетесь выполнить вызовы с предполагаемой Имперсонатионтипе и проверьте, получаете ли вы более высокие Имперсонатионтипе на сервере.</span><span class="sxs-lookup"><span data-stu-id="05319-128">When developing a program, make sure you try to make calls with the intended ImpersonationType and check whether you are getting higher ImpersonationType on the server.</span></span>

 

 