---
title: Рекомендации по развертыванию RPC по HTTP
description: В этом разделе описываются рекомендации и рекомендуемые конфигурации развертывания для достижения максимальной безопасности и производительности при использовании RPC через HTTP.
ms.assetid: 83938a7d-77d0-45e8-b0a3-7b32ef768d83
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8871686d1fc8b87bcd6fb7ac4314b1977252f23a
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104068431"
---
# <a name="rpc-over-http-deployment-recommendations"></a>Рекомендации по развертыванию RPC по HTTP

В этом разделе описываются рекомендации и рекомендуемые конфигурации развертывания для достижения максимальной безопасности и производительности при использовании RPC через HTTP. Различные конфигурации, найденные в этом документе, относятся к разным организациям на основе различных требований к размеру, бюджету и безопасности. Каждая конфигурация также предоставляет рекомендации по развертыванию, позволяющие определить, какой из них лучше подходит для конкретного сценария.

Сведения о сценариях RPC по протоколу HTTP для большого объема см. в [статье балансировка нагрузки Microsoft RPC](rpc-load-balancing.md).

Следующие рекомендации применимы ко всем конфигурациям.

-   Используйте версии Windows, поддерживающие RPC через HTTP v2.
-   Установите службы IIS на компьютере, на котором выполняется прокси-сервер RPC, в режиме IIS 6,0.
-   Запретить анонимный доступ к виртуальному каталогу прокси-сервера RPC.
-   Никогда не включайте раздел реестра AllowAnonymous.
-   Сделайте так, чтобы клиенты RPC через HTTP использовали **цертификатесубжектфиелд** (см. [**рпкбиндингсетаусинфоекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) для получения дополнительных сведений), чтобы убедиться, что прокси-сервер RPC, к которому вы подключены, является прокси-сервером RPC.
-   Настройте раздел реестра **ValidPorts** , чтобы он содержал только те компьютеры, к которым будут подключаться клиенты RPC через HTTP.
-   Не используйте подстановочные знаки в ключе **ValidPorts** . Это позволяет экономить время, но полностью неожиданный компьютер также может соответствовать подстановочному знаку.
-   Используйте протокол SSL для клиентов RPC через HTTP. Если соблюдаются рекомендации, указанные в этих разделах, то клиент RPC через HTTP не сможет подключиться без использования SSL.
-   Настройте клиенты RPC через HTTP для использования шифрования RPC в дополнение к использованию SSL. Если клиент RPC через HTTP не может связаться с KDC, он может использовать только Negotiate и NTLM.
-   Настройте клиентские компьютеры для использования NTLMv2. Задайте для раздела реестра **LmCompatibilityLevel** значение 2 или выше. Дополнительные сведения о ключе **LmCompatibilityLevel** см. в разделе **MSDN.Microsoft.com** .
-   Запустите веб-ферму прокси-серверов RPC с помощью описанной выше конфигурации.
-   Разверните брандмауэр между Интернетом и прокси-сервером RPC.
-   Для оптимальной производительности настройте службы IIS для отправки коротких ответов на коды ошибок, не связанные с успешным выполнением. Поскольку потребитель IIS-ответа является автоматизированным процессом, нет необходимости отправлять пользователю понятные объяснения. они будут просто игнорироваться клиентом RPC через HTTP.

Основными целями прокси-сервера RPC от точки зрения безопасности, производительности и управляемости являются следующие:

-   Предоставьте единую точку входа для трафика RPC через HTTP в сеть сервера. Наличие единой точки входа для трафика RPC через HTTP в серверной сети имеет два основных преимущества. Во-первых, поскольку прокси RPC работает в Интернете, большинство организаций изолируют такие машины в специальной сети, называемой ненадежной сетью периметра, которая отличается от нормальной сети Организации. Серверы в ненадежной сети периметра очень тщательно контролируются, настраиваются и отслеживаются, чтобы иметь возможность выдерживать атаки из Интернета. Чем меньше компьютеров в сети периметра, не являющейся доверенной, тем проще настроить, контролировать, отслеживать и обеспечивать безопасность. Во-вторых, так как одна и той же Web ферма с установленными прокси RPC могут обслуживать любое количество серверов RPC через HTTP, размещенное в корпоративной сети, имеет смысл разделить прокси-сервер RPC от сервера RPC через HTTP, а прокси-сервер RPC находится в ненадежной сети периметра. Если прокси RPC находился на том же компьютере, что и сервер RPC через HTTP, организациям пришлось бы перевести все свои серверные серверы в недоверенную сеть периметра, что значительно усложняет защиту ненадежной сети периметра. Отделение роли прокси-сервера RPC и сервера RPC через HTTP помогает организациям поддерживать количество машин в ненадежной сети периметра, которое является управляемым и, следовательно, более безопасным.
-   Выступает в качестве предохранителя безопасности для сети сервера. Прокси-сервер RPC разрабатывается как предохранитель предохранителя для сети сервера. Если на прокси-сервере RPC что-то пойдет не так, он просто выйдет из строя и обеспечит защиту реальной RPC через HTTP-сервер. Если в этом разделе были выполнены приведенные выше рекомендации, трафик RPC через HTTP шифруется с помощью шифрования RPC в дополнение к SSL. Шифрование RPC происходит между клиентом и сервером, а не между клиентом и прокси. Это означает, что прокси-сервер не понимает и не может расшифровать получаемый трафик RPC. Он понимает только некоторые контрольные последовательности, отправленные ему клиентом, который управляет подключением, управлением потоком и другими сведениями о туннелировании. Он не имеет доступа к данным, которые клиент RPC через HTTP отправляет на сервер. Кроме того, клиент RPC через HTTP должен пройти проверку подлинности как прокси RPC, так и сервера RPC через HTTP. Это обеспечивает глубину защиты. Если компьютер прокси-сервера RPC подвергается компрометации, из-за ошибки конфигурации или нарушения безопасности, данные, передаваемые через нее, по-прежнему защищаются от несанкционированного доступа. Злоумышленник, который мог бы получить контроль над прокси-сервером RPC, может максимально прерывать трафик, но не читать его или изменять его. Именно здесь передается роль предохранителя прокси-сервера RPC — она может извлекаться без нарушения безопасности трафика RPC через HTTP.
-   Распределите некоторые проверки доступа и расшифровки между несколькими компьютерами, на которых выполняется прокси RPC, на веб-ферме. Так как хорошо работает в веб-ферме, прокси RPC позволяет организациям разгрузить расшифровку SSL и некоторые проверки доступа, таким образом освобождая больше емкости на внутреннем сервере для обработки. Использование веб-фермы компьютеров прокси-сервера RPC позволяет Организации повысить способность атак типа "отказ в обслуживании" (DoS), увеличивая емкость серверов клиентского доступа.

В рамках правил, установленных до сих пор, Организации все еще имеют выбор. В каждой организации есть варианты и компромиссы между неудобством пользователей, безопасностью и затратами.

-   **Использовать обычную проверку подлинности или встроенную проверку подлинности Windows для проверки подлинности прокси RPC?** В настоящее время RPC через HTTP поддерживает только протокол NTLM — он не поддерживает протокол Kerberos. Кроме того, при наличии прокси-сервера HTTP или брандмауэра между клиентом RPC через HTTP и прокси-сервером RPC, который вставляет директиву pragma *через* прагма в заголовок HTTP, проверка подлинности NTLM не будет работать. Если это не так, организации могут выбрать обычную проверку подлинности и NTLM. Преимущество обычной проверки подлинности заключается в том, что это быстрее и проще, и поэтому предлагает меньше возможностей для атак типа «отказ в обслуживании». Но NTLM является более безопасной. В зависимости от приоритета Организации он может выбрать базовый, NTLM или разрешить пользователям выбирать между ними. Если выбран только один вариант, лучше отключить другой из виртуального каталога прокси-сервера RPC, чтобы снизить риск атаки.
-   **Использовать один и тот же набор учетных данных для прокси-сервера RPC и RPC через HTTP или использовать разные учетные данные для каждого из них?** Компромисс между этим решением заключается в обеспечении удобства пользователя и безопасности. Несколько пользователей, например, вводят несколько учетных данных. Однако если нарушение безопасности происходит в ненадежной сети периметра, наличие отдельных наборов учетных данных для прокси-сервера RPC и сервера RPC через HTTP обеспечивает дополнительную защиту. Обратите внимание, что если используются отдельные учетные данные, а один набор учетных данных — учетные данные домена пользователя, рекомендуется использовать учетные данные домена пользователя для сервера RPC через HTTP, а не прокси-сервер RPC.

 

 




