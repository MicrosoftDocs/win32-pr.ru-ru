---
title: Рекомендации по развертыванию RPC по HTTP
description: В этом разделе описываются рекомендации и рекомендуемые конфигурации развертывания для достижения максимальной безопасности и производительности при использовании RPC через HTTP.
ms.assetid: 83938a7d-77d0-45e8-b0a3-7b32ef768d83
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8871686d1fc8b87bcd6fb7ac4314b1977252f23a
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104068431"
---
# <a name="rpc-over-http-deployment-recommendations"></a><span data-ttu-id="c42b2-103">Рекомендации по развертыванию RPC по HTTP</span><span class="sxs-lookup"><span data-stu-id="c42b2-103">RPC over HTTP Deployment Recommendations</span></span>

<span data-ttu-id="c42b2-104">В этом разделе описываются рекомендации и рекомендуемые конфигурации развертывания для достижения максимальной безопасности и производительности при использовании RPC через HTTP.</span><span class="sxs-lookup"><span data-stu-id="c42b2-104">This section documents best practices and recommended deployment configurations for achieving maximum security and performance when using RPC over HTTP.</span></span> <span data-ttu-id="c42b2-105">Различные конфигурации, найденные в этом документе, относятся к разным организациям на основе различных требований к размеру, бюджету и безопасности.</span><span class="sxs-lookup"><span data-stu-id="c42b2-105">The various configurations found herein apply do different organizations based on various size, budget, and security requirements.</span></span> <span data-ttu-id="c42b2-106">Каждая конфигурация также предоставляет рекомендации по развертыванию, позволяющие определить, какой из них лучше подходит для конкретного сценария.</span><span class="sxs-lookup"><span data-stu-id="c42b2-106">Each configuration also provides deployment considerations useful in determining which is best for a given scenario.</span></span>

<span data-ttu-id="c42b2-107">Сведения о сценариях RPC по протоколу HTTP для большого объема см. в [статье балансировка нагрузки Microsoft RPC](rpc-load-balancing.md).</span><span class="sxs-lookup"><span data-stu-id="c42b2-107">For information regarding high volume RPC over HTTP scenarios, please see [Microsoft RPC Load Balancing](rpc-load-balancing.md).</span></span>

<span data-ttu-id="c42b2-108">Следующие рекомендации применимы ко всем конфигурациям.</span><span class="sxs-lookup"><span data-stu-id="c42b2-108">The following recommendations apply to all configurations:</span></span>

-   <span data-ttu-id="c42b2-109">Используйте версии Windows, поддерживающие RPC через HTTP v2.</span><span class="sxs-lookup"><span data-stu-id="c42b2-109">Use versions of Windows that support RPC over HTTP v2.</span></span>
-   <span data-ttu-id="c42b2-110">Установите службы IIS на компьютере, на котором выполняется прокси-сервер RPC, в режиме IIS 6,0.</span><span class="sxs-lookup"><span data-stu-id="c42b2-110">Put IIS on the machine that runs the RPC Proxy in IIS 6.0 mode.</span></span>
-   <span data-ttu-id="c42b2-111">Запретить анонимный доступ к виртуальному каталогу прокси-сервера RPC.</span><span class="sxs-lookup"><span data-stu-id="c42b2-111">Disallow anonymous access to the RPC Proxy virtual directory.</span></span>
-   <span data-ttu-id="c42b2-112">Никогда не включайте раздел реестра AllowAnonymous.</span><span class="sxs-lookup"><span data-stu-id="c42b2-112">Never enable the AllowAnonymous registry key.</span></span>
-   <span data-ttu-id="c42b2-113">Сделайте так, чтобы клиенты RPC через HTTP использовали **цертификатесубжектфиелд** (см. [**рпкбиндингсетаусинфоекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) для получения дополнительных сведений), чтобы убедиться, что прокси-сервер RPC, к которому вы подключены, является прокси-сервером RPC.</span><span class="sxs-lookup"><span data-stu-id="c42b2-113">Make your RPC over HTTP clients use the **CertificateSubjectField** (see [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) for more information) to verify that the RPC Proxy you connected to is the RPC Proxy you expect.</span></span>
-   <span data-ttu-id="c42b2-114">Настройте раздел реестра **ValidPorts** , чтобы он содержал только те компьютеры, к которым будут подключаться клиенты RPC через HTTP.</span><span class="sxs-lookup"><span data-stu-id="c42b2-114">Configure the **ValidPorts** registry key to contain only machines to which the RPC over HTTP clients will connect.</span></span>
-   <span data-ttu-id="c42b2-115">Не используйте подстановочные знаки в ключе **ValidPorts** . Это позволяет экономить время, но полностью неожиданный компьютер также может соответствовать подстановочному знаку.</span><span class="sxs-lookup"><span data-stu-id="c42b2-115">Do not use wildcards in the **ValidPorts** key; doing so can save time, but a completely unexpected machine may fit the wildcard as well.</span></span>
-   <span data-ttu-id="c42b2-116">Используйте протокол SSL для клиентов RPC через HTTP.</span><span class="sxs-lookup"><span data-stu-id="c42b2-116">Use SSL on RPC over HTTP clients.</span></span> <span data-ttu-id="c42b2-117">Если соблюдаются рекомендации, указанные в этих разделах, то клиент RPC через HTTP не сможет подключиться без использования SSL.</span><span class="sxs-lookup"><span data-stu-id="c42b2-117">If the guidelines set forth in these sections are followed, the RPC over HTTP client will not be able to connect without using SSL.</span></span>
-   <span data-ttu-id="c42b2-118">Настройте клиенты RPC через HTTP для использования шифрования RPC в дополнение к использованию SSL.</span><span class="sxs-lookup"><span data-stu-id="c42b2-118">Configure RPC over HTTP clients to use RPC Encryption in addition to using SSL.</span></span> <span data-ttu-id="c42b2-119">Если клиент RPC через HTTP не может связаться с KDC, он может использовать только Negotiate и NTLM.</span><span class="sxs-lookup"><span data-stu-id="c42b2-119">If the RPC over HTTP client cannot reach the KDC, it can use only Negotiate and NTLM.</span></span>
-   <span data-ttu-id="c42b2-120">Настройте клиентские компьютеры для использования NTLMv2.</span><span class="sxs-lookup"><span data-stu-id="c42b2-120">Configure client machines to use NTLMv2.</span></span> <span data-ttu-id="c42b2-121">Задайте для раздела реестра **LmCompatibilityLevel** значение 2 или выше.</span><span class="sxs-lookup"><span data-stu-id="c42b2-121">Set the **LMCompatibilityLevel** registry key to 2 or higher.</span></span> <span data-ttu-id="c42b2-122">Дополнительные сведения о ключе **LmCompatibilityLevel** см. в разделе **MSDN.Microsoft.com** .</span><span class="sxs-lookup"><span data-stu-id="c42b2-122">See **msdn.microsoft.com** for more information on the **LMCompatibilityLevel** key.</span></span>
-   <span data-ttu-id="c42b2-123">Запустите веб-ферму прокси-серверов RPC с помощью описанной выше конфигурации.</span><span class="sxs-lookup"><span data-stu-id="c42b2-123">Run a web farm of RPC Proxy machines with the configuration outlined above.</span></span>
-   <span data-ttu-id="c42b2-124">Разверните брандмауэр между Интернетом и прокси-сервером RPC.</span><span class="sxs-lookup"><span data-stu-id="c42b2-124">Deploy a firewall between the Internet and the RPC Proxy.</span></span>
-   <span data-ttu-id="c42b2-125">Для оптимальной производительности настройте службы IIS для отправки коротких ответов на коды ошибок, не связанные с успешным выполнением.</span><span class="sxs-lookup"><span data-stu-id="c42b2-125">For optimal performance, configure IIS to send a short response for non-success error codes.</span></span> <span data-ttu-id="c42b2-126">Поскольку потребитель IIS-ответа является автоматизированным процессом, нет необходимости отправлять пользователю понятные объяснения. они будут просто игнорироваться клиентом RPC через HTTP.</span><span class="sxs-lookup"><span data-stu-id="c42b2-126">Because the consumer of the IIS response is an automated process, there is no need for user friendly explanations to be sent to the client; they will simply be ignored by the RPC over HTTP client.</span></span>

<span data-ttu-id="c42b2-127">Основными целями прокси-сервера RPC от точки зрения безопасности, производительности и управляемости являются следующие:</span><span class="sxs-lookup"><span data-stu-id="c42b2-127">The basic goals of the RPC Proxy from a security, performance and manageability perspective are the following:</span></span>

-   <span data-ttu-id="c42b2-128">Предоставьте единую точку входа для трафика RPC через HTTP в сеть сервера.</span><span class="sxs-lookup"><span data-stu-id="c42b2-128">Provide a single point of entry for RPC over HTTP traffic into the server network.</span></span> <span data-ttu-id="c42b2-129">Наличие единой точки входа для трафика RPC через HTTP в серверной сети имеет два основных преимущества.</span><span class="sxs-lookup"><span data-stu-id="c42b2-129">Having a single point of entry for RPC over HTTP traffic into a server network has two main benefits.</span></span> <span data-ttu-id="c42b2-130">Во-первых, поскольку прокси RPC работает в Интернете, большинство организаций изолируют такие машины в специальной сети, называемой ненадежной сетью периметра, которая отличается от нормальной сети Организации.</span><span class="sxs-lookup"><span data-stu-id="c42b2-130">First, since the RPC Proxy is facing the Internet, most organizations isolate such machines in a special network called an untrusted perimeter network which is separate from the normal organizational network.</span></span> <span data-ttu-id="c42b2-131">Серверы в ненадежной сети периметра очень тщательно контролируются, настраиваются и отслеживаются, чтобы иметь возможность выдерживать атаки из Интернета.</span><span class="sxs-lookup"><span data-stu-id="c42b2-131">Servers in an untrusted perimeter network are very carefully managed, configured and monitored to be able to withstand attacks from the Internet.</span></span> <span data-ttu-id="c42b2-132">Чем меньше компьютеров в сети периметра, не являющейся доверенной, тем проще настроить, контролировать, отслеживать и обеспечивать безопасность.</span><span class="sxs-lookup"><span data-stu-id="c42b2-132">The fewer machines in an untrusted perimeter network, the easier it is to configure, manage, monitor and keep them secure.</span></span> <span data-ttu-id="c42b2-133">Во-вторых, так как одна и той же Web ферма с установленными прокси RPC могут обслуживать любое количество серверов RPC через HTTP, размещенное в корпоративной сети, имеет смысл разделить прокси-сервер RPC от сервера RPC через HTTP, а прокси-сервер RPC находится в ненадежной сети периметра.</span><span class="sxs-lookup"><span data-stu-id="c42b2-133">Second, since a single Web Farm with RPC Proxies installed can service any number of RPC over HTTP Servers residing on the corporate network, it makes a lot of sense to separate the RPC Proxy from the RPC over HTTP Server and have the RPC Proxy reside in an untrusted perimeter network.</span></span> <span data-ttu-id="c42b2-134">Если прокси RPC находился на том же компьютере, что и сервер RPC через HTTP, организациям пришлось бы перевести все свои серверные серверы в недоверенную сеть периметра, что значительно усложняет защиту ненадежной сети периметра.</span><span class="sxs-lookup"><span data-stu-id="c42b2-134">If the RPC Proxy was on the same machine as the RPC over HTTP Server, organizations would be forced to put all of their back end servers into an untrusted perimeter network, which would make it much harder to keep the untrusted perimeter network secure.</span></span> <span data-ttu-id="c42b2-135">Отделение роли прокси-сервера RPC и сервера RPC через HTTP помогает организациям поддерживать количество машин в ненадежной сети периметра, которое является управляемым и, следовательно, более безопасным.</span><span class="sxs-lookup"><span data-stu-id="c42b2-135">Separating the role of the RPC Proxy and the RPC over HTTP server helps organizations keep the number of machines in an untrusted perimeter network manageable and therefore, more secure.</span></span>
-   <span data-ttu-id="c42b2-136">Выступает в качестве предохранителя безопасности для сети сервера.</span><span class="sxs-lookup"><span data-stu-id="c42b2-136">Serve as a safety fuse for the server network.</span></span> <span data-ttu-id="c42b2-137">Прокси-сервер RPC разрабатывается как предохранитель предохранителя для сети сервера. Если на прокси-сервере RPC что-то пойдет не так, он просто выйдет из строя и обеспечит защиту реальной RPC через HTTP-сервер.</span><span class="sxs-lookup"><span data-stu-id="c42b2-137">The RPC Proxy is designed as an expendable fuse for the server network – if something goes wrong on the RPC Proxy, it simply goes out and thus protects the real RPC over HTTP server.</span></span> <span data-ttu-id="c42b2-138">Если в этом разделе были выполнены приведенные выше рекомендации, трафик RPC через HTTP шифруется с помощью шифрования RPC в дополнение к SSL.</span><span class="sxs-lookup"><span data-stu-id="c42b2-138">If the outlined best practices outlined in this section have been followed thus far, the RPC over HTTP traffic is encrypted with RPC encryption in addition to SSL.</span></span> <span data-ttu-id="c42b2-139">Шифрование RPC происходит между клиентом и сервером, а не между клиентом и прокси.</span><span class="sxs-lookup"><span data-stu-id="c42b2-139">The RPC Encryption itself is between the client and the server, not between the client and the proxy.</span></span> <span data-ttu-id="c42b2-140">Это означает, что прокси-сервер не понимает и не может расшифровать получаемый трафик RPC.</span><span class="sxs-lookup"><span data-stu-id="c42b2-140">This means the proxy does not understand and cannot decrypt the RPC traffic it receives.</span></span> <span data-ttu-id="c42b2-141">Он понимает только некоторые контрольные последовательности, отправленные ему клиентом, который управляет подключением, управлением потоком и другими сведениями о туннелировании.</span><span class="sxs-lookup"><span data-stu-id="c42b2-141">It only understands some control sequences sent to it by the client dealing with connection establishment, flow control and other tunneling details.</span></span> <span data-ttu-id="c42b2-142">Он не имеет доступа к данным, которые клиент RPC через HTTP отправляет на сервер.</span><span class="sxs-lookup"><span data-stu-id="c42b2-142">It has no access to the data the RPC over HTTP client sends to the server.</span></span> <span data-ttu-id="c42b2-143">Кроме того, клиент RPC через HTTP должен пройти проверку подлинности как прокси RPC, так и сервера RPC через HTTP.</span><span class="sxs-lookup"><span data-stu-id="c42b2-143">Furthermore, the RPC over HTTP client must independently authenticate to both the RPC Proxy and the RPC over HTTP server.</span></span> <span data-ttu-id="c42b2-144">Это обеспечивает глубину защиты.</span><span class="sxs-lookup"><span data-stu-id="c42b2-144">This provides defense in depth.</span></span> <span data-ttu-id="c42b2-145">Если компьютер прокси-сервера RPC подвергается компрометации, из-за ошибки конфигурации или нарушения безопасности, данные, передаваемые через нее, по-прежнему защищаются от несанкционированного доступа.</span><span class="sxs-lookup"><span data-stu-id="c42b2-145">If the RPC Proxy machine becomes compromised, due to some configuration error or a security breach of some sort, the data that pass through it are still secure from tampering.</span></span> <span data-ttu-id="c42b2-146">Злоумышленник, который мог бы получить контроль над прокси-сервером RPC, может максимально прерывать трафик, но не читать его или изменять его.</span><span class="sxs-lookup"><span data-stu-id="c42b2-146">An attacker that would gain control of the RPC Proxy can at most interrupt the traffic, but not read it or tamper with it.</span></span> <span data-ttu-id="c42b2-147">Именно здесь передается роль предохранителя прокси-сервера RPC — она может извлекаться без нарушения безопасности трафика RPC через HTTP.</span><span class="sxs-lookup"><span data-stu-id="c42b2-147">This is where the fuse role of the RPC Proxy comes into play – it is expendable without the security of the RPC over HTTP traffic being compromised.</span></span>
-   <span data-ttu-id="c42b2-148">Распределите некоторые проверки доступа и расшифровки между несколькими компьютерами, на которых выполняется прокси RPC, на веб-ферме.</span><span class="sxs-lookup"><span data-stu-id="c42b2-148">Distribute some of the access checks and decryption work among multiple machines running RPC Proxy in a Web Farm.</span></span> <span data-ttu-id="c42b2-149">Так как хорошо работает в веб-ферме, прокси RPC позволяет организациям разгрузить расшифровку SSL и некоторые проверки доступа, таким образом освобождая больше емкости на внутреннем сервере для обработки.</span><span class="sxs-lookup"><span data-stu-id="c42b2-149">By functioning well in a Web Farm, the RPC Proxy enables organizations to offload SSL decryption and some of the access checks, thus freeing more capacity on the back end server for processing.</span></span> <span data-ttu-id="c42b2-150">Использование веб-фермы компьютеров прокси-сервера RPC позволяет Организации повысить способность атак типа "отказ в обслуживании" (DoS), увеличивая емкость серверов клиентского доступа.</span><span class="sxs-lookup"><span data-stu-id="c42b2-150">Using a Web Farm of RPC Proxy machines also enables an organization to increase its ability to withstand Denial of Service (DoS) attacks by increasing the capacity on its front end servers.</span></span>

<span data-ttu-id="c42b2-151">В рамках правил, установленных до сих пор, Организации все еще имеют выбор.</span><span class="sxs-lookup"><span data-stu-id="c42b2-151">Within the guidelines set forth thus far, organizations still have choices.</span></span> <span data-ttu-id="c42b2-152">В каждой организации есть варианты и компромиссы между неудобством пользователей, безопасностью и затратами.</span><span class="sxs-lookup"><span data-stu-id="c42b2-152">Each organization has choices and compromises between user inconvenience, security and cost:</span></span>

-   <span data-ttu-id="c42b2-153">**Использовать обычную проверку подлинности или встроенную проверку подлинности Windows для проверки подлинности прокси RPC?**</span><span class="sxs-lookup"><span data-stu-id="c42b2-153">**Use Basic Authentication or Windows Integrated Authentication to authenticate to the RPC Proxy?**</span></span> <span data-ttu-id="c42b2-154">В настоящее время RPC через HTTP поддерживает только протокол NTLM — он не поддерживает протокол Kerberos.</span><span class="sxs-lookup"><span data-stu-id="c42b2-154">RPC over HTTP currently supports only NTLM – it doesn't support Kerberos.</span></span> <span data-ttu-id="c42b2-155">Кроме того, при наличии прокси-сервера HTTP или брандмауэра между клиентом RPC через HTTP и прокси-сервером RPC, который вставляет директиву pragma *через* прагма в заголовок HTTP, проверка подлинности NTLM не будет работать.</span><span class="sxs-lookup"><span data-stu-id="c42b2-155">Also, if there is an HTTP Proxy or a firewall between the RPC over HTTP client and the RPC Proxy which inserts the *via* pragma in the HTTP header, NTLM authentication will not work.</span></span> <span data-ttu-id="c42b2-156">Если это не так, организации могут выбрать обычную проверку подлинности и NTLM.</span><span class="sxs-lookup"><span data-stu-id="c42b2-156">When that is not the case, organizations can choose between Basic and NTLM authentication.</span></span> <span data-ttu-id="c42b2-157">Преимущество обычной проверки подлинности заключается в том, что это быстрее и проще, и поэтому предлагает меньше возможностей для атак типа «отказ в обслуживании».</span><span class="sxs-lookup"><span data-stu-id="c42b2-157">The advantage of Basic authentication is that it is faster and simpler, and therefore offers less opportunity for denial of service attacks.</span></span> <span data-ttu-id="c42b2-158">Но NTLM является более безопасной.</span><span class="sxs-lookup"><span data-stu-id="c42b2-158">But NTLM is more secure.</span></span> <span data-ttu-id="c42b2-159">В зависимости от приоритета Организации он может выбрать базовый, NTLM или разрешить пользователям выбирать между ними.</span><span class="sxs-lookup"><span data-stu-id="c42b2-159">Depending on an organization's priorities, it can choose Basic, NTLM, or allow its users to choose between the two.</span></span> <span data-ttu-id="c42b2-160">Если выбран только один вариант, лучше отключить другой из виртуального каталога прокси-сервера RPC, чтобы снизить риск атаки.</span><span class="sxs-lookup"><span data-stu-id="c42b2-160">If only one is chosen, it is best to turn off the other from the RPC Proxy virtual directory to reduce risk of attack.</span></span>
-   <span data-ttu-id="c42b2-161">**Использовать один и тот же набор учетных данных для прокси-сервера RPC и RPC через HTTP или использовать разные учетные данные для каждого из них?**</span><span class="sxs-lookup"><span data-stu-id="c42b2-161">**Use the same set of credentials for both the RPC Proxy and the RPC over HTTP Server, or use different credentials for each?**</span></span> <span data-ttu-id="c42b2-162">Компромисс между этим решением заключается в обеспечении удобства пользователя и безопасности.</span><span class="sxs-lookup"><span data-stu-id="c42b2-162">The tradeoff for this decision is between user's convenience and security.</span></span> <span data-ttu-id="c42b2-163">Несколько пользователей, например, вводят несколько учетных данных.</span><span class="sxs-lookup"><span data-stu-id="c42b2-163">Few users like to enter multiple credentials.</span></span> <span data-ttu-id="c42b2-164">Однако если нарушение безопасности происходит в ненадежной сети периметра, наличие отдельных наборов учетных данных для прокси-сервера RPC и сервера RPC через HTTP обеспечивает дополнительную защиту.</span><span class="sxs-lookup"><span data-stu-id="c42b2-164">However, if a security breach occurs in an untrusted perimeter network, having separate sets of credentials for the RPC Proxy and the RPC over HTTP Server provides additional protection.</span></span> <span data-ttu-id="c42b2-165">Обратите внимание, что если используются отдельные учетные данные, а один набор учетных данных — учетные данные домена пользователя, рекомендуется использовать учетные данные домена пользователя для сервера RPC через HTTP, а не прокси-сервер RPC.</span><span class="sxs-lookup"><span data-stu-id="c42b2-165">Note that if separate credentials are used, and one set of credentials is the user's domain credentials, it is advisable to use the user's domain credentials for the RPC over HTTP Server and not for the RPC Proxy.</span></span>

 

 




