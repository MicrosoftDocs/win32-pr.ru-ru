---
title: Строки формата NDR для RPC
description: Строки формата ОНД для удаленного вызова процедур (RPC).
ms.assetid: 9c83a039-49d3-491d-8110-29d1548730de
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cf0569a913d6c5a4b19b342cc288d6a8682dfc4a
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103891013"
---
# <a name="rpc-ndr-format-strings"></a><span data-ttu-id="426b5-103">Строки формата NDR для RPC</span><span class="sxs-lookup"><span data-stu-id="426b5-103">RPC NDR Format Strings</span></span>

## <a name="ndr-engine-32-bit-interpreter"></a><span data-ttu-id="426b5-104">Модуль NDR: 32-разрядный интерпретатор</span><span class="sxs-lookup"><span data-stu-id="426b5-104">NDR Engine: 32-bit Interpreter</span></span>

<span data-ttu-id="426b5-105">В этом документе описываются дескрипторы строк формата, иногда называемые MOPs, для подсистемы доставки 32-бит NDR.</span><span class="sxs-lookup"><span data-stu-id="426b5-105">This document describes the format string descriptors, sometimes referred to as MOPs, for the 32-bit NDR engine.</span></span> <span data-ttu-id="426b5-106">В этом разделе описываются изменения, связанные с развитием, от интерпретатора [**– Oi**](/windows/desktop/Midl/-oi) до уровня интерпретатора **– ОИФ** , а также дополнений, связанных с каналами и асинхронной поддержкой.</span><span class="sxs-lookup"><span data-stu-id="426b5-106">This section describes changes associated with the evolution from the [**–Oi**](/windows/desktop/Midl/-oi) interpreter to the **–Oif** interpreter layer, as well as additions related to pipes and asynchronous support.</span></span>

<span data-ttu-id="426b5-107">В этом документе описывается текущая технология язык MIDL (MIDL) с точки зрения ядра и текущая подсистема NDR.</span><span class="sxs-lookup"><span data-stu-id="426b5-107">This document describes current Microsoft Interface Definition Language (MIDL) technology from the engine perspective, and the current NDR engine.</span></span>

## <a name="overview"></a><span data-ttu-id="426b5-108">Обзор</span><span class="sxs-lookup"><span data-stu-id="426b5-108">Overview</span></span>

<span data-ttu-id="426b5-109">Модуль NDR — это модуль упаковки компонентов удаленного вызова процедур (RPC) и DCOM.</span><span class="sxs-lookup"><span data-stu-id="426b5-109">The NDR engine is the marshaling engine of the Remote Procedure Call (RPC) and DCOM components.</span></span> <span data-ttu-id="426b5-110">Он обрабатывает все проблемы, связанные с заглушкой удаленного вызова.</span><span class="sxs-lookup"><span data-stu-id="426b5-110">It handles all stub-related issues of a remote call.</span></span> <span data-ttu-id="426b5-111">В качестве процесса маршалирование ОНД управляется кодом C из заглушек, созданных MIDL, генератором JIT-типа MIDL или заглушками, созданными другими инструментами или написанными вручную.</span><span class="sxs-lookup"><span data-stu-id="426b5-111">As a process, NDR marshaling is driven by the C code from MIDL-generated stubs, a MIDL JIT-type generator, or by stubs generated by other tools or written manually.</span></span> <span data-ttu-id="426b5-112">В свою очередь, подсистема доставки ОНД управляет базовым временем выполнения (DCOM или RPC), которое взаимодействует с конкретными транспортами.</span><span class="sxs-lookup"><span data-stu-id="426b5-112">In turn, the NDR engine drives the underlying run time (DCOM or RPC) that communicates with specific transports.</span></span>

<span data-ttu-id="426b5-113">Первоначальной целью разработки было предоставление средства для эффективного маршалирования произвольных данных на основе информации, предоставляемой компилятором MIDL.</span><span class="sxs-lookup"><span data-stu-id="426b5-113">The original goal of the design had been to provide a tool for effective marshaling for arbitrary data, based on information provided by the MIDL compiler.</span></span> <span data-ttu-id="426b5-114">Строки формата, описанные в этом документе, и фактически все сведения, создаваемые компилятором для использования модуля NDR, всегда считаются внутренним интерфейсом между компилятором и ядром.</span><span class="sxs-lookup"><span data-stu-id="426b5-114">The format strings described in this document—and indeed all information generated by the compiler for NDR engine consumption—have always been considered an internal interface between the compiler and the engine.</span></span> <span data-ttu-id="426b5-115">Аналогично, интерфейсы, доступные механизму для обработки проблем во время выполнения, также являются внутренними (некоторые исключения существуют на стороне среды выполнения RPC, а некоторые интерфейсы DCOM, используемые ядром, являются внешними).</span><span class="sxs-lookup"><span data-stu-id="426b5-115">Similarly, interfaces available to the engine to handle run-time issues are also mostly internal (some exceptions exist on the RPC run-time side, and some DCOM interfaces used by the engine are external).</span></span>

<span data-ttu-id="426b5-116">Два типичных подхода к упаковке всегда были встроенными и управляемыми данными (интерпретируемыми) технологиями.</span><span class="sxs-lookup"><span data-stu-id="426b5-116">Two typical approaches to marshaling have always been inline and data-driven (interpreted) technology.</span></span> <span data-ttu-id="426b5-117">MIDL поддерживает оба параметра [**– OS**](/windows/desktop/Midl/-os) и [**– Oi \***](/windows/desktop/Midl/-oi) в заглушках, созданных C.</span><span class="sxs-lookup"><span data-stu-id="426b5-117">MIDL supports both through its [**–Os**](/windows/desktop/Midl/-os) and [**–Oi\***](/windows/desktop/Midl/-oi) switches in its C-generated stubs.</span></span> <span data-ttu-id="426b5-118">Кроме того, MIDL может создавать библиотеки TLB, используемые пакетом oleautomation.</span><span class="sxs-lookup"><span data-stu-id="426b5-118">In addition, MIDL can generate the TLB libraries used by the oleautomation package.</span></span> <span data-ttu-id="426b5-119">Соответственно, одна из точек внутренних компонентов ядра заключается в том, что она состоит из двух частей.</span><span class="sxs-lookup"><span data-stu-id="426b5-119">Accordingly, one perspective of the engine's internals is that it consists of two parts.</span></span>

<span data-ttu-id="426b5-120">Первый — это набор подпрограмм, которые обрабатывали изменение размера, маршалирование и т. д., соответствующие типичным объектам типа данных, таким как структура или массив.</span><span class="sxs-lookup"><span data-stu-id="426b5-120">The first is a set of routines that handle sizing, marshaling, and so on, corresponding to typical data type objects like a structure or an array.</span></span> <span data-ttu-id="426b5-121">Эти подпрограммы точно настроены для повышения производительности; Например, они обычно пытаются блокировать и копировать данные везде, где это возможно.</span><span class="sxs-lookup"><span data-stu-id="426b5-121">These routines are fine-tuned for performance; for example, they typically attempt to block-copy data wherever possible.</span></span> <span data-ttu-id="426b5-122">Эта часть часто называется основной подсистемой NDR.</span><span class="sxs-lookup"><span data-stu-id="426b5-122">This part is often referred to as the core NDR engine.</span></span>

<span data-ttu-id="426b5-123">Вторая часть состоит из интерпретатора и связанных с ним частей.</span><span class="sxs-lookup"><span data-stu-id="426b5-123">The second part consists of an interpreter and its related pieces.</span></span> <span data-ttu-id="426b5-124">Интерпретатор использует подпрограммы из основной подсистемы доставки ОНД, как если бы из внутренней библиотеки выполнить удаленный вызов со всеми его аргументами, упакованными и неупакованными, в зависимости от ситуации.</span><span class="sxs-lookup"><span data-stu-id="426b5-124">The interpreter uses routines from the core NDR engine, as if from an internal library, in order to execute a remote call with all its arguments marshaled and unmarshaled, as appropriate.</span></span>

<span data-ttu-id="426b5-125">Основная подсистема ОНД используется аналогичным образом независимо от того, используется ли из встроенных заглушек или интерпретатора.</span><span class="sxs-lookup"><span data-stu-id="426b5-125">The core NDR engine is used in a similar manner whether used from inline stubs or from the interpreter.</span></span> <span data-ttu-id="426b5-126">Все подпрограммы ядра СУБД зависят от состояния, переданного структурой сообщений-заглушек.</span><span class="sxs-lookup"><span data-stu-id="426b5-126">All core engine routines depend on the state passed in by a stub message structure.</span></span> <span data-ttu-id="426b5-127">Структура настраивается соответствующим образом встроенной заглушкой или интерпретатором.</span><span class="sxs-lookup"><span data-stu-id="426b5-127">The structure is set up appropriately by the inline stub or by the interpreter.</span></span> <span data-ttu-id="426b5-128">В течение нескольких лет ядро ядра использовалось в другом контексте. в настоящее время интерпретатор представляет собой набор из нескольких отдельных циклов интерпретатора.</span><span class="sxs-lookup"><span data-stu-id="426b5-128">Over the years the core engine had been used in a different context; currently the interpreter is actually a set of several distinct interpreter loops.</span></span> <span data-ttu-id="426b5-129">Они связаны со старыми и новыми интерпретаторами ([**– Oi**](/windows/desktop/Midl/-oi) и **– ОИФ**), а также с циклами, связанными с сериализацией данных (в области выбора), асинхронной поддержкой RPC и поддержкой асинхронной поддержки DCOM (RPC и DCOM имеют разные модели асинхронного программирования).</span><span class="sxs-lookup"><span data-stu-id="426b5-129">These are related to the old and new ([**–Oi**](/windows/desktop/Midl/-oi) versus **–Oif**) interpreters, as well as to loops related to data serialization (pickling), RPC async support and DCOM async support (RPC and DCOM have different asynchronous programming models).</span></span>

<span data-ttu-id="426b5-130">Помимо добавления новых функций, важным аспектом развития механизма NDR является общий сдвиг в подходе к интерпретаторам.</span><span class="sxs-lookup"><span data-stu-id="426b5-130">Beyond the addition of new features, an important aspect of the NDR engine evolution is a general shift in the approach to interpreters.</span></span> <span data-ttu-id="426b5-131">ОНД версии 1.1 была проведена в рамках нового подхода MIDL 2,0 для упаковки, а встроенные заглушки предпочтительны для соображений производительности.</span><span class="sxs-lookup"><span data-stu-id="426b5-131">NDR version1.1 began as part of a new MIDL 2.0 approach to marshaling, with the inline stubs being preferred for performance considerations.</span></span> <span data-ttu-id="426b5-132">С последней версией NDR, [**– ОИФ**](/windows/desktop/Midl/-oi) стал наиболее широко используемым режимом компилятора, почти до исключения встроенных заглушек.</span><span class="sxs-lookup"><span data-stu-id="426b5-132">With the most recent version of NDR, [**–Oif**](/windows/desktop/Midl/-oi) has become the most widely used mode of the compiler, almost to the exclusion of inline stubs.</span></span>

<span data-ttu-id="426b5-133">Дескрипторы строк формата модуля NDR RPC более подробно описаны в следующих разделах:</span><span class="sxs-lookup"><span data-stu-id="426b5-133">RPC NDR Engine format string descriptors are described in more detail in the following topics:</span></span>

-   [<span data-ttu-id="426b5-134">Строки форматирования</span><span class="sxs-lookup"><span data-stu-id="426b5-134">Format Strings</span></span>](format-strings.md)
-   [<span data-ttu-id="426b5-135">Строки формата процедур</span><span class="sxs-lookup"><span data-stu-id="426b5-135">Procedure Format Strings</span></span>](procedure-format-strings.md)
-   [<span data-ttu-id="426b5-136">Дескриптор заголовка процедуры</span><span class="sxs-lookup"><span data-stu-id="426b5-136">Procedure Header Descriptor</span></span>](procedure-header-descriptor.md)
-   [<span data-ttu-id="426b5-137">Handles</span><span class="sxs-lookup"><span data-stu-id="426b5-137">Handles</span></span>](handles.md)
-   [<span data-ttu-id="426b5-138">Заголовок</span><span class="sxs-lookup"><span data-stu-id="426b5-138">The Header</span></span>](the-header.md)
-   [<span data-ttu-id="426b5-139">Дескрипторы параметров</span><span class="sxs-lookup"><span data-stu-id="426b5-139">Parameter Descriptors</span></span>](parameter-descriptors.md)
-   [<span data-ttu-id="426b5-140">Строки формата типов</span><span class="sxs-lookup"><span data-stu-id="426b5-140">Type Format Strings</span></span>](type-format-strings.md)

 

 