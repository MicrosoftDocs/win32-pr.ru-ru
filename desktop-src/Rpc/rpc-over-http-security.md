---
title: Безопасность RPC через HTTP
description: RPC через HTTP предоставляет три типа защиты в дополнение к стандартному обеспечению безопасности RPC, что приводит к тому, что трафик RPC через HTTP защищается в RPC, а затем обеспечивается двойной защитой механизмом туннелирования, обеспечиваемым RPC через HTTP.
ms.assetid: 3a44c72b-b74c-433a-8826-1f76ca019f40
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 527cf5ff74120c41606d83a248e355a6ea46d9d5
ms.sourcegitcommit: 5b98bf8c68922f8f03c14f793fbe17504900559c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/12/2021
ms.locfileid: "104273213"
---
# <a name="rpc-over-http-security"></a><span data-ttu-id="0de42-103">Безопасность RPC через HTTP</span><span class="sxs-lookup"><span data-stu-id="0de42-103">RPC over HTTP Security</span></span>

<span data-ttu-id="0de42-104">RPC через HTTP предоставляет три типа защиты в дополнение к стандартному обеспечению безопасности RPC, что приводит к тому, что трафик RPC через HTTP защищается в RPC, а затем обеспечивается двойной защитой механизмом туннелирования, обеспечиваемым RPC через HTTP.</span><span class="sxs-lookup"><span data-stu-id="0de42-104">RPC over HTTP provides three types of security in addition to standard RPC security, which results in RPC over HTTP traffic being protected once by RPC, and then doubly protected by the tunneling mechanism provided by RPC over HTTP.</span></span> <span data-ttu-id="0de42-105">Описание стандартных механизмов безопасности RPC см. в разделе [Безопасность](security.md).</span><span class="sxs-lookup"><span data-stu-id="0de42-105">For a description of standard RPC security mechanisms, see [Security](security.md).</span></span> <span data-ttu-id="0de42-106">Механизм туннелирования RPC через HTTP добавляет к обычной безопасности RPC следующий способ:</span><span class="sxs-lookup"><span data-stu-id="0de42-106">The RPC over HTTP tunneling mechanism adds to normal RPC security in the following manner:</span></span>

-   <span data-ttu-id="0de42-107">Обеспечивает безопасность через IIS (доступно только для RPC через HTTP v2).</span><span class="sxs-lookup"><span data-stu-id="0de42-107">Provides security through the IIS (available for RPC over HTTP v2 only).</span></span>
-   <span data-ttu-id="0de42-108">Обеспечивает шифрование SSL и проверку прокси-сервера RPC (взаимная проверка подлинности).</span><span class="sxs-lookup"><span data-stu-id="0de42-108">Provides SSL encryption and RPC Proxy verification (mutual authentication).</span></span> <span data-ttu-id="0de42-109">Также доступно только в RPC через HTTP v2.</span><span class="sxs-lookup"><span data-stu-id="0de42-109">Also available in RPC over HTTP v2 only.</span></span>
-   <span data-ttu-id="0de42-110">Предоставляет ограничения на уровне прокси-сервера RPC, определяющие, на каких компьютерах в серверной сети разрешено принимать вызовы RPC через HTTP.</span><span class="sxs-lookup"><span data-stu-id="0de42-110">Provides restrictions on the RPC Proxy level dictating which machines on the server network are allowed to receive RPC over HTTP calls.</span></span>

<span data-ttu-id="0de42-111">Каждая из этих трех функций безопасности подробно описана в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="0de42-111">Each of these three security features is described in more detail in following sections.</span></span>

## <a name="iis-authentication"></a><span data-ttu-id="0de42-112">Проверка подлинности IIS</span><span class="sxs-lookup"><span data-stu-id="0de42-112">IIS Authentication</span></span>

<span data-ttu-id="0de42-113">RPC через HTTP может использовать стандартный механизм проверки подлинности IIS.</span><span class="sxs-lookup"><span data-stu-id="0de42-113">RPC over HTTP can leverage the normal authentication mechanism of IIS.</span></span> <span data-ttu-id="0de42-114">Виртуальный каталог для прокси-сервера RPC можно настроить с помощью узла RPC на веб-сайте по умолчанию в оснастке IIS MMC.</span><span class="sxs-lookup"><span data-stu-id="0de42-114">The virtual directory for RPC Proxy can be configured using the Rpc node under the Default Web Site in the IIS MMC snap-in:</span></span>

![Снимок экрана, показывающий узел RPC на веб-сайте по умолчанию в оснастке IIS MMC.](images/rpc-http-1.png)

<span data-ttu-id="0de42-116">Службы IIS можно настроить на отключение анонимного доступа и потребовать проверку подлинности в виртуальном каталоге для прокси-сервера RPC.</span><span class="sxs-lookup"><span data-stu-id="0de42-116">IIS can be configured to disable anonymous access and require authentication to the virtual directory for the RPC Proxy.</span></span> <span data-ttu-id="0de42-117">Для этого щелкните правой кнопкой мыши узел RPC и выберите пункт **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="0de42-117">To do this, right click the Rpc node and select **Properties**.</span></span> <span data-ttu-id="0de42-118">Откройте вкладку **Безопасность каталога** и нажмите кнопку **изменить** в группе **Управление доступом и проверками подлинности** , как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="0de42-118">Select the **Directory Security** tab and click the **Edit** button in the **Authentication and Access Control** group, as illustrated here:</span></span>

![Снимок экрана: диалоговое окно "свойства RPC".](images/rpc-http-2.png)

<span data-ttu-id="0de42-120">Хотя RPC через HTTP можно использовать, даже если виртуальный каталог RPC-прокси допускает анонимный доступ, корпорация Майкрософт настоятельно рекомендует отключить анонимный доступ к этому виртуальному каталогу по соображениям безопасности.</span><span class="sxs-lookup"><span data-stu-id="0de42-120">Although you can use RPC over HTTP even when the RPC Proxy virtual directory allows anonymous access, Microsoft strongly recommends disabling anonymous access to that virtual directory for security reasons.</span></span> <span data-ttu-id="0de42-121">Вместо этого для RPC через HTTP включите обычную проверку подлинности, встроенную проверку подлинности Windows или и то и другое.</span><span class="sxs-lookup"><span data-stu-id="0de42-121">Rather, for RPC over HTTP enable Basic Authentication, Windows Integrated Authentication or both.</span></span> <span data-ttu-id="0de42-122">Помните, что только RPC через HTTP v2 может проходить проверку подлинности для прокси-сервера RPC, который требует обычной или встроенной проверки подлинности Windows; RPC через HTTP v1 не сможет подключиться, если запрещен **анонимный доступ** .</span><span class="sxs-lookup"><span data-stu-id="0de42-122">Remember that only RPC over HTTP v2 is able to authenticate against RPC Proxy requiring Basic or Windows-integrated authentication; RPC over HTTP v1 will not be able to connect if **Disallow Anonymous Access** is disabled.</span></span> <span data-ttu-id="0de42-123">Так как RPC через HTTP v2 является более безопасной и надежной реализацией, использование версии Windows, поддерживающей эту службу, повысит безопасность установок.</span><span class="sxs-lookup"><span data-stu-id="0de42-123">Since RPC over HTTP v2 is the more secure and robust implementation, using a version of Windows that supports it will improve the security of your installations.</span></span>

> [!Note]  
> <span data-ttu-id="0de42-124">По умолчанию виртуальный каталог RPC прокси-сервера помечен для разрешения анонимного доступа.</span><span class="sxs-lookup"><span data-stu-id="0de42-124">By default, the RPC proxy virtual directory is marked to allow anonymous access.</span></span> <span data-ttu-id="0de42-125">Однако прокси-сервер RPC для RPC через HTTP v2 отклоняет запросы, которые не прошли проверку подлинности по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="0de42-125">However, the RPC proxy for RPC over HTTP v2 rejects requests that are not authenticated by default.</span></span>

 

## <a name="traffic-encryption"></a><span data-ttu-id="0de42-126">Шифрование трафика</span><span class="sxs-lookup"><span data-stu-id="0de42-126">Traffic Encryption</span></span>

<span data-ttu-id="0de42-127">RPC через HTTP может шифровать трафик между клиентом RPC через HTTP и прокси RPC с помощью SSL.</span><span class="sxs-lookup"><span data-stu-id="0de42-127">RPC over HTTP can encrypt traffic between the RPC over HTTP client and the RPC proxy with SSL.</span></span> <span data-ttu-id="0de42-128">Трафик между прокси-сервером RPC и RPC через HTTP-сервер шифруется с помощью обычных механизмов безопасности RPC и не использует SSL (даже если выбран протокол SSL между клиентом и прокси-сервером RPC).</span><span class="sxs-lookup"><span data-stu-id="0de42-128">The traffic between the RPC proxy and RPC over HTTP server is encrypted using normal RPC security mechanisms and does not use SSL (even if SSL between the client and the RPC proxy is chosen).</span></span> <span data-ttu-id="0de42-129">Это обусловлено тем, что часть трафика проходит через сеть Организации и защищена брандмауэром.</span><span class="sxs-lookup"><span data-stu-id="0de42-129">This is because that portion of the traffic travels within an organization's network and behind a firewall.</span></span>

<span data-ttu-id="0de42-130">Трафик между клиентом RPC через HTTP и прокси-сервером RPC, который обычно перемещается через Интернет, может быть зашифрован с помощью SSL в дополнение к тому, какой механизм шифрования был выбран для RPC.</span><span class="sxs-lookup"><span data-stu-id="0de42-130">Traffic between the RPC over HTTP client and the RPC proxy, which generally travels over the Internet, can be encrypted with SSL in addition to which encryption mechanism was chosen for RPC.</span></span> <span data-ttu-id="0de42-131">В этом случае трафик в части Интернета маршрута будет иметь удвоенное шифрование.</span><span class="sxs-lookup"><span data-stu-id="0de42-131">In this case, traffic on the Internet portion of the route becomes doubly encrypted.</span></span> <span data-ttu-id="0de42-132">Шифрование трафика через прокси-сервер RPC обеспечивает дополнительную защиту, если прокси-сервер RPC или другие компьютеры в сети периметра скомпрометированы.</span><span class="sxs-lookup"><span data-stu-id="0de42-132">Encrypting traffic through the RPC proxy provides a secondary defense, in case the RPC proxy or other machines in the perimeter network are compromised.</span></span> <span data-ttu-id="0de42-133">Поскольку прокси RPC не может расшифровать дополнительный уровень шифрования, прокси-сервер RPC не имеет доступа к отправляемым данным.</span><span class="sxs-lookup"><span data-stu-id="0de42-133">Since the RPC proxy cannot decrypt the secondary encryption layer, the RPC proxy does not have access to the data being sent.</span></span> <span data-ttu-id="0de42-134">Дополнительные сведения см. в статье [рекомендации по развертыванию RPC поверх HTTP](rpc-over-http-deployment-recommendations.md) .</span><span class="sxs-lookup"><span data-stu-id="0de42-134">See [RPC over HTTP Deployment Recommendations](rpc-over-http-deployment-recommendations.md) for more information.</span></span> <span data-ttu-id="0de42-135">Шифрование SSL доступно только при использовании RPC через HTTP v2.</span><span class="sxs-lookup"><span data-stu-id="0de42-135">SSL encryption is available only with RPC over HTTP v2.</span></span>

## <a name="restricting-rpc-over-http-calls-to-certain-computers"></a><span data-ttu-id="0de42-136">Запрещение вызовов RPC через HTTP к определенным компьютерам</span><span class="sxs-lookup"><span data-stu-id="0de42-136">Restricting RPC over HTTP Calls to Certain Computers</span></span>

<span data-ttu-id="0de42-137">Конфигурация безопасности IIS основана на разрешенном компьютере и диапазонах портов.</span><span class="sxs-lookup"><span data-stu-id="0de42-137">The IIS security configuration is based on allowed computer and port ranges.</span></span> <span data-ttu-id="0de42-138">Возможность использования RPC через HTTP контролируется двумя записями реестра на компьютере с IIS и прокси-сервером RPC.</span><span class="sxs-lookup"><span data-stu-id="0de42-138">The capability to use RPC over HTTP is controlled by two registry entries on the computer running IIS and the RPC proxy.</span></span> <span data-ttu-id="0de42-139">Первая запись — это флаг, который переключает функциональность прокси-сервера RPC.</span><span class="sxs-lookup"><span data-stu-id="0de42-139">The first entry is a flag that toggles RPC proxy functionality.</span></span> <span data-ttu-id="0de42-140">Второй — необязательный список компьютеров, на которых прокси-сервер может пересылать вызовы RPC.</span><span class="sxs-lookup"><span data-stu-id="0de42-140">The second is an optional list of computers to which the proxy can forward RPC calls.</span></span>

<span data-ttu-id="0de42-141">По умолчанию клиент, который обращается к прокси-серверу RPC для вызовов RPC через HTTP, не может получить доступ к серверным процессам RPC, за исключением процессов сервера RPC через HTTP, запущенных на том же компьютере, что и прокси-сервер RPC.</span><span class="sxs-lookup"><span data-stu-id="0de42-141">By default, a client that contacts the RPC proxy to tunnel RPC over HTTP calls cannot access any RPC server processes except the RPC over HTTP server processes running on the same machine as the RPC proxy.</span></span> <span data-ttu-id="0de42-142">Если флаг ENABLED не определен или имеет нулевое значение, IIS отключает прокси-сервер RPC.</span><span class="sxs-lookup"><span data-stu-id="0de42-142">If the ENABLED flag is not defined or set to a zero value, IIS disables the RPC proxy.</span></span> <span data-ttu-id="0de42-143">Если флаг ENABLED определен и для него задано ненулевое значение, клиент может подключаться к RPC через HTTP-серверы на компьютере, на котором запущены службы IIS.</span><span class="sxs-lookup"><span data-stu-id="0de42-143">If the ENABLED flag is defined and set to a nonzero value, a client can connect to RPC over HTTP servers on the computer running IIS.</span></span> <span data-ttu-id="0de42-144">Чтобы разрешить клиенту выполнять туннелирование на серверный процесс RPC через HTTP на другом компьютере, необходимо добавить запись реестра в список серверов RPC через HTTP на компьютере IIS.</span><span class="sxs-lookup"><span data-stu-id="0de42-144">To enable the client to tunnel to an RPC over HTTP server process on another computer, you must add a registry entry to the IIS computer's list of RPC over HTTP servers.</span></span>

<span data-ttu-id="0de42-145">Серверы RPC не могут принимать вызовы RPC через HTTP, если они специально не запросили RPC для прослушивания RPC через HTTP.</span><span class="sxs-lookup"><span data-stu-id="0de42-145">RPC servers cannot accept RPC over HTTP calls unless they specifically requested RPC to listen on RPC over HTTP.</span></span>

<span data-ttu-id="0de42-146">В следующем примере показано, как настроить реестр, чтобы разрешить клиентам подключаться к серверам через Интернет:</span><span class="sxs-lookup"><span data-stu-id="0de42-146">The following example demonstrates how to configure the registry to allow clients to connect to servers across the Internet:</span></span>

```
HKEY_LOCAL_MACHINE\
   Software\Microsoft\Rpc\RpcProxy\Enabled:REG_DWORD
   Software\Microsoft\Rpc\RpcProxy\ValidPorts:REG_SZ
```

<span data-ttu-id="0de42-147">Запись **ValidPorts** — это запись REG \_ SZ, содержащая список компьютеров, на которые прокси-сервер RPC IIS может пересылать вызовы RPC, а также порты, которые должны использоваться для подключения к серверам RPC.</span><span class="sxs-lookup"><span data-stu-id="0de42-147">The **ValidPorts** entry is a REG\_SZ entry containing a list of computers to which the IIS RPC proxy is allowed to forward RPC calls, and the ports it should use to connect to the RPC servers.</span></span> <span data-ttu-id="0de42-148">Запись REG \_ SZ имеет следующий вид: Роско: 593; Роско: 2000 — 8000; данные \* : 4000-8000.</span><span class="sxs-lookup"><span data-stu-id="0de42-148">The REG\_SZ entry takes the following form: Rosco:593;Rosco:2000-8000;Data\*:4000-8000.</span></span>

<span data-ttu-id="0de42-149">В этом примере IIS может пересылать вызовы RPC через HTTP к серверу "Роско" на портах 593 и 2000 до 8000.</span><span class="sxs-lookup"><span data-stu-id="0de42-149">In this example, IIS can forward RPC over HTTP calls to the server "Rosco" on ports 593 and 2000 through 8000.</span></span> <span data-ttu-id="0de42-150">Он также может отправить вызовы на любой сервер, имя которого начинается с "Data".</span><span class="sxs-lookup"><span data-stu-id="0de42-150">It can also send calls to any server whose name begins with "Data".</span></span> <span data-ttu-id="0de42-151">Он будет подключаться к портам с 4000 по 8000.</span><span class="sxs-lookup"><span data-stu-id="0de42-151">It will connect on ports 4000 through 8000.</span></span> <span data-ttu-id="0de42-152">Кроме того, прежде чем перенаправить трафик на заданный порт на сервере RPC через HTTP, прокси-сервер RPC выполняет Специальный обмен пакетами со службой RPC, который прослушивает этот порт, чтобы убедиться, что он готов принимать запросы по протоколу HTTP.</span><span class="sxs-lookup"><span data-stu-id="0de42-152">In addition, before forwarding traffic to a given port on the RPC over HTTP server, the RPC proxy performs a special packet exchange with the RPC service listening on that port to verify it is willing to accept requests over HTTP.</span></span>

<span data-ttu-id="0de42-153">Для примера, основанного на этих примерах параметров, если служба RPC прослушивает порт 4500 на сервере «файл1», но не вызвал одну из функций [ \* *рпксерверусепротсек \** _](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseq) с параметром _ \* нкакн \_ http \* \*, запрос будет отклонен.</span><span class="sxs-lookup"><span data-stu-id="0de42-153">For an example based on these example settings, if an RPC service listens on port 4500 on server "Data1" but has not called one of the [\**RpcServerUseProtseq\** _](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseq) functions with _\*ncacn\_http\*\*, it will reject the request.</span></span> <span data-ttu-id="0de42-154">Это поведение обеспечивает дополнительную защиту серверов, прослушиваемых открытым портом из-за ошибки конфигурации; Если сервер специально не запрашивает прослушивание RPC через HTTP, он не будет получать вызовы, исходящие из-за пределов брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="0de42-154">This behavior provides additional protection for servers that listen on an opened port due to configuration error; unless the server specifically requested to listen on RPC over HTTP, it will not receive calls originating from outside the firewall.</span></span>

<span data-ttu-id="0de42-155">Записи в ключе **ValidPorts** должны точно соответствовать серверу RPC через HTTP, запрошенному клиентом (без учета регистра).</span><span class="sxs-lookup"><span data-stu-id="0de42-155">Entries in the **ValidPorts** key must be an exact match of the RPC over HTTP server asked for by the client (it is not case-sensitive).</span></span> <span data-ttu-id="0de42-156">Для упрощения обработки прокси-сервер RPC не выполняет каноническое имя, предоставленное клиентом RPC через HTTP.</span><span class="sxs-lookup"><span data-stu-id="0de42-156">To streamline processing, the RPC proxy does not perform canonicalization of the name provided by the RPC over HTTP client.</span></span> <span data-ttu-id="0de42-157">Таким образом, если клиент запрашивает rosco.microsoft.com и в **ValidPorts** содержится только Роско, прокси-сервер RPC не будет сопоставлять имена, даже если оба имени могут ссылаться на один и тот же компьютер.</span><span class="sxs-lookup"><span data-stu-id="0de42-157">Therefore, if the client asks for rosco.microsoft.com, and in **ValidPorts** contain Rosco only, the RPC proxy will not match the names, even though both names may refer to the same machine.</span></span> <span data-ttu-id="0de42-158">Кроме того, если IP-адрес Роско — 66.77.88.99, а клиент запрашивает 66.77.88.99, но ключ **ValidPorts** содержит только Роско, прокси-сервер RPC отклоняет подключение.</span><span class="sxs-lookup"><span data-stu-id="0de42-158">Additionally, if the IP address of Rosco is 66.77.88.99, and the client asks for 66.77.88.99 but the **ValidPorts** key contains Rosco only, the RPC proxy will refuse the connection.</span></span> <span data-ttu-id="0de42-159">Если клиент может запросить сервер RPC через HTTP по имени или по IP-адресу, вставьте оба параметра в ключ **ValidPorts** .</span><span class="sxs-lookup"><span data-stu-id="0de42-159">If a client may ask for the RPC over HTTP server by name, or by IP address, insert both in the **ValidPorts** key.</span></span>

> [!Note]  
> <span data-ttu-id="0de42-160">Хотя RPC включен IPv6, прокси-сервер RPC не поддерживает адреса IPv6 в ключе **ValidPorts** .</span><span class="sxs-lookup"><span data-stu-id="0de42-160">Although RPC is IPv6 enabled, the RPC proxy does not support IPv6 addresses in the **ValidPorts** key.</span></span> <span data-ttu-id="0de42-161">Если протокол IPv6 используется для подключения прокси-сервера RPC и RPC через HTTP-сервер, можно использовать только DNS-имена.</span><span class="sxs-lookup"><span data-stu-id="0de42-161">If IPv6 is used to connect the RPC proxy and the RPC over HTTP server, only DNS names can be used.</span></span>

 

<span data-ttu-id="0de42-162">IIS считывает записи реестра **Enabled** и **ValidPorts** при запуске.</span><span class="sxs-lookup"><span data-stu-id="0de42-162">IIS reads the **Enabled** and **ValidPorts** registry entries on startup.</span></span> <span data-ttu-id="0de42-163">Кроме того, RPC через HTTP заново считывает содержимое ключа **ValidPorts** примерно каждые 5 минут.</span><span class="sxs-lookup"><span data-stu-id="0de42-163">In addition, RPC over HTTP rereads the contents of the **ValidPorts** key approximately every 5 minutes.</span></span> <span data-ttu-id="0de42-164">Если запись **ValidPorts** изменена, изменения реализуются в течение 5 минут.</span><span class="sxs-lookup"><span data-stu-id="0de42-164">If the **ValidPorts** entry is changed, the changes are implemented within 5 minutes.</span></span>

<span data-ttu-id="0de42-165">**RPC через HTTP v1:** ВЕБ-служба должна быть остановлена и перезапущена с помощью Service Manager Интернета для реализации новых значений в записях реестра.</span><span class="sxs-lookup"><span data-stu-id="0de42-165">**RPC over HTTP v1:** The WEB service must be stopped and restarted using the Internet Service Manager for new values in the registry entries to be implemented.</span></span>

 

 




