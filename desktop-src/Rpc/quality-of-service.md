---
title: Качество обслуживания (RPC)
description: Для создания привязки с проверкой подлинности клиентские программы могут использовать функцию Рпкбиндингсетаусинфоекс, а не функцию Рпкбиндингсетаусинфо.
ms.assetid: bc3d47ba-3c1b-4aba-8fe3-b4501a621931
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ee93b1aa376c9d6f4e2b3eedab73c91471d42498
ms.sourcegitcommit: 8fa6614b715bddf14648cce36d2df22e5232801a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2020
ms.locfileid: "103891318"
---
# <a name="quality-of-service-rpc"></a><span data-ttu-id="37a2a-103">Качество обслуживания (RPC)</span><span class="sxs-lookup"><span data-stu-id="37a2a-103">Quality of Service (RPC)</span></span>

<span data-ttu-id="37a2a-104">Для создания привязки с проверкой подлинности клиентские программы могут использовать функцию [**рпкбиндингсетаусинфоекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) , а не функцию [**рпкбиндингсетаусинфо**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfo) .</span><span class="sxs-lookup"><span data-stu-id="37a2a-104">Client programs can use the [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) function rather than the [**RpcBindingSetAuthInfo**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfo) function to create an authenticated binding.</span></span> <span data-ttu-id="37a2a-105">В противном случае они передают указатель на структуру [**\_ \_ QoS безопасности RPC**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_security_qos) в качестве последнего параметра **рпкбиндингсетаусинфоекс**.</span><span class="sxs-lookup"><span data-stu-id="37a2a-105">If they do, they pass a pointer to an [**RPC\_SECURITY\_QOS**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_security_qos) structure as the final parameter of **RpcBindingSetAuthInfoEx**.</span></span> <span data-ttu-id="37a2a-106">Эта структура содержит сведения о качеству обслуживания.</span><span class="sxs-lookup"><span data-stu-id="37a2a-106">This structure contains information about the quality of service.</span></span> <span data-ttu-id="37a2a-107">Клиентские программы также могут указать отслеживание удостоверений и выбрать тип олицетворения.</span><span class="sxs-lookup"><span data-stu-id="37a2a-107">Client programs can also specify the identity tracking and select the impersonation type.</span></span>

<span data-ttu-id="37a2a-108">Используйте элемент **capabilities** структуры [**\_ \_ QoS безопасности RPC**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_security_qos) , чтобы задать, какие части приложения клиента и сервера проходят проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="37a2a-108">Use the **Capabilities** member of the [**RPC\_SECURITY\_QOS**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_security_qos) structure to set which portions of the client/server application are authenticated.</span></span> <span data-ttu-id="37a2a-109">Если выбран параметр RPC \_ C \_ QoS \_ \_ по умолчанию, то библиотека времени выполнения RPC выполняет проверку подлинности клиента или сервера в соответствии с по умолчанию для поставщика общих служб.</span><span class="sxs-lookup"><span data-stu-id="37a2a-109">If RPC\_C\_QOS\_CAPABILITIES\_DEFAULT is selected, the RPC run-time library authenticates the client or server according to the default for the SSP.</span></span> <span data-ttu-id="37a2a-110">По умолчанию поставщик общих служб Kerberos проверяет подлинность клиента и сервера.</span><span class="sxs-lookup"><span data-stu-id="37a2a-110">By default, the Kerberos protocol SSP authenticates both the client and the server.</span></span> <span data-ttu-id="37a2a-111">По умолчанию для всех остальных SSP, предоставляемых корпорацией Майкрософт, является проверка подлинности клиента на сервере, но не проверка подлинности сервера для клиента.</span><span class="sxs-lookup"><span data-stu-id="37a2a-111">The default for all other SSPs that Microsoft provides is to authenticate the client to the server, but not to authenticate the server to the client.</span></span>

<span data-ttu-id="37a2a-112">Если клиент и сервер должны всегда проходить проверку подлинности друг с другом, установите для элемента **возможности** в структуре [**RPC \_ Security \_ QoS**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_security_qos) значение \_ \_ \_ \_ взаимная \_ Проверка подлинности RPC C.</span><span class="sxs-lookup"><span data-stu-id="37a2a-112">If the client and the server should always authenticate to each other, set the **Capabilities** member of the [**RPC\_SECURITY\_QOS**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_security_qos) structure to RPC\_C\_QOS\_CAPABILITIES\_MUTUAL\_AUTH.</span></span> <span data-ttu-id="37a2a-113">Некоторые поставщики безопасности могут не поддерживать взаимную проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="37a2a-113">Some security providers may not support mutual authentication.</span></span> <span data-ttu-id="37a2a-114">Если \_ \_ \_ \_ \_ для таких поставщиков безопасности задана взаимная проверка подлинности RPC C, то при вызове удаленной процедуры будет возвращена ошибка.</span><span class="sxs-lookup"><span data-stu-id="37a2a-114">If RPC\_C\_QOS\_CAPABILITIES\_MUTUAL\_AUTH is specified for such security providers, an error is returned when a remote procedure call is made.</span></span> <span data-ttu-id="37a2a-115">При использовании поставщика общих служб SCHANNEL можно также установить возможности участника RPC C на **основе возможностей** \_ QoS в \_ \_ \_ любом \_ центре.</span><span class="sxs-lookup"><span data-stu-id="37a2a-115">When using the SCHANNEL SSP, it is possible to also set the **Capabilities** member to RPC\_C\_QOS\_CAPABILITIES\_ANY\_AUTHORITY.</span></span> <span data-ttu-id="37a2a-116">Эта константа указывает, что поставщик удостоверений должен проверять вызов удаленной процедуры, даже если центр сертификации, выдавший сертификат проверки подлинности клиента, отсутствует в корневом хранилище сертификатов поставщика общих служб.</span><span class="sxs-lookup"><span data-stu-id="37a2a-116">This constant specifies that the SSP shall validate the remote procedure call even if the certificate authority that issued the client's authentication certificate is not in the SSP's root certificate store.</span></span> <span data-ttu-id="37a2a-117">По умолчанию сертификат отклоняется, если поставщик удостоверений не распознает центр сертификации.</span><span class="sxs-lookup"><span data-stu-id="37a2a-117">The default is to reject the certificate if the SSP does not recognize the certificate authority.</span></span> <span data-ttu-id="37a2a-118">Центр сертификации — это независимая компания или организация, например VeriSign, которая выдает сертификаты проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="37a2a-118">The certificate authority is an independent company or organization, such as VeriSign, that issues authentication certificates.</span></span>

<span data-ttu-id="37a2a-119">Приложения также могут задавать отслеживание идентификации, используемое библиотекой времени выполнения RPC.</span><span class="sxs-lookup"><span data-stu-id="37a2a-119">Applications can also set the identity tracking that the RPC run-time library uses.</span></span> <span data-ttu-id="37a2a-120">Обычно в программах используется [*статическое отслеживание идентификаторов*](s-glos.md).</span><span class="sxs-lookup"><span data-stu-id="37a2a-120">Programs generally use [*static identity tracking*](s-glos.md).</span></span> <span data-ttu-id="37a2a-121">При статическом отслеживании учетные данные клиента задаются при вызове функции [**рпкбиндингсетаусинфо**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfo) .</span><span class="sxs-lookup"><span data-stu-id="37a2a-121">With static tracking, the client's credentials are set when it calls the [**RpcBindingSetAuthInfo**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfo) function.</span></span> <span data-ttu-id="37a2a-122">Затем библиотека времени выполнения RPC использует эти учетные данные для всех вызовов RPC для привязки, независимо от изменений в удостоверении вызывающего потока или вызывающего процесса.</span><span class="sxs-lookup"><span data-stu-id="37a2a-122">The RPC run-time library then uses those credentials for all RPC calls on the binding, regardless of changes in the identity of the calling thread or the calling process.</span></span> <span data-ttu-id="37a2a-123">Приложения также могут выбрать [*динамическое отслеживание идентификаторов*](d-glos.md).</span><span class="sxs-lookup"><span data-stu-id="37a2a-123">Applications can also select [*dynamic identity tracking*](d-glos.md).</span></span> <span data-ttu-id="37a2a-124">Динамическое отслеживание идентификаторов дает указание библиотеке времени выполнения RPC использовать учетные данные вызывающего потока во время каждого вызова, а не маркер привязки.</span><span class="sxs-lookup"><span data-stu-id="37a2a-124">Dynamic identity tracking instructs the RPC run-time library to use the credentials of the calling thread at the time of each call, rather than the binding handle.</span></span> <span data-ttu-id="37a2a-125">По умолчанию отслеживание удостоверений является статическим.</span><span class="sxs-lookup"><span data-stu-id="37a2a-125">The default identity tracking is static.</span></span>

<span data-ttu-id="37a2a-126">Если идентификатор клиента не будет изменяться, то отслеживание статических удостоверений может иметь более высокий уровень производительности и может сэкономить время выполнения RPC от проверки каждого раза, совпадает ли удостоверение в вызывающем потоке с удостоверением, предоставленным системе безопасности.</span><span class="sxs-lookup"><span data-stu-id="37a2a-126">If the identity of the client is not going to change, static identity tracking can have better performance characteristics, and can save the RPC run time from checking each time whether the identity on the calling thread is the same as the identity given to the security system.</span></span> <span data-ttu-id="37a2a-127">Если идентификация вызывающего потока может измениться между вызовами, и сервер должен распознать эти изменения, лучше указать динамическое отслеживание идентификаторов — время выполнения RPC без заданных и эффективно отслеживать удостоверение, а также при изменении удостоверения управляет этим изменением от вашего имени.</span><span class="sxs-lookup"><span data-stu-id="37a2a-127">If the identity of the calling thread may change between calls, and the server needs to recognize those changes, it is best to specify dynamic identity tracking—the RPC run time quietly and efficiently tracks the identity for you, and if the identity changes, manages that change on your behalf.</span></span>

> [!Note]  
> <span data-ttu-id="37a2a-128">Для вызовов **нкалрпк** статические и динамические отслеживания идентификаторов имеют различные характеристики производительности, и в зависимости от обстоятельств они могут быть более быстрыми.</span><span class="sxs-lookup"><span data-stu-id="37a2a-128">For **ncalrpc** calls, static and dynamic identity tracking have different performance characteristics, and depending on the circumstances, either may be faster.</span></span>

 

<span data-ttu-id="37a2a-129">В рамках спецификации качества обслуживания клиентская программа также может задать тип олицетворения, который серверная программа может выполнять от ее имени.</span><span class="sxs-lookup"><span data-stu-id="37a2a-129">As part of the QOS specification, the client program can also set the type of impersonation that a server program can perform on its behalf.</span></span> <span data-ttu-id="37a2a-130">Дополнительные сведения см. в разделе [олицетворение клиента](client-impersonation.md).</span><span class="sxs-lookup"><span data-stu-id="37a2a-130">For more information, see [Client Impersonation](client-impersonation.md).</span></span>

<span data-ttu-id="37a2a-131">В поле номер версии структуры [**\_ \_ QoS безопасности RPC**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_security_qos) всегда должно быть установлено значение RPC \_ C \_ Security \_ QoS \_ Version.</span><span class="sxs-lookup"><span data-stu-id="37a2a-131">The version number field of the [**RPC\_SECURITY\_QOS**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_security_qos) structure should always be set to RPC\_C\_SECURITY\_QOS\_VERSION.</span></span>

 

 




