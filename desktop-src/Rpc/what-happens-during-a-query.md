---
title: Что происходит во время запроса
description: В этом разделе описывается, как сеть обрабатывает запрос, когда 32-разрядный клиент ищет имя в своем собственном домене.
ms.assetid: a8a88743-a245-4258-af05-9261c214ab50
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d6e26fb9aaef0aac2ff66260d51f756725566dee
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104253330"
---
# <a name="what-happens-during-a-query"></a><span data-ttu-id="3b680-103">Что происходит во время запроса</span><span class="sxs-lookup"><span data-stu-id="3b680-103">What Happens During a Query</span></span>

<span data-ttu-id="3b680-104">В этом разделе описывается, как сеть обрабатывает запрос, когда 32-разрядный клиент ищет имя в своем собственном домене.</span><span class="sxs-lookup"><span data-stu-id="3b680-104">This section describes how the network handles the query when a 32-bit client searches for a name in its own domain.</span></span>

<span data-ttu-id="3b680-105">Когда клиентское приложение вызывает [**рпкнсбиндингимпортбегин**](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindingimportbegina), локатор, находящийся на клиентском компьютере, попытается удовлетворить этот запрос.</span><span class="sxs-lookup"><span data-stu-id="3b680-105">When your client application calls [**RpcNsBindingImportBegin**](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindingimportbegina), the locator residing on your client computer will try to satisfy this request.</span></span> <span data-ttu-id="3b680-106">Если в кэше нет ничего, запрос будет перенаправлен RPC на главный Локатор.</span><span class="sxs-lookup"><span data-stu-id="3b680-106">If there is nothing in the cache, it will forward the request by RPC to a master locator.</span></span> <span data-ttu-id="3b680-107">Если в кэше обнаружено ничего, он отправляет запрос всем компьютерам в домене с помощью широковещательной рассылки через почтовый слот.</span><span class="sxs-lookup"><span data-stu-id="3b680-107">If the master locator finds nothing in its cache, it sends the request to all the computers in the domain using a mail-slot broadcast.</span></span> <span data-ttu-id="3b680-108">Если обнаружено совпадение, локатор на каждом компьютере будет отвечать направленному слоту почты.</span><span class="sxs-lookup"><span data-stu-id="3b680-108">If there is a match, the locator on each computer will respond by a directed mail slot.</span></span> <span data-ttu-id="3b680-109">(Например, если процесс на этом компьютере экспортировал интерфейс.) Ответы отправляются по копиям, а RPC завершается с локатора процесса клиента, который будет отвечать на сам клиентский процесс.</span><span class="sxs-lookup"><span data-stu-id="3b680-109">(For example, if a process on that computer has exported the interface.) The responses are collated and the RPC is completed from the client's process locator, which will reply to the client process itself.</span></span>

<span data-ttu-id="3b680-110">В домене локатор клиента выполняет поиск основного локатора в следующих местах:</span><span class="sxs-lookup"><span data-stu-id="3b680-110">In a domain, the client locator searches for a master locator in the following places:</span></span>

-   <span data-ttu-id="3b680-111">На основном контроллере домена</span><span class="sxs-lookup"><span data-stu-id="3b680-111">On the primary domain controller</span></span>
-   <span data-ttu-id="3b680-112">На каждом резервном контроллере домена</span><span class="sxs-lookup"><span data-stu-id="3b680-112">On each backup domain controller</span></span>

<span data-ttu-id="3b680-113">Если совпадение не найдено, локатор клиента объявляет себя основным указателем.</span><span class="sxs-lookup"><span data-stu-id="3b680-113">If a match is not found, the client locator declares itself to be the master locator.</span></span> <span data-ttu-id="3b680-114">В этом случае запросы будут транслироваться, если их нельзя удовлетворить локально.</span><span class="sxs-lookup"><span data-stu-id="3b680-114">As such, it will broadcast queries if they cannot be satisfied locally.</span></span>

<span data-ttu-id="3b680-115">В Рабочей группе локатор клиента поддерживает кэш компьютеров, указатели которых имеют широковещательные рассылки.</span><span class="sxs-lookup"><span data-stu-id="3b680-115">In a workgroup, the client locator maintains a cache of the computers whose locators have broadcast.</span></span> <span data-ttu-id="3b680-116">Он использует тот, который выполнялся дольше, чем локатор главного сервера.</span><span class="sxs-lookup"><span data-stu-id="3b680-116">It uses the one that has been running the longest as the master locator.</span></span> <span data-ttu-id="3b680-117">Если этот компьютер недоступен, используется следующий компьютер с максимальной навещание и т. д.</span><span class="sxs-lookup"><span data-stu-id="3b680-117">If that computer is unavailable, the next, longest-broadcasting computer is used, and so on.</span></span> <span data-ttu-id="3b680-118">Если клиенту требуется главный Локатор и кэш пуст, он пополняет кэш, отправив специальный широковещательный слот, который запрашивает ответы на запросы хозяина запросов.</span><span class="sxs-lookup"><span data-stu-id="3b680-118">If the client needs a master locator and the cache is empty, it replenishes the cache by sending a special mail-slot broadcast that requests master locators to respond.</span></span> <span data-ttu-id="3b680-119">Если ответа нет, локатор клиента объявляет себя основным указателем и передает запросы, если они не могут быть удовлетворены локально.</span><span class="sxs-lookup"><span data-stu-id="3b680-119">If there are no responses, the client locator declares itself to be the master locator and will broadcast queries if they cannot be satisfied locally.</span></span>

<span data-ttu-id="3b680-120">Это меняется, если клиентское приложение является 16-или MS-DOS-программой.</span><span class="sxs-lookup"><span data-stu-id="3b680-120">This changes if your client application is a 16-bit or MS-DOS-based program.</span></span> <span data-ttu-id="3b680-121">В этом случае на клиентском компьютере не выполняется локатор, а Rpcns1.dll или Рпкнслм. RPC содержит код для поиска основного локатора.</span><span class="sxs-lookup"><span data-stu-id="3b680-121">In this case, there is no locator running on the client computer, and Rpcns1.dll or Rpcnslm.rpc contains the code to find a master locator.</span></span> <span data-ttu-id="3b680-122">Все запросы перенаправляются непосредственно в главный указатель.</span><span class="sxs-lookup"><span data-stu-id="3b680-122">All requests are forwarded directly to the master locator.</span></span>

<span data-ttu-id="3b680-123">Эти рекомендации действительны для имен в домене клиента, например имен для "/.:/ ИмяЗаписи ".</span><span class="sxs-lookup"><span data-stu-id="3b680-123">These guidelines are valid for names in the client's domain, such as names for "/.:/entryname".</span></span> <span data-ttu-id="3b680-124">Если клиент запрашивает имя из другого домена с помощью "/.../Домаин/ентринаме;", локатор клиента перенаправляет запрос в указанный домен, который будет транслировать его, если у него нет ответа.</span><span class="sxs-lookup"><span data-stu-id="3b680-124">If the client requests a name from another domain through the use of "/.../DOMAIN/entryname;" the client locator forwards the request to the specified domain which will broadcast it if it does not have the answer.</span></span> <span data-ttu-id="3b680-125">Если домен не работает или в действительности является рабочей группой, запрос завершится ошибкой.</span><span class="sxs-lookup"><span data-stu-id="3b680-125">If the domain is down or is actually a workgroup, the request will fail.</span></span>

> [!Note]  
> <span data-ttu-id="3b680-126">При работе с записями в службе имен помните следующее:</span><span class="sxs-lookup"><span data-stu-id="3b680-126">Remember the following when working with entries in the name service:</span></span>

 

-   <span data-ttu-id="3b680-127">Клиент не может использовать синтаксис "/.../Домаин/ентринаме" для поиска записи в своем собственном домене.</span><span class="sxs-lookup"><span data-stu-id="3b680-127">A client cannot use the "/.../DOMAIN/entryname" syntax to find an entry in its own domain.</span></span> <span data-ttu-id="3b680-128">Используйте синтаксис "/.:/ ИмяЗаписи ".</span><span class="sxs-lookup"><span data-stu-id="3b680-128">Use the syntax "/.:/entryname".</span></span> <span data-ttu-id="3b680-129">Однако можно использовать "/.../Домаин/ентринаме" для поиска записи в другом домене.</span><span class="sxs-lookup"><span data-stu-id="3b680-129">However, you can use "/.../DOMAIN/entryname" to find an entry in another domain.</span></span>
-   <span data-ttu-id="3b680-130">Доменное имя в "/.../Домаин/ентринаме" должно быть в верхнем регистре.</span><span class="sxs-lookup"><span data-stu-id="3b680-130">The domain name in "/.../DOMAIN/entryname" must be uppercase.</span></span> <span data-ttu-id="3b680-131">При поиске соответствия локатор учитывает регистр.</span><span class="sxs-lookup"><span data-stu-id="3b680-131">When looking for a match, the locator is case-sensitive.</span></span>
-   <span data-ttu-id="3b680-132">Имена записей локатора также чувствительны к регистру, но не должны быть прописными буквами.</span><span class="sxs-lookup"><span data-stu-id="3b680-132">Locator entry names are also case-sensitive, but need not be uppercase.</span></span>
-   <span data-ttu-id="3b680-133">Когда клиент использует "/.:/ ИмяЗаписи "указатель не будет искать записи в других доменах, даже если они имеют отношение доверия с доменом входа в систему.</span><span class="sxs-lookup"><span data-stu-id="3b680-133">When the client uses the "/.:/entryname" syntax, the locator will not search for entries in other domains, even if they have a trust relationship with the logon domain.</span></span>
-   <span data-ttu-id="3b680-134">Широковещательные рассылки не являются сегментами локальной сети (например, подсетями).</span><span class="sxs-lookup"><span data-stu-id="3b680-134">Broadcasts do not cross LAN segments (for example, subnets).</span></span> <span data-ttu-id="3b680-135">Поэтому полезность локатора ограничена в Организации с несколькими подсетями.</span><span class="sxs-lookup"><span data-stu-id="3b680-135">Thus, the usefulness of the locator is limited in an organization with multiple subnets.</span></span>

 

 




