---
title: Создание сведений об ошибке
description: Если сервер или приложение встречает неустранимую ошибку при вызове через RPC, она должна указывать на время выполнения RPC, в котором произошла ошибка, и в идеале следует добавить сведения об ошибке, чтобы упростить устранение неполадок.
ms.assetid: 6658c387-94df-4d85-9749-53858f9e0f5f
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1b06a13e932034e6840479443e0b78f4c322c0b3
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "105672053"
---
# <a name="generating-error-information"></a>Создание сведений об ошибке

Если сервер или приложение встречает неустранимую ошибку при вызове через RPC, она должна указывать на время выполнения RPC, в котором произошла ошибка, и в идеале следует добавить сведения об ошибке, чтобы упростить устранение неполадок.

## <a name="indicating-fatal-errors-to-the-rpc-run-time"></a>Указание неустранимых ошибок во время выполнения RPC

Чтобы указать сбой во время выполнения RPC, вызовите функцию [**рпкраисиксцептион**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcraiseexception) в ПОТОКе RPC, в котором было вызвано исключение, или [**рпкасинкаборткалл**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasyncabortcall) , если асинхронно обрабатывается вызов в другом потоке. Возвращение кода ошибки из серверной процедуры, такой как подпрограмма диспетчера, недостаточна — в соответствии со спецификацией RPC возвращаемое значение функции не имеет семантики ошибок на сервере, независимо от параметров файла IDL/ACF.

При возникновении неустранимой ошибки в компоненте выполните все необходимые действия по очистке, а затем вызовите функцию [**рпкраисиксцептион**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcraiseexception) с кодом ошибки. Единственное различие между **рпкраисиксцептион** и возвратом кода ошибки — когда вызывается **рпкраисиксцептион** , выходные параметры не маршалируются. Это, как правило, является преимуществом, поскольку предотвращение неинициализированных параметров становится ненужным.

## <a name="generating-additional-extended-error-information"></a>Создание дополнительных сведений о расширенной ошибке

Так же как и во время выполнения RPC создает цепочку записей об ошибках, сервер или приложение могут добавлять собственные записи в цепочку. Этот подход часто помогает в процессе устранения неполадок. Например, сервер может попытаться открыть заданный файл и получить сообщение об ошибке «файл не найден». Простой возврат ошибки 2 не будет полезен при определении отсутствующего файла.

Вместо этого сервер может вызвать функцию [**рпцеррораддрекорд**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerroraddrecord) и предоставить строковый параметр (ANSI или Unicode) в записи об ошибке, указывающей полный путь к искомому файлу. Когда все эти сведения появляются на экране пользователя на удаленном компьютере, устранение неполадок становится тривиальным; можно выполнить простую проверку существования файла, особенно потому, что имя рассматриваемого компьютера уже предоставлено во время выполнения RPC.

Вызов функции [**рпцеррораддрекорд**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerroraddrecord) может завершиться ошибкой, если достаточно памяти недоступен, несмотря на то, что требуется всего несколько байтов пространства кучи. Кроме того, записи, добавленные функцией **рпцеррораддрекорд** , суммируются в заданном потоке. Среда выполнения обычно очищает эти записи до вызова серверной процедуры, но если расширенные сведения об ошибках используются за пределами RPC, постарайтесь очистить накопленную расширенную ошибку в потоке, вызвав [**рпцеррорклеаринформатион**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerrorclearinformation).

 

 




