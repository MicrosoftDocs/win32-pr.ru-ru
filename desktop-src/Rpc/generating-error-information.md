---
title: Создание сведений об ошибке
description: Если сервер или приложение встречает неустранимую ошибку при вызове через RPC, она должна указывать на время выполнения RPC, в котором произошла ошибка, и в идеале следует добавить сведения об ошибке, чтобы упростить устранение неполадок.
ms.assetid: 6658c387-94df-4d85-9749-53858f9e0f5f
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1b06a13e932034e6840479443e0b78f4c322c0b3
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "105672053"
---
# <a name="generating-error-information"></a><span data-ttu-id="5497c-103">Создание сведений об ошибке</span><span class="sxs-lookup"><span data-stu-id="5497c-103">Generating Error Information</span></span>

<span data-ttu-id="5497c-104">Если сервер или приложение встречает неустранимую ошибку при вызове через RPC, она должна указывать на время выполнения RPC, в котором произошла ошибка, и в идеале следует добавить сведения об ошибке, чтобы упростить устранение неполадок.</span><span class="sxs-lookup"><span data-stu-id="5497c-104">If a server or application encounters a fatal error while being called through RPC, it should indicate to the RPC run time that it has encountered a failure, and ideally, should add information about the failure to facilitate troubleshooting.</span></span>

## <a name="indicating-fatal-errors-to-the-rpc-run-time"></a><span data-ttu-id="5497c-105">Указание неустранимых ошибок во время выполнения RPC</span><span class="sxs-lookup"><span data-stu-id="5497c-105">Indicating Fatal Errors to the RPC Run Time</span></span>

<span data-ttu-id="5497c-106">Чтобы указать сбой во время выполнения RPC, вызовите функцию [**рпкраисиксцептион**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcraiseexception) в ПОТОКе RPC, в котором было вызвано исключение, или [**рпкасинкаборткалл**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasyncabortcall) , если асинхронно обрабатывается вызов в другом потоке.</span><span class="sxs-lookup"><span data-stu-id="5497c-106">To indicate a failure to the RPC run time, call the [**RpcRaiseException**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcraiseexception) function while on the RPC thread the exception was called on, or [**RpcAsyncAbortCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasyncabortcall) if processing the call asynchronously on another thread.</span></span> <span data-ttu-id="5497c-107">Возвращение кода ошибки из серверной процедуры, такой как подпрограмма диспетчера, недостаточна — в соответствии со спецификацией RPC возвращаемое значение функции не имеет семантики ошибок на сервере, независимо от параметров файла IDL/ACF.</span><span class="sxs-lookup"><span data-stu-id="5497c-107">Returning an error code from the server routine, such as the manager routine, is not sufficient—according to the RPC specification, the return value of the function has no error semantics on the server, regardless of the idl/acf file settings.</span></span>

<span data-ttu-id="5497c-108">При возникновении неустранимой ошибки в компоненте выполните все необходимые действия по очистке, а затем вызовите функцию [**рпкраисиксцептион**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcraiseexception) с кодом ошибки.</span><span class="sxs-lookup"><span data-stu-id="5497c-108">When a fatal error occurs in your component, perform any cleanup deemed necessary and then call the [**RpcRaiseException**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcraiseexception) function with the error code.</span></span> <span data-ttu-id="5497c-109">Единственное различие между **рпкраисиксцептион** и возвратом кода ошибки — когда вызывается **рпкраисиксцептион** , выходные параметры не маршалируются.</span><span class="sxs-lookup"><span data-stu-id="5497c-109">The only difference between **RpcRaiseException** and returning an error code is when the **RpcRaiseException** is called, the out parameters are not marshaled.</span></span> <span data-ttu-id="5497c-110">Это, как правило, является преимуществом, поскольку предотвращение неинициализированных параметров становится ненужным.</span><span class="sxs-lookup"><span data-stu-id="5497c-110">This is usually an advantage, since avoiding uninitialized out parameters becomes unnecessary.</span></span>

## <a name="generating-additional-extended-error-information"></a><span data-ttu-id="5497c-111">Создание дополнительных сведений о расширенной ошибке</span><span class="sxs-lookup"><span data-stu-id="5497c-111">Generating Additional Extended Error Information</span></span>

<span data-ttu-id="5497c-112">Так же как и во время выполнения RPC создает цепочку записей об ошибках, сервер или приложение могут добавлять собственные записи в цепочку.</span><span class="sxs-lookup"><span data-stu-id="5497c-112">Just as the RPC run time builds a chain of error records, your server or application can add its own records to the chain.</span></span> <span data-ttu-id="5497c-113">Этот подход часто помогает в процессе устранения неполадок.</span><span class="sxs-lookup"><span data-stu-id="5497c-113">This approach often helps in the troubleshooting process.</span></span> <span data-ttu-id="5497c-114">Например, сервер может попытаться открыть заданный файл и получить сообщение об ошибке «файл не найден».</span><span class="sxs-lookup"><span data-stu-id="5497c-114">For example, a server may attempt to open a given file and receive a file not found error.</span></span> <span data-ttu-id="5497c-115">Простой возврат ошибки 2 не будет полезен при определении отсутствующего файла.</span><span class="sxs-lookup"><span data-stu-id="5497c-115">Simply returning error 2 would not be helpful in determining which file is missing.</span></span>

<span data-ttu-id="5497c-116">Вместо этого сервер может вызвать функцию [**рпцеррораддрекорд**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerroraddrecord) и предоставить строковый параметр (ANSI или Unicode) в записи об ошибке, указывающей полный путь к искомому файлу.</span><span class="sxs-lookup"><span data-stu-id="5497c-116">Instead, your server could call the [**RpcErrorAddRecord**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerroraddrecord) function and provide a string parameter, either ANSI or Unicode, in the error record indicating the full path of the file it was looking for.</span></span> <span data-ttu-id="5497c-117">Когда все эти сведения появляются на экране пользователя на удаленном компьютере, устранение неполадок становится тривиальным; можно выполнить простую проверку существования файла, особенно потому, что имя рассматриваемого компьютера уже предоставлено во время выполнения RPC.</span><span class="sxs-lookup"><span data-stu-id="5497c-117">When all this information appears on the user screen on a remote computer, troubleshooting becomes trivial; a simple check of whether the file exists can be done, especially since the name of the computer in question is already provided by the RPC run time.</span></span>

<span data-ttu-id="5497c-118">Вызов функции [**рпцеррораддрекорд**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerroraddrecord) может завершиться ошибкой, если достаточно памяти недоступен, несмотря на то, что требуется всего несколько байтов пространства кучи.</span><span class="sxs-lookup"><span data-stu-id="5497c-118">The [**RpcErrorAddRecord**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerroraddrecord) function call may fail if enough memory is not available, even though it requires only a few bytes of heap space.</span></span> <span data-ttu-id="5497c-119">Кроме того, записи, добавленные функцией **рпцеррораддрекорд** , суммируются в заданном потоке.</span><span class="sxs-lookup"><span data-stu-id="5497c-119">Also, records added by **RpcErrorAddRecord** accumulate in a given thread.</span></span> <span data-ttu-id="5497c-120">Среда выполнения обычно очищает эти записи до вызова серверной процедуры, но если расширенные сведения об ошибках используются за пределами RPC, постарайтесь очистить накопленную расширенную ошибку в потоке, вызвав [**рпцеррорклеаринформатион**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerrorclearinformation).</span><span class="sxs-lookup"><span data-stu-id="5497c-120">The runtime normally cleans those records up before it calls your server routine, but if extended error information is used outside RPC, take care of cleaning up the accumulated extended error in the thread by calling [**RpcErrorClearInformation**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerrorclearinformation).</span></span>

 

 




