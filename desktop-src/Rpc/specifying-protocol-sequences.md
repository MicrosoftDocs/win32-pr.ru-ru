---
title: Указание последовательностей протоколов
description: Серверные приложения должны выбрать одну или несколько последовательностей протоколов для использования при взаимодействии с клиентом по сети. Варианты последовательностей протоколов зависят от сети. См. раздел Анализ сведений о привязке и выбор последовательности протокола.
ms.assetid: bde26a86-dc4f-4d18-ba51-c6536c62bb75
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a700299e3d2bd98fa5fb0aaebea25e907d85afb0
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104338484"
---
# <a name="specifying-protocol-sequences"></a>Указание последовательностей протоколов

Серверные приложения должны выбрать одну или несколько последовательностей протоколов для использования при взаимодействии с клиентом по сети. Варианты последовательностей протоколов зависят от сети. См. раздел [Анализ сведений о привязке](interpreting-binding-information.md) и [Выбор последовательности протокола](selecting-a-protocol-sequence.md).

Серверная программа может разрешить клиентам подключаться с помощью любой последовательности протоколов, поддерживаемой сетью. Для этого вызовите [**рпксерверусеаллпротсекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqs) и передайте RPC \_ C \_ протсек \_ Max \_ запросов секунду \_ Default в качестве первого параметра. Однако это не рекомендуемый подход. Вместо этого для удаленных вызовов, как правило, достаточно использовать **нкалрпк** для локальных вызовов и **нкакн \_ IP \_ TCP** или **нкакн \_ http** . Разнородных сети являются редкими, и практически все сети поддерживают TCP/IP.

Если требуется, чтобы Клиент ограничивал выделение портов для динамических конечных точек определенным диапазоном портов, следует вызвать [**рпксерверусеаллпротсексекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsex) . Эта функция характерна для Microsoft RPC и чрезвычайно полезна для удаленных вызовов процедур, которые проходят через брандмауэр. Он использует дополнительный параметр для передачи флагов управления выделением портов в функцию. См. [раздел Настройка реестра для выделения портов и выборочной привязки](configuring-the-windows-xp-2000-nt-registry-for-port-allocations-and-selective-binding.md).

Можно указать последовательности протоколов и сведения о конечной точке в файле MIDL при разработке интерфейсов сервера. В этом случае сервер должен использовать [**рпксерверусеаллпротсексиф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsif) для регистрации всех последовательностей протоколов и связанных сведений о конечной точке, предоставленных в IDL-файле. Кроме того, имеется соответствующая функция [**рпксерверусеаллпротсексифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsifex) , которая позволяет серверу передавать флаги управления выделением портов.

Если вы хотите настроить клиентские и серверные программы для взаимодействия с заданной последовательностью протокола, серверное приложение должно вызвать [**рпксерверусепротсек**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseq). Полный список последовательностей протокола Microsoft RPC см. в разделе [константы последовательности протоколов](protocol-sequence-constants.md).

Microsoft RPC также предоставляет [**рпксерверусепротсекекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqex) , позволяя приложениям выбирать определенные последовательности протоколов и управлять динамическим выделением портов.

В дополнение к протоколам, ориентированным на подключения, Microsoft RPC поддерживает также протоколы датаграммы (без подключения). Рекомендуется использовать протоколы, ориентированные на подключение; протоколы датаграмм имеют разные наборы функций, чем протоколы, ориентированные на подключение, и должны использоваться только в том случае, если разработчику распределенной системы требуется функция, доступная только в протоколах датаграмм. Ниже перечислены некоторые функции, доступные при использовании протоколов Datagram.

-   Датаграммы поддерживают протоколы транспорта без подключения по протоколу UDP и IPX.
-   Так как нет необходимости устанавливать и обслуживать подключение, протоколу RPC для датаграмм требуется меньше ресурсов.
-   Датаграммы обеспечивают более быструю привязку.
-   Как и в случае с RPC, ориентированным на подключение, вызовы по протоколу RPC по умолчанию *нонидемпотент*. Это означает, что вызов гарантированно не будет выполняться более одного раза. Однако функция может быть помечена как идемпотентными в IDL-файле, которая указывает RPC на то, что она является безвредной для выполнения функции более одного раза в ответ на один клиентский запрос. Это позволяет время выполнения поддерживать меньшее состояние на сервере. Обратите внимание, что вызов идемпотентными будет выполнен повторно только в редких обстоятельствах в нестабильной сети.
-   Datagram RPC поддерживает атрибут [Broadcast](/windows/desktop/Midl/broadcast) IDL. Широковещательная рассылка позволяет клиенту выдавать сообщения нескольким серверам одновременно. Это позволяет клиенту найти один или несколько доступных серверов в сети или управлять несколькими серверами одновременно. Обратите внимание, что широковещательная рассылка датаграмм действительна только в пределах локальной связи и обычно не пересекает маршрутизаторы. Широковещательные вызовы неявно идемпотентными. Если вызов содержит параметры \[ **out** \] , возвращается только первый ответ сервера. После ответа сервера все будущие RPC через этот маркер привязки будут отправляться только на этот сервер, включая вызовы с атрибутом Broadcast. Чтобы отправить другое вещание, создайте новый маркер привязки или вызовите [**рпкбиндингресет**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingreset) для существующего маркера.
-   Datagram RPC поддерживает атрибут [IDL.](/windows/desktop/Midl/maybe) Это позволяет клиенту отправить вызов серверу, не дожидаясь ответа или подтверждения. Вызов не может содержать \[ **выходные** \] Параметры. Вызовы с использованием, **\[ возможно \]** , вызывают неявное идемпотентными.

 

 