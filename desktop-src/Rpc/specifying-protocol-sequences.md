---
title: Указание последовательностей протоколов
description: Серверные приложения должны выбрать одну или несколько последовательностей протоколов для использования при взаимодействии с клиентом по сети. Варианты последовательностей протоколов зависят от сети. См. раздел Анализ сведений о привязке и выбор последовательности протокола.
ms.assetid: bde26a86-dc4f-4d18-ba51-c6536c62bb75
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a700299e3d2bd98fa5fb0aaebea25e907d85afb0
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104338484"
---
# <a name="specifying-protocol-sequences"></a><span data-ttu-id="9b6e0-105">Указание последовательностей протоколов</span><span class="sxs-lookup"><span data-stu-id="9b6e0-105">Specifying Protocol Sequences</span></span>

<span data-ttu-id="9b6e0-106">Серверные приложения должны выбрать одну или несколько последовательностей протоколов для использования при взаимодействии с клиентом по сети.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-106">Server applications must select one or more protocol sequences to use when communicating with the client over the network.</span></span> <span data-ttu-id="9b6e0-107">Варианты последовательностей протоколов зависят от сети.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-107">The choice of protocol sequences is network-dependent.</span></span> <span data-ttu-id="9b6e0-108">См. раздел [Анализ сведений о привязке](interpreting-binding-information.md) и [Выбор последовательности протокола](selecting-a-protocol-sequence.md).</span><span class="sxs-lookup"><span data-stu-id="9b6e0-108">See [Interpreting Binding Information](interpreting-binding-information.md) and [Selecting a Protocol Sequence](selecting-a-protocol-sequence.md).</span></span>

<span data-ttu-id="9b6e0-109">Серверная программа может разрешить клиентам подключаться с помощью любой последовательности протоколов, поддерживаемой сетью.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-109">Your server program may allow clients to connect using any protocol sequence that the network supports.</span></span> <span data-ttu-id="9b6e0-110">Для этого вызовите [**рпксерверусеаллпротсекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqs) и передайте RPC \_ C \_ протсек \_ Max \_ запросов секунду \_ Default в качестве первого параметра.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-110">To do this, invoke [**RpcServerUseAllProtseqs**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqs) and pass RPC\_C\_PROTSEQ\_MAX\_REQS\_DEFAULT as the first parameter.</span></span> <span data-ttu-id="9b6e0-111">Однако это не рекомендуемый подход.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-111">However, that is not the recommended approach.</span></span> <span data-ttu-id="9b6e0-112">Вместо этого для удаленных вызовов, как правило, достаточно использовать **нкалрпк** для локальных вызовов и **нкакн \_ IP \_ TCP** или **нкакн \_ http** .</span><span class="sxs-lookup"><span data-stu-id="9b6e0-112">Rather, using **ncalrpc** for local calls and **ncacn\_ip\_tcp** or **ncacn\_http** for remote calls is usually sufficient.</span></span> <span data-ttu-id="9b6e0-113">Разнородных сети являются редкими, и практически все сети поддерживают TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-113">Heterogenous networks are uncommon, and virtually all networks support TCP/IP.</span></span>

<span data-ttu-id="9b6e0-114">Если требуется, чтобы Клиент ограничивал выделение портов для динамических конечных точек определенным диапазоном портов, следует вызвать [**рпксерверусеаллпротсексекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsex) .</span><span class="sxs-lookup"><span data-stu-id="9b6e0-114">If you want your client to restrict port allocation for dynamic endpoints to a specific port range, call [**RpcServerUseAllProtseqsEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsex) instead.</span></span> <span data-ttu-id="9b6e0-115">Эта функция характерна для Microsoft RPC и чрезвычайно полезна для удаленных вызовов процедур, которые проходят через брандмауэр.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-115">This function is specific to Microsoft RPC, and is extremely useful for remote procedure calls that pass through a firewall.</span></span> <span data-ttu-id="9b6e0-116">Он использует дополнительный параметр для передачи флагов управления выделением портов в функцию.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-116">It uses an extra parameter to pass port allocation control flags to the function.</span></span> <span data-ttu-id="9b6e0-117">См. [раздел Настройка реестра для выделения портов и выборочной привязки](configuring-the-windows-xp-2000-nt-registry-for-port-allocations-and-selective-binding.md).</span><span class="sxs-lookup"><span data-stu-id="9b6e0-117">See [Configuring the Registry for Port Allocations and Selective Binding](configuring-the-windows-xp-2000-nt-registry-for-port-allocations-and-selective-binding.md).</span></span>

<span data-ttu-id="9b6e0-118">Можно указать последовательности протоколов и сведения о конечной точке в файле MIDL при разработке интерфейсов сервера.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-118">You can specify protocol sequences and endpoint information in your MIDL file when you develop the server's interfaces.</span></span> <span data-ttu-id="9b6e0-119">В этом случае сервер должен использовать [**рпксерверусеаллпротсексиф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsif) для регистрации всех последовательностей протоколов и связанных сведений о конечной точке, предоставленных в IDL-файле.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-119">If you do, your server should use [**RpcServerUseAllProtseqsIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsif) to register all the protocol sequences and associated endpoint information provided in the IDL file.</span></span> <span data-ttu-id="9b6e0-120">Кроме того, имеется соответствующая функция [**рпксерверусеаллпротсексифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsifex) , которая позволяет серверу передавать флаги управления выделением портов.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-120">In addition, there is a corresponding [**RpcServerUseAllProtseqsIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsifex) function that also allows the server to pass port allocation–control flags.</span></span>

<span data-ttu-id="9b6e0-121">Если вы хотите настроить клиентские и серверные программы для взаимодействия с заданной последовательностью протокола, серверное приложение должно вызвать [**рпксерверусепротсек**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseq).</span><span class="sxs-lookup"><span data-stu-id="9b6e0-121">If you want to configure your client and server programs to communicate with a specified protocol sequence, the server application should call [**RpcServerUseProtseq**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseq).</span></span> <span data-ttu-id="9b6e0-122">Полный список последовательностей протокола Microsoft RPC см. в разделе [константы последовательности протоколов](protocol-sequence-constants.md).</span><span class="sxs-lookup"><span data-stu-id="9b6e0-122">For a complete list of Microsoft RPC protocol sequences, see [Protocol Sequence Constants](protocol-sequence-constants.md).</span></span>

<span data-ttu-id="9b6e0-123">Microsoft RPC также предоставляет [**рпксерверусепротсекекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqex) , позволяя приложениям выбирать определенные последовательности протоколов и управлять динамическим выделением портов.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-123">Microsoft RPC also provides [**RpcServerUseProtseqEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqex) to enable applications to select specific protocol sequences and control dynamic port allocation.</span></span>

<span data-ttu-id="9b6e0-124">В дополнение к протоколам, ориентированным на подключения, Microsoft RPC поддерживает также протоколы датаграммы (без подключения).</span><span class="sxs-lookup"><span data-stu-id="9b6e0-124">In addition to connection-oriented protocols, Microsoft RPC supports datagram (connectionless) protocols as well.</span></span> <span data-ttu-id="9b6e0-125">Рекомендуется использовать протоколы, ориентированные на подключение; протоколы датаграмм имеют разные наборы функций, чем протоколы, ориентированные на подключение, и должны использоваться только в том случае, если разработчику распределенной системы требуется функция, доступная только в протоколах датаграмм.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-125">Connection-oriented protocols are recommended; datagram protocols have different feature sets than connection-oriented protocols, and should only be used if a distributed system developer requires a feature available only in datagram protocols.</span></span> <span data-ttu-id="9b6e0-126">Ниже перечислены некоторые функции, доступные при использовании протоколов Datagram.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-126">Some of the features available when using datagram protocols are:</span></span>

-   <span data-ttu-id="9b6e0-127">Датаграммы поддерживают протоколы транспорта без подключения по протоколу UDP и IPX.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-127">Datagrams support the UDP and IPX connectionless transport protocols.</span></span>
-   <span data-ttu-id="9b6e0-128">Так как нет необходимости устанавливать и обслуживать подключение, протоколу RPC для датаграмм требуется меньше ресурсов.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-128">Because it is not necessary to establish and maintain a connection, the datagram RPC protocol requires less resource overhead.</span></span>
-   <span data-ttu-id="9b6e0-129">Датаграммы обеспечивают более быструю привязку.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-129">Datagrams enable faster binding.</span></span>
-   <span data-ttu-id="9b6e0-130">Как и в случае с RPC, ориентированным на подключение, вызовы по протоколу RPC по умолчанию *нонидемпотент*.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-130">As with connection-oriented RPC, datagram RPC calls are by default *nonidempotent*.</span></span> <span data-ttu-id="9b6e0-131">Это означает, что вызов гарантированно не будет выполняться более одного раза.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-131">This means the call is guaranteed not to be executed more than once.</span></span> <span data-ttu-id="9b6e0-132">Однако функция может быть помечена как идемпотентными в IDL-файле, которая указывает RPC на то, что она является безвредной для выполнения функции более одного раза в ответ на один клиентский запрос.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-132">However, a function can be marked as idempotent in the IDL file telling RPC that it is harmless to execute the function more than once in response to a single, client request.</span></span> <span data-ttu-id="9b6e0-133">Это позволяет время выполнения поддерживать меньшее состояние на сервере.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-133">This allows the run time to maintain less state on the server.</span></span> <span data-ttu-id="9b6e0-134">Обратите внимание, что вызов идемпотентными будет выполнен повторно только в редких обстоятельствах в нестабильной сети.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-134">Note that an idempotent call would be re-executed only in rare circumstances on an unstable network.</span></span>
-   <span data-ttu-id="9b6e0-135">Datagram RPC поддерживает атрибут [Broadcast](/windows/desktop/Midl/broadcast) IDL.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-135">Datagram RPC supports the [broadcast](/windows/desktop/Midl/broadcast) IDL attribute.</span></span> <span data-ttu-id="9b6e0-136">Широковещательная рассылка позволяет клиенту выдавать сообщения нескольким серверам одновременно.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-136">Broadcast enables a client to issue messages to multiple servers at the same time.</span></span> <span data-ttu-id="9b6e0-137">Это позволяет клиенту найти один или несколько доступных серверов в сети или управлять несколькими серверами одновременно.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-137">This lets the client locate one of several available servers on the network, or control multiple servers simultaneously.</span></span> <span data-ttu-id="9b6e0-138">Обратите внимание, что широковещательная рассылка датаграмм действительна только в пределах локальной связи и обычно не пересекает маршрутизаторы.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-138">Note that the datagram broadcast is valid only within the local link, and usually does not cross routers.</span></span> <span data-ttu-id="9b6e0-139">Широковещательные вызовы неявно идемпотентными.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-139">Broadcast calls are implicitly idempotent.</span></span> <span data-ttu-id="9b6e0-140">Если вызов содержит параметры \[ **out** \] , возвращается только первый ответ сервера.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-140">If the call contains \[**out**\] parameters, only the first server response is returned.</span></span> <span data-ttu-id="9b6e0-141">После ответа сервера все будущие RPC через этот маркер привязки будут отправляться только на этот сервер, включая вызовы с атрибутом Broadcast.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-141">Once a server responds, all future RPCs over that binding handle will be sent to that server only, including calls with the broadcast attribute.</span></span> <span data-ttu-id="9b6e0-142">Чтобы отправить другое вещание, создайте новый маркер привязки или вызовите [**рпкбиндингресет**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingreset) для существующего маркера.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-142">To send another broadcast, create a new binding handle or call [**RpcBindingReset**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingreset) on the existing handle.</span></span>
-   <span data-ttu-id="9b6e0-143">Datagram RPC поддерживает атрибут [IDL.](/windows/desktop/Midl/maybe)</span><span class="sxs-lookup"><span data-stu-id="9b6e0-143">Datagram RPC supports the [maybe](/windows/desktop/Midl/maybe) IDL attribute.</span></span> <span data-ttu-id="9b6e0-144">Это позволяет клиенту отправить вызов серверу, не дожидаясь ответа или подтверждения.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-144">This lets the client send a call to the server without waiting for a response or confirmation.</span></span> <span data-ttu-id="9b6e0-145">Вызов не может содержать \[ **выходные** \] Параметры.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-145">The call cannot contain \[**out**\] parameters.</span></span> <span data-ttu-id="9b6e0-146">Вызовы с использованием, **\[ возможно \]** , вызывают неявное идемпотентными.</span><span class="sxs-lookup"><span data-stu-id="9b6e0-146">Calls using the **\[maybe\]** calls are implicitly idempotent.</span></span>

 

 