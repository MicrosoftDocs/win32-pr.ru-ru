---
description: В этом разделе описывается создание, определение, установка и удаление таймеров.
ms.assetid: 509a6fc4-ddee-4ff4-88a2-25dad4c48c2f
title: О таймерах
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b3163dbfd5357de516e0202665cd76d017335593
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103999611"
---
# <a name="about-timers"></a><span data-ttu-id="949f4-103">О таймерах</span><span class="sxs-lookup"><span data-stu-id="949f4-103">About Timers</span></span>

<span data-ttu-id="949f4-104">В этом разделе описывается создание, определение, установка и удаление таймеров.</span><span class="sxs-lookup"><span data-stu-id="949f4-104">This topic describes how to create, identify, set, and delete timers.</span></span> <span data-ttu-id="949f4-105">Приложение использует таймер, чтобы запланировать событие для окна по истечении заданного времени.</span><span class="sxs-lookup"><span data-stu-id="949f4-105">An application uses a timer to schedule an event for a window after a specified time has elapsed.</span></span> <span data-ttu-id="949f4-106">Каждый раз, когда истечет указанный интервал (или значение времени ожидания) для таймера, система уведомляет окно, связанное с таймером.</span><span class="sxs-lookup"><span data-stu-id="949f4-106">Each time the specified interval (or time-out value) for a timer elapses, the system notifies the window associated with the timer.</span></span> <span data-ttu-id="949f4-107">Поскольку точность таймера зависит от частоты системных часов и частоты, с которой приложение получает сообщения из очереди сообщений, значение времени ожидания будет приблизительным.</span><span class="sxs-lookup"><span data-stu-id="949f4-107">Because a timer's accuracy depends on the system clock rate and how often the application retrieves messages from the message queue, the time-out value is only approximate.</span></span>

<span data-ttu-id="949f4-108">Этот раздел включает следующие подразделы:</span><span class="sxs-lookup"><span data-stu-id="949f4-108">This topic includes the following sections.</span></span>

-   [<span data-ttu-id="949f4-109">Операции с таймером</span><span class="sxs-lookup"><span data-stu-id="949f4-109">Timer Operations</span></span>](#timer-operations)
-   [<span data-ttu-id="949f4-110">Таймер с высоким разрешением</span><span class="sxs-lookup"><span data-stu-id="949f4-110">High-Resolution Timer</span></span>](#high-resolution-timer)
-   [<span data-ttu-id="949f4-111">Ожидающие объекты таймера</span><span class="sxs-lookup"><span data-stu-id="949f4-111">Waitable Timer Objects</span></span>](#waitable-timer-objects)
-   [<span data-ttu-id="949f4-112">См. также</span><span class="sxs-lookup"><span data-stu-id="949f4-112">Related topics</span></span>](#related-topics)

## <a name="timer-operations"></a><span data-ttu-id="949f4-113">Операции с таймером</span><span class="sxs-lookup"><span data-stu-id="949f4-113">Timer Operations</span></span>

<span data-ttu-id="949f4-114">Приложения создают таймеры с помощью функции [**сеттимер**](/windows/win32/api/winuser/nf-winuser-settimer) .</span><span class="sxs-lookup"><span data-stu-id="949f4-114">Applications create timers by using the [**SetTimer**](/windows/win32/api/winuser/nf-winuser-settimer) function.</span></span> <span data-ttu-id="949f4-115">Новый таймер начинает отсчет времени с момента создания.</span><span class="sxs-lookup"><span data-stu-id="949f4-115">A new timer starts timing the interval as soon as it is created.</span></span> <span data-ttu-id="949f4-116">Приложение может изменить значение времени ожидания таймера с помощью **сеттимер** и может уничтожить таймер с помощью функции [**киллтимер**](/windows/win32/api/winuser/nf-winuser-killtimer) .</span><span class="sxs-lookup"><span data-stu-id="949f4-116">An application can change a timer's time-out value by using **SetTimer** and can destroy a timer by using the [**KillTimer**](/windows/win32/api/winuser/nf-winuser-killtimer) function.</span></span> <span data-ttu-id="949f4-117">Для эффективного использования системных ресурсов приложения должны удалять таймеры, которые больше не нужны.</span><span class="sxs-lookup"><span data-stu-id="949f4-117">To use system resources efficiently, applications should destroy timers that are no longer necessary.</span></span>

<span data-ttu-id="949f4-118">Каждый таймер имеет уникальный идентификатор.</span><span class="sxs-lookup"><span data-stu-id="949f4-118">Each timer has a unique identifier.</span></span> <span data-ttu-id="949f4-119">При создании таймера приложение может либо указать идентификатор, либо создать в системе уникальное значение.</span><span class="sxs-lookup"><span data-stu-id="949f4-119">When creating a timer, an application can either specify an identifier or have the system create a unique value.</span></span> <span data-ttu-id="949f4-120">Первый параметр сообщения [**\_ таймера WM**](wm-timer.md) содержит идентификатор таймера, который опубликовал сообщение.</span><span class="sxs-lookup"><span data-stu-id="949f4-120">The first parameter of a [**WM\_TIMER**](wm-timer.md) message contains the identifier of the timer that posted the message.</span></span>

<span data-ttu-id="949f4-121">Если указать маркер окна в вызове [**сеттимер**](/windows/win32/api/winuser/nf-winuser-settimer), приложение связывает таймер с этим окном.</span><span class="sxs-lookup"><span data-stu-id="949f4-121">If you specify a window handle in the call to [**SetTimer**](/windows/win32/api/winuser/nf-winuser-settimer), the application associates the timer with that window.</span></span> <span data-ttu-id="949f4-122">Если время ожидания для таймера истекает, система отправляет сообщение [**\_ таймера WM**](wm-timer.md) в окно, связанное с таймером.</span><span class="sxs-lookup"><span data-stu-id="949f4-122">Whenever the time-out value for the timer elapses, the system posts a [**WM\_TIMER**](wm-timer.md) message to the window associated with the timer.</span></span> <span data-ttu-id="949f4-123">Если в вызове **сеттимер** не указан маркер окна, приложение, создавшее таймер, должно отслеживать его очередь сообщений на наличие сообщений **\_ таймера WM** и отправлять их в соответствующее окно.</span><span class="sxs-lookup"><span data-stu-id="949f4-123">If no window handle is specified in the call to **SetTimer**, the application that created the timer must monitor its message queue for **WM\_TIMER** messages and dispatch them to the appropriate window.</span></span> <span data-ttu-id="949f4-124">Если указать функцию обратного вызова [**тимерпрок**](/windows/win32/api/winuser/nc-winuser-timerproc) , то процедура окна по умолчанию вызывает функцию обратного вызова при обработке **\_ таймера WM**.</span><span class="sxs-lookup"><span data-stu-id="949f4-124">If you specify a [**TimerProc**](/windows/win32/api/winuser/nc-winuser-timerproc) callback function, the default window procedure calls the callback function when it processes **WM\_TIMER**.</span></span> <span data-ttu-id="949f4-125">Поэтому необходимо отправлять сообщения в вызывающем потоке даже при использовании **тимерпрок** вместо обработки **\_ таймера WM**.</span><span class="sxs-lookup"><span data-stu-id="949f4-125">Therefore, you need to dispatch messages in the calling thread, even when you use **TimerProc** instead of processing **WM\_TIMER**.</span></span>

<span data-ttu-id="949f4-126">Если необходимо получать уведомления по истечении времени таймера, используйте таймер ожидания.</span><span class="sxs-lookup"><span data-stu-id="949f4-126">If you need to be notified when a timer elapses, use a waitable timer.</span></span> <span data-ttu-id="949f4-127">Дополнительные сведения см. в разделе [ожидающие объекты таймера](/windows/desktop/Sync/waitable-timer-objects).</span><span class="sxs-lookup"><span data-stu-id="949f4-127">For more information, see [Waitable Timer Objects](/windows/desktop/Sync/waitable-timer-objects).</span></span>

## <a name="high-resolution-timer"></a><span data-ttu-id="949f4-128">Таймер High-Resolution</span><span class="sxs-lookup"><span data-stu-id="949f4-128">High-Resolution Timer</span></span>

<span data-ttu-id="949f4-129">Счетчик — это общий термин, используемый в программировании для ссылки на переменную приращения.</span><span class="sxs-lookup"><span data-stu-id="949f4-129">A counter is a general term used in programming to refer to an incrementing variable.</span></span> <span data-ttu-id="949f4-130">Некоторые системы включают счетчик производительности высокого разрешения, который обеспечивает время, прошедшее с высоким разрешением.</span><span class="sxs-lookup"><span data-stu-id="949f4-130">Some systems include a high-resolution performance counter that provides high-resolution elapsed times.</span></span>

<span data-ttu-id="949f4-131">Если в системе имеется счетчик производительности высокого разрешения, можно использовать функцию [**куериперформанцефрекуенци**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancefrequency) для выражения частоты в количестве в секунду.</span><span class="sxs-lookup"><span data-stu-id="949f4-131">If a high-resolution performance counter exists on the system, you can use the [**QueryPerformanceFrequency**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancefrequency) function to express the frequency, in counts per second.</span></span> <span data-ttu-id="949f4-132">Значение счетчика зависит от процессора.</span><span class="sxs-lookup"><span data-stu-id="949f4-132">The value of the count is processor dependent.</span></span> <span data-ttu-id="949f4-133">На некоторых процессорах, например, счетчик может быть циклической скоростью процессорных часов.</span><span class="sxs-lookup"><span data-stu-id="949f4-133">On some processors, for example, the count might be the cycle rate of the processor clock.</span></span>

<span data-ttu-id="949f4-134">Функция [**QueryPerformanceCounter**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancecounter) извлекает текущее значение счетчика производительности с высоким разрешением.</span><span class="sxs-lookup"><span data-stu-id="949f4-134">The [**QueryPerformanceCounter**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancecounter) function retrieves the current value of the high-resolution performance counter.</span></span> <span data-ttu-id="949f4-135">Вызывая эту функцию в начале и конце раздела кода, приложение по сути использует этот счетчик как таймер высокого разрешения.</span><span class="sxs-lookup"><span data-stu-id="949f4-135">By calling this function at the beginning and end of a section of code, an application essentially uses the counter as a high-resolution timer.</span></span> <span data-ttu-id="949f4-136">Например, предположим, что [**куериперформанцефрекуенци**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancefrequency) указывает, что частота счетчика производительности высокого разрешения составляет 50 000 счетчиков в секунду.</span><span class="sxs-lookup"><span data-stu-id="949f4-136">For example, suppose that [**QueryPerformanceFrequency**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancefrequency) indicates that the frequency of the high-resolution performance counter is 50,000 counts per second.</span></span> <span data-ttu-id="949f4-137">Если приложение вызывает **QueryPerformanceCounter** непосредственно перед и сразу после того, как раздел кода будет иметь время ожидания, значения счетчика могут быть 1500 числами и 3500 соответственно.</span><span class="sxs-lookup"><span data-stu-id="949f4-137">If the application calls **QueryPerformanceCounter** immediately before and immediately after the section of code to be timed, the counter values might be 1500 counts and 3500 counts, respectively.</span></span> <span data-ttu-id="949f4-138">Эти значения указывают на то, что во время выполнения кода прошло .04 секунд (число 2000).</span><span class="sxs-lookup"><span data-stu-id="949f4-138">These values would indicate that .04 seconds (2000 counts) elapsed while the code executed.</span></span>

## <a name="waitable-timer-objects"></a><span data-ttu-id="949f4-139">Ожидающие объекты таймера</span><span class="sxs-lookup"><span data-stu-id="949f4-139">Waitable Timer Objects</span></span>

<span data-ttu-id="949f4-140">Ожидающий объект таймера — это объект синхронизации, состояние которого задается сигнальным по наступлении указанного времени выполнения.</span><span class="sxs-lookup"><span data-stu-id="949f4-140">A waitable timer object is a synchronization object whose state is set to signaled when the specified due time arrives.</span></span> <span data-ttu-id="949f4-141">Существует два типа таймеров ожидания, которые можно создать: сброс и синхронизация вручную.</span><span class="sxs-lookup"><span data-stu-id="949f4-141">There are two types of waitable timers that can be created: manual-reset and synchronization.</span></span> <span data-ttu-id="949f4-142">Таймер любого типа также может быть периодическим таймером.</span><span class="sxs-lookup"><span data-stu-id="949f4-142">A timer of either type can also be a periodic timer.</span></span>

<span data-ttu-id="949f4-143">Поток использует функцию [**сбой createwaitabletimer**](/windows/win32/api/synchapi/nf-synchapi-createwaitabletimerw) или [**креатеваитаблетимерекс**](/windows/win32/api/synchapi/nf-synchapi-createwaitabletimerexw) для создания объекта Timer.</span><span class="sxs-lookup"><span data-stu-id="949f4-143">A thread uses the [**CreateWaitableTimer**](/windows/win32/api/synchapi/nf-synchapi-createwaitabletimerw) or [**CreateWaitableTimerEx**](/windows/win32/api/synchapi/nf-synchapi-createwaitabletimerexw) function to create a timer object.</span></span> <span data-ttu-id="949f4-144">Создание потока указывает, является ли таймер таймером сброса вручную или таймером синхронизации.</span><span class="sxs-lookup"><span data-stu-id="949f4-144">The creating thread specifies whether the timer is a manual-reset timer or a synchronization timer.</span></span> <span data-ttu-id="949f4-145">Создающий поток может указать имя для объекта Timer.</span><span class="sxs-lookup"><span data-stu-id="949f4-145">The creating thread can specify a name for the timer object.</span></span> <span data-ttu-id="949f4-146">Потоки в других процессах могут открыть обработчик для существующего таймера, указав его имя в вызове функции [**опенваитаблетимер**](/windows/win32/api/synchapi/nf-synchapi-openwaitabletimerw) .</span><span class="sxs-lookup"><span data-stu-id="949f4-146">Threads in other processes can open a handle to an existing timer by specifying its name in a call to the [**OpenWaitableTimer**](/windows/win32/api/synchapi/nf-synchapi-openwaitabletimerw) function.</span></span> <span data-ttu-id="949f4-147">Любой поток с дескриптором объекта Timer может использовать одну из функций ожидания, чтобы ждать, пока состояние таймера не станет сигнальным.</span><span class="sxs-lookup"><span data-stu-id="949f4-147">Any thread with a handle to a timer object can use one of the wait functions to wait for the timer state to be set to signaled.</span></span>

<span data-ttu-id="949f4-148">Дополнительные сведения об использовании ожидающих объектов таймера для синхронизации потоков см. в разделе [ожидающие объекты таймера](/windows/desktop/Sync/waitable-timer-objects).</span><span class="sxs-lookup"><span data-stu-id="949f4-148">For more information about using waitable timer objects for thread synchronization, see [Waitable Timer Objects](/windows/desktop/Sync/waitable-timer-objects).</span></span>

## <a name="related-topics"></a><span data-ttu-id="949f4-149">См. также</span><span class="sxs-lookup"><span data-stu-id="949f4-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="949f4-150">Использование таймеров</span><span class="sxs-lookup"><span data-stu-id="949f4-150">Using Timers</span></span>](using-timers.md)
</dt> </dl>

 

 
