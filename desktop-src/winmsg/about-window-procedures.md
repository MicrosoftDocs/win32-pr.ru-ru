---
description: Каждое окно является членом определенного класса Window. Класс Window определяет процедуру окна по умолчанию, используемую отдельным окном для обработки сообщений.
ms.assetid: 3a8e8f4e-910d-4863-a4a7-dd37c2dfa402
title: О процедурах окна
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f1f63586b9ca4ac6fe8486ba112316174533b44e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105693712"
---
# <a name="about-window-procedures"></a><span data-ttu-id="181b4-104">О процедурах окна</span><span class="sxs-lookup"><span data-stu-id="181b4-104">About Window Procedures</span></span>

<span data-ttu-id="181b4-105">Каждое окно является членом определенного класса Window.</span><span class="sxs-lookup"><span data-stu-id="181b4-105">Each window is a member of a particular window class.</span></span> <span data-ttu-id="181b4-106">Класс Window определяет процедуру окна по умолчанию, используемую отдельным окном для обработки сообщений.</span><span class="sxs-lookup"><span data-stu-id="181b4-106">The window class determines the default window procedure that an individual window uses to process its messages.</span></span> <span data-ttu-id="181b4-107">Все окна, принадлежащие одному и тому же классу, используют одну и ту же процедуру окна по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="181b4-107">All windows belonging to the same class use the same default window procedure.</span></span> <span data-ttu-id="181b4-108">Например, система определяет процедуру окна для класса поля со списком (**ComboBox**). Затем все поля со списком используют эту процедуру окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-108">For example, the system defines a window procedure for the combo box class (**COMBOBOX**); all combo boxes then use that window procedure.</span></span>

<span data-ttu-id="181b4-109">Приложение обычно регистрирует по крайней мере один новый класс окна и связанную с ним процедуру окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-109">An application typically registers at least one new window class and its associated window procedure.</span></span> <span data-ttu-id="181b4-110">После регистрации класса приложение может создать множество окон этого класса, все из которых используют одну и ту же оконную процедуру.</span><span class="sxs-lookup"><span data-stu-id="181b4-110">After registering a class, the application can create many windows of that class, all of which use the same window procedure.</span></span> <span data-ttu-id="181b4-111">Так как это означает, что несколько источников могут одновременно вызывать один и тот же фрагмент кода, при изменении общих ресурсов из оконной процедуры необходимо соблюдать осторожность.</span><span class="sxs-lookup"><span data-stu-id="181b4-111">Because this means several sources could simultaneously call the same piece of code, you must be careful when modifying shared resources from a window procedure.</span></span> <span data-ttu-id="181b4-112">Дополнительные сведения см. в разделе [классы окон](window-classes.md).</span><span class="sxs-lookup"><span data-stu-id="181b4-112">For more information, see [Window Classes](window-classes.md).</span></span>

<span data-ttu-id="181b4-113">Окна процедур для диалоговых окон (называемые процедурами диалоговых окон) имеют схожую структуру и функции в виде обычных оконных процедур.</span><span class="sxs-lookup"><span data-stu-id="181b4-113">Window procedures for dialog boxes (called dialog box procedures) have a similar structure and function as regular window procedures.</span></span> <span data-ttu-id="181b4-114">Все точки, которые ссылаются на процедуры окна в этом разделе, также применяются к процедурам диалоговых окон.</span><span class="sxs-lookup"><span data-stu-id="181b4-114">All points referring to window procedures in this section also apply to dialog box procedures.</span></span> <span data-ttu-id="181b4-115">Дополнительные сведения см. в разделе [диалоговые окна](/windows/desktop/dlgbox/dialog-boxes).</span><span class="sxs-lookup"><span data-stu-id="181b4-115">For more information, see [Dialog Boxes](/windows/desktop/dlgbox/dialog-boxes).</span></span>

<span data-ttu-id="181b4-116">В этом разделе рассматриваются следующие темы.</span><span class="sxs-lookup"><span data-stu-id="181b4-116">This section discusses the following topics.</span></span>

-   [<span data-ttu-id="181b4-117">Структура процедуры окна</span><span class="sxs-lookup"><span data-stu-id="181b4-117">Structure of a Window Procedure</span></span>](#structure-of-a-window-procedure)
-   [<span data-ttu-id="181b4-118">Процедура окна по умолчанию</span><span class="sxs-lookup"><span data-stu-id="181b4-118">Default Window Procedure</span></span>](#default-window-procedure)
-   [<span data-ttu-id="181b4-119">Подклассы оконных процедур</span><span class="sxs-lookup"><span data-stu-id="181b4-119">Window Procedure Subclassing</span></span>](#window-procedure-subclassing)
    -   [<span data-ttu-id="181b4-120">Подклассы экземпляров</span><span class="sxs-lookup"><span data-stu-id="181b4-120">Instance Subclassing</span></span>](#instance-subclassing)
    -   [<span data-ttu-id="181b4-121">Глобальные подклассы</span><span class="sxs-lookup"><span data-stu-id="181b4-121">Global Subclassing</span></span>](#global-subclassing)
-   [<span data-ttu-id="181b4-122">Подклассы оконных процедур</span><span class="sxs-lookup"><span data-stu-id="181b4-122">Window Procedure Superclassing</span></span>](#window-procedure-superclassing)

## <a name="structure-of-a-window-procedure"></a><span data-ttu-id="181b4-123">Структура процедуры окна</span><span class="sxs-lookup"><span data-stu-id="181b4-123">Structure of a Window Procedure</span></span>

<span data-ttu-id="181b4-124">Оконная процедура — это функция, которая имеет четыре параметра и возвращает значение со знаком.</span><span class="sxs-lookup"><span data-stu-id="181b4-124">A window procedure is a function that has four parameters and returns a signed value.</span></span> <span data-ttu-id="181b4-125">Параметры состоят из обработчика окна, идентификатора сообщения **uint** и двух параметров сообщения, объявленных с типами данных **wParam** и **lParam** .</span><span class="sxs-lookup"><span data-stu-id="181b4-125">The parameters consist of a window handle, a **UINT** message identifier, and two message parameters declared with the **WPARAM** and **LPARAM** data types.</span></span> <span data-ttu-id="181b4-126">Дополнительные сведения см. в разделе [**WindowProc**](/previous-versions/windows/desktop/legacy/ms633573(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="181b4-126">For more information, see [**WindowProc**](/previous-versions/windows/desktop/legacy/ms633573(v=vs.85)).</span></span>

<span data-ttu-id="181b4-127">Параметры сообщения часто содержат данные как в неупорядоченных, так и в высоком порядке словах.</span><span class="sxs-lookup"><span data-stu-id="181b4-127">Message parameters often contain information in both their low-order and high-order words.</span></span> <span data-ttu-id="181b4-128">Существует несколько макросов, которые приложение может использовать для извлечения информации из параметров сообщения.</span><span class="sxs-lookup"><span data-stu-id="181b4-128">There are several macros an application can use to extract information from the message parameters.</span></span> <span data-ttu-id="181b4-129">Например, макрос [**ловорд**](/previous-versions/windows/desktop/legacy/ms632659(v=vs.85)) извлекает младшее слово (в битах от 0 до 15) из параметра сообщения.</span><span class="sxs-lookup"><span data-stu-id="181b4-129">The [**LOWORD**](/previous-versions/windows/desktop/legacy/ms632659(v=vs.85)) macro, for example, extracts the low-order word (bits 0 through 15) from a message parameter.</span></span> <span data-ttu-id="181b4-130">К другим макросам относятся [**HIWORD**](/previous-versions/windows/desktop/legacy/ms632657(v=vs.85)), [**лобите**](/previous-versions/windows/desktop/legacy/ms632658(v=vs.85))и [**хибите**](/previous-versions/windows/desktop/legacy/ms632656(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="181b4-130">Other macros include [**HIWORD**](/previous-versions/windows/desktop/legacy/ms632657(v=vs.85)), [**LOBYTE**](/previous-versions/windows/desktop/legacy/ms632658(v=vs.85)), and [**HIBYTE**](/previous-versions/windows/desktop/legacy/ms632656(v=vs.85)).</span></span>

<span data-ttu-id="181b4-131">Интерпретация возвращаемого значения зависит от конкретного сообщения.</span><span class="sxs-lookup"><span data-stu-id="181b4-131">The interpretation of the return value depends on the particular message.</span></span> <span data-ttu-id="181b4-132">Просмотрите описание каждого сообщения, чтобы определить соответствующее возвращаемое значение.</span><span class="sxs-lookup"><span data-stu-id="181b4-132">Consult the description of each message to determine the appropriate return value.</span></span>

<span data-ttu-id="181b4-133">Так как процедуру окна можно вызывать рекурсивно, важно максимально сокращать количество локальных переменных, которые она использует.</span><span class="sxs-lookup"><span data-stu-id="181b4-133">Because it is possible to call a window procedure recursively, it is important to minimize the number of local variables that it uses.</span></span> <span data-ttu-id="181b4-134">При обработке отдельных сообщений приложение должно вызывать функции вне процедуры окна, чтобы избежать чрезмерного использования локальных переменных, что может привести к переполнению стека во время глубокой рекурсии.</span><span class="sxs-lookup"><span data-stu-id="181b4-134">When processing individual messages, an application should call functions outside the window procedure to avoid excessive use of local variables, possibly causing the stack to overflow during deep recursion.</span></span>

## <a name="default-window-procedure"></a><span data-ttu-id="181b4-135">Процедура окна по умолчанию</span><span class="sxs-lookup"><span data-stu-id="181b4-135">Default Window Procedure</span></span>

<span data-ttu-id="181b4-136">Функция процедуры окна по умолчанию [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) определяет определенное фундаментальное поведение, совместно используемое всеми окнами.</span><span class="sxs-lookup"><span data-stu-id="181b4-136">The default window procedure function, [**DefWindowProc**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) defines certain fundamental behavior shared by all windows.</span></span> <span data-ttu-id="181b4-137">Процедура окна по умолчанию предоставляет минимальную функциональность для окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-137">The default window procedure provides the minimal functionality for a window.</span></span> <span data-ttu-id="181b4-138">Определяемая приложением процедура окна должна передавать все сообщения, которые она не обрабатывает, в функцию **дефвиндовпрок** для обработки по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="181b4-138">An application-defined window procedure should pass any messages that it does not process to the **DefWindowProc** function for default processing.</span></span>

## <a name="window-procedure-subclassing"></a><span data-ttu-id="181b4-139">Подклассы оконных процедур</span><span class="sxs-lookup"><span data-stu-id="181b4-139">Window Procedure Subclassing</span></span>

<span data-ttu-id="181b4-140">Когда приложение создает окно, система выделяет блок памяти для хранения сведений, относящихся к окну, включая адрес процедуры окна, которая обрабатывает сообщения для окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-140">When an application creates a window, the system allocates a block of memory for storing information specific to the window, including the address of the window procedure that processes messages for the window.</span></span> <span data-ttu-id="181b4-141">Когда системе необходимо передать сообщение в окно, она выполняет поиск адреса процедуры окна в сведениях, относящихся к окну, и передает сообщение этой процедуре.</span><span class="sxs-lookup"><span data-stu-id="181b4-141">When the system needs to pass a message to the window, it searches the window-specific information for the address of the window procedure and passes the message to that procedure.</span></span>

<span data-ttu-id="181b4-142">Создание *подклассов* — это метод, позволяющий приложению перехватывать и обрабатывать сообщения, отправленные или отправляемые в определенное окно, прежде чем окно сможет их обработать.</span><span class="sxs-lookup"><span data-stu-id="181b4-142">*Subclassing* is a technique that allows an application to intercept and process messages sent or posted to a particular window before the window has a chance to process them.</span></span> <span data-ttu-id="181b4-143">При помощи подкласса окна приложение может дополнять, изменять или отслеживать поведение окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-143">By subclassing a window, an application can augment, modify, or monitor the behavior of the window.</span></span> <span data-ttu-id="181b4-144">Приложение может создать подкласс окна, принадлежащего глобальному системному классу, например элементу управления "поле ввода" или списку.</span><span class="sxs-lookup"><span data-stu-id="181b4-144">An application can subclass a window belonging to a system global class, such as an edit control or a list box.</span></span> <span data-ttu-id="181b4-145">Например, приложение может создать подкласс элемента управления редактирования, чтобы предотвратить прием элементом управления определенных символов.</span><span class="sxs-lookup"><span data-stu-id="181b4-145">For example, an application could subclass an edit control to prevent the control from accepting certain characters.</span></span> <span data-ttu-id="181b4-146">Однако нельзя создать подкласс окна или класса, принадлежащего другому приложению.</span><span class="sxs-lookup"><span data-stu-id="181b4-146">However, you cannot subclass a window or class that belongs to another application.</span></span> <span data-ttu-id="181b4-147">Все подклассы должны выполняться в рамках одного процесса.</span><span class="sxs-lookup"><span data-stu-id="181b4-147">All subclassing must be performed within the same process.</span></span>

<span data-ttu-id="181b4-148">Приложение подклассировать окно, заменив адрес исходной процедуры окна, адресом новой процедуры окна, называемой *процедурой-подкласс*.</span><span class="sxs-lookup"><span data-stu-id="181b4-148">An application subclasses a window by replacing the address of the window's original window procedure with the address of a new window procedure, called the *subclass procedure*.</span></span> <span data-ttu-id="181b4-149">После этого процедура подкласса получает все сообщения, отправленные или опубликованные в окне.</span><span class="sxs-lookup"><span data-stu-id="181b4-149">Thereafter, the subclass procedure receives any messages sent or posted to the window.</span></span>

<span data-ttu-id="181b4-150">Процедура подкласса может предпринять три действия после получения сообщения: оно может передать сообщение в исходную процедуру окна, изменить сообщение и передать его в исходную процедуру окна или обработать сообщение и не передать его в исходную процедуру окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-150">The subclass procedure can take three actions upon receiving a message: it can pass the message to the original window procedure, modify the message and pass it to the original window procedure, or process the message and not pass it to the original window procedure.</span></span> <span data-ttu-id="181b4-151">Если процедура подкласса обрабатывает сообщение, оно может сделать это до, после или до и после того, как оно передаст сообщение в исходную процедуру окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-151">If the subclass procedure processes a message, it can do so before, after, or both before and after it passes the message to the original window procedure.</span></span>

<span data-ttu-id="181b4-152">Система предоставляет два типа подкласса: [экземпляр](#instance-subclassing) и [глобальный](#global-subclassing).</span><span class="sxs-lookup"><span data-stu-id="181b4-152">The system provides two types of subclassing: [instance](#instance-subclassing) and [global](#global-subclassing).</span></span> <span data-ttu-id="181b4-153">В *подклассах экземпляров* приложение заменяет адрес процедуры Windows одного экземпляра окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-153">In *instance subclassing*, an application replaces the window procedure address of a single instance of a window.</span></span> <span data-ttu-id="181b4-154">Приложение должно использовать подклассы экземпляров для подкласса существующего окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-154">An application must use instance subclassing to subclass an existing window.</span></span> <span data-ttu-id="181b4-155">В *глобальных подклассах* приложение заменяет адрес процедуры окна в структуре [**вндкласс**](/windows/win32/api/winuser/ns-winuser-wndclassa) класса Window.</span><span class="sxs-lookup"><span data-stu-id="181b4-155">In *global subclassing*, an application replaces the address of the window procedure in the [**WNDCLASS**](/windows/win32/api/winuser/ns-winuser-wndclassa) structure of a window class.</span></span> <span data-ttu-id="181b4-156">Все последующие окна, созданные с помощью класса, имеют адрес процедуры подкласса, но существующие окна класса не затрагиваются.</span><span class="sxs-lookup"><span data-stu-id="181b4-156">All subsequent windows created with the class have the address of the subclass procedure, but existing windows of the class are not affected.</span></span>

### <a name="instance-subclassing"></a><span data-ttu-id="181b4-157">Подклассы экземпляров</span><span class="sxs-lookup"><span data-stu-id="181b4-157">Instance Subclassing</span></span>

<span data-ttu-id="181b4-158">Приложение подклассировать экземпляр окна с помощью функции [**SetWindowLong**](/windows/win32/api/winuser/nf-winuser-setwindowlonga) .</span><span class="sxs-lookup"><span data-stu-id="181b4-158">An application subclasses an instance of a window by using the [**SetWindowLong**](/windows/win32/api/winuser/nf-winuser-setwindowlonga) function.</span></span> <span data-ttu-id="181b4-159">Приложение передает флаг **ГВЛ \_ WndProc** , маркер окна в подкласс и адрес процедуры подкласс для **SetWindowLong**.</span><span class="sxs-lookup"><span data-stu-id="181b4-159">The application passes the **GWL\_WNDPROC** flag, the handle to the window to subclass, and the address of the subclass procedure to **SetWindowLong**.</span></span> <span data-ttu-id="181b4-160">Процедура подкласса может находиться либо в исполняемом файле приложения, либо в библиотеке DLL.</span><span class="sxs-lookup"><span data-stu-id="181b4-160">The subclass procedure can reside in either the application's executable or a DLL.</span></span>

<span data-ttu-id="181b4-161">[**SetWindowLong**](/windows/win32/api/winuser/nf-winuser-setwindowlonga) возвращает адрес исходной процедуры окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-161">[**SetWindowLong**](/windows/win32/api/winuser/nf-winuser-setwindowlonga) returns the address of the window's original window procedure.</span></span> <span data-ttu-id="181b4-162">Приложение должно сохранить адрес, используя его при последующих вызовах функции [**каллвиндовпрок**](/windows/win32/api/winuser/nf-winuser-callwindowproca) , чтобы передать перехваченные сообщения в исходную процедуру окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-162">The application must save the address, using it in subsequent calls to the [**CallWindowProc**](/windows/win32/api/winuser/nf-winuser-callwindowproca) function, to pass intercepted messages to the original window procedure.</span></span> <span data-ttu-id="181b4-163">Приложение также должно иметь адрес исходной процедуры окна, чтобы удалить подкласс из окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-163">The application must also have the original window procedure address to remove the subclass from the window.</span></span> <span data-ttu-id="181b4-164">Чтобы удалить подкласс, приложение вызывает **SetWindowLong** еще раз, передавая адрес исходной процедуры окна с флагом **ГВЛ \_ WndProc** и маркером в окно.</span><span class="sxs-lookup"><span data-stu-id="181b4-164">To remove the subclass, the application calls **SetWindowLong** again, passing the address of the original window procedure with the **GWL\_WNDPROC** flag and the handle to the window.</span></span>

<span data-ttu-id="181b4-165">Система владеет глобальными системными классами, а аспекты элементов управления могут изменяться от одной версии системы до следующей.</span><span class="sxs-lookup"><span data-stu-id="181b4-165">The system owns the system global classes, and aspects of the controls might change from one version of the system to the next.</span></span> <span data-ttu-id="181b4-166">Если приложение должно подделать подкласс окну, принадлежащему глобальному системному классу, разработчику может потребоваться обновить приложение при выпуске новой версии системы.</span><span class="sxs-lookup"><span data-stu-id="181b4-166">If the application must subclass a window that belongs to a system global class, the developer may need to update the application when a new version of the system is released.</span></span>

<span data-ttu-id="181b4-167">Поскольку создание подклассов экземпляров происходит после создания окна, нельзя добавить дополнительные байты в окно.</span><span class="sxs-lookup"><span data-stu-id="181b4-167">Because instance subclassing occurs after a window is created, you cannot add any extra bytes to the window.</span></span> <span data-ttu-id="181b4-168">Приложения, которые подклассировать окно, должны использовать список свойств окна для хранения любых данных, необходимых для экземпляра окна подкласса.</span><span class="sxs-lookup"><span data-stu-id="181b4-168">Applications that subclass a window should use the window's property list to store any data needed for an instance of the subclassed window.</span></span> <span data-ttu-id="181b4-169">Дополнительные сведения см. в разделе [Свойства окна](window-properties.md).</span><span class="sxs-lookup"><span data-stu-id="181b4-169">For more information, see [Window Properties](window-properties.md).</span></span>

<span data-ttu-id="181b4-170">Когда приложение подклассировать окно подклассов, оно должно удалить подклассы в порядке, в котором они были выполнены.</span><span class="sxs-lookup"><span data-stu-id="181b4-170">When an application subclasses a subclassed window, it must remove the subclasses in the reverse order they were performed.</span></span> <span data-ttu-id="181b4-171">Если порядок удаления не изменяется, может произойти Неустранимая системная ошибка.</span><span class="sxs-lookup"><span data-stu-id="181b4-171">If the removal order is not reversed, an unrecoverable system error may occur.</span></span>

### <a name="global-subclassing"></a><span data-ttu-id="181b4-172">Глобальные подклассы</span><span class="sxs-lookup"><span data-stu-id="181b4-172">Global Subclassing</span></span>

<span data-ttu-id="181b4-173">Чтобы глобально подклассировать класс окна, приложение должно иметь обработчик для окна класса.</span><span class="sxs-lookup"><span data-stu-id="181b4-173">To globally subclass a window class, the application must have a handle to a window of the class.</span></span> <span data-ttu-id="181b4-174">Приложению также нужен обработчик для удаления подкласса.</span><span class="sxs-lookup"><span data-stu-id="181b4-174">The application also needs the handle to remove the subclass.</span></span> <span data-ttu-id="181b4-175">Для получения маркера приложение обычно создает скрытое окно класса, для которого создается подкласс.</span><span class="sxs-lookup"><span data-stu-id="181b4-175">To get the handle, an application typically creates a hidden window of the class to be subclassed.</span></span> <span data-ttu-id="181b4-176">После получения маркера приложение вызывает функцию [**сеткласслонг**](/windows/win32/api/winuser/nf-winuser-setclasslonga) , задавая маркер, флаг **ГКЛ \_ WndProc** и адрес процедуры подкласса.</span><span class="sxs-lookup"><span data-stu-id="181b4-176">After obtaining the handle, the application calls the [**SetClassLong**](/windows/win32/api/winuser/nf-winuser-setclasslonga) function, specifying the handle, the **GCL\_WNDPROC** flag, and the address of the subclass procedure.</span></span> <span data-ttu-id="181b4-177">**Сеткласслонг** возвращает адрес исходной процедуры окна для класса.</span><span class="sxs-lookup"><span data-stu-id="181b4-177">**SetClassLong** returns the address of the original window procedure for the class.</span></span>

<span data-ttu-id="181b4-178">Адрес исходной процедуры окна используется в глобальных подклассах аналогично тому, как он используется в подклассах экземпляров.</span><span class="sxs-lookup"><span data-stu-id="181b4-178">The original window procedure address is used in global subclassing in the same way it is used in instance subclassing.</span></span> <span data-ttu-id="181b4-179">Процедура подкласса передает сообщения в исходную процедуру окна путем вызова [**каллвиндовпрок**](/windows/win32/api/winuser/nf-winuser-callwindowproca).</span><span class="sxs-lookup"><span data-stu-id="181b4-179">The subclass procedure passes messages to the original window procedure by calling [**CallWindowProc**](/windows/win32/api/winuser/nf-winuser-callwindowproca).</span></span> <span data-ttu-id="181b4-180">Приложение удаляет подкласс из класса Window, вызывая [**сеткласслонг**](/windows/win32/api/winuser/nf-winuser-setclasslonga) еще раз, указывая адрес исходной процедуры окна, флаг **ГКЛ \_ WndProc** и указатель на окно класса, для которого создается подкласс.</span><span class="sxs-lookup"><span data-stu-id="181b4-180">The application removes the subclass from the window class by calling [**SetClassLong**](/windows/win32/api/winuser/nf-winuser-setclasslonga) again, specifying the address of the original window procedure, the **GCL\_WNDPROC** flag, and the handle to a window of the class being subclassed.</span></span> <span data-ttu-id="181b4-181">Приложение, глобально подклассом которого является класс элемента управления, должно удалить подкласс при завершении приложения. в противном случае может возникнуть Неустранимая системная ошибка.</span><span class="sxs-lookup"><span data-stu-id="181b4-181">An application that globally subclasses a control class must remove the subclass when the application terminates; otherwise, an unrecoverable system error may occur.</span></span>

<span data-ttu-id="181b4-182">Глобальные подклассы имеют те же ограничения, что и подклассы экземпляров, а также некоторые дополнительные ограничения.</span><span class="sxs-lookup"><span data-stu-id="181b4-182">Global subclassing has the same limitations as instance subclassing, plus some additional restrictions.</span></span> <span data-ttu-id="181b4-183">Приложение не должно использовать дополнительные байты для класса или экземпляра окна, не зная того, как они используются в исходной процедуре окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-183">An application should not use the extra bytes for either the class or the window instance without knowing exactly how the original window procedure uses them.</span></span> <span data-ttu-id="181b4-184">Если приложение должно связывать данные с окном, оно должно использовать свойства окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-184">If the application must associate data with a window, it should use window properties.</span></span>

## <a name="window-procedure-superclassing"></a><span data-ttu-id="181b4-185">Подклассы оконных процедур</span><span class="sxs-lookup"><span data-stu-id="181b4-185">Window Procedure Superclassing</span></span>

<span data-ttu-id="181b4-186">Создание класса с *помощью классов позволяет* приложению создать новый класс Window с базовой функциональностью существующего класса, а также улучшения, предоставляемые приложением.</span><span class="sxs-lookup"><span data-stu-id="181b4-186">*Superclassing* is a technique that allows an application to create a new window class with the basic functionality of the existing class, plus enhancements provided by the application.</span></span> <span data-ttu-id="181b4-187">Суперкласс основан на существующем классе окна, именуемом *базовым классом*.</span><span class="sxs-lookup"><span data-stu-id="181b4-187">A superclass is based on an existing window class called the *base class*.</span></span> <span data-ttu-id="181b4-188">Часто базовый класс является системным глобальным классом окон, таким как элемент управления "поле ввода", но может быть любым классом окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-188">Frequently, the base class is a system global window class such as an edit control, but it can be any window class.</span></span>

<span data-ttu-id="181b4-189">Суперкласс имеет собственную процедуру окна, называемую процедурой суперкласса.</span><span class="sxs-lookup"><span data-stu-id="181b4-189">A superclass has its own window procedure, called the superclass procedure.</span></span> <span data-ttu-id="181b4-190">*Процедура суперкласса* может предпринять три действия после получения сообщения: оно может передать сообщение в исходную процедуру окна, изменить сообщение и передать его в исходную процедуру окна или обработать сообщение и не передать его в исходную процедуру окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-190">The *superclass procedure* can take three actions upon receiving a message: It can pass the message to the original window procedure, modify the message and pass it to the original window procedure, or process the message and not pass it to the original window procedure.</span></span> <span data-ttu-id="181b4-191">Если процедура суперкласса обрабатывает сообщение, оно может сделать это до, после или до и после того, как оно передаст сообщение в исходную процедуру окна.</span><span class="sxs-lookup"><span data-stu-id="181b4-191">If the superclass procedure processes a message, it can do so before, after, or both before and after it passes the message to the original window procedure.</span></span>

<span data-ttu-id="181b4-192">В отличие от процедуры-подкласса, процедура суперкласса может обрабатывать сообщения о создании окна ([**WM \_ нккреате**](wm-nccreate.md), [**WM \_ CREATE**](wm-create.md)и т. д.), но она также должна передаваться в исходную процедуру окна базового класса, чтобы процедура окна базового класса могла выполнить свою процедуру инициализации.</span><span class="sxs-lookup"><span data-stu-id="181b4-192">Unlike a subclass procedure, a superclass procedure can process window creation messages ([**WM\_NCCREATE**](wm-nccreate.md), [**WM\_CREATE**](wm-create.md), and so on), but it must also pass them to the original base-class window procedure so that the base-class window procedure can perform its initialization procedure.</span></span>

<span data-ttu-id="181b4-193">Чтобы создать суперкласс для класса окна, приложение сначала вызывает функцию [**жетклассинфо**](/windows/win32/api/winuser/nf-winuser-getclassinfoa) для получения сведений о базовом классе.</span><span class="sxs-lookup"><span data-stu-id="181b4-193">To superclass a window class, an application first calls the [**GetClassInfo**](/windows/win32/api/winuser/nf-winuser-getclassinfoa) function to retrieve information about the base class.</span></span> <span data-ttu-id="181b4-194">**Жетклассинфо** заполняет структуру [**вндкласс**](/windows/win32/api/winuser/ns-winuser-wndclassa) значениями из структуры **вндкласс** базового класса.</span><span class="sxs-lookup"><span data-stu-id="181b4-194">**GetClassInfo** fills a [**WNDCLASS**](/windows/win32/api/winuser/ns-winuser-wndclassa) structure with the values from the **WNDCLASS** structure of the base class.</span></span> <span data-ttu-id="181b4-195">Затем приложение копирует собственный обработчик экземпляра в элемент **HINSTANCE** структуры **вндкласс** и копирует имя суперкласса в элемент **лпсзкласснаме** .</span><span class="sxs-lookup"><span data-stu-id="181b4-195">Next, the application copies its own instance handle into the **hInstance** member of the **WNDCLASS** structure and copies the name of the superclass into the **lpszClassName** member.</span></span> <span data-ttu-id="181b4-196">Если в базовом классе есть меню, приложение должно предоставить новое меню с теми же идентификаторами меню и скопировать имя меню в элемент **лпсзменунаме** .</span><span class="sxs-lookup"><span data-stu-id="181b4-196">If the base class has a menu, the application must provide a new menu with the same menu identifiers and copy the menu name into the **lpszMenuName** member.</span></span> <span data-ttu-id="181b4-197">Если процедура суперкласса обрабатывает сообщение [**\_ команды WM**](/windows/desktop/menurc/wm-command) и не передает его в процедуру окна базового класса, меню не должно иметь соответствующих идентификаторов.</span><span class="sxs-lookup"><span data-stu-id="181b4-197">If the superclass procedure processes the [**WM\_COMMAND**](/windows/desktop/menurc/wm-command) message and does not pass it to the window procedure of the base class, the menu need not have corresponding identifiers.</span></span> <span data-ttu-id="181b4-198">**Жетклассинфо** не возвращает элемент **лпсзменунаме**, **лпсзкласснаме** или **HINSTANCE** структуры **вндкласс** .</span><span class="sxs-lookup"><span data-stu-id="181b4-198">**GetClassInfo** does not return the **lpszMenuName**, **lpszClassName**, or **hInstance** member of the **WNDCLASS** structure.</span></span>

<span data-ttu-id="181b4-199">Приложение должно также задавать элемент **лпфнвндпрок** структуры [**вндкласс**](/windows/win32/api/winuser/ns-winuser-wndclassa) .</span><span class="sxs-lookup"><span data-stu-id="181b4-199">An application must also set the **lpfnWndProc** member of the [**WNDCLASS**](/windows/win32/api/winuser/ns-winuser-wndclassa) structure.</span></span> <span data-ttu-id="181b4-200">Функция [**жетклассинфо**](/windows/win32/api/winuser/nf-winuser-getclassinfoa) заполняет этот элемент адресом исходной процедуры окна для класса.</span><span class="sxs-lookup"><span data-stu-id="181b4-200">The [**GetClassInfo**](/windows/win32/api/winuser/nf-winuser-getclassinfoa) function fills this member with the address of the original window procedure for the class.</span></span> <span data-ttu-id="181b4-201">Приложение должно сохранить этот адрес для передачи сообщений в исходную процедуру окна, а затем скопировать адрес процедуры суперкласса в элемент **лпфнвндпрок** .</span><span class="sxs-lookup"><span data-stu-id="181b4-201">The application must save this address, to pass messages to the original window procedure, and then copy the address of the superclass procedure into the **lpfnWndProc** member.</span></span> <span data-ttu-id="181b4-202">При необходимости приложение может изменять любые другие члены структуры **вндкласс** .</span><span class="sxs-lookup"><span data-stu-id="181b4-202">The application can, if necessary, modify any other members of the **WNDCLASS** structure.</span></span> <span data-ttu-id="181b4-203">После заполнения структуры **вндкласс** приложение регистрирует суперкласс, передав адрес структуры в функцию [**registerClass**](/windows/win32/api/winuser/nf-winuser-registerclassa) .</span><span class="sxs-lookup"><span data-stu-id="181b4-203">After it fills the **WNDCLASS** structure, the application registers the superclass by passing the address of the structure to the [**RegisterClass**](/windows/win32/api/winuser/nf-winuser-registerclassa) function.</span></span> <span data-ttu-id="181b4-204">Затем этот суперкласс можно использовать для создания окон.</span><span class="sxs-lookup"><span data-stu-id="181b4-204">The superclass can then be used to create windows.</span></span>

<span data-ttu-id="181b4-205">Так как в качестве вспомогательного класса регистрируется новый класс окна, приложение может добавить к дополнительным байтам класса и дополнительным окнам байт.</span><span class="sxs-lookup"><span data-stu-id="181b4-205">Because superclassing registers a new window class, an application can add to both the extra class bytes and the extra window bytes.</span></span> <span data-ttu-id="181b4-206">Суперкласс не должен использовать исходные дополнительные байты для базового класса или окна по тем же причинам, когда подкласс экземпляра или глобальный подкласс не должны использовать их.</span><span class="sxs-lookup"><span data-stu-id="181b4-206">The superclass must not use the original extra bytes for the base class or the window for the same reasons that an instance subclass or a global subclass should not use them.</span></span> <span data-ttu-id="181b4-207">Кроме того, если приложение добавляет дополнительные байты для использования либо в классе, либо в экземпляре окна, оно должно ссылаться на дополнительные байты относительно числа дополнительных байтов, используемых исходным базовым классом.</span><span class="sxs-lookup"><span data-stu-id="181b4-207">Also, if the application adds extra bytes for its use to either the class or the window instance, it must reference the extra bytes relative to the number of extra bytes used by the original base class.</span></span> <span data-ttu-id="181b4-208">Поскольку число байтов, используемых базовым классом, может отличаться от версии базового класса к следующему, начальное смещение для собственных дополнительных байтов этого суперкласса также может отличаться от одной версии базового класса к другому.</span><span class="sxs-lookup"><span data-stu-id="181b4-208">Because the number of bytes used by the base class may vary from one version of the base class to the next, the starting offset for the superclass's own extra bytes may also vary from one version of the base class to the next.</span></span>

 

 
