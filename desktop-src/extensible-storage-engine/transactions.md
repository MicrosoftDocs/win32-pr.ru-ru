---
description: 'Дополнительные сведения: транзакции (события Windows)'
title: Транзакции (события Windows)
TOCTitle: Transactions
ms:assetid: 1ceb362c-1efe-439b-b10a-016c8a54f27b
ms:mtpsurl: https://msdn.microsoft.com/library/Gg269197(v=EXCHG.10)
ms:contentKeyID: 32765500
ms.date: 04/11/2016
ms.topic: article
ms.openlocfilehash: 90b5b566f5ff961ce7b0ae3725f580e1f39c041d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104346955"
---
# <a name="transactions-windows-events"></a><span data-ttu-id="cc85f-103">Транзакции (события Windows)</span><span class="sxs-lookup"><span data-stu-id="cc85f-103">Transactions (Windows Events)</span></span>


<span data-ttu-id="cc85f-104">_**Применимо к:** Windows | Windows Server_</span><span class="sxs-lookup"><span data-stu-id="cc85f-104">_**Applies to:** Windows�| Windows Server_</span></span>

## <a name="transactions"></a><span data-ttu-id="cc85f-105">Transactions</span><span class="sxs-lookup"><span data-stu-id="cc85f-105">Transactions</span></span>

<span data-ttu-id="cc85f-106">Транзакции ESE — это логические единицы обработки, которые управляют тем, как приложение видит и манипулирует строками в базе данных.</span><span class="sxs-lookup"><span data-stu-id="cc85f-106">ESE transactions are logical units of processing that control how an application sees and manipulates rows in the database.</span></span> <span data-ttu-id="cc85f-107">Приложение может использовать точки сохранения транзакций, чтобы определить, следует ли сохранить или отменить определенный набор изменений в базе данных.</span><span class="sxs-lookup"><span data-stu-id="cc85f-107">Your application can use transaction save points to determine whether to keep or discard a particular set of changes to the database.</span></span> <span data-ttu-id="cc85f-108">Все транзакции в ESE являются атомарными, последовательными, изолированными и устойчивыми (ACID), как описано ниже.</span><span class="sxs-lookup"><span data-stu-id="cc85f-108">All transactions in ESE are atomic, consistent, isolated, and durable (ACID) as described below:</span></span>

  - <span data-ttu-id="cc85f-109">**Атомарная:** Все обновления в транзакции появятся в базе данных или отбрасываются.</span><span class="sxs-lookup"><span data-stu-id="cc85f-109">**Atomic:** All the updates in the transaction either appear in the database or they are discarded.</span></span>

<!-- end list -->

  - <span data-ttu-id="cc85f-110">**Соответствует:** База данных всегда будет начинаться в допустимом состоянии и всегда будет находиться в другом допустимом состоянии.</span><span class="sxs-lookup"><span data-stu-id="cc85f-110">**Consistent:** The database will always start in a legal state and will always end in another legal state.</span></span> <span data-ttu-id="cc85f-111">Для приложений ESE ядро СУБД будет управлять некоторыми простыми ограничениями, например уникальностью уникального индекса, но само приложение будет определять почти все остальные аспекты того, что означает, что база данных будет находиться в допустимом состоянии.</span><span class="sxs-lookup"><span data-stu-id="cc85f-111">For ESE applications, the database engine will control some simple constraints, for example uniqueness of a unique index, but the application itself will define almost all other aspects of what it means for the database to be in a legal state.</span></span>

<!-- end list -->

  - <span data-ttu-id="cc85f-112">**Изоляция:** Транзакции изолированы от обновлений в других сеансах.</span><span class="sxs-lookup"><span data-stu-id="cc85f-112">**Isolation:** Transactions are isolated from updates by other sessions.</span></span> <span data-ttu-id="cc85f-113">Транзакция не будет видеть частичный набор изменений, сделанных другой транзакцией.</span><span class="sxs-lookup"><span data-stu-id="cc85f-113">A transaction will never see a partial set of changes made by another transaction.</span></span>

<!-- end list -->

  - <span data-ttu-id="cc85f-114">**Устойчивое:** После того как ядро СУБД подтверждает, что транзакция зафиксирована, ее изменения сохраняются в базе данных.</span><span class="sxs-lookup"><span data-stu-id="cc85f-114">**Durable:** After the database engine acknowledges that a transaction has been committed, its changes are persistent in the database.</span></span> <span data-ttu-id="cc85f-115">Устойчивость транзакции может быть необязательно отменено по соображениям производительности.</span><span class="sxs-lookup"><span data-stu-id="cc85f-115">The durability of a transaction may be optionally waived for performance reasons.</span></span>

<span data-ttu-id="cc85f-116">Транзакции выполняются в пределах границ вызовов [жетбегинтрансактион](./jetbegintransaction-function.md) и [жеткоммиттрансактион](./jetcommittransaction-function.md) или [жетроллбакк](./jetrollback-function.md).</span><span class="sxs-lookup"><span data-stu-id="cc85f-116">Transactions are performed within the bounds of the calls to [JetBeginTransaction](./jetbegintransaction-function.md) and [JetCommitTransaction](./jetcommittransaction-function.md) or [JetRollback](./jetrollback-function.md).</span></span> <span data-ttu-id="cc85f-117">Когда приложение входит в транзакцию, база данных будет зафиксирована в экземпляре во время начала транзакции.</span><span class="sxs-lookup"><span data-stu-id="cc85f-117">When the application enters the transaction, the database appears frozen at the instance in time that the transaction begins.</span></span> <span data-ttu-id="cc85f-118">Это называется изоляцией моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="cc85f-118">This is called snapshot isolation.</span></span> <span data-ttu-id="cc85f-119">Если транзакция завершается вызовом [жетроллбакк](./jetrollback-function.md), ни одна из операций, выполняемых в транзакции, не фиксируется в базе данных.</span><span class="sxs-lookup"><span data-stu-id="cc85f-119">If the transaction is terminated by calling [JetRollback](./jetrollback-function.md), none of the operations performed in the transaction are committed to the database.</span></span> <span data-ttu-id="cc85f-120">Если процесс или компьютер завершается сбоем до вызова [жеткоммиттрансактион](./jetcommittransaction-function.md) , то это то же самое, что и вызов [жетроллбакк](./jetrollback-function.md).</span><span class="sxs-lookup"><span data-stu-id="cc85f-120">If the process or the machine crashes before [JetCommitTransaction](./jetcommittransaction-function.md) is called, it is the same as calling [JetRollback](./jetrollback-function.md).</span></span>

<span data-ttu-id="cc85f-121">В этой процедуре показано, как запустить и зафиксировать транзакцию, которая считывает и обновляет данные в базе данных.</span><span class="sxs-lookup"><span data-stu-id="cc85f-121">This procedure shows how to start and commit a transaction that reads and updates data in a database.</span></span>

### <a name="to-start-and-commit-a-transaction"></a><span data-ttu-id="cc85f-122">Запуск и фиксация транзакции</span><span class="sxs-lookup"><span data-stu-id="cc85f-122">To start and commit a transaction</span></span>

1.  <span data-ttu-id="cc85f-123">Вызовите [жетбегинтрансактион](./jetbegintransaction-function.md) или [JetBeginTransaction2](./jetbegintransaction2-function.md) с идентификатором сеанса, чтобы начать транзакцию.</span><span class="sxs-lookup"><span data-stu-id="cc85f-123">Call [JetBeginTransaction](./jetbegintransaction-function.md) or [JetBeginTransaction2](./jetbegintransaction2-function.md) with the session ID to start the transaction.</span></span>

2.  <span data-ttu-id="cc85f-124">Переместите курсор к нужной записи, вызвав [жетмове](./jetmove-function.md) с JET_MoveFirst, указанным в параметре *CRowset* .</span><span class="sxs-lookup"><span data-stu-id="cc85f-124">Move the cursor to the desired record by calling [JetMove](./jetmove-function.md) with JET_MoveFirst specified in the *cRow* parameter.</span></span> <span data-ttu-id="cc85f-125">Дополнительные сведения о том, как переместить курсор, см. в статье [индексирование в разделе таблицы](./indexing-in-the-table.md) .</span><span class="sxs-lookup"><span data-stu-id="cc85f-125">For more information on how to move the cursor, see the [Indexing in the Table](./indexing-in-the-table.md) topic.</span></span>

3.  <span data-ttu-id="cc85f-126">Вызовите [жетжеттаблеколумнинфо](./jetgettablecolumninfo-function.md) для текущей записи с JET_ColInfo, указанным в параметре *инфолевел* , чтобы получить идентификатор столбца для столбца.</span><span class="sxs-lookup"><span data-stu-id="cc85f-126">Call [JetGetTableColumnInfo](./jetgettablecolumninfo-function.md) on the current record with JET_ColInfo specified in the *InfoLevel* parameter to retrieve the column ID for the column.</span></span> <span data-ttu-id="cc85f-127">Идентификатор столбца возвращается в структуре [JET_COLUMNDEF](./jet-columndef-structure.md) .</span><span class="sxs-lookup"><span data-stu-id="cc85f-127">The column ID is returned in the [JET_COLUMNDEF](./jet-columndef-structure.md) structure.</span></span>

4.  <span data-ttu-id="cc85f-128">Вызовите [жетсетколумн](./jetsetcolumn-function.md) с идентификатором сеанса, идентификатором таблицы и идентификатором столбца обновляемого столбца.</span><span class="sxs-lookup"><span data-stu-id="cc85f-128">Call [JetSetColumn](./jetsetcolumn-function.md) with the session ID, table ID, and column ID of the column that is updated.</span></span> <span data-ttu-id="cc85f-129">Данные столбца содержатся в параметре *пвдата* .</span><span class="sxs-lookup"><span data-stu-id="cc85f-129">The column data is contained in the *pvData* parameter.</span></span>

5.  <span data-ttu-id="cc85f-130">Вызовите [жеткоммиттрансактион](./jetcommittransaction-function.md) , чтобы зафиксировать транзакцию в базе данных.</span><span class="sxs-lookup"><span data-stu-id="cc85f-130">Call [JetCommitTransaction](./jetcommittransaction-function.md) to commit the transaction to the database.</span></span>

<span data-ttu-id="cc85f-131">Способ, с помощью которого ядро базы данных ESE реализует изоляцию моментальных снимков, имеет некоторые важные отличия от традиционных моделей реляционной базы данных и блокировки.</span><span class="sxs-lookup"><span data-stu-id="cc85f-131">The way in which an ESE database engine implements snapshot isolation has some important differences from traditional relational database isolation and locking models.</span></span> <span data-ttu-id="cc85f-132">Когда транзакция считывает строку, она всегда может получить доступ к строке без ошибок или ожидать, пока другие сеансы не выпускают блокировку.</span><span class="sxs-lookup"><span data-stu-id="cc85f-132">When a transaction reads a row, it can always access the row without failing or waiting for other sessions to release a lock.</span></span> <span data-ttu-id="cc85f-133">Когда транзакция пытается обновить строку, она будет выполнена, если это первый сеанс для обновления этой строки, то есть первый модуль записи WINS.</span><span class="sxs-lookup"><span data-stu-id="cc85f-133">When a transaction attempts to update a row, it will succeed if it is the first session to update that row, that is the first writer wins.</span></span> <span data-ttu-id="cc85f-134">Если сеанс не является первым средством записи, он немедленно завершится ошибкой с конфликтом записи.</span><span class="sxs-lookup"><span data-stu-id="cc85f-134">If the session is not the first writer then it will immediately fail with a write conflict error.</span></span> <span data-ttu-id="cc85f-135">Затем сеансу необходимо прервать транзакцию, подождать (обычно через произвольную задержку), чтобы другая транзакция зафиксировала свои изменения, а затем повторить транзакцию.</span><span class="sxs-lookup"><span data-stu-id="cc85f-135">The session must then abort its transaction, wait (usually via a random delay), for the other transaction to commit its changes, and then retry the transaction.</span></span> <span data-ttu-id="cc85f-136">Ядро СУБД не будет автоматически ожидать, пока другая транзакция не завершит свое обновление.</span><span class="sxs-lookup"><span data-stu-id="cc85f-136">The database engine will not automatically cause that session to wait until the other transaction has finished its update.</span></span> <span data-ttu-id="cc85f-137">Как правило, транзакция проверяется, чтобы обновить строку внутри вызова [жетупдате](./jetupdate-function.md) .</span><span class="sxs-lookup"><span data-stu-id="cc85f-137">Usually, a transaction will test if it can update a row inside of the [JetUpdate](./jetupdate-function.md) call.</span></span> <span data-ttu-id="cc85f-138">Если не удается заблокировать строку для обновления, [жетупдате](./jetupdate-function.md) завершится с JET_errWriteConflict.</span><span class="sxs-lookup"><span data-stu-id="cc85f-138">If it cannot lock the row for update then [JetUpdate](./jetupdate-function.md) will fail with JET_errWriteConflict.</span></span>

<span data-ttu-id="cc85f-139">Сеансы ограничены одним потоком с момента запуска транзакции до конца транзакции.</span><span class="sxs-lookup"><span data-stu-id="cc85f-139">Sessions are limited to one thread from the time the transaction starts to the end of the transaction.</span></span> <span data-ttu-id="cc85f-140">Рекомендуется, чтобы все операции Update и извлечения выполнялись в транзакции.</span><span class="sxs-lookup"><span data-stu-id="cc85f-140">It is recommended that all update and retrieve operations be performed in a transaction.</span></span> <span data-ttu-id="cc85f-141">ESE также поддерживает изменения схемы, такие как создание таблиц и добавление столбцов в транзакцию.</span><span class="sxs-lookup"><span data-stu-id="cc85f-141">ESE also supports schema modifications such as creating tables and adding columns inside the transaction.</span></span> <span data-ttu-id="cc85f-142">Обновления и изменения схемы могут выполняться в одной транзакции.</span><span class="sxs-lookup"><span data-stu-id="cc85f-142">Both update and schema modifications can be performed in the same transaction.</span></span> <span data-ttu-id="cc85f-143">После завершения транзакции с [жеткоммиттрансактион](./jetcommittransaction-function.md)обновление заносится в файл журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="cc85f-143">After the transaction completes with [JetCommitTransaction](./jetcommittransaction-function.md), the update is logged in the transaction log file.</span></span> <span data-ttu-id="cc85f-144">Эти файлы можно использовать для поддержания логически стабильного состояния в случае непредвиденного завершения процесса или завершения работы системы.</span><span class="sxs-lookup"><span data-stu-id="cc85f-144">These files can be used to maintain a logically consistent state in the event of an unexpected process termination or system shutdown.</span></span>

<span data-ttu-id="cc85f-145">Транзакции могут быть вложены до 7 уровней с соответствующими вызовами [жетбегинтрансактион](./jetbegintransaction-function.md) , [жеткоммиттрансактион](./jetcommittransaction-function.md) или [жетроллбакк](./jetrollback-function.md) , вложенными друг в друга.</span><span class="sxs-lookup"><span data-stu-id="cc85f-145">Transactions may be nested up to 7 levels with matching calls to [JetBeginTransaction](./jetbegintransaction-function.md) and [JetCommitTransaction](./jetcommittransaction-function.md) or [JetRollback](./jetrollback-function.md) nested within each other.</span></span> <span data-ttu-id="cc85f-146">Это позволяет приложению откатить часть транзакции без необходимости отката всей транзакции.</span><span class="sxs-lookup"><span data-stu-id="cc85f-146">This allows the application to rollback a part of the transaction without having to back out of the entire transaction.</span></span> <span data-ttu-id="cc85f-147">Вложенный вызов [жеткоммиттрансактион](./jetcommittransaction-function.md) означает, что этот уровень обработки завершен; Однако транзакция не фиксируется в базе данных, пока не будет вызвана операция внешнего вызова для фиксации транзакции с [жеткоммиттрансактион](./jetcommittransaction-function.md).</span><span class="sxs-lookup"><span data-stu-id="cc85f-147">The nested call to [JetCommitTransaction](./jetcommittransaction-function.md) signifies that this level of processing is complete; however, the transaction is not committed to the database until the outer most call to commit the transaction with [JetCommitTransaction](./jetcommittransaction-function.md).</span></span>

<span data-ttu-id="cc85f-148">Столбцы депонированного обновления могут обновляться одновременно несколькими сеансами без сбоя при Jet_errWriteConflict.</span><span class="sxs-lookup"><span data-stu-id="cc85f-148">Escrow update columns can be updated concurrently by multiple sessions without failing with Jet_errWriteConflict.</span></span> <span data-ttu-id="cc85f-149">Функцию [жетескровупдате](./jetescrowupdate-function.md) можно вызывать только для депонированных столбцов, столбцов, созданных с помощью Jet_bitColumnEscrowUpdate.</span><span class="sxs-lookup"><span data-stu-id="cc85f-149">The [JetEscrowUpdate](./jetescrowupdate-function.md) function may only be called on escrow columns, columns that were created with Jet_bitColumnEscrowUpdate.</span></span>
