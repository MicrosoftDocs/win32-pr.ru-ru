---
description: Дополнительные сведения о функции Жетрестореинстанце
title: Функция JetRestoreInstance
TOCTitle: JetRestoreInstance Function
ms:assetid: 7ba2b6ee-96f5-44c5-9842-5e58580f60f1
ms:mtpsurl: https://msdn.microsoft.com/library/Gg269306(v=EXCHG.10)
ms:contentKeyID: 32765597
ms.date: 04/11/2016
ms.topic: reference
api_name:
- JetRestoreInstanceW
- JetRestoreInstance
- JetRestoreInstanceA
topic_type:
- apiref
- kbArticle
api_type:
- DLLExport
- COM
api_location:
- ESENT.DLL
ROBOTS: INDEX,FOLLOW
ms.openlocfilehash: 638ec789417dcd35e63758263227245f6c22d65b3c7bb7dff775420c0bac2d66
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118978854"
---
# <a name="jetrestoreinstance-function"></a>Функция JetRestoreInstance


_**Применимо к:** Windows | Windows Сервером_

## <a name="jetrestoreinstance-function"></a>Функция JetRestoreInstance

Функция **жетрестореинстанце** восстанавливает и восстанавливает потоковую передачу резервной копии экземпляра, включая все подключенные базы данных. Он предназначен для работы с резервной копией, созданной с помощью функции [жетбаккупинстанце](./jetbackupinstance-function.md) . Это самая простая и Инкапсулированная функция Restore.

**Windows xp:****жетрестореинстанце** появился в Windows XP.  

```cpp
    JET_ERR JET_API JetRestoreInstance(
      __in          JET_INSTANCE instance,
      __in          JET_PCSTR sz,
      __in_opt      JET_PCSTR szDest,
      __in          JET_PFNSTATUS pfn
    );
```

### <a name="parameters"></a>Параметры

*вхождение*

Указывает экземпляр, используемый для этого вызова.

для Windows XP и более поздних выпусков использование этого параметра зависит от режима работы ядра. если ядро работает в режиме legacy (Windows 2000), где поддерживается только один экземпляр, то этот параметр может иметь значение null или быть установлен в допустимый выходной буфер, содержащий NULL или JET_instanceNil, который будет возвращать глобальный обработчик экземпляра, созданный в качестве побочного результата инициализации. Этот экземпляр можно передать в любой другой API, который принимает экземпляр. Если ядро работает в режиме с несколькими экземплярами, этот параметр должен быть установлен в допустимый входной буфер, содержащий возвращаемый [жеткреатеинстанце](./jetcreateinstance-function.md) экземпляр.

*SZ*

Папка, в которой находится резервная копия. Резервная копия должна быть создана с помощью API-интерфейсов [жетбаккуп](./jetbackup-function.md) .

*сздест*

Имя папки, в которую будут копироваться и восстанавливаться файлы базы данных из набора резервных копий. Если задано значение NULL (то есть для устаревшей [жетресторе](./jetrestore-function.md)), файлы базы данных будут скопированы и восстановлены в исходном расположении.

*PFN*

Необязательный указатель на функцию, которая будет вызываться как уведомление о ходе выполнения операции восстановления.

### <a name="return-value"></a>Возвращаемое значение

Эта функция возвращает [JET_ERR](./jet-err.md) DataType с одним из следующих кодов возврата. дополнительные сведения о возможных ошибках подсистемы ESE см. в разделе [ошибки расширенных служба хранилища Engine](./extensible-storage-engine-errors.md) и [параметры обработки ошибок](./error-handling-parameters.md).

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Код возврата</p></th>
<th><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>JET_errSuccess</p></td>
<td><p>Операция выполнена успешно.</p></td>
</tr>
<tr class="even">
<td><p>JET_errAlreadyInitialized</p></td>
<td><p>Не удалось выполнить операцию, так как модуль уже инициализирован для этого экземпляра.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errInvalidLogSequence</p></td>
<td><p>Набор файлов журнала из резервного набора данных и из текущего пути к журналу не совпадают.</p></td>
</tr>
<tr class="even">
<td><p>JET_errInvalidParameter</p></td>
<td><p>Один из указанных параметров содержит непредвиденное значение или содержит значение, которое не имеет смысла при объединении со значением другого параметра. эта ошибка будет возвращена <strong>жетрестореинстанце</strong> , когда модуль находится в режиме с несколькими экземплярами, а пинстанце ссылается на недопустимый экземпляр Windows XP и более поздних выпусков.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errInvalidPath</p></td>
<td><p>Не удалось выполнить операцию, так как некоторые из указанных путей являются недопустимыми (путь резервной копии, путь назначения, журнал или системный путь для экземпляра).</p></td>
</tr>
<tr class="even">
<td><p>JET_errPageSizeMismatch</p></td>
<td><p>Операция завершилась сбоем, так как модуль настроен на использование размера страницы базы данных (с использованием <a href="gg294044(v=exchg.10).md">жетсетсистемпараметер</a> для <a href="gg269337(v=exchg.10).md">JET_paramDatabasePageSize</a>), который не соответствует размеру страницы базы данных, используемому для создания файлов журнала транзакций, или баз данных, связанных с файлами журнала транзакций.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errRunningInMultiInstanceMode</p></td>
<td><p>не удалось выполнить операцию, так как параметры подразумевают режим одиночного экземпляра (режим совместимости Windows 2000), а модуль уже находится в режиме с несколькими экземплярами.</p></td>
</tr>
</tbody>
</table>


В случае успеха файлы базы данных из набора резервных копий будут восстановлены в своем расположении, а восстановление будет выполняться таким, что базы данных будут находиться в состоянии чистой согласованности транзакций. Восстановление приведет к воспроизведению файлов журналов из резервного набора данных и файлов журналов из пути к журналу, если такие файлы существуют. Это восстановление приведет к изменению файла контрольных точек, файлов журнала транзакций и любых баз данных, на которые ссылаются эти файлы журнала транзакций.

При сбое экземпляр остается в неинициализированном состоянии. Состояние файлов журнала транзакций и всех баз данных, на которые ссылаются эти файлы журнала транзакций, скорее всего, будет изменено при попытке инициализации восстановления и восстановления баз данных.

#### <a name="remarks"></a>Remarks

Процесс восстановления воссоздаст базы данных, присоединенные к экземпляру во время резервного копирования, и сохранит изменения в файлах базы данных. Результатом будут базы данных с одинаковыми транзакциями. По возможности он также сохраняет в базе данных изменения, выполненные с момента создания резервной копии до тех пор, пока в журналах транзакций не найдется Последнее изменение. Это могло быть возможно, если журналы транзакций, созданные с момента создания резервной копии, все еще находятся в каталоге журнала транзакций. Обратите внимание, что если для экземпляра было включено циклическое ведение журнала, то созданные журналы транзакций повторно используются, так что восстановление сможет сохранить изменения, которые были выполнены в момент резервного копирования. В любом случае этот процесс может занять довольно много времени, если количество файлов журнала транзакций, воспроизводимых с базами данных, велико.

**Жетрестореинстанце** должен вызываться для экземпляра, который уже был создан с помощью [жеткреатеинстанце](./jetcreateinstance-function.md).

Так как во время восстановления будет использоваться значительное количество страниц базы данных и журналов транзакций, то для этих функций может возвращаться вся последовательность ошибок. Такие ошибки могут воздержаться во временных сбоях выделения ресурсов, таких как Jet_errOutOfMemory к ошибкам, представляющим физические повреждения, такие как JET_errReadVerifyFailure, JET_errLogFileCorrupt или JET_errBadPageLink. Эти ошибки почти всегда вызываются аппаратными проблемами, поэтому их нельзя избежать. Необычное Управление файлами будет самим манифестом JET_errMissingLogFile или JET_errAttachedDatabaseMismatch или JET_errDatabaseSharingViolation или JET_errInvalidLogSequence. Эти ошибки предотвращаются приложением. Приложение должно быть аккуратным, чтобы защитить репозиторий этих файлов от манипуляции извне, такими как пользователь или другие приложения. Если приложение должно полностью уничтожить экземпляр, необходимо удалить все файлы, связанные с этим экземпляром. К ним относятся файл контрольных точек, файлы журнала транзакций и все файлы базы данных, присоединенные к экземпляру.

На различных этапах восстановления будут созданы записи журнала событий, включая ход воспроизведения журнала транзакций и окончательный результат восстановления.

#### <a name="requirements"></a>Требования

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>Клиент</strong></p></td>
<td><p>требуется Windows Vista или Windows XP.</p></td>
</tr>
<tr class="even">
<td><p><strong>Сервер</strong></p></td>
<td><p>требуется Windows server 2008 или Windows server 2003.</p></td>
</tr>
<tr class="odd">
<td><p><strong>Header</strong></p></td>
<td><p>Объявлено в ESENT. h.</p></td>
</tr>
<tr class="even">
<td><p><strong>Библиотека</strong></p></td>
<td><p>Используйте ESENT. lib.</p></td>
</tr>
<tr class="odd">
<td><p><strong>КОМПОНОВКИ</strong></p></td>
<td><p>Требуется ESENT.dll.</p></td>
</tr>
<tr class="even">
<td><p><strong>Юникод</strong></p></td>
<td><p>Реализуется как <strong>жетрестореинстанцев</strong> (Юникод) и <strong>жетрестореинстанцеа</strong> (ANSI).</p></td>
</tr>
</tbody>
</table>


#### <a name="see-also"></a>См. также

[JET_ERR](./jet-err.md)  
[JET_GRBIT](./jet-grbit.md)  
[JET_INSTANCE](./jet-instance.md)  
[жетбаккуп](./jetbackup-function.md)  
[жетбаккупинстанце](./jetbackupinstance-function.md)  
[жеткреатеинстанце](./jetcreateinstance-function.md)  
[жетсетсистемпараметер](./jetsetsystemparameter-function.md)
