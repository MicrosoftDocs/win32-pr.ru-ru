---
description: 'Дополнительные сведения: расширяемые файлы подсистемы хранилища'
title: Расширяемые файлы подсистемы хранилища
TOCTitle: Extensible Storage Engine Files
ms:assetid: b89a8f78-f2c4-4cbf-a000-a95c34589033
ms:mtpsurl: https://msdn.microsoft.com/library/Gg294069(v=EXCHG.10)
ms:contentKeyID: 32765684
ms.date: 09/22/2016
ms.topic: article
ms.openlocfilehash: c27bb0104c5923496c5dd7962ef4a9bacdc90af4
ms.sourcegitcommit: 70f39ec77d19d3c32c376ee2831753d2cafae41a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/09/2021
ms.locfileid: "105713359"
---
# <a name="extensible-storage-engine-files"></a>Расширяемые файлы подсистемы хранилища


_**Применимо к:** Windows | Windows Server_

## <a name="extensible-storage-engine-files"></a>Расширяемые файлы подсистемы хранилища

Расширяемая подсистема хранилища использует следующие типы файлов:

- [Файлы журнала транзакций](#transaction-log-files)

- [Временные файлы журналов транзакций](#temporary-transaction-log-files)

- [Зарезервированные файлы журнала транзакций](#reserved-transaction-log-files)

- [Файлы контрольных точек](#checkpoint-files)

- [Файлы базы данных](#database-files)

- [Временные базы данных](#temporary-databases)

- [Очистить файлы карт](#flush-map-files)

В этой таблице содержится обзор имен файлов данных, управляемых ESE. Для Windows Vista и более поздних версий параметр JET_paramLegacyNames влияет на используемые имена файлов.

<table xmlns="https://www.w3.org/1999/xhtml">
  <tr>
    <th>
      <p>Операционная система</p>
    </th>
    <th>
      <p>Windows Server 2003 и более ранние версии<br /><br /></p>
    </th>
    <th colspan="2">
      <p></p>
      <p>Windows Vista и более поздние версии (клиент) <br />
Windows Server 2008 и более поздние версии (сервер)
</p>
    </th>
    <th>
      <p>Юбилейное обновление Windows 10 и более поздние версии (клиент) <br />
Windows Server 2016 и более поздние версии (сервер)
</p>
    </th>
  </tr>
  <tr>
    <td>
      <p>
        <strong>Параметр JET_paramLegacyNames</strong>
      </p>
    </td>
    <td>
      <p>
        <strong>Н/Д</strong>
      </p>
    </td>
    <td>
      <p>
        <strong>None</strong>
      </p>
    </td>
    <td>
      <p>
        <strong>JET_bitESE98FileNames</strong>
      </p>
    </td>
    <td>
      <p>
        <strong>То же, что и Windows Vista/Server 2008</strong>
      </p>
    </td>
  </tr>
  <tr>
    <td>
      <p>Текущий журнал</p>
    </td>
    <td>
      <p>&lt;inst &gt; . log</p>
    </td>
    <td>
      <p>&lt;inst &gt; . жткс</p>
    </td>
    <td>
      <p>&lt;inst &gt; . log</p>
    </td>
    <td></td>
  </tr>
  <tr>
    <td>
      <p>Журнал предварительной инициализации</p>
    </td>
    <td>
      <p>&lt;inst &gt; tmp. log</p>
    </td>
    <td>
      <p>&lt;inst &gt; tmp. жткс</p>
    </td>
    <td>
      <p>&lt;inst &gt; tmp. log</p>
    </td>
    <td></td>
  </tr>
  <tr>
    <td>
      <p>Повернутые журналы</p>
    </td>
    <td>
      <p>&lt;inst &gt; XXXXX. log</p>
    </td>
    <td>
      <p>&lt;inst &gt; XXXXX. жткс после FFFFF переключается на &lt; inst &gt; XXXXXXXX. жткс</p>
    </td>
    <td>
      <p>&lt;inst &gt; XXXXX. log после переключения FFFFF в &lt; inst &gt; XXXXXXXX. log.</p>
    </td>
    <td></td>
  </tr>
  <tr>
    <td>
      <p>
        <a href="gg294069(v=exchg.10).md">Файлы контрольных точек</a>
      </p>
    </td>
    <td>
      <p>&lt;inst &gt; . chk</p>
    </td>
    <td>
      <p>&lt;inst &gt; . жкп</p>
    </td>
    <td>
      <p>&lt;inst &gt; . chk</p>
    </td>
    <td rowspan="2"></td>
  </tr>
  <tr>
    <td>
      <p>
        <a href="gg294069(v=exchg.10).md">Временные базы данных</a>
      </p>
    </td>
    <td>
      <p>&lt;имя файла временной базы данных &gt; по умолчанию: TMP. edb</p>
    </td>
    <td>
      <p>&lt;имя файла временной базы данных &gt; по умолчанию: TMP. edb</p>
    </td>
    <td>
      <p>&lt;имя файла временной базы данных &gt; по умолчанию: TMP. edb</p>
    </td>
  </tr>
  <tr>
    <td>
      <p>
        <a href="gg294069(v=exchg.10).md">Зарезервированные файлы журнала транзакций</a>
      </p>
    </td>
    <td>
      <p>Res1. log &amp; Res2. log</p>
    </td>
    <td>
      <p>&lt;inst &gt; рескскскскскс. ЖРС</p>
    </td>
    <td colspan="2">
      <p>&lt;inst &gt; рескскскскскс. ЖРС</p>
    </td>
  </tr>
  <tr>
    <td>
      <p>
        <a href="gg294069(v=exchg.10).md">Файлы базы данных</a>
      </p>
    </td>
    <td>
      <p>&lt;имя файла базы данных&gt;</p>
    </td>
    <td>
      <p>&lt;имя файла базы данных&gt;</p>
    </td>
    <td>
      <p>&lt;имя файла базы данных&gt;</p>
    </td>
    <td></td>
  </tr>
  <tr>
    <td>
      <p>
        <a href="gg294069(v=exchg.10).md">Очистить файлы карт</a>
      </p>
    </td>
    <td>
      <p>Н/Д</p>
    </td>
    <td>
      <p>Н/Д</p>
    </td>
    <td>
      <p>Н/Д</p>
    </td>
    <td>
      <p>&lt;имя файла базы данных без расширения &gt; . жфм</p>
    </td>
  </tr>
</table>


### <a name="transaction-log-files"></a>Файлы журнала транзакций

Файлы журнала транзакций содержат операции с файлами базы данных. Они содержат достаточно информации для перевода базы данных в логически целостное состояние после непредвиденного завершения процесса или завершения работы системы.

Имена файлов журнала зависят от имени из трех букв, которое можно задать с помощью [JET_paramBaseName](./transaction-log-parameters.md). В приведенных ниже примерах используется базовое имя EDB, так как это базовое имя по умолчанию. Расширение для файлов журнала транзакций будет иметь тип. log или. жткс в зависимости от того, задан ли JET_bitESE98FileNames в параметре JET_paramLegacyFileNames. Дополнительные сведения см. в разделе [Расширенные параметры подсистемы хранилища](./extensible-storage-engine-system-parameters.md).

Файлы журнала транзакций имеют имя \<base\> \<generation-number\> . log, начинающееся с 1. Номер создания журнала имеет шестнадцатеричный формат. Например, Edb00001. log — это первый журнал, а edb000ff. log — журнал 255th. Файлы журнала содержат пять шестнадцатеричных цифр в имени файла журнала, пока не будет создан файл журнала 1048576th, после чего файлы журнала начинают называться в формате 11,3 (например, edb00100000. log). \<base\>. log всегда является файлом журнала, который используется в настоящий момент. Если ядро СУБД неактивно, можно определить поколение EDB. log с помощью следующей команды: **esentutl.exe-ML EDB. log**.

Хотя файлы журнала транзакций имеют. Расширение журнала, обычно связанное с текстовыми файлами, файлы журнала транзакций имеют двоичный формат и никогда не должны редактироваться пользователем. Операции с базой данных записываются в журнал первыми. Данные могут быть записаны в файл базы данных позднее; возможно, немедленно, возможно, будет намного позже. В случае непредвиденного завершения процесса или прекращения работы системы операции по-прежнему находятся в файлах журнала, и можно выполнить откат незавершенных транзакций. Процесс воспроизведения файлов журнала транзакций называется *мягким восстановлением* и выполняется автоматически при вызове [жетинит](./jetinit-function.md) или [JetInit2](./jetinit2-function.md) . Мягкое восстановление также можно выполнить вручную с помощью параметра "-r" программы Esentutl.exe. Процесс воспроизведения файлов журнала транзакций в базе данных, восстановленной из резервной копии, называется *жесткое восстановление*.

Файлы журнала имеют фиксированный размер, настраиваемый с помощью [JET_paramLogFileSize](./transaction-log-parameters.md). Когда текущий файл журнала (EDB. log) заполняется, он переименовывается в \<base\> \<generation-number\> . log, а новый файл журнала транзакций необходим в потоке журнала транзакций.

С каждым экземпляром базы данных связана одна последовательность файлов журнала. В Windows XP появился [жеткреатеинстанце](./jetcreateinstance-function.md), что позволяет одному процессу использовать несколько последовательностей файлов журнала транзакций. Однако несколько последовательностей файлов журнала транзакций не могут существовать в одном каталоге.

Файлы журнала транзакций не следует менять, переименовывать, перемещать или удалять вручную, так как это может привести к повреждению данных.

Файлы журнала транзакций будут удалены ядром СУБД во время полной архивации (см. раздел [жетбаккуп](./jetbackup-function.md), [жеттрункателог](./jettruncatelog-function.md), [жеттрункателогинстанце](./jettruncateloginstance-function.md)) или во время нормальной работы, если циклическое ведение журнала включено.

После заполнения файла журнала транзакций ядру СУБД необходимо создать новый файл журнала. Циклическое ведение журнала — это способ, с помощью которого ядро СУБД может автоматически очищать файлы журналов, если они больше не требуются для восстановления после сбоя. Этот процесс является альтернативой удалению файлов журнала в ходе выполнения резервного копирования. Циклическое ведение журнала можно контролировать с помощью системного параметра [JET_paramCircularLog](./transaction-log-parameters.md) . Файлы журнала транзакций не следует удалять с помощью любого другого метода.

### <a name="temporary-transaction-log-files"></a>Временные файлы журналов транзакций

Когда EDB. log заполняется, ESE необходимо создать новый файл. Новый файл транзакций журнала называется временным файлом журнала транзакций до его использования ESE.

Во время создания нового файла журнала и его размера он будет называться \<base\> tmp. log. Создание нового файла может быть потенциально дорогостоящей операцией, поэтому ESE создаст следующий файл журнала в режиме «в фоновом задании».

Поскольку временный файл журнала транзакций создается с учетом необходимости создания нового файла журнала транзакций, он не содержит никаких полезных сведений.

### <a name="reserved-transaction-log-files"></a>Зарезервированные файлы журнала транзакций

Зарезервированные файлы журнала транзакций создаются, когда подсистема начинает регистрировать важные операции, чтобы получить чистое завершение работы.

**Windows Vista:** В Windows Vista и более поздних версиях зарезервированные файлы журнала транзакций имеют имя \<base\> рескскскскскс. ЖРС.

**Windows Server 2003:** В Windows Server 2003 и более ранних версиях зарезервированные файлы журнала транзакций имеют имена Res1. log и Res2. log.

В случае нехватки места на диске для ядра СУБД невозможно создать новый файл журнала. Самый надежный способ — завершить работу аккуратно, но некоторые операции (например, операции отката) все еще должны быть зарегистрированы. На этом этапе большинство операций с базами данных завершится ошибкой.

Поскольку зарезервированные файлы журнала транзакций создаются с учетом необходимости использования файлов журнала транзакций в сценарии нехватки дискового пространства, они не содержат полезных сведений.

### <a name="checkpoint-files"></a>файлы контрольных точек

Файл контрольных точек хранит контрольную точку для определенной последовательности файлов журнала транзакций. Файл контрольных точек называется \<base\> CHK или \<base\> жкп, в зависимости от того, задан ли JET_bitESE98FileNames в параметре JET_paramLegacyFileNames, а его расположение задается [JET_paramSystemPath](./transaction-log-parameters.md).

Операции базы данных сначала записываются в файлы журнала, а затем кэшируются в памяти. В более поздней точке операции записываются в файл базы данных, но по соображениям производительности порядок записи операций в файл базы данных может отличаться от порядка, в котором они были изначально зарегистрированы. Операции, записанные в файл журнала транзакций, будут находиться в одном из двух состояний:

  - Записывается в файл журнала транзакций и в файл базы данных.

  - Записывается в файл журнала транзакций и еще не записывается в файл базы данных.

Многие операции с базами данных могут храниться в одном файле журнала транзакций. Данный файл журнала может состоять из следующих элементов:

  - Все операции, записанные в файл базы данных.

  - Нет операций, записанных в файл базы данных

  - Сочетание операций, записанных в файл базы данных, и операций, которые еще не записаны в файл базы данных.

Контрольная точка относится к моменту времени в потоке журнала транзакций, где все операции до контрольной точки записываются в файл базы данных. Нет никакой гарантии на операции, выполняемые после создания контрольной точки. Некоторые могут быть в памяти, а некоторые могут быть записаны в базу данных.

Так как все операции в файлах журнала до контрольной точки представлены в файле базы данных, для мягкого восстановления требуется только файлы журнала транзакций после контрольной точки, чтобы перевести определенную базу данных в чистое состояние.

### <a name="database-files"></a>Файлы базы данных

Файл базы данных содержит схему для всех таблиц в базе данных, записи для всех таблиц в базе данных и индексы по таблицам. Его расположение задается с помощью [жеткреатедатабасе](./jetcreatedatabase-function.md), [JetCreateDatabase2](./jetcreatedatabase2-function.md), [жетаттачдатабасе](./jetattachdatabase-function.md)или [JetAttachDatabase2](./jetattachdatabase2-function.md).

После успешного вызова [жеттерм](./jetterm-function.md) или [JetTerm2](./jetterm2-function.md)база данных завершает работу в чистом виде.

Программа Esentutl.exe может определить, завершается ли работа базы данных с помощью параметра "-MH". Например, "esentutl.exe-MH Sample. edb" будет считывать заголовок базы данных с именем Sample. edb и выводить сведения о состоянии Sample. edb. Он может вывести на печать состояние: чистое завершение работы или состояние: "грязное" завершение работы.

База данных, которая не была завершена аккуратно, находится в состоянии "неправильное завершение работы". До выхода Windows XP это состояние было вызвано *несоответствующим*. "Грязную" (ненепротиворечивую) базу данных можно вернуть в исходное состояние с мягким восстановлением. Поврежденная база данных не совпадает с «грязной» («непротиворечивой») базой данных.

Поврежденная база данных относится к физическому или логическому повреждению и не может быть исправлена с помощью мягкого восстановления. Физические повреждения могут быть отражены в битах, что часто будет перехватываться контрольными суммами на страницах базы данных. Неудачная контрольная сумма в файле базы данных сама по себе является JET_errReadVerifyFailure ошибкой.

Только аккуратное завершение работы баз данных может быть безопасно перемещено или переименовано. Если база данных не была корректно завершена, она не может быть автоматически перемещена или переименована.

Несколько баз данных могут быть связаны с одной последовательностью файлов журнала транзакций.

### <a name="temporary-databases"></a>Временные базы данных

Временная база данных используется в качестве резервного хранилища для темптаблес, а также используется при создании индексов.

Имя и расположение настраиваются с помощью [JET_paramTempPath](./temporary-database-parameters.md).

Темптаблес создаются с помощью [жетопентемптабле](./jetopentemptable-function.md), [JetOpenTempTable2](./jetopentemptable2-function.md), [JetOpenTempTable3](./jetopentemptable3-function.md), [жетопентемпораритабле](./jetopentemporarytable-function.md). Они также создаются некоторыми вызовами API и используются для возврата сведений о схеме (например, [жетжетиндексинфо](./jetgetindexinfo-function.md)).

## <a name="flush-map-files"></a>Очистить файлы карт

Начиная с юбилея Windows 10 юбилейное обновление (клиент) и Windows Server 2016 (сервер), подсистема ESE добавила дополнительный уровень защиты от потерянных операций записи (или потерянных сбросов) 1, что позволяет ей обнаруживать такие события, initialization2 перекрестной обработки. Эта функция требует сохранения метаданных в отдельном файле, который называется "дисковой картой".

Для каждого файла базы данных создается один файл для записи на диск, который находится в том же каталоге. Имя файла аналогично имени файла базы данных, но с другим расширением. Например, если клиентское приложение создает базу данных с полным путем C: \\ MyDirectory \\ мидабатасе. edb, соответствующий файл записи на диск с файлом отображения имеет значение C: \\ MyDirectory \\ мидабатасе. жфм.

В этом усовершенствовании представлены два требования к именам файлов базы данных.

  - Две базы данных в одном каталоге не должны иметь одинаковые имена файлов с разными расширениями. Например: C: \\ MyDirectory \\ мидабатасе. DB1 и C: \\ MyDirectory \\ мидабатасе. DB2.

  - 2\. База данных не должна иметь расширение жфм.

При копировании или перемещении файла базы данных вручную соответствующий файл с картой на диск должен быть также скопирован или перемещен в тот же целевой каталог. Если файл с картой записи на диск отсутствует во время нового вложения базы данных (через [жетаттачдатабасе](./jetattachdatabase-function.md), новый экземпляр будет создан и повторно заполнен по запросу по мере считывания страниц из базы данных. При смешивании несовпадающих файлов базы данных и файла сопоставлений дисковых карт подсистема ESE выполняет принудительное удаление и повторное создание несовпадающей схемы записи на диск с нуля.

Размер файла на карте записи прямо пропорционален размеру связанного файла базы данных и приблизительно равен (все размеры в байтах, результат должен округляться до следующего числа, кратного 8 192):

`8,192 + ((<database file size> / <database page size>) / 4)`

Например: для базы данных размером 1,5 ГБ, использующей размер страницы 32 КБ, приблизительный размер схемы записи на диск составляет 24 576 байт (или 24KB).

Файл отображения на диск должен быть обновлен, так как страницы базы данных сбрасываются. Если включено ведение журнала транзакций (например, [JET_paramRecovery](./transaction-log-parameters.md) задано значение "on", значение по умолчанию), обновление схемы очистки выполняется по мере внесения изменений в базу данных клиентским приложением. В среднем вся схема очистки записывается на носитель с энергонезависимым по одному разу для каждых 20% [JET_paramCheckpointDepthMax](./database-cache-parameters.md) (в байтах) создаваемых журналов транзакций. Количество операций записи зависит от того, насколько распределены изменения в пределах базы данных. Но в большинстве случаев приблизительно (все размеры в байтах):

`<flush map file size> / JET_paramMaxCoalesceWriteSize`

Если ведение журнала транзакций отключено (например, [JET_paramRecovery](./transaction-log-parameters.md) установлен в значение OFF), то схема записи на диск обновляется только один раз, когда база данных явно отсоединяется явным образом (через [жетдетачдатабасе](./jetdetachdatabase-function.md)или неявно отключается в явном виде путем завершения связанного экземпляра ESE (через любую функцию [жеттерм](./jetterm-function.md) , если [JET_bitTermDirty](./jetterm2-function.md) не передается).

1 потерянная запись (или потерянная очистка) определяется как операция записи, которая успешно возвращает данные из операционной системы в ядро базы данных ESE, но фактических данных они никогда не сохраняются в файле базы данных на носителе с энергонезависимым. Обычно это вызвано неправильной или неправильно настроенным стеком хранилища (программное обеспечение или оборудование). Клиентские приложения могут получить ошибку [JET_errReadLostFlushVerifyFailure](./extensible-storage-engine-error-codes.md) от функций ESE, требующих считывание данных из базы данных, если данные находятся в регионе, в котором произошло потеря события записи.

2 возможность обнаружения потерянных операций записи в течение всего времени существования процесса существует с момента выпуска Windows 8 (Client) и Windows Server 2012 (сервер).
