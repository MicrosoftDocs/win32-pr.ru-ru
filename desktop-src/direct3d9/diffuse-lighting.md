---
description: После настройки интенсивности света для всех эффектов затухания модуль освещения вычисляет количество оставшегося света, отражаемое от вершины, с учетом угла нормали вершины и направления падающего света.
ms.assetid: 29280a02-1c26-4b54-8468-707dd96dea1d
title: Рассеянное освещение (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f51e45093786348aaa115ec38c420acec471f718
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104139235"
---
# <a name="diffuse-lighting-direct3d-9"></a>Рассеянное освещение (Direct3D 9)

После настройки интенсивности света для всех эффектов затухания модуль освещения вычисляет количество оставшегося света, отражаемое от вершины, с учетом угла нормали вершины и направления падающего света. Модуль освещения переходит к этому этапу в случае с направленными источниками света, так как они не ослабевают с расстоянием. Система учитывает два типа отражения — рассеянное и зеркальное — и использует другую формулу для определения количества отраженного света в каждом случае. После вычисления количества отраженного света Direct3D применяет новые полученные значения к свойствам рассеянного и зеркального отражения текущего материала. Полученные значения цвета являются компонентами рассеянного и зеркального отражения, которые средство отрисовки использует для создания затенения по методу Гуро и световых бликов.

Рассеянное освещение описывается следующим уравнением.

Рассеянное освещение = сумма \[ C<sub>d</sub> \* L<sub>d</sub> \* (N<sup>.</sup> L<sub>dir</sub>) \* аттен \*\]



| Параметр       | Значение по умолчанию | Тип          | Описание                                                                                                   |
|-----------------|---------------|---------------|---------------------------------------------------------------------------------------------------------------|
| Sum             | Н/Д           | Н/Д           | Совокупность рассеянных компонентов каждого источника света.                                                                  |
| C<sub>d</sub>   | (0,0,0,0)     | D3DCOLORVALUE | Рассеянный цвет.                                                                                                |
| L<sub>d</sub>   | (0,0,0,0)     | D3DCOLORVALUE | Рассеянный цвет источника света.                                                                                          |
| Нет               | Н/Д           | D3DVECTOR     | Нормаль вершины                                                                                                 |
| L<sub>dir</sub> | Н/Д           | D3DVECTOR     | Вектор направления от вершины объекта к источнику света.                                                             |
| Atten           | Н/Д           | FLOAT         | Затухание света. См. раздел " [ослабление и прожектор" (Direct3D 9)](attenuation-and-spotlight-factor.md). |
| Немедленная оплата.            | Н/Д           | FLOAT         | Коэффициент узкой направленности света. См. раздел " [ослабление и прожектор" (Direct3D 9)](attenuation-and-spotlight-factor.md).  |



 

Значение для C<sub>d</sub> может быть следующим:

-   Вершинный color1, если ДИФФУСЕМАТЕРИАЛСАУРЦЕ = D3DMCS \_ color1, а первый цвет вершин указан в объявлении вершины.
-   Вершинный color2, если ДИФФУСЕМАТЕРИАЛСАУРЦЕ = D3DMCS \_ color2, а второй цвет вершин указан в объявлении вершины.
-   цвет рассеянного материала

> [!Note]  
> Если используется параметр ДИФФУСЕМАТЕРИАЛСАУРЦЕ и не указан цвет вершины, используется рассеянный цвет материала.

 

Сведения о вычислении затухания (Аттен) или характеристиках прожектора (точки) см. в разделе " [ослабление" и "прожектор" (Direct3D 9)](attenuation-and-spotlight-factor.md).

Рассеянные компоненты прикрепляются к диапазону от 0 до 255, после того как все источники освещения отдельно обработаны и интерполированы. Полученное значение рассеянного света представляет собой сочетание значений внешнего, рассеянного и излучаемого освещения.

## <a name="example"></a>Пример

В этом примере цвет объекта определяется рассеянным цветом источника света и рассеянным цветом материала. Код показан ниже.


```
D3DMATERIAL9 mtrl;
ZeroMemory( &mtrl, sizeof(mtrl) );

D3DLIGHT9 light;
ZeroMemory( &light, sizeof(light) );
light.Type = D3DLIGHT_DIRECTIONAL;

D3DXVECTOR3 vecDir;
vecDir = D3DXVECTOR3(0.5f, 0.0f, -0.5f);
D3DXVec3Normalize( (D3DXVECTOR3*)&light.Direction, &vecDir );

// set directional light diffuse color
light.Diffuse.r = 1.0f;
light.Diffuse.g = 1.0f;
light.Diffuse.b = 1.0f;
light.Diffuse.a = 1.0f;
m_pd3dDevice->SetLight( 0, &light );
m_pd3dDevice->LightEnable( 0, TRUE );

// if a material is used, SetRenderState must be used
// vertex color = light diffuse color * material diffuse color
mtrl.Diffuse.r = 0.75f;
mtrl.Diffuse.g = 0.0f;
mtrl.Diffuse.b = 0.0f;
mtrl.Diffuse.a = 0.0f;
m_pd3dDevice->SetMaterial( &mtrl );
m_pd3dDevice->SetRenderState(D3DRS_DIFFUSEMATERIALSOURCE, D3DMCS_MATERIAL);
```



Согласно уравнению, получившийся цвет для вершин объекта — это сочетание цвета материала и цвета света.

На двух следующих рисунках показан цвет материала (серый) и цвет света (ярко-красный).

![иллюстрация серой сферы](images/amb1.jpg)![иллюстрация красной сферы](images/lightred.jpg)

Получившаяся сцена показана на следующем рисунке. Единственный объект в сцене — сфера. Для расчета рассеянного света рассеянный цвет материала и источника света изменяется с учетом угла между направлением света и нормалью вершины при помощи скалярного произведения. В результате, тыльная сторона сфера темнеет по мере ухода изгиба сферы от источника света.

![иллюстрация сферы с рассеянным освещением](images/lightd.jpg)

При совмещении рассеянного и внешнего освещения в предыдущем примере обеспечивает затенение всей поверхности объекта. Внешнее освещение затеняет всю поверхность, а рассеянное освещение помогает раскрыть трехмерную форму объекта, как показано на следующей иллюстрации.

![иллюстрация сферы с рассеянным и внешним освещением](images/lightad.jpg)

Рассеянное освещение сложнее в расчете, чем внешнее. Поскольку оно зависит от нормалей вершин и направления света, раскрывается геометрия объекта в трехмерном пространстве, поэтому освещение становится более реалистичным, чем при использовании внешнего освещения. Вы можете использовать световые блики для получения более реалистичного вида.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Математика освещения](mathematics-of-lighting.md)
</dt> </dl>

 

 



