---
description: Приложение Direct3D обычно отображает анимированную последовательность, создавая кадры анимации в задних буферах и представляя их последовательно.
ms.assetid: 4ca9a845-f433-4d4a-939e-4b9ab2983927
title: Зеркальное отображение поверхностей (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1dafd263de0f907b33ff6f20ffcbb2cce69943da
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "103806299"
---
# <a name="flipping-surfaces-direct3d-9"></a><span data-ttu-id="b4b20-103">Зеркальное отображение поверхностей (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="b4b20-103">Flipping Surfaces (Direct3D 9)</span></span>

<span data-ttu-id="b4b20-104">Приложение Direct3D обычно отображает анимированную последовательность, создавая кадры анимации в задних буферах и представляя их последовательно.</span><span class="sxs-lookup"><span data-stu-id="b4b20-104">A Direct3D application typically displays an animated sequence by generating the frames of the animation in back buffers and presenting them in sequence.</span></span> <span data-ttu-id="b4b20-105">Задние буферы организованы в цепочки подкачки.</span><span class="sxs-lookup"><span data-stu-id="b4b20-105">Back buffers are organized into swap chains.</span></span> <span data-ttu-id="b4b20-106">Цепочка подкачки — это последовательность буферов, которые переворачиваются на экран один за другим.</span><span class="sxs-lookup"><span data-stu-id="b4b20-106">A swap chain is a series of buffers that "flip" to the screen one after another.</span></span> <span data-ttu-id="b4b20-107">Это можно использовать для отображения одной сцены в памяти и последующей перелистывания сцены на экран после завершения подготовки к просмотру.</span><span class="sxs-lookup"><span data-stu-id="b4b20-107">This can be used to render one scene in memory and then flip the scene to the screen when rendering is complete.</span></span> <span data-ttu-id="b4b20-108">Это позволяет избежать проблем, известных как разрывы, и обеспечивает более гладкую анимацию.</span><span class="sxs-lookup"><span data-stu-id="b4b20-108">This avoids the phenomenon known as tearing and allows for smoother animation.</span></span>

<span data-ttu-id="b4b20-109">Каждое устройство, созданное в Direct3D, имеет по крайней мере одну цепь подкачки.</span><span class="sxs-lookup"><span data-stu-id="b4b20-109">Each device created in Direct3D has at least one swap chain.</span></span> <span data-ttu-id="b4b20-110">При инициализации первого устройства Direct3D задается член Баккбуфферкаунт [**\_ параметров D3DPRESENT**](d3dpresent-parameters.md), который сообщает Direct3D о количестве задних буферов, которые будут находиться в цепочке подкачки.</span><span class="sxs-lookup"><span data-stu-id="b4b20-110">When you initialize the first Direct3D device, you set the BackBufferCount member of [**D3DPRESENT\_PARAMETERS**](d3dpresent-parameters.md), which tells Direct3D the number of back buffers that will be in the swap chain.</span></span> <span data-ttu-id="b4b20-111">Затем вызов [**IDirect3D9:: креатедевице**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-createdevice) создает устройство Direct3D и соответствующую цепочку подкачки.</span><span class="sxs-lookup"><span data-stu-id="b4b20-111">The call to [**IDirect3D9::CreateDevice**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-createdevice) then creates the Direct3D device and corresponding swap chain.</span></span>

<span data-ttu-id="b4b20-112">При использовании [**IDirect3DDevice9::P**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-present) отправку для запроса операции отражения поверхности, указатели на память поверхности для переднего буфера и задние буферы меняются местами.</span><span class="sxs-lookup"><span data-stu-id="b4b20-112">When you use [**IDirect3DDevice9::Present**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-present) to request a surface flip operation, the pointers to surface memory for the front buffer and back buffers are swapped.</span></span> <span data-ttu-id="b4b20-113">Зеркальное отображение выполняется путем переключения указателей, которые устройство отображения использует для ссылки на память, а не копирует память поверхности.</span><span class="sxs-lookup"><span data-stu-id="b4b20-113">Flipping is performed by switching pointers that the display device uses for referencing memory, not by copying surface memory.</span></span> <span data-ttu-id="b4b20-114">Если цепочка зеркального отображения содержит передний буфер и несколько задних буферов, указатели переключаются в циклической схеме, как показано на следующей диаграмме.</span><span class="sxs-lookup"><span data-stu-id="b4b20-114">When a flipping chain contains a front buffer and more than one back buffer, the pointers are switched in a circular pattern, as shown in the following diagram.</span></span>

![Схема зеркальной цепочки с передним буфером и двумя задними буферами](images/trplflip.png)

<span data-ttu-id="b4b20-116">Вы можете создать цепочки переменного сложения для устройства, вызвав [**IDirect3DDevice9:: креатеаддитионалсвапчаин**](/windows/desktop/api).</span><span class="sxs-lookup"><span data-stu-id="b4b20-116">You can create addition swap chains for a device by calling [**IDirect3DDevice9::CreateAdditionalSwapChain**](/windows/desktop/api).</span></span> <span data-ttu-id="b4b20-117">Приложение может создать одну цепочку подкачки для каждого представления и связать каждую цепочку подкачки с определенным окном.</span><span class="sxs-lookup"><span data-stu-id="b4b20-117">An application can create one swap chain per view and associate each swap chain with a particular window.</span></span> <span data-ttu-id="b4b20-118">Приложение визуализирует изображения в задних буферах каждой цепочки буферов, а затем представляет их по отдельности.</span><span class="sxs-lookup"><span data-stu-id="b4b20-118">The application renders images in the back buffers of each swap chain, and then presents them individually.</span></span> <span data-ttu-id="b4b20-119">Два параметра, **IDirect3DDevice9:: креатеаддитионалсвапчаин** , принимают в качестве указателя на структуру [**\_ параметров D3DPRESENT**](d3dpresent-parameters.md) и адрес указателя на интерфейс [**IDirect3DSwapChain9**](/windows/desktop/api) .</span><span class="sxs-lookup"><span data-stu-id="b4b20-119">The two parameters that **IDirect3DDevice9::CreateAdditionalSwapChain** takes are a pointer to a [**D3DPRESENT\_PARAMETERS**](d3dpresent-parameters.md) structure and the address of a pointer to an [**IDirect3DSwapChain9**](/windows/desktop/api) interface.</span></span> <span data-ttu-id="b4b20-120">Затем можно использовать [**IDirect3DSwapChain9::P**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dswapchain9-present) повторно отправить, чтобы отобразить содержимое следующего заднего буфера в интерфейсном буфере.</span><span class="sxs-lookup"><span data-stu-id="b4b20-120">You can then use [**IDirect3DSwapChain9::Present**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dswapchain9-present) to display the contents of the next back buffer to the front buffer.</span></span> <span data-ttu-id="b4b20-121">Обратите внимание, что устройство может иметь только одну цепочку полноэкранного подкачки.</span><span class="sxs-lookup"><span data-stu-id="b4b20-121">Note that a device can only have one full-screen swap chain.</span></span>

<span data-ttu-id="b4b20-122">Доступ к конкретному буферу можно получить, вызвав методы [**IDirect3DDevice9:: жетбаккбуффер**](/windows/desktop/api) или [**IDirect3DSwapChain9:: жетбаккбуффер**](/windows/desktop/api) , которые возвращают указатель на интерфейс [**IDirect3DSurface9**](/windows/desktop/api) , представляющий возвращаемую поверхность заднего буфера.</span><span class="sxs-lookup"><span data-stu-id="b4b20-122">You can gain access to a specific back buffer by calling the [**IDirect3DDevice9::GetBackBuffer**](/windows/desktop/api) or [**IDirect3DSwapChain9::GetBackBuffer**](/windows/desktop/api) methods, which return a pointer to an [**IDirect3DSurface9**](/windows/desktop/api) interface that represents the returned back buffer surface.</span></span> <span data-ttu-id="b4b20-123">Обратите внимание, что вызов этого метода увеличивает внутренний счетчик ссылок в интерфейсе [**IDirect3DDevice9**](/windows/desktop/api) , поэтому необходимо вызвать [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) , когда вы завершите работу с этой областью, или у вас будет утечка памяти.</span><span class="sxs-lookup"><span data-stu-id="b4b20-123">Note that calling this method increases the internal reference count on the [**IDirect3DDevice9**](/windows/desktop/api) interface so be sure to call [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) when you are done using this surface or you will have a memory leak.</span></span>

<span data-ttu-id="b4b20-124">Помните, что Direct3D переворачивает поверхности путем переключения указателей памяти поверхности в цепочке буферов, а не самих поверхностей.</span><span class="sxs-lookup"><span data-stu-id="b4b20-124">Remember, Direct3D flips surfaces by swapping surface memory pointers within the swap chain, not by swapping the surfaces themselves.</span></span> <span data-ttu-id="b4b20-125">Это означает, что вы всегда будете отрисовываться в обратном буфере, который будет отображаться далее.</span><span class="sxs-lookup"><span data-stu-id="b4b20-125">This means that you will always render to the back buffer that will be displayed next.</span></span>

<span data-ttu-id="b4b20-126">Важно отметить различие между «операциями зеркального отображения», выполняемой драйвером видеоадаптера, и операцией «Present», применяемой к цепочке буфера обмена, созданной с помощью D3DSWAPEFFECT \_ reпереворот.</span><span class="sxs-lookup"><span data-stu-id="b4b20-126">It is important to note the distinction between a "flipping operation," as performed by a display adapter driver, and a "Present" operation applied to a swap chain created with D3DSWAPEFFECT\_FLIP.</span></span>

<span data-ttu-id="b4b20-127">Термин "перелистывание" означает операцию, которая изменяет диапазон адресов видеопамяти, используемый видеоадаптером для формирования выходного сигнала, что приводит к отображению содержимого ранее скрытого заднего буфера.</span><span class="sxs-lookup"><span data-stu-id="b4b20-127">The term "flip" conventionally denotes an operation that alters the range of video memory addresses that a display adapter uses to generate its output signal, thus causing the contents of a previously hidden back buffer to be displayed.</span></span> <span data-ttu-id="b4b20-128">В Direct3D 9 термин часто используется для описания представления заднего буфера в любой цепочке буферов, созданной с помощью D3DSWAPEFFECT \_ отражения.</span><span class="sxs-lookup"><span data-stu-id="b4b20-128">In Direct3D 9, the term is often used more generally to describe the presentation of a back buffer in any swap chain created with the D3DSWAPEFFECT\_FLIP swap effect.</span></span>

<span data-ttu-id="b4b20-129">Хотя такие операции "Present" почти неизменно реализуются с помощью операций отражения, когда цепочка подкачки является полноэкранной, они обязательно реализуются с помощью операций копирования, когда цепочка буферов перемещается в окно.</span><span class="sxs-lookup"><span data-stu-id="b4b20-129">While such "Present" operations are almost invariably implemented by flip operations when the swap chain is a full-screen one, they are necessarily implemented by copy operations when the swap chain is windowed.</span></span> <span data-ttu-id="b4b20-130">Кроме того, драйвер видеоадаптера может использовать зеркальное отображение для реализации существующих операций с цепочками полноэкранного переключения на основе D3DSWAPEFFECT \_ Discard и D3DSWAPEFFECT \_ Copy.</span><span class="sxs-lookup"><span data-stu-id="b4b20-130">Furthermore, a display adapter driver may use flipping to implement Present operations against full-screen swap chains based on the D3DSWAPEFFECT\_DISCARD and D3DSWAPEFFECT\_COPY.</span></span>

<span data-ttu-id="b4b20-131">Приведенное выше обсуждение применяется к часто используемым вариантам цепочки полноэкранного буфера, созданной с помощью D3DSWAPEFFECT \_ reпереворот.</span><span class="sxs-lookup"><span data-stu-id="b4b20-131">The discussion above applies to the commonly used case of a full-screen swap chain created with D3DSWAPEFFECT\_FLIP.</span></span>

<span data-ttu-id="b4b20-132">Более общее описание различных эффектов переключения для оконных и полноэкранных цепочек переключения см. в разделе [**D3DSWAPEFFECT**](./d3dswapeffect.md).</span><span class="sxs-lookup"><span data-stu-id="b4b20-132">For a more general discussion of the different swap effects for both windowed and full-screen swap chains, see [**D3DSWAPEFFECT**](./d3dswapeffect.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="b4b20-133">См. также</span><span class="sxs-lookup"><span data-stu-id="b4b20-133">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b4b20-134">Поверхности Direct3D</span><span class="sxs-lookup"><span data-stu-id="b4b20-134">Direct3D Surfaces</span></span>](direct3d-surfaces.md)
</dt> </dl>

 

 
