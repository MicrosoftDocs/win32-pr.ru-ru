---
description: Индексные буферы, представленные интерфейсом IDirect3DIndexBuffer9, представляют собой буферы памяти, содержащие индексные данные.
ms.assetid: baa60cd1-a1f0-4dbe-b934-aeb1a5c6b784
title: Буферы индексов (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7151fae6deb72a0c569d269c80e5b13bf946f9d0
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "103894317"
---
# <a name="index-buffers-direct3d-9"></a><span data-ttu-id="7603d-103">Буферы индексов (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="7603d-103">Index Buffers (Direct3D 9)</span></span>

<span data-ttu-id="7603d-104">Индексные буферы, представленные интерфейсом [**IDirect3DIndexBuffer9**](/windows/win32/api/d3d9helper/nn-d3d9helper-idirect3dindexbuffer9) , представляют собой буферы памяти, содержащие индексные данные.</span><span class="sxs-lookup"><span data-stu-id="7603d-104">Index buffers, represented by the [**IDirect3DIndexBuffer9**](/windows/win32/api/d3d9helper/nn-d3d9helper-idirect3dindexbuffer9) interface, are memory buffers that contain index data.</span></span> <span data-ttu-id="7603d-105">Индексные данные (или индексы) являются целочисленными смещениями в буферах вершин и используются для отрисовки примитивов с помощью метода [**IDirect3DDevice9::D равиндекседпримитиве**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawindexedprimitive) .</span><span class="sxs-lookup"><span data-stu-id="7603d-105">Index data, or indices, are integer offsets into vertex buffers and are used to render primitives using the [**IDirect3DDevice9::DrawIndexedPrimitive**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawindexedprimitive) method.</span></span>

<span data-ttu-id="7603d-106">Буфер вершин содержит вершины; соответственно, можно рисовать буферы вершин с помощью индексированных примитивов и без них.</span><span class="sxs-lookup"><span data-stu-id="7603d-106">A vertex buffer contains vertices; therefore, you can draw a vertex buffer either with or without indexed primitives.</span></span> <span data-ttu-id="7603d-107">Однако, поскольку буфер индексов содержит индексы, невозможно использовать буфер индексов без соответствующего буфера вершин.</span><span class="sxs-lookup"><span data-stu-id="7603d-107">However, because an index buffer contains indices, you cannot use an index buffer without a corresponding vertex buffer.</span></span> <span data-ttu-id="7603d-108">(В качестве побочной заметки [**IDirect3DDevice9::D равиндекседпримитивеуп**](/windows/desktop/api) и [**IDirect3DDevice9::D равпримитивеуп**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawprimitiveup) — это единственные методы рисования, которые рисуются без индекса или буфера вершин.)</span><span class="sxs-lookup"><span data-stu-id="7603d-108">(As a side note, [**IDirect3DDevice9::DrawIndexedPrimitiveUP**](/windows/desktop/api) and [**IDirect3DDevice9::DrawPrimitiveUP**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawprimitiveup) are the only draw methods that draw without an index or a vertex buffer.)</span></span>

## <a name="index-buffer-description"></a><span data-ttu-id="7603d-109">Описание буфера индексов</span><span class="sxs-lookup"><span data-stu-id="7603d-109">Index Buffer Description</span></span>

<span data-ttu-id="7603d-110">Буфер индексов описывается с рассмотрением его возможностей: где он находится в памяти, поддерживает ли он чтение и запись, тип и число индексов, которые он может содержать.</span><span class="sxs-lookup"><span data-stu-id="7603d-110">An index buffer is described in terms of its capabilities, such as where it exists in memory, whether it supports reading and writing, and the type and number of indices it can contain.</span></span> <span data-ttu-id="7603d-111">Эти признаки хранятся в структуре [**D3DINDEXBUFFER \_ DESC**](d3dindexbuffer-desc.md) .</span><span class="sxs-lookup"><span data-stu-id="7603d-111">These traits are held in a [**D3DINDEXBUFFER\_DESC**](d3dindexbuffer-desc.md) structure.</span></span>

<span data-ttu-id="7603d-112">Описания буферов индексов сообщают приложению, как был создан существующий буфер.</span><span class="sxs-lookup"><span data-stu-id="7603d-112">Index buffer descriptions tell your application how an existing buffer was created.</span></span> <span data-ttu-id="7603d-113">Вы предоставляете пустую конструкцию для описания, которую система заполняет перечислением возможностей ранее созданного буфера индексов.</span><span class="sxs-lookup"><span data-stu-id="7603d-113">You provide an empty description structure for the system to fill with the capabilities of a previously created index buffer.</span></span>

-   <span data-ttu-id="7603d-114">Элемент Format описывает формат поверхности данных буфера индекса.</span><span class="sxs-lookup"><span data-stu-id="7603d-114">The Format member describes the surface format of the index buffer data.</span></span>
-   <span data-ttu-id="7603d-115">Тип определяет тип ресурса буфера индекса.</span><span class="sxs-lookup"><span data-stu-id="7603d-115">The Type identifies the resource type of the index buffer.</span></span>
-   <span data-ttu-id="7603d-116">Член структуры использования содержит общие флаги возможностей.</span><span class="sxs-lookup"><span data-stu-id="7603d-116">The Usage structure member contains general capability flags.</span></span> <span data-ttu-id="7603d-117">Флаг D3DUSAGE \_ софтварепроцессинг указывает, что буфер индексов используется для обработки вершин программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="7603d-117">The D3DUSAGE\_SOFTWAREPROCESSING flag indicates that the index buffer is to be used with software vertex processing.</span></span> <span data-ttu-id="7603d-118">Наличие \_ флага D3DUSAGE WRITEONLY в использовании указывает на то, что память буфера индекса используется только для операций записи.</span><span class="sxs-lookup"><span data-stu-id="7603d-118">The presence of the D3DUSAGE\_WRITEONLY flag in Usage indicates that the index buffer memory is used only for write operations.</span></span> <span data-ttu-id="7603d-119">Это освобождает драйвер для размещения данных индекса в оптимальном расположении в памяти для быстрой обработки и подготовки к просмотру.</span><span class="sxs-lookup"><span data-stu-id="7603d-119">This frees the driver to place the index data in the best memory location to enable fast processing and rendering.</span></span> <span data-ttu-id="7603d-120">Если флаг D3DUSAGE \_ WRITEONLY не используется, драйвер, скорее всего, поместит данные в расположение, неэффективное для операций чтения.</span><span class="sxs-lookup"><span data-stu-id="7603d-120">If the D3DUSAGE\_WRITEONLY flag is not used, the driver is less likely to put the data in a location that is inefficient for read operations.</span></span> <span data-ttu-id="7603d-121">Это пожертвует некоторую скорость обработки и отрисовки.</span><span class="sxs-lookup"><span data-stu-id="7603d-121">This sacrifices some processing and rendering speed.</span></span> <span data-ttu-id="7603d-122">Если этот флаг не указан, то предполагается, что приложения выполняют операции чтения и записи данных в буфере индекса.</span><span class="sxs-lookup"><span data-stu-id="7603d-122">If this flag is not specified, it is assumed that applications perform read and write operations on the data in the index buffer.</span></span>
-   <span data-ttu-id="7603d-123">Pool указывает класс памяти, выделенный для буфера индекса.</span><span class="sxs-lookup"><span data-stu-id="7603d-123">Pool specifies the memory class allocated for the index buffer.</span></span> <span data-ttu-id="7603d-124">Флаг D3DPOOL \_ системмем указывает, что система создала буфер индексов в системной памяти.</span><span class="sxs-lookup"><span data-stu-id="7603d-124">The D3DPOOL\_SYSTEMMEM flag indicates that the system created the index buffer in system memory.</span></span>
-   <span data-ttu-id="7603d-125">Элемент size сохраняет размер данных буфера вершин в байтах.</span><span class="sxs-lookup"><span data-stu-id="7603d-125">The Size member stores the size, in bytes, of the vertex buffer data.</span></span>
-   <span data-ttu-id="7603d-126">Последний параметр Пшаредхандле не используется.</span><span class="sxs-lookup"><span data-stu-id="7603d-126">The last parameter pSharedHandle is not used.</span></span> <span data-ttu-id="7603d-127">Задайте для него **значение NULL**.</span><span class="sxs-lookup"><span data-stu-id="7603d-127">Set it to **NULL**.</span></span>

## <a name="index-processing-requirements"></a><span data-ttu-id="7603d-128">Требования к обработке индексов</span><span class="sxs-lookup"><span data-stu-id="7603d-128">Index Processing Requirements</span></span>

<span data-ttu-id="7603d-129">Производительность операций обработки индексов сильно зависит от расположения буфера индексов в памяти и от типа используемого устройства отрисовки.</span><span class="sxs-lookup"><span data-stu-id="7603d-129">The performance of index processing operations depends heavily on where the index buffer exists in memory and what type of rendering device is being used.</span></span> <span data-ttu-id="7603d-130">Приложения управляют выделением памяти для буферов индексов при их создании.</span><span class="sxs-lookup"><span data-stu-id="7603d-130">Applications control the memory allocation for index buffers when they are created.</span></span> <span data-ttu-id="7603d-131">Если \_ установлен флаг D3DPOOL системмем Memory, буфер индекса создается в системной памяти.</span><span class="sxs-lookup"><span data-stu-id="7603d-131">When the D3DPOOL\_SYSTEMMEM memory flag is set, the index buffer is created in system memory.</span></span> <span data-ttu-id="7603d-132">При \_ использовании флага памяти D3DPOOL по умолчанию драйвер устройства определяет, где лучше всего выделяется память для буфера индекса, часто называемую оптимальным для драйвера памятью.</span><span class="sxs-lookup"><span data-stu-id="7603d-132">When the D3DPOOL\_DEFAULT memory flag is used, the device driver determines where the memory for the index buffer is best allocated, often referred to as driver-optimal memory.</span></span> <span data-ttu-id="7603d-133">Оптимальным для драйвера памятью может быть локальная видеопамять, Нелокальная видеопамять или системная память.</span><span class="sxs-lookup"><span data-stu-id="7603d-133">Driver-optimal memory can be local video memory, non-local video memory, or system memory.</span></span>

<span data-ttu-id="7603d-134">Установка \_ флага поведения D3DUSAGE софтварепроцессинг при вызове метода [**IDirect3DDevice9:: креатеиндексбуффер**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createindexbuffer) указывает, что буфер индекса должен использоваться с программной обработкой вершин.</span><span class="sxs-lookup"><span data-stu-id="7603d-134">Setting the D3DUSAGE\_SOFTWAREPROCESSING behavior flag when calling the [**IDirect3DDevice9::CreateIndexBuffer**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createindexbuffer) method specifies that the index buffer is to be used with software vertex processing.</span></span> <span data-ttu-id="7603d-135">Этот флаг необходим для обработки вершин в смешанном режиме (D3DCREATE \_ Mixed \_ вертекспроцессинг) при использовании обработки вершин программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="7603d-135">This flag is required in mixed mode vertex processing (D3DCREATE\_MIXED\_VERTEXPROCESSING) when software vertex processing is used.</span></span>

<span data-ttu-id="7603d-136">Приложение может записывать индексы непосредственно в буфер индексов, выделенный в оптимальном для драйвера участке памяти.</span><span class="sxs-lookup"><span data-stu-id="7603d-136">The application can directly write indices to a index buffer allocated in driver-optimal memory.</span></span> <span data-ttu-id="7603d-137">Этот метод предотвращает избыточную операцию копирования на более позднем этапе.</span><span class="sxs-lookup"><span data-stu-id="7603d-137">This technique prevents a redundant copy operation later.</span></span> <span data-ttu-id="7603d-138">Этот прием оказывается менее полезен, если приложение снова считывает данные из буфера индексов, поскольку операции чтения, выполняемые хостом из оптимального для драйвера участка памяти, могут проходить очень медленно.</span><span class="sxs-lookup"><span data-stu-id="7603d-138">This technique does not work well if your application reads data back from an index buffer, because read operations done by the host from driver-optimal memory can be very slow.</span></span> <span data-ttu-id="7603d-139">Таким образом, если приложению необходимо выполнять чтение данных во время обработки или выполнять беспорядочную запись данных в буфер, размещение буфера индексов в памяти системы может стать оптимальным вариантом.</span><span class="sxs-lookup"><span data-stu-id="7603d-139">Therefore, if your application needs to read during processing or writes data to the buffer erratically, a system-memory index buffer is a better choice.</span></span>

> [!Note]  
> <span data-ttu-id="7603d-140">Всегда используйте D3DPOOL \_ по умолчанию, за исключением случаев, когда вы не хотите использовать видеопамять или большие объемы памяти, заблокированной страничным каналом, когда драйвер помещает буферы вершин или индексы в память AGP.</span><span class="sxs-lookup"><span data-stu-id="7603d-140">Always use D3DPOOL\_DEFAULT, except when you don't want to use video memory or use large amounts of page-locked RAM when the driver is putting vertex or index buffers into AGP memory.</span></span>

 

## <a name="create-an-index-buffer"></a><span data-ttu-id="7603d-141">Создание буфера индекса</span><span class="sxs-lookup"><span data-stu-id="7603d-141">Create an Index Buffer</span></span>

<span data-ttu-id="7603d-142">Создайте объект буфера индекса, вызвав метод [**IDirect3DDevice9:: креатеиндексбуффер**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createindexbuffer) , который принимает шесть параметров.</span><span class="sxs-lookup"><span data-stu-id="7603d-142">Create an index buffer object by calling the [**IDirect3DDevice9::CreateIndexBuffer**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createindexbuffer) method, which accepts six parameters.</span></span>

-   <span data-ttu-id="7603d-143">Первый параметр указывает длину буфера индекса в байтах.</span><span class="sxs-lookup"><span data-stu-id="7603d-143">The first parameter specifies the index buffer length, in bytes.</span></span>
-   <span data-ttu-id="7603d-144">Второй параметр — это набор элементов управления использованием.</span><span class="sxs-lookup"><span data-stu-id="7603d-144">The second parameter is a set of usage controls.</span></span> <span data-ttu-id="7603d-145">Помимо прочего, его значение определяет, могут ли вершины, на которые ссылаются индексы, содержать сведения об обрезке.</span><span class="sxs-lookup"><span data-stu-id="7603d-145">Among other things, its value determines whether the vertices being referred to by the indices are capable of containing clipping information.</span></span> <span data-ttu-id="7603d-146">Чтобы повысить производительность, укажите D3DUSAGE \_ донотклип, когда отсечение не требуется.</span><span class="sxs-lookup"><span data-stu-id="7603d-146">To improve performance, specify D3DUSAGE\_DONOTCLIP when clipping is not required.</span></span>

    <span data-ttu-id="7603d-147">Флаг D3DUSAGE \_ софтварепроцессинг можно задать при обработке вершин в смешанном режиме или на уровне программного обеспечения (D3DCREATE \_ Mixed \_ вертекспроцессинг/D3DCREATE \_ Software \_ вертекспроцессинг) для этого устройства включена.</span><span class="sxs-lookup"><span data-stu-id="7603d-147">The D3DUSAGE\_SOFTWAREPROCESSING flag can be set when mixed-mode or software vertex processing (D3DCREATE\_MIXED\_VERTEXPROCESSING / D3DCREATE\_SOFTWARE\_VERTEXPROCESSING) is enabled for that device.</span></span> <span data-ttu-id="7603d-148">D3DUSAGE \_ софтварепроцессинг должен быть установлен для использования буферов с обработкой вершин программного обеспечения в смешанном режиме, но не должен быть установлен для наилучшей производительности при использовании аппаратной обработки индекса в смешанном режиме (D3DCREATE \_ Hardware \_ вертекспроцессинг).</span><span class="sxs-lookup"><span data-stu-id="7603d-148">D3DUSAGE\_SOFTWAREPROCESSING must be set for buffers to be used with software vertex processing in mixed mode, but it should not be set for the best possible performance when using hardware index processing in mixed mode (D3DCREATE\_HARDWARE\_VERTEXPROCESSING).</span></span> <span data-ttu-id="7603d-149">Однако параметр D3DUSAGE \_ софтварепроцессинг является единственным, если один буфер используется одновременно с аппаратной и программной обработкой вершин.</span><span class="sxs-lookup"><span data-stu-id="7603d-149">However, setting D3DUSAGE\_SOFTWAREPROCESSING is the only option when a single buffer is used with both hardware and software vertex processing.</span></span> <span data-ttu-id="7603d-150">D3DUSAGE \_ софтварепроцессинг разрешен для смешанных и программных устройств.</span><span class="sxs-lookup"><span data-stu-id="7603d-150">D3DUSAGE\_SOFTWAREPROCESSING is allowed for mixed and software devices.</span></span>

    <span data-ttu-id="7603d-151">Можно принудительно использовать буферы вершин и индексов в системной памяти, указав D3DPOOL \_ системмем, даже если обработка индекса выполняется в оборудовании.</span><span class="sxs-lookup"><span data-stu-id="7603d-151">It is possible to force vertex and index buffers into system memory by specifying D3DPOOL\_SYSTEMMEM, even when the index processing is being done in hardware.</span></span> <span data-ttu-id="7603d-152">Это способ избежать чрезмерно больших объемов памяти, заблокированных страницей, когда драйвер помещает эти буферы в память AGP.</span><span class="sxs-lookup"><span data-stu-id="7603d-152">This is a way to avoid overly large amounts of page-locked memory when a driver is putting these buffers into AGP memory.</span></span>

-   <span data-ttu-id="7603d-153">Третьим параметром является либо D3DFMT \_ INDEX16, либо D3DFMT \_ INDEX32 в перечислимом типе [D3DFORMAT](d3dformat.md) , который указывает размер каждого индекса.</span><span class="sxs-lookup"><span data-stu-id="7603d-153">The third parameter is either the D3DFMT\_INDEX16 or D3DFMT\_INDEX32 member of the [D3DFORMAT](d3dformat.md) enumerated type that specifies the size of each index.</span></span>

-   <span data-ttu-id="7603d-154">Четвертый параметр является членом перечислимого типа [**D3DPOOL**](./d3dpool.md) , который указывает системе, где в памяти следует разместить новый буфер индекса.</span><span class="sxs-lookup"><span data-stu-id="7603d-154">The fourth parameter is a member of the [**D3DPOOL**](./d3dpool.md) enumerated type that tells the system where in memory to place the new index buffer.</span></span>

-   <span data-ttu-id="7603d-155">Последний параметр, который [**IDirect3DDevice9:: креатеиндексбуффер**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createindexbuffer) принимает, является адресом переменной, которая заполнена указателем на новый интерфейс [**IDirect3DIndexBuffer9**](/windows/win32/api/d3d9helper/nn-d3d9helper-idirect3dindexbuffer9) объекта buffer вершин, если вызов завершается с ошибкой.</span><span class="sxs-lookup"><span data-stu-id="7603d-155">The final parameter that [**IDirect3DDevice9::CreateIndexBuffer**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createindexbuffer) accepts is the address of a variable that is filled with a pointer to the new [**IDirect3DIndexBuffer9**](/windows/win32/api/d3d9helper/nn-d3d9helper-idirect3dindexbuffer9) interface of the vertex buffer object, if the call succeeds.</span></span>

<span data-ttu-id="7603d-156">В следующем примере кода C++ показано, что создание буфера индекса может выглядеть в коде.</span><span class="sxs-lookup"><span data-stu-id="7603d-156">The following C++ code example shows what creating an index buffer might look like in code.</span></span>


```
/*
 * For the purposes of this example, the d3dDevice variable is the 
 * address of an IDirect3DDevice9 interface exposed by a 
 * Direct3DDevice object, g_IB is a variable of type 
 * LPDIRECT3DINDEXBUFFER9.
 */

if( FAILED( d3dDevice->CreateIndexBuffer( 16384 *sizeof(WORD),
           D3DUSAGE_WRITEONLY, D3DFMT_INDEX16, D3DPOOL_DEFAULT, 
           &g_IB, NULL ) ) )
    return E_FAIL;
```



## <a name="access-an-index-buffer"></a><span data-ttu-id="7603d-157">Доступ к буферу индекса</span><span class="sxs-lookup"><span data-stu-id="7603d-157">Access an Index Buffer</span></span>

<span data-ttu-id="7603d-158">Объекты буфера индексов позволяют приложениям напрямую обращаться к памяти, выделенной для данных индекса.</span><span class="sxs-lookup"><span data-stu-id="7603d-158">Index buffer objects enable applications to directly access the memory allocated for index data.</span></span> <span data-ttu-id="7603d-159">Можно получить указатель на буферную память буфера путем вызова метода [**IDirect3DIndexBuffer9:: Lock**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dindexbuffer9-lock) , а затем получить доступ к памяти по мере необходимости для заполнения буфера новыми данными индекса или для чтения содержащихся в нем данных.</span><span class="sxs-lookup"><span data-stu-id="7603d-159">You can retrieve a pointer to index buffer memory by calling the [**IDirect3DIndexBuffer9::Lock**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dindexbuffer9-lock) method, and then accessing the memory as needed to fill the buffer with new index data or to read any data it contains.</span></span> <span data-ttu-id="7603d-160">Метод Lock принимает четыре параметра.</span><span class="sxs-lookup"><span data-stu-id="7603d-160">The Lock method accepts four parameters.</span></span> <span data-ttu-id="7603d-161">Первый, *оффсеттолокк*, является смещением данных индекса.</span><span class="sxs-lookup"><span data-stu-id="7603d-161">The first, *OffsetToLock*, is the offset into the index data.</span></span> <span data-ttu-id="7603d-162">Второй параметр — это размер данных индекса, измеряемый в байтах.</span><span class="sxs-lookup"><span data-stu-id="7603d-162">The second parameter is the size, measured in bytes, of the index data.</span></span> <span data-ttu-id="7603d-163">Третьим параметром, принятым методом **IDirect3DIndexBuffer9:: Lock** , *ппбдата*, является адрес указателя байта, заполненного указателем на данные индекса, если вызов выполнен.</span><span class="sxs-lookup"><span data-stu-id="7603d-163">The third parameter accepted by the **IDirect3DIndexBuffer9::Lock** method, *ppbData*, is the address of a BYTE pointer filled with a pointer to the index data, if the call succeeds.</span></span>

<span data-ttu-id="7603d-164">Последний параметр, *Флаги* сообщает системе о том, как должна быть заблокирована память.</span><span class="sxs-lookup"><span data-stu-id="7603d-164">The last parameter, *Flags*, tells the system how the memory should be locked.</span></span> <span data-ttu-id="7603d-165">Его можно использовать для указания того, как приложение обращается к данным в буфере.</span><span class="sxs-lookup"><span data-stu-id="7603d-165">You can use it to indicate how the application accesses the data in the buffer.</span></span> <span data-ttu-id="7603d-166">Укажите константы для параметра *flags* в соответствии с тем, как приложение будет получать доступ к данным индекса.</span><span class="sxs-lookup"><span data-stu-id="7603d-166">Specify constants for the *Flags* parameter according to the way the index data will be accessed by your application.</span></span> <span data-ttu-id="7603d-167">Это позволяет драйверу заблокировать память и обеспечить максимальную производительность, исходя из требуемого типа доступа.</span><span class="sxs-lookup"><span data-stu-id="7603d-167">This allows the driver to lock the memory and provide the best performance given the requested access type.</span></span> <span data-ttu-id="7603d-168">Используйте \_ флаг D3DLOCK ReadOnly, если приложение будет считывать только из буферной памяти индекса.</span><span class="sxs-lookup"><span data-stu-id="7603d-168">Use D3DLOCK\_READONLY flag if your application will read only from the index buffer memory.</span></span> <span data-ttu-id="7603d-169">Включение этого флага позволяет Direct3D оптимизировать свои внутренние процедуры для повышения эффективности, учитывая, что доступ к памяти будет доступен только для чтения.</span><span class="sxs-lookup"><span data-stu-id="7603d-169">Including this flag enables Direct3D to optimize its internal procedures to improve efficiency, given that access to the memory will be read-only.</span></span>

<span data-ttu-id="7603d-170">После заполнения или считывания данных индекса вызовите метод [**IDirect3DIndexBuffer9:: Unlock**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dindexbuffer9-unlock) , как показано в следующем примере кода.</span><span class="sxs-lookup"><span data-stu-id="7603d-170">After you fill or read the index data, call the [**IDirect3DIndexBuffer9::Unlock**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dindexbuffer9-unlock) method, as shown in the following code example.</span></span>


```
// This code example assumes the m_pIndexBuffer is a variable of type 
// LPDIRECT3DINDEXBUFFER9 and that g_Indices has been properly 
// initialized with indices.

// To fill the index buffer, you must lock the buffer to gain 
// access to the indices. This mechanism is required because index
// buffers may be in device memory.

VOID* pIndices;

if( FAILED( m_pIndexBuffer->Lock( 
      0,                 // Fill from start of the buffer
      sizeof(g_Indices), // Size of the data to load
      BYTE**)&pIndices,  // Returned index data
      0 ) ) )            // Send default flags to the lock
{
    SAFE_RELEASE(m_pIndexBuffer);
    return E_FAIL;
}

memcpy( pIndices, g_Indices, sizeof(g_Indices) );
m_pIndexBuffer->Unlock();
```



> [!Note]
>
> <span data-ttu-id="7603d-171">Если вы создаете буфер индекса с \_ флагом D3DUSAGE WRITEONLY, не используйте \_ флаг блокировки D3DLOCK ReadOnly.</span><span class="sxs-lookup"><span data-stu-id="7603d-171">If you create an index buffer with the D3DUSAGE\_WRITEONLY flag, do not use the D3DLOCK\_READONLY locking flag.</span></span> <span data-ttu-id="7603d-172">Используйте флаг D3DLOCK \_ ReadOnly, если приложение будет считывать только из буферной памяти индекса.</span><span class="sxs-lookup"><span data-stu-id="7603d-172">Use the D3DLOCK\_READONLY flag if your application will read only from the index buffer memory.</span></span> <span data-ttu-id="7603d-173">Включение этого флага позволяет Direct3D оптимизировать свои внутренние процедуры для повышения эффективности, учитывая, что доступ к памяти будет доступен только для чтения.</span><span class="sxs-lookup"><span data-stu-id="7603d-173">Including this flag enables Direct3D to optimize its internal procedures to improve efficiency, given that access to the memory will be read-only.</span></span>
>
> <span data-ttu-id="7603d-174">Сведения об использовании D3DLOCK \_ Discard или D3DLOCK \_ нуверврите для параметра *flags* метода [**IDirect3DIndexBuffer9:: Lock**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dindexbuffer9-lock) см. в разделе [Оптимизация производительности (Direct3D 9)](performance-optimizations.md).</span><span class="sxs-lookup"><span data-stu-id="7603d-174">For information about using D3DLOCK\_DISCARD or D3DLOCK\_NOOVERWRITE for the *Flags* parameter of the [**IDirect3DIndexBuffer9::Lock**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dindexbuffer9-lock) method, see [Performance Optimizations (Direct3D 9)](performance-optimizations.md).</span></span>

 

<span data-ttu-id="7603d-175">В C++, так как вы напрямую обращаетесь к памяти, выделенной для буфера индекса, убедитесь, что приложение правильно обращается к выделенной памяти.</span><span class="sxs-lookup"><span data-stu-id="7603d-175">In C++, because you directly access the memory allocated for the index buffer, make sure your application properly accesses the allocated memory.</span></span> <span data-ttu-id="7603d-176">В противном случае вы рискуете выявление недействительной памяти.</span><span class="sxs-lookup"><span data-stu-id="7603d-176">Otherwise, you risk rendering that memory invalid.</span></span> <span data-ttu-id="7603d-177">Используйте индекс формата индекса, используемого приложением для перехода от одного индекса в выделенном буфере к другому.</span><span class="sxs-lookup"><span data-stu-id="7603d-177">Use the stride of the index format your application uses to move from one index in the allocated buffer to another.</span></span>

<span data-ttu-id="7603d-178">Получите сведения о буфере индекса, вызвав метод [**IDirect3DIndexBuffer9:: DESC**](/windows/desktop/api) .</span><span class="sxs-lookup"><span data-stu-id="7603d-178">Retrieve information about an index buffer by calling the [**IDirect3DIndexBuffer9::GetDesc**](/windows/desktop/api) method.</span></span> <span data-ttu-id="7603d-179">Этот метод заполняет члены структуры [**D3DINDEXBUFFER \_ DESC**](d3dindexbuffer-desc.md) сведениями о буфере индекса.</span><span class="sxs-lookup"><span data-stu-id="7603d-179">This method fills the members of the [**D3DINDEXBUFFER\_DESC**](d3dindexbuffer-desc.md) structure with information about the index buffer.</span></span>

## <a name="related-topics"></a><span data-ttu-id="7603d-180">См. также</span><span class="sxs-lookup"><span data-stu-id="7603d-180">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="7603d-181">Ресурсы Direct3D</span><span class="sxs-lookup"><span data-stu-id="7603d-181">Direct3D Resources</span></span>](direct3d-resources.md)
</dt> <dt>

[<span data-ttu-id="7603d-182">Отрисовка из буферов вершин и индексов (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="7603d-182">Rendering from Vertex and Index Buffers (Direct3D 9)</span></span>](rendering-from-vertex-and-index-buffers.md)
</dt> <dt>

[<span data-ttu-id="7603d-183">Буферы вершин (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="7603d-183">Vertex Buffers (Direct3D 9)</span></span>](vertex-buffers.md)
</dt> </dl>

 

 
