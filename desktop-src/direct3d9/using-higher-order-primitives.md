---
description: В этом разделе показано, как использовать примитивы более высокого порядка в приложении.
ms.assetid: 7aa4f3ab-cfce-4f8f-a538-384f038fd324
title: Использование примитивов Higher-Order (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6a7d7a7b7f619c033665f8cb9894db5d60d5d6ecf9116de4ada230accc476c07
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118797304"
---
# <a name="using-higher-order-primitives-direct3d-9"></a>Использование примитивов Higher-Order (Direct3D 9)

В этом разделе показано, как использовать примитивы более высокого порядка в приложении.

-   [Определение поддержки примитивов Higher-Order](#determining-higher-order-primitive-support)
-   [Исправления для рисования](#drawing-patches)
-   [Создание нормалей и координат текстуры](#generating-normals-and-texture-coordinates)

## <a name="determining-higher-order-primitive-support"></a>Определение поддержки примитивов Higher-Order

Можно запросить элемент Девкапс структуры [**D3DCAPS9**](/windows/desktop/api/D3D9Caps/ns-d3d9caps-d3dcaps9) , чтобы определить уровень поддержки для операций, включающих примитивы более высокого порядка. В следующей таблице перечислены возможности устройств, связанные с примитивами более высокого порядка в Direct3D 9.



| Возможность устройства             | Описание                                                                                                                                                  |
|-------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| D3DDEVCAPS \_ нпатчес          | Устройство поддерживает N исправлений и основано на [изогнутых треугольниках PN](https://alex.vlachos.com/graphics/CurvedPNTriangles.pdf) (в виде треугольников Безье третьего порядка). |
| D3DDEVCAPS \_ куинтикртпатчес  | Устройство поддерживает кривые Безье куинтик и линии B-сплайны.                                                                                                         |
| D3DDEVCAPS \_ ртпатчес         | Устройство поддерживает прямоугольные и треугольные исправления (RT-патчи).                                                                                             |
| D3DDEVCAPS \_ ртпатчхандлезеро | RT-исправления могут быть эффективно отрисованы с помощью нулевого маркера.                                                                                                     |



 

Обратите внимание, что D3DDEVCAPS \_ ртпатчхандлезеро не означает, что можно изобразить исправление с нулевым маркером. Нулевое исправление для обработчика всегда может быть вырисовано независимо от того, задана ли эта возможность устройства. Если эта возможность задана, аппаратная архитектура не требует кэширования каких-либо данных, и эти некэшированные исправления (нулевое значение обнуля) должны быть обработаны как кэшированные.

## <a name="drawing-patches"></a>Исправления для рисования

Direct3D 9 поддерживает два типа примитивов более высокого порядка, или исправления. Они называются N-исправлениями и обновлениями Rect и более чем три. N — исправления можно визуализировать с помощью любого вызова отрисовки треугольника, включив N-патчи с помощью вызова [**IDirect3DDevice9:: сетнпатчмоде**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setnpatchmode)(нсегментс) с нсегментс значением больше 1,0. Исправления Rect/втрое должны быть визуализированы с использованием следующих явных точек входа.

Для рисования исправлений можно использовать следующие методы.

-   [**IDirect3DDevice9::D равректпатч**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawrectpatch). Чтобы лучше понять, как на данные исправления ссылаются в буфере вершин, см [**. \_ сведения о D3DRECTPATCH**](d3drectpatch-info.md).
-   [**IDirect3DDevice9::D равтрипатч**](/windows/desktop/api). Чтобы лучше понять, как на данные исправления ссылаются в буфере вершин, см [**. \_ сведения о D3DTRIPATCH**](d3dtripatch-info.md).

[**IDirect3DDevice9::D равректпатч**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawrectpatch) рисует прямоугольное исправление высокого порядка, заданное параметром пректпатчинфо, с помощью потоков, заданных в настоящий момент. Параметр Handle используется для связывания исправления с маркером, чтобы при следующей прорисовке исправления не нужно было переопределять Пректпатчинфо. Это делает возможным предварительное вычисление и кэширование коэффициентов прямой разности или других сведений, которые, в свою очередь, позволяют выполнять последующие вызовы **IDirect3DDevice9::D равректпатч** , использующие один и тот же обработчик для эффективной работы.

Он предназначен для статических обновлений, приложение задаст шейдер вершин и соответствующие потоки, предоставляя сведения об исправлениях в параметре Пректпатчинфо и задали обработчик, чтобы Direct3D мог записывать и кэшировать данные. После этого приложение может вызвать метод [**IDirect3DDevice9::D равректпатч**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawrectpatch) с пректпатчинфо, имеющим значение **null** , чтобы эффективно выполнить прорисовку исправления. При рисовании кэшированного исправления потоки, установленные в настоящий момент, игнорируются. Однако можно переопределить кэшированные Пнумсегс, указав новые значения для Пнумсегс. Кроме того, необходимо задать тот же шейдер вершин при подготовке к просмотру кэшированного исправления, как было задано при его записи.

Для динамических исправлений данные исправления изменяются для каждой отрисовки исправления, поэтому кэширование данных не является эффективным. Приложение может передать это значение в Direct3D, установив для параметра handle значение 0. В этом случае Direct3D выводит исправление с помощью текущих потоков и значений Пнумсегс и не кэширует какие бы то ни было данные. Нельзя одновременно установить для Handle значение 0 и Ппатч в **null**.

При повторном указании Пректпатчинфо для одного и того же маркера приложение может перезаписать ранее кэшированные данные.

[**IDirect3DDevice9::D равтрипатч**](/windows/desktop/api) аналогичен [**IDirect3DDevice9::D равректпатч**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawrectpatch) , за исключением того, что он рисует треугольное высокоуровневое исправление.

## <a name="generating-normals-and-texture-coordinates"></a>Создание нормалей и координат текстуры

При использовании шейдера гибкого формата вершин (ФВФ) автоматическое создание обычных и текстурных координат невозможно.

Для обычных вычислений можно либо напрямую предоставить их, либо настроить Direct3D для их вычисления.

Координаты, формируемые для прямоугольных исправлений, являются координатами на основе сплайна, как показано на следующих иллюстрациях.

![Иллюстрация исходной текстуры и текстуры с помощью координат на основе сплайна](images/texturespline.png)

Координаты, формируемые для треугольных исправлений, являются барицентрик координатами на основе сплайна, как показано на следующих иллюстрациях.

![Иллюстрация исходной текстуры и текстуры с барицентрикными координатами на основе сплайна](images/texturebarycentricspline.png)

Если приложение должно изменить диапазон созданных координат текстуры, это можно сделать с помощью преобразования текстур.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Примитивы высшего порядка](higher-order-primitives.md)
</dt> </dl>

 

 
