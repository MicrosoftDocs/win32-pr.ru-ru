---
description: В этом разделе показано, как использовать примитивы более высокого порядка в приложении.
ms.assetid: 7aa4f3ab-cfce-4f8f-a538-384f038fd324
title: Использование примитивов Higher-Order (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7e8d1447635c38e5e5df3d16ebca5ee3ee142020
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104561772"
---
# <a name="using-higher-order-primitives-direct3d-9"></a><span data-ttu-id="ffd4c-103">Использование примитивов Higher-Order (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="ffd4c-103">Using Higher-Order Primitives (Direct3D 9)</span></span>

<span data-ttu-id="ffd4c-104">В этом разделе показано, как использовать примитивы более высокого порядка в приложении.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-104">This section shows you how to use higher-order primitives in your application.</span></span>

-   [<span data-ttu-id="ffd4c-105">Определение поддержки примитивов Higher-Order</span><span class="sxs-lookup"><span data-stu-id="ffd4c-105">Determining Higher-Order Primitive Support</span></span>](#determining-higher-order-primitive-support)
-   [<span data-ttu-id="ffd4c-106">Исправления для рисования</span><span class="sxs-lookup"><span data-stu-id="ffd4c-106">Drawing Patches</span></span>](#drawing-patches)
-   [<span data-ttu-id="ffd4c-107">Создание нормалей и координат текстуры</span><span class="sxs-lookup"><span data-stu-id="ffd4c-107">Generating Normals and Texture Coordinates</span></span>](#generating-normals-and-texture-coordinates)

## <a name="determining-higher-order-primitive-support"></a><span data-ttu-id="ffd4c-108">Определение поддержки примитивов Higher-Order</span><span class="sxs-lookup"><span data-stu-id="ffd4c-108">Determining Higher-Order Primitive Support</span></span>

<span data-ttu-id="ffd4c-109">Можно запросить элемент Девкапс структуры [**D3DCAPS9**](/windows/desktop/api/D3D9Caps/ns-d3d9caps-d3dcaps9) , чтобы определить уровень поддержки для операций, включающих примитивы более высокого порядка.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-109">The [**D3DCAPS9**](/windows/desktop/api/D3D9Caps/ns-d3d9caps-d3dcaps9) structure's DevCaps member can be queried to determine the level of support for operations involving higher-order primitives.</span></span> <span data-ttu-id="ffd4c-110">В следующей таблице перечислены возможности устройств, связанные с примитивами более высокого порядка в Direct3D 9.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-110">The following table lists the device capabilities related to higher-order primitives in Direct3D 9.</span></span>



| <span data-ttu-id="ffd4c-111">Возможность устройства</span><span class="sxs-lookup"><span data-stu-id="ffd4c-111">Device capability</span></span>             | <span data-ttu-id="ffd4c-112">Описание</span><span class="sxs-lookup"><span data-stu-id="ffd4c-112">Description</span></span>                                                                                                                                                  |
|-------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="ffd4c-113">D3DDEVCAPS \_ нпатчес</span><span class="sxs-lookup"><span data-stu-id="ffd4c-113">D3DDEVCAPS\_NPATCHES</span></span>          | <span data-ttu-id="ffd4c-114">Устройство поддерживает N исправлений и основано на [изогнутых треугольниках PN](https://alex.vlachos.com/graphics/CurvedPNTriangles.pdf) (в виде треугольников Безье третьего порядка).</span><span class="sxs-lookup"><span data-stu-id="ffd4c-114">Device supports N-patches and is based on [Curved PN Triangles](https://alex.vlachos.com/graphics/CurvedPNTriangles.pdf) (a special kind of cubic Bézier triangles).</span></span> |
| <span data-ttu-id="ffd4c-115">D3DDEVCAPS \_ куинтикртпатчес</span><span class="sxs-lookup"><span data-stu-id="ffd4c-115">D3DDEVCAPS\_QUINTICRTPATCHES</span></span>  | <span data-ttu-id="ffd4c-116">Устройство поддерживает кривые Безье куинтик и линии B-сплайны.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-116">Device supports quintic Bezier curves and B-splines.</span></span>                                                                                                         |
| <span data-ttu-id="ffd4c-117">D3DDEVCAPS \_ ртпатчес</span><span class="sxs-lookup"><span data-stu-id="ffd4c-117">D3DDEVCAPS\_RTPATCHES</span></span>         | <span data-ttu-id="ffd4c-118">Устройство поддерживает прямоугольные и треугольные исправления (RT-патчи).</span><span class="sxs-lookup"><span data-stu-id="ffd4c-118">Device supports rectangular and triangular patches (RT-patches).</span></span>                                                                                             |
| <span data-ttu-id="ffd4c-119">D3DDEVCAPS \_ ртпатчхандлезеро</span><span class="sxs-lookup"><span data-stu-id="ffd4c-119">D3DDEVCAPS\_RTPATCHHANDLEZERO</span></span> | <span data-ttu-id="ffd4c-120">RT-исправления могут быть эффективно отрисованы с помощью нулевого маркера.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-120">RT-patches might be drawn efficiently using handle zero.</span></span>                                                                                                     |



 

<span data-ttu-id="ffd4c-121">Обратите внимание, что D3DDEVCAPS \_ ртпатчхандлезеро не означает, что можно изобразить исправление с нулевым маркером.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-121">Note that D3DDEVCAPS\_RTPATCHHANDLEZERO does not mean that a patch with handle zero can be drawn.</span></span> <span data-ttu-id="ffd4c-122">Нулевое исправление для обработчика всегда может быть вырисовано независимо от того, задана ли эта возможность устройства.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-122">A handle zero patch can always be drawn, whether this device capability is set or not.</span></span> <span data-ttu-id="ffd4c-123">Если эта возможность задана, аппаратная архитектура не требует кэширования каких-либо данных, и эти некэшированные исправления (нулевое значение обнуля) должны быть обработаны как кэшированные.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-123">When this capability is set, the hardware architecture does not require caching of any information and that uncached patches (handle zero) be drawn as efficiently as cached ones.</span></span>

## <a name="drawing-patches"></a><span data-ttu-id="ffd4c-124">Исправления для рисования</span><span class="sxs-lookup"><span data-stu-id="ffd4c-124">Drawing Patches</span></span>

<span data-ttu-id="ffd4c-125">Direct3D 9 поддерживает два типа примитивов более высокого порядка, или исправления.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-125">Direct3D 9 supports two types of higher-order primitives, or patches.</span></span> <span data-ttu-id="ffd4c-126">Они называются N-исправлениями и обновлениями Rect и более чем три.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-126">These are referred to as N-Patches and Rect/Tri patches.</span></span> <span data-ttu-id="ffd4c-127">N — исправления можно визуализировать с помощью любого вызова отрисовки треугольника, включив N-патчи с помощью вызова [**IDirect3DDevice9:: сетнпатчмоде**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setnpatchmode)(нсегментс) с нсегментс значением больше 1,0.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-127">N-patches can be rendered using any triangle rendering call by enabling N-patches through the call to [**IDirect3DDevice9::SetNPatchMode**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setnpatchmode)( nSegments ) with nSegments value greater than 1.0.</span></span> <span data-ttu-id="ffd4c-128">Исправления Rect/втрое должны быть визуализированы с использованием следующих явных точек входа.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-128">Rect/Tri patches must be rendered using the following explicit entry points.</span></span>

<span data-ttu-id="ffd4c-129">Для рисования исправлений можно использовать следующие методы.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-129">You can use the following methods to draw patches.</span></span>

-   <span data-ttu-id="ffd4c-130">[**IDirect3DDevice9::D равректпатч**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawrectpatch).</span><span class="sxs-lookup"><span data-stu-id="ffd4c-130">[**IDirect3DDevice9::DrawRectPatch**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawrectpatch).</span></span> <span data-ttu-id="ffd4c-131">Чтобы лучше понять, как на данные исправления ссылаются в буфере вершин, см [**. \_ сведения о D3DRECTPATCH**](d3drectpatch-info.md).</span><span class="sxs-lookup"><span data-stu-id="ffd4c-131">To better understand how the patch data is referenced in the vertex buffer, see [**D3DRECTPATCH\_INFO**](d3drectpatch-info.md).</span></span>
-   <span data-ttu-id="ffd4c-132">[**IDirect3DDevice9::D равтрипатч**](/windows/desktop/api).</span><span class="sxs-lookup"><span data-stu-id="ffd4c-132">[**IDirect3DDevice9::DrawTriPatch**](/windows/desktop/api).</span></span> <span data-ttu-id="ffd4c-133">Чтобы лучше понять, как на данные исправления ссылаются в буфере вершин, см [**. \_ сведения о D3DTRIPATCH**](d3dtripatch-info.md).</span><span class="sxs-lookup"><span data-stu-id="ffd4c-133">To better understand how the patch data is referenced in the vertex buffer, see [**D3DTRIPATCH\_INFO**](d3dtripatch-info.md).</span></span>

<span data-ttu-id="ffd4c-134">[**IDirect3DDevice9::D равректпатч**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawrectpatch) рисует прямоугольное исправление высокого порядка, заданное параметром пректпатчинфо, с помощью потоков, заданных в настоящий момент.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-134">[**IDirect3DDevice9::DrawRectPatch**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawrectpatch) draws a rectangular high-order patch specified by the pRectPatchInfo parameter using the currently set streams.</span></span> <span data-ttu-id="ffd4c-135">Параметр Handle используется для связывания исправления с маркером, чтобы при следующей прорисовке исправления не нужно было переопределять Пректпатчинфо.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-135">The Handle parameter is used to associate the patch with a handle, so that the next time the patch is drawn, there is no need to respecify pRectPatchInfo.</span></span> <span data-ttu-id="ffd4c-136">Это делает возможным предварительное вычисление и кэширование коэффициентов прямой разности или других сведений, которые, в свою очередь, позволяют выполнять последующие вызовы **IDirect3DDevice9::D равректпатч** , использующие один и тот же обработчик для эффективной работы.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-136">This makes it possible to precompute and cache forward difference coefficients or other information, which in turn enables subsequent calls to **IDirect3DDevice9::DrawRectPatch** using the same handle to run efficiently.</span></span>

<span data-ttu-id="ffd4c-137">Он предназначен для статических обновлений, приложение задаст шейдер вершин и соответствующие потоки, предоставляя сведения об исправлениях в параметре Пректпатчинфо и задали обработчик, чтобы Direct3D мог записывать и кэшировать данные.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-137">It is intended that for static patches, an application would set the vertex shader and appropriate streams, supply patch information in the pRectPatchInfo parameter, and specify a handle so that Direct3D can capture and cache information.</span></span> <span data-ttu-id="ffd4c-138">После этого приложение может вызвать метод [**IDirect3DDevice9::D равректпатч**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawrectpatch) с пректпатчинфо, имеющим значение **null** , чтобы эффективно выполнить прорисовку исправления.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-138">The application can then call [**IDirect3DDevice9::DrawRectPatch**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawrectpatch) subsequently with pRectPatchInfo set to **NULL** to efficiently draw the patch.</span></span> <span data-ttu-id="ffd4c-139">При рисовании кэшированного исправления потоки, установленные в настоящий момент, игнорируются.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-139">When drawing a cached patch, the currently set streams are ignored.</span></span> <span data-ttu-id="ffd4c-140">Однако можно переопределить кэшированные Пнумсегс, указав новые значения для Пнумсегс.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-140">However, it is possible to override the cached pNumSegs by specifying new values for pNumSegs.</span></span> <span data-ttu-id="ffd4c-141">Кроме того, необходимо задать тот же шейдер вершин при подготовке к просмотру кэшированного исправления, как было задано при его записи.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-141">Also, it is required to set the same vertex shader when rendering a cached patch as was set when it was captured.</span></span>

<span data-ttu-id="ffd4c-142">Для динамических исправлений данные исправления изменяются для каждой отрисовки исправления, поэтому кэширование данных не является эффективным.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-142">For dynamic patches, the patch data changes for every rendering of the patch, so it is not efficient to cache information.</span></span> <span data-ttu-id="ffd4c-143">Приложение может передать это значение в Direct3D, установив для параметра handle значение 0.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-143">The application can convey this to Direct3D by setting Handle to 0.</span></span> <span data-ttu-id="ffd4c-144">В этом случае Direct3D выводит исправление с помощью текущих потоков и значений Пнумсегс и не кэширует какие бы то ни было данные.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-144">In this case, Direct3D draws the patch using the currently set streams and the pNumSegs values and does not cache any information.</span></span> <span data-ttu-id="ffd4c-145">Нельзя одновременно установить для Handle значение 0 и Ппатч в **null**.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-145">It is not valid to simultaneously set Handle to 0 and pPatch to **NULL**.</span></span>

<span data-ttu-id="ffd4c-146">При повторном указании Пректпатчинфо для одного и того же маркера приложение может перезаписать ранее кэшированные данные.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-146">By respecifying pRectPatchInfo for the same handle, the application can overwrite the previously cached information.</span></span>

<span data-ttu-id="ffd4c-147">[**IDirect3DDevice9::D равтрипатч**](/windows/desktop/api) аналогичен [**IDirect3DDevice9::D равректпатч**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawrectpatch) , за исключением того, что он рисует треугольное высокоуровневое исправление.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-147">[**IDirect3DDevice9::DrawTriPatch**](/windows/desktop/api) is similar to [**IDirect3DDevice9::DrawRectPatch**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawrectpatch) except that it draws a triangular high-order patch.</span></span>

## <a name="generating-normals-and-texture-coordinates"></a><span data-ttu-id="ffd4c-148">Создание нормалей и координат текстуры</span><span class="sxs-lookup"><span data-stu-id="ffd4c-148">Generating Normals and Texture Coordinates</span></span>

<span data-ttu-id="ffd4c-149">При использовании шейдера гибкого формата вершин (ФВФ) автоматическое создание обычных и текстурных координат невозможно.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-149">If you are using a flexible vertex format (FVF) shader, automatic generation of normals and texture coordinates is not possible.</span></span>

<span data-ttu-id="ffd4c-150">Для обычных вычислений можно либо напрямую предоставить их, либо настроить Direct3D для их вычисления.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-150">For normals, you can either directly supply them or have Direct3D calculate them for you.</span></span>

<span data-ttu-id="ffd4c-151">Координаты, формируемые для прямоугольных исправлений, являются координатами на основе сплайна, как показано на следующих иллюстрациях.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-151">The coordinates generated for rectangular patches are spline-based coordinates, as shown in the following illustrations.</span></span>

![Иллюстрация исходной текстуры и текстуры с помощью координат на основе сплайна](images/texturespline.png)

<span data-ttu-id="ffd4c-153">Координаты, формируемые для треугольных исправлений, являются барицентрик координатами на основе сплайна, как показано на следующих иллюстрациях.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-153">The coordinates generated for triangular patches are barycentric spline-based coordinates, as shown in the following illustrations.</span></span>

![Иллюстрация исходной текстуры и текстуры с барицентрикными координатами на основе сплайна](images/texturebarycentricspline.png)

<span data-ttu-id="ffd4c-155">Если приложение должно изменить диапазон созданных координат текстуры, это можно сделать с помощью преобразования текстур.</span><span class="sxs-lookup"><span data-stu-id="ffd4c-155">If an application must change the range of the generated texture coordinates, this can be done using texture transforms.</span></span>

## <a name="related-topics"></a><span data-ttu-id="ffd4c-156">См. также</span><span class="sxs-lookup"><span data-stu-id="ffd4c-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ffd4c-157">Примитивы высшего порядка</span><span class="sxs-lookup"><span data-stu-id="ffd4c-157">Higher-Order Primitives</span></span>](higher-order-primitives.md)
</dt> </dl>

 

 
