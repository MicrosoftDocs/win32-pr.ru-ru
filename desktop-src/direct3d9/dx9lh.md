---
description: Эта документация специально относится к расширениям Windows Vista для графики DirectX.
ms.assetid: 3cc0b08c-e126-4f1b-b5d1-0d6c1ebeb0c5
title: Сводка функций (Direct3D 9 для Windows Vista)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3d5cf2447297b7f24edf7d0200e640d5aef90bff
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "105691982"
---
# <a name="feature-summary-direct3d-9-for-windows-vista"></a><span data-ttu-id="211f1-103">Сводка функций (Direct3D 9 для Windows Vista)</span><span class="sxs-lookup"><span data-stu-id="211f1-103">Feature Summary (Direct3D 9 for Windows Vista)</span></span>

<span data-ttu-id="211f1-104">Эта документация специально относится к расширениям Windows Vista для графики DirectX.</span><span class="sxs-lookup"><span data-stu-id="211f1-104">This documentation specifically refers to the Windows Vista extensions for DirectX graphics.</span></span> <span data-ttu-id="211f1-105">Для разработки возможностей DirectX для Windows Vista необходимо установить пакет SDK для Windows Vista и пакет SDK для DirectX.</span><span class="sxs-lookup"><span data-stu-id="211f1-105">To develop the power of DirectX for Windows Vista, you must install the Windows Vista SDK as well as the DirectX SDK.</span></span> <span data-ttu-id="211f1-106">Приложения, использующие DirectX для Windows Vista, должны использовать оборудование, использующее драйвер WDDM (модель драйвера устройства Windows) в отличие от модели XPDM (модель драйвера для XP); драйверы, не реализующие WDDM, не могут создавать экземпляры графических интерфейсов DirectX для Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="211f1-106">Applications using DirectX for Windows Vista must be using hardware that uses the WDDM driver (Windows Device Driver Model) as opposed to the XPDM (XP Driver Model); drivers that do not implement the WDDM cannot instantiate Windows Vista DirectX graphics interfaces.</span></span>

<span data-ttu-id="211f1-107">Узнайте о новых функциях графики DirectX в Windows Vista в одном из следующих разделов:</span><span class="sxs-lookup"><span data-stu-id="211f1-107">Discover the new DirectX graphics features in Windows Vista in one of these sections:</span></span>

-   [<span data-ttu-id="211f1-108">Изменения в поведении устройства</span><span class="sxs-lookup"><span data-stu-id="211f1-108">Device Behavior Changes</span></span>](#device-behavior-changes)
-   [<span data-ttu-id="211f1-109">Отключение обработки многопотоковых вершин программного обеспечения</span><span class="sxs-lookup"><span data-stu-id="211f1-109">Disabling Multithreaded Software Vertex Processing</span></span>](#disabling-multithreaded-software-vertex-processing)
-   [<span data-ttu-id="211f1-110">Один битовый поверхностный</span><span class="sxs-lookup"><span data-stu-id="211f1-110">One Bit Surfaces</span></span>](#one-bit-surfaces)
-   [<span data-ttu-id="211f1-111">Чтение буферов глубины и трафаретов</span><span class="sxs-lookup"><span data-stu-id="211f1-111">Reading Depth/Stencil Buffers</span></span>](#reading-depthstencil-buffers)
-   [<span data-ttu-id="211f1-112">Совместное использование ресурсов</span><span class="sxs-lookup"><span data-stu-id="211f1-112">Sharing Resources</span></span>](#sharing-resources)
-   [<span data-ttu-id="211f1-113">Преобразование sRGB перед наложением</span><span class="sxs-lookup"><span data-stu-id="211f1-113">sRGB Conversion Before Blending</span></span>](#srgb-conversion-before-blending)
-   [<span data-ttu-id="211f1-114">Усовершенствования Стретчрект</span><span class="sxs-lookup"><span data-stu-id="211f1-114">StretchRect Improvements</span></span>](#stretchrect-improvements)
-   [<span data-ttu-id="211f1-115">Создание текстуры в системной памяти</span><span class="sxs-lookup"><span data-stu-id="211f1-115">Texture Creation in System Memory</span></span>](#texture-creation-in-system-memory)

## <a name="device-behavior-changes"></a><span data-ttu-id="211f1-116">Изменения в поведении устройства</span><span class="sxs-lookup"><span data-stu-id="211f1-116">Device Behavior Changes</span></span>

<span data-ttu-id="211f1-117">Теперь устройства теряются только при двух обстоятельствах. При сбросе оборудования из-за зависания и при остановке драйвера устройства.</span><span class="sxs-lookup"><span data-stu-id="211f1-117">Devices are now only lost under two circumstances; when the hardware is reset because it is hanging, and when the device driver is stopped.</span></span> <span data-ttu-id="211f1-118">При зависании оборудования устройство можно сбросить, вызвав [**ресетекс**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-resetex).</span><span class="sxs-lookup"><span data-stu-id="211f1-118">When hardware hangs, the device can be reset by calling [**ResetEx**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-resetex).</span></span> <span data-ttu-id="211f1-119">При зависании оборудования память текстуры теряется.</span><span class="sxs-lookup"><span data-stu-id="211f1-119">If hardware hangs, texture memory is lost.</span></span>

<span data-ttu-id="211f1-120">После остановки драйвера необходимо создать объект IDirect9Ex, чтобы возобновить подготовку к просмотру.</span><span class="sxs-lookup"><span data-stu-id="211f1-120">After a driver is stopped, the IDirect9Ex object must be recreated to resume rendering.</span></span>

<span data-ttu-id="211f1-121">Если область презентации скрыта другим окном в оконном режиме или когда полноэкранное приложение свернется, [**пресентекс**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-presentex) возвратит S \_ D3DPRESENTATIONOCCLUDED.</span><span class="sxs-lookup"><span data-stu-id="211f1-121">When the presentation area is obscured by another window in windowed mode, or when a fullscreen application is minimized, [**PresentEx**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-presentex) will return S\_D3DPRESENTATIONOCCLUDED.</span></span> <span data-ttu-id="211f1-122">Полноэкранные приложения могут возобновлять отрисовку при получении сообщения обратного вызова [**WM \_ активатеапп**](../winmsg/wm-activateapp.md) .</span><span class="sxs-lookup"><span data-stu-id="211f1-122">Full screen applications can resume rendering when they receive a [**WM\_ACTIVATEAPP**](../winmsg/wm-activateapp.md) callback message.</span></span>

<span data-ttu-id="211f1-123">В предыдущих версиях DirectX при изменении режима работы приложения единственным способом восстановления был сброс устройства и повторное создание всех ресурсов видеопамяти и цепочек обмена.</span><span class="sxs-lookup"><span data-stu-id="211f1-123">In previous versions of DirectX, when an application experienced a mode change, the only way to recover was to reset the device and re-create all video memory resources and swap chains.</span></span> <span data-ttu-id="211f1-124">Теперь с DirectX для Windows Vista вызов метода Reset после изменения режима не приводит к потере поверхностей памяти текстуры, текстур и сведений о состоянии, а также не требует повторного создания этих ресурсов.</span><span class="sxs-lookup"><span data-stu-id="211f1-124">Now with DirectX for Windows Vista, calling Reset after a mode change does not cause texture memory surfaces, textures and state information to be lost and these resources do not need to be recreated.</span></span>

## <a name="disabling-multithreaded-software-vertex-processing"></a><span data-ttu-id="211f1-125">Отключение обработки многопотоковых вершин программного обеспечения</span><span class="sxs-lookup"><span data-stu-id="211f1-125">Disabling Multithreaded Software Vertex Processing</span></span>

<span data-ttu-id="211f1-126">Добавлен новый бит Caps (D3DCREATE \_ disable \_ ПСГП \_ Threading), который отключит многопоточность для обработки вершин программного обеспечения (СВВП).</span><span class="sxs-lookup"><span data-stu-id="211f1-126">A new caps bit (D3DCREATE\_DISABLE\_PSGP\_THREADING) has been added that will disable multithreading for software vertex processing (swvp).</span></span> <span data-ttu-id="211f1-127">Используйте этот макрос для создания флага поведения для IDirect3D9:: Креатедевице.</span><span class="sxs-lookup"><span data-stu-id="211f1-127">Use this macro to generate a behavior flag for IDirect3D9::CreateDevice.</span></span>


```
#define D3DCREATE_DISABLE_PSGP_THREADING
```



## <a name="one-bit-surfaces"></a><span data-ttu-id="211f1-128">Один битовый поверхностный</span><span class="sxs-lookup"><span data-stu-id="211f1-128">One Bit Surfaces</span></span>

<span data-ttu-id="211f1-129">Существует новый тип формата битовой поверхности, который может быть особенно полезен для обработки глифов текста.</span><span class="sxs-lookup"><span data-stu-id="211f1-129">There is a new one bit surface format type which can be especially useful for processing text glyphs.</span></span> <span data-ttu-id="211f1-130">Новый формат называется D3DFMT \_ a1.</span><span class="sxs-lookup"><span data-stu-id="211f1-130">The new format is called D3DFMT\_A1.</span></span> <span data-ttu-id="211f1-131">Одноразрядная поверхность предназначена для использования в качестве текстуры для каждого пикселя или выходных данных целевого объекта прорисовки, создаваемой Компосеректс или Колорфилл.</span><span class="sxs-lookup"><span data-stu-id="211f1-131">A one-bit surface is designed to be either used as a per-pixel texture, or the render target output generated by ComposeRects or ColorFill.</span></span> <span data-ttu-id="211f1-132">Для ширины и высоты поверхности не существует отдельных политик. реализация должна поддерживать одну поверхность размера, которая равна 2 КБ пикселей текстуры x 8 КБ пикселей текстуры.</span><span class="sxs-lookup"><span data-stu-id="211f1-132">There are no separate caps for the surface width and height; an implementation must support a single size surface that is 2K texels x 8K texels.</span></span>

<span data-ttu-id="211f1-133">Одноразрядная поверхность имеет один бит на шаг текселя; Таким образом, один из них означает, что все компоненты (r, g, b, a) пикселя равны 1, а нулевое значение означает, что все компоненты равны 0.</span><span class="sxs-lookup"><span data-stu-id="211f1-133">A one-bit surface has one bit per texel; therefore, a one would mean that all components (r,g,b,a) of a pixel are 1, and zero would mean that all components are equal to 0.</span></span> <span data-ttu-id="211f1-134">Вы можете использовать одноразрядные поверхности со следующими API: Колорфилл, Упдатесурфаце и Упдатетекстуре.</span><span class="sxs-lookup"><span data-stu-id="211f1-134">You may use one-bit surfaces with the following APIs: ColorFill, UpdateSurface and UpdateTexture.</span></span>

<span data-ttu-id="211f1-135">При считывании одноразрядной поверхности среда выполнения может выполнять выборку образца или фильтрацию свертки.</span><span class="sxs-lookup"><span data-stu-id="211f1-135">When a one-bit surface is read, the runtime can perform either point sample or convolution filtering.</span></span> <span data-ttu-id="211f1-136">Фильтр свертки является настраиваемым (см. [**сетконволутионмонокернел**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-setconvolutionmonokernel)).</span><span class="sxs-lookup"><span data-stu-id="211f1-136">The convolution filter is adjustable (see [**SetConvolutionMonoKernel**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-setconvolutionmonokernel)).</span></span>

<span data-ttu-id="211f1-137">Существуют некоторые ограничения для одноразрядных поверхностей.</span><span class="sxs-lookup"><span data-stu-id="211f1-137">There are some restrictions for one-bit surfaces:</span></span>

-   <span data-ttu-id="211f1-138">MIP-сопоставление не поддерживается</span><span class="sxs-lookup"><span data-stu-id="211f1-138">Mip-mapping is not supported</span></span>
-   <span data-ttu-id="211f1-139">данные sRGB нельзя читать или записывать в одноразрядную поверхность.</span><span class="sxs-lookup"><span data-stu-id="211f1-139">sRGB data cannot be read or written to a one-bit surface.</span></span>
-   <span data-ttu-id="211f1-140">Одноразрядную поверхность нельзя использовать в качестве текстуры вершин или для многовыборочной выборки.</span><span class="sxs-lookup"><span data-stu-id="211f1-140">A one-bit surface cannot be used as a vertex texture or for multisampling.</span></span>

## <a name="reading-depthstencil-buffers"></a><span data-ttu-id="211f1-141">Чтение буферов глубины и трафаретов</span><span class="sxs-lookup"><span data-stu-id="211f1-141">Reading Depth/Stencil Buffers</span></span>

<span data-ttu-id="211f1-142">Используйте IDirect3DDevice9:: Упдатесурфаце для чтения или записи данных глубины или трафарета из поверхностей, полученных из IDirect3DDevice9:: КреатедепсстенЦилсурфаце или IDirect3DDevice9:: ЖетдепсстенЦилсурфаце.</span><span class="sxs-lookup"><span data-stu-id="211f1-142">Use IDirect3DDevice9::UpdateSurface to read or write depth/stencil data from surfaces obtained from IDirect3DDevice9::CreateDepthStencilSurface or IDirect3DDevice9::GetDepthStencilSurface.</span></span>

<span data-ttu-id="211f1-143">Сначала создайте блокируемую, только глубину или трафаретную поверхность только с помощью IDirect3DDevice9:: Креатеоффскринплаинсурфаце.</span><span class="sxs-lookup"><span data-stu-id="211f1-143">First, create a lockable, depth only or stencil only surface using IDirect3DDevice9::CreateOffscreenPlainSurface.</span></span> <span data-ttu-id="211f1-144">Используйте один из следующих форматов:</span><span class="sxs-lookup"><span data-stu-id="211f1-144">Use one of the following formats:</span></span>

-   <span data-ttu-id="211f1-145">D3DFMT \_ D16 \_ блокируемый</span><span class="sxs-lookup"><span data-stu-id="211f1-145">D3DFMT\_D16\_LOCKABLE</span></span>
-   <span data-ttu-id="211f1-146">D3DFMT \_ D32F \_ блокируемый</span><span class="sxs-lookup"><span data-stu-id="211f1-146">D3DFMT\_D32F\_LOCKABLE</span></span>
-   <span data-ttu-id="211f1-147">D3DFMT \_ d32 \_ блокируемый</span><span class="sxs-lookup"><span data-stu-id="211f1-147">D3DFMT\_D32\_LOCKABLE</span></span>
-   <span data-ttu-id="211f1-148">D3DFMT \_ S8 \_ блокируемый</span><span class="sxs-lookup"><span data-stu-id="211f1-148">D3DFMT\_S8\_LOCKABLE</span></span>

<span data-ttu-id="211f1-149">Во-вторых, перенесите данные между буфером глубины и трафарета и вновь созданной глубиной или областью набора элементов.</span><span class="sxs-lookup"><span data-stu-id="211f1-149">Second, transfer data between the depth/stencil buffer and the newly-created lockable depth or stencil surface.</span></span> <span data-ttu-id="211f1-150">Перенос выполняется с помощью IDirect3DDevice9:: Упдатесурфаце.</span><span class="sxs-lookup"><span data-stu-id="211f1-150">The transfer is performed using IDirect3DDevice9::UpdateSurface.</span></span>

<span data-ttu-id="211f1-151">Упдатесурфаце завершится ошибкой, если оба поверхностей имеют БЛОКИРУЕМый формат или оба являются не блокируемыми.</span><span class="sxs-lookup"><span data-stu-id="211f1-151">UpdateSurface will fail when both surfaces are a LOCKABLE format or both are non-lockable.</span></span>

<span data-ttu-id="211f1-152">Передача несуществующих данных приведет к ошибке (например, передача из неблокируемой поверхности только глубины в D3DFMT \_ S8 \_ запираемая поверхность).</span><span class="sxs-lookup"><span data-stu-id="211f1-152">Transferring non-existent data will result in an error (for example, transferring from a non-lockable depth-only surface to a D3DFMT\_S8\_LOCKABLE surface).</span></span>

<span data-ttu-id="211f1-153">Остальные ограничения для IDirect3DDevice9:: Упдатесурфаце по-прежнему применяются.</span><span class="sxs-lookup"><span data-stu-id="211f1-153">The rest of the restrictions for IDirect3DDevice9::UpdateSurface still apply.</span></span>

## <a name="sharing-resources"></a><span data-ttu-id="211f1-154">Совместное использование ресурсов</span><span class="sxs-lookup"><span data-stu-id="211f1-154">Sharing Resources</span></span>

<span data-ttu-id="211f1-155">Теперь ресурсы Direct3D можно совместно использовать между устройствами или процессами.</span><span class="sxs-lookup"><span data-stu-id="211f1-155">Direct3D resources can now be shared between devices or processes.</span></span> <span data-ttu-id="211f1-156">Это относится к любому ресурсу Direct3D, включая текстуры, буферы вершин, буферы индексов или поверхности (например, целевые объекты отрисовки, буферы трафаретов глубины и необычные Экранные поверхности).</span><span class="sxs-lookup"><span data-stu-id="211f1-156">This applies to any Direct3D resource including textures, vertex buffers, index buffers, or surfaces (such as render targets, depth stencil buffers or off-screen plain surfaces).</span></span> <span data-ttu-id="211f1-157">Для общего доступа необходимо назначить ресурс для совместного использования во время создания и определить ресурс в пуле по умолчанию (D3DPOOL \_ по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="211f1-157">To be shared, you need to designate a resource for sharing at the time of creation, and locate the resource in the default pool (D3DPOOL\_DEFAULT).</span></span> <span data-ttu-id="211f1-158">После создания ресурса для совместного использования он может быть общим для всех устройств внутри процесса или совместно использоваться процессами.</span><span class="sxs-lookup"><span data-stu-id="211f1-158">Once a resource is created for sharing, it can be shared across devices within a process, or shared across processes.</span></span>

<span data-ttu-id="211f1-159">Для включения общих ресурсов интерфейсы API создания ресурсов имеют дополнительный параметр Handle.</span><span class="sxs-lookup"><span data-stu-id="211f1-159">To enable shared resources, the resource creation APIs have an additional handle parameter.</span></span> <span data-ttu-id="211f1-160">Это маркер, указывающий на общий ресурс.</span><span class="sxs-lookup"><span data-stu-id="211f1-160">This is a HANDLE that points to the shared resource.</span></span> <span data-ttu-id="211f1-161">В предыдущих версиях DirectX этот аргумент был частью сигнатуры API, но он не используется и должен быть установлен в **значение NULL**.</span><span class="sxs-lookup"><span data-stu-id="211f1-161">In previous revisions of DirectX, this argument has been part of the API signature, but has been unused and must be set to **NULL**.</span></span> <span data-ttu-id="211f1-162">Начиная с Windows Vista, используйте Пшаредхандле следующим образом:</span><span class="sxs-lookup"><span data-stu-id="211f1-162">Starting with Windows Vista, use pSharedHandle in the following ways:</span></span>

-   <span data-ttu-id="211f1-163">Установите для указателя (Пшаредхандле) **значение NULL** , чтобы не предоставить общий доступ к ресурсу.</span><span class="sxs-lookup"><span data-stu-id="211f1-163">Set the pointer (pSharedHandle) to **NULL** to not share a resource.</span></span> <span data-ttu-id="211f1-164">Это поведение аналогично поведению DirectX до Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="211f1-164">This is just like the behavior of DirectX prior to Windows Vista.</span></span>
-   <span data-ttu-id="211f1-165">Чтобы создать общий ресурс, вызовите любой API создания ресурсов (см. ниже) с неинициализированным маркером (сам указатель не равен **null** (пшаредхандле! = **null**), но указатель указывает на значение **null** ( \* пшаредхандле = = **null**)).</span><span class="sxs-lookup"><span data-stu-id="211f1-165">To create a shared resource, call any resource creation API (see below) with an uninitialized handle (the pointer itself is not **NULL** (pSharedHandle != **NULL**), but the pointer points to a **NULL** value (\*pSharedHandle == **NULL**)).</span></span> <span data-ttu-id="211f1-166">API создаст общий ресурс и возвратит допустимый маркер.</span><span class="sxs-lookup"><span data-stu-id="211f1-166">The API will generate a shared resource and return a valid handle.</span></span>
-   <span data-ttu-id="211f1-167">Чтобы открыть ранее созданный общий ресурс и получить к нему доступ с помощью ненулевого общего ресурса, задайте Пшаредхандле в качестве адреса этого маркера.</span><span class="sxs-lookup"><span data-stu-id="211f1-167">To open and access a previously created shared resource by using a nonNULL shared resource handle, set pSharedHandle to the address of that handle.</span></span> <span data-ttu-id="211f1-168">После открытия ранее созданного общего ресурса таким образом можно использовать возвращенный интерфейс в API Direct3D 9 или Direct3D 9Ex, как если бы интерфейс был типичным ресурсом этого типа.</span><span class="sxs-lookup"><span data-stu-id="211f1-168">After you open the previously created shared resource in this manner, you can use the returned interface in the Direct3D 9 or Direct3D 9Ex API as if the interface were a typical resource of that type.</span></span>

<span data-ttu-id="211f1-169">Интерфейсы API для создания ресурсов включают- [**креатетекстуре**](/windows/desktop/api), [**креатеволуметекстуре**](/windows/desktop/api), [**креатекубетекстуре**](/windows/desktop/api), [**креатерендертаржет**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createrendertarget), [**креатевертексбуффер**](/windows/desktop/api), [**CreateIndexBuffer**](/windows/desktop/api), [**CreateDepthStencilSurface**](/windows/desktop/api), [**CreateOffscreenPlainSurface**](/windows/desktop/api), [**CreateDepthStencilSurfaceEx**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-createdepthstencilsurfaceex), [**CreateOffscreenPlainSurfaceEx**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-createoffscreenplainsurfaceex)и [**CreateRenderTargetEx**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-createrendertargetex).</span><span class="sxs-lookup"><span data-stu-id="211f1-169">Resource creation APIs include - [**CreateTexture**](/windows/desktop/api), [**CreateVolumeTexture**](/windows/desktop/api), [**CreateCubeTexture**](/windows/desktop/api), [**CreateRenderTarget**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createrendertarget), [**CreateVertexBuffer**](/windows/desktop/api), [**CreateIndexBuffer**](/windows/desktop/api), [**CreateDepthStencilSurface**](/windows/desktop/api), [**CreateOffscreenPlainSurface**](/windows/desktop/api), [**CreateDepthStencilSurfaceEx**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-createdepthstencilsurfaceex), [**CreateOffscreenPlainSurfaceEx**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-createoffscreenplainsurfaceex), and [**CreateRenderTargetEx**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-createrendertargetex).</span></span>

<span data-ttu-id="211f1-170">Существуют некоторые ограничения на использование общих ресурсов.</span><span class="sxs-lookup"><span data-stu-id="211f1-170">There are some restrictions for using shared resources.</span></span> <span data-ttu-id="211f1-171">Сюда входит следующее.</span><span class="sxs-lookup"><span data-stu-id="211f1-171">These include:</span></span>

-   <span data-ttu-id="211f1-172">API-интерфейс, используемый для открытия общего ресурса, должен соответствовать API, который использовался для создания общего ресурса.</span><span class="sxs-lookup"><span data-stu-id="211f1-172">The API that you use to open a shared resource must match the API that you used to create the shared resource.</span></span> <span data-ttu-id="211f1-173">Например, если вы использовали [**креатетекстуре**](/windows/desktop/api) для создания общего ресурса, необходимо использовать **креатетекстуре** , чтобы открыть этот общий ресурс. Если для создания общего ресурса использовался [**креатерендертаржет**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createrendertarget) , необходимо использовать **креатерендертаржет** для открытия этого общего ресурса и т. д.</span><span class="sxs-lookup"><span data-stu-id="211f1-173">For example, if you used [**CreateTexture**](/windows/desktop/api) to create a shared resource, you must use **CreateTexture** to open that shared resource; if you used [**CreateRenderTarget**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createrendertarget) to create a shared resource, you must use **CreateRenderTarget** to open that shared resource;and so on.</span></span>
-   <span data-ttu-id="211f1-174">При открытии общего ресурса необходимо указать D3DPOOL \_ по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="211f1-174">When you open a shared resource, you must specify D3DPOOL\_DEFAULT.</span></span>
-   <span data-ttu-id="211f1-175">Блокируемые ресурсы (текстуры с \_ динамическими D3DUSAGE, буферами вершин и буферами индексов) могут испытывать низкую производительность при совместном использовании.</span><span class="sxs-lookup"><span data-stu-id="211f1-175">Lockable resources (textures with D3DUSAGE\_DYNAMIC, vertex buffers and index buffers, for instance) can experience poor performance when shared.</span></span> <span data-ttu-id="211f1-176">Блокируемая рендертаржетс не будет совместно использоваться на определенном оборудовании.</span><span class="sxs-lookup"><span data-stu-id="211f1-176">Lockable rendertargets will fail to be shared on some hardware.</span></span>
-   <span data-ttu-id="211f1-177">Ссылки на общий ресурс перекрестной обработки должны иметь те же измерения, что и исходный ресурс.</span><span class="sxs-lookup"><span data-stu-id="211f1-177">References to a cross-process shared resource must have the same dimensions as the original resource.</span></span> <span data-ttu-id="211f1-178">При передаче обработчика между процессами Включите сведения об измерении, чтобы ссылка могла быть создана одинаково.</span><span class="sxs-lookup"><span data-stu-id="211f1-178">When passing a handle across process, include the dimension information so that the reference can be created identically.</span></span>
-   <span data-ttu-id="211f1-179">В общих межпроцессных поверхностях не предусмотрен механизм синхронизации.</span><span class="sxs-lookup"><span data-stu-id="211f1-179">Shared cross-process surfaces provide no synchronization mechanism.</span></span> <span data-ttu-id="211f1-180">При необходимости чтение и запись изменений в общей поверхности могут не отражать представление области ссылающегося процесса.</span><span class="sxs-lookup"><span data-stu-id="211f1-180">Read/write changes to a shared surface may not reflect a referencing process's view of the surface when expected.</span></span> <span data-ttu-id="211f1-181">Чтобы обеспечить синхронизацию, используйте запросы событий или заблокируйте текстуру.</span><span class="sxs-lookup"><span data-stu-id="211f1-181">To provide synchronization, use event queries or lock the texture.</span></span>
-   <span data-ttu-id="211f1-182">Только процесс, который изначально создает общий ресурс, может заблокировать его (любой процесс, открывающий ссылку на этот общий ресурс, не сможет его заблокировать).</span><span class="sxs-lookup"><span data-stu-id="211f1-182">Only the process that initially creates a shared resource can lock it (any process that opens a reference to that shared resource cannot lock it).</span></span>
-   <span data-ttu-id="211f1-183">Если общий ресурс заблокирован, другие процессы не смогут проверить, доступен ли ресурс.</span><span class="sxs-lookup"><span data-stu-id="211f1-183">If a shared resource is locked, there is no validation for other processes to know if the resource is available.</span></span>

## <a name="srgb-conversion-before-blending"></a><span data-ttu-id="211f1-184">Преобразование sRGB перед наложением</span><span class="sxs-lookup"><span data-stu-id="211f1-184">sRGB Conversion Before Blending</span></span>

<span data-ttu-id="211f1-185">Теперь можно проверить, может ли устройство преобразовывать данные конвейера в sRGB перед смешением буфера кадров.</span><span class="sxs-lookup"><span data-stu-id="211f1-185">You can now check to see if the device can convert pipeline data to sRGB before frame-buffer blending.</span></span> <span data-ttu-id="211f1-186">Это означает, что устройство преобразует значения целевого объекта рендеринга из sRGB.</span><span class="sxs-lookup"><span data-stu-id="211f1-186">This implies that the device converts the render-target values from sRGB.</span></span> <span data-ttu-id="211f1-187">Чтобы узнать, поддерживается ли преобразование оборудованием, проверьте наличие этого ограничения:</span><span class="sxs-lookup"><span data-stu-id="211f1-187">To see if conversion is supported by the hardware, check for this cap:</span></span>


```
D3DPMISCCAPS_POSTBLENDSRGBCONVERT
```



<span data-ttu-id="211f1-188">Это ограничение определяет оборудование, которое поддерживает преобразование в sRGB перед наложением.</span><span class="sxs-lookup"><span data-stu-id="211f1-188">This cap identifies hardware that supports conversion to sRGB before blending.</span></span> <span data-ttu-id="211f1-189">Эта возможность важна для высококачественной отрисовки из fp16ных буферов кадров в диспетчере окон рабочего стола (DWM).</span><span class="sxs-lookup"><span data-stu-id="211f1-189">This capability is important for the high quality rendering from fp16 frame buffers in the desktop window manager (DWM).</span></span>

## <a name="stretchrect-improvements"></a><span data-ttu-id="211f1-190">Усовершенствования Стретчрект</span><span class="sxs-lookup"><span data-stu-id="211f1-190">StretchRect Improvements</span></span>

<span data-ttu-id="211f1-191">В предыдущих версиях DirectX Стретчрект имеет много ограничений для размещения различных драйверов (см. раздел IDirect3DDevice9:: Стретчрект).</span><span class="sxs-lookup"><span data-stu-id="211f1-191">In previous versions of DirectX, StretchRect has many restrictions to accommodate different drivers (see IDirect3DDevice9::StretchRect).</span></span> <span data-ttu-id="211f1-192">Windows Vista построена на основе модели драйверов устройств Windows (WDDM).</span><span class="sxs-lookup"><span data-stu-id="211f1-192">Windows Vista is built on the Windows Device Driver Model (WDDM).</span></span> <span data-ttu-id="211f1-193">Эта новая модель драйвера гораздо более надежна и позволяет драйверам справляться с особыми случаями оборудования.</span><span class="sxs-lookup"><span data-stu-id="211f1-193">This new driver model is much more robust, and allows drivers to handle special cases in the hardware.</span></span>

<span data-ttu-id="211f1-194">В целом, единственным оставшимся ограничением является то, что целевой объект отрисовки должен быть создан с использованием целевого объекта визуализации (D3DUSAGE \_ рендертаржет).</span><span class="sxs-lookup"><span data-stu-id="211f1-194">In general, the only remaining restriction is that the render target must have been created with render-target usage (D3DUSAGE\_RENDERTARGET).</span></span> <span data-ttu-id="211f1-195">Это ограничение ликвидируется, если вы выполняете простую копию (где источник и конечный объект имеют тот же формат и не имеют подпрямоугольников).</span><span class="sxs-lookup"><span data-stu-id="211f1-195">This restriction is lifted if you are doing a simple copy (where the source and dest are the same format, same size and there are no sub-rectangles).</span></span>

## <a name="texture-creation-in-system-memory"></a><span data-ttu-id="211f1-196">Создание текстуры в системной памяти</span><span class="sxs-lookup"><span data-stu-id="211f1-196">Texture Creation in System Memory</span></span>

<span data-ttu-id="211f1-197">Приложения, которым требуется более гибкое использование, выделение и удаление системной памяти, теперь могут создавать текстуры из указателя системной памяти.</span><span class="sxs-lookup"><span data-stu-id="211f1-197">Applications that need more flexibility over the use, allocation and deletion of the system memory can now create textures from a system memory pointer.</span></span> <span data-ttu-id="211f1-198">Например, приложение может создать текстуру Direct3D на основе указателя точечного рисунка памяти GDI.</span><span class="sxs-lookup"><span data-stu-id="211f1-198">For example, an application could create a Direct3D texture from a GDI system-memory bitmap pointer.</span></span>

<span data-ttu-id="211f1-199">Для создания такой текстуры необходимо выполнить два действия.</span><span class="sxs-lookup"><span data-stu-id="211f1-199">You need to do two things to create such a texture:</span></span>

-   <span data-ttu-id="211f1-200">Выделите достаточно памяти системы, чтобы вместить текстурную поверхность.</span><span class="sxs-lookup"><span data-stu-id="211f1-200">Allocate enough system memory to hold the texture surface.</span></span> <span data-ttu-id="211f1-201">Минимальное число байтов — ширина x высота x байт на пиксель.</span><span class="sxs-lookup"><span data-stu-id="211f1-201">The minimum number of bytes is width x height x bytes per pixel.</span></span>
-   <span data-ttu-id="211f1-202">Передайте адрес указателя на поверхность системной памяти для \* параметра handle в IDirect3DDevice9:: креатетекстуре.</span><span class="sxs-lookup"><span data-stu-id="211f1-202">Pass the address of a pointer to your system memory surface for the HANDLE\* parameter to IDirect3DDevice9::CreateTexture.</span></span>

<span data-ttu-id="211f1-203">Ниже приведен прототип функции для IDirect3DDevice9:: Креатетекстуре:</span><span class="sxs-lookup"><span data-stu-id="211f1-203">Here is the function prototype for IDirect3DDevice9::CreateTexture:</span></span>


```
STDMETHOD(CreateTexture)(THIS_ UINT Width, UINT Height, UINT Levels, 
    DWORD Usage, D3DFORMAT Format, D3DPOOL Pool, IDirect3DTexture9** ppTexture, 
    HANDLE* pSharedHandle)
```



<span data-ttu-id="211f1-204">Текстура системной памяти имеет следующие ограничения.</span><span class="sxs-lookup"><span data-stu-id="211f1-204">A system-memory texture has the following restrictions:</span></span>

-   <span data-ttu-id="211f1-205">Высота текстуры должна равняться ширине текстуры, равной числу байтов на пиксель.</span><span class="sxs-lookup"><span data-stu-id="211f1-205">The texture pitch must equal texture width times the number of bytes per pixel.</span></span>
-   <span data-ttu-id="211f1-206">При использовании сжатых форматов (DXT formats) приложение отвечает за выделение правильного размера.</span><span class="sxs-lookup"><span data-stu-id="211f1-206">When using compressed formats (DXT formats), the application is responsible for allocating the correct size.</span></span>
-   <span data-ttu-id="211f1-207">Поддерживаются только текстуры с одним уровнем mipmap.</span><span class="sxs-lookup"><span data-stu-id="211f1-207">Only textures with a single mipmap level are supported.</span></span>
-   <span data-ttu-id="211f1-208">Значение, передаваемое в Креатетекстуре для аргумента pool, должно быть D3DPOOL \_ системмем.</span><span class="sxs-lookup"><span data-stu-id="211f1-208">The value passed to CreateTexture for the Pool argument must be D3DPOOL\_SYSTEMMEM.</span></span>
-   <span data-ttu-id="211f1-209">Этот API заключает в оболочку переданную память в текстуре.</span><span class="sxs-lookup"><span data-stu-id="211f1-209">This API wraps the supplied memory in a texture.</span></span> <span data-ttu-id="211f1-210">Не выделяйте эту память до тех пор, пока не завершите работу с ней.</span><span class="sxs-lookup"><span data-stu-id="211f1-210">Do not deallocate this memory until you are done with it.</span></span>

 

 
