---
description: По сути, окно просмотра — это двухмерный (двумерный) прямоугольник, в котором проецируется трехмерная сцена.
ms.assetid: eddadaa1-9181-47fa-8530-44aa46fea286
title: Окна просмотра и обрезка (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d57f64d17f7abf4e370406f984fa50037be6d44e
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104139214"
---
# <a name="viewports-and-clipping-direct3d-9"></a><span data-ttu-id="ab995-103">Окна просмотра и обрезка (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="ab995-103">Viewports and Clipping (Direct3D 9)</span></span>

<span data-ttu-id="ab995-104">По сути, окно просмотра — это двухмерный (двумерный) прямоугольник, в котором проецируется трехмерная сцена.</span><span class="sxs-lookup"><span data-stu-id="ab995-104">Conceptually, a viewport is a two-dimensional (2D) rectangle into which a 3D scene is projected.</span></span> <span data-ttu-id="ab995-105">В Direct3D этот прямоугольник существует как координаты внутри поверхности Direct3D, которую система использует как целевой объект отрисовки.</span><span class="sxs-lookup"><span data-stu-id="ab995-105">In Direct3D, the rectangle exists as coordinates within a Direct3D surface that the system uses as a rendering target.</span></span> <span data-ttu-id="ab995-106">Преобразование проекции преобразует вершины в систему координат, используемую для окна просмотра.</span><span class="sxs-lookup"><span data-stu-id="ab995-106">The projection transformation converts vertices into the coordinate system used for the viewport.</span></span> <span data-ttu-id="ab995-107">Окно просмотра также используется, чтобы указать диапазон значений глубины на целевой поверхности отрисовки, где будет отрисовываться сцена (как правило, от 0,0 до 1,0).</span><span class="sxs-lookup"><span data-stu-id="ab995-107">A viewport is also used to specify the range of depth values on a render-target surface into which a scene will be rendered (usually 0.0 to 1.0).</span></span>

## <a name="the-viewing-frustum"></a><span data-ttu-id="ab995-108">Усеченная пирамида видимости</span><span class="sxs-lookup"><span data-stu-id="ab995-108">The Viewing Frustum</span></span>

<span data-ttu-id="ab995-109">Усеченная пирамида видимости — это 3D-объем в сцене, позиционируемый относительно камеры окна просмотра.</span><span class="sxs-lookup"><span data-stu-id="ab995-109">A viewing frustum is 3D volume in a scene positioned relative to the viewport's camera.</span></span> <span data-ttu-id="ab995-110">Форма этого объема влияет на то, как модели проецируются из пространства камеры на экран.</span><span class="sxs-lookup"><span data-stu-id="ab995-110">The shape of the volume affects how models are projected from camera space onto the screen.</span></span> <span data-ttu-id="ab995-111">При использовании наиболее распространенного типа проекции — перспективной проекции — объекты, которые находятся ближе к камере, кажутся больше, чем объекты дальше от нее.</span><span class="sxs-lookup"><span data-stu-id="ab995-111">The most common type of projection, a perspective projection, is responsible for making objects near the camera appear bigger than objects in the distance.</span></span> <span data-ttu-id="ab995-112">В случае перспективной проекции усеченную пирамиду видимости можно визуализировать как пирамиду, на вершине которой находится камера, как показано на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="ab995-112">For perspective viewing, the viewing frustum can be visualized as a pyramid, with the camera positioned at the tip as shown in the following illustration.</span></span> <span data-ttu-id="ab995-113">Эта пирамида пересекается передней и задней плоскостью кадрирования.</span><span class="sxs-lookup"><span data-stu-id="ab995-113">This pyramid is intersected by a front and back clipping plane.</span></span> <span data-ttu-id="ab995-114">Объем пирамиды между передней и задней плоскостями кадрирования — это и есть усеченная пирамида видимости.</span><span class="sxs-lookup"><span data-stu-id="ab995-114">The volume within the pyramid between the front and back clipping planes is the viewing frustum.</span></span> <span data-ttu-id="ab995-115">Объекты отображаются, только когда они находятся в пределах этого объема.</span><span class="sxs-lookup"><span data-stu-id="ab995-115">Objects are visible only when they are in this volume.</span></span>

![Иллюстрация усеченной пирамиды видимости с передней и задней плоскостью кадрирования](images/frustum.png)

<span data-ttu-id="ab995-117">Если представить себе, что вы стоите в темной комнате и смотрите наружу через квадратное окно, то, что вы видите — это усеченная пирамида видимости.</span><span class="sxs-lookup"><span data-stu-id="ab995-117">If you imagine that you are standing in a dark room and looking through a square window, you are visualizing a viewing frustum.</span></span> <span data-ttu-id="ab995-118">В этой аналогии ближняя плоскость кадрирования — это окно, а задняя плоскость кадрирования — это то, что в итоге перегораживает открывающийся перед вами вид: высотный дом через дорогу, горы вдалеке или вообще ничего.</span><span class="sxs-lookup"><span data-stu-id="ab995-118">In this analogy, the near clipping plane is the window, and the back clipping plane is whatever finally interrupts your view - the skyscraper across the street, the mountains in the distance, or nothing at all.</span></span> <span data-ttu-id="ab995-119">Вы видите все, что находится внутри усеченной пирамиды, которая начинается окном и заканчивается предметом, который перегораживает вид; больше вы не видите ничего.</span><span class="sxs-lookup"><span data-stu-id="ab995-119">You can see everything inside the truncated pyramid that starts at the window and ends with whatever interrupts your view, and you can see nothing else.</span></span>

<span data-ttu-id="ab995-120">Усеченная пирамида видимости определяется полем зрения и расстояниями до передней и задней плоскостей кадрирования, заданными в виде Z-координат, как показано на следующей схеме.</span><span class="sxs-lookup"><span data-stu-id="ab995-120">The viewing frustum is defined by fov (field of view) and by the distances of the front and back clipping planes, specified in z-coordinates, as shown in the following diagram.</span></span>

![Схема усеченной пирамиды видимости](images/fovdiag.png)

<span data-ttu-id="ab995-122">На этой схеме переменная D — это расстояние от камеры до начала координат пространства, которое было определено на последнем участке геометрического конвейера — при преобразовании для просмотра.</span><span class="sxs-lookup"><span data-stu-id="ab995-122">In this diagram, the variable D is the distance from the camera to the origin of the space that was defined in the last part of the geometry pipeline - the viewing transformation.</span></span> <span data-ttu-id="ab995-123">Это пространство, вокруг которого располагаются пределы вашей усеченной пирамиды видимости.</span><span class="sxs-lookup"><span data-stu-id="ab995-123">This is the space around which you arrange the limits of your viewing frustum.</span></span> <span data-ttu-id="ab995-124">Сведения о том, как эта D-переменная используется для построения матрицы проекции, см. в разделе [преобразование проекции (Direct3D 9)](projection-transform.md) .</span><span class="sxs-lookup"><span data-stu-id="ab995-124">For information about how this D variable is used to build the projection matrix, see the [Projection Transform (Direct3D 9)](projection-transform.md)</span></span>

## <a name="viewport-rectangle"></a><span data-ttu-id="ab995-125">Прямоугольник окна просмотра</span><span class="sxs-lookup"><span data-stu-id="ab995-125">Viewport Rectangle</span></span>

<span data-ttu-id="ab995-126">Вы определяете прямоугольник окна просмотра в C++ с помощью структуры [**D3DVIEWPORT9**](d3dviewport9.md) .</span><span class="sxs-lookup"><span data-stu-id="ab995-126">You define the viewport rectangle in C++ by using the [**D3DVIEWPORT9**](d3dviewport9.md) structure.</span></span> <span data-ttu-id="ab995-127">Структура D3DVIEWPORT9 используется со следующими методами обработки окна просмотра, предоставляемыми интерфейсом IDirect3DDevice9.</span><span class="sxs-lookup"><span data-stu-id="ab995-127">The D3DVIEWPORT9 structure is used with the following viewport manipulation methods exposed by the IDirect3DDevice9 interface.</span></span>

-   [<span data-ttu-id="ab995-128">**IDirect3DDevice9:: "окно просмотра"**</span><span class="sxs-lookup"><span data-stu-id="ab995-128">**IDirect3DDevice9::GetViewport**</span></span>](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-getviewport)
-   [<span data-ttu-id="ab995-129">**IDirect3DDevice9:: Сетвиевпорт**</span><span class="sxs-lookup"><span data-stu-id="ab995-129">**IDirect3DDevice9::SetViewport**</span></span>](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setviewport)

<span data-ttu-id="ab995-130">Структура D3DVIEWPORT9 содержит четыре элемента: X, Y, ширина, высота, которые определяют область поверхности рендеринга, в которой будет отображаться сцена.</span><span class="sxs-lookup"><span data-stu-id="ab995-130">The D3DVIEWPORT9 structure contains four members - X, Y, Width, Height - that define the area of the render-target surface into which a scene will be rendered.</span></span> <span data-ttu-id="ab995-131">Эти значения соответствуют целевому прямоугольнику, или прямоугольнику окна просмотра, как показано на следующей схеме.</span><span class="sxs-lookup"><span data-stu-id="ab995-131">These values correspond to the destination rectangle, or viewport rectangle, as shown in the following diagram.</span></span>

![Схема прямоугольника окна просмотра](images/destrect.png)

<span data-ttu-id="ab995-133">Значения, задаваемые в качестве членов X, Y, Width, Height, — это экранные координаты относительно левого верхнего угла поверхности целевого объекта отрисовки.</span><span class="sxs-lookup"><span data-stu-id="ab995-133">The values you specify for the X, Y, Width, Height members are screen coordinates relative to the upper-left corner of the render-target surface.</span></span> <span data-ttu-id="ab995-134">Структура определяет два дополнительных члена (MinZ и MaxZ); они указывают диапазоны глубин, в которых будет отрисовываться сцена.</span><span class="sxs-lookup"><span data-stu-id="ab995-134">The structure defines two additional members (MinZ and MaxZ) that indicate the depth-ranges into which the scene will be rendered.</span></span>

<span data-ttu-id="ab995-135">Direct3D предполагает, что объем кадрирования окна просмотра находится в диапазоне от -1,0 до 1,0 по оси X и от 1,0 до -1,0 по оси Y. Эти значения в прошлом использовались большинством приложений.</span><span class="sxs-lookup"><span data-stu-id="ab995-135">Direct3D assumes that the viewport clipping volume ranges from -1.0 to 1.0 in X, and from 1.0 to -1.0 in Y. These were the settings used most often by applications in the past.</span></span> <span data-ttu-id="ab995-136">Пропорции окна просмотра можно откорректировать перед кадрированием с использованием [преобразования проекции](projection-transform.md).</span><span class="sxs-lookup"><span data-stu-id="ab995-136">You can adjust the viewport aspect ratio before clipping using the [projection transform](projection-transform.md).</span></span>

> [!Note]  
> <span data-ttu-id="ab995-137">Минз и Максз обозначают диапазоны глубины, в которых будет выполняться визуализация сцены и которые не используются для обрезки.</span><span class="sxs-lookup"><span data-stu-id="ab995-137">MinZ and MaxZ indicate the depth-ranges into which the scene will be rendered and are not used for clipping.</span></span> <span data-ttu-id="ab995-138">В большинстве приложений эти члены будут установлены в 0,0 и 1,0, чтобы система отображалась во всем диапазоне значений глубины в буфере глубины.</span><span class="sxs-lookup"><span data-stu-id="ab995-138">Most applications will set these members to 0.0 and 1.0 to enable the system to render to the entire range of depth values in the depth buffer.</span></span> <span data-ttu-id="ab995-139">В некоторых случаях можно добиться особых эффектов, используя другие диапазоны глубин.</span><span class="sxs-lookup"><span data-stu-id="ab995-139">In some cases, you can achieve special effects by using other depth ranges.</span></span> <span data-ttu-id="ab995-140">Например, для отрисовки экранных элементов в игре вы можно задать оба значения равными 0,0, чтобы заставить систему отрисовывать объекты в сцене на переднем плане, или задать их оба равными 1,0 для отрисовки объекта, который всегда должен находиться на заднем плане.</span><span class="sxs-lookup"><span data-stu-id="ab995-140">For instance, to render a heads-up display in a game, you can set both values to 0.0 to force the system to render objects in a scene in the foreground, or you might set them both to 1.0 to render an object that should always be in the background.</span></span>

 

<span data-ttu-id="ab995-141">Измерения, используемые в элементах X, Y, Width и Height структуры [**D3DVIEWPORT9**](d3dviewport9.md) для окна просмотра, определяют расположение и размеры окна просмотра на поверхности целевого объекта рендеринга.</span><span class="sxs-lookup"><span data-stu-id="ab995-141">The dimensions used in the X, Y, Width, Height members of the [**D3DVIEWPORT9**](d3dviewport9.md) structure for a viewport define the location and dimensions of the viewport on the render-target surface.</span></span> <span data-ttu-id="ab995-142">Эти значения задаются в экранных координатах относительно левого верхнего угла поверхности.</span><span class="sxs-lookup"><span data-stu-id="ab995-142">These values are in screen coordinates, relative to the upper-left corner of the surface.</span></span>

<span data-ttu-id="ab995-143">Direct3D использует местоположение и размеры окна просмотра для масштабирования вершин так, чтобы отрисованная сцена поместилась в соответствующее место на поверхности целевого объекта.</span><span class="sxs-lookup"><span data-stu-id="ab995-143">Direct3D uses the viewport location and dimensions to scale the vertices to fit a rendered scene into the appropriate location on the target surface.</span></span> <span data-ttu-id="ab995-144">Внутренне Direct3D вставляет эти значения в следующую матрицу, которая применяется к каждой вершине.</span><span class="sxs-lookup"><span data-stu-id="ab995-144">Internally, Direct3D inserts these values into the following matrix that is applied to each vertex.</span></span>

![уравнение матрицы, применяемое к каждой вершине](images/vpscale.png)

<span data-ttu-id="ab995-146">Эта матрица масштабирует вершины в соответствии с размерами окна просмотра и желаемым диапазоном глубин, а также переносит их в соответствующее местоположение на поверхности целевого объекта отрисовки.</span><span class="sxs-lookup"><span data-stu-id="ab995-146">This matrix scales vertices according to the viewport dimensions and desired depth range and translates them to the appropriate location on the render-target surface.</span></span> <span data-ttu-id="ab995-147">Матрица также обращает Y-координату, чтобы отразить начало координат экрана в левом верхнем углу с осью Y, направленной вниз.</span><span class="sxs-lookup"><span data-stu-id="ab995-147">The matrix also flips the y-coordinate to reflect a screen origin at the top-left corner with y increasing downward.</span></span> <span data-ttu-id="ab995-148">После применения этой матрицы вершины по-прежнему являются однородными, то есть они по-прежнему существуют в виде \[ вершин x, y, z, w \] и должны быть преобразованы в однородные координаты перед отправкой в средство программной прорисовки.</span><span class="sxs-lookup"><span data-stu-id="ab995-148">After this matrix is applied, vertices are still homogeneous - that is, they still exist as \[x,y,z,w\] vertices - and they must be converted to non-homogeneous coordinates before being sent to the rasterizer.</span></span>

> [!Note]  
> <span data-ttu-id="ab995-149">Матрица масштабирования окна просмотра содержит элементы Минз и Максз структуры [**D3DVIEWPORT9**](d3dviewport9.md) для масштабирования вершин в соответствии с диапазоном глубины \[ Минз, максз \] .</span><span class="sxs-lookup"><span data-stu-id="ab995-149">The viewport scaling matrix incorporates the MinZ and MaxZ members of the [**D3DVIEWPORT9**](d3dviewport9.md) structure to scale vertices to fit the depth range \[MinZ, MaxZ\].</span></span> <span data-ttu-id="ab995-150">Это представляет собой другую семантику из предыдущих выпусков DirectX, в которых эти члены использовались для обрезки.</span><span class="sxs-lookup"><span data-stu-id="ab995-150">This represents different semantics from previous releases of DirectX, in which these members were used for clipping.</span></span>

 

> [!Note]  
> <span data-ttu-id="ab995-151">Приложения обычно устанавливают Минз и Максз в 0,0 и 1,0 соответственно, что приводит к отрисовке системой всего диапазона глубины.</span><span class="sxs-lookup"><span data-stu-id="ab995-151">Applications typically set MinZ and MaxZ to 0.0 and 1.0 respectively to cause the system to render to the entire depth range.</span></span> <span data-ttu-id="ab995-152">Однако можно использовать другие значения для достижения определенных эффектов.</span><span class="sxs-lookup"><span data-stu-id="ab995-152">However, you can use other values to achieve certain affects.</span></span> <span data-ttu-id="ab995-153">Например, можно задать оба значения равными 0,0, чтобы все объекты отрисовывались на переднем плане, или равными 1,0, чтобы все объекты отрисовывались на заднем плане.</span><span class="sxs-lookup"><span data-stu-id="ab995-153">For example, you might set both values to 0.0 to force all objects into the foreground, or set both to 1.0 to render all objects into the background.</span></span>

 

## <a name="clearing-a-viewport"></a><span data-ttu-id="ab995-154">Очистка окна просмотра</span><span class="sxs-lookup"><span data-stu-id="ab995-154">Clearing a Viewport</span></span>

<span data-ttu-id="ab995-155">При очистке окна просмотра содержимое прямоугольника окна просмотра на поверхности целевого объекта отрисовки сбрасывается.</span><span class="sxs-lookup"><span data-stu-id="ab995-155">Clearing the viewport resets the contents of the viewport rectangle on the render-target surface.</span></span> <span data-ttu-id="ab995-156">Также при этом может очищаться прямоугольник в буфере глубины и буфере трафарета.</span><span class="sxs-lookup"><span data-stu-id="ab995-156">It can also clear the rectangle in the depth and stencil buffer surfaces.</span></span>

<span data-ttu-id="ab995-157">Чтобы очистить окно просмотра, используйте [**IDirect3DDevice9:: Clear**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-clear) .</span><span class="sxs-lookup"><span data-stu-id="ab995-157">Use [**IDirect3DDevice9::Clear**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-clear) to clear the viewport.</span></span> <span data-ttu-id="ab995-158">Метод принимает один или несколько прямоугольников, определяющих области на поверхности.</span><span class="sxs-lookup"><span data-stu-id="ab995-158">The method accepts one or more rectangles that define the areas on the surface being cleared.</span></span> <span data-ttu-id="ab995-159">Если задать для параметра Count значение 1, а параметр Пректс — адрес одного прямоугольника, охватывающего всю область окна просмотра, будет очищено все окно просмотра.</span><span class="sxs-lookup"><span data-stu-id="ab995-159">Setting the Count parameter to 1, and the pRects parameter to the address of a single rectangle that covers the entire viewport area will clear the entire viewport.</span></span> <span data-ttu-id="ab995-160">Другим способом очистки всего окна просмотра является установка для параметра Пректс **значения NULL** , а для параметра Count — значение 0.</span><span class="sxs-lookup"><span data-stu-id="ab995-160">Another way to clear the entire viewport is to set the pRects parameter to **NULL** and the Count parameter to 0.</span></span>

<span data-ttu-id="ab995-161">[**IDirect3DDevice9:: Clear**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-clear) можно использовать для очистки битов трафарета в буфере глубины.</span><span class="sxs-lookup"><span data-stu-id="ab995-161">The [**IDirect3DDevice9::Clear**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-clear) can be used for clearing stencil bits within a depth buffer.</span></span> <span data-ttu-id="ab995-162">Просто установите параметр flags, чтобы определить, как **IDirect3DDevice9:: Clear** работает с целью рендеринга и любыми связанными буферами глубины или трафарета.</span><span class="sxs-lookup"><span data-stu-id="ab995-162">Simply set the Flags parameter to determine how **IDirect3DDevice9::Clear** works with the render target and any associated depth or stencil buffers.</span></span> <span data-ttu-id="ab995-163">\_Флаг целевого объекта D3DCLEAR очистит окно просмотра, используя произвольный цвет RGBA, который вы задаете в аргументе Color (это не цвет материала).</span><span class="sxs-lookup"><span data-stu-id="ab995-163">The D3DCLEAR\_TARGET flag will clear the viewport using an arbitrary RGBA color that you provide in the Color argument (this is not the material color).</span></span> <span data-ttu-id="ab995-164">Флаг D3DCLEAR \_ збуффер очистит буфер глубины до произвольной глубины, указанной в Z: 0,0 — ближайшее расстояние, а 1,0 — самым крайним.</span><span class="sxs-lookup"><span data-stu-id="ab995-164">The D3DCLEAR\_ZBUFFER flag will clear the depth buffer to an arbitrary depth you specify in Z: 0.0 is the closest distance, and 1.0 is the farthest.</span></span> <span data-ttu-id="ab995-165">\_Флаг набора элементов D3DCLEAR приведет к сбросу битов шаблона до значения, которое вы задасте в аргументе набора элементов.</span><span class="sxs-lookup"><span data-stu-id="ab995-165">The D3DCLEAR\_STENCIL flag will reset the stencil bits to the value you provide in the Stencil argument.</span></span> <span data-ttu-id="ab995-166">Можно использовать целые числа в диапазоне от 0 до 2n-1, где n — битовая глубина буфера шаблона.</span><span class="sxs-lookup"><span data-stu-id="ab995-166">You can use integers that range from 0 to 2n-1, where n is the stencil buffer bit depth.</span></span>

<span data-ttu-id="ab995-167">В некоторых ситуациях может быть отображена только часть мелких частей целевого объекта рендеринга и поверхностей буфера глубины.</span><span class="sxs-lookup"><span data-stu-id="ab995-167">In some situations, you might be rendering only to small portions of the render target and depth buffer surfaces.</span></span> <span data-ttu-id="ab995-168">Методы Clear также позволяют очищать несколько областей поверхностей в одном вызове.</span><span class="sxs-lookup"><span data-stu-id="ab995-168">The clear methods also enable you to clear multiple areas of your surfaces in a single call.</span></span> <span data-ttu-id="ab995-169">Для этого установите параметр count равным количеству прямоугольников, которые нужно очистить, и укажите адрес первого прямоугольника в массиве прямоугольников в параметре Пректс.</span><span class="sxs-lookup"><span data-stu-id="ab995-169">Do this by setting the Count parameter to the number of rectangles you want cleared, and specify the address of the first rectangle in an array of rectangles in the pRects parameter.</span></span>

## <a name="set-up-the-viewport-for-clipping"></a><span data-ttu-id="ab995-170">Настройка окна просмотра для кадрирования</span><span class="sxs-lookup"><span data-stu-id="ab995-170">Set Up the Viewport for Clipping</span></span>

<span data-ttu-id="ab995-171">Результаты матрицы проекции определяют объем кадрирования в пространстве проекции следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ab995-171">The results of the projection matrix determine the clipping volume in projection space as:</span></span>

<span data-ttu-id="ab995-172">-w<sub>c</sub><= x<sub>c</sub><= w<sub>c</sub></span><span class="sxs-lookup"><span data-stu-id="ab995-172">-w<sub>c</sub><= x<sub>c</sub><= w<sub>c</sub></span></span>

<span data-ttu-id="ab995-173">-w<sub>c</sub><= y<sub>c</sub><= w<sub>c</sub></span><span class="sxs-lookup"><span data-stu-id="ab995-173">-w<sub>c</sub><= y<sub>c</sub><= w<sub>c</sub></span></span>

<span data-ttu-id="ab995-174">0 <= z<sub>c</sub><= w<sub>c</sub></span><span class="sxs-lookup"><span data-stu-id="ab995-174">0 <= z<sub>c</sub><= w<sub>c</sub></span></span>

<span data-ttu-id="ab995-175">где x, y, z и w представляют координаты вершин после применения преобразования проекции.</span><span class="sxs-lookup"><span data-stu-id="ab995-175">Where: x, y, z, and w represent the vertex coordinates after the projection transformation is applied.</span></span> <span data-ttu-id="ab995-176">Все вершины, у которых x-, y- или z-компонент находится вне этих диапазонов, отсекаются, если кадрирование включено (поведение по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="ab995-176">Any vertices that have an x-, y-, or z-component outside these ranges are clipped, if clipping is enabled (the default behavior).</span></span>

<span data-ttu-id="ab995-177">За исключением буферов вершин, приложения включают или отключают обрезку с помощью [**состояния \_ рендеринга D3DRS**](./d3drenderstatetype.md) .</span><span class="sxs-lookup"><span data-stu-id="ab995-177">With the exception of vertex buffers, applications enable or disable clipping by way of the [**D3DRS\_CLIPPING**](./d3drenderstatetype.md) render state.</span></span> <span data-ttu-id="ab995-178">Сведения об отсечениях для буферов вершин создаются во время обработки.</span><span class="sxs-lookup"><span data-stu-id="ab995-178">Clipping information for vertex buffers is generated during processing.</span></span> <span data-ttu-id="ab995-179">Дополнительные сведения см. в разделе [Обработка вершин фиксированной функции (Direct3D 9)](fixed-function-vertex-processing.md) и [программируемая обработка вершин (Direct3D 9)](programmable-vertex-processing.md).</span><span class="sxs-lookup"><span data-stu-id="ab995-179">For more information, see [Fixed Function Vertex Processing (Direct3D 9)](fixed-function-vertex-processing.md) and [Programmable Vertex Processing (Direct3D 9)](programmable-vertex-processing.md).</span></span>

<span data-ttu-id="ab995-180">Direct3D не обрезает преобразованные вершины примитива из буфера вершин, если он не поступает из [**IDirect3DDevice9::P роцессвертицес**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-processvertices).</span><span class="sxs-lookup"><span data-stu-id="ab995-180">Direct3D does not clip transformed vertices of a primitive from a vertex buffer unless it comes from [**IDirect3DDevice9::ProcessVertices**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-processvertices).</span></span> <span data-ttu-id="ab995-181">Если вы выполняете собственные преобразования и для выполнения обрезки требуется Direct3D, не следует использовать буферы вершин.</span><span class="sxs-lookup"><span data-stu-id="ab995-181">If you are doing your own transforms and need Direct3D to do the clipping, you should not use vertex buffers.</span></span> <span data-ttu-id="ab995-182">В этом случае приложение проходит по данным, чтобы преобразовать их.</span><span class="sxs-lookup"><span data-stu-id="ab995-182">In this case, the application traverses the data to transform it.</span></span> <span data-ttu-id="ab995-183">Direct3D перебирает данные во второй раз, чтобы обрезать его, а затем драйвер подготавливает к просмотру данные, что является неэффективным.</span><span class="sxs-lookup"><span data-stu-id="ab995-183">Direct3D traverses the data a second time to clip it, and then the driver renders the data, which is inefficient.</span></span> <span data-ttu-id="ab995-184">Таким образом, если приложение преобразует данные, оно также должно обрезать данные.</span><span class="sxs-lookup"><span data-stu-id="ab995-184">So, if the application transforms the data, is should also clip the data.</span></span>

<span data-ttu-id="ab995-185">Когда устройство получает предварительно преобразованные и освещенные вершины (T&L вершины), которые необходимо обрезать, для выполнения операции обрезки вершины преобразуются в область обрезки с помощью обратной однородной оси w (РХВ) и информации окна просмотра.</span><span class="sxs-lookup"><span data-stu-id="ab995-185">When the device receives pre-transformed and lit vertices (T&L vertices) that need to be clipped, in order to perform the clipping operation the vertices are back-transformed to the clipping space using the vertex's reciprocal homogeneous w (RHW) and the viewport information.</span></span> <span data-ttu-id="ab995-186">Затем выполняется обрезка.</span><span class="sxs-lookup"><span data-stu-id="ab995-186">Clipping is then performed.</span></span> <span data-ttu-id="ab995-187">Не все устройства способны выполнить это обратное преобразование, чтобы обрезать вершины&L.</span><span class="sxs-lookup"><span data-stu-id="ab995-187">Not all devices are capable of performing this back-transform in order to clip T&L vertices.</span></span>

<span data-ttu-id="ab995-188">\_Возможность устройства D3DPMISCCAPS клиптлвертс указывает, поддерживает ли устройство отсечение вершин T&L.</span><span class="sxs-lookup"><span data-stu-id="ab995-188">The D3DPMISCCAPS\_CLIPTLVERTS device capability indicates whether the device is capable of clipping T&L vertices.</span></span> <span data-ttu-id="ab995-189">Если эта возможность не задана, приложение несет ответственность за обрезание вершин T&L, которые он намеревается отправить на устройство для подготовки к просмотру.</span><span class="sxs-lookup"><span data-stu-id="ab995-189">If this capability is not set, the application is responsible for clipping the T&L vertices that it intends to send down to the device to be rendered.</span></span> <span data-ttu-id="ab995-190">Устройство всегда может обрезать вершины T&L в режиме обработки вершин программного обеспечения (независимо от того, создано ли устройство в режиме обработки вершин программного обеспечения или переключено на режим обработки вершин программного обеспечения).</span><span class="sxs-lookup"><span data-stu-id="ab995-190">The device is always capable of clipping T&L vertices in the software vertex processing mode (regardless of whether the device is created in the software vertex processing mode, or switched to the software vertex processing mode).</span></span>

<span data-ttu-id="ab995-191">Единственным требованием для настройки параметров окна просмотра для устройства отрисовки является установка тома обрезки окна просмотра.</span><span class="sxs-lookup"><span data-stu-id="ab995-191">The only requirement for configuring the viewport parameters for a rendering device is to set the viewport's clipping volume.</span></span> <span data-ttu-id="ab995-192">Для этого инициализируйте и установите отсеченные значения для тома обрезки и для поверхности целевого объекта рендеринга.</span><span class="sxs-lookup"><span data-stu-id="ab995-192">To do this, you initialize and set clipping values for the clipping volume and for the render-target surface.</span></span> <span data-ttu-id="ab995-193">Обычно окна просмотра настроены для отображения в полную область поверхности целевого объекта рендеринга, но это не является обязательным.</span><span class="sxs-lookup"><span data-stu-id="ab995-193">Viewports are commonly set up to render to the full area of the render-target surface, but this isn't a requirement.</span></span>

<span data-ttu-id="ab995-194">Чтобы добиться этого в C++, можно использовать следующие параметры для членов структуры [**D3DVIEWPORT9**](d3dviewport9.md) .</span><span class="sxs-lookup"><span data-stu-id="ab995-194">You can use the following settings for the members of the [**D3DVIEWPORT9**](d3dviewport9.md) structure to achieve this in C++.</span></span>


```
D3DVIEWPORT9 viewData = { 0, 0, width, height, 0.0f, 1.0f };
```



<span data-ttu-id="ab995-195">После задания значений в структуре [**D3DVIEWPORT9**](d3dviewport9.md) примените параметры окна просмотра к устройству, вызвав его метод [**IDirect3DDevice9:: сетвиевпорт**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setviewport) .</span><span class="sxs-lookup"><span data-stu-id="ab995-195">After setting values in the [**D3DVIEWPORT9**](d3dviewport9.md) structure, apply the viewport parameters to the device by calling its [**IDirect3DDevice9::SetViewport**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setviewport) method.</span></span> <span data-ttu-id="ab995-196">В следующем примере кода показано, как может выглядеть этот вызов.</span><span class="sxs-lookup"><span data-stu-id="ab995-196">The following code example shows what this call might look like.</span></span>


```
HRESULT hr;

hr = pd3dDevice->SetViewport(&viewData);
if(FAILED(hr))
    return hr;
```



<span data-ttu-id="ab995-197">Если вызов завершится с ошибкой, параметры окна просмотра задаются и вступят в силу при следующем вызове метода отрисовки.</span><span class="sxs-lookup"><span data-stu-id="ab995-197">If the call succeeds, the viewport parameters are set and will take effect the next time a rendering method is called.</span></span> <span data-ttu-id="ab995-198">Чтобы внести изменения в параметры окна просмотра, просто обновите значения в структуре [**D3DVIEWPORT9**](d3dviewport9.md) и снова вызовите [**IDirect3DDevice9:: сетвиевпорт**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setviewport) .</span><span class="sxs-lookup"><span data-stu-id="ab995-198">To make changes to the viewport parameters, just update the values in the [**D3DVIEWPORT9**](d3dviewport9.md) structure and call [**IDirect3DDevice9::SetViewport**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setviewport) again.</span></span>

> [!Note]  
> <span data-ttu-id="ab995-199">Элементы структуры [**D3DVIEWPORT9**](d3dviewport9.md) Минз и максз указывают глубину, в которой будет выполняться визуализация сцены и которые не используются для обрезки.</span><span class="sxs-lookup"><span data-stu-id="ab995-199">The [**D3DVIEWPORT9**](d3dviewport9.md) structure members MinZ and MaxZ indicate the depth-ranges into which the scene will be rendered and are not used for clipping.</span></span> <span data-ttu-id="ab995-200">В большинстве приложений эти члены устанавливаются в 0,0 и 1,0, чтобы система отображалась во всем диапазоне значений глубины в буфере глубины.</span><span class="sxs-lookup"><span data-stu-id="ab995-200">Most applications set these members to 0.0 and 1.0 to enable the system to render to the entire range of depth values in the depth buffer.</span></span> <span data-ttu-id="ab995-201">В некоторых случаях можно добиться особых эффектов, используя другие диапазоны глубин.</span><span class="sxs-lookup"><span data-stu-id="ab995-201">In some cases, you can achieve special effects by using other depth ranges.</span></span> <span data-ttu-id="ab995-202">Например, для отрисовки экранных элементов в игре вы можно задать оба значения равными 0,0, чтобы заставить систему отрисовывать объекты в сцене на переднем плане, или задать их оба равными 1,0 для отрисовки объекта, который всегда должен находиться на заднем плане.</span><span class="sxs-lookup"><span data-stu-id="ab995-202">For instance, to render a heads-up display in a game, you can set both values to 0.0 to force the system to render objects in a scene in the foreground, or you might set them both to 1.0 to render an object that should always be in the background.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="ab995-203">См. также</span><span class="sxs-lookup"><span data-stu-id="ab995-203">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ab995-204">Начало работы</span><span class="sxs-lookup"><span data-stu-id="ab995-204">Getting Started</span></span>](getting-started.md)
</dt> </dl>

 

 
