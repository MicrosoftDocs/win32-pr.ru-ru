---
description: Содержимое текстур часто хранится в формате sRGB.
ms.assetid: d076140d-3e91-412a-b099-9baa52f8d7d8
title: Гамма (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4cea4b3ba224452e1c3be8f96b7136f4e4f649c8
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "105710563"
---
# <a name="gamma-direct3d-9"></a><span data-ttu-id="32336-103">Гамма (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="32336-103">Gamma (Direct3D 9)</span></span>

<span data-ttu-id="32336-104">Содержимое текстур часто хранится в формате sRGB.</span><span class="sxs-lookup"><span data-stu-id="32336-104">Texture content is often stored in sRGB format.</span></span> <span data-ttu-id="32336-105">Обычно конвейеры пикселей предполагают, что цвета будут линейными, поэтому операции смешения выполнялись в линейном пространстве.</span><span class="sxs-lookup"><span data-stu-id="32336-105">Traditionally, pixel pipelines assumed the colors to be linear so blending operations were performed in linear space.</span></span> <span data-ttu-id="32336-106">Однако, поскольку содержимое sRGB корректирует гамму, операции смешения в линейном пространстве приведут к неверным результатам.</span><span class="sxs-lookup"><span data-stu-id="32336-106">However, since sRGB content is gamma corrected, blending operations in linear space will produce incorrect results.</span></span> <span data-ttu-id="32336-107">Видеоадаптеры теперь могут устранить эту проблему, отменив гамму-коррекцию при считывании любого содержимого sRGB и преобразующие данные пикселей обратно в формат sRGB при записи пикселей.</span><span class="sxs-lookup"><span data-stu-id="32336-107">Video cards can now fix this problem by undoing the gamma correction when they read any sRGB content, and convert pixel data back to the sRGB format when writing out pixels.</span></span> <span data-ttu-id="32336-108">В этом случае все операции внутри пиксельного конвейера выполняются в линейном пространстве.</span><span class="sxs-lookup"><span data-stu-id="32336-108">In this case, all operations inside the pixel pipeline are performed in the linear space.</span></span>

## <a name="gamma-correction"></a><span data-ttu-id="32336-109">Гамма-коррекция</span><span class="sxs-lookup"><span data-stu-id="32336-109">Gamma Correction</span></span>

<span data-ttu-id="32336-110">Direct3D 9 может:</span><span class="sxs-lookup"><span data-stu-id="32336-110">Direct3D 9 can:</span></span>

-   <span data-ttu-id="32336-111">Укажите, исправлена ли текстура гамма-2,2 (sRGB или нет).</span><span class="sxs-lookup"><span data-stu-id="32336-111">Indicate whether a texture is gamma 2.2 corrected or not (sRGB or not).</span></span> <span data-ttu-id="32336-112">Драйвер будет преобразовываться в линейную гамму для операций смешения во время Сеттекстуре, или если образец будет преобразован в линейные данные во время поиска.</span><span class="sxs-lookup"><span data-stu-id="32336-112">The driver will either convert to a linear gamma for blending operations at SetTexture time, or the sampler will convert it to linear data at lookup time.</span></span>
-   <span data-ttu-id="32336-113">Укажите, следует ли перевернуть конвейер пикселей в пространство sRGB при записи в целевой объект прорисовки.</span><span class="sxs-lookup"><span data-stu-id="32336-113">Indicate whether the pixel pipeline should gamma correct back to sRGB space when writing out to the render target.</span></span>

<span data-ttu-id="32336-114">Все остальные цвета (снятие цвета, цвета материала, цвета вершин и т. д.) считаются линейным пространством.</span><span class="sxs-lookup"><span data-stu-id="32336-114">All other colors (clear color, material color, vertex color, etc.) are assumed to be in linear space.</span></span> <span data-ttu-id="32336-115">Приложения могут выполнять гамма-коррекцию цветов, записанных в буфер кадров, с помощью инструкций шейдера пикселей.</span><span class="sxs-lookup"><span data-stu-id="32336-115">Applications can gamma-correct the colors written into the frame buffer using pixel shader instructions.</span></span> <span data-ttu-id="32336-116">Линейную расрезку следует применять только к каналам RGB, а не к альфа-каналу.</span><span class="sxs-lookup"><span data-stu-id="32336-116">The linearization should be applied only to the RGB channels and not to the alpha channel.</span></span>

<span data-ttu-id="32336-117">Не все форматы поверхности могут быть линейно.</span><span class="sxs-lookup"><span data-stu-id="32336-117">Not all surface formats can be linearized.</span></span> <span data-ttu-id="32336-118">Линейно можно выполнять только форматы, которые передают [**чеккдевицеформат**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat) с помощью D3DUSAGE \_ запросов \_ сргбреад.</span><span class="sxs-lookup"><span data-stu-id="32336-118">Only the formats that pass [**CheckDeviceFormat**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat) with D3DUSAGE\_QUERY\_SRGBREAD can be linearized.</span></span> <span data-ttu-id="32336-119">Состояние образца D3DSAMP \_ сргбтекстуре игнорируется для остальных.</span><span class="sxs-lookup"><span data-stu-id="32336-119">The sampler state D3DSAMP\_SRGBTEXTURE is ignored for the rest.</span></span> <span data-ttu-id="32336-120">Для этого преобразования должны поддерживаться только форматы текстур без знака.</span><span class="sxs-lookup"><span data-stu-id="32336-120">Only unsigned texture formats are expected to support this conversion.</span></span> <span data-ttu-id="32336-121">Неподписанные форматы текстур включают только компоненты R, G, B и L.</span><span class="sxs-lookup"><span data-stu-id="32336-121">Unsigned texture formats include only R, G, B, and L components.</span></span> <span data-ttu-id="32336-122">Если имеется альфа-канал, он игнорируется.</span><span class="sxs-lookup"><span data-stu-id="32336-122">If the alpha channel is present, it is ignored.</span></span> <span data-ttu-id="32336-123">Если смешанные форматы поддерживают линейную расрезку sRGB, затрагиваются только неподписанные каналы.</span><span class="sxs-lookup"><span data-stu-id="32336-123">If mixed formats support sRGB linearization, only the unsigned channels are affected.</span></span> <span data-ttu-id="32336-124">В идеале оборудование должно выполнить линейную фильтрацию до фильтрации, но в Direct3D 9 оборудование может выполнять линейную расрезку после фильтрации.</span><span class="sxs-lookup"><span data-stu-id="32336-124">Ideally, hardware should perform the linearization before filtering but in Direct3D 9, hardware is allowed to perform the linearization after filtering.</span></span>

<span data-ttu-id="32336-125">Не все форматы поверхности могут быть записаны в пространстве sRGB.</span><span class="sxs-lookup"><span data-stu-id="32336-125">Not all surface formats can be written in sRGB space.</span></span> <span data-ttu-id="32336-126">Линейно можно использовать только форматы, которые проходят [**чеккдевицеформат**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat) с флагом использования D3DUSAGE \_ Query \_ сргбврите.</span><span class="sxs-lookup"><span data-stu-id="32336-126">Only the formats that pass the [**CheckDeviceFormat**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat) with the usage flag D3DUSAGE\_QUERY\_SRGBWRITE can be linearized.</span></span> <span data-ttu-id="32336-127">Состояние отрисовки D3DRS \_ сргбвритинабле игнорируется для остальных.</span><span class="sxs-lookup"><span data-stu-id="32336-127">The render state D3DRS\_SRGBWRITEENABLE is ignored for the rest.</span></span> <span data-ttu-id="32336-128">Для обеспечения этой возможности ожидается восемь бит на канал в форматах RGB без подписи.</span><span class="sxs-lookup"><span data-stu-id="32336-128">Eight bits per channel RGB unsigned formats are expected to expose this ability.</span></span>

<span data-ttu-id="32336-129">В идеале оборудование должно выполнять операции смешения буферов кадров в линейном пространстве, но после построителя текстуры, но до постановки в буфер кадров это оборудование разрешается выполнять.</span><span class="sxs-lookup"><span data-stu-id="32336-129">Ideally, hardware should perform the frame buffer blending operations in the linear space, but hardware is allowed to perform it after the pixel shader but before the frame buffer blender.</span></span> <span data-ttu-id="32336-130">Это означает, что операции смешения буферов кадров, которые выполняются в пространстве sRGB, приведут к неверным результатам.</span><span class="sxs-lookup"><span data-stu-id="32336-130">This means that the frame buffer blending operations that take place in sRGB space will produce incorrect results.</span></span> <span data-ttu-id="32336-131">D3DRS \_ сргбвритинабле учитывается при выполнении очистки целевого объекта рендеринга.</span><span class="sxs-lookup"><span data-stu-id="32336-131">D3DRS\_SRGBWRITEENABLE is honored while performing a clear of the render target.</span></span> <span data-ttu-id="32336-132">Для оборудования, поддерживающего [несколько целевых объектов отрисовки (Direct3D 9)](multiple-render-targets.md) или [текстур с несколькими элементами (Direct3D 9)](multiple-element-textures.md), записывается только первый целевой объект отрисовки или элемент.</span><span class="sxs-lookup"><span data-stu-id="32336-132">For hardware that supports [Multiple Render Targets (Direct3D 9)](multiple-render-targets.md) or [Multiple-element Textures (Direct3D 9)](multiple-element-textures.md), only the first render target or element is written.</span></span>

### <a name="api-changes"></a><span data-ttu-id="32336-133">Изменения API</span><span class="sxs-lookup"><span data-stu-id="32336-133">API Changes</span></span>


```
// New sampler state (DWORD)
// If this is nonzero, the texture is linearized on lookup.
D3DSAMP_SRGBTEXTURE       // Default FALSE

// New render state (DWORD)
D3DRS_SRGBWRITEENABLE     // Default FALSE

// New usage flags
D3DUSAGE_QUERY_SRGBWRITE
D3DUSAGE_QUERY_SRGBREAD
```



### <a name="windowed-swap-chains"></a><span data-ttu-id="32336-134">Цепочки подкачки с окнами</span><span class="sxs-lookup"><span data-stu-id="32336-134">Windowed Swap Chains</span></span>

<span data-ttu-id="32336-135">В приложениях очень важно, чтобы приложения продолжали буферы их цепочек подкачки в линейном пространстве, чтобы обеспечить правильные операции смешения.</span><span class="sxs-lookup"><span data-stu-id="32336-135">It is valuable for applications to keep the back buffers of their swap chains in linear space in order to enable correct blending operations.</span></span> <span data-ttu-id="32336-136">Так как рабочий стол обычно не находится в линейном пространстве, для представления содержимого заднего буфера требуется гамма-коррекция.</span><span class="sxs-lookup"><span data-stu-id="32336-136">Since the desktop is typically not in linear space, a gamma correction is required before the contents of the back buffer can be presented.</span></span> <span data-ttu-id="32336-137">Приложение может влиять на это исправление, выделяя дополнительный буфер и выполняя собственную копию из линейного буфера в задний буфер.</span><span class="sxs-lookup"><span data-stu-id="32336-137">The application can effect this correction itself by allocating an additional buffer and performing its own correcting copy from the linear buffer to the back buffer.</span></span> <span data-ttu-id="32336-138">Это требует дополнительной копии, которую можно избежать, если драйвер выполняет гамма-коррекцию в рамках презентации Блит.</span><span class="sxs-lookup"><span data-stu-id="32336-138">This necessitates an extra copy which can be avoided if the driver performs gamma correction as part of the presentation blit.</span></span>

<span data-ttu-id="32336-139">В Direct3D 9 новый флаг, [D3DPRESENT \_ линейное \_ содержимое](d3dpresent.md), доступен для [**отображения**](/windows/desktop/api) , что позволяет презентации неявным образом преобразовать из линейного пространства в sRGB/гамма 2,2.</span><span class="sxs-lookup"><span data-stu-id="32336-139">In Direct3D 9 a new flag, [D3DPRESENT\_LINEAR\_CONTENT](d3dpresent.md), is available for [**Present**](/windows/desktop/api) that allows the presentation to implicitly convert from linear space to sRGB/gamma 2.2.</span></span> <span data-ttu-id="32336-140">Приложения должны указывать этот флаг, если формат буфера в виде 16-разрядной плавающей запятой соответствует режиму, заданному в оконном режиме, с возможностью гаммы полноэкранного режима, при условии, \_ \_ что для \_ \_ возможностей устройств, получаемых через [**жетдевицекапс**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-getdevicecaps), возвращается D3DCAPS3 линейное представление sRGB.</span><span class="sxs-lookup"><span data-stu-id="32336-140">Applications should specify this flag if the backbuffer format is 16-bit floating point in order to match windowed mode present to full screen gamma behavior, provided D3DCAPS3\_LINEAR\_TO\_SRGB\_PRESENTATION is returned for device capabilities retrieved through [**GetDeviceCaps**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-getdevicecaps).</span></span>

## <a name="related-topics"></a><span data-ttu-id="32336-141">См. также</span><span class="sxs-lookup"><span data-stu-id="32336-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="32336-142">Буфер кадров</span><span class="sxs-lookup"><span data-stu-id="32336-142">Frame Buffer</span></span>](frame-buffer.md)
</dt> </dl>

 

 
