---
description: Управление ресурсами — это процесс, в ходе которого ресурсы переносятся из хранилища системной памяти в хранилище, доступное для устройств, и удаляются из хранилища, доступного для устройств.
ms.assetid: 4aa55313-b86c-48e7-829a-a0917c2ebae7
title: Управление ресурсами (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 30ef7a8be0e71c652b6e3f2ed467e866fd922791
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104262359"
---
# <a name="managing-resources-direct3d-9"></a><span data-ttu-id="ef9ee-103">Управление ресурсами (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="ef9ee-103">Managing Resources (Direct3D 9)</span></span>

<span data-ttu-id="ef9ee-104">Управление ресурсами — это процесс, в ходе которого ресурсы переносятся из хранилища системной памяти в хранилище, доступное для устройств, и удаляются из хранилища, доступного для устройств.</span><span class="sxs-lookup"><span data-stu-id="ef9ee-104">Resource management is the process where resources are promoted from system-memory storage to device-accessible storage and discarded from device-accessible storage.</span></span> <span data-ttu-id="ef9ee-105">Во время выполнения Direct3D используется собственный алгоритм управления, основанный на методе приоритета "самый последний раз".</span><span class="sxs-lookup"><span data-stu-id="ef9ee-105">The Direct3D run time has its own management algorithm based on a least-recently-used priority technique.</span></span> <span data-ttu-id="ef9ee-106">Direct3D переключается на наиболее часто используемый метод приоритета при обнаружении того, что больше ресурсов, чем могут сосуществовать в памяти, доступной для устройств, используется в одном кадре между [**IDirect3DDevice9:: бегинсцене**](/windows/desktop/api) и [**IDirect3DDevice9:: ендсцене**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-endscene) .</span><span class="sxs-lookup"><span data-stu-id="ef9ee-106">Direct3D switches to a most-recently-used priority technique when it detects that more resources than can coexist in device-accessible memory are used in a single frame - between [**IDirect3DDevice9::BeginScene**](/windows/desktop/api) and [**IDirect3DDevice9::EndScene**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-endscene) calls.</span></span>

<span data-ttu-id="ef9ee-107">Используйте флаг [**D3DPOOL \_ по умолчанию**](./d3dpool.md) во время создания, чтобы указать, что ресурс помещается в пул памяти, наиболее подходящий для набора использований, запрошенных для данного ресурса.</span><span class="sxs-lookup"><span data-stu-id="ef9ee-107">Use the [**D3DPOOL\_DEFAULT**](./d3dpool.md) flag at creation time to specify that a resource are placed in the memory pool most appropriate for the set of usages requested for the given resource.</span></span> <span data-ttu-id="ef9ee-108">Обычно это видеопамять, в том числе как локальная видеопамять, так и графическая карта (AGP).</span><span class="sxs-lookup"><span data-stu-id="ef9ee-108">This is usually video memory, including both local video memory and accelerated graphics port (AGP) memory.</span></span> <span data-ttu-id="ef9ee-109">Ресурсы в пуле по умолчанию не сохраняются посредством переходов между потерянным и операционным состояниями устройства.</span><span class="sxs-lookup"><span data-stu-id="ef9ee-109">Resources in the default pool do not persist through transitions between the lost and operational states of the device.</span></span> <span data-ttu-id="ef9ee-110">Эти ресурсы должны быть освобождены перед вызовом Reset и затем должны быть созданы повторно.</span><span class="sxs-lookup"><span data-stu-id="ef9ee-110">These resources must be released before calling reset and must then be re-created.</span></span>

<span data-ttu-id="ef9ee-111">Используйте [**\_ управляемый флаг D3DPOOL**](./d3dpool.md) во время создания, чтобы указать управляемый ресурс.</span><span class="sxs-lookup"><span data-stu-id="ef9ee-111">Use the [**D3DPOOL\_MANAGED**](./d3dpool.md) flag at creation time to specify a managed resource.</span></span> <span data-ttu-id="ef9ee-112">Управляемые ресурсы сохраняются посредством переходов между потерянным и операционным состояниями устройства.</span><span class="sxs-lookup"><span data-stu-id="ef9ee-112">Managed resources persist through transitions between the lost and operational states of the device.</span></span> <span data-ttu-id="ef9ee-113">Эти ресурсы существуют в видео и системной памяти.</span><span class="sxs-lookup"><span data-stu-id="ef9ee-113">These resources exist both in video and system memory.</span></span> <span data-ttu-id="ef9ee-114">Управляемый ресурс будет скопирован в видеопамять, когда он понадобится во время подготовки к просмотру.</span><span class="sxs-lookup"><span data-stu-id="ef9ee-114">A managed resource will be copied into video memory when it is needed during rendering.</span></span> <span data-ttu-id="ef9ee-115">Устройство можно восстановить с помощью вызова [**IDirect3DDevice9:: Reset**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-reset), и такие ресурсы продолжают работать нормально без повторной загрузки с данными.</span><span class="sxs-lookup"><span data-stu-id="ef9ee-115">The device can be restored with a call to [**IDirect3DDevice9::Reset**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-reset), and such resources continue to function normally without being reloaded with data.</span></span> <span data-ttu-id="ef9ee-116">Однако если устройство должно быть уничтожено и создано повторно, все ресурсы необходимо создать заново.</span><span class="sxs-lookup"><span data-stu-id="ef9ee-116">However, if the device must be destroyed and re-created, all resources must be re-created.</span></span>

<span data-ttu-id="ef9ee-117">Управление ресурсами не рекомендуется для ресурсов, которые меняются с высокой частотой.</span><span class="sxs-lookup"><span data-stu-id="ef9ee-117">Resource management is not recommended for resources which change with high frequency.</span></span> <span data-ttu-id="ef9ee-118">Например, буферы вершин и индексов, которые используются для прохода по графу сцены, каждый кадр отображают только геометрию, видимую для пользователя, каждый кадр изменяется.</span><span class="sxs-lookup"><span data-stu-id="ef9ee-118">For example, vertex and index buffers which are used to traverse a scene graph every frame rendering only geometry visible to the user changes every frame.</span></span> <span data-ttu-id="ef9ee-119">Так как управляемые ресурсы поддерживаются системной памятью, постоянные изменения должны быть обновлены в системной памяти, что может привести к серьезному снижению производительности.</span><span class="sxs-lookup"><span data-stu-id="ef9ee-119">Since managed resources are backed by system memory, the constant changes must be updated in system memory, which can cause a severe degradation in performance.</span></span> <span data-ttu-id="ef9ee-120">Для этого конкретного сценария следует использовать [**D3DPOOL \_ по умолчанию**](./d3dpool.md) вместе с [**D3DUSAGE \_ dynamic**](d3dusage.md) .</span><span class="sxs-lookup"><span data-stu-id="ef9ee-120">For this particular scenario, [**D3DPOOL\_DEFAULT**](./d3dpool.md) along with [**D3DUSAGE\_DYNAMIC**](d3dusage.md) should be used.</span></span>

<span data-ttu-id="ef9ee-121">Еще один пример, в котором управление ресурсами не рекомендуется (и явно не разрешено средой выполнения), — это управление текстурой, созданной с помощью [**D3DUSAGE \_ рендертаржет**](d3dusage.md).</span><span class="sxs-lookup"><span data-stu-id="ef9ee-121">Another example for which resource management is not recommended (and explicitly not allowed by the runtime) is management of a texture created with [**D3DUSAGE\_RENDERTARGET**](d3dusage.md).</span></span> <span data-ttu-id="ef9ee-122">Если память, используемая объектами прорисовки, была управляться средой выполнения, ее содержимое будет постоянно копироваться в системную память во время подготовки к просмотру, что приведет к значительному снижению производительности.</span><span class="sxs-lookup"><span data-stu-id="ef9ee-122">If the memory used by render targets were managed by the runtime, it's contents would have to constantly be copied to system memory during rendering, causing large performance penalties.</span></span> <span data-ttu-id="ef9ee-123">По этой причине целевые объекты рендеринга должны быть созданы в пуле по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="ef9ee-123">For this reason, render targets must be created in the default pool.</span></span> <span data-ttu-id="ef9ee-124">Если требуется доступ ЦП к данным, содержащимся в целевом объекте прорисовки, данные должны быть скопированы в ресурс, созданный в [**D3DPOOL \_ системмем**](./d3dpool.md) с помощью [**IDirect3DDevice9:: упдатетекстуре**](/windows/desktop/api)или [**IDirect3DDevice9:: упдатесурфаце**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-updatesurface)</span><span class="sxs-lookup"><span data-stu-id="ef9ee-124">If CPU access of the data contained in a render target is needed, the data must be copied to a resource created in [**D3DPOOL\_SYSTEMMEM**](./d3dpool.md) using [**IDirect3DDevice9::UpdateTexture**](/windows/desktop/api), or [**IDirect3DDevice9::UpdateSurface**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-updatesurface)</span></span>

<span data-ttu-id="ef9ee-125">Дополнительные сведения о состоянии потерянного устройства см. в разделе [потерянные устройства (Direct3D 9)](lost-devices.md).</span><span class="sxs-lookup"><span data-stu-id="ef9ee-125">For more information about the lost state of a device, see [Lost Devices (Direct3D 9)](lost-devices.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="ef9ee-126">См. также</span><span class="sxs-lookup"><span data-stu-id="ef9ee-126">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ef9ee-127">Ресурсы Direct3D</span><span class="sxs-lookup"><span data-stu-id="ef9ee-127">Direct3D Resources</span></span>](direct3d-resources.md)
</dt> </dl>

 

 
