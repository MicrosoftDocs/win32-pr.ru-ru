---
description: Сферовые карты среды или географические карты — это специальные текстуры, которые содержат изображение сцены вокруг объекта или эффекты освещения объекта.
ms.assetid: b4a8defc-876f-4a23-a12e-e7423a1e8f89
title: Сопоставление сферического окружения (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e9b0e7aaa123478ecc7cc327dca0b13a8aae3d0c
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "105673047"
---
# <a name="spherical-environment-mapping-direct3d-9"></a><span data-ttu-id="94f0d-103">Сопоставление сферического окружения (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="94f0d-103">Spherical Environment Mapping (Direct3D 9)</span></span>

<span data-ttu-id="94f0d-104">Сферовые карты среды или географические карты — это специальные текстуры, которые содержат изображение сцены вокруг объекта или эффекты освещения объекта.</span><span class="sxs-lookup"><span data-stu-id="94f0d-104">Spherical environment maps, or sphere maps, are special textures that contain an image of the scene surrounding an object, or the lighting effects around the object.</span></span> <span data-ttu-id="94f0d-105">В отличие от сопоставлений в кубических средах, карты сфер не представляют собой окружающую окружение объекта напрямую.</span><span class="sxs-lookup"><span data-stu-id="94f0d-105">Unlike cubic environment maps, sphere maps don't directly represent an object's surroundings.</span></span> <span data-ttu-id="94f0d-106">В разделе изображение чайник в [сопоставлении среды (Direct3D 9)](environment-mapping.md) показаны эффекты отражения, которые можно достичь с помощью сопоставления сфер.</span><span class="sxs-lookup"><span data-stu-id="94f0d-106">The teapot image in [Environment Mapping (Direct3D 9)](environment-mapping.md) topic shows the reflection effects you can achieve with sphere mapping.</span></span> <span data-ttu-id="94f0d-107">Геообъектная схема — это 2D-представление полного (в 360 градусов) представления сцены вокруг объекта, как показано на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="94f0d-107">A sphere map is a 2D representation of the full 360-degree view of the scene surrounding of an object, as if taken through a fish-eye lens, as shown in the following illustration.</span></span>

![Иллюстрация геообъектной схемы внутри здания](images/spheremap.png)

## <a name="texture-coordinates-for-spherical-environment-maps"></a><span data-ttu-id="94f0d-109">Координаты текстур для сферического сопоставления среды</span><span class="sxs-lookup"><span data-stu-id="94f0d-109">Texture Coordinates for Spherical Environment Maps</span></span>

<span data-ttu-id="94f0d-110">Координаты текстуры, указываемые для каждой вершины, получающей сопоставление среды, должны обращаться к текстуре в качестве функции отраженного искажения, созданного в кривизне поверхности.</span><span class="sxs-lookup"><span data-stu-id="94f0d-110">The texture coordinates that you specify for each vertex receiving an environment mapping should address the texture as a function of the reflective distortion created by the curvature of the surface.</span></span> <span data-ttu-id="94f0d-111">Приложения должны вычислять эти координаты текстуры для каждой вершины, чтобы добиться желаемого результата.</span><span class="sxs-lookup"><span data-stu-id="94f0d-111">Applications must compute these texture coordinates for each vertex to achieve the desired effect.</span></span> <span data-ttu-id="94f0d-112">Один простой и эффективный способ создания координат текстуры использует нормаль вершины в качестве входных данных.</span><span class="sxs-lookup"><span data-stu-id="94f0d-112">One simple and effective way to generate texture coordinates uses the vertex normal as input.</span></span> <span data-ttu-id="94f0d-113">Хотя существует несколько методов, в приложениях, выполняющих сопоставление сред с картами Sphere, часто встречается следующее уравнение.</span><span class="sxs-lookup"><span data-stu-id="94f0d-113">Although several methods exist, the following equation is common among applications that perform environment mapping with sphere maps.</span></span>

![уравнение вычисления координат текстуры для геообъектной гиперкарты](images/spheremap-formula.png)

<span data-ttu-id="94f0d-115">В этих формулах вы и v используете вычисленные координаты текстуры, а N<sub>x</sub> и n<sub>Y</sub> — это компоненты X и y вершинного пространства камеры.</span><span class="sxs-lookup"><span data-stu-id="94f0d-115">In these formulas, u and v are the texture coordinates being computed, and N<sub>X</sub> and N<sub>Y</sub> are the x and y components of the camera-space vertex normal.</span></span> <span data-ttu-id="94f0d-116">Формула проста, но эффективна.</span><span class="sxs-lookup"><span data-stu-id="94f0d-116">The formula is simple but effective.</span></span> <span data-ttu-id="94f0d-117">Если у обычного компонента есть положительный компонент x, нормальная точка накладывается вправо, а координата u корректируется соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="94f0d-117">If the normal has a positive x component, the normal points to the right, and the u coordinate is adjusted to address the texture appropriately.</span></span> <span data-ttu-id="94f0d-118">Аналогично для координаты v: положительный y означает, что нормальная точка вверх.</span><span class="sxs-lookup"><span data-stu-id="94f0d-118">Likewise for the v coordinate: positive y indicates that the normal points up.</span></span> <span data-ttu-id="94f0d-119">Противоположное значение верно для отрицательных значений в каждом компоненте.</span><span class="sxs-lookup"><span data-stu-id="94f0d-119">The opposite is true for negative values in each component.</span></span>

<span data-ttu-id="94f0d-120">Если нормальные точки находятся непосредственно на камере, в результирующих координатах не должно быть искажений.</span><span class="sxs-lookup"><span data-stu-id="94f0d-120">If the normal points directly at the camera, the resulting coordinates should receive no distortion.</span></span> <span data-ttu-id="94f0d-121">Смещение + 0,5 для обеих координат помещает точку нулевого искажения в центр геообъектической схемы, а вершинный нормаль (0, 0, z) — в эту точку.</span><span class="sxs-lookup"><span data-stu-id="94f0d-121">The +0.5 bias to both coordinates places the point of zero-distortion at the center of the sphere map, and a vertex normal of (0, 0, z) addresses this point.</span></span> <span data-ttu-id="94f0d-122">Эта формула не учитывает z-компонент нормали, но приложения, использующие эту формулу, могут оптимизировать вычисления, пропуская вершины с обычным элементом z.</span><span class="sxs-lookup"><span data-stu-id="94f0d-122">This formula doesn't account for the z component of the normal, but applications that use the formula can optimize computations by skipping vertices with a normal that has a positive z element.</span></span> <span data-ttu-id="94f0d-123">Это работает для объектов с плоским затенением, так как в пространстве камеры, если обычные точки из камеры (положительное значение z), вершина исключается при подготовке объекта к просмотру.</span><span class="sxs-lookup"><span data-stu-id="94f0d-123">This works for flat-shaded objects because, in camera space, if the normal points away from the camera (positive z), the vertex is culled when the object is rendered.</span></span> <span data-ttu-id="94f0d-124">Для объектов, затененных по методу Гуро, обычная точка может указывать на сторону от камеры (положительный x), а треугольник, содержащий вершину, по-прежнему может быть видимым.</span><span class="sxs-lookup"><span data-stu-id="94f0d-124">For Gouraud-shaded objects, a normal can point away from the camera (positive x), and the triangle containing the vertex can still be visible.</span></span> <span data-ttu-id="94f0d-125">Если вы не Вычислите вы и v для этой вершины, то, возможно, он все еще используется, что приведет к непредвиденному поведению.</span><span class="sxs-lookup"><span data-stu-id="94f0d-125">If you don't compute u and v for this vertex, the face might still be used, resulting in unexpected behavior.</span></span>

## <a name="applying-spherical-environment-maps"></a><span data-ttu-id="94f0d-126">Применение карт для сферического окружения</span><span class="sxs-lookup"><span data-stu-id="94f0d-126">Applying Spherical Environment Maps</span></span>

<span data-ttu-id="94f0d-127">Вы применяете соответствие среды к объектам так же, как и для любой другой текстуры, настроив текстуру на соответствующую стадию текстуры с помощью метода [**IDirect3DDevice9:: сеттекстуре**](/windows/desktop/api) .</span><span class="sxs-lookup"><span data-stu-id="94f0d-127">You apply an environment map to objects in the same manner as for any other texture, by setting the texture to the appropriate texture stage with the [**IDirect3DDevice9::SetTexture**](/windows/desktop/api) method.</span></span> <span data-ttu-id="94f0d-128">Задайте для первого параметра индекс требуемой стадии текстуры и задайте для второго параметра адрес интерфейса [**IDirect3DDevice9**](/windows/win32/api/d3d9helper/nn-d3d9helper-idirect3ddevice9) , возвращаемого при создании текстуры для карты среды.</span><span class="sxs-lookup"><span data-stu-id="94f0d-128">Set the first parameter to the index for the desired texture stage, and set the second parameter to the address of the [**IDirect3DDevice9**](/windows/win32/api/d3d9helper/nn-d3d9helper-idirect3ddevice9) interface returned when you created the texture for the environment map.</span></span> <span data-ttu-id="94f0d-129">Для достижения требуемых эффектов смешения текстур можно задать цветовую и альфа-операции смешения и аргументы.</span><span class="sxs-lookup"><span data-stu-id="94f0d-129">You can set the color and alpha blending operations and arguments as needed to achieve the desired texture blending effects.</span></span>

## <a name="related-topics"></a><span data-ttu-id="94f0d-130">См. также</span><span class="sxs-lookup"><span data-stu-id="94f0d-130">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="94f0d-131">Сопоставление окружения</span><span class="sxs-lookup"><span data-stu-id="94f0d-131">Environment Mapping</span></span>](environment-mapping.md)
</dt> </dl>

 

 
