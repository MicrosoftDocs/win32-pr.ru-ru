---
description: Управление текстурами — это процесс определения текстур, необходимых для отрисовки в определенный момент времени, и обеспечения загрузки этих текстур в видеопамять.
ms.assetid: ea6d64ee-f570-49eb-b5fd-67fcde3f8ddc
title: Автоматическое управление текстурами (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d0eb14eede197661bc127a062229ebed31274ae8
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103896310"
---
# <a name="automatic-texture-management-direct3d-9"></a><span data-ttu-id="5eca2-103">Автоматическое управление текстурами (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="5eca2-103">Automatic Texture Management (Direct3D 9)</span></span>

<span data-ttu-id="5eca2-104">Управление текстурами — это процесс определения текстур, необходимых для отрисовки в определенный момент времени, и обеспечения загрузки этих текстур в видеопамять.</span><span class="sxs-lookup"><span data-stu-id="5eca2-104">Texture management is the process of determining which textures are needed for rendering at a given time and ensuring that those textures are loaded into video memory.</span></span> <span data-ttu-id="5eca2-105">Как и в случае с любым алгоритмом, схемы управления текстурами различаются по сложности, но любой подход к управлению текстурами включает следующие ключевые задачи.</span><span class="sxs-lookup"><span data-stu-id="5eca2-105">As with any algorithm, texture management schemes vary in complexity, but any approach to texture management involves the following key tasks.</span></span>

-   <span data-ttu-id="5eca2-106">Отслеживание объема доступной памяти текстуры.</span><span class="sxs-lookup"><span data-stu-id="5eca2-106">Tracking the amount of available texture memory.</span></span>
-   <span data-ttu-id="5eca2-107">Вычисление текстур, необходимых для подготовки к просмотру, а не.</span><span class="sxs-lookup"><span data-stu-id="5eca2-107">Calculating which textures are needed for rendering, and which are not.</span></span>
-   <span data-ttu-id="5eca2-108">Определение, какие существующие ресурсы текстуры можно загрузить с помощью другого изображения текстуры, и какие поверхности должны быть уничтожены и заменены новыми ресурсами текстуры.</span><span class="sxs-lookup"><span data-stu-id="5eca2-108">Determining which existing texture resources can be reloaded with another texture image, and which surfaces should be destroyed and replaced with new texture resources.</span></span>

<span data-ttu-id="5eca2-109">Direct3D реализует управление текстурами, поддерживаемое системой, чтобы обеспечить оптимальную производительность для загрузки текстур.</span><span class="sxs-lookup"><span data-stu-id="5eca2-109">Direct3D implements system-supported texture management to ensure that textures are loaded for optimal performance.</span></span> <span data-ttu-id="5eca2-110">Ресурсы текстуры, которыми управляет Direct3D, называются управляемыми текстурами.</span><span class="sxs-lookup"><span data-stu-id="5eca2-110">Texture resources that Direct3D manages are referred to as managed textures.</span></span>

<span data-ttu-id="5eca2-111">Диспетчер текстуры отслеживает текстуры с меткой времени, которая определяет время последнего использования текстуры.</span><span class="sxs-lookup"><span data-stu-id="5eca2-111">The texture manager tracks textures with a time-stamp that identifies when the texture was last used.</span></span> <span data-ttu-id="5eca2-112">Затем он использует алгоритм наименее недавно использовавшийся, чтобы определить, какие текстуры следует удалить.</span><span class="sxs-lookup"><span data-stu-id="5eca2-112">It then uses a least-recently-used algorithm to determine which textures should be removed.</span></span> <span data-ttu-id="5eca2-113">Приоритеты текстур используются в качестве отсчетных прерываний, если две текстуры предназначены для удаления из памяти.</span><span class="sxs-lookup"><span data-stu-id="5eca2-113">Texture priorities are used as tie breakers when two textures are targeted for removal from memory.</span></span> <span data-ttu-id="5eca2-114">Если две текстуры имеют одинаковое значение приоритета, то будет удалена текстура с наименьшим использованием.</span><span class="sxs-lookup"><span data-stu-id="5eca2-114">If two textures have the same priority value, the least-recently-used texture is removed.</span></span> <span data-ttu-id="5eca2-115">Однако если две текстуры имеют одинаковую отметку времени, сначала удаляется текстура с более низким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="5eca2-115">However, if two textures have the same time-stamp, the texture that has a lower priority is removed first.</span></span>

<span data-ttu-id="5eca2-116">Вы запрашиваете автоматическое управление текстурой для поверхностей текстуры при их создании.</span><span class="sxs-lookup"><span data-stu-id="5eca2-116">You request automatic texture management for texture surfaces when you create them.</span></span> <span data-ttu-id="5eca2-117">Чтобы получить управляемую текстуру в приложении C++, создайте ресурс текстуры, вызвав [**IDirect3DDevice9:: креатетекстуре**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) и указав D3DPOOL, \_ управляемую для параметра pool.</span><span class="sxs-lookup"><span data-stu-id="5eca2-117">To retrieve a managed texture in a C++ application, create a texture resource by calling [**IDirect3DDevice9::CreateTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) and specifying the D3DPOOL\_MANAGED for the Pool parameter.</span></span> <span data-ttu-id="5eca2-118">Вы не можете указать, где должна быть создана текстура.</span><span class="sxs-lookup"><span data-stu-id="5eca2-118">You are not allowed to specify where you want the texture created.</span></span> <span data-ttu-id="5eca2-119">\_При создании управляемой текстуры нельзя использовать флаги D3DPOOL по умолчанию или D3DPOOL \_ системмем.</span><span class="sxs-lookup"><span data-stu-id="5eca2-119">You cannot use the D3DPOOL\_DEFAULT or D3DPOOL\_SYSTEMMEM flags when creating a managed texture.</span></span> <span data-ttu-id="5eca2-120">После создания управляемой текстуры можно вызвать метод [**IDirect3DDevice9:: сеттекстуре**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-settexture) , чтобы задать для него этап на текстуре устройства отрисовки каскадом.</span><span class="sxs-lookup"><span data-stu-id="5eca2-120">After creating the managed texture, you can call the [**IDirect3DDevice9::SetTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-settexture) method to set it to a stage in the rendering device's texture cascade.</span></span>

<span data-ttu-id="5eca2-121">Можно назначить приоритет управляемым текстурам, вызвав метод [**IDirect3DResource9:: SetPriority**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dresource9-setpriority) для поверхности текстуры.</span><span class="sxs-lookup"><span data-stu-id="5eca2-121">You can assign a priority to managed textures by calling the [**IDirect3DResource9::SetPriority**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dresource9-setpriority) method for the texture surface.</span></span>

<span data-ttu-id="5eca2-122">Direct3D автоматически скачивает текстуры в видеопамяти по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="5eca2-122">Direct3D automatically downloads textures into video memory as needed.</span></span> <span data-ttu-id="5eca2-123">Система может кэшировать управляемые текстуры в локальной или нелокальной видеопамяти в зависимости от доступности нелокальной видеопамяти или других факторов.</span><span class="sxs-lookup"><span data-stu-id="5eca2-123">The system might cache managed textures in local or nonlocal video memory, depending on the availability of nonlocal video memory or other factors.</span></span> <span data-ttu-id="5eca2-124">Расположение кэша управляемых текстур не передается в ваше приложение, и эти сведения не требуются для использования автоматического управления текстурами.</span><span class="sxs-lookup"><span data-stu-id="5eca2-124">The cache location of your managed textures is not communicated to your application, nor is this information required to use automatic texture management.</span></span> <span data-ttu-id="5eca2-125">Если приложение использует больше текстур, чем может уместиться в видеопамяти, Direct3D удаляет старые текстуры из видеопамяти, чтобы освободить место для новых текстур.</span><span class="sxs-lookup"><span data-stu-id="5eca2-125">If your application uses more textures than can fit in video memory, Direct3D removes older textures from video memory to make room for the new textures.</span></span> <span data-ttu-id="5eca2-126">Если вы снова используете удаленную текстуру, система использует исходную поверхность текстуры системной памяти для перезагрузки текстуры в кэш видеопамяти.</span><span class="sxs-lookup"><span data-stu-id="5eca2-126">If you use a removed texture again, the system uses the original system-memory texture surface to reload the texture in the video-memory cache.</span></span> <span data-ttu-id="5eca2-127">Хотя перезагрузка текстуры необходима, она также снижает производительность приложения.</span><span class="sxs-lookup"><span data-stu-id="5eca2-127">Although reloading the texture is necessary, it also decreases the application's performance.</span></span>

<span data-ttu-id="5eca2-128">Можно динамически изменить исходную копию в памяти системы путем обновления или блокировки ресурса текстуры.</span><span class="sxs-lookup"><span data-stu-id="5eca2-128">You can dynamically modify the original system-memory copy of the texture by updating or locking the texture resource.</span></span> <span data-ttu-id="5eca2-129">Когда система обнаруживает "грязную" поверхность — после завершения обновления или при разблокировании, диспетчер текстур автоматически обновляет копию текстуры в видеопамяти.</span><span class="sxs-lookup"><span data-stu-id="5eca2-129">When the system detects a dirty surface - after an update is completed, or when the surface is unlocked - the texture manager automatically updates the video-memory copy of the texture.</span></span> <span data-ttu-id="5eca2-130">Снижение производительности похоже на повторную загрузку удаленной текстуры.</span><span class="sxs-lookup"><span data-stu-id="5eca2-130">The performance hit incurred is similar to reloading a removed texture.</span></span>

<span data-ttu-id="5eca2-131">При вводе нового уровня в игру приложению может потребоваться сбросить все управляемые текстуры из видеопамяти (путем вызова [**IDirect3DDevice9:: евиктманажедресаурцес**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-evictmanagedresources)).</span><span class="sxs-lookup"><span data-stu-id="5eca2-131">When entering a new level in a game, your application might need to flush all managed textures from video memory (by calling [**IDirect3DDevice9::EvictManagedResources**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-evictmanagedresources)).</span></span>

<span data-ttu-id="5eca2-132">Дополнительные сведения об управлении ресурсами см. в разделе [Управление ресурсами (Direct3D 9)](managing-resources.md).</span><span class="sxs-lookup"><span data-stu-id="5eca2-132">For more information about resource management, see [Managing Resources (Direct3D 9)](managing-resources.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="5eca2-133">См. также</span><span class="sxs-lookup"><span data-stu-id="5eca2-133">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="5eca2-134">Текстуры Direct3D</span><span class="sxs-lookup"><span data-stu-id="5eca2-134">Direct3D Textures</span></span>](direct3d-textures.md)
</dt> </dl>

 

 
