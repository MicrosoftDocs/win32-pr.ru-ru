---
description: 'Доступ к памяти поверхности можно получить напрямую с помощью метода IDirect3DSurface9:: Локкрект.'
ms.assetid: ad669c22-6163-4fbb-bad0-160ced5bc558
title: Прямой доступ к памяти Surface (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e7ed9a65265671e6509172eccd9a1b66ea91507f
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104342222"
---
# <a name="accessing-surface-memory-directly-direct3d-9"></a>Прямой доступ к памяти Surface (Direct3D 9)

Доступ к памяти поверхности можно получить напрямую с помощью метода [**IDirect3DSurface9:: локкрект**](/windows/desktop/api) . При вызове этого метода параметр прект является указателем на структуру [**Rect**](/previous-versions//dd162897(v=vs.85)) , описывающую прямоугольник на поверхности для прямого доступа. Чтобы запрашивать блокировку всей поверхности, установите для прект **значение NULL**. Кроме того, можно указать **Rect** , охватывающий только часть поверхности. При условии, что два прямоугольника перекрываются, два потока или процесса могут одновременно блокировать несколько прямоугольников на поверхности. Обратите внимание, что многовыборочный задний буфер не может быть заблокирован.

Метод [**IDirect3DSurface9:: локкрект**](/windows/desktop/api) заполняет структуру [**\_ Rect D3DLOCKED**](d3dlocked-rect.md) всеми сведениями для правильного доступа к памяти поверхности. Структура включает сведения о шаге и имеет указатель на заблокированные биты. После завершения доступа к памяти поверхности вызовите метод [**IDirect3DSurface9:: унлоккрект**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dsurface9-unlockrect) , чтобы разблокировать его.

При наличии заблокированной поверхности можно напрямую управлять содержимым. В следующем списке описаны некоторые рекомендации по устранению распространенных проблем с прямым отображением памяти поверхности.

-   Никогда не рассчитывать на постоянный тон. Всегда изучите сведения о шаге, возвращаемые методом [**IDirect3DSurface9:: локкрект**](/windows/desktop/api) . Этот шаг может отличаться по ряду причин, включая расположение памяти поверхности, тип видеокарты или даже версию драйвера Direct3D. Дополнительные сведения см. в разделе [Width/тон (Direct3D 9)](width-vs--pitch.md).
-   Выполните копирование на незаблокированные поверхности. Методы копирования Direct3D завершатся ошибкой, если они вызваны на заблокированной поверхности.
-   Ограничьте действие приложения, пока поверхность заблокирована.
-   Всегда копировать данные, выводимые в соответствии с объемом памяти. Windows 98 использует обработчик ошибок страницы Вфлатд. 386, чтобы реализовать виртуальный буфер плоских кадров для видеоадаптеров с памятью с банком. Обработчик позволяет этим устройствам отображать линейный буфер кадров для Direct3D. Копирование данных, несогласованных для экрана, может привести к приостановке системы в случае, если копирование охватывает банки памяти.
-   Поверхность может не быть заблокирована, если она принадлежит ресурсу, назначенному \_ пулу памяти D3DPOOL по умолчанию, если это не динамическая текстура или поверхность, созданная с помощью [**IDirect3DDevice9:: креатеоффскринплаинсурфаце**](/windows/desktop/api). Поверхности заднего буфера, к которым можно получить доступ с помощью методов [**IDirect3DDevice9:: жетбаккбуффер**](/windows/desktop/api) и [**IDirect3DSwapChain9:: жетбаккбуффер**](/windows/desktop/api) , могут быть заблокированы только в том случае, если цепочка буферов была создана с помощью элемента flags из [**D3DPRESENT \_ параметров**](d3dpresent-parameters.md) для включения D3DPRESENTFLAG \_ блокируемого \_ буфера обмена.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Поверхности Direct3D](direct3d-surfaces.md)
</dt> </dl>

 

 
