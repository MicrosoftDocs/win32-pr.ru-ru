---
description: 'Доступ к памяти поверхности можно получить напрямую с помощью метода IDirect3DSurface9:: Локкрект.'
ms.assetid: ad669c22-6163-4fbb-bad0-160ced5bc558
title: Прямой доступ к памяти Surface (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e7ed9a65265671e6509172eccd9a1b66ea91507f
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104342222"
---
# <a name="accessing-surface-memory-directly-direct3d-9"></a><span data-ttu-id="5b326-103">Прямой доступ к памяти Surface (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="5b326-103">Accessing Surface Memory Directly (Direct3D 9)</span></span>

<span data-ttu-id="5b326-104">Доступ к памяти поверхности можно получить напрямую с помощью метода [**IDirect3DSurface9:: локкрект**](/windows/desktop/api) .</span><span class="sxs-lookup"><span data-stu-id="5b326-104">You can directly access the surface memory by using the [**IDirect3DSurface9::LockRect**](/windows/desktop/api) method.</span></span> <span data-ttu-id="5b326-105">При вызове этого метода параметр прект является указателем на структуру [**Rect**](/previous-versions//dd162897(v=vs.85)) , описывающую прямоугольник на поверхности для прямого доступа.</span><span class="sxs-lookup"><span data-stu-id="5b326-105">When you call this method, the pRect parameter is a pointer to a [**RECT**](/previous-versions//dd162897(v=vs.85)) structure that describes the rectangle on the surface to access directly.</span></span> <span data-ttu-id="5b326-106">Чтобы запрашивать блокировку всей поверхности, установите для прект **значение NULL**.</span><span class="sxs-lookup"><span data-stu-id="5b326-106">To request that the entire surface be locked, set pRect to **NULL**.</span></span> <span data-ttu-id="5b326-107">Кроме того, можно указать **Rect** , охватывающий только часть поверхности.</span><span class="sxs-lookup"><span data-stu-id="5b326-107">Also, you can specify a **RECT** that covers only a portion of the surface.</span></span> <span data-ttu-id="5b326-108">При условии, что два прямоугольника перекрываются, два потока или процесса могут одновременно блокировать несколько прямоугольников на поверхности.</span><span class="sxs-lookup"><span data-stu-id="5b326-108">Providing that no two rectangles overlap, two threads or processes can simultaneously lock multiple rectangles in a surface.</span></span> <span data-ttu-id="5b326-109">Обратите внимание, что многовыборочный задний буфер не может быть заблокирован.</span><span class="sxs-lookup"><span data-stu-id="5b326-109">Note that a multisample back buffer cannot be locked.</span></span>

<span data-ttu-id="5b326-110">Метод [**IDirect3DSurface9:: локкрект**](/windows/desktop/api) заполняет структуру [**\_ Rect D3DLOCKED**](d3dlocked-rect.md) всеми сведениями для правильного доступа к памяти поверхности.</span><span class="sxs-lookup"><span data-stu-id="5b326-110">The [**IDirect3DSurface9::LockRect**](/windows/desktop/api) method fills a [**D3DLOCKED\_RECT**](d3dlocked-rect.md) structure with all the information to properly access the surface memory.</span></span> <span data-ttu-id="5b326-111">Структура включает сведения о шаге и имеет указатель на заблокированные биты.</span><span class="sxs-lookup"><span data-stu-id="5b326-111">The structure includes information about the pitch and has a pointer to the locked bits.</span></span> <span data-ttu-id="5b326-112">После завершения доступа к памяти поверхности вызовите метод [**IDirect3DSurface9:: унлоккрект**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dsurface9-unlockrect) , чтобы разблокировать его.</span><span class="sxs-lookup"><span data-stu-id="5b326-112">When you finish accessing the surface memory, call the [**IDirect3DSurface9::UnlockRect**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dsurface9-unlockrect) method to unlock it.</span></span>

<span data-ttu-id="5b326-113">При наличии заблокированной поверхности можно напрямую управлять содержимым.</span><span class="sxs-lookup"><span data-stu-id="5b326-113">While you have a surface locked, you can directly manipulate the contents.</span></span> <span data-ttu-id="5b326-114">В следующем списке описаны некоторые рекомендации по устранению распространенных проблем с прямым отображением памяти поверхности.</span><span class="sxs-lookup"><span data-stu-id="5b326-114">The following list describes some tips for avoiding common problems with directly rendering surface memory.</span></span>

-   <span data-ttu-id="5b326-115">Никогда не рассчитывать на постоянный тон.</span><span class="sxs-lookup"><span data-stu-id="5b326-115">Never assume a constant display pitch.</span></span> <span data-ttu-id="5b326-116">Всегда изучите сведения о шаге, возвращаемые методом [**IDirect3DSurface9:: локкрект**](/windows/desktop/api) .</span><span class="sxs-lookup"><span data-stu-id="5b326-116">Always examine the pitch information returned by the [**IDirect3DSurface9::LockRect**](/windows/desktop/api) method.</span></span> <span data-ttu-id="5b326-117">Этот шаг может отличаться по ряду причин, включая расположение памяти поверхности, тип видеокарты или даже версию драйвера Direct3D.</span><span class="sxs-lookup"><span data-stu-id="5b326-117">This pitch can vary for a number of reasons, including the location of the surface memory, the display card type, or even the version of the Direct3D driver.</span></span> <span data-ttu-id="5b326-118">Дополнительные сведения см. в разделе [Width/тон (Direct3D 9)](width-vs--pitch.md).</span><span class="sxs-lookup"><span data-stu-id="5b326-118">For more information, see [Width vs. Pitch (Direct3D 9)](width-vs--pitch.md).</span></span>
-   <span data-ttu-id="5b326-119">Выполните копирование на незаблокированные поверхности.</span><span class="sxs-lookup"><span data-stu-id="5b326-119">Make certain you copy to unlocked surfaces.</span></span> <span data-ttu-id="5b326-120">Методы копирования Direct3D завершатся ошибкой, если они вызваны на заблокированной поверхности.</span><span class="sxs-lookup"><span data-stu-id="5b326-120">Direct3D copy methods will fail if called on a locked surface.</span></span>
-   <span data-ttu-id="5b326-121">Ограничьте действие приложения, пока поверхность заблокирована.</span><span class="sxs-lookup"><span data-stu-id="5b326-121">Limit your application's activity while a surface is locked.</span></span>
-   <span data-ttu-id="5b326-122">Всегда копировать данные, выводимые в соответствии с объемом памяти.</span><span class="sxs-lookup"><span data-stu-id="5b326-122">Always copy data aligned to display memory.</span></span> <span data-ttu-id="5b326-123">Windows 98 использует обработчик ошибок страницы Вфлатд. 386, чтобы реализовать виртуальный буфер плоских кадров для видеоадаптеров с памятью с банком.</span><span class="sxs-lookup"><span data-stu-id="5b326-123">Windows 98 uses a page fault handler, Vflatd.386, to implement a virtual flat-frame buffer for display cards with bank-switched memory.</span></span> <span data-ttu-id="5b326-124">Обработчик позволяет этим устройствам отображать линейный буфер кадров для Direct3D.</span><span class="sxs-lookup"><span data-stu-id="5b326-124">The handler allows these display devices to present a linear frame buffer to Direct3D.</span></span> <span data-ttu-id="5b326-125">Копирование данных, несогласованных для экрана, может привести к приостановке системы в случае, если копирование охватывает банки памяти.</span><span class="sxs-lookup"><span data-stu-id="5b326-125">Copying data unaligned to display memory can cause the system to suspend operations if the copy spans memory banks.</span></span>
-   <span data-ttu-id="5b326-126">Поверхность может не быть заблокирована, если она принадлежит ресурсу, назначенному \_ пулу памяти D3DPOOL по умолчанию, если это не динамическая текстура или поверхность, созданная с помощью [**IDirect3DDevice9:: креатеоффскринплаинсурфаце**](/windows/desktop/api).</span><span class="sxs-lookup"><span data-stu-id="5b326-126">A surface may not be locked if it belongs to a resource assigned to the D3DPOOL\_DEFAULT memory pool unless it is a dynamic texture or a surface created using [**IDirect3DDevice9::CreateOffscreenPlainSurface**](/windows/desktop/api).</span></span> <span data-ttu-id="5b326-127">Поверхности заднего буфера, к которым можно получить доступ с помощью методов [**IDirect3DDevice9:: жетбаккбуффер**](/windows/desktop/api) и [**IDirect3DSwapChain9:: жетбаккбуффер**](/windows/desktop/api) , могут быть заблокированы только в том случае, если цепочка буферов была создана с помощью элемента flags из [**D3DPRESENT \_ параметров**](d3dpresent-parameters.md) для включения D3DPRESENTFLAG \_ блокируемого \_ буфера обмена.</span><span class="sxs-lookup"><span data-stu-id="5b326-127">Back buffer surfaces, which may be accessed using the [**IDirect3DDevice9::GetBackBuffer**](/windows/desktop/api) and [**IDirect3DSwapChain9::GetBackBuffer**](/windows/desktop/api) methods, may be locked only if the swap chain was created with the Flags member of [**D3DPRESENT\_PARAMETERS**](d3dpresent-parameters.md) to include D3DPRESENTFLAG\_LOCKABLE\_BACKBUFFER.</span></span>

## <a name="related-topics"></a><span data-ttu-id="5b326-128">См. также</span><span class="sxs-lookup"><span data-stu-id="5b326-128">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="5b326-129">Поверхности Direct3D</span><span class="sxs-lookup"><span data-stu-id="5b326-129">Direct3D Surfaces</span></span>](direct3d-surfaces.md)
</dt> </dl>

 

 
