---
description: Поддержка точек-спрайтов в Direct3D 9 обеспечивает высокопроизводительную визуализацию точек (системы частиц). Спрайты точек — это обобщенные обобщенные точки, позволяющие подготавливать произвольные формы, как определено текстурами.
ms.assetid: a9046c7e-779c-4f33-b8ff-f189da3dcfc5
title: Точки спрайтов (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c988a104eb65b5e2d7e56ff2444e8d422c422df2
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104537433"
---
# <a name="point-sprites-direct3d-9"></a><span data-ttu-id="a4f8e-104">Точки спрайтов (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="a4f8e-104">Point Sprites (Direct3D 9)</span></span>

<span data-ttu-id="a4f8e-105">Поддержка точек-спрайтов в Direct3D 9 обеспечивает высокопроизводительную визуализацию точек (системы частиц).</span><span class="sxs-lookup"><span data-stu-id="a4f8e-105">Support for point sprites in Direct3D 9 enables the high-performance rendering of points (particle systems).</span></span> <span data-ttu-id="a4f8e-106">Спрайты точек — это обобщенные обобщенные точки, позволяющие подготавливать произвольные формы, как определено текстурами.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-106">Point sprites are generalizations of generic points that enable arbitrary shapes to be rendered as defined by textures.</span></span>

-   [<span data-ttu-id="a4f8e-107">Элементы управления отрисовкой точек-примитивов</span><span class="sxs-lookup"><span data-stu-id="a4f8e-107">Point Primitive Rendering Controls</span></span>](#point-primitive-rendering-controls)
-   [<span data-ttu-id="a4f8e-108">Вычисления размера точки</span><span class="sxs-lookup"><span data-stu-id="a4f8e-108">Point Size Computations</span></span>](#point-size-computations)
-   [<span data-ttu-id="a4f8e-109">Отрисовка точки</span><span class="sxs-lookup"><span data-stu-id="a4f8e-109">Point Rendering</span></span>](#point-rendering)

## <a name="point-primitive-rendering-controls"></a><span data-ttu-id="a4f8e-110">Элементы управления отрисовкой точек-примитивов</span><span class="sxs-lookup"><span data-stu-id="a4f8e-110">Point Primitive Rendering Controls</span></span>

<span data-ttu-id="a4f8e-111">Direct3D 9 поддерживает дополнительные параметры для управления отрисовкой точек спрайтов (примитивы точек).</span><span class="sxs-lookup"><span data-stu-id="a4f8e-111">Direct3D 9 supports additional parameters to control the rendering of point sprites (point primitives).</span></span> <span data-ttu-id="a4f8e-112">Эти параметры позволяют точкам иметь переменный размер и иметь полную карту текстуры.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-112">These parameters enable points to be of variable size and have a full texture map applied.</span></span> <span data-ttu-id="a4f8e-113">Размер каждой точки определяется заданным приложением размером в сочетании с функцией на основе расстояния, вычисленной Direct3D.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-113">The size of each point is determined by an application-specified size combined with a distance-based function computed by Direct3D.</span></span> <span data-ttu-id="a4f8e-114">Приложение может указать размер точки как на уровне вершины, так и с помощью параметра D3DRS \_ POINTSIZE, который применяется к точкам без размера каждой вершины.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-114">The application can specify point size either as per-vertex or by setting D3DRS\_POINTSIZE, which applies to points without a per-vertex size.</span></span> <span data-ttu-id="a4f8e-115">Размер точки выражается в единицах области камеры, за исключением того момента, когда приложение передается после преобразования вершинного формата вершин (ФВФ).</span><span class="sxs-lookup"><span data-stu-id="a4f8e-115">The point size is expressed in camera space units, with the exception of when the application is passing post-transformed flexible vertex format (FVF) vertices.</span></span> <span data-ttu-id="a4f8e-116">В этом случае функция на основе расстояния не применяется, а размер точки выражается в единицах измерения для целевого объекта отрисовки.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-116">In this case, the distance-based function is not applied and the point size is expressed in units of pixels on the render target.</span></span>

<span data-ttu-id="a4f8e-117">Координаты текстуры, вычисленные и используемые при отрисовке точек, зависят от значения параметра D3DRS \_ поинтспритинабле.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-117">The texture coordinates computed and used when rendering points depends on the setting of D3DRS\_POINTSPRITEENABLE.</span></span> <span data-ttu-id="a4f8e-118">Если это значение равно **true**, координаты текстуры задаются таким образом, чтобы каждая точка отображала полную текстуру.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-118">When this value is set to **TRUE**, the texture coordinates are set so that each point displays the full texture.</span></span> <span data-ttu-id="a4f8e-119">Как правило, это полезно, только если точки значительно больше одного пикселя.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-119">In general, this is only useful when points are significantly larger than one pixel.</span></span> <span data-ttu-id="a4f8e-120">Если D3DRS \_ поинтспритинабле имеет значение **false**, координата текстуры вершины каждой точки используется для всей точки.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-120">When D3DRS\_POINTSPRITEENABLE is set to **FALSE**, each point's vertex texture coordinate is used for the entire point.</span></span>

## <a name="point-size-computations"></a><span data-ttu-id="a4f8e-121">Вычисления размера точки</span><span class="sxs-lookup"><span data-stu-id="a4f8e-121">Point Size Computations</span></span>

<span data-ttu-id="a4f8e-122">Размер точки определяется параметром D3DRS \_ поинтскалинабле.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-122">Point size is determined by D3DRS\_POINTSCALEENABLE.</span></span> <span data-ttu-id="a4f8e-123">Если это значение равно **false**, то размер заданной в приложении точки используется в качестве размера экранного пространства (после преобразования).</span><span class="sxs-lookup"><span data-stu-id="a4f8e-123">If this value is set to **FALSE**, the application-specified point size is used as the screen-space (post-transformed) size.</span></span> <span data-ttu-id="a4f8e-124">Вершины, которые передаются в Direct3D в пространстве экрана, не рассчитывают размеры точек. указанный размер точки интерпретируется как размер экранного пространства.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-124">Vertices that are passed to Direct3D in screen space do not have point sizes computed; the specified point size is interpreted as screen-space size.</span></span>

<span data-ttu-id="a4f8e-125">Если D3DRS \_ поинтскалинабле имеет **значение true**, Direct3D вычислит размер точки на экране в соответствии со следующей формулой.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-125">If D3DRS\_POINTSCALEENABLE is **TRUE**, Direct3D computes the screen-space point size according to the following formula.</span></span> <span data-ttu-id="a4f8e-126">Заданный приложением размер точки выражается в единицах пространства камеры.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-126">The application-specified point size is expressed in camera space units.</span></span>

<span data-ttu-id="a4f8e-127">S s = вх \* s <sub>i</sub> \* Sqrt (1/(A + B \* D ₑ + C \* (D ₑ ²)))</span><span class="sxs-lookup"><span data-stu-id="a4f8e-127">S ₛ = Vₕ \* S <sub>i</sub> \* sqrt(1/(A + B \* D ₑ + C \*( D ₑ² )))</span></span>

<span data-ttu-id="a4f8e-128">В этой формуле размер входной точки, <sub>i</sub>, — это либо на вершину, либо на значение \_ состояния визуализации D3DRS POINTSIZE.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-128">In this formula, the input point size, S <sub>i</sub>, is either per-vertex or the value of the D3DRS\_POINTSIZE render state.</span></span> <span data-ttu-id="a4f8e-129">Факторы масштаба точки, D3DRS \_ поинтскале \_ A, D3DRS \_ ПОИНТСКАЛЕ \_ B и D3DRS \_ Поинтскале \_ C, представлены точками A, B и c. Высота окна просмотра, V h, представляет собой элемент высоты [**D3DVIEWPORT9**](d3dviewport9.md) структуры, представляющий окно просмотра.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-129">The point scale factors, D3DRS\_POINTSCALE\_A, D3DRS\_POINTSCALE\_B, and D3DRS\_POINTSCALE\_C, are represented by the points A, B, and C. The height of the viewport, V ₕ, is the [**D3DVIEWPORT9**](d3dviewport9.md) structure's Height member representing the viewport.</span></span> <span data-ttu-id="a4f8e-130">Г ₑ, расстояние от глаза до позиции (глаз в источнике) вычисляются путем получения позиции области видимости (X ₑ, Y ₑ, Z ₑ) и выполнения следующей операции.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-130">D ₑ, the distance from the eye to the position (the eye at the origin), is computed by taking the eye space position of the point (Xₑ, Yₑ, Zₑ) and performing the following operation.</span></span>

<span data-ttu-id="a4f8e-131">D ₑ = Sqrt (X ₑ ² + Y ₑ ² + Z ₑ ²)</span><span class="sxs-lookup"><span data-stu-id="a4f8e-131">D ₑ = sqrt (Xₑ² + Y ₑ² + Z ₑ²)</span></span>

<span data-ttu-id="a4f8e-132">Максимальный размер точки, PM ₐ ₓ, определяется путем получения меньшего значения элемента Макспоинтсизе структуры [**D3DCAPS9**](/windows/desktop/api/D3D9Caps/ns-d3d9caps-d3dcaps9) или \_ \_ максимального состояния визуализации D3DRS POINTSIZE.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-132">The maximum point size, Pₘₐₓ, is determined by taking the smaller of either the [**D3DCAPS9**](/windows/desktop/api/D3D9Caps/ns-d3d9caps-d3dcaps9) structure's MaxPointSize member or the D3DRS\_POINTSIZE\_MAX render state.</span></span> <span data-ttu-id="a4f8e-133">Минимальный размер точки (P<sub>мин</sub>) определяется путем запроса значения D3DRS \_ POINTSIZE \_ min.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-133">The minimum point size, P<sub>min</sub>, is determined by querying the value of D3DRS\_POINTSIZE\_MIN.</span></span> <span data-ttu-id="a4f8e-134">Таким образом, конечный размер экранной точки (S) определяется следующим образом.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-134">Thus the final screen-space point size, S, is determined in the following manner.</span></span>

-   <span data-ttu-id="a4f8e-135">Если SS > ₐ ₓ, то S = P m ₐ ₓ</span><span class="sxs-lookup"><span data-stu-id="a4f8e-135">If Sₛ > Pₘₐₓ, then S = P ₘₐₓ</span></span>
-   <span data-ttu-id="a4f8e-136">Если S < P<sub>min</sub>, то s = p <sub>min</sub></span><span class="sxs-lookup"><span data-stu-id="a4f8e-136">if S < P<sub>min</sub>, then S = P <sub>min</sub></span></span>
-   <span data-ttu-id="a4f8e-137">В противном случае S = S</span><span class="sxs-lookup"><span data-stu-id="a4f8e-137">Otherwise, S = S ₛ</span></span>

## <a name="point-rendering"></a><span data-ttu-id="a4f8e-138">Отрисовка точки</span><span class="sxs-lookup"><span data-stu-id="a4f8e-138">Point Rendering</span></span>

<span data-ttu-id="a4f8e-139">Точечная точка экрана, P = (X, Y, Z, W), размером пространства экрана, используется в виде растрового изображения как грани четырехсторонней из следующих четырех вершин.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-139">A screen-space point, P = ( X, Y, Z, W), of screen-space size S is rasterized as a quadrilateral of the following four vertices.</span></span>

<span data-ttu-id="a4f8e-140">((X + S/2, Y + S/2, Z, W), (X + S/2, Y-S/2, Z, W), (X-S/2, Y-S/2, Z, W), (X-S/2, Y + S/2, Z, W))</span><span class="sxs-lookup"><span data-stu-id="a4f8e-140">(( X + S/2, Y + S/2, Z, W), ( X + S/2, Y - S/2, Z, W), ( X - S/2, Y- S/2, Z, W), ( X - S/2, Y + S/2, Z, W))</span></span>

<span data-ttu-id="a4f8e-141">Атрибуты цвета вершины дублируются на каждой вершине; Таким же, каждая точка всегда отображается с постоянными цветами.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-141">The vertex color attributes are duplicated at each vertex; thus each point is always rendered with constant colors.</span></span>

<span data-ttu-id="a4f8e-142">Назначение индексов текстур управляется \_ параметром состояния отрисовки D3DRS поинтспритинабле.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-142">The assignment of texture indices is controlled by the D3DRS\_POINTSPRITEENABLE render state setting.</span></span> <span data-ttu-id="a4f8e-143">Если D3DRS \_ поинтспритинабле имеет значение **false**, координаты текстуры вершин дублируются на каждой вершине.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-143">If D3DRS\_POINTSPRITEENABLE is set to **FALSE**, then the vertex texture coordinates are duplicated at each vertex.</span></span> <span data-ttu-id="a4f8e-144">Если D3DRS \_ поинтспритинабле имеет значение **true**, координаты текстуры на четырех вершинах устанавливаются в следующие значения.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-144">If D3DRS\_POINTSPRITEENABLE is set to **TRUE**, then the texture coordinates at the four vertices are set to the following values.</span></span>

<span data-ttu-id="a4f8e-145">(0. F, 0. F), (0. F, 1. F), (1. F, 0. F), (1. F, 1. F)</span><span class="sxs-lookup"><span data-stu-id="a4f8e-145">(0.F, 0.F), (0.F, 1.F), (1.F, 0.F), (1.F, 1.F)</span></span>

<span data-ttu-id="a4f8e-146">Это показано на схеме ниже.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-146">This is shown in the following diagram.</span></span>

![Схема квадрата с пометками вершин для значений координат (u, v) и (x, y)](images/spritepoint.png)

<span data-ttu-id="a4f8e-148">Если обрезка включена, точки обрезаются следующим образом.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-148">When clipping is enabled, points are clipped in the following manner.</span></span> <span data-ttu-id="a4f8e-149">Если вершина превышает диапазон значений глубины — Минз и Максз структуры [**D3DVIEWPORT9**](d3dviewport9.md) , в которую готовится визуализация сцены, то точка существует вне представления фрустум и не подготавливается к просмотру.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-149">If the vertex exceeds the range of depth values - MinZ and MaxZ of the [**D3DVIEWPORT9**](d3dviewport9.md) structure - into which a scene is to be rendered, the point exists outside of the view frustum and is not rendered.</span></span> <span data-ttu-id="a4f8e-150">Если точка, учитывающая размер точки, полностью выходит за пределы окна просмотра в X и Y, то точка не подготавливается к просмотру; остальные точки подготавливаются к просмотру.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-150">If the point, taking into account the point size, is completely outside the viewport in X and Y, then the point is not rendered; the remaining points are rendered.</span></span> <span data-ttu-id="a4f8e-151">Расположение точки может находиться вне окна просмотра в X или Y и по-прежнему быть частично видимым.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-151">It is possible for the point position to be outside the viewport in X or Y and still be partially visible.</span></span>

<span data-ttu-id="a4f8e-152">Точки могут быть неправильно обрезаны на определяемых пользователем плоскостях клипов.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-152">Points may or may not be correctly clipped to user-defined clip planes.</span></span> <span data-ttu-id="a4f8e-153">Если D3DPMISCCAPS \_ клиппланескаледпоинтс не задан в элементе примитивемисккапс структуры [**D3DCAPS9**](/windows/desktop/api/D3D9Caps/ns-d3d9caps-d3dcaps9) , точки обрезаются до определяемых пользователем роликовых плоскостей на основе только позиции вершины, игнорируя размер точки.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-153">If D3DPMISCCAPS\_CLIPPLANESCALEDPOINTS is not set in the [**D3DCAPS9**](/windows/desktop/api/D3D9Caps/ns-d3d9caps-d3dcaps9) structure's PrimitiveMiscCaps member, points are clipped to user-defined clip planes based only on the vertex position, ignoring the point size.</span></span> <span data-ttu-id="a4f8e-154">В этом случае масштабированные точки отображаются полностью, если позиция вершины находится внутри плоскости обрезки, и отбрасывается, когда позиция вершины находится за пределами плоскости обрезки.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-154">In this case, scaled points are fully rendered when the vertex position is inside the clip planes, and discarded when the vertex position is outside a clip plane.</span></span> <span data-ttu-id="a4f8e-155">Приложения могут предотвратить потенциальные артефакты, добавив границу с границей к резким размерам, равным максимальному размеру точки.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-155">Applications can prevent potential artifacts by adding a border geometry to clip planes that is as large as the maximum point size.</span></span>

<span data-ttu-id="a4f8e-156">Если \_ установлен бит КЛИППЛАНЕСКАЛЕДПОИНТС D3DPMISCCAPS, то масштабированные точки правильно обрезаются на пользовательские плоскости.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-156">If the D3DPMISCCAPS\_CLIPPLANESCALEDPOINTS bit is set, then the scaled points are correctly clipped to user-defined clip planes.</span></span>

<span data-ttu-id="a4f8e-157">Аппаратная обработка вершин может не поддерживать размер точек.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-157">Hardware vertex processing may or may not support point size.</span></span> <span data-ttu-id="a4f8e-158">Например, если устройство создано с D3DCREATE \_ Hardware \_ вертекспроцессинг на слое абстрагирования оборудования (HAL) (D3DDEVTYPE \_ HAL), в котором для элемента макспоинтсизе структуры [**D3DCAPS9**](/windows/desktop/api/D3D9Caps/ns-d3d9caps-d3dcaps9) задано значение 1,0 или 0,0, то все точки представляют собой один пиксель.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-158">For example, if a device is created with D3DCREATE\_HARDWARE\_VERTEXPROCESSING on a hardware abstraction layer (HAL) device (D3DDEVTYPE\_HAL) that has the [**D3DCAPS9**](/windows/desktop/api/D3D9Caps/ns-d3d9caps-d3dcaps9) structure's MaxPointSize member set to 1.0 or 0.0, then all points are a single pixel.</span></span> <span data-ttu-id="a4f8e-159">Для отрисовки спрайтов точек с точками, размер которых меньше 1,0, необходимо использовать вершину ФВФ TL (преобразованную и освещенную) или обработку вершин программного обеспечения (D3DCREATE \_ Software \_ вертекспроцессинг). в этом случае время запуска Direct3D эмулирует визуализацию точки спрайта.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-159">To render pixel point sprites less than 1.0, you must use either FVF TL (transformed and lit) vertices or software vertex processing (D3DCREATE\_SOFTWARE\_VERTEXPROCESSING), in which case the Direct3D run time emulates the point sprite rendering.</span></span>

<span data-ttu-id="a4f8e-160">Устройство, которое выполняет обработку вершин и поддерживает точки-спрайти — для вычисления размера непреобразованных спрайтов требуется Макспоинтсизе, для которых задано значение больше 1,0 f, и требуется правильно задать для вершин или D3DRS \_ POINTSIZED3DRS \_ POINTSIZE для ВЕРШИН в TL.</span><span class="sxs-lookup"><span data-stu-id="a4f8e-160">A hardware device that does vertex processing and supports point sprites - MaxPointSize set to greater than 1.0f - is required to perform the size computation for nontransformed sprites and is required to properly set the per-vertex or D3DRS\_POINTSIZED3DRS\_POINTSIZE for TL vertices.</span></span>

<span data-ttu-id="a4f8e-161">Дополнительные сведения о правилах отрисовки точек, линий и треугольников см. в разделе [правила растрирования (Direct3D 9)](rasterization-rules.md).</span><span class="sxs-lookup"><span data-stu-id="a4f8e-161">For information about rendering rules for points, lines, and triangles, see [Rasterization Rules (Direct3D 9)](rasterization-rules.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="a4f8e-162">См. также</span><span class="sxs-lookup"><span data-stu-id="a4f8e-162">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a4f8e-163">Конвейер вершин</span><span class="sxs-lookup"><span data-stu-id="a4f8e-163">Vertex Pipeline</span></span>](vertex-pipeline.md)
</dt> </dl>

 

 



