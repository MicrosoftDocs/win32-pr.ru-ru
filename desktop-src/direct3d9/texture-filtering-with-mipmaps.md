---
description: MIP-карта — это последовательность текстур, каждая из которых представляет собой одно и то же изображение с последовательно снижающимся разрешением.
ms.assetid: b64abca9-0efb-4939-849d-e75a8d0dc10b
title: Фильтрация текстур с помощью MIP-карты (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bdc109ae6de93a26b5d5e5b90e948761e92ee92c
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104553896"
---
# <a name="texture-filtering-with-mipmaps-direct3d-9"></a><span data-ttu-id="162fc-103">Фильтрация текстур с помощью MIP-карты (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="162fc-103">Texture Filtering with Mipmaps (Direct3D 9)</span></span>

<span data-ttu-id="162fc-104">MIP-карта — это последовательность текстур, каждая из которых представляет собой одно и то же изображение с последовательно снижающимся разрешением.</span><span class="sxs-lookup"><span data-stu-id="162fc-104">A mipmap is a sequence of textures, each of which is a progressively lower resolution representation of the same image.</span></span> <span data-ttu-id="162fc-105">Высота и ширина каждого изображения, или уровня в mipmap, — это степень числа двух меньше предыдущего уровня.</span><span class="sxs-lookup"><span data-stu-id="162fc-105">The height and width of each image, or level, in the mipmap is a power of two smaller than the previous level.</span></span> <span data-ttu-id="162fc-106">MIP-карты не обязаны быть квадратными.</span><span class="sxs-lookup"><span data-stu-id="162fc-106">Mipmaps do not have to be square.</span></span>

<span data-ttu-id="162fc-107">Изображения MIP-карт с высоким разрешением используются для объектов, расположенных близко к пользователю.</span><span class="sxs-lookup"><span data-stu-id="162fc-107">A high-resolution mipmap image is used for objects that are close to the user.</span></span> <span data-ttu-id="162fc-108">Изображения с низким разрешением используются для объектов, отображаемых дальше.</span><span class="sxs-lookup"><span data-stu-id="162fc-108">Lower-resolution images are used as the object appears farther away.</span></span> <span data-ttu-id="162fc-109">Использование MIP-карт улучшает качество отображаемой текстуры за счет использования большего объема памяти.</span><span class="sxs-lookup"><span data-stu-id="162fc-109">Mipmapping improves the quality of rendered textures at the expense of using more memory.</span></span>

<span data-ttu-id="162fc-110">Direct3D представляет MIP-карты как цепочку присоединенных поверхностей.</span><span class="sxs-lookup"><span data-stu-id="162fc-110">Direct3D represents mipmaps as a chain of attached surfaces.</span></span> <span data-ttu-id="162fc-111">Текстура с наиболее высоким разрешением находится в начале цепочки, а далее к ней присоединяются последующие уровни MIP-карты.</span><span class="sxs-lookup"><span data-stu-id="162fc-111">The highest resolution texture is at the head of the chain and has the next level of the mipmap as an attachment.</span></span> <span data-ttu-id="162fc-112">Этот уровень тоже имеет вложение — следующий уровень MIP-карты, и так далее до самого низкого разрешения MIP-карты.</span><span class="sxs-lookup"><span data-stu-id="162fc-112">In turn, that level has an attachment that is the next level in the mipmap, and so on, down to the lowest resolution level of the mipmap.</span></span>

<span data-ttu-id="162fc-113">На следующих рисунках показан пример таких уровней.</span><span class="sxs-lookup"><span data-stu-id="162fc-113">The following illustrations shows an example of these levels.</span></span> <span data-ttu-id="162fc-114">Точечные текстуры представляют собой знак на контейнере в трехмерной игре от первого лица.</span><span class="sxs-lookup"><span data-stu-id="162fc-114">The bitmap textures represent a sign on a container in a 3D first-person game.</span></span> <span data-ttu-id="162fc-115">При создании MIP-карты текстура с самым высоким разрешением является первой в наборе.</span><span class="sxs-lookup"><span data-stu-id="162fc-115">When created as a mipmap, the highest resolution texture is first in the set.</span></span> <span data-ttu-id="162fc-116">Каждая последующая текстура в наборе MIP-карт меньше предыдущей по высоте и ширине на число, соответствующее степени двух.</span><span class="sxs-lookup"><span data-stu-id="162fc-116">Each succeeding texture in the mipmap set is smaller in height and width by a power of 2.</span></span> <span data-ttu-id="162fc-117">В этом случае максимальное разрешение MIP-карты — 256 пикселей на 256 пикселей.</span><span class="sxs-lookup"><span data-stu-id="162fc-117">In this case, the maximum-resolution mipmap is 256 pixels by 256 pixels.</span></span> <span data-ttu-id="162fc-118">Далее следует текстура размером 128x128 пкс.</span><span class="sxs-lookup"><span data-stu-id="162fc-118">The next, texture is 128x128.</span></span> <span data-ttu-id="162fc-119">Последняя текстура в цепочке имеет размеры 64x64 пкс.</span><span class="sxs-lookup"><span data-stu-id="162fc-119">The last texture in the chain is 64x64.</span></span>

<span data-ttu-id="162fc-120">Этот знак расположен на максимальном расстоянии, на котором его можно увидеть.</span><span class="sxs-lookup"><span data-stu-id="162fc-120">This sign has a maximum distance from which it is visible.</span></span> <span data-ttu-id="162fc-121">Если пользователь находится далеко от знака, игра отображает самую маленькую текстуру в цепочке MIP-карт, которая в данном случае имеет размер 64x64 пкс.</span><span class="sxs-lookup"><span data-stu-id="162fc-121">If the user begins far away from the sign, the game displays the smallest texture in the mipmap chain, which in this case the 64x64 texture.</span></span>

![изображение текстуры знака опасности размером 64x64 пкс](images/mip1.jpg)

<span data-ttu-id="162fc-123">Когда пользователь перемещает точку зрения ближе к знаку, используются текстуры цепочки MIP-карты с постепенно увеличивающимся разрешением.</span><span class="sxs-lookup"><span data-stu-id="162fc-123">As the user moves the point of view closer to the sign, progressively higher-resolution textures in the mipmap chain are used.</span></span> <span data-ttu-id="162fc-124">Разрешение на следующем рисунке — 128x128 пкс.</span><span class="sxs-lookup"><span data-stu-id="162fc-124">The resolution in the following illustration is 128x128.</span></span>

![изображение текстуры знака опасности размером 128x128 пкс](images/mip2.jpg)

<span data-ttu-id="162fc-126">Текстура с самым высоким разрешением используется, когда точка зрения пользователя находится на минимально допустимом расстоянии от знака, как показано на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="162fc-126">The highest resolution texture is used when the user's point of view is at the minimum allowable distance from the sign, as shown in the following illustration.</span></span>

![изображение текстуры знака опасности размером 256x256 пкс](images/mip3.jpg)

<span data-ttu-id="162fc-128">Это более эффективный способ имитации перспективы для текстур.</span><span class="sxs-lookup"><span data-stu-id="162fc-128">This is a more efficient way of simulating perspective for textures.</span></span> <span data-ttu-id="162fc-129">Вместо отрисовки одной текстуры во многих разрешениях, быстрее использовать несколько текстур в разных разрешениях.</span><span class="sxs-lookup"><span data-stu-id="162fc-129">Rather than render a single texture at many resolutions, it is faster to use multiple textures at varying resolutions.</span></span>

<span data-ttu-id="162fc-130">Direct3D может оценить, какая текстура в наборе MIP-карт имеет разрешение, наиболее близкое к требуемому для вывода, и сопоставляет пиксели пространству текселей.</span><span class="sxs-lookup"><span data-stu-id="162fc-130">Direct3D can assess which texture in a mipmap set is the closest resolution to the desired output, and it can map pixels into its texel space.</span></span> <span data-ttu-id="162fc-131">Если разрешение конечного изображения является промежуточным между двумя разрешениями текстур в наборе MIP-карт, Direct3D проверяет тексели обеих MIP-карт и накладывает их цветовые значения друг на друга.</span><span class="sxs-lookup"><span data-stu-id="162fc-131">If the resolution of the final image is between the resolutions of the textures in the mipmap set, Direct3D can examine texels in both mipmaps and blend their color values together.</span></span>

<span data-ttu-id="162fc-132">Для использования MIP-карт ваше приложение должно построить набор MIP-карт.</span><span class="sxs-lookup"><span data-stu-id="162fc-132">To use mipmaps, your application must build a set of mipmaps.</span></span> <span data-ttu-id="162fc-133">Приложения применяют MIP-карты, выбирая набор MIP-карт в качестве первой текстуры в наборе текущих текстур.</span><span class="sxs-lookup"><span data-stu-id="162fc-133">Applications apply mipmaps by selecting the mipmap set as the first texture in the set of current textures.</span></span> <span data-ttu-id="162fc-134">Дополнительные сведения см. в разделе [смешение текстур (Direct3D 9)](texture-blending.md).</span><span class="sxs-lookup"><span data-stu-id="162fc-134">For more information, see [Texture Blending (Direct3D 9)](texture-blending.md).</span></span>

<span data-ttu-id="162fc-135">Затем приложение должно установить метод фильтрации, который использует Direct3D для выборки текселей.</span><span class="sxs-lookup"><span data-stu-id="162fc-135">Next, your application must set the filtering method that Direct3D uses to sample texels.</span></span> <span data-ttu-id="162fc-136">При самом быстром методе фильтрации MIP-карт Direct3D выбирает ближайший тексель.</span><span class="sxs-lookup"><span data-stu-id="162fc-136">The fastest method of mipmap filtering is to have Direct3D select the nearest texel.</span></span> <span data-ttu-id="162fc-137">\_Чтобы выбрать это, используйте перечислимое значение точки D3DTEXF.</span><span class="sxs-lookup"><span data-stu-id="162fc-137">Use the D3DTEXF\_POINT enumerated value to select this.</span></span> <span data-ttu-id="162fc-138">С помощью Direct3D можно улучшить фильтрацию результатов, если приложение использует \_ значение линейной перечисленности D3DTEXF.</span><span class="sxs-lookup"><span data-stu-id="162fc-138">Direct3D can produce better filtering results if your application uses the D3DTEXF\_LINEAR enumerated value.</span></span> <span data-ttu-id="162fc-139">В этом случае выбирается ближайшая MIP-карта, после чего вычисляется взвешенное среднее значение текселей, окружающих точку текстуры, которой сопоставлен текущий пиксель.</span><span class="sxs-lookup"><span data-stu-id="162fc-139">This selects the nearest mipmap, and then computes a weighted average of the texels surrounding the location in the texture to which the current pixel maps.</span></span>

<span data-ttu-id="162fc-140">Текстуры MIP-карт используются в трехмерных сценах, чтобы уменьшить время, необходимое для обработки сцены.</span><span class="sxs-lookup"><span data-stu-id="162fc-140">Mipmap textures are used in 3D scenes to decrease the time required to render a scene.</span></span> <span data-ttu-id="162fc-141">Они также повышают реалистичность сцены.</span><span class="sxs-lookup"><span data-stu-id="162fc-141">They also improve the scene's realism.</span></span> <span data-ttu-id="162fc-142">Однако зачастую для этого требуется большой объем памяти.</span><span class="sxs-lookup"><span data-stu-id="162fc-142">However, they often require large amounts of memory.</span></span>

## <a name="creating-a-set-of-mipmaps"></a><span data-ttu-id="162fc-143">Создание набора MIP-карты</span><span class="sxs-lookup"><span data-stu-id="162fc-143">Creating a Set of Mipmaps</span></span>

<span data-ttu-id="162fc-144">В следующем примере показано, как приложение может вызвать метод [**IDirect3DDevice9:: креатетекстуре**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) для создания цепочки из пяти уровней mipmap: 256x256, 128x128, 64 x 64, 32x32 и 16x16.</span><span class="sxs-lookup"><span data-stu-id="162fc-144">The following example shows how your application can call the [**IDirect3DDevice9::CreateTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) method to build a chain of five mipmap levels: 256x256, 128x128, 64x64, 32x32, and 16x16.</span></span>


```
// This code example assumes that m_d3dDevice is a
// valid pointer to a IDirect3DDevice9 interface

IDirect3DTexture9 * pMipMap;
m_pD3DDevice->CreateTexture(256, 256, 5, 0, D3DFMT_R8G8B8, 
    D3DPOOL_MANAGED, &pMipMap);
```



<span data-ttu-id="162fc-145">Первые два параметра, которые принимаются параметром [**IDirect3DDevice9:: креатетекстуре**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) , имеют размер и ширину текстуры верхнего уровня.</span><span class="sxs-lookup"><span data-stu-id="162fc-145">The first two parameters that are accepted by [**IDirect3DDevice9::CreateTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) are the size and width of the top-level texture.</span></span> <span data-ttu-id="162fc-146">Третий параметр указывает количество уровней в текстуре.</span><span class="sxs-lookup"><span data-stu-id="162fc-146">The third parameter specifies the number of levels in the texture.</span></span> <span data-ttu-id="162fc-147">Если присвоить этому параметру значение 0, Direct3D создает цепочку поверхностей, каждая из которых меньше, чем предыдущая, и до наименьшего возможного размера 1x1.</span><span class="sxs-lookup"><span data-stu-id="162fc-147">If you set this to zero, Direct3D creates a chain of surfaces, each a power of two smaller than the previous one, down to the smallest possible size of 1x1.</span></span> <span data-ttu-id="162fc-148">Четвертый параметр задает использование для этого ресурса; в этом случае указывается значение 0, указывающее на отсутствие конкретного использования ресурса.</span><span class="sxs-lookup"><span data-stu-id="162fc-148">The fourth parameter specifies the usage for this resource; in this case, 0 is specified to indicate no specific usage for the resource.</span></span> <span data-ttu-id="162fc-149">Пятый параметр указывает формат поверхности для текстуры.</span><span class="sxs-lookup"><span data-stu-id="162fc-149">The fifth parameter specifies the surface format for the texture.</span></span> <span data-ttu-id="162fc-150">Используйте значение из перечисляемого типа [D3DFORMAT](d3dformat.md) для этого параметра.</span><span class="sxs-lookup"><span data-stu-id="162fc-150">Use a value from the [D3DFORMAT](d3dformat.md) enumerated type for this parameter.</span></span> <span data-ttu-id="162fc-151">Шестой параметр указывает член перечислимого типа [**D3DPOOL**](./d3dpool.md) , указывающий класс памяти, в который будет размещен созданный ресурс.</span><span class="sxs-lookup"><span data-stu-id="162fc-151">The sixth parameter specifies a member of the [**D3DPOOL**](./d3dpool.md) enumerated type indicating the memory class into which to place the created resource.</span></span> <span data-ttu-id="162fc-152">Если динамические текстуры не используются, \_ рекомендуется использовать управляемый D3DPOOL.</span><span class="sxs-lookup"><span data-stu-id="162fc-152">Unless you are using dynamic textures, D3DPOOL\_MANAGED is recommended.</span></span> <span data-ttu-id="162fc-153">Последний параметр принимает адрес указателя на интерфейс [**IDirect3DTexture9**](/windows/win32/api/d3d9helper/nn-d3d9helper-idirect3dtexture9) .</span><span class="sxs-lookup"><span data-stu-id="162fc-153">The final parameter takes the address of a pointer to an [**IDirect3DTexture9**](/windows/win32/api/d3d9helper/nn-d3d9helper-idirect3dtexture9) interface.</span></span>

> [!Note]  
> <span data-ttu-id="162fc-154">Каждая поверхность в цепочке mipmap имеет измерения, которые находятся в одной половине от предыдущей поверхности в цепочке.</span><span class="sxs-lookup"><span data-stu-id="162fc-154">Each surface in a mipmap chain has dimensions that are one-half that of the previous surface in the chain.</span></span> <span data-ttu-id="162fc-155">Если MIP-карта верхнего уровня имеет размер 256x128 пкс, размер MIP-карты второго уровня составит 128x64 пкс, третьего уровня — 64x32 пкс и так далее до 1x1 пкс.</span><span class="sxs-lookup"><span data-stu-id="162fc-155">If the top-level mipmap has dimensions of 256x128, the dimensions of the second-level mipmap are 128x64, the third-level are 64x32, and so on, down to 1x1.</span></span> <span data-ttu-id="162fc-156">Невозможно запросить в Levels число уровней MIP-карт, которое приведет к тому, что ширина или высота любой из MIP-карт в цепочке станет меньше 1 пкс.</span><span class="sxs-lookup"><span data-stu-id="162fc-156">You cannot request a number of mipmap levels in Levels that would cause either the width or height of any mipmap in the chain to be smaller than 1.</span></span> <span data-ttu-id="162fc-157">В простом случае поверхности MIP-карты размером 4x2 пкс максимально допустимое значение Levels — 3.</span><span class="sxs-lookup"><span data-stu-id="162fc-157">In the simple case of a 4x2 top-level mipmap surface, the maximum value allowed for Levels is three.</span></span> <span data-ttu-id="162fc-158">Размер верхнего уровня равен 4x2 пкс, размер второго уровня — 2x1, а третьего уровня — 1x1 пкс.</span><span class="sxs-lookup"><span data-stu-id="162fc-158">The top-level dimensions are 4x2, the second-level dimensions are 2x1, and the dimensions for the third level are 1x1.</span></span> <span data-ttu-id="162fc-159">При значении Levels больше 3 будет получено дробное значение высоты MIP-карты второго уровня, поэтому использование такого значения запрещено.</span><span class="sxs-lookup"><span data-stu-id="162fc-159">A value larger than 3 in Levels results in a fractional value in the height of the second-level mipmap, and is therefore disallowed.</span></span>

 

## <a name="selecting-and-displaying-a-mipmap"></a><span data-ttu-id="162fc-160">Выбор и отображение mipmap</span><span class="sxs-lookup"><span data-stu-id="162fc-160">Selecting and Displaying a Mipmap</span></span>

<span data-ttu-id="162fc-161">Вызовите метод [**IDirect3DDevice9:: сеттекстуре**](/windows/desktop/api) , чтобы задать текстуру mipmap в качестве первой текстуры в списке текущих текстур.</span><span class="sxs-lookup"><span data-stu-id="162fc-161">Call the [**IDirect3DDevice9::SetTexture**](/windows/desktop/api) method to set the mipmap texture set as the first texture in the list of current textures.</span></span> <span data-ttu-id="162fc-162">Дополнительные сведения см. в разделе [смешение текстур (Direct3D 9)](texture-blending.md).</span><span class="sxs-lookup"><span data-stu-id="162fc-162">For more information, see [Texture Blending (Direct3D 9)](texture-blending.md).</span></span>

<span data-ttu-id="162fc-163">После того как приложение выберет набор текстур mipmap, ему необходимо присвоить значения из перечисляемого типа [**D3DTEXTUREFILTERTYPE**](./d3dtexturefiltertype.md) к \_ состоянию D3DSAMP мипфилтер.</span><span class="sxs-lookup"><span data-stu-id="162fc-163">After your application selects the mipmap texture set, it must assign values from the [**D3DTEXTUREFILTERTYPE**](./d3dtexturefiltertype.md) enumerated type to the D3DSAMP\_MIPFILTER sampler state.</span></span> <span data-ttu-id="162fc-164">Затем Direct3D автоматически выполняет фильтрацию текстур mipmap.</span><span class="sxs-lookup"><span data-stu-id="162fc-164">Direct3D then automatically performs mipmap texture filtering.</span></span> <span data-ttu-id="162fc-165">Включение фильтрации текстур mipmap демонстрируется в следующем примере кода.</span><span class="sxs-lookup"><span data-stu-id="162fc-165">Enabling mipmap texture filtering is demonstrated in the following code example.</span></span>


```
m_pD3DDevice->SetTexture(0, pMipMap);
m_pD3DDevice->SetSamplerState(0, D3DSAMP_MIPFILTER, D3DTEXF_POINT);
```



<span data-ttu-id="162fc-166">Приложение также может вручную пройти по цепочке поверхностей mipmap с помощью метода [**IDirect3DTexture9:: жетсурфацелевел**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dtexture9-getsurfacelevel) и указать уровень mipmap для получения.</span><span class="sxs-lookup"><span data-stu-id="162fc-166">Your application can also manually traverse a chain of mipmap surfaces by using the [**IDirect3DTexture9::GetSurfaceLevel**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dtexture9-getsurfacelevel) method and specifying the mipmap level to retrieve.</span></span> <span data-ttu-id="162fc-167">В следующем примере передается цепочка mipmap от высшего до самого низкого разрешения.</span><span class="sxs-lookup"><span data-stu-id="162fc-167">The following example traverses a mipmap chain from highest to lowest resolutions.</span></span>


```
IDirect3DSurface9 * pSurfaceLevel;
for (int iLevel = 0; iLevel < pMipMap->GetLevelCount(); iLevel++)
{
    pMipMap->GetSurfaceLevel(iLevel, &pSurfaceLevel);
    // Process this level
    pSurfaceLevel->Release();
}
```



<span data-ttu-id="162fc-168">Приложения должны вручную перемещаться по цепочке mipmap для загрузки данных точечного рисунка в каждую поверхность цепочки.</span><span class="sxs-lookup"><span data-stu-id="162fc-168">Applications need to manually traverse a mipmap chain to load bitmap data into each surface in the chain.</span></span> <span data-ttu-id="162fc-169">Как правило, это единственная причина для обхода цепи.</span><span class="sxs-lookup"><span data-stu-id="162fc-169">This is typically the only reason to traverse the chain.</span></span> <span data-ttu-id="162fc-170">Приложение может извлекать количество уровней в mipmap путем вызова [**IDirect3DBaseTexture9:: жетлевелкаунт**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dbasetexture9-getlevelcount).</span><span class="sxs-lookup"><span data-stu-id="162fc-170">An application can retrieve the number of levels in a mipmap by calling [**IDirect3DBaseTexture9::GetLevelCount**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dbasetexture9-getlevelcount).</span></span>

## <a name="related-topics"></a><span data-ttu-id="162fc-171">См. также</span><span class="sxs-lookup"><span data-stu-id="162fc-171">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="162fc-172">Фильтрация текстур</span><span class="sxs-lookup"><span data-stu-id="162fc-172">Texture Filtering</span></span>](texture-filtering.md)
</dt> </dl>

 

 
