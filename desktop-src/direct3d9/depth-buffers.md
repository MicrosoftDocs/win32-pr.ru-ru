---
description: Буфер глубины, часто также называемый z-буфером или w-буфером, — это свойство устройства, в котором хранятся сведения о глубине, используемые в Direct3D.
ms.assetid: vs|directx_sdk|~\depth_buffers.htm
title: Буферы глубины (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fc1ab41ba98ca5e3b08980ac90a572a19fc8a72a
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104494916"
---
# <a name="depth-buffers-direct3d-9"></a><span data-ttu-id="c5a62-103">Буферы глубины (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="c5a62-103">Depth Buffers (Direct3D 9)</span></span>

<span data-ttu-id="c5a62-104">Буфер глубины, часто также называемый z-буфером или w-буфером, — это свойство устройства, в котором хранятся сведения о глубине, используемые в Direct3D.</span><span class="sxs-lookup"><span data-stu-id="c5a62-104">A depth buffer, often called a z-buffer or a w-buffer, is a property of the device that stores depth information to be used by Direct3D.</span></span> <span data-ttu-id="c5a62-105">При отрисовке сцены на поверхности цели Direct3D может использовать память на связанной поверхности буфера глубины как рабочую область, чтобы определить, как пиксели преобразованных в растровый формат многоугольников закрывают друг друга.</span><span class="sxs-lookup"><span data-stu-id="c5a62-105">When Direct3D renders a scene to a target surface, it can use the memory in an associated depth-buffer surface as a workspace to determine how the pixels of rasterized polygons occlude one another.</span></span> <span data-ttu-id="c5a62-106">Direct3D использует поверхность Direct3D вне экрана в качестве цели, куда записываются окончательные значения цветов.</span><span class="sxs-lookup"><span data-stu-id="c5a62-106">Direct3D uses an off-screen Direct3D surface as the target to which final color values are written.</span></span> <span data-ttu-id="c5a62-107">Поверхность буфера глубины, связанная с поверхностью цели отрисовки, используется для хранения сведений о глубине, которые используются в Direct3D, чтобы определить глубину отображения каждого пикселя в сцене.</span><span class="sxs-lookup"><span data-stu-id="c5a62-107">The depth-buffer surface that is associated with the render-target surface is used to store depth information that tells Direct3D how deep each visible pixel is in the scene.</span></span>

<span data-ttu-id="c5a62-108">Когда сцена преобразуется в растровый формат с включенной буферизацией глубины, каждая точка на поверхности отрисовки проверяется.</span><span class="sxs-lookup"><span data-stu-id="c5a62-108">When a scene is rasterized with depth buffering enabled, each point on the rendering surface is tested.</span></span> <span data-ttu-id="c5a62-109">Значения в буфере глубины могут быть координатой z точки или ее однородной координатой w на основе координат расположения точки (x,y,z,w) в пространстве проекции.</span><span class="sxs-lookup"><span data-stu-id="c5a62-109">The values in the depth buffer can be a point's z-coordinate or its homogeneous w-coordinate - from the point's (x,y,z,w) location in projection space.</span></span> <span data-ttu-id="c5a62-110">Буфер глубины, в котором используются значения z-координаты, часто называется z-буфером, а тот, в котором используются значения w-координаты, — w-буфером.</span><span class="sxs-lookup"><span data-stu-id="c5a62-110">A depth buffer that uses z values is often called a z-buffer, and one that uses w values is called a w-buffer.</span></span> <span data-ttu-id="c5a62-111">У каждого типа буфера глубины есть преимущества и недостатки, которые будут подробно описаны далее.</span><span class="sxs-lookup"><span data-stu-id="c5a62-111">Each type of depth buffer has advantages and disadvantages, which are discussed later.</span></span>

<span data-ttu-id="c5a62-112">В начале теста в буфере глубины установлено максимально возможное для сцены значение глубины.</span><span class="sxs-lookup"><span data-stu-id="c5a62-112">At the beginning of the test, the depth value in the depth buffer is set to the largest possible value for the scene.</span></span> <span data-ttu-id="c5a62-113">В качестве значения цвета на поверхности отрисовки используется либо значение цвета фона, либо значение цвета текстуры фона в этой точке.</span><span class="sxs-lookup"><span data-stu-id="c5a62-113">The color value on the rendering surface is set to either the background color value or the color value of the background texture at that point.</span></span> <span data-ttu-id="c5a62-114">Каждый полигон в сцене проверяется на предмет пересечения с текущей координатой (x,y) на поверхности отрисовки.</span><span class="sxs-lookup"><span data-stu-id="c5a62-114">Each polygon in the scene is tested to see if it intersects with the current coordinate (x,y) on the rendering surface.</span></span> <span data-ttu-id="c5a62-115">Если это так, то значение глубины, которое будет координатой z в z-буфере, и координата w в w-buffer — в текущей точке проверяется на предмет меньшего значения глубины, хранящегося в буфере глубины.</span><span class="sxs-lookup"><span data-stu-id="c5a62-115">If it does, the depth value - which will be the z coordinate in a z-buffer, and the w coordinate in a w-buffer - at the current point is tested to see if it is smaller than the depth value stored in the depth buffer.</span></span> <span data-ttu-id="c5a62-116">Если значение глубины полигона меньше, оно сохраняется в буфер глубины, а значение цвета полигона записывается в текущую точку на поверхности отрисовки.</span><span class="sxs-lookup"><span data-stu-id="c5a62-116">If the depth of the polygon value is smaller, it is stored in the depth buffer and the color value from the polygon is written to the current point on the rendering surface.</span></span> <span data-ttu-id="c5a62-117">Если значение глубины полигона в этой точке больше, проверяется следующий полигон в списке.</span><span class="sxs-lookup"><span data-stu-id="c5a62-117">If the depth value of the polygon at that point is larger, the next polygon in the list is tested.</span></span> <span data-ttu-id="c5a62-118">Этот процесс показан на следующей схеме.</span><span class="sxs-lookup"><span data-stu-id="c5a62-118">This process is shown in the following diagram.</span></span>

![схема проверки значений глубины](images/zbuffer.png)

> [!Note]  
> <span data-ttu-id="c5a62-120">Хотя в большинстве приложений эта функция не используется, вы можете изменить сравнение, используемое в Direct3D для определения того, какие значения следует поместить в буфер глубины и в дальнейшем на поверхность цели отрисовки.</span><span class="sxs-lookup"><span data-stu-id="c5a62-120">Although most applications don't use this feature, you can change the comparison that Direct3D uses to determine which values are placed in the depth buffer and subsequently the render-target surface.</span></span> <span data-ttu-id="c5a62-121">Для этого измените значение для \_ состояния рендеринга D3DRS зфунк.</span><span class="sxs-lookup"><span data-stu-id="c5a62-121">To do so, change the value for the D3DRS\_ZFUNC render state.</span></span> <span data-ttu-id="c5a62-122">На некоторых видах оборудования при изменении функции сравнения может отключиться иерархическая проверка z-буферов.</span><span class="sxs-lookup"><span data-stu-id="c5a62-122">On some hardware, changing the compare function may disable hierarchical z testing.</span></span>

 

<span data-ttu-id="c5a62-123">Почти все представленные на рынке ускорители поддерживают z-буферизацию, поэтому z-буферы — один из самых распространенных типов буферов глубины на сегодняшний день.</span><span class="sxs-lookup"><span data-stu-id="c5a62-123">Nearly all accelerators on the market support z-buffering, making z-buffers the most common type of depth buffer today.</span></span> <span data-ttu-id="c5a62-124">Но несмотря на широкую распространенность, у z-буферов есть определенные недостатки.</span><span class="sxs-lookup"><span data-stu-id="c5a62-124">However ubiquitous, z-buffers have their drawbacks.</span></span> <span data-ttu-id="c5a62-125">Из-за особенностей выполняемых математических операций генерируемые z-значения в z-буфере часто не распределяются равномерно в диапазоне z-буфера (как правило, от 0,0 до 1,0 включительно).</span><span class="sxs-lookup"><span data-stu-id="c5a62-125">Due to the mathematics involved, the generated z values in a z-buffer tend not to be distributed evenly across the z-buffer range (typically 0.0 to 1.0, inclusive).</span></span> <span data-ttu-id="c5a62-126">В частности, соотношение между дальней и ближней плоскостями отсечения сильно влияет на неравномерность распределения z-значений.</span><span class="sxs-lookup"><span data-stu-id="c5a62-126">Specifically, the ratio between the far and near clipping planes strongly affects how unevenly z values are distributed.</span></span> <span data-ttu-id="c5a62-127">Если соотношение между расстояниями до дальней и ближней плоскостей равно 100, 90% диапазона буфера глубины занимается первыми 10% диапазона глубины сцены.</span><span class="sxs-lookup"><span data-stu-id="c5a62-127">Using a far-plane distance to near-plane distance ratio of 100, 90 percent of the depth buffer range is spent on the first 10 percent of the scene depth range.</span></span> <span data-ttu-id="c5a62-128">В обычных приложениях для развлечения или визуального моделирования с внешними сценами часто требуется соотношение между расстояниями до дальней и ближней плоскостей в диапазоне от 1 000 до 10 000.</span><span class="sxs-lookup"><span data-stu-id="c5a62-128">Typical applications for entertainment or visual simulations with exterior scenes often require far-plane/near-plane ratios of anywhere between 1,000 to 10,000.</span></span> <span data-ttu-id="c5a62-129">При соотношении 1 000 98% диапазона занимается первыми 2% диапазона глубины, а при повышении соотношения равномерность распределения падает.</span><span class="sxs-lookup"><span data-stu-id="c5a62-129">At a ratio of 1,000, 98 percent of the range is spent on the first 2 percent of the depth range, and the distribution becomes worse with higher ratios.</span></span> <span data-ttu-id="c5a62-130">Это может привести к скрытым артефактам поверхности дальних объектов, особенно при использовании 16-разрядных буферов глубины, наиболее широко поддерживаемой глубине.</span><span class="sxs-lookup"><span data-stu-id="c5a62-130">This can cause hidden surface artifacts in distant objects, especially when using 16-bit depth buffers, the most commonly supported bit-depth.</span></span>

<span data-ttu-id="c5a62-131">С другой стороны, w-буфер глубины обычно обеспечивает более равномерное распределение между ближней и дальней плоскостями отсечения, чем z-буфер.</span><span class="sxs-lookup"><span data-stu-id="c5a62-131">A w-based depth buffer, on the other hand, is often more evenly distributed between the near and far clip planes than a z-buffer.</span></span> <span data-ttu-id="c5a62-132">Главное преимущество заключается в том, что соотношение расстояний до дальней и ближней плоскостей отсечения больше не доставляет проблем.</span><span class="sxs-lookup"><span data-stu-id="c5a62-132">The key benefit is that the ratio of distances for the far and near clipping planes is no longer an issue.</span></span> <span data-ttu-id="c5a62-133">За счет этого приложения могут поддерживать большие максимальные диапазоны, при этом обеспечивая относительно точную буферизацию глубины вблизи базовой точки визуализации сцены.</span><span class="sxs-lookup"><span data-stu-id="c5a62-133">This allows applications to support large maximum ranges, while still getting relatively accurate depth buffering close to the eye point.</span></span> <span data-ttu-id="c5a62-134">W-буфер глубины не идеален и иногда может приводить к возникновению скрытых артефактов поверхности ближних объектов.</span><span class="sxs-lookup"><span data-stu-id="c5a62-134">A w-based depth buffer isn't perfect, and can sometimes exhibit hidden surface artifacts for near objects.</span></span> <span data-ttu-id="c5a62-135">Еще один недостаток использования w-буфера связан с поддержкой оборудования: w-буферизация не так широко поддерживается на оборудовании, как z-буферизация.</span><span class="sxs-lookup"><span data-stu-id="c5a62-135">Another drawback to the w-buffered approach is related to hardware support: w-buffering isn't supported as widely in hardware as z-buffering.</span></span>

<span data-ttu-id="c5a62-136">Для использования z-буфера требуются дополнительные ресурсы при отрисовке.</span><span class="sxs-lookup"><span data-stu-id="c5a62-136">Using a z-buffer requires overhead during rendering.</span></span> <span data-ttu-id="c5a62-137">Существуют различные методы оптимизации отрисовки с использованием z-буферов.</span><span class="sxs-lookup"><span data-stu-id="c5a62-137">Various techniques can be used to optimize rendering when using z-buffers.</span></span> <span data-ttu-id="c5a62-138">Дополнительные сведения см. в разделе [производительность Z-буфера](performance-optimizations.md).</span><span class="sxs-lookup"><span data-stu-id="c5a62-138">For details, see [Z-Buffer Performance](performance-optimizations.md).</span></span>

> [!Note]  
> <span data-ttu-id="c5a62-139">Фактическая интерпретация значения глубины зависит от конкретного обработчика.</span><span class="sxs-lookup"><span data-stu-id="c5a62-139">The actual interpretation of a depth value is specific to the renderer.</span></span>

 

<span data-ttu-id="c5a62-140">В этом разделе представлены сведения об использовании буферов глубины для скрытой линии и удаления скрытых областей.</span><span class="sxs-lookup"><span data-stu-id="c5a62-140">This section presents information about using depth buffers for hidden line and hidden surface removal.</span></span>

-   [<span data-ttu-id="c5a62-141">Запросы для поддержки буфера глубины (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="c5a62-141">Querying for Depth Buffer Support (Direct3D 9)</span></span>](querying-for-depth-buffer-support.md)
-   [<span data-ttu-id="c5a62-142">Создание буфера глубины (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="c5a62-142">Creating a Depth Buffer (Direct3D 9)</span></span>](creating-a-depth-buffer.md)
-   [<span data-ttu-id="c5a62-143">Включение буферизации глубины (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="c5a62-143">Enabling Depth Buffering (Direct3D 9)</span></span>](enabling-depth-buffering.md)
-   [<span data-ttu-id="c5a62-144">Получение буфера глубины (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="c5a62-144">Retrieving a Depth Buffer (Direct3D 9)</span></span>](retrieving-a-depth-buffer.md)
-   [<span data-ttu-id="c5a62-145">Очистка буферов глубины (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="c5a62-145">Clearing Depth Buffers (Direct3D 9)</span></span>](clearing-depth-buffers.md)
-   [<span data-ttu-id="c5a62-146">Изменение доступа на запись в буфер глубины (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="c5a62-146">Changing Depth Buffer Write Access (Direct3D 9)</span></span>](changing-depth-buffer-write-access.md)
-   [<span data-ttu-id="c5a62-147">Изменение функций сравнения буферов глубины (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="c5a62-147">Changing Depth Buffer Comparison Functions (Direct3D 9)</span></span>](changing-depth-buffer-comparison-functions.md)

## <a name="related-topics"></a><span data-ttu-id="c5a62-148">См. также</span><span class="sxs-lookup"><span data-stu-id="c5a62-148">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c5a62-149">Визуализация Direct3D</span><span class="sxs-lookup"><span data-stu-id="c5a62-149">Direct3D Rendering</span></span>](direct3d-rendering.md)
</dt> </dl>

 

 



