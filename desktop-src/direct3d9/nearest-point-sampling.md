---
description: От приложений не требуется использовать фильтрацию текстур.
ms.assetid: bba0e485-ac5a-4e43-9eb7-25cd0c90d316
title: Выборка Nearest-Point (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b11cf98ee917b124b35f3c30ff263365ec3c46e1
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104416672"
---
# <a name="nearest-point-sampling-direct3d-9"></a><span data-ttu-id="18dbf-103">Выборка Nearest-Point (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="18dbf-103">Nearest-Point Sampling (Direct3D 9)</span></span>

<span data-ttu-id="18dbf-104">От приложений не требуется использовать фильтрацию текстур.</span><span class="sxs-lookup"><span data-stu-id="18dbf-104">Applications are not required to use texture filtering.</span></span> <span data-ttu-id="18dbf-105">Интерфейс Direct3D можно настроить таким образом, чтобы он вычислял адрес текселя, который часто не является целым числом, и копировал цвет текселя с ближайшим целочисленным адресом.</span><span class="sxs-lookup"><span data-stu-id="18dbf-105">Direct3D can be set so that it computes the texel address, which often does not evaluate to integers, and copies the color of the texel with the closest integer address.</span></span> <span data-ttu-id="18dbf-106">Этот процесс называется выборкой с ближайшей точки.</span><span class="sxs-lookup"><span data-stu-id="18dbf-106">This process is called nearest-point sampling.</span></span> <span data-ttu-id="18dbf-107">Это может быть быстрым и эффективным способом обработки текстур, если размер текстуры аналогичен размеру изображения-примитива на экране.</span><span class="sxs-lookup"><span data-stu-id="18dbf-107">This can be a fast and efficient way to process textures if the size of the texture is similar to the size of the primitive's image on the screen.</span></span> <span data-ttu-id="18dbf-108">В противном случае текстуру необходимо увеличить или уменьшить.</span><span class="sxs-lookup"><span data-stu-id="18dbf-108">If not, the texture must be magnified or minified.</span></span> <span data-ttu-id="18dbf-109">Результат может быть больших, псевдонимом или размытым изображением.</span><span class="sxs-lookup"><span data-stu-id="18dbf-109">The result can be a chunky, aliased, or blurred image.</span></span>

<span data-ttu-id="18dbf-110">Приложение C++ может выбрать выборку с ближайшей точкой, вызвав метод [**IDirect3DDevice9:: сетсамплерстате**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setsamplerstate) .</span><span class="sxs-lookup"><span data-stu-id="18dbf-110">Your C++ application can select nearest-point sampling by calling the [**IDirect3DDevice9::SetSamplerState**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setsamplerstate) method.</span></span> <span data-ttu-id="18dbf-111">Задайте для первого параметра значение целочисленного индекса (0-7) текстуры, для которой выбирается метод фильтрации текстур.</span><span class="sxs-lookup"><span data-stu-id="18dbf-111">Set the value of the first parameter to the integer index number (0-7) of the texture for which you are selecting a texture filtering method.</span></span> <span data-ttu-id="18dbf-112">Передайте D3DSAMP \_ магфилтер, D3DSAMP \_ МИНФИЛТЕР или D3DSAMP \_ мипфилтер во второй параметр, чтобы задать фильтр увеличения, минификации или функции текстурирования.</span><span class="sxs-lookup"><span data-stu-id="18dbf-112">Pass D3DSAMP\_MAGFILTER, D3DSAMP\_MINFILTER, or D3DSAMP\_MIPFILTER for the second parameter to set the magnification, minification, or mipmapping filter.</span></span> <span data-ttu-id="18dbf-113">Передайте \_ точку D3DTEXF в третьем параметре.</span><span class="sxs-lookup"><span data-stu-id="18dbf-113">Pass D3DTEXF\_POINT in the third parameter.</span></span>

<span data-ttu-id="18dbf-114">Следует тщательно использовать выборку с ближайшей точкой, так как иногда это может вызвать графические артефакты при выборе текстуры в границах между двумя пикселей текстуры.</span><span class="sxs-lookup"><span data-stu-id="18dbf-114">You should use nearest-point sampling carefully, because it can sometimes cause graphic artifacts when the texture is sampled at the boundary between two texels.</span></span> <span data-ttu-id="18dbf-115">Эта граница представляет собой расположение вдоль одной из осей текстуры (u или v), в котором используемый тексель переходит от одного текселя к другому.</span><span class="sxs-lookup"><span data-stu-id="18dbf-115">This boundary is the position along the texture (u or v) at which the sampled texel transitions from one texel to the next.</span></span> <span data-ttu-id="18dbf-116">При выборке в точке система выбирает один или другой тексель, и результат на разных текселях может резко отличаться, поскольку пересекается граница.</span><span class="sxs-lookup"><span data-stu-id="18dbf-116">When point sampling is used, the system chooses one sample texel or the other, and the result can change abruptly from one texel to the next texel as the boundary is crossed.</span></span> <span data-ttu-id="18dbf-117">Это может проявиться как нежелательные графические артефакты в отображаемой текстуре.</span><span class="sxs-lookup"><span data-stu-id="18dbf-117">This effect can appear as undesired graphic artifacts in the displayed texture.</span></span> <span data-ttu-id="18dbf-118">Если используется линейная фильтрация, полученный тексель вычисляется на основании обоих соседних текселей, и он плавно переходит между ними, поскольку индекс текселя пересекает границу.</span><span class="sxs-lookup"><span data-stu-id="18dbf-118">When linear filtering is used, the resulting texel is computed from both adjacent texels and smoothly blends between them as the texture index moves through the boundary.</span></span>

<span data-ttu-id="18dbf-119">Этот эффект может быть виден при разметке очень маленькой текстуры на очень большом многоугольнике, такую операцию часто называют увеличением.</span><span class="sxs-lookup"><span data-stu-id="18dbf-119">This effect can be seen when mapping a very small texture onto a very large polygon: an operation often called magnification.</span></span> <span data-ttu-id="18dbf-120">Например, при использовании текстуры в виде шахматной доски, выборка в ближайшей точке приводит созданию более крупной шахматной доски, на которой четко видны края.</span><span class="sxs-lookup"><span data-stu-id="18dbf-120">For example, when using a texture that looks like a checkerboard, nearest-point sampling results in a larger checkerboard that shows distinct edges.</span></span> <span data-ttu-id="18dbf-121">В отличие от этого, линейная фильтрация текстур создает изображение, где цвета шахматной доски плавно меняются по поверхности многоугольника.</span><span class="sxs-lookup"><span data-stu-id="18dbf-121">By contrast, linear texture filtering results in an image where the checkerboard colors vary smoothly across the polygon.</span></span>

<span data-ttu-id="18dbf-122">В большинстве случаев приложения достигают наилучших результатов, избегая выборку в ближайшей точке, где это возможно.</span><span class="sxs-lookup"><span data-stu-id="18dbf-122">In most cases, applications receive the best results by avoiding nearest-point sample wherever possible.</span></span> <span data-ttu-id="18dbf-123">Сегодня большая часть оборудования оптимизирована для линейной фильтрации, поэтому ваше приложение не должно испытывать снижение качества при работе.</span><span class="sxs-lookup"><span data-stu-id="18dbf-123">The majority of hardware today is optimized for linear filtering, so your application should not suffer degraded performance.</span></span> <span data-ttu-id="18dbf-124">Если необходимый вам эффект неизбежно требует использования выборки в ближайшей точке, например при использовании текстуры для отображения читаемых текстовых символов, ваше приложение должно проявлять особую осторожность и не производить выборку на границах текселей, которая может привести к нежелательным последствиям.</span><span class="sxs-lookup"><span data-stu-id="18dbf-124">If the effect you desire absolutely requires the use of the nearest-point sampling - such as when using textures to display readable text characters - then your application should be extremely careful to avoid sampling at the texel boundaries, which might result in undesired effects.</span></span> <span data-ttu-id="18dbf-125">На иллюстрации ниже показано, как могут выглядеть такие артефакты.</span><span class="sxs-lookup"><span data-stu-id="18dbf-125">The following illustration shows what these artifacts can look like.</span></span>

![иллюстрация прямоугольника из шести сегментов с разрывами в горизонтальных линиях в двух правых верхних квадратах](images/ptrtfct.png)

<span data-ttu-id="18dbf-127">Обратите внимание, что два квадрата в правом верхнем углу группы отображаются не так, как соседние, с диагональными смещениями, выполняемыми через них.</span><span class="sxs-lookup"><span data-stu-id="18dbf-127">Notice that the two squares in the upper right of the group appear different than their neighbors, with diagonal offsets running through them.</span></span> <span data-ttu-id="18dbf-128">Во избежание появления таких графических артефактов необходимо понимать правила выборки текстур в Direct3D при фильтрации по ближайшей точке.</span><span class="sxs-lookup"><span data-stu-id="18dbf-128">To avoid graphic artifacts like these, you must be familiar with Direct3D texture sampling rules for nearest-point filtering.</span></span> <span data-ttu-id="18dbf-129">Direct3D сопоставляет координату текстуры с плавающей запятой в диапазоне от \[ 0,0, 1,0 \] (0,0 до 1,0 включительно) с целым шаг текселя значением пространства в диапазоне от \[ -0,5, n-0,5 \] , где n — число пикселей текстуры в заданном измерении текстуры.</span><span class="sxs-lookup"><span data-stu-id="18dbf-129">Direct3D maps a floating-point texture coordinate ranging from \[0.0, 1.0\] (0.0 to 1.0, inclusive) to an integer texel space value ranging from \[ - 0.5, n - 0.5\], where n is the number of texels in a given dimension on the texture.</span></span> <span data-ttu-id="18dbf-130">Полученный индекс текстуры округляется до ближайшего целого числа.</span><span class="sxs-lookup"><span data-stu-id="18dbf-130">The resulting texture index is rounded to the nearest integer.</span></span> <span data-ttu-id="18dbf-131">Данное сопоставление может привести к неточности выборки на границах текселей.</span><span class="sxs-lookup"><span data-stu-id="18dbf-131">This mapping can introduce sampling inaccuracies at texel boundaries.</span></span>

<span data-ttu-id="18dbf-132">В качестве простого примера представьте себе приложение, которое визуализирует многоугольники в \_ режиме адресации текстуры D3DTADDRESS.</span><span class="sxs-lookup"><span data-stu-id="18dbf-132">For a simple example, imagine an application that renders polygons with the D3DTADDRESS\_WRAP texture addressing mode.</span></span> <span data-ttu-id="18dbf-133">Используя такое применяемое Direct3D сопоставление, индекс текстуры u сопоставляется, как показано на следующей схеме для текстуры с шириной 4 текселя.</span><span class="sxs-lookup"><span data-stu-id="18dbf-133">Using the mapping employed by Direct3D, the u texture index maps as show in the following diagram for a texture with a width of 4 texels.</span></span>

![схема координат текстуры 0,0 и 1,0 на границе между текселями](images/ptsmpprb.png)

<span data-ttu-id="18dbf-135">Обратите внимание, что координаты текстуры 0,0 и 1,0 для этой иллюстрации находятся в точности на границе между пикселей текстуры.</span><span class="sxs-lookup"><span data-stu-id="18dbf-135">Notice that the texture coordinates, 0.0 and 1.0 for this illustration, are exactly at the boundary between texels.</span></span> <span data-ttu-id="18dbf-136">Используя метод, с помощью которого Direct3D сопоставляет значения, координаты текстуры находятся в диапазоне от \[ -0,5, 4-0,5 \] , где 4 — это ширина текстуры.</span><span class="sxs-lookup"><span data-stu-id="18dbf-136">Using the method by which Direct3D maps values, the texture coordinates range from \[ - 0.5, 4 - 0.5\], where 4 is the width of the texture.</span></span> <span data-ttu-id="18dbf-137">В этом случае полученный при выборке тексель является текселем 0 для индекса текстуры 1,0.</span><span class="sxs-lookup"><span data-stu-id="18dbf-137">For this case, the sampled texel is the 0 texel for a texture index of 1.0.</span></span> <span data-ttu-id="18dbf-138">Однако, если координата текстуры будет немного меньше 1,0, полученный при выборке тексель будет текселем n, а не текселем 0.</span><span class="sxs-lookup"><span data-stu-id="18dbf-138">However, if the texture coordinate was only slightly less than 1.0, the sampled texel would be the n texel instead of the 0 texel.</span></span>

<span data-ttu-id="18dbf-139">Это означает, что увеличение небольшой текстуры с помощью координат текстуры, точно равных 0,0 и 1,0, и с использованием фильтрации по ближайшей точке в выровненном по экрану треугольнике приведет к созданию пикселей, для которых выборка в сопоставлении текстуры будет выполняться на границе между текселями.</span><span class="sxs-lookup"><span data-stu-id="18dbf-139">The implication of this is that magnifying a small texture using texture coordinates of exactly 0.0 and 1.0 with nearest-point filtering on a screen-space aligned triangle results in pixels for which the texture map is sampled at the boundary between texels.</span></span> <span data-ttu-id="18dbf-140">Любые неточности при вычислении координат текстуры, какими бы незначительными они ни были, приводят к возникновению артефактов рядом с теми областями в отрисованном изображении, которые соответствуют краям текселей в сопоставлении текстуры.</span><span class="sxs-lookup"><span data-stu-id="18dbf-140">Any inaccuracies in the computation of texture coordinates, however small, results in artifacts along the areas in the rendered image which correspond to the texel edges of the texture map.</span></span>

<span data-ttu-id="18dbf-141">Выполнение этого сопоставления координат текстуры с плавающей запятой с целочисленными текселями с идеальной точностью является очень сложным, требует много времени и обычно не требуется.</span><span class="sxs-lookup"><span data-stu-id="18dbf-141">Performing this mapping of floating point texture coordinates to integer texels with perfect accuracy is difficult, computationally time-consuming, and generally not necessary.</span></span> <span data-ttu-id="18dbf-142">В большинстве аппаратных реализаций используется итеративный подход для вычисления координат текстуры в расположении каждого пикселя в треугольнике.</span><span class="sxs-lookup"><span data-stu-id="18dbf-142">Most hardware implementations use an iterative approach for computing texture coordinates at each pixel location within a triangle.</span></span> <span data-ttu-id="18dbf-143">Итеративные подходы обычно скрывают эти неточности, поскольку ошибки во время итераций накапливаются равномерно.</span><span class="sxs-lookup"><span data-stu-id="18dbf-143">Iterative approaches tend to hide these inaccuracies because the errors are accumulated evenly during iteration.</span></span>

<span data-ttu-id="18dbf-144">Средство программной прорисовки Direct3D использует подход с прямой оценкой для вычисления индексов текстуры в расположении каждого пикселя.</span><span class="sxs-lookup"><span data-stu-id="18dbf-144">The Direct3D reference rasterizer uses a direct-evaluation approach for computing texture indexes at each pixel location.</span></span> <span data-ttu-id="18dbf-145">Прямое вычисление отличается от итеративного подхода тем, что любая неточность в этой операции приводит к более беспорядочному распределению ошибок.</span><span class="sxs-lookup"><span data-stu-id="18dbf-145">Direct evaluation differs from the iterative approach in that any inaccuracy in the operation exhibits a more random error distribution.</span></span> <span data-ttu-id="18dbf-146">Таким образом ошибки выборки, которые происходят на границах, могут быть более заметными, поскольку средство программной прорисовки не выполняет эту операцию с идеальной точностью.</span><span class="sxs-lookup"><span data-stu-id="18dbf-146">The result of this is that the sampling errors that occur at the boundaries can be more noticeable because the reference rasterizer does not perform this operation with perfect accuracy.</span></span>

<span data-ttu-id="18dbf-147">Лучший подход — использовать фильтрацию по ближайшей точке только в случае необходимости.</span><span class="sxs-lookup"><span data-stu-id="18dbf-147">The best approach is to use nearest-point filtering only when necessary.</span></span> <span data-ttu-id="18dbf-148">Если использовать ее необходимо, рекомендуется слегка смещать координаты текстуры от границы, чтобы избежать возникновения артефактов.</span><span class="sxs-lookup"><span data-stu-id="18dbf-148">When you must use it, it is recommended that you offset texture coordinates slightly from the boundary positions to avoid artifacts.</span></span>

## <a name="related-topics"></a><span data-ttu-id="18dbf-149">См. также</span><span class="sxs-lookup"><span data-stu-id="18dbf-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="18dbf-150">Фильтрация текстур</span><span class="sxs-lookup"><span data-stu-id="18dbf-150">Texture Filtering</span></span>](texture-filtering.md)
</dt> </dl>

 

 
