---
description: Direct3D позволяет приложению повысить реальную работу, выполнив визуализацию сегментированных объектов-многоугольников (особенно символов), имеющих гладкие смешивание.
ms.assetid: 190d5865-c45b-42ea-8a16-10a4f0bda743
title: Смешение геометрических объектов (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a19daa40f7d7d8193ae486640bc613dd7a666ec7
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "103805188"
---
# <a name="geometry-blending-direct3d-9"></a>Смешение геометрических объектов (Direct3D 9)

Direct3D позволяет приложению повысить реальную работу, выполнив визуализацию сегментированных объектов-многоугольников (особенно символов), имеющих гладкие смешивание. Эти эффекты часто называются обложками. Система достигает этого результата, применяя дополнительные матрицы универсального преобразования к одному набору вершин для создания нескольких результатов, а затем выполняет линейное смешение между результирующими вершинами для создания одного набора геометрии для отрисовки. Этот процесс показан на следующей иллюстрации.

![Иллюстрация процесса смешения двух объектов с текстурой с неменяющими скобками](images/geometry-blend.png)

На предыдущем рисунке показано, как можно представить процесс смешивания геометрического смешения. В одном вызове подготовки к просмотру система принимает вершины для «вниз», преобразует их дважды, без изменения, и один раз с простым поворотом и объединяет результаты, чтобы создать изогнутое значение «вниз». Система смешивает расположение вершины, а также нормальную вершину, когда освещение включено. Приложения не ограничиваются двумя путями смешивания. С помощью Direct3D можно смешивать геометрические объекты, накладываемые на четыре мировых матрицы, включая стандартную матрицу мира [**D3DTS \_ World**](d3dts-world.md).

> [!Note]
>
> Если освещение включено, нормали вершин преобразуются в соответствующую матрицу представления мира, взвешенную таким же образом, как и при вычислении расположения вершины. Система нормализует результирующий нормальный вектор, если \_ состояние визуализации D3DRS нормализенормалс имеет значение **true**.

 

При отсутствии смешения геометрии динамически построенные модели часто подготавливаются к просмотру в виде сегментов. Например, рассмотрим трехмерную модель человеческих рычагов. В самом простом представлении ARM состоит из двух частей: верхней ARM, который подключается к телу, и нижней ARM, который подключается к руки. Эти два соединения соединены с изгибом, а нижняя точка вращения — на этом этапе. Приложение, обрабатывающее ARM, может хранить данные вершин для верхней и нижней ARM, каждый из которых имеет отдельную матрицу преобразования мира. Это показано в следующем примере кода.


```
typedef struct _Arm
{
    VERTEX upper_arm_verts[200];
    D3DMATRIX matWorld_Upper;

    VERTEX lower_arm_verts[200];
    D3DMATRIX matWorld_Lower;
} ARM, *LPARM;

ARM MyArm; // This needs to be initialized.
```



Для визуализации ARM создаются два вызова отрисовки, как показано в следующем коде.


```
// Render the upper arm.
d3dDevice->SetTransform( D3DTS_WORLD, &MyArm.matWorld_Upper );
d3dDevice->DrawPrimitive( D3DPT_TRIANGLELIST, 0, numFaces );

// Render the lower arm, updating its world matrix to articulate
// the arm by pi/4 radians (45 degrees) at the elbow.
MyArm.matWorld_Lower = RotateMyArm(MyArm.matWorld, pi/4);
d3dDevice->SetTransform( D3DTS_WORLD, &MyArm.matWorld_Lower );
d3dDevice->DrawPrimitive( D3DPT_TRIANGLELIST, 0, numFaces );
```



На следующем рисунке для использования этого метода изменено значение «неменяющий».

![Иллюстрация смешенного вниз без смешения геометрии](images/noblend.png)

Различия между смешиванием и несмешением геометрии очевидны. Этот пример является несколько крайним. В реальных приложениях соединения сегментированных моделей разрабатываются так, чтобы стыки не настолько очевидны. Однако стыки видны во времени, что представляет собой постоянные проблемы, связанные с конструкторами моделей.

Смешивание геометрии в Direct3D представляет собой альтернативу классическому сценарию сегментированного моделирования. Однако улучшенное визуальное качество сегментированных объектов достигается за счет использования вычислений смешения во время отрисовки. Чтобы уменьшить влияние этих дополнительных операций, конвейер обработки геометрии Direct3D оптимизирован для смешивания геометрии с минимально возможными издержками. Приложения, которые эффективно используют службы смешения геометрических объектов, предлагаемые Direct3D, могут улучшить реальную работу своих символов и избежать серьезных последствий в производительности.

## <a name="blending-transform-and-render-states"></a>Смешение преобразований и состояний отрисовки

Метод [**IDirect3DDevice9:: сеттрансформ**](/windows/desktop/api) распознает макросы [**D3DTS \_ World**](d3dts-world.md) и [**D3DTS \_ ворлдн**](d3dts-worldn.md) , соответствующие значениям, которые могут быть определены с помощью макроса [**D3DTS \_ ворлдматрикс**](d3dts-worldmatrix.md) . Эти макросы используются для указания матриц, между которыми будет осуществляться смешение геометрического объекта.

Перечислимый тип [**D3DRENDERSTATETYPE**](./d3drenderstatetype.md) включает \_ состояние отображения D3DRS вертексбленд, чтобы включить и контролировать смешение геометрических объектов. Допустимые значения для этого состояния рендеринга определяются перечисляемым типом [**D3DVERTEXBLENDFLAGS**](./d3dvertexblendflags.md) . Если включено смешение геометрических объектов, формат вершины должен включать соответствующее число весов.

## <a name="blending-weights"></a>Весовые коэффициенты смешения

Вес смешения, иногда называемый весом бета-версии, управляет степенью, в которой данная матрица мира влияет на вершину. Весовые коэффициенты смешения — это значения с плавающей запятой в диапазоне от 0,0 до 1,0, закодированные в формате вершин, где значение 0,0 означает, что вершина не смешивается с этой матрицей, а 1,0 означает, что вершина затронута матрицей полностью.

Весовые коэффициенты смешивания геометрических значений кодируются в формате вершин, который отображается сразу после расположения для каждой вершины, как описано в разделе [фиксированная функция Фвф Codes (Direct3D 9)](fixed-function-fvf-codes.md). Вы сообщаете о числе весовых коэффициентов смешения в формате вершин, включая одну из [констант фвф](d3dfvf.md) в описание вершины, которое предоставляется методам подготовки к просмотру.

Система выполняет линейное смешение между взвешенными результатами матриц смешения. Следующее уравнение является полной формулой смешения.

![уравнение линейного смешения, использование матриц мирового преобразования](images/vert-blend-formula.png)

В предыдущем уравнении Вбленд — это вершина вывода, v-элементы — это вершины, создаваемые примененной матрицей мира ([**D3DTS \_ ворлдн**](d3dts-worldn.md)). Элементы W являются соответствующими значениями веса в формате вершины. Вершина, накладываемая между n матрицами, может иметь значения веса смешения, по одному для каждой матрицы смешения, за исключением последней. Система автоматически создает вес для последней матрицы мира, чтобы сумма всех весов была 1,0, выраженная в нотации Сигма. Эту формулу можно упростить для каждого варианта, поддерживаемого Direct3D, который показан в следующих уравнениях.

![формулы линейного смешения для трех вариантов смешивания](images/vert-blend-formulas-simple.png)

Это упрощенные формы полной формулы смешения для двух, трех и четырех вариантов матрицы смешения.

> [!Note]  
> Хотя Direct3D включает дескрипторы ФВФ для определения вершин, которые содержат до пяти весов смешения, в этом выпуске DirectX можно использовать только три.

 

Дополнительные сведения содержатся в следующих разделах.

-   [Использование смешения геометрии (Direct3D 9)](using-geometry-blending.md)
-   [Индексированное смешение вершин (Direct3D 9)](indexed-vertex-blending.md)
-   [Анимированная анимация вершин (Direct3D 9)](vertex-tweening.md)

## <a name="related-topics"></a>См. также

<dl> <dt>

[Конвейер вершин](vertex-pipeline.md)
</dt> </dl>

 

 
