---
title: Код уведомления TVN_ASYNCDRAW (Коммктрл. h)
description: Посылается элементом управления иерархического представления родительскому элементу, когда произошел сбой при рисовании значка или оверлея. Этот код уведомления отправляется в виде \_ сообщения WM notify.
ms.assetid: 209bfffb-e57d-435d-98a1-8b117c4969b1
keywords:
- TVN_ASYNCDRAW кода уведомления Windows элементы управления
topic_type:
- apiref
api_name:
- TVN_ASYNCDRAW
api_location:
- Commctrl.h
api_type:
- HeaderDef
ms.topic: reference
ms.date: 05/31/2018
ms.openlocfilehash: 5e4d929977e1a14a5ada96232fa054c2689d27f1eaa026b64c974d51f5a2c38c
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120060104"
---
# <a name="tvn_asyncdraw-notification-code"></a>\_Код уведомления ТВН асинкдрав

Посылается элементом управления иерархического представления родительскому элементу, когда произошел сбой при рисовании значка или оверлея. Этот код уведомления отправляется в виде сообщения [**WM \_ Notify**](wm-notify.md) .


```C++
TVN_ASYNCDRAW
        
    pnmTVAsynchDraw =  (NMTVASYNCDRAW *) lParam; 
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*lParam* 
</dt> <dd>

Указатель на структуру [**нмтвасинкдрав**](/windows/win32/api/commctrl/ns-commctrl-nmtvasyncdraw) . Структура **нмтвасинкдрав** содержит причину сбоя рисования.

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Нет возвращаемого значения.

## <a name="remarks"></a>Remarks

Элемент управления "представление дерева" должен иметь расширенный стиль " [**телевизоры \_ \_ дравимажеасинк**](tree-view-control-window-extended-styles.md) ". Обратите внимание, что это эквивалентно флагу ЛВН асинкдравн в виде списка \_ и соответствующему стилю.

Этот элемент управления не рисуется асинхронно. Асинхронный используется в контексте, который элемент управления "представление дерева" не выполняет синхронный Извлечение изображения, если оно недоступно. (Например, изображение может быть недоступно, если элемент управления "представление дерева" использует список разреженных изображений, так как изображение может быть выгружено.) Вместо этого, если изображение недоступно, элемент управления синхронно запрашивает у родительского элемента, какое действие следует предпринять, отправив родительское \_ уведомление ТВН асинкдрав с структурой [**нмтвасинкдрав**](/windows/win32/api/commctrl/ns-commctrl-nmtvasyncdraw) . Элемент **HR** этой структуры описывает причину сбоя рисования элемента управления. Результат «ч», полученный в результате **HR** \_ , означает, что изображение отсутствует (изображение необходимо извлечь). Успешно указывает, что изображение имеется, но не соответствует требуемому качеству изображения.

Родитель задает элемент **двретфлагс** структуры для информирования элемента управления о том, как продолжать работу. Например, родитель может вернуть другое изображение в элементе **иретимажеиндекс** для рисования элемента управления. В этом случае родительский элемент устанавливает для элемента **двретфлагс** значение \_ DRAWIMAGE адрф. Если элемент управления обнаруживает возвращенное изображение, он не был извлечен, но \_ элемент управления может отправить другое уведомление ТВН асинкдрав.

Если изображение недоступно, идея асинхронного процесса заключается в том, чтобы разрешить родительскому приложению выполнять извлечение в фоновом режиме, чтобы извлечение не блокировало поток пользовательского интерфейса, то есть поток, на котором находится элемент управления. Родитель может вернуть \_ элемент управления адрф дравносинг, а затем запустить фоновый поток для извлечения значка. После извлечения родительский элемент может установить значок в элементе управления TreeView с помощью макроса [**TreeView \_ сетитем**](/windows/desktop/api/Commctrl/nf-commctrl-treeview_setitem). Это приводит к тому, что представление дерева делает элемент недействительным и, в конечном итоге, перерисовывает его извлеченным изображением из списка изображений.

В следующем примере кода, который будет использоваться как часть более крупной программы, показано, как родительский элемент может обрабатывать два возможных кода возврата в этом уведомлении с помощью элемента управления и решать, какие действия должен предпринять элемент управления. Параметр **двретфлагс** не отображается.


```
case TVN_ASYNCDRAW:

   NMTVASYNCDRAW *pnm =  (NMTVASYNCDRAW *)lParam
   short dwDrawSuccessFlags = ShortFromResult(pnm->hr);

   if (dwDrawSuccessFlags & ILDRF_IMAGELOWQUALITY)
   {
        // Need to re-extract the icon
   }

   if (dwDrawSuccessFlags & ILDRF_OVERLAYLOWQUALITY)
   {
        // Need to re-extract the overlay
   }
```



## <a name="requirements"></a>Requirements (Требования)



| Требование | Значение |
|-------------------------------------|---------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows \[Только классические приложения Vista\]<br/>                                        |
| Минимальная версия сервера<br/> | Windows Только для \[ настольных приложений сервера 2008\]<br/>                                  |
| Заголовок<br/>                   | <dl> <dt>Коммктрл. h</dt> </dl> |



 

 





