---
title: Сведения об элементах управления "заголовок"
description: Элемент управления "заголовок" — это окно, которое обычно располагается над столбцами текста или чисел. Он содержит заголовок для каждого столбца, который можно разделить на части.
ms.assetid: b464fb9a-e342-4209-ba6f-15b5388f3914
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a6d9beaa9dc3bd8eb94d749ec271902a480b853e
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "103793951"
---
# <a name="about-header-controls"></a>Сведения об элементах управления "заголовок"

Элемент управления "заголовок" — это окно, которое обычно располагается над столбцами текста или чисел. Он содержит заголовок для каждого столбца, который можно разделить на части. Пользователь может перетаскивать разделители, разделяющие части, для установки ширины каждого столбца. На следующем рисунке показан элемент управления "заголовок" со столбцами с метками, которые предоставляют подробные сведения о файлах в каталоге.

![снимок экрана — диалоговое окно с элементом управления "заголовок с тремя столбцами"](images/header.png)

Элемент управления "заголовок" можно создать с помощью функции [**CreateWindowEx**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) , указав класс [**окна \_ заголовка WC**](common-control-window-classes.md) и соответствующие [стили элемента управления заголовка](header-control-styles.md). Этот класс окна регистрируется при загрузке библиотеки DLL общих элементов управления. Чтобы убедиться, что библиотека DLL загружена, используйте функцию [**InitCommonControlsEx**](/windows/desktop/api/Commctrl/nf-commctrl-initcommoncontrolsex) . После создания элемента управления "заголовок" его можно разделить на части, задать текст в каждой части и управлять внешним видом окна с помощью сообщений в окне заголовка.

Элемент управления "заголовок" может быть создан как дочернее окно другого элемента управления, например списка. Однако родительский элемент управления не знает элемент управления "заголовок" и не допускает пространство, занимаемое заголовком, в результате чего элементы списка будут отображаться позади заголовка. Если вы хотите использовать элемент управления "заголовок" в списке или другом элементе управления, родительский элемент управления должен быть нарисован владельцем, чтобы все элементы отображались в правильном положении.

Элементы управления "представление списка" уже имеют элементы управления "заголовок". Вместо создания элемента управления "заголовок" для элемента управления "представление списка" для получения существующего элемента управления используется [**LVMный \_**](lvm-getheader.md) верхний колонтитул или [**ListView \_**](/windows/desktop/api/Commctrl/nf-commctrl-listview_getheader) .

-   [Размер и расположение элемента управления заголовка](#header-control-size-and-position)
-   [Элементы](#items)
-   [Элементы управления "заголовок, рисуемые владельцем"](#owner-drawn-header-controls)
-   [Фильтры элемента управления заголовка](#header-control-filters)
-   [Обработка сообщений элемента управления заголовков по умолчанию](#default-header-control-message-processing)

## <a name="header-control-size-and-position"></a>Размер и расположение элемента управления заголовка

Как правило, необходимо задать размер и расположение элемента управления "заголовок" в соответствии с границами определенного прямоугольника, например клиентской областью окна. С помощью сообщения [**\_ макета HDM**](hdm-layout.md) можно получить соответствующие значения размера и расположения из элемента управления "заголовок".

При отправке [**\_ макета HDM**](hdm-layout.md)указывается адрес структуры [**хдлайаут**](/windows/win32/api/commctrl/ns-commctrl-hdlayout) , которая содержит координаты прямоугольника, занимаемого элементом управления "заголовок", и предоставляет указатель на структуру [**WINDOWPOS**](/windows/win32/api/winuser/ns-winuser-windowpos) . Элемент управления заполняет структуру **WINDOWPOS** значениями размера и положения, подходящими для позиционирования элемента управления вдоль верхней границы заданного прямоугольника. Значение Height представляет собой сумму высоты горизонтальных границ элемента управления и среднюю высоту символов в шрифте, выделенном в контексте устройства элемента управления.

Если вы хотите использовать [**\_ Макет HDM**](hdm-layout.md) для установки начального размера и расположения элемента управления "заголовок", установите исходное состояние видимости элемента управления, чтобы оно было скрыто. После отправки **\_ макета HDM** для получения значений размера и расположения можно использовать функцию [**SetWindowPos**](/windows/desktop/api/winuser/nf-winuser-setwindowpos) для установки нового размера, расположения и состояния видимости.

## <a name="items"></a>Элементы

Элемент управления "заголовок" обычно имеет несколько элементов заголовка, определяющих столбцы элемента управления. Добавьте элемент в элемент управления "заголовок", отправив [**сообщение \_ INSERTITEM HDM**](hdm-insertitem.md) в элемент управления. Сообщение содержит адрес структуры [**хдитем**](/windows/win32/api/commctrl/ns-commctrl-hditema) . Эта структура определяет свойства элемента заголовка, которые могут включать строку, Растровое изображение, исходный размер и определенное приложением значение **lParam** .

Элемент **FMT** структуры [**хдитем**](/windows/win32/api/commctrl/ns-commctrl-hditema) элемента может включать флаг **ХДФ \_ String** или **ХДФ \_ Bitmap** , чтобы указать, отображает ли элемент управления строку или точечный рисунок элемента. Если требуется отобразить как строку, так и растровое изображение, создайте рисуемый владельцем элемент, установив для элемента **FMT** флаг **ХДФ \_ овнердрав** . Структура **хдитем** также задает флаги форматирования, которые указывают элементу управления, следует ли выровнять по центру, по левому краю или по правому краю строку или точечный рисунок в прямоугольнике элемента.

[**Разъем HDM \_ INSERTITEM**](hdm-insertitem.md) возвращает индекс только что добавленного элемента. Индекс в других сообщениях можно использовать для задания свойств или получения сведений об элементе. Вы можете удалить элемент с помощью сообщения [**HDM \_ DELETEITEM**](hdm-deleteitem.md) , указав индекс удаляемого элемента.

Можно использовать сообщение [**\_ сетитем HDM**](hdm-setitem.md) , чтобы задать свойства существующего элемента заголовка и сообщение о [**\_ доэлементе HDM**](hdm-getitem.md) для получения текущих свойств элемента. Чтобы получить количество элементов в элементе управления "заголовок", используйте сообщение [**HDM \_ GETITEMCOUNT**](hdm-getitemcount.md) .

## <a name="owner-drawn-header-controls"></a>Owner-Drawn элементы управления "заголовок"

Отдельные элементы элемента управления "заголовок" можно определить как элементы, рисуемые владельцем. Использование этой методики обеспечивает больший контроль, чем в случае, если бы вы имели в виду элемент заголовка.

Можно использовать сообщение [**\_ INSERTITEM HDM**](hdm-insertitem.md) , чтобы вставить новый рисуемый владельцем элемент в элемент управления заголовка или сообщение [**\_ сетитем HDM**](hdm-setitem.md) , чтобы изменить существующий элемент на рисуемый владельцем элемент. Оба сообщения включают адрес структуры [**хдитем**](/windows/win32/api/commctrl/ns-commctrl-hditema) , для которой элемент **FMT** должен иметь значение **\_ овнердрав ХДФ** .

Когда элемент управления "заголовок" должен нарисовать рисуемый владельцем элемент, он отправляет сообщение [**WM \_ DRAWITEM**](wm-drawitem.md) в родительское окно. Параметр *wParam* сообщения представляет собой идентификатор дочернего окна элемента управления заголовка, а параметр *lParam* — адрес структуры [**дравитемструкт**](/windows/win32/api/winuser/ns-winuser-drawitemstruct) . Родительское окно использует сведения в структуре для рисования элемента. Для рисуемого владельцем элемента в элементе управления "заголовок" Структура **дравитемструкт** содержит следующие сведения.



| Член         | Описание                                                                                                                                            |
|----------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|
| **ктлтипе**    | [**ODT \_**](/windows/win32/api/winuser/ns-winuser-drawitemstruct) Тип элемента управления, рисуемый владельцем заголовка.                                                                                        |
| **ктлид**      | Идентификатор дочернего окна элемента управления "заголовок".                                                                                                         |
| **itemID**     | Индекс рисуемого элемента.                                                                                                                         |
| **итемактион** | [**Ода \_ ДРАВЕНТИРЕ**](/windows/win32/api/winuser/ns-winuser-drawitemstruct) , флаг действия рисования.                                                                                         |
| **ItemState**  | [**ODS \_ ВЫБРАННЫЙ**](/windows/win32/api/winuser/ns-winuser-drawitemstruct) флаг действия рисования, если курсор находится на элементе и кнопка мыши не работает. В противном случае этот элемент равен нулю. |
| **хвндитем**   | Обработчик для элемента управления "заголовок".                                                                                                                          |
| **hDC**        | Обработайте с контекстом устройства элемента управления "заголовок".                                                                                                    |
| **rcItem**     | Координаты рисуемого элемента заголовка. Координаты задаются относительно левого верхнего угла элемента управления "заголовок".                               |
| **итемдата**   | Определяемое приложением 32-разрядное значение, связанное с элементом.                                                                                             |



 

## <a name="header-control-filters"></a>Фильтры элемента управления заголовка

Указав стиль окна [**HDS \_ филтербар**](header-control-styles.md) для элемента управления "заголовок", можно включить размещение полей редактирования фильтра под заголовками столбцов. Рядом с полем ввода появляется кнопка фильтра. Можно реализовать фильтрацию, реагируя на коды уведомлений [ХДН \_ бегинфилтередит](hdn-beginfilteredit.md), [ХДН \_ Ендфилтередит](hdn-endfilteredit.md), [ХДН \_ филтербтнкликк](hdn-filterbtnclick.md)или [ХДН \_ ](hdn-filterchange.md) филтерчанже.

По умолчанию поле ввода содержит запрос на ввод текста пользователем. Окно редактирования можно восстановить в это состояние по умолчанию, используя [**заголовок \_ Клеарфилтер**](/windows/desktop/api/Commctrl/nf-commctrl-header_clearfilter) или [**заголовок \_ клеараллфилтерс**](/windows/desktop/api/Commctrl/nf-commctrl-header_clearallfilters).

В следующем примере кода показано, как извлечь элемент управления "заголовок" из элемента управления "представление списка" и добавить строку фильтра.


```
// hList is the HWND of the list-view control.
HWND hHeader = ListView_GetHeader(hList);
LONG_PTR styles = GetWindowLongPtr(hHeader, GWL_STYLE);
SetWindowLongPtr(g_hHeader, GWL_STYLE, styles | HDS_FILTERBAR);
```



## <a name="default-header-control-message-processing"></a>Обработка сообщений элемента управления заголовков по умолчанию

В этом разделе описываются сообщения окна, обрабатываемые процедурой окна для класса окна [**\_ заголовка WC**](common-control-window-classes.md) .



| Сообщение                                            | Обработка выполнена                                                                                                                                                                                                                                                                                          |
|----------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**\_Создание WM**](/windows/desktop/winmsg/wm-create)                 | Инициализирует элемент управления "заголовок".                                                                                                                                                                                                                                                                               |
| [**WM \_ destroy**](/windows/desktop/winmsg/wm-destroy)               | Отменяет инициализацию элемента управления "заголовок".                                                                                                                                                                                                                                                                             |
| [**WM \_ ерасебкгнд**](/windows/desktop/winmsg/wm-erasebkgnd)         | Заполняет фон элемента управления "заголовок", используя текущий цвет фона элемента управления.                                                                                                                                                                                                                      |
| [**WM \_ жетдлгкоде**](/windows/desktop/dlgbox/wm-getdlgcode)         | Возвращает сочетание значений [**длгк \_ Ванттаб**](/windows/desktop/dlgbox/wm-getdlgcode) и [**длгк \_ вантарровс**](/windows/desktop/dlgbox/wm-getdlgcode) .                                                                                                                     |
| [**WM, \_ Шрифт**](/windows/desktop/winmsg/wm-getfont)               | Возвращает маркер текущего шрифта, который используется элементом управления "заголовок" для рисования текста.                                                                                                                                                                                                                 |
| [**WM \_ лбуттондблклк**](/windows/desktop/inputdev/wm-lbuttondblclk) | Захватывает ввод мыши. Если курсор мыши находится на разделителе, элемент управления отправляет код уведомления [ХДН \_ бегинтракк](hdn-begintrack.md) и начинает перетаскивать разделитель. Если курсор находится на элементе, элемент отображается в нажатом состоянии.                                                            |
| [**WM \_ лбуттондовн**](/windows/desktop/inputdev/wm-lbuttondown)     | То же, что и сообщение [**WM \_ лбуттондблклк**](/windows/desktop/inputdev/wm-lbuttondblclk) .                                                                                                                                                                                                                                       |
| [**WM \_ лбуттонуп**](/windows/desktop/inputdev/wm-lbuttonup)         | Освобождает захват мыши. Если элемент управления отслеживает перемещение мыши, он отправляет код уведомления [ХДН \_ ендтракк](hdn-endtrack.md) и перерисовывает элемент управления "заголовок". В противном случае элемент управления отправляет код уведомления [ХДН \_ итемкликк](hdn-itemclick.md) и перерисовывает элемент заголовка, который был выбран. |
| [**WM \_ MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove)         | При перетаскивании разделителя элемент управления отправляет код уведомления [ХДН \_ Track](hdn-track.md) и отображает элемент в новой позиции. Если левая кнопка мыши не нажата и курсор находится на элементе, элемент отображается в нажатом состоянии.                                                      |
| [**WM \_ нккреате**](/windows/desktop/winmsg/wm-nccreate)             | Выделяет и инициализирует внутреннюю структуру данных.                                                                                                                                                                                                                                                         |
| [**WM \_ нкдестрой**](/windows/desktop/winmsg/wm-ncdestroy)           | Освобождает ресурсы, выделенные элементом управления "заголовок" после того, как элемент управления "заголовок" не инициализирован.                                                                                                                                                                                                                |
| [**WM \_ Paint**](/windows/desktop/gdi/wm-paint)                      | Закрашивает недопустимый регион элемента управления "заголовок". Если параметр *wParam* не равен null, то элемент управления предполагает, что значение является HDC и рисует его с помощью контекста устройства.                                                                                                                                    |
| [**WM \_ сеткурсор**](/windows/desktop/menurc/wm-setcursor)           | Задает форму курсора в зависимости от того, находится курсор на разделителе или в элементе заголовка.                                                                                                                                                                                                                   |
| [**WM \_ сетфонт**](/windows/desktop/winmsg/wm-setfont)               | Выбирает новый маркер шрифта в контексте устройства для элемента управления "заголовок".                                                                                                                                                                                                                                     |



 

 

 