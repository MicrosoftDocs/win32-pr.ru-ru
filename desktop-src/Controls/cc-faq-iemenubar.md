---
title: Создание строки меню Интернет Explorer-Style
description: На первый взгляд, строка меню в Microsoft Internet Explorer 5 и более поздних версий похожа на стандартное меню. Однако при начале использования он выглядит совершенно иначе.
ms.assetid: e0fe25f2-3d49-4c5a-a3f9-2f468f2cfef2
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b262bc55407d263c97d4bd7e3938a9794d3a58f5
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "103891124"
---
# <a name="how-to-create-an-internet-explorer-style-menu-bar"></a><span data-ttu-id="8c8bb-104">Создание строки меню Интернет Explorer-Style</span><span class="sxs-lookup"><span data-stu-id="8c8bb-104">How to Create an Internet Explorer-Style Menu Bar</span></span>

<span data-ttu-id="8c8bb-105">На первый взгляд, строка меню в Microsoft Internet Explorer 5 и более поздних версий похожа на стандартное меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-105">At first glance, the menu bar in Microsoft Internet Explorer 5 and later looks similar to a standard menu.</span></span> <span data-ttu-id="8c8bb-106">Однако при начале использования он выглядит совершенно иначе.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-106">However, it looks quite different when you begin using it.</span></span>

<span data-ttu-id="8c8bb-107">На следующем снимке экрана показана панель меню Windows Internet Explorer с выбранным меню Сервис.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-107">The following screen shot shows the Windows Internet Explorer menu bar with the Tools menu selected.</span></span>

![снимок экрана, на котором показана строка меню Windows Internet Explorer с выбранным меню "Сервис"](images/howto8.jpg)

<span data-ttu-id="8c8bb-109">Панель меню на самом деле представляет собой элемент управления ToolBar, похожий на стандартное меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-109">The menu bar is actually a toolbar control that looks like a standard menu.</span></span> <span data-ttu-id="8c8bb-110">Вместо пунктов меню верхнего уровня в строке меню имеется ряд кнопок только с текстом, которые отображают раскрывающееся меню при щелчке.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-110">Instead of top-level menu items, a menu bar has a series of text-only buttons that display a drop-down menu when clicked.</span></span> <span data-ttu-id="8c8bb-111">Однако в качестве специального типа панели инструментов в строке меню есть некоторые возможности стандартных меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-111">However, as a specialized type of toolbar, a menu bar has some capabilities that standard menus lack:</span></span>

-   <span data-ttu-id="8c8bb-112">Его можно настроить с помощью стандартных методов панели инструментов, позволяя пользователю перемещать, удалять или добавлять элементы.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-112">It can be customized using standard toolbar techniques, allowing the user to move, delete, or add items.</span></span>
-   <span data-ttu-id="8c8bb-113">Он может иметь возможность оперативного отслеживания, чтобы пользователи могли понять, когда они находятся на элементе верхнего уровня, и не щелкать их первыми.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-113">It can have hot-tracking, so that users will know when they are over a top-level item without having to click it first.</span></span>

<span data-ttu-id="8c8bb-114">Строку меню можно включить в элемент управления главной панели, предоставив следующие возможности:</span><span class="sxs-lookup"><span data-stu-id="8c8bb-114">A menu bar can be incorporated into a rebar control, giving it the following features:</span></span>

-   <span data-ttu-id="8c8bb-115">Он может иметь захват, позволяющий пользователю перемещать или изменять размер полосы.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-115">It can have a gripper, which allows the user to move or resize the band.</span></span>
-   <span data-ttu-id="8c8bb-116">Она может совместно использовать полосу в элементе управления главной панели с другими полосами, такими как стандартная панель инструментов на предыдущем рисунке.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-116">It can share a strip in the rebar control with other bands, such as the standard toolbar in the preceding illustration.</span></span>
-   <span data-ttu-id="8c8bb-117">Он может отображать Шеврон, когда он охватывает смежную полосу, предоставляя пользователю доступ к скрытым элементам.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-117">It can display a chevron when it is covered by an adjacent band, giving the user access to the hidden items.</span></span>
-   <span data-ttu-id="8c8bb-118">Он может иметь заданное приложением фоновое растровое изображение.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-118">It can have an application-defined background bitmap.</span></span>

<span data-ttu-id="8c8bb-119">В этом разделе описывается, как реализовать строку меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-119">This topic discusses how to implement a menu bar.</span></span> <span data-ttu-id="8c8bb-120">Так как строка меню является специализированной реализацией элемента управления ToolBar, фокус будет отображаться на разделах, относящихся к строкам меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-120">Since a menu bar is a specialized implementation of a toolbar control, the focus will be on topics that are specific to menu bars.</span></span> <span data-ttu-id="8c8bb-121">Обсуждение того, как внедрить панель инструментов в элемент управления главной панели, см. [в разделе Создание панели инструментов Explorer-Style Internet](cc-faq-ietoolbar.md) и [Управление главной](rebar-controls.md)панелью.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-121">For a discussion of how to incorporate a toolbar into a rebar control, see [How to Create an Internet Explorer-Style Toolbar](cc-faq-ietoolbar.md) and [About Rebar Controls](rebar-controls.md).</span></span>

-   [<span data-ttu-id="8c8bb-122">Создание панели инструментов в строке меню</span><span class="sxs-lookup"><span data-stu-id="8c8bb-122">Making a Toolbar into a Menu Bar</span></span>](#making-a-toolbar-into-a-menu-bar)
-   [<span data-ttu-id="8c8bb-123">Обработка навигации с помощью Hot-Tracking меню отключена</span><span class="sxs-lookup"><span data-stu-id="8c8bb-123">Handling Navigation with Menu Hot-Tracking Disabled</span></span>](#handling-navigation-with-menu-hot-tracking-disabled)
    -   [<span data-ttu-id="8c8bb-124">Навигация по мыши</span><span class="sxs-lookup"><span data-stu-id="8c8bb-124">Mouse Navigation</span></span>](#mouse-navigation)
    -   [<span data-ttu-id="8c8bb-125">Навигация с помощью клавиатуры</span><span class="sxs-lookup"><span data-stu-id="8c8bb-125">Keyboard Navigation</span></span>](#keyboard-navigation)
    -   [<span data-ttu-id="8c8bb-126">Смешанная Навигация</span><span class="sxs-lookup"><span data-stu-id="8c8bb-126">Mixed Navigation</span></span>](#mixed-navigation)
-   [<span data-ttu-id="8c8bb-127">Обработка навигации с включенным Hot-Tracking меню</span><span class="sxs-lookup"><span data-stu-id="8c8bb-127">Handling Navigation with Menu Hot-Tracking Enabled</span></span>](#handling-navigation-with-menu-hot-tracking-enabled)
    -   [<span data-ttu-id="8c8bb-128">Обработка сообщений для горячего отслеживания меню</span><span class="sxs-lookup"><span data-stu-id="8c8bb-128">Message Processing for Menu Hot-Tracking</span></span>](#message-processing-for-menu-hot-tracking)
    -   [<span data-ttu-id="8c8bb-129">Навигация по мыши</span><span class="sxs-lookup"><span data-stu-id="8c8bb-129">Mouse Navigation</span></span>](#mouse-navigation)
    -   [<span data-ttu-id="8c8bb-130">Навигация с помощью клавиатуры</span><span class="sxs-lookup"><span data-stu-id="8c8bb-130">Keyboard Navigation</span></span>](#keyboard-navigation)

## <a name="making-a-toolbar-into-a-menu-bar"></a><span data-ttu-id="8c8bb-131">Создание панели инструментов в строке меню</span><span class="sxs-lookup"><span data-stu-id="8c8bb-131">Making a Toolbar into a Menu Bar</span></span>

<span data-ttu-id="8c8bb-132">Чтобы сделать панель инструментов в строке меню, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-132">To make a toolbar into a menu bar:</span></span>

-   <span data-ttu-id="8c8bb-133">Создайте плоскую панель инструментов, включив [**тбстиле \_ Flat**](toolbar-control-and-button-styles.md) с другими флагами стиля окна.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-133">Create a flat toolbar by including [**TBSTYLE\_FLAT**](toolbar-control-and-button-styles.md) with the other window style flags.</span></span> <span data-ttu-id="8c8bb-134">**\_ Неструктурированный стиль тбстиле** также обеспечивает горячее отслеживание.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-134">The **TBSTYLE\_FLAT** style also enables hot-tracking.</span></span> <span data-ttu-id="8c8bb-135">В этом стиле строка меню похожа на стандартное меню, пока пользователь не активирует кнопку.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-135">With this style, the menu bar looks much like a standard menu until the user activates a button.</span></span> <span data-ttu-id="8c8bb-136">После этого кнопка будет выделена на панели инструментов и Депресс при ее нажатии, как и стандартная кнопка.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-136">Then, the button appears to stand out from the toolbar and depress when it is clicked, just like a standard button.</span></span> <span data-ttu-id="8c8bb-137">Так как включено отслеживание "горячего" отслеживания, все, что необходимо для активации кнопки, — это курсор, наведя на него указатель мыши.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-137">Because hot-tracking is enabled, all that is needed to activate a button is for the cursor to hover over it.</span></span> <span data-ttu-id="8c8bb-138">Если курсор переместится на другую кнопку, он будет активирован, а старая кнопка деактивируется.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-138">If the cursor moves to another button, it will be activated and the old button deactivated.</span></span>
-   <span data-ttu-id="8c8bb-139">Создайте кнопки в стиле списка, включив [**\_ список тбстиле**](toolbar-control-and-button-styles.md) с другими флагами стиля окна.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-139">Create list-style buttons by including [**TBSTYLE\_LIST**](toolbar-control-and-button-styles.md) with the other window style flags.</span></span> <span data-ttu-id="8c8bb-140">Этот стиль создает более тонкую кнопку, которая больше похожа на стандартный элемент меню верхнего уровня.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-140">This style creates a thinner button that looks more like a standard top-level menu item.</span></span>
-   <span data-ttu-id="8c8bb-141">Сделайте кнопки только текстом, установив для элемента **ибитмап** структуры [**тббуттон**](/windows/desktop/api/Commctrl/ns-commctrl-tbbutton) кнопки значение \_ Имаженоне, а для элемента **истринг** — текст кнопки.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-141">Make the buttons text-only by setting the **iBitmap** member of the button's [**TBBUTTON**](/windows/desktop/api/Commctrl/ns-commctrl-tbbutton) structure to I\_IMAGENONE and the **iString** member to the button text.</span></span>
-   <span data-ttu-id="8c8bb-142">Присвойте каждой кнопке стиль [**\_ раскрывающегося списка бтнс**](toolbar-control-and-button-styles.md) .</span><span class="sxs-lookup"><span data-stu-id="8c8bb-142">Give each button the [**BTNS\_DROPDOWN**](toolbar-control-and-button-styles.md) style.</span></span> <span data-ttu-id="8c8bb-143">При нажатии кнопки элемент управления ToolBar отправляет приложению уведомление [ \_ раскрывающегося списка ТБН](tbn-dropdown.md) , предлагающее отобразить меню кнопки.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-143">When the button is clicked, the toolbar control sends your application a [TBN\_DROPDOWN](tbn-dropdown.md) notification to prompt it to display the button's menu.</span></span>
-   <span data-ttu-id="8c8bb-144">Включить строку меню в полосу главной панели.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-144">Incorporate the menu bar into a rebar band.</span></span> <span data-ttu-id="8c8bb-145">Включите как захваты, так и шевроны, как описано в разделе [Создание веб Explorer-Style панели инструментов](cc-faq-ietoolbar.md).</span><span class="sxs-lookup"><span data-stu-id="8c8bb-145">Enable both grippers and chevrons, as discussed in [How to Create an Internet Explorer-Style Toolbar](cc-faq-ietoolbar.md).</span></span>
-   <span data-ttu-id="8c8bb-146">Реализуйте [обработчик \_ раскрывающегося списка ТБН](tbn-dropdown.md) , чтобы отобразить *раскрывающееся меню* кнопки при ее нажатии.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-146">Implement a [TBN\_DROPDOWN](tbn-dropdown.md) handler to display the button's *drop-down menu* when it is clicked.</span></span> <span data-ttu-id="8c8bb-147">Раскрывающееся меню — это тип всплывающего меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-147">The drop-down menu is a type of pop-up menu.</span></span> <span data-ttu-id="8c8bb-148">Она создается с помощью функции [**метод TrackPopupMenu**](/windows/desktop/api/winuser/nf-winuser-trackpopupmenu) , а ее левый верхний угол выстраивается в левом нижнем углу кнопки.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-148">It is created by using the [**TrackPopupMenu**](/windows/desktop/api/winuser/nf-winuser-trackpopupmenu) function, with its upper-left corner aligned with the lower-left corner of the button.</span></span>
-   <span data-ttu-id="8c8bb-149">Реализуйте навигацию с помощью клавиатуры, чтобы строка меню стала полностью доступной без мыши.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-149">Implement keyboard navigation, so that the menu bar is fully accessible without a mouse.</span></span>
-   <span data-ttu-id="8c8bb-150">Реализуйте горячее отслеживание в меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-150">Implement menu hot-tracking.</span></span> <span data-ttu-id="8c8bb-151">При использовании стандартных меню после отображения меню пункта меню верхнего уровня при перемещении курсора на другой элемент верхнего уровня автоматически отображается его меню и сворачивается меню предыдущего элемента.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-151">With standard menus, once a top level menu item's menu has been displayed, moving the cursor over another top-level item automatically displays its menu and collapses the menu of the previous item.</span></span> <span data-ttu-id="8c8bb-152">Элемент управления Toolbar (панель инструментов) будет зафиксировать курсор и изменить изображение кнопки, но автоматически отобразит новое меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-152">The toolbar control will hot-track the cursor and change the button image, but it does automatically display the new menu.</span></span> <span data-ttu-id="8c8bb-153">Приложение должно сделать это явным образом.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-153">Your application must do so explicitly.</span></span>

<span data-ttu-id="8c8bb-154">Большинство этих элементов просты в реализации и обсуждаются в других местах.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-154">Most of these items are straightforward to implement and are discussed elsewhere.</span></span> <span data-ttu-id="8c8bb-155">Общие сведения об использовании панелей инструментов и элементов управления главной панели см. [в статье Создание веб-Explorer-Style панели инструментов](cc-faq-ietoolbar.md), о панелях инструментов и [элементах управления главной](rebar-controls.md) [панелью](toolbar-controls-overview.md).</span><span class="sxs-lookup"><span data-stu-id="8c8bb-155">See [How to Create an Internet Explorer-Style Toolbar](cc-faq-ietoolbar.md), [About Toolbar Controls](toolbar-controls-overview.md), or [About Rebar Controls](rebar-controls.md) for a general discussion of how to use toolbars and rebar controls.</span></span> <span data-ttu-id="8c8bb-156">Сведения о том, как управлять всплывающими меню, см. в разделе [меню](/windows/desktop/menurc/menus) .</span><span class="sxs-lookup"><span data-stu-id="8c8bb-156">See [Menus](/windows/desktop/menurc/menus) for a discussion of how to handle pop-up menus.</span></span> <span data-ttu-id="8c8bb-157">В оставшейся части этого раздела обсуждаются последние два элемента: Навигация по клавишам и «горячее» отслеживание.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-157">The final two items, keyboard navigation and menu hot-tracking, are discussed in the remainder of this topic.</span></span>

## <a name="handling-navigation-with-menu-hot-tracking-disabled"></a><span data-ttu-id="8c8bb-158">Обработка навигации с помощью Hot-Tracking меню отключена</span><span class="sxs-lookup"><span data-stu-id="8c8bb-158">Handling Navigation with Menu Hot-Tracking Disabled</span></span>

<span data-ttu-id="8c8bb-159">Пользователи могут перемещаться по строке меню с помощью мыши, клавиатуры или сочетания обеих клавиш.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-159">Users can choose to navigate the menu bar with the mouse, the keyboard, or a mixture of both.</span></span> <span data-ttu-id="8c8bb-160">Чтобы реализовать навигацию в строке меню, приложение должно выполнять обработку уведомлений на панели инструментов и отслеживать работу мыши и клавиатуры.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-160">To implement menu bar navigation, your application must handle toolbar notifications and monitor the mouse and keyboard.</span></span> <span data-ttu-id="8c8bb-161">Эту задачу можно разделить на две отдельные части: с помощью и без "горячего" отслеживания меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-161">This task can be broken into two distinct parts: with and without menu hot-tracking.</span></span> <span data-ttu-id="8c8bb-162">В этом разделе описывается, как управлять навигацией, когда меню не отображается и не включена поддержка горячего отслеживания меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-162">This section discusses how to handle navigation when no menus are displayed and menu hot-tracking is not enabled.</span></span>

### <a name="mouse-navigation"></a><span data-ttu-id="8c8bb-163">Навигация по мыши</span><span class="sxs-lookup"><span data-stu-id="8c8bb-163">Mouse Navigation</span></span>

<span data-ttu-id="8c8bb-164">Если меню "горячее" Отслеживание отключено, можно рассматривать строку меню как обычную панель инструментов.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-164">If menu hot-tracking is disabled, you can treat a menu bar as a normal toolbar.</span></span> <span data-ttu-id="8c8bb-165">Если пользователь выполняет переход с помощью мыши, все ваше приложение должно работать с [ \_ раскрывающимся](tbn-dropdown.md) уведомлением ТБН.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-165">If the user is navigating with a mouse, all your application needs to do is handle the [TBN\_DROPDOWN](tbn-dropdown.md) notification.</span></span> <span data-ttu-id="8c8bb-166">При получении этого уведомления откройте соответствующее раскрывающееся меню и включите горячее отслеживание меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-166">When this notification is received, display the appropriate drop-down menu, and enable menu hot-tracking.</span></span> <span data-ttu-id="8c8bb-167">После этого вы войдете в меню "горячее отслеживание" региме, которое обсуждалось в разделе [Обработка навигации с включенным Hot-Tracking меню](#handling-navigation-with-menu-hot-tracking-enabled).</span><span class="sxs-lookup"><span data-stu-id="8c8bb-167">From then on, you are in the menu hot-tracking regime discussed in [Handling Navigation with Menu Hot-Tracking Enabled](#handling-navigation-with-menu-hot-tracking-enabled).</span></span>

<span data-ttu-id="8c8bb-168">Как обсуждалось при [смешанной навигации](#mixed-navigation), необходимо также обрабатывать уведомление [ТБН \_ хотитемчанже](tbn-hotitemchange.md) , чтобы контролировать активную кнопку.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-168">As discussed in [Mixed Navigation](#mixed-navigation), you also need to handle the [TBN\_HOTITEMCHANGE](tbn-hotitemchange.md) notification to keep track of the active button.</span></span> <span data-ttu-id="8c8bb-169">Это уведомление не имеет значения, если пользователь работает только с мышью, но он необходим, если навигация с помощью мыши и клавиатуры является смешанной.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-169">This notification is irrelevant if the user is only navigating with the mouse, but it is necessary when mouse and keyboard navigation are mixed.</span></span>

### <a name="keyboard-navigation"></a><span data-ttu-id="8c8bb-170">Навигация с помощью клавиатуры</span><span class="sxs-lookup"><span data-stu-id="8c8bb-170">Keyboard Navigation</span></span>

<span data-ttu-id="8c8bb-171">Как отмечалось в предыдущем разделе, пользователь может выполнить ряд операций навигации с клавиатурой, если отключено горячее отслеживание меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-171">As noted in the previous section, the user can do a number of navigation operations with the keyboard when menu hot-tracking is disabled.</span></span> <span data-ttu-id="8c8bb-172">Элементы управления ToolBar поддерживают навигацию с помощью клавиатуры только в том случае, если они имеют фокус.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-172">Toolbar controls support keyboard navigation only if they have focus.</span></span> <span data-ttu-id="8c8bb-173">Кроме того, они не обрабатывают все нажатия клавиш, необходимые для строк меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-173">They also do not handle all the key presses that are needed for menu bars.</span></span> <span data-ttu-id="8c8bb-174">Самым простым решением для работы с клавиатурой является обработка соответствующих событий нажатия клавиши явным образом.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-174">The simplest solution to handling keyboard navigation is to process the relevant key press events explicitly.</span></span>

<span data-ttu-id="8c8bb-175">Если отключено горячее отслеживание в меню, приложение должно решить эти события нажатия, как указано ниже.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-175">If menu hot-tracking is disabled, your application must handle these key press events in the following way:</span></span>

-   <span data-ttu-id="8c8bb-176">Клавиша F10.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-176">The F10 key.</span></span> <span data-ttu-id="8c8bb-177">Активируйте первую кнопку с [**\_ сесотитем ТБ**](tb-sethotitem.md).</span><span class="sxs-lookup"><span data-stu-id="8c8bb-177">Activate the first button with [**TB\_SETHOTITEM**](tb-sethotitem.md).</span></span>
-   <span data-ttu-id="8c8bb-178">Клавиши Стрелка влево и стрелка вправо.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-178">The LEFT ARROW and RIGHT ARROW keys.</span></span> <span data-ttu-id="8c8bb-179">Активируйте смежную кнопку с [**ТБ \_ сесотитем**](tb-sethotitem.md).</span><span class="sxs-lookup"><span data-stu-id="8c8bb-179">Activate the adjacent button with [**TB\_SETHOTITEM**](tb-sethotitem.md).</span></span> <span data-ttu-id="8c8bb-180">Если пользователь пытается перейти к концу строки меню, активируйте первую кнопку на противоположном конце.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-180">If the user attempts to navigate off either end of the menu bar, activate the first button at the opposite end.</span></span>
-   <span data-ttu-id="8c8bb-181">Клавиша ESCAPE.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-181">The ESCAPE key.</span></span> <span data-ttu-id="8c8bb-182">Деактивация активной кнопки с [**\_ сесотитем ТБ**](tb-sethotitem.md).</span><span class="sxs-lookup"><span data-stu-id="8c8bb-182">Deactivate the active button with [**TB\_SETHOTITEM**](tb-sethotitem.md).</span></span> <span data-ttu-id="8c8bb-183">Строка меню должна возвращаться в то состояние, в котором оно было до активации первой кнопки.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-183">The menu bar should be returned to the state it had prior to activating the first button.</span></span>
-   <span data-ttu-id="8c8bb-184">Сочетание клавиш ALT +*Клавиша* .</span><span class="sxs-lookup"><span data-stu-id="8c8bb-184">An ALT-*Key* accelerator key.</span></span> <span data-ttu-id="8c8bb-185">Используйте сообщение [**\_ мапакцелератор ТБ**](tb-mapaccelerator.md) , чтобы определить, к какой кнопке соответствует символ *ключа* .</span><span class="sxs-lookup"><span data-stu-id="8c8bb-185">Use the [**TB\_MAPACCELERATOR**](tb-mapaccelerator.md) message to determine which button the *Key* character corresponds to.</span></span> <span data-ttu-id="8c8bb-186">Отобразить раскрывающееся меню кнопки и включить горячее отслеживание меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-186">Display the button's drop-down menu and enable menu hot-tracking.</span></span>
-   <span data-ttu-id="8c8bb-187">Клавиша СТРЕЛКА ВНИЗ.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-187">The DOWN ARROW key.</span></span> <span data-ttu-id="8c8bb-188">Если кнопка активна, но меню не отображается, отобразите меню кнопки и включите функцию горячего отслеживания меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-188">If a button is active but no menu has been displayed, display the button's menu and enable menu hot-tracking.</span></span>
-   <span data-ttu-id="8c8bb-189">Клавиша ВВОД.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-189">The ENTER key.</span></span> <span data-ttu-id="8c8bb-190">Деактивация активной кнопки с [**\_ сесотитем ТБ**](tb-sethotitem.md).</span><span class="sxs-lookup"><span data-stu-id="8c8bb-190">Deactivate the active button with [**TB\_SETHOTITEM**](tb-sethotitem.md).</span></span> <span data-ttu-id="8c8bb-191">Строка меню должна возвращаться в то состояние, в котором оно было до активации первой кнопки.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-191">The menu bar should be returned to the state it had prior to activating the first button.</span></span>

### <a name="mixed-navigation"></a><span data-ttu-id="8c8bb-192">Смешанная Навигация</span><span class="sxs-lookup"><span data-stu-id="8c8bb-192">Mixed Navigation</span></span>

<span data-ttu-id="8c8bb-193">Обработчики навигации с клавиатурой, описанные в предыдущем разделе, в основном выполняют две задачи: отслеживание активной кнопки и отображение соответствующего меню при выборе кнопки.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-193">The keyboard navigation handlers outlined in the preceding section basically do two tasks: keep track of the active button and display the appropriate menu when a button is selected.</span></span> <span data-ttu-id="8c8bb-194">Эти обработчики достаточно, пока пользователь переходит только с клавиатуры.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-194">These handlers are sufficient as long as the user navigates only with the keyboard.</span></span> <span data-ttu-id="8c8bb-195">Однако пользователи часто сочетают навигацию с помощью клавиатуры и мыши.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-195">However, users often mix keyboard and mouse navigation.</span></span> <span data-ttu-id="8c8bb-196">Например, они могут активировать первую кнопку с помощью клавиши F10, использовать мышь для активации другой кнопки, а затем открыть ее меню с помощью клавиши со стрелкой вниз.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-196">For example, they might activate the first button with the F10 key, use the mouse to activate a different button, and then open its menu with the DOWN ARROW key.</span></span> <span data-ttu-id="8c8bb-197">Если вы отслеживаете только нажатия клавиш, чтобы следить за активным ключом, отобразится неправильное меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-197">If you are only monitoring key presses to keep track of the active key, you will display the wrong menu.</span></span> <span data-ttu-id="8c8bb-198">Также необходимо выполнить обработку уведомления [ТБН \_ хотитемчанже](tbn-hotitemchange.md) , чтобы точно контролировать активную кнопку.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-198">You must also handle the [TBN\_HOTITEMCHANGE](tbn-hotitemchange.md) notification to accurately keep track of the active button.</span></span>

## <a name="handling-navigation-with-menu-hot-tracking-enabled"></a><span data-ttu-id="8c8bb-199">Обработка навигации с включенным Hot-Tracking меню</span><span class="sxs-lookup"><span data-stu-id="8c8bb-199">Handling Navigation with Menu Hot-Tracking Enabled</span></span>

<span data-ttu-id="8c8bb-200">Если включено горячее отслеживание в меню, приложение должно изменить способ реагирования на навигацию пользователя.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-200">When menu hot-tracking is enabled, your application must change the way it responds to user navigation.</span></span> <span data-ttu-id="8c8bb-201">Для репликации поведения стандартных меню необходимо явно реализовать следующие функции.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-201">To replicate the behavior of standard menus, you must implement the following features explicitly.</span></span>

<span data-ttu-id="8c8bb-202">С навигацией с помощью мыши:</span><span class="sxs-lookup"><span data-stu-id="8c8bb-202">With mouse navigation:</span></span>

-   <span data-ttu-id="8c8bb-203">Если пользователь перемещает курсор на другую кнопку, это меню немедленно появляется, а предыдущее меню исчезает.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-203">If the user moves the cursor over another button, that menu immediately appears and the previous menu disappears.</span></span>
-   <span data-ttu-id="8c8bb-204">Горячая трассировка меню остается активной до тех пор, пока пользователь не выберет команду или не щелкнет точку, которая не является частью области меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-204">Menu hot-tracking stays active until the user selects a command or clicks a point that is not part of the menu region.</span></span> <span data-ttu-id="8c8bb-205">Любое действие отключает горячее отслеживание меню до нажатия другой кнопки.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-205">Either action deactivates menu hot-tracking until another button is clicked.</span></span>
-   <span data-ttu-id="8c8bb-206">Если курсор перемещается из меню, текущее раскрывающееся меню остается до тех пор, пока курсор не будет перемещен обратно или пользователь щелкнет точку за пределами, область, выделенная в меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-206">If the cursor moves off the menu, the current drop-down menu remains until the cursor moves back onto, or the user clicks a point outside, the area covered by the menu.</span></span> <span data-ttu-id="8c8bb-207">Если курсор возвращается к другой кнопке, чем отображаемая в данный момент, то старое меню сворачивается и отображается новое меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-207">If the cursor returns to a different button than the one currently being displayed, the old menu is collapsed and the new menu is displayed.</span></span>

<span data-ttu-id="8c8bb-208">С навигацией с помощью клавиатуры:</span><span class="sxs-lookup"><span data-stu-id="8c8bb-208">With keyboard navigation:</span></span>

-   <span data-ttu-id="8c8bb-209">Клавиша со стрелкой вправо перемещает фокус вправо.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-209">The RIGHT ARROW key moves the focus to the right.</span></span> <span data-ttu-id="8c8bb-210">Если у элемента есть подменю, отобразите подменю.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-210">If the item has a submenu, display the submenu.</span></span> <span data-ttu-id="8c8bb-211">Если элемент не имеет подменю, сверните меню и все подменю, активируйте кнопку Далее с [**ТБ в \_ сесотитем**](tb-sethotitem.md)и выведите меню для соседней кнопки.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-211">If the item does not have a submenu, collapse the menu and any submenus, activate the next button with [**TB\_SETHOTITEM**](tb-sethotitem.md), and display the menu for the adjacent button.</span></span> <span data-ttu-id="8c8bb-212">Если последняя кнопка активна при получении этого сообщения, отобразите меню для первой кнопки.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-212">If the last button is active when this message is received, display the menu for the first button.</span></span>
-   <span data-ttu-id="8c8bb-213">Клавиша со стрелкой влево перемещает фокус влево.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-213">The LEFT ARROW key moves the focus to the left.</span></span> <span data-ttu-id="8c8bb-214">Если элемент является подменю, сверните его и переместит фокус на его родительское меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-214">If the item is a submenu, collapse it and shift focus to its parent menu.</span></span> <span data-ttu-id="8c8bb-215">Если элемент не является подменю, сверните меню, активируйте кнопку Далее с [**ТБ \_ сесотитем**](tb-sethotitem.md)и выведите меню для этой кнопки.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-215">If the item is not a submenu, collapse the menu, activate the next button with [**TB\_SETHOTITEM**](tb-sethotitem.md), and display the menu for that button.</span></span>

<!-- -->

-   <span data-ttu-id="8c8bb-216">При нажатии клавиши ESCAPE отображается один шаг.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-216">The ESCAPE key backs the display up one step.</span></span>
    -   <span data-ttu-id="8c8bb-217">Если подменю отображается, оно сворачивается и фокус перемещается в родительское меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-217">If a submenu is displayed, it is collapsed and focus shifts to the parent menu.</span></span>
    -   <span data-ttu-id="8c8bb-218">Если меню кнопки отображается, оно сворачивается и отключается горячее отслеживание меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-218">If a button's menu is displayed, it is collapsed and menu hot-tracking is disabled.</span></span> <span data-ttu-id="8c8bb-219">Кнопка элемента остается активной.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-219">The item's button remains active.</span></span>
    -   <span data-ttu-id="8c8bb-220">Если меню не отображаются, но активна кнопка, кнопка становится неактивной, а «горячее» отслеживание отключено.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-220">If no menus are displayed but a button is active, the button is deactivated and menu hot-tracking is disabled.</span></span>
-   <span data-ttu-id="8c8bb-221">Клавиши Стрелка вверх и стрелка вниз используются только для навигации в определенном меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-221">The UP ARROW and DOWN ARROW keys are used only to navigate within a particular menu.</span></span>
-   <span data-ttu-id="8c8bb-222">Клавиша ВВОД запускает команду, связанную с пунктом меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-222">The ENTER key launches the command associated with a menu item.</span></span> <span data-ttu-id="8c8bb-223">Если у пункта меню есть подменю, клавиша ВВОД отображает его.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-223">If the menu item has a submenu, the ENTER key displays it.</span></span>

<span data-ttu-id="8c8bb-224">Как и в случае с отключенным режимом «горячее отслеживание», приложение должно иметь возможность обрабатывать мышь, клавиатуру и смешанную навигацию.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-224">As with the menu hot-tracking disabled case, your application must be able to handle mouse, keyboard, and mixed navigation.</span></span> <span data-ttu-id="8c8bb-225">Однако тот факт, что отображается меню, означает, что обмен сообщениями должен обрабатываться несколько иначе.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-225">However, the fact that a menu is displayed means that messaging will have to be handled somewhat differently.</span></span>

### <a name="message-processing-for-menu-hot-tracking"></a><span data-ttu-id="8c8bb-226">Обработка сообщений для Hot-Tracking меню</span><span class="sxs-lookup"><span data-stu-id="8c8bb-226">Message Processing for Menu Hot-Tracking</span></span>

<span data-ttu-id="8c8bb-227">Для горячего отслеживания меню требуется, чтобы меню отображалось в любое время, помимо короткого интервала, необходимого для переключения на новое меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-227">Menu hot-tracking requires that a menu be displayed at all times, apart from the brief interval required to switch to a new menu.</span></span> <span data-ttu-id="8c8bb-228">Однако раскрывающееся меню, отображаемое [**метод TrackPopupMenu**](/windows/desktop/api/winuser/nf-winuser-trackpopupmenu) , является модальным.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-228">However, the drop-down menu that is displayed by [**TrackPopupMenu**](/windows/desktop/api/winuser/nf-winuser-trackpopupmenu) is modal.</span></span> <span data-ttu-id="8c8bb-229">Приложение будет по-прежнему отправлять некоторые сообщения, включая [**\_ команду WM**](/windows/desktop/menurc/wm-command), [ТБН \_ хотитемчанже](tbn-hotitemchange.md)и обычные сообщения, связанные с меню, такие как [**WM \_ менуселект**](/windows/desktop/menurc/wm-menuselect).</span><span class="sxs-lookup"><span data-stu-id="8c8bb-229">Your application will continue to receive some messages directly, including [**WM\_COMMAND**](/windows/desktop/menurc/wm-command), [TBN\_HOTITEMCHANGE](tbn-hotitemchange.md), and normal menu-related messages such as [**WM\_MENUSELECT**](/windows/desktop/menurc/wm-menuselect).</span></span> <span data-ttu-id="8c8bb-230">Однако он не будет напрямую отправлять сообщения с клавиатурой или мышью с низким уровнем.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-230">However, it will not receive low-level keyboard or mouse messages directly.</span></span> <span data-ttu-id="8c8bb-231">Для обработки сообщений, таких как [**WM \_ MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove), необходимо установить обработчик сообщений для перехвата сообщений, направляемых в меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-231">To handle messages such as [**WM\_MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove), you must set a message hook to intercept messages that are directed to the menu.</span></span>

<span data-ttu-id="8c8bb-232">При отображении раскрывающегося меню задайте обработчик сообщений, вызвав функцию [**сетвиндовшукекс**](/windows/desktop/api/winuser/nf-winuser-setwindowshookexa) с параметром *идхук* , который имеет значение \_ мсгфилтер.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-232">When a drop-down menu is displayed, set the message hook by calling the [**SetWindowsHookEx**](/windows/desktop/api/winuser/nf-winuser-setwindowshookexa) function with the *idHook* parameter set to WH\_MSGFILTER.</span></span> <span data-ttu-id="8c8bb-233">Все сообщения, предназначенные для меню, будут переданы в [процедуру подключения](/previous-versions/windows/desktop/legacy/ms644987(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="8c8bb-233">All messages intended for the menu will be passed to your [hook procedure](/previous-versions/windows/desktop/legacy/ms644987(v=vs.85)).</span></span> <span data-ttu-id="8c8bb-234">Например, в следующем фрагменте кода задается обработчик сообщений, который будет выполнять перехват сообщений, передаваемых в раскрывающееся меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-234">For example, the following code fragment sets a message hook that will trap messages that are going to a drop-down menu.</span></span> <span data-ttu-id="8c8bb-235">`MsgHook` имя процедуры-обработчика, а `hhookMsg` — это обработчик процедуры.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-235">`MsgHook` is the name of the hook procedure, and `hhookMsg` is the handle to the procedure.</span></span>


```
hhookMsg = SetWindowsHookEx(WH_MSGFILTER, MsgHook, HINST_THISDLL, 0);
```



<span data-ttu-id="8c8bb-236">Сообщения меню идентифицируются путем установки параметра *нкоде* для процедуры-обработчика в \_ меню мсгф.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-236">Menu messages are identified by setting the hook procedure's *nCode* parameter to MSGF\_MENU.</span></span> <span data-ttu-id="8c8bb-237">Параметр *lParam* будет указывать на структуру [**MSG**](/windows/win32/api/winuser/ns-winuser-msg) с сообщением.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-237">The *lParam* parameter will point to a [**MSG**](/windows/win32/api/winuser/ns-winuser-msg) structure with the message.</span></span> <span data-ttu-id="8c8bb-238">Сведения о том, какие сообщения необходимо обработать, и о том, как они обсуждаются в оставшейся части этого раздела.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-238">The details of which messages need to be handled, and how, are discussed in the remainder of this topic.</span></span>

<span data-ttu-id="8c8bb-239">Приложение должно передать все сообщения в следующий обработчик сообщений, вызвав функцию [**каллнекссукекс**](/windows/desktop/api/winuser/nf-winuser-callnexthookex) .</span><span class="sxs-lookup"><span data-stu-id="8c8bb-239">Your application must pass all messages on to the next message hook by calling the [**CallNextHookEx**](/windows/desktop/api/winuser/nf-winuser-callnexthookex) function.</span></span> <span data-ttu-id="8c8bb-240">Также необходимо отправить сообщения мыши непосредственно в элемент управления ToolBar, дополнив преобразование всех координат точек в клиентское пространство панели инструментов.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-240">You must also send mouse messages directly to the toolbar control, making sure to convert any point coordinates to the toolbar client coordinate space.</span></span> <span data-ttu-id="8c8bb-241">Прямая отправка сообщений гарантирует, что элемент управления ToolBar получит соответствующие сообщения мыши.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-241">Sending the messages directly ensures that the toolbar control receives the appropriate mouse messages.</span></span> <span data-ttu-id="8c8bb-242">Например, панель инструментов должна получить сообщения [**WM \_ MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove) для горячей замены своих кнопок.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-242">For instance, the toolbar needs to receive [**WM\_MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove) messages in order to hot-track its buttons.</span></span>

<span data-ttu-id="8c8bb-243">При активации новой кнопки приложение должно свернуть старое раскрывающееся меню с сообщением [**WM \_ канцелмоде**](/windows/desktop/winmsg/wm-cancelmode) и отобразить новое меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-243">When a new button is activated, your application must collapse the old drop-down menu with a [**WM\_CANCELMODE**](/windows/desktop/winmsg/wm-cancelmode) message, and display a new menu.</span></span> <span data-ttu-id="8c8bb-244">Он также должен сворачивать раскрывающееся меню, когда фокус переводится из строки меню с помощью клавиш перемещения или щелчка вне области меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-244">It must also collapse the drop-down menu when focus is taken from the menu bar with keyboard navigation or by clicking outside the menu area.</span></span> <span data-ttu-id="8c8bb-245">Всякий раз при свертывании меню необходимо освободить его обработчик сообщений с помощью функции [**унхуквиндовшукекс**](/windows/desktop/api/winuser/nf-winuser-unhookwindowshookex) .</span><span class="sxs-lookup"><span data-stu-id="8c8bb-245">Whenever you collapse a menu, you should free its message hook by using the [**UnhookWindowsHookEx**](/windows/desktop/api/winuser/nf-winuser-unhookwindowshookex) function.</span></span> <span data-ttu-id="8c8bb-246">Если необходимо отобразить другое раскрывающееся меню, создайте новый обработчик сообщений.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-246">If you need to display another drop-down menu, create a new message hook.</span></span> <span data-ttu-id="8c8bb-247">При запуске команды меню будет свернуто автоматически, но необходимо явно освободить обработчик сообщений.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-247">When a command is launched, the menu will be collapsed automatically but you must explicitly free the message hook.</span></span>

<span data-ttu-id="8c8bb-248">В следующем примере кода освобождается обработчик сообщений, который был задан в предыдущем примере.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-248">The following code example frees the message hook that was set in the previous example.</span></span>


```
UnhookWindowsHookEx(hhookMsg);
```



### <a name="mouse-navigation"></a><span data-ttu-id="8c8bb-249">Навигация по мыши</span><span class="sxs-lookup"><span data-stu-id="8c8bb-249">Mouse Navigation</span></span>

<span data-ttu-id="8c8bb-250">Когда на обычной панели инструментов отображаются кнопки "горячая" Отслеживание, она выделяет активную кнопку и отправляет в приложение уведомление [ТБН \_ хотитемчанже](tbn-hotitemchange.md) при каждом активировании новой кнопки.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-250">When a normal toolbar control hot-tracks buttons, it highlights the active button and sends the application a [TBN\_HOTITEMCHANGE](tbn-hotitemchange.md) notification each time a new button is activated.</span></span> <span data-ttu-id="8c8bb-251">Приложение отвечает за отображение соответствующего раскрывающегося меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-251">Your application is responsible for displaying the appropriate drop-down menu.</span></span> <span data-ttu-id="8c8bb-252">Оно должно:</span><span class="sxs-lookup"><span data-stu-id="8c8bb-252">It must:</span></span>

-   <span data-ttu-id="8c8bb-253">Обработайте уведомление [ТБН \_ хотитемчанже](tbn-hotitemchange.md) , чтобы вести отслеживание активной кнопки.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-253">Handle the [TBN\_HOTITEMCHANGE](tbn-hotitemchange.md) notification to keep track of the active button.</span></span> <span data-ttu-id="8c8bb-254">Когда активная кнопка изменится, сверните старое меню и создайте новое.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-254">When the active button changes, collapse the old menu and create a new one.</span></span>
-   <span data-ttu-id="8c8bb-255">Обрабатывает уведомление [в \_ раскрывающемся списке ТБН](tbn-dropdown.md) , которое отправляется при нажатии кнопки.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-255">Handle the [TBN\_DROPDOWN](tbn-dropdown.md) notification that is sent when a button is clicked.</span></span> <span data-ttu-id="8c8bb-256">Затем следует свернуть меню и отключить горячее отслеживание меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-256">It should then collapse the menu and disable menu hot-tracking.</span></span> <span data-ttu-id="8c8bb-257">Кнопка остается активной.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-257">The button remains active.</span></span>
-   <span data-ttu-id="8c8bb-258">Обрабатывайте сообщения [**WM \_ лбуттондовн**](/windows/desktop/inputdev/wm-lbuttondown), [**WM \_ рбуттондовн**](/windows/desktop/inputdev/wm-rbuttondown)и [**WM \_ MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove) в процедуре обработчика сообщений, чтобы отследить расположение мыши.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-258">Handle the [**WM\_LBUTTONDOWN**](/windows/desktop/inputdev/wm-lbuttondown), [**WM\_RBUTTONDOWN**](/windows/desktop/inputdev/wm-rbuttondown), and [**WM\_MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove) messages in your message hook procedure, to keep track of the mouse position.</span></span> <span data-ttu-id="8c8bb-259">Если щелкнуть мышью за пределами области меню, свернуть текущее раскрывающееся меню, отключить горячее отслеживание меню и вернуть строку меню в состояние ее предактивации.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-259">If the mouse is clicked outside the menu area, collapse the current drop-down menu, deactivate menu hot-tracking, and return the menu bar to its preactivation state.</span></span>
-   <span data-ttu-id="8c8bb-260">При запуске команды меню отключите функцию «горячее отслеживание».</span><span class="sxs-lookup"><span data-stu-id="8c8bb-260">When a menu command is launched, disable menu hot-tracking.</span></span> <span data-ttu-id="8c8bb-261">Меню будет свернуто автоматически, но необходимо явным образом освободить обработчик сообщений.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-261">The menu will be collapsed automatically but you must explicitly free the message hook.</span></span>

<span data-ttu-id="8c8bb-262">Также необходимо работать с сообщениями, связанными с меню, например с сообщением [**WM \_ инитменупопуп**](/windows/desktop/menurc/wm-initmenupopup) , которое отправляется, когда элементу меню нужно отобразить подменю.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-262">You must also handle menu-related messaging, such as the [**WM\_INITMENUPOPUP**](/windows/desktop/menurc/wm-initmenupopup) message that is sent when a menu item needs to display a submenu.</span></span> <span data-ttu-id="8c8bb-263">Обсуждение того, как обработано такие сообщения, см. в разделе [меню](/windows/desktop/menurc/menus).</span><span class="sxs-lookup"><span data-stu-id="8c8bb-263">For a discussion of how to handle such messages, see [Menus](/windows/desktop/menurc/menus).</span></span>

### <a name="keyboard-navigation"></a><span data-ttu-id="8c8bb-264">Навигация с помощью клавиатуры</span><span class="sxs-lookup"><span data-stu-id="8c8bb-264">Keyboard Navigation</span></span>

<span data-ttu-id="8c8bb-265">Приложение должно обрабатывать сообщения клавиатуры в процедуре обработчика сообщений и действовать на тех, которые влияют на горячее отслеживание меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-265">Your application must process keyboard messages in the message hook procedure and act on those that affect menu hot-tracking.</span></span> <span data-ttu-id="8c8bb-266">Необходимо обработать следующие ключевые клавиши:</span><span class="sxs-lookup"><span data-stu-id="8c8bb-266">The following key presses must be handled:</span></span>

-   <span data-ttu-id="8c8bb-267">Клавиша ESCAPE.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-267">The ESCAPE key.</span></span> <span data-ttu-id="8c8bb-268">При нажатии клавиши ESCAPE отображается на один уровень вверх.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-268">The ESCAPE key backs the display up one level.</span></span> <span data-ttu-id="8c8bb-269">Если подменю отображается, оно должно быть свернуто.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-269">If a submenu is being displayed, it must be collapsed.</span></span> <span data-ttu-id="8c8bb-270">Если основное меню кнопки отображается, сверните его и отключите функцию горячего отслеживания меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-270">If a button's primary menu is displayed, collapse it and disable menu hot-tracking.</span></span> <span data-ttu-id="8c8bb-271">Кнопка остается активной.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-271">The button remains active.</span></span>
-   <span data-ttu-id="8c8bb-272">Клавиша СТРЕЛКА ВПРАВО.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-272">The RIGHT ARROW key.</span></span> <span data-ttu-id="8c8bb-273">Если у элемента есть подменю, отобразите его.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-273">If the item has a submenu, display it.</span></span> <span data-ttu-id="8c8bb-274">Если элемент не имеет подменю, сверните меню и все подменю, активируйте кнопку Далее с [**ТБ \_ сесотитем**](tb-sethotitem.md)и отобразите его меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-274">If the item does not have a submenu, collapse the menu and any submenus, activate the next button with [**TB\_SETHOTITEM**](tb-sethotitem.md), and display its menu.</span></span> <span data-ttu-id="8c8bb-275">Если последняя кнопка была активна при получении уведомления, отобразите меню для первой кнопки.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-275">If the last button was active when this notification was received, display the menu for the first button.</span></span>
-   <span data-ttu-id="8c8bb-276">Клавиша СТРЕЛКА ВЛЕВО.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-276">The LEFT ARROW key.</span></span> <span data-ttu-id="8c8bb-277">Если элемент находится в подменю, сверните его и переместите фокус на его родительское меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-277">If the item is in a submenu, collapse it and shift focus to its parent menu.</span></span> <span data-ttu-id="8c8bb-278">Если элемент не является подменю, сверните меню, активируйте смежную кнопку с [**ТБ \_ сесотитем**](tb-sethotitem.md)и отобразите его меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-278">If the item is not a submenu, collapse the menu, activate the adjacent button with [**TB\_SETHOTITEM**](tb-sethotitem.md), and display its menu.</span></span> <span data-ttu-id="8c8bb-279">Если первая кнопка была активна при получении уведомления, отобразите меню последней кнопки.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-279">If the first button was active when this notification was received, display the menu for the last button.</span></span>
-   <span data-ttu-id="8c8bb-280">Клавиши со стрелками вверх и вниз.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-280">The UP ARROW and DOWN ARROW keys.</span></span> <span data-ttu-id="8c8bb-281">Эти ключи используются для навигации в меню, но не влияют непосредственно на горячее отслеживание меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-281">These keys are used to navigate within a menu but do not directly affect menu hot-tracking.</span></span>
-   <span data-ttu-id="8c8bb-282">Сочетание клавиш ALT +*Клавиша* .</span><span class="sxs-lookup"><span data-stu-id="8c8bb-282">An ALT-*Key* accelerator key.</span></span> <span data-ttu-id="8c8bb-283">Используйте сообщение [**\_ мапакцелератор ТБ**](tb-mapaccelerator.md) , чтобы определить, к какой кнопке соответствует символ *ключа* .</span><span class="sxs-lookup"><span data-stu-id="8c8bb-283">Use the [**TB\_MAPACCELERATOR**](tb-mapaccelerator.md) message to determine which button the *Key* character corresponds to.</span></span> <span data-ttu-id="8c8bb-284">Если она соответствует другой кнопке, а не активной в данный момент, сверните текущее раскрывающееся меню, активируйте кнопку New с [**ТБ \_ сесотитем**](tb-sethotitem.md)и выведите меню для соседней кнопки.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-284">If it corresponds to a different button than the currently active one, collapse the current drop-down menu, activate the new button with [**TB\_SETHOTITEM**](tb-sethotitem.md), and display the menu for the adjacent button.</span></span> <span data-ttu-id="8c8bb-285">Если *символ клавиши* соответствует отображаемой в данный момент кнопке, сверните раскрывающееся меню и отключите горячее отслеживание в меню.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-285">If the *Key character* corresponds to the currently displayed button, collapse the drop-down menu and disable menu hot-tracking.</span></span> <span data-ttu-id="8c8bb-286">Кнопка должна оставаться активной.</span><span class="sxs-lookup"><span data-stu-id="8c8bb-286">The button should remain active.</span></span>

 

 