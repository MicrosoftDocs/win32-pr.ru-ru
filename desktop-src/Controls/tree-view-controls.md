---
title: Сведения об элементах управления Tree-View
description: Элемент управления "представление в виде дерева" — это окно, в котором отображается иерархический список элементов, например заголовки в документе, записи в индексе или файлы и каталоги на диске.
ms.assetid: 10cc7949-dd77-412d-bad1-db8d8a049582
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: df70a2d3c2f841b022930a07ee2f140ee5bfc8e3
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "103987942"
---
# <a name="about-tree-view-controls"></a><span data-ttu-id="5e666-103">Сведения об элементах управления Tree-View</span><span class="sxs-lookup"><span data-stu-id="5e666-103">About Tree-View Controls</span></span>

<span data-ttu-id="5e666-104">Элемент управления "представление в виде дерева" — это окно, в котором отображается иерархический список элементов, например заголовки в документе, записи в индексе или файлы и каталоги на диске.</span><span class="sxs-lookup"><span data-stu-id="5e666-104">A tree-view control is a window that displays a hierarchical list of items, such as the headings in a document, the entries in an index, or the files and directories on a disk.</span></span> <span data-ttu-id="5e666-105">Каждый элемент состоит из метки и необязательного изображения точечного рисунка, и каждый элемент может иметь список связанных с ним подэлементов.</span><span class="sxs-lookup"><span data-stu-id="5e666-105">Each item consists of a label and an optional bitmapped image, and each item can have a list of subitems associated with it.</span></span> <span data-ttu-id="5e666-106">Щелкнув элемент, пользователь может развернуть или свернуть связанный список подэлементов.</span><span class="sxs-lookup"><span data-stu-id="5e666-106">By clicking an item, the user can expand or collapse the associated list of subitems.</span></span>

<span data-ttu-id="5e666-107">На следующем рисунке показан простой элемент управления представлением дерева с корневым узлом, развернутым узлом и свернутым узлом.</span><span class="sxs-lookup"><span data-stu-id="5e666-107">The following illustration shows a simple tree-view control with a root node, an expanded node, and a collapsed node.</span></span> <span data-ttu-id="5e666-108">Элемент управления использует одно растровое изображение для выбранного элемента и другое растровое изображение для других элементов.</span><span class="sxs-lookup"><span data-stu-id="5e666-108">The control uses one bitmap for the selected item and another bitmap for other items.</span></span>

![снимок экрана, отображающий пять узлов в иерархии; выбран текст одного узла, но узлы не связаны друг с другом по строкам.](images/tv-simple.png)

<span data-ttu-id="5e666-110">После создания элемента управления "дерево-представление" вы добавляете, удаляете, упорядочивайте или иным образом управляете элементами, отправляя сообщения в элемент управления.</span><span class="sxs-lookup"><span data-stu-id="5e666-110">After creating a tree-view control, you add, remove, arrange, or otherwise manipulate items by sending messages to the control.</span></span> <span data-ttu-id="5e666-111">Каждое сообщение имеет один или несколько соответствующих макросов, которые можно использовать вместо отправки сообщения явным образом.</span><span class="sxs-lookup"><span data-stu-id="5e666-111">Each message has one or more corresponding macros that you can use instead of sending the message explicitly.</span></span>

<span data-ttu-id="5e666-112">В этом разделе рассматриваются следующие темы.</span><span class="sxs-lookup"><span data-stu-id="5e666-112">The following topics are discussed in this section.</span></span>

-   [<span data-ttu-id="5e666-113">Стили представления в виде дерева</span><span class="sxs-lookup"><span data-stu-id="5e666-113">Tree-View Styles</span></span>](#tree-view-styles)
-   [<span data-ttu-id="5e666-114">Родительские и дочерние элементы</span><span class="sxs-lookup"><span data-stu-id="5e666-114">Parent and Child Items</span></span>](#parent-and-child-items)
-   [<span data-ttu-id="5e666-115">Метки элементов</span><span class="sxs-lookup"><span data-stu-id="5e666-115">Item Labels</span></span>](#item-labels)
-   [<span data-ttu-id="5e666-116">Редактирование меток в виде дерева</span><span class="sxs-lookup"><span data-stu-id="5e666-116">Tree-View Label Editing</span></span>](#tree-view-label-editing)
-   [<span data-ttu-id="5e666-117">Позиция элемента представления в виде дерева</span><span class="sxs-lookup"><span data-stu-id="5e666-117">Tree-View Item Position</span></span>](#tree-view-item-position)
-   [<span data-ttu-id="5e666-118">Общие сведения о состояниях элементов представления в виде дерева</span><span class="sxs-lookup"><span data-stu-id="5e666-118">Tree-View Item States Overview</span></span>](#tree-view-item-states-overview)
-   [<span data-ttu-id="5e666-119">Выбор элементов</span><span class="sxs-lookup"><span data-stu-id="5e666-119">Item Selection</span></span>](#item-selection)
-   [<span data-ttu-id="5e666-120">Сведения об элементе</span><span class="sxs-lookup"><span data-stu-id="5e666-120">Item Information</span></span>](#item-information)
-   [<span data-ttu-id="5e666-121">Древовидное представление списков изображений</span><span class="sxs-lookup"><span data-stu-id="5e666-121">Tree-View Image Lists</span></span>](#tree-view-image-lists)
-   [<span data-ttu-id="5e666-122">Операции перетаскивания</span><span class="sxs-lookup"><span data-stu-id="5e666-122">Drag-and-Drop Operations</span></span>](#drag-and-drop-operations)
-   [<span data-ttu-id="5e666-123">Сообщения с уведомлениями элемента управления представления в виде дерева</span><span class="sxs-lookup"><span data-stu-id="5e666-123">Tree-View Control Notification Messages</span></span>](#tree-view-control-notification-messages)
-   [<span data-ttu-id="5e666-124">Обработка сообщений управления Tree-View по умолчанию</span><span class="sxs-lookup"><span data-stu-id="5e666-124">Default Tree-View Control Message Processing</span></span>](#default-tree-view-control-message-processing)
-   [<span data-ttu-id="5e666-125">См. также</span><span class="sxs-lookup"><span data-stu-id="5e666-125">Related topics</span></span>](#related-topics)

## <a name="tree-view-styles"></a><span data-ttu-id="5e666-126">Стили Tree-View</span><span class="sxs-lookup"><span data-stu-id="5e666-126">Tree-View Styles</span></span>

<span data-ttu-id="5e666-127">Стили представления в виде дерева определяют аспекты внешнего вида элемента управления представления в виде дерева.</span><span class="sxs-lookup"><span data-stu-id="5e666-127">Tree-view styles govern aspects of a tree-view control's appearance.</span></span> <span data-ttu-id="5e666-128">Начальные стили задаются при создании элемента управления "дерево-представление".</span><span class="sxs-lookup"><span data-stu-id="5e666-128">You set the initial styles when you create the tree-view control.</span></span> <span data-ttu-id="5e666-129">Стили можно извлечь и изменить после создания элемента управления "дерево-представление" с помощью функций [**жетвиндовлонг**](/windows/desktop/api/winuser/nf-winuser-getwindowlonga) и [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga) .</span><span class="sxs-lookup"><span data-stu-id="5e666-129">You can retrieve and change the styles after creating the tree-view control by using the [**GetWindowLong**](/windows/desktop/api/winuser/nf-winuser-getwindowlonga) and [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga) functions.</span></span>

<span data-ttu-id="5e666-130">Стиль [**\_ хаслинес телевизоров**](tree-view-control-window-styles.md) улучшает графическое представление иерархии элемента управления иерархического представления, рисуя линии, связывающие дочерние элементы с родительским элементом, как показано на следующей иллюстрации.</span><span class="sxs-lookup"><span data-stu-id="5e666-130">The [**TVS\_HASLINES**](tree-view-control-window-styles.md) style enhances the graphic representation of a tree-view control's hierarchy by drawing lines that link child items to their parent item, as shown in the following illustration.</span></span>

![снимок экрана с предыдущим расположением, но со строками, соединяющимися с узлами; Первая строка в порядке убывания от корневого узла](images/tv-haslines.png)

<span data-ttu-id="5e666-132">Сам по себе этот стиль не рисует линии в корне иерархии.</span><span class="sxs-lookup"><span data-stu-id="5e666-132">By itself, this style does not draw lines at the root of the hierarchy.</span></span> <span data-ttu-id="5e666-133">Для этого необходимо объединить стили [**\_ Хаслинес**](tree-view-control-window-styles.md) и [**телевизоры \_ линесатрут**](tree-view-control-window-styles.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-133">To do so, you need to combine the [**TVS\_HASLINES**](tree-view-control-window-styles.md) and [**TVS\_LINESATROOT**](tree-view-control-window-styles.md) styles.</span></span> <span data-ttu-id="5e666-134">Результат показан на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="5e666-134">The result is shown in the following illustration.</span></span>

![снимок экрана с предыдущим расположением, но с дополнительной горизонтальной линией, ведущей к корневому узлу](images/tv-rootlines.png)

<span data-ttu-id="5e666-136">Пользователь может развернуть или свернуть список дочерних элементов родительского элемента, дважды щелкнув родительский элемент.</span><span class="sxs-lookup"><span data-stu-id="5e666-136">The user can expand or collapse a parent item's list of child items by double-clicking the parent item.</span></span> <span data-ttu-id="5e666-137">Элемент управления представлением в виде дерева, имеющий стиль [**\_ хасбуттонс телевизоров**](tree-view-control-window-styles.md) , добавляет кнопку слева от каждого родительского элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-137">A tree-view control that has the [**TVS\_HASBUTTONS**](tree-view-control-window-styles.md) style adds a button to the left side of each parent item.</span></span> <span data-ttu-id="5e666-138">Пользователь может нажать эту кнопку один раз вместо двойного щелчка родительского элемента, чтобы развернуть или свернуть дочерний элемент.</span><span class="sxs-lookup"><span data-stu-id="5e666-138">The user can click the button once instead of double-clicking the parent item to expand or collapse the child.</span></span> <span data-ttu-id="5e666-139">**Телевизоры \_ ХАСБУТТОНС** не добавляет кнопки к элементам в корне иерархии.</span><span class="sxs-lookup"><span data-stu-id="5e666-139">**TVS\_HASBUTTONS** does not add buttons to items at the root of the hierarchy.</span></span> <span data-ttu-id="5e666-140">Для этого необходимо объединить [**телевизоры \_ хаслинес**](tree-view-control-window-styles.md), [**телевизоры \_ линесатрут**](tree-view-control-window-styles.md)и **телевизоры \_ хасбуттонс**.</span><span class="sxs-lookup"><span data-stu-id="5e666-140">To do so, you must combine [**TVS\_HASLINES**](tree-view-control-window-styles.md), [**TVS\_LINESATROOT**](tree-view-control-window-styles.md), and **TVS\_HASBUTTONS**.</span></span> <span data-ttu-id="5e666-141">Это сочетание стилей показано на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="5e666-141">This combination of styles is shown in the following illustration.</span></span>

![снимок экрана, отображающий предыдущее расположение, но с кнопками "развернуть/свернуть" на каждой вершине двух линий](images/tv-hasbuttons.png)

<span data-ttu-id="5e666-143">Стиль [**\_ флажков телевизоры**](tree-view-control-window-styles.md) создает флажки рядом с каждым элементом.</span><span class="sxs-lookup"><span data-stu-id="5e666-143">The [**TVS\_CHECKBOXES**](tree-view-control-window-styles.md) style creates checkboxes next to each item.</span></span> <span data-ttu-id="5e666-144">Если вы хотите использовать стиль CheckBox, необходимо задать стиль **"телевизоры \_ "** (с [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga)) после создания элемента управления "дерево-представление" и перед заполнением дерева.</span><span class="sxs-lookup"><span data-stu-id="5e666-144">If you want to use the checkbox style, you must set the **TVS\_CHECKBOXES** style (with [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga)) after you create the tree-view control and before you populate the tree.</span></span> <span data-ttu-id="5e666-145">В противном случае флажки в зависимости от временных проблем могут оказаться неустановленными.</span><span class="sxs-lookup"><span data-stu-id="5e666-145">Otherwise, the checkboxes might appear unchecked, depending on timing issues.</span></span> <span data-ttu-id="5e666-146">На следующем рисунке показан стиль CheckBox.</span><span class="sxs-lookup"><span data-stu-id="5e666-146">The following illustration shows the checkbox style.</span></span>

![снимок экрана, отображающий предыдущее расположение, но с флажком рядом с каждым узлом; выбраны два флажка](images/tv-haschecks.png)

<span data-ttu-id="5e666-148">Стиль " [**телевизоры \_ фуллровселект**](tree-view-control-window-styles.md) " приводит к выделению выделения для расширения всей ширины элемента управления, а не только для самого элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-148">The [**TVS\_FULLROWSELECT**](tree-view-control-window-styles.md) style causes the selection highlight to extend over the full width of the control, not just over the item itself.</span></span> <span data-ttu-id="5e666-149">Этот стиль показан на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="5e666-149">The following illustration shows this style.</span></span>

![снимок экрана с исходным расположением пяти узлов без линий, но выделение выделения расширяет всю ширину элемента управления](images/tv-fullrow.png)

<span data-ttu-id="5e666-151">Стиль [**\_ Едитлабелс для телевизоров**](tree-view-control-window-styles.md) позволяет пользователю изменять метки элементов древовидного представления.</span><span class="sxs-lookup"><span data-stu-id="5e666-151">The [**TVS\_EDITLABELS**](tree-view-control-window-styles.md) style makes it possible for the user to edit the labels of tree-view items.</span></span> <span data-ttu-id="5e666-152">Дополнительные сведения об изменении меток см. в разделе [Редактирование меток в виде дерева](#tree-view-label-editing).</span><span class="sxs-lookup"><span data-stu-id="5e666-152">For more information about editing labels, see [Tree-View Label Editing](#tree-view-label-editing).</span></span>

<span data-ttu-id="5e666-153">Дополнительные сведения об этих и других стилях см. в разделе [стили окна управления в виде дерева](tree-view-control-window-styles.md).</span><span class="sxs-lookup"><span data-stu-id="5e666-153">For more information on these and other styles, see [Tree-View Control Window Styles](tree-view-control-window-styles.md).</span></span>

## <a name="parent-and-child-items"></a><span data-ttu-id="5e666-154">Родительские и дочерние элементы</span><span class="sxs-lookup"><span data-stu-id="5e666-154">Parent and Child Items</span></span>

<span data-ttu-id="5e666-155">Любой элемент в элементе управления "дерево" может содержать список вложенных элементов, называемых *дочерними элементами*.</span><span class="sxs-lookup"><span data-stu-id="5e666-155">Any item in a tree-view control can have a list of subitems—called *child items*—associated with it.</span></span> <span data-ttu-id="5e666-156">Элемент с одним или несколькими дочерними элементами называется *родительским элементом*.</span><span class="sxs-lookup"><span data-stu-id="5e666-156">An item that has one or more child items is called a *parent item*.</span></span> <span data-ttu-id="5e666-157">Дочерний элемент отображается под родительским элементом и помещается с отступом, чтобы показать, что он является подчиненным для родительского элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-157">A child item is displayed below its parent item and is indented to indicate that it is subordinate to the parent.</span></span> <span data-ttu-id="5e666-158">Элемент, не имеющий родителя, отображается в верхней части иерархии и называется *корневым элементом*.</span><span class="sxs-lookup"><span data-stu-id="5e666-158">An item that has no parent appears at the top of the hierarchy and is called a *root item*.</span></span>

<span data-ttu-id="5e666-159">Чтобы добавить элемент в элемент управления представлением в виде дерева, отправьте сообщение [**TVM \_ INSERTITEM**](tvm-insertitem.md) в элемент управления.</span><span class="sxs-lookup"><span data-stu-id="5e666-159">To add an item to a tree-view control, send the [**TVM\_INSERTITEM**](tvm-insertitem.md) message to the control.</span></span> <span data-ttu-id="5e666-160">Сообщение возвращает маркер типа ХТРИИТЕМ, который однозначно определяет элемент.</span><span class="sxs-lookup"><span data-stu-id="5e666-160">The message returns a handle to the HTREEITEM type, which uniquely identifies the item.</span></span> <span data-ttu-id="5e666-161">При добавлении элемента необходимо указать этот маркер для родительского элемента нового элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-161">When adding an item, you must specify the handle to the new item's parent item.</span></span> <span data-ttu-id="5e666-162">Если  \_ вместо родительского маркера элемента в структуре [**твинсертструкт**](/windows/win32/api/commctrl/ns-commctrl-tvinsertstructa) указано значение null или Тви root, этот элемент добавляется в качестве корневого элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-162">If you specify **NULL** or the TVI\_ROOT value instead of a parent item handle in the [**TVINSERTSTRUCT**](/windows/win32/api/commctrl/ns-commctrl-tvinsertstructa) structure, the item is added as a root item.</span></span>

<span data-ttu-id="5e666-163">В любой момент времени состояние списка дочерних элементов родительского элемента может быть либо развернутым, либо свернутым.</span><span class="sxs-lookup"><span data-stu-id="5e666-163">At any given time, the state of a parent item's list of child items can be either expanded or collapsed.</span></span> <span data-ttu-id="5e666-164">Когда состояние разворачивается, дочерние элементы отображаются под родительским элементом.</span><span class="sxs-lookup"><span data-stu-id="5e666-164">When the state is expanded, the child items are displayed below the parent item.</span></span> <span data-ttu-id="5e666-165">Когда он свернут, дочерние элементы не отображаются.</span><span class="sxs-lookup"><span data-stu-id="5e666-165">When it is collapsed, the child items are not displayed.</span></span> <span data-ttu-id="5e666-166">Список автоматически переключается между развернутым и свернутым состояниями, когда пользователь дважды щелкает родительский элемент, или, если у родителя есть стиль [**\_ хасбуттонс**](tree-view-control-window-styles.md) , когда пользователь нажимает кнопку, связанную с родительским элементом.</span><span class="sxs-lookup"><span data-stu-id="5e666-166">The list automatically toggles between the expanded and collapsed states when the user double-clicks the parent item or, if the parent has the [**TVS\_HASBUTTONS**](tree-view-control-window-styles.md) style, when the user clicks the button associated with the parent item.</span></span> <span data-ttu-id="5e666-167">Приложение может развернуть или свернуть дочерние элементы с помощью сообщения [**TVM \_ expand**](tvm-expand.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-167">An application can expand or collapse the child items by using the [**TVM\_EXPAND**](tvm-expand.md) message.</span></span>

<span data-ttu-id="5e666-168">Элемент управления представлением в виде дерева отправляет родительскому окну сообщение уведомления [ТВН \_ итемекспандинг](tvn-itemexpanding.md) , когда список дочерних элементов родительского элемента будет развернут или свернут.</span><span class="sxs-lookup"><span data-stu-id="5e666-168">A tree-view control sends the parent window a [TVN\_ITEMEXPANDING](tvn-itemexpanding.md) notification message when a parent item's list of child items is about to be expanded or collapsed.</span></span> <span data-ttu-id="5e666-169">Уведомление дает приложению возможность предотвратить изменение или задать любые атрибуты родительского элемента, зависящие от состояния списка дочерних элементов.</span><span class="sxs-lookup"><span data-stu-id="5e666-169">The notification gives an application the opportunity to prevent the change or to set any attributes of the parent item that depend on the state of the list of child items.</span></span> <span data-ttu-id="5e666-170">После изменения состояния списка элемент управления представлением дерева отправляет родительскому окну сообщение уведомления [ТВН \_ итемекспандед](tvn-itemexpanded.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-170">After changing the state of the list, the tree-view control sends the parent window a [TVN\_ITEMEXPANDED](tvn-itemexpanded.md) notification message.</span></span>

<span data-ttu-id="5e666-171">Когда список дочерних элементов разворачивается, он располагается с отступом относительно родительского элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-171">When a list of child items is expanded, it is indented relative to the parent item.</span></span> <span data-ttu-id="5e666-172">Можно задать величину отступов с помощью сообщения [**TVM \_ сетиндент**](tvm-setindent.md) или получить текущую сумму с помощью сообщения [**TVM \_ Indent**](tvm-getindent.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-172">You can set the amount of indentation by using the [**TVM\_SETINDENT**](tvm-setindent.md) message or retrieve the current amount by using the [**TVM\_GETINDENT**](tvm-getindent.md) message.</span></span>

<span data-ttu-id="5e666-173">Элемент управления "представление в виде дерева" использует память, выделенную из кучи процесса, который создает элемент управления "дерево-представление".</span><span class="sxs-lookup"><span data-stu-id="5e666-173">A tree-view control uses memory allocated from the heap of the process that creates the tree-view control.</span></span> <span data-ttu-id="5e666-174">Максимальное число элементов в представлении в виде дерева зависит от объема памяти, доступной в куче.</span><span class="sxs-lookup"><span data-stu-id="5e666-174">The maximum number of items in a tree view is based on the amount of memory available in the heap.</span></span>

## <a name="item-labels"></a><span data-ttu-id="5e666-175">Метки элементов</span><span class="sxs-lookup"><span data-stu-id="5e666-175">Item Labels</span></span>

<span data-ttu-id="5e666-176">Обычно текст метки элемента задается при добавлении элемента к элементу управления "дерево-представление".</span><span class="sxs-lookup"><span data-stu-id="5e666-176">You typically specify the text of an item's label when adding the item to the tree-view control.</span></span> <span data-ttu-id="5e666-177">Сообщение [**TVM \_ INSERTITEM**](tvm-insertitem.md) содержит структуру [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) , определяющую свойства элемента, включая строку, содержащую текст метки.</span><span class="sxs-lookup"><span data-stu-id="5e666-177">The [**TVM\_INSERTITEM**](tvm-insertitem.md) message includes a [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) structure that defines the item's properties, including a string containing the text of the label.</span></span>

<span data-ttu-id="5e666-178">Элемент управления "дерево-представление" выделяет память для хранения каждого элемента; текст меток элементов занимает значительную часть этой памяти.</span><span class="sxs-lookup"><span data-stu-id="5e666-178">A tree-view control allocates memory for storing each item; the text of the item labels takes up a significant portion of this memory.</span></span> <span data-ttu-id="5e666-179">Если приложение сохраняет копию строк в элементе управления "дерево-представление", можно уменьшить требования к памяти элемента управления, указав \_ значение LPSTR тексткаллбакк в элементе **псзтекст** [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) вместо передачи фактических строк в представление в виде дерева.</span><span class="sxs-lookup"><span data-stu-id="5e666-179">If your application maintains a copy of the strings in the tree-view control, you can decrease the memory requirements of the control by specifying the LPSTR\_TEXTCALLBACK value in the **pszText** member of [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) instead of passing actual strings to the tree view.</span></span> <span data-ttu-id="5e666-180">Использование LPSTR \_ тексткаллбакк приводит к тому, что элемент управления "представление дерева" получает текст метки элемента из родительского окна каждый раз, когда необходимо перерисовать элемент.</span><span class="sxs-lookup"><span data-stu-id="5e666-180">Using LPSTR\_TEXTCALLBACK causes the tree-view control to retrieve the text of an item's label from the parent window whenever the item needs to be redrawn.</span></span> <span data-ttu-id="5e666-181">Чтобы получить текст, элемент управления "представление дерева" отправляет сообщение уведомления [ТВН \_ жетдиспинфо](tvn-getdispinfo.md) , которое включает адрес структуры [**нмтвдиспинфо**](/windows/win32/api/commctrl/ns-commctrl-nmtvdispinfoa) .</span><span class="sxs-lookup"><span data-stu-id="5e666-181">To retrieve the text, the tree-view control sends a [TVN\_GETDISPINFO](tvn-getdispinfo.md) notification message, which includes the address of an [**NMTVDISPINFO**](/windows/win32/api/commctrl/ns-commctrl-nmtvdispinfoa) structure.</span></span> <span data-ttu-id="5e666-182">Родительское окно должно заполнить соответствующие члены включаемой структуры.</span><span class="sxs-lookup"><span data-stu-id="5e666-182">The parent window must fill the appropriate members of the included structure.</span></span>

## <a name="tree-view-label-editing"></a><span data-ttu-id="5e666-183">Изменение меток Tree-View</span><span class="sxs-lookup"><span data-stu-id="5e666-183">Tree-View Label Editing</span></span>

<span data-ttu-id="5e666-184">Пользователь может непосредственно изменять метки элементов в элементе управления "дерево", имеющем стиль [**\_ едитлабелс**](tree-view-control-window-styles.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-184">The user can directly edit the labels of items in a tree-view control that has the [**TVS\_EDITLABELS**](tree-view-control-window-styles.md) style.</span></span> <span data-ttu-id="5e666-185">Пользователь начинает редактирование, щелкая метку элемента, который находится в фокусе.</span><span class="sxs-lookup"><span data-stu-id="5e666-185">The user begins editing by clicking the label of the item that has the focus.</span></span> <span data-ttu-id="5e666-186">Приложение начинает редактирование с помощью сообщения [**TVM \_ едитлабел**](tvm-editlabel.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-186">An application begins editing by using the [**TVM\_EDITLABEL**](tvm-editlabel.md) message.</span></span> <span data-ttu-id="5e666-187">Элемент управления просмотром дерева уведомляет родительское окно при начале редактирования, а также при его отмене или завершении.</span><span class="sxs-lookup"><span data-stu-id="5e666-187">The tree-view control notifies the parent window when editing begins and when it is canceled or completed.</span></span> <span data-ttu-id="5e666-188">По завершении редактирования родительское окно отвечает за обновление метки элемента, если это уместно.</span><span class="sxs-lookup"><span data-stu-id="5e666-188">When editing is completed, the parent window is responsible for updating the item's label, if appropriate.</span></span>

<span data-ttu-id="5e666-189">Когда начинается редактирование метки, элемент управления "представление дерева" отправляет свое родительское окно сообщение уведомления [ТВН \_ бегинлабеледит](tvn-beginlabeledit.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-189">When label editing begins, a tree-view control sends its parent window a [TVN\_BEGINLABELEDIT](tvn-beginlabeledit.md) notification message.</span></span> <span data-ttu-id="5e666-190">Обрабатывая это уведомление, приложение может разрешить редактирование некоторых меток и запретить редактирование других.</span><span class="sxs-lookup"><span data-stu-id="5e666-190">By processing this notification, an application can allow editing of some labels and prevent editing of others.</span></span> <span data-ttu-id="5e666-191">Возврат нуля позволяет изменять и возвращать ненулевой запрет.</span><span class="sxs-lookup"><span data-stu-id="5e666-191">Returning zero allows editing, and returning nonzero prevents it.</span></span>

<span data-ttu-id="5e666-192">Когда изменение метки отменено или завершено, элемент управления "представление дерева" отправляет свое родительское окно сообщение уведомления [ТВН \_ ендлабеледит](tvn-endlabeledit.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-192">When label editing is canceled or completed, a tree-view control sends its parent window a [TVN\_ENDLABELEDIT](tvn-endlabeledit.md) notification message.</span></span> <span data-ttu-id="5e666-193">Параметр *lParam* является адресом структуры [**нмтвдиспинфо**](/windows/win32/api/commctrl/ns-commctrl-nmtvdispinfoa) .</span><span class="sxs-lookup"><span data-stu-id="5e666-193">The *lParam* parameter is the address of an [**NMTVDISPINFO**](/windows/win32/api/commctrl/ns-commctrl-nmtvdispinfoa) structure.</span></span> <span data-ttu-id="5e666-194">Параметр *Item* представляет собой структуру [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) , определяющую элемент и включающую редактируемый текст.</span><span class="sxs-lookup"><span data-stu-id="5e666-194">The *item* parameter is a [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) structure that identifies the item and includes the edited text.</span></span> <span data-ttu-id="5e666-195">Родительское окно отвечает за обновление метки элемента, если требуется разместить новую метку.</span><span class="sxs-lookup"><span data-stu-id="5e666-195">The parent window is responsible for updating the item's label if it wishes to keep the new label.</span></span> <span data-ttu-id="5e666-196">Элемент **псзтекст** объекта **твитем** равен нулю, если редактирование отменено.</span><span class="sxs-lookup"><span data-stu-id="5e666-196">The **pszText** member of **TVITEM** is zero if editing is canceled.</span></span>

<span data-ttu-id="5e666-197">Во время редактирования метки, как правило, в ответ на сообщение уведомления [ТВН \_ бегинлабеледит](tvn-beginlabeledit.md) , можно получить маркер элемента управления редактирования, используемого для редактирования меток, с помощью сообщения [**TVM \_ жетедитконтрол**](tvm-geteditcontrol.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-197">During label editing, typically in response to the [TVN\_BEGINLABELEDIT](tvn-beginlabeledit.md) notification message, you can retrieve the handle to the edit control used for label editing by using the [**TVM\_GETEDITCONTROL**](tvm-geteditcontrol.md) message.</span></span> <span data-ttu-id="5e666-198">Вы можете отправить сообщение с элементом управления [**Edit \_ сетлимиттекст**](em-setlimittext.md) , чтобы ограничить объем текста, который пользователь может ввести или создать подкласс элемента управления "поле ввода" для перехвата и удаления недопустимых символов.</span><span class="sxs-lookup"><span data-stu-id="5e666-198">You can send the edit control an [**EM\_SETLIMITTEXT**](em-setlimittext.md) message to limit the amount of text a user can enter or subclass the edit control to intercept and discard invalid characters.</span></span> <span data-ttu-id="5e666-199">Однако обратите внимание, что элемент управления "поле ввода" отображается только *после*   \_ отправки ТВН бегинлабеледит.</span><span class="sxs-lookup"><span data-stu-id="5e666-199">Note, however, that the edit control is displayed only *after* TVN\_BEGINLABELEDIT is sent.</span></span>

## <a name="tree-view-item-position"></a><span data-ttu-id="5e666-200">Позиция Tree-View элемента</span><span class="sxs-lookup"><span data-stu-id="5e666-200">Tree-View Item Position</span></span>

<span data-ttu-id="5e666-201">Начальная позиция элемента задается при добавлении элемента в элемент управления "дерево" с помощью сообщения [**\_ INSERTITEM TVM**](tvm-insertitem.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-201">An item's initial position is set when the item is added to the tree-view control by using the [**TVM\_INSERTITEM**](tvm-insertitem.md) message.</span></span> <span data-ttu-id="5e666-202">Сообщение содержит структуру [**твинсертструкт**](/windows/win32/api/commctrl/ns-commctrl-tvinsertstructa) , указывающую маркер родительского элемента, и маркер элемента, после которого вставляется новый элемент.</span><span class="sxs-lookup"><span data-stu-id="5e666-202">The message includes a [**TVINSERTSTRUCT**](/windows/win32/api/commctrl/ns-commctrl-tvinsertstructa) structure that specifies the handle to the parent item and the handle to the item after which the new item is to be inserted.</span></span> <span data-ttu-id="5e666-203">Второй маркер должен обозначать либо дочерний элемент данного родителя, либо одно из следующих значений: Тви \_ First, Тви \_ Last или Тви \_ Sort.</span><span class="sxs-lookup"><span data-stu-id="5e666-203">The second handle must identify either a child item of the given parent or one of these values: TVI\_FIRST, TVI\_LAST, or TVI\_SORT.</span></span>

<span data-ttu-id="5e666-204">Если указан параметр Тви \_ First или Тви \_ Last, элемент управления "представление дерева" помещает новый элемент в начало или в конец данного списка дочерних элементов родительского элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-204">When TVI\_FIRST or TVI\_LAST is specified, the tree-view control places the new item at the beginning or end of the given parent item's list of child items.</span></span> <span data-ttu-id="5e666-205">Если указан параметр Тви \_ Sort, элемент управления "представление дерева" вставляет новый элемент в список дочерних элементов в алфавитном порядке в зависимости от текста меток элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-205">When TVI\_SORT is specified, the tree-view control inserts the new item into the list of child items in alphabetical order based on the text of the item labels.</span></span>

<span data-ttu-id="5e666-206">Вы можете вставить список дочерних элементов родительского элемента в алфавитном порядке, используя сообщение [**TVM \_ сортчилдрен**](tvm-sortchildren.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-206">You can put a parent item's list of child items in alphabetical order by using the [**TVM\_SORTCHILDREN**](tvm-sortchildren.md) message.</span></span> <span data-ttu-id="5e666-207">Сообщение содержит параметр, указывающий, сортируются ли все уровни дочерних элементов в порядке убывания из заданного родительского элемента в алфавитном порядке.</span><span class="sxs-lookup"><span data-stu-id="5e666-207">The message includes a parameter that specifies whether all levels of child items descending from the given parent item are also sorted in alphabetical order.</span></span>

<span data-ttu-id="5e666-208">Сообщение [**TVM \_ сортчилдренкб**](tvm-sortchildrencb.md) позволяет сортировать дочерние элементы на основе заданных критериев.</span><span class="sxs-lookup"><span data-stu-id="5e666-208">The [**TVM\_SORTCHILDRENCB**](tvm-sortchildrencb.md) message allows you to sort child items based on criteria that you define.</span></span> <span data-ttu-id="5e666-209">При использовании этого сообщения вы указываете функцию обратного вызова, определяемую приложением, которую элемент управления "дерево" может вызывать каждый раз, когда необходимо выбрать относительный порядок двух дочерних элементов.</span><span class="sxs-lookup"><span data-stu-id="5e666-209">When you use this message, you specify an application-defined callback function that the tree-view control can call whenever the relative order of two child items needs to be decided.</span></span> <span data-ttu-id="5e666-210">Функция обратного вызова получает 2 32-разрядные значения, определяемые приложением, для сравниваемых элементов и третье 32-разрядное значение, указанное при отправке **TVM \_ сортчилдренкб**.</span><span class="sxs-lookup"><span data-stu-id="5e666-210">The callback function receives two 32-bit application-defined values for the items being compared and a third 32-bit value that you specify when sending **TVM\_SORTCHILDRENCB**.</span></span>

## <a name="tree-view-item-states-overview"></a><span data-ttu-id="5e666-211">Общие сведения о состояниях элементов Tree-View</span><span class="sxs-lookup"><span data-stu-id="5e666-211">Tree-View Item States Overview</span></span>

<span data-ttu-id="5e666-212">Каждый элемент в элементе управления иерархического представления имеет текущее состояние.</span><span class="sxs-lookup"><span data-stu-id="5e666-212">Each item in a tree-view control has a current state.</span></span> <span data-ttu-id="5e666-213">Сведения о состоянии для каждого элемента включают набор битовых флагов, а также индексы списка изображений, которые указывают изображение состояния элемента и изображение оверлея.</span><span class="sxs-lookup"><span data-stu-id="5e666-213">The state information for each item includes a set of bit flags as well as image list indexes that indicate the item's state image and overlay image.</span></span> <span data-ttu-id="5e666-214">Битовые флаги указывают, что элемент выбран, отключен, развернут и т. д.</span><span class="sxs-lookup"><span data-stu-id="5e666-214">The bit flags indicate whether the item is selected, disabled, expanded, and so on.</span></span> <span data-ttu-id="5e666-215">В большинстве случаев элемент управления "представление в виде дерева" автоматически задает состояние элемента для отражения действий пользователя, таких как выборка элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-215">For the most part, a tree-view control automatically sets an item's state to reflect user actions, such as selection of an item.</span></span> <span data-ttu-id="5e666-216">Тем не менее можно также задать состояние элемента с помощью сообщения [**TVM \_ сетитем**](tvm-setitem.md) , а также получить текущее состояние элемента с помощью сообщения о [**\_ дозаписи TVM**](tvm-getitem.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-216">However, you can also set an item's state by using the [**TVM\_SETITEM**](tvm-setitem.md) message, and you can retrieve the current state of an item by using the [**TVM\_GETITEM**](tvm-getitem.md) message.</span></span> <span data-ttu-id="5e666-217">Полный список состояний элементов см. в разделе [дерево-представление элементов управления](tree-view-control-item-states.md).</span><span class="sxs-lookup"><span data-stu-id="5e666-217">For a complete list of item states, see [Tree-View Control Item States](tree-view-control-item-states.md).</span></span>

<span data-ttu-id="5e666-218">Текущее состояние элемента задается элементом **State** структуры [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) .</span><span class="sxs-lookup"><span data-stu-id="5e666-218">An item's current state is specified by the **state** member of the [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) structure.</span></span> <span data-ttu-id="5e666-219">Элемент управления "представление дерева" может изменить состояние элемента в соответствии с действиями пользователя, например выбрать элемент или установить фокус на элемент.</span><span class="sxs-lookup"><span data-stu-id="5e666-219">A tree-view control might change an item's state to reflect a user action, such as selecting the item or setting the focus to the item.</span></span> <span data-ttu-id="5e666-220">Кроме того, приложение может изменить состояние элемента, чтобы отключить или скрыть элемент или указать изображение оверлея или изображение состояния.</span><span class="sxs-lookup"><span data-stu-id="5e666-220">In addition, an application might change an item's state to disable or hide the item or to specify an overlay image or state image.</span></span>

<span data-ttu-id="5e666-221">При указании или изменении состояния элемента элемент **статемаск** элемента [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) указывает, какие биты состояния задаются, а элемент **State** содержит новые значения для этих битов.</span><span class="sxs-lookup"><span data-stu-id="5e666-221">When you specify or change an item's state, the **statemask** member of [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) specifies which state bits to set, and the **state** member contains the new values for those bits.</span></span>

<span data-ttu-id="5e666-222">Чтобы задать изображение оверлея элемента, **статемаск** должно включать значение [**ТВИС \_ оверлаймаск**](tree-view-control-item-states.md) , а **State** должно включать Отсчитываемый от единицы индекс перекрытия изображения, смещенный влево 8 бит, с помощью макроса [**индекстуверлаймаск**](/windows/desktop/api/Commctrl/nf-commctrl-indextooverlaymask) .</span><span class="sxs-lookup"><span data-stu-id="5e666-222">To set an item's overlay image, **statemask** must include the [**TVIS\_OVERLAYMASK**](tree-view-control-item-states.md) value, and **state** must include the one-based index of the overlay image shifted left 8 bits by using the [**INDEXTOOVERLAYMASK**](/windows/desktop/api/Commctrl/nf-commctrl-indextooverlaymask) macro.</span></span> <span data-ttu-id="5e666-223">Индекс может быть равен нулю, чтобы не указывать изображение оверлея.</span><span class="sxs-lookup"><span data-stu-id="5e666-223">The index can be zero to specify no overlay image.</span></span>

<span data-ttu-id="5e666-224">Изображение состояния отображается рядом со значком элемента для указания на определенное приложением состояние.</span><span class="sxs-lookup"><span data-stu-id="5e666-224">A state image is displayed next to an item's icon to indicate an application-defined state.</span></span> <span data-ttu-id="5e666-225">Изображения состояния содержатся в *списке изображений состояний* , который указывается путем отправки сообщения [**\_ сетимажелист TVM**](tvm-setimagelist.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-225">State images are contained in a *state image list* that is specified by sending a [**TVM\_SETIMAGELIST**](tvm-setimagelist.md) message.</span></span> <span data-ttu-id="5e666-226">Чтобы задать изображение состояния элемента, включите значение [**ТВИС \_ статеимажемаск**](tree-view-control-item-states.md) в элемент **статемаск** структуры [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) .</span><span class="sxs-lookup"><span data-stu-id="5e666-226">To set an item's state image, include the [**TVIS\_STATEIMAGEMASK**](tree-view-control-item-states.md) value in the **statemask** member of the [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) structure.</span></span> <span data-ttu-id="5e666-227">В битах с 12 по 15 элемента **состояния** структуры указывается индекс в списке изображений состояния изображения для прорисовки.</span><span class="sxs-lookup"><span data-stu-id="5e666-227">Bits 12 through 15 of the structure's **state** member specify the index in the state image list of the image to be drawn.</span></span>

<span data-ttu-id="5e666-228">Чтобы задать индекс изображения состояния, используйте [**индекстостатеимажемаск**](/windows/desktop/api/Commctrl/nf-commctrl-indextostateimagemask).</span><span class="sxs-lookup"><span data-stu-id="5e666-228">To set the state image index, use [**INDEXTOSTATEIMAGEMASK**](/windows/desktop/api/Commctrl/nf-commctrl-indextostateimagemask).</span></span> <span data-ttu-id="5e666-229">Этот макрос принимает индекс и устанавливает биты 12 – 15 соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="5e666-229">This macro takes an index, and sets bits 12 through 15 appropriately.</span></span> <span data-ttu-id="5e666-230">Чтобы указать, что элемент не имеет изображения состояния, установите нулевое значение индекса.</span><span class="sxs-lookup"><span data-stu-id="5e666-230">To indicate that the item has no state image, set the index to zero.</span></span> <span data-ttu-id="5e666-231">Это означает, что нулевой образ в списке изображений состояния нельзя использовать в качестве изображения состояния.</span><span class="sxs-lookup"><span data-stu-id="5e666-231">This convention means that image zero in the state image list cannot be used as a state image.</span></span> <span data-ttu-id="5e666-232">Чтобы изолировать BITS 12 – 15 от члена **состояния** , используйте маску [**ТВИС \_ статеимажемаск**](tree-view-control-item-states.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-232">To isolate bits 12 through 15 of the **state** member, use the [**TVIS\_STATEIMAGEMASK**](tree-view-control-item-states.md) mask.</span></span> <span data-ttu-id="5e666-233">Дополнительные сведения о наложении и образах состояний см. в разделе [древовидное представление списков изображений](#tree-view-image-lists).</span><span class="sxs-lookup"><span data-stu-id="5e666-233">For more information about overlay and state images, see [Tree-View Image Lists](#tree-view-image-lists).</span></span>

## <a name="item-selection"></a><span data-ttu-id="5e666-234">Выбор элементов</span><span class="sxs-lookup"><span data-stu-id="5e666-234">Item Selection</span></span>

<span data-ttu-id="5e666-235">Элемент управления представлением в виде дерева уведомляет родительское окно о том, что при изменении выбора с одного элемента на другой отправляются сообщения уведомления [ТВН \_ Селчангинг](tvn-selchanging.md) и [ТВН \_ селчанжед](tvn-selchanged.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-235">A tree-view control notifies the parent window when the selection changes from one item to another by sending the [TVN\_SELCHANGING](tvn-selchanging.md) and [TVN\_SELCHANGED](tvn-selchanged.md) notification messages.</span></span> <span data-ttu-id="5e666-236">Оба уведомления включают значение, указывающее, является ли изменение результатом щелчка мыши или нажатия клавиши.</span><span class="sxs-lookup"><span data-stu-id="5e666-236">Both notifications include a value that specifies whether the change is the result of a mouse click or a keystroke.</span></span> <span data-ttu-id="5e666-237">Уведомления также содержат сведения об элементе, который получает выделение, и элементе, который теряет выделение.</span><span class="sxs-lookup"><span data-stu-id="5e666-237">The notifications also include information about the item that is gaining the selection and the item that is losing the selection.</span></span> <span data-ttu-id="5e666-238">Эти сведения можно использовать для задания атрибутов элементов, зависящих от состояния выбора элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-238">You can use this information to set item attributes that depend on the selection state of the item.</span></span> <span data-ttu-id="5e666-239">При возврате значения **true** в ответ на ТВН \_ селчангинг предотвращает изменение выбора, а возврат значения **false** позволяет изменить.</span><span class="sxs-lookup"><span data-stu-id="5e666-239">Returning **TRUE** in response to TVN\_SELCHANGING prevents the selection from changing, and returning **FALSE** allows the change.</span></span>

<span data-ttu-id="5e666-240">Приложение может изменить выбор, отправив сообщение [**TVM \_ селектитем**](tvm-selectitem.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-240">An application can change the selection by sending the [**TVM\_SELECTITEM**](tvm-selectitem.md) message.</span></span>

## <a name="item-information"></a><span data-ttu-id="5e666-241">Сведения об элементе</span><span class="sxs-lookup"><span data-stu-id="5e666-241">Item Information</span></span>

<span data-ttu-id="5e666-242">Элементы управления "дерево-представление" поддерживают ряд сообщений, которые извлекают сведения об элементах в элементе управления.</span><span class="sxs-lookup"><span data-stu-id="5e666-242">Tree-view controls support a number of messages that retrieve information about items in the control.</span></span>

<span data-ttu-id="5e666-243">Сообщение [**TVM \_ доitem**](tvm-getitem.md) может извлекать маркеры и атрибуты элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-243">The [**TVM\_GETITEM**](tvm-getitem.md) message can retrieve an item's handle and attributes.</span></span> <span data-ttu-id="5e666-244">Атрибуты элемента включают в себя его текущее состояние, индексы в списке изображений элемента управления для выбранных и невыбранных растровых изображений, флаг, указывающий, имеет ли элемент дочерние элементы, адрес строки метки элемента и определяемое приложением 32-разрядное значение.</span><span class="sxs-lookup"><span data-stu-id="5e666-244">An item's attributes include its current state, the indexes in the control's image list of the item's selected and nonselected bitmapped images, a flag that indicates whether the item has child items, the address of the item's label string, and the item's application-defined 32-bit value.</span></span>

<span data-ttu-id="5e666-245">Сообщение [**TVM \_ жетнекститем**](tvm-getnextitem.md) извлекает элемент дерева-представления, который несет указанную связь с текущим элементом.</span><span class="sxs-lookup"><span data-stu-id="5e666-245">The [**TVM\_GETNEXTITEM**](tvm-getnextitem.md) message retrieves the tree-view item that bears the specified relationship to the current item.</span></span> <span data-ttu-id="5e666-246">Сообщение может получить родительский элемент, следующий или предыдущий видимый элемент, первый дочерний элемент и т. д.</span><span class="sxs-lookup"><span data-stu-id="5e666-246">The message can retrieve an item's parent, the next or previous visible item, the first child item, and so on.</span></span>

<span data-ttu-id="5e666-247">Сообщение [**TVM \_ жетитемрект**](tvm-getitemrect.md) извлекает ограничивающий прямоугольник для элемента представления дерева.</span><span class="sxs-lookup"><span data-stu-id="5e666-247">The [**TVM\_GETITEMRECT**](tvm-getitemrect.md) message retrieves the bounding rectangle for a tree-view item.</span></span> <span data-ttu-id="5e666-248">Сообщения [**TVM \_ NOCOUNT**](tvm-getcount.md) и [**TVM \_ жетвисиблекаунт**](tvm-getvisiblecount.md) извлекают количество элементов в элементе управления "дерево-представление" и число элементов, которые могут быть полностью видны в окне элемента управления "дерево-представление" соответственно.</span><span class="sxs-lookup"><span data-stu-id="5e666-248">The [**TVM\_GETCOUNT**](tvm-getcount.md) and [**TVM\_GETVISIBLECOUNT**](tvm-getvisiblecount.md) messages retrieve a count of the items in a tree-view control and a count of the items that can be fully visible in the tree-view control's window, respectively.</span></span> <span data-ttu-id="5e666-249">Вы можете убедиться, что конкретный элемент виден с помощью сообщения [**TVM \_ енсуревисибле**](tvm-ensurevisible.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-249">You can ensure that a particular item is visible by using the [**TVM\_ENSUREVISIBLE**](tvm-ensurevisible.md) message.</span></span>

## <a name="tree-view-image-lists"></a><span data-ttu-id="5e666-250">Tree-View списки изображений</span><span class="sxs-lookup"><span data-stu-id="5e666-250">Tree-View Image Lists</span></span>

<span data-ttu-id="5e666-251">Каждый элемент в элементе управления "дерево" может связываться с четырьмя изображениями с точечным рисунком.</span><span class="sxs-lookup"><span data-stu-id="5e666-251">Each item in a tree-view control can have four bitmapped images associated with it.</span></span>

-   <span data-ttu-id="5e666-252">Изображение, например открытая папка, отображаемое при выборе элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-252">An image, such as an open folder, displayed when the item is selected.</span></span>
-   <span data-ttu-id="5e666-253">Изображение, например закрытая папка, отображаемое, если элемент не выбран.</span><span class="sxs-lookup"><span data-stu-id="5e666-253">An image, such as a closed folder, displayed when the item is not selected.</span></span>
-   <span data-ttu-id="5e666-254">Изображение оверлея, которое прозрачно рисуется над выбранным или невыбранным изображением.</span><span class="sxs-lookup"><span data-stu-id="5e666-254">An overlay image that is drawn transparently over the selected or nonselected image.</span></span>
-   <span data-ttu-id="5e666-255">Изображение состояния, которое является дополнительным изображением, отображаемым слева от выбранного или невыделенного изображения.</span><span class="sxs-lookup"><span data-stu-id="5e666-255">A state image, which is an additional image displayed to the left of the selected or nonselected image.</span></span> <span data-ttu-id="5e666-256">Для обозначения состояний элементов, определенных приложением, можно использовать изображения состояний, например флажки установлен и снят.</span><span class="sxs-lookup"><span data-stu-id="5e666-256">You can use state images, such as checked and cleared check boxes, to indicate application-defined item states.</span></span>

<span data-ttu-id="5e666-257">По умолчанию элемент управления "представление дерева" не отображает изображения элементов.</span><span class="sxs-lookup"><span data-stu-id="5e666-257">By default, a tree-view control does not display item images.</span></span> <span data-ttu-id="5e666-258">Чтобы отобразить изображения элементов, необходимо создать списки изображений и связать их с элементом управления.</span><span class="sxs-lookup"><span data-stu-id="5e666-258">To display item images, you must create image lists and associate them with the control.</span></span> <span data-ttu-id="5e666-259">Дополнительные сведения о списках изображений см. в разделе [Image Lists](image-lists.md).</span><span class="sxs-lookup"><span data-stu-id="5e666-259">For more information about image lists, see [Image Lists](image-lists.md).</span></span>

<span data-ttu-id="5e666-260">Элемент управления "дерево" может иметь два списка изображений: нормальный список изображений и список изображений состояния.</span><span class="sxs-lookup"><span data-stu-id="5e666-260">A tree-view control can have two image lists: a normal image list and a state image list.</span></span> <span data-ttu-id="5e666-261">В стандартном списке изображений хранятся выбранные, невыбранные изображения и наложения.</span><span class="sxs-lookup"><span data-stu-id="5e666-261">A normal image list stores the selected, nonselected, and overlay images.</span></span> <span data-ttu-id="5e666-262">В списке изображений состояний хранятся образы состояний.</span><span class="sxs-lookup"><span data-stu-id="5e666-262">A state image list stores state images.</span></span> <span data-ttu-id="5e666-263">Используйте функцию [**ImageList \_ CREATE**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_create) для создания списка изображений и используйте другие функции списка изображений для добавления точечных рисунков в список изображений.</span><span class="sxs-lookup"><span data-stu-id="5e666-263">Use the [**ImageList\_Create**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_create) function to create an image list, and use other image list functions to add bitmaps to the image list.</span></span> <span data-ttu-id="5e666-264">Затем, чтобы связать список изображений с элементом управления "дерево-представление", используйте сообщение [**TVM \_ сетимажелист**](tvm-setimagelist.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-264">Then, to associate the image list with the tree-view control, use the [**TVM\_SETIMAGELIST**](tvm-setimagelist.md) message.</span></span> <span data-ttu-id="5e666-265">Сообщение [**TVM- \_ ImageList**](tvm-getimagelist.md) Извлекает маркер одного из списков изображений элемента управления представления в виде дерева.</span><span class="sxs-lookup"><span data-stu-id="5e666-265">The [**TVM\_GETIMAGELIST**](tvm-getimagelist.md) message retrieves a handle to one of a tree-view control's image lists.</span></span> <span data-ttu-id="5e666-266">Это сообщение полезно, если необходимо добавить дополнительные изображения в список.</span><span class="sxs-lookup"><span data-stu-id="5e666-266">This message is useful if you need to add more images to the list.</span></span>

<span data-ttu-id="5e666-267">В дополнение к выбранным и невыбранным изображениям список обычных изображений элемента управления "дерево" может содержать до четырех изображений оверлея.</span><span class="sxs-lookup"><span data-stu-id="5e666-267">In addition to the selected and nonselected images, a tree-view control's normal image list can contain up to four overlay images.</span></span> <span data-ttu-id="5e666-268">Изображения наложения идентифицируются с помощью индекса, основанного на единицах, и предназначены для прозрачного рисования на выбранных и невыбранных изображениях.</span><span class="sxs-lookup"><span data-stu-id="5e666-268">Overlay images are identified by a one-based index and are designed to be drawn transparently over the selected and nonselected images.</span></span> <span data-ttu-id="5e666-269">Чтобы назначить изображение маски оверлея изображению в списке обычного изображения, вызовите функцию [**ImageList \_ сетоверлайимаже**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_setoverlayimage) .</span><span class="sxs-lookup"><span data-stu-id="5e666-269">To assign an overlay mask index to an image in the normal image list, call the [**ImageList\_SetOverlayImage**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_setoverlayimage) function.</span></span>

<span data-ttu-id="5e666-270">По умолчанию все элементы отображают первое изображение в списке обычные изображения для выбранных и невыбранных состояний.</span><span class="sxs-lookup"><span data-stu-id="5e666-270">By default, all items display the first image in the normal image list for both the selected and nonselected states.</span></span> <span data-ttu-id="5e666-271">Кроме того, по умолчанию элементы не отображают изображения наложения или изображения состояния.</span><span class="sxs-lookup"><span data-stu-id="5e666-271">Also, by default, items do not display overlay images or state images.</span></span> <span data-ttu-id="5e666-272">Вы можете изменить поведение по умолчанию для элемента, отправив сообщение [**TVM \_ INSERTITEM**](tvm-insertitem.md) или [**TVM \_ сетитем**](tvm-setitem.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-272">You can change these default behaviors for an item by sending the [**TVM\_INSERTITEM**](tvm-insertitem.md) or [**TVM\_SETITEM**](tvm-setitem.md) message.</span></span> <span data-ttu-id="5e666-273">Эти сообщения используют структуру [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) для указания индексов списка изображений для элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-273">These messages use the [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) structure to specify image list indexes for an item.</span></span>

<span data-ttu-id="5e666-274">Чтобы указать выбранные и невыбранные изображения элемента, задайте \_ биты изображения твиф селектедимаже и твиф в элементе \_ **Mask** структуры [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) и укажите индексы из списка обычных изображений элемента управления в члене **иселектимаже** и **иимаже** .</span><span class="sxs-lookup"><span data-stu-id="5e666-274">To specify an item's selected and nonselected images, set the TVIF\_SELECTEDIMAGE and TVIF\_IMAGE bits in the **mask** member of the [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) structure and specify indexes from the control's normal image list in the **iSelectImage** and **iImage** members.</span></span> <span data-ttu-id="5e666-275">Кроме того, можно указать значение I \_ имажекаллбакк в **Иселектимаже** и **иимаже** вместо указания индексов.</span><span class="sxs-lookup"><span data-stu-id="5e666-275">Alternatively, you can specify the I\_IMAGECALLBACK value in **iSelectImage** and **iImage** instead of specifying indexes.</span></span> <span data-ttu-id="5e666-276">Это приводит к тому, что элемент управления запрашивает у родительского окна индекс списка изображений при каждом перерисовке элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-276">This causes the control to query its parent window for an image list index each time the item is about to be redrawn.</span></span> <span data-ttu-id="5e666-277">Элемент управления отправляет сообщение уведомления [ТВН \_ жетдиспинфо](tvn-getdispinfo.md) для получения индекса.</span><span class="sxs-lookup"><span data-stu-id="5e666-277">The control sends the [TVN\_GETDISPINFO](tvn-getdispinfo.md) notification message to retrieve the index.</span></span>

<span data-ttu-id="5e666-278">Чтобы связать изображение оверлея с элементом, используйте макрос [**индекстуверлаймаск**](/windows/desktop/api/Commctrl/nf-commctrl-indextooverlaymask) , чтобы указать индекс маски оверлея в элементе **State** структуры [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-278">To associate an overlay image with an item, use the [**INDEXTOOVERLAYMASK**](/windows/desktop/api/Commctrl/nf-commctrl-indextooverlaymask) macro to specify an overlay mask index in the **state** member of the item's [**TVITEM**](/windows/win32/api/commctrl/ns-commctrl-tvitema) structure.</span></span> <span data-ttu-id="5e666-279">Необходимо также задать биты [**ТВИС \_ оверлаймаск**](tree-view-control-item-states.md) в элементе **статемаск** .</span><span class="sxs-lookup"><span data-stu-id="5e666-279">You must also set the [**TVIS\_OVERLAYMASK**](tree-view-control-item-states.md) bits in the **stateMask** member.</span></span> <span data-ttu-id="5e666-280">Индексы-маски наложения основаны на единицах; нулевой индекс означает, что изображение оверлея не указано.</span><span class="sxs-lookup"><span data-stu-id="5e666-280">Overlay mask indexes are one-based; an index of zero indicates that no overlay image was specified.</span></span>

<span data-ttu-id="5e666-281">Образы состояния хранятся в отдельном списке изображений состояний и определяются по их индексу.</span><span class="sxs-lookup"><span data-stu-id="5e666-281">State images are stored in a separate state image list and identified by their index.</span></span> <span data-ttu-id="5e666-282">Чтобы указать список изображений состояния, отправьте сообщение [**TVM \_ сетимажелист**](tvm-setimagelist.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-282">To specify the state image list, send a [**TVM\_SETIMAGELIST**](tvm-setimagelist.md) message.</span></span> <span data-ttu-id="5e666-283">В отличие от элемента управления "представление списка", использующего Отсчитываемый от единицы индекса для идентификации изображений состояния, изображения состояния элемента управления "дерево" определяются индексом, начинающимся с нуля.</span><span class="sxs-lookup"><span data-stu-id="5e666-283">Unlike the list-view control, which uses a one-based index to identify state images, tree-view control state images are identified by a zero-based index.</span></span> <span data-ttu-id="5e666-284">Однако нулевой индекс указывает, что элемент не имеет изображения состояния.</span><span class="sxs-lookup"><span data-stu-id="5e666-284">However, an index of zero indicates that the item does not have a state image.</span></span> <span data-ttu-id="5e666-285">Следовательно, нулевое изображение не может использоваться в качестве изображения состояния.</span><span class="sxs-lookup"><span data-stu-id="5e666-285">Consequently, image zero cannot be used as a state image.</span></span> <span data-ttu-id="5e666-286">Дополнительные сведения о состояниях элементов и образах состояний см. в статье [Обзор состояний элементов в виде дерева](#tree-view-item-states-overview).</span><span class="sxs-lookup"><span data-stu-id="5e666-286">For further discussion of item states and state images, see [Tree-View Item States Overview](#tree-view-item-states-overview).</span></span>

## <a name="drag-and-drop-operations"></a><span data-ttu-id="5e666-287">Операции перетаскивания</span><span class="sxs-lookup"><span data-stu-id="5e666-287">Drag-and-Drop Operations</span></span>

<span data-ttu-id="5e666-288">Элемент управления просмотром дерева уведомляет родительское окно, когда пользователь начинает перетаскивать элемент.</span><span class="sxs-lookup"><span data-stu-id="5e666-288">A tree-view control notifies the parent window when the user starts to drag an item.</span></span> <span data-ttu-id="5e666-289">Родительское окно получает сообщение уведомления [ТВН \_ бегиндраг](tvn-begindrag.md) , когда пользователь начинает перетаскивать элемент с помощью левой кнопки мыши и сообщения уведомления [ТВН \_ бегинрдраг](tvn-beginrdrag.md) , когда пользователь начинает перетаскивать с помощью правой кнопки мыши.</span><span class="sxs-lookup"><span data-stu-id="5e666-289">The parent window receives a [TVN\_BEGINDRAG](tvn-begindrag.md) notification message when the user begins dragging an item with the left mouse button and a [TVN\_BEGINRDRAG](tvn-beginrdrag.md) notification message when the user begins dragging with the right button.</span></span> <span data-ttu-id="5e666-290">Можно предотвратить отправку таких уведомлений элементом управления "дерево-представление", предоставив элемент управления "дерево" в стиле [**\_ дисабледрагдроп**](tree-view-control-window-styles.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-290">You can prevent a tree-view control from sending these notifications by giving the tree-view control the [**TVS\_DISABLEDRAGDROP**](tree-view-control-window-styles.md) style.</span></span>

<span data-ttu-id="5e666-291">Вы получаете изображение, которое будет отображаться во время операции перетаскивания с помощью сообщения [**TVM \_ креатедрагимаже**](tvm-createdragimage.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-291">You obtain an image to display during a drag operation by using the [**TVM\_CREATEDRAGIMAGE**](tvm-createdragimage.md) message.</span></span> <span data-ttu-id="5e666-292">Элемент управления "дерево" создает перетаскивание растрового изображения на основе метки перетаскиваемого элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-292">The tree-view control creates a dragging bitmap based on the label of the item being dragged.</span></span> <span data-ttu-id="5e666-293">Затем элемент управления "дерево" создает список изображений, добавляет к нему растровое изображение и возвращает этот маркер в список изображений.</span><span class="sxs-lookup"><span data-stu-id="5e666-293">Then the tree-view control creates an image list, adds the bitmap to it, and returns the handle to the image list.</span></span>

<span data-ttu-id="5e666-294">Необходимо указать код, который будет перетаскивать элемент.</span><span class="sxs-lookup"><span data-stu-id="5e666-294">You must provide the code that actually drags the item.</span></span> <span data-ttu-id="5e666-295">Обычно это касается использования возможностей перетаскивания в списке изображений и обработки сообщений [**WM \_ MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove) и [**WM \_ лбуттонуп**](/windows/desktop/inputdev/wm-lbuttonup) (или [**WM \_ рбуттонуп**](/windows/desktop/inputdev/wm-rbuttonup)), отправленных в родительское окно после начала операции перетаскивания.</span><span class="sxs-lookup"><span data-stu-id="5e666-295">This typically involves using the dragging capabilities of the image list functions and processing the [**WM\_MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove) and [**WM\_LBUTTONUP**](/windows/desktop/inputdev/wm-lbuttonup) (or [**WM\_RBUTTONUP**](/windows/desktop/inputdev/wm-rbuttonup)) messages sent to the parent window after the drag operation has begun.</span></span>

<span data-ttu-id="5e666-296">Если элементы в элементе управления "дерево" являются целевыми объектами операций перетаскивания, необходимо знать, когда указатель мыши находится на целевом элементе.</span><span class="sxs-lookup"><span data-stu-id="5e666-296">If items in a tree-view control are to be the targets of drag-and-drop operations, you need to know when the mouse pointer is on a target item.</span></span> <span data-ttu-id="5e666-297">Вы можете узнать с помощью сообщения [**TVM \_ HITTEST**](tvm-hittest.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-297">You can find out by using the [**TVM\_HITTEST**](tvm-hittest.md) message.</span></span> <span data-ttu-id="5e666-298">Вы указываете адрес структуры [**твхиттестинфо**](/windows/win32/api/commctrl/ns-commctrl-tvhittestinfo) , которая содержит текущие координаты указателя мыши.</span><span class="sxs-lookup"><span data-stu-id="5e666-298">You specify the address of a [**TVHITTESTINFO**](/windows/win32/api/commctrl/ns-commctrl-tvhittestinfo) structure that contains the current coordinates of the mouse pointer.</span></span> <span data-ttu-id="5e666-299">Когда функция [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage) возвращает, структура содержит флаг, указывающий расположение указателя мыши относительно элемента управления "дерево-представление".</span><span class="sxs-lookup"><span data-stu-id="5e666-299">When the [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage) function returns, the structure contains a flag indicating the location of the mouse pointer relative to the tree-view control.</span></span> <span data-ttu-id="5e666-300">Если указатель находится над элементом в элементе управления "дерево-представление", структура также содержит этот маркер элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-300">If the pointer is over an item in the tree-view control, the structure contains the handle to the item as well.</span></span>

<span data-ttu-id="5e666-301">Можно указать, что элемент является целевым объектом операции перетаскивания с помощью сообщения [**TVM \_ сетитем**](tvm-setitem.md) , чтобы установить для состояния значение [**ТВИС \_ дрофилитед**](tree-view-control-item-states.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-301">You can indicate that an item is the target of a drag-and-drop operation by using the [**TVM\_SETITEM**](tvm-setitem.md) message to set the state to the [**TVIS\_DROPHILITED**](tree-view-control-item-states.md) value.</span></span> <span data-ttu-id="5e666-302">Элемент с этим состоянием рисуется в стиле, который указывает на цель перетаскивания.</span><span class="sxs-lookup"><span data-stu-id="5e666-302">An item that has this state is drawn in the style used to indicate a drag-and-drop target.</span></span>

## <a name="tree-view-control-notification-messages"></a><span data-ttu-id="5e666-303">Tree-View контрольных сообщений</span><span class="sxs-lookup"><span data-stu-id="5e666-303">Tree-View Control Notification Messages</span></span>

<span data-ttu-id="5e666-304">Элемент управления "представление в виде дерева" отправляет следующие сообщения уведомления родительскому окну в форме [**\_ уведомлений WM**](wm-notify.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-304">A tree-view control sends the following notification messages to its parent window in the form of [**WM\_NOTIFY**](wm-notify.md) messages.</span></span>



| <span data-ttu-id="5e666-305">Уведомление</span><span class="sxs-lookup"><span data-stu-id="5e666-305">Notification</span></span>                                    | <span data-ttu-id="5e666-306">Описание</span><span class="sxs-lookup"><span data-stu-id="5e666-306">Description</span></span>                                                                            |
|-------------------------------------------------|----------------------------------------------------------------------------------------|
| [<span data-ttu-id="5e666-307">ТВН \_ бегиндраг</span><span class="sxs-lookup"><span data-stu-id="5e666-307">TVN\_BEGINDRAG</span></span>](tvn-begindrag.md)             | <span data-ttu-id="5e666-308">Сигнализирует о начале операции перетаскивания.</span><span class="sxs-lookup"><span data-stu-id="5e666-308">Signals the start of a drag-and-drop operation.</span></span>                                        |
| <span data-ttu-id="5e666-309">[ТВН \_ бегинлабеледит](tvn-beginlabeledit.md)  </span><span class="sxs-lookup"><span data-stu-id="5e666-309">[TVN\_BEGINLABELEDIT](tvn-beginlabeledit.md)  </span></span> | <span data-ttu-id="5e666-310">Сигнализирует начало редактирования метки на месте.</span><span class="sxs-lookup"><span data-stu-id="5e666-310">Signals the start of in-place label editing.</span></span>                                           |
| [<span data-ttu-id="5e666-311">ТВН \_ бегинрдраг</span><span class="sxs-lookup"><span data-stu-id="5e666-311">TVN\_BEGINRDRAG</span></span>](tvn-beginrdrag.md)           | <span data-ttu-id="5e666-312">Сигнализирует, что при нажатии правой кнопки мыши была запущена операция перетаскивания.</span><span class="sxs-lookup"><span data-stu-id="5e666-312">Signals that the right mouse button has started a drag-and-drop operation.</span></span>             |
| [<span data-ttu-id="5e666-313">ТВН \_ DELETEITEM</span><span class="sxs-lookup"><span data-stu-id="5e666-313">TVN\_DELETEITEM</span></span>](tvn-deleteitem.md)           | <span data-ttu-id="5e666-314">Сообщает об удалении определенного элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-314">Signals the deletion of a specific item.</span></span>                                               |
| [<span data-ttu-id="5e666-315">ТВН \_ ендлабеледит</span><span class="sxs-lookup"><span data-stu-id="5e666-315">TVN\_ENDLABELEDIT</span></span>](tvn-endlabeledit.md)       | <span data-ttu-id="5e666-316">Сообщает об окончании редактирования метки.</span><span class="sxs-lookup"><span data-stu-id="5e666-316">Signals the end of label editing.</span></span>                                                      |
| [<span data-ttu-id="5e666-317">ТВН \_ жетдиспинфо</span><span class="sxs-lookup"><span data-stu-id="5e666-317">TVN\_GETDISPINFO</span></span>](tvn-getdispinfo.md)         | <span data-ttu-id="5e666-318">Запрашивает сведения, необходимые элементу управления "дерево-представление" для отображения элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-318">Requests information that the tree-view control requires to display an item.</span></span>           |
| [<span data-ttu-id="5e666-319">ТВН \_ итемекспандед</span><span class="sxs-lookup"><span data-stu-id="5e666-319">TVN\_ITEMEXPANDED</span></span>](tvn-itemexpanded.md)       | <span data-ttu-id="5e666-320">Сигнализирует, что список дочерних элементов родительского элемента был развернут или свернут.</span><span class="sxs-lookup"><span data-stu-id="5e666-320">Signals that a parent item's list of child items was expanded or collapsed.</span></span>            |
| [<span data-ttu-id="5e666-321">ТВН \_ итемекспандинг</span><span class="sxs-lookup"><span data-stu-id="5e666-321">TVN\_ITEMEXPANDING</span></span>](tvn-itemexpanding.md)     | <span data-ttu-id="5e666-322">Сигнализирует, что список дочерних элементов родительского элемента будет развернут или свернут.</span><span class="sxs-lookup"><span data-stu-id="5e666-322">Signals that a parent item's list of child items is about to be expanded or collapsed.</span></span> |
| [<span data-ttu-id="5e666-323">ТВН \_ KeyDown</span><span class="sxs-lookup"><span data-stu-id="5e666-323">TVN\_KEYDOWN</span></span>](tvn-keydown.md)                 | <span data-ttu-id="5e666-324">Сигнализирует о событии клавиатуры.</span><span class="sxs-lookup"><span data-stu-id="5e666-324">Signals a keyboard event.</span></span>                                                              |
| [<span data-ttu-id="5e666-325">ТВН \_ селчанжед</span><span class="sxs-lookup"><span data-stu-id="5e666-325">TVN\_SELCHANGED</span></span>](tvn-selchanged.md)           | <span data-ttu-id="5e666-326">Сигнализирует, что выделение изменилось с одного элемента на другой.</span><span class="sxs-lookup"><span data-stu-id="5e666-326">Signals that the selection has changed from one item to another.</span></span>                       |
| [<span data-ttu-id="5e666-327">ТВН \_ селчангинг</span><span class="sxs-lookup"><span data-stu-id="5e666-327">TVN\_SELCHANGING</span></span>](tvn-selchanging.md)         | <span data-ttu-id="5e666-328">Сигнализирует о том, что выбор будет изменен с одного элемента на другой.</span><span class="sxs-lookup"><span data-stu-id="5e666-328">Signals that the selection is about to be changed from one item to another.</span></span>            |
| [<span data-ttu-id="5e666-329">ТВН \_ сетдиспинфо</span><span class="sxs-lookup"><span data-stu-id="5e666-329">TVN\_SETDISPINFO</span></span>](tvn-setdispinfo.md)         | <span data-ttu-id="5e666-330">Уведомляет родительское окно о том, что необходимо обновить сведения, которые он поддерживает для элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-330">Notifies a parent window that it must update the information it maintains for an item.</span></span> |



 

## <a name="default-tree-view-control-message-processing"></a><span data-ttu-id="5e666-331">Обработка сообщений управления Tree-View по умолчанию</span><span class="sxs-lookup"><span data-stu-id="5e666-331">Default Tree-View Control Message Processing</span></span>

<span data-ttu-id="5e666-332">В этом разделе описывается обработка сообщений окна, выполняемая элементом управления "дерево-представление".</span><span class="sxs-lookup"><span data-stu-id="5e666-332">This section describes the window message processing performed by a tree-view control.</span></span> <span data-ttu-id="5e666-333">Сообщения, относящиеся к элементам управления "дерево-представление", обсуждаются в других разделах этого документа, поэтому они не включаются здесь.</span><span class="sxs-lookup"><span data-stu-id="5e666-333">Messages specific to tree-view controls are discussed in other sections of this document, so they are not included here.</span></span>



| <span data-ttu-id="5e666-334">Сообщение</span><span class="sxs-lookup"><span data-stu-id="5e666-334">Message</span></span>                                            | <span data-ttu-id="5e666-335">Обработка выполнена</span><span class="sxs-lookup"><span data-stu-id="5e666-335">Processing performed</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|----------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="5e666-336">**\_команда WM**</span><span class="sxs-lookup"><span data-stu-id="5e666-336">**WM\_COMMAND**</span></span>](/windows/desktop/menurc/wm-command)               | <span data-ttu-id="5e666-337">Обрабатывает сообщения уведомления элемента управления " [en \_ Update](en-update.md) " и " [en \_ киллфокус](en-killfocus.md) Edit" и пересылает все остальные уведомления об изменении элемента управления в родительское окно.</span><span class="sxs-lookup"><span data-stu-id="5e666-337">Processes the [EN\_UPDATE](en-update.md) and [EN\_KILLFOCUS](en-killfocus.md) edit control notification messages and forwards all other edit control notifications to the parent window.</span></span> <span data-ttu-id="5e666-338">Возвращаемое значение отсутствует.</span><span class="sxs-lookup"><span data-stu-id="5e666-338">There is no return value.</span></span>                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="5e666-339">**\_Создание WM**</span><span class="sxs-lookup"><span data-stu-id="5e666-339">**WM\_CREATE**</span></span>](/windows/desktop/winmsg/wm-create)                 | <span data-ttu-id="5e666-340">Выделяет память и инициализирует внутренние структуры данных.</span><span class="sxs-lookup"><span data-stu-id="5e666-340">Allocates memory and initializes internal data structures.</span></span> <span data-ttu-id="5e666-341">При успешном выполнении возвращается нуль, или значение-1 в противном случае.</span><span class="sxs-lookup"><span data-stu-id="5e666-341">It returns zero if successful, or -1 otherwise.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                          |
| [<span data-ttu-id="5e666-342">**WM \_ destroy**</span><span class="sxs-lookup"><span data-stu-id="5e666-342">**WM\_DESTROY**</span></span>](/windows/desktop/winmsg/wm-destroy)               | <span data-ttu-id="5e666-343">Освобождает все системные ресурсы, связанные с элементом управления.</span><span class="sxs-lookup"><span data-stu-id="5e666-343">Frees all system resources associated with the control.</span></span> <span data-ttu-id="5e666-344">Он возвращает ноль.</span><span class="sxs-lookup"><span data-stu-id="5e666-344">It returns zero.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| [<span data-ttu-id="5e666-345">**\_Включение WM**</span><span class="sxs-lookup"><span data-stu-id="5e666-345">**WM\_ENABLE**</span></span>](/windows/desktop/winmsg/wm-enable)                 | <span data-ttu-id="5e666-346">Включает или отключает элемент управления.</span><span class="sxs-lookup"><span data-stu-id="5e666-346">Enables or disables the control.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| [<span data-ttu-id="5e666-347">**WM \_ ерасебкгнд**</span><span class="sxs-lookup"><span data-stu-id="5e666-347">**WM\_ERASEBKGND**</span></span>](/windows/desktop/winmsg/wm-erasebkgnd)         | <span data-ttu-id="5e666-348">Стирает фон окна, используя текущий цвет фона для элемента управления "дерево-представление".</span><span class="sxs-lookup"><span data-stu-id="5e666-348">Erases the window background using the current background color for the tree-view control.</span></span> <span data-ttu-id="5e666-349">Он возвращает **значение true**.</span><span class="sxs-lookup"><span data-stu-id="5e666-349">It returns **TRUE**.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                     |
| [<span data-ttu-id="5e666-350">**WM \_ жетдлгкоде**</span><span class="sxs-lookup"><span data-stu-id="5e666-350">**WM\_GETDLGCODE**</span></span>](/windows/desktop/dlgbox/wm-getdlgcode)         | <span data-ttu-id="5e666-351">Возвращает сочетание \_ значений длгк вантарровс и длгк \_ вантчарс.</span><span class="sxs-lookup"><span data-stu-id="5e666-351">Returns a combination of the DLGC\_WANTARROWS and DLGC\_WANTCHARS values.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| [<span data-ttu-id="5e666-352">**WM, \_ Шрифт**</span><span class="sxs-lookup"><span data-stu-id="5e666-352">**WM\_GETFONT**</span></span>](/windows/desktop/winmsg/wm-getfont)               | <span data-ttu-id="5e666-353">Возвращает маркер для текущего шрифта метки.</span><span class="sxs-lookup"><span data-stu-id="5e666-353">Returns the handle to the current label font.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| [<span data-ttu-id="5e666-354">**WM \_ HSCROLL**</span><span class="sxs-lookup"><span data-stu-id="5e666-354">**WM\_HSCROLL**</span></span>](wm-hscroll.md)                  | <span data-ttu-id="5e666-355">Выполняет прокрутку элемента управления "дерево-представление".</span><span class="sxs-lookup"><span data-stu-id="5e666-355">Scrolls the tree-view control.</span></span> <span data-ttu-id="5e666-356">Он возвращает **значение true** , если выполняется прокрутка, или **false** в противном случае.</span><span class="sxs-lookup"><span data-stu-id="5e666-356">It returns **TRUE** if scrolling occurs, or **FALSE** otherwise.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                     |
| [<span data-ttu-id="5e666-357">**WM \_ KeyDown**</span><span class="sxs-lookup"><span data-stu-id="5e666-357">**WM\_KEYDOWN**</span></span>](/windows/desktop/inputdev/wm-keydown)             | <span data-ttu-id="5e666-358">Отправляет сообщение уведомления [ТВН \_ KeyDown](tvn-keydown.md) в родительское окно для всех ключей.</span><span class="sxs-lookup"><span data-stu-id="5e666-358">Sends the [TVN\_KEYDOWN](tvn-keydown.md) notification message to the parent window for all keys.</span></span> <span data-ttu-id="5e666-359">Отправляет уведомление [о \_ возврате (представление в виде дерева)](nm-return-tree-view-.md) , когда пользователь нажимает клавишу ВВОД.</span><span class="sxs-lookup"><span data-stu-id="5e666-359">Sends the [NM\_RETURN (tree view)](nm-return-tree-view-.md) notification message when the user presses the ENTER key.</span></span> <span data-ttu-id="5e666-360">Он перемещает курсор, когда пользователь нажимает клавиши со стрелками или вверх, на страницу вниз, в начало, конец или на клавишу BACKSPACE.</span><span class="sxs-lookup"><span data-stu-id="5e666-360">It moves the caret when the user presses the direction keys or the PAGE UP, PAGE DOWN, HOME, END, or BACKSPACE key.</span></span> <span data-ttu-id="5e666-361">Элемент управления "дерево" прокручивается, когда пользователь нажимает клавишу CTRL в сочетании с этими клавишами.</span><span class="sxs-lookup"><span data-stu-id="5e666-361">It scrolls the tree-view control when the user presses the CTRL key in combination with those keys.</span></span> <span data-ttu-id="5e666-362">Он возвращает **значение true** , если ключ обрабатывается, или **значение false** в противном случае.</span><span class="sxs-lookup"><span data-stu-id="5e666-362">It returns **TRUE** if a key is processed, or **FALSE** otherwise.</span></span> |
| [<span data-ttu-id="5e666-363">**WM \_ киллфокус**</span><span class="sxs-lookup"><span data-stu-id="5e666-363">**WM\_KILLFOCUS**</span></span>](/windows/desktop/inputdev/wm-killfocus)         | <span data-ttu-id="5e666-364">Перерисовывает элемент с упором, если он есть, и отправляет в родительское окно сообщение с уведомлением о [ \_ киллфокус (представление в виде дерева)](nm-killfocus-tree-view.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-364">Repaints the focused item, if any, and sends an [NM\_KILLFOCUS (tree view)](nm-killfocus-tree-view.md) notification message to the parent window.</span></span>                                                                                                                                                                                                                                                                                                                                                                  |
| [<span data-ttu-id="5e666-365">**WM \_ лбуттондблклк**</span><span class="sxs-lookup"><span data-stu-id="5e666-365">**WM\_LBUTTONDBLCLK**</span></span>](/windows/desktop/inputdev/wm-lbuttondblclk) | <span data-ttu-id="5e666-366">Отменяет правку метки и, если элемент был двойным щелчком мыши, отправляет в родительское окно сообщение с уведомлением [NM \_ дблклк (представление в виде дерева)](nm-dblclk-tree-view.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-366">Cancels label editing and, if an item was double-clicked, sends the [NM\_DBLCLK (tree view)](nm-dblclk-tree-view.md) notification message to the parent window.</span></span> <span data-ttu-id="5e666-367">Если родительское окно возвращает 0, элемент управления "представление дерева" переключает развернутое состояние элемента, отправляя родительское окно сообщения уведомления [ТВН \_ Итемекспандинг](tvn-itemexpanding.md) и [ТВН \_ итемекспандед](tvn-itemexpanded.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-367">If the parent window returns 0, the tree-view control toggles the expanded state of the item, sending the parent window the [TVN\_ITEMEXPANDING](tvn-itemexpanding.md) and [TVN\_ITEMEXPANDED](tvn-itemexpanded.md) notification messages.</span></span> <span data-ttu-id="5e666-368">Возвращаемое значение отсутствует.</span><span class="sxs-lookup"><span data-stu-id="5e666-368">There is no return value.</span></span>                                                                             |
| [<span data-ttu-id="5e666-369">**WM \_ лбуттондовн**</span><span class="sxs-lookup"><span data-stu-id="5e666-369">**WM\_LBUTTONDOWN**</span></span>](/windows/desktop/inputdev/wm-lbuttondown)     | <span data-ttu-id="5e666-370">Переключает развернутое состояние, если пользователь щелкнул кнопку, связанную с родительским элементом.</span><span class="sxs-lookup"><span data-stu-id="5e666-370">Toggles the expanded state if the user clicked the button associated with a parent item.</span></span> <span data-ttu-id="5e666-371">Если пользователь щелкнул метку элемента, элемент управления "представление дерева" выбирает и устанавливает фокус на элемент.</span><span class="sxs-lookup"><span data-stu-id="5e666-371">If the user clicked an item label, the tree-view control selects and sets the focus to the item.</span></span> <span data-ttu-id="5e666-372">Если пользователь перемещает мышь перед отправкой кнопки мыши, элемент управления "представление дерева" начинает операцию перетаскивания.</span><span class="sxs-lookup"><span data-stu-id="5e666-372">If the user moves the mouse before releasing the mouse button, the tree-view control begins a drag-and-drop operation.</span></span> <span data-ttu-id="5e666-373">Возвращаемое значение отсутствует.</span><span class="sxs-lookup"><span data-stu-id="5e666-373">There is no return value.</span></span>                                                                                                                                                                          |
| [<span data-ttu-id="5e666-374">**WM \_ Paint**</span><span class="sxs-lookup"><span data-stu-id="5e666-374">**WM\_PAINT**</span></span>](/windows/desktop/gdi/wm-paint)                      | <span data-ttu-id="5e666-375">Закрашивает недействительную область элемента управления "дерево-представление".</span><span class="sxs-lookup"><span data-stu-id="5e666-375">Paints the invalid region of the tree-view control.</span></span> <span data-ttu-id="5e666-376">Он возвращает ноль.</span><span class="sxs-lookup"><span data-stu-id="5e666-376">It returns zero.</span></span> <span data-ttu-id="5e666-377">Если параметр *wParam* не равен **null**, то элемент управления предполагает, что значение является обработчиком контекста устройства (HDC) и рисует его с помощью контекста этого устройства.</span><span class="sxs-lookup"><span data-stu-id="5e666-377">If the *wParam* parameter is non-**NULL**, the control assumes that the value is a handle to a device context (HDC) and paints using that device context.</span></span>                                                                                                                                                                                                                                                                                      |
| [<span data-ttu-id="5e666-378">**WM \_ рбуттондовн**</span><span class="sxs-lookup"><span data-stu-id="5e666-378">**WM\_RBUTTONDOWN**</span></span>](/windows/desktop/inputdev/wm-rbuttondown)     | <span data-ttu-id="5e666-379">Проверяет, была ли нажата кнопка, и начинается операция перетаскивания.</span><span class="sxs-lookup"><span data-stu-id="5e666-379">Checks to see if an item was clicked and a drag operation was begun.</span></span> <span data-ttu-id="5e666-380">Если операция началась, она отправляет сообщение уведомления [ТВН \_ бегинрдраг](tvn-beginrdrag.md) в родительское окно и выделяет цель перетаскивания.</span><span class="sxs-lookup"><span data-stu-id="5e666-380">If the operation has begun, it sends a [TVN\_BEGINRDRAG](tvn-beginrdrag.md) notification message to the parent window and highlights the drop target.</span></span> <span data-ttu-id="5e666-381">В противном случае он отправляет в родительское окно сообщение с уведомлением [NM \_ ркликк (представление в виде дерева)](nm-rclick-tree-view.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-381">Otherwise, it sends an [NM\_RCLICK (tree view)](nm-rclick-tree-view.md) notification message to the parent window.</span></span> <span data-ttu-id="5e666-382">Возвращаемое значение отсутствует.</span><span class="sxs-lookup"><span data-stu-id="5e666-382">There is no return value.</span></span>                                                                                                                                           |
| [<span data-ttu-id="5e666-383">**WM \_ SETFOCUS**</span><span class="sxs-lookup"><span data-stu-id="5e666-383">**WM\_SETFOCUS**</span></span>](/windows/desktop/inputdev/wm-setfocus)           | <span data-ttu-id="5e666-384">Перерисовывает элемент с отправкой, если он есть, и отправляет в родительское окно сообщение уведомления о [NM \_ SETFOCUS](nm-setfocus.md) .</span><span class="sxs-lookup"><span data-stu-id="5e666-384">Repaints the focused item, if any, and sends an [NM\_SETFOCUS](nm-setfocus.md) notification message to the parent window.</span></span>                                                                                                                                                                                                                                                                                                                                                                                          |
| [<span data-ttu-id="5e666-385">**WM \_ сетфонт**</span><span class="sxs-lookup"><span data-stu-id="5e666-385">**WM\_SETFONT**</span></span>](/windows/desktop/winmsg/wm-setfont)               | <span data-ttu-id="5e666-386">Сохраняет заданный маркер шрифта и перерисовывает элемент управления "дерево-представление" с помощью нового шрифта.</span><span class="sxs-lookup"><span data-stu-id="5e666-386">Saves the specified font handle and repaints the tree-view control using the new font.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                              |
| [<span data-ttu-id="5e666-387">**WM \_ сетредрав**</span><span class="sxs-lookup"><span data-stu-id="5e666-387">**WM\_SETREDRAW**</span></span>](/windows/desktop/gdi/wm-setredraw)              | <span data-ttu-id="5e666-388">Задает или очищает флаг перерисовки.</span><span class="sxs-lookup"><span data-stu-id="5e666-388">Sets or clears the redraw flag.</span></span> <span data-ttu-id="5e666-389">После установки флага перерисовки элемент управления представлением в виде дерева перерисовывается.</span><span class="sxs-lookup"><span data-stu-id="5e666-389">The tree-view control is redrawn after the redraw flag is set.</span></span> <span data-ttu-id="5e666-390">Он возвращает ноль.</span><span class="sxs-lookup"><span data-stu-id="5e666-390">It returns zero.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                     |
| [<span data-ttu-id="5e666-391">**\_Размер WM**</span><span class="sxs-lookup"><span data-stu-id="5e666-391">**WM\_SIZE**</span></span>](/windows/desktop/winmsg/wm-size)                     | <span data-ttu-id="5e666-392">Пересчитывает внутренние переменные, зависящие от размера клиентской области элемента управления "дерево-представление".</span><span class="sxs-lookup"><span data-stu-id="5e666-392">Recomputes internal variables that depend on the size of the tree-view control's client area.</span></span> <span data-ttu-id="5e666-393">Он возвращает **значение true**.</span><span class="sxs-lookup"><span data-stu-id="5e666-393">It returns **TRUE**.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                  |
| [<span data-ttu-id="5e666-394">**WM \_ стилечанжед**</span><span class="sxs-lookup"><span data-stu-id="5e666-394">**WM\_STYLECHANGED**</span></span>](/windows/desktop/winmsg/wm-stylechanged)     | <span data-ttu-id="5e666-395">Отменяет изменение метки и перерисовывает элемент управления "дерево-представление" с помощью новых стилей.</span><span class="sxs-lookup"><span data-stu-id="5e666-395">Cancels label editing and redraws the tree-view control using the new styles.</span></span> <span data-ttu-id="5e666-396">Он возвращает ноль.</span><span class="sxs-lookup"><span data-stu-id="5e666-396">It returns zero.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                      |
| [<span data-ttu-id="5e666-397">**WM \_ сисколорчанже**</span><span class="sxs-lookup"><span data-stu-id="5e666-397">**WM\_SYSCOLORCHANGE**</span></span>](/windows/desktop/gdi/wm-syscolorchange)    | <span data-ttu-id="5e666-398">Перерисовывает элемент управления "дерево-представление", используя новый цвет, если установлен флаг перерисовки.</span><span class="sxs-lookup"><span data-stu-id="5e666-398">Redraws the tree-view control using the new color if the redraw flag is set.</span></span> <span data-ttu-id="5e666-399">Возвращаемое значение отсутствует.</span><span class="sxs-lookup"><span data-stu-id="5e666-399">There is no return value.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                              |
| [<span data-ttu-id="5e666-400">**\_таймер WM**</span><span class="sxs-lookup"><span data-stu-id="5e666-400">**WM\_TIMER**</span></span>](/windows/desktop/winmsg/wm-timer)                   | <span data-ttu-id="5e666-401">Начинает редактирование метки элемента.</span><span class="sxs-lookup"><span data-stu-id="5e666-401">Begins editing an item label.</span></span> <span data-ttu-id="5e666-402">Если пользователь щелкает метку элемента с заголовком, элемент управления "представление дерева" устанавливает таймер вместо того, чтобы сразу перейти в режим редактирования.</span><span class="sxs-lookup"><span data-stu-id="5e666-402">If the user clicks the label of the focused item, the tree-view control sets a timer instead of entering edit mode immediately.</span></span> <span data-ttu-id="5e666-403">Таймер делает возможным представление в виде дерева, чтобы избежать входа в режим редактирования, если пользователь дважды щелкнет метку.</span><span class="sxs-lookup"><span data-stu-id="5e666-403">The timer makes it possible for the tree view to avoid entering edit mode if the user double-clicks the label.</span></span> <span data-ttu-id="5e666-404">Он возвращает ноль.</span><span class="sxs-lookup"><span data-stu-id="5e666-404">It returns zero.</span></span>                                                                                                                                                                                                                       |
| [<span data-ttu-id="5e666-405">**WM \_ VSCROLL**</span><span class="sxs-lookup"><span data-stu-id="5e666-405">**WM\_VSCROLL**</span></span>](wm-vscroll.md)                  | <span data-ttu-id="5e666-406">Выполняет прокрутку элемента управления "дерево-представление".</span><span class="sxs-lookup"><span data-stu-id="5e666-406">Scrolls the tree-view control.</span></span> <span data-ttu-id="5e666-407">Он возвращает **значение true** , если выполняется прокрутка, или **false** в противном случае.</span><span class="sxs-lookup"><span data-stu-id="5e666-407">It returns **TRUE** if scrolling occurs, or **FALSE** otherwise.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                     |



 

## <a name="related-topics"></a><span data-ttu-id="5e666-408">См. также</span><span class="sxs-lookup"><span data-stu-id="5e666-408">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="5e666-409">Пример: Кустдтв демонстрирует пользовательское рисование в TreeView (Q248496)</span><span class="sxs-lookup"><span data-stu-id="5e666-409">SAMPLE: CustDTv Illustrates Custom Draw in a TreeView (Q248496)</span></span>](https://support.microsoft.com/default.aspx?scid=kb;EN-US;q248496)
</dt> </dl>

 

 