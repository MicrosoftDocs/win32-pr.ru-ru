---
title: Состояние кэша в корне виртуализации
description: Описывает различные состояния кэша. файл или каталог, управляемый поставщиком, может иметь.
ms.assetid: <GUID-GOES-HERE>
ms.date: 01/17/2020
ms.topic: article
ms.openlocfilehash: 43d62ceb1f5ef5bf07000666f336077270b1e86a
ms.sourcegitcommit: 62e758931c610782807c7c9fad284921a6c56232
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/22/2020
ms.locfileid: "104412370"
---
# <a name="cache-state-in-the-virtualization-root"></a><span data-ttu-id="08771-103">Состояние кэша в корне виртуализации</span><span class="sxs-lookup"><span data-stu-id="08771-103">Cache State In the Virtualization Root</span></span>

<span data-ttu-id="08771-104">Поставщик использует локальную файловую систему в корне виртуализации в качестве кэша элементов, которыми он управляет.</span><span class="sxs-lookup"><span data-stu-id="08771-104">The provider uses the local file system under the virtualization root as a cache of the items that it manages.</span></span>  <span data-ttu-id="08771-105">Элемент (файл или каталог) может находиться в одном из шести состояний в локальной файловой системе:</span><span class="sxs-lookup"><span data-stu-id="08771-105">An item (file or directory) can be in one of six states on the local file system:</span></span>

* <span data-ttu-id="08771-106">Виртуальная</span><span class="sxs-lookup"><span data-stu-id="08771-106">Virtual</span></span>

  <span data-ttu-id="08771-107">Элемент не существует локально на диске.</span><span class="sxs-lookup"><span data-stu-id="08771-107">The item does not exist locally on disk.</span></span>  <span data-ttu-id="08771-108">Это проецируется, например, синтезированное во время перечисления родительского каталога.</span><span class="sxs-lookup"><span data-stu-id="08771-108">It is projected, i.e. synthesized, during enumerations of its parent directory.</span></span>  <span data-ttu-id="08771-109">Виртуальные элементы объединяются с любыми элементами, которые могут существовать на диске, чтобы представлять все содержимое родительского каталога.</span><span class="sxs-lookup"><span data-stu-id="08771-109">Virtual items are merged with any items that may exist on disk to present the full contents of the parent directory.</span></span>

* <span data-ttu-id="08771-110">Заполнитель</span><span class="sxs-lookup"><span data-stu-id="08771-110">Placeholder</span></span>

  <span data-ttu-id="08771-111">Для файлов: содержимое файла (первичный поток данных) отсутствует на диске.</span><span class="sxs-lookup"><span data-stu-id="08771-111">For files: The file's content (primary data stream) is not present on the disk.</span></span>  <span data-ttu-id="08771-112">Метаданные файла (имя, размер, метки времени, атрибуты и т. д.) кэшируются на диске.</span><span class="sxs-lookup"><span data-stu-id="08771-112">The file’s metadata (name, size, timestamps, attributes, etc.) is cached on the disk.</span></span>
  
  <span data-ttu-id="08771-113">Для каталогов: некоторые или все непосредственные потомки каталога (файлы и каталоги в каталоге) отсутствуют на диске, т. е. они все еще являются виртуальными.</span><span class="sxs-lookup"><span data-stu-id="08771-113">For directories: Some or all of the directory’s immediate descendants (the files and directories in the directory) are not present on the disk, i.e. they are still virtual.</span></span>  <span data-ttu-id="08771-114">Метаданные каталога (имя, метки времени, атрибуты и т. д.) кэшируются на диске.</span><span class="sxs-lookup"><span data-stu-id="08771-114">The directory’s metadata (name, timestamps, attributes, etc.) is cached on the disk.</span></span>

* <span data-ttu-id="08771-115">Заполнитель заархивированного текста</span><span class="sxs-lookup"><span data-stu-id="08771-115">Hydrated placeholder</span></span>

  <span data-ttu-id="08771-116">Для файлов: содержимое и метаданные файла были кэшированы на диске.</span><span class="sxs-lookup"><span data-stu-id="08771-116">For files: The file’s content and metadata have been cached to the disk.</span></span>  <span data-ttu-id="08771-117">Также называется "частичным файлом".</span><span class="sxs-lookup"><span data-stu-id="08771-117">Also referred to as a "partial file".</span></span>
  
  <span data-ttu-id="08771-118">Для каталогов: Каталог, созданный на диске в качестве заполнителя, никогда не станет каталогом заполнители.</span><span class="sxs-lookup"><span data-stu-id="08771-118">For directories: A directory that was created on disk as a placeholder never becomes a hydrated placeholder directory.</span></span>  <span data-ttu-id="08771-119">Это позволяет поставщику добавлять или удалять элементы из каталога в резервном хранилище, а эти изменения будут отражены в локальном кэше.</span><span class="sxs-lookup"><span data-stu-id="08771-119">This allows the provider to add or remove items from the directory in its backing store and have those changes be reflected in the local cache.</span></span>

* <span data-ttu-id="08771-120">Заполнитель "грязный" (заархивированный или нет)</span><span class="sxs-lookup"><span data-stu-id="08771-120">Dirty placeholder (hydrated or not)</span></span>

  <span data-ttu-id="08771-121">Метаданные элемента были локально изменены и больше не являются кэшем своего состояния в хранилище поставщика.</span><span class="sxs-lookup"><span data-stu-id="08771-121">The item's metadata has been locally modified and is no longer a cache of its state in the provider's store.</span></span> <span data-ttu-id="08771-122">Обратите внимание, что создание или удаление файла или каталога в заполнительном каталоге приводит к тому, что этот каталог заполнитель становится «грязным».</span><span class="sxs-lookup"><span data-stu-id="08771-122">Note that creating or deleting a file or directory under a placeholder directory causes that placeholder directory to become dirty.</span></span>

* <span data-ttu-id="08771-123">Полный файл или каталог</span><span class="sxs-lookup"><span data-stu-id="08771-123">Full file/directory</span></span>

  <span data-ttu-id="08771-124">Для файлов: содержимое файла (первичный поток данных) было изменено.</span><span class="sxs-lookup"><span data-stu-id="08771-124">For files: The file's content (primary data stream) has been modified.</span></span>  <span data-ttu-id="08771-125">Файл больше не является кэшем своего состояния в хранилище поставщика.</span><span class="sxs-lookup"><span data-stu-id="08771-125">The file is no longer a cache of its state in the provider's store.</span></span>  <span data-ttu-id="08771-126">Файлы, созданные в локальной файловой системе (т. е. которые не существуют в хранилище поставщика), также считаются полными файлами.</span><span class="sxs-lookup"><span data-stu-id="08771-126">Files that have been created on the local file system (i.e. that do not exist in the provider's store at all) are also considered to be full files.</span></span>
  
  <span data-ttu-id="08771-127">Для каталогов: каталоги, созданные в локальной файловой системе (т. е. которые не существуют в хранилище поставщика), считаются полными каталогами.</span><span class="sxs-lookup"><span data-stu-id="08771-127">For directories: Directories that have been created on the local file system (i.e. that do not exist in the provider's store at all) are considered to be full directories.</span></span>  <span data-ttu-id="08771-128">Каталог, созданный на диске в качестве заполнителя, никогда не станет полным каталогом.</span><span class="sxs-lookup"><span data-stu-id="08771-128">A directory that was created on disk as a placeholder never becomes a full directory.</span></span>
  
* <span data-ttu-id="08771-129">Отметки полного удаления</span><span class="sxs-lookup"><span data-stu-id="08771-129">Tombstone</span></span>

  <span data-ttu-id="08771-130">Специальный скрытый заполнитель, представляющий элемент, который был удален из локальной файловой системы.</span><span class="sxs-lookup"><span data-stu-id="08771-130">A special hidden placeholder that represents an item that has been deleted from the local file system.</span></span>  <span data-ttu-id="08771-131">При перечислении каталога Прожфс объединяет набор локальных элементов (заполнителей, полных файлов и т. д.) с набором виртуальных проецируемых элементов.</span><span class="sxs-lookup"><span data-stu-id="08771-131">When a directory is enumerated ProjFS merges the set of local items (placeholders, full files, etc.) with the set of virtual projected items.</span></span>  <span data-ttu-id="08771-132">Если элемент отображается как в локальном, так и в проектируемом наборе, приоритет имеет локальный элемент.</span><span class="sxs-lookup"><span data-stu-id="08771-132">If an item appears in both the local and projected sets, the local item takes precedence.</span></span>  <span data-ttu-id="08771-133">Если файл не существует в локальной файловой системе, локальное состояние отсутствует, поэтому оно отображается в перечислении.</span><span class="sxs-lookup"><span data-stu-id="08771-133">If a file does not exist in the local file system there is no local state, so it would appear in the enumeration.</span></span>  <span data-ttu-id="08771-134">Однако если этот элемент был удален, его отображение в перечислении будет неожиданным.</span><span class="sxs-lookup"><span data-stu-id="08771-134">However if that item had been deleted, having it appear in the enumeration would be unexpected.</span></span>  <span data-ttu-id="08771-135">Замена удаленного элемента на объект-захоронение приводит к следующим результатам:</span><span class="sxs-lookup"><span data-stu-id="08771-135">Replacing a deleted item with a tombstone results in the following effects:</span></span>

  * <span data-ttu-id="08771-136">Перечисление, чтобы не раскрывать элемент.</span><span class="sxs-lookup"><span data-stu-id="08771-136">Enumerations to not reveal the item.</span></span>
  * <span data-ttu-id="08771-137">Откроется файл, в котором должно произойти сбой элемента, например "файл не найден".</span><span class="sxs-lookup"><span data-stu-id="08771-137">File opens that expect the item to exist fail with e.g. "file not found".</span></span>
  * <span data-ttu-id="08771-138">Файл создает, что оно должно выполняться, только если элемент не существует. Прожфс удаляет объект-захоронение в рамках операции.</span><span class="sxs-lookup"><span data-stu-id="08771-138">File creates that expect to succeed only if the item does not exist succeed; ProjFS removes the tombstone as part of the operation.</span></span>

<span data-ttu-id="08771-139">Чтобы проиллюстрировать приведенные выше состояния, рассмотрим следующую последовательность, если поставщик Прожфс имеет один файл "foo.txt", расположенный в корневом каталоге виртуализации К:\рут.</span><span class="sxs-lookup"><span data-stu-id="08771-139">To illustrate the above states, consider the following sequence, given a ProjFS provider that has a single file "foo.txt" located in the virtualization root C:\root.</span></span>

1. <span data-ttu-id="08771-140">Приложение перечисляет К:\рут.</span><span class="sxs-lookup"><span data-stu-id="08771-140">An app enumerates C:\root.</span></span>  <span data-ttu-id="08771-141">Он видит виртуальный файл "foo.txt".</span><span class="sxs-lookup"><span data-stu-id="08771-141">It sees the virtual file "foo.txt".</span></span>  <span data-ttu-id="08771-142">Так как файл еще не был получен, он не существует на диске.</span><span class="sxs-lookup"><span data-stu-id="08771-142">Since the file has not yet been accessed, the file does not exist on disk.</span></span>
1. <span data-ttu-id="08771-143">Приложение открывает обработчик для C:\root\foo.txt.</span><span class="sxs-lookup"><span data-stu-id="08771-143">The app opens a handle to C:\root\foo.txt.</span></span>  <span data-ttu-id="08771-144">Прожфс указывает поставщику создать для него заполнитель.</span><span class="sxs-lookup"><span data-stu-id="08771-144">ProjFS tells the provider to create a placeholder for it.</span></span>
1. <span data-ttu-id="08771-145">Приложение считывает содержимое файла.</span><span class="sxs-lookup"><span data-stu-id="08771-145">The app reads the content of the file.</span></span>  <span data-ttu-id="08771-146">Поставщик предоставляет содержимое файла для Прожфс и кэшируется в C:\root\foo.txt.</span><span class="sxs-lookup"><span data-stu-id="08771-146">The provider provides the file content to ProjFS and it is cached to C:\root\foo.txt.</span></span>  <span data-ttu-id="08771-147">Теперь файл является заполнительом.</span><span class="sxs-lookup"><span data-stu-id="08771-147">The file is now a hydrated placeholder.</span></span>
1. <span data-ttu-id="08771-148">Приложение обновляет метку времени последнего изменения.</span><span class="sxs-lookup"><span data-stu-id="08771-148">The app updates the Last Modified timestamp.</span></span>  <span data-ttu-id="08771-149">Теперь файл является грязным заполнительом.</span><span class="sxs-lookup"><span data-stu-id="08771-149">The file is now a dirty hydrated placeholder.</span></span>
1. <span data-ttu-id="08771-150">Приложение открывает маркер для доступа на запись в файл.</span><span class="sxs-lookup"><span data-stu-id="08771-150">The app opens a handle for write access to the file.</span></span>  <span data-ttu-id="08771-151">C:\root\foo.txt теперь является полным файлом.</span><span class="sxs-lookup"><span data-stu-id="08771-151">C:\root\foo.txt is now a full file.</span></span>
1. <span data-ttu-id="08771-152">Приложение удаляет C:\root\foo.txt.</span><span class="sxs-lookup"><span data-stu-id="08771-152">The app deletes C:\root\foo.txt.</span></span>  <span data-ttu-id="08771-153">Прожфс заменяет файл захоронением.</span><span class="sxs-lookup"><span data-stu-id="08771-153">ProjFS replaces the file with a tombstone.</span></span>  <span data-ttu-id="08771-154">Теперь, когда приложение перечисляет К:\рут, он не увидит foo.txt.</span><span class="sxs-lookup"><span data-stu-id="08771-154">Now when the app enumerates C:\root it does not see foo.txt.</span></span>  <span data-ttu-id="08771-155">При попытке открыть файл открывается ошибка с ERROR_FILE_NOT_FOUND.</span><span class="sxs-lookup"><span data-stu-id="08771-155">If it tries to open the file, the open fails with ERROR_FILE_NOT_FOUND.</span></span>
