---
title: Состояние кэша в корне виртуализации
description: Описывает различные состояния кэша. файл или каталог, управляемый поставщиком, может иметь.
ms.assetid: <GUID-GOES-HERE>
ms.date: 01/17/2020
ms.topic: article
ms.openlocfilehash: 43d62ceb1f5ef5bf07000666f336077270b1e86a
ms.sourcegitcommit: 62e758931c610782807c7c9fad284921a6c56232
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/22/2020
ms.locfileid: "104412370"
---
# <a name="cache-state-in-the-virtualization-root"></a>Состояние кэша в корне виртуализации

Поставщик использует локальную файловую систему в корне виртуализации в качестве кэша элементов, которыми он управляет.  Элемент (файл или каталог) может находиться в одном из шести состояний в локальной файловой системе:

* Виртуальная

  Элемент не существует локально на диске.  Это проецируется, например, синтезированное во время перечисления родительского каталога.  Виртуальные элементы объединяются с любыми элементами, которые могут существовать на диске, чтобы представлять все содержимое родительского каталога.

* Заполнитель

  Для файлов: содержимое файла (первичный поток данных) отсутствует на диске.  Метаданные файла (имя, размер, метки времени, атрибуты и т. д.) кэшируются на диске.
  
  Для каталогов: некоторые или все непосредственные потомки каталога (файлы и каталоги в каталоге) отсутствуют на диске, т. е. они все еще являются виртуальными.  Метаданные каталога (имя, метки времени, атрибуты и т. д.) кэшируются на диске.

* Заполнитель заархивированного текста

  Для файлов: содержимое и метаданные файла были кэшированы на диске.  Также называется "частичным файлом".
  
  Для каталогов: Каталог, созданный на диске в качестве заполнителя, никогда не станет каталогом заполнители.  Это позволяет поставщику добавлять или удалять элементы из каталога в резервном хранилище, а эти изменения будут отражены в локальном кэше.

* Заполнитель "грязный" (заархивированный или нет)

  Метаданные элемента были локально изменены и больше не являются кэшем своего состояния в хранилище поставщика. Обратите внимание, что создание или удаление файла или каталога в заполнительном каталоге приводит к тому, что этот каталог заполнитель становится «грязным».

* Полный файл или каталог

  Для файлов: содержимое файла (первичный поток данных) было изменено.  Файл больше не является кэшем своего состояния в хранилище поставщика.  Файлы, созданные в локальной файловой системе (т. е. которые не существуют в хранилище поставщика), также считаются полными файлами.
  
  Для каталогов: каталоги, созданные в локальной файловой системе (т. е. которые не существуют в хранилище поставщика), считаются полными каталогами.  Каталог, созданный на диске в качестве заполнителя, никогда не станет полным каталогом.
  
* Отметки полного удаления

  Специальный скрытый заполнитель, представляющий элемент, который был удален из локальной файловой системы.  При перечислении каталога Прожфс объединяет набор локальных элементов (заполнителей, полных файлов и т. д.) с набором виртуальных проецируемых элементов.  Если элемент отображается как в локальном, так и в проектируемом наборе, приоритет имеет локальный элемент.  Если файл не существует в локальной файловой системе, локальное состояние отсутствует, поэтому оно отображается в перечислении.  Однако если этот элемент был удален, его отображение в перечислении будет неожиданным.  Замена удаленного элемента на объект-захоронение приводит к следующим результатам:

  * Перечисление, чтобы не раскрывать элемент.
  * Откроется файл, в котором должно произойти сбой элемента, например "файл не найден".
  * Файл создает, что оно должно выполняться, только если элемент не существует. Прожфс удаляет объект-захоронение в рамках операции.

Чтобы проиллюстрировать приведенные выше состояния, рассмотрим следующую последовательность, если поставщик Прожфс имеет один файл "foo.txt", расположенный в корневом каталоге виртуализации К:\рут.

1. Приложение перечисляет К:\рут.  Он видит виртуальный файл "foo.txt".  Так как файл еще не был получен, он не существует на диске.
1. Приложение открывает обработчик для C:\root\foo.txt.  Прожфс указывает поставщику создать для него заполнитель.
1. Приложение считывает содержимое файла.  Поставщик предоставляет содержимое файла для Прожфс и кэшируется в C:\root\foo.txt.  Теперь файл является заполнительом.
1. Приложение обновляет метку времени последнего изменения.  Теперь файл является грязным заполнительом.
1. Приложение открывает маркер для доступа на запись в файл.  C:\root\foo.txt теперь является полным файлом.
1. Приложение удаляет C:\root\foo.txt.  Прожфс заменяет файл захоронением.  Теперь, когда приложение перечисляет К:\рут, он не увидит foo.txt.  При попытке открыть файл открывается ошибка с ERROR_FILE_NOT_FOUND.
