---
description: Библиотека Dynamic-Link (DLL) может содержать глобальные данные или локальные данные.
ms.assetid: b1f6811e-c413-4124-9ccb-ea59b7a8a7ff
title: Dynamic-Link данных библиотеки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 83280d3bfc449061c44f9e8bfd9b47833e7eca19
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105664445"
---
# <a name="dynamic-link-library-data"></a><span data-ttu-id="5b384-103">Dynamic-Link данных библиотеки</span><span class="sxs-lookup"><span data-stu-id="5b384-103">Dynamic-Link Library Data</span></span>

<span data-ttu-id="5b384-104">Библиотека Dynamic-Link (DLL) может содержать глобальные данные или локальные данные.</span><span class="sxs-lookup"><span data-stu-id="5b384-104">A Dynamic-Link Library (DLL) can contain global data or local data.</span></span>

## <a name="variable-scope"></a><span data-ttu-id="5b384-105">Область действия переменных</span><span class="sxs-lookup"><span data-stu-id="5b384-105">Variable Scope</span></span>

<span data-ttu-id="5b384-106">Переменные, объявленные как глобальные в файле исходного кода DLL, обрабатываются компилятором и компоновщиком как глобальные переменные, но каждый процесс, загружающий заданную библиотеку DLL, получает собственную копию глобальных переменных библиотеки DLL.</span><span class="sxs-lookup"><span data-stu-id="5b384-106">Variables that are declared as global in a DLL source code file are treated as global variables by the compiler and linker, but each process that loads a given DLL gets its own copy of that DLL's global variables.</span></span> <span data-ttu-id="5b384-107">Область статических переменных ограничена блоком, в котором объявляются статические переменные.</span><span class="sxs-lookup"><span data-stu-id="5b384-107">The scope of static variables is limited to the block in which the static variables are declared.</span></span> <span data-ttu-id="5b384-108">В результате каждый процесс имеет собственный экземпляр глобальных и статических переменных DLL по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="5b384-108">As a result, each process has its own instance of the DLL global and static variables by default.</span></span>

> [!Note]  
> <span data-ttu-id="5b384-109">Средства разработки могут позволять переопределить поведение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="5b384-109">Your development tools may allow you to override the default behavior.</span></span> <span data-ttu-id="5b384-110">Например, компилятор Visual C++ поддерживает **\# раздел pragma** , а компоновщик поддерживает параметр/Section.</span><span class="sxs-lookup"><span data-stu-id="5b384-110">For example, the Visual C++ compiler supports **\#pragma section** and the linker supports the /SECTION option.</span></span> <span data-ttu-id="5b384-111">Дополнительные сведения см. в документации, входящей в состав средств разработки.</span><span class="sxs-lookup"><span data-stu-id="5b384-111">For more information, see the documentation included with your development tools.</span></span>

 

## <a name="dynamic-memory-allocation"></a><span data-ttu-id="5b384-112">Выделение динамическая память</span><span class="sxs-lookup"><span data-stu-id="5b384-112">Dynamic Memory Allocation</span></span>

<span data-ttu-id="5b384-113">Когда библиотека DLL выделяет память с помощью любой из функций выделения памяти ([**GlobalAlloc**](/windows/desktop/api/winbase/nf-winbase-globalalloc), [**локалаллок**](/windows/desktop/api/winbase/nf-winbase-localalloc), [**хеапаллок**](/windows/desktop/api/heapapi/nf-heapapi-heapalloc)и [**VirtualAlloc**](/windows/desktop/api/memoryapi/nf-memoryapi-virtualalloc)), память выделяется в виртуальном адресном пространстве вызывающего процесса и доступна только потокам этого процесса.</span><span class="sxs-lookup"><span data-stu-id="5b384-113">When a DLL allocates memory using any of the memory allocation functions ([**GlobalAlloc**](/windows/desktop/api/winbase/nf-winbase-globalalloc), [**LocalAlloc**](/windows/desktop/api/winbase/nf-winbase-localalloc), [**HeapAlloc**](/windows/desktop/api/heapapi/nf-heapapi-heapalloc), and [**VirtualAlloc**](/windows/desktop/api/memoryapi/nf-memoryapi-virtualalloc)), the memory is allocated in the virtual address space of the calling process and is accessible only to the threads of that process.</span></span>

<span data-ttu-id="5b384-114">Библиотека DLL может использовать сопоставление файлов для выделения памяти, которая может совместно использоваться процессами.</span><span class="sxs-lookup"><span data-stu-id="5b384-114">A DLL can use file mapping to allocate memory that can be shared among processes.</span></span> <span data-ttu-id="5b384-115">Общее описание использования сопоставления файлов для создания именованной общей памяти см. в разделе [Сопоставление файлов](/windows/desktop/Memory/file-mapping).</span><span class="sxs-lookup"><span data-stu-id="5b384-115">For a general discussion of how to use file mapping to create named shared memory, see [File Mapping](/windows/desktop/Memory/file-mapping).</span></span> <span data-ttu-id="5b384-116">Пример, использующий функцию [**DllMain**](dllmain.md) для настройки общей памяти с помощью сопоставления файлов, см. [в разделе Использование общей памяти в библиотеке Dynamic-Link](using-shared-memory-in-a-dynamic-link-library.md).</span><span class="sxs-lookup"><span data-stu-id="5b384-116">For an example that uses the [**DllMain**](dllmain.md) function to set up shared memory using file mapping, see [Using Shared Memory in a Dynamic-Link Library](using-shared-memory-in-a-dynamic-link-library.md).</span></span>

## <a name="thread-local-storage"></a><span data-ttu-id="5b384-117">локальное хранилище потока</span><span class="sxs-lookup"><span data-stu-id="5b384-117">Thread Local Storage</span></span>

<span data-ttu-id="5b384-118">Функции локального хранилища потока (TLS) позволяют библиотеке DLL выделить индекс для хранения и извлечения различных значений для каждого потока многопоточного процесса.</span><span class="sxs-lookup"><span data-stu-id="5b384-118">The thread local storage (TLS) functions enable a DLL to allocate an index for storing and retrieving a different value for each thread of a multithreaded process.</span></span> <span data-ttu-id="5b384-119">Например, приложение электронной таблицы может создавать экземпляры одного и того же потока каждый раз, когда пользователь открывает новую электронную таблицу.</span><span class="sxs-lookup"><span data-stu-id="5b384-119">For example, a spreadsheet application can create a new instance of the same thread each time the user opens a new spreadsheet.</span></span> <span data-ttu-id="5b384-120">Библиотека DLL, предоставляющая функции для различных операций с электронными таблицами, может использовать TLS для сохранения сведений о текущем состоянии каждой таблицы (строки, столбца и т. д.).</span><span class="sxs-lookup"><span data-stu-id="5b384-120">A DLL providing the functions for various spreadsheet operations can use TLS to save information about the current state of each spreadsheet (row, column, and so on).</span></span> <span data-ttu-id="5b384-121">Общие сведения о локальном хранилище потоков см. в статье [Локальное хранилище потока](/windows/desktop/ProcThread/thread-local-storage).</span><span class="sxs-lookup"><span data-stu-id="5b384-121">For a general discussion of thread local storage, see [Thread Local Storage](/windows/desktop/ProcThread/thread-local-storage).</span></span> <span data-ttu-id="5b384-122">Пример, в котором для настройки локального хранилища потока используется функция [**DllMain**](dllmain.md) , см. [в разделе Использование локального хранилища потока в библиотеке Dynamic-Link](using-thread-local-storage-in-a-dynamic-link-library.md).</span><span class="sxs-lookup"><span data-stu-id="5b384-122">For an example that uses the [**DllMain**](dllmain.md) function to set up thread local storage, see [Using Thread Local Storage in a Dynamic-Link Library](using-thread-local-storage-in-a-dynamic-link-library.md).</span></span>

<span data-ttu-id="5b384-123">**Windows Server 2003 и Windows XP:** Компилятор Visual C++ поддерживает синтаксис, позволяющий объявлять локальные переменные потока: **\_ declspec (thread)**.</span><span class="sxs-lookup"><span data-stu-id="5b384-123">**Windows Server 2003 and Windows XP:** The Visual C++ compiler supports a syntax that enables you to declare thread-local variables: **\_declspec(thread)**.</span></span> <span data-ttu-id="5b384-124">При использовании этого синтаксиса в библиотеке DLL вы не сможете загрузить DLL явным образом с помощью [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) или [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) в версиях Windows, предшествовавших Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="5b384-124">If you use this syntax in a DLL, you will not be able to load the DLL explicitly using [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) on versions of Windows prior to Windows Vista.</span></span> <span data-ttu-id="5b384-125">Если библиотека DLL будет загружена явным образом, необходимо использовать функции локального хранилища потока вместо **\_ declspec (thread)**.</span><span class="sxs-lookup"><span data-stu-id="5b384-125">If your DLL will be loaded explicitly, you must use the thread local storage functions instead of **\_declspec(thread)**.</span></span>

 

 
