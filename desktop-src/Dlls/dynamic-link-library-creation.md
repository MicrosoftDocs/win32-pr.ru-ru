---
description: Чтобы создать библиотеку Dynamic-Link (DLL), необходимо создать один или несколько файлов исходного кода и, возможно, файл компоновщика для экспорта функций.
ms.assetid: b66ea0e8-84c3-40be-bf02-765b9dd61f9f
title: Создание библиотеки Dynamic-Link
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c12d296b1494cfcedcdfa823eb1a3dd4d408427a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103811483"
---
# <a name="dynamic-link-library-creation"></a><span data-ttu-id="f921f-103">Создание библиотеки Dynamic-Link</span><span class="sxs-lookup"><span data-stu-id="f921f-103">Dynamic-Link Library Creation</span></span>

<span data-ttu-id="f921f-104">Чтобы создать библиотеку Dynamic-Link (DLL), необходимо создать один или несколько файлов исходного кода и, возможно, файл компоновщика для экспорта функций.</span><span class="sxs-lookup"><span data-stu-id="f921f-104">To create a Dynamic-Link Library (DLL), you must create one or more source code files, and possibly a linker file for exporting the functions.</span></span> <span data-ttu-id="f921f-105">Если вы планируете разрешить приложениям, использующим библиотеку DLL, использовать динамическую компоновку во время загрузки, необходимо также создать библиотеку импорта.</span><span class="sxs-lookup"><span data-stu-id="f921f-105">If you plan to allow applications that use your DLL to use load-time dynamic linking, you must also create an import library.</span></span>

## <a name="creating-source-files"></a><span data-ttu-id="f921f-106">Создание исходных файлов</span><span class="sxs-lookup"><span data-stu-id="f921f-106">Creating Source Files</span></span>

<span data-ttu-id="f921f-107">Исходные файлы для библиотеки DLL содержат экспортированные функции и данные, внутренние функции и данные, а также необязательная [функция точки входа](dynamic-link-library-entry-point-function.md) для библиотеки DLL.</span><span class="sxs-lookup"><span data-stu-id="f921f-107">The source files for a DLL contain exported functions and data, internal functions and data, and an optional [entry-point function](dynamic-link-library-entry-point-function.md) for the DLL.</span></span> <span data-ttu-id="f921f-108">Вы можете использовать любые средства разработки, поддерживающие создание библиотек DLL на основе Windows.</span><span class="sxs-lookup"><span data-stu-id="f921f-108">You may use any development tools that support the creation of Windows-based DLLs.</span></span>

<span data-ttu-id="f921f-109">Если библиотека DLL может использоваться многопоточным приложением, следует сделать DLL-файл "потокобезопасным".</span><span class="sxs-lookup"><span data-stu-id="f921f-109">If your DLL may be used by a multithreaded application, you should make your DLL "thread-safe".</span></span> <span data-ttu-id="f921f-110">Чтобы избежать повреждения данных, необходимо синхронизировать доступ ко всем глобальным данным библиотеки DLL.</span><span class="sxs-lookup"><span data-stu-id="f921f-110">You must synchronize access to all of the DLL's global data to avoid data corruption.</span></span> <span data-ttu-id="f921f-111">Также необходимо обеспечить связь только с библиотеками, которые также являются потокобезопасными.</span><span class="sxs-lookup"><span data-stu-id="f921f-111">You must also ensure that you link only with libraries that are thread-safe as well.</span></span> <span data-ttu-id="f921f-112">Например, Microsoft Visual C++ содержит несколько версий библиотеки времени выполнения C, которая не является потокобезопасной, и две из них.</span><span class="sxs-lookup"><span data-stu-id="f921f-112">For example, Microsoft Visual C++ contains multiple versions of the C Run-time Library, one that is not thread-safe and two that are.</span></span>

## <a name="exporting-functions"></a><span data-ttu-id="f921f-113">Экспорт функций</span><span class="sxs-lookup"><span data-stu-id="f921f-113">Exporting Functions</span></span>

<span data-ttu-id="f921f-114">Определение того, какие функции в библиотеке DLL следует экспортировать, зависит от средств, которые используются для разработки.</span><span class="sxs-lookup"><span data-stu-id="f921f-114">How you specify which functions in a DLL should be exported depends on the tools that you are using for development.</span></span> <span data-ttu-id="f921f-115">Некоторые компиляторы позволяют экспортировать функцию непосредственно в исходный код с помощью модификатора в объявлении функции.</span><span class="sxs-lookup"><span data-stu-id="f921f-115">Some compilers allow you to export a function directly in the source code by using a modifier in the function declaration.</span></span> <span data-ttu-id="f921f-116">В других случаях необходимо указать EXPORTS в файле, который передается компоновщику.</span><span class="sxs-lookup"><span data-stu-id="f921f-116">Other times, you must specify exports in a file that you pass to the linker.</span></span>

<span data-ttu-id="f921f-117">Например, с помощью Visual C++ существует два возможных способа экспорта функций DLL: с помощью модификатора [**\_ \_ declspec (dllexport)**](https://msdn.microsoft.com/library/3y1sfaz2(v=VS.71).aspx) или с помощью файла определения модуля (DEF).</span><span class="sxs-lookup"><span data-stu-id="f921f-117">For example, using Visual C++, there are two possible ways to export DLL functions: with the [**\_\_declspec(dllexport)**](https://msdn.microsoft.com/library/3y1sfaz2(v=VS.71).aspx) modifier or with a module-definition (.def) file.</span></span> <span data-ttu-id="f921f-118">При использовании модификатора **\_ \_ declspec (dllexport)** необязательно использовать DEF-файл.</span><span class="sxs-lookup"><span data-stu-id="f921f-118">If you use the **\_\_declspec(dllexport)** modifier, it is not necessary to use a .def file.</span></span> <span data-ttu-id="f921f-119">Дополнительные сведения см. в разделе [Экспорт из библиотеки DLL](/cpp/build/exporting-from-a-dll?view=vs-2019).</span><span class="sxs-lookup"><span data-stu-id="f921f-119">For more information, see [Exporting from a DLL](/cpp/build/exporting-from-a-dll?view=vs-2019).</span></span>

## <a name="creating-an-import-library"></a><span data-ttu-id="f921f-120">Создание библиотеки импорта</span><span class="sxs-lookup"><span data-stu-id="f921f-120">Creating an Import Library</span></span>

<span data-ttu-id="f921f-121">Файл библиотеки импорта (lib) содержит сведения, необходимые компоновщику для разрешения внешних ссылок на экспортированные функции DLL, поэтому система может найти указанную библиотеку DLL и экспортированные функции DLL во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="f921f-121">An import library (.lib) file contains information the linker needs to resolve external references to exported DLL functions, so the system can locate the specified DLL and exported DLL functions at run time.</span></span> <span data-ttu-id="f921f-122">При сборке библиотеки DLL можно создать библиотеку импорта для библиотеки DLL.</span><span class="sxs-lookup"><span data-stu-id="f921f-122">You can create an import library for your DLL when you build your DLL.</span></span>

<span data-ttu-id="f921f-123">Дополнительные сведения см. в разделе [Создание библиотеки импорта и файла экспорта](/cpp/build/reference/building-an-import-library-and-export-file?view=vs-2019).</span><span class="sxs-lookup"><span data-stu-id="f921f-123">For more information, see [Building an Import Library and Export File](/cpp/build/reference/building-an-import-library-and-export-file?view=vs-2019).</span></span>

## <a name="using-an-import-library"></a><span data-ttu-id="f921f-124">Использование библиотеки импорта</span><span class="sxs-lookup"><span data-stu-id="f921f-124">Using an Import Library</span></span>

<span data-ttu-id="f921f-125">Например, чтобы вызвать функцию [**CreateWindow**](/windows/win32/api/winuser/nf-winuser-createwindowa) , необходимо связать код с библиотекой импорта user32. lib.</span><span class="sxs-lookup"><span data-stu-id="f921f-125">For example, to call the [**CreateWindow**](/windows/win32/api/winuser/nf-winuser-createwindowa) function, you must link your code with the import library User32.lib.</span></span> <span data-ttu-id="f921f-126">Причина заключается в том, что **CreateWindow** находится в системной библиотеке DLL с именем User32.dll, а user32. lib — это библиотека импорта, используемая для разрешения вызовов экспортированных функций в User32.dll в коде.</span><span class="sxs-lookup"><span data-stu-id="f921f-126">The reason is that **CreateWindow** resides in a system DLL named User32.dll, and User32.lib is the import library used to resolve the calls to exported functions in User32.dll in your code.</span></span> <span data-ttu-id="f921f-127">Компоновщик создает таблицу, содержащую адрес каждого вызова функции.</span><span class="sxs-lookup"><span data-stu-id="f921f-127">The linker creates a table that contains the address of each function call.</span></span> <span data-ttu-id="f921f-128">Вызовы функций в библиотеке DLL будут исправлены при загрузке библиотеки DLL.</span><span class="sxs-lookup"><span data-stu-id="f921f-128">Calls to functions in a DLL will be fixed up when the DLL is loaded.</span></span> <span data-ttu-id="f921f-129">Во время инициализации процесса система загружает User32.dll, поскольку процесс зависит от экспортированных функций в этой библиотеке DLL и обновляет записи в таблице адресов функций.</span><span class="sxs-lookup"><span data-stu-id="f921f-129">While the system is initializing the process, it loads User32.dll because the process depends on exported functions in that DLL, and it updates the entries in the function address table.</span></span> <span data-ttu-id="f921f-130">Все вызовы **CreateWindow** вызывают функцию, экспортированную из User32.dll.</span><span class="sxs-lookup"><span data-stu-id="f921f-130">All calls to **CreateWindow** invoke the function exported from User32.dll.</span></span>

<span data-ttu-id="f921f-131">Дополнительные сведения см. в статье [неявное связывание с библиотекой DLL](/previous-versions/d14wsce5(v=vs.140)).</span><span class="sxs-lookup"><span data-stu-id="f921f-131">For information, see [Linking Implicitly with a DLL](/previous-versions/d14wsce5(v=vs.140)).</span></span>

## <a name="related-topics"></a><span data-ttu-id="f921f-132">См. также</span><span class="sxs-lookup"><span data-stu-id="f921f-132">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f921f-133">Создание простой библиотеки динамической компоновки</span><span class="sxs-lookup"><span data-stu-id="f921f-133">Creating a Simple Dynamic-link Library</span></span>](creating-a-simple-dynamic-link-library.md)
</dt> <dt>

[<span data-ttu-id="f921f-134">Библиотеки DLL (Visual C++)</span><span class="sxs-lookup"><span data-stu-id="f921f-134">DLLs (Visual C++)</span></span>](/cpp/build/dlls-in-visual-cpp?view=vs-2019)
</dt> </dl>

 

 
