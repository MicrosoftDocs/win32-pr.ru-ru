---
description: Чтобы создать библиотеку Dynamic-Link (DLL), необходимо создать один или несколько файлов исходного кода и, возможно, файл компоновщика для экспорта функций.
ms.assetid: b66ea0e8-84c3-40be-bf02-765b9dd61f9f
title: Создание библиотеки Dynamic-Link
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c12d296b1494cfcedcdfa823eb1a3dd4d408427a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103811483"
---
# <a name="dynamic-link-library-creation"></a>Создание библиотеки Dynamic-Link

Чтобы создать библиотеку Dynamic-Link (DLL), необходимо создать один или несколько файлов исходного кода и, возможно, файл компоновщика для экспорта функций. Если вы планируете разрешить приложениям, использующим библиотеку DLL, использовать динамическую компоновку во время загрузки, необходимо также создать библиотеку импорта.

## <a name="creating-source-files"></a>Создание исходных файлов

Исходные файлы для библиотеки DLL содержат экспортированные функции и данные, внутренние функции и данные, а также необязательная [функция точки входа](dynamic-link-library-entry-point-function.md) для библиотеки DLL. Вы можете использовать любые средства разработки, поддерживающие создание библиотек DLL на основе Windows.

Если библиотека DLL может использоваться многопоточным приложением, следует сделать DLL-файл "потокобезопасным". Чтобы избежать повреждения данных, необходимо синхронизировать доступ ко всем глобальным данным библиотеки DLL. Также необходимо обеспечить связь только с библиотеками, которые также являются потокобезопасными. Например, Microsoft Visual C++ содержит несколько версий библиотеки времени выполнения C, которая не является потокобезопасной, и две из них.

## <a name="exporting-functions"></a>Экспорт функций

Определение того, какие функции в библиотеке DLL следует экспортировать, зависит от средств, которые используются для разработки. Некоторые компиляторы позволяют экспортировать функцию непосредственно в исходный код с помощью модификатора в объявлении функции. В других случаях необходимо указать EXPORTS в файле, который передается компоновщику.

Например, с помощью Visual C++ существует два возможных способа экспорта функций DLL: с помощью модификатора [**\_ \_ declspec (dllexport)**](https://msdn.microsoft.com/library/3y1sfaz2(v=VS.71).aspx) или с помощью файла определения модуля (DEF). При использовании модификатора **\_ \_ declspec (dllexport)** необязательно использовать DEF-файл. Дополнительные сведения см. в разделе [Экспорт из библиотеки DLL](/cpp/build/exporting-from-a-dll?view=vs-2019).

## <a name="creating-an-import-library"></a>Создание библиотеки импорта

Файл библиотеки импорта (lib) содержит сведения, необходимые компоновщику для разрешения внешних ссылок на экспортированные функции DLL, поэтому система может найти указанную библиотеку DLL и экспортированные функции DLL во время выполнения. При сборке библиотеки DLL можно создать библиотеку импорта для библиотеки DLL.

Дополнительные сведения см. в разделе [Создание библиотеки импорта и файла экспорта](/cpp/build/reference/building-an-import-library-and-export-file?view=vs-2019).

## <a name="using-an-import-library"></a>Использование библиотеки импорта

Например, чтобы вызвать функцию [**CreateWindow**](/windows/win32/api/winuser/nf-winuser-createwindowa) , необходимо связать код с библиотекой импорта user32. lib. Причина заключается в том, что **CreateWindow** находится в системной библиотеке DLL с именем User32.dll, а user32. lib — это библиотека импорта, используемая для разрешения вызовов экспортированных функций в User32.dll в коде. Компоновщик создает таблицу, содержащую адрес каждого вызова функции. Вызовы функций в библиотеке DLL будут исправлены при загрузке библиотеки DLL. Во время инициализации процесса система загружает User32.dll, поскольку процесс зависит от экспортированных функций в этой библиотеке DLL и обновляет записи в таблице адресов функций. Все вызовы **CreateWindow** вызывают функцию, экспортированную из User32.dll.

Дополнительные сведения см. в статье [неявное связывание с библиотекой DLL](/previous-versions/d14wsce5(v=vs.140)).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Создание простой библиотеки динамической компоновки](creating-a-simple-dynamic-link-library.md)
</dt> <dt>

[Библиотеки DLL (Visual C++)](/cpp/build/dlls-in-visual-cpp?view=vs-2019)
</dt> </dl>

 

 
