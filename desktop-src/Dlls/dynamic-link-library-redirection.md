---
description: Приложения могут зависеть от конкретной версии общей библиотеки DLL и начать неудачу, если установлено другое приложение с более новой или более ранней версией той же DLL.
ms.assetid: 3b426b6c-1ad5-43b9-81ea-5e6d3c6588c8
title: Перенаправление библиотеки Dynamic-Link
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6b575d566231058cca13c10a067a3c2e20078073
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105683052"
---
# <a name="dynamic-link-library-redirection"></a><span data-ttu-id="892d1-103">Перенаправление библиотеки Dynamic-Link</span><span class="sxs-lookup"><span data-stu-id="892d1-103">Dynamic-Link Library Redirection</span></span>

<span data-ttu-id="892d1-104">Приложения могут зависеть от конкретной версии общей библиотеки DLL и начать неудачу, если установлено другое приложение с более новой или более ранней версией той же DLL.</span><span class="sxs-lookup"><span data-stu-id="892d1-104">Applications can depend on a specific version of a shared DLL and start to fail if another application is installed with a newer or older version of the same DLL.</span></span> <span data-ttu-id="892d1-105">Существует два способа убедиться, что приложение использует правильную библиотеку DLL: перенаправление DLL и параллельные компоненты.</span><span class="sxs-lookup"><span data-stu-id="892d1-105">There are two ways to ensure that your application uses the correct DLL: DLL redirection and side-by-side components.</span></span> <span data-ttu-id="892d1-106">Разработчикам и администраторам следует использовать перенаправление библиотек DLL для существующих приложений, так как оно не требует каких-либо изменений в приложении.</span><span class="sxs-lookup"><span data-stu-id="892d1-106">Developers and administrators should use DLL redirection for existing applications, because it does not require any changes to the application.</span></span> <span data-ttu-id="892d1-107">Если вы создаете новое приложение или обновляете приложение и хотите изолировать приложение от потенциальных проблем, создайте [параллельный компонент](/windows/desktop/SbsCs/isolated-applications-and-side-by-side-assemblies-portal).</span><span class="sxs-lookup"><span data-stu-id="892d1-107">If you are creating a new application or updating an application and want to isolate your application from potential problems, create a [side-by-side component](/windows/desktop/SbsCs/isolated-applications-and-side-by-side-assemblies-portal).</span></span>

<span data-ttu-id="892d1-108">Чтобы включить перенаправление библиотек DLL на уровне компьютера, необходимо создать новый раздел реестра.</span><span class="sxs-lookup"><span data-stu-id="892d1-108">To enable DLL redirection machine-wide, you must create a new registry key.</span></span> <span data-ttu-id="892d1-109">Создайте новый ключ DWORD с именем **девоверридинабле** в **HKLM\Software\Microsoft\Windows нт\куррентверсион\имаже File Options** и задайте для него значение 1.</span><span class="sxs-lookup"><span data-stu-id="892d1-109">Create a new DWORD key called **DevOverrideEnable** at **HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options** and set it to 1.</span></span> <span data-ttu-id="892d1-110">После этого необходимо перезагрузить компьютер, чтобы увидеть эффекты.</span><span class="sxs-lookup"><span data-stu-id="892d1-110">After this, you must restart your computer to see the effects.</span></span>

<span data-ttu-id="892d1-111">Чтобы использовать перенаправление библиотек DLL, создайте *файл перенаправления* для приложения.</span><span class="sxs-lookup"><span data-stu-id="892d1-111">To use DLL redirection, create a *redirection file* for your application.</span></span> <span data-ttu-id="892d1-112">Файл перенаправления должен называться следующим образом: *app \_ Name*. local.</span><span class="sxs-lookup"><span data-stu-id="892d1-112">The redirection file must be named as follows: *App\_name*.local.</span></span> <span data-ttu-id="892d1-113">Например, если имя приложения — Editor.exe, файл перенаправления должен называться Editor.exe. local.</span><span class="sxs-lookup"><span data-stu-id="892d1-113">For example, if the application name is Editor.exe, the redirection file should be named Editor.exe.local.</span></span> <span data-ttu-id="892d1-114">Необходимо установить локальный файл в каталог приложения.</span><span class="sxs-lookup"><span data-stu-id="892d1-114">You must install the .local file in the application directory.</span></span> <span data-ttu-id="892d1-115">Также необходимо установить библиотеки DLL в каталоге приложения.</span><span class="sxs-lookup"><span data-stu-id="892d1-115">You must also install the DLLs in the application directory.</span></span>

<span data-ttu-id="892d1-116">Содержимое файла перенаправления игнорируется, но его присутствие приводит к тому, что Windows сначала проверяет каталог приложения при загрузке библиотеки DLL, независимо от пути, указанного для [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) или [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span><span class="sxs-lookup"><span data-stu-id="892d1-116">The contents of a redirection file are ignored, but its presence causes Windows to check the application directory first whenever it loads a DLL, regardless of the path specified to [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span></span> <span data-ttu-id="892d1-117">Если библиотека DLL не найдена в каталоге приложения, то эти функции используют их обычный порядок поиска.</span><span class="sxs-lookup"><span data-stu-id="892d1-117">If the DLL is not found in the application directory, then these functions use their usual search order.</span></span> <span data-ttu-id="892d1-118">Например, если приложение c: \\ myapp \\myapp.exe вызывает **LoadLibrary** , используя следующий путь:</span><span class="sxs-lookup"><span data-stu-id="892d1-118">For example, if the application c:\\myapp\\myapp.exe calls **LoadLibrary** using the following path:</span></span>

<span data-ttu-id="892d1-119">c: \\ Program Files \\ Common Files \\ System \\mydll.dll</span><span class="sxs-lookup"><span data-stu-id="892d1-119">c:\\program files\\common files\\system\\mydll.dll</span></span>

<span data-ttu-id="892d1-120">Если же в c: \\ myapp \\myapp.exe. local и c: \\ MyApp \\mydll.dll существует, то [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) загружает c: \\ MyApp \\mydll.dll.</span><span class="sxs-lookup"><span data-stu-id="892d1-120">And, if both c:\\myapp\\myapp.exe.local and c:\\myapp\\mydll.dll exist, [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) loads c:\\myapp\\mydll.dll.</span></span> <span data-ttu-id="892d1-121">В противном случае **LoadLibrary** загружает c: \\ Program Files \\ common Files \\ System \\mydll.dll.</span><span class="sxs-lookup"><span data-stu-id="892d1-121">Otherwise, **LoadLibrary** loads c:\\program files\\common files\\system\\mydll.dll.</span></span>

<span data-ttu-id="892d1-122">Кроме того, если каталог с именем c: \\ myapp \\myapp.exe. local существует и содержит mydll.dll, [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) загружает c: \\ MyApp \\myapp.exe. local \\mydll.dll.</span><span class="sxs-lookup"><span data-stu-id="892d1-122">Alternatively, if a directory named c:\\myapp\\myapp.exe.local exists and contains mydll.dll, [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) loads c:\\myapp\\myapp.exe.local\\mydll.dll.</span></span>

<span data-ttu-id="892d1-123">Если приложение имеет манифест, то все локальные файлы игнорируются.</span><span class="sxs-lookup"><span data-stu-id="892d1-123">If the application has a manifest, then any .local files are ignored.</span></span>

<span data-ttu-id="892d1-124">Если вы используете перенаправление библиотек DLL и приложение не имеет доступа ко всем дискам и каталогам в порядке поиска, [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) прекращает поиск, как только доступ будет запрещен.</span><span class="sxs-lookup"><span data-stu-id="892d1-124">If you are using DLL redirection and the application does not have access to all drives and directories in the search order, [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) stops searching as soon as access is denied.</span></span> <span data-ttu-id="892d1-125">(Если перенаправление библиотек DLL не используется, то **LoadLibrary** пропускает недоступные каталоги, а затем продолжит поиск.)</span><span class="sxs-lookup"><span data-stu-id="892d1-125">(If you are not using DLL redirection, **LoadLibrary** skips directories that it cannot access and then continues searching.)</span></span>

<span data-ttu-id="892d1-126">Рекомендуется устанавливать библиотеки DLL приложения в тот же каталог, где находится приложение, даже если перенаправление библиотек DLL не используется.</span><span class="sxs-lookup"><span data-stu-id="892d1-126">It is good practice to install application DLLs in the same directory that contains the application, even if you are not using DLL redirection.</span></span> <span data-ttu-id="892d1-127">Это гарантирует, что установка приложения не перезаписывает другие копии библиотеки DLL и приведет к сбою других приложений.</span><span class="sxs-lookup"><span data-stu-id="892d1-127">This ensures that installing the application does not overwrite other copies of the DLL and cause other applications to fail.</span></span> <span data-ttu-id="892d1-128">Кроме того, при выполнении этой хорошей методики другие приложения не перезапишут копию библиотеки DLL и приведут к сбою приложения.</span><span class="sxs-lookup"><span data-stu-id="892d1-128">Also, if you follow this good practice, other applications do not overwrite your copy of the DLL and cause your application to fail.</span></span>

 

 
