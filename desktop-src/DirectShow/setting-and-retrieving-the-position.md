---
description: Установка и получение расположения
ms.assetid: 06b0e2d7-9539-41ad-a631-7e8da556feeb
title: Установка и получение расположения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 776a32eb6193ef456d693b5a133c87d800a0b64e
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "103805207"
---
# <a name="setting-and-retrieving-the-position"></a>Установка и получение расположения

Граф фильтра поддерживает два значения позиции: текущая позиция и позиция окончания. Они определяются следующим образом.

-   При выполнении графа текущее расположение является текущей позицией воспроизведения относительно начала источника. Когда работа графа остановлена или приостановлена, текущей позицией является точка, с которой начинается потоковая передача при следующей команде Run.
-   Позиция окончания — это точка, в которой поток будет завершен. Когда граф достигает позиции окончания, больше не выполняется потоковая передача данных, а диспетчер графа фильтров публикует событие [**EC \_ Complete**](ec-complete.md) . (Однако диаграмма не переключается автоматически на остановленное состояние. Дополнительные сведения см. [в разделе реагирование на события](responding-to-events.md).)

Чтобы получить эти значения, вызовите метод [**имедиасикинг:: Disposition**](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-getpositions) . Возвращаемые значения всегда относятся к исходному источнику мультимедиа. По умолчанию значения находятся в ссылочных единицах времени. В некоторых случаях можно изменить единицы времени; Дополнительные сведения см. в разделе [форматы времени для команд Seek](time-formats-for-seek-commands.md).

Чтобы перейти к новой позиции или задать новую точку окончания, вызовите метод [**имедиасикинг:: сетпоситионс**](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-setpositions) , как показано в следующем примере:


```C++
#define ONE_SECOND 10000000
REFERENCE_TIME rtNow  = 2 * ONE_SECOND, 
               rtStop = 5 * ONE_SECOND;

hr = pSeek->SetPositions(
    &rtNow,  AM_SEEKING_AbsolutePositioning, 
    &rtStop, AM_SEEKING_AbsolutePositioning
    );
```



> [!Note]  
> Одна секунда — 10 000 000 единиц времени ссылки. Для удобства в примере это значение определяется как одна \_ секунда. При использовании библиотеки базового класса DirectShow константные единицы имеют одинаковое значение.

 

Параметр *ртнов* задает новую текущую точку. Второй параметр — это флаг, определяющий способ интерпретации *ртнов*. В этом примере \_ флаг абсолутепоситионинг для поиска \_ указывает, что *ртнов* указывает абсолютное положение в источнике. Таким образом, граф фильтра будет выполнять поиск в положении, равном двум секундам от начала потока. Параметр *ртстоп* задает время окончания. Последний параметр указывает, что *ртстоп* также является абсолютной позицией.

Чтобы задать расположение относительно предыдущего значения положения, используйте \_ \_ флаг AM релативепоситионинг. Чтобы оставить одно из значений в неизменном виде, используйте флаг AM для \_ поиска по \_ положению. В этом случае соответствующий параметр времени может иметь **значение NULL** . В следующем примере производится поиск вперед на 10 секунд, но не изменяется и позиция останавливается.


```C++
REFERENCE_TIME rtNow = 10 * ONE_SECOND;
hr = pSeek->SetPositions(
    &rtNow, AM_SEEKING_RelativePositioning, 
    NULL, AM_SEEKING_NoPositioning
    );
```



Если граф фильтра остановлен, модуль подготовки видео не обновляет образ после операции поиска. Для пользователя он будет выглядеть так, как если бы поиск не выполнялся. Чтобы обновить образ, приостановите граф после операции поиска. При приостановке графа подготавливается новый кадр видео для модуля подготовки видео. Можно использовать метод [**имедиаконтрол:: стопвхенреади**](/windows/desktop/api/Control/nf-control-imediacontrol-stopwhenready) , который приостанавливает граф, а затем останавливает его.

 

 



