---
description: Класс Кбасеаллокатор является абстрактным базовым классом, реализующим распределитель. Распределительы предоставляют интерфейс Имемаллокатор.
ms.assetid: 3c9003d8-f15c-4e85-9712-9aaa87dffdf3
title: Класс Кбасеаллокатор (Амфилтер. h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- CBaseAllocator
api_type:
- COM
api_location:
- Strmbase.lib
- Strmbase.dll
- Strmbasd.lib
- Strmbasd.dll
ms.openlocfilehash: 068dd45ee3ffac5c3b915c3b0cdd8bc87756377e
ms.sourcegitcommit: c8ec1ded1ffffc364d3c4f560bb2171da0dc5040
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "105688775"
---
# <a name="cbaseallocator-class"></a><span data-ttu-id="50397-104">Класс Кбасеаллокатор</span><span class="sxs-lookup"><span data-stu-id="50397-104">CBaseAllocator class</span></span>

![Иерархия классов кбасеаллокатор](images/filter10.png)

<span data-ttu-id="50397-106">Класс **кбасеаллокатор** является абстрактным базовым классом, реализующим распределитель.</span><span class="sxs-lookup"><span data-stu-id="50397-106">The **CBaseAllocator** class is an abstract base class that implements an allocator.</span></span> <span data-ttu-id="50397-107">Распределительы предоставляют интерфейс [**имемаллокатор**](/windows/desktop/api/Strmif/nn-strmif-imemallocator) .</span><span class="sxs-lookup"><span data-stu-id="50397-107">Allocators expose the [**IMemAllocator**](/windows/desktop/api/Strmif/nn-strmif-imemallocator) interface.</span></span>

<span data-ttu-id="50397-108">*Распределитель* — это объект, который выделяет буферы памяти.</span><span class="sxs-lookup"><span data-stu-id="50397-108">An *allocator* is an object that allocates memory buffers.</span></span> <span data-ttu-id="50397-109">Распределитель поддерживает список доступных буферов.</span><span class="sxs-lookup"><span data-stu-id="50397-109">The allocator maintains a list of available buffers.</span></span> <span data-ttu-id="50397-110">Когда клиент (как правило, фильтр) запрашивает буфер, распределитель получает его из списка.</span><span class="sxs-lookup"><span data-stu-id="50397-110">When a client (generally a filter) requests a buffer, the allocator retrieves one from the list.</span></span> <span data-ttu-id="50397-111">Клиент заполняет буфер данными и может передать буфер другому объекту.</span><span class="sxs-lookup"><span data-stu-id="50397-111">The client fills the buffer with data, and might pass the buffer to another object.</span></span> <span data-ttu-id="50397-112">В конечном итоге буфер освобождается, и распределитель возвращает его в список доступных буферов.</span><span class="sxs-lookup"><span data-stu-id="50397-112">Eventually the buffer is released and the allocator returns it to the list of available buffers.</span></span>

<span data-ttu-id="50397-113">Каждый буфер инкапсулируется объектом, называемым *примером мультимедиа*.</span><span class="sxs-lookup"><span data-stu-id="50397-113">Each buffer is encapsulated by an object called a *media sample*.</span></span> <span data-ttu-id="50397-114">Примеры носителей — это способ упаковки указателей на блоки памяти в среде COM.</span><span class="sxs-lookup"><span data-stu-id="50397-114">Media samples are a way to package pointers to memory blocks within the Component Object Model (COM) framework.</span></span> <span data-ttu-id="50397-115">Примеры носителей предоставляют интерфейс [**имедиасампле**](/windows/desktop/api/Strmif/nn-strmif-imediasample) и реализуются с помощью класса [**кмедиасампле**](cmediasample.md) .</span><span class="sxs-lookup"><span data-stu-id="50397-115">Media samples expose the [**IMediaSample**](/windows/desktop/api/Strmif/nn-strmif-imediasample) interface, and are implemented using the [**CMediaSample**](cmediasample.md) class.</span></span> <span data-ttu-id="50397-116">Пример носителя содержит указатель на связанный буфер, доступ к которому можно получить путем вызова метода [**имедиасампле::-Point**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getpointer) .</span><span class="sxs-lookup"><span data-stu-id="50397-116">A media sample contains a pointer to the associated buffer, which can be accessed by calling the [**IMediaSample::GetPointer**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getpointer) method.</span></span> <span data-ttu-id="50397-117">Дополнительные сведения см. в разделе [Samples and распределителяs](samples-and-allocators.md).</span><span class="sxs-lookup"><span data-stu-id="50397-117">For more information, see [Samples and Allocators](samples-and-allocators.md).</span></span>

<span data-ttu-id="50397-118">Чтобы использовать этот класс, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="50397-118">To use this class, perform the following steps:</span></span>

1.  <span data-ttu-id="50397-119">Вызовите метод [**кбасеаллокатор:: SetProperties**](cbaseallocator-setproperties.md) , чтобы указать требования к буферу, включая количество буферов и размер каждого буфера.</span><span class="sxs-lookup"><span data-stu-id="50397-119">Call the [**CBaseAllocator::SetProperties**](cbaseallocator-setproperties.md) method to specify the buffer requirements, including the number of buffers and the size of each buffer.</span></span>
2.  <span data-ttu-id="50397-120">Вызовите метод [**кбасеаллокатор:: Commit**](cbaseallocator-commit.md) , чтобы выделить буферы.</span><span class="sxs-lookup"><span data-stu-id="50397-120">Call the [**CBaseAllocator::Commit**](cbaseallocator-commit.md) method to allocate the buffers.</span></span>
3.  <span data-ttu-id="50397-121">Вызовите метод [**кбасеаллокатор::**](cbaseallocator-getbuffer.md) WebMethod для получения примеров мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="50397-121">Call the [**CBaseAllocator::GetBuffer**](cbaseallocator-getbuffer.md) method to retrieve media samples.</span></span> <span data-ttu-id="50397-122">Этот метод блокируется до тех пор, пока не станет доступным следующий образец.</span><span class="sxs-lookup"><span data-stu-id="50397-122">This method blocks until the next sample becomes available.</span></span>
4.  <span data-ttu-id="50397-123">Завершив работу с каждым образцом, вызовите метод **IUnknown:: Release** в примере.</span><span class="sxs-lookup"><span data-stu-id="50397-123">When you are done with each sample, call the **IUnknown::Release** method on the sample.</span></span> <span data-ttu-id="50397-124">Этот образец не удаляется, когда счетчик ссылок достигает нуля.</span><span class="sxs-lookup"><span data-stu-id="50397-124">The sample is not deleted when its reference count reaches zero.</span></span> <span data-ttu-id="50397-125">Вместо этого пример возвращается в свободный список распределителя.</span><span class="sxs-lookup"><span data-stu-id="50397-125">Instead, the sample returns to the allocator's free list.</span></span>
5.  <span data-ttu-id="50397-126">По завершении использования распределителя вызовите метод [**кбасеаллокатор::D екоммит**](cbaseallocator-decommit.md) , чтобы освободить память для буферов.</span><span class="sxs-lookup"><span data-stu-id="50397-126">When you are done using the allocator, call the [**CBaseAllocator::Decommit**](cbaseallocator-decommit.md) method to free the memory for the buffers.</span></span>

<span data-ttu-id="50397-127">Метод [**commit**](cbaseallocator-commit.md) вызывает виртуальный метод [**Кбасеаллокатор:: Alloc**](cbaseallocator-alloc.md), который выделяет память для буферов.</span><span class="sxs-lookup"><span data-stu-id="50397-127">The [**Commit**](cbaseallocator-commit.md) method calls the virtual method [**CBaseAllocator::Alloc**](cbaseallocator-alloc.md), which allocates the memory for the buffers.</span></span> <span data-ttu-id="50397-128">Метод [**uncommit**](cbaseallocator-decommit.md) вызывает чистый виртуальный метод [**Кбасеаллокатор:: Free**](cbaseallocator-free.md), который освобождает память.</span><span class="sxs-lookup"><span data-stu-id="50397-128">The [**Decommit**](cbaseallocator-decommit.md) method calls the pure virtual method [**CBaseAllocator::Free**](cbaseallocator-free.md), which frees the memory.</span></span> <span data-ttu-id="50397-129">Производные классы должны переопределять эти два метода.</span><span class="sxs-lookup"><span data-stu-id="50397-129">Derived classes must override these two methods.</span></span>

<span data-ttu-id="50397-130">Базовый класс [**кмемаллокатор**](cmemallocator.md) является производным от **кбасеаллокатор**.</span><span class="sxs-lookup"><span data-stu-id="50397-130">The [**CMemAllocator**](cmemallocator.md) base class derives from **CBaseAllocator**.</span></span> <span data-ttu-id="50397-131">Базовые классы фильтров используют класс **кмемаллокатор** .</span><span class="sxs-lookup"><span data-stu-id="50397-131">The filter base classes use the **CMemAllocator** class.</span></span>



| <span data-ttu-id="50397-132">Защищенные переменные членов</span><span class="sxs-lookup"><span data-stu-id="50397-132">Protected Member Variables</span></span>                                                   | <span data-ttu-id="50397-133">Описание</span><span class="sxs-lookup"><span data-stu-id="50397-133">Description</span></span>                                                                                |
|------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|
| [<span data-ttu-id="50397-134">**m \_ лфри**</span><span class="sxs-lookup"><span data-stu-id="50397-134">**m\_lFree**</span></span>](cbaseallocator-m-lfree.md)                                   | <span data-ttu-id="50397-135">Указатель на список доступных (бесплатных) образцов мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="50397-135">Pointer to a list of available (free) media samples.</span></span>                                       |
| [<span data-ttu-id="50397-136">**m \_ хсем**</span><span class="sxs-lookup"><span data-stu-id="50397-136">**m\_hSem**</span></span>](cbaseallocator-m-hsem.md)                                     | <span data-ttu-id="50397-137">Семафор, сигнальный при появления образца.</span><span class="sxs-lookup"><span data-stu-id="50397-137">Semaphore that is signaled when a sample becomes available.</span></span>                                |
| [<span data-ttu-id="50397-138">**m \_ лваитинг**</span><span class="sxs-lookup"><span data-stu-id="50397-138">**m\_lWaiting**</span></span>](cbaseallocator-m-lwaiting.md)                             | <span data-ttu-id="50397-139">Число потоков, ожидающих выборок.</span><span class="sxs-lookup"><span data-stu-id="50397-139">Count of threads waiting for samples.</span></span>                                                      |
| [<span data-ttu-id="50397-140">**m \_ lCount**</span><span class="sxs-lookup"><span data-stu-id="50397-140">**m\_lCount**</span></span>](cbaseallocator-m-lcount.md)                                 | <span data-ttu-id="50397-141">Количество буферов для предоставления.</span><span class="sxs-lookup"><span data-stu-id="50397-141">Number of buffers to provide.</span></span>                                                              |
| [<span data-ttu-id="50397-142">**m \_ лаллокатед**</span><span class="sxs-lookup"><span data-stu-id="50397-142">**m\_lAllocated**</span></span>](cbaseallocator-m-lallocated.md)                         | <span data-ttu-id="50397-143">Количество буферов, выделенных в настоящий момент.</span><span class="sxs-lookup"><span data-stu-id="50397-143">Number of buffers currently allocated.</span></span>                                                     |
| [<span data-ttu-id="50397-144">**m \_ лсизе**</span><span class="sxs-lookup"><span data-stu-id="50397-144">**m\_lSize**</span></span>](cbaseallocator-m-lsize.md)                                   | <span data-ttu-id="50397-145">Размер каждого буфера.</span><span class="sxs-lookup"><span data-stu-id="50397-145">Size of each buffer.</span></span>                                                                       |
| [<span data-ttu-id="50397-146">**m \_ лалигнмент**</span><span class="sxs-lookup"><span data-stu-id="50397-146">**m\_lAlignment**</span></span>](cbaseallocator-m-lalignment.md)                         | <span data-ttu-id="50397-147">Выравнивание каждого буфера.</span><span class="sxs-lookup"><span data-stu-id="50397-147">Alignment of each buffer.</span></span>                                                                  |
| [<span data-ttu-id="50397-148">**m \_ лпрефикс**</span><span class="sxs-lookup"><span data-stu-id="50397-148">**m\_lPrefix**</span></span>](cbaseallocator-m-lprefix.md)                               | <span data-ttu-id="50397-149">Префикс каждого буфера.</span><span class="sxs-lookup"><span data-stu-id="50397-149">Prefix of each buffer.</span></span>                                                                     |
| [<span data-ttu-id="50397-150">**m \_ бчанжед**</span><span class="sxs-lookup"><span data-stu-id="50397-150">**m\_bChanged**</span></span>](cbaseallocator-m-bchanged.md)                             | <span data-ttu-id="50397-151">Флаг, указывающий, изменились ли требования к буферу.</span><span class="sxs-lookup"><span data-stu-id="50397-151">Flag indicating whether the buffer requirements have changed.</span></span>                              |
| [<span data-ttu-id="50397-152">**m \_ бкоммиттед**</span><span class="sxs-lookup"><span data-stu-id="50397-152">**m\_bCommitted**</span></span>](cbaseallocator-m-bcommitted.md)                         | <span data-ttu-id="50397-153">Флаг, указывающий, зафиксирован ли распределитель.</span><span class="sxs-lookup"><span data-stu-id="50397-153">Flag indicating whether the allocator has been committed.</span></span>                                  |
| [<span data-ttu-id="50397-154">**m \_ бдекоммитинпрогресс**</span><span class="sxs-lookup"><span data-stu-id="50397-154">**m\_bDecommitInProgress**</span></span>](cbaseallocator-m-bdecommitinprogress.md)       | <span data-ttu-id="50397-155">Флаг, указывающий, выполняется ли операция дефиксации.</span><span class="sxs-lookup"><span data-stu-id="50397-155">Flag indicating whether a decommit operation is in progress.</span></span>                               |
| [<span data-ttu-id="50397-156">**m \_ пнотифи**</span><span class="sxs-lookup"><span data-stu-id="50397-156">**m\_pNotify**</span></span>](cbaseallocator-m-pnotify.md)                               | <span data-ttu-id="50397-157">Указатель на интерфейс обратного вызова, который вызывается при освобождении образцов.</span><span class="sxs-lookup"><span data-stu-id="50397-157">Pointer to a callback interface, which is called when samples are released.</span></span>                |
| [<span data-ttu-id="50397-158">**m \_ фенаблерелеасекаллбакк**</span><span class="sxs-lookup"><span data-stu-id="50397-158">**m\_fEnableReleaseCallback**</span></span>](cbaseallocator-m-fenablereleasecallback.md) | <span data-ttu-id="50397-159">Флаг, указывающий, включен ли обратный вызов выпуска.</span><span class="sxs-lookup"><span data-stu-id="50397-159">Flag indicating whether the release callback is enabled.</span></span>                                   |
| <span data-ttu-id="50397-160">Защищенные методы</span><span class="sxs-lookup"><span data-stu-id="50397-160">Protected Methods</span></span>                                                            | <span data-ttu-id="50397-161">Описание</span><span class="sxs-lookup"><span data-stu-id="50397-161">Description</span></span>                                                                                |
| [<span data-ttu-id="50397-162">**Идентификатор**</span><span class="sxs-lookup"><span data-stu-id="50397-162">**Alloc**</span></span>](cbaseallocator-alloc.md)                                        | <span data-ttu-id="50397-163">Выделяет память для буферов.</span><span class="sxs-lookup"><span data-stu-id="50397-163">Allocates memory for the buffers.</span></span> <span data-ttu-id="50397-164">Виртуализаци.</span><span class="sxs-lookup"><span data-stu-id="50397-164">Virtual.</span></span>                                                 |
| <span data-ttu-id="50397-165">Открытые методы</span><span class="sxs-lookup"><span data-stu-id="50397-165">Public Methods</span></span>                                                               | <span data-ttu-id="50397-166">Описание</span><span class="sxs-lookup"><span data-stu-id="50397-166">Description</span></span>                                                                                |
| [<span data-ttu-id="50397-167">**кбасеаллокатор**</span><span class="sxs-lookup"><span data-stu-id="50397-167">**CBaseAllocator**</span></span>](cbaseallocator-cbaseallocator.md)                      | <span data-ttu-id="50397-168">Метод конструктора.</span><span class="sxs-lookup"><span data-stu-id="50397-168">Constructor method.</span></span>                                                                        |
| [<span data-ttu-id="50397-169">**~ Кбасеаллокатор**</span><span class="sxs-lookup"><span data-stu-id="50397-169">**~ CBaseAllocator**</span></span>](cbaseallocator--cbaseallocator.md)                   | <span data-ttu-id="50397-170">Метод деструктора.</span><span class="sxs-lookup"><span data-stu-id="50397-170">Destructor method.</span></span>                                                                         |
| [<span data-ttu-id="50397-171">**сетнотифи**</span><span class="sxs-lookup"><span data-stu-id="50397-171">**SetNotify**</span></span>](cbaseallocator-setnotify.md)                                | <span data-ttu-id="50397-172">Является устаревшей.</span><span class="sxs-lookup"><span data-stu-id="50397-172">Obsolete.</span></span>                                                                                  |
| [<span data-ttu-id="50397-173">**жетфрикаунт**</span><span class="sxs-lookup"><span data-stu-id="50397-173">**GetFreeCount**</span></span>](cbaseallocator-getfreecount.md)                          | <span data-ttu-id="50397-174">Возвращает количество неиспользуемых выборок мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="50397-174">Retrieves the number of media samples that are not in use.</span></span>                                 |
| [<span data-ttu-id="50397-175">**нотифисампле**</span><span class="sxs-lookup"><span data-stu-id="50397-175">**NotifySample**</span></span>](cbaseallocator-notifysample.md)                          | <span data-ttu-id="50397-176">Освобождает все потоки, ожидающие выборки.</span><span class="sxs-lookup"><span data-stu-id="50397-176">Releases any threads that are waiting for samples.</span></span>                                         |
| [<span data-ttu-id="50397-177">**сетваитинг**</span><span class="sxs-lookup"><span data-stu-id="50397-177">**SetWaiting**</span></span>](cbaseallocator-setwaiting.md)                              | <span data-ttu-id="50397-178">Увеличивает число ожидающих потоков.</span><span class="sxs-lookup"><span data-stu-id="50397-178">Increments the count of waiting threads.</span></span>                                                   |
| <span data-ttu-id="50397-179">Чистые виртуальные методы</span><span class="sxs-lookup"><span data-stu-id="50397-179">Pure Virtual Methods</span></span>                                                         | <span data-ttu-id="50397-180">Описание</span><span class="sxs-lookup"><span data-stu-id="50397-180">Description</span></span>                                                                                |
| [<span data-ttu-id="50397-181">**Free**</span><span class="sxs-lookup"><span data-stu-id="50397-181">**Free**</span></span>](cbaseallocator-free.md)                                          | <span data-ttu-id="50397-182">Освобождает всю буферную память.</span><span class="sxs-lookup"><span data-stu-id="50397-182">Releases all of the buffer memory.</span></span>                                                         |
| <span data-ttu-id="50397-183">Методы Имемаллокатор</span><span class="sxs-lookup"><span data-stu-id="50397-183">IMemAllocator Methods</span></span>                                                        | <span data-ttu-id="50397-184">Описание</span><span class="sxs-lookup"><span data-stu-id="50397-184">Description</span></span>                                                                                |
| [<span data-ttu-id="50397-185">**SetProperties**</span><span class="sxs-lookup"><span data-stu-id="50397-185">**SetProperties**</span></span>](cbaseallocator-setproperties.md)                        | <span data-ttu-id="50397-186">Указывает количество выделяемых буферов и размер каждого буфера.</span><span class="sxs-lookup"><span data-stu-id="50397-186">Specifies the number of buffers to allocate and the size of each buffer.</span></span>                   |
| [<span data-ttu-id="50397-187">**GetProperties**</span><span class="sxs-lookup"><span data-stu-id="50397-187">**GetProperties**</span></span>](cbaseallocator-getproperties.md)                        | <span data-ttu-id="50397-188">Извлекает количество буферов, которые будут созданы распределителем, и свойства буфера.</span><span class="sxs-lookup"><span data-stu-id="50397-188">Retrieves the number of buffers that the allocator will create, and the buffer properties.</span></span> |
| [<span data-ttu-id="50397-189">**Сохраните**</span><span class="sxs-lookup"><span data-stu-id="50397-189">**Commit**</span></span>](cbaseallocator-commit.md)                                      | <span data-ttu-id="50397-190">Выделяет память для буферов.</span><span class="sxs-lookup"><span data-stu-id="50397-190">Allocates the memory for the buffers.</span></span>                                                      |
| [<span data-ttu-id="50397-191">**Освобождения**</span><span class="sxs-lookup"><span data-stu-id="50397-191">**Decommit**</span></span>](cbaseallocator-decommit.md)                                  | <span data-ttu-id="50397-192">Отменяет фиксацию буферов.</span><span class="sxs-lookup"><span data-stu-id="50397-192">Decommits the buffers.</span></span>                                                                     |
| [<span data-ttu-id="50397-193">**GetBuffer**</span><span class="sxs-lookup"><span data-stu-id="50397-193">**GetBuffer**</span></span>](cbaseallocator-getbuffer.md)                                | <span data-ttu-id="50397-194">Извлекает пример носителя, содержащий буфер.</span><span class="sxs-lookup"><span data-stu-id="50397-194">Retrieves a media sample that contains a buffer.</span></span>                                           |
| [<span data-ttu-id="50397-195">**релеасебуффер**</span><span class="sxs-lookup"><span data-stu-id="50397-195">**ReleaseBuffer**</span></span>](cbaseallocator-releasebuffer.md)                        | <span data-ttu-id="50397-196">Возвращает пример носителя в список примеров бесплатных носителей.</span><span class="sxs-lookup"><span data-stu-id="50397-196">Returns a media sample to the list of free media samples.</span></span>                                  |



 

## <a name="requirements"></a><span data-ttu-id="50397-197">Требования</span><span class="sxs-lookup"><span data-stu-id="50397-197">Requirements</span></span>



| <span data-ttu-id="50397-198">Требование</span><span class="sxs-lookup"><span data-stu-id="50397-198">Requirement</span></span> | <span data-ttu-id="50397-199">Значение</span><span class="sxs-lookup"><span data-stu-id="50397-199">Value</span></span> |
|--------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="50397-200">Header</span><span class="sxs-lookup"><span data-stu-id="50397-200">Header</span></span><br/>  | <dl> <span data-ttu-id="50397-201"><dt>Амфилтер. h (включение Streams. h)</dt></span><span class="sxs-lookup"><span data-stu-id="50397-201"><dt>Amfilter.h (include Streams.h)</dt></span></span> </dl>                                                                                  |
| <span data-ttu-id="50397-202">Библиотека</span><span class="sxs-lookup"><span data-stu-id="50397-202">Library</span></span><br/> | <dl> <span data-ttu-id="50397-203"><dt>Стрмбасе. lib (розничные сборки); </dt> <dt>Стрмбасд. lib (отладочные сборки)</dt></span><span class="sxs-lookup"><span data-stu-id="50397-203"><dt>Strmbase.lib (retail builds); </dt> <dt>Strmbasd.lib (debug builds)</dt></span></span> </dl> |



## <a name="see-also"></a><span data-ttu-id="50397-204">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="50397-204">See also</span></span>

<dl> <dt>

[<span data-ttu-id="50397-205">Предоставление пользовательского распределителя</span><span class="sxs-lookup"><span data-stu-id="50397-205">Providing a Custom Allocator</span></span>](providing-a-custom-allocator.md)
</dt> </dl>

 

 




