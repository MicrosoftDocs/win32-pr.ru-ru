---
description: Метки времени
ms.assetid: 445fe6b9-9d5b-45fd-9c9e-8c632c5228ae
title: Метки времени
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 855d2c472d7964ccad6ec8bbc87efd39b1c4cdd6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105684639"
---
# <a name="time-stamps"></a><span data-ttu-id="7ea15-103">Метки времени</span><span class="sxs-lookup"><span data-stu-id="7ea15-103">Time Stamps</span></span>

<span data-ttu-id="7ea15-104">*Метка времени* определяет время начала и окончания образца носителя, измеряемое во время потока.</span><span class="sxs-lookup"><span data-stu-id="7ea15-104">The *time stamp* defines a media sample's start and finish times, measured in stream time.</span></span> <span data-ttu-id="7ea15-105">Метка времени иногда называется *временем презентации*.</span><span class="sxs-lookup"><span data-stu-id="7ea15-105">The time stamp is sometimes called the *presentation time*.</span></span> <span data-ttu-id="7ea15-106">При чтении оставшейся части этой статьи важно помнить, что не все форматы используют метки времени одинаковым образом.</span><span class="sxs-lookup"><span data-stu-id="7ea15-106">When reading the rest of this article, it is important to remember that not all formats use time stamps in the same way.</span></span> <span data-ttu-id="7ea15-107">Например, не все образцы MPEG имеют отметку времени.</span><span class="sxs-lookup"><span data-stu-id="7ea15-107">For example, not all MPEG samples are time stamped.</span></span> <span data-ttu-id="7ea15-108">В графах фильтра MPEG отметка времени не применяется к каждому кадру, пока они не выводятся из декодера.</span><span class="sxs-lookup"><span data-stu-id="7ea15-108">In MPEG filter graphs, the time stamp is not applied to each frame until they are output from the decoder.</span></span>

<span data-ttu-id="7ea15-109">Когда фильтр модуля подготовки отчетов получает образец, он планирует отрисовку на основе метки времени.</span><span class="sxs-lookup"><span data-stu-id="7ea15-109">When a renderer filter receives a sample, it schedules rendering based on the time stamp.</span></span> <span data-ttu-id="7ea15-110">Если пример приступит к опозданию или не имеет отметки времени, фильтр немедленно выводит пример.</span><span class="sxs-lookup"><span data-stu-id="7ea15-110">If the sample arrives late, or has no time stamp, the filter renders the sample immediately.</span></span> <span data-ttu-id="7ea15-111">В противном случае фильтр ожидает до тех пор, пока не будет отображен пример.</span><span class="sxs-lookup"><span data-stu-id="7ea15-111">Otherwise, the filter waits until the sample's start time before it renders the sample.</span></span> <span data-ttu-id="7ea15-112">(Он ждет времени начала, вызвав метод [**иреференцеклокк:: адвисетиме**](/windows/desktop/api/Strmif/nf-strmif-ireferenceclock-advisetime) .)</span><span class="sxs-lookup"><span data-stu-id="7ea15-112">(It waits for the start time by calling the [**IReferenceClock::AdviseTime**](/windows/desktop/api/Strmif/nf-strmif-ireferenceclock-advisetime) method.)</span></span>

<span data-ttu-id="7ea15-113">Фильтры источников и фильтры анализатора отвечают за установку правильных меток времени для обрабатываемых образцов.</span><span class="sxs-lookup"><span data-stu-id="7ea15-113">Source filters and parser filters are responsible for setting the correct time stamps on the samples they process.</span></span> <span data-ttu-id="7ea15-114">Используйте следующие рекомендации.</span><span class="sxs-lookup"><span data-stu-id="7ea15-114">Use the following guidelines.</span></span>

-   <span data-ttu-id="7ea15-115">Воспроизведение файла: Первая выборка имеет отметку времени начала, равное нулю.</span><span class="sxs-lookup"><span data-stu-id="7ea15-115">File playback: The first sample is time stamped with a start time of zero.</span></span> <span data-ttu-id="7ea15-116">Последующие отметки времени определяются длиной выборки и скоростью воспроизведения, которая определяется форматом файла.</span><span class="sxs-lookup"><span data-stu-id="7ea15-116">Subsequent time stamps are determined by the sample length and the playback rate, which itself is determined by the file format.</span></span> <span data-ttu-id="7ea15-117">Фильтр, который анализирует файл, отвечает за вычисление правильных меток времени (например, [разделителя AVI](avi-splitter-filter.md)).</span><span class="sxs-lookup"><span data-stu-id="7ea15-117">The filter that parses the file is responsible for calculating the correct time stamps (for example, the [AVI Splitter](avi-splitter-filter.md)).</span></span>
-   <span data-ttu-id="7ea15-118">Запись видео и звука. Каждый образец имеет время начала, равное времени выполнения потока при записи, со следующими предупреждениями.</span><span class="sxs-lookup"><span data-stu-id="7ea15-118">Video and audio capture: Every sample is time stamped with a start time equal to the stream time when it was captured, with the following caveats:</span></span>
    -   <span data-ttu-id="7ea15-119">Видеокадры из предварительной версии ПИН-кода (в отличие от ПИН-кода захвата) не имеют метки времени.</span><span class="sxs-lookup"><span data-stu-id="7ea15-119">Video frames from a preview pin (as opposed to a capture pin) are not time stamped.</span></span> <span data-ttu-id="7ea15-120">Из-за задержки графа видеокадр, помеченный временем записи, всегда приступит к работе модуля подготовки видео.</span><span class="sxs-lookup"><span data-stu-id="7ea15-120">Because of graph latency, a video frame that is stamped with the capture time will always arrive late at the video renderer.</span></span> <span data-ttu-id="7ea15-121">Это может привести к тому, что модуль подготовки отчетов выполнит удаление кадров в попытке контроля качества.</span><span class="sxs-lookup"><span data-stu-id="7ea15-121">This may cause the renderer to drop frames, in an attempt at quality control.</span></span> <span data-ttu-id="7ea15-122">Сведения об управлении качеством см. в разделе [Управление качеством](quality-control-management.md).</span><span class="sxs-lookup"><span data-stu-id="7ea15-122">For information about quality control, see [Quality-Control Management](quality-control-management.md).</span></span>
    -   <span data-ttu-id="7ea15-123">Запись звука. фильтр записи звука использует собственный набор буферов, отличный от тех, которые используются драйвером аудиоподсистемы.</span><span class="sxs-lookup"><span data-stu-id="7ea15-123">Audio capture: The audio capture filter uses its own set of buffers, which are separate from those used by the audio driver.</span></span> <span data-ttu-id="7ea15-124">Драйвер аудиоподсистемы заполняет буферы фильтра записи с фиксированными интервалами.</span><span class="sxs-lookup"><span data-stu-id="7ea15-124">The audio driver fills the capture filter's buffers at fixed intervals.</span></span> <span data-ttu-id="7ea15-125">Интервал зависит от драйвера, но обычно не превышает 10 миллисекунд.</span><span class="sxs-lookup"><span data-stu-id="7ea15-125">The interval depends on the driver, but generally is not more than 10 milliseconds.</span></span> <span data-ttu-id="7ea15-126">Метки времени на звуковых примерах соответствуют времени, когда драйвер заполняет буферы фильтра записи звука.</span><span class="sxs-lookup"><span data-stu-id="7ea15-126">The time stamps on the audio samples reflect the time when the driver filled the audio capture filter's buffers.</span></span> <span data-ttu-id="7ea15-127">Эти значения времени могут быть немного неточными, особенно если приложение использует очень маленький размер буфера.</span><span class="sxs-lookup"><span data-stu-id="7ea15-127">These times can be slightly inaccurate, especially if the application is using a very small buffer size.</span></span> <span data-ttu-id="7ea15-128">Тем не менее, время передачи мультимедиа будет точно отражать число образцов аудио в буфере.</span><span class="sxs-lookup"><span data-stu-id="7ea15-128">However, the media times will accurately reflect the number audio samples in the buffer.</span></span>
-   <span data-ttu-id="7ea15-129">Фильтры мультиплексора. в зависимости от формата выходных данных для фильтра мультиплексора может потребоваться создать отметки времени или не может быть.</span><span class="sxs-lookup"><span data-stu-id="7ea15-129">Mux filters: Depending on the output format, a mux filter may need to generate time stamps, or it may not.</span></span> <span data-ttu-id="7ea15-130">Например, формат AVI-файла использует фиксированную частоту кадров без штампов времени, поэтому фильтр для [AVI-мультиплексора](avi-mux-filter.md) предполагает, что выборки поступают приблизительно в нужное время.</span><span class="sxs-lookup"><span data-stu-id="7ea15-130">For example, the AVI file format uses a fixed frame rate with no time stamps, so the [AVI Mux](avi-mux-filter.md) filter assumes that samples are arriving at approximately the right time.</span></span> <span data-ttu-id="7ea15-131">Если штампы времени поступающего показывают промежуток, превышающий один кадр, то в случае, если в формате AVI имеется запись индекса с нулевым размером, это означает, что кадр был удален.</span><span class="sxs-lookup"><span data-stu-id="7ea15-131">If the incoming time stamps show a gap larger than one frame, however, the AVI Mux writes an index entry with size zero, to indicate a dropped frame.</span></span> <span data-ttu-id="7ea15-132">При воспроизведении файлов новые отметки времени создаются во время выполнения, как описано выше.</span><span class="sxs-lookup"><span data-stu-id="7ea15-132">On file playback, new time stamps are generated at run time, as described previously.</span></span>

<span data-ttu-id="7ea15-133">Чтобы задать метку времени для образца, вызовите метод [**имедиасампле:: setTime**](/windows/desktop/api/Strmif/nf-strmif-imediasample-settime) .</span><span class="sxs-lookup"><span data-stu-id="7ea15-133">To set the time stamp on a sample, call the [**IMediaSample::SetTime**](/windows/desktop/api/Strmif/nf-strmif-imediasample-settime) method.</span></span>

<span data-ttu-id="7ea15-134">**Время передачи мультимедиа**</span><span class="sxs-lookup"><span data-stu-id="7ea15-134">**Media Times**</span></span>

<span data-ttu-id="7ea15-135">При необходимости фильтр также может указать *время носителя* для образца.</span><span class="sxs-lookup"><span data-stu-id="7ea15-135">Optionally, the filter can also specify a *media time* for the sample.</span></span> <span data-ttu-id="7ea15-136">В потоке видео время мультимедиа представляет номер кадра.</span><span class="sxs-lookup"><span data-stu-id="7ea15-136">In a video stream, media time represents the frame number.</span></span> <span data-ttu-id="7ea15-137">В звуковом потоке время носителя представляет образец номера в пакете.</span><span class="sxs-lookup"><span data-stu-id="7ea15-137">In an audio stream, media time represents the sample number in the packet.</span></span> <span data-ttu-id="7ea15-138">Например, если каждый пакет содержит одну секунду для звука 44,1 килохертз (кГц), первый пакет имеет нулевое время начала и время окончания, равное 44100.</span><span class="sxs-lookup"><span data-stu-id="7ea15-138">For example, if each packet contains one second of 44.1 kilohertz (kHz) audio, the first packet has a media start time of zero and a media stop time of 44100.</span></span> <span data-ttu-id="7ea15-139">В потоке, доступном для поиска, время мультимедиа всегда указывается относительно времени начала потока.</span><span class="sxs-lookup"><span data-stu-id="7ea15-139">In a seekable stream, the media time is always relative to the start time of the stream.</span></span> <span data-ttu-id="7ea15-140">Например, предположим, что вы зайдете на 2 секунды с начала видеопотока из 15 кадров в секунду.</span><span class="sxs-lookup"><span data-stu-id="7ea15-140">For example, suppose you seek to 2 seconds from the start of a 15-fps video stream.</span></span> <span data-ttu-id="7ea15-141">Первый пример носителя после операции поиска имеет отметку времени, равную нулю, но время мультимедиа, равное 30.</span><span class="sxs-lookup"><span data-stu-id="7ea15-141">The first media sample after the seek has a time stamp of zero but a media time of 30.</span></span>

<span data-ttu-id="7ea15-142">Фильтры визуализации и мультиплексора могут использовать время мультимедиа, чтобы определить, были ли удалены фреймы или образцы, путем проверки наличия пропусков.</span><span class="sxs-lookup"><span data-stu-id="7ea15-142">Renderer and mux filters can use the media time to determine whether frames or samples have been dropped, by checking for gaps.</span></span> <span data-ttu-id="7ea15-143">Однако для установки времени мультимедиа фильтры не требуются.</span><span class="sxs-lookup"><span data-stu-id="7ea15-143">However, filters are not required to set the media time.</span></span> <span data-ttu-id="7ea15-144">Чтобы задать время мультимедиа в образце, вызовите метод [**имедиасампле:: сетмедиатиме**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatime) .</span><span class="sxs-lookup"><span data-stu-id="7ea15-144">To set the media time on a sample, call the [**IMediaSample::SetMediaTime**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatime) method.</span></span>

## <a name="related-topics"></a><span data-ttu-id="7ea15-145">См. также</span><span class="sxs-lookup"><span data-stu-id="7ea15-145">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="7ea15-146">Время и часы в DirectShow</span><span class="sxs-lookup"><span data-stu-id="7ea15-146">Time and Clocks in DirectShow</span></span>](time-and-clocks-in-directshow.md)
</dt> </dl>

 

 



