---
description: Типы мультимедиа DMO
ms.assetid: 40958e12-09c7-4ce5-aa4d-5ed8b1f40aa3
title: Типы мультимедиа DMO
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1997abb1cc3c8eb10301778982ef7a46690855ed
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "104547426"
---
# <a name="dmo-media-types"></a><span data-ttu-id="567d1-103">Типы мультимедиа DMO</span><span class="sxs-lookup"><span data-stu-id="567d1-103">DMO Media Types</span></span>

<span data-ttu-id="567d1-104">Тип носителя описывает формат, связанный с потоком данных мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="567d1-104">A media type describes the format associated with a stream of media data.</span></span> <span data-ttu-id="567d1-105">В этой статье описывается, как дмос обрабатывает типы мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="567d1-105">This article describes how DMOs handle media types.</span></span> <span data-ttu-id="567d1-106">В основном он предназначен для разработчиков, создающих собственные пользовательские дмос.</span><span class="sxs-lookup"><span data-stu-id="567d1-106">It is primarily intended for developers who are writing their own custom DMOs.</span></span>

<span data-ttu-id="567d1-107">Типы носителей определяются с помощью [**структуры \_ \_ типа мультимедиа DMO**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_media_type) .</span><span class="sxs-lookup"><span data-stu-id="567d1-107">Media types are defined using the [**DMO\_MEDIA\_TYPE**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_media_type) structure.</span></span> <span data-ttu-id="567d1-108">Эта структура включает следующие сведения:</span><span class="sxs-lookup"><span data-stu-id="567d1-108">This structure includes the following information:</span></span>

-   <span data-ttu-id="567d1-109">*Основной тип* — это глобальный уникальный идентификатор (GUID), определяющий обширную категорию, например аудио или видео.</span><span class="sxs-lookup"><span data-stu-id="567d1-109">The *major type* is a globally unique identifier (GUID) that defines a broad category, such as audio or video.</span></span>
-   <span data-ttu-id="567d1-110">*Подтип* — это идентификатор GUID, определяющий более конкретные аспекты типа.</span><span class="sxs-lookup"><span data-stu-id="567d1-110">The *subtype* is a GUID that defines more specific aspects of the type.</span></span> <span data-ttu-id="567d1-111">Например, в видео подтипы включают 16-битный RGB, 24-разрядный RGB, UYVY, видео в кодировке DV и т. д.</span><span class="sxs-lookup"><span data-stu-id="567d1-111">For example, within video, the subtypes include 16-bit RGB, 24-bit RGB, UYVY, DV-encoded video, and so forth.</span></span>
-   <span data-ttu-id="567d1-112">*Блок формата* — это вторичная структура, полностью определяющая формат.</span><span class="sxs-lookup"><span data-stu-id="567d1-112">The *format block* is a secondary structure that fully specifies the format.</span></span> <span data-ttu-id="567d1-113">Макет блока форматирования зависит от типа данных.</span><span class="sxs-lookup"><span data-stu-id="567d1-113">The layout of the format block depends on the type of data.</span></span> <span data-ttu-id="567d1-114">Например, в звуковом PCM используется структура **вавеформатекс** .</span><span class="sxs-lookup"><span data-stu-id="567d1-114">For example, PCM audio uses the **WAVEFORMATEX** structure.</span></span> <span data-ttu-id="567d1-115">Видео использует различные структуры, включая **видеоинфохеадер** и **VIDEOINFOHEADER2**.</span><span class="sxs-lookup"><span data-stu-id="567d1-115">Video uses various other structures, including **VIDEOINFOHEADER** and **VIDEOINFOHEADER2**.</span></span> <span data-ttu-id="567d1-116">Макет блока формата определяется идентификатором GUID типа.</span><span class="sxs-lookup"><span data-stu-id="567d1-116">The layout of the format block is identified by a format type GUID.</span></span> <span data-ttu-id="567d1-117">Например, FORMAT \_ вавеформатекс указывает структуру **вавеформатекс** .</span><span class="sxs-lookup"><span data-stu-id="567d1-117">For example, FORMAT\_WaveFormatEx specifies a **WAVEFORMATEX** structure.</span></span>

<span data-ttu-id="567d1-118">При первом создании DMO потоки не имеют типа мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="567d1-118">When a DMO is first created, the streams do not have a media type.</span></span> <span data-ttu-id="567d1-119">Прежде чем DMO сможет обработать какие-либо данные, клиент должен задать тип носителя для каждого потока.</span><span class="sxs-lookup"><span data-stu-id="567d1-119">Before the DMO can process any data, the client must set a media type for each stream.</span></span> <span data-ttu-id="567d1-120">Этот процесс описан в разделе [Настройка типов мультимедиа в DMO](setting-media-types-on-a-dmo.md)с точки зрения клиента.</span><span class="sxs-lookup"><span data-stu-id="567d1-120">This process is described from the client's perspective in [Setting Media Types on a DMO](setting-media-types-on-a-dmo.md).</span></span>

<span data-ttu-id="567d1-121">**Типы носителей в реестре**</span><span class="sxs-lookup"><span data-stu-id="567d1-121">**Media Types in the Registry**</span></span>

<span data-ttu-id="567d1-122">DMO может добавить список типов мультимедиа, которые он поддерживает, в реестр, вызвав функцию [**дморегистер**](/previous-versions/windows/desktop/api/Dmoreg/nf-dmoreg-dmoregister) .</span><span class="sxs-lookup"><span data-stu-id="567d1-122">A DMO can add a list of media types that it supports to the registry, by calling the [**DMORegister**](/previous-versions/windows/desktop/api/Dmoreg/nf-dmoreg-dmoregister) function.</span></span> <span data-ttu-id="567d1-123">Приложение может использовать эти сведения для поиска дмос, соответствующих определенному формату.</span><span class="sxs-lookup"><span data-stu-id="567d1-123">An application can use this information to search for DMOs that match a particular format.</span></span> <span data-ttu-id="567d1-124">Сведения в реестре не должны быть исчерпывающими.</span><span class="sxs-lookup"><span data-stu-id="567d1-124">The information in the registry is not meant to be comprehensive.</span></span> <span data-ttu-id="567d1-125">Обычно включаются только основные типы, поддерживаемые DMO.</span><span class="sxs-lookup"><span data-stu-id="567d1-125">Typically, you would include only the main types that the DMO supports.</span></span> <span data-ttu-id="567d1-126">Запись реестра имеет отдельные ключи для входных и выходных типов, но не различает отдельные потоки.</span><span class="sxs-lookup"><span data-stu-id="567d1-126">The registry entry has separate keys for input and output types, but does not distinguish among individual streams.</span></span>

<span data-ttu-id="567d1-127">Функция **дморегистер** использует [**\_ частичную структуру \_ носителя DMO**](/previous-versions/windows/desktop/api/Dmoreg/ns-dmoreg-dmo_partial_mediatype) для описания типов мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="567d1-127">The **DMORegister** function uses the [**DMO\_PARTIAL\_MEDIATYPE**](/previous-versions/windows/desktop/api/Dmoreg/ns-dmoreg-dmo_partial_mediatype) structure to describe media types.</span></span> <span data-ttu-id="567d1-128">Эта структура содержит подмножество сведений, находящихся в **структуре \_ \_ типов мультимедиа DMO** — а именно — основной тип и подтип.</span><span class="sxs-lookup"><span data-stu-id="567d1-128">This structure contains a subset of the information found in the **DMO\_MEDIA\_TYPE** structure—namely the major type and the subtype.</span></span> <span data-ttu-id="567d1-129">Он не включает блок формата, поскольку блок формата обычно содержит сведения, которые слишком детализированы для включения в реестр, такие как высота и ширина изображения видео.</span><span class="sxs-lookup"><span data-stu-id="567d1-129">It does not include a format block, because the format block typically contains information that is too granular to include in the registry, such as the height and width of a video image.</span></span>

<span data-ttu-id="567d1-130">**Предпочтительные типы носителей**</span><span class="sxs-lookup"><span data-stu-id="567d1-130">**Preferred Media Types**</span></span>

<span data-ttu-id="567d1-131">После создания приложения DMO оно может запросить объекты DMO для поддерживаемых им типов мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="567d1-131">After the application has created a DMO, it can query the DMO for the media types it supports.</span></span> <span data-ttu-id="567d1-132">Для каждого потока DMO создает список типов мультимедиа (возможно, пустых), упорядоченный в порядке предпочтения.</span><span class="sxs-lookup"><span data-stu-id="567d1-132">For each stream, the DMO creates a list of media types (possibly empty), ranked in order of preference.</span></span> <span data-ttu-id="567d1-133">Методы [**имедиаобжект:: жетинпуттипе**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputtype) и [**Имедиаобжект:: жетаутпуттипе**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputtype) перечисляют предпочтительные типы.</span><span class="sxs-lookup"><span data-stu-id="567d1-133">The [**IMediaObject::GetInputType**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputtype) and [**IMediaObject::GetOutputType**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputtype) methods enumerate the preferred types.</span></span> <span data-ttu-id="567d1-134">Предпочтительные типы потока могут изменяться динамически, когда приложение задает типы носителей в других потоках.</span><span class="sxs-lookup"><span data-stu-id="567d1-134">A stream's preferred types can change dynamically when the application sets media types on other streams.</span></span> <span data-ttu-id="567d1-135">Например, список предпочтительных типов выходных данных может измениться после установки типа входных данных или наоборот.</span><span class="sxs-lookup"><span data-stu-id="567d1-135">For example, the list of preferred output types might change after the input type is set, or vice versa.</span></span> <span data-ttu-id="567d1-136">Однако DMO не требуется динамически обновлять предпочтительные типы.</span><span class="sxs-lookup"><span data-stu-id="567d1-136">However, the DMO is not required to update its preferred types dynamically.</span></span> <span data-ttu-id="567d1-137">Приложение не может предположить, что каждый тип, который он получает, является допустимым.</span><span class="sxs-lookup"><span data-stu-id="567d1-137">The application cannot assume that every type it receives is valid.</span></span> <span data-ttu-id="567d1-138">По этой причине методы [**имедиаобжект:: сетинпуттипе**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-setinputtype) и [**Имедиаобжект:: сетаутпуттипе**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-setoutputtype) поддерживают флаг для проверки определенного типа.</span><span class="sxs-lookup"><span data-stu-id="567d1-138">For this reason, the [**IMediaObject::SetInputType**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-setinputtype) and [**IMediaObject::SetOutputType**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-setoutputtype) methods support a flag for testing a specific type.</span></span>

<span data-ttu-id="567d1-139">Методы **жетинпуттипе** и **жетаутпуттипе** возвращают структуру **\_ \_ типа мультимедиа DMO** .</span><span class="sxs-lookup"><span data-stu-id="567d1-139">The **GetInputType** and **GetOutputType** methods both return a **DMO\_MEDIA\_TYPE** structure.</span></span> <span data-ttu-id="567d1-140">DMO может оставить часть информации в этой структуре пустой, чтобы указать диапазон типов.</span><span class="sxs-lookup"><span data-stu-id="567d1-140">The DMO can leave some of the information in this structure blank, to indicate a range of types.</span></span> <span data-ttu-id="567d1-141">Основной тип или подтип может иметь \_ значение GUID null, а блок формата может быть пустым (0 байт).</span><span class="sxs-lookup"><span data-stu-id="567d1-141">The major type or subtype can be GUID\_NULL, and the format block can be empty (zero bytes).</span></span> <span data-ttu-id="567d1-142">Если блок формата пуст, тип формата должен быть \_ РАВЕН GUID null.</span><span class="sxs-lookup"><span data-stu-id="567d1-142">If the format block is empty, the format type must be GUID\_NULL.</span></span>

<span data-ttu-id="567d1-143">После того как приложение установит все типы входных данных DMO, объекты DMO должны возвращать по крайней мере один полный тип для каждого потока вывода.</span><span class="sxs-lookup"><span data-stu-id="567d1-143">After the application sets all of a DMO's input types, the DMO should generally return at least one complete type for each output stream.</span></span> <span data-ttu-id="567d1-144">Полный тип вывода упрощает тестирование, и приложения могут использовать его в качестве разумного значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="567d1-144">A complete output type facilitates testing, and applications can use it as a reasonable default.</span></span> <span data-ttu-id="567d1-145">Это поведение зависит от тестового приложения DMO.</span><span class="sxs-lookup"><span data-stu-id="567d1-145">The DMO test application relies on this behavior.</span></span> <span data-ttu-id="567d1-146">(См. раздел [Использование приложения дмотест](using-the-dmotest-application.md).)</span><span class="sxs-lookup"><span data-stu-id="567d1-146">(See [Using the DMOTest Application](using-the-dmotest-application.md).)</span></span>

<span data-ttu-id="567d1-147">**Настройка типов мультимедиа**</span><span class="sxs-lookup"><span data-stu-id="567d1-147">**Setting the Media Types**</span></span>

<span data-ttu-id="567d1-148">Приложения используют методы **сетинпуттипе** и **сетаутпуттипе** для проверки, установки и очистки типов в указанном потоке.</span><span class="sxs-lookup"><span data-stu-id="567d1-148">Applications use the **SetInputType** and **SetOutputType** methods to test, set, or clear types on a specified stream.</span></span> <span data-ttu-id="567d1-149">Приложение должно полностью указать тип.</span><span class="sxs-lookup"><span data-stu-id="567d1-149">The application must fully specify the type.</span></span> <span data-ttu-id="567d1-150">DMO проверяет, может ли он принять предложенный тип.</span><span class="sxs-lookup"><span data-stu-id="567d1-150">The DMO verifies whether it can accept the proposed type.</span></span> <span data-ttu-id="567d1-151">Ответ может зависеть от того, какие типы были установлены для других потоков.</span><span class="sxs-lookup"><span data-stu-id="567d1-151">The answer may depend on which types have been set on other streams.</span></span> <span data-ttu-id="567d1-152">\_ \_ Флаг Clear Set ТИПЕФ-DMO \_ очищает тип потока, поэтому приложение может выполнить команду "обратное" и попробовать другое сочетание.</span><span class="sxs-lookup"><span data-stu-id="567d1-152">The DMO\_SET\_TYPEF\_CLEAR flag clears a stream's type, so the application can "back out" and try another combination.</span></span>

<span data-ttu-id="567d1-153">**Примеры сценариев**</span><span class="sxs-lookup"><span data-stu-id="567d1-153">**Example Scenarios**</span></span>

<span data-ttu-id="567d1-154">В следующих примерах описываются некоторые типичные сценарии, иллюстрирующие точки, сделанные в предыдущих разделах.</span><span class="sxs-lookup"><span data-stu-id="567d1-154">The following examples describe some typical scenarios, to illustrate the points made in the previous sections.</span></span>

-   <span data-ttu-id="567d1-155">**Видеодекодеры.**</span><span class="sxs-lookup"><span data-stu-id="567d1-155">**Video Decoders.**</span></span> <span data-ttu-id="567d1-156">В обычном видеодекодере тип ввода частично определяет тип выходных данных.</span><span class="sxs-lookup"><span data-stu-id="567d1-156">In a typical video decoder, the input type partly determines the output type.</span></span> <span data-ttu-id="567d1-157">Например, обычно оба потока должны иметь одинаковую частоту кадров и размеры изображения.</span><span class="sxs-lookup"><span data-stu-id="567d1-157">For example, usually both streams must have the same frame rate and image dimensions.</span></span> <span data-ttu-id="567d1-158">Один из вариантов — не определять предпочтительные типы выходных данных до тех пор, пока не будет задан тип входных данных.</span><span class="sxs-lookup"><span data-stu-id="567d1-158">One option is not to define any preferred output types until the input type is set.</span></span> <span data-ttu-id="567d1-159">Другой вариант — перечислить набор незавершенных типов, пропуская блок формата.</span><span class="sxs-lookup"><span data-stu-id="567d1-159">Another option is to enumerate a set of incomplete types, omitting the format block.</span></span> <span data-ttu-id="567d1-160">Используйте подтип для указания поддерживаемых несжатых типов, таких как 16-разрядный RGB, 24-разрядный RGB и т. д.</span><span class="sxs-lookup"><span data-stu-id="567d1-160">Use the subtype to indicate the supported uncompressed types, such as 16-bit RGB, 24-bit RGB, and so forth.</span></span> <span data-ttu-id="567d1-161">Кроме того, видеодекодеры обычно не поддерживают задание типа выходных данных перед входным типом.</span><span class="sxs-lookup"><span data-stu-id="567d1-161">Also, video decoders generally do not support setting the output type before the input type.</span></span> <span data-ttu-id="567d1-162">Обычным сценарием является декодирование из известного формата входных данных, чтобы это ограничение было разумным.</span><span class="sxs-lookup"><span data-stu-id="567d1-162">The usual scenario is to decode from a known input format, so this limitation is reasonable.</span></span>
-   <span data-ttu-id="567d1-163">**Звуковые декодеры.**</span><span class="sxs-lookup"><span data-stu-id="567d1-163">**Audio Decoders.**</span></span> <span data-ttu-id="567d1-164">Звуковой декодер может поддерживать ограниченный фиксированный набор выходных форматов.</span><span class="sxs-lookup"><span data-stu-id="567d1-164">An audio decoder might support a limited, fixed set of output formats.</span></span> <span data-ttu-id="567d1-165">В этом случае перед известным форматом входных данных может быть создан список предпочтительных форматов вывода.</span><span class="sxs-lookup"><span data-stu-id="567d1-165">In that case, it may be able to create a list of preferred output formats before the input format is known.</span></span>
-   <span data-ttu-id="567d1-166">**Программы сжатия.**</span><span class="sxs-lookup"><span data-stu-id="567d1-166">**Compressors.**</span></span> <span data-ttu-id="567d1-167">В большинстве случаев программа сжатия видео не может полностью указывать Предпочтительные форматы вывода, пока приложение не настроит входной формат и наоборот.</span><span class="sxs-lookup"><span data-stu-id="567d1-167">In most cases, a video compressor cannot fully specify its preferred output formats until the application sets the input format, and vice versa.</span></span> <span data-ttu-id="567d1-168">Вместо этого DMO должен возвращать неполный тип без блока Format.</span><span class="sxs-lookup"><span data-stu-id="567d1-168">Instead, the DMO should return an incomplete type with no format block.</span></span> <span data-ttu-id="567d1-169">Для сжатия звука и видео обычно приложению необходимо задать различные выходные параметры, например скорость потока.</span><span class="sxs-lookup"><span data-stu-id="567d1-169">For both audio and video compression, the application usually needs to set various output parameters, such as the bit rate.</span></span> <span data-ttu-id="567d1-170">Однако после установки типа входных данных программа сжатия должна вернуть по крайней мере один полный выходной тип по причинам, упомянутым выше.</span><span class="sxs-lookup"><span data-stu-id="567d1-170">However, after the input type is set, the compressor should return at least one complete output type, for the reasons mentioned previously.</span></span>

## <a name="related-topics"></a><span data-ttu-id="567d1-171">См. также</span><span class="sxs-lookup"><span data-stu-id="567d1-171">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="567d1-172">Написание DMO</span><span class="sxs-lookup"><span data-stu-id="567d1-172">Writing a DMO</span></span>](writing-a-dmo.md)
</dt> </dl>

 

 



