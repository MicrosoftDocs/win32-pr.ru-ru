---
description: Как аппаратные устройства участвуют в графе фильтра
ms.assetid: 27e1c097-9bb4-4f9c-b9f9-0d4225c0d290
title: Как аппаратные устройства участвуют в графе фильтра
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 68794bbc046e633e9a435b2628a20b8ea8aab174
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104494307"
---
# <a name="how-hardware-devices-participate-in-the-filter-graph"></a><span data-ttu-id="26bdd-103">Как аппаратные устройства участвуют в графе фильтра</span><span class="sxs-lookup"><span data-stu-id="26bdd-103">How Hardware Devices Participate in the Filter Graph</span></span>

<span data-ttu-id="26bdd-104">В этой статье описывается взаимодействие DirectShow с аудио и видео оборудованием.</span><span class="sxs-lookup"><span data-stu-id="26bdd-104">This article describes how DirectShow interacts with audio and video hardware.</span></span>

<span data-ttu-id="26bdd-105">**Фильтры оболочки**</span><span class="sxs-lookup"><span data-stu-id="26bdd-105">**Wrapper Filters**</span></span>

<span data-ttu-id="26bdd-106">Все фильтры DirectShow являются программными компонентами пользовательского режима.</span><span class="sxs-lookup"><span data-stu-id="26bdd-106">All DirectShow filters are user mode software components.</span></span> <span data-ttu-id="26bdd-107">Чтобы устройство с режимом ядра, например карта видеозаписи, присоединяется к графу фильтра DirectShow, оно должно быть представлено в виде фильтра в пользовательском режиме.</span><span class="sxs-lookup"><span data-stu-id="26bdd-107">In order for a kernel mode hardware device, such as a video capture card, to join a DirectShow filter graph, the device must be represented as a user-mode filter.</span></span> <span data-ttu-id="26bdd-108">Эта функция выполняется специальными фильтрами оболочки, поставляемыми с DirectShow.</span><span class="sxs-lookup"><span data-stu-id="26bdd-108">This function is performed by specialized "wrapper" filters provided with DirectShow.</span></span> <span data-ttu-id="26bdd-109">Эти фильтры включают фильтр [записи звука](audio-capture.md) , фильтр [записи VFW](vfw-capture-filter.md) , фильтр ТВ- [тюнера](tv-tuner-filter.md) , фильтр [ТВ-звука](tv-audio-filter.md) и [аналоговый фильтр видеомикшера](analog-video-crossbar-filter.md) .</span><span class="sxs-lookup"><span data-stu-id="26bdd-109">These filters include the [Audio Capture](audio-capture.md) filter, the [VFW Capture](vfw-capture-filter.md) filter, the [TV Tuner](tv-tuner-filter.md) filter, the [TV Audio](tv-audio-filter.md) filter, and the [Analog Video Crossbar](analog-video-crossbar-filter.md) filter.</span></span> <span data-ttu-id="26bdd-110">DirectShow также предоставляет фильтр с именем Кспрокси, который может представлять любой тип устройства потоковой передачи WDM (WDM).</span><span class="sxs-lookup"><span data-stu-id="26bdd-110">DirectShow also provides a filter called KsProxy, which can represent any type of Windows Driver Model (WDM) streaming device.</span></span> <span data-ttu-id="26bdd-111">Поставщики оборудования могут расширять Кспрокси для поддержки пользовательских функций, предоставляя *подключаемый модуль кспрокси*— COM-объект, агрегированный по кспрокси.</span><span class="sxs-lookup"><span data-stu-id="26bdd-111">Hardware vendors can extend KsProxy to support custom functionality, by providing a *Ksproxy plug-in*, which is a COM object aggregated by KsProxy.</span></span>

<span data-ttu-id="26bdd-112">Фильтры-оболочки предоставляют интерфейсы COM, представляющие возможности устройства.</span><span class="sxs-lookup"><span data-stu-id="26bdd-112">The wrapper filters expose COM interfaces that represent the capabilities of the device.</span></span> <span data-ttu-id="26bdd-113">Приложение использует эти интерфейсы для передачи информации в фильтр и обратно.</span><span class="sxs-lookup"><span data-stu-id="26bdd-113">The application uses these interfaces to pass information to and from the filter.</span></span> <span data-ttu-id="26bdd-114">Фильтр преобразует вызовы метода COM в вызовы драйвера устройства, передает эти сведения драйверу в режиме ядра, а затем преобразует результат обратно в приложение.</span><span class="sxs-lookup"><span data-stu-id="26bdd-114">The filter translates the COM method calls into device driver calls, passes that information to the driver in kernel mode, and then translates the result back to the application.</span></span> <span data-ttu-id="26bdd-115">Фильтры ТВ-тюнера, ТВ-аудио, аналогового видеомикшера и фильтров Кспрокси поддерживают настраиваемые свойства драйверов через интерфейс [**икспропертисет**](ikspropertyset.md) .</span><span class="sxs-lookup"><span data-stu-id="26bdd-115">The TV Tuner, TV Audio, Analog Video Crossbar, and KsProxy filters support custom driver properties through the [**IKsPropertySet**](ikspropertyset.md) interface.</span></span> <span data-ttu-id="26bdd-116">Фильтр записи VFW и фильтр записи звука не расширяемы таким образом.</span><span class="sxs-lookup"><span data-stu-id="26bdd-116">The VFW Capture filter and the Audio Capture filter are not extensible in this way.</span></span>

<span data-ttu-id="26bdd-117">Для разработчиков приложений фильтры-оболочки позволяют приложению управлять устройствами так же, как и любым другим фильтром DirectShow.</span><span class="sxs-lookup"><span data-stu-id="26bdd-117">For application developers, wrapper filters enable the application to control devices just as they control any other DirectShow filter.</span></span> <span data-ttu-id="26bdd-118">Никакого специального программирования не требуется; сведения о взаимодействии с устройством режима ядра инкапсулируются в фильтре.</span><span class="sxs-lookup"><span data-stu-id="26bdd-118">No special programming is required; the details of communicating with the kernel-mode device are encapsulated within the filter.</span></span>

<span data-ttu-id="26bdd-119">**Видео для устройств Windows**</span><span class="sxs-lookup"><span data-stu-id="26bdd-119">**Video for Windows Devices**</span></span>

<span data-ttu-id="26bdd-120">Фильтр записи VFW поддерживает более ранние видеокарты для захвата видео для Windows (VfW).</span><span class="sxs-lookup"><span data-stu-id="26bdd-120">The VFW Capture filter supports earlier Video for Windows (VfW) capture cards.</span></span> <span data-ttu-id="26bdd-121">Если на целевой системе имеется карта VfW, ее можно обнаружить и добавить на граф фильтра с помощью [перечислителя системных устройств](system-device-enumerator.md)DirectShow.</span><span class="sxs-lookup"><span data-stu-id="26bdd-121">When a VfW card is present on the target system, it can be discovered and added to the filter graph using the DirectShow [System Device Enumerator](system-device-enumerator.md).</span></span> <span data-ttu-id="26bdd-122">Дополнительные сведения см. в разделе [Перечисление устройств и фильтров](enumerating-devices-and-filters.md).</span><span class="sxs-lookup"><span data-stu-id="26bdd-122">For details, see [Enumerating Devices and Filters](enumerating-devices-and-filters.md).</span></span>

<span data-ttu-id="26bdd-123">**Звуковая запись и смешивание устройств (звуковые карты)**</span><span class="sxs-lookup"><span data-stu-id="26bdd-123">**Audio Capture and Mixing Devices (Sound Cards)**</span></span>

<span data-ttu-id="26bdd-124">Новые звуковые карты имеют розетки ввода для микрофонов и устройств других типов.</span><span class="sxs-lookup"><span data-stu-id="26bdd-124">Newer sound cards have input jacks for microphones and other types of devices.</span></span> <span data-ttu-id="26bdd-125">Как правило, эти карты также имеют встроенные возможности смешивания для управления томом, высоких частотой и низкие частоты каждого отдельного входа.</span><span class="sxs-lookup"><span data-stu-id="26bdd-125">Typically these cards also have on-board mixing capabilities for controlling the volume, treble, and bass of each individual input.</span></span> <span data-ttu-id="26bdd-126">В DirectShow входные и микшерные звуковые карты упаковываются фильтром записи звука.</span><span class="sxs-lookup"><span data-stu-id="26bdd-126">In DirectShow, the sound card's inputs and mixer are wrapped by the Audio Capture filter.</span></span> <span data-ttu-id="26bdd-127">Каждую звуковую карту можно обнаружить с помощью перечислителя системных устройств.</span><span class="sxs-lookup"><span data-stu-id="26bdd-127">Each sound card can be discovered with the System Device Enumerator.</span></span> <span data-ttu-id="26bdd-128">Чтобы просмотреть звуковые карты в системе, запустите Графедит и выберите категорию источники звукозаписи.</span><span class="sxs-lookup"><span data-stu-id="26bdd-128">To view the sound cards in your system, run GraphEdit and select from the Audio Capture Sources category.</span></span> <span data-ttu-id="26bdd-129">Каждый фильтр в этой категории является отдельным экземпляром фильтра записи звука.</span><span class="sxs-lookup"><span data-stu-id="26bdd-129">Each filter in that category is a separate instance of the Audio Capture filter.</span></span> <span data-ttu-id="26bdd-130">(См. раздел [Использование графедит](using-graphedit.md).)</span><span class="sxs-lookup"><span data-stu-id="26bdd-130">(See [Using GraphEdit](using-graphedit.md).)</span></span>

<span data-ttu-id="26bdd-131">**Устройства потоковой передачи WDM**</span><span class="sxs-lookup"><span data-stu-id="26bdd-131">**WDM Streaming Devices**</span></span>

<span data-ttu-id="26bdd-132">Новые аппаратные декодеры и карты захвата соответствуют спецификации WDM (WDM).</span><span class="sxs-lookup"><span data-stu-id="26bdd-132">Newer hardware decoders and capture cards conform to the Windows Driver Model (WDM) specification.</span></span> <span data-ttu-id="26bdd-133">Эти устройства обладают большей функциональностью, чем устройства VfW.</span><span class="sxs-lookup"><span data-stu-id="26bdd-133">These devices have greater functionality than VfW devices.</span></span> <span data-ttu-id="26bdd-134">Карты видеозаписи WDM могут поддерживать функции, недоступные в VfW, включая перечисление форматов записи, программное управление параметрами видео, такими как оттенок и яркость, Программный выбор ввода и поддержка ТВ-тюнера.</span><span class="sxs-lookup"><span data-stu-id="26bdd-134">WDM video capture cards can support features that are not available under VfW, including the enumeration of capture formats, programmatic control of video parameters such as hue and brightness, programmatic input selection, and TV Tuner support.</span></span>

<span data-ttu-id="26bdd-135">Для поддержки устройств потоковой передачи WDM в DirectShow предусмотрен фильтр Кспрокси (ksproxy.ax).</span><span class="sxs-lookup"><span data-stu-id="26bdd-135">To support WDM streaming devices, DirectShow provides the KsProxy filter (ksproxy.ax).</span></span> <span data-ttu-id="26bdd-136">Кспрокси назывался «фильтром Швейцарии армии нож», так как он делает так много различных вещей.</span><span class="sxs-lookup"><span data-stu-id="26bdd-136">KsProxy has been called the "Swiss Army Knife filter" because it does so many different things.</span></span> <span data-ttu-id="26bdd-137">Количество ПИН-кодов в фильтре и количество интерфейсов COM, предоставляемых фильтром, зависят от возможностей базового драйвера.</span><span class="sxs-lookup"><span data-stu-id="26bdd-137">The number of pins on the filter, and the number of COM interfaces exposed by the filter, depend on the capabilities of the underlying driver.</span></span> <span data-ttu-id="26bdd-138">Кспрокси не отображается в графе фильтра под именем "Кспрокси".</span><span class="sxs-lookup"><span data-stu-id="26bdd-138">KsProxy does not appear in the filter graph under the name "KsProxy."</span></span> <span data-ttu-id="26bdd-139">Он всегда принимает понятное имя устройства, которое находится в реестре.</span><span class="sxs-lookup"><span data-stu-id="26bdd-139">It always takes the friendly name of the device, which is found in the registry.</span></span> <span data-ttu-id="26bdd-140">Чтобы просмотреть устройства WDM в системе, запустите Графедит и выберите из категорий потоковой передачи WDM.</span><span class="sxs-lookup"><span data-stu-id="26bdd-140">To view the WDM devices on your system, run GraphEdit and select from the WDM Streaming categories.</span></span> <span data-ttu-id="26bdd-141">Даже если в системе имеется только одна карта WDM, она может содержать несколько устройств.</span><span class="sxs-lookup"><span data-stu-id="26bdd-141">Even if you have only one WDM card on your system, that card might contain more than one device.</span></span> <span data-ttu-id="26bdd-142">Каждое устройство представляется в виде отдельного фильтра, и каждый из этих фильтров на самом деле Кспрокси.</span><span class="sxs-lookup"><span data-stu-id="26bdd-142">Each device is represented as a separate filter, and each of these filters is actually KsProxy.</span></span>

<span data-ttu-id="26bdd-143">Приложение использует перечислитель системных устройств для поиска моникеров устройств WDM в системе.</span><span class="sxs-lookup"><span data-stu-id="26bdd-143">An application uses the System Device Enumerator to find WDM device monikers on the system.</span></span> <span data-ttu-id="26bdd-144">Экземпляр Кспрокси создается путем вызова **биндтубжект** для моникера.</span><span class="sxs-lookup"><span data-stu-id="26bdd-144">KsProxy is instantiated by calling **BindToObject** on the moniker.</span></span> <span data-ttu-id="26bdd-145">Так как Кспрокси может представлять все виды устройств WDM, он должен запросить драйвер, чтобы определить, какие из свойств поддерживаются драйвером.</span><span class="sxs-lookup"><span data-stu-id="26bdd-145">Because KsProxy can represent all kinds of WDM devices, it must query the driver to determine which property sets the driver supports.</span></span> <span data-ttu-id="26bdd-146">Наборы свойств — это коллекции структур данных, используемых драйверами WDM, а также фильтры пользовательского режима, такие как программные декодеры MPEG-2.</span><span class="sxs-lookup"><span data-stu-id="26bdd-146">Property sets are collections of data structures used by WDM drivers, and also by some user mode filters, such as MPEG-2 software decoders.</span></span> <span data-ttu-id="26bdd-147">Кспрокси настраивается для предоставления интерфейсов COM, соответствующих этим наборам свойств.</span><span class="sxs-lookup"><span data-stu-id="26bdd-147">KsProxy configures itself to expose the COM interfaces that correspond to those property sets.</span></span> <span data-ttu-id="26bdd-148">Кспрокси преобразует вызовы COM-методов в наборы свойств и отправляет их драйверу.</span><span class="sxs-lookup"><span data-stu-id="26bdd-148">KsProxy translates the COM method calls into property sets and sends these to the driver.</span></span> <span data-ttu-id="26bdd-149">Поставщики оборудования могут расширять Кспрокси, предоставляя подключаемые модули, которые являются интерфейсами конкретного поставщика, которые предоставляют специальные возможности устройства.</span><span class="sxs-lookup"><span data-stu-id="26bdd-149">Hardware vendors can extend KsProxy by supplying plug-ins, which are vendor-specific interfaces that expose the special capabilities of a device.</span></span> <span data-ttu-id="26bdd-150">Все эти сведения скрыты от приложения.</span><span class="sxs-lookup"><span data-stu-id="26bdd-150">All these details are hidden from application.</span></span> <span data-ttu-id="26bdd-151">Приложение управляет устройством с помощью Кспрокси так же, как и любого другого фильтра DirectShow.</span><span class="sxs-lookup"><span data-stu-id="26bdd-151">The application controls the device by way of KsProxy, in the same way as any other DirectShow filter.</span></span>

<span data-ttu-id="26bdd-152">**Потоковая передача ядра**</span><span class="sxs-lookup"><span data-stu-id="26bdd-152">**Kernel Streaming**</span></span>

<span data-ttu-id="26bdd-153">Устройства WDM поддерживают потоковую передачу ядра, в котором данные полностью передаются в режиме ядра без переключения в пользовательский режим.</span><span class="sxs-lookup"><span data-stu-id="26bdd-153">WDM devices support kernel streaming, in which data is streamed entirely in kernel mode without ever switching to user mode.</span></span> <span data-ttu-id="26bdd-154">Переключение между режимом ядра и пользовательским режимом занимает много вычислительных ресурсов; Потоковая передача ядра обеспечивает высокую скорость передачи данных без нагрузки на ЦП узла.</span><span class="sxs-lookup"><span data-stu-id="26bdd-154">Switching between kernel mode and user mode is computationally expensive; kernel streaming allows for high bit rates without burdening the host CPU.</span></span> <span data-ttu-id="26bdd-155">Фильтры на основе WDM могут использовать потоковую передачу ядра для передачи мультимедийных данных непосредственно с одного аппаратного устройства на другое на одной карте или на другой карте без копирования данных в основную память системы.</span><span class="sxs-lookup"><span data-stu-id="26bdd-155">WDM-based filters can use kernel streaming to pass multimedia data directly from one hardware device to another, either on the same card or on a different card, without copying the data into the system's main memory.</span></span>

<span data-ttu-id="26bdd-156">С точки зрения приложения он выглядит так, как если бы данные переперемещались из одного фильтра пользовательского режима в следующий.</span><span class="sxs-lookup"><span data-stu-id="26bdd-156">From an application's point of view, it appears as if the data moves from one user-mode filter to the next.</span></span> <span data-ttu-id="26bdd-157">На практике данные могут никогда не передаваться в пользовательский режим, а могут передаваться напрямую из одного устройства режима ядра в другое, пока оно не будет отображено на видеоадаптере.</span><span class="sxs-lookup"><span data-stu-id="26bdd-157">In reality, the data might never pass into user mode at all, but instead might be streamed directly from one kernel-mode device to another until it is rendered on the video graphics card.</span></span> <span data-ttu-id="26bdd-158">В некоторых сценариях, например при записи в файл, требуется, чтобы данные в некоторый момент передавались из режима ядра в пользовательский режим.</span><span class="sxs-lookup"><span data-stu-id="26bdd-158">Some scenarios, such as capture to a file, require that the data pass from kernel mode to user mode at some point.</span></span> <span data-ttu-id="26bdd-159">Однако этот параметр не обязательно требует копирования данных в новое место в памяти.</span><span class="sxs-lookup"><span data-stu-id="26bdd-159">However, this switch does not necessarily require the data to be copied to a new location in memory.</span></span>

<span data-ttu-id="26bdd-160">Разработчикам приложений обычно не требуется заботиться о потоковой передаче ядра, за исключением фоновых сведений.</span><span class="sxs-lookup"><span data-stu-id="26bdd-160">Application developers generally do not need to be concerned with the details of kernel streaming, except as background information.</span></span> <span data-ttu-id="26bdd-161">Более подробные сведения о WDM, потоковой передаче в ядро, Кспрокси и связанных разделах см. в Microsoft DDK.</span><span class="sxs-lookup"><span data-stu-id="26bdd-161">See the Microsoft DDK for more detailed information about WDM, kernel streaming, KsProxy, and related topics.</span></span>

## <a name="related-topics"></a><span data-ttu-id="26bdd-162">См. также</span><span class="sxs-lookup"><span data-stu-id="26bdd-162">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="26bdd-163">Граф фильтра и его компоненты</span><span class="sxs-lookup"><span data-stu-id="26bdd-163">The Filter Graph and Its Components</span></span>](the-filter-graph-and-its-components.md)
</dt> </dl>

 

 



