---
description: Спецификация оперативного ускорения DirectX Video Иамвидеоакцелератор
ms.assetid: 25ee05d5-8554-4739-9122-e3c0255bf965
title: Спецификация оперативного ускорения DirectX Video Иамвидеоакцелератор
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3360e18e91197f2a15a36fb112f0419b6382e915
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "103989916"
---
# <a name="directx-video-acceleration-iamvideoaccelerator-operational-specification"></a><span data-ttu-id="5a2a8-103">Спецификация оперативного ускорения DirectX Video Иамвидеоакцелератор</span><span class="sxs-lookup"><span data-stu-id="5a2a8-103">DirectX Video Acceleration IAMVideoAccelerator Operational Specification</span></span>

<span data-ttu-id="5a2a8-104">Точный механизм работы выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="5a2a8-104">The precise mechanism of operation is as follows:</span></span>

1.  <span data-ttu-id="5a2a8-105">Каждый профиль с ограниченным режимом, определенный в этом документе, имеет связанный идентификатор GUID, который может поддерживаться нисходящим входным закреплением [**Ипин:: куерякцепт**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) и [**Ипин:: рецеивеконнектион**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) и перечислены в [**иамвидеоакцелератор:: жетвидеоакцелераторгуидс**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getvideoacceleratorguids).</span><span class="sxs-lookup"><span data-stu-id="5a2a8-105">Each restricted mode profile defined herein has an associated DirectX VA GUID which can be supported by a downstream input pin's [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) and [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) and listed in [**IAMVideoAccelerator::GetVideoAcceleratorGUIDs**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getvideoacceleratorguids).</span></span>
2.  <span data-ttu-id="5a2a8-106">Аналогичным образом, каждый тип протокола шифрования для использования с DirectX, должен иметь соответствующий идентификатор GUID типа протокола шифрования, который может поддерживаться [**Ипин:: куерякцепт**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) и [**Ипин:: рецеивеконнектион**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) и перечислены в **иамвидеоакцелератор:: жетвидеоакцелераторгуидс**.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-106">Similarly, each encryption protocol type for use with DirectX VA shall have an associated encryption protocol type GUID which can be supported by a downstream input pin's [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) and [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) and listed in **IAMVideoAccelerator::GetVideoAcceleratorGUIDs**.</span></span> <span data-ttu-id="5a2a8-107">Параметр "без шифрования" GUID ДКСВА \_ не должен отправляться в этом списке, так как его поддержка является обязательной и, следовательно, неявной.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-107">The "no encryption" GUID DXVA\_NoEncrypt shall not be sent in this list, as support for it is required and therefore implicit.</span></span>
3.  <span data-ttu-id="5a2a8-108">После вызова [**Ипин:: рецеивеконнектион**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) для попытки соединения с нисходящим входным закреплением декодер [**Иамвидеоакцелераторнотифи:: жеткреатевидеоакцелератордата**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoacceleratornotify-getcreatevideoacceleratordata) должен возвращать указатель на \_ структуру данных DXVA ConnectMode, содержащую сведения о режиме соединения для соединения.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-108">After calling [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) to attempt a connection to the downstream input pin, the decoder's [**IAMVideoAcceleratorNotify::GetCreateVideoAcceleratorData**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoacceleratornotify-getcreatevideoacceleratordata) shall return a pointer to a DXVA\_ConnectMode data structure containing the connection mode information for the connection.</span></span> <span data-ttu-id="5a2a8-109">[**Иамвидеоакцелератор:: жеткомпбуфферинфо**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getcompbufferinfo) должен вызываться с \* пдвнумтипескомпбуфферс = 16 и возвращать информацию о сжатом буфере на основе соглашения о том, что номер типа каждого буфера (как определено в разделе 3,4 спецификации DirectX ва) можно использовать непосредственно в качестве индекса, начинающегося с нуля, в массиве **амвакомпбуфферинфо** структур данных, которые возвращаются.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-109">[**IAMVideoAccelerator::GetCompBufferInfo**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getcompbufferinfo) shall be called with \*pdwNumTypesCompBuffers = 16 and shall return compressed buffer information based on the convention that the type number of each buffer (as defined in Section 3.4 of the DirectX VA specification) can be used directly as the zero-based index into the array of **AMVACompBufferInfo** data structures that is returned.</span></span> <span data-ttu-id="5a2a8-110">Для этого требуется, чтобы для любых типов буферов, которые не будут использоваться (включая тип буфера 0, поскольку не определено использование этого типа буфера), драйвер ускорителя предоставит структуры данных Амвакомпбуфферинфо с каким-либо форматом значений параметров (например, Двнумкомпбуфферс = 0, Дввидстокреате = 0, Двхеигхттокреате = 0 и Двбитестоаллокате = 0).</span><span class="sxs-lookup"><span data-stu-id="5a2a8-110">This requires that for any buffer types that will not be used (including buffer type 0, since there is no defined use of that buffer type), the accelerator driver will provide AMVACompBufferInfo data structures with some form of "dummy" parameter values (such as dwNumCompBuffers=0, dwWidthToCreate=0, dwHeightToCreate=0, and dwBytesToAllocate=0).</span></span>
4.  <span data-ttu-id="5a2a8-111">События ДКСВА и связанные с ними буферы данных отправляются с помощью [**иамвидеоакцелератор:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span><span class="sxs-lookup"><span data-stu-id="5a2a8-111">DXVA function indications and associated data buffers are sent using [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span></span> <span data-ttu-id="5a2a8-112">Функция ДКСВА указывается в параметре Двфунктион вызова.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-112">The DXVA function is indicated in the dwFunction parameter of the call.</span></span> <span data-ttu-id="5a2a8-113">Единственные ДКСВА функции, относящиеся к инициализации, — это ДКСВА \_ конфигкуерйорреплифунк и дксва \_ енкриптпротоколфунк.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-113">The only DXVA functions that are relevant for initialization are DXVA\_ConfigQueryOrReplyFunc and DXVA\_EncryptProtocolFunc.</span></span>
    -   <span data-ttu-id="5a2a8-114">Если Двфунктион содержит ДКСВА \_ конфигкуерйорреплифунк, то указатель лпприватеинпутдата для передачи данных в ускоритель в этом вызове указывает на структуру данных конфигурации, указатель лпприватеаутпутдата для получения информации от ускорителя, указывающий на область, где может быть размещена альтернативная или повторяющаяся структура данных конфигурации, указатель памвабуфферинфо для массива AMVABUFFERINFO должен быть **равен null**, а dwNumBuffers должен быть равен нулю.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-114">If dwFunction contains a DXVA\_ConfigQueryOrReplyFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to a configuration data structure, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where an alternative or duplicate configuration data structure can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="5a2a8-115">Возвращаемое значение HRESULT содержит \_ признак s OK или s \_ false, или e \_ Fail или e \_ INVALIDARG или другое обозначение ошибки HRESULT в случае серьезной проблемы при выполнении протокола (например, недопустимый параметр конфигурации).</span><span class="sxs-lookup"><span data-stu-id="5a2a8-115">The returned HRESULT contains the S\_OK or S\_FALSE indication, or E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution (such as an invalid configuration parameter).</span></span> <span data-ttu-id="5a2a8-116">Все вызовы **иамвидеоакцелератор:: Execute** для всех применений дксва \_ конфигкуерйорреплифунк должны предшествовать всем остальным вызовам **иамвидеоакцелератор:: Execute**.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-116">All calls to **IAMVideoAccelerator::Execute** for all uses of DXVA\_ConfigQueryOrReplyFunc shall precede all other calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="5a2a8-117">Если Двфунктион содержит ДКСВА \_ енкриптпротоколфунк, то указатель лпприватеинпутдата для передачи данных в ускоритель в этом вызове должен указывать на структуру данных протокола шифрования, которая начинается с дксва \_ енкриптпротоколхеадер, указатель lpPrivateOutputData для получения сведений от сочетания клавиш должен указывать на область, в которой должны быть возвращены данные (например, сертификат) по протоколу шифрования (который начинается с DXVA \_ EncryptProtocolHeader), указатель PAMVABUFFERINFO для массива AMVABUFFERINFO должен быть **равен null**, а dwNumBuffers — равняться нулю.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-117">If dwFunction contains a DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to an encryption protocol data structure that begins with DXVA\_EncryptProtocolHeader, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where the data to be returned (such as a certificate) by the encryption protocol (which will begin with DXVA\_EncryptProtocolHeader) can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="5a2a8-118">Возвращаемое значение HRESULT содержит S \_ ОК, если протокол шифрования работает нормально и содержит e \_ Fail или e \_ INVALIDARG или другое обозначение ошибки HRESULT в случае серьезной проблемы при выполнении протокола.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-118">The returned HRESULT contains S\_OK as long as the encryption protocol is functioning normally and contains E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution.</span></span>

        <span data-ttu-id="5a2a8-119">После инициализации операции в приведенном выше режиме фактическая операция декодера продолжается следующим образом:</span><span class="sxs-lookup"><span data-stu-id="5a2a8-119">After initialization of operation in the above fashion, the actual operation of the decoder proceeds as follows:</span></span>

5.  <span data-ttu-id="5a2a8-120">**Иамвидеоакцелератор:: бегинфраме** должен вызываться перед отправкой любых бдксва \_ Func с параметрами сжатого буфера, которые вызывают запись в несжатую конечную поверхность.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-120">**IAMVideoAccelerator::BeginFrame** shall be called prior to sending any bDXVA\_Func with compressed buffer parameters which cause writes to an uncompressed destination surface.</span></span> <span data-ttu-id="5a2a8-121">Целью [**иамвидеоакцелератор:: бегинфраме**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) в DirectX ва является связывание целевых поверхностей со значениями индекса и уведомление драйвера ускорителя для инициации записи поверхности, чтобы драйвер мог ответить на то, что поверхность готова к перезаписи.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-121">The purpose of [**IAMVideoAccelerator::BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) in DirectX VA is to associate destination surfaces with index values and to notify the video accelerator driver of the intent to initiate writes a surface so that the driver can respond with an indication of whether the surface is ready to be overwritten.</span></span> <span data-ttu-id="5a2a8-122">Структура **амвабегинфрамеинфо** , передаваемая в **Иамвидеоакцелератор:: бегинфраме** , должна содержать указатель Пинпутдата на один параметр вбегинпиктуреиндекс Word, соответствующий индексу кадра, переданному в **IAMVideoAccelerator:: BeginFrame** (и dwSizeInputData должен быть 2).</span><span class="sxs-lookup"><span data-stu-id="5a2a8-122">The **AMVABeginFrameInfo** structure passed in **IAMVideoAccelerator::BeginFrame** shall contain a pInputData pointer to single WORD wBeginPictureIndex parameter matching the frame index passed into **IAMVideoAccelerator::BeginFrame** (and dwSizeInputData shall be 2).</span></span> <span data-ttu-id="5a2a8-123">Это индекс, который будет использоваться в сжатом буфере для команды записи в область (например, для использования в качестве Вдекодедпиктуреиндекс, Вдеблоккедпиктуреиндекс, Вблендеддестинатиониндекс или ВпикресампледестпиЦиндекс).</span><span class="sxs-lookup"><span data-stu-id="5a2a8-123">This is the index to be used in a compressed buffer to command a write to the surface (for example, to be used as wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex).</span></span> <span data-ttu-id="5a2a8-124">Каждый вызов **иамвидеоакцелератор:: бегинфраме** должен быть связан с соответствующим вызовом [**Иамвидеоакцелератор:: ендфраме**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) , как описано ниже.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-124">Each call to **IAMVideoAccelerator::BeginFrame** shall be paired with a corresponding call to [**IAMVideoAccelerator::EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) as described below.</span></span> <span data-ttu-id="5a2a8-125">Например, если сжатая картинка должна быть декодирована, а затем в альфа-смешение с помощью внешнего интерфейса, перекрывающегося из буфера в буфер с графическим изображением, будет вызван вызов **иамвидеоакцелератор:: бегинфраме** перед декодированием сжатого изображения в область, указанную в вдекодедпиктуреиндекс, затем вызывается метод **Иамвидеоакцелератор:: ендфраме** после передачи всех сжатых буферов, используемых для декодирования изображения, затем второй вызов **IAMVideoAccelerator:: BeginFrame** перед сочетанием альфа-смешения цвета источника с декодированным изображением в поверхность, указанную в WBlendedDestinationIndex, а затем второй вызов **IAMVideoAccelerator:: EndFrame** после операции сочетания альфа-смешения. Указатель Паутпутдата в Амвабегинфрамеинфо должен иметь **значение NULL** (и двсизеаутпутдата должен быть "0").</span><span class="sxs-lookup"><span data-stu-id="5a2a8-125">For example, if a compressed picture is to be decoded and then alpha blended using front-end buffer-to-buffer blending with a graphic image, there would be a call to **IAMVideoAccelerator::BeginFrame** prior to decoding the compressed picture into a surface specified in wDecodedPictureIndex, then a call to **IAMVideoAccelerator::EndFrame** after passing all compressed buffers used to decode the picture, then a second call to **IAMVideoAccelerator::BeginFrame** prior to commanding alpha blending combination of the graphic source with the decoded picture into a surface specified in wBlendedDestinationIndex, and then a second call to **IAMVideoAccelerator::EndFrame** after the alpha blend combination operation.The pointer pOutputData in AMVABeginFrameInfo shall be **NULL** (and dwSizeOutputData shall be "0").</span></span> <span data-ttu-id="5a2a8-126">Значение HRESULT, возвращаемое функцией **иамвидеоакцелератор:: бегинфраме** , должно быть следующим:</span><span class="sxs-lookup"><span data-stu-id="5a2a8-126">The HRESULT that is returned by **IAMVideoAccelerator::BeginFrame** shall be:</span></span>
    -   <span data-ttu-id="5a2a8-127">\_ОК, если несжатая поверхность доступна и готова к использованию.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-127">S\_OK if the uncompressed surface is available and ready for use.</span></span>
    -   <span data-ttu-id="5a2a8-128">\_В ожидании, если несжатая поверхность еще недоступна для использования, но скоро станет доступна (если несжатая поверхность считывается для отображения и чтение/отображение поверхности еще не завершено).</span><span class="sxs-lookup"><span data-stu-id="5a2a8-128">E\_PENDING if the uncompressed surface is not yet available for use but will become available soon (if the uncompressed surface is being read for display and the reading/display of the surface has not yet been completed).</span></span>
    -   <span data-ttu-id="5a2a8-129">E \_ Fail или e \_ INVALIDARG другое уведомление об ошибке, только если обнаружена ошибка формата данных или протокола (например, неверное значение двсизеинпутдата или паутпутдата, отличное от **null** ).</span><span class="sxs-lookup"><span data-stu-id="5a2a8-129">E\_FAIL or E\_INVALIDARG some other error indication only if a data format or protocol error is detected (such as an incorrect value of dwSizeInputData or a non-**NULL** pOutputData).</span></span>
6.  <span data-ttu-id="5a2a8-130">События ДКСВА и связанные с ними буферы данных отправляются с помощью **иамвидеоакцелератор:: Execute**.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-130">DXVA function indications and associated data buffers are sent using **IAMVideoAccelerator::Execute**.</span></span> <span data-ttu-id="5a2a8-131">\_В одном вызове [**иамвидеоакцелератор:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute)может быть указано более одного значения бдксва Func.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-131">More than one bDXVA\_Func value may be indicated in the same call to [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span></span> <span data-ttu-id="5a2a8-132">Значения Бдксва \_ Func должны быть упакованы в параметр двфунктион вызова с первой командой функции в восьми МСБС, следующей командой в следующих восьми битах и так далее, при этом все оставшиеся биты заканчиваются нулями.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-132">The bDXVA\_Func values shall be packed into the dwFunction parameter of the call, with the first function command in the eight MSBs, the next command in the next eight bits, and so on, with any remaining bits padded out with zeros.</span></span> <span data-ttu-id="5a2a8-133">Значение 0xFF для Бдксва \_ Func указывает, что бдксва \_ Func расширяется до двух или четырех байт.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-133">The value 0xFF for bDXVA\_Func indicates that the bDXVA\_Func is extended to two or four bytes.</span></span> <span data-ttu-id="5a2a8-134">Если второй байт является также 0xFF, это означает, что Бдксва \_ Func расширен до четырех байтов.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-134">If the second byte is also 0xFF, this indicates that bDXVA\_Func is extended to four bytes.</span></span> <span data-ttu-id="5a2a8-135">Если верхние четыре бита третьего байта являются 0xF или 0x0, это означает, что Бдксва \_ Func содержит дксва \_ КОНФИГКУЕРЙОРРЕПЛИФУНК или дксва \_ енкриптпротоколфунк.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-135">If the upper four bits of the third byte are 0xF or 0x0, this indicates that bDXVA\_Func contains a DXVA\_ConfigQueryOrReplyFunc or DXVA\_EncryptProtocolFunc.</span></span> <span data-ttu-id="5a2a8-136">Многобайтовые команды не должны указывать на продолжение после окончания Двфунктион.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-136">Multi-byte commands shall not indicate continuation past the end of dwFunction.</span></span> <span data-ttu-id="5a2a8-137">Будьте осторожны с помощью декодера, чтобы убедиться, что между различными \_ значениями бдксва Func, заданными в одном вызове иамвидеоакцелератор, не существует последовательных зависимостей. **выполнение** и то, что все возможные состояния гонки (например, между декодированием изображений и наложением подизображений, между загрузкой подизображения и наложением подизображения и т. д.) препятствуют выполнению соответствующих вызовов **иамвидеоакцелератор:: бегинфраме** и [**иамвидеоакцелератор:: куерирендерстатус**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) до последующих вызовов **IAMVideoAccelerator:: Execute**.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-137">Care must be taken by the decoder to ensure that no sequential dependencies are present between different bDXVA\_Func values specified in the same call to **IAMVideoAccelerator::Execute** and that all potential race conditions (such as between picture decoding and sub-picture blending, between sub-picture loading and sub-picture blending, and so on) are prevented by appropriate calls to **IAMVideoAccelerator::BeginFrame** and [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) before subsequent calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="5a2a8-138">Если Двфунктион содержит ДКСВА \_ конфигкуерйорреплифунк, то указатель лпприватеинпутдата для передачи данных в ускоритель в этом вызове указывает на структуру данных конфигурации, указатель лпприватеаутпутдата для получения информации от ускорителя, указывающий на область, где может быть размещена альтернативная или повторяющаяся структура данных конфигурации, указатель памвабуфферинфо для массива AMVABUFFERINFO должен быть **равен null**, а dwNumBuffers должен быть равен нулю.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-138">If dwFunction contains a DXVA\_ConfigQueryOrReplyFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to a configuration data structure, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where an alternative or duplicate configuration data structure can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="5a2a8-139">Возвращаемое значение HRESULT содержит значение S \_ ОК или s \_ false в ответ на запрос, или e \_ Fail или e \_ INVALIDARG другое обозначение ошибки HRESULT в случае серьезной проблемы при выполнении протокола (например, в параметре фигурации invalid.config).</span><span class="sxs-lookup"><span data-stu-id="5a2a8-139">The returned HRESULT contains the S\_OK or S\_FALSE indication in response to the query, or E\_FAIL or E\_INVALIDARG some other error indication HRESULT in the event of a severe problem in protocol execution (such as an invalid.configuration parameter).</span></span> <span data-ttu-id="5a2a8-140">Все вызовы **иамвидеоакцелератор:: Execute** для всех применений дксва \_ конфигкуерйорреплифунк должны предшествовать всем остальным вызовам **иамвидеоакцелератор:: Execute**.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-140">All calls to **IAMVideoAccelerator::Execute** for all uses of DXVA\_ConfigQueryOrReplyFunc shall precede all other calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="5a2a8-141">Если Двфунктион содержит ДКСВА \_ енкриптпротоколфунк, то указатель лпприватеинпутдата для передачи данных в ускоритель в этом вызове должен указывать на структуру данных протокола шифрования, которая начинается с дксва \_ енкриптпротоколхеадер, указатель lpPrivateOutputData для получения сведений от сочетания клавиш должен указывать на область, в которой должны быть возвращены данные (например, сертификат) по протоколу шифрования (который начинается с DXVA \_ EncryptProtocolHeader), указатель PAMVABUFFERINFO для массива AMVABUFFERINFO должен быть **равен null**, а dwNumBuffers — равняться нулю.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-141">If dwFunction contains a DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to an encryption protocol data structure that begins with DXVA\_EncryptProtocolHeader, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where the data to be returned (such as a certificate) by the encryption protocol (which will begin with DXVA\_EncryptProtocolHeader) can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="5a2a8-142">Возвращаемое значение HRESULT содержит S \_ ОК, если протокол шифрования работает нормально и содержит e \_ Fail или e \_ INVALIDARG или другое обозначение ошибки HRESULT в случае серьезной проблемы при выполнении протокола.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-142">The returned HRESULT contains S\_OK as long as the encryption protocol is functioning normally and contains E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution.</span></span>
    -   <span data-ttu-id="5a2a8-143">Если Двфунктион не содержит ДКСВА \_ конфигкуерйорреплифунк или дксва \_ енкриптпротоколфунк, то указатель лпприватеинпутдата для передачи данных в ускоритель должен указывать на список описания буфера.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-143">If dwFunction does not contain a DXVA\_ConfigQueryOrReplyFunc or DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator shall point to a buffer description list.</span></span> <span data-ttu-id="5a2a8-144">Первые четыре записи в структуре списка буферных описаний для каждого буфера (Двтипеиндекс, Двбуффериндекс, Двдатаоффсет и Двдатасизе) должны быть равны значениям в структуре данных АМВАБУФФЕРИНФО для одного и того же буфера.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-144">The first four entries in the buffer description list structure for each buffer (dwTypeIndex, dwBufferIndex, dwDataOffset, and dwDataSize) shall be equal to those in the AMVABUFFERINFO data structure for the same buffer.</span></span> <span data-ttu-id="5a2a8-145">Если Бдксва \_ Func равно "1" в двфунктион, а бпикреадбаккрекуестс — "1", указатель лпприватеаутпутдата для получения сведений от сочетания клавиш должен указывать на область постоянной памяти (например, кучу), которая должна быть заполнена данными макроблокк, передаваемых из ускорителя (такие данные не гарантированно будут представлены до тех пор, пока **иамвидеоакцелератор:: QueryRenderStatus** для записи в тот же буфер параметров изображения, \_ как описано в элементе 10 ниже).</span><span class="sxs-lookup"><span data-stu-id="5a2a8-145">If bDXVA\_Func is equal to "1" is specified within dwFunction and bPicReadbackRequests is "1", the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area of persistent memory (for example heap) to be filled in with read-back macroblock data from the accelerator (such data not guaranteed to be present until **IAMVideoAccelerator::QueryRenderStatus** for writing to the same picture parameters buffer indicates S\_OK as described in item 10 below).</span></span> <span data-ttu-id="5a2a8-146">В противном случае указатель Лпприватеаутпутдата для получения сведений от сочетания клавиш должен указывать на одиночный DWORD, чтобы задать одно из следующих значений индикации (особенно полезно для сообщения об ошибках битовый поток в ВЛД операции вне узла).</span><span class="sxs-lookup"><span data-stu-id="5a2a8-146">Otherwise, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to a single DWORD to be set to one of the following indication values (particularly useful for reporting bitstream errors in off-host VLD operation).</span></span>

        | <span data-ttu-id="5a2a8-147">Значение</span><span class="sxs-lookup"><span data-stu-id="5a2a8-147">Value</span></span> | <span data-ttu-id="5a2a8-148">Описание</span><span class="sxs-lookup"><span data-stu-id="5a2a8-148">Description</span></span>                                     |
        |-------|-------------------------------------------------|
        | <span data-ttu-id="5a2a8-149">0</span><span class="sxs-lookup"><span data-stu-id="5a2a8-149">0</span></span>     | <span data-ttu-id="5a2a8-150">Выполнение ОК.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-150">Execution OK.</span></span>                                   |
        | <span data-ttu-id="5a2a8-151">1</span><span class="sxs-lookup"><span data-stu-id="5a2a8-151">1</span></span>     | <span data-ttu-id="5a2a8-152">Обнаружена незначительная проблема в формате данных.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-152">Minor problem in data format encountered.</span></span>       |
        | <span data-ttu-id="5a2a8-153">2</span><span class="sxs-lookup"><span data-stu-id="5a2a8-153">2</span></span>     | <span data-ttu-id="5a2a8-154">Обнаружена значительная проблема в формате данных.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-154">Significant problem in data format encountered.</span></span> |
        | <span data-ttu-id="5a2a8-155">3</span><span class="sxs-lookup"><span data-stu-id="5a2a8-155">3</span></span>     | <span data-ttu-id="5a2a8-156">Обнаружена серьезная проблема в формате данных.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-156">Severe problem in data format encountered.</span></span>      |
        | <span data-ttu-id="5a2a8-157">4</span><span class="sxs-lookup"><span data-stu-id="5a2a8-157">4</span></span>     | <span data-ttu-id="5a2a8-158">Возникла другая серьезная проблема.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-158">Other severe problem encountered.</span></span>               |

        

         

        <span data-ttu-id="5a2a8-159">Если выводится серьезная проблема, программный декодер прекращает работать с функциями, если не может быть выполнено корректирующее действие.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-159">If either type of "severe" problem is indicated, the software decoder should cease to operate the function(s) unless corrective action can be taken.</span></span> <span data-ttu-id="5a2a8-160">Эти данные, возвращенные с помощью сочетания клавиш, не должны считываться узлом до тех пор, пока не завершится подготовка буфера для изображения, что можно проверить с помощью [**иамвидеоакцелератор:: куерирендерстатус**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus).</span><span class="sxs-lookup"><span data-stu-id="5a2a8-160">This data returned from the accelerator shall not be read by the host until after the buffer rendering for the picture has completed, as can be tested by [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus).</span></span> <span data-ttu-id="5a2a8-161">Возвращаемое значение HRESULT содержит S \_ ОК, если операция интерфейса работает нормально и может возвращать e \_ Fail или e \_ INVALIDARG или другое обозначение ошибки HRESULT в случае серьезной проблемы.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-161">The returned HRESULT contains S\_OK as long as the interface operation is functioning normally and may return E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem.</span></span>

7.  <span data-ttu-id="5a2a8-162">Буфер параметров декодирования изображения должен быть в одном из первых буферов, отправленных для декодирования каждого изображения при использовании [**иамвидеоакцелератор:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute) с бдксва \_ Func, равным "1", и все буферы для декодирования изображения в битовый поток должны быть отправлены перед любыми буферами для декодирования последующих изображений.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-162">The picture decoding parameters buffer shall be among the first buffers sent for the decoding of each picture when using [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute) with bDXVA\_Func equal to "1", and all the buffers for decoding a picture in a bitstream shall be sent before any buffers for decoding subsequent pictures.</span></span> <span data-ttu-id="5a2a8-163">При отправке буфера команд элемента управления макроблокк необходимо отправить соответствующий буфер данных о остаточной разнице (содержащий данные для одного макроблоккс) с тем же вызовом **иамвидеоакцелератор:: Execute** .</span><span class="sxs-lookup"><span data-stu-id="5a2a8-163">If a macroblock control command buffer is sent, a corresponding residual difference data buffer shall be sent (containing data for the same macroblocks) with the same **IAMVideoAccelerator::Execute** call.</span></span>
8.  <span data-ttu-id="5a2a8-164">[**Иамвидеоакцелератор:: ендфраме**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) должен вызываться после отправки всех сжатых буферов, что приведет к созданию выходного содержимого в заданной несжатой поверхности (результат операций указан для Вдекодедпиктуреиндекс, Вдеблоккедпиктуреиндекс, Вблендеддестинатиониндекс или wPicResampleDestPicIndex).</span><span class="sxs-lookup"><span data-stu-id="5a2a8-164">[**IAMVideoAccelerator::EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) shall be called after all compressed buffers have been sent that will cause the creation of the output content in a specified uncompressed surface (a result of operations specified for wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex).</span></span> <span data-ttu-id="5a2a8-165">Целью этого вызова к **иамвидеоакцелератор:: ендфраме** является уведомление оборудования ускорителя о том, что все данные, необходимые для указанной операции, отправлены.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-165">The purpose of this call to **IAMVideoAccelerator::EndFrame** is to notify the video accelerator hardware that all data needed for the specified operation has been sent.</span></span> <span data-ttu-id="5a2a8-166">Указатель на данные, которые будут отправлены через **иамвидеоакцелератор:: ендфраме** , указывает на одно слово вендпиктуреиндекс, содержащее индекс завершенного кадра.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-166">The pointer to data to send downstream through **IAMVideoAccelerator::EndFrame** shall point to a single WORD wEndPictureIndex containing the index of the frame that is ending.</span></span> <span data-ttu-id="5a2a8-167">Этот параметр должен соответствовать значению Вбегинпиктуреиндекс, указанному в предыдущем вызове метода [**иамвидеоакцелератор:: бегинфраме**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) перед отправкой соответствующих сжатых буферов.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-167">This parameter shall match the wBeginPictureIndex value specified in the prior call to [**IAMVideoAccelerator::BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) before the sending of the relevant compressed buffers.</span></span> <span data-ttu-id="5a2a8-168">После вызова **иамвидеоакцелератор:: ендфраме** несжатая поверхность с индексом вендпиктуреиндекс не найдена ни в Вдекодедпиктуреиндекс, Вдеблоккедпиктуреиндекс, wBlendedDestinationIndex, ни в wPicResampleDestPicIndex до тех пор, пока не будет вызван еще один вызов **IAMVideoAccelerator:: BeginFrame** , чтобы объявить о том, что это произойдет, и в \_ результате возвращается значение ОК.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-168">Subsequent to a call to **IAMVideoAccelerator::EndFrame**, the uncompressed surface with index wEndPictureIndex shall not be found in any picture's wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex until after another call to **IAMVideoAccelerator::BeginFrame** is issued to announce that this will occur and an S\_OK has been returned as a result.</span></span> <span data-ttu-id="5a2a8-169">Однако индекс конечной поверхности может встречаться в последующих командах чтения, таких как Вфорвардрефпиктуреиндекс, Вбакквардрефпиктуреиндекс, ВпикресамплесаурцепиЦиндекс или Брефпикселект \[ i \] .</span><span class="sxs-lookup"><span data-stu-id="5a2a8-169">However, that destination surface index may occur in subsequent read access commands such as wForwardRefPictureIndex, wBackwardRefPictureIndex, wPicResampleSourcePicIndex, or bRefPicSelect\[i\].</span></span> <span data-ttu-id="5a2a8-170">Значение HRESULT, возвращаемое функцией **иамвидеоакцелератор:: ендфраме** , должно быть равно " \_ ОК", если не существует какого-либо формата данных или ошибки протокола, в этом случае может быть E \_ Fail или e \_ INVALIDARG или другое указание ошибки.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-170">The HRESULT returned by **IAMVideoAccelerator::EndFrame** shall be S\_OK unless there is some kind of data format or protocol error, in which case it can be E\_FAIL or E\_INVALIDARG or some other error indication.</span></span>
9.  <span data-ttu-id="5a2a8-171">В случае декодирования на основе полей (например, в MPEG-2 битстреамс) в интерфейсе ускорителя не будет однозначно сопоставлять функциональные рисунки в битовый поток с несжатыми областями.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-171">In the case of field based decoding (for example, in MPEG-2 bitstreams) there will not be a one-to-one mapping of functional pictures in the bitstream to uncompressed surfaces in the accelerator interface.</span></span> <span data-ttu-id="5a2a8-172">При декодировании изображений в формате MPEG-2 битовый поток будет раскодировано два рисунка для создания одного полного выходного несжатого изображения поверхности.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-172">When decoding field pictures in an MPEG-2 bitstream, there will be two "pictures" decoded to produce one complete output uncompressed surface.</span></span> <span data-ttu-id="5a2a8-173">В определении интерфейса DirectX ва каждый кадр соответствует каждому использованию Вдекодедпиктуреиндекс, Вдеблоккедпиктуреиндекс, Вблендеддестинатиониндекс или ВпикресампледестпиЦиндекс.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-173">In the DirectX VA interface definition, each frame corresponds to each use of wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex.</span></span> <span data-ttu-id="5a2a8-174">Таким образом, две пары вызовов **иамвидеоакцелератор:: бегинфраме** и **Иамвидеоакцелератор:: ендфраме** необходимы для расшифровки рисунков полей на выходных несжатых поверхностях.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-174">Thus two pairs of calls to **IAMVideoAccelerator::BeginFrame** and **IAMVideoAccelerator::EndFrame** are required for the decoding of field pictures into output uncompressed surfaces.</span></span>
10. <span data-ttu-id="5a2a8-175">Вызов [**иамвидеоакцелератор:: куерирендерстатус**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) с dwFlags равным нулю, который происходит после вызова **Иамвидеоакцелератор:: Ендфраме** с определенным вендпиктуреиндекс и проверяет состояние буфера, который был отправлен, который содержал WEndPictureIndex в WDecodedPictureIndex, WDeblockedPictureIndex, wBlendedDestinationIndex или WPicResampleDestPicIndex, возвращает значение S \_ ОК, если все операции записи данных на несжатую поверхность завершены и будут возвращать E \_ Pending, если операция еще не завершена.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-175">A call to [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) with dwFlags equal to zero which occurs sometime after a call to **IAMVideoAccelerator::EndFrame** with a particular wEndPictureIndex and checks the status of a buffer that was sent that contained the wEndPictureIndex in wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex will return an S\_OK indication if all of the operations to write the data to the uncompressed surface have completed and will return E\_PENDING if the operation has not yet completed.</span></span> <span data-ttu-id="5a2a8-176">E \_ Fail или e \_ INVALIDARG или другие признаки ошибки могут возвращаться в случае ошибки протокола.</span><span class="sxs-lookup"><span data-stu-id="5a2a8-176">E\_FAIL or E\_INVALIDARG or some other error indication may be returned in the event of a protocol error.</span></span>

## <a name="related-topics"></a><span data-ttu-id="5a2a8-177">См. также</span><span class="sxs-lookup"><span data-stu-id="5a2a8-177">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="5a2a8-178">Сопоставление ускорения видео DirectX с Иамвидеоакцелератор</span><span class="sxs-lookup"><span data-stu-id="5a2a8-178">Mapping DirectX Video Acceleration to IAMVideoAccelerator</span></span>](mapping-directx-video-acceleration-to-iamvideoaccelerator.md)
</dt> </dl>

 

 



