---
description: Интеллектуальное подключение
ms.assetid: 938ba1b0-822e-4871-8786-b7eeee243867
title: Интеллектуальное подключение
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 12aead305867ccec1f1f1f0cbd76c652ba3ec412
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104495480"
---
# <a name="intelligent-connect"></a><span data-ttu-id="c4ef8-103">Интеллектуальное подключение</span><span class="sxs-lookup"><span data-stu-id="c4ef8-103">Intelligent Connect</span></span>

<span data-ttu-id="c4ef8-104">Интеллектуальное соединение — это механизм, используемый диспетчером графа фильтров для построения графов фильтра.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-104">Intelligent Connect is the mechanism the Filter Graph Manager uses to build filter graphs.</span></span> <span data-ttu-id="c4ef8-105">Он состоит из нескольких связанных алгоритмов, которые выбирают фильтры и добавляют их в граф фильтра.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-105">It consists of several related algorithms that select filters and add them to the filter graph.</span></span>

<span data-ttu-id="c4ef8-106">Прочтите этот раздел, если у вас возникли проблемы с построением определенного графа фильтра и хотите устранить проблему, или если вы пишете собственный фильтр и хотите сделать его доступным для автоматического построения графа.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-106">Read this topic if you are having trouble building a certain filter graph and want to troubleshoot the problem, or if you are writing your own filter and want to make it available for automatic graph building.</span></span>

<span data-ttu-id="c4ef8-107">Интеллектуальное соединение включает следующие методы [**играфбуилдер**](/windows/desktop/api/Strmif/nn-strmif-igraphbuilder) :</span><span class="sxs-lookup"><span data-stu-id="c4ef8-107">Intelligent Connect involves the following [**IGraphBuilder**](/windows/desktop/api/Strmif/nn-strmif-igraphbuilder) methods:</span></span>

-   [<span data-ttu-id="c4ef8-108">**Играфбуилдер:: Аддсаурцефилтер**</span><span class="sxs-lookup"><span data-stu-id="c4ef8-108">**IGraphBuilder::AddSourceFilter**</span></span>](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-addsourcefilter)
-   [<span data-ttu-id="c4ef8-109">**Играфбуилдер:: Render**</span><span class="sxs-lookup"><span data-stu-id="c4ef8-109">**IGraphBuilder::Render**</span></span>](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render)
-   [<span data-ttu-id="c4ef8-110">**Играфбуилдер:: RenderFile**</span><span class="sxs-lookup"><span data-stu-id="c4ef8-110">**IGraphBuilder::RenderFile**</span></span>](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-renderfile)
-   [<span data-ttu-id="c4ef8-111">**Играфбуилдер:: Connect**</span><span class="sxs-lookup"><span data-stu-id="c4ef8-111">**IGraphBuilder::Connect**</span></span>](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-connect)

### <a name="igraphbuilderaddsourcefilter"></a><span data-ttu-id="c4ef8-112">Играфбуилдер:: Аддсаурцефилтер</span><span class="sxs-lookup"><span data-stu-id="c4ef8-112">IGraphBuilder::AddSourceFilter</span></span>

<span data-ttu-id="c4ef8-113">Метод [**играфбуилдер:: аддсаурцефилтер**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-addsourcefilter) добавляет фильтр источника, который может визуализировать указанный файл.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-113">The [**IGraphBuilder::AddSourceFilter**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-addsourcefilter) method adds a source filter that can render a specified file.</span></span> <span data-ttu-id="c4ef8-114">Сначала он ищет в реестре и соответствует протоколу (например `https://` ,), расширению имени файла или набору предварительно определенных *байтов проверки*, которые представляют собой байты в определенном смещении в файле, соответствующем определенным шаблонам.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-114">First it looks in the registry and matches against the protocol (such as `https://`), the file name extension, or a set of predetermined *check bytes*, which are bytes at particular offsets in the file that match certain patterns.</span></span> <span data-ttu-id="c4ef8-115">Дополнительные сведения см. [в разделе Регистрация пользовательского типа файлов](registering-a-custom-file-type.md).</span><span class="sxs-lookup"><span data-stu-id="c4ef8-115">For details, see [Registering a Custom File Type](registering-a-custom-file-type.md).</span></span> <span data-ttu-id="c4ef8-116">Предполагая, что метод находит соответствующий фильтр источника, он создает экземпляр этого фильтра, добавляет его к графу и вызывает метод [**ифилесаурцефилтер:: Load**](/windows/desktop/api/Strmif/nf-strmif-ifilesourcefilter-load) фильтра с именем файла.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-116">Assuming that the method locates an appropriate source filter, it then creates an instance of that filter, adds it to the graph, and calls the filter's [**IFileSourceFilter::Load**](/windows/desktop/api/Strmif/nf-strmif-ifilesourcefilter-load) method with the file name.</span></span>

### <a name="igraphbuilderrender"></a><span data-ttu-id="c4ef8-117">Играфбуилдер:: Render</span><span class="sxs-lookup"><span data-stu-id="c4ef8-117">IGraphBuilder::Render</span></span>

<span data-ttu-id="c4ef8-118">Метод [**играфбуилдер:: Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) создает подраздел диаграммы.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-118">The [**IGraphBuilder::Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) method builds a subsection of a graph.</span></span> <span data-ttu-id="c4ef8-119">Он начинается с неподключенного выходного контакта и работает нисходящим образом, добавляя новые фильтры по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-119">It starts from an unconnected output pin and works downstream, adding new filters as needed.</span></span> <span data-ttu-id="c4ef8-120">Начальный фильтр уже должен быть в графе.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-120">The starting filter must already be in the graph.</span></span> <span data-ttu-id="c4ef8-121">На каждом шаге метод **Render** выполняет поиск фильтра, который может подключиться к предыдущему фильтру.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-121">At each step, the **Render** method searches for a filter that can connect to the previous filter.</span></span> <span data-ttu-id="c4ef8-122">Поток может быть разветвлен, если фильтр соединения имеет несколько выходных закрепления.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-122">The stream can branch if a connecting filter has multiple output pins.</span></span> <span data-ttu-id="c4ef8-123">Поиск останавливается, когда у каждого потока есть модуль подготовки отчетов.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-123">The search stops when every stream has a renderer.</span></span> <span data-ttu-id="c4ef8-124">Если метод **Render** зависает, он может выполнить резервное копирование и повторить попытку, используя другой набор фильтров.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-124">If the **Render** method gets stuck, it might back up and try again, using a different set of filters.</span></span>

<span data-ttu-id="c4ef8-125">Для подключения каждого выходного контакта метод [**Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) выполняет следующие действия:</span><span class="sxs-lookup"><span data-stu-id="c4ef8-125">To connect each output pin, the [**Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) method does the following:</span></span>

1.  <span data-ttu-id="c4ef8-126">Если ПИН-код поддерживает интерфейс [**истреамбуилдер**](/windows/desktop/api/Strmif/nn-strmif-istreambuilder) , диспетчер графа фильтров делегирует весь процесс методу [**Истреамбуилдер:: Render**](/windows/desktop/api/Strmif/nf-strmif-istreambuilder-render) контакта.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-126">If the pin supports the [**IStreamBuilder**](/windows/desktop/api/Strmif/nn-strmif-istreambuilder) interface, the Filter Graph Manager delegates the entire process to the pin's [**IStreamBuilder::Render**](/windows/desktop/api/Strmif/nf-strmif-istreambuilder-render) method.</span></span> <span data-ttu-id="c4ef8-127">При предоставлении доступа к этому интерфейсу ПИН-код принимает ответственность за построение оставшейся части графа в модуле подготовки отчетов.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-127">By exposing this interface, the pin assumes responsibility for building the remainder of the graph, down to the renderer.</span></span> <span data-ttu-id="c4ef8-128">Однако этот интерфейс поддерживается очень небольшими ПИН-контактами.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-128">However, very few pins support this interface.</span></span>
2.  <span data-ttu-id="c4ef8-129">Диспетчер графов фильтров пытается использовать фильтры, кэшированные в памяти, если таковые имеются.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-129">The Filter Graph Manager tries to use filters that are cached in memory, if any.</span></span> <span data-ttu-id="c4ef8-130">В рамках интеллектуального процесса подключения диспетчер графов фильтров может кэшировать фильтры из предыдущих шагов процесса.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-130">Throughout the Intelligent Connect process, the Filter Graph Manager may cache filters from earlier steps in the process.</span></span> <span data-ttu-id="c4ef8-131">(Также см. статью [динамическое построение графа](dynamic-graph-building.md).)</span><span class="sxs-lookup"><span data-stu-id="c4ef8-131">(Also, see [Dynamic Graph Building](dynamic-graph-building.md).)</span></span>
3.  <span data-ttu-id="c4ef8-132">Если граф фильтра содержит фильтры с неподключенными входными контактами, диспетчер графов фильтров попытается выполнить их далее.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-132">If the filter graph contains any filters with unconnected input pins, the Filter Graph Manager tries them next.</span></span> <span data-ttu-id="c4ef8-133">Можно принудительно применить определенный фильтр в методе [**Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) , добавив этот фильтр к графу перед вызовом **Render**.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-133">You can force the [**Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) method to try a particular filter by adding that filter to the graph before calling **Render**.</span></span>
4.  <span data-ttu-id="c4ef8-134">Начиная с Windows 7, DirectShow имеет список предпочтительных фильтров для определенных подтипов носителей.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-134">Starting in Windows 7, DirectShow has a list of preferred filters for certain media subtypes.</span></span> <span data-ttu-id="c4ef8-135">Если для отображаемого типа мультимедиа используется предпочтительный фильтр, диспетчер графа фильтров попытается выполнить фильтр далее.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-135">If there is a preferred filter for the media type that is being rendered, the Filter Graph Manager tries that filter next.</span></span> <span data-ttu-id="c4ef8-136">Приложение может изменить список предпочтительных фильтров с помощью интерфейса [**иамплугинконтрол**](/windows/desktop/api/Strmif/nn-strmif-iamplugincontrol) .</span><span class="sxs-lookup"><span data-stu-id="c4ef8-136">An application can modify the list of preferred filters by using the [**IAMPluginControl**](/windows/desktop/api/Strmif/nn-strmif-iamplugincontrol) interface.</span></span> <span data-ttu-id="c4ef8-137">Изменения в списке влияют на текущий процесс приложения и удаляются после завершения процесса.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-137">Changes to the list affect the application's current process, and are discarded after the process ends.</span></span>
5.  <span data-ttu-id="c4ef8-138">Наконец, если подходящий фильтр не найден, диспетчер графов фильтра выполняет поиск в реестре с помощью метода [**IFilterMapper2:: енумматчингфилтерс**](/windows/desktop/api/Strmif/nf-strmif-ifiltermapper2-enummatchingfilters) .</span><span class="sxs-lookup"><span data-stu-id="c4ef8-138">Finally, if no suitable filter has been found, the Filter Graph Manager searches the registry, using the [**IFilterMapper2::EnumMatchingFilters**](/windows/desktop/api/Strmif/nf-strmif-ifiltermapper2-enummatchingfilters) method.</span></span> <span data-ttu-id="c4ef8-139">Он пытается сопоставить предпочтительные типы выходных данных с типами носителей, перечисленными в реестре.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-139">It tries to match the output pin's preferred media types against media types listed in the registry.</span></span>

    <span data-ttu-id="c4ef8-140">Каждый фильтр зарегистрирован с недоступностью, числовым значением, *указывающим, насколько* предпочтительным является фильтр, относительно других фильтров.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-140">Each filter is registered with a *merit*, a numerical value that indicates how preferable the filter is, relative to other filters.</span></span> <span data-ttu-id="c4ef8-141">Метод [**енумматчингфилтерс**](/windows/desktop/api/Strmif/nf-strmif-ifiltermapper2-enummatchingfilters) Возвращает фильтры в порядке их следования, при **\_ этом \_ не следует \_ использовать** + 1.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-141">The [**EnumMatchingFilters**](/windows/desktop/api/Strmif/nf-strmif-ifiltermapper2-enummatchingfilters) method returns filters in order of merit, with a minimum merit of **MERIT\_DO\_NOT\_USE** + 1.</span></span> <span data-ttu-id="c4ef8-142">Он не учитывает фильтры с **\_ \_ недоступностью, но не \_ использует** или меньше.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-142">It ignores filters with a merit of **MERIT\_DO\_NOT\_USE** or less.</span></span> <span data-ttu-id="c4ef8-143">Фильтры также группируются по категориям, определяемым по GUID.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-143">Filters are also grouped into categories, defined by GUID.</span></span> <span data-ttu-id="c4ef8-144">Сами категории имеют свои преимущества, и метод **енумматчингфилтерс** игнорирует любую категорию с недостаточной степенью их **\_ \_ \_ использования** , даже если фильтры в этой категории имеют более высокие значения.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-144">Categories themselves have merit, and the **EnumMatchingFilters** method ignores any category with a merit of **MERIT\_DO\_NOT\_USE** or less, even if the filters in that category have higher merit values.</span></span>

    <span data-ttu-id="c4ef8-145">Начиная с Windows 7, DirectShow имеет список заблокированных фильтров для определенных подтипов носителей.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-145">Starting in Windows 7, DirectShow has a list of blocked filters for certain media subtypes.</span></span> <span data-ttu-id="c4ef8-146">Диспетчер графов фильтров пропускает фильтры в этом списке.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-146">The Filter Graph Manager skips filters on this list.</span></span> <span data-ttu-id="c4ef8-147">Приложение может изменить список заблокированных фильтров с помощью интерфейса [**иамплугинконтрол**](/windows/desktop/api/Strmif/nn-strmif-iamplugincontrol) .</span><span class="sxs-lookup"><span data-stu-id="c4ef8-147">An application can modify the list of blocked filters by using the [**IAMPluginControl**](/windows/desktop/api/Strmif/nn-strmif-iamplugincontrol) interface.</span></span> <span data-ttu-id="c4ef8-148">Изменения в этом списке влияют на текущий процесс приложения и удаляются после завершения процесса.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-148">Changes to this list affect the application's current process, and are discarded after the process ends.</span></span>

<span data-ttu-id="c4ef8-149">Для суммирования метод [**Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) пытается выполнить фильтры в следующем порядке:</span><span class="sxs-lookup"><span data-stu-id="c4ef8-149">To summarize, the [**Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) method tries filters in the following order:</span></span>

1.  <span data-ttu-id="c4ef8-150">Используйте [**истреамбуилдер**](/windows/desktop/api/Strmif/nn-strmif-istreambuilder).</span><span class="sxs-lookup"><span data-stu-id="c4ef8-150">Use [**IStreamBuilder**](/windows/desktop/api/Strmif/nn-strmif-istreambuilder).</span></span>
2.  <span data-ttu-id="c4ef8-151">Попробуйте использовать кэшированные фильтры.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-151">Try cached filters.</span></span>
3.  <span data-ttu-id="c4ef8-152">Фильтры Try в графе.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-152">Try filters in the graph.</span></span>
4.  <span data-ttu-id="c4ef8-153">Windows 7 или более поздней версии: попробуйте использовать предпочтительный фильтр для типа носителя, если он есть.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-153">Windows 7 or later: Try the preferred filter for the media type, if any.</span></span>
5.  <span data-ttu-id="c4ef8-154">Поиск фильтров в реестре.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-154">Look up filters in the registry.</span></span>

### <a name="igraphbuilderrenderfile"></a><span data-ttu-id="c4ef8-155">Играфбуилдер:: RenderFile</span><span class="sxs-lookup"><span data-stu-id="c4ef8-155">IGraphBuilder::RenderFile</span></span>

<span data-ttu-id="c4ef8-156">Метод [**играфбуилдер:: renderFile**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-renderfile) создает граф воспроизведения по умолчанию на основе имени файла.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-156">The [**IGraphBuilder::RenderFile**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-renderfile) method builds a default playback graph from a file name.</span></span> <span data-ttu-id="c4ef8-157">На внутреннем уровне этот метод использует [**аддсаурцефилтер**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-addsourcefilter) для нахождение правильного фильтра источника и [**отрисовки**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) для построения остальной части графа.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-157">Internally, this method uses [**AddSourceFilter**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-addsourcefilter) to locate the correct source filter, and [**Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) to build the rest of the graph.</span></span>

### <a name="igraphbuilderconnect"></a><span data-ttu-id="c4ef8-158">Играфбуилдер:: Connect</span><span class="sxs-lookup"><span data-stu-id="c4ef8-158">IGraphBuilder::Connect</span></span>

<span data-ttu-id="c4ef8-159">Метод [**играфбуилдер:: Connect**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-connect) подключает выходной контакт к входному ПИН-коду.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-159">The [**IGraphBuilder::Connect**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-connect) method connects an output pin to an input pin.</span></span> <span data-ttu-id="c4ef8-160">При необходимости этот метод добавляет промежуточные фильтры, используя разновидность алгоритма, описанного для метода [**Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) :</span><span class="sxs-lookup"><span data-stu-id="c4ef8-160">This method adds intermediate filters if needed, using a variation of the algorithm described for the [**Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) method:</span></span>

1.  <span data-ttu-id="c4ef8-161">Попробуйте прямое подключение между фильтрами без промежуточных фильтров.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-161">Try a direct connection between the filters, with no intermediate filters.</span></span>
2.  <span data-ttu-id="c4ef8-162">Попробуйте использовать кэшированные фильтры.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-162">Try cached filters.</span></span>
3.  <span data-ttu-id="c4ef8-163">Фильтры Try в графе.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-163">Try filters in the graph.</span></span>
4.  <span data-ttu-id="c4ef8-164">Windows 7 или более поздней версии: попробуйте использовать предпочтительный фильтр для типа носителя, если он есть.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-164">Windows 7 or later: Try the preferred filter for the media type, if any.</span></span>
5.  <span data-ttu-id="c4ef8-165">Поиск фильтров в реестре.</span><span class="sxs-lookup"><span data-stu-id="c4ef8-165">Look up filters in the registry.</span></span>

## <a name="related-topics"></a><span data-ttu-id="c4ef8-166">См. также</span><span class="sxs-lookup"><span data-stu-id="c4ef8-166">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c4ef8-167">Фильтровать категории</span><span class="sxs-lookup"><span data-stu-id="c4ef8-167">Filter Categories</span></span>](filter-categories.md)
</dt> <dt>

[<span data-ttu-id="c4ef8-168">Заслуживают</span><span class="sxs-lookup"><span data-stu-id="c4ef8-168">Merit</span></span>](merit.md)
</dt> <dt>

[<span data-ttu-id="c4ef8-169">Имитация построения графа с помощью Графедит</span><span class="sxs-lookup"><span data-stu-id="c4ef8-169">Simulating Graph Building with GraphEdit</span></span>](simulating-graph-building-with-graphedit.md)
</dt> <dt>

[<span data-ttu-id="c4ef8-170">Построение графа фильтра</span><span class="sxs-lookup"><span data-stu-id="c4ef8-170">Building the Filter Graph</span></span>](building-the-filter-graph.md)
</dt> </dl>

 

 



