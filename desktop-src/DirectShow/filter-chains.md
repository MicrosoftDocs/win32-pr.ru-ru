---
description: Фильтровать цепочки
ms.assetid: c17b3b58-65ab-4e83-91f2-54a995f22ddf
title: Фильтровать цепочки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d22ee33f7bc24495bc5099d0abeca7b8c70bc6d4
ms.sourcegitcommit: 63753fcfb0afbbe5ec283fb8316e62c2dc950f66
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2021
ms.locfileid: "107909062"
---
# <a name="filter-chains"></a><span data-ttu-id="8a6ac-103">Фильтровать цепочки</span><span class="sxs-lookup"><span data-stu-id="8a6ac-103">Filter Chains</span></span>

<span data-ttu-id="8a6ac-104">*Цепочка фильтров* — это последовательность фильтров, которая соответствует следующим условиям.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-104">A *filter chain* is a sequence of filters that meets the following conditions:</span></span>

-   <span data-ttu-id="8a6ac-105">Каждый фильтр в цепочке имеет не более одного подключенного входного ПИН-кода и одного подключенного выходного контакта.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-105">Each filter in the chain has at most one connected input pin and one connected output pin.</span></span>
-   <span data-ttu-id="8a6ac-106">Можно просмотреть каждый фильтр в цепочке без прохода по фильтрам за пределами цепочки.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-106">It is possible to traverse every filter in the chain without traversing filters outside the chain.</span></span>

<span data-ttu-id="8a6ac-107">Например, на следующей схеме фильтры A – B, C – D и F-G-H являются цепочками фильтров.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-107">For example, in the following diagram, filters A–B, C–D, and F–G–H are filter chains.</span></span> <span data-ttu-id="8a6ac-108">Каждая подцепочка в F – G – H (F – G и G – H) также является цепочкой фильтров.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-108">Each subchain in F–G–H (F–G and G–H) is also a filter chain.</span></span> <span data-ttu-id="8a6ac-109">Цепочка фильтров может состоять из одного фильтра, поэтому фильтры A, B, C, D, F, G и H также являются отдельными цепочками фильтров.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-109">A filter chain can consist of a single filter, so filters A, B, C, D, F, G, and H are also distinct filter chains.</span></span> <span data-ttu-id="8a6ac-110">Фильтр E имеет два входных соединения, поэтому любая последовательность фильтров, включающая фильтр E, не является цепочкой фильтров.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-110">Filter E has two input connections, so any sequence of filters that includes filter E is not a filter chain.</span></span>

![цепочка фильтров (пример 1)](images/filter-chain1.png)

<span data-ttu-id="8a6ac-112">Интерфейс [**ифилтерчаин**](/windows/desktop/api/Strmif/nn-strmif-ifilterchain) предоставляет следующие методы управления цепочками фильтров:</span><span class="sxs-lookup"><span data-stu-id="8a6ac-112">The [**IFilterChain**](/windows/desktop/api/Strmif/nn-strmif-ifilterchain) interface provides the following methods for controlling filter chains:</span></span>



| <span data-ttu-id="8a6ac-113">Метка</span><span class="sxs-lookup"><span data-stu-id="8a6ac-113">Label</span></span> | <span data-ttu-id="8a6ac-114">Значение</span><span class="sxs-lookup"><span data-stu-id="8a6ac-114">Value</span></span> |
|---------------------------------------------------------------|---------------------------------|
| [<span data-ttu-id="8a6ac-115">**Ифилтерчаин:: Стартчаин**</span><span class="sxs-lookup"><span data-stu-id="8a6ac-115">**IFilterChain::StartChain**</span></span>](/windows/desktop/api/Strmif/nf-strmif-ifilterchain-startchain)   | <span data-ttu-id="8a6ac-116">Запускает цепочку.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-116">Starts a chain.</span></span>                 |
| [<span data-ttu-id="8a6ac-117">**Ифилтерчаин:: Стопчаин**</span><span class="sxs-lookup"><span data-stu-id="8a6ac-117">**IFilterChain::StopChain**</span></span>](/windows/desktop/api/Strmif/nf-strmif-ifilterchain-stopchain)     | <span data-ttu-id="8a6ac-118">Останавливает цепочку.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-118">Stops a chain.</span></span>                  |
| [<span data-ttu-id="8a6ac-119">**Ифилтерчаин::P Аусечаин**</span><span class="sxs-lookup"><span data-stu-id="8a6ac-119">**IFilterChain::PauseChain**</span></span>](/windows/desktop/api/Strmif/nf-strmif-ifilterchain-pausechain)   | <span data-ttu-id="8a6ac-120">Приостанавливает цепочку.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-120">Pauses a chain.</span></span>                 |
| [<span data-ttu-id="8a6ac-121">**Ифилтерчаин:: Ремовечаин**</span><span class="sxs-lookup"><span data-stu-id="8a6ac-121">**IFilterChain::RemoveChain**</span></span>](/windows/desktop/api/Strmif/nf-strmif-ifilterchain-removechain) | <span data-ttu-id="8a6ac-122">Удаляет цепочку из графа.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-122">Removes a chain from the graph.</span></span> |



 

<span data-ttu-id="8a6ac-123">Нет определенного метода для добавления цепочки.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-123">There is no specific method for adding a chain.</span></span> <span data-ttu-id="8a6ac-124">Чтобы добавить цепочку, вставьте новые фильтры с помощью метода [**ифилтерграф:: аддфилтер**](/windows/desktop/api/Strmif/nf-strmif-ifiltergraph-addfilter) .</span><span class="sxs-lookup"><span data-stu-id="8a6ac-124">To add a chain, insert the new filters using the [**IFilterGraph::AddFilter**](/windows/desktop/api/Strmif/nf-strmif-ifiltergraph-addfilter) method.</span></span> <span data-ttu-id="8a6ac-125">Затем соедините фильтры, вызвав [**играфбуилдер:: Connect**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-connect), [**Играфбуилдер:: Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render)или аналогичные методы.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-125">Then connect the filters by calling [**IGraphBuilder::Connect**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-connect), [**IGraphBuilder::Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render), or similar methods.</span></span>

<span data-ttu-id="8a6ac-126">При выполнении графа цепочка фильтров может переключаться между выполнением и остановкой.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-126">When the graph is running, a filter chain can switch between running and stopped.</span></span> <span data-ttu-id="8a6ac-127">Когда граф приостанавливается, он может переключаться между приостановкой и остановкой.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-127">When the graph is paused, it can switch between paused and stopped.</span></span> <span data-ttu-id="8a6ac-128">Это единственные возможные переходы состояния с цепочками фильтров.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-128">These are the only state transitions possible with filter chains.</span></span>

## <a name="filter-chain-guidelines"></a><span data-ttu-id="8a6ac-129">Рекомендации по использованию цепочки фильтров</span><span class="sxs-lookup"><span data-stu-id="8a6ac-129">Filter Chain Guidelines</span></span>

<span data-ttu-id="8a6ac-130">При использовании методов **ифилтерчаин** важно убедиться, что фильтры в графе могут поддерживать операции цепочки фильтров.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-130">When you use **IFilterChain** methods, it is important to make sure that the filters in the graph can support filter chaining operations.</span></span> <span data-ttu-id="8a6ac-131">В противном случае могут возникнуть ошибки взаимоблокировки или графа.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-131">Otherwise, you might cause deadlocks or graph errors.</span></span> <span data-ttu-id="8a6ac-132">Фильтры, подключенные к цепочке, должны работать правильно после изменения состояния цепочки.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-132">Filters connected to the chain must function correctly after the chain changes state.</span></span>

<span data-ttu-id="8a6ac-133">Лучшим способом использования **ифилтерчаин** является набор фильтров, разработанных специально для цепочки.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-133">The best way to use **IFilterChain** is with a set of filters that you have designed specifically for chaining.</span></span> <span data-ttu-id="8a6ac-134">Используйте следующие рекомендации, чтобы убедиться, что фильтры являются надежными для операций фильтрации по цепочке.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-134">Use the following guidelines to ensure that your filters are safe for filter chain operations.</span></span> <span data-ttu-id="8a6ac-135">Эти точки относятся к схеме ниже.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-135">These points refer to the following diagram.</span></span>

![цепочка фильтров (пример 2)](images/filter-chain2.png)

-   <span data-ttu-id="8a6ac-137">Перед изменением состояния цепочки фильтров необходимо завершить все вызовы обработки данных на границе цепи фильтров.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-137">Before the filter chain's state changes, all data processing calls at the boundary of the filter chain must be completed.</span></span> <span data-ttu-id="8a6ac-138">Это правило применяется к методам [**имеминпутпин:: Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive), [**Ипин:: невсегмент**](/windows/desktop/api/Strmif/nf-strmif-ipin-newsegment)и [**Ипин:: EndOfStream**](/windows/desktop/api/Strmif/nf-strmif-ipin-endofstream).</span><span class="sxs-lookup"><span data-stu-id="8a6ac-138">This rule applies to the methods [**IMemInputPin::Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive), [**IPin::NewSegment**](/windows/desktop/api/Strmif/nf-strmif-ipin-newsegment), and [**IPin::EndOfStream**](/windows/desktop/api/Strmif/nf-strmif-ipin-endofstream).</span></span> <span data-ttu-id="8a6ac-139">Фильтры в цепочке должны возвращать из вызовов этих методов, сделанных фильтрами за пределами цепочки. фильтры, находящиеся за пределами цепочки, должны возвращать вызовы, сделанные фильтрами в цепочке.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-139">Filters in the chain must return from calls to these methods made by filters outside the chain; and filters outside the chain must return from calls made by filters within the chain.</span></span>

<span data-ttu-id="8a6ac-140">Например, на предыдущей схеме фильтр б должен выполнить все вызовы обработки данных из фильтра а, а фильтр E должен завершить любые вызовы из фильтра D. Если ПИН-коды предоставляют интерфейсы [**ипинфловконтрол**](/windows/desktop/api/Strmif/nn-strmif-ipinflowcontrol) и [**ипинконнектион**](/windows/desktop/api/Strmif/nn-strmif-ipinconnection) , можно передать данные через граф, вызвав методы [**Ипинфловконтрол:: Block**](/windows/desktop/api/Strmif/nf-strmif-ipinflowcontrol-block) и [**играфконфиг::P ушсраугхдата**](/windows/desktop/api/Strmif/nf-strmif-igraphconfig-pushthroughdata) , как описано в разделе [динамическое](dynamic-reconnection.md)повторное подключение.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-140">For example, in the previous diagram, filter B must complete any data processing calls from filter A, and filter E must finish any calls from filter D. If the pins expose the [**IPinFlowControl**](/windows/desktop/api/Strmif/nn-strmif-ipinflowcontrol) and [**IPinConnection**](/windows/desktop/api/Strmif/nn-strmif-ipinconnection) interfaces, you can push the data through the graph by calling the [**IPinFlowControl::Block**](/windows/desktop/api/Strmif/nf-strmif-ipinflowcontrol-block) and [**IGraphConfig::PushThroughData**](/windows/desktop/api/Strmif/nf-strmif-igraphconfig-pushthroughdata) methods, as described in [Dynamic Reconnection](dynamic-reconnection.md).</span></span> <span data-ttu-id="8a6ac-141">Фильтры также могут поддерживать закрытые методы для передачи данных.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-141">Filters might also support private methods for pushing the data.</span></span>

-   <span data-ttu-id="8a6ac-142">Вышестоящее фильтры должны ждать изменения состояния цепочки.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-142">Upstream filters must expect the chain's state to change.</span></span> <span data-ttu-id="8a6ac-143">Например, на предыдущей схеме Предположим, что цепочка остановлена, но фильтрация вызывает **имеминпутпин:: Receive**.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-143">For example, in the previous diagram, suppose the chain is stopped but filter A calls **IMemInputPin::Receive**.</span></span> <span data-ttu-id="8a6ac-144">Вызов завершается ошибкой, а ответ фильтра а — на потоковую передачу.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-144">The call fails and the response of filter A is to stop streaming.</span></span> <span data-ttu-id="8a6ac-145">Когда приложение перезапускает цепочку, оно не действует, поскольку фильтр A больше не использует потоковую передачу данных.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-145">When the application restarts the chain, it has no effect because filter A is no longer streaming data.</span></span>
-   <span data-ttu-id="8a6ac-146">Нисходящие фильтры также должны ждать изменения состояния цепочки.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-146">Downstream filters must also expect the chain's state to change.</span></span> <span data-ttu-id="8a6ac-147">В противном случае нисходящий фильтр может блокироваться, пока не будет ожидать выборки, которые не поступают.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-147">If not, the downstream filter might block while it waits for samples that never arrive.</span></span> <span data-ttu-id="8a6ac-148">Например, для фильтров мультиплексора (МУЛЬТИПЛЕКСОРа) часто требуются данные из всех входных ПИН-кодов.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-148">For example, multiplexer (MUX) filters often require data from all of their input pins.</span></span> <span data-ttu-id="8a6ac-149">Остановка потока данных из одного входного ПИН-кода может препятствовать обработке других потоков.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-149">Halting the flow of data from one input pin might block the other streams from processing.</span></span> <span data-ttu-id="8a6ac-150">Это может привести к взаимоблокировке графа.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-150">This can cause the graph to deadlock.</span></span>
-   <span data-ttu-id="8a6ac-151">Каждое подключение закрепления от фильтра за пределами цепочки к фильтру в пределах цепочки должно иметь собственный распределитель, который не используется другими соединениями.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-151">Each pin connection from a filter outside the chain to a filter within the chain should have its own allocator, which is not shared by other connections.</span></span> <span data-ttu-id="8a6ac-152">При изменении состояния цепочки или удалении из графа распределитель может быть отменен.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-152">When the chain changes state or is removed from the graph, the allocator might be decommitted.</span></span> <span data-ttu-id="8a6ac-153">Если другие соединения использовали один распределитель, они больше не смогут обрабатывать образцы.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-153">If other connections were using the same allocator, they can no longer process samples.</span></span>
-   <span data-ttu-id="8a6ac-154">Не удаляйте цепочку, если только фильтры, подключенные к цепочке, поддерживают динамическое отключение.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-154">Do not remove a chain unless the filters connected to the chain support dynamic disconnection.</span></span> <span data-ttu-id="8a6ac-155">Как правило, подключенные фильтры поддерживают интерфейс **ипинконнектион** или **ипинфловконтрол** , но вместо этого могут поддерживать частные интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="8a6ac-155">Typically, the connected filters will support the **IPinConnection** or **IPinFlowControl** interface, but might support private interfaces instead.</span></span>

## <a name="related-topics"></a><span data-ttu-id="8a6ac-156">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="8a6ac-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8a6ac-157">Построение динамического графа</span><span class="sxs-lookup"><span data-stu-id="8a6ac-157">Dynamic Graph Building</span></span>](dynamic-graph-building.md)
</dt> </dl>

 

 



