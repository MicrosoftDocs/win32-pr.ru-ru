---
description: Обработка изменений формата из модуля подготовки видео
ms.assetid: ac7d7b1c-3c9a-4693-87ea-0a10a8ab915c
title: Обработка изменений формата из модуля подготовки видео
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d731ac4b9d6985cf5ad92f642b6d8262209fa91d
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "105650426"
---
# <a name="handling-format-changes-from-the-video-renderer"></a><span data-ttu-id="dc1a5-103">Обработка изменений формата из модуля подготовки видео</span><span class="sxs-lookup"><span data-stu-id="dc1a5-103">Handling Format Changes from the Video Renderer</span></span>

<span data-ttu-id="dc1a5-104">В этом разделе описывается, как фильтр декодера или фильтр преобразования должен обрабатывать изменения формата из модуля подготовки видео.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-104">This section describes how a decoder filter or transform filter should handle format changes from the video renderer.</span></span>

<span data-ttu-id="dc1a5-105">**Фильтр модуля подготовки отчетов видео**</span><span class="sxs-lookup"><span data-stu-id="dc1a5-105">**Video Renderer Filter**</span></span>

<span data-ttu-id="dc1a5-106">При подключении старого фильтра модуля подготовки отчетов к [просмотру](video-renderer-filter.md) требуется формат RGB, соответствующий формату отображения основного монитора.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-106">When the old [Video Renderer](video-renderer-filter.md) filter connects, it requires an RGB format that matches the display format of the primary monitor.</span></span> <span data-ttu-id="dc1a5-107">Это позволяет использовать GDI для отрисовки, если DirectDraw недоступен.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-107">This enables it to use GDI for rendering if DirectDraw is not available.</span></span> <span data-ttu-id="dc1a5-108">При запуске воспроизведения модуль подготовки отчетов может переключиться в формат, совместимый с DirectDraw.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-108">When playback starts, the Video Renderer may switch to a DirectDraw-compatible format.</span></span> <span data-ttu-id="dc1a5-109">Чтобы верфифи, может ли вышестоящий фильтр поддерживать новый формат, модуль подготовки видео вызывает [**Ипин:: куерякцепт**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) в выходном ПИН-коде вышестоящего фильтра.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-109">To verfify whether the upstream filter can support the new format, the Video Renderer calls [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) on the upstream filter's output pin.</span></span> <span data-ttu-id="dc1a5-110">Если вышестоящий фильтр принимает новый формат, метод **куерякцепт** возвращает значение S \_ ОК.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-110">If the upstream filter accepts the new format, the **QueryAccept** method returns S\_OK.</span></span> <span data-ttu-id="dc1a5-111">Модуль подготовки видео переключает форматы, присоединяя к следующему примеру носителя тип мультимедиа с новым форматом, возвращенный его распределителем.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-111">The Video Renderer switches formats by attaching a media type with the new format to the next media sample returned by its allocator.</span></span> <span data-ttu-id="dc1a5-112">Вышестоящий фильтр должен проверить изменения формата, вызвав [**имедиасампле:: жетмедиатипе**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) для каждого образца.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-112">The upstream filter should check for format changes by calling [**IMediaSample::GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) on each sample.</span></span> <span data-ttu-id="dc1a5-113">Модуль обработки видео может переключаться между исходным форматом и новым форматом в любое время во время потоковой передачи.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-113">The Video Renderer may switch back and forth between the original format and new format at any time during streaming.</span></span> <span data-ttu-id="dc1a5-114">Он не вызывает **куерякцепт** после первого изменения формата.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-114">It does not call **QueryAccept** after the first format change.</span></span> <span data-ttu-id="dc1a5-115">После того, как вышестоящий фильтр принял новый формат, он должен иметь возможность переключения обратно и назад.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-115">Once the upstream filter has accepted the new format, it must be able to switch back and forth.</span></span>

<span data-ttu-id="dc1a5-116">Вышестоящий фильтр может отклонить изменение формата, возвращая S \_ false из **куерякцепт**.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-116">The upstream filter can reject the format change by returning S\_FALSE from **QueryAccept**.</span></span> <span data-ttu-id="dc1a5-117">В этом случае модуль подготовки видео продолжит использовать GDI с исходным форматом.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-117">In that case, the Video Renderer continues to use GDI with the original format.</span></span>

<span data-ttu-id="dc1a5-118">**Фильтр модуля подготовки видео микшера**</span><span class="sxs-lookup"><span data-stu-id="dc1a5-118">**Video Mixing Renderer Filter**</span></span>

<span data-ttu-id="dc1a5-119">Фильтр визуализации видео микширования (VMR-7 и VMR-9) будет подключаться к любому формату, поддерживаемому графическим оборудованием в системе.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-119">The Video Mixing Renderer filter (VMR-7 and VMR-9) will connect with any format that is supported by the graphics hardware on the system.</span></span> <span data-ttu-id="dc1a5-120">VMR-7 всегда использует DirectDraw для отрисовки и выделяет базовые поверхности DirectDraw при соединении вышестоящего фильтра.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-120">The VMR-7 always uses DirectDraw for rendering, and allocates the underlying DirectDraw surfaces when the upstream filter connects.</span></span> <span data-ttu-id="dc1a5-121">VMR-9 всегда использует Direct3D для отрисовки и выделяет базовые поверхности Direct3D при соединении вышестоящего фильтра.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-121">The VMR-9 always uses Direct3D for rendering, and allocates the underlying Direct3D surfaces when the upstream filter connects.</span></span>

<span data-ttu-id="dc1a5-122">Для графического оборудования может потребоваться больший размер поверхности, чем ширина изображения.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-122">The graphics hardware may require a larger surface stride than the image width.</span></span> <span data-ttu-id="dc1a5-123">В этом случае VMR запрашивает новый формат, вызывая **куерякцепт**.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-123">In that case, the VMR requests a new format by calling **QueryAccept**.</span></span> <span data-ttu-id="dc1a5-124">Он отображает шаг поверхности в элементе **бивидс** в [**битмапинфохеадер**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader) в формате видео.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-124">It reports the surface stride in the **biWidth** member of the [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader) in the video format.</span></span> <span data-ttu-id="dc1a5-125">Если вышестоящий фильтр не возвращает значение S \_ ОК из **куерякцепт**, то VMR отклоняет формат и пытается подключиться, используя следующий формат, объявленный вышестоящим фильтром.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-125">If the upstream filter does not return S\_OK from **QueryAccept**, the VMR rejects the format and tries to connect using the next format advertised by the upstream filter.</span></span> <span data-ttu-id="dc1a5-126">VMR присоединяет тип мультимедиа к новому формату для первого примера носителя.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-126">The VMR attaches the media type with the new format to the first media sample.</span></span> <span data-ttu-id="dc1a5-127">После первой выборки формат остается постоянным. фильтр VMR не будет переключать форматы во время работы графа.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-127">After the first sample, the format remains constant; the VMR will not switch formats while the graph is running.</span></span>

<span data-ttu-id="dc1a5-128">**Улучшенная визуализация видео (Евр)**</span><span class="sxs-lookup"><span data-stu-id="dc1a5-128">**Enhanced Video Render (EVR)**</span></span>

<span data-ttu-id="dc1a5-129">Евр всегда использует Direct3D для отрисовки.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-129">The EVR always uses Direct3D for rendering.</span></span> <span data-ttu-id="dc1a5-130">Если необходим больший шаг, ЕВР использует тот же механизм **куерякцепт** , что и VMR.</span><span class="sxs-lookup"><span data-stu-id="dc1a5-130">If a larger surface stride is needed, the EVR uses the same **QueryAccept** mechanism as the VMR.</span></span>

## <a name="related-topics"></a><span data-ttu-id="dc1a5-131">См. также</span><span class="sxs-lookup"><span data-stu-id="dc1a5-131">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="dc1a5-132">Куерякцепт (вышестоящий)</span><span class="sxs-lookup"><span data-stu-id="dc1a5-132">QueryAccept (Upstream)</span></span>](queryaccept--upstream.md)
</dt> </dl>

 

 



