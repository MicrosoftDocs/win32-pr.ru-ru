---
description: Введение в программирование приложений DirectShow
ms.assetid: 21a72efa-95df-4754-8304-ad56965a914d
title: Введение в программирование приложений DirectShow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f6218a346a7eb9711259c025aef09133ef2e58f6
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104416640"
---
# <a name="introduction-to-directshow-application-programming"></a><span data-ttu-id="e03e3-103">Введение в программирование приложений DirectShow</span><span class="sxs-lookup"><span data-stu-id="e03e3-103">Introduction to DirectShow Application Programming</span></span>

<span data-ttu-id="e03e3-104">В этой статье рассказывается о базовой терминологии и концепциях, используемых в DirectShow.</span><span class="sxs-lookup"><span data-stu-id="e03e3-104">This article introduces the basic terminology and concepts that are used in DirectShow.</span></span> <span data-ttu-id="e03e3-105">После прочтения этого раздела вы будете готовы написать свое первое приложение DirectShow.</span><span class="sxs-lookup"><span data-stu-id="e03e3-105">After reading this section, you will be ready to write your first DirectShow application.</span></span>

<span data-ttu-id="e03e3-106">**Фильтры и графы фильтров**</span><span class="sxs-lookup"><span data-stu-id="e03e3-106">**Filters and Filter Graphs**</span></span>

<span data-ttu-id="e03e3-107">Стандартный блок DirectShow — это программный компонент, называемый *фильтром*.</span><span class="sxs-lookup"><span data-stu-id="e03e3-107">The building block of DirectShow is a software component called a *filter*.</span></span> <span data-ttu-id="e03e3-108">Фильтр — это программный компонент, который выполняет некоторую операцию в потоке мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="e03e3-108">A filter is a software component that performs some operation on a multimedia stream.</span></span> <span data-ttu-id="e03e3-109">Например, фильтры DirectShow могут</span><span class="sxs-lookup"><span data-stu-id="e03e3-109">For example, DirectShow filters can</span></span>

-   <span data-ttu-id="e03e3-110">чтение файлов</span><span class="sxs-lookup"><span data-stu-id="e03e3-110">read files</span></span>
-   <span data-ttu-id="e03e3-111">получение видео с устройства видеозаписи</span><span class="sxs-lookup"><span data-stu-id="e03e3-111">get video from a video capture device</span></span>
-   <span data-ttu-id="e03e3-112">декодирование различных форматов потоков, таких как видео MPEG-1</span><span class="sxs-lookup"><span data-stu-id="e03e3-112">decode various stream formats, such as MPEG-1 video</span></span>
-   <span data-ttu-id="e03e3-113">Передача данных в графический или звуковой адаптер</span><span class="sxs-lookup"><span data-stu-id="e03e3-113">pass data to the graphics or sound card</span></span>

<span data-ttu-id="e03e3-114">Фильтры получают входные данные и выдают выходные данные.</span><span class="sxs-lookup"><span data-stu-id="e03e3-114">Filters receive input and produce output.</span></span> <span data-ttu-id="e03e3-115">Например, если фильтр декодирует видео MPEG-1, входные данные являются потоком в кодировке MPEG, а выходные данные — серией несжатых видеокадров.</span><span class="sxs-lookup"><span data-stu-id="e03e3-115">For example, if a filter decodes MPEG-1 video, the input is the MPEG-encoded stream and the output is a series of uncompressed video frames.</span></span>

<span data-ttu-id="e03e3-116">В DirectShow приложение выполняет любую задачу, подключив цепочки фильтров друг к другу, чтобы выход из одного фильтра стал входным для другого.</span><span class="sxs-lookup"><span data-stu-id="e03e3-116">In DirectShow, an application performs any task by connecting chains of filters together, so that the output from one filter becomes the input for another.</span></span> <span data-ttu-id="e03e3-117">Набор подключенных фильтров называется *графом фильтра*.</span><span class="sxs-lookup"><span data-stu-id="e03e3-117">A set of connected filters is called a *filter graph*.</span></span> <span data-ttu-id="e03e3-118">Например, на следующей диаграмме показан граф фильтра для воспроизведения AVI-файла.</span><span class="sxs-lookup"><span data-stu-id="e03e3-118">For example, the following diagram shows a filter graph for playing an AVI file.</span></span>

![Фильтрация графа для воспроизведения файла AVI](images/avi-filter-graph.png)

<span data-ttu-id="e03e3-120">Фильтр источника файлов считывает AVI с жесткого диска.</span><span class="sxs-lookup"><span data-stu-id="e03e3-120">The File Source filter reads the AVI file from the hard disk.</span></span> <span data-ttu-id="e03e3-121">Фильтр-разделитель AVI анализирует файл в два потока: сжатый поток видео и аудиопоток.</span><span class="sxs-lookup"><span data-stu-id="e03e3-121">The AVI Splitter filter parses the file into two streams, a compressed video stream and an audio stream.</span></span> <span data-ttu-id="e03e3-122">Фильтр распаковки AVI декодирует кадры видео.</span><span class="sxs-lookup"><span data-stu-id="e03e3-122">The AVI Decompressor filter decodes the video frames.</span></span> <span data-ttu-id="e03e3-123">Фильтр модуля обработки видео выводит кадры на экран с помощью DirectDraw или GDI.</span><span class="sxs-lookup"><span data-stu-id="e03e3-123">The Video Renderer filter draws the frames to the display, using DirectDraw or GDI.</span></span> <span data-ttu-id="e03e3-124">Фильтр устройства DirectSound по умолчанию воспроизводит аудиопоток, используя DirectSound.</span><span class="sxs-lookup"><span data-stu-id="e03e3-124">The Default DirectSound Device filter plays the audio stream, using DirectSound.</span></span>

<span data-ttu-id="e03e3-125">Приложению не требуется управлять всеми этими потоками данных.</span><span class="sxs-lookup"><span data-stu-id="e03e3-125">The application does not have to manage all of this data flow.</span></span> <span data-ttu-id="e03e3-126">Вместо этого фильтры контролируются компонентом высокого уровня, который называется диспетчером графа фильтров.</span><span class="sxs-lookup"><span data-stu-id="e03e3-126">Instead, the filters are controlled by a high-level component called the Filter Graph Manager.</span></span> <span data-ttu-id="e03e3-127">Приложение выполняет высокоуровневые вызовы API, такие как "Run" (для перемещения данных через граф) или "останавливаться" (для завершения потока данных).</span><span class="sxs-lookup"><span data-stu-id="e03e3-127">The application makes high-level API calls such as "Run" (to move data through the graph) or "Stop" (to stop the flow of data).</span></span> <span data-ttu-id="e03e3-128">Если требуется больший контроль над операциями потока, можно получить доступ к фильтрам напрямую через интерфейсы COM.</span><span class="sxs-lookup"><span data-stu-id="e03e3-128">If you require more control over the stream operations, you can access the filters directly through COM interfaces.</span></span> <span data-ttu-id="e03e3-129">Диспетчер графов фильтров также передает в приложение уведомления о событиях.</span><span class="sxs-lookup"><span data-stu-id="e03e3-129">The Filter Graph Manager also passes event notifications to the application.</span></span>

<span data-ttu-id="e03e3-130">Диспетчер графов фильтров также выполняет другие задачи: он предоставляет приложениям методы для построения графа фильтра путем соединения фильтров.</span><span class="sxs-lookup"><span data-stu-id="e03e3-130">The Filter Graph Manager serves another purpose as well: It provides methods for the application to build the filter graph, by connecting the filters together.</span></span> <span data-ttu-id="e03e3-131">(DirectShow также предоставляет различные вспомогательные объекты, упрощающие этот процесс.</span><span class="sxs-lookup"><span data-stu-id="e03e3-131">(DirectShow also provides various helper objects that simplify this process.</span></span> <span data-ttu-id="e03e3-132">Они тщательно описаны в документации.)</span><span class="sxs-lookup"><span data-stu-id="e03e3-132">These are thoroughly described in the documentation.)</span></span>

<span data-ttu-id="e03e3-133">**Написание приложения DirectShow**</span><span class="sxs-lookup"><span data-stu-id="e03e3-133">**Writing a DirectShow Application**</span></span>

<span data-ttu-id="e03e3-134">В общих чертах есть три задачи, которые должны выполняться в любом приложении DirectShow.</span><span class="sxs-lookup"><span data-stu-id="e03e3-134">In broad terms, there are three tasks that any DirectShow application must perform.</span></span> <span data-ttu-id="e03e3-135">Они показаны на следующей схеме.</span><span class="sxs-lookup"><span data-stu-id="e03e3-135">These are illustrated in the following diagram.</span></span>

![Типичное приложение DirectShow](images/fgm.png)

1.  <span data-ttu-id="e03e3-137">Приложение создает экземпляр диспетчера графа фильтров.</span><span class="sxs-lookup"><span data-stu-id="e03e3-137">The application creates an instance of the Filter Graph Manager.</span></span>
2.  <span data-ttu-id="e03e3-138">Приложение использует диспетчер графа фильтров для создания графа фильтра.</span><span class="sxs-lookup"><span data-stu-id="e03e3-138">The application uses the Filter Graph Manager to build a filter graph.</span></span> <span data-ttu-id="e03e3-139">Точный набор фильтров в графе будет зависеть от приложения.</span><span class="sxs-lookup"><span data-stu-id="e03e3-139">The exact set of filters in the graph will depend on the application.</span></span>
3.  <span data-ttu-id="e03e3-140">Приложение использует диспетчер графа фильтров для управления графом фильтра и потоковых данных с помощью фильтров.</span><span class="sxs-lookup"><span data-stu-id="e03e3-140">The application uses the Filter Graph Manager to control the filter graph and stream data through the filters.</span></span> <span data-ttu-id="e03e3-141">В ходе этого процесса приложение также будет реагировать на события из диспетчера графа фильтров.</span><span class="sxs-lookup"><span data-stu-id="e03e3-141">Throughout this process, the application will also respond to events from the Filter Graph Manager.</span></span>

<span data-ttu-id="e03e3-142">После завершения обработки приложение освобождает диспетчер графов фильтров и все фильтры.</span><span class="sxs-lookup"><span data-stu-id="e03e3-142">When processing is completed, the application releases the Filter Graph Manager and all of the filters.</span></span>

<span data-ttu-id="e03e3-143">DirectShow основана на модели COM; Диспетчер графов фильтров и фильтры являются объектами COM.</span><span class="sxs-lookup"><span data-stu-id="e03e3-143">DirectShow is based on COM; the Filter Graph Manager and the filters are all COM objects.</span></span> <span data-ttu-id="e03e3-144">Перед началом программирования DirectShow необходимо иметь общее представление о программировании клиента COM.</span><span class="sxs-lookup"><span data-stu-id="e03e3-144">You should have a general understanding of COM client programming before you begin programming DirectShow.</span></span> <span data-ttu-id="e03e3-145">Доступно множество книг по программированию COM.</span><span class="sxs-lookup"><span data-stu-id="e03e3-145">Many books about COM programming are available.</span></span>

<span data-ttu-id="e03e3-146">Чтобы приступить к работе с DirectShow, прочитайте статью [как воспроизвести файл](how-to-play-a-file.md), который представляет собой простое консольное приложение для воспроизведения видеофайла.</span><span class="sxs-lookup"><span data-stu-id="e03e3-146">To get started with DirectShow, read the article [How To Play a File](how-to-play-a-file.md), which presents a simple console application to play a video file.</span></span> <span data-ttu-id="e03e3-147">В разделе, [посвященном DirectShow](about-directshow.md) , описывается архитектура DirectShow более подробно, а в разделе [Использование DirectShow](using-directshow.md) изучаются основные сценарии, поддерживаемые DirectShow, такие как захват, редактирование видео, воспроизведение DVD-дисков и телевидение.</span><span class="sxs-lookup"><span data-stu-id="e03e3-147">The section [About DirectShow](about-directshow.md) explains the DirectShow architecture in more detail, while the section [Using DirectShow](using-directshow.md) examines the major scenarios that are supported by DirectShow, such as capture, video editing, DVD playback, and television.</span></span>

 

 



