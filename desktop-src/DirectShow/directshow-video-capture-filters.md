---
description: Фильтры захвата видео DirectShow
ms.assetid: e4d1452d-ceac-4b5c-b9ba-ad4722ecff76
title: Фильтры захвата видео DirectShow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 238f18dd77bc40011fa9fc0dbab3192ea81a223f
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104494409"
---
# <a name="directshow-video-capture-filters"></a><span data-ttu-id="f2dcb-103">Фильтры захвата видео DirectShow</span><span class="sxs-lookup"><span data-stu-id="f2dcb-103">DirectShow Video Capture Filters</span></span>

<span data-ttu-id="f2dcb-104">Фильтры записи в DirectShow имеют некоторые функции, которые отличают их от других типов фильтров.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-104">Capture filters in DirectShow have some features that distinguish them from other kinds of filters.</span></span> <span data-ttu-id="f2dcb-105">Несмотря на то, что в [построителе графов записи](capture-graph-builder.md) скрываются многие детали, рекомендуется прочитать этот раздел, чтобы получить общее представление о графах записи DirectShow.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-105">Although the [Capture Graph Builder](capture-graph-builder.md) hides many of the details, it is a good idea to read this section, in order to have a general understanding of DirectShow capture graphs.</span></span>

<span data-ttu-id="f2dcb-106">**Закрепить категории**</span><span class="sxs-lookup"><span data-stu-id="f2dcb-106">**Pin Categories**</span></span>

<span data-ttu-id="f2dcb-107">Фильтр захвата часто содержит два или более выходных контакта, которые доставляют одни и те же данные, например ПИН-код предварительной версии и ПИН-код захвата.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-107">A capture filter often has two or more output pins that deliver the same kind of data—for example, a preview pin and a capture pin.</span></span> <span data-ttu-id="f2dcb-108">Поэтому типы мультимедиа не являются хорошим способом различения ПИН-кодов.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-108">Therefore, media types are not a good way to distinguish the pins.</span></span> <span data-ttu-id="f2dcb-109">Вместо этого эти ПИН-коды различаются их функциональностью, которая определяется с помощью идентификатора GUID, который называется *категорией закрепления*.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-109">Instead, the pins are distinguished by their functionality, which is identified using a GUID, called the *pin category*.</span></span>

<span data-ttu-id="f2dcb-110">Сведения о том, как запрашивать ПИН-коды для их категории, см. в статье [Работа с категориями закрепления](working-with-pin-categories.md).</span><span class="sxs-lookup"><span data-stu-id="f2dcb-110">For a discussion of how to query pins for their category, see [Working with Pin Categories](working-with-pin-categories.md).</span></span> <span data-ttu-id="f2dcb-111">Однако для большинства приложений вам не придется запрашивать ПИН-коды напрямую.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-111">For most applications, however, you will not have to query pins directly.</span></span> <span data-ttu-id="f2dcb-112">Вместо этого различные методы [**ICaptureGraphBuilder2**](/windows/desktop/api/Strmif/nn-strmif-icapturegraphbuilder2) принимают параметры, которые задают категорию закрепления для выполнения.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-112">Instead, various [**ICaptureGraphBuilder2**](/windows/desktop/api/Strmif/nn-strmif-icapturegraphbuilder2) methods take parameters that specify the pin category on which to operate.</span></span> <span data-ttu-id="f2dcb-113">Построитель графов записи автоматически находит правильный ПИН-код.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-113">The Capture Graph Builder automatically locates the correct pin.</span></span>

<span data-ttu-id="f2dcb-114">**Предварительный просмотр ПИН-кодов и ПИН-коды захвата**</span><span class="sxs-lookup"><span data-stu-id="f2dcb-114">**Preview Pins and Capture Pins**</span></span>

<span data-ttu-id="f2dcb-115">Некоторые устройства видеозаписи имеют отдельные выходные сигналы для предварительного просмотра и записи.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-115">Some video capture devices have separate output pins for preview and capture.</span></span> <span data-ttu-id="f2dcb-116">ПИН-код для предварительного просмотра используется для отображения видео на экране, а закрепление записи используется для записи видео в файл.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-116">The preview pin is used to render video to the screen, while the capture pin is used to write video to a file.</span></span>

<span data-ttu-id="f2dcb-117">ПИН-код предварительной версии и ПИН-код захвата имеют следующие отличия.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-117">A preview pin and a capture pin have the following differences:</span></span>

-   <span data-ttu-id="f2dcb-118">ПИН-код для предварительного просмотра удаляет кадры по мере необходимости для поддержания пропускной способности ПИН-кода записи.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-118">A preview pin drops frames as needed to maintain throughput on the capture pin.</span></span>
-   <span data-ttu-id="f2dcb-119">Каждый кадр из ПИН-кода записи отмечается временем потока во время записи кадра.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-119">Each frame from a capture pin is time-stamped with the stream time when the frame was captured.</span></span> <span data-ttu-id="f2dcb-120">ПИН-код предварительной версии не отметок времени о том, какие образцы он доставляет.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-120">A preview pin does not time stamp the samples it delivers.</span></span>

<span data-ttu-id="f2dcb-121">Причина, по которой в кадрах предварительной версии отсутствуют отметки времени, заключается в том, что граф фильтра создает небольшой объем задержки в потоке.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-121">The reason that preview frames do not have time stamps is that the filter graph introduces a small amount of latency into the stream.</span></span> <span data-ttu-id="f2dcb-122">Если время записи используется как время презентации, модуль подготовки отчетов рассматривает каждый пример как немного поздно.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-122">If the capture time is used as the presentation time, the video renderer treats every sample as being slightly late.</span></span> <span data-ttu-id="f2dcb-123">Это может привести к тому, что модуль подготовки отчетов будет удалять кадры, пока он пытается его обнаружить.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-123">This can cause the video renderer to drop frames while it tries to catch up.</span></span> <span data-ttu-id="f2dcb-124">Удаление меток времени гарантирует, что модуль подготовки отчетов будет отображать каждый выбор при поступлении, не удаляя кадры.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-124">Removing the time stamps ensures that the renderer presents each sample when it arrives, without dropping frames.</span></span>

<span data-ttu-id="f2dcb-125">В качестве ПИН-кода для предварительной версии ПИН-кода используется \_ \_ Предварительная версия категории PIN.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-125">The pin category for preview pins is PIN\_CATEGORY\_PREVIEW.</span></span> <span data-ttu-id="f2dcb-126">Категория для ПИН-кодов захвата — \_ это \_ захват категории.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-126">The category for capture pins is PIN\_CATEGORY\_CAPTURE.</span></span>

<span data-ttu-id="f2dcb-127">**ПИН-коды порта видео**</span><span class="sxs-lookup"><span data-stu-id="f2dcb-127">**Video Port Pins**</span></span>

<span data-ttu-id="f2dcb-128">Видеопорт — это аппаратное подключение между видеоустройством (например, аналоговым ТВ-тюнером) и видеоадаптером.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-128">A video port is a hardware connection between a video device (such as an analog TV tuner) and the video card.</span></span> <span data-ttu-id="f2dcb-129">Порт видео позволяет устройству передавать видеоданные непосредственно на графическую карту.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-129">A video port enables the device to send video data directly to the graphics card.</span></span> <span data-ttu-id="f2dcb-130">Видео отображается на экране с помощью наложения оборудования.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-130">The video is displayed on the screen using a hardware overlay.</span></span> <span data-ttu-id="f2dcb-131">Видеопортом может быть реальный кабель, соединяющий два устройства на отдельных картах; или это может быть жестко проводное подключение на одной карте.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-131">A video port might be an actual cable that connects two devices on separate cards; or it might be a hard-wired connection on the same card.</span></span>

<span data-ttu-id="f2dcb-132">Преимущество видеопорта заключается в том, что видео передается непосредственно в видеопамять без каких-либо операций с ЦП.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-132">The advantage of a video port is that the video goes directly into video memory, without any work by the CPU.</span></span> <span data-ttu-id="f2dcb-133">Однако видеопорты имеют некоторые недостатки:</span><span class="sxs-lookup"><span data-stu-id="f2dcb-133">However, video ports have some drawbacks:</span></span>

-   <span data-ttu-id="f2dcb-134">Видеопорт всегда использует область наложения во время записи, независимо от того, требуется ли предварительный просмотр видео.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-134">A video port always uses the overlay surface during capture, regardless of whether you want to preview the video.</span></span>
-   <span data-ttu-id="f2dcb-135">Автоматическое переключение между кадрами происходит автоматически, что затрудняет синхронизацию перелистывания с другими операциями с видео.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-135">Flipping between frames occurs automatically, which makes it difficult to synchronize the flip with other video operations.</span></span>

<span data-ttu-id="f2dcb-136">Если устройство записи использует порт видео, то фильтр записи будет иметь ПИН-код видеопорта вместо ПИН-кода для предварительной версии.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-136">If a capture device uses a video port, the capture filter has a video port pin instead of a preview pin.</span></span> <span data-ttu-id="f2dcb-137">Категория закрепления для ПИН-кодов порта — это закрепить \_ категорию \_ видеопорт.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-137">The pin category for video port pins is PIN\_CATEGORY\_VIDEOPORT.</span></span>

<span data-ttu-id="f2dcb-138">Каждый фильтр записи имеет по крайней мере один ПИН-код захвата.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-138">Every capture filter has at least one capture pin.</span></span> <span data-ttu-id="f2dcb-139">Кроме того, он может иметь ПИН-код предварительной версии или ПИН-код видеопорта, но не оба.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-139">In addition it might have a preview pin or a video port pin, but never both.</span></span> <span data-ttu-id="f2dcb-140">Фильтры могут иметь несколько ПИН-кодов захвата и предварительный просмотр, каждый из которых доставляет отдельный тип носителя.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-140">Filters can have multiple capture pins and preview pins, each delivering a separate media type.</span></span> <span data-ttu-id="f2dcb-141">Таким же, один фильтр может иметь ПИН-код видеозаписи, ПИН-код для предварительного просмотра видео, ПИН-код записи и ПИН-код для предварительной версии.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-141">Thus, a single filter could have a video capture pin, a video preview pin, an audio capture pin, and an audio preview pin.</span></span> <span data-ttu-id="f2dcb-142">(Однако нет ничего эквивалентного видеопорта для звукового устройства.)</span><span class="sxs-lookup"><span data-stu-id="f2dcb-142">(There is nothing equivalent to a video port for audio, however.)</span></span>

<span data-ttu-id="f2dcb-143">**Вышестоящий фильтр WDM**</span><span class="sxs-lookup"><span data-stu-id="f2dcb-143">**Upstream WDM Filters**</span></span>

<span data-ttu-id="f2dcb-144">Устройствам WDM (WDM) могут потребоваться некоторые дополнительные фильтры из фильтра записи.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-144">Windows Driver Model (WDM) devices may require some additional filters upstream from the capture filter.</span></span> <span data-ttu-id="f2dcb-145">К этим фильтрам относятся следующие:</span><span class="sxs-lookup"><span data-stu-id="f2dcb-145">These filters include the following:</span></span>

-   <span data-ttu-id="f2dcb-146">[Фильтр ТВ-тюнера](tv-tuner-filter.md).</span><span class="sxs-lookup"><span data-stu-id="f2dcb-146">[TV Tuner Filter](tv-tuner-filter.md).</span></span> <span data-ttu-id="f2dcb-147">Управляет настройкой аналогового ТВ-тюнера.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-147">Controls tuning for analog TV tuners.</span></span>
-   <span data-ttu-id="f2dcb-148">[Фильтр ТВ-звука](tv-audio-filter.md).</span><span class="sxs-lookup"><span data-stu-id="f2dcb-148">[TV Audio Filter](tv-audio-filter.md).</span></span> <span data-ttu-id="f2dcb-149">Управляет параметрами звука для аналоговых ТВ-тюнеров.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-149">Controls audio settings for analog TV tuners.</span></span>
-   <span data-ttu-id="f2dcb-150">[Аналоговый фильтр микшера видео](analog-video-crossbar-filter.md).</span><span class="sxs-lookup"><span data-stu-id="f2dcb-150">[Analog Video Crossbar Filter](analog-video-crossbar-filter.md).</span></span> <span data-ttu-id="f2dcb-151">Направляет видео и звуковые сигналы через устройство.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-151">Routes video and audio signals through the hardware device.</span></span> <span data-ttu-id="f2dcb-152">Например, устройство может иметь несколько входов, например S-Video и композитное видео.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-152">For example, a device might have multiple inputs, such as S-Video and composite video.</span></span> <span data-ttu-id="f2dcb-153">Фильтр микшера позволяет приложению выбрать входные данные.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-153">The crossbar filter enables the application to select the input.</span></span>

<span data-ttu-id="f2dcb-154">Хотя эти фильтры являются отдельными фильтрами в DirectShow, они обычно представляют одно и то же аппаратное устройство.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-154">Although these are separate filters in DirectShow, they typically represent the same hardware device.</span></span> <span data-ttu-id="f2dcb-155">Каждый фильтр управляет разной функцией устройства.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-155">Each filter controls a different function of the device.</span></span> <span data-ttu-id="f2dcb-156">Фильтры соединены ПИН-кодом, но данные мультимедиа не перемещаются через подключения.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-156">The filters are connected by pins, but no media data moves across the pin connections.</span></span> <span data-ttu-id="f2dcb-157">Поэтому ПИН-коды на этих фильтрах не подключаются путем установки типа носителя.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-157">Therefore, the pins on these filters do not connect by establishing a media type.</span></span> <span data-ttu-id="f2dcb-158">Вместо этого они используют значения GUID, называемые *средними*.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-158">Instead, they use GUID values called *mediums*.</span></span> <span data-ttu-id="f2dcb-159">Средние идентификаторы GUID однозначно определяются для заданного минидривера устройства.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-159">Medium GUIDs are uniquely defined for a given device minidriver.</span></span> <span data-ttu-id="f2dcb-160">Например, фильтр ТВ-тюнера и фильтр записи видео для одной и той же телекарты будут поддерживать один и тот же носитель, что позволит приложению правильно построить граф.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-160">For example, the TV Tuner filter and the Video Capture filter for the same TV card will both support the same medium, which enables the application to build the graph correctly.</span></span>

<span data-ttu-id="f2dcb-161">На практике эти фильтры автоматически добавляются на диаграмму, пока вы используете **ICaptureGraphBuilder2** для создания графов записи.</span><span class="sxs-lookup"><span data-stu-id="f2dcb-161">In practice, as long as you are using **ICaptureGraphBuilder2** to build your capture graphs, these filters are added to the graph automatically.</span></span> <span data-ttu-id="f2dcb-162">Более подробное обсуждение см. в разделе [фильтры драйвера класса WDM](wdm-class-driver-filters.md).</span><span class="sxs-lookup"><span data-stu-id="f2dcb-162">For a more detailed discussion, see [WDM Class Driver Filters](wdm-class-driver-filters.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="f2dcb-163">См. также</span><span class="sxs-lookup"><span data-stu-id="f2dcb-163">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f2dcb-164">Сведения о записи видео в DirectShow</span><span class="sxs-lookup"><span data-stu-id="f2dcb-164">About Video Capture in DirectShow</span></span>](about-video-capture-in-directshow.md)
</dt> </dl>

 

 



