---
description: Процесс подключения Кбасепин
ms.assetid: 4b3a9023-0267-4caa-9d89-88237009df05
title: Процесс подключения Кбасепин
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1441b0daba58857e00da0139d3312fb277287fc2
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "103990078"
---
# <a name="cbasepin-connection-process"></a><span data-ttu-id="02fb3-103">Процесс подключения Кбасепин</span><span class="sxs-lookup"><span data-stu-id="02fb3-103">CBasePin Connection Process</span></span>

<span data-ttu-id="02fb3-104">В этом разделе описывается, как класс [**кбасепин**](cbasepin.md) реализует процесс подключения ПИН-кода.</span><span class="sxs-lookup"><span data-stu-id="02fb3-104">This section describes how the [**CBasePin**](cbasepin.md) class implements the pin connection process.</span></span>

<span data-ttu-id="02fb3-105">Диспетчер графов фильтров инициирует все подключения ПИН-кода.</span><span class="sxs-lookup"><span data-stu-id="02fb3-105">The Filter Graph Manager initiates all pin connections.</span></span> <span data-ttu-id="02fb3-106">Он вызывает метод [**Ипин:: Connect**](/windows/desktop/api/Strmif/nf-strmif-ipin-connect) выходного контакта, указывая входной ПИН-код.</span><span class="sxs-lookup"><span data-stu-id="02fb3-106">It calls the output pin's [**IPin::Connect**](/windows/desktop/api/Strmif/nf-strmif-ipin-connect) method, specifying the input pin.</span></span> <span data-ttu-id="02fb3-107">Закрепление вывода завершает соединение, вызывая метод [**Ипин:: рецеивеконнектион**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) входного контакта.</span><span class="sxs-lookup"><span data-stu-id="02fb3-107">The output pin completes the connection by calling the input pin's [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) method.</span></span> <span data-ttu-id="02fb3-108">Входной ПИН-код может принимать или отклонять соединение.</span><span class="sxs-lookup"><span data-stu-id="02fb3-108">The input pin can accept or reject the connection.</span></span>

<span data-ttu-id="02fb3-109">Диспетчер графов фильтров может также указывать тип носителя для соединения.</span><span class="sxs-lookup"><span data-stu-id="02fb3-109">The Filter Graph Manager can also specify a media type for the connection.</span></span> <span data-ttu-id="02fb3-110">В этом случае ПИН-коды пытаются подключиться к этому типу.</span><span class="sxs-lookup"><span data-stu-id="02fb3-110">If so, the pins try to connect with that type.</span></span> <span data-ttu-id="02fb3-111">В противном случае ПИН-коды должны согласовать тип.</span><span class="sxs-lookup"><span data-stu-id="02fb3-111">If not, the pins must negotiate the type.</span></span> <span data-ttu-id="02fb3-112">Диспетчер графов фильтров может также указывать *частичный* тип носителя, который имеет значение GUID \_ null для основного типа, подтипа или типа формата.</span><span class="sxs-lookup"><span data-stu-id="02fb3-112">The Filter Graph Manager may also specify a *partial* media type, which has the value GUID\_NULL for either the major type, subtype, or format type.</span></span> <span data-ttu-id="02fb3-113">В этом случае ПИН-коды пытаются сопоставить какой-либо фрагмент типа носителя. значение GUID \_ null выступает в качестве подстановочного знака.</span><span class="sxs-lookup"><span data-stu-id="02fb3-113">In that case, the pins try to match whichever portions of the media type were specified; the value GUID\_NULL acts as a wildcard.</span></span>

<span data-ttu-id="02fb3-114">Метод [**кбасепин:: Connect**](cbasepin-connect.md) начинается с проверки того, что ПИН-код может принять соединение.</span><span class="sxs-lookup"><span data-stu-id="02fb3-114">The [**CBasePin::Connect**](cbasepin-connect.md) method starts by verifying that the pin can accept a connection.</span></span> <span data-ttu-id="02fb3-115">Например, он проверяет, что ПИН-код еще не подключен.</span><span class="sxs-lookup"><span data-stu-id="02fb3-115">For example, it checks that the pin is not already connected.</span></span> <span data-ttu-id="02fb3-116">Он делегирует оставшуюся часть процесса подключения методу [**кбасепин:: агримедиатипе**](cbasepin-agreemediatype.md) .</span><span class="sxs-lookup"><span data-stu-id="02fb3-116">It delegates the rest of the connection process to the [**CBasePin::AgreeMediaType**](cbasepin-agreemediatype.md) method.</span></span> <span data-ttu-id="02fb3-117">Все, что следует за, выполняется с помощью **агримедиатипе**.</span><span class="sxs-lookup"><span data-stu-id="02fb3-117">Everything that follows is performed by **AgreeMediaType**.</span></span>

<span data-ttu-id="02fb3-118">Если тип носителя задан полностью, ПИН-код вызывает метод [**кбасепин:: аттемптконнектион**](cbasepin-attemptconnection.md) для попытки подключения.</span><span class="sxs-lookup"><span data-stu-id="02fb3-118">If the media type is fully specified, the pin calls the [**CBasePin::AttemptConnection**](cbasepin-attemptconnection.md) method to attempt the connection.</span></span> <span data-ttu-id="02fb3-119">В противном случае он пытается выполнить типы мультимедиа в следующем порядке:</span><span class="sxs-lookup"><span data-stu-id="02fb3-119">Otherwise, it tries media types in the following order:</span></span>

1.  <span data-ttu-id="02fb3-120">Предпочтительные типы входного ПИН-кода.</span><span class="sxs-lookup"><span data-stu-id="02fb3-120">The input pin's preferred types.</span></span>
2.  <span data-ttu-id="02fb3-121">Предпочтительные типы выходного контакта.</span><span class="sxs-lookup"><span data-stu-id="02fb3-121">The output pin's preferred types.</span></span>

<span data-ttu-id="02fb3-122">Этот порядок можно изменить, задав для флага [**кбасепин:: m \_ Бтримитипесфирст**](cbasepin-m-btrymytypesfirst.md) **значение true**.</span><span class="sxs-lookup"><span data-stu-id="02fb3-122">You can reverse this order by setting the [**CBasePin::m\_bTryMyTypesFirst**](cbasepin-m-btrymytypesfirst.md) flag to **TRUE**.</span></span>

<span data-ttu-id="02fb3-123">В каждом случае ПИН-код вызывает [**Ипин:: енуммедиатипес**](/windows/desktop/api/Strmif/nf-strmif-ipin-enummediatypes) для перечисления типов мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="02fb3-123">In each case, the pin calls [**IPin::EnumMediaTypes**](/windows/desktop/api/Strmif/nf-strmif-ipin-enummediatypes) to enumerate the media types.</span></span> <span data-ttu-id="02fb3-124">Этот метод извлекает объект перечислителя, который передается в метод [**кбасепин:: тримедиатипес**](cbasepin-trymediatypes.md) .</span><span class="sxs-lookup"><span data-stu-id="02fb3-124">This method retrieves an enumerator object, which is passed to the [**CBasePin::TryMediaTypes**](cbasepin-trymediatypes.md) method.</span></span> <span data-ttu-id="02fb3-125">Метод **тримедиатипес** циклически проходит по каждому типу мультимедиа и вызывает [**аттемптконнектион**](cbasepin-attemptconnection.md) для каждого типа.</span><span class="sxs-lookup"><span data-stu-id="02fb3-125">The **TryMediaTypes** method loops through each media type and calls [**AttemptConnection**](cbasepin-attemptconnection.md) for each type.</span></span>

<span data-ttu-id="02fb3-126">В методе [**аттемптконнектион**](cbasepin-attemptconnection.md) закрепление вывода вызывает следующие методы:</span><span class="sxs-lookup"><span data-stu-id="02fb3-126">Within the [**AttemptConnection**](cbasepin-attemptconnection.md) method, the output pin calls the following methods:</span></span>

-   <span data-ttu-id="02fb3-127">Он вызывает [**кбасепин:: чеккконнект**](cbasepin-checkconnect.md) для себя, чтобы проверить, подходит ли входной ПИН-код.</span><span class="sxs-lookup"><span data-stu-id="02fb3-127">It calls [**CBasePin::CheckConnect**](cbasepin-checkconnect.md) on itself, to check whether the input pin is suitable.</span></span>
-   <span data-ttu-id="02fb3-128">Он вызывает [**кбасепин:: чеккмедиатипе**](cbasepin-checkmediatype.md) для себя, чтобы проверить тип носителя.</span><span class="sxs-lookup"><span data-stu-id="02fb3-128">It calls [**CBasePin::CheckMediaType**](cbasepin-checkmediatype.md) on itself, to validate the media type.</span></span>
-   <span data-ttu-id="02fb3-129">Он вызывает [**Ипин:: рецеивеконнектион**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) для входного ПИН-кода.</span><span class="sxs-lookup"><span data-stu-id="02fb3-129">It calls [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) on the input pin.</span></span> <span data-ttu-id="02fb3-130">Входной ПИН-код использует этот метод, чтобы определить, должен ли он принимать соединение.</span><span class="sxs-lookup"><span data-stu-id="02fb3-130">The input pin uses this method to determine whether it should accept the connection.</span></span>
-   <span data-ttu-id="02fb3-131">Он вызывает [**кбасепин:: комплетеконнект**](cbasepin-completeconnect.md) для себя, чтобы завершить соединение.</span><span class="sxs-lookup"><span data-stu-id="02fb3-131">It calls [**CBasePin::CompleteConnect**](cbasepin-completeconnect.md) on itself to completes the connection.</span></span>

<span data-ttu-id="02fb3-132">Следует отметить следующее.</span><span class="sxs-lookup"><span data-stu-id="02fb3-132">Note the following:</span></span>

-   <span data-ttu-id="02fb3-133">[**Чеккконнект**](cbasepin-checkconnect.md) является виртуальным методом.</span><span class="sxs-lookup"><span data-stu-id="02fb3-133">[**CheckConnect**](cbasepin-checkconnect.md) is a virtual method.</span></span> <span data-ttu-id="02fb3-134">В базовом классе этот метод проверяет, совместимы ли направления ПИН-кода.</span><span class="sxs-lookup"><span data-stu-id="02fb3-134">In the base class, this method checks whether the pin directions are compatible.</span></span> <span data-ttu-id="02fb3-135">Выходные контакты должны подключаться к входным ПИН-данным и наоборот.</span><span class="sxs-lookup"><span data-stu-id="02fb3-135">Output pins must connect to input pins, and vice versa.</span></span> <span data-ttu-id="02fb3-136">Производный класс закрепления, как правило, переопределяет этот метод для выполнения других проверок.</span><span class="sxs-lookup"><span data-stu-id="02fb3-136">The derived pin class will typically override this method to perform other checks.</span></span> <span data-ttu-id="02fb3-137">Например, он может запросить другой ПИН-код для интерфейса, который необходим для соединения.</span><span class="sxs-lookup"><span data-stu-id="02fb3-137">For example, it might query the other pin for an interface that is required for the connection.</span></span> <span data-ttu-id="02fb3-138">Если производный класс переопределяет **чеккконнект**, он должен также вызвать метод [**кбасепин**](cbasepin.md) .</span><span class="sxs-lookup"><span data-stu-id="02fb3-138">If the derived class overrides **CheckConnect**, it should also call the [**CBasePin**](cbasepin.md) method.</span></span>
-   <span data-ttu-id="02fb3-139">[**Чеккмедиатипе**](cbasepin-checkmediatype.md) является чисто виртуальным методом, который должен реализовываться производным классом.</span><span class="sxs-lookup"><span data-stu-id="02fb3-139">[**CheckMediaType**](cbasepin-checkmediatype.md) is a pure virtual method, which the derived class must implement.</span></span>
-   <span data-ttu-id="02fb3-140">[**Комплетеконнект**](cbasepin-completeconnect.md) — виртуальный метод, который не выполняет никаких действий в базовом классе.</span><span class="sxs-lookup"><span data-stu-id="02fb3-140">[**CompleteConnect**](cbasepin-completeconnect.md) is a virtual method that does nothing in the base class.</span></span> <span data-ttu-id="02fb3-141">Производные классы могут переопределять этот метод для выполнения любой дополнительной работы, необходимой для завершения подключения, например для выбора распределителя памяти.</span><span class="sxs-lookup"><span data-stu-id="02fb3-141">Derived classes can override this method to perform any additional work needed to complete the connection, such as deciding a memory allocator.</span></span>

<span data-ttu-id="02fb3-142">Если какое-либо из этих действий завершается неудачей, закрепление вывода вызывает метод [**кбасепин:: бреакконнект**](cbasepin-breakconnect.md) , чтобы отменить все действия, сделанные [**чеккконнект**](cbasepin-checkconnect.md).</span><span class="sxs-lookup"><span data-stu-id="02fb3-142">If any of these steps fails, the output pin calls the [**CBasePin::BreakConnect**](cbasepin-breakconnect.md) method to undo whatever steps were taken by [**CheckConnect**](cbasepin-checkconnect.md).</span></span>

<span data-ttu-id="02fb3-143">Метод [**рецеивеконнектион**](cbasepin-receiveconnection.md) входного контакта вызывает методы [**чеккконнект**](cbasepin-checkconnect.md), [**чеккмедиатипе**](cbasepin-checkmediatype.md)и [**комплетеконнект**](cbasepin-completeconnect.md) входного контакта.</span><span class="sxs-lookup"><span data-stu-id="02fb3-143">The input pin's [**ReceiveConnection**](cbasepin-receiveconnection.md) method calls the input pin's [**CheckConnect**](cbasepin-checkconnect.md), [**CheckMediaType**](cbasepin-checkmediatype.md), and [**CompleteConnect**](cbasepin-completeconnect.md) methods.</span></span> <span data-ttu-id="02fb3-144">В случае неудачи попытка подключения также завершится ошибкой.</span><span class="sxs-lookup"><span data-stu-id="02fb3-144">If any of these fail, the connection attempt also fails.</span></span>

<span data-ttu-id="02fb3-145">На следующей схеме показан процесс подключения в [**кбасепин**](cbasepin.md).</span><span class="sxs-lookup"><span data-stu-id="02fb3-145">The following diagram shows the connection process in [**CBasePin**](cbasepin.md):</span></span>

![процесс подключения кбасепин](images/cbasepin-connect.png)

## <a name="related-topics"></a><span data-ttu-id="02fb3-147">См. также</span><span class="sxs-lookup"><span data-stu-id="02fb3-147">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="02fb3-148">**кбасепин**</span><span class="sxs-lookup"><span data-stu-id="02fb3-148">**CBasePin**</span></span>](cbasepin.md)
</dt> </dl>

 

 



