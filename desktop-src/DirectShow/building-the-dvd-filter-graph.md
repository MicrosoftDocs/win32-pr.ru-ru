---
description: Создание графа фильтра DVD
ms.assetid: 1d2f8284-2deb-4207-b067-24a54d6b286c
title: Создание графа фильтра DVD
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 96d15c7d84ec138771e1f5da8be4270faae049cc
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104140527"
---
# <a name="building-the-dvd-filter-graph"></a><span data-ttu-id="bd130-103">Создание графа фильтра DVD</span><span class="sxs-lookup"><span data-stu-id="bd130-103">Building the DVD Filter Graph</span></span>

<span data-ttu-id="bd130-104">Как и в любом приложении DirectShow, приложение для воспроизведения DVD-дисков начинается с создания графа фильтра.</span><span class="sxs-lookup"><span data-stu-id="bd130-104">As with any DirectShow application, a DVD playback application starts by building a filter graph.</span></span> <span data-ttu-id="bd130-105">DirectShow предоставляет следующие компоненты для воспроизведения DVD-дисков:</span><span class="sxs-lookup"><span data-stu-id="bd130-105">DirectShow provides the following components for DVD playback:</span></span>

-   <span data-ttu-id="bd130-106">[Построитель DVD Graph](dvd-graph-builder.md).</span><span class="sxs-lookup"><span data-stu-id="bd130-106">[DVD Graph Builder](dvd-graph-builder.md).</span></span> <span data-ttu-id="bd130-107">Вспомогательный объект, создающий граф фильтра.</span><span class="sxs-lookup"><span data-stu-id="bd130-107">A helper object that constructs the filter graph.</span></span> <span data-ttu-id="bd130-108">Он предоставляет интерфейс [**идвдграфбуилдер**](/windows/desktop/api/Strmif/nn-strmif-idvdgraphbuilder) .</span><span class="sxs-lookup"><span data-stu-id="bd130-108">It exposes the [**IDvdGraphBuilder**](/windows/desktop/api/Strmif/nn-strmif-idvdgraphbuilder) interface.</span></span>
-   <span data-ttu-id="bd130-109">Фильтр [DVD Navigator](dvd-navigator-filter.md) .</span><span class="sxs-lookup"><span data-stu-id="bd130-109">[DVD Navigator](dvd-navigator-filter.md) filter.</span></span> <span data-ttu-id="bd130-110">Фильтр DirectShow, который обрабатывает воспроизведение DVD-дисков, навигацию и другие команды.</span><span class="sxs-lookup"><span data-stu-id="bd130-110">A DirectShow filter that handles DVD playback, navigation, and other commands.</span></span>

<span data-ttu-id="bd130-111">Для воспроизведения DVD также требуется декодер MPEG-2.</span><span class="sxs-lookup"><span data-stu-id="bd130-111">DVD playback also requires an MPEG-2 decoder.</span></span> <span data-ttu-id="bd130-112">Декодеры MPEG-2 и программное обеспечение доступны третьим лицам.</span><span class="sxs-lookup"><span data-stu-id="bd130-112">Hardware and software MPEG-2 decoders are available from third parties.</span></span> <span data-ttu-id="bd130-113">Сначала создайте экземпляр объекта построителя DVD Graph.</span><span class="sxs-lookup"><span data-stu-id="bd130-113">First, create an instance of the DVD Graph Builder object.</span></span>


```C++
IDvdGraphBuilder *pBuild = NULL;
hr = CoCreateInstance(CLSID_DvdGraphBuilder, NULL, 
    CLSCTX_INPROC_SERVER, IID_IDvdGraphBuilder, (void **)&pBuild);
```



<span data-ttu-id="bd130-114">На этом этапе можно выбрать и настроить модуль подготовки видео перед построением остальной части графа.</span><span class="sxs-lookup"><span data-stu-id="bd130-114">At this point, you can select and configure the video renderer before you build the rest of the graph.</span></span> <span data-ttu-id="bd130-115">Этот шаг, который является необязательным, подробно описан в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="bd130-115">This step, which is optional, is described in more detail in the next section.</span></span> <span data-ttu-id="bd130-116">Если пропустить этот шаг, построитель DVD Graph выберет модуль подготовки отчетов по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="bd130-116">If you omit this step, the DVD Graph Builder selects a default renderer.</span></span> <span data-ttu-id="bd130-117">Затем создайте граф, вызвав метод [**идвдграфбуилдер:: рендердвдвидеоволуме**](/windows/desktop/api/Strmif/nf-strmif-idvdgraphbuilder-renderdvdvideovolume) .</span><span class="sxs-lookup"><span data-stu-id="bd130-117">Next, build the graph by calling the [**IDvdGraphBuilder::RenderDvdVideoVolume**](/windows/desktop/api/Strmif/nf-strmif-idvdgraphbuilder-renderdvdvideovolume) method.</span></span>


```C++
AM_DVD_RENDERSTATUS buildStatus;
hr = pBuild->RenderDvdVideoVolume(L"Z:\\video_ts", 0, &buildStatus);
```



<span data-ttu-id="bd130-118">Первый параметр — это имя каталога, содержащего файлы DVD.</span><span class="sxs-lookup"><span data-stu-id="bd130-118">The first parameter is the name of a directory that contains the DVD files.</span></span> <span data-ttu-id="bd130-119">На DVD-диске эти файлы находятся в каталоге с именем VIDEO \_ TS.</span><span class="sxs-lookup"><span data-stu-id="bd130-119">On a DVD disc, these files reside in a directory named VIDEO\_TS.</span></span> <span data-ttu-id="bd130-120">Если первый параметр имеет **значение NULL**, то в построителе DVD Graph используется первый диск, СОДЕРЖАЩИЙ том DVD.</span><span class="sxs-lookup"><span data-stu-id="bd130-120">If the first parameter is **NULL**, the DVD Graph Builder uses the first drive that contains a DVD volume.</span></span>

<span data-ttu-id="bd130-121">Второй параметр содержит различные необязательные флаги для выбора типа декодера (аппаратного или программного обеспечения) и других параметров.</span><span class="sxs-lookup"><span data-stu-id="bd130-121">The second parameter contains various optional flags for choosing the type of decoder (hardware or software) and other options.</span></span>

<span data-ttu-id="bd130-122">Третьим параметром является [**Структура \_ \_ рендерстатус DVD**](/windows/win32/api/strmif/ns-strmif-am_dvd_renderstatus) , которая получает сведения о состоянии.</span><span class="sxs-lookup"><span data-stu-id="bd130-122">The third parameter is an [**AM\_DVD\_RENDERSTATUS**](/windows/win32/api/strmif/ns-strmif-am_dvd_renderstatus) structure that receives status information.</span></span> <span data-ttu-id="bd130-123">Если метод [**рендердвдвидеоволуме**](/windows/desktop/api/Strmif/nf-strmif-idvdgraphbuilder-renderdvdvideovolume) возвращает \_ значение false, это означает, что вызов частично завершился успешно (или частично завершился сбоем, если вы являетесь пессимистичным).</span><span class="sxs-lookup"><span data-stu-id="bd130-123">If the [**RenderDvdVideoVolume**](/windows/desktop/api/Strmif/nf-strmif-idvdgraphbuilder-renderdvdvideovolume) method returns S\_FALSE, it means the call partially succeeded (or partially failed, if you're a pessimist).</span></span> <span data-ttu-id="bd130-124">Например, метод может не обрабатывать поток субтитров, даже если другие потоки успешно визуализируются.</span><span class="sxs-lookup"><span data-stu-id="bd130-124">For example, the method might fail to render the subpicture stream, even though the other streams rendered successfully.</span></span> <span data-ttu-id="bd130-125">Если метод **рендердвдвидеоволуме** возвращает код ошибки или значение \_ false, можно просмотреть сведения об ошибке в структуре **\_ DVD \_ рендерстатус** .</span><span class="sxs-lookup"><span data-stu-id="bd130-125">If the **RenderDvdVideoVolume** method returns an error code or the value S\_FALSE, you can examine the **AM\_DVD\_RENDERSTATUS** structure for details about the error.</span></span>

<span data-ttu-id="bd130-126">Затем получите указатель на диспетчер графа фильтров, вызвав [**идвдграфбуилдер:: жетфилтерграф**](/windows/desktop/api/Strmif/nf-strmif-idvdgraphbuilder-getfiltergraph).</span><span class="sxs-lookup"><span data-stu-id="bd130-126">Next, get a pointer to the Filter Graph Manager by calling [**IDvdGraphBuilder::GetFiltergraph**](/windows/desktop/api/Strmif/nf-strmif-idvdgraphbuilder-getfiltergraph).</span></span> <span data-ttu-id="bd130-127">Этот метод возвращает указатель на интерфейс [**Играфбуилдер**](/windows/desktop/api/Strmif/nn-strmif-igraphbuilder) диспетчера графа фильтров.</span><span class="sxs-lookup"><span data-stu-id="bd130-127">This method returns a pointer to the Filter Graph Manager's [**IGraphBuilder**](/windows/desktop/api/Strmif/nn-strmif-igraphbuilder) interface.</span></span>


```C++
IGraphBuilder *pGraph = NULL;
hr =  pBuild->GetFiltergraph(&m_pGraph);
```



<span data-ttu-id="bd130-128">Используйте метод [**идвдграфбуилдер:: жетдвдинтерфаце**](/windows/desktop/api/Strmif/nf-strmif-idvdgraphbuilder-getdvdinterface) для получения интерфейсов, связанных с DVD, включая следующие:</span><span class="sxs-lookup"><span data-stu-id="bd130-128">Use the [**IDvdGraphBuilder::GetDvdInterface**](/windows/desktop/api/Strmif/nf-strmif-idvdgraphbuilder-getdvdinterface) method to retrieve DVD-related interfaces, including the following:</span></span>

-   <span data-ttu-id="bd130-129">[**IDvdControl2**](/windows/desktop/api/Strmif/nn-strmif-idvdcontrol2).</span><span class="sxs-lookup"><span data-stu-id="bd130-129">[**IDvdControl2**](/windows/desktop/api/Strmif/nn-strmif-idvdcontrol2).</span></span> <span data-ttu-id="bd130-130">Управляет командами воспроизведения и DVD</span><span class="sxs-lookup"><span data-stu-id="bd130-130">Controls playback and DVD commands</span></span>
-   <span data-ttu-id="bd130-131">[**IDvdInfo2**](/windows/desktop/api/Strmif/nn-strmif-idvdinfo2).</span><span class="sxs-lookup"><span data-stu-id="bd130-131">[**IDvdInfo2**](/windows/desktop/api/Strmif/nn-strmif-idvdinfo2).</span></span> <span data-ttu-id="bd130-132">Возвращает сведения о текущем состоянии DVD-навигатора.</span><span class="sxs-lookup"><span data-stu-id="bd130-132">Returns information about the DVD Navigator's current state.</span></span>
-   <span data-ttu-id="bd130-133">[**IAMLine21Decoder**](/previous-versions/windows/desktop/api/il21dec/nn-il21dec-iamline21decoder).</span><span class="sxs-lookup"><span data-stu-id="bd130-133">[**IAMLine21Decoder**](/previous-versions/windows/desktop/api/il21dec/nn-il21dec-iamline21decoder).</span></span> <span data-ttu-id="bd130-134">Управляет отображением скрытых субтитров.</span><span class="sxs-lookup"><span data-stu-id="bd130-134">Controls closed caption display.</span></span> <span data-ttu-id="bd130-135">Отображение скрытых субтитров включено по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="bd130-135">Closed caption display is enabled by default.</span></span> <span data-ttu-id="bd130-136">Чтобы отключить его, вызовите [**IAMLine21Decoder:: SetServiceState**](/previous-versions/windows/desktop/api/il21dec/nf-il21dec-iamline21decoder-setservicestate) с \_ \_ флагом AM L21 ккстате \_ Off.</span><span class="sxs-lookup"><span data-stu-id="bd130-136">To disable it, call [**IAMLine21Decoder::SetServiceState**](/previous-versions/windows/desktop/api/il21dec/nf-il21dec-iamline21decoder-setservicestate) with the AM\_L21\_CCSTATE\_Off flag.</span></span>
-   <span data-ttu-id="bd130-137">[**Ибасикаудио**](/windows/desktop/api/Control/nn-control-ibasicaudio).</span><span class="sxs-lookup"><span data-stu-id="bd130-137">[**IBasicAudio**](/windows/desktop/api/Control/nn-control-ibasicaudio).</span></span> <span data-ttu-id="bd130-138">Управляет звуковым Томом и балансом.</span><span class="sxs-lookup"><span data-stu-id="bd130-138">Controls audio volume and balance.</span></span>

<span data-ttu-id="bd130-139">Например, следующий код возвращает интерфейс [**IDvdControl2**](/windows/desktop/api/Strmif/nn-strmif-idvdcontrol2) .</span><span class="sxs-lookup"><span data-stu-id="bd130-139">For example, the following code returns the [**IDvdControl2**](/windows/desktop/api/Strmif/nn-strmif-idvdcontrol2) interface.</span></span>


```C++
IDvdControl2 *pDvdControl = NULL;
hr = pBuild->GetDvdInterface(IID_IDvdControl2, (void**)&pDvdControl);
```



<span data-ttu-id="bd130-140">Чтобы создать диаграмму фильтра воспроизведения DVD, рекомендуется сделать так, чтобы объект [Видеостроителя](dvd-graph-builder.md) DVD автоматически выполнил его.</span><span class="sxs-lookup"><span data-stu-id="bd130-140">The recommended way to build the DVD playback filter graph is to have a [DVD Graph Builder](dvd-graph-builder.md) object do it for you automatically.</span></span> <span data-ttu-id="bd130-141">Этот подход показан ниже и в примере приложения DVD.</span><span class="sxs-lookup"><span data-stu-id="bd130-141">This approach is demonstrated below and in the DVD sample application.</span></span> <span data-ttu-id="bd130-142">Если вам нужно создать граф фильтра DVD вручную, это можно сделать, следуя основным правилам построения графов, обсуждаемым в других разделах документации по DirectShow.</span><span class="sxs-lookup"><span data-stu-id="bd130-142">If you need to build your DVD filter graph manually, you can do so by following the basic rules of graph building discussed elsewhere in the DirectShow documentation.</span></span> <span data-ttu-id="bd130-143">Как правило, не следует вручную добавлять, удалять, подключать или отключать отдельные фильтры в графе, созданном построителем DVD Graph, так как это может привести к путанице с кодом очистки.</span><span class="sxs-lookup"><span data-stu-id="bd130-143">Generally, you should not manually add, remove, connect, or disconnect individual filters in the graph created by the DVD Graph Builder, because doing so might confuse the cleanup code.</span></span>

<span data-ttu-id="bd130-144">Настройка модуля подготовки видео</span><span class="sxs-lookup"><span data-stu-id="bd130-144">Configuring the Video Renderer</span></span>

<span data-ttu-id="bd130-145">DirectShow предоставляет несколько фильтров модуля подготовки отчетов.</span><span class="sxs-lookup"><span data-stu-id="bd130-145">DirectShow provides several video renderer filters.</span></span> <span data-ttu-id="bd130-146">Перед построением графа можно выбрать, какой модуль подготовки видео вам нужен.</span><span class="sxs-lookup"><span data-stu-id="bd130-146">Before you build the graph, you can chose which video renderer you prefer.</span></span> <span data-ttu-id="bd130-147">Выберите модуль подготовки, вызвав [**идвдграфбуилдер:: жетдвдинтерфаце**](/windows/desktop/api/Strmif/nf-strmif-idvdgraphbuilder-getdvdinterface) и запросив интерфейс, относящийся к этому модулю подготовки отчетов:</span><span class="sxs-lookup"><span data-stu-id="bd130-147">Select the renderer by calling [**IDvdGraphBuilder::GetDvdInterface**](/windows/desktop/api/Strmif/nf-strmif-idvdgraphbuilder-getdvdinterface) and requesting an interface that is specific to that renderer:</span></span>

-   <span data-ttu-id="bd130-148">Фильтр микшера оверлея: [**иддравексклмодевидео**](/windows/desktop/api/Strmif/nn-strmif-iddrawexclmodevideo).</span><span class="sxs-lookup"><span data-stu-id="bd130-148">Overlay Mixer Filter: [**IDDrawExclModeVideo**](/windows/desktop/api/Strmif/nn-strmif-iddrawexclmodevideo).</span></span>
-   <span data-ttu-id="bd130-149">Устройство микширования видео 7 (VMR-7): [**ивмрфилтерконфиг**](/windows/desktop/api/Strmif/nn-strmif-ivmrfilterconfig).</span><span class="sxs-lookup"><span data-stu-id="bd130-149">Video Mixing Renderer 7 (VMR-7): [**IVMRFilterConfig**](/windows/desktop/api/Strmif/nn-strmif-ivmrfilterconfig).</span></span>
-   <span data-ttu-id="bd130-150">Устройство микширования видео 9 (VMR-9): [**IVMRFilterConfig9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrfilterconfig9).</span><span class="sxs-lookup"><span data-stu-id="bd130-150">Video Mixing Renderer 9 (VMR-9): [**IVMRFilterConfig9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrfilterconfig9).</span></span>
-   <span data-ttu-id="bd130-151">Улучшенный обработчик видео (Евр): [**иеврфилтерконфиг**](/windows/desktop/api/evr/nn-evr-ievrfilterconfig).</span><span class="sxs-lookup"><span data-stu-id="bd130-151">Enhanced Video Renderer (EVR): [**IEVRFilterConfig**](/windows/desktop/api/evr/nn-evr-ievrfilterconfig).</span></span>

<span data-ttu-id="bd130-152">Если вы запрашиваете любой из этих интерфейсов перед построением графа фильтра, построитель DVD Graph создает соответствующий модуль подготовки видео.</span><span class="sxs-lookup"><span data-stu-id="bd130-152">If you request any of these interfaces before building the filter graph, the DVD Graph Builder creates the corresponding video renderer.</span></span> <span data-ttu-id="bd130-153">Позже, при построении графа, построитель DVD Graph попытается использовать этот модуль подготовки отчетов.</span><span class="sxs-lookup"><span data-stu-id="bd130-153">Later, when you build the graph, the DVD Graph Builder will try to use that renderer.</span></span> <span data-ttu-id="bd130-154">Но если не удается построить граф с помощью выбранного модуля подготовки отчетов, он может переключиться на другой модуль подготовки отчетов.</span><span class="sxs-lookup"><span data-stu-id="bd130-154">But if it cannot build the graph using the renderer you selected, it may switch to another renderer.</span></span> <span data-ttu-id="bd130-155">Например, декодер MPEG-2 может быть несовместим с фильтром VMR. в этом случае в построителе DVD Graph по умолчанию используется микшер наложения.</span><span class="sxs-lookup"><span data-stu-id="bd130-155">For example, your MPEG-2 decoder might not be compatible with the VMR filter, in which case the DVD Graph Builder would default to the Overlay Mixer.</span></span>

<span data-ttu-id="bd130-156">Эти интерфейсы также дают возможность настроить модуль подготовки отчетов перед его подключением к декодеру.</span><span class="sxs-lookup"><span data-stu-id="bd130-156">These interfaces also give you a chance to configure the renderer before it is connected to the decoder.</span></span> <span data-ttu-id="bd130-157">Например, можно задать VMR для использования режима без окон, а не оконного режима по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="bd130-157">For example, you can set the VMR to use windowless mode instead of the default windowed mode.</span></span> <span data-ttu-id="bd130-158">Дополнительные сведения о модулях подготовки отчетов см. в разделе [о отрисовке видео в DirectShow](about-video-rendering-in-directshow.md).</span><span class="sxs-lookup"><span data-stu-id="bd130-158">For more information about video renderers, see the topic [About Video Rendering in DirectShow](about-video-rendering-in-directshow.md).</span></span>

<span data-ttu-id="bd130-159">В Windows XP и более поздних версиях построитель DVD Graph всегда использует [устройство микширования видео версии 7](video-mixing-renderer-filter-7.md) (VMR-7), если:</span><span class="sxs-lookup"><span data-stu-id="bd130-159">On Windows XP and later, the DVD Graph Builder always uses the [Video Mixing Renderer 7](video-mixing-renderer-filter-7.md) (VMR-7), unless:</span></span>

-   <span data-ttu-id="bd130-160">Вызывающие запросы интерфейсов обнаружили только [микшер наложения](overlay-mixer-filter.md), например [**IMixerPinConfig2**](/windows/desktop/api/Mpconfig/nn-mpconfig-imixerpinconfig2).</span><span class="sxs-lookup"><span data-stu-id="bd130-160">The caller queries interfaces found only the [Overlay Mixer](overlay-mixer-filter.md), such as [**IMixerPinConfig2**](/windows/desktop/api/Mpconfig/nn-mpconfig-imixerpinconfig2).</span></span> <span data-ttu-id="bd130-161">При этом в построителе DVD Graph отправляется указание о том, что приложение хочет использовать микшер наложения, а не VMR.</span><span class="sxs-lookup"><span data-stu-id="bd130-161">This sends a hint to the DVD Graph Builder that the application wants to use the Overlay Mixer and not the VMR.</span></span> <span data-ttu-id="bd130-162">Проигрыватель Windows Media также имеет параметр диалогового окна для принудительного использования микшера наложения.</span><span class="sxs-lookup"><span data-stu-id="bd130-162">Windows Media Player also has a dialog box option to force the use of the Overlay Mixer.</span></span>
-   <span data-ttu-id="bd130-163">Установленный декодер не совместим с VMR.</span><span class="sxs-lookup"><span data-stu-id="bd130-163">The installed decoder is not VMR-compatible.</span></span> <span data-ttu-id="bd130-164">Во время построения графа используется новый интерфейс [**иамдекодеркапс**](/windows/desktop/api/Strmif/nn-strmif-iamdecodercaps) для проверки поддержки VMR декодера.</span><span class="sxs-lookup"><span data-stu-id="bd130-164">During graph building, the new [**IAMDecoderCaps**](/windows/desktop/api/Strmif/nn-strmif-iamdecodercaps) interface is used to check for the decoder's VMR support.</span></span> <span data-ttu-id="bd130-165">Если это не так, в построителе DVD Graph будет использоваться микшер наложения.</span><span class="sxs-lookup"><span data-stu-id="bd130-165">If that is not present, the DVD Graph Builder will use the Overlay Mixer.</span></span>
-   <span data-ttu-id="bd130-166">При использовании аппаратного декодера декодер не может подключиться к [диспетчеру видеопортов](video-port-manager.md) (ВПМ).</span><span class="sxs-lookup"><span data-stu-id="bd130-166">While using a hardware decoder, the decoder cannot connect to the [Video Port Manager](video-port-manager.md) (VPM).</span></span> <span data-ttu-id="bd130-167">Если аппаратный декодер не может использовать ВПМ, он не может использовать VMR, поэтому построитель DVD Graph попытается построить граф с помощью микшера наложения.</span><span class="sxs-lookup"><span data-stu-id="bd130-167">If a hardware decoder cannot use the VPM, then it cannot use the VMR, and so the DVD Graph Builder then tries to build a graph using the Overlay Mixer.</span></span>
-   <span data-ttu-id="bd130-168">Известно, что видеокарта имеет недостаточные ресурсы и (или) возможности для поддержки VMR, но неправильно сообщает об этом в драйвере.</span><span class="sxs-lookup"><span data-stu-id="bd130-168">The display card is known to have insufficient resources and/or capabilities to support the VMR but does not correctly report this in the driver.</span></span> <span data-ttu-id="bd130-169">(Некоторые известные случаи специально исключены построителем DVD Graph.)</span><span class="sxs-lookup"><span data-stu-id="bd130-169">(Some known cases are specifically excluded by the DVD Graph Builder.)</span></span>
-   <span data-ttu-id="bd130-170">Соединение между декодером и VMR завершается сбоем по любой причине, обычно из-за отсутствия видеопамяти для создания необходимых поверхностей.</span><span class="sxs-lookup"><span data-stu-id="bd130-170">The connection between the decoder and the VMR fails for any reason, usually due to a lack of VRAM to create the necessary surfaces.</span></span> <span data-ttu-id="bd130-171">В этих случаях в построителе DVD-дисков параметр VMR используется и пытается использовать микшер наложения для построения графа.</span><span class="sxs-lookup"><span data-stu-id="bd130-171">In these cases, the DVD Graph Builder switches off VMR use and tries to use the Overlay Mixer to build a graph.</span></span>

<span data-ttu-id="bd130-172">Режим с окнами</span><span class="sxs-lookup"><span data-stu-id="bd130-172">Windowed Mode</span></span>

<span data-ttu-id="bd130-173">В оконном режиме (микшер наложения или VMR) модуль подготовки отчетов создает собственное окно видео.</span><span class="sxs-lookup"><span data-stu-id="bd130-173">In windowed mode (Overlay Mixer or VMR), the renderer creates its own video window.</span></span> <span data-ttu-id="bd130-174">Чтобы сделать это окно дочерним по отношению к окну приложения, вызовите [**ивидеовиндов::p UT \_ owner**](/windows/desktop/api/Control/nf-control-ivideowindow-put_owner) с помощью маркера приложения.</span><span class="sxs-lookup"><span data-stu-id="bd130-174">To make this window a child of the application window, call [**IVideoWindow::put\_Owner**](/windows/desktop/api/Control/nf-control-ivideowindow-put_owner) with a handle to the application.</span></span> <span data-ttu-id="bd130-175">Также вызовите [**ивидеовиндов::p UT \_ WindowStyle**](/windows/desktop/api/Control/nf-control-ivideowindow-put_windowstyle) , чтобы установить \_ Стили дочернего приложения и WS \_ клипсиблингс в окне видео модуля подготовки.</span><span class="sxs-lookup"><span data-stu-id="bd130-175">Also call [**IVideoWindow::put\_WindowStyle**](/windows/desktop/api/Control/nf-control-ivideowindow-put_windowstyle) to set the WS\_CHILD and WS\_CLIPSIBLINGS styles on the renderer's video window.</span></span> <span data-ttu-id="bd130-176">Чтобы получить сообщения от мыши из окна видео модуля подготовки, вызовите [**ивидеовиндов::p UT \_ мессажедраин**](/windows/desktop/api/Control/nf-control-ivideowindow-put_messagedrain) с помощью маркера окна приложения.</span><span class="sxs-lookup"><span data-stu-id="bd130-176">To get mouse messages from the renderer's video window, call [**IVideoWindow::put\_MessageDrain**](/windows/desktop/api/Control/nf-control-ivideowindow-put_messagedrain) with a handle to the application window.</span></span> <span data-ttu-id="bd130-177">Этот метод настраивает "стоку сообщений" — видеоокно пересылает все сообщения мыши, полученные в окне "Сток сообщений".</span><span class="sxs-lookup"><span data-stu-id="bd130-177">This method sets up a "message drain" — the video window forwards any mouse messages it receives to the message drain window.</span></span>


```C++
pVideoWindow->put_Owner((OAHWND)hwnd);
pVideoWindow->put_WindowStyle(WS_CHILD | WS_CLIPSIBLINGS);
pVideoWindow->put_MessageDrain((OAHWND)hwnd) ;
```



<span data-ttu-id="bd130-178">Сток сообщений позволяет немного усложнить выбор кнопок в меню DVD.</span><span class="sxs-lookup"><span data-stu-id="bd130-178">The message drain makes selecting DVD menu buttons somewhat complicated.</span></span> <span data-ttu-id="bd130-179">Предполагая, что окно видео не заполняет всю клиентскую область приложения, некоторые события мыши будут находиться за пределами окна видео.</span><span class="sxs-lookup"><span data-stu-id="bd130-179">Assuming the video window does not fill the application's entire client area, some mouse events will fall outside the video window.</span></span> <span data-ttu-id="bd130-180">При получении события мыши из окна видео необходимо обработать его для *навигации в меню* DVD.</span><span class="sxs-lookup"><span data-stu-id="bd130-180">When you get a mouse event from *inside* the video window, you should process it for DVD menu navigation.</span></span> <span data-ttu-id="bd130-181">События мыши *вне* окна видео не должны обрабатываться.</span><span class="sxs-lookup"><span data-stu-id="bd130-181">Mouse events from *outside* the video window should not be processed.</span></span> <span data-ttu-id="bd130-182">С стоком сообщений невозможно различить эти два.</span><span class="sxs-lookup"><span data-stu-id="bd130-182">With the message drain, there is no way to distinguish between the two.</span></span> <span data-ttu-id="bd130-183">Более того, координаты событий мыши из окна видео зависят от клиентской области окна видео. но события мыши вне окна видео зависят от клиентской области приложения.</span><span class="sxs-lookup"><span data-stu-id="bd130-183">Furthermore, the coordinates for mouse events from the video window are relative to the video window's client area; but mouse events from outside the video window are relative to the application's client area.</span></span>

<span data-ttu-id="bd130-184">Режим без окон</span><span class="sxs-lookup"><span data-stu-id="bd130-184">Windowless Mode</span></span>

<span data-ttu-id="bd130-185">Безоконный режим позволяет избежать проблем с сообщениями мыши.</span><span class="sxs-lookup"><span data-stu-id="bd130-185">Windowless mode avoids the problems with mouse messages altogether.</span></span> <span data-ttu-id="bd130-186">Очистка сообщений не требуется, так как VMR (или Евр) не создает собственное окно в режиме без окон.</span><span class="sxs-lookup"><span data-stu-id="bd130-186">You do not need a message drain, because the VMR (or EVR) does not create its own window in windowless mode.</span></span> <span data-ttu-id="bd130-187">Вместо этого он непосредственно рисуется в окне приложения.</span><span class="sxs-lookup"><span data-stu-id="bd130-187">Instead, it draws directly onto your application window.</span></span> <span data-ttu-id="bd130-188">Если размер прямоугольника назначения меньше, чем клиентская область приложения, Навигатор DVD учитывает это при вычислении положения кнопок DVD.</span><span class="sxs-lookup"><span data-stu-id="bd130-188">If the destination rectangle is smaller than the application client area, the DVD Navigator takes this into account when it calculates the DVD button positions.</span></span> <span data-ttu-id="bd130-189">Поэтому при получении сообщения с помощью мыши можно передать координаты непосредственно в Навигатор DVD, как описано в разделе Навигация по меню раздела.</span><span class="sxs-lookup"><span data-stu-id="bd130-189">Therefore, when you get a mouse message, you can pass the coordinates directly to the DVD Navigator, as described in the section Menu Navigation.</span></span>

## <a name="related-topics"></a><span data-ttu-id="bd130-190">См. также</span><span class="sxs-lookup"><span data-stu-id="bd130-190">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="bd130-191">DVD-приложения</span><span class="sxs-lookup"><span data-stu-id="bd130-191">DVD Applications</span></span>](dvd-applications.md)
</dt> </dl>

 

 
