---
description: Активные источники
ms.assetid: 571fe5e5-9616-463b-837c-f8dbb8adf1be
title: Активные источники
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 43486cf3db797f493c9446bf782989b8beaae829
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104495066"
---
# <a name="live-sources"></a><span data-ttu-id="3bb8d-103">Активные источники</span><span class="sxs-lookup"><span data-stu-id="3bb8d-103">Live Sources</span></span>

<span data-ttu-id="3bb8d-104">Активный источник, который также называется *источником push-уведомлений*, получает данные в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-104">A live source, also called a *push source*, receives data in real time.</span></span> <span data-ttu-id="3bb8d-105">Примеры включают видеозапись и широковещательные сети.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-105">Examples include video capture and network broadcasts.</span></span> <span data-ttu-id="3bb8d-106">Как правило, активный источник не может управлять скоростью поступления данных.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-106">In general, a live source cannot control the rate at which data arrives.</span></span>

<span data-ttu-id="3bb8d-107">Фильтр считается активным источником, если выполняется одно из следующих условий.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-107">A filter is considered to be a live source if either of the following are true:</span></span>

-   <span data-ttu-id="3bb8d-108">Фильтр возвращает для фильтра i \_ \_ \_ Флаги \_ -источники флаги \_ источника из метода [**иамфилтермискфлагс:: жетмискфлагс**](/windows/desktop/api/Strmif/nf-strmif-iamfiltermiscflags-getmiscflags) , а по крайней мере один из его выходных контактов предоставляет интерфейс [**иампушсаурце**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) .</span><span class="sxs-lookup"><span data-stu-id="3bb8d-108">The filter returns the AM\_FILTER\_MISC\_FLAGS\_IS\_SOURCE flag from the [**IAMFilterMiscFlags::GetMiscFlags**](/windows/desktop/api/Strmif/nf-strmif-iamfiltermiscflags-getmiscflags) method, AND at least one of its output pins exposes the [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) interface.</span></span>
-   <span data-ttu-id="3bb8d-109">Фильтр предоставляет интерфейс [**икспропертисет**](ikspropertyset.md) и имеет ПИН-код записи ( \_ запись категории закрепления \_ ).</span><span class="sxs-lookup"><span data-stu-id="3bb8d-109">The filter exposes the [**IKsPropertySet**](ikspropertyset.md) interface and has a capture pin (PIN\_CATEGORY\_CAPTURE).</span></span> <span data-ttu-id="3bb8d-110">Дополнительные сведения см. в разделе [закрепить набор свойств](pin-property-set.md) .</span><span class="sxs-lookup"><span data-stu-id="3bb8d-110">See [Pin Property Set](pin-property-set.md) for more information.</span></span>

<span data-ttu-id="3bb8d-111">Если фильтр источника содержит часы, диспетчер графа фильтров будет предпочитать этот момент времени при выборе часового таймера.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-111">If a live source filter provides a clock, the Filter Graph Manager will prefer that clock when it chooses the graph reference clock.</span></span> <span data-ttu-id="3bb8d-112">Дополнительные сведения см. в разделе [эталонные часы](reference-clocks.md) .</span><span class="sxs-lookup"><span data-stu-id="3bb8d-112">See [Reference Clocks](reference-clocks.md) for more information.</span></span>

<span data-ttu-id="3bb8d-113">**Задержка**</span><span class="sxs-lookup"><span data-stu-id="3bb8d-113">**Latency**</span></span>

<span data-ttu-id="3bb8d-114">Задержка фильтра — это период времени, в течение которого Фильтр обрабатывает пример.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-114">A filter's latency is the amount of time it takes the filter to process a sample.</span></span> <span data-ttu-id="3bb8d-115">Для активных источников задержка определяется размером буфера, используемого для хранения выборок.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-115">For live sources, the latency is determined by the size of the buffer used to hold samples.</span></span> <span data-ttu-id="3bb8d-116">Например, предположим, что граф фильтра имеет источник видео с задержкой 33 миллисекунд (МС) и источником звука с задержкой 500 мс.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-116">For example, suppose the filter graph has a video source with a latency of 33 milliseconds (ms) and an audio source with a latency of 500 ms.</span></span> <span data-ttu-id="3bb8d-117">Каждый видеокадр поступает на устройство визуализации видео о 470 МС, прежде чем соответствующий образец будет достигить модуль подготовки звука.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-117">Each video frame arrives at the video renderer about 470 ms before the matching audio sample reaches the audio renderer.</span></span> <span data-ttu-id="3bb8d-118">Если граф не компенсирует разницу, аудио и видео не будут синхронизированы.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-118">Unless the graph compensates for the difference, the audio and video will not be synchronized.</span></span>

<span data-ttu-id="3bb8d-119">Динамические источники можно синхронизировать с помощью интерфейса [**иампушсаурце**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) .</span><span class="sxs-lookup"><span data-stu-id="3bb8d-119">Live sources can be synchronized through the [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) interface.</span></span> <span data-ttu-id="3bb8d-120">Диспетчер графов фильтров не синхронизирует активные источники, если приложение не поддерживает синхронизацию путем вызова метода [**иамграфстреамс:: синкусингстреамоффсет**](/windows/desktop/api/Strmif/nf-strmif-iamgraphstreams-syncusingstreamoffset) .</span><span class="sxs-lookup"><span data-stu-id="3bb8d-120">The Filter Graph Manager does not synchronize live sources unless the application enables synchronization by calling the [**IAMGraphStreams::SyncUsingStreamOffset**](/windows/desktop/api/Strmif/nf-strmif-iamgraphstreams-syncusingstreamoffset) method.</span></span> <span data-ttu-id="3bb8d-121">Если синхронизация включена, диспетчер графа фильтров запрашивает каждый фильтр источника для **иампушсаурце**.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-121">If synchronization is enabled, the Filter Graph Manager queries each source filter for **IAMPushSource**.</span></span> <span data-ttu-id="3bb8d-122">Если фильтр поддерживает **иампушсаурце**, диспетчер графа фильтров вызывает [**иамлатенци::**](/windows/desktop/api/Strmif/nf-strmif-iamlatency-getlatency) для получения ожидаемой задержки фильтра.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-122">If the filter supports **IAMPushSource**, the Filter Graph Manager calls [**IAMLatency::GetLatency**](/windows/desktop/api/Strmif/nf-strmif-iamlatency-getlatency) to retrieve the filter's expected latency.</span></span> <span data-ttu-id="3bb8d-123">(Интерфейс **иампушсаурце** наследует [**иамлатенци**](/windows/desktop/api/Strmif/nn-strmif-iamlatency).) Из Объединенных значений задержки диспетчер графов фильтров определяет максимальную ожидаемую задержку в графе.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-123">(The **IAMPushSource** interface inherits [**IAMLatency**](/windows/desktop/api/Strmif/nn-strmif-iamlatency).) From the combined latency values, the Filter Graph Manager determines the maximum expected latency in the graph.</span></span> <span data-ttu-id="3bb8d-124">Затем он вызывает метод [**иампушсаурце:: сетстреамоффсет**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-setstreamoffset) , чтобы каждому исходному фильтру присвоено смещение потока, которое фильтр добавляет к создаваемым им штампам времени.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-124">It then calls [**IAMPushSource::SetStreamOffset**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-setstreamoffset) to give each source filter a stream offset, which that filter adds to the time stamps that it generates.</span></span>

<span data-ttu-id="3bb8d-125">Этот метод предназначен в первую очередь для интерактивной предварительной версии.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-125">This method is intended primarily for live preview.</span></span> <span data-ttu-id="3bb8d-126">Однако обратите внимание, что предварительный ПИН-код на устройстве записи в режиме реального времени (например, на камере) не устанавливает штампы временных меток для образцов, которые она предоставляет.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-126">However, note that a preview pin on a live capture device (such as a camera) does not set time stamps on the samples it delivers.</span></span> <span data-ttu-id="3bb8d-127">Поэтому для использования этого метода с устройством записи в реальном времени необходимо предварительно просмотреть ПИН-код записи.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-127">Therefore, to use this method with a live capture device, you must preview from the capture pin.</span></span> <span data-ttu-id="3bb8d-128">Дополнительные сведения см. в статье [Фильтры захвата видео DirectShow](directshow-video-capture-filters.md).</span><span class="sxs-lookup"><span data-stu-id="3bb8d-128">For more information, see [DirectShow Video Capture Filters](directshow-video-capture-filters.md).</span></span>

<span data-ttu-id="3bb8d-129">В настоящее время интерфейс [**иампушсаурце**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) поддерживается фильтром [записи VFW](vfw-capture-filter.md) и фильтром [записи звука](audio-capture-filter.md) .</span><span class="sxs-lookup"><span data-stu-id="3bb8d-129">Currently the [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) interface is supported by the [VFW Capture](vfw-capture-filter.md) filter and the [Audio Capture](audio-capture-filter.md) filter.</span></span>

<span data-ttu-id="3bb8d-130">**Сопоставление частоты**</span><span class="sxs-lookup"><span data-stu-id="3bb8d-130">**Rate Matching**</span></span>

<span data-ttu-id="3bb8d-131">Если фильтр модуля подготовки отчетов планирует выборку с помощью одного эталонного таймера, но фильтр источника создает их, используя разные часы, при воспроизведении могут возникать сбои.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-131">If a renderer filter schedules samples using one reference clock, but the source filter produces them using a different clock, glitches can occur in playback.</span></span> <span data-ttu-id="3bb8d-132">Модуль подготовки отчетов может работать быстрее, чем источник, что приводит к пропуску данных.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-132">The renderer might run faster than the source, causing gaps in the data.</span></span> <span data-ttu-id="3bb8d-133">Или может выполняться медленнее, чем источник, что приводит к тому, что выборка выполняется в несколько точек до тех пор, пока на диаграмме образцы не будут удалены.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-133">Or it might run slower than the source, causing samples to "bunch up," until at some point the graph will drop samples.</span></span> <span data-ttu-id="3bb8d-134">Как правило, активный источник не может управлять своей производственной частотой, поэтому модуль подготовки отчетов должен соответствовать тарифам с источником.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-134">Typically, a live source cannot control its production rate, so instead the renderer should match rates with the source.</span></span>

<span data-ttu-id="3bb8d-135">В настоящее время сопоставление скорости выполняется только модулем подготовки звука, так как сбои в воспроизведении аудио являются более заметными, чем сбои в видео.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-135">Currently, only the audio renderer performs rate matching, because glitches in audio playback are more noticeable than glitches in video.</span></span> <span data-ttu-id="3bb8d-136">Чтобы выполнить согласование скорости, модуль подготовки звука должен выбрать что-то, с которым он будет соответствовать тарифам.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-136">To perform rate-matching, the audio renderer must select something against which it will match rates.</span></span> <span data-ttu-id="3bb8d-137">Он использует следующий алгоритм:</span><span class="sxs-lookup"><span data-stu-id="3bb8d-137">It uses the following algorithm:</span></span>

-   <span data-ttu-id="3bb8d-138">Если граф не использует ссылочный период, модуль подготовки звука не пытается согласовать тарифы.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-138">If the graph is not using a reference clock, the audio renderer does not try to match rates.</span></span> <span data-ttu-id="3bb8d-139">(Если на графе нет эталонного таймера, выборки всегда подготавливаются сразу же после их прибытия.)</span><span class="sxs-lookup"><span data-stu-id="3bb8d-139">(Whenever the graph has no reference clock, samples are always rendered immediately as they arrive.)</span></span>
-   <span data-ttu-id="3bb8d-140">В противном случае, если для графа имеется эталонный таймер, модуль подготовки звука проверяет, существует ли потоковая передача в реальном времени, используя описанные выше критерии.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-140">Otherwise, if there is a reference clock for the graph, the audio renderer checks whether there is a live source upstream, using the criteria described previously.</span></span> <span data-ttu-id="3bb8d-141">Если нет, то модуль подготовки звука не соответствует тарифам.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-141">If not, the audio renderer does not match rates.</span></span>
-   <span data-ttu-id="3bb8d-142">Если имеется потоковая передача в реальном времени и этот источник предоставляет интерфейс [**иампушсаурце**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) на выходном ПИН-коде, модуль подготовки звука вызывает [**Иампушсаурце:: жетпушсаурцефлагс**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-getpushsourceflags).</span><span class="sxs-lookup"><span data-stu-id="3bb8d-142">If there is a live source upstream, and that source exposes the [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) interface on its output pin, the audio renderer calls [**IAMPushSource::GetPushSourceFlags**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-getpushsourceflags).</span></span> <span data-ttu-id="3bb8d-143">Он ищет один из следующих флагов:</span><span class="sxs-lookup"><span data-stu-id="3bb8d-143">It looks for one of the following flags:</span></span>
    -   <span data-ttu-id="3bb8d-144">\_пушсаурцекапс \_ внутренний \_ RM.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-144">AM\_PUSHSOURCECAPS\_INTERNAL\_RM.</span></span> <span data-ttu-id="3bb8d-145">Этот флаг означает, что фильтр источника имеет собственный механизм сопоставления ставок, поэтому модуль подготовки звука не соответствует тарифам.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-145">This flag means the source filter has its own rate-matching mechanism, so the audio renderer does not match rates.</span></span>
    -   <span data-ttu-id="3bb8d-146">\_пушсаурцекапс \_ не \_ проживает.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-146">AM\_PUSHSOURCECAPS\_NOT\_LIVE.</span></span> <span data-ttu-id="3bb8d-147">Этот флаг означает, что фильтр источника не является фактически исходным источником, несмотря на то, что он предоставляет интерфейс [**иампушсаурце**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) .</span><span class="sxs-lookup"><span data-stu-id="3bb8d-147">This flag means the source filter is not really a live source, even though it exposes the [**IAMPushSource**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) interface.</span></span> <span data-ttu-id="3bb8d-148">Таким образом, модуль подготовки звука не соответствует тарифам.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-148">Therefore, the audio renderer does not match rates.</span></span>
    -   <span data-ttu-id="3bb8d-149">\_пушсаурцекапс \_ закрытые \_ часы.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-149">AM\_PUSHSOURCECAPS\_PRIVATE\_CLOCK.</span></span> <span data-ttu-id="3bb8d-150">Этот флаг означает, что фильтр источника использует закрытые часы для создания меток времени.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-150">This flag means the source filter is using a private clock to generate time stamps.</span></span> <span data-ttu-id="3bb8d-151">В этом случае модуль подготовки звука сопоставляет ставки с метками времени.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-151">In this case, the audio renderer matches rates against the time stamps.</span></span> <span data-ttu-id="3bb8d-152">(Если для образцов не заданы отметки времени, модуль подготовки отчетов игнорирует этот флаг.)</span><span class="sxs-lookup"><span data-stu-id="3bb8d-152">(If the samples have no time stamps, however, the renderer ignores this flag.)</span></span>
-   <span data-ttu-id="3bb8d-153">Если [**жетпушсаурцефлагс**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-getpushsourceflags) не возвращает флаги (ноль), поведение модуля подготовки звука зависит от часов графа, а также от того, имеют ли образцы отметки времени:</span><span class="sxs-lookup"><span data-stu-id="3bb8d-153">If [**GetPushSourceFlags**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-getpushsourceflags) returns no flags (zero), the audio renderer's behavior depends on the graph clock and whether the samples have time stamps:</span></span>
    -   <span data-ttu-id="3bb8d-154">Если модуль подготовки звука не является часами графа, а образцы имеют отметки времени, модуль подготовки звука соответствует тарифам в соответствии с отметками времени.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-154">If the audio renderer is not the graph clock, AND the samples have time stamps, the audio renderer matches rates against the time stamps.</span></span>
    -   <span data-ttu-id="3bb8d-155">Если у образцов нет штампов времени, модуль подготовки звука пытается согласовать скорость входящих звуковых данных.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-155">If the samples do not have time stamps, the audio renderer tries to match the rate of incoming audio data.</span></span>
    -   <span data-ttu-id="3bb8d-156">Если модуль подготовки звука является часами графа, он пытается сопоставить входящую скорость передачи данных.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-156">If the audio renderer is the graph clock, it tries to match the incoming data rate.</span></span>

<span data-ttu-id="3bb8d-157">Причиной последнего варианта является следующее: Если модуль подготовки звука является эталонным, а фильтр источника использует те же часы для создания штампов времени, то модуль подготовки звука не может согласовать скорости с отметками времени.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-157">The reason for the last case is the following: If the audio renderer is the reference clock, and the source filter is using the same clock to generate time stamps, then the audio renderer cannot match rates against the time stamps.</span></span> <span data-ttu-id="3bb8d-158">Если это так, то, в свою очередь, попытается согласовать тарифы с самим собой, что может привести к смещению часов.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-158">If it did, in effect it would be trying to match rates with itself, which could cause the clock to drift.</span></span> <span data-ttu-id="3bb8d-159">Поэтому в этом случае модуль подготовки отчетов соответствует скорости входящих звуковых данных.</span><span class="sxs-lookup"><span data-stu-id="3bb8d-159">Therefore, in this case the renderer matches the rate of incoming audio data.</span></span>

## <a name="related-topics"></a><span data-ttu-id="3bb8d-160">См. также</span><span class="sxs-lookup"><span data-stu-id="3bb8d-160">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3bb8d-161">Время и часы в DirectShow</span><span class="sxs-lookup"><span data-stu-id="3bb8d-161">Time and Clocks in DirectShow</span></span>](time-and-clocks-in-directshow.md)
</dt> </dl>

 

 



