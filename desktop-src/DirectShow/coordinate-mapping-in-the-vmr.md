---
description: Сопоставление координат в VMR
ms.assetid: f0821b90-51d1-4e77-8aed-04337a3dd623
title: Сопоставление координат в VMR
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c18b38249471e6e68e36f1b9051f51e920f62b31
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "103894361"
---
# <a name="coordinate-mapping-in-the-vmr"></a><span data-ttu-id="ad591-103">Сопоставление координат в VMR</span><span class="sxs-lookup"><span data-stu-id="ad591-103">Coordinate Mapping in the VMR</span></span>

<span data-ttu-id="ad591-104">В этом разделе описаны пять преобразований, применяемых к исходному изображению перед его сопоставлением VMR с окончательным выходным изображением.</span><span class="sxs-lookup"><span data-stu-id="ad591-104">This section describes the five transformations that are applied to a source image before it is mapped by the VMR onto the final output image.</span></span>

1.  <span data-ttu-id="ad591-105">Преобразование *T (src)* сопоставляет исходный прямоугольник с конечным прямоугольником.</span><span class="sxs-lookup"><span data-stu-id="ad591-105">The transformation *T(Src)* maps the source rectangle to the destination rectangle.</span></span> <span data-ttu-id="ad591-106">Они задаются членами **рксаурце** и **рктаржет** структуры [**видеоинфохеадер**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) или [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2) в типе мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="ad591-106">These are specified by the **rcSource** and **rcTarget** members of the [**VIDEOINFOHEADER**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) or [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2) structure in the media type.</span></span> <span data-ttu-id="ad591-107">Это сопоставление предварительно обрабатывает исходное изображение, которое передается в VMR.</span><span class="sxs-lookup"><span data-stu-id="ad591-107">This mapping preprocesses the source image as it passes to the VMR.</span></span>
2.  <span data-ttu-id="ad591-108">Преобразование *T (флаг)* выполняет любые манипуляции с изображениями, заданные флагами в примере носителя.</span><span class="sxs-lookup"><span data-stu-id="ad591-108">The transformation *T(Flag)* performs any image manipulations specified by flags in the media sample.</span></span> <span data-ttu-id="ad591-109">Эти преобразования, такие как вертикальное преобразование и масштабирование, удовлетворяют флагам чересстрочную развертки.</span><span class="sxs-lookup"><span data-stu-id="ad591-109">These included transformations such as the vertical translation and scale to accommodate the bob interlace flags.</span></span> <span data-ttu-id="ad591-110">Преобразование «развертка» удваивает высоту изображения и, возможно, преобразует изображение на половину строки видео, если оно находится в нечетном поле.</span><span class="sxs-lookup"><span data-stu-id="ad591-110">The interlace transformation doubles the image height and possibly translates the image by half of a video line if it is in the odd field.</span></span>
3.  <span data-ttu-id="ad591-111">Преобразование *T (AR)* корректирует изображение до квадратных пикселей на основе пропорций изображения.</span><span class="sxs-lookup"><span data-stu-id="ad591-111">The transformation *T(AR)* adjusts the image to square pixels, based on the image aspect ratio.</span></span> <span data-ttu-id="ad591-112">Для типов мультимедиа **видеоинфохеадер** пропорции определяются размером изображения.</span><span class="sxs-lookup"><span data-stu-id="ad591-112">For **VIDEOINFOHEADER** media types, the aspect ratio is determined by the image size.</span></span> <span data-ttu-id="ad591-113">Для типов **VIDEOINFOHEADER2** пропорции определяются полями **двпиктаспектратиокс** и **двпиктаспектратиой** , если только не \_ задано амконтрол Pad \_ на \_ 16x9 или амконтрол \_ Pad \_ в \_ 4x3 flags.</span><span class="sxs-lookup"><span data-stu-id="ad591-113">For **VIDEOINFOHEADER2** types, the aspect ratio is determined by the **dwPictAspectRatioX** and **dwPictAspectRatioY** fields, unless the AMCONTROL\_PAD\_TO\_16x9 or AMCONTROL\_PAD\_TO\_4x3 flags are set.</span></span> <span data-ttu-id="ad591-114">Это преобразование предполагает, что параметр отображения монитора соответствует физическому пропорции монитора.</span><span class="sxs-lookup"><span data-stu-id="ad591-114">This transformation assumes that the monitor display setting matches the physical aspect ratio of the monitor.</span></span> <span data-ttu-id="ad591-115">Например, если у пользователя есть монитор с пропорциями 4 x 3, но устанавливает дисплей на 1280 x 768 пикселей (5 x 3), изображение не будет иметь правильных пропорций.</span><span class="sxs-lookup"><span data-stu-id="ad591-115">For example, if the user has a monitor with 4 x 3 aspect ratio, but sets the display to 1280 x 768 pixels (5 x 3), the image will not have the correct aspect ratio.</span></span>
4.  <span data-ttu-id="ad591-116">Преобразования «Преобразование *T (Mix)* » размещает изображение в целевом изображении с использованием нормализованных прямоугольников, указанных в методах [**ивмрмиксерконтрол**](/windows/desktop/api/Strmif/nn-strmif-ivmrmixercontrol) .</span><span class="sxs-lookup"><span data-stu-id="ad591-116">The transformation *T(Mix)* transforms positions the image within the destination image, using the normalized rectangles specified in the [**IVMRMixerControl**](/windows/desktop/api/Strmif/nn-strmif-ivmrmixercontrol) methods.</span></span> <span data-ttu-id="ad591-117">Нормализованные прямоугольники позволяют приложению организовать расположение и масштабирование исходных потоков и масштабировать их относительно друг друга.</span><span class="sxs-lookup"><span data-stu-id="ad591-117">The normalized rectangles enable the application to organize how the source streams are positioned and scaled relative to each other.</span></span> <span data-ttu-id="ad591-118">VMR Вычисляет целевое изображение, вычисляя максимальные размеры всех исходных изображений и выровнять каждый из них внутри общего ограничивающего прямоугольника.</span><span class="sxs-lookup"><span data-stu-id="ad591-118">The VMR computes the destination image by computing the maximum dimensions of all the source images and centering each inside an overall bounding rectangle.</span></span> <span data-ttu-id="ad591-119">Углы ограничивающего прямоугольника назначаются диапазону (0, 0) (1, 1).</span><span class="sxs-lookup"><span data-stu-id="ad591-119">The corners of the bounding rectangle are assigned the range (0,0) to (1,1).</span></span> <span data-ttu-id="ad591-120">Ограничивающий прямоугольник фиксируется до выполнения графа и остается постоянным, даже если потоки добавляются или удаляются.</span><span class="sxs-lookup"><span data-stu-id="ad591-120">The bounding rectangle is fixed before the graph runs and remains constant even if streams are added or deleted.</span></span> <span data-ttu-id="ad591-121">Прямоугольники назначения для каждого потока могут находиться вне диапазона (0, 0) до (1, 1) и по-прежнему быть допустимыми.</span><span class="sxs-lookup"><span data-stu-id="ad591-121">Destination rectangles for each stream can lie outside of the range (0,0) to (1,1) and still be valid.</span></span>
5.  <span data-ttu-id="ad591-122">Наконец, часть смешанного изображения может быть преобразована с помощью сопоставления *T (DST)*, заданного исходным и целевым прямоугольниками в интерфейсе [**ибасиквидео**](/windows/desktop/api/Control/nn-control-ibasicvideo) в VMR.</span><span class="sxs-lookup"><span data-stu-id="ad591-122">Finally, a portion of the mixed image can be transformed by the mapping *T(Dst)*, specified by the source and destination rectangles in the [**IBasicVideo**](/windows/desktop/api/Control/nn-control-ibasicvideo) interface on the VMR.</span></span> <span data-ttu-id="ad591-123">Если Allocator-Presenter заменяется и интерфейс **ибасиквидео** не используется, приложение должно реализовать интерфейс [**ивмрвиндовлессконтрол**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol) и сопоставлять координаты обратно в плоское линейное пространство.</span><span class="sxs-lookup"><span data-stu-id="ad591-123">If the Allocator-Presenter is replaced and the **IBasicVideo** interface is not used, the application must implement the [**IVMRWindowlessControl**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol) interface and map the coordinates back into a 2D linear space.</span></span> <span data-ttu-id="ad591-124">Координаты мыши, возвращаемые в Навигатор DVD, также должны находиться в этом пространстве.</span><span class="sxs-lookup"><span data-stu-id="ad591-124">The mouse coordinates returned to the DVD navigator must also be in this space.</span></span> <span data-ttu-id="ad591-125">Например, если приложение визуализирует видео в вращающийся куб, оно будет сообщать о полном отображении элемента управления без окон и возвращать координаты мыши относительно отображения.</span><span class="sxs-lookup"><span data-stu-id="ad591-125">For example, if an application renders video onto a spinning cube, they would report back the entire display for the windowless control and return mouse coordinates relative to the display.</span></span>

<span data-ttu-id="ad591-126">Полное преобразование образа из источника данных в окончательный модуль подготовки отчетов:</span><span class="sxs-lookup"><span data-stu-id="ad591-126">The overall image transformation from the source data to the final renderer is:</span></span>

<span data-ttu-id="ad591-127">T = T (src) \* t (флаг) t (AR) t (Mix) \* t (DST)\*</span><span class="sxs-lookup"><span data-stu-id="ad591-127">T = T(Src)\* T(Flag)T(Ar)T(Mix)\* T(Dst)\*</span></span>

<span data-ttu-id="ad591-128">где \* указывает, что изображение можно обрезать на целевом изображении на этом этапе.</span><span class="sxs-lookup"><span data-stu-id="ad591-128">where \* indicates that the image could be clipped to the destination image at that stage.</span></span> <span data-ttu-id="ad591-129">Обратите внимание, что это все аффинных преобразования, поэтому VMR может объединить их в одно преобразование.</span><span class="sxs-lookup"><span data-stu-id="ad591-129">Note that these are all affine transformations, so the VMR can combine them into a single transformation.</span></span>

<span data-ttu-id="ad591-130">Обратная часть преобразования:</span><span class="sxs-lookup"><span data-stu-id="ad591-130">The inverse of the transformation is:</span></span>

![обратное преобразование](images/vmrmapping-t-1.png)

<span data-ttu-id="ad591-132">Коэффициент t (src) t (флаг) T (AR) задается относительно разрешения источника.</span><span class="sxs-lookup"><span data-stu-id="ad591-132">The factor T(Src) T(Flag) T(Ar) is relative to the source resolution.</span></span> <span data-ttu-id="ad591-133">В коэффициенте T (Mix) нормализованный исходный прямоугольник является относительным к исправленному изображению.</span><span class="sxs-lookup"><span data-stu-id="ad591-133">In the factor T(Mix), the normalized source rectangle is relative to the aspect-corrected image.</span></span> <span data-ttu-id="ad591-134">Нормализованный конечный прямоугольник является относительным для разрешения вывода.</span><span class="sxs-lookup"><span data-stu-id="ad591-134">The normalized destination rectangle is relative to the output resolution.</span></span> <span data-ttu-id="ad591-135">Эти связи показаны на следующей схеме.</span><span class="sxs-lookup"><span data-stu-id="ad591-135">The following diagram shows these relationships.</span></span>

![шаги преобразования изображений](images/vmrmapping-transform-steps.png)

## <a name="related-topics"></a><span data-ttu-id="ad591-137">См. также</span><span class="sxs-lookup"><span data-stu-id="ad591-137">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ad591-138">Использование VMR для разработчиков фильтров DirectShow</span><span class="sxs-lookup"><span data-stu-id="ad591-138">Using the VMR for DirectShow Filter Developers</span></span>](using-the-vmr-for-directshow-filter-developers.md)
</dt> </dl>

 

 



