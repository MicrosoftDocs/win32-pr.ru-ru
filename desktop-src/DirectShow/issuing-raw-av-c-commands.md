---
description: Выдача необработанных команд AV/C
ms.assetid: 18081652-962f-4605-84b7-1fa60f61ad05
title: Выдача необработанных команд AV/C
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 729cad0be3a55a3f95592e54e8f91b9074892a8d111da9ad996b4e00a136cbe1
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118153791"
---
# <a name="issuing-raw-avc-commands"></a>Выдача необработанных команд AV/C

Интерфейсы [**иамекстдевице**](/windows/desktop/api/Strmif/nn-strmif-iamextdevice), [**иамексттранспорт**](/windows/desktop/api/Strmif/nn-strmif-iamexttransport)и [**иамтимекодереадер**](/windows/desktop/api/Strmif/nn-strmif-iamtimecodereader) работают путем перевода вызовов метода в команды для драйвера, интерпретации ответа драйвера и его возврата через **HRESULT** или выходной параметр. Однако некоторые функции устройства могут быть недоступны через эти методы. Таким образом, МСДВ поддерживает отправку необработанных команд AV/C на устройство.

При использовании этой функции следует учитывать следующие моменты:

-   Команда передается непосредственно на устройство без проверки ошибок или параметров. по этой причине следует выдавать необработанные команды AV/C, только если интерфейсы DirectShow не реализуют нужные вам функции.
-   Все необработанные команды AV/C являются синхронными. Поток, выдающий команду, блокируется до тех пор, пока команда не вернет значение.
-   В каждый момент времени может быть предоставлена только одна команда. Во время обработки команды устройство будет отклонять любые дополнительные команды.
-   Драйвер УВК не поддерживает необработанные команды AV/C.

Чтобы отправить команду AV/C, отформатируйте команду в виде массива байтов. Затем вызовите [**иамексттранспорт:: жеттранспортбасикпараметерс**](/windows/desktop/api/Strmif/nf-strmif-iamexttransport-gettransportbasicparameters). Передайте флаг "ED \_ RAW \_ ext cmd" \_ \_ , размер массива и массив. Необходимо привести адрес массива к типу **лполестр \*** , поскольку первоначальное назначение этого параметра было бы возвращать строковое значение.


```C++
BYTE AvcCmd[] = { ... }; // Contains the AV/C command (not shown)
long cbCmd = sizeof(AvcCmd);
hr = pTransport->GetTransportBasicParameters(
    ED_RAW_EXT_DEV_CMD, 
    &cbCmd,
    (LPOLESTR*) AvcCmd);
```



Содержимое массива передается непосредственно на устройство, поэтому необходимо соблюдать осторожность при правильном форматировании. Команда может ориентироваться на единицу (видеокамера) или подединицу (ленту или камеру). Соответствующие стандарты доступны на [веб-сайте торговой связи 1394](https://1394ta.org).

-   Общая спецификация набора команд для цифрового интерфейса AV/C
-   Спецификация подразделений для записи или воспроизведения на ленте AV/C

В предыдущем описан способ форматирования команд AV/C и перечислены команды единиц измерения. В последней спецификации перечислены команды подединицы.

Метод **жеттранспортбасикпараметерс** может возвращать один из следующих кодов ошибок:



| Код ошибки              | Описание                                                                      |
|-------------------------|----------------------------------------------------------------------------------|
| \_время ожидания ошибки          | Время ожидания команды истекло.                                                           |
| Ошибка \_ req \_ не \_ акцеп  | Устройство не приняло команду.                                           |
| Ошибка \_ не \_ поддерживается   | Устройство не поддерживает команду.                                         |
| запрос на ошибку \_ \_ прерван | Команда была прервана. Поссбли устройство удалено или произошла сброс шины. |



 

> [!Note]  
> Эти ошибки возвращаются в виде кодов ошибок Win32, а не значений HRESULT, поэтому следует проверить эти значения напрямую, вместо того чтобы использовать макросы с **успехом** и **сбоем** .

 

Если метод возвращает значение S \_ , ответ от устройства копируется в массив. Полезные данные ответа могут быть больше, чем команда, поэтому необходимо выделить буфер, достаточно большой для его хранения. Максимальный размер полезных данных — 512 байт. Обратите внимание, что возвращаемое значение S \_ OK не всегда означает, что устройство успешно выполнило команду. Чтобы определить состояние, приложение должно проверить полезные данные ответа.

В следующем примере показана команда для поиска абсолютного номера записи.


```C++
// Set up the ATN search command.
BYTE AvcCmd[] = 
{ 
    0x00,   // ctype = "control"
    0x20,   // subunit_type, subunit_id
    0x52,   // opcode (ATN)
    0x20,   // operand 0 = "search"
    0x00,   // operand 1 = ATN
    0x00,   // operand 2 = ATN
    0x00,   // operand 3 = ATN
    0xFF   //  operand 4 = D-VCR medium type.
};
// Specify a track number.
ULONG ulTrackNumber = track_number; // Specify the track number here.
// Shift over by 1 (LSB of operand 1 is a 1-bit blank flag)
ulTrackNumber = ulTrackNumber << 1; 
// Plug this number into operands 1 - 3.
AvcCmd[4] = (BYTE) (ulTrackNumber & 0x000000FF);
AvcCmd[5] = (BYTE)((ulTrackNumber & 0x0000FF00) >> 8);
AvcCmd[6] = (BYTE)((ulTrackNumber & 0x00FF0000) >> 16);
```



## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Управление видеокамерой](controlling-a-dv-camcorder.md)
</dt> </dl>

 

 



