---
description: Использование шаблона класса DMO
ms.assetid: 5193ad08-aaee-47e3-93eb-a126a66d8f23
title: Использование шаблона класса DMO
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4db80017372f11f6c928e0e6a83b591967a84ee7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104081089"
---
# <a name="using-the-dmo-class-template"></a><span data-ttu-id="a9c09-103">Использование шаблона класса DMO</span><span class="sxs-lookup"><span data-stu-id="a9c09-103">Using the DMO Class Template</span></span>

<span data-ttu-id="a9c09-104">DirectShow включает шаблон класса [**имедиаобжектимпл**](imediaobjectimpl-class-template.md)для реализации дмос.</span><span class="sxs-lookup"><span data-stu-id="a9c09-104">DirectShow includes a class template, [**IMediaObjectImpl**](imediaobjectimpl-class-template.md), for implementing DMOs.</span></span> <span data-ttu-id="a9c09-105">Шаблон обрабатывает множество задач по регистрации, например проверку входных параметров.</span><span class="sxs-lookup"><span data-stu-id="a9c09-105">The template handles many of the "bookkeeping" tasks, such as validating input parameters.</span></span> <span data-ttu-id="a9c09-106">С помощью шаблона вы можете сосредоточиться на функциональных возможностях, характерных для объектов DMO.</span><span class="sxs-lookup"><span data-stu-id="a9c09-106">By using the template, you can focus on the functionality that is specific to your DMO.</span></span> <span data-ttu-id="a9c09-107">Кроме того, шаблон помогает гарантировать создание надежной реализации.</span><span class="sxs-lookup"><span data-stu-id="a9c09-107">In addition, the template helps to ensure that you create a robust implementation.</span></span> <span data-ttu-id="a9c09-108">Шаблон определяется в файле заголовка Дмоимпл. h, расположенном в каталоге Include пакета SDK.</span><span class="sxs-lookup"><span data-stu-id="a9c09-108">The template is defined in the header file Dmoimpl.h, located in the Include directory of the SDK.</span></span>

<span data-ttu-id="a9c09-109">Шаблон **имедиаобжектимпл** наследует интерфейс [**имедиаобжект**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediaobject) .</span><span class="sxs-lookup"><span data-stu-id="a9c09-109">The **IMediaObjectImpl** template inherits the [**IMediaObject**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediaobject) interface.</span></span> <span data-ttu-id="a9c09-110">Чтобы создать DMO с помощью шаблона, определите новый класс, производный от **имедиаобжектимпл**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-110">To create a DMO using the template, define a new class that derives from **IMediaObjectImpl**.</span></span> <span data-ttu-id="a9c09-111">Шаблон реализует все методы **имедиаобжект** .</span><span class="sxs-lookup"><span data-stu-id="a9c09-111">The template implements all of the **IMediaObject** methods.</span></span> <span data-ttu-id="a9c09-112">В большинстве случаев шаблон вызывает соответствующий закрытый метод производного класса.</span><span class="sxs-lookup"><span data-stu-id="a9c09-112">In most cases, the template calls a corresponding private method on the derived class.</span></span> <span data-ttu-id="a9c09-113">Этот шаблон предоставляет следующие возможности.</span><span class="sxs-lookup"><span data-stu-id="a9c09-113">The template provides the following features:</span></span>

-   <span data-ttu-id="a9c09-114">Проверка основных параметров.</span><span class="sxs-lookup"><span data-stu-id="a9c09-114">Basic parameter checking.</span></span> <span data-ttu-id="a9c09-115">Методы шаблона проверяют, что обязательные параметры не равны **null**, индексы потоков находятся в пределах диапазона, и что эти флаги допустимы.</span><span class="sxs-lookup"><span data-stu-id="a9c09-115">The template methods verify that required parameters are not **NULL**, that stream indexes are within range, and that flags are valid.</span></span>
-   <span data-ttu-id="a9c09-116">Блокировкой.</span><span class="sxs-lookup"><span data-stu-id="a9c09-116">Locking.</span></span> <span data-ttu-id="a9c09-117">Методы шаблона вызывают два внутренних метода: **Lock** и **Unlock** для сериализации операций в DMO.</span><span class="sxs-lookup"><span data-stu-id="a9c09-117">The template methods call two internal methods, **Lock** and **Unlock**, to serialize operations on the DMO.</span></span> <span data-ttu-id="a9c09-118">Эта функция гарантирует, что DMO будет потокобезопасным.</span><span class="sxs-lookup"><span data-stu-id="a9c09-118">This feature ensures that the DMO is thread-safe.</span></span>
-   <span data-ttu-id="a9c09-119">Типы носителей.</span><span class="sxs-lookup"><span data-stu-id="a9c09-119">Media types.</span></span> <span data-ttu-id="a9c09-120">Шаблон хранит типы носителей, заданные клиентом, и предоставляет методы доступа для типов мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="a9c09-120">The template stores the media types set by the client, and provides accessor methods for the media types.</span></span>
-   <span data-ttu-id="a9c09-121">Потоки.</span><span class="sxs-lookup"><span data-stu-id="a9c09-121">Streaming.</span></span> <span data-ttu-id="a9c09-122">Шаблон предотвращает потоковую передачу, пока клиент не настроил типы мультимедиа для всех необязательных потоков.</span><span class="sxs-lookup"><span data-stu-id="a9c09-122">The template prevents streaming until the client has set media types for all non-optional streams.</span></span> <span data-ttu-id="a9c09-123">Это также гарантирует, что метод [**имедиаобжект:: аллокатестреамингресаурцес**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-allocatestreamingresources) вызывается перед началом потоковой передачи, что гарантирует выделение ресурсов.</span><span class="sxs-lookup"><span data-stu-id="a9c09-123">It also ensures that the [**IMediaObject::AllocateStreamingResources**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-allocatestreamingresources) method is called before streaming begins, which guarantees that resources are allocated.</span></span>

<span data-ttu-id="a9c09-124">Производный класс должен реализовывать интерфейс **IUnknown** ; Этот интерфейс не предоставляется шаблоном.</span><span class="sxs-lookup"><span data-stu-id="a9c09-124">The derived class must implement the **IUnknown** interface; the template does not provide this interface.</span></span> <span data-ttu-id="a9c09-125">Можно использовать библиотеку активных шаблонов (ATL) для реализации **IUnknown** или предоставить некоторую другую реализацию.</span><span class="sxs-lookup"><span data-stu-id="a9c09-125">You can use the Active Template Library (ATL) to implement **IUnknown**, or you can provide some other implementation.</span></span> <span data-ttu-id="a9c09-126">В шаблоне также не реализован механизм блокировки.</span><span class="sxs-lookup"><span data-stu-id="a9c09-126">The template also does not implement the locking mechanism.</span></span> <span data-ttu-id="a9c09-127">Производный класс должен реализовывать методы **Lock** и **Unlock** .</span><span class="sxs-lookup"><span data-stu-id="a9c09-127">The derived class must implement the **Lock** and **Unlock** methods.</span></span> <span data-ttu-id="a9c09-128">При создании класса с помощью ATL можно использовать реализации ATL по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="a9c09-128">If you create your class using ATL, you can use the default ATL implementations.</span></span>

<span data-ttu-id="a9c09-129">**Объявление производного класса**</span><span class="sxs-lookup"><span data-stu-id="a9c09-129">**Declaring the Derived Class**</span></span>

<span data-ttu-id="a9c09-130">Шаблон класса **имедиаобжектимпл** объявляется следующим образом:</span><span class="sxs-lookup"><span data-stu-id="a9c09-130">The **IMediaObjectImpl** class template is declared as follows:</span></span>


```C++
template <class _DERIVED_, int NUMBEROFINPUTS, int NUMBEROFOUTPUTS>
class IMediaObjectImpl : public ImediaObject
```



<span data-ttu-id="a9c09-131">Три параметра шаблона являются \_ производными \_ , НУМБЕРОФИНПУТС и нумберофаутпутс.</span><span class="sxs-lookup"><span data-stu-id="a9c09-131">The three template parameters are \_DERIVED\_, NUMBEROFINPUTS, and NUMBEROFOUTPUTS.</span></span> <span data-ttu-id="a9c09-132">Задайте значение \_ производное \_ равным имени класса.</span><span class="sxs-lookup"><span data-stu-id="a9c09-132">Set \_DERIVED\_ equal to the name of your class.</span></span> <span data-ttu-id="a9c09-133">Два других параметра определяют количество входных потоков и потоков вывода в DMO.</span><span class="sxs-lookup"><span data-stu-id="a9c09-133">The other two parameters define the number of input streams and output streams on the DMO.</span></span> <span data-ttu-id="a9c09-134">Например, чтобы создать класс DMO с именем Кмидмо, который поддерживает один входной поток и два выходных потока, используйте следующее объявление:</span><span class="sxs-lookup"><span data-stu-id="a9c09-134">For example, to create a DMO class named CMyDmo that supports one input stream and two output streams, use the following declaration:</span></span>


```C++
class CMyDmo : public IMediaObjectImpl<CMyDmo, 1, 2>
```



<span data-ttu-id="a9c09-135">Оставшаяся часть этого раздела описывает, как шаблон реализует различные методы в **имедиаобжект**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-135">The remainder of this section describes how the template implements the various methods in **IMediaObject**.</span></span>

<span data-ttu-id="a9c09-136">**Методы установки типов мультимедиа**</span><span class="sxs-lookup"><span data-stu-id="a9c09-136">**Methods for Setting Media Types**</span></span>

<span data-ttu-id="a9c09-137">Следующие методы устанавливают или извлекают типы мультимедиа в DMO:</span><span class="sxs-lookup"><span data-stu-id="a9c09-137">The following methods set or retrieve media types on the DMO:</span></span>

-   <span data-ttu-id="a9c09-138">**Жетинпуттипе**, **жетаутпуттипе**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-138">**GetInputType**, **GetOutputType**.</span></span> <span data-ttu-id="a9c09-139">Эти методы возвращают предпочтительные типы мультимедиа по номеру потока и индексу типа.</span><span class="sxs-lookup"><span data-stu-id="a9c09-139">These methods return preferred media types, by stream number and type index.</span></span> <span data-ttu-id="a9c09-140">Шаблон вызывает **интерналжетинпуттипе** или **интерналжетаутпуттипе** в производном классе.</span><span class="sxs-lookup"><span data-stu-id="a9c09-140">The template calls **InternalGetInputType** or **InternalGetOutputType** on the derived class.</span></span>
-   <span data-ttu-id="a9c09-141">**Сетинпуттипе**, **сетаутпуттипе**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-141">**SetInputType**, **SetOutputType**.</span></span> <span data-ttu-id="a9c09-142">Эти методы задают тип мультимедиа в потоке, проверяют тип носителя или удаляют тип носителя.</span><span class="sxs-lookup"><span data-stu-id="a9c09-142">These methods set the media type on a stream, test a media type, or clear a media type.</span></span> <span data-ttu-id="a9c09-143">Чтобы проверить тип носителя, шаблон вызывает **интерналчеккинпуттипе** или **интерналчеккаутпуттипе** в производном классе.</span><span class="sxs-lookup"><span data-stu-id="a9c09-143">To validate the media type, the template calls **InternalCheckInputType** or **InternalCheckOutputType** on the derived class.</span></span> <span data-ttu-id="a9c09-144">Производный класс возвращает S \_ ОК, чтобы принять тип или DMO \_ E \_ инвалидтипе для отклонения типа.</span><span class="sxs-lookup"><span data-stu-id="a9c09-144">The derived class returns S\_OK to accept the type or DMO\_E\_INVALIDTYPE to reject the type.</span></span> <span data-ttu-id="a9c09-145">Шаблон обрабатывает установку или очистку типа носителя.</span><span class="sxs-lookup"><span data-stu-id="a9c09-145">The template handles setting or clearing the media type.</span></span>
-   <span data-ttu-id="a9c09-146">**Жетинпуткурренттипе**, **жетаутпуткурренттипе**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-146">**GetInputCurrentType**, **GetOutputCurrentType**.</span></span> <span data-ttu-id="a9c09-147">Эти методы возвращают текущий тип мультимедиа для потока или \_ тип DMO E, \_ \_ \_ Если тип не задан.</span><span class="sxs-lookup"><span data-stu-id="a9c09-147">These methods return the current media type for a stream, or DMO\_E\_TYPE\_NOT\_SET if no type is set.</span></span> <span data-ttu-id="a9c09-148">Шаблон полностью реализует эти методы.</span><span class="sxs-lookup"><span data-stu-id="a9c09-148">The template completely implements these methods.</span></span>

<span data-ttu-id="a9c09-149">**Информационные методы**</span><span class="sxs-lookup"><span data-stu-id="a9c09-149">**Informational Methods**</span></span>

<span data-ttu-id="a9c09-150">Следующие методы предоставляют сведения о DMO.</span><span class="sxs-lookup"><span data-stu-id="a9c09-150">The following methods provide information about the DMO.</span></span>

-   <span data-ttu-id="a9c09-151">**Жетинпутмакслатенци**, **сетинпутмакслатенци**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-151">**GetInputMaxLatency**, **SetInputMaxLatency**.</span></span> <span data-ttu-id="a9c09-152">Эти методы извлекают или устанавливают максимальную задержку.</span><span class="sxs-lookup"><span data-stu-id="a9c09-152">These methods retrieve or set the maximum latency.</span></span> <span data-ttu-id="a9c09-153">Шаблон вызывает **интерналжетинпутмакслатенци** или **интерналсетинпутмакслатенци** в производном классе.</span><span class="sxs-lookup"><span data-stu-id="a9c09-153">The template calls **InternalGetInputMaxLatency** or **InternalSetInputMaxLatency** on the derived class.</span></span>
-   <span data-ttu-id="a9c09-154">**Жетинпутсизеинфо**, **жетаутпутсизеинфо**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-154">**GetInputSizeInfo**, **GetOutputSizeInfo**.</span></span> <span data-ttu-id="a9c09-155">Эти методы возвращают требования к буферу DMO для указанного потока.</span><span class="sxs-lookup"><span data-stu-id="a9c09-155">These methods return the DMO's buffer requirements for a specified stream.</span></span> <span data-ttu-id="a9c09-156">Если для этого потока не задан тип мультимедиа, шаблон Возвращает тип DMO " \_ \_ \_ не \_ задан".</span><span class="sxs-lookup"><span data-stu-id="a9c09-156">If no media type has been set on that stream, the template returns DMO\_E\_TYPE\_NOT\_SET.</span></span> <span data-ttu-id="a9c09-157">В противном случае он вызывает **интерналжетинпутсизеинфо** или **интерналжетаутпутсизеинфо** в производном классе.</span><span class="sxs-lookup"><span data-stu-id="a9c09-157">Otherwise, it calls **InternalGetInputSizeInfo** or **InternalGetOutputSizeInfo** on the derived class.</span></span>
-   <span data-ttu-id="a9c09-158">**Жетинпутстреаминфо**, **жетаутпутстреаминфо**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-158">**GetInputStreamInfo**, **GetOutputStreamInfo**.</span></span> <span data-ttu-id="a9c09-159">Эти методы возвращают различные флаги, которые указывают, как клиент должен форматировать данные.</span><span class="sxs-lookup"><span data-stu-id="a9c09-159">These methods return various flags that indicate how the client should format the data.</span></span> <span data-ttu-id="a9c09-160">Шаблон вызывает **интерналжетинпутстреаминфо** или **интерналжетаутпутстреаминфо** в производном классе.</span><span class="sxs-lookup"><span data-stu-id="a9c09-160">The template calls **InternalGetInputStreamInfo** or **InternalGetOutputStreamInfo** on the derived class.</span></span>
-   <span data-ttu-id="a9c09-161">**Жетстреамкаунт**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-161">**GetStreamCount**.</span></span> <span data-ttu-id="a9c09-162">Этот метод возвращает число потоков ввода и вывода.</span><span class="sxs-lookup"><span data-stu-id="a9c09-162">This method returns the number of input and output streams.</span></span> <span data-ttu-id="a9c09-163">Шаблон реализует этот метод с помощью параметров шаблона.</span><span class="sxs-lookup"><span data-stu-id="a9c09-163">The template implements this method, using the template parameters.</span></span>

<span data-ttu-id="a9c09-164">**Методы для выделения ресурсов**</span><span class="sxs-lookup"><span data-stu-id="a9c09-164">**Methods for Resource Allocation**</span></span>

-   <span data-ttu-id="a9c09-165">Метод **аллокатестреамингресаурцес** выделяет все ресурсы, необходимые для DMO перед началом потоковой передачи.</span><span class="sxs-lookup"><span data-stu-id="a9c09-165">The **AllocateStreamingResources** method allocates any resources the DMO needs before streaming begins.</span></span> <span data-ttu-id="a9c09-166">Метод **фристреамингресаурцес** освобождает те же ресурсы.</span><span class="sxs-lookup"><span data-stu-id="a9c09-166">The **FreeStreamingResources** method releases the same resources.</span></span> <span data-ttu-id="a9c09-167">Шаблон вызывает **интерналаллокатестреамингресаурцес** и **интерналфристреамингресаурцес** соответственно.</span><span class="sxs-lookup"><span data-stu-id="a9c09-167">The template calls **InternalAllocateStreamingResources** and **InternalFreeStreamingResources**, respectively.</span></span>

<span data-ttu-id="a9c09-168">Клиенту DMO не требуется вызывать эти методы, но шаблон автоматически вызывает **аллокатестреамингресаурцес** перед запуском потоковой передачи.</span><span class="sxs-lookup"><span data-stu-id="a9c09-168">The client of the DMO is not required to call these methods, but the template automatically calls **AllocateStreamingResources** before streaming starts.</span></span> <span data-ttu-id="a9c09-169">Таким образом, DMO может предположить, что ресурсы были правильно распределены по времени, вызванном методом **ProcessInput** .</span><span class="sxs-lookup"><span data-stu-id="a9c09-169">Therefore, the DMO can assume that resources are have been allocated correctly by the time **ProcessInput** is called.</span></span> <span data-ttu-id="a9c09-170">DMO должен вызвать **фристреамингресаурцес** в своем деструкторе.</span><span class="sxs-lookup"><span data-stu-id="a9c09-170">The DMO should call **FreeStreamingResources** in its destructor.</span></span>

<span data-ttu-id="a9c09-171">Кроме того, когда шаблон вызывает **интерналаллокатестреамингресаурцес**, он устанавливает внутренний флаг, чтобы он не вызывал этот метод еще раз до вызова **интерналфристреамингресаурцес**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-171">Also, when the template calls **InternalAllocateStreamingResources**, it sets an internal flag, so that it does not call that method again until calling **InternalFreeStreamingResources**.</span></span> <span data-ttu-id="a9c09-172">Это гарантирует, что ресурсы не будут перераспределяться случайно, что может привести к утечкам памяти.</span><span class="sxs-lookup"><span data-stu-id="a9c09-172">This ensures that resources are not re-allocated accidentally, which could cause memory leaks.</span></span>

<span data-ttu-id="a9c09-173">**Методы потоковой передачи**</span><span class="sxs-lookup"><span data-stu-id="a9c09-173">**Methods for Streaming**</span></span>

<span data-ttu-id="a9c09-174">Для потоковой передачи данных используются следующие методы.</span><span class="sxs-lookup"><span data-stu-id="a9c09-174">The following methods are used to stream data:</span></span>

-   <span data-ttu-id="a9c09-175">**Жетинпутстатус**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-175">**GetInputStatus**.</span></span> <span data-ttu-id="a9c09-176">Этот метод указывает, может ли объект DMO принимать входные данные в данный момент.</span><span class="sxs-lookup"><span data-stu-id="a9c09-176">This method indicates whether the DMO can accept input at this time.</span></span> <span data-ttu-id="a9c09-177">Шаблон вызывает **интерналакцептингинпут** в производном классе.</span><span class="sxs-lookup"><span data-stu-id="a9c09-177">The template calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="a9c09-178">Если объекты DMO могут принимать входные данные, то производный класс возвращает \_ значение S ОК, а шаблон задает \_ бит входных \_ данных статусф для DMO \_ \_ в параметре *dwFlags* .</span><span class="sxs-lookup"><span data-stu-id="a9c09-178">If the DMO can accept input, the derived class returns S\_OK and the template sets the DMO\_INPUT\_STATUSF\_ACCEPT\_DATA bit in the *dwFlags* parameter.</span></span> <span data-ttu-id="a9c09-179">В противном случае производный класс возвращает \_ значение false, а шаблон задает для *dwFlags* значение 0.</span><span class="sxs-lookup"><span data-stu-id="a9c09-179">Otherwise, the derived class returns S\_FALSE and the template sets *dwFlags* to zero.</span></span>
-   <span data-ttu-id="a9c09-180">**ProcessInput**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-180">**ProcessInput**.</span></span> <span data-ttu-id="a9c09-181">Этот метод обрабатывает входной буфер.</span><span class="sxs-lookup"><span data-stu-id="a9c09-181">This method processes an input buffer.</span></span> <span data-ttu-id="a9c09-182">Шаблон вызывает **аллокатестреамингресаурцес**, описанный выше.</span><span class="sxs-lookup"><span data-stu-id="a9c09-182">The template calls **AllocateStreamingResources**, described previously.</span></span> <span data-ttu-id="a9c09-183">Затем он вызывает **интерналакцептингинпут** в производном классе.</span><span class="sxs-lookup"><span data-stu-id="a9c09-183">Then it calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="a9c09-184">Если DMO может принимать новые входные данные, шаблон вызывает **интерналпроцессинпут**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-184">If the DMO can accept new input, the template calls **InternalProcessInput**.</span></span>
-   <span data-ttu-id="a9c09-185">**ProcessOutput**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-185">**ProcessOutput**.</span></span> <span data-ttu-id="a9c09-186">Этот метод обрабатывает набор выходных буферов, по одному буферу для каждого выходного потока.</span><span class="sxs-lookup"><span data-stu-id="a9c09-186">This method processes a set of output buffers, one buffer for each output stream.</span></span> <span data-ttu-id="a9c09-187">Шаблон вызывает **аллокатестреамингресаурцес** , а затем **интерналпроцессаутпут**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-187">The template calls **AllocateStreamingResources** and then **InternalProcessOutput**.</span></span>
-   <span data-ttu-id="a9c09-188">**Ненепрерывность**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-188">**Discontinuity**.</span></span> <span data-ttu-id="a9c09-189">Этот метод сигнализирует о прекращении поддержки во входном потоке.</span><span class="sxs-lookup"><span data-stu-id="a9c09-189">This method signals a discontinuity in an input stream.</span></span> <span data-ttu-id="a9c09-190">Шаблон вызывает **интерналакцептингинпут** в производном классе.</span><span class="sxs-lookup"><span data-stu-id="a9c09-190">The template calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="a9c09-191">Если этот метод возвращает значение \_ ОК, шаблон вызывает **интерналдисконтинуити** для производного класса.</span><span class="sxs-lookup"><span data-stu-id="a9c09-191">If that method returns S\_OK, the template calls **InternalDiscontinuity** on the derived class.</span></span>
-   <span data-ttu-id="a9c09-192">**Сброс**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-192">**Flush**.</span></span> <span data-ttu-id="a9c09-193">Этот метод очищает DMO.</span><span class="sxs-lookup"><span data-stu-id="a9c09-193">This method flushes the DMO.</span></span> <span data-ttu-id="a9c09-194">Шаблон вызывает **интерналфлуш** в производном классе.</span><span class="sxs-lookup"><span data-stu-id="a9c09-194">The template calls **InternalFlush** on the derived class.</span></span> <span data-ttu-id="a9c09-195">DMO должен удалить все входные буферы, которые все еще хранятся для обработки.</span><span class="sxs-lookup"><span data-stu-id="a9c09-195">The DMO should discard any input buffers that it still holds to be processed.</span></span>

<span data-ttu-id="a9c09-196">Шаблон не предоставляет прямой поддержки для интерфейса [**имедиаобжектинплаце**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobjectinplace) .</span><span class="sxs-lookup"><span data-stu-id="a9c09-196">The template does not provide any direct support for the [**IMediaObjectInPlace**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobjectinplace) interface.</span></span>

<span data-ttu-id="a9c09-197">**Методы блокировки**</span><span class="sxs-lookup"><span data-stu-id="a9c09-197">**Methods for Locking**</span></span>

<span data-ttu-id="a9c09-198">Блокировка используется для защиты состояния DMO в многопоточной среде.</span><span class="sxs-lookup"><span data-stu-id="a9c09-198">Locking is used to protect the DMO's state in a multithreaded environment.</span></span> <span data-ttu-id="a9c09-199">В проекте ATL метод [**имедиаобжект:: Lock**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-lock) вызывает конфликт имен с методом **блокировки** ATL.</span><span class="sxs-lookup"><span data-stu-id="a9c09-199">In an ATL project, the [**IMediaObject::Lock**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-lock) method causes a name conflict with the ATL **Lock** method.</span></span> <span data-ttu-id="a9c09-200">Для разрешения конфликта шаблон переименовывает метод **имедиаобжект** в **дмолокк**.</span><span class="sxs-lookup"><span data-stu-id="a9c09-200">To resolve the conflict, the template renames the **IMediaObject** method to **DMOLock**.</span></span> <span data-ttu-id="a9c09-201">При компиляции производного класса Определите имя исправления, \_ \_ прежде чем включать файл заголовка DMO. h:</span><span class="sxs-lookup"><span data-stu-id="a9c09-201">When you compile the derived class, define FIX\_LOCK\_NAME before including the header file Dmo.h:</span></span>


```C++
#define FIX_LOCK_NAME
#include <dmo.h>
```



<span data-ttu-id="a9c09-202">Эта директива заставляет препроцессору заменять **дмолокк** для **блокировки** в объявлении интерфейса **имедиаобжект** .</span><span class="sxs-lookup"><span data-stu-id="a9c09-202">This directive causes the preprocessor to substitute **DMOLock** for **Lock** in the declaration of the **IMediaObject** interface.</span></span> <span data-ttu-id="a9c09-203">Приложения по-прежнему могут вызывать метод с помощью **блокировки** имени, так как порядок vtable не изменяется.</span><span class="sxs-lookup"><span data-stu-id="a9c09-203">Applications can still invoke the method using the name **Lock**, because the vtable order does not change.</span></span> <span data-ttu-id="a9c09-204">Метод **дмолокк** вызывает **блокировку** или **разблокировку** в производном классе.</span><span class="sxs-lookup"><span data-stu-id="a9c09-204">The **DMOLock** method calls **Lock** or **Unlock** on the derived class.</span></span> <span data-ttu-id="a9c09-205">Если для реализации производного класса используется ATL, эти методы уже определены в ATL, поэтому дополнительный код не требуется.</span><span class="sxs-lookup"><span data-stu-id="a9c09-205">If you are using ATL to implement the derived class, these methods are already defined by ATL, so no additional code is necessary.</span></span> <span data-ttu-id="a9c09-206">Если вы не используете ATL, необходимо предоставить методы **Lock** и **Unlock** в производном классе.</span><span class="sxs-lookup"><span data-stu-id="a9c09-206">If you are not using ATL, you must provide **Lock** and **Unlock** methods in your derived class.</span></span>

<span data-ttu-id="a9c09-207">Шаблон автоматически блокирует DMO в каждом из методов **имедиаобжект** .</span><span class="sxs-lookup"><span data-stu-id="a9c09-207">The template automatically locks the DMO in each of the **IMediaObject** methods.</span></span> <span data-ttu-id="a9c09-208">Производному классу может потребоваться заблокировать DMO в других открытых методах, которые он реализует (например, если он поддерживает **имедиаобжектинплаце**).</span><span class="sxs-lookup"><span data-stu-id="a9c09-208">The derived class might need to lock the DMO inside other public methods that it implements (for example, if it supports **IMediaObjectInPlace**).</span></span> <span data-ttu-id="a9c09-209">Шаблон класса также предоставляет внутренний вспомогательный класс [**имедиаобжектимпл:: локкит**](imediaobjectimpl-lockit.md), который полезен для блокировки и разблокировки DMO.</span><span class="sxs-lookup"><span data-stu-id="a9c09-209">The class template also provides an internal helper class, [**IMediaObjectImpl::LockIt**](imediaobjectimpl-lockit.md), which is useful for locking and unlocking the DMO.</span></span>

<span data-ttu-id="a9c09-210">**Сводка**</span><span class="sxs-lookup"><span data-stu-id="a9c09-210">**Summary**</span></span>

<span data-ttu-id="a9c09-211">Для следующих методов **имедиаобжект** шаблон вызывает соответствующий метод с той же сигнатурой в производном классе.</span><span class="sxs-lookup"><span data-stu-id="a9c09-211">For the following **IMediaObject** methods, the template calls a corresponding method with the same signature on the derived class.</span></span> <span data-ttu-id="a9c09-212">Производный класс должен реализовывать каждый из методов, показанных во втором столбце.</span><span class="sxs-lookup"><span data-stu-id="a9c09-212">The derived class must implement each of the methods shown in the second column.</span></span>



| <span data-ttu-id="a9c09-213">Метод Имедиаобжект</span><span class="sxs-lookup"><span data-stu-id="a9c09-213">IMediaObject Method</span></span>            | <span data-ttu-id="a9c09-214">Метод производного класса</span><span class="sxs-lookup"><span data-stu-id="a9c09-214">Derived Class Method</span></span>                   |
|--------------------------------|----------------------------------------|
| <span data-ttu-id="a9c09-215">**аллокатестреамингресаурцес**</span><span class="sxs-lookup"><span data-stu-id="a9c09-215">**AllocateStreamingResources**</span></span> | <span data-ttu-id="a9c09-216">**интерналаллокатестреамингресаурцес**</span><span class="sxs-lookup"><span data-stu-id="a9c09-216">**InternalAllocateStreamingResources**</span></span> |
| <span data-ttu-id="a9c09-217">**Разрыв**</span><span class="sxs-lookup"><span data-stu-id="a9c09-217">**Discontinuity**</span></span>              | <span data-ttu-id="a9c09-218">**интерналдисконтинуити**</span><span class="sxs-lookup"><span data-stu-id="a9c09-218">**InternalDiscontinuity**</span></span>              |
| <span data-ttu-id="a9c09-219">**Очистка**</span><span class="sxs-lookup"><span data-stu-id="a9c09-219">**Flush**</span></span>                      | <span data-ttu-id="a9c09-220">**интерналфлуш**</span><span class="sxs-lookup"><span data-stu-id="a9c09-220">**InternalFlush**</span></span>                      |
| <span data-ttu-id="a9c09-221">**фристреамингресаурцес**</span><span class="sxs-lookup"><span data-stu-id="a9c09-221">**FreeStreamingResources**</span></span>     | <span data-ttu-id="a9c09-222">**интерналфристреамингресаурцес**</span><span class="sxs-lookup"><span data-stu-id="a9c09-222">**InternalFreeStreamingResources**</span></span>     |
| <span data-ttu-id="a9c09-223">**жетинпутмакслатенци**</span><span class="sxs-lookup"><span data-stu-id="a9c09-223">**GetInputMaxLatency**</span></span>         | <span data-ttu-id="a9c09-224">**интерналжетинпутмакслатенци**</span><span class="sxs-lookup"><span data-stu-id="a9c09-224">**InternalGetInputMaxLatency**</span></span>         |
| <span data-ttu-id="a9c09-225">**жетинпутсизеинфо**</span><span class="sxs-lookup"><span data-stu-id="a9c09-225">**GetInputSizeInfo**</span></span>           | <span data-ttu-id="a9c09-226">**интерналжетинпутсизеинфо**</span><span class="sxs-lookup"><span data-stu-id="a9c09-226">**InternalGetInputSizeInfo**</span></span>           |
| <span data-ttu-id="a9c09-227">**жетинпутстреаминфо**</span><span class="sxs-lookup"><span data-stu-id="a9c09-227">**GetInputStreamInfo**</span></span>         | <span data-ttu-id="a9c09-228">**интерналжетинпутстреаминфо**</span><span class="sxs-lookup"><span data-stu-id="a9c09-228">**InternalGetInputStreamInfo**</span></span>         |
| <span data-ttu-id="a9c09-229">**жетинпуттипе**</span><span class="sxs-lookup"><span data-stu-id="a9c09-229">**GetInputType**</span></span>               | <span data-ttu-id="a9c09-230">**интерналжетинпуттипе**</span><span class="sxs-lookup"><span data-stu-id="a9c09-230">**InternalGetInputType**</span></span>               |
| <span data-ttu-id="a9c09-231">**жетаутпутсизеинфо**</span><span class="sxs-lookup"><span data-stu-id="a9c09-231">**GetOutputSizeInfo**</span></span>          | <span data-ttu-id="a9c09-232">**интерналжетаутпутсизеинфо**</span><span class="sxs-lookup"><span data-stu-id="a9c09-232">**InternalGetOutputSizeInfo**</span></span>          |
| <span data-ttu-id="a9c09-233">**жетаутпутстреаминфо**</span><span class="sxs-lookup"><span data-stu-id="a9c09-233">**GetOutputStreamInfo**</span></span>        | <span data-ttu-id="a9c09-234">**интерналжетаутпутстреаминфо**</span><span class="sxs-lookup"><span data-stu-id="a9c09-234">**InternalGetOutputStreamInfo**</span></span>        |
| <span data-ttu-id="a9c09-235">**жетаутпуттипе**</span><span class="sxs-lookup"><span data-stu-id="a9c09-235">**GetOutputType**</span></span>              | <span data-ttu-id="a9c09-236">**интерналжетаутпуттипе**</span><span class="sxs-lookup"><span data-stu-id="a9c09-236">**InternalGetOutputType**</span></span>              |
| <span data-ttu-id="a9c09-237">**ProcessInput**</span><span class="sxs-lookup"><span data-stu-id="a9c09-237">**ProcessInput**</span></span>               | <span data-ttu-id="a9c09-238">**интерналпроцессинпут**</span><span class="sxs-lookup"><span data-stu-id="a9c09-238">**InternalProcessInput**</span></span>               |
| <span data-ttu-id="a9c09-239">**ProcessOutput**</span><span class="sxs-lookup"><span data-stu-id="a9c09-239">**ProcessOutput**</span></span>              | <span data-ttu-id="a9c09-240">**интерналпроцессаутпут**</span><span class="sxs-lookup"><span data-stu-id="a9c09-240">**InternalProcessOutput**</span></span>              |
| <span data-ttu-id="a9c09-241">**сетинпутмакслатенци**</span><span class="sxs-lookup"><span data-stu-id="a9c09-241">**SetInputMaxLatency**</span></span>         | <span data-ttu-id="a9c09-242">**интерналсетинпутмакслатенци**</span><span class="sxs-lookup"><span data-stu-id="a9c09-242">**InternalSetInputMaxLatency**</span></span>         |



 

<span data-ttu-id="a9c09-243">Для оставшихся методов **имедиаобжект** не существует соответствия "один к одному" между методами шаблонов и методами производного класса.</span><span class="sxs-lookup"><span data-stu-id="a9c09-243">For the remaining **IMediaObject** methods, there is not a one-to-one correspondence between template methods and derived-class methods.</span></span> <span data-ttu-id="a9c09-244">В следующей таблице перечислены методы, полностью реализуемые шаблоном, и методы, которые вызывают другие методы в производном классе.</span><span class="sxs-lookup"><span data-stu-id="a9c09-244">The following table summarizes which methods are fully implemented by the template, and which methods call other methods on the derived class.</span></span>



| <span data-ttu-id="a9c09-245">Метод Имедиаобжект</span><span class="sxs-lookup"><span data-stu-id="a9c09-245">IMediaObject Method</span></span>                   | <span data-ttu-id="a9c09-246">Метод производного класса</span><span class="sxs-lookup"><span data-stu-id="a9c09-246">Derived Class Method</span></span>                                                             |
|---------------------------------------|----------------------------------------------------------------------------------|
| <span data-ttu-id="a9c09-247">**жетинпуткурренттипе**</span><span class="sxs-lookup"><span data-stu-id="a9c09-247">**GetInputCurrentType**</span></span>               | <span data-ttu-id="a9c09-248">Полностью реализовано</span><span class="sxs-lookup"><span data-stu-id="a9c09-248">Fully implemented</span></span>                                                                |
| <span data-ttu-id="a9c09-249">**жетаутпуткурренттипе**</span><span class="sxs-lookup"><span data-stu-id="a9c09-249">**GetOutputCurrentType**</span></span>              | <span data-ttu-id="a9c09-250">Полностью реализовано</span><span class="sxs-lookup"><span data-stu-id="a9c09-250">Fully implemented</span></span>                                                                |
| <span data-ttu-id="a9c09-251">**жетстреамкаунт**</span><span class="sxs-lookup"><span data-stu-id="a9c09-251">**GetStreamCount**</span></span>                    | <span data-ttu-id="a9c09-252">Полностью реализовано</span><span class="sxs-lookup"><span data-stu-id="a9c09-252">Fully implemented</span></span>                                                                |
| <span data-ttu-id="a9c09-253">**жетинпутстатус**</span><span class="sxs-lookup"><span data-stu-id="a9c09-253">**GetInputStatus**</span></span>                    | <span data-ttu-id="a9c09-254">[**интерналакцептингинпут**](/previous-versions/ms809095(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="a9c09-254">[**InternalAcceptingInput**](/previous-versions/ms809095(v=msdn.10))</span></span>        |
| <span data-ttu-id="a9c09-255">**Lock** (реализован как **дмолокк**)</span><span class="sxs-lookup"><span data-stu-id="a9c09-255">**Lock** (implemented as **DMOLock**)</span></span> | <span data-ttu-id="a9c09-256">[**Блокировка**](/previous-versions/ms809100(v=msdn.10)), [ **разблокировка**](/previous-versions/ms809101(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="a9c09-256">[**Lock**](/previous-versions/ms809100(v=msdn.10)), [**Unlock**](/previous-versions/ms809101(v=msdn.10))</span></span> |
| <span data-ttu-id="a9c09-257">**сетинпуттипе**</span><span class="sxs-lookup"><span data-stu-id="a9c09-257">**SetInputType**</span></span>                      | <span data-ttu-id="a9c09-258">[**интерналчеккинпуттипе**](/previous-versions/ms809096(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="a9c09-258">[**InternalCheckInputType**](/previous-versions/ms809096(v=msdn.10))</span></span>        |
| <span data-ttu-id="a9c09-259">**сетаутпуттипе**</span><span class="sxs-lookup"><span data-stu-id="a9c09-259">**SetOutputType**</span></span>                     | <span data-ttu-id="a9c09-260">[**интерналчеккаутпуттипе**](/previous-versions/ms809098(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="a9c09-260">[**InternalCheckOutputType**](/previous-versions/ms809098(v=msdn.10))</span></span>      |



 

## <a name="related-topics"></a><span data-ttu-id="a9c09-261">См. также</span><span class="sxs-lookup"><span data-stu-id="a9c09-261">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a9c09-262">**Шаблон класса Имедиаобжектимпл**</span><span class="sxs-lookup"><span data-stu-id="a9c09-262">**IMediaObjectImpl Class Template**</span></span>](imediaobjectimpl-class-template.md)
</dt> <dt>

[<span data-ttu-id="a9c09-263">Написание DMO</span><span class="sxs-lookup"><span data-stu-id="a9c09-263">Writing a DMO</span></span>](writing-a-dmo.md)
</dt> </dl>

 

 
