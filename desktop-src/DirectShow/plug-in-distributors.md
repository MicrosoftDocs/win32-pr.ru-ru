---
description: Распространители подключаемых модулей
ms.assetid: 80ff713d-f704-40d3-9317-cbf33d932207
title: Распространители подключаемых модулей
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f7817e5e31b29444cc596b0be583be2198adc018
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "105682234"
---
# <a name="plug-in-distributors"></a><span data-ttu-id="45796-103">Распространители подключаемых модулей</span><span class="sxs-lookup"><span data-stu-id="45796-103">Plug-in Distributors</span></span>

<span data-ttu-id="45796-104">Подключаемые модули распространителей (PID) позволяют расширить функциональные возможности диспетчера графа фильтров.</span><span class="sxs-lookup"><span data-stu-id="45796-104">Plug-in distributors (PIDs) are a way to extend the functionality of the filter graph manager.</span></span> <span data-ttu-id="45796-105">Подключаемый модуль распространителя — это COM-объект, который выполняет статистическую обработку диспетчером графов фильтра во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="45796-105">A plug-in distributor is a COM object that the filter graph manager aggregates at run time.</span></span> <span data-ttu-id="45796-106">Приложения получают доступ к PID с помощью диспетчера графа фильтров.</span><span class="sxs-lookup"><span data-stu-id="45796-106">Applications obtain access to the PID through the filter graph manager.</span></span>

<span data-ttu-id="45796-107">Когда диспетчер графов фильтров запрашивает интерфейс, который он не поддерживает, он выполняет поиск раздела в реестре в следующем формате:</span><span class="sxs-lookup"><span data-stu-id="45796-107">When the filter graph manager is queried for an interface that it does not support, it searches the registry for a key with the following form:</span></span>


```C++
HKEY_CLASSES_ROOT\Interface\IID\Distributor
```



<span data-ttu-id="45796-108">`IID` Строка, содержащая идентификатор интерфейса.</span><span class="sxs-lookup"><span data-stu-id="45796-108">`IID` is a string containing the interface identifier.</span></span> <span data-ttu-id="45796-109">Если запись реестра существует, значение записи определяет идентификатор класса (CLSID) PID, который поддерживает интерфейс.</span><span class="sxs-lookup"><span data-stu-id="45796-109">If the registry entry exists, the value of the entry defines the class identifier (CLSID) of a PID that supports the interface.</span></span> <span data-ttu-id="45796-110">Диспетчер графов фильтров выполняет статистическое вычисление PID и возвращает указатель интерфейса, который выступает в роли внешнего **IUnknown** для PID.</span><span class="sxs-lookup"><span data-stu-id="45796-110">The filter graph manager aggregates the PID and returns an interface pointer, thereby acting as the outer **IUnknown** for the PID.</span></span> <span data-ttu-id="45796-111">Когда приложение вызывает методы интерфейса, оно фактически вызывает их в PID.</span><span class="sxs-lookup"><span data-stu-id="45796-111">When the application calls methods on the interface, it is actually calling them on the PID.</span></span> <span data-ttu-id="45796-112">Тем не менее существование идентификатора процесса является прозрачным для приложения.</span><span class="sxs-lookup"><span data-stu-id="45796-112">However, the existence of the PID is transparent to the application.</span></span>

<span data-ttu-id="45796-113">Термин *распространитель* основан на том, что PID может запрашивать внешний указатель **IUnknown** для интерфейсов в диспетчере графов фильтров.</span><span class="sxs-lookup"><span data-stu-id="45796-113">The term *distributor* stems from the fact that a PID can query its outer **IUnknown** pointer for interfaces on the filter graph manager.</span></span> <span data-ttu-id="45796-114">Вызывая метод [**ифилтерграф:: енумфилтерс**](/windows/desktop/api/Strmif/nf-strmif-ifiltergraph-enumfilters) , PID может перечислить фильтры в графе и распределить вызовы методов к этим фильтрам.</span><span class="sxs-lookup"><span data-stu-id="45796-114">By calling the [**IFilterGraph::EnumFilters**](/windows/desktop/api/Strmif/nf-strmif-ifiltergraph-enumfilters) method, the PID can enumerate the filters in the graph and distribute method calls to those filters.</span></span> <span data-ttu-id="45796-115">Таким образом, PID может служить одной контрольной точкой, чтобы приложение вызывало методы для фильтров.</span><span class="sxs-lookup"><span data-stu-id="45796-115">In this way, a PID can serve as a single control point for the application to call methods on filters.</span></span>

<span data-ttu-id="45796-116">Когда диспетчер графов фильтров выполняет статистическое вычисление PID, он запрашивает идентификатор процесса для интерфейса [**идистрибуторнотифи**](/windows/desktop/api/Strmif/nn-strmif-idistributornotify) .</span><span class="sxs-lookup"><span data-stu-id="45796-116">When the filter graph manager aggregates a PID, it queries the PID for the [**IDistributorNotify**](/windows/desktop/api/Strmif/nn-strmif-idistributornotify) interface.</span></span> <span data-ttu-id="45796-117">Если идентификатор процесса поддерживает этот интерфейс, диспетчер графа фильтров использует его для уведомления PID об изменениях в графе:</span><span class="sxs-lookup"><span data-stu-id="45796-117">If the PID supports this interface, the filter graph manager uses it to notify the PID about changes in the graph:</span></span>

-   <span data-ttu-id="45796-118">Когда граф фильтра переключается между запусками, приостановленными и остановленными состояниями, он вызывает [**идистрибуторнотифи:: Run**](/windows/desktop/api/Strmif/nf-strmif-idistributornotify-run), [**идистрибуторнотифи::P Аусе**](/windows/desktop/api/Strmif/nf-strmif-idistributornotify-pause)или [**идистрибуторнотифи:: остановка**](/windows/desktop/api/Strmif/nf-strmif-idistributornotify-stop).</span><span class="sxs-lookup"><span data-stu-id="45796-118">When the filter graph switches between run, paused, and stopped states, it calls [**IDistributorNotify::Run**](/windows/desktop/api/Strmif/nf-strmif-idistributornotify-run), [**IDistributorNotify::Pause**](/windows/desktop/api/Strmif/nf-strmif-idistributornotify-pause), or [**IDistributorNotify::Stop**](/windows/desktop/api/Strmif/nf-strmif-idistributornotify-stop).</span></span>
-   <span data-ttu-id="45796-119">Если задано значение ссылочного времени, диспетчер графа фильтров вызывает [**идистрибуторнотифи:: сетсинксаурце**](/windows/desktop/api/Strmif/nf-strmif-idistributornotify-setsyncsource).</span><span class="sxs-lookup"><span data-stu-id="45796-119">When a reference clock is set, the filter graph manager calls [**IDistributorNotify::SetSyncSource**](/windows/desktop/api/Strmif/nf-strmif-idistributornotify-setsyncsource).</span></span>
-   <span data-ttu-id="45796-120">Когда фильтры добавляются или удаляются, или закрепление соединений изменяется, диспетчер графа фильтров вызывает [**идистрибуторнотифи:: нотифиграфчанже**](/windows/desktop/api/Strmif/nf-strmif-idistributornotify-notifygraphchange).</span><span class="sxs-lookup"><span data-stu-id="45796-120">When filters are added or removed, or pin connections are changed, the filter graph manager calls [**IDistributorNotify::NotifyGraphChange**](/windows/desktop/api/Strmif/nf-strmif-idistributornotify-notifygraphchange).</span></span>

<span data-ttu-id="45796-121">Чтобы реализовать пользовательский идентификатор процесса, создайте COM-объект, поддерживающий агрегирование.</span><span class="sxs-lookup"><span data-stu-id="45796-121">To implement a custom PID, create a COM object that supports aggregation.</span></span> <span data-ttu-id="45796-122">Он должен поддерживать интерфейс, который диспетчер графов фильтров еще не поддерживает.</span><span class="sxs-lookup"><span data-stu-id="45796-122">It must support an interface that the filter graph manager does not already support.</span></span> <span data-ttu-id="45796-123">При необходимости он может поддерживать интерфейс **идистрибуторнотифи** .</span><span class="sxs-lookup"><span data-stu-id="45796-123">Optionally, it can support the **IDistributorNotify** interface.</span></span>

<span data-ttu-id="45796-124">Если идентификатор процесса получает указатели интерфейса от диспетчера графа фильтров, он должен немедленно освободить их.</span><span class="sxs-lookup"><span data-stu-id="45796-124">If the PID obtains any interface pointers from the filter graph manager, it should release them immediately.</span></span> <span data-ttu-id="45796-125">В противном случае он может создать циклическое число ссылок, которое может препятствовать удалению диспетчера графов фильтров.</span><span class="sxs-lookup"><span data-stu-id="45796-125">Otherwise, it might create a circular reference count, which could prevent the filter graph manager from being destroyed.</span></span> <span data-ttu-id="45796-126">Наличие счетчика ссылок в диспетчере графов фильтров не требуется в любом случае, поскольку диспетчер графа фильтров управляет временем существования PID.</span><span class="sxs-lookup"><span data-stu-id="45796-126">Holding a reference count on the filter graph manager is unnecessary in any case, because the filter graph manager controls the PID's lifetime.</span></span>

<span data-ttu-id="45796-127">Так как PID разработан специально для агрегирования диспетчером графа фильтров, может потребоваться применить его в методе конструктора PID.</span><span class="sxs-lookup"><span data-stu-id="45796-127">Because a PID is designed specifically for aggregation by the filter graph manager, you might want to enforce this in the PID's constructor method.</span></span> <span data-ttu-id="45796-128">Проверьте, имеет ли  внешний указатель IUnknown **значение NULL**, и, если да, возвращайте код ошибки VFW \_ E " \_ требуется \_ владелец".</span><span class="sxs-lookup"><span data-stu-id="45796-128">Check whether the outer **IUnknown** pointer is **NULL**, and if so, return the error code VFW\_E\_NEED\_OWNER.</span></span> <span data-ttu-id="45796-129">(См. раздел [коды ошибок и успешности](error-and-success-codes.md).) Кроме того, чтобы предотвратить агрегирование PID другими объектами, можно запросить внешний указатель **IUnknown** для интерфейса [**играфбуилдер**](/windows/desktop/api/Strmif/nn-strmif-igraphbuilder) .</span><span class="sxs-lookup"><span data-stu-id="45796-129">(See [Error and Success Codes](error-and-success-codes.md).) Also, to prevent other objects from aggregating the PID, you can query the outer **IUnknown** pointer for the [**IGraphBuilder**](/windows/desktop/api/Strmif/nn-strmif-igraphbuilder) interface.</span></span> <span data-ttu-id="45796-130">Возвращает код ошибки, если объект не предоставляет **играфбуилдер**.</span><span class="sxs-lookup"><span data-stu-id="45796-130">Return an error code if the object does not expose **IGraphBuilder**.</span></span>

 

 



