---
description: Поток данных в навигаторе DVD
ms.assetid: 14f9cfa3-5ef6-419c-9196-2e4060549c03
title: Поток данных в навигаторе DVD
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 29a981d2d7b528163abb53478e9e8f2ab88d46c0
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "103806719"
---
# <a name="data-flow-in-the-dvd-navigator"></a><span data-ttu-id="490e6-103">Поток данных в навигаторе DVD</span><span class="sxs-lookup"><span data-stu-id="490e6-103">Data Flow in the DVD Navigator</span></span>

<span data-ttu-id="490e6-104">В навигаторе DVD есть методы остановки и приостановки воспроизведения.</span><span class="sxs-lookup"><span data-stu-id="490e6-104">The DVD Navigator has methods to stop and pause playback.</span></span> <span data-ttu-id="490e6-105">Эти методы аналогичны (но не идентичны) методам **остановки** и **приостановки** в [**имедиаконтрол**](/windows/desktop/api/Control/nn-control-imediacontrol).</span><span class="sxs-lookup"><span data-stu-id="490e6-105">These methods are similar — but not identical — to the **Stop** and **Pause** methods in [**IMediaControl**](/windows/desktop/api/Control/nn-control-imediacontrol).</span></span> <span data-ttu-id="490e6-106">Вот разница между ними:</span><span class="sxs-lookup"><span data-stu-id="490e6-106">Here is the difference between them:</span></span>

-   <span data-ttu-id="490e6-107">Методы **IDvdControl2** изменяют то, что читает DVD-навигатор с диска.</span><span class="sxs-lookup"><span data-stu-id="490e6-107">The **IDvdControl2** methods change what the DVD Navigator reads from the disk.</span></span> <span data-ttu-id="490e6-108">Они не изменяют состояние графа.</span><span class="sxs-lookup"><span data-stu-id="490e6-108">They do not change the state of the graph.</span></span>
-   <span data-ttu-id="490e6-109">Методы **имедиаконтрол** изменяют состояние графа.</span><span class="sxs-lookup"><span data-stu-id="490e6-109">The **IMediaControl** methods change the state of the graph.</span></span> <span data-ttu-id="490e6-110">Они не изменяют то, что читает DVD-навигатор с диска.</span><span class="sxs-lookup"><span data-stu-id="490e6-110">They do not change what the DVD Navigator reads from the disk.</span></span> <span data-ttu-id="490e6-111">(Существует одно важное исключение, описанное в следующем разделе, связанное с методом « **останавливаться** ».)</span><span class="sxs-lookup"><span data-stu-id="490e6-111">(There is one important exception, explained in the next section, related to the **Stop** method.)</span></span>

<span data-ttu-id="490e6-112">Например, метод [**IDvdControl2::P Аусе**](/windows/desktop/api/Strmif/nf-strmif-idvdcontrol2-pause) выдает команду в приложении J "Pause \_ On", но не приостанавливает граф фильтра.</span><span class="sxs-lookup"><span data-stu-id="490e6-112">For example, [**IDvdControl2::Pause**](/windows/desktop/api/Strmif/nf-strmif-idvdcontrol2-pause) method issues the Annex J "Pause\_On" command, but does not pause the filter graph.</span></span> <span data-ttu-id="490e6-113">Метод [**имедиаконтрол::P Аусе**](/windows/desktop/api/Control/nf-control-imediacontrol-pause) , с другой стороны, приостанавливает граф, но не выдает никаких команд DVD.</span><span class="sxs-lookup"><span data-stu-id="490e6-113">The [**IMediaControl::Pause**](/windows/desktop/api/Control/nf-control-imediacontrol-pause) method, on the other hand, pauses the graph but does not issue any DVD command.</span></span>

<span data-ttu-id="490e6-114">В общем случае используйте методы **имедиаконтрол::P Аусе** и **останавливают** вместо соответствующих методов **IDvdControl2** .</span><span class="sxs-lookup"><span data-stu-id="490e6-114">In general, use the **IMediaControl::Pause** and **Stop** methods instead of the corresponding **IDvdControl2** methods.</span></span> <span data-ttu-id="490e6-115">Методы **имедиаконтрол** имеют очень небольшие задержки, в то время как методы **IDvdControl2** могут иметь задержку до двух секунд.</span><span class="sxs-lookup"><span data-stu-id="490e6-115">The **IMediaControl** methods have very small latencies, whereas the **IDvdControl2** methods can have up to two seconds of latency.</span></span>

<span data-ttu-id="490e6-116">Остановка воспроизведения</span><span class="sxs-lookup"><span data-stu-id="490e6-116">Stopping Playback</span></span>

<span data-ttu-id="490e6-117">Поведение [**имедиаконтрол:: останавливаться**](/windows/desktop/api/Control/nf-control-imediacontrol-stop) зависит от флага, который можно задать с помощью метода [**IDvdControl2:: SetOption**](/windows/desktop/api/Strmif/nf-strmif-idvdcontrol2-setoption) .</span><span class="sxs-lookup"><span data-stu-id="490e6-117">The behavior of [**IMediaControl::Stop**](/windows/desktop/api/Control/nf-control-imediacontrol-stop) depends on a flag that you can set with the [**IDvdControl2::SetOption**](/windows/desktop/api/Strmif/nf-strmif-idvdcontrol2-setoption) method.</span></span>

-   <span data-ttu-id="490e6-118">Если \_ флаг РЕСЕТОНСТОП DVD имеет **значение false**, **имедиаконтрол:: Stop** останавливает граф, но не изменяет домен навигатора DVD.</span><span class="sxs-lookup"><span data-stu-id="490e6-118">If the DVD\_ResetOnStop flag is **FALSE**, **IMediaControl::Stop** stops the graph, but does not change the DVD Navigator's domain.</span></span> <span data-ttu-id="490e6-119">При повторном вызове метода воспроизведение продолжается с текущей позицией.</span><span class="sxs-lookup"><span data-stu-id="490e6-119">When you call run again, playback resumes from the current position.</span></span>
-   <span data-ttu-id="490e6-120">Если \_ РЕСЕТОНСТОП DVD имеет **значение true**, **имедиаконтрол:: останавливается** приводит к сбросу DVD-навигатора.</span><span class="sxs-lookup"><span data-stu-id="490e6-120">If DVD\_ResetOnStop is **TRUE**, **IMediaControl::Stop** causes the DVD Navigator to reset.</span></span> <span data-ttu-id="490e6-121">При вызове [**имедиаконтрол:: Run**](/windows/desktop/api/Control/nf-control-imediacontrol-run) еще раз Навигатор DVD воспроизводится из первого домена воспроизведения, как будто DVD-диск впервые вставлен в первый раз.</span><span class="sxs-lookup"><span data-stu-id="490e6-121">When you call [**IMediaControl::Run**](/windows/desktop/api/Control/nf-control-imediacontrol-run) again, the DVD Navigator plays from the First Play domain, as if you were inserting the DVD for the first time.</span></span>

<span data-ttu-id="490e6-122">\_По умолчанию флаг DVD ресетонстоп имеет **значение true** для совместимости с более старыми приложениями.</span><span class="sxs-lookup"><span data-stu-id="490e6-122">The DVD\_ResetOnStop flag is **TRUE** by default, for compatibility with older applications.</span></span> <span data-ttu-id="490e6-123">Однако обычно следует переопределить значение по умолчанию и установить для флага значение **false**.</span><span class="sxs-lookup"><span data-stu-id="490e6-123">Generally, however, you should override the default and set the flag to **FALSE**.</span></span> <span data-ttu-id="490e6-124">Причина заключается в том, что определенные события могут привести к прекращению графа во время воспроизведения.</span><span class="sxs-lookup"><span data-stu-id="490e6-124">The reason is that certain events can cause the graph to stop during playback.</span></span> <span data-ttu-id="490e6-125">Например, если разрешение экрана изменяется, граф фильтра останавливается, повторно подключает модуль подготовки отчетов и перезагружается.</span><span class="sxs-lookup"><span data-stu-id="490e6-125">For example, if the display resolution changes, the filter graph stops, reconnects the video renderer, and restarts.</span></span> <span data-ttu-id="490e6-126">Если \_ РЕСЕТОНСТОП DVD имеет **значение true**, воспроизведение будет перезапущено с начала диска. Это, вероятно, не то, что ждет пользователь.</span><span class="sxs-lookup"><span data-stu-id="490e6-126">If DVD\_ResetOnStop is **TRUE**, playback will restart from the beginning of the disc. That is probably not what the user expects.</span></span>

<span data-ttu-id="490e6-127">Поэтому в начале приложения необходимо вызвать **SetOption** с DVD \_ ресетонстоп, установленным в значение **false**.</span><span class="sxs-lookup"><span data-stu-id="490e6-127">At the beginning of your application, therefore, call **SetOption** with DVD\_ResetOnStop set to **FALSE**.</span></span> <span data-ttu-id="490e6-128">Если вы хотите отключить воспроизведение и возобновить его из того же расположения, вызовите **имедиаконтрол:: останавливаться** или **имедиаконтрол::P Аусе**.</span><span class="sxs-lookup"><span data-stu-id="490e6-128">If you want to stop playback and have it resume from the same location, call **IMediaControl::Stop** or **IMediaControl::Pause**.</span></span> <span data-ttu-id="490e6-129">Если вы хотите отключить воспроизведение и сбросить диск, вызовите **SetOption** с DVD- \_ ресетонстоп, равным **true**; затем вызовите **имедиаконтрол:: останавливаться**; наконец, снова вызовите **SetOption** и сбросьте DVD \_ ресетонстоп в **значение false**.</span><span class="sxs-lookup"><span data-stu-id="490e6-129">If you want to stop playback and reset the disk, call **SetOption** with DVD\_ResetOnStop equal to **TRUE**; then call **IMediaControl::Stop**; finally, call **SetOption** again and reset DVD\_ResetOnStop to **FALSE**.</span></span>

<span data-ttu-id="490e6-130">Приостановка воспроизведения</span><span class="sxs-lookup"><span data-stu-id="490e6-130">Pausing Playback</span></span>

<span data-ttu-id="490e6-131">Если передать DVD-навигатор команде во время приостановки графа, команда может не завершиться, пока граф не будет запущен снова.</span><span class="sxs-lookup"><span data-stu-id="490e6-131">If you give the DVD Navigator a command while the graph is paused, the command may not complete until the graph runs again.</span></span> <span data-ttu-id="490e6-132">В некоторых случаях это может вызвать взаимоблокировку в приложении.</span><span class="sxs-lookup"><span data-stu-id="490e6-132">In some situations, this can cause a deadlock in your application.</span></span> <span data-ttu-id="490e6-133">Чтобы избежать взаимоблокировок, необходимо выполнить два правила.</span><span class="sxs-lookup"><span data-stu-id="490e6-133">There are two rules you should follow to avoid deadlocks:</span></span>

-   <span data-ttu-id="490e6-134">При приостановке не выдается более одной асинхронной команды DVD.</span><span class="sxs-lookup"><span data-stu-id="490e6-134">While paused, do not issue more than one asynchronous DVD command.</span></span>
-   <span data-ttu-id="490e6-135">Во время приостановки не блокируйте поток пользовательского интерфейса приложения или поток, который изменяет состояние графа.</span><span class="sxs-lookup"><span data-stu-id="490e6-135">While paused, do not block the application's UI thread or the thread that changes the state of the graph.</span></span>

<span data-ttu-id="490e6-136">Второе правило стоит изучить более подробно.</span><span class="sxs-lookup"><span data-stu-id="490e6-136">The second rule is worth examining in more detail.</span></span> <span data-ttu-id="490e6-137">Ниже приведены некоторые особые сценарии, которые могут вызвать взаимоблокировку:</span><span class="sxs-lookup"><span data-stu-id="490e6-137">Here are some specific scenarios that may cause a deadlock:</span></span>

-   <span data-ttu-id="490e6-138">**Сценарий**. при приостановке приложение создает команду DVD с флагом блокировки.</span><span class="sxs-lookup"><span data-stu-id="490e6-138">**Scenario**: While paused, the application issues a DVD command with the blocking flag.</span></span> <span data-ttu-id="490e6-139">Это может привести к взаимоблокировке, если поток, который выдает команду DVD, является тем же потоком, который выдает команду Run.</span><span class="sxs-lookup"><span data-stu-id="490e6-139">This can cause a deadlock if the thread that issues the DVD command is the same thread that issues the run command.</span></span> <span data-ttu-id="490e6-140">Команда DVD блокируется до тех пор, пока граф не будет запущен, но граф не сможет выполняться до завершения команды.</span><span class="sxs-lookup"><span data-stu-id="490e6-140">The DVD command blocks until the graph runs, but the graph cannot run until the command completes.</span></span>

    <span data-ttu-id="490e6-141">**Рекомендация**: выполните команду DVD в отдельном рабочем потоке или не используйте флаг блокировки.</span><span class="sxs-lookup"><span data-stu-id="490e6-141">**Recommendation**: Issue the DVD command on a separate worker thread, or don't use the blocking flag.</span></span>

-   <span data-ttu-id="490e6-142">**Сценарий**. при приостановке приложение создает команду DVD, а затем вызывает [**Идвдкмд:: ваитфоренд**](/windows/desktop/api/Strmif/nf-strmif-idvdcmd-waitforend) в объекте Command.</span><span class="sxs-lookup"><span data-stu-id="490e6-142">**Scenario**: While paused, the application issues a DVD command, then calls [**IDvdCmd::WaitForEnd**](/windows/desktop/api/Strmif/nf-strmif-idvdcmd-waitforend) on the command object.</span></span> <span data-ttu-id="490e6-143">Эта ситуация эквивалентна предыдущему примеру.</span><span class="sxs-lookup"><span data-stu-id="490e6-143">This situation is equivalent to the previous example.</span></span> <span data-ttu-id="490e6-144">Если вызвать **Wait** из потока пользовательского интерфейса, поток пользовательского интерфейса не сможет запустить граф до тех пор, пока метод **Wait** не разблокируется, но метод **Wait** не будет разблокирован до выполнения графа.</span><span class="sxs-lookup"><span data-stu-id="490e6-144">If you call **Wait** from the UI thread, the UI thread cannot run the graph until the **Wait** method unblocks, but the **Wait** method will not unblock until the graph runs.</span></span>

    <span data-ttu-id="490e6-145">**Рекомендация**: вызов **Wait** в рабочем потоке.</span><span class="sxs-lookup"><span data-stu-id="490e6-145">**Recommendation**: Call **Wait** on a worker thread.</span></span>

-   <span data-ttu-id="490e6-146">**Сценарий**. пока граф работает, приложение создает команду DVD с флагом блокировки, а затем вызывает Pause из другого потока.</span><span class="sxs-lookup"><span data-stu-id="490e6-146">**Scenario**: While the graph is running, the application issues a DVD command with the blocking flag, and then calls pause from another thread.</span></span> <span data-ttu-id="490e6-147">Это возможный конфликт, так как граф может быть приостановлен до выдачи команды.</span><span class="sxs-lookup"><span data-stu-id="490e6-147">This is a possible race condition because the graph may pause before the command is issued.</span></span> <span data-ttu-id="490e6-148">Если один из двух потоков является потоком пользовательского интерфейса, может возникнуть взаимоблокировка, похожая на два предыдущих примера.</span><span class="sxs-lookup"><span data-stu-id="490e6-148">If one of the two threads is the UI thread, you may cause a deadlock similar to the previous two examples.</span></span> <span data-ttu-id="490e6-149">В этом примере показана важность написания поточно-ориентированного кода, если приложение использует несколько потоков.</span><span class="sxs-lookup"><span data-stu-id="490e6-149">This example illustrates the importance of writing thread-safe code if your application uses multiple threads.</span></span>

    <span data-ttu-id="490e6-150">**Рекомендация**. Если вы используете рабочие потоки, убедитесь, что код является потокобезопасным.</span><span class="sxs-lookup"><span data-stu-id="490e6-150">**Recommendation**: If you use worker threads, make sure your code is thread-safe.</span></span>

-   <span data-ttu-id="490e6-151">**Сценарий**. при приостановке приложение отключает команду Run из пользовательского интерфейса, а затем выдает команду для асинхронного DVD-диска.</span><span class="sxs-lookup"><span data-stu-id="490e6-151">**Scenario**: While paused, the application disables the run command from the UI, and then issues an asynchronous DVD command.</span></span> <span data-ttu-id="490e6-152">Этот вариант не является строго взаимоблокировкой, так как поток приложения все еще выполняется.</span><span class="sxs-lookup"><span data-stu-id="490e6-152">This case is not strictly a deadlock, because the application thread is still running.</span></span> <span data-ttu-id="490e6-153">Однако пользователю не удастся запустить граф, поэтому команда не будет выполнена.</span><span class="sxs-lookup"><span data-stu-id="490e6-153">However, the user is now prevented from running the graph, and therefore the command will never complete.</span></span>

    <span data-ttu-id="490e6-154">**Рекомендация**. при приостановке всегда оставляйте включенную команду выполнения.</span><span class="sxs-lookup"><span data-stu-id="490e6-154">**Recommendation**: When pausing, always leave the run command enabled.</span></span>

<span data-ttu-id="490e6-155">Поиск DVD-диска в указанное время</span><span class="sxs-lookup"><span data-stu-id="490e6-155">Seeking a DVD to a Specified Time</span></span>

<span data-ttu-id="490e6-156">Чтобы точно найти указанное время на диске, вызовите [**имедиаконтрол:: Run**](/windows/desktop/api/Control/nf-control-imediacontrol-run).</span><span class="sxs-lookup"><span data-stu-id="490e6-156">To accurately seek to a specified time on a disc, call [**IMediaControl::Run**](/windows/desktop/api/Control/nf-control-imediacontrol-run).</span></span> <span data-ttu-id="490e6-157">Затем вызовите [**IDvdControl2::P лайаттиме**](/windows/desktop/api/Strmif/nf-strmif-idvdcontrol2-playattime), указав время и настроив  \_ \_ Сброс флага dwFlags на DVD-диск \_ .</span><span class="sxs-lookup"><span data-stu-id="490e6-157">Then call [**IDvdControl2::PlayAtTime**](/windows/desktop/api/Strmif/nf-strmif-idvdcontrol2-playattime), specifying the time and setting *dwFlags* to DVD\_CMD\_FLAG\_Flush.</span></span>

## <a name="related-topics"></a><span data-ttu-id="490e6-158">См. также</span><span class="sxs-lookup"><span data-stu-id="490e6-158">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="490e6-159">DVD-приложения</span><span class="sxs-lookup"><span data-stu-id="490e6-159">DVD Applications</span></span>](dvd-applications.md)
</dt> </dl>

 

 



