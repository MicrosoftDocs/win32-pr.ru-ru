---
description: Очистки
ms.assetid: 868218c4-3e1a-4da0-89fa-30a9848da0e8
title: Очистки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 575f311020c2c7a567e544b80ba323a29051cc38
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104537952"
---
# <a name="flushing"></a><span data-ttu-id="0e6e7-103">Очистки</span><span class="sxs-lookup"><span data-stu-id="0e6e7-103">Flushing</span></span>

<span data-ttu-id="0e6e7-104">Пока граф фильтра работает, можно перемещать произвольные объемы данных через граф.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-104">While the filter graph is running, arbitrary amounts of data can be moving through the graph.</span></span> <span data-ttu-id="0e6e7-105">Некоторые из них могут находиться в очередях, ожидающих доставки.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-105">Some of it might be in queues, waiting to be delivered.</span></span> <span data-ttu-id="0e6e7-106">Бывают случаи, когда графу фильтра необходимо как можно быстрее удалить эти ожидающие данные и заменить их новыми данными.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-106">There are times when the filter graph needs to remove this pending data as quickly as possible and replace it with new data.</span></span> <span data-ttu-id="0e6e7-107">Например, после команды Seek фильтр источника создает образцы из новой позицией в источнике.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-107">After a seek command, for example, the source filter generates samples from a new position in the source.</span></span> <span data-ttu-id="0e6e7-108">Чтобы максимально сокращать задержку, нисходящие фильтры должны отбросить все выборки, созданные до команды Seek.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-108">To minimize latency, downstream filters should discard any samples that were created before the seek command.</span></span> <span data-ttu-id="0e6e7-109">Процесс удаления примеров называется *очисткой*.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-109">The process of discarding samples is called *flushing*.</span></span> <span data-ttu-id="0e6e7-110">Он обеспечивает более высокую скорость реагирования графа, когда события изменяют нормальный поток данных.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-110">It enables the graph to be more responsive when events alter the normal data flow.</span></span>

<span data-ttu-id="0e6e7-111">По модели извлечения, в отличие от модели отправки, очистка обрабатывается немного иначе.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-111">Flushing is handled slightly differently by the pull model than the push model.</span></span> <span data-ttu-id="0e6e7-112">Эта статья начинается с описания модели push-уведомлений. Затем описываются различия в модели извлечения.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-112">This article starts by describing the push model; then it describes the differences in the pull model.</span></span>

<span data-ttu-id="0e6e7-113">Запись на диск происходит в два этапа.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-113">Flushing happens in two stages.</span></span>

-   <span data-ttu-id="0e6e7-114">Во-первых, фильтр источника вызывает [**Ипин:: бегинфлуш**](/windows/desktop/api/Strmif/nf-strmif-ipin-beginflush) для входного контакта подчиненного фильтра.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-114">First, the source filter calls [**IPin::BeginFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-beginflush) on the downstream filter's input pin.</span></span> <span data-ttu-id="0e6e7-115">Нисходящий фильтр начинает отклонять выборки из вышестоящего.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-115">The downstream filter starts rejecting samples from upstream.</span></span> <span data-ttu-id="0e6e7-116">Он также удаляет все удерживаемые примеры и отправляет вызов **бегинфлуш** в следующий фильтр.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-116">It also discards any samples it is holding, and sends the **BeginFlush** call downstream to the next filter.</span></span>
-   <span data-ttu-id="0e6e7-117">Когда фильтр источника готов к отправке новых данных, он вызывает [**Ипин:: ендфлуш**](/windows/desktop/api/Strmif/nf-strmif-ipin-endflush) для входного ПИН-кода.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-117">When the source filter is ready to send new data, it calls [**IPin::EndFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-endflush) on the input pin.</span></span> <span data-ttu-id="0e6e7-118">Это сигнализирует подчиненному фильтру о том, что он может получать новые образцы.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-118">This signals the downstream filter that it can receive new samples.</span></span> <span data-ttu-id="0e6e7-119">Нисходящий фильтр отправляет вызов **ендфлуш** следующему фильтру.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-119">The downstream filter sends the **EndFlush** call to the next filter.</span></span>

<span data-ttu-id="0e6e7-120">В методе **бегинфлуш** входной ПИН-код выполняет следующие действия:</span><span class="sxs-lookup"><span data-stu-id="0e6e7-120">In the **BeginFlush** method, the input pin does the following:</span></span>

1.  <span data-ttu-id="0e6e7-121">Вызывает **бегинфлуш** для подчиненных входных контактов.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-121">Calls **BeginFlush** on downstream input pins.</span></span>
2.  <span data-ttu-id="0e6e7-122">Отклоняет все последующие вызовы, которые продают потоковые данные, включая **Receive** и **EndOfStream**.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-122">Rejects any further calls that stream data, including **Receive** and **EndOfStream**.</span></span>
3.  <span data-ttu-id="0e6e7-123">Разблокирует все вышестоящее фильтры, которые заблокированы в ожидании выборки из распределителя фильтра.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-123">Unblocks any upstream filters that are blocked waiting for a sample from the filter's allocator.</span></span> <span data-ttu-id="0e6e7-124">Некоторые фильтры отменяют свои распределителя для этой цели.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-124">Some filters decommit their allocators for this purpose.</span></span>
4.  <span data-ttu-id="0e6e7-125">Завершает работу из всех ожиданий, блокирующих потоковую передачу.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-125">Exits from any waits that block streaming.</span></span> <span data-ttu-id="0e6e7-126">Например, фильтр модуля подготовки отчетов блокируется при приостановке.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-126">For example, renderer filters block when paused.</span></span> <span data-ttu-id="0e6e7-127">Они также блокируются, когда они ожидают отрисовку образца в правильном потоке.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-127">They also block when they are waiting to render a sample at the correct stream time.</span></span> <span data-ttu-id="0e6e7-128">Фильтр должен разблокировать, чтобы образцы, помещенные в очередь, могли быть доставлены и отклонены.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-128">The filter must unblock, so that samples queued upstream can be delivered and rejected.</span></span> <span data-ttu-id="0e6e7-129">Этот шаг гарантирует, что все вышестоящее фильтры в конечном итоге разблокируются.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-129">This step ensures that all upstream filters eventually unblock.</span></span>

<span data-ttu-id="0e6e7-130">В методе **ендфлуш** входной ПИН-код выполняет следующие действия:</span><span class="sxs-lookup"><span data-stu-id="0e6e7-130">In the **EndFlush** method, the input pin does the following:</span></span>

1.  <span data-ttu-id="0e6e7-131">Ожидает, пока все образцы в очереди не будут удалены.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-131">Waits for all queued samples to be discarded.</span></span>
2.  <span data-ttu-id="0e6e7-132">Освобождает все буферизованные данные.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-132">Frees any buffered data.</span></span> <span data-ttu-id="0e6e7-133">Иногда этот шаг можно выполнить в методе **бегинфлуш** .</span><span class="sxs-lookup"><span data-stu-id="0e6e7-133">This step can sometimes be performed in the **BeginFlush** method.</span></span> <span data-ttu-id="0e6e7-134">Однако **бегинфлуш** не синхронизируется с потоком потоковой передачи.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-134">However, **BeginFlush** is not synchronized with the streaming thread.</span></span> <span data-ttu-id="0e6e7-135">Фильтр не должен обрабатывать или буферизовать дополнительные данные между вызовом **бегинфлуш** и вызовом **ендфлуш**.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-135">The filter must not process or buffer any more data between the call to **BeginFlush** and the call to **EndFlush**.</span></span>
3.  <span data-ttu-id="0e6e7-136">Удаляет все ожидающие \_ уведомления EC о завершении.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-136">Clears any pending EC\_COMPLETE notifications.</span></span>
4.  <span data-ttu-id="0e6e7-137">Вызывает **ендфлуш** .</span><span class="sxs-lookup"><span data-stu-id="0e6e7-137">Calls **EndFlush** downstream.</span></span>

<span data-ttu-id="0e6e7-138">На этом этапе фильтр может снова принять выборки.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-138">At this point, the filter can accept samples again.</span></span> <span data-ttu-id="0e6e7-139">Все выборки гарантированно будут более новыми, чем очистка.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-139">All samples are guaranteed to be more recent than the flush.</span></span>

<span data-ttu-id="0e6e7-140">В модели извлечения фильтр анализатора запускает очистку, а не фильтр источника.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-140">In the pull model, the parser filter initiates flushing, rather than the source filter.</span></span> <span data-ttu-id="0e6e7-141">Он не только вызывает **Ипин:: бегинфлуш** и **Ипин:: ендфлуш** в подчиненном фильтре, но также вызывает [**Иасинкреадер:: Бегинфлуш**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-beginflush) и [**иасинкреадер:: ендфлуш**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-endflush) на *выходном* контактном фильтре источника.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-141">Not only does it call **IPin::BeginFlush** and **IPin::EndFlush** on the downstream filter, it also calls [**IAsyncReader::BeginFlush**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-beginflush) and [**IAsyncReader::EndFlush**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-endflush) on the *output* pin of the source filter.</span></span> <span data-ttu-id="0e6e7-142">Если фильтр источника имеет ожидающие запросы на чтение, то он будет удален.</span><span class="sxs-lookup"><span data-stu-id="0e6e7-142">If the source filter has pending read requests, it will discard them.</span></span>

## <a name="related-topics"></a><span data-ttu-id="0e6e7-143">См. также</span><span class="sxs-lookup"><span data-stu-id="0e6e7-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="0e6e7-144">Очистка данных</span><span class="sxs-lookup"><span data-stu-id="0e6e7-144">Flushing Data</span></span>](flushing-data.md)
</dt> </dl>

 

 



