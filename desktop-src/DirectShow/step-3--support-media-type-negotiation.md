---
description: Реализуйте поддержку согласования типов мультимедиа в процессе записи фильтра преобразования. Тип носителя описывает формат данных.
ms.assetid: b2b5dafc-d38d-4ec3-a390-55229495b4f9
title: Шаг 3. Поддержка согласования типов мультимедиа
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3a23784e70330f751325fc5f780463d5a3904d20
ms.sourcegitcommit: 5d4e99f4c8f42f5f543e52cb9beb9fb13ec56c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/19/2021
ms.locfileid: "112410047"
---
# <a name="step-3-support-media-type-negotiation"></a><span data-ttu-id="04bf1-105">Шаг 3.</span><span class="sxs-lookup"><span data-stu-id="04bf1-105">Step 3.</span></span> <span data-ttu-id="04bf1-106">Поддержка согласования типов мультимедиа</span><span class="sxs-lookup"><span data-stu-id="04bf1-106">Support Media Type Negotiation</span></span>

<span data-ttu-id="04bf1-107">Это шаг 3 учебника [Создание фильтров преобразования](writing-transform-filters.md).</span><span class="sxs-lookup"><span data-stu-id="04bf1-107">This is step 3 of the tutorial [Writing Transform Filters](writing-transform-filters.md).</span></span>

<span data-ttu-id="04bf1-108">Когда два контакта соединяются, они должны согласовать тип носителя для подключения.</span><span class="sxs-lookup"><span data-stu-id="04bf1-108">When two pins connect, they must agree on a media type for the connection.</span></span> <span data-ttu-id="04bf1-109">Тип носителя описывает формат данных.</span><span class="sxs-lookup"><span data-stu-id="04bf1-109">The media type describes the format of the data.</span></span> <span data-ttu-id="04bf1-110">Без типа носителя фильтр может доставлять данные одного типа, только если другой фильтр обрабатывает его как нечто другое.</span><span class="sxs-lookup"><span data-stu-id="04bf1-110">Without the media type, a filter might deliver one kind of data, only to have another filter treat it as something else.</span></span>

<span data-ttu-id="04bf1-111">Основным механизмом согласования типов мультимедиа является метод [**Ипин:: рецеивеконнектион**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) .</span><span class="sxs-lookup"><span data-stu-id="04bf1-111">The basic mechanism for negotiating media types is the [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) method.</span></span> <span data-ttu-id="04bf1-112">Закрепление вывода вызывает этот метод для входного ПИН-кода с предложенным типом мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="04bf1-112">The output pin calls this method on the input pin with a proposed media type.</span></span> <span data-ttu-id="04bf1-113">Входной ПИН-код принимает соединение или отклоняет его.</span><span class="sxs-lookup"><span data-stu-id="04bf1-113">The input pin accepts the connection or rejects it.</span></span> <span data-ttu-id="04bf1-114">Если подключение отклоняется, закрепление вывода может попытаться использовать другой тип мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="04bf1-114">If it rejects the connection, the output pin can try another media type.</span></span> <span data-ttu-id="04bf1-115">Если подходящие типы не найдены, соединение завершается сбоем.</span><span class="sxs-lookup"><span data-stu-id="04bf1-115">If no suitable types are found, the connection fails.</span></span> <span data-ttu-id="04bf1-116">При необходимости входной ПИН-код может объявить список типов, которые он предпочитает, с помощью метода [**Ипин:: енуммедиатипес**](/windows/desktop/api/Strmif/nf-strmif-ipin-enummediatypes) .</span><span class="sxs-lookup"><span data-stu-id="04bf1-116">Optionally, the input pin can advertise a list of types that it prefers, through the [**IPin::EnumMediaTypes**](/windows/desktop/api/Strmif/nf-strmif-ipin-enummediatypes) method.</span></span> <span data-ttu-id="04bf1-117">Закрепление вывода может использовать этот список, если он предлагает типы мультимедиа, хотя это и не обязательно.</span><span class="sxs-lookup"><span data-stu-id="04bf1-117">The output pin can use this list when it proposes media types, although it does not have to.</span></span>

<span data-ttu-id="04bf1-118">Класс **ктрансформфилтер** реализует общую платформу для этого процесса следующим образом:</span><span class="sxs-lookup"><span data-stu-id="04bf1-118">The **CTransformFilter** class implements a general framework for this process, as follows:</span></span>

-   <span data-ttu-id="04bf1-119">Входной ПИН-код не имеет предпочтительных типов мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="04bf1-119">The input pin has no preferred media types.</span></span> <span data-ttu-id="04bf1-120">Он полностью зависит от вышестоящего фильтра, чтобы предложить тип мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="04bf1-120">It relies entirely on the upstream filter to propose the media type.</span></span> <span data-ttu-id="04bf1-121">Для данных видео это имеет смысл, так как тип носителя включает размер изображения и частоту кадров.</span><span class="sxs-lookup"><span data-stu-id="04bf1-121">For video data, this makes sense, because the media type includes the image size and the frame rate.</span></span> <span data-ttu-id="04bf1-122">Как правило, эта информация должна быть предоставлена фильтром вышестоящего источника или фильтром синтаксического анализатора.</span><span class="sxs-lookup"><span data-stu-id="04bf1-122">Typically, that information must be supplied by an upstream source filter or parser filter.</span></span> <span data-ttu-id="04bf1-123">В случае с звуковыми данными набор возможных форматов меньше, поэтому входные данные могут быть очень практичными для предоставления некоторых предпочтительных типов.</span><span class="sxs-lookup"><span data-stu-id="04bf1-123">In the case of audio data, the set of possible formats is smaller, so it may be practical for the input pin to offer some preferred types.</span></span> <span data-ttu-id="04bf1-124">В этом случае Переопределите [**кбасепин:: жетмедиатипе**](cbasepin-getmediatype.md) для входного ПИН-кода.</span><span class="sxs-lookup"><span data-stu-id="04bf1-124">In that case, override [**CBasePin::GetMediaType**](cbasepin-getmediatype.md) on the input pin.</span></span>
-   <span data-ttu-id="04bf1-125">Когда вышестоящий фильтр предлагает тип мультимедиа, входной ПИН-код вызывает метод [**ктрансформфилтер:: чеккинпуттипе**](ctransformfilter-checkinputtype.md) , который принимает или отклоняет тип.</span><span class="sxs-lookup"><span data-stu-id="04bf1-125">When the upstream filter proposes a media type, the input pin calls the [**CTransformFilter::CheckInputType**](ctransformfilter-checkinputtype.md) method, which accepts or rejects the type.</span></span>
-   <span data-ttu-id="04bf1-126">ПИН-код выхода не будет подключаться, если только входной ПИН-код не подключен первыми.</span><span class="sxs-lookup"><span data-stu-id="04bf1-126">The output pin will not connect unless the input pin is connected first.</span></span> <span data-ttu-id="04bf1-127">Это поведение типично для фильтров преобразования.</span><span class="sxs-lookup"><span data-stu-id="04bf1-127">This behavior is typical for transform filters.</span></span> <span data-ttu-id="04bf1-128">В большинстве случаев фильтр должен определить тип входных данных, прежде чем он сможет задать тип выходных данных.</span><span class="sxs-lookup"><span data-stu-id="04bf1-128">In most cases, the filter must determine the input type before it can set the output type.</span></span>
-   <span data-ttu-id="04bf1-129">Когда закрепление вывода подключается, он получает список типов мультимедиа, которые он предлагает для подчиненного фильтра.</span><span class="sxs-lookup"><span data-stu-id="04bf1-129">When the output pin does connect, it has a list of media types that it proposes to the downstream filter.</span></span> <span data-ttu-id="04bf1-130">Он вызывает метод [**ктрансформфилтер:: жетмедиатипе**](ctransformfilter-getmediatype.md) для создания этого списка.</span><span class="sxs-lookup"><span data-stu-id="04bf1-130">It calls the [**CTransformFilter::GetMediaType**](ctransformfilter-getmediatype.md) method to generate this list.</span></span> <span data-ttu-id="04bf1-131">Закрепление выходных данных также попытается использовать типы мультимедиа, предлагаемые нисходящим фильтром.</span><span class="sxs-lookup"><span data-stu-id="04bf1-131">The output pin will also try any media types that the downstream filter proposes.</span></span>
-   <span data-ttu-id="04bf1-132">Чтобы проверить, совместим ли определенный тип выходных данных с типом входных данных, закрепление вывода вызывает метод [**ктрансформфилтер:: чекктрансформ**](ctransformfilter-checktransform.md) .</span><span class="sxs-lookup"><span data-stu-id="04bf1-132">To check whether a particular output type is compatible with the input type, the output pin calls the [**CTransformFilter::CheckTransform**](ctransformfilter-checktransform.md) method.</span></span>

<span data-ttu-id="04bf1-133">Три приведенных выше метода **ктрансформфилтер** являются чисто виртуальными методами, поэтому производный класс должен их реализовать.</span><span class="sxs-lookup"><span data-stu-id="04bf1-133">The three **CTransformFilter** methods listed previously are pure virtual methods, so your derived class must implement them.</span></span> <span data-ttu-id="04bf1-134">Ни один из этих методов не принадлежит к COM-интерфейсу; они просто являются частью реализации, предоставляемой базовыми классами.</span><span class="sxs-lookup"><span data-stu-id="04bf1-134">None of these methods belongs to a COM interface; they are simply part of the implementation provided by the base classes.</span></span>

<span data-ttu-id="04bf1-135">В следующих разделах каждый метод описан более подробно.</span><span class="sxs-lookup"><span data-stu-id="04bf1-135">The following sections describe each method in more detail:</span></span>

-   [<span data-ttu-id="04bf1-136">Шаг 3A. Реализация метода Чеккинпуттипе</span><span class="sxs-lookup"><span data-stu-id="04bf1-136">Step 3A. Implement the CheckInputType Method</span></span>](step-3a--implement-the-checkinputtype-method.md)
-   [<span data-ttu-id="04bf1-137">Шаг 3B. Реализация метода Жетмедиатипе</span><span class="sxs-lookup"><span data-stu-id="04bf1-137">Step 3B. Implement the GetMediaType Method</span></span>](step-3b--implement-the-getmediatype-method.md)
-   [<span data-ttu-id="04bf1-138">Шаг 3C. Реализация метода Чекктрансформ</span><span class="sxs-lookup"><span data-stu-id="04bf1-138">Step 3C. Implement the CheckTransform Method</span></span>](step-3c--implement-the-checktransform-method.md)

## <a name="related-topics"></a><span data-ttu-id="04bf1-139">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="04bf1-139">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="04bf1-140">Как подключаются фильтры</span><span class="sxs-lookup"><span data-stu-id="04bf1-140">How Filters Connect</span></span>](how-filters-connect.md)
</dt> <dt>

[<span data-ttu-id="04bf1-141">Написание фильтров DirectShow</span><span class="sxs-lookup"><span data-stu-id="04bf1-141">Writing DirectShow Filters</span></span>](writing-directshow-filters.md)
</dt> </dl>

 

 



