---
description: Эталонные часы
ms.assetid: 43f1a4d6-dbed-4940-a301-d863ddd34bce
title: Эталонные часы
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f9b958787f4dbdb20cd595b10cf486f59222a072
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "105673000"
---
# <a name="reference-clocks"></a><span data-ttu-id="e7d95-103">Эталонные часы</span><span class="sxs-lookup"><span data-stu-id="e7d95-103">Reference Clocks</span></span>

<span data-ttu-id="e7d95-104">Одна из функций диспетчера графа фильтров — синхронизировать все фильтры в графе с теми же часами, которые называются *ссылочным временем*.</span><span class="sxs-lookup"><span data-stu-id="e7d95-104">One function of the Filter Graph Manager is to synchronize all of the filters in the graph to the same clock, called the *reference clock*.</span></span>

<span data-ttu-id="e7d95-105">Любой объект, предоставляющий интерфейс [**иреференцеклокк**](/windows/desktop/api/Strmif/nn-strmif-ireferenceclock) , может использоваться в качестве эталонного времени.</span><span class="sxs-lookup"><span data-stu-id="e7d95-105">Any object that exposes the [**IReferenceClock**](/windows/desktop/api/Strmif/nn-strmif-ireferenceclock) interface can act as the reference clock.</span></span> <span data-ttu-id="e7d95-106">Ссылочное время может предоставляться фильтром DirectShow — обычно модулем подготовки звука, который имеет доступ к аппаратному таймеру.</span><span class="sxs-lookup"><span data-stu-id="e7d95-106">The reference clock might be provided by a DirectShow filter—typically the audio renderer, which has access to a hardware timer.</span></span> <span data-ttu-id="e7d95-107">В качестве резервного варианта диспетчер графа фильтров может использовать системное время.</span><span class="sxs-lookup"><span data-stu-id="e7d95-107">As a fallback, the Filter Graph Manager can use the system time.</span></span>

<span data-ttu-id="e7d95-108">В номинальной величине эталонное значение измеряет время в 100-наносекундных интервалах, хотя фактическая точность часов может быть меньше.</span><span class="sxs-lookup"><span data-stu-id="e7d95-108">Nominally, a reference clock measures time in 100-nanosecond intervals, although the actual accuracy of the clock might be less.</span></span> <span data-ttu-id="e7d95-109">Чтобы получить текущее время часов, вызовите метод [**иреференцеклокк:: OnTime**](/windows/desktop/api/Strmif/nf-strmif-ireferenceclock-gettime) .</span><span class="sxs-lookup"><span data-stu-id="e7d95-109">To retrieve the clock's current time, call the [**IReferenceClock::GetTime**](/windows/desktop/api/Strmif/nf-strmif-ireferenceclock-gettime) method.</span></span> <span data-ttu-id="e7d95-110">Базовый показатель часов — время, с которого он начинает подсчитаться, зависит от реализации, поэтому значение, возвращаемое методомического **времени** , не является значимым.</span><span class="sxs-lookup"><span data-stu-id="e7d95-110">The clock's baseline—the time from which it starts counting—depends on the implementation, so the value returned by **GetTime** is not inherently meaningful.</span></span> <span data-ttu-id="e7d95-111">Важность — это Дельта, начиная с момента начала работы графа.</span><span class="sxs-lookup"><span data-stu-id="e7d95-111">What matters is the delta from when the graph started running.</span></span>

<span data-ttu-id="e7d95-112">Хотя точность ссылочного времени может быть различной, время, возвращаемое [**методом Times**](/windows/desktop/api/Strmif/nf-strmif-ireferenceclock-gettime) , гарантированно увеличивается монотонно.</span><span class="sxs-lookup"><span data-stu-id="e7d95-112">Although the accuracy of a reference clock can vary, the times returned by the [**GetTime**](/windows/desktop/api/Strmif/nf-strmif-ireferenceclock-gettime) method are guaranteed to increase monotonically.</span></span> <span data-ttu-id="e7d95-113">Иными словами, время часы никогда не переходят назад.</span><span class="sxs-lookup"><span data-stu-id="e7d95-113">In other words, clock times will never go backward.</span></span> <span data-ttu-id="e7d95-114">Если эталонный таймер создает часы из аппаратного источника, а аппаратные часы переходят назад (например, при наличии корректировки для часов) **, метод Times** должен возвращать Последнее сообщаемое время до тех пор, пока аппаратные часы не будут перехватываться.</span><span class="sxs-lookup"><span data-stu-id="e7d95-114">If a reference clock is generating clock times from a hardware source and the hardware clock jumps backward (for example, if there is an adjustment to the clock), the **GetTime** method should continue to return the last reported time until the hardware clock catches up.</span></span> <span data-ttu-id="e7d95-115">Дополнительные сведения см. в разделе [**класс кбасереференцеклокк**](cbasereferenceclock.md).</span><span class="sxs-lookup"><span data-stu-id="e7d95-115">For more information, see [**CBaseReferenceClock Class**](cbasereferenceclock.md).</span></span>

<span data-ttu-id="e7d95-116">**Эталонный таймер по умолчанию**</span><span class="sxs-lookup"><span data-stu-id="e7d95-116">**Default Reference Clock**</span></span>

<span data-ttu-id="e7d95-117">Диспетчер графов фильтров автоматически выбирает эталонный таймер при выполнении графа.</span><span class="sxs-lookup"><span data-stu-id="e7d95-117">The Filter Graph Manager automatically selects a reference clock when the graph runs.</span></span> <span data-ttu-id="e7d95-118">Для выбора часов используется следующий алгоритм:</span><span class="sxs-lookup"><span data-stu-id="e7d95-118">It uses the following algorithm to select the clock:</span></span>

-   <span data-ttu-id="e7d95-119">Если приложение выбрало часы (см. ниже), используйте это время.</span><span class="sxs-lookup"><span data-stu-id="e7d95-119">If the application has selected a clock (see below), use that clock.</span></span>
-   <span data-ttu-id="e7d95-120">Если граф содержит фильтр активного источника, поддерживающий [**иреференцеклокк**](/windows/desktop/api/Strmif/nn-strmif-ireferenceclock), используйте этот фильтр.</span><span class="sxs-lookup"><span data-stu-id="e7d95-120">If the graph contains a live source filter that supports [**IReferenceClock**](/windows/desktop/api/Strmif/nn-strmif-ireferenceclock), use that filter.</span></span> <span data-ttu-id="e7d95-121">Определение активного источника см. в разделе [Динамические источники](live-sources.md).</span><span class="sxs-lookup"><span data-stu-id="e7d95-121">For the definition of a live source, see [Live Sources](live-sources.md).</span></span>
-   <span data-ttu-id="e7d95-122">Если граф не содержит фильтров источника Live, используйте любой фильтр в графе, который поддерживает [**иреференцеклокк**](/windows/desktop/api/Strmif/nn-strmif-ireferenceclock), начиная с модулей подготовки отчетов и рабочего потока.</span><span class="sxs-lookup"><span data-stu-id="e7d95-122">If the graph does NOT contain any live source filters, use any filter in the graph that supports [**IReferenceClock**](/windows/desktop/api/Strmif/nn-strmif-ireferenceclock), starting from the renderers and working upstream.</span></span> <span data-ttu-id="e7d95-123">Предпочитать подключенные фильтры по неподключенным фильтрам.</span><span class="sxs-lookup"><span data-stu-id="e7d95-123">Prefer connected filters over unconnected filters.</span></span> <span data-ttu-id="e7d95-124">(Если граф выполняет визуализацию аудиопотока, этот шаг обычно выбирает фильтр модуля подготовки звука.)</span><span class="sxs-lookup"><span data-stu-id="e7d95-124">(If the graph is rendering an audio stream, this step in the algorithm will normally select the audio renderer filter.)</span></span>
-   <span data-ttu-id="e7d95-125">Если ни один из фильтров не предоставляет подходящее время, используйте [системные часы](system-reference-clock.md), которые основаны на системном времени.</span><span class="sxs-lookup"><span data-stu-id="e7d95-125">If no filter provides a suitable clock, use the [System Reference Clock](system-reference-clock.md), which is based on the system time.</span></span>

<span data-ttu-id="e7d95-126">**Задание ссылочного времени**</span><span class="sxs-lookup"><span data-stu-id="e7d95-126">**Setting the Reference Clock**</span></span>

<span data-ttu-id="e7d95-127">Приложение может выбрать часы, вызвав метод [**имедиафилтер:: сетсинксаурце**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-setsyncsource) в диспетчере графов фильтров.</span><span class="sxs-lookup"><span data-stu-id="e7d95-127">An application can select a clock by calling the [**IMediaFilter::SetSyncSource**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-setsyncsource) method on the Filter Graph Manager.</span></span> <span data-ttu-id="e7d95-128">Это следует делать только в том случае, если есть конкретная причина для того, чтобы предпочитать другие часы.</span><span class="sxs-lookup"><span data-stu-id="e7d95-128">You should do this only if you have a particular reason to prefer another clock.</span></span>

<span data-ttu-id="e7d95-129">Можно указать диспетчеру графа фильтров не использовать время ссылки, вызвав [**сетсинксаурце**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-setsyncsource) со значением **null**.</span><span class="sxs-lookup"><span data-stu-id="e7d95-129">You can instruct the Filter Graph Manager not to use a reference clock by calling [**SetSyncSource**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-setsyncsource) with the value **NULL**.</span></span> <span data-ttu-id="e7d95-130">Например, это можно сделать для быстрой обработки образцов как можно быстрее.</span><span class="sxs-lookup"><span data-stu-id="e7d95-130">For example, you might do this to process samples as quickly as possible.</span></span> <span data-ttu-id="e7d95-131">Чтобы восстановить ссылочное время по умолчанию, вызовите метод [**ифилтерграф:: сетдефаултсинксаурце**](/windows/desktop/api/Strmif/nf-strmif-ifiltergraph-setdefaultsyncsource) в диспетчере графов фильтров.</span><span class="sxs-lookup"><span data-stu-id="e7d95-131">To restore the default reference clock, call the [**IFilterGraph::SetDefaultSyncSource**](/windows/desktop/api/Strmif/nf-strmif-ifiltergraph-setdefaultsyncsource) method on the Filter Graph Manager.</span></span>

<span data-ttu-id="e7d95-132">При изменении ссылочного времени диспетчер графа фильтров уведомляет каждый фильтр, вызывая его метод [**имедиафилтер:: сетсинксаурце**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-setsyncsource) .</span><span class="sxs-lookup"><span data-stu-id="e7d95-132">Whenever the reference clock changes, the Filter Graph Manager notifies each filter by calling its [**IMediaFilter::SetSyncSource**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-setsyncsource) method.</span></span> <span data-ttu-id="e7d95-133">Приложения никогда не должны вызывать этот метод для фильтров.</span><span class="sxs-lookup"><span data-stu-id="e7d95-133">Applications should never call this method on filters.</span></span>

## <a name="related-topics"></a><span data-ttu-id="e7d95-134">См. также</span><span class="sxs-lookup"><span data-stu-id="e7d95-134">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e7d95-135">Настройка часов графа</span><span class="sxs-lookup"><span data-stu-id="e7d95-135">Setting the Graph Clock</span></span>](setting-the-graph-clock.md)
</dt> <dt>

[<span data-ttu-id="e7d95-136">Время и часы в DirectShow</span><span class="sxs-lookup"><span data-stu-id="e7d95-136">Time and Clocks in DirectShow</span></span>](time-and-clocks-in-directshow.md)
</dt> </dl>

 

 



