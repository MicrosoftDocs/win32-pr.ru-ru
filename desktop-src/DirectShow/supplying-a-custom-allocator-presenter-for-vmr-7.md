---
description: Предоставление пользовательского Allocator-Presenter для VMR-7
ms.assetid: 19b43c9b-2578-418f-b03b-af7c7a3a46e4
title: Предоставление пользовательского Allocator-Presenter для VMR-7
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1e79f191401f990214b2551f9210fab4dfe4d43b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104571179"
---
# <a name="supplying-a-custom-allocator-presenter-for-vmr-7"></a><span data-ttu-id="9bb7b-103">Предоставление пользовательского Allocator-Presenter для VMR-7</span><span class="sxs-lookup"><span data-stu-id="9bb7b-103">Supplying a Custom Allocator-Presenter for VMR-7</span></span>

<span data-ttu-id="9bb7b-104">Распределитель-выступающий отвечает за выделение поверхностей DirectDraw и показ видеокадров для подготовки к просмотру.</span><span class="sxs-lookup"><span data-stu-id="9bb7b-104">The allocator-presenter is responsible for allocating DirectDraw surfaces and presenting the video frames for rendering.</span></span> <span data-ttu-id="9bb7b-105">В подавляющем большинстве случаев функциональные возможности распределителя по умолчанию будут более чем достаточными для нужд приложения.</span><span class="sxs-lookup"><span data-stu-id="9bb7b-105">In the vast majority of scenarios, the functionality of the default allocator-presenter will be more than sufficient for an application's needs.</span></span> <span data-ttu-id="9bb7b-106">Но благодаря подключению пользовательского распределителя, приложение может получить прямой доступ к видеороликам и полностью управлять процессом отрисовки.</span><span class="sxs-lookup"><span data-stu-id="9bb7b-106">But by plugging in a custom allocator-presenter, an application can obtain direct access to the video bits and completely control the rendering process.</span></span> <span data-ttu-id="9bb7b-107">Компромисс для этой повышенной мощности заключается в том, что приложение должно справиться со сложенной сложностью управления поверхностью DirectDraw.</span><span class="sxs-lookup"><span data-stu-id="9bb7b-107">The trade-off for this increased power is that the application must handle the added complexity of DirectDraw surface management.</span></span>

![Использование пользовательского распределителя-выступающего](images/custom-ap.png)

<span data-ttu-id="9bb7b-109">На предыдущем рисунке показаны интерфейсы связи, используемые VMR и распределителя-Presenter.</span><span class="sxs-lookup"><span data-stu-id="9bb7b-109">The preceding figure shows the communication interfaces used by the VMR and the allocator-presenter.</span></span> <span data-ttu-id="9bb7b-110">Пользовательский распределитель-выступающий, переопределяющий все функции выделения и представления по умолчанию, должен реализовывать интерфейсы [**ивмримажепресентер**](/windows/desktop/api/Strmif/nn-strmif-ivmrimagepresenter) и [**ивмрсурфацеаллокатор**](/windows/desktop/api/Strmif/nn-strmif-ivmrsurfaceallocator) и, при необходимости, [**ивмрвиндовлессконтрол**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol).</span><span class="sxs-lookup"><span data-stu-id="9bb7b-110">A custom allocator-presenter that overrides all of the default allocation and presentation functionality must implement the [**IVMRImagePresenter**](/windows/desktop/api/Strmif/nn-strmif-ivmrimagepresenter) and [**IVMRSurfaceAllocator**](/windows/desktop/api/Strmif/nn-strmif-ivmrsurfaceallocator) interfaces, and optionally, [**IVMRWindowlessControl**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol).</span></span>

<span data-ttu-id="9bb7b-111">Для замены распределителя по умолчанию приложение вызывает метод [**ивмрсурфацеаллокаторнотифи:: адвисесурфацеаллокатор**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocatornotify-advisesurfaceallocator) и передает указатель на новый объект распределителя-Presenter.</span><span class="sxs-lookup"><span data-stu-id="9bb7b-111">To replace the default allocator-presenter, an application calls the [**IVMRSurfaceAllocatorNotify::AdviseSurfaceAllocator**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocatornotify-advisesurfaceallocator) method and passes in a pointer to the new allocator-presenter.</span></span> <span data-ttu-id="9bb7b-112">В ответ на этот вызов VMR будет вызывать метод [**ивмрсурфацеаллокатор:: адвисенотифи**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocator-advisenotify) распределителя-Presenter, чтобы предоставить указатель на интерфейс [**ивмрсурфацеаллокаторнотифи**](/windows/desktop/api/Strmif/nn-strmif-ivmrsurfaceallocatornotify) VMR.</span><span class="sxs-lookup"><span data-stu-id="9bb7b-112">In response to this call, the VMR will call the allocator-presenter's [**IVMRSurfaceAllocator::AdviseNotify**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocator-advisenotify) method to provide the pointer to the VMR's [**IVMRSurfaceAllocatorNotify**](/windows/desktop/api/Strmif/nn-strmif-ivmrsurfaceallocatornotify) interface.</span></span> <span data-ttu-id="9bb7b-113">Распределитель-выступающий будет использовать этот указатель интерфейса при передаче событий в VMR с помощью метода [**ивмрсурфацеаллокаторнотифи:: нотифевент**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocatornotify-notifyevent) .</span><span class="sxs-lookup"><span data-stu-id="9bb7b-113">The allocator-presenter will use this interface pointer when passing events to the VMR with the [**IVMRSurfaceAllocatorNotify::NotifyEvent**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocatornotify-notifyevent) method.</span></span>

<span data-ttu-id="9bb7b-114">В качестве альтернативного решения приложение может использовать как собственное средство выделения-выступающего, так и средство распределения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="9bb7b-114">As an alternate solution, an application can use both its own allocator-presenter and the default allocator-presenter.</span></span> <span data-ttu-id="9bb7b-115">В этом сценарии пользовательский распределитель-выступающий обрабатывает только те вызовы, в которых требуется пользовательская функциональность, и передает остальные вызовы из VMR в интерфейс распределителя-Presenter по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="9bb7b-115">In this scenario, the custom allocator-presenter handles only those calls where custom functionality is needed, and passes the rest of the calls from the VMR through to the default allocator-presenter.</span></span> <span data-ttu-id="9bb7b-116">Во многих случаях необходимо переопределить только интерфейс [**ивмримажепресентер**](/windows/desktop/api/Strmif/nn-strmif-ivmrimagepresenter) .</span><span class="sxs-lookup"><span data-stu-id="9bb7b-116">In many cases, it is only necessary to override the [**IVMRImagePresenter**](/windows/desktop/api/Strmif/nn-strmif-ivmrimagepresenter) interface.</span></span>

![использование двух средств выделения-выступающих](images/custom-ap2.png)

<span data-ttu-id="9bb7b-118">Чтобы использовать пользовательский распределитель-объект и средство распределения по умолчанию, приложение сначала вызывает метод [**ивмрсурфацеаллокаторнотифи:: адвисесурфацеаллокатор**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocatornotify-advisesurfaceallocator) , чтобы предоставить указатель на новый распределитель-представление.</span><span class="sxs-lookup"><span data-stu-id="9bb7b-118">To use both a custom allocator-presenter and the default allocator-presenter, an application would first call [**IVMRSurfaceAllocatorNotify::AdviseSurfaceAllocator**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocatornotify-advisesurfaceallocator) to provide a pointer to the new allocator-presenter.</span></span> <span data-ttu-id="9bb7b-119">Это приводит к уничтожению распределителя по умолчанию, поэтому приложение должно создать другой экземпляр, вызвав **QueryInterface** на VMR и запрашивая интерфейс [**ивмрсурфацеаллокатор**](/windows/desktop/api/Strmif/nn-strmif-ivmrsurfaceallocator) .</span><span class="sxs-lookup"><span data-stu-id="9bb7b-119">This causes the default allocator-presenter to be destroyed, so the application must create another instance of it by calling **QueryInterface** on the VMR and requesting the [**IVMRSurfaceAllocator**](/windows/desktop/api/Strmif/nn-strmif-ivmrsurfaceallocator) interface.</span></span> <span data-ttu-id="9bb7b-120">Как показано на предыдущем рисунке, пользовательский распределитель-представление переопределяет методы интерфейса [**ивмримажепресентер**](/windows/desktop/api/Strmif/nn-strmif-ivmrimagepresenter) и просто передает все вызовы интерфейса **ивмрсурфацеаллокатор** через реализацию по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="9bb7b-120">As shown in the preceding figure, the custom allocator-presenter overrides the [**IVMRImagePresenter**](/windows/desktop/api/Strmif/nn-strmif-ivmrimagepresenter) interface methods, and simply passes all calls to the **IVMRSurfaceAllocator** interface through to the default implementation.</span></span> <span data-ttu-id="9bb7b-121">На рисунке также показан интерфейс [**ивмрвиндовлессконтрол**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol) , реализованный в распределителе-Presenter.</span><span class="sxs-lookup"><span data-stu-id="9bb7b-121">The figure also shows the [**IVMRWindowlessControl**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol) interface as being implemented on the allocator-presenter.</span></span>

## <a name="related-topics"></a><span data-ttu-id="9bb7b-122">См. также</span><span class="sxs-lookup"><span data-stu-id="9bb7b-122">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="9bb7b-123">Предоставление пользовательского Allocator-Presenter для VMR-9</span><span class="sxs-lookup"><span data-stu-id="9bb7b-123">Supplying a Custom Allocator-Presenter for VMR-9</span></span>](supplying-a-custom-allocator-presenter-for-vmr-9.md)
</dt> <dt>

[<span data-ttu-id="9bb7b-124">Режим воспроизведения VMR (пользовательский распределитель — выступающие)</span><span class="sxs-lookup"><span data-stu-id="9bb7b-124">VMR Renderless Playback Mode (Custom Allocator-Presenters)</span></span>](vmr-renderless-playback-mode--custom-allocator-presenters.md)
</dt> </dl>

 

 



