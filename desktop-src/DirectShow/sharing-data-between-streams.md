---
description: Обмен данными между потоками
ms.assetid: e18eecf8-9475-420a-9a60-4b1b5f8fd43a
title: Обмен данными между потоками
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ee0b2f53fe1952bbc16711f7c7e39c3182ba94a7
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104495234"
---
# <a name="sharing-data-between-streams"></a><span data-ttu-id="9db76-103">Обмен данными между потоками</span><span class="sxs-lookup"><span data-stu-id="9db76-103">Sharing Data Between Streams</span></span>

> [!Note]  
> <span data-ttu-id="9db76-104">Эти API-интерфейсы являются устаревшими.</span><span class="sxs-lookup"><span data-stu-id="9db76-104">These APIs are deprecated.</span></span> <span data-ttu-id="9db76-105">Приложения должны использовать [**образец фильтра захвата**](sample-grabber-filter.md) или реализовать настраиваемый фильтр для получения данных из графа фильтра DirectShow.</span><span class="sxs-lookup"><span data-stu-id="9db76-105">Applications should use the [**Sample Grabber**](sample-grabber-filter.md) filter or implement a custom filter to get data from a DirectShow filter graph.</span></span>

 

<span data-ttu-id="9db76-106">Для обработки мультимедийных данных обычно требуется большой объем системных ресурсов. Поэтому следует избегать копирования данных везде, где это возможно.</span><span class="sxs-lookup"><span data-stu-id="9db76-106">Processing multimedia data typically requires a great deal of system resources; therefore, you should avoid copying data whenever possible.</span></span> <span data-ttu-id="9db76-107">Архитектура потоковой передачи поддерживает примеры общих потоков — механизм, который перемещает данные из одного потока в другой без копирования.</span><span class="sxs-lookup"><span data-stu-id="9db76-107">The streaming architecture supports shared stream samples, a mechanism that moves data from one stream to another without copying it.</span></span> <span data-ttu-id="9db76-108">Этот буфер обеспечивает эффективный транспорт данных между двумя потоками, даже если целевой поток не поддерживает базовый формат данных.</span><span class="sxs-lookup"><span data-stu-id="9db76-108">This buffer enables the efficient transportation of data between two streams even if the destination stream doesn't specifically support the underlying data format.</span></span>

<span data-ttu-id="9db76-109">Например, предположим, что у вас есть мультимедийный поток с тремя потоками данных: видео и аудио, а также данные URL-адреса со временем, которые соответствуют содержимому видео.</span><span class="sxs-lookup"><span data-stu-id="9db76-109">For example, assume that you have a multimedia stream with three data streams: video and audio, and URL data time-stamped to match the video content.</span></span> <span data-ttu-id="9db76-110">Вы хотите написать приложение, которое добавляет уведомление об авторских правах в каждый кадр видеозаписи и записывает данные в другой поток для хранения, но ваше приложение не понимает никаких форматов данных, кроме видеопотока.</span><span class="sxs-lookup"><span data-stu-id="9db76-110">You want to write an application that adds a copyright notice on every video frame and writes the data to another stream for storage, but your application doesn't understand any data formats except the video stream.</span></span> <span data-ttu-id="9db76-111">Для видеопотока вы создаете пример, присоединенный к нужной поверхности DirectDraw.</span><span class="sxs-lookup"><span data-stu-id="9db76-111">For the video stream, you create a sample attached to the desired DirectDraw surface.</span></span> <span data-ttu-id="9db76-112">Затем можно создать выходной поток, вызвав метод [**идиректдравмедиастреам:: креатесампле**](/previous-versions/windows/desktop/api/ddstream/nf-ddstream-idirectdrawmediastream-createsample) с этим указателем на ту же поверхность или [**Имедиастреам:: креатешаредсампле**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample).</span><span class="sxs-lookup"><span data-stu-id="9db76-112">You can then create an output stream by calling either the [**IDirectDrawMediaStream::CreateSample**](/previous-versions/windows/desktop/api/ddstream/nf-ddstream-idirectdrawmediastream-createsample) method with that pointer to the same surface, or [**IMediaStream::CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample).</span></span> <span data-ttu-id="9db76-113">В обоих случаях входные и выходные потоки совместно используют поверхность DirectDraw.</span><span class="sxs-lookup"><span data-stu-id="9db76-113">In both cases, the input and output streams share the DirectDraw surface.</span></span> <span data-ttu-id="9db76-114">Так как вы понимаете формат видео, при необходимости вы можете получить доступ к этой поверхности.</span><span class="sxs-lookup"><span data-stu-id="9db76-114">Because you understand the video format, you can access this surface as needed.</span></span>

<span data-ttu-id="9db76-115">Чтобы получить другие указатели исходного потока (аудио и URL), перечислите исходный поток контейнера и захватите указатели на видеопотоки.</span><span class="sxs-lookup"><span data-stu-id="9db76-115">To retrieve the other source stream pointers (audio and URL), enumerate the source container stream and grab pointers to the nonvideo streams.</span></span> <span data-ttu-id="9db76-116">Каждый из этих исходных потоков имеет связанный выходной поток в контейнере потока вывода.</span><span class="sxs-lookup"><span data-stu-id="9db76-116">Each of these source streams has an associated output stream in the output stream container.</span></span> <span data-ttu-id="9db76-117">Получите эти выходные указатели, вызвав метод [**имултимедиастреам:: жетмедиастреам**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) в контейнере вывода с каждым из указателей исходного потока.</span><span class="sxs-lookup"><span data-stu-id="9db76-117">Retrieve these output pointers by calling the [**IMultiMediaStream::GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) method on the output container with each of the source stream pointers.</span></span> <span data-ttu-id="9db76-118">Следующие шаги описывают данный процесс.</span><span class="sxs-lookup"><span data-stu-id="9db76-118">The following steps describe this process.</span></span>

1.  <span data-ttu-id="9db76-119">Вызовите метод [**имултимедиастреам:: енуммедиастреамс**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-enummediastreams) , чтобы получить указатель на исходный поток.</span><span class="sxs-lookup"><span data-stu-id="9db76-119">Call [**IMultiMediaStream::EnumMediaStreams**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-enummediastreams) to retrieve a pointer to a source stream.</span></span> <span data-ttu-id="9db76-120">Убедитесь, что это не видеопоток, так как приложение уже распознает свой формат.</span><span class="sxs-lookup"><span data-stu-id="9db76-120">Make sure that it's not the video stream, because your application already understands its format.</span></span>
2.  <span data-ttu-id="9db76-121">Вызовите метод [**имултимедиастреам:: жетмедиастреам**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) в выходном потоке контейнера с указателем из шага 1.</span><span class="sxs-lookup"><span data-stu-id="9db76-121">Call [**IMultiMediaStream::GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) on the output container stream with the pointer from step 1.</span></span> <span data-ttu-id="9db76-122">Он возвращает указатель на нужный выходной поток.</span><span class="sxs-lookup"><span data-stu-id="9db76-122">This returns a pointer to the desired output stream.</span></span>
3.  <span data-ttu-id="9db76-123">Вызовите [**аллокатесампле**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-allocatesample) в исходном потоке.</span><span class="sxs-lookup"><span data-stu-id="9db76-123">Call [**AllocateSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-allocatesample) on the source stream.</span></span>
4.  <span data-ttu-id="9db76-124">Вызовите [**креатешаредсампле**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample) в потоке вывода.</span><span class="sxs-lookup"><span data-stu-id="9db76-124">Call [**CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample) on the output stream.</span></span>
5.  <span data-ttu-id="9db76-125">Чтобы считать данные, вызовите метод [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) в исходном потоке.</span><span class="sxs-lookup"><span data-stu-id="9db76-125">Call [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) on the source stream to read the data.</span></span>
6.  <span data-ttu-id="9db76-126">Вызовите метод [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) в потоке вывода, чтобы записать данные.</span><span class="sxs-lookup"><span data-stu-id="9db76-126">Call [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) on the output stream to write the data.</span></span>

<span data-ttu-id="9db76-127">Повторите эти действия для каждого потока, формат которого не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="9db76-127">Repeat these steps for each stream whose format you don't support.</span></span> <span data-ttu-id="9db76-128">После завершения обновления обоих образцов выходной поток получает все данные из исходного потока и все готово.</span><span class="sxs-lookup"><span data-stu-id="9db76-128">When both samples finish updating, the output stream has all data from the source stream and you are done.</span></span>

 

 



