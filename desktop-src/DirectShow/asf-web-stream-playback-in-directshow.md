---
description: Воспроизведение веб-потока ASF в DirectShow
ms.assetid: c7818c62-24af-4eac-84b8-f76be4ca6c09
title: Воспроизведение веб-потока ASF в DirectShow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2d14a83d2baf9c11aa824f5d6358f62790c16b30
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104341935"
---
# <a name="asf-web-stream-playback-in-directshow"></a><span data-ttu-id="64d4f-103">Воспроизведение веб-потока ASF в DirectShow</span><span class="sxs-lookup"><span data-stu-id="64d4f-103">ASF Web Stream Playback in DirectShow</span></span>

<span data-ttu-id="64d4f-104">Microsoft DirectShow поддерживает веб-потоки в сценариях воспроизведения файлов с помощью фильтра [чтения WM ASF](wm-asf-reader-filter.md) , но для записи и сохранения потока необходимо написать собственный фильтр DirectShow.</span><span class="sxs-lookup"><span data-stu-id="64d4f-104">Microsoft DirectShow supports web streams in file playback scenarios through the [WM ASF Reader](wm-asf-reader-filter.md) filter, but you must write your own DirectShow filter to capture and persist the stream.</span></span>

> [!Note]  
> <span data-ttu-id="64d4f-105">Для воспроизведения веб-потоков в содержимом, которое передается с сервера, на котором работают службы Windows Media, используйте элемент управления ActiveX® Windows Media 9 Series, внедренный в веб-страницу.</span><span class="sxs-lookup"><span data-stu-id="64d4f-105">To play back web streams in content that is being streamed from a server running Windows Media Services, use the Windows Media Player 9 Series ActiveX® control embedded in a web page.</span></span>

 

<span data-ttu-id="64d4f-106">При наличии файла, содержащего потоки типа ВММЕДИАТИПЕ \_ филетрансфер, средство чтения WM ASF создаст для него закрепление вывода.</span><span class="sxs-lookup"><span data-stu-id="64d4f-106">When given a file containing streams of type WMMEDIATYPE\_FileTransfer, the WM ASF Reader will create an output pin for it.</span></span> <span data-ttu-id="64d4f-107">Блоком формата будет структура [**\_ \_ формата ВМТ**](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wmt_webstream_format) в виде потока.</span><span class="sxs-lookup"><span data-stu-id="64d4f-107">The format block will be a [**WMT\_WEBSTREAM\_FORMAT**](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wmt_webstream_format) structure.</span></span> <span data-ttu-id="64d4f-108">(Эта структура описана в документации пакета Windows Media Format SDK.) Если подчиненный фильтр недоступен для работы с этим типом мультимедиа, ПИН-код останется неподключенным, но он по-прежнему будет воспроизводить аудио-и видеопотоки.</span><span class="sxs-lookup"><span data-stu-id="64d4f-108">(This structure is documented in the Windows Media Format SDK documentation.) If no downstream filter is available that can handle that media type, then the pin will remain unconnected, but the file will still play the audio and/or video streams.</span></span>

<span data-ttu-id="64d4f-109">Каждый пример носителя в веб-потоке содержит [**структуру \_ \_ \_ заголовков ВМТ для примера потока**](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wmt_webstream_sample_header) , которая описана в документации по пакету SDK Windows Media Format.</span><span class="sxs-lookup"><span data-stu-id="64d4f-109">Each media sample in a web stream contains a [**WMT\_WEBSTREAM\_SAMPLE\_HEADER**](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wmt_webstream_sample_header) structure, which is documented in the Windows Media Format SDK documentation.</span></span> <span data-ttu-id="64d4f-110">Структура имеет переменную длину в зависимости от длины ее элемента **всзурл** .</span><span class="sxs-lookup"><span data-stu-id="64d4f-110">The structure has a variable length depending on the length of its **wszURL** member.</span></span> <span data-ttu-id="64d4f-111">Указатель на образец данных изначально указывает на эту структуру, и необходимо передвинуть указатель за пределы структуры, чтобы получить доступ к реальным данным в потоке.</span><span class="sxs-lookup"><span data-stu-id="64d4f-111">The pointer to the sample data initially points to this structure, and you must advance the pointer past the structure in order to access the actual data in the stream.</span></span>

<span data-ttu-id="64d4f-112">Фильтр обработчика веб-потока должен основываться на классе [**кбасерендерер**](cbaserenderer.md) .</span><span class="sxs-lookup"><span data-stu-id="64d4f-112">Your web stream handler filter should be based on the [**CBaseRenderer**](cbaserenderer.md) class.</span></span> <span data-ttu-id="64d4f-113">В методе [**кбасерендерер::D орендерсампле**](cbaserenderer-dorendersample.md) фильтру необходимо будет проанализировать структуру для получения сведений о веб-потоке, а затем выполнить соответствующее действие.</span><span class="sxs-lookup"><span data-stu-id="64d4f-113">In the [**CBaseRenderer::DoRenderSample**](cbaserenderer-dorendersample.md) method, the filter will need to parse the structure for information about the web stream, and then perform the appropriate action.</span></span> <span data-ttu-id="64d4f-114">Как правило, это предполагает сохранение файла на диск, а затем вызов функций [**креатеурлкачинтри**](/windows/desktop/api/wininet/nf-wininet-createurlcacheentrya) и [**коммитурлкачинтрив**](/windows/desktop/api/wininet/nf-wininet-commiturlcacheentryw) или [**коммитурлкачинтря**](/windows/desktop/api/wininet/nf-wininet-commiturlcacheentrya) для помещения файлов в кэш Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="64d4f-114">Typically, this will involve saving the file to disk, and then calling the [**CreateUrlCacheEntry**](/windows/desktop/api/wininet/nf-wininet-createurlcacheentrya) and [**CommitUrlCacheEntryW**](/windows/desktop/api/wininet/nf-wininet-commiturlcacheentryw) or [**CommitUrlCacheEntryA**](/windows/desktop/api/wininet/nf-wininet-commiturlcacheentrya) functions to place the files into the Internet Explorer cache.</span></span> <span data-ttu-id="64d4f-115">Фильтр должен обрабатывать составные файлы, то есть файлы, размер которых больше одного образца, а также обрабатывать команды рендеринга, которые задаются членом **ВМТ \_ \_ \_ . ВСАМПЛЕТИПЕ в образце потока** .</span><span class="sxs-lookup"><span data-stu-id="64d4f-115">The filter must handle multipart files, that is, files that are larger than one sample, and also must handle render commands, which are specified by the **WMT\_WEBSTREAM\_SAMPLE\_HEADER.wSampleType** member.</span></span> <span data-ttu-id="64d4f-116">Фильтр отправляет в приложение [**событие \_ EC \_ OLE**](ec-ole-event.md) , а также текст **\_ заголовка ВМТ \_ \_ . всзурл** , который содержит имя файла для подготовки к просмотру.</span><span class="sxs-lookup"><span data-stu-id="64d4f-116">The filter sends an [**EC\_OLE\_EVENT**](ec-ole-event.md) event to the application, along with the text of the **WMT\_WEBSTREAM\_SAMPLE\_HEADER.wszURL** string which contains the name of the file to be rendered.</span></span> <span data-ttu-id="64d4f-117">Затем приложение вызывает отображение указанной страницы в браузере.</span><span class="sxs-lookup"><span data-stu-id="64d4f-117">The application then causes the browser to display the specified page.</span></span> <span data-ttu-id="64d4f-118">Если веб-поток создан правильно, файл должен уже находиться в кэше.</span><span class="sxs-lookup"><span data-stu-id="64d4f-118">If the web stream has been authored correctly, the file should already be in the cache.</span></span>

<span data-ttu-id="64d4f-119">Дополнительные сведения о формате ВМТ в \_ \_ виде потока и в \_ \_ \_ заголовке ВМТ Stream см. в документации по пакету SDK для Windows Media Format.</span><span class="sxs-lookup"><span data-stu-id="64d4f-119">For more information on WMT\_WEBSTREAM\_FORMAT and WMT\_WEBSTREAM\_SAMPLE\_HEADER, see the Windows Media Format SDK documentation.</span></span>

## <a name="related-topics"></a><span data-ttu-id="64d4f-120">См. также</span><span class="sxs-lookup"><span data-stu-id="64d4f-120">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="64d4f-121">Чтение файлов ASF в DirectShow</span><span class="sxs-lookup"><span data-stu-id="64d4f-121">Reading ASF Files in DirectShow</span></span>](reading-asf-files-in-directshow.md)
</dt> </dl>

 

 
