---
description: Согласование распределителя
ms.assetid: fe13477c-1a7b-4098-9d0f-c54783102bc9
title: Согласование распределителя
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2faa393ba9fcd8585d68947cec172d4cfca6decf
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "105682185"
---
# <a name="negotiating-allocators"></a>Согласование распределителя

Когда два контакта соединяются, им нужен механизм для обмена данными мультимедиа. Этот механизм называется *транспортным*. Как правило, архитектура DirectShow нейтральна к транспортам. Два фильтра могут согласиться на подключение с помощью любого транспортного транспорта, поддерживающего обе операции.

Наиболее распространенным транспортом является транспорт *локальной памяти* , в котором данные мультимедиа находятся в основной памяти. Существует две разновидности транспорта локальной памяти, *модель push-уведомлений* и *модель извлечения*. В модели отправки фильтр источника передает данные в нисходящий фильтр, используя интерфейс [**имеминпутпин**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) на входном закреплением подчиненного фильтра. В модели извлечения нисходящий фильтр запрашивает данные из фильтра источника с помощью интерфейса [**иасинкреадер**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader) в закреплениях вывода фильтра источника. Дополнительные сведения об этих двух моделях потоков данных см. в разделе [поток данных в графе фильтра](data-flow-in-the-filter-graph.md).

При транспортировке локальной памяти объект, отвечающий за выделение буферов памяти, называется *распределителем*. Распределитель поддерживает интерфейс [**имемаллокатор**](/windows/desktop/api/Strmif/nn-strmif-imemallocator) . Оба ПИН-кода совместно используют один распределитель. Любой ПИН-код может предоставлять распределитель, но закрепление вывода выбирает, какой распределитель следует использовать.

Закрепление вывода также задает свойства распределителя, которые определяют количество буферов, создаваемых распределителем, размер каждого буфера и выравнивание памяти. Закрепление вывода может откладываться на входной ПИН-код для требований к буферу.

В подключении **имеминпутпин** согласование распределителя работает следующим образом:

1.  При необходимости выходной ПИН-код вызывает [**имеминпутпин:: жеталлокаторрекуирементс**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocatorrequirements). Этот метод получает требования к буферу входного ПИН-кода, например выравнивание памяти. В общем случае выходной ПИН-код должен соответствовать запросу входного ПИН-кода, если нет веской причины отсутствия.
2.  При необходимости выходной ПИН-код вызывает [**имеминпутпин::-распределителя**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocator). Этот метод запрашивает распределитель из входного ПИН-кода. Входной ПИН-код предоставляет один или возвращает код ошибки.
3.  Закрепление вывода выбирает распределитель. Он может использовать один из предоставленных ПИН-кодов ввода или создать собственный.
4.  Закрепление вывода вызывает [**имемаллокатор:: SetProperties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-setproperties) для задания свойств распределителя. Однако распределитель может не учитывать запрошенные свойства. (Например, это может произойти, если входной ПИН-код предоставляет распределитель). Распределитель возвращает фактические свойства в виде выходного параметра в методе **SetProperties** .
5.  Аутпин вызывает [**имеминпутпин:: нотифяллокатор**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-notifyallocator) , чтобы уведомить входной ПИН-код выделения.
6.  Входной ПИН-код должен вызывать [**имемаллокатор::-Properties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getproperties) , чтобы проверить, приемлемы ли свойства распределителя.
7.  Закрепление вывода отвечает за фиксацию и отправку распределителя. Это происходит при запуске и остановке потоковой передачи.

В подключении **иасинкреадер** согласование распределителя работает следующим образом:

1.  Входной ПИН-код вызывает [**иасинкреадер:: рекуесталлокатор**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-requestallocator) на выходном заводе. Входной ПИН-код определяет требования к буферу и, при необходимости, предоставляет распределитель.
2.  Закрепление вывода выбирает распределитель. Он может использовать тот, который предоставлен ПИН-кодом ввода, если таковой имеется, или создать собственный.
3.  Закрепление вывода возвращает распределитель в качестве исходящего параметра в методе **рекуесталлокатор** . Входной ПИН-код должен проверять свойства распределителя.
4.  Входной ПИН-код отвечает за фиксацию и отправку распределителя.
5.  В любой момент во время процесса согласования распределителя любой из ПИН-кодов может привести к сбою подключения.
6.  Если закрепление вывода использует распределитель входного контакта, он может использовать этот распределитель только для доставки образцов на этот входной ПИН-код. Фильтр-владелец не должен использовать распределитель для доставки образцов на другие контакты.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Предоставление пользовательского распределителя](providing-a-custom-allocator.md)
</dt> </dl>

 

 



