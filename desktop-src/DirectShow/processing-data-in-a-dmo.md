---
description: Обработка данных в DMO
ms.assetid: 715482d9-23f4-40d0-9c09-7a81e148c543
title: Обработка данных в DMO
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bcd4dd05df960bd27b34eb55b604c8469e7bbaedd57ea928f5b4f412ad4bff04
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119748244"
---
# <a name="processing-data-in-a-dmo"></a>Обработка данных в DMO

В этом разделе описывается обработка потока данных с помощью DMO. Действия, описанные в этом разделе, являются поведением по умолчанию. все дмос должны поддерживать описанные здесь методы. Эти методы используют отдельные буферы для ввода и вывода. Некоторые дмос также поддерживают обработку на месте с помощью одного буфера. Дополнительные сведения об обработке на месте см. в разделе [обработка на месте](in-place-processing.md).

**Выделение буферов**

Клиент отвечает за выделение всех буферов. после установки типов мультимедиа на DMO запросите DMO для каждого из требований к буферу потока. Они могут изменяться в зависимости от типа носителя. Для каждого потока вызовите метод [**имедиаобжект:: жетинпутсизеинфо**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputsizeinfo) или [**Имедиаобжект:: жетаутпутсизеинфо**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputsizeinfo) . Эти методы возвращают следующие сведения:

-   Минимальный размер буфера в байтах.
-   Требования к выравниванию, если таковые имеются. Если начальный адрес кратен определенному целому числу, буфер будет согласован.
-   максимальный объем данных, который будет храниться DMO для просмотра вперед. Это число применяется только к входным потокам. для некоторых типов данных (например, кодирования MPEG) DMO может потребоваться искать в потоке вперед. значение "просмотр вперед" указывает, сколько входных данных будет требовать DMO, прежде чем он сможет создать выходные данные.

Клиент должен выделить буферы, соответствующие этим требованиям. кроме того, DMO могут иметь требования о том, как клиент упаковывает входные данные. например, DMO может потребовать, чтобы каждый буфер содержал только один образец (или видеокадр). Чтобы определить эти требования, вызовите метод [**имедиаобжект:: жетинпутстреаминфо**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstreaminfo) . Метод [**имедиаобжект:: жетаутпутстреаминфо**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputstreaminfo) возвращает аналогичные сведения о потоке вывода.

В модели потоковой передачи по умолчанию клиент не передает необработанные указатели буфера в DMO. Вместо этого он использует упрощенный COM-объект, который предоставляет интерфейс [**имедиабуффер**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediabuffer) . Интерфейс **имедиабуффер** выступает в качестве обертки COM для блока памяти. Так как это COM-объект, он поддерживает подсчет ссылок, что позволяет гарантировать, что буферы не освобождаются, пока все еще используются.

> [!Note]  
> Интерфейс **имедиабуффер** обслуживает функцию, аналогичную интерфейсу **имедиасампле** в DirectShow.

 

Клиент должен реализовать объект **имедиабуффер** . Дополнительные сведения см. в разделе [Реализация имедиабуффер](implementing-imediabuffer.md).

**Обработка данных**

Для обработки данных выполните следующие действия.

1.  Для каждого входного потока заполните буфер входными данными.
2.  Вызовите [**имедиаобжект::P роцессинпут**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processinput) для доставки каждого буфера.
3.  Вызовите [**имедиаобжект::P роцессаутпут**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processoutput) , чтобы обработать данные. Этот метод принимает массив буферов, по одному для каждого потока вывода.
4.  Повторяйте до тех пор, пока не будет больше входных данных.

Метод **ProcessInput** принимает входные данные для одного потока за раз. обычно метод возвращает значение немедленно, а DMO содержит счетчик ссылок на объект **имедиабуффер** . Он освобождает объект после обработки всех данных в буфере или при очистке приложением DMO. не используйте буфер повторно, пока он не будет освобожден DMO. Чтобы определить, может ли входной поток принимать больше данных, вызовите метод [**имедиаобжект:: жетинпутстатус**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstatus) . этот метод возвращает значение \_ \_ флага DMO INPUT статусф \_ ACCEPT \_ DATA, если поток может принимать больше входных данных.

Метод **ProcessOutput** создает выходные данные для всех потоков вывода за один раз. приложение передает массив [**DMOных структур \_ \_ \_ буфера выходных данных**](/previous-versions/windows/desktop/api/Mediaobj/ns-mediaobj-dmo_output_data_buffer) , по одному для каждого потока вывода. Каждая структура в массиве имеет указатель на объект **имедиабуффер** . DMO записывает как объем выходных данных, которые могут быть помещены в буфер. Он также устанавливает различные флаги для сообщения о состоянии операции. \_ \_ \_ \_ флаг неполного буфферф выходных данных указывает, что DMO может выдать больше выходных данных из существующих входов. DMO В этом случае клиент может вызвать **ProcessOutput** еще раз. В противном случае он должен вызывать **ProcessInput** с дополнительными входными данными. DMO никогда не изменяет данные во входных буферах; Он выполняет запись только в выходные буферы.

После доставки всех данных во входной поток вызовите метод [**имедиаобжект::D методом непрерывности**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-discontinuity) . DMO не принимает дальнейшие входные данные в этот поток, пока не будет выполнена обработка оставшихся выходных данных (или очистка DMO).

в любой момент после начала потоковой передачи DMO может получать входные или выдавать выходные данные или и то, и другое. таким образом, либо **жетинпутстатус** возвращает DMO \_ входные \_ статусф \_ принимать \_ данные, либо **ProcessOutput** возвращает DMO \_ выходным \_ данным, \_ буфферф \_ неполными. Приложение хранит данные, проверяя эти флаги и вызывая метод **ProcessInput** или **ProcessOutput** соответственно. Чтобы прервать поток данных, вызовите метод [**имедиаобжект:: Flush**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-flush) . этот метод приводит к тому, что DMO удаляет все буферы, которые он удерживает внутренне.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Непосредственное размещение DMO](directly-hosting-a-dmo.md)
</dt> <dt>

[Обработка на месте](in-place-processing.md)
</dt> </dl>

 

 



