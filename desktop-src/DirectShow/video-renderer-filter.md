---
description: Фильтр модуля подготовки отчетов видео
ms.assetid: 7719ed9d-e3b9-4c84-b587-4e120b5cabf8
title: Фильтр модуля подготовки отчетов видео
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5ca3becb4fbdbb52a9968481aade07d14d963828
ms.sourcegitcommit: 63753fcfb0afbbe5ec283fb8316e62c2dc950f66
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2021
ms.locfileid: "107908422"
---
# <a name="video-renderer-filter"></a><span data-ttu-id="a7276-103">Фильтр модуля подготовки отчетов видео</span><span class="sxs-lookup"><span data-stu-id="a7276-103">Video Renderer Filter</span></span>

<span data-ttu-id="a7276-104">Фильтр модуля подготовки отчетов видео является надежным модулем подготовки видео, предназначенным для всех целей.</span><span class="sxs-lookup"><span data-stu-id="a7276-104">The Video Renderer filter is a robust, all-purpose video renderer.</span></span>

> [!Note]  
> <span data-ttu-id="a7276-105">В Windows XP и более поздних версиях модулем подготовки видео по умолчанию является [Фильтр модуля подготовки видео "Микширование 7](video-mixing-renderer-filter-7.md) " (VMR-7).</span><span class="sxs-lookup"><span data-stu-id="a7276-105">On Windows XP and later, the default video renderer is the [Video Mixing Renderer Filter 7](video-mixing-renderer-filter-7.md) (VMR-7).</span></span> <span data-ttu-id="a7276-106">Фильтр VMR-7 и модуль подготовки видео имеют понятное имя "модуль подготовки видео".</span><span class="sxs-lookup"><span data-stu-id="a7276-106">The VMR-7 and the Video Renderer both have the friendly name "Video Renderer."</span></span> <span data-ttu-id="a7276-107">На более ранних платформах модуль подготовки видео является модулем подготовки отчетов по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="a7276-107">On earlier platforms, the Video Renderer is the default renderer.</span></span> <span data-ttu-id="a7276-108">См. раздел [Выбор правильного модуля подготовки](choosing-the-right-renderer.md)отчетов.</span><span class="sxs-lookup"><span data-stu-id="a7276-108">See [Choosing the Right Renderer](choosing-the-right-renderer.md).</span></span>

 

<span data-ttu-id="a7276-109">Модуль подготовки видео использует поверхности DirectDraw и оверлея, если видеоадаптер поддерживает их.</span><span class="sxs-lookup"><span data-stu-id="a7276-109">The Video Renderer uses DirectDraw and overlay surfaces, if the video card supports them.</span></span> <span data-ttu-id="a7276-110">Диспетчер графов фильтров предоставляет интерфейс [**ивидеовиндов**](/windows/desktop/api/Control/nn-control-ivideowindow) , который позволяет приложениям устанавливать и извлекать свойства модуля подготовки видео.</span><span class="sxs-lookup"><span data-stu-id="a7276-110">The Filter Graph Manager exposes the [**IVideoWindow**](/windows/desktop/api/Control/nn-control-ivideowindow) interface, which enables applications to set and retrieve properties on the Video Renderer.</span></span> <span data-ttu-id="a7276-111">При использовании новых видеоадаптеров модуль подготовки отчетов поддерживает полноэкранную отрисовку.</span><span class="sxs-lookup"><span data-stu-id="a7276-111">With newer video cards, the Video Renderer supports full-screen rendering.</span></span> <span data-ttu-id="a7276-112">В противном случае диспетчер графов фильтров автоматически переключается на [полноэкранный](full-screen-renderer-filter.md) фильтр модуля подготовки отчетов в полноэкранном режиме.</span><span class="sxs-lookup"><span data-stu-id="a7276-112">Otherwise, the Filter Graph Manager automatically switches to the [Full Screen Renderer](full-screen-renderer-filter.md) filter for full-screen mode.</span></span> <span data-ttu-id="a7276-113">Дополнительные сведения см. в разделе [**ивидеовиндов::p UT \_ фуллскринмоде**](/windows/desktop/api/Control/nf-control-ivideowindow-put_fullscreenmode) .</span><span class="sxs-lookup"><span data-stu-id="a7276-113">See [**IVideoWindow::put\_FullScreenMode**](/windows/desktop/api/Control/nf-control-ivideowindow-put_fullscreenmode) for more information.</span></span>

-   <span data-ttu-id="a7276-114">\[! Существенно\]</span><span class="sxs-lookup"><span data-stu-id="a7276-114">\[!Important\]</span></span>  
    > <span data-ttu-id="a7276-115">Как правило, окно видео этого фильтра обрабатывает сообщения в рабочем потоке, созданном диспетчером графа фильтров.</span><span class="sxs-lookup"><span data-stu-id="a7276-115">Normally, this filter's video window processes messages on a worker thread created by the Filter Graph Manager.</span></span> <span data-ttu-id="a7276-116">Однако. Если приложение непосредственно создает фильтр с помощью **CoCreateInstance**, окно видео обрабатывает сообщения в потоке приложения.</span><span class="sxs-lookup"><span data-stu-id="a7276-116">Howerver, if an application directly creates the filter using **CoCreateInstance**, the video window processes messages on the application thread.</span></span> <span data-ttu-id="a7276-117">В этом случае поток приложения должен иметь цикл обработки сообщений для отправки сообщений в окно видео.</span><span class="sxs-lookup"><span data-stu-id="a7276-117">In that case, the application thread must have a message loop, to dispatch messages to the video window.</span></span> <span data-ttu-id="a7276-118">Кроме того, поток не должен завершать работу до завершения окончательного вызова **выпуска** для модуля подготовки видео, который происходит при завершении работы диспетчера графа фильтра.</span><span class="sxs-lookup"><span data-stu-id="a7276-118">Also, the thread must not exit until the final **Release** call to the Video Renderer, which occurs when the Filter Graph Manager shuts down.</span></span> <span data-ttu-id="a7276-119">В противном случае приложение может привести к взаимоблокировке.</span><span class="sxs-lookup"><span data-stu-id="a7276-119">Otherwise, the application might deadlock.</span></span>

     



| <span data-ttu-id="a7276-120">Метка</span><span class="sxs-lookup"><span data-stu-id="a7276-120">Label</span></span> | <span data-ttu-id="a7276-121">Значение</span><span class="sxs-lookup"><span data-stu-id="a7276-121">Value</span></span> |
|------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="a7276-122">Интерфейсы фильтра</span><span class="sxs-lookup"><span data-stu-id="a7276-122">Filter Interfaces</span></span>                        | <span data-ttu-id="a7276-123">[**Ибасефилтер**](/windows/desktop/api/Strmif/nn-strmif-ibasefilter), [**ибасиквидео**](/windows/desktop/api/Control/nn-control-ibasicvideo), [**IBasicVideo2**](/windows/desktop/api/Control/nn-control-ibasicvideo2), [**идиректдраввидео**](/previous-versions/windows/desktop/api/Amvideo/nn-amvideo-idirectdrawvideo), [**икспропертисет**](ikspropertyset.md), [**имедиапоситион**](/windows/desktop/api/Control/nn-control-imediaposition), [**имедиасикинг**](/windows/desktop/api/Strmif/nn-strmif-imediaseeking), [**IQualityControl**](/windows/desktop/api/Strmif/nn-strmif-iqualitycontrol), [**IQualProp**](/previous-versions/windows/desktop/api/Amvideo/nn-amvideo-iqualprop), [**IVideoWindow**](/windows/desktop/api/Control/nn-control-ivideowindow)</span><span class="sxs-lookup"><span data-stu-id="a7276-123">[**IBaseFilter**](/windows/desktop/api/Strmif/nn-strmif-ibasefilter), [**IBasicVideo**](/windows/desktop/api/Control/nn-control-ibasicvideo), [**IBasicVideo2**](/windows/desktop/api/Control/nn-control-ibasicvideo2), [**IDirectDrawVideo**](/previous-versions/windows/desktop/api/Amvideo/nn-amvideo-idirectdrawvideo), [**IKsPropertySet**](ikspropertyset.md), [**IMediaPosition**](/windows/desktop/api/Control/nn-control-imediaposition), [**IMediaSeeking**](/windows/desktop/api/Strmif/nn-strmif-imediaseeking), [**IQualityControl**](/windows/desktop/api/Strmif/nn-strmif-iqualitycontrol), [**IQualProp**](/previous-versions/windows/desktop/api/Amvideo/nn-amvideo-iqualprop), [**IVideoWindow**](/windows/desktop/api/Control/nn-control-ivideowindow)</span></span> |
| <span data-ttu-id="a7276-124">Типы носителей входных закрепления</span><span class="sxs-lookup"><span data-stu-id="a7276-124">Input Pin Media Types</span></span>                    | <span data-ttu-id="a7276-125">Форматы видео без сжатия.</span><span class="sxs-lookup"><span data-stu-id="a7276-125">Uncompressed video formats.</span></span>                                                                                                                                                                                                                                                                                                                                                                              |
| <span data-ttu-id="a7276-126">Интерфейсы входных закрепления</span><span class="sxs-lookup"><span data-stu-id="a7276-126">Input Pin Interfaces</span></span>                     | <span data-ttu-id="a7276-127">[**Имеминпутпин**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin), [**иоверлай**](/windows/desktop/api/Strmif/nn-strmif-ioverlay), [**Ипин**](/windows/desktop/api/Strmif/nn-strmif-ipin), [**ипинконнектион**](/windows/desktop/api/Strmif/nn-strmif-ipinconnection), [**икуалитиконтрол**](/windows/desktop/api/Strmif/nn-strmif-iqualitycontrol)</span><span class="sxs-lookup"><span data-stu-id="a7276-127">[**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin), [**IOverlay**](/windows/desktop/api/Strmif/nn-strmif-ioverlay), [**IPin**](/windows/desktop/api/Strmif/nn-strmif-ipin), [**IPinConnection**](/windows/desktop/api/Strmif/nn-strmif-ipinconnection), [**IQualityControl**](/windows/desktop/api/Strmif/nn-strmif-iqualitycontrol)</span></span>                                                                                                                                                                                                                           |
| <span data-ttu-id="a7276-128">Типы носителей для выходного ПИН-кода</span><span class="sxs-lookup"><span data-stu-id="a7276-128">Output Pin Media Types</span></span>                   | <span data-ttu-id="a7276-129">Не применяется</span><span class="sxs-lookup"><span data-stu-id="a7276-129">Not applicable.</span></span>                                                                                                                                                                                                                                                                                                                                                                                          |
| <span data-ttu-id="a7276-130">Интерфейсы выходного ПИН-кода</span><span class="sxs-lookup"><span data-stu-id="a7276-130">Output Pin Interfaces</span></span>                    | <span data-ttu-id="a7276-131">Не применяется</span><span class="sxs-lookup"><span data-stu-id="a7276-131">Not applicable.</span></span>                                                                                                                                                                                                                                                                                                                                                                                          |
| <span data-ttu-id="a7276-132">Фильтровать CLSID</span><span class="sxs-lookup"><span data-stu-id="a7276-132">Filter CLSID</span></span>                             | <span data-ttu-id="a7276-133">\_ВИДЕОРЕНДЕРЕР CLSID</span><span class="sxs-lookup"><span data-stu-id="a7276-133">CLSID\_VideoRenderer</span></span>                                                                                                                                                                                                                                                                                                                                                                                     |
| <span data-ttu-id="a7276-134">CLSID страницы свойств</span><span class="sxs-lookup"><span data-stu-id="a7276-134">Property Page CLSID</span></span>                      | <span data-ttu-id="a7276-135">Нет страницы свойств.</span><span class="sxs-lookup"><span data-stu-id="a7276-135">No property page.</span></span>                                                                                                                                                                                                                                                                                                                                                                                        |
| <span data-ttu-id="a7276-136">Исполняемый объект</span><span class="sxs-lookup"><span data-stu-id="a7276-136">Executable</span></span>                               | <span data-ttu-id="a7276-137">quartz.dll</span><span class="sxs-lookup"><span data-stu-id="a7276-137">quartz.dll</span></span>                                                                                                                                                                                                                                                                                                                                                                                               |
| [<span data-ttu-id="a7276-138">Заслуживают</span><span class="sxs-lookup"><span data-stu-id="a7276-138">Merit</span></span>](merit.md)                       | <span data-ttu-id="a7276-139">Windows XP и более поздние версии: **\_ маловероятно**</span><span class="sxs-lookup"><span data-stu-id="a7276-139">Windows XP and later: **MERIT\_UNLIKELY**</span></span>                                                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="a7276-140">Категория фильтра</span><span class="sxs-lookup"><span data-stu-id="a7276-140">Filter Category</span></span>](filter-categories.md) | <span data-ttu-id="a7276-141">**\_ЛЕГАЦИАМФИЛТЕРКАТЕГОРИ CLSID**</span><span class="sxs-lookup"><span data-stu-id="a7276-141">**CLSID\_LegacyAmFilterCategory**</span></span>                                                                                                                                                                                                                                                                                                                                                                        |



 

## <a name="remarks"></a><span data-ttu-id="a7276-142">Комментарии</span><span class="sxs-lookup"><span data-stu-id="a7276-142">Remarks</span></span>

<span data-ttu-id="a7276-143">В отладочной версии Quartz.dll, если \_ уровень отладки трассировки журнала равен 5 или выше, модуль подготовки отчетов отображает штампы времени каждого кадра в окне видео.</span><span class="sxs-lookup"><span data-stu-id="a7276-143">In the debug version of Quartz.dll, if the LOG\_TRACE debug level is set to 5 or higher, the Video Renderer displays each frame's time stamps on the video window.</span></span> <span data-ttu-id="a7276-144">Эти номера не отображаются в розничной версии библиотеки DLL.</span><span class="sxs-lookup"><span data-stu-id="a7276-144">These numbers do not appear in the retail version of the DLL.</span></span> <span data-ttu-id="a7276-145">Дополнительные сведения см. в разделе [отладочные функции вывода](debug-output-functions.md).</span><span class="sxs-lookup"><span data-stu-id="a7276-145">For more information, see [Debug Output Functions](debug-output-functions.md).</span></span>

<span data-ttu-id="a7276-146">Следующие примечания предназначены для разработчиков фильтров:</span><span class="sxs-lookup"><span data-stu-id="a7276-146">The following remarks are intended for filter developers:</span></span>

<span data-ttu-id="a7276-147">Модуль подготовки видео принимает форматы YUV, если видеоадаптер поддерживает поверхности наложения YUV.</span><span class="sxs-lookup"><span data-stu-id="a7276-147">The Video Renderer accepts YUV formats if the video graphics card supports YUV overlay surfaces.</span></span> <span data-ttu-id="a7276-148">Однако при первом подключении к вышестоящему фильтру для модуля подготовки видео требуется формат RGB, соответствующий глубине цвета текущих параметров монитора.</span><span class="sxs-lookup"><span data-stu-id="a7276-148">When it first connects to the upstream filter, however, the Video Renderer requires an RGB format that matches the color depth of the current monitor settings.</span></span> <span data-ttu-id="a7276-149">Например, если текущим параметром дисплея является 24-разрядный цвет, то вышестоящий фильтр должен иметь возможность предоставлять 24-битное видео RGB.</span><span class="sxs-lookup"><span data-stu-id="a7276-149">For example, if the current display setting is 24-bit color, the upstream filter must be able to provide 24-bit RGB video.</span></span> <span data-ttu-id="a7276-150">Когда граф фильтра переключается в состояние которых запущены, модуль подготовки видео согласовывает динамическое изменение формата с соответствующим цветовым пространством YUV.</span><span class="sxs-lookup"><span data-stu-id="a7276-150">When the filter graph switches to a runing state, the Video Renderer negotiates a dynamic format change to the appropriate YUV color space.</span></span>

<span data-ttu-id="a7276-151">При соединении с типом RGB модуль подготовки видео гарантирует, что он сможет использовать GDI в случае, если DirectDraw недоступен.</span><span class="sxs-lookup"><span data-stu-id="a7276-151">By connecting with an RGB type, the Video Renderer ensures that it can use GDI in case DirectDraw is not available.</span></span> <span data-ttu-id="a7276-152">Он переключается на GDI, если другое приложение использует видеопамять, если прямоугольник видео размещает два монитора в системе с несколькими мониторами или если прямоугольник видео полностью скрыт другим окном.</span><span class="sxs-lookup"><span data-stu-id="a7276-152">It will switch to GDI if another application is using the video memory, if the video rectangle straddles two monitors on a multi-monitor system, or if the video rectangle is completely obscured by another window.</span></span>

> [!Note]  
> <span data-ttu-id="a7276-153">Модуль подготовки видео не выполняет этот тип изменения динамического формата и не требует типа мультимедиа RGB, так как он никогда не использует GDI для отрисовки.</span><span class="sxs-lookup"><span data-stu-id="a7276-153">The Video Mixing Renderer does not perform this type of dynamic format change, and does not require an RGB media type, because it never uses GDI for rendering.</span></span>

 

<span data-ttu-id="a7276-154">Для согласования изменения формата модуль подготовки видео вызывает [**Ипин:: куерякцепт**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) с новым типом носителя.</span><span class="sxs-lookup"><span data-stu-id="a7276-154">To negotiate a format change, the Video Renderer calls [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) with the new media type.</span></span> <span data-ttu-id="a7276-155">Если вышестоящий фильтр возвращает значение \_ ОК, модуль подготовки отчетов присоединяет новый носитель к следующему примеру.</span><span class="sxs-lookup"><span data-stu-id="a7276-155">If the upstream filter returns S\_OK, the Video Renderer attaches the new media to the next sample.</span></span> <span data-ttu-id="a7276-156">Вышестоящий фильтр должен вызвать [**имедиасампле:: жетмедиатипе**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) для каждого образца.</span><span class="sxs-lookup"><span data-stu-id="a7276-156">The upstream filter should call [**IMediaSample::GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) on each sample.</span></span> <span data-ttu-id="a7276-157">Если **жетмедиатипе** возвращает значение, отличное от **null** , оно указывает на изменение формата, а вышестоящий фильтр — на переключение типов вывода.</span><span class="sxs-lookup"><span data-stu-id="a7276-157">If **GetMediaType** returns a non-**NULL** value, it indicates a format change, and the upstream filter should respond by switching output types.</span></span> <span data-ttu-id="a7276-158">(Не переключайте типы в метод **куерякцепт** .) Вышестоящий фильтр должен принимать по крайней мере основные типы RGB, и в идеале он должен поддерживать общие типы YUV.</span><span class="sxs-lookup"><span data-stu-id="a7276-158">(Do not switch types in the **QueryAccept** method.) The upstream filter should accept at least the major RGB types, and ideally should support the common YUV types.</span></span> <span data-ttu-id="a7276-159">Во время потоковой передачи модуль подготовки видео может переключаться между типами YUV и RGB любое количество раз.</span><span class="sxs-lookup"><span data-stu-id="a7276-159">During streaming, the Video Renderer might switch back and forth between YUV and RGB types any number of times.</span></span> <span data-ttu-id="a7276-160">Модуль подготовки видео не принимает изменения динамического формата, инициированные вышестоящим фильтром.</span><span class="sxs-lookup"><span data-stu-id="a7276-160">The Video Renderer does not accept dynamic format changes initiated by the upstream filter.</span></span>

<span data-ttu-id="a7276-161">Когда модуль обработки видео рисуется на поверхности наложения DirectDraw, он выделяет один буфер для входного ПИН-кода.</span><span class="sxs-lookup"><span data-stu-id="a7276-161">When the Video Renderer draws to a DirectDraw overlay surface, it allocates a single buffer for its input pin.</span></span> <span data-ttu-id="a7276-162">Если вышестоящий фильтр пытается принудительно установить соединение с помощью нескольких буферов, модуль подготовки видео не сможет использовать область наложения.</span><span class="sxs-lookup"><span data-stu-id="a7276-162">If the upstream filter attempts to force a connection using multiple buffers, the Video Renderer will be unable to use the overlay surface.</span></span>

## <a name="related-topics"></a><span data-ttu-id="a7276-163">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="a7276-163">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a7276-164">Фильтры DirectShow</span><span class="sxs-lookup"><span data-stu-id="a7276-164">DirectShow Filters</span></span>](directshow-filters.md)
</dt> </dl>

 

 



