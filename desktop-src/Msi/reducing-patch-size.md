---
description: Начиная с версии установщик Windows 3,0, авторы исправлений могут использовать базовый план продукта, кэшированный установщиком, для более простого обслуживания приложений с меньшими разностными исправлениями.
ms.assetid: ab5b193d-79ce-4ed4-af53-89a4197197c1
title: Уменьшение размера исправления
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4fa365e831ab8685073347dc254bac58269135f1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673670"
---
# <a name="reducing-patch-size"></a><span data-ttu-id="6fb23-103">Уменьшение размера исправления</span><span class="sxs-lookup"><span data-stu-id="6fb23-103">Reducing Patch Size</span></span>

<span data-ttu-id="6fb23-104">Начиная с версии установщик Windows 3,0, авторы исправлений могут использовать базовый план продукта, кэшированный установщиком, для более простого обслуживания приложений с меньшими разностными исправлениями.</span><span class="sxs-lookup"><span data-stu-id="6fb23-104">Beginning with Windows Installer version 3.0, patch authors can use the product baseline cached by the installer to more easily service applications with smaller delta patches.</span></span> <span data-ttu-id="6fb23-105">Во многих случаях [*разностное обновление*](d-gly.md) , которое доставляет сведения об обслуживании в приложение, может быть значительно меньше, чем полное обновление или пакет установки, доставляющие одну и ту же информацию.</span><span class="sxs-lookup"><span data-stu-id="6fb23-105">In many cases, a [*delta patch*](d-gly.md) that delivers servicing information to an application can be significantly smaller than a full-file patch or installation package that delivers the same information.</span></span>

<span data-ttu-id="6fb23-106">**Установщик Windows 2,0:** Не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="6fb23-106">**Windows Installer 2.0:** Not supported.</span></span> <span data-ttu-id="6fb23-107">Начиная с установщик Windows 3,0, установщик выборочно сохраняет базовые сведения о файлах при их обновлении.</span><span class="sxs-lookup"><span data-stu-id="6fb23-107">Beginning with Windows Installer 3.0, the installer selectively saves baseline information about files when they are updated.</span></span>

<span data-ttu-id="6fb23-108">Установщик Windows предоставляет три метода для обновления и обслуживания приложений: [небольшие обновления](small-updates.md), [незначительные](minor-upgrades.md)обновления и [основные обновления](major-upgrades.md).</span><span class="sxs-lookup"><span data-stu-id="6fb23-108">Windows Installer provides three methods for updating and servicing applications: [small updates](small-updates.md), [minor upgrades](minor-upgrades.md), and [major upgrades](major-upgrades.md).</span></span> <span data-ttu-id="6fb23-109">Небольшое обновление также называется обновлением с исправлением QFE, а дополнительное обновление также называется обновлением пакета обновления (SP).</span><span class="sxs-lookup"><span data-stu-id="6fb23-109">A small update is also referred to as a quick fix engineering (QFE) update, and a minor upgrade is also referred to as a service pack (SP) update.</span></span> <span data-ttu-id="6fb23-110">Типичное крупное обновление удаляет предыдущее приложение и устанавливает новое приложение.</span><span class="sxs-lookup"><span data-stu-id="6fb23-110">A typical major upgrade removes a previous application and installs a new application.</span></span> <span data-ttu-id="6fb23-111">Установщик Windows может доставлять данные обслуживания в приложения в виде [установочного пакета](installation-package.md) (MSI-файла) или [пакета исправлений](patch-packages.md) (MSP-файл).</span><span class="sxs-lookup"><span data-stu-id="6fb23-111">Windows Installer can deliver servicing information to applications as an [installation package](installation-package.md) (.msi file) or as a [patch package](patch-packages.md) (.msp file).</span></span>

<span data-ttu-id="6fb23-112">Пакет исправлений установщик Windows, который доставляет сведения об обслуживании для небольшого или незначительного обновления, обычно намного меньше, чем эквивалентный пакет установки, доставляющий те же сведения об обслуживании.</span><span class="sxs-lookup"><span data-stu-id="6fb23-112">A Windows Installer patch package that delivers servicing information for a small update or minor upgrade is generally much smaller than the equivalent installation package that delivers the same servicing information.</span></span> <span data-ttu-id="6fb23-113">Рекомендуется использовать пакеты исправлений для распространения небольших и незначительных обновлений.</span><span class="sxs-lookup"><span data-stu-id="6fb23-113">It is recommended that patch packages be used for the distribution of small and minor upgrades.</span></span> <span data-ttu-id="6fb23-114">Рекомендуется использовать установочный пакет для распространения крупного обновления.</span><span class="sxs-lookup"><span data-stu-id="6fb23-114">It is recommended that an installation package be used for the distribution of a major upgrade.</span></span>

<span data-ttu-id="6fb23-115">Установщик Windows исправления (MSP-файлы) могут создаваться либо из полных файлов, либо из-за различий в файлах (также называемых разностными файлами). Установщик Windowsное исправление, созданное на основе различий файлов, может быть намного меньше, чем соответствующее обновление полного файла.</span><span class="sxs-lookup"><span data-stu-id="6fb23-115">Windows Installer patches (.msp files) can be generated from either full files or from file differences (also called file deltas.) A Windows Installer patch generated from file deltas can be much smaller than the equivalent full-file patch.</span></span> <span data-ttu-id="6fb23-116">Все версии установщик Windows могут использовать как исправления полных файлов, так и разностные исправления.</span><span class="sxs-lookup"><span data-stu-id="6fb23-116">All versions of the Windows Installer can use both full-file patches or delta patches.</span></span>

<span data-ttu-id="6fb23-117">Начиная с версии установщик Windows 3,0 установщик выборочно сохраняет базовые сведения о файлах при их обновлении.</span><span class="sxs-lookup"><span data-stu-id="6fb23-117">Beginning with Windows Installer version 3.0, the installer selectively saves baseline information about files when they are updated.</span></span> <span data-ttu-id="6fb23-118">Сведения о первоначальном базовом приложении (RTM-версии) и последнем незначительном обновлении (пакет обновления) сохраняются в частном расположении при установке приложения или при получении незначительного обновления.</span><span class="sxs-lookup"><span data-stu-id="6fb23-118">Information about the original base application (the RTM version) and the most recent minor upgrade (service pack) are saved in a private location when the application is installed or receives a minor upgrade.</span></span>

<span data-ttu-id="6fb23-119">Для минимального размера базового кэша Установщик выполняет следующие действия.</span><span class="sxs-lookup"><span data-stu-id="6fb23-119">The installer does the following to minimize the size of the baseline cache:</span></span>

-   <span data-ttu-id="6fb23-120">Для каждого приложения поддерживается не более двух базовых планов: базовый план первоначально выпущенного файла (RTM) и базовый план файла в самом последнем незначительном обновлении (пакет обновления).</span><span class="sxs-lookup"><span data-stu-id="6fb23-120">No more than two baselines are maintained for each application: a baseline of the file as originally released (RTM) and a baseline of the file at the most recent minor upgrade (service pack.)</span></span>
-   <span data-ttu-id="6fb23-121">Файл не добавляется в кэш, пока не будет исправлен.</span><span class="sxs-lookup"><span data-stu-id="6fb23-121">A file is not added to the cache until it is patched.</span></span> <span data-ttu-id="6fb23-122">Базовый кэш — это копирование при записи.</span><span class="sxs-lookup"><span data-stu-id="6fb23-122">The baseline cache is copy-on-write.</span></span>
-   <span data-ttu-id="6fb23-123">Если приложение никогда не обновлялось, в базовом кэше нет файлов.</span><span class="sxs-lookup"><span data-stu-id="6fb23-123">If the application has never been updated, there are no files in the baseline cache.</span></span>
-   <span data-ttu-id="6fb23-124">Если последнее обслуживание приложения было незначительным (пакет обновления), приложение находится на базовом уровне и на компьютере может присутствовать не более двух копий файла.</span><span class="sxs-lookup"><span data-stu-id="6fb23-124">When the application's last servicing was a minor upgrade (service pack) the application is at a baseline level and at most two copies of a file can be present on the computer.</span></span> <span data-ttu-id="6fb23-125">Одна копия файла находится в целевом каталоге установки.</span><span class="sxs-lookup"><span data-stu-id="6fb23-125">One copy of the file is in the target directory of the installation.</span></span> <span data-ttu-id="6fb23-126">Другая копия может находиться в базовом кэше RTM.</span><span class="sxs-lookup"><span data-stu-id="6fb23-126">The other copy can be in the RTM baseline cache.</span></span>
-   <span data-ttu-id="6fb23-127">Если последнее обслуживание приложения было небольшим обновлением (QFE), приложение не находится на базовом уровне и на компьютере может присутствовать не более трех копий файла.</span><span class="sxs-lookup"><span data-stu-id="6fb23-127">When the application's last servicing was a small update (QFE) the application is not at a baseline level and at most three copies of a file can be present on the computer.</span></span> <span data-ttu-id="6fb23-128">Первая копия файла находится в целевом каталоге установки.</span><span class="sxs-lookup"><span data-stu-id="6fb23-128">The first copy of the file is in the target directory of the installation.</span></span> <span data-ttu-id="6fb23-129">Вторая копия файла находится в базовом кэше RTM.</span><span class="sxs-lookup"><span data-stu-id="6fb23-129">The second copy of the file is in the RTM baseline cache.</span></span> <span data-ttu-id="6fb23-130">Последняя копия файла находится в самом последнем базовом кэше.</span><span class="sxs-lookup"><span data-stu-id="6fb23-130">The last copy of the file is in the most recent baseline cache.</span></span>
-   <span data-ttu-id="6fb23-131">Базовый кэш приложения удаляется при удалении продукта.</span><span class="sxs-lookup"><span data-stu-id="6fb23-131">The application's baseline cache is removed when the product is uninstalled.</span></span>

<span data-ttu-id="6fb23-132">Начиная с версии установщик Windows 3,0, установщик может использовать базовый кэш при применении исправлений к приложению.</span><span class="sxs-lookup"><span data-stu-id="6fb23-132">Beginning with Windows Installer version 3.0, the installer can use the baseline cache when patches are applied to the application.</span></span> <span data-ttu-id="6fb23-133">Базовые сведения можно использовать для применения разностного исправления или для возврата файла к предыдущей версии во время удаления исправления.</span><span class="sxs-lookup"><span data-stu-id="6fb23-133">The baseline information can be used to apply a delta patch or to revert a file to a previous version during a patch uninstall.</span></span> <span data-ttu-id="6fb23-134">Это позволяет авторам исправлений использовать преимущества небольших разностных исправлений.</span><span class="sxs-lookup"><span data-stu-id="6fb23-134">This can enable patch authors to benefit from smaller delta patches.</span></span> <span data-ttu-id="6fb23-135">Если установщик обнаруживает, что разностное обновление не может быть применено к целевому файлу, установщик может попытаться использовать файл, сохраненный в базовом кэше, в качестве отправной точки.</span><span class="sxs-lookup"><span data-stu-id="6fb23-135">If the installer finds that the delta patch cannot be applied to the target file, the installer can attempt to use a file saved in the baseline cache as a starting point.</span></span> <span data-ttu-id="6fb23-136">Установщик выполняет запрос только к исходному источнику установки только после того, как попытаться все возможности в кэше.</span><span class="sxs-lookup"><span data-stu-id="6fb23-136">The installer only resorts to requesting the original installation source after trying all the possibilities in the cache.</span></span>

<span data-ttu-id="6fb23-137">Соблюдение следующих рекомендаций может помочь авторам исправлений использовать исправления установщик Windows версии 3,0 и базовый кэш для создания меньших разностных исправлений:</span><span class="sxs-lookup"><span data-stu-id="6fb23-137">Adherence to the following guidelines can help patch authors use Windows Installer version 3.0 patches and the baseline cache to create smaller delta patches:</span></span>

-   <span data-ttu-id="6fb23-138">Исправления автора, включающие [таблицу мсипатчсекуенце](msipatchsequence-table.md).</span><span class="sxs-lookup"><span data-stu-id="6fb23-138">Author patches that include the [MsiPatchSequence table](msipatchsequence-table.md).</span></span> <span data-ttu-id="6fb23-139">Эта таблица необходима для использования базового кэша и доступна начиная с версии установщик Windows 3,0.</span><span class="sxs-lookup"><span data-stu-id="6fb23-139">This table is required to use the baseline cache and is available beginning with Windows Installer version 3.0.</span></span>
-   <span data-ttu-id="6fb23-140">Не устанавливайте политику, запрещающую базовое кэширование.</span><span class="sxs-lookup"><span data-stu-id="6fb23-140">Do not set policy that prevents baseline caching.</span></span> <span data-ttu-id="6fb23-141">Значение политики [макспатчкачесизе](maxpatchcachesize.md) указывает максимальный процент дискового пространства, который можно использовать.</span><span class="sxs-lookup"><span data-stu-id="6fb23-141">The value of the [MaxPatchCacheSize](maxpatchcachesize.md) policy specifies the maximum percentage of disk space that can be used.</span></span> <span data-ttu-id="6fb23-142">Если для политики Макспатчкачесизе задано значение 0, в базовом кэше не сохраняются никакие дополнительные файлы.</span><span class="sxs-lookup"><span data-stu-id="6fb23-142">If the MaxPatchCacheSize policy is set to 0, no additional files are saved in the baseline cache.</span></span> <span data-ttu-id="6fb23-143">Если политика не задана, по умолчанию можно использовать не более 10% места на диске.</span><span class="sxs-lookup"><span data-stu-id="6fb23-143">If the policy is not set, the default is that a maximum of 10% of the disk space can be used.</span></span> <span data-ttu-id="6fb23-144">Если общий размер кэша достигает максимального процента дискового пространства, дополнительные файлы не сохраняются.</span><span class="sxs-lookup"><span data-stu-id="6fb23-144">If the total size of the cache reaches the maximum percentage of disk space, no additional files are saved.</span></span> <span data-ttu-id="6fb23-145">Политика не влияет на уже сохраненные файлы.</span><span class="sxs-lookup"><span data-stu-id="6fb23-145">The policy does not affect files that have already been saved.</span></span> <span data-ttu-id="6fb23-146">Даже если кэширование отключено, установщик может использовать существующие базовые кэши продукта.</span><span class="sxs-lookup"><span data-stu-id="6fb23-146">Even when caching is disabled, the installer can use existing product baseline caches.</span></span>
-   <span data-ttu-id="6fb23-147">Если первое примененное исправление включает [таблицу мсипатчсекуенце](msipatchsequence-table.md), для приложения включено кэширование.</span><span class="sxs-lookup"><span data-stu-id="6fb23-147">If the first patch applied includes the [MsiPatchSequence table](msipatchsequence-table.md), caching is enabled for the application.</span></span>
-   <span data-ttu-id="6fb23-148">Если какое-либо обновление в транзакции обслуживания не включает [таблицу мсипатчсекуенце](msipatchsequence-table.md), кэширование включается для приложения только в том случае, если к продукту успешно применено небольшое обновление (пакет обновления), включающее таблицу мсипатчсекуенце.</span><span class="sxs-lookup"><span data-stu-id="6fb23-148">If any patch in the servicing transaction does not include the [MsiPatchSequence table](msipatchsequence-table.md), caching is enabled for the application only if a minor upgrade patch (service pack) that includes the MsiPatchSequence table is successfully applied to the product.</span></span>
-   <span data-ttu-id="6fb23-149">Создайте пакет исправлений с помощью средств создания исправлений, таких как [Msimsp.exe](msimsp-exe.md) и [PATCHWIZ.DLL](patchwiz-dll.md).</span><span class="sxs-lookup"><span data-stu-id="6fb23-149">Generate the patch package using patch creation tools such as [Msimsp.exe](msimsp-exe.md) and [PATCHWIZ.DLL](patchwiz-dll.md).</span></span>
-   <span data-ttu-id="6fb23-150">Всегда нацеливание исправлений для RTM-версии приложения или незначительного обновления (пакета обновления) приложения.</span><span class="sxs-lookup"><span data-stu-id="6fb23-150">Always target patches for the RTM version of the application or a minor upgrade (service pack) version of the application.</span></span> <span data-ttu-id="6fb23-151">Целевыми объектами, указанными в [таблице таржетимажес](targetimages-table-patchwiz-dll-.md) файла свойств создания исправления (PCP), должны быть точки проверки продукта, определенные в первых трех полях свойства [**ProductVersion**](productversion.md) .</span><span class="sxs-lookup"><span data-stu-id="6fb23-151">The targets specified in the [TargetImages table](targetimages-table-patchwiz-dll-.md) of the Patch Creation Properties (PCP) file should be product check points defined by the first three fields of the [**ProductVersion**](productversion.md) property.</span></span>
-   <span data-ttu-id="6fb23-152">Никогда не нацеливание на исправления в небольших образах обновлений.</span><span class="sxs-lookup"><span data-stu-id="6fb23-152">Never target patches at small update images.</span></span> <span data-ttu-id="6fb23-153">Целевые объекты для сборки исправления не должны содержать предыдущие образы обновления небольших обновлений.</span><span class="sxs-lookup"><span data-stu-id="6fb23-153">The targets for building the patch should not include previous small update upgrade images.</span></span>

 

 



