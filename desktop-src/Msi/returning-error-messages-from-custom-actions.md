---
description: В этом разделе описывается, как отправить сообщения из пользовательских действий, которые фактически выполняют часть установки, путем вызова библиотеки динамической компоновки или скрипта.
ms.assetid: 637efccf-920d-421d-9183-528cc3515bf8
title: Возвращение сообщений об ошибках из настраиваемых действий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 480a9e7891680aadc9d8eb4eedba2bad0d2e3dd4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104155515"
---
# <a name="returning-error-messages-from-custom-actions"></a><span data-ttu-id="98f17-103">Возвращение сообщений об ошибках из настраиваемых действий</span><span class="sxs-lookup"><span data-stu-id="98f17-103">Returning Error Messages from Custom Actions</span></span>

<span data-ttu-id="98f17-104">В этом разделе описывается, как отправить сообщения из пользовательских действий, которые фактически выполняют часть установки, путем вызова библиотеки динамической компоновки или скрипта.</span><span class="sxs-lookup"><span data-stu-id="98f17-104">This section describes how to send messages from custom actions that actually perform a part of the installation by calling a dynamic link library or script.</span></span> <span data-ttu-id="98f17-105">Обратите внимание, что [тип настраиваемого действия 19](custom-action-type-19.md) отправляет только указанное сообщение об ошибке, возвращает ошибку, а затем завершает установку.</span><span class="sxs-lookup"><span data-stu-id="98f17-105">Note that [Custom Action Type 19](custom-action-type-19.md) only sends a specified error message, returns failure, and then terminates the installation.</span></span> <span data-ttu-id="98f17-106">Тип настраиваемого действия 19 не выполняет никакой части установки.</span><span class="sxs-lookup"><span data-stu-id="98f17-106">Custom Action Type 19 does not perform any part of the installation.</span></span>

<span data-ttu-id="98f17-107">Чтобы отправить сообщение об ошибке из настраиваемого действия, использующего [библиотеку динамической компоновки](dynamic-link-libraries.md) (DLL), необходимо выполнить вызов настраиваемого действия [**мсипроцессмессаже**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage).</span><span class="sxs-lookup"><span data-stu-id="98f17-107">To send an error message from a custom action that uses a [dynamic-link library](dynamic-link-libraries.md) (DLL), have the custom action call [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage).</span></span> <span data-ttu-id="98f17-108">Обратите внимание, что настраиваемые действия, запускаемые [DoAction таблице ControlEvent событие](doaction-controlevent.md) , могут отправить сообщения с помощью метода [**сообщения**](session-message.md) , но не могут отправить сообщение с помощью **мсипроцессмессаже**.</span><span class="sxs-lookup"><span data-stu-id="98f17-108">Note that custom actions launched by a [DoAction ControlEvent](doaction-controlevent.md) can send messages with the [**Message**](session-message.md) method but cannot send a message with **MsiProcessMessage**.</span></span> <span data-ttu-id="98f17-109">В системах, предшествующих Windows Server 2003, пользовательские действия, запускаемые DoAction таблице ControlEvent событие, не могут отправить сообщения с помощью метода **мсипроцессмессаже** или **Message** .</span><span class="sxs-lookup"><span data-stu-id="98f17-109">On systems earlier than Windows Server 2003, custom actions launched by a DoAction ControlEvent cannot send messages with **MsiProcessMessage** or **Message** method.</span></span> <span data-ttu-id="98f17-110">Дополнительные сведения см. [в разделе Отправка сообщений в установщик Windows с помощью мсипроцессмессаже](sending-messages-to-windows-installer-using-msiprocessmessage.md).</span><span class="sxs-lookup"><span data-stu-id="98f17-110">For more information, see [Sending Messages to Windows Installer Using MsiProcessMessage](sending-messages-to-windows-installer-using-msiprocessmessage.md).</span></span>

<span data-ttu-id="98f17-111">**Отображение сообщения об ошибке из настраиваемого действия с помощью библиотеки DLL**</span><span class="sxs-lookup"><span data-stu-id="98f17-111">**To display an error message from within a custom action using a DLL**</span></span>

1.  <span data-ttu-id="98f17-112">Настраиваемое действие должно вызвать [**мсипроцессмессаже**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) и передать параметры *хинсталл*, *емессажетипе* и *хрекорд*.</span><span class="sxs-lookup"><span data-stu-id="98f17-112">The custom action should call [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) and pass in the parameters *hInstall*, *eMessageType*, and *hRecord*.</span></span> <span data-ttu-id="98f17-113">Для настраиваемого действия может быть предоставлен настраиваемый [тип действия 19](custom-action-type-19.md), как описано в разделе [доступ к текущему сеансу установщика из настраиваемого действия](accessing-the-current-installer-session-from-inside-a-custom-action.md) или из [**мсиопенпродукт**](/windows/desktop/api/Msi/nf-msi-msiopenproducta) или [**мсиопенпаккаже**](/windows/desktop/api/Msi/nf-msi-msiopenpackagea).</span><span class="sxs-lookup"><span data-stu-id="98f17-113">The handle to the installation, [Custom Action Type 19](custom-action-type-19.md), may be provided to the custom action as described in [Accessing the Current Installer Session from Inside a Custom Action](accessing-the-current-installer-session-from-inside-a-custom-action.md) or from [**MsiOpenProduct**](/windows/desktop/api/Msi/nf-msi-msiopenproducta) or [**MsiOpenPackage**](/windows/desktop/api/Msi/nf-msi-msiopenpackagea).</span></span>
2.  <span data-ttu-id="98f17-114">Параметр *емессажетипе* должен указывать один из типов сообщений, перечисленных в [**мсипроцессмессаже**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage).</span><span class="sxs-lookup"><span data-stu-id="98f17-114">The parameter *eMessageType* should specify one of the message types as listed in [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage).</span></span>
3.  <span data-ttu-id="98f17-115">Параметр *хрекорд* функции [**мсипроцессмессаже**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) зависит от типа сообщения.</span><span class="sxs-lookup"><span data-stu-id="98f17-115">The *hRecord* parameter of the [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) function depends upon the message type.</span></span> <span data-ttu-id="98f17-116">См. раздел [Отправка сообщений в установщик Windows с помощью мсипроцессмессаже](sending-messages-to-windows-installer-using-msiprocessmessage.md).</span><span class="sxs-lookup"><span data-stu-id="98f17-116">See [Sending Messages to Windows Installer Using MsiProcessMessage](sending-messages-to-windows-installer-using-msiprocessmessage.md).</span></span> <span data-ttu-id="98f17-117">Если сообщение содержит форматированные данные, введите сообщение в таблицу [ошибок](error-table.md) , используя форматирование, описанное в разделе [форматировано](formatted.md).</span><span class="sxs-lookup"><span data-stu-id="98f17-117">If the message contains formatted data, enter the message into the [Error](error-table.md) table using the formatting described in [Formatted](formatted.md).</span></span>

<span data-ttu-id="98f17-118">Чтобы отправить сообщение об ошибке из настраиваемого действия, использующего [скрипты](scripts.md), пользовательское действие может вызвать метод [**Message**](session-message.md) объекта [**Session**](session-object.md) .</span><span class="sxs-lookup"><span data-stu-id="98f17-118">To send an error message from a custom action that uses [Scripts](scripts.md), the custom action may call the [**Message**](session-message.md) method of the [**Session**](session-object.md) object.</span></span>

<span data-ttu-id="98f17-119">**Отображение сообщения об ошибке в настраиваемом действии с помощью скрипта**</span><span class="sxs-lookup"><span data-stu-id="98f17-119">**To display an error message from within a custom action using script**</span></span>

1.  <span data-ttu-id="98f17-120">Настраиваемое действие должно вызывать метод [**Message**](session-message.md) объекта [**Session**](session-object.md) и передавать параметры *типа* и *записи*.</span><span class="sxs-lookup"><span data-stu-id="98f17-120">The custom action should call the [**Message**](session-message.md) method of the [**Session**](session-object.md) object and pass in the parameters *kind* and *record*.</span></span>
2.  <span data-ttu-id="98f17-121">*Тип* параметра должен указывать один из типов сообщений, перечисленных в методе [**Message**](session-message.md) .</span><span class="sxs-lookup"><span data-stu-id="98f17-121">The parameter *kind* should specify one of the message types listed in the [**Message**](session-message.md) method.</span></span>
3.  <span data-ttu-id="98f17-122">Параметр *записи* метода [**Message**](session-message.md) зависит от типа сообщения.</span><span class="sxs-lookup"><span data-stu-id="98f17-122">The *record* parameter of the [**Message**](session-message.md) method depends upon the message type.</span></span> <span data-ttu-id="98f17-123">Если сообщение содержит форматированные данные, введите сообщение в таблицу [ошибок](error-table.md) , используя форматирование, описанное в разделе [форматировано](formatted.md).</span><span class="sxs-lookup"><span data-stu-id="98f17-123">If the message contains formatted data, enter the message into the [Error](error-table.md) table using the formatting described in [Formatted](formatted.md).</span></span>

<span data-ttu-id="98f17-124">Пользовательские действия, использующие [исполняемые файлы](executable-files.md) , не могут отправить сообщение путем вызова [**Мсипроцессмессаже**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) или метода [**Message**](session-message.md) , так как они не могут получить маркер установки.</span><span class="sxs-lookup"><span data-stu-id="98f17-124">Custom actions using [Executable Files](executable-files.md) cannot send a message by calling [**MsiProcessMessage**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) or the [**Message**](session-message.md) method because they cannot get a handle to the installation.</span></span>

## <a name="related-topics"></a><span data-ttu-id="98f17-125">См. также</span><span class="sxs-lookup"><span data-stu-id="98f17-125">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="98f17-126">Возвращаемые значения настраиваемого действия</span><span class="sxs-lookup"><span data-stu-id="98f17-126">Custom Action Return Values</span></span>](custom-action-return-values.md)
</dt> </dl>

 

 



