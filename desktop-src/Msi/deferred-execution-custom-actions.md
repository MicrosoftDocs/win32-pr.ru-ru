---
description: Назначение отложенного выполнения настраиваемого действия заключается в задержке выполнения системного изменения на время выполнения скрипта установки.
ms.assetid: 79bf4d0b-624d-4652-8c4f-0ecd928a88e3
title: Пользовательские действия отложенного выполнения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e09b91793f5d5bbc7be7099c92f8d8f212012d12
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103998823"
---
# <a name="deferred-execution-custom-actions"></a><span data-ttu-id="dfc95-103">Пользовательские действия отложенного выполнения</span><span class="sxs-lookup"><span data-stu-id="dfc95-103">Deferred Execution Custom Actions</span></span>

<span data-ttu-id="dfc95-104">Назначение отложенного выполнения настраиваемого действия заключается в задержке выполнения системного изменения на время выполнения скрипта установки.</span><span class="sxs-lookup"><span data-stu-id="dfc95-104">The purpose of a deferred execution custom action is to delay the execution of a system change to the time when the installation script is executed.</span></span> <span data-ttu-id="dfc95-105">Это отличается от обычного настраиваемого действия или стандартного действия, в котором установщик выполняет действие немедленно при его возникновении в таблице последовательности или при вызове [**мсидоактион**](/windows/desktop/api/Msiquery/nf-msiquery-msidoactiona).</span><span class="sxs-lookup"><span data-stu-id="dfc95-105">This differs from a regular custom action, or a standard action, in which the installer executes the action immediately upon encountering it in a sequence table or in a call to [**MsiDoAction**](/windows/desktop/api/Msiquery/nf-msiquery-msidoactiona).</span></span> <span data-ttu-id="dfc95-106">Пользовательское действие отложенного выполнения позволяет автору пакета указывать системные операции в определенной точке выполнения скрипта установки.</span><span class="sxs-lookup"><span data-stu-id="dfc95-106">A deferred execution custom action enables a package author to specify system operations at a particular point within the execution of the installation script.</span></span>

<span data-ttu-id="dfc95-107">Установщик не выполняет настраиваемое действие отложенного выполнения во время обработки последовательности установки.</span><span class="sxs-lookup"><span data-stu-id="dfc95-107">The installer does not execute a deferred execution custom action at the time the installation sequence is processed.</span></span> <span data-ttu-id="dfc95-108">Вместо этого установщик записывает пользовательское действие в скрипт установки.</span><span class="sxs-lookup"><span data-stu-id="dfc95-108">Instead the installer writes the custom action into the installation script.</span></span> <span data-ttu-id="dfc95-109">Единственным параметром режима, который устанавливает установщик в этом случае, является МСИРУНМОДЕ \_ Schedule.</span><span class="sxs-lookup"><span data-stu-id="dfc95-109">The only mode parameter the installer sets in this case is MSIRUNMODE\_SCHEDULED.</span></span> <span data-ttu-id="dfc95-110">Описание параметров режима выполнения см. в разделе [**мсижетмоде**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) .</span><span class="sxs-lookup"><span data-stu-id="dfc95-110">See [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) for a description of the run mode parameters.</span></span>

<span data-ttu-id="dfc95-111">Пользовательское действие отложенного выполнения должно быть запланировано в таблице выполнение последовательности в разделе, который выполняет создание скрипта.</span><span class="sxs-lookup"><span data-stu-id="dfc95-111">A deferred execution custom action must be scheduled in the execute sequence table within the section that performs script generation.</span></span> <span data-ttu-id="dfc95-112">Пользовательские действия отложенного выполнения должны следовать после [инсталлинитиализе](installinitialize-action.md) и предшествовать [функции InstallFinalize](installfinalize-action.md) в последовательности действий.</span><span class="sxs-lookup"><span data-stu-id="dfc95-112">Deferred execution custom actions must come after [InstallInitialize](installinitialize-action.md) and come before [InstallFinalize](installfinalize-action.md) in the action sequence.</span></span>

<span data-ttu-id="dfc95-113">Настраиваемые действия, которые задают свойства, состояния компонентов, состояния компонентов или целевые каталоги или планируют системные операции путем вставки строк в таблицы последовательности, во многих случаях могут безопасно использовать немедленное выполнение.</span><span class="sxs-lookup"><span data-stu-id="dfc95-113">Custom actions that set properties, feature states, component states, or target directories, or that schedule system operations by inserting rows into sequence tables, can in many cases use immediate execution safely.</span></span> <span data-ttu-id="dfc95-114">Однако пользовательские действия, которые изменяют систему напрямую или вызывают другую системную службу, должны быть отложены до момента выполнения сценария установки.</span><span class="sxs-lookup"><span data-stu-id="dfc95-114">However, custom actions that change the system directly, or call another system service, must be deferred to the time when the installation script is executed.</span></span> <span data-ttu-id="dfc95-115">Дополнительные сведения о возможных конфликтах между настраиваемыми действиями и основным потоком установки см. в разделе [синхронные и асинхронные настраиваемые действия](synchronous-and-asynchronous-custom-actions.md) .</span><span class="sxs-lookup"><span data-stu-id="dfc95-115">See [Synchronous and Asynchronous Custom Actions](synchronous-and-asynchronous-custom-actions.md) for more information about potential clashes between their custom actions and the main installation thread.</span></span>

<span data-ttu-id="dfc95-116">Поскольку сценарий установки может выполняться вне сеанса установки, в котором он был записан, сеанс может больше не существовать во время выполнения сценария установки.</span><span class="sxs-lookup"><span data-stu-id="dfc95-116">Because the installation script can be executed outside of the installation session in which it was written, the session may no longer exist during execution of the installation script.</span></span> <span data-ttu-id="dfc95-117">Это означает, что исходный обработчик сеанса и данные свойства, установленные во время последовательности установки, недоступны для отложенного настраиваемого действия выполнения.</span><span class="sxs-lookup"><span data-stu-id="dfc95-117">This means that the original session handle and property data set during the installation sequence is not available to a deferred execution custom action.</span></span> <span data-ttu-id="dfc95-118">Отложенные пользовательские действия, вызывающие библиотеки динамической компоновки (DLL), передают маркер, который может использоваться только для получения очень ограниченного объема информации, как описано в разделе [Получение сведений о контексте для отложенного выполнения настраиваемых действий](obtaining-context-information-for-deferred-execution-custom-actions.md).</span><span class="sxs-lookup"><span data-stu-id="dfc95-118">Deferred custom actions that call dynamic-link libraries (DLLs) pass a handle which can only be used to obtain a very limited amount of information, as described in [Obtaining Context Information for Deferred Execution Custom Actions](obtaining-context-information-for-deferred-execution-custom-actions.md).</span></span>

<span data-ttu-id="dfc95-119">Обратите внимание, что отложенные настраиваемые действия, включая [откат настраиваемых действий](rollback-custom-actions.md) и [фиксация настраиваемых действий](commit-custom-actions.md), являются единственными типами действий, которые могут выполняться вне контекста безопасности пользователей.</span><span class="sxs-lookup"><span data-stu-id="dfc95-119">Note that deferred custom actions, including [rollback custom actions](rollback-custom-actions.md) and [commit custom actions](commit-custom-actions.md), are the only types of actions that can run outside the users security context.</span></span>

## <a name="related-topics"></a><span data-ttu-id="dfc95-120">См. также</span><span class="sxs-lookup"><span data-stu-id="dfc95-120">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="dfc95-121">Параметры выполнения In-Script настраиваемого действия</span><span class="sxs-lookup"><span data-stu-id="dfc95-121">Custom Action In-Script Execution Options</span></span>](custom-action-in-script-execution-options.md)
</dt> <dt>

[<span data-ttu-id="dfc95-122">Ссылка на настраиваемое действие</span><span class="sxs-lookup"><span data-stu-id="dfc95-122">Custom Action Reference</span></span>](custom-action-reference.md)
</dt> </dl>

 

 



