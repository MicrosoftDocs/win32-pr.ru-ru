---
description: Параллельные установки, также называемые вложенными установками, являются устаревшей функцией установщик Windows.
ms.assetid: 579ae4ee-47a0-440e-81ca-ea8bf60c5349
title: Параллельные установки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d89f2ef4af062c8151935fefab471603f79d7633
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103910987"
---
# <a name="concurrent-installations"></a><span data-ttu-id="f6474-103">Параллельные установки</span><span class="sxs-lookup"><span data-stu-id="f6474-103">Concurrent Installations</span></span>

<span data-ttu-id="f6474-104">Параллельные установки, также называемые вложенными установками, являются устаревшей функцией установщик Windows.</span><span class="sxs-lookup"><span data-stu-id="f6474-104">Concurrent Installations, also called Nested Installations, is a deprecated feature of the Windows Installer.</span></span> <span data-ttu-id="f6474-105">Приложения, установленные с параллельными установками, в итоге могут завершаться сбоем, так как они трудно обслуживать правильно.</span><span class="sxs-lookup"><span data-stu-id="f6474-105">Applications installed with concurrent installations can eventually fail because they are difficult for customers to service correctly.</span></span> <span data-ttu-id="f6474-106">Не используйте параллельные установки для установки продуктов, предназначенных для выпуска в общедоступной версии.</span><span class="sxs-lookup"><span data-stu-id="f6474-106">Do not use concurrent installations to install products that are intended to be released to the public.</span></span> <span data-ttu-id="f6474-107">Параллельные установки могут иметь ограниченную применимость в контролируемых корпоративных средах при использовании для установки приложений, которые не предназначены для общедоступного выпуска.</span><span class="sxs-lookup"><span data-stu-id="f6474-107">Concurrent installations can have limited applicability in controlled corporate environments when used to install applications that are not intended for public release.</span></span> <span data-ttu-id="f6474-108">Документация по параллельным установкам предназначена для авторов пакетов, которые хотят использовать параллельные установки с приложениями, которые не предназначены для общедоступного распространения.</span><span class="sxs-lookup"><span data-stu-id="f6474-108">The concurrent installations documentation is provided for package authors that wish to use concurrent installations with applications that are not for public distribution.</span></span>

<span data-ttu-id="f6474-109">Одновременное действие установки устанавливает другой пакет установщик Windows во время выполнения установки.</span><span class="sxs-lookup"><span data-stu-id="f6474-109">A concurrent installation action installs another Windows Installer package during a currently running installation.</span></span> <span data-ttu-id="f6474-110">Параллельная установка добавляется в пакет путем создания одновременных действий установки в [таблице CustomAction](customaction-table.md) и планирования этого настраиваемого действия в таблицах последовательности.</span><span class="sxs-lookup"><span data-stu-id="f6474-110">A concurrent installation is added to a package by authoring a concurrent installation action into the [CustomAction table](customaction-table.md) and scheduling this custom action into the sequence tables.</span></span> <span data-ttu-id="f6474-111">Целевое поле таблицы CustomAction содержит строку параметров общедоступного свойства, используемых параллельной установкой.</span><span class="sxs-lookup"><span data-stu-id="f6474-111">The Target field of the CustomAction table contains a string of public property settings used by the concurrent installation.</span></span> <span data-ttu-id="f6474-112">Поле источника в таблице CustomAction определяет параллельный пакет.</span><span class="sxs-lookup"><span data-stu-id="f6474-112">The Source field of the CustomAction table identifies the concurrent package.</span></span> <span data-ttu-id="f6474-113">Одновременное действие установки может переустановить или удалить приложение, установленное с помощью пакета установки текущего приложения.</span><span class="sxs-lookup"><span data-stu-id="f6474-113">A concurrent installation action can only reinstall or remove an application that has been installed by the current application's installation package.</span></span>

<span data-ttu-id="f6474-114">Тип одновременных операций установки указывается в поле Тип таблицы CustomAction.</span><span class="sxs-lookup"><span data-stu-id="f6474-114">The type of concurrent installation action is specified in the Type field of the CustomAction table.</span></span> <span data-ttu-id="f6474-115">В зависимости от типа настраиваемого действия пакет для параллельного приложения может находиться во внешнем хранилище основного пакета, в виде файла в расположении, указанном свойством, или в виде объявленного приложения на компьютере пользователя.</span><span class="sxs-lookup"><span data-stu-id="f6474-115">Depending upon the custom action type, the package for the concurrent application can reside in a substorage of the main package, as a file at a location specified by a property, or as an advertised application on the user's machine.</span></span> <span data-ttu-id="f6474-116">Следующие типы настраиваемых действий выполняют параллельную установку.</span><span class="sxs-lookup"><span data-stu-id="f6474-116">The following types of custom actions perform a concurrent installation.</span></span>



| <span data-ttu-id="f6474-117">Тип настраиваемого действия</span><span class="sxs-lookup"><span data-stu-id="f6474-117">Custom action type</span></span>                                 | <span data-ttu-id="f6474-118">Описание</span><span class="sxs-lookup"><span data-stu-id="f6474-118">Description</span></span>                                                                     |
|----------------------------------------------------|---------------------------------------------------------------------------------|
| [<span data-ttu-id="f6474-119">Тип настраиваемого действия 7</span><span class="sxs-lookup"><span data-stu-id="f6474-119">Custom Action Type 7</span></span>](custom-action-type-7.md)   | <span data-ttu-id="f6474-120">Параллельная установка продукта, находящегося в пакете установки.</span><span class="sxs-lookup"><span data-stu-id="f6474-120">Concurrent installation of a product residing in the installation package.</span></span>      |
| [<span data-ttu-id="f6474-121">Тип настраиваемого действия 23</span><span class="sxs-lookup"><span data-stu-id="f6474-121">Custom Action Type 23</span></span>](custom-action-type-23.md) | <span data-ttu-id="f6474-122">Параллельная установка пакета установщика в текущем исходном дереве.</span><span class="sxs-lookup"><span data-stu-id="f6474-122">Concurrent installation of an installer package within the current source tree.</span></span> |
| [<span data-ttu-id="f6474-123">Тип настраиваемого действия 39</span><span class="sxs-lookup"><span data-stu-id="f6474-123">Custom Action Type 39</span></span>](custom-action-type-39.md) | <span data-ttu-id="f6474-124">Параллельная установка объявленного пакета установщика.</span><span class="sxs-lookup"><span data-stu-id="f6474-124">Concurrent installation of an advertised installer package.</span></span>                     |



 

<span data-ttu-id="f6474-125">Параллельная установка использует один и тот же пользовательский интерфейс и параметры ведения журнала в качестве основной установки.</span><span class="sxs-lookup"><span data-stu-id="f6474-125">A concurrent installation shares the same user interface and logging settings as the main installation.</span></span>

<span data-ttu-id="f6474-126">Одновременные действия установки должны размещаться между [действием инсталлинитиализе](installinitialize-action.md) и [действием функции InstallFinalize](installfinalize-action.md) основной последовательности действий установки.</span><span class="sxs-lookup"><span data-stu-id="f6474-126">Concurrent installation actions should be placed between the [InstallInitialize action](installinitialize-action.md) and [InstallFinalize action](installfinalize-action.md) of the main installation's action sequence.</span></span> <span data-ttu-id="f6474-127">После отката основной установки установщик также выполняет откат параллельной установки.</span><span class="sxs-lookup"><span data-stu-id="f6474-127">Upon rollback of the main installation, the installer will then rollback the concurrent installation as well.</span></span> <span data-ttu-id="f6474-128">Использование [отложенного выполнения](deferred-execution-custom-actions.md) с параллельными действиями установки не требуется, так как установщик объединяет данные отката из параллельных и основных установок.</span><span class="sxs-lookup"><span data-stu-id="f6474-128">The use of [deferred execution](deferred-execution-custom-actions.md) with concurrent installation actions is unnecessary because the installer combines rollback information from the concurrent and main installations.</span></span> <span data-ttu-id="f6474-129">Все изменения отменяются при установке отката.</span><span class="sxs-lookup"><span data-stu-id="f6474-129">All changes are reversed upon a rollback installation.</span></span>

<span data-ttu-id="f6474-130">Возвращаемые значения для параллельных действий установки те же, что и для других настраиваемых действий.</span><span class="sxs-lookup"><span data-stu-id="f6474-130">The return values for concurrent installation actions are the same as for other custom actions.</span></span> <span data-ttu-id="f6474-131">См. раздел [возвращаемые значения пользовательских действий](custom-action-return-values.md).</span><span class="sxs-lookup"><span data-stu-id="f6474-131">See [Custom Action Return Values](custom-action-return-values.md).</span></span>

<span data-ttu-id="f6474-132">Стандартные или настраиваемые действия, которые задают автоматический перезапуск системы или запрашивают у пользователя перезапуск, могут также выполнять перезапуск или запрос в рамках параллельной установки.</span><span class="sxs-lookup"><span data-stu-id="f6474-132">Standard or custom actions that specify an automatic restart of the system, or request the user to restart, can also perform restart or request from within a concurrent installation.</span></span>

<span data-ttu-id="f6474-133">После того как установщик начнет параллельную установку, все остальные установки будут заблокированы до завершения параллельной установки и до продолжения основной установки.</span><span class="sxs-lookup"><span data-stu-id="f6474-133">Once the installer begins a concurrent installation, it locks out all other installations until the concurrent installation is complete and before continuing the main installation.</span></span> <span data-ttu-id="f6474-134">Установщик может выполнять параллельные установки только в качестве синхронных настраиваемых действий.</span><span class="sxs-lookup"><span data-stu-id="f6474-134">The installer can only execute concurrent installations as synchronous custom actions.</span></span> <span data-ttu-id="f6474-135">См. раздел [синхронные и асинхронные настраиваемые действия](synchronous-and-asynchronous-custom-actions.md).</span><span class="sxs-lookup"><span data-stu-id="f6474-135">See [Synchronous and Asynchronous Custom Actions](synchronous-and-asynchronous-custom-actions.md).</span></span> <span data-ttu-id="f6474-136">Флаги параметров, описанные в разделе [Параметры обработки возвращаемых значений настраиваемых действий](custom-action-return-processing-options.md) , должны иметь значение None (+ 0) или **мсидбкустомактионтипеконтинуе** (+ 64).</span><span class="sxs-lookup"><span data-stu-id="f6474-136">The option flags described in [Custom Action Return Processing Options](custom-action-return-processing-options.md) must be set to none (+0) or **msidbCustomActionTypeContinue** (+64).</span></span>

<span data-ttu-id="f6474-137">Одновременное действие установки может установить приложение для локального запуска, запуска из источника, переустановки или удаления тем же способом, что и при использовании [**мсиинсталлпродукт**](/windows/desktop/api/Msi/nf-msi-msiinstallproducta) для обычной установки.</span><span class="sxs-lookup"><span data-stu-id="f6474-137">A concurrent installation action can install an application to be run locally, to run from source, to be reinstalled, or to be removed in the same manner as when using [**MsiInstallProduct**](/windows/desktop/api/Msi/nf-msi-msiinstallproducta) for a regular installation.</span></span> <span data-ttu-id="f6474-138">Чтобы указать тип установки, перед одновременным действием установки передайте значение свойства [**ADDLOCAL**](addlocal.md), [**аддсаурце**](addsource.md), [**REINSTALL**](reinstall.md)или [**Remove**](remove.md) .</span><span class="sxs-lookup"><span data-stu-id="f6474-138">To specify the type of installation, pass either the [**ADDLOCAL**](addlocal.md), [**ADDSOURCE**](addsource.md), [**REINSTALL**](reinstall.md), or [**REMOVE**](remove.md) property to the concurrent installation action.</span></span>

<span data-ttu-id="f6474-139">Одновременные действия установки могут быть созданы парами, одним действием для установки и другим действием, используемым для удаления параллельной установки.</span><span class="sxs-lookup"><span data-stu-id="f6474-139">Concurrent installation actions can be authored in pairs, one action used for installing and the other action used for removing the concurrent installation.</span></span> <span data-ttu-id="f6474-140">Для установки обычно используется [тип настраиваемого действия 7](custom-action-type-7.md) или [тип настраиваемого действия 23](custom-action-type-23.md) .</span><span class="sxs-lookup"><span data-stu-id="f6474-140">A [Custom Action Type 7](custom-action-type-7.md) or [Custom Action Type 23](custom-action-type-23.md) is typically used to install.</span></span> <span data-ttu-id="f6474-141">[Тип настраиваемого действия 39](custom-action-type-39.md) обычно используется для удаления параллельной установки при удалении родительского продукта.</span><span class="sxs-lookup"><span data-stu-id="f6474-141">A [Custom Action Type 39](custom-action-type-39.md) is typically used to remove the concurrent installation when the parent product is uninstalled.</span></span> <span data-ttu-id="f6474-142">Запись для настраиваемого действия удаления в [таблице CustomAction](customaction-table.md) может содержать идентификатор GUID кода продукта в поле источника и "удалить = все" в целевом поле.</span><span class="sxs-lookup"><span data-stu-id="f6474-142">The record for the removal custom action in the [CustomAction table](customaction-table.md) can have the product code GUID in the Source field and "REMOVE=ALL" in the Target field.</span></span> <span data-ttu-id="f6474-143">Два настраиваемых действия должны быть созданы в таблице действий с взаимоисключающими условиями.</span><span class="sxs-lookup"><span data-stu-id="f6474-143">The two custom actions need to be authored in the action sequence table with mutually exclusive conditions.</span></span> <span data-ttu-id="f6474-144">Например, настраиваемое действие, устанавливающее продукт, может иметь значение "не установлено" в поле "условие", а пользовательское действие удаляет параллельную установку с параметром "Удалить =" все "в поле" условие ".</span><span class="sxs-lookup"><span data-stu-id="f6474-144">For example, the custom action that installs the product can have "NOT Installed" in its Condition field and the custom action removes the concurrent installation can have REMOVE="ALL" in its Condition field.</span></span>

<span data-ttu-id="f6474-145">Не существует метода для выполнения запросов к пакету по его затратам.</span><span class="sxs-lookup"><span data-stu-id="f6474-145">There is no method for querying a package for its cost.</span></span> <span data-ttu-id="f6474-146">Это усложняет издержки параллельной установки.</span><span class="sxs-lookup"><span data-stu-id="f6474-146">This makes the costing of a concurrent installations difficult.</span></span> <span data-ttu-id="f6474-147">Строки необходимо добавить в [таблицу ресервекост](reservecost-table.md) , чтобы указать папки и затраты на наихудший случай для компонента, связанного с параллельной установкой.</span><span class="sxs-lookup"><span data-stu-id="f6474-147">Rows must be added to the [ReserveCost table](reservecost-table.md) to indicate the folders and worst-case costs of the component associated with the concurrent install.</span></span>

<span data-ttu-id="f6474-148">Единственными [параметрами, возвращаемыми](custom-action-return-processing-options.md) при одновременном выполнении установки, являются "нет" (+ 0) или **мсидбкустомактионтипеконтинуе** (+ 64).</span><span class="sxs-lookup"><span data-stu-id="f6474-148">The only [Custom Action Return Processing Options](custom-action-return-processing-options.md) available with concurrent installation actions are none (+0) or **msidbCustomActionTypeContinue** (+64).</span></span>

<span data-ttu-id="f6474-149">Обратите внимание, что родительская установка не может вызвать собственный пакет как параллельное действие установки.</span><span class="sxs-lookup"><span data-stu-id="f6474-149">Note that a parent installation cannot call its own package as a concurrent installation action.</span></span>

<span data-ttu-id="f6474-150">Обратите внимание, что если установка на компьютере пытается выполнить одновременную установку для каждого пользователя, установщик регистрирует родительскую установку как по умолчанию для пользователя.</span><span class="sxs-lookup"><span data-stu-id="f6474-150">Note that if a per-machine installation attempts to run a per-user concurrent installation, the installer registers the parent installation as per-user by default.</span></span> <span data-ttu-id="f6474-151">Это может привести к неправильному удалению приложения установщиком, так как установщик пытается удалить приложение на компьютере, если оно действительно зарегистрировано для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="f6474-151">This can cause the installer to incorrectly remove the application because the installer attempts to uninstall the application per-machine when it is actually registered as per-user.</span></span> <span data-ttu-id="f6474-152">Чтобы принудительно выполнить одновременную установку для отслеживания состояния своей родительской установки, введите ALLUSERS = " \[ ALLUSERS \] " в столбце Target [таблицы CustomAction](customaction-table.md).</span><span class="sxs-lookup"><span data-stu-id="f6474-152">To force the state of a concurrent installation to track the state of its parent installation, enter ALLUSERS="\[ALLUSERS\]" in the Target column of the [CustomAction table](customaction-table.md).</span></span> <span data-ttu-id="f6474-153">В этом случае параллельная установка выполняется для каждого компьютера, если родительский компьютер находится на компьютере, а параллельная установка — для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="f6474-153">In this case, the concurrent installation is per-machine if the parent is per-machine, and the concurrent installation is per-user if the parent is per-user.</span></span>

<span data-ttu-id="f6474-154">При создании параллельных установок разработчикам следует обратить внимание на следующие предупреждения.</span><span class="sxs-lookup"><span data-stu-id="f6474-154">Developers should note the following warnings when authoring concurrent installations.</span></span>

-   <span data-ttu-id="f6474-155">Параллельные установки не могут совместно использовать компоненты.</span><span class="sxs-lookup"><span data-stu-id="f6474-155">Concurrent installations cannot share components.</span></span>
-   <span data-ttu-id="f6474-156">Административная установка не может также содержать параллельную установку.</span><span class="sxs-lookup"><span data-stu-id="f6474-156">An administrative installation cannot also contain a concurrent installation.</span></span>
-   <span data-ttu-id="f6474-157">Установка исправлений и обновления может не работать одновременно с параллельной установкой.</span><span class="sxs-lookup"><span data-stu-id="f6474-157">Patching and upgrading may not work with concurrent installations.</span></span>
-   <span data-ttu-id="f6474-158">Установщик может неправильно издержки параллельной установки.</span><span class="sxs-lookup"><span data-stu-id="f6474-158">The installer may not properly cost a concurrent installation.</span></span>
-   <span data-ttu-id="f6474-159">Интегрированные компоненты ProgressBar нельзя использовать с параллельными установками.</span><span class="sxs-lookup"><span data-stu-id="f6474-159">Integrated ProgressBars cannot be used with concurrent installations.</span></span>
-   <span data-ttu-id="f6474-160">Ресурсы, которые должны быть объявлены, не могут быть установлены параллельной установкой.</span><span class="sxs-lookup"><span data-stu-id="f6474-160">Resources that are to be advertised cannot be installed by the concurrent installation.</span></span>
-   <span data-ttu-id="f6474-161">Пакет, выполняющий параллельную установку приложения, должен также удалить параллельное приложение при удалении родительского продукта.</span><span class="sxs-lookup"><span data-stu-id="f6474-161">A package that performs a concurrent installation of an application should also uninstall the concurrent application when the parent product is uninstalled.</span></span>

<span data-ttu-id="f6474-162">Чтобы предотвратить установку пакета в качестве параллельной установки, добавьте в таблицу [лаунчкондитион](launchcondition-table.md) одну из следующих условных операторов.</span><span class="sxs-lookup"><span data-stu-id="f6474-162">To prevent a package from ever being installed as a concurrent installation, add either of the following conditional statements to the [LaunchCondition](launchcondition-table.md) table.</span></span> <span data-ttu-id="f6474-163">Это предотвращает установку пакета в ходе параллельной установки, выполняемой другой установкой.</span><span class="sxs-lookup"><span data-stu-id="f6474-163">This prevents the package from ever being installed by a concurrent installation action run by another installation.</span></span> <span data-ttu-id="f6474-164">Это не мешает удалению пакета с помощью действия [RemoveExistingProducts](removeexistingproducts-action.md) .</span><span class="sxs-lookup"><span data-stu-id="f6474-164">This does not prevent the package from being removed by the [RemoveExistingProducts](removeexistingproducts-action.md) action.</span></span> <span data-ttu-id="f6474-165">См. также свойство [**паренторигиналдатабасе**](parentoriginaldatabase.md) и свойство [**парентпродукткоде**](parentproductcode.md) .</span><span class="sxs-lookup"><span data-stu-id="f6474-165">See also the [**ParentOriginalDatabase**](parentoriginaldatabase.md) property and [**ParentProductCode**](parentproductcode.md) property.</span></span>

``` syntax
"Not ParentProductCode"
```

``` syntax
"Not ParentOriginalDatabase"
```

 

 



