---
description: В этом разделе описывается включение CAB-файлов при установке. Дополнительные сведения см. в разделе Использование ящиков и сжатых источников.
ms.assetid: 17ea7f76-90b2-48fb-8187-64dc6d294443
title: Включение CAB-файла в установку
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 098e660de3f7ec7097ab02613d75219ac0a0d624
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105650698"
---
# <a name="including-a-cabinet-file-in-an-installation"></a><span data-ttu-id="04334-104">Включение CAB-файла в установку</span><span class="sxs-lookup"><span data-stu-id="04334-104">Including a Cabinet File in an Installation</span></span>

<span data-ttu-id="04334-105">В этом разделе описывается включение CAB-файлов при установке.</span><span class="sxs-lookup"><span data-stu-id="04334-105">This section describes including cabinet files in installations.</span></span> <span data-ttu-id="04334-106">Дополнительные сведения см. [в разделе Использование ящиков и сжатых источников](using-cabinets-and-compressed-sources.md).</span><span class="sxs-lookup"><span data-stu-id="04334-106">For more information, see [Using Cabinets and Compressed Sources](using-cabinets-and-compressed-sources.md).</span></span>

<span data-ttu-id="04334-107">**Включение CAB-файла в пакет установки**</span><span class="sxs-lookup"><span data-stu-id="04334-107">**To include a cabinet file in a installation package**</span></span>

1.  <span data-ttu-id="04334-108">Используйте средство создания CAB-файлов, чтобы сжать исходные файлы в CAB-файл.</span><span class="sxs-lookup"><span data-stu-id="04334-108">Use a cabinet creation tool to compress the source files into a cabinet file.</span></span> <span data-ttu-id="04334-109">См. [CAB-файлы](cabinet-files.md).</span><span class="sxs-lookup"><span data-stu-id="04334-109">See [Cabinet Files](cabinet-files.md).</span></span>
2.  <span data-ttu-id="04334-110">CAB-файл должен находиться в потоке данных внутри MSI-файла или в отдельном CAB-файле, расположенном в корне исходного дерева, заданном в [таблице Directory](directory-table.md).</span><span class="sxs-lookup"><span data-stu-id="04334-110">The cabinet file must either be located in a data stream inside the .msi file or in a separate cabinet file located at the root of the source tree specified by the [Directory Table](directory-table.md).</span></span>
3.  <span data-ttu-id="04334-111">Определите, является ли источник сжатым типом или смешанным типом, который содержит как несжатые, так и сжатые файлы.</span><span class="sxs-lookup"><span data-stu-id="04334-111">Determine whether the source is to be a compressed type or a mixed type that has both uncompressed and compressed files.</span></span> <span data-ttu-id="04334-112">См. раздел [сжатые и несжатые источники](compressed-and-uncompressed-sources.md).</span><span class="sxs-lookup"><span data-stu-id="04334-112">See [Compressed and Uncompressed Sources](compressed-and-uncompressed-sources.md).</span></span> <span data-ttu-id="04334-113">В зависимости от типа исходного изображения установите флаги сжатых или несжатых битов для свойства [**Сводка слов**](word-count-summary.md) "Статистика".</span><span class="sxs-lookup"><span data-stu-id="04334-113">Depending on the type of source image, set the compressed or uncompressed flag bits of the [**Word Count Summary**](word-count-summary.md) Property.</span></span>
4.  <span data-ttu-id="04334-114">Добавьте запись в [таблицу файлов](file-table.md) для каждого файла в CAB-файле.</span><span class="sxs-lookup"><span data-stu-id="04334-114">Add a record to the [File table](file-table.md) for each of the files in the cabinet.</span></span> <span data-ttu-id="04334-115">Введите ключ файла в столбец File, который точно соответствует ключу файла в CAB-файле.</span><span class="sxs-lookup"><span data-stu-id="04334-115">Enter a file key in the File column that exactly matches the file key of the file in the cabinet.</span></span> <span data-ttu-id="04334-116">В ключах файлов учитывается регистр.</span><span class="sxs-lookup"><span data-stu-id="04334-116">The file keys are case-sensitive.</span></span> <span data-ttu-id="04334-117">Последовательность установки файлов в таблице File и в CAB-файле также должна совпадать.</span><span class="sxs-lookup"><span data-stu-id="04334-117">The file installation sequence in the File table and the cabinet must also be the same.</span></span> <span data-ttu-id="04334-118">Последовательность файлов указывается порядковым номером в столбце последовательности.</span><span class="sxs-lookup"><span data-stu-id="04334-118">The file sequence is specified by the sequence number in the Sequence column.</span></span> <span data-ttu-id="04334-119">Чтобы приступить к порядковому номеру первого файла в CAB-файле, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="04334-119">To arrive at the sequence number for the first file in the cabinet, do the following.</span></span> <span data-ttu-id="04334-120">Найдите существующую запись в [таблице Media](media-table.md) , имеющую наибольшее значение в столбце DiskID.</span><span class="sxs-lookup"><span data-stu-id="04334-120">Find the existing record in the [Media table](media-table.md) having the greatest value in the DiskID column.</span></span> <span data-ttu-id="04334-121">Поле Ластсекуенце этой записи содержит последний номер последовательности файлов, используемый на носителе.</span><span class="sxs-lookup"><span data-stu-id="04334-121">The LastSequence field of this record gives the last file sequence number used on the media.</span></span> <span data-ttu-id="04334-122">В таблице File Назначьте первому файлу нового CAB-файла порядковый номер, который больше этого.</span><span class="sxs-lookup"><span data-stu-id="04334-122">In the File table, assign the first file of the new cabinet a sequence number that is greater than this.</span></span> <span data-ttu-id="04334-123">Присвойте порядковые номера всем оставшимся файлам в том же порядке, что и в CAB-файле.</span><span class="sxs-lookup"><span data-stu-id="04334-123">Assign sequence numbers to all of the remaining files in the same order as in the cabinet file.</span></span> <span data-ttu-id="04334-124">Описание оставшихся полей записей см. в разделе [File Table](file-table.md).</span><span class="sxs-lookup"><span data-stu-id="04334-124">For a description of the remaining record fields, see [File table](file-table.md).</span></span>
5.  <span data-ttu-id="04334-125">Добавьте запись в [таблицу Media](media-table.md) для CAB-файла.</span><span class="sxs-lookup"><span data-stu-id="04334-125">Add a record to the [Media table](media-table.md) for the cabinet.</span></span> <span data-ttu-id="04334-126">Укажите значение в поле DiskID этой новой записи, которое больше, чем максимальное значение DiskID, уже существующее в таблице.</span><span class="sxs-lookup"><span data-stu-id="04334-126">Specify a value in the DiskID field of this new record that is greater than the largest DiskID value already existing in the table.</span></span> <span data-ttu-id="04334-127">Вставьте имя CAB-файла в поле CAB-файла.</span><span class="sxs-lookup"><span data-stu-id="04334-127">Put the name of the cabinet into the Cabinet field.</span></span> <span data-ttu-id="04334-128">Это имя должно быть в виде типа данных [CAB](cabinet.md) .</span><span class="sxs-lookup"><span data-stu-id="04334-128">This name must be in the form of a [Cabinet](cabinet.md) data type.</span></span> <span data-ttu-id="04334-129">Добавьте перед именем знак решетки " \# ", если CAB-файл является потоком данных, хранящимся в файле MSI.</span><span class="sxs-lookup"><span data-stu-id="04334-129">Prefix the name with a number sign "\#" if the cabinet is a data stream stored in the .msi file.</span></span> <span data-ttu-id="04334-130">Обратите внимание, что если CAB-файл является потоком данных, в имени CAB-файла учитывается регистр.</span><span class="sxs-lookup"><span data-stu-id="04334-130">Note that if the cabinet is a data stream, the name of the cabinet is case-sensitive.</span></span> <span data-ttu-id="04334-131">Если CAB-файл является отдельным файлом, в имени файла регистр не учитывается.</span><span class="sxs-lookup"><span data-stu-id="04334-131">If the cabinet is a separate file, the name of the file is not case-sensitive.</span></span>
6.  <span data-ttu-id="04334-132">Определите наибольший порядковый номер файла в новом CAB-файле, проверив столбец последовательности обновленной таблицы файлов.</span><span class="sxs-lookup"><span data-stu-id="04334-132">Determine the greatest file sequence number in the new cabinet by checking the Sequence column of the updated File table.</span></span> <span data-ttu-id="04334-133">Введите значение, которое больше этого, в поле Ластсекуенце новой записи таблицы мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="04334-133">Enter a value that is greater than this into the LastSequence field of the new record of the Media table.</span></span> <span data-ttu-id="04334-134">Описание оставшихся полей записей см. в разделе [Таблица мультимедиа](media-table.md).</span><span class="sxs-lookup"><span data-stu-id="04334-134">For a description of the remaining record fields, see [Media table](media-table.md).</span></span>
7.  <span data-ttu-id="04334-135">CAB-файл можно сохранить в установочном пакете с помощью такого средства, как Msidb.exe или с помощью [функций базы данных](database-functions.md)установщика.</span><span class="sxs-lookup"><span data-stu-id="04334-135">You can store the cabinet file in the installation package either by using a tool such as Msidb.exe or by using the installer's [Database Functions](database-functions.md).</span></span> <span data-ttu-id="04334-136">В следующих четырех шагах объясняется, как добавить CAB-файл из программы с помощью функций базы данных.</span><span class="sxs-lookup"><span data-stu-id="04334-136">The following four steps explain how to add the cabinet from a program by using the database functions.</span></span>
8.  <span data-ttu-id="04334-137">Чтобы добавить CAB-файл в установочный пакет из программы, откройте представление в [ \_ таблице Streams](-streams-table.md) базы данных с помощью [**мсидатабасеопенвиев**](/windows/desktop/api/Msiquery/nf-msiquery-msidatabaseopenviewa).</span><span class="sxs-lookup"><span data-stu-id="04334-137">To add the cabinet to the installation package from a program open a view on the [\_Streams table](-streams-table.md) of the database using [**MsiDatabaseOpenView**](/windows/desktop/api/Msiquery/nf-msiquery-msidatabaseopenviewa).</span></span>
9.  <span data-ttu-id="04334-138">Используйте [**мсирекордсетстринг**](/windows/desktop/api/Msiquery/nf-msiquery-msirecordsetstringa) , чтобы задать для столбца Name \_ таблицы Streams имя, отображаемое в столбце CAB-файла [таблицы Media](media-table.md).</span><span class="sxs-lookup"><span data-stu-id="04334-138">Use [**MsiRecordSetString**](/windows/desktop/api/Msiquery/nf-msiquery-msirecordsetstringa) to set the Name column of the \_Streams table to the name appearing in the Cabinet column of the [Media table](media-table.md).</span></span> <span data-ttu-id="04334-139">Опустить знак номера: \# .</span><span class="sxs-lookup"><span data-stu-id="04334-139">Omit the number sign: \#.</span></span>
10. <span data-ttu-id="04334-140">Используйте [**мсирекордсетстреам**](/windows/desktop/api/Msiquery/nf-msiquery-msirecordsetstreama) , чтобы задать для столбца данных \_ таблицы Streams данные CAB-файла.</span><span class="sxs-lookup"><span data-stu-id="04334-140">Use [**MsiRecordSetStream**](/windows/desktop/api/Msiquery/nf-msiquery-msirecordsetstreama) to set the Data column of the \_Streams table to the cabinet's data.</span></span>
11. <span data-ttu-id="04334-141">Используйте [**мсивиевмодифи**](/windows/desktop/api/Msiquery/nf-msiquery-msiviewmodify) для обновления записи в \_ таблице Streams.</span><span class="sxs-lookup"><span data-stu-id="04334-141">Use [**MsiViewModify**](/windows/desktop/api/Msiquery/nf-msiquery-msiviewmodify) to update the record in the \_Streams table.</span></span>
12. <span data-ttu-id="04334-142">Чтобы использовать Msidb.exe для добавления CAB-файла Mycab.cab в установочный пакет с именем Mydatabase.msi, используйте следующую командную строку: Msidb.exe-d mydatabase.msi-a mycab.cab.</span><span class="sxs-lookup"><span data-stu-id="04334-142">To use Msidb.exe to add the cabinet file Mycab.cab to the installation package named Mydatabase.msi, use the following command line: Msidb.exe -d mydatabase.msi -a mycab.cab.</span></span> <span data-ttu-id="04334-143">В этом случае столбец CAB-файла таблицы мультимедиа должен содержать строку: \#mycab.cab.</span><span class="sxs-lookup"><span data-stu-id="04334-143">In this case, the Cabinet column of the Media table should contain the string: \#mycab.cab.</span></span>

 

 



