---
description: Так как сценарий установки может быть выполнен вне сеанса установки, в котором он был записан, сеанс может больше не существовать во время выполнения сценария установки.
ms.assetid: 13174c5d-c810-4b5d-9d1e-60ed30b8c44d
title: Получение сведений о контексте для отложенных настраиваемых действий выполнения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a13cd956509a5b8a4c92e0a53bfa455154a59bcc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103811285"
---
# <a name="obtaining-context-information-for-deferred-execution-custom-actions"></a><span data-ttu-id="a87d7-103">Получение сведений о контексте для отложенных настраиваемых действий выполнения</span><span class="sxs-lookup"><span data-stu-id="a87d7-103">Obtaining Context Information for Deferred Execution Custom Actions</span></span>

<span data-ttu-id="a87d7-104">Так как сценарий установки может быть выполнен вне сеанса установки, в котором он был записан, сеанс может больше не существовать во время выполнения сценария установки.</span><span class="sxs-lookup"><span data-stu-id="a87d7-104">Because installation script can be executed outside of the installation session in which it was written, the session may no longer exist during execution of the installation script.</span></span> <span data-ttu-id="a87d7-105">В этом случае исходный обработчик и свойства сеанса, заданные во время последовательности установки, недоступны для отложенного настраиваемого действия выполнения.</span><span class="sxs-lookup"><span data-stu-id="a87d7-105">In this case, the original session handle and properties set during the installation sequence are not available to a deferred execution custom action.</span></span> <span data-ttu-id="a87d7-106">Все функции, для которых требуется дескриптор сеанса, ограничены одними методами, которые могут извлекать сведения о контексте, или свойства, необходимые во время выполнения скрипта, должны быть записаны в скрипт установки.</span><span class="sxs-lookup"><span data-stu-id="a87d7-106">Any functions that require a session handle are restricted to a few methods that can retrieve context information, or else properties that are needed during script execution must be written into the installation script.</span></span> <span data-ttu-id="a87d7-107">Например, отложенные пользовательские действия, вызывающие библиотеки динамической компоновки (DLL), передают маркер, который может использоваться только для получения очень ограниченного объема информации.</span><span class="sxs-lookup"><span data-stu-id="a87d7-107">For example, deferred custom actions that call dynamic-link libraries (DLLs) pass a handle which can only be used to obtain a very limited amount of information.</span></span> <span data-ttu-id="a87d7-108">К функциям, которым не требуется доступ к обработчику сеанса, можно обращаться из отложенного настраиваемого действия.</span><span class="sxs-lookup"><span data-stu-id="a87d7-108">Functions that do not require a session handle can be accessed from a deferred custom action.</span></span>

<span data-ttu-id="a87d7-109">Пользовательские действия отложенного выполнения ограничены вызовом только следующих функций, для которых требуется маркер.</span><span class="sxs-lookup"><span data-stu-id="a87d7-109">Deferred execution custom actions are restricted to calling only the following functions requiring a handle.</span></span>



| <span data-ttu-id="a87d7-110">Функция</span><span class="sxs-lookup"><span data-stu-id="a87d7-110">Function</span></span>                                       | <span data-ttu-id="a87d7-111">Описание</span><span class="sxs-lookup"><span data-stu-id="a87d7-111">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="a87d7-112">**MsiGetProperty**</span><span class="sxs-lookup"><span data-stu-id="a87d7-112">**MsiGetProperty**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya)       | <span data-ttu-id="a87d7-113">Поддерживает ограниченный набор свойств при использовании [настраиваемых действий отложенного выполнения](deferred-execution-custom-actions.md): свойство CustomActionData, свойство [**ProductCode**](productcode.md) [**и свойство "значение"**](usersid.md) . [Зафиксировать настраиваемые действия](commit-custom-actions.md) не могут использовать функцию [**MsiGetProperty**](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya) для получения свойства [**ProductCode**](productcode.md) .</span><span class="sxs-lookup"><span data-stu-id="a87d7-113">Supports a limited set of properties when used with [deferred execution custom actions](deferred-execution-custom-actions.md): the CustomActionData property, [**ProductCode**](productcode.md) property, and [**UserSID**](usersid.md) property.[Commit custom actions](commit-custom-actions.md) cannot use the [**MsiGetProperty**](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya) function to obtain the [**ProductCode**](productcode.md) property.</span></span> <span data-ttu-id="a87d7-114">Зафиксировать настраиваемые действия могут использовать свойство CustomActionData для получения кода продукта.</span><span class="sxs-lookup"><span data-stu-id="a87d7-114">Commit custom actions can use the CustomActionData property to obtain the product code.</span></span><br/> |
| [<span data-ttu-id="a87d7-115">**мсиформатрекорд**</span><span class="sxs-lookup"><span data-stu-id="a87d7-115">**MsiFormatRecord**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msiformatrecorda)     | <span data-ttu-id="a87d7-116">Поддерживает ограниченный набор свойств при использовании [настраиваемых действий отложенного выполнения](deferred-execution-custom-actions.md): свойства CustomActionData и ProductCode.</span><span class="sxs-lookup"><span data-stu-id="a87d7-116">Supports a limited set of properties when used with [deferred execution custom actions](deferred-execution-custom-actions.md): the CustomActionData and ProductCode properties.</span></span>                                                                                                                                                                                                                                                                                                                                                      |
| [<span data-ttu-id="a87d7-117">**мсижетмоде**</span><span class="sxs-lookup"><span data-stu-id="a87d7-117">**MsiGetMode**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode)               | <span data-ttu-id="a87d7-118">При вызове из [отложенных настраиваемых действий выполнения](deferred-execution-custom-actions.md), [фиксации настраиваемых действий](commit-custom-actions.md)или [отката настраиваемых действий](rollback-custom-actions.md) [**мсижетмоде**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) возвращает true или false при запросе для проверки параметров Mode мсирунмоде \_ Schedule, мсирунмоде \_ Commit или мсирунмоде \_ Rollback.</span><span class="sxs-lookup"><span data-stu-id="a87d7-118">When called from [deferred execution custom actions](deferred-execution-custom-actions.md), [commit custom actions](commit-custom-actions.md), or [rollback custom actions](rollback-custom-actions.md), [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) returns True or False when requested to check the mode parameters MSIRUNMODE\_SCHEDULED, MSIRUNMODE\_COMMIT, or MSIRUNMODE\_ROLLBACK.</span></span> <span data-ttu-id="a87d7-119">Запросы на проверку любых других параметров режима выполнения из настраиваемого действия отложена, фиксации или отката возвращают значение false.</span><span class="sxs-lookup"><span data-stu-id="a87d7-119">Requests to check any other run mode parameters from a deferred, commit, or rollback custom action returns False.</span></span><br/>                       |
| [<span data-ttu-id="a87d7-120">**мсижетлангуаже**</span><span class="sxs-lookup"><span data-stu-id="a87d7-120">**MsiGetLanguage**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage)       | <span data-ttu-id="a87d7-121">Числовой идентификатор языка для текущего продукта. [Зафиксировать настраиваемые действия](commit-custom-actions.md) не могут использовать функцию [**мсижетлангуаже**](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage) .</span><span class="sxs-lookup"><span data-stu-id="a87d7-121">The numeric language ID for the current product.[Commit custom actions](commit-custom-actions.md) cannot use the [**MsiGetLanguage**](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage) function.</span></span> <span data-ttu-id="a87d7-122">Зафиксировать настраиваемые действия могут использовать свойство CustomActionData для получения числового идентификатора языка.</span><span class="sxs-lookup"><span data-stu-id="a87d7-122">Commit custom actions can use the CustomActionData property to get the numeric language ID.</span></span><br/>                                                                                                                                                                                                                                                           |
| [<span data-ttu-id="a87d7-123">**мсипроцессмессаже**</span><span class="sxs-lookup"><span data-stu-id="a87d7-123">**MsiProcessMessage**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) | <span data-ttu-id="a87d7-124">Обрабатывает сообщения об ошибках или ходе выполнения настраиваемого действия.</span><span class="sxs-lookup"><span data-stu-id="a87d7-124">Processes error or progress messages from the custom action.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |



 

<span data-ttu-id="a87d7-125">Для пользовательского действия, написанного на JScript или VBScript, требуется объект [**сеанса**](session-object.md) установки.</span><span class="sxs-lookup"><span data-stu-id="a87d7-125">A custom action that is written in JScript or VBScript requires the install [**Session**](session-object.md) object.</span></span> <span data-ttu-id="a87d7-126">Это относится к объекту типа **Session** , а Установщик прикрепляет его к сценарию с именем Session.</span><span class="sxs-lookup"><span data-stu-id="a87d7-126">This is of the type **Session Object** and the installer attaches it to the script with the name "Session".</span></span> <span data-ttu-id="a87d7-127">Так как объект **сеанса** может не существовать во время отката установки, отложенное настраиваемое действие, написанное в скрипте, должно использовать один из следующих методов или свойства объекта **Session** для получения контекста.</span><span class="sxs-lookup"><span data-stu-id="a87d7-127">Because the **Session** object may not exist during an installation rollback, a deferred custom action written in script must use one of the following methods or properties of the **Session** object to retrieve its context.</span></span>



| <span data-ttu-id="a87d7-128">Имя</span><span class="sxs-lookup"><span data-stu-id="a87d7-128">Name</span></span>                                                           | <span data-ttu-id="a87d7-129">Описание</span><span class="sxs-lookup"><span data-stu-id="a87d7-129">Description</span></span>                                                                                                                        |
|----------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="a87d7-130">**Режим, свойство**</span><span class="sxs-lookup"><span data-stu-id="a87d7-130">**Mode Property**</span></span>](session-mode.md)                          | <span data-ttu-id="a87d7-131">Возвращает true для МСИРУНМОДЕ \_ только по расписанию.</span><span class="sxs-lookup"><span data-stu-id="a87d7-131">Returns True for MSIRUNMODE\_SCHEDULED only.</span></span>                                                                                       |
| [<span data-ttu-id="a87d7-132">**Свойство Property (объект Session)**</span><span class="sxs-lookup"><span data-stu-id="a87d7-132">**Property Property (Session Object)**</span></span>](session-session.md)  | <span data-ttu-id="a87d7-133">Возвращает свойство CustomActionData, свойство [**ProductCode**](productcode.md) [**или свойство "значение"**](usersid.md) .</span><span class="sxs-lookup"><span data-stu-id="a87d7-133">Returns the CustomActionData property, [**ProductCode**](productcode.md) property, or [**UserSID**](usersid.md) property.</span></span>        |
| [<span data-ttu-id="a87d7-134">**Свойство Language (объект Session)**</span><span class="sxs-lookup"><span data-stu-id="a87d7-134">**Language Property (Session Object)**</span></span>](session-language.md) | <span data-ttu-id="a87d7-135">Возвращает числовой идентификатор языка сеанса установки.</span><span class="sxs-lookup"><span data-stu-id="a87d7-135">Returns numeric language ID of the installation session.</span></span>                                                                           |
| [<span data-ttu-id="a87d7-136">**Метод сообщения**</span><span class="sxs-lookup"><span data-stu-id="a87d7-136">**Message Method**</span></span>](session-message.md)                      | <span data-ttu-id="a87d7-137">Вызывается для обработки ошибок и хода выполнения.</span><span class="sxs-lookup"><span data-stu-id="a87d7-137">Called to handle errors and progress.</span></span>                                                                                              |
| [<span data-ttu-id="a87d7-138">**Свойство установщика**</span><span class="sxs-lookup"><span data-stu-id="a87d7-138">**Installer Property**</span></span>](session-installer.md)                | <span data-ttu-id="a87d7-139">Возвращает родительский объект, который используется для функций, не являющихся сеансами, таких как доступ к реестру и управление конфигурацией установщика.</span><span class="sxs-lookup"><span data-stu-id="a87d7-139">Returns the parent object, which is used for non-session functions such as registry access and installer configuration management.</span></span> |



 

<span data-ttu-id="a87d7-140">Значения свойств, заданные во время обработки последовательности установки в скрипте, могут быть недоступны во время выполнения скрипта.</span><span class="sxs-lookup"><span data-stu-id="a87d7-140">Property values that are set at the time the installation sequence is processed into script may be unavailable at the time of script execution.</span></span> <span data-ttu-id="a87d7-141">Только следующий ограниченный набор свойств всегда доступен для настраиваемых действий во время выполнения скрипта.</span><span class="sxs-lookup"><span data-stu-id="a87d7-141">Only the following limited set of properties is always accessible to custom actions during script execution.</span></span>



| <span data-ttu-id="a87d7-142">Имя свойства</span><span class="sxs-lookup"><span data-stu-id="a87d7-142">Property name</span></span>                      | <span data-ttu-id="a87d7-143">Описание</span><span class="sxs-lookup"><span data-stu-id="a87d7-143">Description</span></span>                                                                                                                                                                                                     |
|------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="a87d7-144">CustomActionData</span><span class="sxs-lookup"><span data-stu-id="a87d7-144">CustomActionData</span></span>                   | <span data-ttu-id="a87d7-145">Значение на момент времени в таблице последовательностей обрабатывается настраиваемое действие.</span><span class="sxs-lookup"><span data-stu-id="a87d7-145">Value at time custom action is processed in sequence table.</span></span> <span data-ttu-id="a87d7-146">Свойство CustomActionData доступно только для отложенных настраиваемых действий выполнения.</span><span class="sxs-lookup"><span data-stu-id="a87d7-146">The CustomActionData property is only available to deferred execution custom actions.</span></span> <span data-ttu-id="a87d7-147">Непосредственные настраиваемые действия не имеют доступа к этому свойству.</span><span class="sxs-lookup"><span data-stu-id="a87d7-147">Immediate custom actions do not have access to this property.</span></span> |
| [<span data-ttu-id="a87d7-148">**ProductCode**</span><span class="sxs-lookup"><span data-stu-id="a87d7-148">**ProductCode**</span></span>](productcode.md) | <span data-ttu-id="a87d7-149">Уникальный код для продукта, строка [GUID](guid.md) .</span><span class="sxs-lookup"><span data-stu-id="a87d7-149">Unique code for the product, a [GUID](guid.md) string.</span></span>                                                                                                                                                         |
| [<span data-ttu-id="a87d7-150">**UserSID**</span><span class="sxs-lookup"><span data-stu-id="a87d7-150">**UserSID**</span></span>](usersid.md)         | <span data-ttu-id="a87d7-151">Задается установщиком для идентификатора безопасности (SID) пользователя.</span><span class="sxs-lookup"><span data-stu-id="a87d7-151">Set by the installer to the user's security identifier (SID).</span></span>                                                                                                                                                   |



 

<span data-ttu-id="a87d7-152">Если для отложенного выполнения настраиваемого действия требуются другие данные свойств, их значения должны храниться в скрипте установки.</span><span class="sxs-lookup"><span data-stu-id="a87d7-152">If other property data is required by the deferred execution custom action, then their values must be stored in the installation script.</span></span> <span data-ttu-id="a87d7-153">Это можно сделать с помощью второго настраиваемого действия.</span><span class="sxs-lookup"><span data-stu-id="a87d7-153">This can be done by using a second custom action.</span></span>

<span data-ttu-id="a87d7-154">**Запись значения свойства в скрипт установки для использования во время отложенного выполнения настраиваемого действия**</span><span class="sxs-lookup"><span data-stu-id="a87d7-154">**To write the value of a property into the installation script for use during a deferred execution custom action**</span></span>

1.  <span data-ttu-id="a87d7-155">Вставьте небольшое пользовательское действие в последовательность установки, которое задает интересующее свойство свойства, имя которого совпадает с именем отложенного выполнения настраиваемого действия.</span><span class="sxs-lookup"><span data-stu-id="a87d7-155">Insert a small custom action into the installation sequence that sets the property of interest to a property having the same name as the deferred execution custom action.</span></span> <span data-ttu-id="a87d7-156">Например, если первичный ключ для настраиваемого действия отложенного выполнения имеет значение "Мяктион", задайте свойству с именем "Мяктион" значение свойства X, которое необходимо получить.</span><span class="sxs-lookup"><span data-stu-id="a87d7-156">For example, if the primary key for the deferred execution custom action is "MyAction" set a property named "MyAction" to the property X which you need to retrieve.</span></span> <span data-ttu-id="a87d7-157">Необходимо задать свойство "Мяктион" в последовательности установки перед настраиваемым действием "Мяктион".</span><span class="sxs-lookup"><span data-stu-id="a87d7-157">You must set the "MyAction" property in the installation sequence before the "MyAction" custom action.</span></span> <span data-ttu-id="a87d7-158">Хотя любой тип настраиваемого действия может задавать данные контекста, простейшим методом является использование настраиваемого действия назначения свойств (например, [тип настраиваемого действия 51](custom-action-type-51.md)).</span><span class="sxs-lookup"><span data-stu-id="a87d7-158">Although any type of custom action can set the context data, the simplest method is to use a property assignment custom action (for example [Custom Action Type 51](custom-action-type-51.md)).</span></span>
2.  <span data-ttu-id="a87d7-159">Во время обработки последовательности установки установщик записывает значение свойства X в скрипт выполнения как значение свойства CustomActionData.</span><span class="sxs-lookup"><span data-stu-id="a87d7-159">At the time when the installation sequence is processed, the installer will write the value of property X into the execution script as the value of the property CustomActionData.</span></span>

## <a name="related-topics"></a><span data-ttu-id="a87d7-160">См. также</span><span class="sxs-lookup"><span data-stu-id="a87d7-160">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a87d7-161">Сведения о свойствах</span><span class="sxs-lookup"><span data-stu-id="a87d7-161">About Properties</span></span>](about-properties.md)
</dt> <dt>

[<span data-ttu-id="a87d7-162">Использование свойств</span><span class="sxs-lookup"><span data-stu-id="a87d7-162">Using Properties</span></span>](using-properties.md)
</dt> <dt>

[<span data-ttu-id="a87d7-163">Справочник по свойствам</span><span class="sxs-lookup"><span data-stu-id="a87d7-163">Property Reference</span></span>](property-reference.md)
</dt> </dl>

 

 




