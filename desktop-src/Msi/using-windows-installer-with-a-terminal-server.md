---
description: Приведенные ниже инструкции могут повлиять на установщик Windows установки при использовании сервера терминалов. Разработчики программы установки должны всегда проверять, что их установщик Windows устанавливаются, как и ожидается, когда пользователи также используют сервер терминалов.
ms.assetid: deda9efa-a0fc-4b4e-a531-650ac201fd84
title: Использование установщик Windows с сервером терминалов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d471fa19b4588a01a2730af44fa5e9d978d18859
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104497247"
---
# <a name="using-windows-installer-with-a-terminal-server"></a><span data-ttu-id="81144-104">Использование установщик Windows с сервером терминалов</span><span class="sxs-lookup"><span data-stu-id="81144-104">Using Windows Installer with a Terminal Server</span></span>

<span data-ttu-id="81144-105">Приведенные ниже инструкции могут повлиять на установщик Windows установки при использовании сервера терминалов.</span><span class="sxs-lookup"><span data-stu-id="81144-105">The following may affect Windows Installer installations when using a terminal server.</span></span> <span data-ttu-id="81144-106">Разработчики программы установки должны всегда проверять, что их установщик Windows устанавливаются, как и ожидается, когда пользователи также используют сервер терминалов.</span><span class="sxs-lookup"><span data-stu-id="81144-106">Setup developers should always test that their Windows Installer package installs as expected when users are also using a terminal server.</span></span>

-   <span data-ttu-id="81144-107">В операционных системах, предшествующих Windows Server 2008 и Windows Vista, системная политика [енаблеадминтсремоте](enableadmintsremote.md) должна быть настроена, чтобы позволить администраторам выполнять установки в клиентском сеансе.</span><span class="sxs-lookup"><span data-stu-id="81144-107">On operating systems earlier than Windows Server 2008 and Windows Vista, the [EnableAdminTSRemote](enableadmintsremote.md) system policy must be set to enable administrators to perform installations in the client session.</span></span> <span data-ttu-id="81144-108">Начиная с Windows Server 2008 и Windows Vista, политика Енаблеадминтсремоте больше не оказывает никакого воздействия.</span><span class="sxs-lookup"><span data-stu-id="81144-108">Beginning with Windows Server 2008 and Windows Vista, the EnableAdminTSRemote policy no longer has any effect.</span></span> <span data-ttu-id="81144-109">Независимо от его настройки администраторы и другие администраторы могут выполнять установку в сеансе клиента или в сеансе консоли.</span><span class="sxs-lookup"><span data-stu-id="81144-109">Regardless of its setting, administrators and non-administrators can perform an installation in the client session or the console session.</span></span> <span data-ttu-id="81144-110">Администраторы и другие администраторы всегда могут выполнять установщик Windows установки в сеансе консоли.</span><span class="sxs-lookup"><span data-stu-id="81144-110">Administrators and non-administrators can always perform Windows Installer installations in the console session.</span></span>
-   <span data-ttu-id="81144-111">Установщик Windows предотвращает установку в [контексте установки](installation-context.md) на уровне пользователя, если[Системная политика](system-policy.md) [дисаблеусеринсталлс](disableuserinstalls.md)имеет значение 1.</span><span class="sxs-lookup"><span data-stu-id="81144-111">The Windows Installer prevents installation in the per-user [installation context](installation-context.md) if the [DisableUserInstalls](disableuserinstalls.md)[system policy](system-policy.md) is set to 1.</span></span> <span data-ttu-id="81144-112">В этом случае установщик пропускает все приложения, зарегистрированные как "на пользователя", и выполняет поиск только для приложений, зарегистрированных как для каждого компьютера.</span><span class="sxs-lookup"><span data-stu-id="81144-112">In this case, the installer ignores all applications registered as per-user and searches only for applications registered as per-machine.</span></span>
-   <span data-ttu-id="81144-113">Когда администратор выполняет установку в сеансе клиента сервера терминалов, размещенного в Windows 2000, при установке необходимо использовать UNC-путь, а не букву подключенного диска.</span><span class="sxs-lookup"><span data-stu-id="81144-113">When an administrator performs an installation in a client session of a terminal server that is hosted in Windows 2000, the installation must use a UNC path and not a mapped drive letter.</span></span>

<span data-ttu-id="81144-114">При разработке установщик Windows компонента, который может использоваться с сервером терминалов, разработчикам следует соблюдать следующие рекомендации.</span><span class="sxs-lookup"><span data-stu-id="81144-114">Developers should adhere to the following guidelines when developing a Windows Installer component that may be used with a terminal server.</span></span>

-   <span data-ttu-id="81144-115">Запишите все данные реестра **HKCU** в разделе \\ **программного обеспечения** HKCU в реестре.</span><span class="sxs-lookup"><span data-stu-id="81144-115">Write all **HKCU** registry information in the **HKCU**\\**Software** part of the registry.</span></span>
-   <span data-ttu-id="81144-116">Хранение сведений о конфигурации в INI-файлах не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="81144-116">Storing configuration information in INI files is not recommended.</span></span>
-   <span data-ttu-id="81144-117">Запись сведений для каждого пользователя в реестр при первом запуске приложения, а не во время установки.</span><span class="sxs-lookup"><span data-stu-id="81144-117">Write per-user information to the registry when the application is run for the first time and not at installation time.</span></span> <span data-ttu-id="81144-118">Если во время установки необходимо записывать сведения для каждого пользователя в реестр, разделите сведения для каждого пользователя и компьютера на разные установщик Windows компоненты.</span><span class="sxs-lookup"><span data-stu-id="81144-118">If you must write per-user information to the registry at installation time, separate the per-user and per-machine information into different Windows Installer components.</span></span> <span data-ttu-id="81144-119">Создайте пакет таким же, чтобы установщик не пытался проверить и восстановить компоненты, содержащие сведения о пользователе при установке приложения.</span><span class="sxs-lookup"><span data-stu-id="81144-119">Author the package such that the installer does not attempt to validate and repair the components containing per-user information when the application is installed.</span></span>
-   <span data-ttu-id="81144-120">Пакет, используемый только для установки на компьютере, должен записывать переменные среды в среду компьютера, включив \* в столбец Name [таблицы Environment](environment-table.md).</span><span class="sxs-lookup"><span data-stu-id="81144-120">A package used for only per-machine installations should write environment variables to the computer's environment by including \* in the Name column of the [Environment Table](environment-table.md).</span></span> <span data-ttu-id="81144-121">Если пакет можно использовать для установки на уровне пользователя или для отдельных компьютеров, используйте два компонента.</span><span class="sxs-lookup"><span data-stu-id="81144-121">If the package can be used for per-user installations or per-machine installations, use two components.</span></span> <span data-ttu-id="81144-122">Включите компонент для каждого пользователя в [таблицу Component](condition-table.md) и введите параметры пользователя в таблице среда.</span><span class="sxs-lookup"><span data-stu-id="81144-122">Include the per-user component in the [Component Table](condition-table.md) and enter the user settings in the Environment Table.</span></span> <span data-ttu-id="81144-123">Включите компонент для компьютера в таблицу Component и введите параметры компьютера в таблице среда.</span><span class="sxs-lookup"><span data-stu-id="81144-123">Include the per-machine component in the Component Table and enter the computer settings in the Environment Table.</span></span> <span data-ttu-id="81144-124">Управление установкой компонента с помощью условных операторов на основе свойства [**ALLUSERS**](allusers.md) в поле Условие таблицы Component.</span><span class="sxs-lookup"><span data-stu-id="81144-124">Control which component gets installed by using conditional statements based upon the [**ALLUSERS**](allusers.md) property in the Condition field of the Component Table.</span></span>
-   <span data-ttu-id="81144-125">При выполнении установки на компьютере с сервера терминалов установщик записывает переменные среды для отдельных пользователей в **HKCU** \\ **. Среда по умолчанию** \\ .</span><span class="sxs-lookup"><span data-stu-id="81144-125">When performing per-machine installations from a terminal server, the installer writes per-user environment variables to **HKCU**\\ **.Default**\\**Environment**.</span></span> <span data-ttu-id="81144-126">Так как сервер терминалов не реплицирует этот раздел реестра, при установке не устанавливаются переменные среды для отдельных пользователей.</span><span class="sxs-lookup"><span data-stu-id="81144-126">Because the terminal server does not replicate this section of the registry, the installation does not set the per-user environment variables.</span></span>
-   <span data-ttu-id="81144-127">Так как сервер можно настроить таким образом, чтобы пользователи не могли восстанавливать приложения, приложение должно надлежащим образом обрабатывать регистр отсутствующих разделов реестра.</span><span class="sxs-lookup"><span data-stu-id="81144-127">Because a server may be configured to prevent users from repairing applications, your application should handle the case of missing registry keys gracefully.</span></span>

<span data-ttu-id="81144-128">Следующее применимо, если пакет установщик Windows, использующий библиотеки DLL, EXE или [Настраиваемые действия](custom-actions.md) сценария, устанавливается в контексте установки на компьютере на сервере терминалов.</span><span class="sxs-lookup"><span data-stu-id="81144-128">The following applies when a Windows Installer package that uses DLL, EXE, or Script [custom actions](custom-actions.md) is installed in the per-machine installation context on a terminal server.</span></span> <span data-ttu-id="81144-129">В этом случае установщик задает свойство [**терминалсервер**](terminalserver.md) .</span><span class="sxs-lookup"><span data-stu-id="81144-129">In this case, the installer sets the [**TerminalServer**](terminalserver.md) property.</span></span>

-   <span data-ttu-id="81144-130">Отложенные настраиваемые действия выполняются в контексте локальной системы, если только действие не имеет атрибута **мсидбкустомактионтипетсаваре** .</span><span class="sxs-lookup"><span data-stu-id="81144-130">Deferred custom actions run in the context of the local system unless the action has the **msidbCustomActionTypeTSAware** attribute.</span></span> <span data-ttu-id="81144-131">Это справедливо даже в том случае, если пользовательское действие олицетворяет пользователя в системе, которая не является сервером терминалов.</span><span class="sxs-lookup"><span data-stu-id="81144-131">This is true even if the custom action impersonates the user on a system that is not a terminal server.</span></span> <span data-ttu-id="81144-132">Обратите внимание, что если пользовательское действие с атрибутом **мсидбкустомактионтипетсаваре** изменяет реестр пользователя, установщик не гарантирует, что эти изменения также будут внесены в реестр каждого пользователя компьютера.</span><span class="sxs-lookup"><span data-stu-id="81144-132">Note that if a custom action having the **msidbCustomActionTypeTSAware** attribute changes the user's registry, the installer does not automatically ensure that those changes are also made in the registry of every user on the computer.</span></span>
-   <span data-ttu-id="81144-133">Любые операции реестра в отложенном настраиваемом действии, которые считываются из куста реестра **HKCU** , видят куст реестра по умолчанию, а не куст реестра текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="81144-133">Any registry operations in a deferred custom action that read from the **HKCU** registry hive sees the system's default registry hive and not the current user's registry hive.</span></span>
-   <span data-ttu-id="81144-134">Все операции с реестром в отложенном пользовательском действии, которое записывает в \\ **программное обеспечение** HKCU, обнаруживаются установщиком и копируются каждому пользователю компьютера при следующем входе пользователя в систему.</span><span class="sxs-lookup"><span data-stu-id="81144-134">Any registry operations in a deferred custom action that write to **HKCU**\\**Software** are detected by the installer and copied to every user of the computer at the next logon of the user.</span></span>
-   <span data-ttu-id="81144-135">Все операции с реестром в отложенном пользовательском действии, которое записывает в **HKCU**, но не находятся в разделе реестра **HKCU** \\  , не обнаруживаются установщиком или не копируются.</span><span class="sxs-lookup"><span data-stu-id="81144-135">Any registry operations in a deferred custom action that write to **HKCU**, but are not under the **HKCU**\\**Software** registry key, are not detected by the installer or copied.</span></span>

<span data-ttu-id="81144-136">Дополнительные сведения см. в статье [службы терминалов](../termserv/terminal-services-portal.md) в пакете средств разработки программного обеспечения (SDK) для Microsoft Windows.</span><span class="sxs-lookup"><span data-stu-id="81144-136">For more information, see [Terminal Services](../termserv/terminal-services-portal.md) in the Microsoft Windows Software Development Kit (SDK).</span></span>

## <a name="related-topics"></a><span data-ttu-id="81144-137">См. также</span><span class="sxs-lookup"><span data-stu-id="81144-137">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="81144-138">енаблеадминтсремоте</span><span class="sxs-lookup"><span data-stu-id="81144-138">EnableAdminTSRemote</span></span>](enableadmintsremote.md)
</dt> <dt>

[<span data-ttu-id="81144-139">**Терминалсервер, свойство**</span><span class="sxs-lookup"><span data-stu-id="81144-139">**TerminalServer property**</span></span>](terminalserver.md)
</dt> <dt>

[<span data-ttu-id="81144-140">**Ремотеадминтс, свойство**</span><span class="sxs-lookup"><span data-stu-id="81144-140">**RemoteAdminTS property**</span></span>](remoteadmints.md)
</dt> <dt>

[<span data-ttu-id="81144-141">Службы терминалов</span><span class="sxs-lookup"><span data-stu-id="81144-141">Terminal Services</span></span>](../termserv/terminal-services-portal.md)
</dt> </dl>

 

 
