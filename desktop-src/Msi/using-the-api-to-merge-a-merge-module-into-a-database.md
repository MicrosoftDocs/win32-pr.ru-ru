---
description: Модули слияния обеспечивают стандартный способ предоставления разработчикам общих установщик Windows компонентов и логики установки приложений.
ms.assetid: 3eb087b1-0f44-40d8-a950-67d489f09408
title: Использование API для слияния модуля слияния с базой данных
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2e68298671045825dda41ad120896fa22c89f068
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105650960"
---
# <a name="using-the-api-to-merge-a-merge-module-into-a-database"></a><span data-ttu-id="7b4dd-103">Использование API для слияния модуля слияния с базой данных</span><span class="sxs-lookup"><span data-stu-id="7b4dd-103">Using the API to Merge a Merge Module into a Database</span></span>

<span data-ttu-id="7b4dd-104">[Модули слияния](merge-modules.md) обеспечивают стандартный способ предоставления разработчикам общих установщик Windows [*компонентов*](c-gly.md) и логики установки приложений.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-104">[Merge modules](merge-modules.md) provide a standard method for developers to deliver shared Windows Installer [*components*](c-gly.md) and setup logic to their applications.</span></span> <span data-ttu-id="7b4dd-105">Модули слияния должны быть объединены в установочный пакет с помощью средства слияния.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-105">Merge modules must be merged into an installation package using a merge tool.</span></span> <span data-ttu-id="7b4dd-106">Лучшим вариантом является получение свободно распределенного инструмента слияния или приобретение одного из средств слияния, доступных от независимых поставщиков программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-106">The best alternative is to obtain a freely distributed merge tool or purchase one of the merging tools available from independent software vendors.</span></span> <span data-ttu-id="7b4dd-107">Например, можно использовать функциональные возможности, предоставляемые [Mergemod.dll](merge-module-automation.md).</span><span class="sxs-lookup"><span data-stu-id="7b4dd-107">For example you can use the functionality provided by [Mergemod.dll](merge-module-automation.md).</span></span>

<span data-ttu-id="7b4dd-108">Выполните следующие действия, чтобы объединить модуль слияния в базу данных установки установщик Windows с помощью API [Mergemod.dll](merge-module-automation.md).</span><span class="sxs-lookup"><span data-stu-id="7b4dd-108">Use the following steps in sequence to merge a merge module into a Windows Installer installation database by the API of [Mergemod.dll](merge-module-automation.md).</span></span>

<span data-ttu-id="7b4dd-109">**Объединение модуля слияния в базу данных установки установщик Windows**</span><span class="sxs-lookup"><span data-stu-id="7b4dd-109">**To merge a merge module into a Windows Installer installation database**</span></span>

1.  <span data-ttu-id="7b4dd-110">Откройте файл журнала с помощью [**опенлог**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openlog).</span><span class="sxs-lookup"><span data-stu-id="7b4dd-110">Open a log file using [**OpenLog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openlog).</span></span> <span data-ttu-id="7b4dd-111">Этот шаг необходим только в том случае, если необходимо создать файл журнала или добавить существующий файл журнала для процесса слияния.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-111">This step is required only if you need to create a log file, or append an existing log file, for the merge process.</span></span>
2.  <span data-ttu-id="7b4dd-112">Откройте базу данных установки, [файл MSI](windows-installer-file-extensions.md), который будет принимать модуль слияния с помощью [**опендатабасе**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-opendatabase).</span><span class="sxs-lookup"><span data-stu-id="7b4dd-112">Open the installation database, an [.msi file](windows-installer-file-extensions.md), that will receive the merge module using [**OpenDatabase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-opendatabase).</span></span> <span data-ttu-id="7b4dd-113">Этот шаг является обязательным.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-113">This step is required.</span></span>
3.  <span data-ttu-id="7b4dd-114">Откройте модуль слияния (MSM- [файл](windows-installer-file-extensions.md)), который объединяется с базой данных с помощью [**опенмодуле**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openmodule).</span><span class="sxs-lookup"><span data-stu-id="7b4dd-114">Open the merge module, an [.msm file](windows-installer-file-extensions.md), that is being merged into the database using [**OpenModule**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openmodule).</span></span> <span data-ttu-id="7b4dd-115">Модуль необходимо открыть, прежде чем его можно будет объединить с базой данных установки.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-115">A module must be opened before it can be merged with an installation database.</span></span> <span data-ttu-id="7b4dd-116">Этот шаг является обязательным.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-116">This step is required.</span></span>
4.  <span data-ttu-id="7b4dd-117">Объедините модуль в базу данных установки с помощью [**Merge**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-merge) или [**мержеекс**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-mergeex).</span><span class="sxs-lookup"><span data-stu-id="7b4dd-117">Merge the module into the installation database by using [**Merge**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-merge) or [**MergeEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-mergeex).</span></span> <span data-ttu-id="7b4dd-118">Обратите внимание, что **Merge** или **мержеекс** можно вызывать только один раз для слияния определенного сочетания файлов. msi и. msm.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-118">Note that **Merge** or **MergeEx** can only be called once to merge a particular combination of .msi and .msm files.</span></span> <span data-ttu-id="7b4dd-119">**Мержеекс** доступен только при использовании [Mergemod.dll версии 2,0](merge-module-automation.md) или более поздней и только при использовании интерфейса [IMsmMerge2](/windows/desktop/api/Mergemod/nn-mergemod-imsmmerge2) .</span><span class="sxs-lookup"><span data-stu-id="7b4dd-119">**MergeEx** is only available when using [Mergemod.dll version 2.0](merge-module-automation.md) or later and only when using the [IMsmMerge2](/windows/desktop/api/Mergemod/nn-mergemod-imsmmerge2) interface.</span></span> <span data-ttu-id="7b4dd-120">Этот шаг является обязательным.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-120">This step is required.</span></span>
5.  <span data-ttu-id="7b4dd-121">Вызывайте [**\_ ошибки Get**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-get_errors) и изучите извлеченную коллекцию ошибок для конфликтов слияния или других ошибок.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-121">Call [**get\_Errors**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-get_errors) and examine the retrieved collection of errors for merge conflicts or other errors.</span></span> <span data-ttu-id="7b4dd-122">Извлечение является обратимым.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-122">The retrieval is non-destructive.</span></span> <span data-ttu-id="7b4dd-123">Несколько экземпляров коллекции ошибок могут быть извлечены путем многократного чтения вызывающих **\_ ошибок Get**.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-123">Multiple instances of the error collection may be retrieved by repeatedly reading calling **get\_Errors**.</span></span> <span data-ttu-id="7b4dd-124">Вам потребуется устранить все ошибки в случае необходимости.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-124">You will need to resolve any errors as appropriate for your case.</span></span>
6.  <span data-ttu-id="7b4dd-125">Свяжите компоненты модуля слияния с другими дополнительными компонентами, которые были объединены в базу данных установки с помощью [**подключения**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-connect).</span><span class="sxs-lookup"><span data-stu-id="7b4dd-125">Associate the components of the merge module with any additional features that have been, or will be, merged into the installation database using [**Connect**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-connect).</span></span> <span data-ttu-id="7b4dd-126">Эта функция уже должна существовать до вызова этого метода.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-126">The feature must already exist before calling this method.</span></span> <span data-ttu-id="7b4dd-127">Этот шаг требуется, только если у вас есть дополнительные функции. Дополнительные сведения см. [в разделе Подключение модуля слияния к нескольким функциям](connecting-a-merge-module-to-multiple-features.md) .</span><span class="sxs-lookup"><span data-stu-id="7b4dd-127">This step is only required if you have additional features, for more information see [Connecting a Merge Module to Multiple Features](connecting-a-merge-module-to-multiple-features.md)</span></span>
7.  <span data-ttu-id="7b4dd-128">При необходимости извлеките исходные файлы из модуля, выполнив одно или несколько из следующих действий.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-128">If necessary, extract source files from the module by doing one or more of the following.</span></span>

    <span data-ttu-id="7b4dd-129">Чтобы извлечь файлы из внедренного CAB-файла, а затем скопировать их в указанный каталог, используйте [**екстрактфилес**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractfiles) или [**екстрактфилесекс**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-extractfilesex).</span><span class="sxs-lookup"><span data-stu-id="7b4dd-129">To extract files from an embedded .cab file and then copy into a specified directory, use [**ExtractFiles**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractfiles) or [**ExtractFilesEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-extractfilesex).</span></span> <span data-ttu-id="7b4dd-130">Обратите внимание, что для **екстрактфилесекс** требуется [Mergemod.dll версии 2,0](merge-module-automation.md) или более поздней.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-130">Note that **ExtractFilesEx** requires [Mergemod.dll version 2.0](merge-module-automation.md) or later.</span></span>

    <span data-ttu-id="7b4dd-131">Чтобы извлечь файлы из внедренного CAB-файла и затем сохранить их в указанном файле, используйте [**екстракткаб**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractcab).</span><span class="sxs-lookup"><span data-stu-id="7b4dd-131">To extract files from an embedded .cab file and then save in a specified file, use [**ExtractCAB**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractcab).</span></span>

    <span data-ttu-id="7b4dd-132">Чтобы извлечь файлы из модуля и затем скопировать их в исходное изображение на диске после слияния, используйте [**креатесаурцеимаже**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-createsourceimage).</span><span class="sxs-lookup"><span data-stu-id="7b4dd-132">To extract files from a module and then copy to a source image on disk after the merge, use [**CreateSourceImage**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-createsourceimage).</span></span> <span data-ttu-id="7b4dd-133">Обратите внимание, что **креатесаурцеимаже** доступен только в [Mergemod.dll версии 2,0](merge-module-automation.md) или более поздней.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-133">Note that **CreateSourceImage** is only available with [Mergemod.dll version 2.0](merge-module-automation.md) or later.</span></span>

8.  <span data-ttu-id="7b4dd-134">Закройте текущий открытый модуль слияния с помощью [**клосемодуле**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closemodule).</span><span class="sxs-lookup"><span data-stu-id="7b4dd-134">Close the current open merge module using [**CloseModule**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closemodule).</span></span> <span data-ttu-id="7b4dd-135">Этот шаг является обязательным.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-135">This step is required.</span></span>
9.  <span data-ttu-id="7b4dd-136">Закройте текущую открытую базу данных установки с помощью [**клоседатабасе**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closedatabase).</span><span class="sxs-lookup"><span data-stu-id="7b4dd-136">Close the current open installation database using [**CloseDatabase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closedatabase).</span></span> <span data-ttu-id="7b4dd-137">Этот шаг является обязательным.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-137">This step is required.</span></span> <span data-ttu-id="7b4dd-138">При закрытии базы данных удаляются все сведения о зависимостях, но не затрагиваются все ошибки, которые не были получены.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-138">Closing a database clears all dependency information but does not affect any errors that have not been retrieved.</span></span>
10. <span data-ttu-id="7b4dd-139">Закройте текущий файл журнала с помощью [**клоселог**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closelog).</span><span class="sxs-lookup"><span data-stu-id="7b4dd-139">Close the current log file using [**CloseLog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closelog).</span></span> <span data-ttu-id="7b4dd-140">Этот шаг необходим, если вы открыли файл журнала.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-140">This step is required if you have opened a log file.</span></span>

<span data-ttu-id="7b4dd-141">После слияния модуля с базой данных с помощью [Mergemod.dll](merge-module-automation.md)необходимо обновить [таблицу мультимедиа](media-table.md) , чтобы описать нужный макет исходного изображения.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-141">After the module has been merged into the database using [Mergemod.dll](merge-module-automation.md), the [Media Table](media-table.md) must be updated to describe the desired source image layout.</span></span> <span data-ttu-id="7b4dd-142">Процесс слияния, предоставляемый Mergemod.dll, не обновляет таблицу мультимедиа, так как потребитель модуля слияния может выбрать различные способы размещения исходного изображения.</span><span class="sxs-lookup"><span data-stu-id="7b4dd-142">The merge process provided by Mergemod.dll does not update the Media Table because the consumer of the merge module can select various ways to layout the source image.</span></span>

 

 
