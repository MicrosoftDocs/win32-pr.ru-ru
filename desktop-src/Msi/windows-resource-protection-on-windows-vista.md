---
description: Установщик Windows придерживается защита ресурсов Windows (WRP) при установке необходимых системных файлов, папок и данных реестра в Windows Server 2008 и более поздних версиях и Windows Vista и более поздних версиях.
ms.assetid: 38865ee1-22ef-430b-99ce-1c6983c3b51f
title: Использование установщик Windows и защита ресурсов Windows
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 72808184ff11b29bfeb02dda576e9393e34189fd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103998738"
---
# <a name="using-windows-installer-and-windows-resource-protection"></a><span data-ttu-id="f6061-103">Использование установщик Windows и защита ресурсов Windows</span><span class="sxs-lookup"><span data-stu-id="f6061-103">Using Windows Installer and Windows Resource Protection</span></span>

<span data-ttu-id="f6061-104">Установщик Windows придерживается защита ресурсов Windows (WRP) при установке необходимых системных файлов, папок и данных реестра в Windows Server 2008 и более поздних версиях и Windows Vista и более поздних версиях.</span><span class="sxs-lookup"><span data-stu-id="f6061-104">Windows Installer adheres to Windows Resource Protection (WRP) when installing essential system files, folders, and registry information in Windows Server 2008 and later and Windows Vista and later.</span></span>

<span data-ttu-id="f6061-105">WRP в Windows Server 2008 и Windows Vista заменяет защиту файлов Windows (WFP) в Windows Server 2003, Windows XP и Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="f6061-105">WRP in Windows Server 2008 and Windows Vista replaces Windows File Protection (WFP) in Windows Server 2003, Windows XP, and Windows 2000.</span></span> <span data-ttu-id="f6061-106">Разработчикам установщик Windows следует отметить следующие изменения в том, как установщик обрабатывает защищенные ресурсы в Windows Server 2008 и более поздних версиях, а также в Windows Vista и более поздних версиях.</span><span class="sxs-lookup"><span data-stu-id="f6061-106">Windows Installer developers should note the following changes in how the installer handles protected resources in Windows Server 2008 and later and Windows Vista and later:</span></span>

-   <span data-ttu-id="f6061-107">При работе в Windows Server 2008 и более поздних версий или Windows Vista и более поздних версиях установщик Windows пропускает установку любого файла, защищенного WRP, установщик вводит предупреждение в файл журнала и продолжит выполнение оставшейся части установки без ошибки.</span><span class="sxs-lookup"><span data-stu-id="f6061-107">When running on Windows Server 2008 and later or Windows Vista and later, the Windows Installer skips the installation of any file that is protected by WRP, the installer enters a warning in the log file, and continues with the remainder of the installation without an error.</span></span> <span data-ttu-id="f6061-108">В Windows Server 2003, Windows XP и Windows 2000, когда установщик Windows обнаружил файл, защищенный с помощью WFP, установщик запрашивает установку файла в WFP.</span><span class="sxs-lookup"><span data-stu-id="f6061-108">In Windows Server 2003, Windows XP, and Windows 2000, when the Windows Installer encountered a WFP-protected file, the installer would request that WFP install the file.</span></span>
-   <span data-ttu-id="f6061-109">WRP в Windows Server 2008 и более поздних версиях или Windows Vista и более поздних версий может защищать разделы реестра в дополнение к файлам.</span><span class="sxs-lookup"><span data-stu-id="f6061-109">WRP on Windows Server 2008 and later or Windows Vista and later can protect registry keys in addition to files.</span></span> <span data-ttu-id="f6061-110">Если установщик Windows обнаруживает раздел реестра, защищенный WRP, установщик пропускает установку этого раздела реестра, установщик вводит предупреждение в файл журнала и продолжит выполнение оставшейся части установки без ошибки.</span><span class="sxs-lookup"><span data-stu-id="f6061-110">If the Windows Installer encounters a WRP-protected registry key, the installer skips the installation of that registry key, the installer enters a warning in the log file, and continues with the remainder of the installation without an error.</span></span>
-   <span data-ttu-id="f6061-111">Обратите внимание, что если компонент установщик Windows содержит файл или раздел реестра, защищенный WRP, этот ресурс должен использоваться в качестве ключевого пути для компонента.</span><span class="sxs-lookup"><span data-stu-id="f6061-111">Note that if a Windows Installer component contains a file or registry key that is protected by WRP, this resource must be used as the KeyPath for the component.</span></span> <span data-ttu-id="f6061-112">В этом случае установщик Windows не устанавливает, не обновляет или не удаляет компонент.</span><span class="sxs-lookup"><span data-stu-id="f6061-112">In this case, Windows Installer does not install, update, or remove the component.</span></span> <span data-ttu-id="f6061-113">В пакет установки не следует включать защищенные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="f6061-113">You should not include any protected resources in an installation package.</span></span> <span data-ttu-id="f6061-114">Вместо этого следует использовать [поддерживаемые механизмы замены ресурсов](../wfp/supported-file-replacement-mechanisms.md) для [Защита ресурсов Windows](../wfp/windows-resource-protection-portal.md).</span><span class="sxs-lookup"><span data-stu-id="f6061-114">Instead, you should use the [supported resource replacement mechanisms](../wfp/supported-file-replacement-mechanisms.md) for [Windows Resource Protection](../wfp/windows-resource-protection-portal.md).</span></span>

<span data-ttu-id="f6061-115">Дополнительные сведения о WRP см. в разделе [Защита ресурсов Windows](../wfp/windows-resource-protection-portal.md) и сведения, предоставляемые [Microsoft TechNet](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc709691(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="f6061-115">For more information about WRP, see [Windows Resource Protection](../wfp/windows-resource-protection-portal.md) and information that is provided on [Microsoft Technet](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc709691(v=ws.10)).</span></span>

## <a name="wfp-for-windows-server-2003-and-windows-xp2000"></a><span data-ttu-id="f6061-116">WFP для Windows Server 2003 и Windows XP/2000</span><span class="sxs-lookup"><span data-stu-id="f6061-116">WFP for Windows Server 2003 and Windows XP/2000</span></span>

<span data-ttu-id="f6061-117">Установщик Windows соответствует защите файлов Windows (WFP) при установке необходимых системных файлов в Windows Server 2003, Windows XP и Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="f6061-117">Windows Installer adheres to Windows File Protection (WFP) when installing essential system files on Windows Server 2003, Windows XP and Windows 2000.</span></span> <span data-ttu-id="f6061-118">Если защищенный системный файл изменяется автоматической установкой приложения, WFP восстанавливает файл в проверенной версии.</span><span class="sxs-lookup"><span data-stu-id="f6061-118">If a protected system file is modified by an unattended installation of an application, WFP restores the file to the verified file version.</span></span>

<span data-ttu-id="f6061-119">Установщик Windows никогда не пытается установить или заменить защищенный файл.</span><span class="sxs-lookup"><span data-stu-id="f6061-119">Windows Installer never attempts to install or replace a protected file.</span></span> <span data-ttu-id="f6061-120">Если действие [инсталлфилес](installfiles-action.md) или любое другое действие, запланированное до инсталлфилес, пытается установить файл, защищенный на windows Server 2003, Windows XP или Windows 2000, УСТАНОВЩИК вызывает WFP с запросом на установку или замену защищенного файла.</span><span class="sxs-lookup"><span data-stu-id="f6061-120">When the [InstallFiles](installfiles-action.md) action or any other action scheduled before InstallFiles attempts to install a file protected on Windows Server 2003, Windows XP or Windows 2000, the installer calls WFP with a request to install or replace the protected file.</span></span> <span data-ttu-id="f6061-121">Установщик запрашивает установку файлов из WFP сразу же после выполнения действия Инсталлфилес.</span><span class="sxs-lookup"><span data-stu-id="f6061-121">The installer requests the file installation from WFP immediately after executing the InstallFiles action.</span></span> <span data-ttu-id="f6061-122">WFP устанавливает или заменяет файл в системе пользователя кэшированной версией защищенного файла.</span><span class="sxs-lookup"><span data-stu-id="f6061-122">WFP installs or replaces the file on the user's system with a cached version of the protected file.</span></span> <span data-ttu-id="f6061-123">Обратите внимание, что это не гарантирует, что версия файла, установленного из кэша, является версией, требуемой для приложения.</span><span class="sxs-lookup"><span data-stu-id="f6061-123">Note that this does not guarantee that the version of the file installed from the cache is the version required by the application.</span></span> <span data-ttu-id="f6061-124">После установки файла WFP установщик определяет, совпадает ли эта версия с версией в пакете.</span><span class="sxs-lookup"><span data-stu-id="f6061-124">After WFP has installed the file, the installer determines whether this version matches the version in the package.</span></span> <span data-ttu-id="f6061-125">Если версия файла в пакете больше установленной версии, установщик информирует пользователя, что ему не удается обновить систему и что для приложения может потребоваться обновление операционной системы.</span><span class="sxs-lookup"><span data-stu-id="f6061-125">If the file version in the package is greater than the installed version, the installer informs the user that it cannot update the system and that an update of the operating system may be required for the application.</span></span>

<span data-ttu-id="f6061-126">Если какое-либо действие, упорядоченное после [инсталлфилес](installfiles-action.md) , попытается установить или заменить защищенный файл, еще не установленный в системе, установщик не сможет вызвать WFP для установки файла.</span><span class="sxs-lookup"><span data-stu-id="f6061-126">If any action sequenced after [InstallFiles](installfiles-action.md) attempts to install or replace a protected file not already installed on the system, the installer cannot call WFP to install the file.</span></span> <span data-ttu-id="f6061-127">В этом случае установщик информирует пользователя, что ему не удается обновить систему, и что для приложения может потребоваться обновление операционной системы.</span><span class="sxs-lookup"><span data-stu-id="f6061-127">In this case, the installer informs the user that it cannot update the system and that an update of the operating system may be required for the application.</span></span>

<span data-ttu-id="f6061-128">Установщик также проверяет WFP при удалении файлов и никогда не пытается удалить защищенные системные файлы.</span><span class="sxs-lookup"><span data-stu-id="f6061-128">The installer also checks with WFP when removing files and never attempts to remove protected system files.</span></span>

## <a name="component-key-files-protected-by-wfp"></a><span data-ttu-id="f6061-129">Файлы ключей компонентов, защищенные WFP</span><span class="sxs-lookup"><span data-stu-id="f6061-129">Component Key Files Protected by WFP</span></span>

<span data-ttu-id="f6061-130">Обратите внимание, что если компонент установщик Windows содержит файл WFP, этот файл должен быть указан в качестве пути к ключу для компонента.</span><span class="sxs-lookup"><span data-stu-id="f6061-130">Note that if a Windows Installer component contains a WFP file, this file must be specified as the key path for the component.</span></span>

<span data-ttu-id="f6061-131">Когда установщик пытается установить файл ключа компонента в Windows Server 2003, Windows XP или Windows 2000, он сначала вызывает WFP, чтобы определить, защищен ли файл ключа.</span><span class="sxs-lookup"><span data-stu-id="f6061-131">When the installer attempts to install a component's key file on Windows Server 2003, Windows XP or Windows 2000, it first calls WFP to determine if the key file is protected.</span></span> <span data-ttu-id="f6061-132">Если файл ключа компонента защищен с помощью WFP и этот файл ключа уже установлен, установщик обновляет компонент, только если версия файла ключа в пакете превышает установленную версию.</span><span class="sxs-lookup"><span data-stu-id="f6061-132">When the key file of a component is protected by WFP, and that key file is already installed, the installer updates the component only if the version of the key file in the package is greater than the installed version.</span></span> <span data-ttu-id="f6061-133">Если пакет установки указывает, что компонент должен быть установлен, а файл ключа компонента в данный момент не установлен, то независимо от того, защищен ли файл ключа, установщик устанавливает компонент.</span><span class="sxs-lookup"><span data-stu-id="f6061-133">If the installation package specifies that a component be installed, and the key file of the component is not currently installed, then regardless of whether the key file is protected the installer installs the component.</span></span> <span data-ttu-id="f6061-134">После установки любого компонента, защищенного с помощью WFP, он устанавливается окончательно, а установщик никогда не удаляет или не заменяет компонент.</span><span class="sxs-lookup"><span data-stu-id="f6061-134">Once any component having a key file protected by WFP is installed, it is permanently installed, and the installer never removes or replaces the component.</span></span>

## <a name="installation-of-assemblies-by-wfp"></a><span data-ttu-id="f6061-135">Установка сборок с помощью WFP</span><span class="sxs-lookup"><span data-stu-id="f6061-135">Installation of Assemblies by WFP</span></span>

<span data-ttu-id="f6061-136">WFP для сборок отличается от WFP для системных файлов.</span><span class="sxs-lookup"><span data-stu-id="f6061-136">WFP for assemblies differs from WFP for system files.</span></span>

<span data-ttu-id="f6061-137">WFP защищает системные файлы Windows Server 2003, Windows XP и Windows 2000, выявляя попытки замены защищенных системных файлов.</span><span class="sxs-lookup"><span data-stu-id="f6061-137">WFP protects Windows Server 2003, Windows XP and Windows 2000 system files by detecting attempts to replace protected system files.</span></span> <span data-ttu-id="f6061-138">Эта защита активируется после того, как WFP получает уведомление об изменении каталога для файла в защищенном каталоге.</span><span class="sxs-lookup"><span data-stu-id="f6061-138">This protection is triggered after WFP receives a directory change notification for a file in a protected directory.</span></span> <span data-ttu-id="f6061-139">Когда WFP получает это уведомление, он определяет, какой файл был изменен.</span><span class="sxs-lookup"><span data-stu-id="f6061-139">When WFP receives this notification, it determines which file has changed.</span></span> <span data-ttu-id="f6061-140">Если файл защищен, WFP ищет подпись файла в статическом файле каталога, чтобы определить, является ли новый файл правильной версией.</span><span class="sxs-lookup"><span data-stu-id="f6061-140">If the file is protected, WFP looks up the file signature in a static catalog file to determine if the new file is the correct version.</span></span> <span data-ttu-id="f6061-141">Если версия файла неверна, система заменяет файл правильной версией из кэша или с дистрибутивного носителя.</span><span class="sxs-lookup"><span data-stu-id="f6061-141">If the file version is not correct, the system replaces the file with the correct version from either the cache or distribution media.</span></span>

<span data-ttu-id="f6061-142">Напротив, WFP сборок является динамическим.</span><span class="sxs-lookup"><span data-stu-id="f6061-142">In contrast, WFP of assemblies is dynamic.</span></span> <span data-ttu-id="f6061-143">WFP распространяется на файлы по мере их добавления в общий кэш сборок параллельного использования.</span><span class="sxs-lookup"><span data-stu-id="f6061-143">WFP is extended to files as they are added to the shared side-by-side assembly cache.</span></span> <span data-ttu-id="f6061-144">Если сборка повреждена, WFP запросит, что файл будет заменен установщиком.</span><span class="sxs-lookup"><span data-stu-id="f6061-144">If an assembly becomes corrupted, WFP will request that the installer replace the file.</span></span> <span data-ttu-id="f6061-145">Установщик Windows может или не может заменить файл в зависимости от того, доступен ли исходный пакет.</span><span class="sxs-lookup"><span data-stu-id="f6061-145">Windows Installer may or may not be able to replace the file depending on whether the source package is accessible.</span></span> <span data-ttu-id="f6061-146">Если исходный пакет недоступен, WFP создаст диалоговое окно с сообщением о том, что не удается восстановить файл.</span><span class="sxs-lookup"><span data-stu-id="f6061-146">If the source package is inaccessible, WFP will put up a dialog box stating that it is unable to restore the file.</span></span>

<span data-ttu-id="f6061-147">Обратите внимание, что неуправляемые общие параллельные сборки, установленные в% WINDIR% \\ WinSxS, защищены с помощью WFP.</span><span class="sxs-lookup"><span data-stu-id="f6061-147">Note that unmanaged shared side-by-side assemblies, installed in %windir%\\winsxs, are protected by WFP.</span></span> <span data-ttu-id="f6061-148">Неуправляемые закрытые сборки, установленные в каталоге приложения, не защищаются с помощью WFP.</span><span class="sxs-lookup"><span data-stu-id="f6061-148">Unmanaged private assemblies, installed in the application directory, are not protected by WFP.</span></span> <span data-ttu-id="f6061-149">Управляемые глобальные сборки, установленные в каталоге приложения или сборки GAC% WINDIR% \\ \\ , не защищаются с помощью WFP.</span><span class="sxs-lookup"><span data-stu-id="f6061-149">Managed global assemblies installed in the application directory or %windir%\\assembly\\gac are not protected by WFP.</span></span>

## <a name="related-topics"></a><span data-ttu-id="f6061-150">См. также</span><span class="sxs-lookup"><span data-stu-id="f6061-150">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f6061-151">защита ресурсов Windows</span><span class="sxs-lookup"><span data-stu-id="f6061-151">Windows Resource Protection</span></span>](../wfp/windows-resource-protection-portal.md)
</dt> </dl>

 

 
