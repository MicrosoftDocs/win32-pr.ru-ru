---
description: приложения, использующие установщик Windows 4,0 для установки и обслуживания в Windows Vista, автоматически используют диспетчер перезапуска для уменьшения числа перезапусков системы.
ms.assetid: 821739ff-f7a7-4192-ad34-254aa7d74d13
title: использование установщик Windows с диспетчером перезапуска
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cf361cf20d6f56dc25bd43c9077c65a25eeebdae1c6b512dfcde3e756448a7b0
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118141154"
---
# <a name="using-windows-installer-with-restart-manager"></a>использование установщик Windows с диспетчером перезапуска

приложения, использующие установщик Windows 4,0 для установки и обслуживания в Windows Vista, автоматически используют [диспетчер перезапуска](../rstmgr/restart-manager-portal.md) для уменьшения числа перезапусков системы. поведение по умолчанию в Windows Vista — завершение работы приложений, а не выключение и перезапуск операционной системы везде, где это возможно. В случаях, когда перезапуск системы недоступен, установщики могут использовать API [диспетчера перезапуска](../rstmgr/restart-manager-portal.md) , чтобы запланировать перезапуск таким образом, чтобы минимизировать перебои в работе потока пользователя.

Windows Разработчики установщика могут выполнять следующие действия по подготовке пакета для работы с [диспетчером перезапуска](../rstmgr/restart-manager-portal.md).

-   Добавьте в пакет диалоговое окно [мсирмфилесинусе](msirmfilesinuse-dialog.md) . если в пакете имеется диалоговое окно мсирмфилесинусе, то пользователь Windows Vista, выполняющий установку на [уровне пользовательского интерфейса](user-interface-levels.md) , получает возможность автоматически закрывать и перезапускать приложения. Пакет установки может содержать сведения как в диалоговом окне Мсирмфилесинусе, так и в диалоговом окне [филесинусе](filesinuse-dialog.md) . диалоговое окно мсирмфилесинусе отображается только в том случае, если пакет устанавливается по крайней мере установщик Windows 4,0 в Windows Vista, и в противном случае игнорируется. Существующие пакеты, не имеющие диалогового окна Мсирмфилесинусе, продолжают работать с помощью диалогового окна Филесинусе. Преобразование настройки можно использовать для добавления диалогового окна Мсирмфилесинусе в существующие пакеты.

    Конечные пользователи обычно запускают установку на полном [уровне](user-interface-levels.md)пользовательского интерфейса. Базовый пользовательский интерфейс или ограниченные установки уровня пользовательского интерфейса позволяют пользователю использовать [Диспетчер перезапуска](../rstmgr/restart-manager-portal.md) для уменьшения числа перезапусков системы, даже если отсутствует диалоговое окно [мсирмфилесинусе](msirmfilesinuse-dialog.md) . автоматическая установка на уровне пользовательского интерфейса всегда завершает работу приложений и служб, а в Windows Vista всегда используйте диспетчер перезапуска.

-   Регистрация приложений для перезапуска с помощью функции [**регистераппликатионрестарт**](/windows/win32/api/winbase/nf-winbase-registerapplicationrestart) . Диспетчер перезапуска может перезапустить только те приложения, которые были зарегистрированы для перезапуска. Диспетчер перезапуска перезапускает зарегистрированные приложения после установки. Если для установки требуется перезагрузка системы, диспетчер перезапускает перезапуск зарегистрированного приложения после перезагрузки системы.
-   Укажите ИНСТАЛЛЛОГМОДЕ \_ рмфилесинусе при включении обработчика внешнего пользовательского интерфейса с функциями [**Мсисетекстерналуи**](/windows/desktop/api/Msi/nf-msi-msisetexternaluia) и [**мсисетекстерналуирекорд**](/windows/desktop/api/Msi/nf-msi-msisetexternaluirecord) . Windows Установщик отправит сообщение ИНСТАЛЛМЕССАЖЕ \_ рмфилесинусе для внешних обработчиков пользовательского интерфейса, которые поддерживают [Диспетчер перезапуска](../rstmgr/restart-manager-portal.md). Если зарегистрированный или внутренний пользовательский интерфейс не обрабатывает сообщение ИНСТАЛЛМЕССАЖЕ \_ рмфилесинусе, установщик отправляет \_ сообщение инсталлмессаже филесинусе для обработчиков пользовательского интерфейса, поддерживающих диалоговое окно [филесинусе](filesinuse-dialog.md) . Дополнительные сведения см. в разделе [Использование диспетчера перезапуска с внешним пользовательским интерфейсом](using-restart-manager-with-an-external-ui-.md).
-   Настраиваемые действия могут добавлять ресурсы, принадлежащие сеансу [диспетчера перезапуска](../rstmgr/restart-manager-portal.md) . Настраиваемое действие должно быть упорядочено до действия [инсталлвалидате](installvalidate-action.md) . Настраиваемые действия могут использовать свойство [**мсирестартманажерсессионкэй**](msirestartmanagersessionkey.md) для получения ключа сеанса и должны вызывать функции [**РМЖОИНСЕССИОН**](/windows/win32/api/restartmanager/nf-restartmanager-rmjoinsession) и [**рмендсессион**](/windows/win32/api/restartmanager/nf-restartmanager-rmendsession) API диспетчера перезапуска. Настраиваемые действия не могут удалять ресурсы, принадлежащие сеансу диспетчера перезапуска. Пользовательские действия не должны пытаться завершить работу или перезапустить приложения с помощью функций [**рмшутдовн**](/windows/win32/api/restartmanager/nf-restartmanager-rmshutdown), [**RmGetList**](/windows/win32/api/restartmanager/nf-restartmanager-rmgetlist) и [**рмрестарт**](/windows/win32/api/restartmanager/nf-restartmanager-rmrestart) .
-   Авторы пакетов могут основывать условие в [таблице лаунчкондитион](launchcondition-table.md) свойства [**мсисистемребутпендинг**](msisystemrebootpending.md) , чтобы предотвратить установку пакета при ожидании перезагрузки системы.
-   авторы пакетов и администраторы могут управлять взаимодействием установщик Windows и диспетчера перезапуска с помощью свойств [**мсирестартманажерконтрол**](msirestartmanagercontrol.md), [**мсидисаблермрестарт**](msidisablermrestart.md), [**мсирмшутдовн**](msirmshutdown.md) и политики [дисаблеаутоматикаппликатионшутдовн](disableautomaticapplicationshutdown.md) .
-   Приложения и службы должны следовать рекомендациям, описанным в разделе [Использование диспетчера перезапуска](../rstmgr/using-restart-manager.md) документации по [диспетчеру перезапуска](../rstmgr/restart-manager-portal.md) .

 

 
