---
description: Приложения, использующие установщик Windows 4,0 для установки и обслуживания в Windows Vista, автоматически используют диспетчер перезапуска для уменьшения числа перезапусков системы.
ms.assetid: 821739ff-f7a7-4192-ad34-254aa7d74d13
title: Использование установщик Windows с диспетчером перезапуска
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4160b2241c75ec7305accd1ab4d1295a54fa9f65
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673366"
---
# <a name="using-windows-installer-with-restart-manager"></a><span data-ttu-id="65501-103">Использование установщик Windows с диспетчером перезапуска</span><span class="sxs-lookup"><span data-stu-id="65501-103">Using Windows Installer with Restart Manager</span></span>

<span data-ttu-id="65501-104">Приложения, использующие установщик Windows 4,0 для установки и обслуживания в Windows Vista, автоматически используют [Диспетчер перезапуска](../rstmgr/restart-manager-portal.md) для уменьшения числа перезапусков системы.</span><span class="sxs-lookup"><span data-stu-id="65501-104">Applications that use Windows Installer 4.0 for installation and servicing on Windows Vista automatically use the [Restart Manager](../rstmgr/restart-manager-portal.md) to reduce system restarts.</span></span> <span data-ttu-id="65501-105">Поведение по умолчанию в Windows Vista — завершение работы приложений, а не выключение и перезапуск операционной системы везде, где это возможно.</span><span class="sxs-lookup"><span data-stu-id="65501-105">The default behavior on Windows Vista is to shut down applications rather than shut down and restart the operating system whenever possible.</span></span> <span data-ttu-id="65501-106">В случаях, когда перезапуск системы недоступен, установщики могут использовать API [диспетчера перезапуска](../rstmgr/restart-manager-portal.md) , чтобы запланировать перезапуск таким образом, чтобы минимизировать перебои в работе потока пользователя.</span><span class="sxs-lookup"><span data-stu-id="65501-106">In cases where a system restart is unavoidable, installers can use the [Restart Manager](../rstmgr/restart-manager-portal.md) API to schedule restarts in such a way that it minimizes the disruption of the user's work flow.</span></span>

<span data-ttu-id="65501-107">Установщик Windows разработчики могут выполнять следующие действия по подготовке пакета для работы с [диспетчером перезапуска](../rstmgr/restart-manager-portal.md).</span><span class="sxs-lookup"><span data-stu-id="65501-107">Windows Installer developers can perform the following actions to prepare their package to work with the [Restart Manager](../rstmgr/restart-manager-portal.md).</span></span>

-   <span data-ttu-id="65501-108">Добавьте в пакет диалоговое окно [мсирмфилесинусе](msirmfilesinuse-dialog.md) .</span><span class="sxs-lookup"><span data-stu-id="65501-108">Add the [MsiRMFilesInUse](msirmfilesinuse-dialog.md) dialog box to your package.</span></span> <span data-ttu-id="65501-109">Если в пакете имеется диалоговое окно Мсирмфилесинусе, пользователь Windows Vista, выполняющий установку на [уровне пользовательского интерфейса](user-interface-levels.md) , получает возможность автоматического закрытия и перезапуска приложений.</span><span class="sxs-lookup"><span data-stu-id="65501-109">If the MsiRMFilesInUse dialog box is present in the package, the Windows Vista user running an installation at the Full UI [user interface level](user-interface-levels.md) is given the option to automatically close and restart applications.</span></span> <span data-ttu-id="65501-110">Пакет установки может содержать сведения как в диалоговом окне Мсирмфилесинусе, так и в диалоговом окне [филесинусе](filesinuse-dialog.md) .</span><span class="sxs-lookup"><span data-stu-id="65501-110">An installation package can contain information for both the MsiRMFilesInUse dialog box and the [FilesInUse](filesinuse-dialog.md) dialog box .</span></span> <span data-ttu-id="65501-111">Диалоговое окно Мсирмфилесинусе отображается только в том случае, если пакет устанавливается по крайней мере установщик Windows 4,0 в Windows Vista, и в противном случае игнорируется.</span><span class="sxs-lookup"><span data-stu-id="65501-111">The MsiRMFilesInUse dialog box is only displayed if the package is installed with at least Windows Installer 4.0 on Windows Vista, and is otherwise ignored.</span></span> <span data-ttu-id="65501-112">Существующие пакеты, не имеющие диалогового окна Мсирмфилесинусе, продолжают работать с помощью диалогового окна Филесинусе.</span><span class="sxs-lookup"><span data-stu-id="65501-112">Existing packages that do not have the MsiRMFilesInUse dialog box continue to function using the FilesInUse dialog box.</span></span> <span data-ttu-id="65501-113">Преобразование настройки можно использовать для добавления диалогового окна Мсирмфилесинусе в существующие пакеты.</span><span class="sxs-lookup"><span data-stu-id="65501-113">A customization transform can be used to add an MsiRMFilesInUse dialog box to existing packages.</span></span>

    <span data-ttu-id="65501-114">Конечные пользователи обычно запускают установку на полном [уровне](user-interface-levels.md)пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="65501-114">End-users typically run installations at the Full UI [user interface level](user-interface-levels.md).</span></span> <span data-ttu-id="65501-115">Базовый пользовательский интерфейс или ограниченные установки уровня пользовательского интерфейса позволяют пользователю использовать [Диспетчер перезапуска](../rstmgr/restart-manager-portal.md) для уменьшения числа перезапусков системы, даже если отсутствует диалоговое окно [мсирмфилесинусе](msirmfilesinuse-dialog.md) .</span><span class="sxs-lookup"><span data-stu-id="65501-115">Basic UI or Reduced UI level installations give the user the option of using the [Restart Manager](../rstmgr/restart-manager-portal.md) to reduce system restarts even if the [MsiRMFilesInUse](msirmfilesinuse-dialog.md) dialog box is not present.</span></span> <span data-ttu-id="65501-116">Автоматическая установка на уровне пользовательского интерфейса всегда завершает работу приложений и служб, а в Windows Vista всегда используйте диспетчер перезапуска.</span><span class="sxs-lookup"><span data-stu-id="65501-116">Silent UI level installations always shut down applications and services, and on Windows Vista, always use Restart Manager.</span></span>

-   <span data-ttu-id="65501-117">Регистрация приложений для перезапуска с помощью функции [**регистераппликатионрестарт**](/windows/win32/api/winbase/nf-winbase-registerapplicationrestart) .</span><span class="sxs-lookup"><span data-stu-id="65501-117">Register applications for a restart using the [**RegisterApplicationRestart**](/windows/win32/api/winbase/nf-winbase-registerapplicationrestart) function.</span></span> <span data-ttu-id="65501-118">Диспетчер перезапуска может перезапустить только те приложения, которые были зарегистрированы для перезапуска.</span><span class="sxs-lookup"><span data-stu-id="65501-118">Restart Manager can only restart applications that have been registered for restart.</span></span> <span data-ttu-id="65501-119">Диспетчер перезапуска перезапускает зарегистрированные приложения после установки.</span><span class="sxs-lookup"><span data-stu-id="65501-119">Restart Manager restarts registered applications after the installation.</span></span> <span data-ttu-id="65501-120">Если для установки требуется перезагрузка системы, диспетчер перезапускает перезапуск зарегистрированного приложения после перезагрузки системы.</span><span class="sxs-lookup"><span data-stu-id="65501-120">If the installation requires a system restart, Restart Manager restarts the registered application after the system restart.</span></span>
-   <span data-ttu-id="65501-121">Укажите ИНСТАЛЛЛОГМОДЕ \_ рмфилесинусе при включении обработчика внешнего пользовательского интерфейса с функциями [**Мсисетекстерналуи**](/windows/desktop/api/Msi/nf-msi-msisetexternaluia) и [**мсисетекстерналуирекорд**](/windows/desktop/api/Msi/nf-msi-msisetexternaluirecord) .</span><span class="sxs-lookup"><span data-stu-id="65501-121">Specify INSTALLLOGMODE\_RMFILESINUSE when enabling an external user-interface handler with the [**MsiSetExternalUI**](/windows/desktop/api/Msi/nf-msi-msisetexternaluia) and [**MsiSetExternalUIRecord**](/windows/desktop/api/Msi/nf-msi-msisetexternaluirecord) functions.</span></span> <span data-ttu-id="65501-122">Установщик Windows отправляет \_ сообщение РМФИЛЕСИНУСЕ инсталлмессаже для внешних обработчиков пользовательского интерфейса, поддерживающих [Диспетчер перезапуска](../rstmgr/restart-manager-portal.md).</span><span class="sxs-lookup"><span data-stu-id="65501-122">Windows Installer will send a INSTALLMESSAGE\_RMFILESINUSE message for external user-interface handlers that support the [Restart Manager](../rstmgr/restart-manager-portal.md).</span></span> <span data-ttu-id="65501-123">Если зарегистрированный или внутренний пользовательский интерфейс не обрабатывает сообщение ИНСТАЛЛМЕССАЖЕ \_ рмфилесинусе, установщик отправляет \_ сообщение инсталлмессаже филесинусе для обработчиков пользовательского интерфейса, поддерживающих диалоговое окно [филесинусе](filesinuse-dialog.md) .</span><span class="sxs-lookup"><span data-stu-id="65501-123">If no registered or internal user-interface handles the INSTALLMESSAGE\_RMFILESINUSE message, the installer sends a INSTALLMESSAGE\_FILESINUSE message for user-interface handlers that support the [FilesInUse](filesinuse-dialog.md) dialog box.</span></span> <span data-ttu-id="65501-124">Дополнительные сведения см. в разделе [Использование диспетчера перезапуска с внешним пользовательским интерфейсом](using-restart-manager-with-an-external-ui-.md).</span><span class="sxs-lookup"><span data-stu-id="65501-124">For more information, see [Using Restart Manager with an External UI](using-restart-manager-with-an-external-ui-.md).</span></span>
-   <span data-ttu-id="65501-125">Настраиваемые действия могут добавлять ресурсы, принадлежащие сеансу [диспетчера перезапуска](../rstmgr/restart-manager-portal.md) .</span><span class="sxs-lookup"><span data-stu-id="65501-125">Custom actions can add resources belonging to a [Restart Manager](../rstmgr/restart-manager-portal.md) session.</span></span> <span data-ttu-id="65501-126">Настраиваемое действие должно быть упорядочено до действия [инсталлвалидате](installvalidate-action.md) .</span><span class="sxs-lookup"><span data-stu-id="65501-126">The custom action should be sequenced before the [InstallValidate](installvalidate-action.md) action.</span></span> <span data-ttu-id="65501-127">Настраиваемые действия могут использовать свойство [**мсирестартманажерсессионкэй**](msirestartmanagersessionkey.md) для получения ключа сеанса и должны вызывать функции [**РМЖОИНСЕССИОН**](/windows/win32/api/restartmanager/nf-restartmanager-rmjoinsession) и [**рмендсессион**](/windows/win32/api/restartmanager/nf-restartmanager-rmendsession) API диспетчера перезапуска.</span><span class="sxs-lookup"><span data-stu-id="65501-127">Custom actions can use the [**MsiRestartManagerSessionKey**](msirestartmanagersessionkey.md) property to obtain the session key, and should call the [**RmJoinSession**](/windows/win32/api/restartmanager/nf-restartmanager-rmjoinsession) and [**RmEndSession**](/windows/win32/api/restartmanager/nf-restartmanager-rmendsession) functions of the Restart Manager API.</span></span> <span data-ttu-id="65501-128">Настраиваемые действия не могут удалять ресурсы, принадлежащие сеансу диспетчера перезапуска.</span><span class="sxs-lookup"><span data-stu-id="65501-128">Custom actions cannot remove resources belonging to a Restart Manager session.</span></span> <span data-ttu-id="65501-129">Пользовательские действия не должны пытаться завершить работу или перезапустить приложения с помощью функций [**рмшутдовн**](/windows/win32/api/restartmanager/nf-restartmanager-rmshutdown), [**RmGetList**](/windows/win32/api/restartmanager/nf-restartmanager-rmgetlist) и [**рмрестарт**](/windows/win32/api/restartmanager/nf-restartmanager-rmrestart) .</span><span class="sxs-lookup"><span data-stu-id="65501-129">Custom actions should not attempt to shutdown or restart applications using the [**RmShutdown**](/windows/win32/api/restartmanager/nf-restartmanager-rmshutdown), [**RmGetList**](/windows/win32/api/restartmanager/nf-restartmanager-rmgetlist) and [**RmRestart**](/windows/win32/api/restartmanager/nf-restartmanager-rmrestart) functions.</span></span>
-   <span data-ttu-id="65501-130">Авторы пакетов могут основывать условие в [таблице лаунчкондитион](launchcondition-table.md) свойства [**мсисистемребутпендинг**](msisystemrebootpending.md) , чтобы предотвратить установку пакета при ожидании перезагрузки системы.</span><span class="sxs-lookup"><span data-stu-id="65501-130">Package authors can base a condition in the [LaunchCondition table](launchcondition-table.md) on the [**MsiSystemRebootPending**](msisystemrebootpending.md) property to prevent the installation of their package when a system restart is pending.</span></span>
-   <span data-ttu-id="65501-131">Авторы пакетов и администраторы могут управлять взаимодействием установщик Windows и диспетчера перезапуска с помощью свойств [**мсирестартманажерконтрол**](msirestartmanagercontrol.md), [**мсидисаблермрестарт**](msidisablermrestart.md), [**мсирмшутдовн**](msirmshutdown.md) и политики [дисаблеаутоматикаппликатионшутдовн](disableautomaticapplicationshutdown.md) .</span><span class="sxs-lookup"><span data-stu-id="65501-131">Package authors and administrators can control the interaction of the Windows Installer and Restart Manager by using the [**MSIRESTARTMANAGERCONTROL**](msirestartmanagercontrol.md), [**MSIDISABLERMRESTART**](msidisablermrestart.md), [**MSIRMSHUTDOWN**](msirmshutdown.md) properties and the [DisableAutomaticApplicationShutdown](disableautomaticapplicationshutdown.md) policy.</span></span>
-   <span data-ttu-id="65501-132">Приложения и службы должны следовать рекомендациям, описанным в разделе [Использование диспетчера перезапуска](../rstmgr/using-restart-manager.md) документации по [диспетчеру перезапуска](../rstmgr/restart-manager-portal.md) .</span><span class="sxs-lookup"><span data-stu-id="65501-132">Applications and services should follow the guidelines described in the [Using Restart Manager](../rstmgr/using-restart-manager.md) section of the [Restart Manager](../rstmgr/restart-manager-portal.md) documentation.</span></span>

 

 
