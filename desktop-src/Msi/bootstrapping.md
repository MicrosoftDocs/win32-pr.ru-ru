---
description: В настоящее время каждая установка, которая пытается использовать установщик Windows, начинается с проверки наличия установщика на компьютере пользователя, и если он отсутствует, то будет ли пользователь и компьютер готовы к установке установщик Windows.
ms.assetid: a5174284-2a8c-4510-accf-641fda5be98d
title: Начальной загрузки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ff743acbcd2dfc81b0e912e5be84c363f34614ea
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105650714"
---
# <a name="bootstrapping"></a>Начальной загрузки

В настоящее время каждая установка, которая пытается использовать установщик Windows, начинается с проверки наличия установщика на компьютере пользователя, и если он отсутствует, то будет ли пользователь и компьютер готовы к установке установщик Windows. Приложение установки [Instmsi.exe](instmsi-exe.md) доступно в пакете SDK для установщик Windows, который содержит всю логику и функциональные возможности для установки установщик Windows. Однако начальное приложение должно управлять этой установкой.

Приложение начальной загрузки должно сначала проверить, установлено ли в данный момент установщик Windows. Приложения могут получить версию установщик Windows, установленную в настоящее время, с помощью [**дллжетверсион**](/windows/win32/api/shlwapi/nc-shlwapi-dllgetversionproc). Если установщик Windows в данный момент не установлен, приложение начальной загрузки должно запросить операционную систему, чтобы определить, какая версия Instmsi.exe требуется. После запуска установки установщик Windows приложение начальной загрузки должно выполнить обработку кодов возврата из приложения Instmsi.exe и выполнить перезагрузку, которая произошел во время установки установщик Windows. Дополнительные сведения см. [в разделе Определение версии установщик Windows](determining-the-windows-installer-version.md)

В следующем примере показано, как приложение установки, устанавливающее Microsoft Office 2000, проверяет систему пользователя и настраивает установку установщик Windows. Этот пример специально написан для установки Office 2000 и должен использоваться только в качестве общего справочника.

Когда пользователь вставляет компакт-диск Office 2000 в компьютер, Setup.exe пытается запустить режим обслуживания, приложение установки или ничего не делает в соответствии с потребностями пользователя. В следующем разделе описывается, как приложение установки Office 2000 с именем Setup.exe, определяет пользователя и его компьютер, конструирует командную строку и устанавливает установщик Windows с помощью приложения Msiexec.exe.

## <a name="how-setupexe-bootstraps-the-windows-installer-when-installing-office-2000"></a>Setup.exe начальной загрузки установщик Windows при установке Office 2000

1.  Пользователь вставляет компакт-диск Office 2000 в компьютер. Операционная система Windows инициирует Setup.exe с помощью параметра/ауторун и файла autorun. INF. Файл autorun. INF находится в корне компакт-диска Office 2000 и содержит следующие разделы:

    \[Загрузка\]

     

    \[Возможности Office\]

     

    \[Сведения о продукте\]

     

    \[ServicePack \] .

    \[Раздел автозапуска \] содержит командную строку, которая выполняет Setup.exe приложение, выполняет значок, используемый для показа диска, и содержит сведения о добавлении параметра "Install" (Настройка) в контекстное меню для компакт-диска.

    \[Раздел функции Office \] содержит список функций и пар имен компонентов.

    В \[ разделе сведения о продукте \] указывается имя и версия приложения.

    \[Раздел ServicePack \] позволяет администратору сети установить минимально необходимый уровень пакета обновления. Администратор сети может использовать этот раздел, чтобы создать текст оповещения, отображаемого, если в локальной операционной системе отсутствует необходимый пакет обновления.

    Ниже приведен пример файла autorun. INF.

    ``` syntax
    [autorun] 
    OPEN=setup.EXE /AUTORUN /KEY:Software\Microsoft\Office\9.0\Common\General\InstallProductID
    ICON=setup.EXE,1
    shell\configure=&Configure
    shell\configure\command=setup.EXE
    shell\install=&Install
    shell\install\command=setup.EXE
    [OfficeFeatures]
    Feature1=ACCESSFiles
    Feature2=OfficeFiles
    Feature3=WORDFiles
    Feature4=EXCELFiles
    Feature5=PPTFiles
    [ProductInformation]
    DisplayName=Microsoft Office 9
    Version=9.0
    ProductCode={product guid}
    [ServicePack]
    MessageText="The operating system does not have a required service pack. Please download and install this from www.microsoft.com."
    SPLevel=3
    ```

2.  Приложение Setup.exe проверяет \_ мьютекс мсипромптфоркд. Установщик Windows создает этот мьютекс, когда он предлагает пользователю вставить компакт-диск. Наличие мьютекса означает, что установщик Windows выполняет установку, которая запросила компакт-диск Office 2000. В этом случае Setup.exe приложение немедленно завершает работу и позволяет продолжить установку Office 2000. Если мьютекс отсутствует, Setup.exe приложение продолжится на шаге 3, где проверяется раздел реестра, чтобы определить, установлен ли Office 2000.
3.  Приложение Setup.exe проверяет наличие раздела реестра Office9:

    **HKCU/Software/Microsoft/Office/9.0/Common/General/Инсталлпродуктид**

    Если этот раздел реестра не существует, Setup.exeное приложение продолжит работу на шаге 6, где операционная система проверяет, подходит ли он для установки Office 2000.

4.  Если раздел реестра Office 2000 существует, приложение Setup.exe проверяет текущее состояние установки, вызывая [**мсикуерипродуктстате**](/windows/desktop/api/Msi/nf-msi-msiqueryproductstatea). Возвращаемое состояние InstallState \_ по умолчанию означает, что Office 2000 уже установлен, а приложение Setup.exe будет продолжаться на шаге 5, где Office 2000 проверяется на запуск из источника.

    Если Office 2000 не установлен, приложение Setup.exe продолжится на шаге 6, где операционная система проверяет, подходит ли она для установки Office 2000.

5.  Setup.exe приложение вызывает [**мсикуерифеатурестате**](/windows/desktop/api/Msi/nf-msi-msiqueryfeaturestatea) для каждого компонента в разделе **\[ оффицефеатурес \]** файла autorun. INF. Если какая-либо из этих функций возвращает INSTALLSTATE \_ Source, это означает, что компонент запускается из источника, а Setup.exe приложение немедленно завершает работу.

    Если ни одна из функций не возвращает INSTALLSTATE \_ Source, приложение Setup.exe запускает приложение установщика, Msiexec.exe и представляет режим обслуживания установщик Windows перед выходом.

6.  Приложение Setup.exe определяет, соответствует ли операционная система установке Office 2000. Для установки Office 2000 требуется Windows XP. Если операционной системе требуется обновление пакета обновления для Office 2000, в приложении Setup.exe отображается текст, указанный в файле autorun. INF. Если операционная система не является обязательной для Office 2000 или обновления Office 2000, в приложении Setup.exe отображается сообщение о том, что пользователь не сможет продолжить работу.

    Если операционная система предназначена для Office 2000, приложение Setup.exe продолжится на шаге 7, который определяет, установлен ли установщик Windows на компьютере пользователя.

7.  Если установщик Windows существует на компьютере пользователя, Setup.exe приложение запускает приложение Msiexec.exe и передает ему файл Office 2000. msi.

    Если установщик Windows не установлен на локальном компьютере, Setup.exe приложение продолжит работу на шаге 8, который определяет, соответствует ли операционная система установленной установщик Windows.

8.  Если локальный компьютер имеет право на установку установщик Windows, то Setup.exe приложение запускает правильную версию приложения установщика Instmsi.exe для платформы. Setup.exe может передать параметр командной строки/q, чтобы отключить пользовательский интерфейс и запретить пользователю изменять параметры конфигурации установки.
9.  Приложение Setup.exe загружает только что установленный файл Msi.dll и выполняет вызов функции [**мсиинсталлпродукт**](/windows/desktop/api/Msi/nf-msi-msiinstallproducta) для установки приложения пользователя.

## <a name="setupexe-command-line-parameters"></a>Setup.exe параметров командной строки

Приложение Setup.exe позволяет администраторам и пользователям передавать параметры командной строки в приложение Msiexec.exe. Дополнительные сведения см. в разделе [Параметры командной строки](command-line-options.md). В следующей таблице перечислены параметры команды, которые можно использовать с Setup.exe.



| Параметр                       | Использование                                                                                                                                        | Значение                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| /ауторун                     | setup.exe/ауторун                                                                                                                           | Запускает файл autorun. INF, описанный выше.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| /a                           | setup.exe /a                                                                                                                                 | Инициирует административную установку.                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| /j                           | \[\| \] *пакет* u m или <br/> \[\| \] *список преобразования* *пакета* u m<br/> или <br/> \[u \| m \] *пакет* /g *LanguageID*<br/> | Объявляет продукт. Этот параметр игнорирует все значения свойств, указанные в командной строке. u объявление для текущего пользователя.<br/> m объявление для всех пользователей компьютера.<br/> Идентификатор языка g<br/> t применяет преобразование к объявленному пакету.<br/>                                                                                                                                                                                                                        |
| /I                           | setup.exe/I Office9.msi/t Программгмт. MST                                                                                                  | Указывает MSI-файл, который Setup.exe должен быть установлен. Если параметр/I не включен, Setup.exe использует файл Office9.msi.                                                                                                                                                                                                                                                                                                                                                                                 |
| /o< = *значение* свойства> | setup.exe/o КДКЭЙ = 111111-1111                                                                                                               | Задает свойства в файле MSI. Setup.exe передает их в msiexec как записанный.                                                                                                                                                                                                                                                                                                                                                                                                                           |
| /q                           | setup.exe/q                                                                                                                                 | Задайте уровень установки на уровне пользовательского интерфейса. /q без пользовательского интерфейса (/Qn для msiexec)/QB Basic UI<br/> /КР ограниченный пользовательский интерфейс.<br/>                                                                                                                                                                                                                                                                                                                                                                                    |
| /m\#                         | setup.exe/M4                                                                                                                                | Поддерживает несколько лицензий в соответствии с соглашениями SELECT. Это свойство используется в настраиваемом действии проверки лицензии для записи сертификата LV. За параметром/m должно следовать допустимое число разблокирований. Значение, заданное параметром/m, должно быть задано как свойство M в файле Office9.msi. Если значение не указано, но параметр/m используется вместе с программой установки, то должно быть задано значение 0. Параметр/m необходим для поддержки выбора клиентов, использующих компакт-диск или сеть. |
| /Settings                    | setup.exe/Settings mysettings.ini                                                                                                           | Позволяет администраторам указывать ini-файл, содержащий все пользовательские параметры, которые должны быть переданы во время установки Office 2000. См. Описание ini-файла ниже.                                                                                                                                                                                                                                                                                                                                  |



 

## <a name="using-an-ini-file"></a>Использование ini-файла

Создание файла инициализации может оказаться проще, чем создавать длинную командную строку. С помощью параметра/Settings приложение Setup.exe считывает указанный ini-файл и конструирует командную строку для передачи в приложение Msiexec.exe. В ini-файле поддерживаются только те свойства, которые поддерживаются в командной строке. Если свойство или значение найдено как в ini-файле, так и в командной строке, параметры командной строки переопределяют параметры INI-файла.

INI-файл имеет формат:

\[MSI\]

 

\[осн\]

 

\[options\]

 

\[Дисплей\]

В \[ \] разделе MSI ini-файла указан путь к установочному пакету для установки. Это соответствует параметру/I в командной строке.

В \[ \] разделе MST ini-файла указан путь к преобразованиям, используемым в этой установке. Это соответствует параметру/j в командной строке. Несколько преобразований указываются в другой строке с помощью MST1 MST (N). При синтаксическом анализе в командной строке список в ini-файле включается слева направо. Обратите внимание, что номер, связанный с заголовком MST (N), существует только для поддержки уникальных идентификаторов и не имеет программного значения.

\[Раздел параметров \] позволяет сетевым администраторам задавать и переопределять свойства в файлах MSI или MST. Параметры, заданные в ini-файле, добавляются в командную строку с помощью параметра/o. Каждый параметр в разделе параметров должен иметь имя свойства и значение.

\[Раздел Отображение \] используется для задания уровня пользовательского интерфейса, используемого во время установки. Соответствует параметру/q в командной строке. Допустимые значения: None, Basic, Reduced и Full.

Пример ini-файла

\[MSI\]

 

MSI = \\ \\ саурцешаре \\ office2000 \\Office2000.msi

 

\[ОСН\]

 

MST1 = \\ \\ саурцешаре \\ office2000 \\ trns1. MST

 

MST2 = \\ \\ саурцешаре \\ office2000 \\ trns2. MST

 

\[Параметры\]

 

ПУБЛИКПРОПЕРТИ = ваше значение

\[Дисплей\]

 

Показать = нет

 

