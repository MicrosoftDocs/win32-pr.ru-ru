---
description: Невозможно устранить все обстоятельства, при которых приложению обновления может потребоваться доступ к исходному источнику установки.
ms.assetid: f7028c55-e4a5-4596-af7a-728c9f4f367e
title: Предотвращение необходимости доступа к исходному источнику установки исправления
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: baee8b261ff0a3f6bb94fb141ee765726ffa2ced
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103909004"
---
# <a name="preventing-a-patch-from-requiring-access-to-the-original-installation-source"></a><span data-ttu-id="2939a-103">Предотвращение необходимости доступа к исходному источнику установки исправления</span><span class="sxs-lookup"><span data-stu-id="2939a-103">Preventing a Patch from Requiring Access to the Original Installation Source</span></span>

<span data-ttu-id="2939a-104">Невозможно устранить все обстоятельства, при которых приложению обновления может потребоваться доступ к исходному источнику установки.</span><span class="sxs-lookup"><span data-stu-id="2939a-104">It is not possible to eliminate all circumstances under which the application of a patch may require access to the original installation source.</span></span>

<span data-ttu-id="2939a-105">Придерживайтесь следующих моментов, чтобы максимально потребовать, чтобы исправление потребовало доступа к исходному источнику:</span><span class="sxs-lookup"><span data-stu-id="2939a-105">Adhere to following points to minimize the possibility that your patch will require access to the original source:</span></span>

-   <span data-ttu-id="2939a-106">Используйте исправления только для целых файлов.</span><span class="sxs-lookup"><span data-stu-id="2939a-106">Use whole-file only patches.</span></span> <span data-ttu-id="2939a-107">Это избавляет от необходимости создавать двоичные исправления для всех ранее выпущенных версий файла.</span><span class="sxs-lookup"><span data-stu-id="2939a-107">This eliminates the need to create binary patches for all previously released versions of the file.</span></span> <span data-ttu-id="2939a-108">Обратите внимание, что обычно исправления файлов имеют больший размер, чем двоичные исправления.</span><span class="sxs-lookup"><span data-stu-id="2939a-108">Note that whole file patches are generally larger in size than binary patches.</span></span> <span data-ttu-id="2939a-109">Можно легко установить исправление в виде полного исправления файла, создав свойство Инклудевхолефилесонли со значением 1 (одно) в файле свойств создания исправления (PCP).</span><span class="sxs-lookup"><span data-stu-id="2939a-109">You can easily set a patch to be a whole file patch by authoring the IncludeWholeFilesOnly property with a value of 1 (one) in the Patch Creation Properties (PCP) file.</span></span>
-   <span data-ttu-id="2939a-110">Убедитесь, что ни одно из настраиваемых действий не имеет доступа к исходному расположению источника.</span><span class="sxs-lookup"><span data-stu-id="2939a-110">Ensure that none of your custom actions access the original source location.</span></span>
-   <span data-ttu-id="2939a-111">Убедитесь, что действие Ресолвесаурце является условным, чтобы оно выполнялось только при необходимости, или вообще не представлено.</span><span class="sxs-lookup"><span data-stu-id="2939a-111">Ensure that the ResolveSource action is conditionalized so that it only runs when needed, or alternatively is not present at all.</span></span>
-   <span data-ttu-id="2939a-112">Заполнение [таблицы мсифилехаш](msifilehash-table.md) для всех файлов с неверсиями.</span><span class="sxs-lookup"><span data-stu-id="2939a-112">Populate the [MsiFileHash Table](msifilehash-table.md) for all unversioned files.</span></span> <span data-ttu-id="2939a-113">Средство установщик Windows SDK, Msifiler.exe, может легко сделать это за вас.</span><span class="sxs-lookup"><span data-stu-id="2939a-113">The Windows Installer SDK tool, Msifiler.exe, can easily do this for you.</span></span>
-   <span data-ttu-id="2939a-114">Убедитесь, что все файлы имеют правильные сведения о версии и языке.</span><span class="sxs-lookup"><span data-stu-id="2939a-114">Ensure that all files have the correct version and language information.</span></span> <span data-ttu-id="2939a-115">Средство установщик Windows SDK, Msifiler.exe, может легко сделать это за вас.</span><span class="sxs-lookup"><span data-stu-id="2939a-115">The Windows Installer SDK tool, Msifiler.exe, can easily do this for you.</span></span>

## <a name="source-requirements-when-patching"></a><span data-ttu-id="2939a-116">Требования к источнику при установке исправлений</span><span class="sxs-lookup"><span data-stu-id="2939a-116">Source Requirements When Patching</span></span>

<span data-ttu-id="2939a-117">Для применения исправления в следующих случаях может потребоваться доступ к исходным источникам установки.</span><span class="sxs-lookup"><span data-stu-id="2939a-117">Access to the original installation sources may be required to apply the patch in the following cases:</span></span>

-   <span data-ttu-id="2939a-118">Это исправление применяется к компоненту, который в данный момент выполняется из источника.</span><span class="sxs-lookup"><span data-stu-id="2939a-118">The patch applies to a feature that is currently run from source.</span></span> <span data-ttu-id="2939a-119">В этом случае функция перемещается из состояния запуска от исходного кода в локальное состояние.</span><span class="sxs-lookup"><span data-stu-id="2939a-119">In this case, the feature is transitioned from the run-from-source state to the local state.</span></span>
-   <span data-ttu-id="2939a-120">Исправление применяется к компоненту, который имеет отсутствующий или поврежденный файл.</span><span class="sxs-lookup"><span data-stu-id="2939a-120">The patch applies to a component that has a missing or corrupted file.</span></span>
-   <span data-ttu-id="2939a-121">Исправление применяется к файлу в компоненте, который также содержит файлы без версий без записей Мсифилехаш.</span><span class="sxs-lookup"><span data-stu-id="2939a-121">The patch applies to a file in a component that also contains unversioned files with no MsiFileHash entries.</span></span> <span data-ttu-id="2939a-122">Заполненная [Таблица мсифилехаш](msifilehash-table.md) необходима для предотвращения ненужного повторного копирования файлов с неверсиями из исходного расположения.</span><span class="sxs-lookup"><span data-stu-id="2939a-122">A populated [MsiFileHash Table](msifilehash-table.md) is required to prevent unnecessary recopying of unversioned files from the source location.</span></span>
-   <span data-ttu-id="2939a-123">Исправление было применено с REINSTALLMODE АМУС или емус.</span><span class="sxs-lookup"><span data-stu-id="2939a-123">The patch was applied with a REINSTALLMODE of amus or emus.</span></span> <span data-ttu-id="2939a-124">Этот параметр опасен, так как он выполняет операции копирования файлов независимо от версии файла.</span><span class="sxs-lookup"><span data-stu-id="2939a-124">This option is dangerous in that it performs file copy operations regardless of file version.</span></span> <span data-ttu-id="2939a-125">Это может привести к ревинг файлов, и почти всегда требуется источник.</span><span class="sxs-lookup"><span data-stu-id="2939a-125">This can lead to down-reving of files and almost always requires the source.</span></span> <span data-ttu-id="2939a-126">Рекомендуемое значение REINSTALLMODE — omus.</span><span class="sxs-lookup"><span data-stu-id="2939a-126">The recommended REINSTALLMODE value is omus.</span></span>
-   <span data-ttu-id="2939a-127">Отсутствует кэшированный пакет для продукта.</span><span class="sxs-lookup"><span data-stu-id="2939a-127">The cached package for the product is missing.</span></span> <span data-ttu-id="2939a-128">Для применения исправления требуется кэшированный пакет.</span><span class="sxs-lookup"><span data-stu-id="2939a-128">The cached package is needed for application of a patch.</span></span> <span data-ttu-id="2939a-129">Кэшированный пакет хранится в папке установщика% WINDIR% \\ .</span><span class="sxs-lookup"><span data-stu-id="2939a-129">The cached package is stored in the %windir%\\Installer folder.</span></span>
-   <span data-ttu-id="2939a-130">Пакет создан для выполнения вызова [действия ресолвесаурце](resolvesource-action.md).</span><span class="sxs-lookup"><span data-stu-id="2939a-130">The package is authored to make a call to the [ResolveSource Action](resolvesource-action.md).</span></span> <span data-ttu-id="2939a-131">Это действие обычно следует избегать или подделать соответствующим образом, поскольку его выполнение всегда приводит к получению доступа к источнику.</span><span class="sxs-lookup"><span data-stu-id="2939a-131">This action should generally be avoided or conditionalized appropriately, because its execution always results in an access to the source.</span></span>
-   <span data-ttu-id="2939a-132">У пакета есть пользовательское действие, которое пытается получить доступ к источнику каким-либо образом.</span><span class="sxs-lookup"><span data-stu-id="2939a-132">The package has a custom action that attempts to access the source in some manner.</span></span> <span data-ttu-id="2939a-133">Наиболее распространенный пример — это настраиваемое действие параллельной установки типа 23.</span><span class="sxs-lookup"><span data-stu-id="2939a-133">The most common example is a type 23 concurrent installation custom action.</span></span>
    > [!Note]  
    > <span data-ttu-id="2939a-134">Параллельные установки не рекомендуются для установки приложений, предназначенных для выпуска в общедоступной версии.</span><span class="sxs-lookup"><span data-stu-id="2939a-134">Concurrent installations are not recommended for the installation of applications intended for release to the public.</span></span> <span data-ttu-id="2939a-135">Сведения о параллельных установках см. в разделе [одновременная установка](concurrent-installations.md).</span><span class="sxs-lookup"><span data-stu-id="2939a-135">For information about concurrent installations please see [Concurrent Installations](concurrent-installations.md).</span></span>

     

-   <span data-ttu-id="2939a-136">Пакет исправлений состоит из двоичных исправлений, которые не применяются к текущей версии файла на компьютере.</span><span class="sxs-lookup"><span data-stu-id="2939a-136">The patch package consists of binary patches that do not apply to the current version of the file on the computer.</span></span>

<span data-ttu-id="2939a-137">Рассмотрим следующий пример, где установщик Windows требуется доступ к исходному источнику при применении исправления:</span><span class="sxs-lookup"><span data-stu-id="2939a-137">Consider the following example where Windows Installer requires access to the original source when applying a patch:</span></span>

1.  <span data-ttu-id="2939a-138">Установите ОКОНЧАТЕЛЬНую версию примера продукта.</span><span class="sxs-lookup"><span data-stu-id="2939a-138">Install RTM version of the product Example.</span></span>
2.  <span data-ttu-id="2939a-139">Примените исправление Qfe1. MSP к компьютеру.</span><span class="sxs-lookup"><span data-stu-id="2939a-139">Apply patch Qfe1.msp to the computer.</span></span> <span data-ttu-id="2939a-140">Этот патч версии 1,0 Example.dll до версии 1,1.</span><span class="sxs-lookup"><span data-stu-id="2939a-140">This patches version 1.0 of Example.dll to version 1.1.</span></span>
3.  <span data-ttu-id="2939a-141">Предоставляется новое исправление, Qfe2. MSP, которое обновляет Example.dll до версии 1,2 и устаревшие Qfe1. MSP.</span><span class="sxs-lookup"><span data-stu-id="2939a-141">A new patch, Qfe2.msp is provided, which updates Example.dll to version 1.2 and obsoletes Qfe1.msp.</span></span> <span data-ttu-id="2939a-142">Однако это исправление было создано только для целевой версии 1,0 Example.dll, поскольку оно было создано с помощью RTM-версии продукта.</span><span class="sxs-lookup"><span data-stu-id="2939a-142">However, the patch was only created to target version 1.0 of Example.dll because it was generated using the RTM version of the product.</span></span> <span data-ttu-id="2939a-143">Example.dll версии 1,2 включает исправление, содержащееся в Example.dll версии 1,1, но файл MSP был создан между образами RTM и QFE2.</span><span class="sxs-lookup"><span data-stu-id="2939a-143">Example.dll version 1.2 includes the fix contained in Example.dll version 1.1, but the .msp file was generated between the RTM and QFE2 images.</span></span> <span data-ttu-id="2939a-144">Таким образом, когда к компьютеру применяется Qfe2. MSP, установщик Windows должен получить доступ к исходному источнику.</span><span class="sxs-lookup"><span data-stu-id="2939a-144">So, when Qfe2.msp is applied to the computer, Windows Installer needs to access the original source.</span></span> <span data-ttu-id="2939a-145">Двоичное исправление для Example.dll не может применяться к версии 1,1; Он может применяться только к версии 1,0.</span><span class="sxs-lookup"><span data-stu-id="2939a-145">The binary patch for Example.dll cannot apply to version 1.1; it can only apply to version 1.0.</span></span> <span data-ttu-id="2939a-146">Это приведет к повторному копированию версии 1,0 Example.dll из исходного расположения источника, чтобы исправление можно было применить успешно.</span><span class="sxs-lookup"><span data-stu-id="2939a-146">This results in the Installer recopying version 1.0 of Example.dll from the original source location so that the patch can be applied successfully.</span></span>

## <a name="source-requirements-when-removing-a-patch"></a><span data-ttu-id="2939a-147">Требования к источнику при удалении исправления</span><span class="sxs-lookup"><span data-stu-id="2939a-147">Source Requirements When Removing a Patch</span></span>

<span data-ttu-id="2939a-148">Для удаления исправления может потребоваться доступ к исходным источникам установки, если установщик Windows не сохранила базовые сведения об этом исправлении.</span><span class="sxs-lookup"><span data-stu-id="2939a-148">Access to the original installation sources may be required to remove a patch if the Windows Installer has not stored baseline information about the patch.</span></span> <span data-ttu-id="2939a-149">Начиная с установщик Windows 3,0, установщик выборочно сохраняет базовые сведения о файлах при их обновлении.</span><span class="sxs-lookup"><span data-stu-id="2939a-149">Beginning with Windows Installer 3.0, the installer selectively saves baseline information about files when they are updated.</span></span> <span data-ttu-id="2939a-150">Дополнительные сведения о базовом кэше см. в разделе [уменьшение размера исправления](reducing-patch-size.md) .</span><span class="sxs-lookup"><span data-stu-id="2939a-150">For more information about the baseline cache, see [Reducing Patch Size](reducing-patch-size.md) .</span></span>

 

 



