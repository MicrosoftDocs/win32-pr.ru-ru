---
description: Настраиваемые действия планируются в таблицах последовательности таким же образом, как стандартные действия.
ms.assetid: 1aea75b1-a498-405e-9208-91672455496b
title: Виртуализация настраиваемых действий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ad7c24fb91247a36880cb808c9b8e10437312cf7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104272781"
---
# <a name="sequencing-custom-actions"></a><span data-ttu-id="fdbaa-103">Виртуализация настраиваемых действий</span><span class="sxs-lookup"><span data-stu-id="fdbaa-103">Sequencing Custom Actions</span></span>

<span data-ttu-id="fdbaa-104">Настраиваемые действия планируются в таблицах последовательности таким же образом, как стандартные действия.</span><span class="sxs-lookup"><span data-stu-id="fdbaa-104">Custom actions are scheduled in sequence tables in the same way as standard actions.</span></span>

<span data-ttu-id="fdbaa-105">**Планирование настраиваемого действия в таблице последовательности**</span><span class="sxs-lookup"><span data-stu-id="fdbaa-105">**To schedule a custom action in a sequence table**</span></span>

1.  <span data-ttu-id="fdbaa-106">Введите имя настраиваемого действия (первичный ключ пользовательской программы [CustomAction](customaction-table.md)) в столбец Action таблицы [Sequence](sequence-table-detailed-example.md) .</span><span class="sxs-lookup"><span data-stu-id="fdbaa-106">Enter the custom action name (which is the primary key of the [CustomAction](customaction-table.md)) table into the Action column of the [Sequence](sequence-table-detailed-example.md) table.</span></span>
2.  <span data-ttu-id="fdbaa-107">Введите последовательность настраиваемого действия относительно других действий в таблице в столбец Sequence таблицы [Sequence](sequence-table-detailed-example.md) .</span><span class="sxs-lookup"><span data-stu-id="fdbaa-107">Enter the custom action's sequence relative to the other actions in the table into the Sequence column of the [Sequence](sequence-table-detailed-example.md) table.</span></span> <span data-ttu-id="fdbaa-108">Дополнительные сведения о таблицах последовательностей см. в разделе [Использование таблицы последовательностей](using-a-sequence-table.md).</span><span class="sxs-lookup"><span data-stu-id="fdbaa-108">For more information about sequence tables, see [Using a Sequence Table](using-a-sequence-table.md).</span></span>
3.  <span data-ttu-id="fdbaa-109">Чтобы условно пропустить действие, введите условное выражение в столбец Условие таблицы [Sequence](sequence-table-detailed-example.md) .</span><span class="sxs-lookup"><span data-stu-id="fdbaa-109">To conditionally skip the action, enter a conditional expression into the Condition column of the [Sequence](sequence-table-detailed-example.md) table.</span></span> <span data-ttu-id="fdbaa-110">Установщик пропускает это действие, если выражение принимает значение FALSE.</span><span class="sxs-lookup"><span data-stu-id="fdbaa-110">The installer skips this action if the expression evaluates to FALSE.</span></span>

<span data-ttu-id="fdbaa-111">Как и в случае со стандартными действиями, настраиваемые действия, запланированные в [инсталлуисекуенце](installuisequence-table.md) или [админуисекуенце](adminuisequence-table.md) , выполняются только в том случае, если для внутреннего пользовательского интерфейса задан полный уровень.</span><span class="sxs-lookup"><span data-stu-id="fdbaa-111">As in the case of standard actions, custom actions that are scheduled in the [InstallUISequence](installuisequence-table.md) or [AdminUISequence](adminuisequence-table.md) run only if the internal user interface is set to the full level.</span></span> <span data-ttu-id="fdbaa-112">Уровень пользовательского интерфейса задается с помощью функции [**мсисетинтерналуи**](/windows/desktop/api/Msi/nf-msi-msisetinternalui) .</span><span class="sxs-lookup"><span data-stu-id="fdbaa-112">The UI level is set by using the [**MsiSetInternalUI**](/windows/desktop/api/Msi/nf-msi-msisetinternalui) function.</span></span>

<span data-ttu-id="fdbaa-113">Стандартные и настраиваемые действия, запланированные в таблицах [инсталлексекутесекуенце](installexecutesequence-table.md), [админексекутесекуенце](adminexecutesequence-table.md)или [адвтексекутесекуенце](advtexecutesequence-table.md) , не делают изменения в системе.</span><span class="sxs-lookup"><span data-stu-id="fdbaa-113">Standard and custom actions scheduled in the [InstallExecuteSequence](installexecutesequence-table.md), [AdminExecuteSequence](adminexecutesequence-table.md), or [AdvtExecuteSequence](advtexecutesequence-table.md) tables do not make system changes.</span></span> <span data-ttu-id="fdbaa-114">Вместо этого Установщик помещает в очередь записи выполнения в скрипте для последующего выполнения во время работы службы установки.</span><span class="sxs-lookup"><span data-stu-id="fdbaa-114">Instead the installer queues up execution records in a script for subsequent execution during the install service.</span></span> <span data-ttu-id="fdbaa-115">Если служба установки отсутствует, действия, запланированные в этих таблицах, выполняются в том же контексте, что и последовательность пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="fdbaa-115">If there is no install service, then the actions scheduled in these tables are run in the same context as the UI sequence.</span></span>

<span data-ttu-id="fdbaa-116">Если сервер установщика не зарегистрирован, пользовательские действия выполняются на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="fdbaa-116">If the installer server is not registered, the custom actions are executed on the client side.</span></span> <span data-ttu-id="fdbaa-117">Если сервер зарегистрирован и использует режим полного пользовательского интерфейса, настраиваемые действия выполняются на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="fdbaa-117">If the server is registered and using the full UI mode, then the custom actions are run on the server side.</span></span>

<span data-ttu-id="fdbaa-118">При использовании полного пользовательского интерфейса с сервером начальные действия, выполняемые перед действием [инсталлвалидате](installvalidate-action.md) , выполняются на клиенте, чтобы обеспечить полное взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="fdbaa-118">If using full UI with the server, the initial actions prior to the [InstallValidate](installvalidate-action.md) action are run on the client to allow full interaction.</span></span> <span data-ttu-id="fdbaa-119">Затем выполнение переключается на сервер, который повторяет эти действия и выполняет действия по выполнению скрипта.</span><span class="sxs-lookup"><span data-stu-id="fdbaa-119">Execution is then switched to the server which repeats those actions and runs the script execution actions.</span></span> <span data-ttu-id="fdbaa-120">За ним следует возврат клиенту для получения окончательных действий.</span><span class="sxs-lookup"><span data-stu-id="fdbaa-120">This is followed by a return to the client for the final actions.</span></span>

<span data-ttu-id="fdbaa-121">Обратите внимание, что если продукт удаляется из-за того, что его компонент Top имеет значение отсутствует, свойство [**Remove**](remove.md) может не совпадать со значением ALL до действия [инсталлвалидате](installvalidate-action.md) .</span><span class="sxs-lookup"><span data-stu-id="fdbaa-121">Note that if a product is removed by setting its top feature to absent, the [**REMOVE**](remove.md) property may not equal ALL until after the [InstallValidate](installvalidate-action.md) action.</span></span> <span data-ttu-id="fdbaa-122">Это означает, что любое пользовательское действие, зависящее от Remove = ALL, должно быть упорядочено после действия Инсталлвалидате.</span><span class="sxs-lookup"><span data-stu-id="fdbaa-122">This means that any custom action that depends on REMOVE=ALL must be sequenced after the InstallValidate action.</span></span> <span data-ttu-id="fdbaa-123">Пользовательское действие может проверить удаление, чтобы определить, был ли установлен продукт полностью удален.</span><span class="sxs-lookup"><span data-stu-id="fdbaa-123">A custom action may check REMOVE to determine whether a product has been set to be completely uninstalled.</span></span>

<span data-ttu-id="fdbaa-124">Настраиваемые действия, которые ссылаются на установленный файл в качестве источника, например тип настраиваемого действия 17 (DLL), тип настраиваемого действия 18 (EXE), тип настраиваемого действия 21 (JScript) и тип настраиваемого действия 22 (VBScript), должны соответствовать следующим ограничениям последовательности.</span><span class="sxs-lookup"><span data-stu-id="fdbaa-124">Custom actions that reference an installed file as their source, such as Custom Action Type 17 (DLL), Custom Action Type 18 (EXE), Custom Action Type 21 (JScript), and Custom Action Type 22 (VBScript), must adhere to the following sequencing restrictions.</span></span>

-   <span data-ttu-id="fdbaa-125">Пользовательское действие должно быть упорядочено после действия [костфинализе](costfinalize-action.md) , чтобы можно было разрешить путь к файлу, на который указывает ссылка.</span><span class="sxs-lookup"><span data-stu-id="fdbaa-125">The custom action must be sequenced after the [CostFinalize](costfinalize-action.md) action so that the path to the referenced file can be resolved.</span></span>
-   <span data-ttu-id="fdbaa-126">Если исходный файл еще не установлен на компьютере, отложенные (в скрипте) настраиваемые действия должны быть упорядочены после [инсталлфилес](installfiles-action.md).</span><span class="sxs-lookup"><span data-stu-id="fdbaa-126">If the source file is not already installed on the computer, deferred (in-script) custom actions must be sequenced after the [InstallFiles](installfiles-action.md).</span></span>
-   <span data-ttu-id="fdbaa-127">Если исходный файл еще не установлен на компьютере, пользовательские действия нондеферред должны быть упорядочены после действия [инсталлинитиализе](installinitialize-action.md) .</span><span class="sxs-lookup"><span data-stu-id="fdbaa-127">If the source file is not already installed on the computer, nondeferred custom actions must be sequenced after the [InstallInitialize](installinitialize-action.md) action.</span></span>

<span data-ttu-id="fdbaa-128">Следующие ограничения последовательности применяются к настраиваемым действиям, которые изменяют или обновляют пакет установщик Windows.</span><span class="sxs-lookup"><span data-stu-id="fdbaa-128">The following sequencing restrictions apply to custom actions that change or update a Windows Installer package.</span></span>

-   <span data-ttu-id="fdbaa-129">Если пользовательское действие изменяет пакет, например, добавляя строки в таблицу, действие должно быть упорядочено до действия [инсталлинитиализе](installinitialize-action.md) .</span><span class="sxs-lookup"><span data-stu-id="fdbaa-129">If the custom action changes the package, such as by adding rows to a table, the action must be sequenced before the [InstallInitialize](installinitialize-action.md) action.</span></span>
-   <span data-ttu-id="fdbaa-130">Если пользовательское действие вносит изменения, которые повлияют на стоимость, она должна быть упорядочена перед действием [костинитиализе](costfinalize-action.md) .</span><span class="sxs-lookup"><span data-stu-id="fdbaa-130">If the custom action makes changes that would affect costing, then it should be sequenced before the [CostInitialize](costfinalize-action.md) action.</span></span>
-   <span data-ttu-id="fdbaa-131">Если пользовательское действие изменяет состояние установки компонентов или компонентов, оно должно быть упорядочено перед действием [инсталлвалидате](installvalidate-action.md) .</span><span class="sxs-lookup"><span data-stu-id="fdbaa-131">If the custom action changes the installation state of features or components, it must be sequenced before the [InstallValidate](installvalidate-action.md) action.</span></span>

 

 



