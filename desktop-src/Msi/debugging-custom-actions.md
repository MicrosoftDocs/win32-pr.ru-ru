---
description: Вы можете выполнять отладку пользовательских действий, основанных на библиотеках динамической компоновки, с помощью средств отладки для Windows. Нельзя использовать динамическую отладку с настраиваемыми действиями на основе исполняемых файлов или скриптов.
ms.assetid: 4241a27a-c127-4c65-96a2-1d655b343eba
title: Отладка настраиваемых действий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9ddfbc9952f0dd7fc1b85b5c64fa6a23381ceafe
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105663716"
---
# <a name="debugging-custom-actions"></a><span data-ttu-id="fac69-104">Отладка настраиваемых действий</span><span class="sxs-lookup"><span data-stu-id="fac69-104">Debugging Custom Actions</span></span>

<span data-ttu-id="fac69-105">Вы можете выполнять отладку пользовательских действий, основанных на [библиотеках динамической компоновки](dynamic-link-libraries.md) , с помощью [средств отладки для Windows](https://www.microsoft.com/?ref=go).</span><span class="sxs-lookup"><span data-stu-id="fac69-105">You can debug custom actions that are based on [dynamic-link libraries](dynamic-link-libraries.md) by using [Debugging Tools for Windows](https://www.microsoft.com/?ref=go).</span></span> <span data-ttu-id="fac69-106">Нельзя использовать динамическую отладку с настраиваемыми действиями на основе [исполняемых файлов](executable-files.md) или [скриптов](scripts.md).</span><span class="sxs-lookup"><span data-stu-id="fac69-106">It is not possible to use dynamic debugging with custom actions based on [executable files](executable-files.md) or [scripts](scripts.md).</span></span>

<span data-ttu-id="fac69-107">Методы, описанные в этом разделе, помогут вам выполнить отладку установщик Windows пользовательских действий.</span><span class="sxs-lookup"><span data-stu-id="fac69-107">The techniques described in this section can help you debug Windows Installer custom actions.</span></span> <span data-ttu-id="fac69-108">Сведения о [средствах отладки для Windows](https://www.microsoft.com/?ref=go)см. в разделе средства разработки драйверов пакета Windows Driver Kit (WDK).</span><span class="sxs-lookup"><span data-stu-id="fac69-108">See the Driver Development Tools section of the Windows Driver Kit (WDK) for information about [Debugging Tools for Windows](https://www.microsoft.com/?ref=go).</span></span>

<span data-ttu-id="fac69-109">Установщик Windows использует переменную среды Мсибреак, чтобы определить, какое настраиваемое действие следует отлаживать.</span><span class="sxs-lookup"><span data-stu-id="fac69-109">Windows Installer uses the MsiBreak environment variable to determine which custom action is to be debugged.</span></span> <span data-ttu-id="fac69-110">Если у вас есть доступ к исходному коду настраиваемого действия, вы можете использовать отладку без Мсибреак.</span><span class="sxs-lookup"><span data-stu-id="fac69-110">If you have access to the custom action's source code, you may be able to use debugging without MsiBreak.</span></span> <span data-ttu-id="fac69-111">Чтобы начать отладку без Мсибреак, вставьте временное окно сообщения в начале кода действия.</span><span class="sxs-lookup"><span data-stu-id="fac69-111">To start debugging without MsiBreak, put a temporary message box at the beginning of the action's code.</span></span> <span data-ttu-id="fac69-112">Когда в процессе установки появится окно сообщения, Подключите отладчик к процессу, владеющему окном сообщения.</span><span class="sxs-lookup"><span data-stu-id="fac69-112">When the message box appears during the installation, attach the debugger to the process owning the message box.</span></span> <span data-ttu-id="fac69-113">Затем можно задать все необходимые точки останова и закрыть окно сообщения, чтобы возобновить выполнение.</span><span class="sxs-lookup"><span data-stu-id="fac69-113">You can then set any necessary breakpoints and dismiss the message box to resume execution.</span></span> <span data-ttu-id="fac69-114">Невозможно выполнить отладку предыдущих частей настраиваемого действия с помощью этого метода.</span><span class="sxs-lookup"><span data-stu-id="fac69-114">It is not possible to debug the earlier portions of the custom action by this method.</span></span>

<span data-ttu-id="fac69-115">Чтобы использовать переменную среды Мсибреак для отладки настраиваемого действия, задайте Мсибреак в качестве имени настраиваемого действия в [таблице CustomAction](customaction-table.md).</span><span class="sxs-lookup"><span data-stu-id="fac69-115">To use the MsiBreak environment variable to debug the custom action, set MsiBreak to the custom action's name in the [CustomAction table](customaction-table.md).</span></span> <span data-ttu-id="fac69-116">Мсибреак может быть либо системной, либо пользовательской переменной среды.</span><span class="sxs-lookup"><span data-stu-id="fac69-116">MsiBreak can be either a system or a user environment variable.</span></span> <span data-ttu-id="fac69-117">Если переменная задана как системная переменная, то при изменении значения для обнаружения нового значения может потребоваться перезагрузка системы.</span><span class="sxs-lookup"><span data-stu-id="fac69-117">If the variable is set as a system variable, a restart of the system may be needed when the value is changed to detect the new value.</span></span>

<span data-ttu-id="fac69-118">Чтобы использовать переменную среды Мсибреак для отладки внедренного пользовательского интерфейса, присвойте параметру Мсибреак значение Мсиембеддедуи.</span><span class="sxs-lookup"><span data-stu-id="fac69-118">To use the MsiBreak environment variable to debug an embedded user interface, set the value of MsiBreak to MsiEmbeddedUI.</span></span>

<span data-ttu-id="fac69-119">Установщик Windows только проверяет переменную среды Мсибреак, если пользователь является администратором.</span><span class="sxs-lookup"><span data-stu-id="fac69-119">Windows Installer only checks the MsiBreak environment variable if the user is an Administrator.</span></span> <span data-ttu-id="fac69-120">Установщик игнорирует значение параметра Мсибреак, если пользователь не является администратором, даже если это [*управляемое приложение*](m-gly.md).</span><span class="sxs-lookup"><span data-stu-id="fac69-120">The installer ignores the value of MsiBreak if the user is not an Administrator, even if this is a [*managed application*](m-gly.md).</span></span>

<span data-ttu-id="fac69-121">При отладке настраиваемого действия, выполняемого с привилегиями с повышенными правами (System) в последовательности выполнения, Подключите отладчик к службе установщик Windows.</span><span class="sxs-lookup"><span data-stu-id="fac69-121">If you are debugging a custom action that runs with elevated (system) privileges in the execution sequence, attach the debugger to the Windows Installer service.</span></span> <span data-ttu-id="fac69-122">При отладке настраиваемого действия, которое выполняется с олицетворенными привилегиями в последовательности выполнения, система запрашивает диалоговое окно с указанием, какой процесс должен быть отлажен.</span><span class="sxs-lookup"><span data-stu-id="fac69-122">When debugging a custom action that runs with impersonated privileges in the execution sequence, the system prompts with a dialog box that indicates which process should be debugged.</span></span> <span data-ttu-id="fac69-123">Пользователю будет предложено диалоговое окно с указанием процесса отладки.</span><span class="sxs-lookup"><span data-stu-id="fac69-123">The user is prompted with a dialog box indicating which process to debug.</span></span> <span data-ttu-id="fac69-124">Дополнительные сведения о настраиваемых действиях с повышенными правами см. в разделе [Безопасность настраиваемых действий](custom-action-security.md).</span><span class="sxs-lookup"><span data-stu-id="fac69-124">For more information about elevated custom actions, see [Custom Action Security](custom-action-security.md).</span></span>

<span data-ttu-id="fac69-125">После присоединения отладчика к нужному процессу установщик активирует точку останова отладчика непосредственно перед вызовом точки входа библиотеки DLL.</span><span class="sxs-lookup"><span data-stu-id="fac69-125">Once the debugger has been attached to the correct process, the installer triggers a debugger breakpoint immediately before calling the entry point of the DLL.</span></span> <span data-ttu-id="fac69-126">В точке останова ваша библиотека DLL уже загружена в процесс и определен адрес точки входа.</span><span class="sxs-lookup"><span data-stu-id="fac69-126">At the breakpoint, your DLL is already loaded into the process and the entry point address determined.</span></span> <span data-ttu-id="fac69-127">Если не удалось загрузить библиотеку DLL пользовательского действия или точка входа настраиваемого действия не существует, точка останова не запускается.</span><span class="sxs-lookup"><span data-stu-id="fac69-127">If your custom action DLL could not be loaded or the custom action entry point did not exist, no breakpoint is triggered.</span></span> <span data-ttu-id="fac69-128">Так как точка останова активируется перед вызовом функции DLL, после активации точки останова следует использовать отладчик, чтобы перейти на другой адрес до вызова точки входа настраиваемого действия.</span><span class="sxs-lookup"><span data-stu-id="fac69-128">Because the breakpoint is triggered before calling the DLL function, once the breakpoint has been triggered you should use your debugger to step forward until your custom action entry point is called.</span></span> <span data-ttu-id="fac69-129">Кроме того, можно задать точку останова в любом месте настраиваемого действия и возобновить нормальное выполнение.</span><span class="sxs-lookup"><span data-stu-id="fac69-129">Alternately, you can set a breakpoint anywhere in your custom action and resume normal execution.</span></span>

<span data-ttu-id="fac69-130">Установщик Windows выполняет библиотеки DLL, не хранящиеся в [двоичной таблице](binary-table.md) непосредственно из расположения библиотеки DLL.</span><span class="sxs-lookup"><span data-stu-id="fac69-130">The Windows Installer executes DLLs not stored in the [Binary table](binary-table.md) directly from the DLL location.</span></span> <span data-ttu-id="fac69-131">Установщик не знает исходное имя библиотеки DLL, хранящейся в двоичной таблице, и запускает настраиваемое действие DLL с именем временного файла.</span><span class="sxs-lookup"><span data-stu-id="fac69-131">The installer does not know the original name of a DLL stored in the Binary table and runs the DLL custom action under a temporary file name.</span></span> <span data-ttu-id="fac69-132">Формат имени временного файла — MSI?????. TMP.</span><span class="sxs-lookup"><span data-stu-id="fac69-132">The form of the temporary file name is MSI?????.TMP.</span></span> <span data-ttu-id="fac69-133">В Windows XP этот временный файл хранится в безопасном месте, обычно в <WindowFolder> \\ установщике.</span><span class="sxs-lookup"><span data-stu-id="fac69-133">On Windows XP, this temporary file is stored in a secure location, commonly <WindowFolder>\\Installer.</span></span>

<span data-ttu-id="fac69-134">Обратите внимание, что многие библиотеки DLL, созданные для отладки, содержат имя и путь к соответствующему PDB-файлу в составе самой библиотеки DLL.</span><span class="sxs-lookup"><span data-stu-id="fac69-134">Note that many DLLs created for debugging contain the name and path of the corresponding PDB file as part of the DLL itself.</span></span> <span data-ttu-id="fac69-135">При отладке библиотеки DLL этого типа в системе, где файл PDB можно найти в расположении, хранящемся в библиотеке DLL, символы могут загружаться автоматически с помощью средства отладки.</span><span class="sxs-lookup"><span data-stu-id="fac69-135">When debugging this type of DLL on a system where the PDB can be found at the location stored in the DLL, symbols may be loaded automatically by the debugger tool.</span></span> <span data-ttu-id="fac69-136">В ситуациях, когда PDB не удается найти в сохраненном расположении, где отладчик не поддерживает загрузку символов из сохраненного расположения или если библиотека DLL не была построена с отладочной информацией, может потребоваться поместить файлы символов в папку с временным файлом DLL.</span><span class="sxs-lookup"><span data-stu-id="fac69-136">In situations where the PDB cannot be found at the stored location, where the debugger does not support loading symbols from the stored location, or where the DLL was not built with debugging information, you may need to place your symbol files in the folder with the temporary DLL file.</span></span>

<span data-ttu-id="fac69-137">Установщик добавляет отладочную информацию для сценариев настраиваемых действий в файл журнала установки.</span><span class="sxs-lookup"><span data-stu-id="fac69-137">The installer adds debugging information for custom action scripts to the installation log file.</span></span>

``` syntax
There is a problem with this Windows Installer package. A script 
required for this install to complete could not be run. Contact your 
support personnel or package vendor.  {Custom action [2] script error 
[3], [4]: [5] Line [6], Column [7], [8] }
```

 

 



