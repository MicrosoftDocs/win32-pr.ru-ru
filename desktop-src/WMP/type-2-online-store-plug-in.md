---
title: Подключаемый модуль интернет-магазина типа 2
description: Подключаемый модуль интернет-магазина типа 2
ms.assetid: 16e90a01-20be-49a6-96df-de81a7283f42
keywords:
- Интернет-магазины проигрывателя Windows Media, подключаемые модули
- Интернет-магазины, подключаемые модули
- Тип 2 Интернет-магазинов, подключаемые модули
- Интернет-магазины проигрывателя Windows Media, интерфейс Ивмпсубскриптионсервице
- Интернет-магазины, интерфейс Ивмпсубскриптионсервице
- Тип 2 Интернет-магазинов, интерфейс Ивмпсубскриптионсервице
- подключаемые модули, Интернет-магазины проигрывателя Windows Media
- подключаемые модули, Интернет-магазины
- подключаемые модули, тип 2 Интернет-магазинов
- подключаемые модули, интерфейс Ивмпсубскриптионсервице
- Подключаемые модули проигрывателя Windows Media, тип 2 Интернет-магазинов
- Подключаемые модули проигрывателя Windows Media, Интернет-магазины
- Подключаемые модули проигрывателя Windows Media, Интернет-магазины проигрывателя Windows Media
- Подключаемые модули проигрывателя Windows Media, интерфейс Ивмпсубскриптионсервице
- ивмпсубскриптионсервице
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c6d2f3aeeaa7456c3452b498a1a728e24c96783c
ms.sourcegitcommit: ad672d3a10192c5ccac619ad2524407109266e93
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/25/2020
ms.locfileid: "104133590"
---
# <a name="type-2-online-store-plug-in"></a><span data-ttu-id="c1c94-118">Подключаемый модуль интернет-магазина типа 2</span><span class="sxs-lookup"><span data-stu-id="c1c94-118">Type 2 Online Store Plug-in</span></span>

<span data-ttu-id="c1c94-119">Подключаемый модуль интернет-магазина типа 2 — это COM-компонент, реализующий интерфейс [ивмпсубскриптионсервице](/previous-versions/windows/desktop/api/subscriptionservices/nn-subscriptionservices-iwmpsubscriptionservice) и, при необходимости, интерфейс [IWMPSubscriptionService2](/previous-versions/windows/desktop/api/subscriptionservices/nn-subscriptionservices-iwmpsubscriptionservice2) .</span><span class="sxs-lookup"><span data-stu-id="c1c94-119">A type 2 online store plug-in is a COM component that implements the [IWMPSubscriptionService](/previous-versions/windows/desktop/api/subscriptionservices/nn-subscriptionservices-iwmpsubscriptionservice) interface and optionally the [IWMPSubscriptionService2](/previous-versions/windows/desktop/api/subscriptionservices/nn-subscriptionservices-iwmpsubscriptionservice2) interface.</span></span> <span data-ttu-id="c1c94-120">Проигрыватель Windows Media 9 вызывает методы интерфейса **ивмпсубскриптионсервице** .</span><span class="sxs-lookup"><span data-stu-id="c1c94-120">Windows Media Player 9 calls the methods of the **IWMPSubscriptionService** interface.</span></span> <span data-ttu-id="c1c94-121">Проигрыватель Windows Media 10 или более поздней версии вызывает методы интерфейсов **ивмпсубскриптионсервице** и **IWMPSubscriptionService2** .</span><span class="sxs-lookup"><span data-stu-id="c1c94-121">Windows Media Player 10 or later calls the methods of both the **IWMPSubscriptionService** and **IWMPSubscriptionService2** interfaces.</span></span>

<span data-ttu-id="c1c94-122">Подключаемый модуль интернет-магазина типа 2 упакован как внутрипроцессный COM-сервер.</span><span class="sxs-lookup"><span data-stu-id="c1c94-122">A type 2 online store plug-in is packaged as an in-process COM server.</span></span> <span data-ttu-id="c1c94-123">То есть подключаемый модуль реализуется в DLL-файле, сопоставленном с процессом проигрывателя Windows Media.</span><span class="sxs-lookup"><span data-stu-id="c1c94-123">That is, the plug-in is implemented in a .dll file that is mapped into the Windows Media Player process.</span></span>

<span data-ttu-id="c1c94-124">Проигрыватель Windows Media при необходимости активирует подключаемые модули оперативного хранилища типа 2.</span><span class="sxs-lookup"><span data-stu-id="c1c94-124">Windows Media Player activates type 2 online store plug-ins as needed.</span></span> <span data-ttu-id="c1c94-125">Например, предположим, что пользователь пытается воспроизвести защищенную песню, а Текущая лицензия для ее воспроизведения отсутствует.</span><span class="sxs-lookup"><span data-stu-id="c1c94-125">For example, suppose the user attempts to play a protected song, and there is no current license to play it.</span></span> <span data-ttu-id="c1c94-126">В этом случае проигрыватель Windows Media проверяет атрибут **контентдистрибутор** либо в заголовке файла, либо в заголовке DRM.</span><span class="sxs-lookup"><span data-stu-id="c1c94-126">In that case, Windows Media Player inspects the **ContentDistributor** attribute in either the file header or the DRM header.</span></span> <span data-ttu-id="c1c94-127">Если существует значение, совпадающее с именем ключа Интернет-магазина, проигрыватель Windows Media проверяет реестр, чтобы проверить, предоставил ли Интернет-магазин подключаемый модуль типа 2.</span><span class="sxs-lookup"><span data-stu-id="c1c94-127">If a value exists that matches the key name of an online store, Windows Media Player checks the registry to see whether that online store has provided a type 2 plug-in.</span></span> <span data-ttu-id="c1c94-128">Если подключаемый модуль существует, проигрыватель Windows Media загружает подключаемый модуль и вызывает его методы, чтобы определить, имеет ли пользователь права на воспроизведение песни.</span><span class="sxs-lookup"><span data-stu-id="c1c94-128">If the plug-in exists, Windows Media Player loads the plug-in and calls its methods to determine whether the user is has the rights to play the song.</span></span>

<span data-ttu-id="c1c94-129">В следующем списке описаны некоторые сценарии, в которых проигрыватель Windows Media вызывает подключаемый модуль интернет-магазина типа 2.</span><span class="sxs-lookup"><span data-stu-id="c1c94-129">The following list describes some of the scenarios in which Windows Media Player calls a type 2 online store plug-in.</span></span>

-   <span data-ttu-id="c1c94-130">**Пользователь пытается воспроизвести содержимое Интернет-магазина.**</span><span class="sxs-lookup"><span data-stu-id="c1c94-130">**The user attempts to play online store content.**</span></span> <span data-ttu-id="c1c94-131">В этом случае проигрыватель Windows Media вызывает метод [ивмпсубскриптионсервице:: алловплай](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice-allowplay) подключаемого модуля, передавая указатель на мультимедийный элемент, который пытается воспроизвести пользователь.</span><span class="sxs-lookup"><span data-stu-id="c1c94-131">When this happens, Windows Media Player calls the plug-in's [IWMPSubscriptionService::allowPlay](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice-allowplay) method, passing a pointer to the digital media item that the user is attempting to play.</span></span> <span data-ttu-id="c1c94-132">Интернет-магазин может использовать эту возможность для обновления лицензии пользователя на воспроизведение содержимого или запрета воспроизведения.</span><span class="sxs-lookup"><span data-stu-id="c1c94-132">The online store can use this as an opportunity to update the user's license to play the content or to disallow playback.</span></span> <span data-ttu-id="c1c94-133">Если подключаемый модуль возвращает **значение true** в параметре *Пфалловплай* , проигрыватель Windows Media пытается воспроизвести содержимое.</span><span class="sxs-lookup"><span data-stu-id="c1c94-133">If the plug-in returns **TRUE** in the *pfAllowPlay* parameter, Windows Media Player attempts to play the content.</span></span> <span data-ttu-id="c1c94-134">Воспроизведение по-прежнему завершится ошибкой, если действительная лицензия не существует. Этот процесс не обходит управление цифровыми правами (DRM).</span><span class="sxs-lookup"><span data-stu-id="c1c94-134">Playback will still fail if a valid license does not exist; this process does not circumvent digital rights management (DRM).</span></span>
-   <span data-ttu-id="c1c94-135">**Пользователь запрашивает разрешение на запись содержимого на компакт-диск или DVD-диск.**</span><span class="sxs-lookup"><span data-stu-id="c1c94-135">**The user requests permission to burn content to a CD or DVD.**</span></span> <span data-ttu-id="c1c94-136">В этом случае проигрыватель Windows Media вызывает метод [ивмпсубскриптионсервице:: алловкдбурн](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice-allowcdburn) подключаемого модуля.</span><span class="sxs-lookup"><span data-stu-id="c1c94-136">When this happens, Windows Media Player calls the plug-in's [IWMPSubscriptionService::allowCDBurn](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice-allowcdburn) method.</span></span>
-   <span data-ttu-id="c1c94-137">**Пользователь пытается синхронизировать содержимое Интернет-магазина с устройством, или проигрыватель Windows Media готов к автоматической синхронизации содержимого Интернет-магазина с устройством.**</span><span class="sxs-lookup"><span data-stu-id="c1c94-137">**The user attempts to synchronize online store content with a device, or Windows Media Player is ready to automatically synchronize online store content with a device.**</span></span> <span data-ttu-id="c1c94-138">В этом случае проигрыватель Windows Media вызывает метод [IWMPSubscriptionService2::P репарефорсинк](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice2-prepareforsync) подключаемого модуля для оповещения Интернет-магазина о том, что элемент мультимедиа будет синхронизирован с определенным устройством, которое определяется по каноническому имени.</span><span class="sxs-lookup"><span data-stu-id="c1c94-138">When this happens, Windows Media Player calls the plug-in's [IWMPSubscriptionService2::prepareForSync](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice2-prepareforsync) method to alert the online store that a media item is about to be synchronized with a particular device, which is identified by its canonical name.</span></span> <span data-ttu-id="c1c94-139">Это возможность Интернет-магазина определить, разрешено ли пользователю синхронизировать элемент мультимедиа с устройством.</span><span class="sxs-lookup"><span data-stu-id="c1c94-139">This is an opportunity for the online store to determine whether the user is allowed to synchronize the media item with the device.</span></span> <span data-ttu-id="c1c94-140">Кроме того, в Интернет-магазине можно подготовить устройство к синхронизации и обновить записи, такие как счетчики синхронизации, связанные с устройством или элементом мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="c1c94-140">It is also an opportunity for the online store to prepare the device for synchronization and to update records, such as synchronization counts, associated with the device or the media item.</span></span> <span data-ttu-id="c1c94-141">Подключаемый модуль должен передавать задачи разрешения, подготовки и сохранения записей в отдельный поток и сразу же возвращаться из **препарефорсинк**.</span><span class="sxs-lookup"><span data-stu-id="c1c94-141">The plug-in should pass the permission, preparation, and record-keeping tasks to a separate thread and return immediately from **prepareForSync**.</span></span> <span data-ttu-id="c1c94-142">Когда отдельный поток завершит свою работу, он должен уведомить проигрыватель Windows Media, вызвав [ивмпсубскриптионсервицекаллбакк:: OnComplete](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservicecallback-oncomplete).</span><span class="sxs-lookup"><span data-stu-id="c1c94-142">When the separate thread has finished its work, it must notify Windows Media Player by calling [IWMPSubscriptionServiceCallback::onComplete](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservicecallback-oncomplete).</span></span>
-   <span data-ttu-id="c1c94-143">**Устройство станет доступным для фоновой обработки.**</span><span class="sxs-lookup"><span data-stu-id="c1c94-143">**A device becomes available for background processing.**</span></span> <span data-ttu-id="c1c94-144">Когда устройство подключено, проигрыватель Windows Media оповещает Интернет-магазин о том, что устройство доступно и бездействует, вызывая [IWMPSubscriptionService2::D евицеаваилабле](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice2-deviceavailable).</span><span class="sxs-lookup"><span data-stu-id="c1c94-144">When a device is connected, Windows Media Player alerts the online store that the device is available and idle by calling [IWMPSubscriptionService2::deviceAvailable](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice2-deviceavailable).</span></span>
-   <span data-ttu-id="c1c94-145">**Пользователь нажимает кнопку для активации Интернет-магазина в проигрывателе Windows Media.**</span><span class="sxs-lookup"><span data-stu-id="c1c94-145">**The user clicks a button to activate an online store in Windows Media Player.**</span></span> <span data-ttu-id="c1c94-146">В этом случае проигрыватель Windows Media вызывает метод [IWMPSubscriptionService2:: сервицеевент](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice2-serviceevent) подключаемого модуля.</span><span class="sxs-lookup"><span data-stu-id="c1c94-146">When this occurs, Windows Media Player calls the plug-in's [IWMPSubscriptionService2::serviceEvent](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice2-serviceevent) method.</span></span> <span data-ttu-id="c1c94-147">Проигрыватель Windows Media также вызывает этот метод, когда пользователь переключается на другую службу.</span><span class="sxs-lookup"><span data-stu-id="c1c94-147">Windows Media Player also calls this method when the user switches to another service.</span></span>
-   <span data-ttu-id="c1c94-148">**Проигрыватель Windows Media переходит в состояние нехватки активности.**</span><span class="sxs-lookup"><span data-stu-id="c1c94-148">**Windows Media Player enters a state of low activity.**</span></span> <span data-ttu-id="c1c94-149">В этом случае проигрыватель вызывает метод [ивмпсубскриптионсервице:: стартбаккграундпроцессинг](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice-startbackgroundprocessing) подключаемого модуля.</span><span class="sxs-lookup"><span data-stu-id="c1c94-149">When this happens, the Player calls the plug-in's [IWMPSubscriptionService::startBackgroundProcessing](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice-startbackgroundprocessing) method.</span></span> <span data-ttu-id="c1c94-150">Интернет-магазин может использовать эту возможность для запуска или пробуждения любых потоков, выполняющих фоновые задачи, таких как обновление просроченных лицензий или компиляция данных счетчиков воспроизведения.</span><span class="sxs-lookup"><span data-stu-id="c1c94-150">The online store can use this opportunity to start or wake up any threads that perform background tasks, such as renewing expired licenses or compiling play-count data.</span></span>
-   <span data-ttu-id="c1c94-151">**Проигрыватель Windows Media переходит в состояние высокой активности.**</span><span class="sxs-lookup"><span data-stu-id="c1c94-151">**Windows Media Player enters a state of high activity.**</span></span> <span data-ttu-id="c1c94-152">В этом случае проигрыватель Windows Media вызывает метод [IWMPSubscriptionService2:: стопбаккграундпроцессинг](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice2-stopbackgroundprocessing) подключаемого модуля.</span><span class="sxs-lookup"><span data-stu-id="c1c94-152">When this happens, Windows Media Player calls the plug-in's [IWMPSubscriptionService2::stopBackgroundProcessing](/previous-versions/windows/desktop/api/subscriptionservices/nf-subscriptionservices-iwmpsubscriptionservice2-stopbackgroundprocessing) method.</span></span> <span data-ttu-id="c1c94-153">Это информирует подключаемый модуль о том, что он должен приостановить все потоки, выполняющие фоновые задачи.</span><span class="sxs-lookup"><span data-stu-id="c1c94-153">This informs the plug-in that it must suspend any threads that are performing background tasks.</span></span>

<span data-ttu-id="c1c94-154">Проигрыватель Windows Media освобождает компонент Интернет-магазина по окончании сеанса проигрывателя.</span><span class="sxs-lookup"><span data-stu-id="c1c94-154">Windows Media Player releases the online store component when the Player session ends.</span></span> <span data-ttu-id="c1c94-155">После выпуска компонент должен прерывать выполнение любой фоновой обработки, а затем завершать его работу.</span><span class="sxs-lookup"><span data-stu-id="c1c94-155">Upon release, the component must interrupt any background processing in progress and then shut down.</span></span>

## <a name="related-topics"></a><span data-ttu-id="c1c94-156">См. также</span><span class="sxs-lookup"><span data-stu-id="c1c94-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c1c94-157">**Интерфейс Ивмпсубскриптионсервице**</span><span class="sxs-lookup"><span data-stu-id="c1c94-157">**IWMPSubscriptionService Interface**</span></span>](/previous-versions/windows/desktop/api/subscriptionservices/nn-subscriptionservices-iwmpsubscriptionservice)
</dt> <dt>

[<span data-ttu-id="c1c94-158">**Интерфейс IWMPSubscriptionService2**</span><span class="sxs-lookup"><span data-stu-id="c1c94-158">**IWMPSubscriptionService2 Interface**</span></span>](/previous-versions/windows/desktop/api/subscriptionservices/nn-subscriptionservices-iwmpsubscriptionservice2)
</dt> <dt>

[<span data-ttu-id="c1c94-159">**Интерфейс Ивмпсубскриптионсервицекаллбакк**</span><span class="sxs-lookup"><span data-stu-id="c1c94-159">**IWMPSubscriptionServiceCallback Interface**</span></span>](/previous-versions/windows/desktop/api/subscriptionservices/nn-subscriptionservices-iwmpsubscriptionservicecallback)
</dt> <dt>

[<span data-ttu-id="c1c94-160">**Тип 2 Примеры Интернет-магазина**</span><span class="sxs-lookup"><span data-stu-id="c1c94-160">**Type 2 Online Store Samples**</span></span>](type-2-online-store-samples.md)
</dt> </dl>

 

 




