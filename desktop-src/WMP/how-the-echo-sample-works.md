---
title: Как работает образец Echo
description: Как работает образец Echo
ms.assetid: 554afc08-6e4f-427c-8a09-0d1ebf3ca8dc
keywords:
- Подключаемые модули проигрывателя Windows Media, обзор эхо-образца
- подключаемые модули, Обзор примера эхо
- подключаемые модули обработки цифровых сигналов, обзор образца эха
- Подключаемые модули DSP, Обзор примера эхо
- Пример подключаемого модуля Echo DSP, сведения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 08814a6f0d604c7d566a0fc8d9f07b05446fca64
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "105691248"
---
# <a name="how-the-echo-sample-works"></a>Как работает образец Echo

Код создает эхо-результат, выделяя буфер достаточно большим, чтобы вместить ровно то количество звуковых данных, которое может быть визуализировано за кадр времени, заданный значением времени задержки. Размер буфера вычисляется в байтах по следующей формуле:

Размер буфера = \* Частота выборки по времени задержки/1000. \* Выравнивание блока

Время задержки в миллисекундах. Значения частоты выборки и выравнивания блока задаются в структуре ВАВЕФОРМАТЕКС. Скорость выборки определяется в примерах в секунду; при делении на 1000 выдаются образцы на миллисекунду. Выравнивание блока равно числу каналов (1 для Mono, 2 для стерео) и числу битов на выборку (8 или 16), деленную на 8 (бит на байт).

В дополнение к переменной указателя, указывающей на заголовок буфера задержки, код создает перемещаемый указатель, который проходит через данные в буфере в процессе синхронизации с циклом обработки в функции **допроцессаутпут** . Когда перемещаемый указатель достигает конца буфера задержки, он перемещается обратно в конец буфера. Буфер, используемый таким способом, называется циклическим буфером.

Когда буфер задержки существует, и проигрыватель Windows Media выделил входной буфер для передачи звуковых данных и выходной буфер для получения обработанных звуковых данных, обработка эха продолжается следующим образом:

1.  Введите цикл, который позволяет обрабатывать каждый звуковой образец во входном буфере.
2.  Получение примера из входного буфера. Затем переместите указатель входного буфера вперед к следующему примеру, чтобы подготовиться к итерации следующего цикла.
3.  Получение примера из буфера задержки.
4.  Скопируйте пример из входного буфера в то же расположение в буфере задержки, из которого был получен образец с последней задержкой.
5.  Переместите указатель буфера задержки вперед к следующему примеру. Если указатель перемещается за концом буфера, переместите его в начало буфера.
6.  Объедините пример из входного буфера с примером из буфера задержки.
7.  Скопируйте результат в выходной буфер. Затем переместите указатель выходного буфера на следующую единицу, чтобы подготовиться к итерации следующего цикла.
8.  Повторяйте до тех пор, пока не будут обработаны все образцы.

Когда входной пример, полученный на шаге 2, копируется в буфер задержки на шаге 4, он остается там до тех пор, пока перемещаемый указатель не пойдет через каждый пример в буфере задержки и не вернется к той же позиции. Поскольку размер буфера задержки соответствует времени задержки, время, прошедшее между копированием выборки в буфер задержки и возвращаемым примером, равно заданной задержке (плюс любые задержки, появившиеся в реальной обработке).

При запуске потока данные задержки не создаются до истечения времени задержки. Поэтому важно, чтобы буфер задержки изначально содержал тишину. Если буфер задержки содержит случайные данные, пользователь будет слышать белый шум до тех пор, пока подключаемый модуль не создаст достаточно данных задержки для перезаписи всего буфера задержки.

## <a name="related-topics"></a>См. также

<dl> <dt>

[**Обзор образца эхо**](echo-sample-overview.md)
</dt> </dl>

 

 




