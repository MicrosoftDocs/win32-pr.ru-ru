---
title: Изменение кода, созданного мастером
description: Изменение кода, созданного мастером
ms.assetid: 391a7773-c3e2-499a-bb63-e5934537d963
keywords:
- Проигрыватель Windows Media Mobile, подключаемые модули
- Проигрыватель Windows Media Mobile, подключаемые модули пользовательского интерфейса
- Подключаемые модули мобильных устройств проигрывателя Windows Media
- подключаемые модули, Пользовательский интерфейс
- подключаемые модули, проигрыватель Windows Media Mobile
- подключаемые модули пользовательского интерфейса, мобильные проигрыватели Windows Media
- Подключаемые модули пользовательского интерфейса, проигрыватель Windows Media Mobile
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a83bda7cb265d0c2e039ada6d9d827c6da3faf63
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "105691322"
---
# <a name="modifying-wizard-generated-code"></a><span data-ttu-id="77ff0-110">Изменение кода, созданного мастером</span><span class="sxs-lookup"><span data-stu-id="77ff0-110">Modifying Wizard-generated Code</span></span>

<span data-ttu-id="77ff0-111">В коде подключаемого модуля, созданном мастером, есть несколько мест, которые необходимо изменить, прежде чем подключаемый модуль будет работать с проигрывателем Windows Media 10 Mobile.</span><span class="sxs-lookup"><span data-stu-id="77ff0-111">There are several places in the wizard-generated plug-in code that you must modify before your plug-in will work with Windows Media Player 10 Mobile.</span></span> <span data-ttu-id="77ff0-112">Код, который необходимо изменить, выделяется полужирным шрифтом в следующих примерах.</span><span class="sxs-lookup"><span data-stu-id="77ff0-112">The code you must modify is bold in the following examples.</span></span>

## <a name="changes-to-wmpplugh"></a><span data-ttu-id="77ff0-113">Изменения в вмпплуг. h</span><span class="sxs-lookup"><span data-stu-id="77ff0-113">Changes to wmpplug.h</span></span>

<span data-ttu-id="77ff0-114">Методы ANSI не поддерживаются на устройствах под управлением Windows CE, поэтому необходимо изменить следующий метод ANSI, созданный мастером в вмпплуг. h:</span><span class="sxs-lookup"><span data-stu-id="77ff0-114">ANSI methods are not supported on devices running Windows CE, so you must modify the following ANSI method generated by the wizard in wmpplug.h:</span></span>


```C++
return( ::PostMessage( HWND_BROADCAST, ::RegisterWindowMessageA( "WMPlayer_PluginAddRemove" ), 0, 0 ) );
```



<span data-ttu-id="77ff0-115">Измените его, как показано ниже, чтобы он стал методом Юникода:</span><span class="sxs-lookup"><span data-stu-id="77ff0-115">Modify it as shown in the following so that it becomes a Unicode method:</span></span>


```C++
return( ::PostMessage( HWND_BROADCAST, ::RegisterWindowMessageW( L"WMPlayer_PluginAddRemove" ), 0, 0 ) );
```



## <a name="changes-to-networkpluginh"></a><span data-ttu-id="77ff0-116">Изменения в Нетворкплугин. h</span><span class="sxs-lookup"><span data-stu-id="77ff0-116">Changes to NetworkPlugin.h</span></span>

<span data-ttu-id="77ff0-117">Найдите следующий код в Нетворкплугин. h:</span><span class="sxs-lookup"><span data-stu-id="77ff0-117">Find the following code in NetworkPlugin.h:</span></span>


```C++
BEGIN_COM_MAP(CNetworkPlugin)
    COM_INTERFACE(IWMPPluginUI)
END_COM_MAP()
```



<span data-ttu-id="77ff0-118">Измените код так, чтобы он выглядел следующим образом:</span><span class="sxs-lookup"><span data-stu-id="77ff0-118">Modify the code so that it looks like this:</span></span>


```C++
BEGIN_COM_MAP(CNetworkPlugin)
    
COM_INTERFACE_ENTRY_IID(__uuidof(IWMPPluginUI), IWMPPluginUI)
END_COM_MAP()
```



## <a name="changes-to-networkplugindllcpp"></a><span data-ttu-id="77ff0-119">Изменения в Нетворкплугиндлл. cpp</span><span class="sxs-lookup"><span data-stu-id="77ff0-119">Changes to NetworkPlugindll.cpp</span></span>

<span data-ttu-id="77ff0-120">Найдите функцию **DllMain** в нетворкплугиндлл. cpp:</span><span class="sxs-lookup"><span data-stu-id="77ff0-120">Find the **DllMain** function in NetworkPlugindll.cpp:</span></span>


```C++
extern "C" BOOL WINAPI DllMain(HINSTANCE hInstance, DWORD dwReason, LPVOID /*lpReserved*/)
{
    if (dwReason == DLL_PROCESS_ATTACH)
    {
        _Module.Init(ObjectMap, hInstance);
        DisableThreadLibraryCalls(hInstance);
    }
    else if (dwReason == DLL_PROCESS_DETACH)
        _Module.Term();
    return TRUE;    // ok
}
```



<span data-ttu-id="77ff0-121">Измените код так, чтобы он выглядел следующим образом:</span><span class="sxs-lookup"><span data-stu-id="77ff0-121">Modify the code so that it looks like this:</span></span>


```C++
extern "C" BOOL WINAPI DllMain(HANDLE hInstance, DWORD dwReason, LPVOID /*lpReserved*/)
{
    if (dwReason == DLL_PROCESS_ATTACH)
    {
        _Module.Init(ObjectMap, (HINSTANCE)hInstance);
#ifndef UNDER_CE
        DisableThreadLibraryCalls((HINSTANCE)hInstance);
#endif
    }
    else if (dwReason == DLL_PROCESS_DETACH)
        _Module.Term();
    return TRUE;    // ok
}
```



## <a name="changes-to-networkplugincpp"></a><span data-ttu-id="77ff0-122">Изменения в Нетворкплугин. cpp</span><span class="sxs-lookup"><span data-stu-id="77ff0-122">Changes to NetworkPlugin.cpp</span></span>

<span data-ttu-id="77ff0-123">Найдите следующий код в Нетворкплугин. cpp:</span><span class="sxs-lookup"><span data-stu-id="77ff0-123">Find the following code in NetworkPlugin.cpp:</span></span>


```C++
hr = m_spCore->QueryInterface(&spConnectionContainer);
```



<span data-ttu-id="77ff0-124">Измените код так, чтобы он выглядел следующим образом:</span><span class="sxs-lookup"><span data-stu-id="77ff0-124">Modify the code so that it looks like this:</span></span>


```C++
hr = m_spCore->QueryInterface(__uuidof(IConnectionPointContainer), (void**)&spConnectionContainer);
```



## <a name="change-the-threading-model"></a><span data-ttu-id="77ff0-125">Изменение потоковой модели</span><span class="sxs-lookup"><span data-stu-id="77ff0-125">Change the Threading Model</span></span>

<span data-ttu-id="77ff0-126">В отличие от ATL для Windows, ATL для Windows CE не поддерживает модель потоков подразделений, так как модель подразделения требует больше ресурсов памяти, чем модели с одним потоком и свободными потоками.</span><span class="sxs-lookup"><span data-stu-id="77ff0-126">Unlike ATL for Windows, ATL for Windows CE does not support the apartment threading model because the apartment model requires more memory resources than the single threading and free threading models.</span></span> <span data-ttu-id="77ff0-127">Поэтому необходимо найти все экземпляры потоков подразделений в файле StdAfx. h и Нетворкплугин. RGS и изменить их, чтобы они указывали на свободную потоковое взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="77ff0-127">Therefore, you must find all instances of apartment threading in StdAfx.h and NetworkPlugin.rgs and change them to indicate free threading.</span></span>

<span data-ttu-id="77ff0-128">Кроме того, можно вызвать только мобильный элемент управления Windows Media Player 10 из потока, в котором он был создан.</span><span class="sxs-lookup"><span data-stu-id="77ff0-128">Also, you can only call the Windows Media Player 10 Mobile control from the thread on which it was created.</span></span>

## <a name="build-and-test-the-project"></a><span data-ttu-id="77ff0-129">Сборка и тестирование проекта</span><span class="sxs-lookup"><span data-stu-id="77ff0-129">Build and Test the Project</span></span>

<span data-ttu-id="77ff0-130">После внесения этих изменений можно построить проект, чтобы убедиться, что он компилируется перед добавлением пользовательского кода.</span><span class="sxs-lookup"><span data-stu-id="77ff0-130">After making these changes outlined here, you can build your project to verify that it compiles before you add any custom code.</span></span>

1.  <span data-ttu-id="77ff0-131">Задайте для параметра Активная конфигурация проекта значение Win32 (ВЦЕ ARMV4) Debug или Win32 (ВЦЕ ARMV4).</span><span class="sxs-lookup"><span data-stu-id="77ff0-131">Set the active project configuration to Win32 (WCE ARMV4) Debug or Win32 (WCE ARMV4) Release.</span></span>
2.  <span data-ttu-id="77ff0-132">Установите для активной платформы значение Pocket PC 2003.</span><span class="sxs-lookup"><span data-stu-id="77ff0-132">Set the active platform to Pocket PC 2003.</span></span>
3.  <span data-ttu-id="77ff0-133">Щелкните элемент меню **Сборка** , а затем выберите **Сборка NetworkPlugin.dll**.</span><span class="sxs-lookup"><span data-stu-id="77ff0-133">Click the **Build** menu item, and then select **Build NetworkPlugin.dll**.</span></span> <span data-ttu-id="77ff0-134">Она должна компилироваться, скачиваться и регистрироваться на устройстве.</span><span class="sxs-lookup"><span data-stu-id="77ff0-134">It should compile, download, and register itself on your device.</span></span>

## <a name="related-topics"></a><span data-ttu-id="77ff0-135">См. также</span><span class="sxs-lookup"><span data-stu-id="77ff0-135">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="77ff0-136">**Создание подключаемого модуля пользовательского интерфейса для проигрывателя Windows Media 10 Mobile**</span><span class="sxs-lookup"><span data-stu-id="77ff0-136">**Creating a User Interface Plug-in for Windows Media Player 10 Mobile**</span></span>](creating-a-user-interface-plug-in-for-windows-media-player-10-mobile.md)
</dt> </dl>

 

 




