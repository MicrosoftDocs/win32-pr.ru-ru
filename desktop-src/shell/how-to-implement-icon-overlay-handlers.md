---
description: Обработчики наложения значков являются внутрипроцессного COM-объектами, реализованными в виде библиотек DLL.
ms.assetid: ADF27BFD-CC96-43F9-9EBB-DEBE0DEA7B92
title: Реализация обработчиков наложения значков
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e22c1057f65c50b31c6627846ec77103827a0283
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104985428"
---
# <a name="how-to-implement-icon-overlay-handlers"></a><span data-ttu-id="45c56-103">Реализация обработчиков наложения значков</span><span class="sxs-lookup"><span data-stu-id="45c56-103">How to Implement Icon Overlay Handlers</span></span>

<span data-ttu-id="45c56-104">Обработчики наложения значков являются внутрипроцессного COM-объектами, реализованными в виде библиотек DLL.</span><span class="sxs-lookup"><span data-stu-id="45c56-104">Icon overlay handlers are in-process Component Object Model (COM) objects, implemented as DLLs.</span></span> <span data-ttu-id="45c56-105">В дополнение к [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown): [**ишелликоноверлайидентифиер**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishelliconoverlayidentifier), они экспортируют один интерфейс.</span><span class="sxs-lookup"><span data-stu-id="45c56-105">They export one interface in addition to [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown): [**IShellIconOverlayIdentifier**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishelliconoverlayidentifier).</span></span> <span data-ttu-id="45c56-106">Этот интерфейс имеет три метода: [**ишелликоноверлайидентифиер:: жетоверлайинфо**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo), [**Ишелликоноверлайидентифиер:: предшествовал**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority)и [**ишелликоноверлайидентифиер:: IsMemberOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-ismemberof).</span><span class="sxs-lookup"><span data-stu-id="45c56-106">This interface has three methods: [**IShellIconOverlayIdentifier::GetOverlayInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo), [**IShellIconOverlayIdentifier::GetPriority**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority), and [**IShellIconOverlayIdentifier::IsMemberOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-ismemberof).</span></span>

## <a name="instructions"></a><span data-ttu-id="45c56-107">Инструкции</span><span class="sxs-lookup"><span data-stu-id="45c56-107">Instructions</span></span>

### <a name="step-1-implementing-getoverlayinfo"></a><span data-ttu-id="45c56-108">Шаг 1. Реализация Жетоверлайинфо</span><span class="sxs-lookup"><span data-stu-id="45c56-108">Step 1: Implementing GetOverlayInfo</span></span>

<span data-ttu-id="45c56-109">Метод [**жетоверлайинфо**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo) сначала вызывается во время инициализации.</span><span class="sxs-lookup"><span data-stu-id="45c56-109">The [**GetOverlayInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo) method is first called during initialization.</span></span> <span data-ttu-id="45c56-110">Метод возвращает полный путь к файлу, содержащему изображение наложения значка, и его Отсчитываемый от нуля индекс в файле.</span><span class="sxs-lookup"><span data-stu-id="45c56-110">The method returns the fully qualified path of the file that contains the icon overlay image, and its zero-based index within the file.</span></span> <span data-ttu-id="45c56-111">Затем оболочка добавляет образ в список образов системы.</span><span class="sxs-lookup"><span data-stu-id="45c56-111">The Shell then adds the image to the system image list.</span></span> <span data-ttu-id="45c56-112">Наложения значков могут содержаться в любом из стандартных типов файлов, включая exe, DLL и ICO.</span><span class="sxs-lookup"><span data-stu-id="45c56-112">Icon overlays can be contained in any of the standard file types, including .exe, .dll, and .ico.</span></span>

<span data-ttu-id="45c56-113">После завершения инициализации оболочка вызывает [**жетоверлайинфо**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo) , когда требуется отобразить наложение значка обработчика.</span><span class="sxs-lookup"><span data-stu-id="45c56-113">After initialization is complete, the Shell calls [**GetOverlayInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo) when it needs to display the handler's icon overlay.</span></span> <span data-ttu-id="45c56-114">Метод должен возвращать то же имя файла и индекс, который выполнялся во время инициализации.</span><span class="sxs-lookup"><span data-stu-id="45c56-114">The method should return the same file name and index that it did during initialization.</span></span> <span data-ttu-id="45c56-115">Хотя оболочка использует образ, кэшированный в списке системных образов, а не загружает образ из файла, наложение значков по-прежнему определяется по имени файла и индексу.</span><span class="sxs-lookup"><span data-stu-id="45c56-115">Although the Shell uses the image that is cached in the system image list rather than loading the image from the file, an icon overlay is still identified by its file name and index.</span></span>

### <a name="step-2-implementing-getpriority"></a><span data-ttu-id="45c56-116">Шаг 2. Реализация Предшествовалного</span><span class="sxs-lookup"><span data-stu-id="45c56-116">Step 2: Implementing GetPriority</span></span>

<span data-ttu-id="45c56-117">Метод [**WebMethod**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority) вызывается только во время инициализации.</span><span class="sxs-lookup"><span data-stu-id="45c56-117">The [**GetPriority**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority) method is called only during initialization.</span></span> <span data-ttu-id="45c56-118">Он назначает значение приоритета для наложения значка обработчика.</span><span class="sxs-lookup"><span data-stu-id="45c56-118">It assigns a priority value to the handler's icon overlay.</span></span> <span data-ttu-id="45c56-119">Значение может варьироваться от нуля до 100, где 100 — самый низкий приоритет.</span><span class="sxs-lookup"><span data-stu-id="45c56-119">The value can range from zero to 100, where 100 is the lowest priority.</span></span> <span data-ttu-id="45c56-120">Назначение этого значения приоритета заключается в том, чтобы помочь оболочке разрешить конфликт, возникающий, если для одного объекта задано несколько наложений значков.</span><span class="sxs-lookup"><span data-stu-id="45c56-120">The purpose of this priority value is to help the Shell resolve the conflict that arises when multiple icon overlays are specified for a single object.</span></span> <span data-ttu-id="45c56-121">Оболочка сначала использует внутренний набор правил для определения наложения значков с наивысшим приоритетом.</span><span class="sxs-lookup"><span data-stu-id="45c56-121">The Shell first uses an internal set of rules to determine the highest-priority icon overlay.</span></span> <span data-ttu-id="45c56-122">Если эти правила не разрешают конфликт, значения, назначенные для наложения значков, **определяют приоритет** .</span><span class="sxs-lookup"><span data-stu-id="45c56-122">If these rules do not resolve the conflict, the values assigned to the icon overlays by **GetPriority** determine priority.</span></span>

<span data-ttu-id="45c56-123">Значение приоритета, установленное методом [**предшествовал**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority) , не является надежным способом разрешения конфликтов между обработчиками наложения несвязанных значков.</span><span class="sxs-lookup"><span data-stu-id="45c56-123">The priority value set by [**GetPriority**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority) is not a reliable way to resolve conflicts between unrelated icon overlay handlers.</span></span> <span data-ttu-id="45c56-124">Обработчику не существует способа определить, какие значения приоритета используются другими обработчиками.</span><span class="sxs-lookup"><span data-stu-id="45c56-124">There is no way for your handler to determine what priority values other handlers are using.</span></span> <span data-ttu-id="45c56-125">Обычно значение должно быть равно нулю.</span><span class="sxs-lookup"><span data-stu-id="45c56-125">Normally, you should set the value to zero.</span></span> <span data-ttu-id="45c56-126">Однако значение приоритета полезно при реализации двух или более обработчиков наложения значков, которые могут запрашивать значки наложения значков для одного и того же объекта.</span><span class="sxs-lookup"><span data-stu-id="45c56-126">However, the priority value is useful when you have implemented two or more icon overlay handlers that can request icon overlay icons for the same object.</span></span> <span data-ttu-id="45c56-127">Устанавливая соответствующие значения приоритета, можно указать, какие из запрошенных наложения значков будут отображаться.</span><span class="sxs-lookup"><span data-stu-id="45c56-127">By setting the priority values appropriately, you can specify which of the requested icon overlays will be displayed.</span></span>

### <a name="step-3-implementing-ismemberof"></a><span data-ttu-id="45c56-128">Шаг 3. Реализация IsMemberOf</span><span class="sxs-lookup"><span data-stu-id="45c56-128">Step 3: Implementing IsMemberOf</span></span>

<span data-ttu-id="45c56-129">Оболочка вызывает метод [**IsMemberOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-ismemberof) , чтобы определить, должен ли он отображать наложение значка обработчика для определенного объекта.</span><span class="sxs-lookup"><span data-stu-id="45c56-129">The Shell calls the [**IsMemberOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-ismemberof) method to determine whether it should display a handler's icon overlay for a particular object.</span></span> <span data-ttu-id="45c56-130">Оболочка задает объект, передав его имя в метод.</span><span class="sxs-lookup"><span data-stu-id="45c56-130">The Shell specifies the object by passing its name to the method.</span></span> <span data-ttu-id="45c56-131">Если обработчик хочет отобразить наложение значка, **IsMemberOf** возвращает S \_ ОК.</span><span class="sxs-lookup"><span data-stu-id="45c56-131">If a handler wants to have its icon overlay displayed, **IsMemberOf** returns S\_OK.</span></span> <span data-ttu-id="45c56-132">В противном случае возвращается \_ значение false.</span><span class="sxs-lookup"><span data-stu-id="45c56-132">If not, it returns S\_FALSE.</span></span>

<span data-ttu-id="45c56-133">Обработчики наложения значков обычно предназначены для работы с определенной группой файлов.</span><span class="sxs-lookup"><span data-stu-id="45c56-133">Icon overlay handlers are normally intended to work with a particular group of files.</span></span> <span data-ttu-id="45c56-134">Типичный пример — это [Тип файла](fa-file-types.md), идентифицируемый по определенному расширению имени файла.</span><span class="sxs-lookup"><span data-stu-id="45c56-134">A typical example is a [file type](fa-file-types.md), identified by a specific file name extension.</span></span> <span data-ttu-id="45c56-135">Обработчик наложения значков может запрашивать наложение значка для всех файлов типа файлов.</span><span class="sxs-lookup"><span data-stu-id="45c56-135">An icon overlay handler can request an icon overlay for all files of the file type.</span></span> <span data-ttu-id="45c56-136">Некоторые обработчики запрашивают наложение значка, только если файл типа файла находится в определенном состоянии.</span><span class="sxs-lookup"><span data-stu-id="45c56-136">Some handlers request an icon overlay only if a file of the file type is in a particular state.</span></span> <span data-ttu-id="45c56-137">Однако обработчики наложения значков свободны для запроса наложения значков для любого объекта, который они выбирают.</span><span class="sxs-lookup"><span data-stu-id="45c56-137">However, icon overlay handlers are free to request their icon overlay for any object that they choose.</span></span>

 

 
