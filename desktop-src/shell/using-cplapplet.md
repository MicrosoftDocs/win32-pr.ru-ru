---
description: До Windows Vista вы создали элемент панели управления, создав DLL-файл и наименую его с расширением. cpl.
ms.assetid: 258dae28-c054-4392-b0e9-99493f23c814
title: Использование Кплапплет
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b1e59b29dd7c082822ed63d425dd4967a542b5d1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104985400"
---
# <a name="using-cplapplet"></a><span data-ttu-id="07a1b-103">Использование Кплапплет</span><span class="sxs-lookup"><span data-stu-id="07a1b-103">Using CPLApplet</span></span>

<span data-ttu-id="07a1b-104">До Windows Vista вы создали элемент панели управления, создав DLL-файл и наименую его с расширением. cpl.</span><span class="sxs-lookup"><span data-stu-id="07a1b-104">Prior to Windows Vista, you created a Control Panel item by creating a .dll file and naming it with a .cpl extension.</span></span> <span data-ttu-id="07a1b-105">Этот файл экспортировал функцию [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) .</span><span class="sxs-lookup"><span data-stu-id="07a1b-105">This file exported the [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) function.</span></span> <span data-ttu-id="07a1b-106">Эта схема по-прежнему поддерживается в Windows Vista и более поздних версиях и рассматривается в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="07a1b-106">This scheme is still supported in Windows Vista and later versions and is discussed in this topic.</span></span> <span data-ttu-id="07a1b-107">Однако рекомендации для новых элементов панели управления рекомендуют более простой подход с помощью элемента панели управления, созданного как exe-файл, который использует макет потока задач.</span><span class="sxs-lookup"><span data-stu-id="07a1b-107">However, the guidelines for new Control Panel items recommend a simpler approach with the Control Panel item built as a .exe file that uses a task flow layout.</span></span>

<span data-ttu-id="07a1b-108">Когда панель управления загружает файл DLL (или. cpl), она вызывает функцию [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) для получения таких сведений, как количество элементов панели управления, содержащихся в файлах, а также сведения о каждом элементе.</span><span class="sxs-lookup"><span data-stu-id="07a1b-108">When Control Panel loads a .dll (or .cpl) file, it calls the [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) function to get information such as the number of Control Panel items the file hosts, as well as information about each item.</span></span> <span data-ttu-id="07a1b-109">Панель управления также вызывает функцию при инициализации, открытии или закрытии окна элемента.</span><span class="sxs-lookup"><span data-stu-id="07a1b-109">Control Panel also calls the function when the item's window is initialized, opened, or closed.</span></span>

<span data-ttu-id="07a1b-110">Когда Windows впервые загружает элемент панели управления, он получает адрес функции [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) и затем использует этот адрес для вызова функции и передачи сообщений.</span><span class="sxs-lookup"><span data-stu-id="07a1b-110">When Windows first loads the Control Panel item, it retrieves the address of the [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) function and subsequently uses that address to call the function and pass it messages.</span></span> <span data-ttu-id="07a1b-111">Он может отправить следующие сообщения.</span><span class="sxs-lookup"><span data-stu-id="07a1b-111">It might send the following messages.</span></span>



| <span data-ttu-id="07a1b-112">Сообщение</span><span class="sxs-lookup"><span data-stu-id="07a1b-112">Message</span></span>                                     | <span data-ttu-id="07a1b-113">Описание</span><span class="sxs-lookup"><span data-stu-id="07a1b-113">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|---------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="07a1b-114">**CPL \_ дблклк**</span><span class="sxs-lookup"><span data-stu-id="07a1b-114">**CPL\_DBLCLK**</span></span>](cpl-dblclk.md)           | <span data-ttu-id="07a1b-115">Отправляется уведомление [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) о том, что пользователь выбрал значок, связанный с заданным элементом панели управления.</span><span class="sxs-lookup"><span data-stu-id="07a1b-115">Sent to notify [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) that the user has chosen the icon associated with a given Control Panel item.</span></span> <span data-ttu-id="07a1b-116">**Кплапплет** должен отобразить диалоговое окно для указанного элемента и выполнить все определяемые пользователем задачи.</span><span class="sxs-lookup"><span data-stu-id="07a1b-116">**CPlApplet** should display the dialog box for the specified item and carry out any user-specified tasks.</span></span> <span data-ttu-id="07a1b-117">Параметр  *lParam1* кплапплет — это целое число, представляющее отсчитываемый от нуля индекс элемента панели управления.</span><span class="sxs-lookup"><span data-stu-id="07a1b-117">The **CPlApplet** *lParam1* parameter is an integer that represents the zero-based index of the Control Panel item.</span></span> <span data-ttu-id="07a1b-118">Параметр *lParam2* — это указатель **лпдата** , возвращаемый в структуре [**Кплинфо**](/windows/win32/api/cpl/ns-cpl-cplinfo) или [**невкплинфо**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) в сообщении [**CPL \_**](cpl-inquire.md) или [**CPL \_ невинкуире**](cpl-newinquire.md) .</span><span class="sxs-lookup"><span data-stu-id="07a1b-118">The *lParam2* parameter is the **lpData** pointer returned in the [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) or [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) structure in the [**CPL\_INQUIRE**](cpl-inquire.md) or [**CPL\_NEWINQUIRE**](cpl-newinquire.md) message.</span></span> <span data-ttu-id="07a1b-119">Возвращаемое значение игнорируется.</span><span class="sxs-lookup"><span data-stu-id="07a1b-119">The return value is ignored.</span></span>                                                                |
| [<span data-ttu-id="07a1b-120">**\_выход CPL**</span><span class="sxs-lookup"><span data-stu-id="07a1b-120">**CPL\_EXIT**</span></span>](cpl-exit.md)               | <span data-ttu-id="07a1b-121">Посылается после последнего \_ сообщения об ошибке CPL и сразу перед тем, как Windows использует функцию [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) для высвобождения библиотеки DLL, содержащей элемент панели управления.</span><span class="sxs-lookup"><span data-stu-id="07a1b-121">Sent after the last CPL\_STOP message and immediately before Windows uses the [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) function to free the DLL that contains the Control Panel item.</span></span> <span data-ttu-id="07a1b-122">[**Кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) должен освободить оставшийся объем памяти и подготовиться к закрытию.</span><span class="sxs-lookup"><span data-stu-id="07a1b-122">[**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) should free any remaining memory and prepare to close.</span></span> <span data-ttu-id="07a1b-123">Возвращаемое значение игнорируется.</span><span class="sxs-lookup"><span data-stu-id="07a1b-123">The return value is ignored.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="07a1b-124">**CPL — \_ Счетчик**</span><span class="sxs-lookup"><span data-stu-id="07a1b-124">**CPL\_GETCOUNT**</span></span>](cpl-getcount.md)       | <span data-ttu-id="07a1b-125">Отправляется после \_ сообщения CPL init для запроса [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) на возврат числа, которое указывает, сколько поддерживаемых им подпрограмм.</span><span class="sxs-lookup"><span data-stu-id="07a1b-125">Sent after the CPL\_INIT message to prompt [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) to return a number that indicates how many subprograms it supports.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| [<span data-ttu-id="07a1b-126">**\_Инициализация CPL**</span><span class="sxs-lookup"><span data-stu-id="07a1b-126">**CPL\_INIT**</span></span>](cpl-init.md)               | <span data-ttu-id="07a1b-127">Отправляется сразу после загрузки библиотеки DLL, содержащей элемент панели управления.</span><span class="sxs-lookup"><span data-stu-id="07a1b-127">Sent immediately after the DLL that contains the Control Panel item is loaded.</span></span> <span data-ttu-id="07a1b-128">В сообщении запрашиваются [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) для выполнения процедур инициализации, включая выделение памяти.</span><span class="sxs-lookup"><span data-stu-id="07a1b-128">The message prompts [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) to perform initialization procedures, including memory allocation.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| [<span data-ttu-id="07a1b-129">**\_запрос CPL**</span><span class="sxs-lookup"><span data-stu-id="07a1b-129">**CPL\_INQUIRE**</span></span>](cpl-inquire.md)         | <span data-ttu-id="07a1b-130">Отправляется после сообщения CPL- \_ Count в запрос [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) на предоставление сведений об указанной подпрограмме.</span><span class="sxs-lookup"><span data-stu-id="07a1b-130">Sent after the CPL\_GETCOUNT message to prompt [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) to provide information about a specified subprogram.</span></span> <span data-ttu-id="07a1b-131">Значение *lParam1* — это целое число, представляющее отсчитываемый от нуля индекс подпрограммы, сведения о которой запрашиваются.</span><span class="sxs-lookup"><span data-stu-id="07a1b-131">The *lParam1* value is an integer that represents the zero-based index of the subprogram about which information is being requested.</span></span> <span data-ttu-id="07a1b-132">Параметр *lParam2* объекта **кплапплет** указывает на структуру [**кплинфо**](/windows/win32/api/cpl/ns-cpl-cplinfo) .</span><span class="sxs-lookup"><span data-stu-id="07a1b-132">The *lParam2* parameter of **CPlApplet** points to a [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) structure.</span></span> <span data-ttu-id="07a1b-133">Возвращаемое значение игнорируется.</span><span class="sxs-lookup"><span data-stu-id="07a1b-133">The return value is ignored.</span></span>                                                                                                                                                                                                                                                                                                    |
| [<span data-ttu-id="07a1b-134">**CPL \_ невинкуире**</span><span class="sxs-lookup"><span data-stu-id="07a1b-134">**CPL\_NEWINQUIRE**</span></span>](cpl-newinquire.md)   | <span data-ttu-id="07a1b-135">Отправляется после сообщения CPL- \_ Count в запрос [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) на предоставление сведений об указанном элементе панели управления.</span><span class="sxs-lookup"><span data-stu-id="07a1b-135">Sent after the CPL\_GETCOUNT message to prompt [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) to provide information about a specified Control Panel item.</span></span> <span data-ttu-id="07a1b-136">Значение *lParam1* — это целое число, представляющее отсчитываемый от нуля индекс подпрограммы, сведения о которой запрашиваются.</span><span class="sxs-lookup"><span data-stu-id="07a1b-136">The *lParam1* value is an integer that represents the zero-based index of the subprogram about which information is being requested.</span></span> <span data-ttu-id="07a1b-137">Параметр *lParam2* является указателем на структуру [**невкплинфо**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) .</span><span class="sxs-lookup"><span data-stu-id="07a1b-137">The *lParam2* parameter is a pointer to a [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) structure.</span></span> <span data-ttu-id="07a1b-138">CPL \_ невинкуире обычно следует игнорировать.</span><span class="sxs-lookup"><span data-stu-id="07a1b-138">CPL\_NEWINQUIRE normally should be ignored.</span></span> <span data-ttu-id="07a1b-139">Приложение должно обрабатывать только управляющие \_ запросы CPL в windows 95, Microsoft Windows NT 4,0 и более поздних системах, так как при \_ использовании CPL невинкуире используется отрицательная производительность панели управления.</span><span class="sxs-lookup"><span data-stu-id="07a1b-139">Your application should process only CPL\_INQUIRE on Windows 95, Microsoft Windows NT 4.0, and later systems since Control Panel performance suffers when CPL\_NEWINQUIRE is used.</span></span> <span data-ttu-id="07a1b-140">Это обусловлено тем, что возвращаемые строки и значки не могут быть кэшированы.</span><span class="sxs-lookup"><span data-stu-id="07a1b-140">This is because the returned strings and icons cannot be cached.</span></span> <span data-ttu-id="07a1b-141">Возвращаемое значение игнорируется.</span><span class="sxs-lookup"><span data-stu-id="07a1b-141">The return value is ignored.</span></span> |
| [<span data-ttu-id="07a1b-142">**CPL — \_ Выбор**</span><span class="sxs-lookup"><span data-stu-id="07a1b-142">**CPL\_SELECT**</span></span>](cpl-select.md)           | <span data-ttu-id="07a1b-143">Является устаревшей.</span><span class="sxs-lookup"><span data-stu-id="07a1b-143">Obsolete.</span></span> <span data-ttu-id="07a1b-144">Текущие версии Windows не отправляют это сообщение.</span><span class="sxs-lookup"><span data-stu-id="07a1b-144">Current versions of Windows do not send this message.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| [<span data-ttu-id="07a1b-145">**CPL \_ стартвпармс**</span><span class="sxs-lookup"><span data-stu-id="07a1b-145">**CPL\_STARTWPARMS**</span></span>](cpl-startwparms.md) | <span data-ttu-id="07a1b-146">Отправляется уведомление [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) о том, что пользователь выбрал значок, связанный с заданным диалоговым окном.</span><span class="sxs-lookup"><span data-stu-id="07a1b-146">Sent to notify [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) that the user has chosen the icon associated with a given dialog box.</span></span> <span data-ttu-id="07a1b-147">**Кплапплет** должен отобразить соответствующее диалоговое окно и выполнить все определяемые пользователем задачи.</span><span class="sxs-lookup"><span data-stu-id="07a1b-147">**CPlApplet** should display the corresponding dialog box and carry out any user-specified tasks.</span></span> <span data-ttu-id="07a1b-148">Это сообщение похоже на CPL \_ дблклк, но может быть несколько дополнительных сведений.</span><span class="sxs-lookup"><span data-stu-id="07a1b-148">This message is similar to CPL\_DBLCLK, but there might be some additional information.</span></span> <span data-ttu-id="07a1b-149">Параметр *lParam1* — это номер элемента панели управления, а *lParam2* — **LPCTSTR** любые дополнительные направления, которые могут потребоваться.</span><span class="sxs-lookup"><span data-stu-id="07a1b-149">The *lParam1* parameter is the Control Panel item number and *lParam2* is an **LPCTSTR** to any extra directions that might be necessary.</span></span> <span data-ttu-id="07a1b-150">Возвращает **значение true** , если сообщение обрабатывается; в противном случае — **значение false**.</span><span class="sxs-lookup"><span data-stu-id="07a1b-150">Return **TRUE** if this message is handled; otherwise, **FALSE**.</span></span> <span data-ttu-id="07a1b-151">Это сообщение допустимо для Shell32.dll [версии 5,00](versions.md) и более поздних версий.</span><span class="sxs-lookup"><span data-stu-id="07a1b-151">This message is valid for [version 5.00](versions.md) and later of Shell32.dll.</span></span>                                                                                         |
| [<span data-ttu-id="07a1b-152">**\_Отключить CPL**</span><span class="sxs-lookup"><span data-stu-id="07a1b-152">**CPL\_STOP**</span></span>](cpl-stop.md)               | <span data-ttu-id="07a1b-153">Отправляется один раз для каждого элемента панели управления в файле. cpl перед тем, как Windows выгружает расширение панели управления.</span><span class="sxs-lookup"><span data-stu-id="07a1b-153">Sent once for each Control Panel item in the .cpl file before Windows unloads the Control Panel extension.</span></span> <span data-ttu-id="07a1b-154">[**Кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) должен освободить память, связанную с номером товара, указанным в *lParam1*.</span><span class="sxs-lookup"><span data-stu-id="07a1b-154">[**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) should free any memory associated with the item number provided in *lParam1*.</span></span> <span data-ttu-id="07a1b-155">Параметр *lParam2* — это **лпдата** указатель, возвращаемый в структуре [**Кплинфо**](/windows/win32/api/cpl/ns-cpl-cplinfo) или [**невкплинфо**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) в [**сообщении \_ CPL**](cpl-inquire.md) или [**CPL \_ невинкуире**](cpl-newinquire.md) .</span><span class="sxs-lookup"><span data-stu-id="07a1b-155">The *lParam2* parameter is **lpData** pointer returned in the [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) or [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) structure in the [**CPL\_INQUIRE**](cpl-inquire.md) or [**CPL\_NEWINQUIRE**](cpl-newinquire.md) message.</span></span> <span data-ttu-id="07a1b-156">Возвращаемое значение игнорируется.</span><span class="sxs-lookup"><span data-stu-id="07a1b-156">The return value is ignored.</span></span>                                                                                                                                                                                                       |



 

## <a name="related-topics"></a><span data-ttu-id="07a1b-157">См. также</span><span class="sxs-lookup"><span data-stu-id="07a1b-157">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="07a1b-158">Элементы панели управления</span><span class="sxs-lookup"><span data-stu-id="07a1b-158">Control Panel Items</span></span>](control-panel-applications.md)
</dt> <dt>

[<span data-ttu-id="07a1b-159">Руководство по работе пользователей</span><span class="sxs-lookup"><span data-stu-id="07a1b-159">User Experience Guidelines</span></span>](user-experience-guidelines.md)
</dt> <dt>

[<span data-ttu-id="07a1b-160">Регистрация элементов панели управления</span><span class="sxs-lookup"><span data-stu-id="07a1b-160">Registering Control Panel Items</span></span>](registering-control-panel-items.md)
</dt> <dt>

[<span data-ttu-id="07a1b-161">Обработка сообщений в панели управления</span><span class="sxs-lookup"><span data-stu-id="07a1b-161">Control Panel Message Processing</span></span>](message-processing.md)
</dt> <dt>

[<span data-ttu-id="07a1b-162">Исполнение элементов панели управления</span><span class="sxs-lookup"><span data-stu-id="07a1b-162">Executing Control Panel Items</span></span>](executing-control-panel-items.md)
</dt> <dt>

[<span data-ttu-id="07a1b-163">Расширение элементов панели управления "система"</span><span class="sxs-lookup"><span data-stu-id="07a1b-163">Extending System Control Panel Items</span></span>](extending-system-control-panel-items.md)
</dt> <dt>

[<span data-ttu-id="07a1b-164">Назначение категорий панели управления</span><span class="sxs-lookup"><span data-stu-id="07a1b-164">Assigning Control Panel Categories</span></span>](assigning-control-panel-categories.md)
</dt> <dt>

[<span data-ttu-id="07a1b-165">Создание ссылок на задачи с возможностью поиска для элемента панели управления</span><span class="sxs-lookup"><span data-stu-id="07a1b-165">Creating Searchable Task Links for a Control Panel Item</span></span>](creating-searchable-task-links.md)
</dt> <dt>

[<span data-ttu-id="07a1b-166">Доступ к панели управления в защищенном режиме в Windows Vista</span><span class="sxs-lookup"><span data-stu-id="07a1b-166">Accessing the Control Panel in Safe Mode under Windows Vista</span></span>](accessing-the-cp-in-safe-mode-under-vista.md)
</dt> </dl>

 

 
