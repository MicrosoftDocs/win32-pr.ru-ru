---
description: Многие приложения позволяют пользователям передавать данные в другое приложение путем перетаскивания данных с помощью мыши или буфера обмена.
title: Передача объектов оболочки с помощью перетаскивания и буфера обмена
ms.topic: article
ms.date: 05/31/2018
ms.assetid: bd73098b-2f69-48a4-bb06-e1e0a452e69d
api_name: ''
api_type: ''
api_location: ''
topic_type:
- kbArticle
ms.openlocfilehash: b04523d0ae22eac7bef68f37a6d22ac94b21e303
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104985533"
---
# <a name="transferring-shell-objects-with-drag-and-drop-and-the-clipboard"></a><span data-ttu-id="e434a-103">Передача объектов оболочки с помощью перетаскивания и буфера обмена</span><span class="sxs-lookup"><span data-stu-id="e434a-103">Transferring Shell Objects with Drag-and-Drop and the Clipboard</span></span>

<span data-ttu-id="e434a-104">Многие приложения позволяют пользователям передавать данные в другое приложение путем перетаскивания данных с помощью мыши или буфера обмена.</span><span class="sxs-lookup"><span data-stu-id="e434a-104">Many applications allow users to transfer data to another application by dragging and dropping the data with the mouse, or by using the Clipboard.</span></span> <span data-ttu-id="e434a-105">К числу типов данных, которые могут быть переданы, относятся объекты оболочки, такие как файлы или папки.</span><span class="sxs-lookup"><span data-stu-id="e434a-105">Among the many types of data that can be transferred are Shell objects such as files or folders.</span></span> <span data-ttu-id="e434a-106">Обмен данными между оболочками может выполняться между двумя приложениями, но пользователи также могут передавать данные оболочки в рабочий стол или проводник Windows.</span><span class="sxs-lookup"><span data-stu-id="e434a-106">Shell data transfer can take place between two applications, but users can also transfer Shell data to or from the desktop or Windows Explorer.</span></span>

<span data-ttu-id="e434a-107">Хотя файлы — это наиболее распространенный объект оболочки, передача данных оболочки может заключаться в любом из множества объектов, находящихся в [пространстве имен Shell](namespace-intro.md).</span><span class="sxs-lookup"><span data-stu-id="e434a-107">Although files are the most commonly transferred Shell object, Shell data transfer can involve any of the variety of objects found in the [Shell namespace](namespace-intro.md).</span></span> <span data-ttu-id="e434a-108">Например, приложению может потребоваться переместить файл в виртуальную папку, например в корзину, или принять объект из расширения пространства имен, отличного от Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="e434a-108">For instance, your application might need to transfer a file to a virtual folder such as the Recycle Bin, or accept an object from a non-Microsoft namespace extension.</span></span> <span data-ttu-id="e434a-109">Если вы реализуете расширение пространства имен, оно должно иметь возможность корректно работать в качестве источника и целевого объекта перетаскивания.</span><span class="sxs-lookup"><span data-stu-id="e434a-109">If you are implementing a namespace extension, it must be able to behave properly as a drop source and target.</span></span>

<span data-ttu-id="e434a-110">В этом документе обсуждается, как приложения могут реализовывать перетаскивание и передачу данных в буфер обмена с помощью объектов оболочки.</span><span class="sxs-lookup"><span data-stu-id="e434a-110">This document discusses how applications can implement drag-and-drop and Clipboard data transfers with Shell objects.</span></span>

-   [<span data-ttu-id="e434a-111">Объект данных оболочки</span><span class="sxs-lookup"><span data-stu-id="e434a-111">The Shell Data Object</span></span>](dataobject.md)
-   [<span data-ttu-id="e434a-112">Форматы буфера обмена оболочки</span><span class="sxs-lookup"><span data-stu-id="e434a-112">Shell Clipboard Formats</span></span>](clipboard.md)
-   [<span data-ttu-id="e434a-113">Обработка сценариев передачи данных оболочки</span><span class="sxs-lookup"><span data-stu-id="e434a-113">Handling Shell Data Transfer Scenarios</span></span>](datascenarios.md)

## <a name="how-drag-and-drop-works-with-shell-objects"></a><span data-ttu-id="e434a-114">Принцип работы перетаскивания с объектами оболочки</span><span class="sxs-lookup"><span data-stu-id="e434a-114">How Drag-and-Drop Works with Shell Objects</span></span>

<span data-ttu-id="e434a-115">Приложениям часто требуется предоставить пользователям способ передачи данных оболочки.</span><span class="sxs-lookup"><span data-stu-id="e434a-115">Applications often need to provide users with a way to transfer Shell data.</span></span> <span data-ttu-id="e434a-116">Ниже приведены некоторые примеры.</span><span class="sxs-lookup"><span data-stu-id="e434a-116">Some examples are:</span></span>

-   <span data-ttu-id="e434a-117">Перетаскивание файла из проводника Windows или рабочего стола в приложение.</span><span class="sxs-lookup"><span data-stu-id="e434a-117">Dragging a file from Windows Explorer or the desktop and dropping it on an application.</span></span>
-   <span data-ttu-id="e434a-118">Копирование файла в буфер обмена в проводнике Windows и его вставление в приложение.</span><span class="sxs-lookup"><span data-stu-id="e434a-118">Copying a file to the Clipboard in Windows Explorer and pasting it into an application.</span></span>
-   <span data-ttu-id="e434a-119">Перетаскивание файла из приложения в корзину.</span><span class="sxs-lookup"><span data-stu-id="e434a-119">Dragging a file from an application to the Recycle Bin.</span></span>

<span data-ttu-id="e434a-120">Подробное описание способов обработки этих и других сценариев см. в разделе [Обработка сценариев передача данных оболочки](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="e434a-120">For a detailed discussion of how to handle these and other scenarios, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span> <span data-ttu-id="e434a-121">В этом документе рассматриваются общие принципы обмена данными в оболочке.</span><span class="sxs-lookup"><span data-stu-id="e434a-121">This document focuses on the general principles behind Shell data transfer.</span></span>

<span data-ttu-id="e434a-122">Windows предоставляет два стандартных способа для перемещения данных оболочки в приложениях:</span><span class="sxs-lookup"><span data-stu-id="e434a-122">Windows provides two standard ways for applications to transfer Shell data:</span></span>

-   <span data-ttu-id="e434a-123">Пользователь вырезает или копирует данные оболочки, например один или несколько файлов, в буфер обмена.</span><span class="sxs-lookup"><span data-stu-id="e434a-123">A user cuts or copies Shell data, such as one or more files, to the Clipboard.</span></span> <span data-ttu-id="e434a-124">Другое приложение получает данные из буфера обмена.</span><span class="sxs-lookup"><span data-stu-id="e434a-124">The other application retrieves the data from the Clipboard.</span></span>
-   <span data-ttu-id="e434a-125">Пользователь перетаскивает значок, представляющий данные из исходного приложения, и удаляет значок в окне, принадлежащем целевому объекту.</span><span class="sxs-lookup"><span data-stu-id="e434a-125">A user drags an icon that represents the data from the source application and drops the icon on a window owned by the target.</span></span>

<span data-ttu-id="e434a-126">В обоих случаях передаваемые данные содержатся в *объекте данных*.</span><span class="sxs-lookup"><span data-stu-id="e434a-126">In both cases, the transferred data is contained in a *data object*.</span></span> <span data-ttu-id="e434a-127">Объекты данных являются объектами модели COM, которые предоставляют интерфейс [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) .</span><span class="sxs-lookup"><span data-stu-id="e434a-127">Data objects are Component Object Model (COM) objects that expose the [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span> <span data-ttu-id="e434a-128">Схематическое руководство состоит из трех этапов, которые должны выполнять все передачи данных в оболочке:</span><span class="sxs-lookup"><span data-stu-id="e434a-128">Schematically, there are three essential steps that all Shell data transfers must follow:</span></span>

1.  <span data-ttu-id="e434a-129">Источник создает объект данных, представляющий передаваемые данные.</span><span class="sxs-lookup"><span data-stu-id="e434a-129">The source creates a data object that represents the data that is to be transferred.</span></span>
2.  <span data-ttu-id="e434a-130">Целевой объект получает указатель на интерфейс [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) объекта данных.</span><span class="sxs-lookup"><span data-stu-id="e434a-130">The target receives a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span>
3.  <span data-ttu-id="e434a-131">Цель вызывает интерфейс [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) для извлечения данных из него.</span><span class="sxs-lookup"><span data-stu-id="e434a-131">The target calls the [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface to extract the data from it.</span></span>

<span data-ttu-id="e434a-132">Разница между буфером обмена и перемещением данных при перетаскивании заключается в основном в том, как передается указатель [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) из источника в целевой объект.</span><span class="sxs-lookup"><span data-stu-id="e434a-132">The difference between Clipboard and drag-and-drop data transfers lies primarily in how the [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) pointer is transferred from the source to the target.</span></span>

### <a name="clipboard-data-transfers"></a><span data-ttu-id="e434a-133">Передача данных из буфера обмена</span><span class="sxs-lookup"><span data-stu-id="e434a-133">Clipboard Data Transfers</span></span>

<span data-ttu-id="e434a-134">Буфер обмена — это самый простой способ перемещения данных оболочки.</span><span class="sxs-lookup"><span data-stu-id="e434a-134">The Clipboard is the simplest way to transfer Shell data.</span></span> <span data-ttu-id="e434a-135">Основная процедура аналогична передаче стандартных данных буфера обмена.</span><span class="sxs-lookup"><span data-stu-id="e434a-135">The basic procedure is similar to standard Clipboard data transfers.</span></span> <span data-ttu-id="e434a-136">Однако, поскольку вы передаете указатель на объект данных, а не сами данные, необходимо использовать API OLE Clipboard вместо стандартного API буфера обмена.</span><span class="sxs-lookup"><span data-stu-id="e434a-136">However, because you are transferring a pointer to a data object, not the data itself, you must use the OLE clipboard API instead of the standard clipboard API.</span></span> <span data-ttu-id="e434a-137">В следующей процедуре показано, как использовать интерфейс API буфера обмена OLE для перемещения данных оболочки в буфер обмена.</span><span class="sxs-lookup"><span data-stu-id="e434a-137">The following procedure outlines how to use the OLE clipboard API to transfer Shell data with the Clipboard:</span></span>

1.  <span data-ttu-id="e434a-138">Источник данных создает объект данных для хранения данных.</span><span class="sxs-lookup"><span data-stu-id="e434a-138">The data source creates a data object to contain the data.</span></span>
2.  <span data-ttu-id="e434a-139">Источник данных вызывает [**олесетклипбоард**](/windows/win32/api/ole2/nf-ole2-olesetclipboard), который помещает указатель на интерфейс [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) объекта данных в буфер обмена.</span><span class="sxs-lookup"><span data-stu-id="e434a-139">The data source calls [**OleSetClipboard**](/windows/win32/api/ole2/nf-ole2-olesetclipboard), which places a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface on the Clipboard.</span></span>
3.  <span data-ttu-id="e434a-140">Цель вызывает [**олежетклипбоард**](/windows/win32/api/ole2/nf-ole2-olegetclipboard) для получения указателя на интерфейс [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) объекта данных.</span><span class="sxs-lookup"><span data-stu-id="e434a-140">The target calls [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard) to retrieve the pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span>
4.  <span data-ttu-id="e434a-141">Целевой объект извлекает данные путем вызова метода [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) .</span><span class="sxs-lookup"><span data-stu-id="e434a-141">The target extracts the data by calling the [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) method.</span></span>
5.  <span data-ttu-id="e434a-142">При передаче данных в оболочке целевому объекту также может потребоваться вызвать метод [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) объекта данных, чтобы отправить отзыв объекту данных в результате передачи данных.</span><span class="sxs-lookup"><span data-stu-id="e434a-142">With some Shell data transfers, the target might also need to call the data object's [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method to provide feedback to the data object on the outcome of the data transfer.</span></span> <span data-ttu-id="e434a-143">Пример этого типа операций см. в разделе [Обработка оптимизированных операций перемещения](datascenarios.md) .</span><span class="sxs-lookup"><span data-stu-id="e434a-143">See [Handling Optimized Move Operations](datascenarios.md) for an example of this type of operation.</span></span>

### <a name="drag-and-drop-data-transfers"></a><span data-ttu-id="e434a-144">Перемещение данных при перетаскивании</span><span class="sxs-lookup"><span data-stu-id="e434a-144">Drag-and-Drop Data Transfers</span></span>

<span data-ttu-id="e434a-145">Хотя несколько сложнее в реализации, перемещение данных с помощью перетаскивания имеет значительные преимущества по сравнению с буфером обмена:</span><span class="sxs-lookup"><span data-stu-id="e434a-145">While somewhat more complex to implement, drag-and-drop data transfer has some significant advantages over the Clipboard:</span></span>

-   <span data-ttu-id="e434a-146">Перемещение по перетаскиванию можно выполнить с помощью простого перемещения мыши, что делает операцию более гибкой и удобной для использования, чем буфер обмена.</span><span class="sxs-lookup"><span data-stu-id="e434a-146">Drag-and-drop transfers can be done with a simple mouse movement, making operation more flexible and intuitive to use than the Clipboard.</span></span>
-   <span data-ttu-id="e434a-147">Перетаскивание предоставляет пользователю визуальное представление операции.</span><span class="sxs-lookup"><span data-stu-id="e434a-147">Drag-and-drop provides the user with a visual representation of the operation.</span></span> <span data-ttu-id="e434a-148">Пользователь может следовать за значком при переходе от источника к целевому объекту.</span><span class="sxs-lookup"><span data-stu-id="e434a-148">The user can follow the icon as it moves from source to target.</span></span>
-   <span data-ttu-id="e434a-149">Перетаскивание уведомляет целевой объект, когда данные доступны.</span><span class="sxs-lookup"><span data-stu-id="e434a-149">Drag-and-drop notifies the target when the data is available.</span></span>

<span data-ttu-id="e434a-150">Операции перетаскивания также используют объекты данных для переноса данных.</span><span class="sxs-lookup"><span data-stu-id="e434a-150">Drag-and-drop operations also use data objects to transfer data.</span></span> <span data-ttu-id="e434a-151">Однако источник удаления должен предоставлять функциональные возможности, которые выходят за рамки, необходимые для перемещения буфера обмена:</span><span class="sxs-lookup"><span data-stu-id="e434a-151">However, the drop source must provide functionality beyond that required for Clipboard transfers:</span></span>

-   <span data-ttu-id="e434a-152">Источник удаления должен также создать объект, предоставляющий интерфейс [**идропсаурце**](/windows/win32/api/oleidl/nn-oleidl-idropsource) .</span><span class="sxs-lookup"><span data-stu-id="e434a-152">The drop source must also create an object that exposes an [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface.</span></span> <span data-ttu-id="e434a-153">Система использует **идропсаурце** для связи с источником во время выполнения операции.</span><span class="sxs-lookup"><span data-stu-id="e434a-153">The system uses **IDropSource** to communicate with the source while the operation is in progress.</span></span>
-   <span data-ttu-id="e434a-154">Объект данных перетаскивания отвечает за отслеживание перемещения курсора и отображение значка для представления объекта данных.</span><span class="sxs-lookup"><span data-stu-id="e434a-154">The drag-and-drop data object is responsible for tracking cursor movement and displaying an icon to represent the data object.</span></span>

<span data-ttu-id="e434a-155">Цели перетаскивания также должны предоставлять больше функций, чем требуется для обработки перемещений в буфер обмена:</span><span class="sxs-lookup"><span data-stu-id="e434a-155">Drop targets must also provide more functionality than is needed to handle Clipboard transfers:</span></span>

-   <span data-ttu-id="e434a-156">Цель перетаскивания должна предоставлять интерфейс [**интерфейс IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) .</span><span class="sxs-lookup"><span data-stu-id="e434a-156">The drop target must expose an [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span> <span data-ttu-id="e434a-157">Когда курсор находится над целевым окном, система использует **интерфейс IDropTarget** для предоставления целевой информации, например позиции курсора, и для уведомления об удалении данных.</span><span class="sxs-lookup"><span data-stu-id="e434a-157">When the cursor is over a target window, the system uses **IDropTarget** to provide the target with information such as the cursor position, and to notify it when the data is dropped.</span></span>
-   <span data-ttu-id="e434a-158">Цель перетаскивания должна быть зарегистрирована в системе путем вызова [**регистердрагдроп**](/windows/win32/api/ole2/nf-ole2-registerdragdrop).</span><span class="sxs-lookup"><span data-stu-id="e434a-158">The drop target must register itself with the system by calling [**RegisterDragDrop**](/windows/win32/api/ole2/nf-ole2-registerdragdrop).</span></span> <span data-ttu-id="e434a-159">Эта функция обеспечивает систему с помощью маркера целевого окна и указателя на интерфейс [**интерфейс IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) целевого приложения.</span><span class="sxs-lookup"><span data-stu-id="e434a-159">This function provides the system with the handle to a target window and a pointer to the target application's [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span>

> [!Note]  
> <span data-ttu-id="e434a-160">Для операций перетаскивания приложение должно инициализировать COM с помощью [**олеинитиализе**](/windows/win32/api/ole2/nf-ole2-oleinitialize), а не [**CoInitialize**](/windows/win32/api/objbase/nf-objbase-coinitialize).</span><span class="sxs-lookup"><span data-stu-id="e434a-160">For drag-and-drop operations, your application must initialize COM with [**OleInitialize**](/windows/win32/api/ole2/nf-ole2-oleinitialize), not [**CoInitialize**](/windows/win32/api/objbase/nf-objbase-coinitialize).</span></span>

 

<span data-ttu-id="e434a-161">Следующая процедура описывает ключевые шаги, которые обычно используются для переноса данных оболочки с помощью перетаскивания.</span><span class="sxs-lookup"><span data-stu-id="e434a-161">The following procedure outlines the essential steps that are typically used to transfer Shell data with drag-and-drop:</span></span>

1.  <span data-ttu-id="e434a-162">Цель вызывает [**регистердрагдроп**](/windows/win32/api/ole2/nf-ole2-registerdragdrop) , чтобы дать системе указатель на интерфейс [**интерфейс IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) и зарегистрировать окно в качестве целевого объекта перетаскивания.</span><span class="sxs-lookup"><span data-stu-id="e434a-162">The target calls [**RegisterDragDrop**](/windows/win32/api/ole2/nf-ole2-registerdragdrop) to give the system a pointer to its [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface and register a window as a drop target.</span></span>
2.  <span data-ttu-id="e434a-163">Когда пользователь запускает операцию перетаскивания, источник создает объект данных и инициирует *цикл перетаскивания* путем вызова [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop).</span><span class="sxs-lookup"><span data-stu-id="e434a-163">When the user starts a drag-and-drop operation, the source creates a data object and initiates a *drag loop* by calling [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop).</span></span>
3.  <span data-ttu-id="e434a-164">Когда курсор находится над целевым окном, система уведомляет целевой объект, вызывая один из методов [**интерфейс IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) целевого объекта.</span><span class="sxs-lookup"><span data-stu-id="e434a-164">When the cursor is over the target window, the system notifies the target by calling one of the target's [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) methods.</span></span> <span data-ttu-id="e434a-165">Система вызывает [**интерфейс IDropTarget::D ражентер**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) , когда курсор попадает в целевое окно, и [**интерфейс IDropTarget::D раговер**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) по мере прохождения курсора в целевом окне.</span><span class="sxs-lookup"><span data-stu-id="e434a-165">The system calls [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) when the cursor enters the target window, and [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) as the cursor passes over the target window.</span></span> <span data-ttu-id="e434a-166">Оба метода обеспечивают цель перетаскивания текущей позицией курсора и состояние клавиш с модификаторами клавиатуры, таких как CTRL или ALT.</span><span class="sxs-lookup"><span data-stu-id="e434a-166">Both methods provide the drop target with the current cursor position and the state of keyboard modifier keys such as CTRL or ALT.</span></span> <span data-ttu-id="e434a-167">Когда курсор покидает целевое окно, система уведомляет целевой объект, вызывая [**интерфейс IDropTarget::D раглеаве**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragleave).</span><span class="sxs-lookup"><span data-stu-id="e434a-167">When the cursor leaves the target window, the system notifies the target by calling [**IDropTarget::DragLeave**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragleave).</span></span> <span data-ttu-id="e434a-168">Когда любой из этих методов возвращает значение, система вызывает интерфейс [**идропсаурце**](/windows/win32/api/oleidl/nn-oleidl-idropsource) для передачи возвращаемого значения в источник.</span><span class="sxs-lookup"><span data-stu-id="e434a-168">When any of these methods return, the system calls the [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface to pass the return value to the source.</span></span>
4.  <span data-ttu-id="e434a-169">Когда пользователь отпускает кнопку мыши для удаления данных, система вызывает метод [**интерфейс IDropTarget::D верхнем**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) целевого объекта.</span><span class="sxs-lookup"><span data-stu-id="e434a-169">When the user releases the mouse button to drop the data, the system calls the target's [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) method.</span></span> <span data-ttu-id="e434a-170">Между параметрами метода — это указатель на интерфейс [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) объекта данных.</span><span class="sxs-lookup"><span data-stu-id="e434a-170">Among the method's parameters is a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span>
5.  <span data-ttu-id="e434a-171">Цель вызывает метод [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) объекта данных для извлечения данных.</span><span class="sxs-lookup"><span data-stu-id="e434a-171">The target calls the data object's [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) method to extract the data.</span></span>
6.  <span data-ttu-id="e434a-172">При передаче данных в оболочке целевому объекту также может потребоваться вызвать метод [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) объекта данных, чтобы отправить отзыв источнику на результат передачи данных.</span><span class="sxs-lookup"><span data-stu-id="e434a-172">With some Shell data transfers, the target might also need to call the data object's [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method to provide feedback to the source on the outcome of the data transfer.</span></span>
7.  <span data-ttu-id="e434a-173">Когда целевой объект завершит работу с объектом данных, он возвращается из [**интерфейс IDropTarget::D верхнем**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop).</span><span class="sxs-lookup"><span data-stu-id="e434a-173">When the target is finished with the data object, it returns from [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop).</span></span> <span data-ttu-id="e434a-174">Система возвращает вызов [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) источника для уведомления источника о завершении передачи данных.</span><span class="sxs-lookup"><span data-stu-id="e434a-174">The system returns the source's [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) call to notify the source that the data transfer is complete.</span></span>
8.  <span data-ttu-id="e434a-175">В зависимости от конкретного [сценария передачи данных](datascenarios.md)источнику может потребоваться выполнить дополнительные действия в зависимости от значения, возвращаемого [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) , и значений, которые передаются в объект данных целевым объектом.</span><span class="sxs-lookup"><span data-stu-id="e434a-175">Depending on the particular [data transfer scenario](datascenarios.md), the source might need to take additional action based on the value returned by [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) and the values that are passed to the data object by the target.</span></span> <span data-ttu-id="e434a-176">Например, при перемещении файла источник должен проверить эти значения, чтобы определить, должен ли он удалить исходный файл.</span><span class="sxs-lookup"><span data-stu-id="e434a-176">For instance, when a file is moved, the source must check these values to determine whether it must delete the original file.</span></span>
9.  <span data-ttu-id="e434a-177">Источник освобождает объект данных.</span><span class="sxs-lookup"><span data-stu-id="e434a-177">The source releases the data object.</span></span>

<span data-ttu-id="e434a-178">Хотя процедуры, описанные выше, предоставляют хорошую общую модель для передачи данных оболочки, существует множество различных типов данных, которые могут содержаться в объекте данных оболочки.</span><span class="sxs-lookup"><span data-stu-id="e434a-178">While the procedures outlined above provide a good general model for Shell data transfer, there are many different types of data that can be contained in a Shell data object.</span></span> <span data-ttu-id="e434a-179">Существует также ряд различных сценариев для обмена данными, которые могут потребоваться для работы приложения.</span><span class="sxs-lookup"><span data-stu-id="e434a-179">There are also a number of different data transfer scenarios that your application might need to handle.</span></span> <span data-ttu-id="e434a-180">Для каждого типа данных и сценария требуется несколько иной подход к трем ключевым этапам процедуры:</span><span class="sxs-lookup"><span data-stu-id="e434a-180">Each data type and scenario requires a somewhat different approach to three key steps in the procedure:</span></span>

-   <span data-ttu-id="e434a-181">Как источник конструирует объект данных для хранения данных оболочки.</span><span class="sxs-lookup"><span data-stu-id="e434a-181">How a source constructs a data object to contain the Shell data.</span></span>
-   <span data-ttu-id="e434a-182">То, как целевой объект извлекает данные оболочки из объекта данных.</span><span class="sxs-lookup"><span data-stu-id="e434a-182">How a target extracts Shell data from the data object.</span></span>
-   <span data-ttu-id="e434a-183">Как источник завершает операцию обмена данными.</span><span class="sxs-lookup"><span data-stu-id="e434a-183">How the source completes the data transfer operation.</span></span>

<span data-ttu-id="e434a-184">[Объект данных оболочки](dataobject.md) предоставляет общее описание того, как источник создает объект данных оболочки и как этот объект данных может обрабатываться целевым объектом.</span><span class="sxs-lookup"><span data-stu-id="e434a-184">The [Shell Data Object](dataobject.md) provides a general discussion of how a source constructs a Shell data object, and how that data object can be handled by the target.</span></span> <span data-ttu-id="e434a-185">[Обработка сценариев передача данных оболочки](datascenarios.md) подробно рассказывает о том, как обрабатывать ряд распространенных сценариев обмена данными с оболочкой.</span><span class="sxs-lookup"><span data-stu-id="e434a-185">[Handling Shell Data Transfer Scenarios](datascenarios.md) discusses in detail how to handle a number of common Shell data transfer scenarios.</span></span>

 

 
