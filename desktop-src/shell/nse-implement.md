---
description: Процедура реализации расширения пространства имен аналогична процедуре для любого другого внутрипроцессного объекта компонента модели COM.
title: Реализация интерфейсов объекта папки Basic
ms.topic: article
ms.date: 05/31/2018
ms.assetid: a45b8011-5355-429b-8935-4a7bdb5d2316
api_name: ''
api_type: ''
api_location: ''
topic_type:
- kbArticle
ms.openlocfilehash: c05f5d2e4c21a923856c7324ad2d407230fa7595
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104985661"
---
# <a name="implementing-the-basic-folder-object-interfaces"></a><span data-ttu-id="eaab4-103">Реализация интерфейсов объекта папки Basic</span><span class="sxs-lookup"><span data-stu-id="eaab4-103">Implementing the Basic Folder Object Interfaces</span></span>

<span data-ttu-id="eaab4-104">Процедура реализации расширения пространства имен аналогична процедуре для любого другого внутрипроцессного объекта компонента модели COM.</span><span class="sxs-lookup"><span data-stu-id="eaab4-104">The procedure for implementing a namespace extension is similar to that for any other in-process Component Object Model (COM) object.</span></span> <span data-ttu-id="eaab4-105">Все расширения должны поддерживать три основных интерфейса, которые предоставляют проводнику Windows Основные сведения, необходимые для отображения папок расширения в представлении в виде дерева.</span><span class="sxs-lookup"><span data-stu-id="eaab4-105">All extensions must support three primary interfaces that provide Windows Explorer with the basic information needed to display the extension's folders in the tree view.</span></span> <span data-ttu-id="eaab4-106">Однако, чтобы полностью использовать возможности проводника Windows, расширение также должно предоставлять один или несколько дополнительных интерфейсов, поддерживающих более сложные функции, такие как контекстные меню или перетаскивание, и предоставлять представление папок.</span><span class="sxs-lookup"><span data-stu-id="eaab4-106">However, to make full use of the capabilities of Windows Explorer, your extension must also expose one or more optional interfaces that support more sophisticated features, such as shortcut menus or drag-and-drop, and provide a folder view.</span></span>

<span data-ttu-id="eaab4-107">В этом документе рассматривается реализация основного и дополнительного интерфейсов, которые Windows Explorer вызывает для получения сведений о содержимом вашего расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-107">This document discusses how to implement the primary and optional interfaces that Windows Explorer calls for information about the contents of your extension.</span></span> <span data-ttu-id="eaab4-108">Обсуждение реализации представления папок и настройки проводника Windows см. в разделе [Реализация представления папок](../lwef/nse-folderview.md).</span><span class="sxs-lookup"><span data-stu-id="eaab4-108">For a discussion of how to implement a folder view and how to customize Windows Explorer, see [Implementing a Folder View](../lwef/nse-folderview.md).</span></span>

-   [<span data-ttu-id="eaab4-109">Базовая реализация и регистрация</span><span class="sxs-lookup"><span data-stu-id="eaab4-109">Basic Implementation and Registration</span></span>](#basic-implementation-and-registration)
    -   [<span data-ttu-id="eaab4-110">Регистрация расширения</span><span class="sxs-lookup"><span data-stu-id="eaab4-110">Registering an Extension</span></span>](#registering-an-extension)
-   [<span data-ttu-id="eaab4-111">Обработка PIDL</span><span class="sxs-lookup"><span data-stu-id="eaab4-111">Handling PIDLs</span></span>](#handling-pidls)
    -   [<span data-ttu-id="eaab4-112">Создание структуры ШИТЕМИД</span><span class="sxs-lookup"><span data-stu-id="eaab4-112">Creating an SHITEMID Structure</span></span>](#creating-an-shitemid-structure)
    -   [<span data-ttu-id="eaab4-113">Создание ПИДЛ</span><span class="sxs-lookup"><span data-stu-id="eaab4-113">Constructing a PIDL</span></span>](#constructing-a-pidl)
    -   [<span data-ttu-id="eaab4-114">Интерпретация PIDL</span><span class="sxs-lookup"><span data-stu-id="eaab4-114">Interpreting PIDLs</span></span>](#interpreting-pidls)
-   [<span data-ttu-id="eaab4-115">Реализация основных интерфейсов</span><span class="sxs-lookup"><span data-stu-id="eaab4-115">Implementing the Primary Interfaces</span></span>](#implementing-the-primary-interfaces)
    -   [<span data-ttu-id="eaab4-116">Интерфейс Иперсистфолдер</span><span class="sxs-lookup"><span data-stu-id="eaab4-116">IPersistFolder Interface</span></span>](#ipersistfolder-interface)
    -   [<span data-ttu-id="eaab4-117">Интерфейс Ишеллфолдер</span><span class="sxs-lookup"><span data-stu-id="eaab4-117">IShellFolder Interface</span></span>](#ishellfolder-interface)
    -   [<span data-ttu-id="eaab4-118">Интерфейс Иенумидлист</span><span class="sxs-lookup"><span data-stu-id="eaab4-118">IEnumIDList Interface</span></span>](#ienumidlist-interface)
-   [<span data-ttu-id="eaab4-119">Реализация необязательных интерфейсов</span><span class="sxs-lookup"><span data-stu-id="eaab4-119">Implementing the Optional Interfaces</span></span>](#implementing-the-optional-interfaces)
    -   [<span data-ttu-id="eaab4-120">иекстрактикон</span><span class="sxs-lookup"><span data-stu-id="eaab4-120">IExtractIcon</span></span>](#iextracticon)
    -   [<span data-ttu-id="eaab4-121">IContextMenu</span><span class="sxs-lookup"><span data-stu-id="eaab4-121">IContextMenu</span></span>](#icontextmenu)
    -   [<span data-ttu-id="eaab4-122">икуеринфо</span><span class="sxs-lookup"><span data-stu-id="eaab4-122">IQueryInfo</span></span>](#iqueryinfo)
    -   [<span data-ttu-id="eaab4-123">IDataObject и интерфейс IDropTarget</span><span class="sxs-lookup"><span data-stu-id="eaab4-123">IDataObject and IDropTarget</span></span>](#idataobject-and-idroptarget)
-   [<span data-ttu-id="eaab4-124">Работа с реализацией представления папки оболочки по умолчанию</span><span class="sxs-lookup"><span data-stu-id="eaab4-124">Working With the Default Shell Folder View Implementation</span></span>](#working-with-the-default-shell-folder-view-implementation)

## <a name="basic-implementation-and-registration"></a><span data-ttu-id="eaab4-125">Базовая реализация и регистрация</span><span class="sxs-lookup"><span data-stu-id="eaab4-125">Basic Implementation and Registration</span></span>

<span data-ttu-id="eaab4-126">В качестве внутрипроцессного COM-сервера библиотека DLL должна предоставлять несколько стандартных функций и интерфейсов:</span><span class="sxs-lookup"><span data-stu-id="eaab4-126">As an in-process COM server, your DLL must expose several standard functions and interfaces:</span></span>

-   [<span data-ttu-id="eaab4-127">**DllCanUnloadNow**</span><span class="sxs-lookup"><span data-stu-id="eaab4-127">**DllCanUnloadNow**</span></span>](/windows/win32/api/combaseapi/nf-combaseapi-dllcanunloadnow)
-   [<span data-ttu-id="eaab4-128">**DllGetClassObject**</span><span class="sxs-lookup"><span data-stu-id="eaab4-128">**DllGetClassObject**</span></span>](/windows/win32/api/combaseapi/nf-combaseapi-dllgetclassobject)
-   [<span data-ttu-id="eaab4-129">**IClassFactory**</span><span class="sxs-lookup"><span data-stu-id="eaab4-129">**IClassFactory**</span></span>](/windows/win32/api/unknwn/nn-unknwn-iclassfactory)
-   [<span data-ttu-id="eaab4-130">**IUnknown**</span><span class="sxs-lookup"><span data-stu-id="eaab4-130">**IUnknown**</span></span>](/windows/win32/api/unknwn/nn-unknwn-iunknown)

<span data-ttu-id="eaab4-131">Эти функции и интерфейсы реализуются так же, как и для большинства других COM-объектов.</span><span class="sxs-lookup"><span data-stu-id="eaab4-131">These functions and interfaces are implemented in the same way as they are for most other COM objects.</span></span> <span data-ttu-id="eaab4-132">Дополнительные сведения см. в [документации по com](../com/the-component-object-model.md).</span><span class="sxs-lookup"><span data-stu-id="eaab4-132">For details, see the [COM documentation](../com/the-component-object-model.md).</span></span>

### <a name="registering-an-extension"></a><span data-ttu-id="eaab4-133">Регистрация расширения</span><span class="sxs-lookup"><span data-stu-id="eaab4-133">Registering an Extension</span></span>

<span data-ttu-id="eaab4-134">Как и для всех COM-объектов, необходимо создать GUID идентификатора класса (CLSID) для вашего расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-134">As with all COM objects, you must create a class identifier (CLSID) GUID for your extension.</span></span> <span data-ttu-id="eaab4-135">Зарегистрируйте объект, создав подраздел с **\_ \_ корневым** \\ **идентификатором CLSID** классов hKey с именем для идентификатора CLSID вашего расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-135">Register the object by creating a subkey of **HKEY\_CLASSES\_ROOT**\\**CLSID** named for the CLSID of your extension.</span></span> <span data-ttu-id="eaab4-136">Библиотека DLL должна быть зарегистрирована как внутрипроцессный сервер и должна указывать модель потоков подразделений.</span><span class="sxs-lookup"><span data-stu-id="eaab4-136">The DLL should be registered as an in-process server and should specify the apartment threading model.</span></span> <span data-ttu-id="eaab4-137">Поведение корневой папки расширения можно настроить, добавив различные подразделы и значения в ключ CLSID расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-137">You can customize the behavior of an extension's root folder by adding a variety of subkeys and values to the extension's CLSID key.</span></span>

<span data-ttu-id="eaab4-138">Некоторые из этих значений применяются только к расширениям с точками виртуального соединения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-138">Several of these values apply only to extensions with virtual junction points.</span></span> <span data-ttu-id="eaab4-139">Эти значения не применяются к расширениям, точки соединения которых являются папками файловой системы.</span><span class="sxs-lookup"><span data-stu-id="eaab4-139">These values do not apply to extensions whose junction points are file system folders.</span></span> <span data-ttu-id="eaab4-140">Дополнительные сведения см. [в статье указание расположения расширения пространства имен](nse-junction.md).</span><span class="sxs-lookup"><span data-stu-id="eaab4-140">For further discussion, see [Specifying a Namespace Extension's Location](nse-junction.md).</span></span> <span data-ttu-id="eaab4-141">Чтобы изменить поведение расширения с помощью виртуальной точки соединения, добавьте одно или несколько следующих значений в ключ CLSID расширения:</span><span class="sxs-lookup"><span data-stu-id="eaab4-141">To modify the behavior of an extension with a virtual junction point, add one or more of the following values to the extension's CLSID key:</span></span>

-   <span data-ttu-id="eaab4-142">Вантсфорпарсинг.</span><span class="sxs-lookup"><span data-stu-id="eaab4-142">WantsFORPARSING.</span></span> <span data-ttu-id="eaab4-143">Имя синтаксического анализа для расширения с виртуальной точкой соединения обычно будет иметь вид:: {*GUID*}.</span><span class="sxs-lookup"><span data-stu-id="eaab4-143">The parsing name for an extension with a virtual junction point will normally have the form ::{*GUID*}.</span></span> <span data-ttu-id="eaab4-144">Расширения этого типа обычно содержат виртуальные элементы.</span><span class="sxs-lookup"><span data-stu-id="eaab4-144">Extensions of this type normally contain virtual items.</span></span> <span data-ttu-id="eaab4-145">Однако некоторые расширения, например "Мои документы", фактически соответствуют папкам файловой системы, даже если они имеют виртуальные точки соединения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-145">However, some extensions, such as My Documents, actually correspond to file system folders, even though they have virtual junction points.</span></span> <span data-ttu-id="eaab4-146">Если расширение представляет объекты файловой системы таким образом, можно задать значение Вантсфорпарсинг.</span><span class="sxs-lookup"><span data-stu-id="eaab4-146">If your extension represents file system objects in this way, you can set the WantsFORPARSING value.</span></span> <span data-ttu-id="eaab4-147">Проводник Windows запросит имя для анализа корневой папки, вызвав метод [**ишеллфолдер:: жетдисплайнамеоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) объекта Folder с *уфлагс* , имеющим значение **шгдн \_ форпарсинг** , а *Пидл* задать один пустой указатель на список идентификаторов элементов (Пидл).</span><span class="sxs-lookup"><span data-stu-id="eaab4-147">Windows Explorer will then request your root folder's parsing name by calling the folder object's [**IShellFolder::GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) method with *uFlags* set to **SHGDN\_FORPARSING** and *pidl* set to a single empty pointer to an item identifier list (PIDL).</span></span> <span data-ttu-id="eaab4-148">Пустой ПИДЛ содержит только признак конца.</span><span class="sxs-lookup"><span data-stu-id="eaab4-148">An empty PIDL contains only a terminator.</span></span> <span data-ttu-id="eaab4-149">Затем метод должен вернуть имя синтаксического анализа:: {*GUID*} корневой папки.</span><span class="sxs-lookup"><span data-stu-id="eaab4-149">Your method should then return the root folder's ::{*GUID*} parsing name.</span></span>
-   <span data-ttu-id="eaab4-150">Хидефолдервербс.</span><span class="sxs-lookup"><span data-stu-id="eaab4-150">HideFolderVerbs.</span></span> <span data-ttu-id="eaab4-151">Команды, зарегистрированные в **\_ \_ корневой папке классов hKey** \\  , обычно связаны со всеми расширениями.</span><span class="sxs-lookup"><span data-stu-id="eaab4-151">The verbs registered under **HKEY\_CLASSES\_ROOT**\\**Folder** normally are associated with all extensions.</span></span> <span data-ttu-id="eaab4-152">Они отображаются в контекстном меню расширения и могут вызываться [**ShellExecute**](/windows/desktop/api/Shellapi/nf-shellapi-shellexecutea).</span><span class="sxs-lookup"><span data-stu-id="eaab4-152">They appear on the extension's shortcut menu and can be invoked by [**ShellExecute**](/windows/desktop/api/Shellapi/nf-shellapi-shellexecutea).</span></span> <span data-ttu-id="eaab4-153">Чтобы предотвратить связь этих команд с расширением, задайте значение Хидефолдервербс.</span><span class="sxs-lookup"><span data-stu-id="eaab4-153">To prevent any of these verbs from being associated with your extension, set the HideFolderVerbs value.</span></span>
-   <span data-ttu-id="eaab4-154">Хидеасделете.</span><span class="sxs-lookup"><span data-stu-id="eaab4-154">HideAsDelete.</span></span> <span data-ttu-id="eaab4-155">Если пользователь пытается удалить расширение, в проводнике вместо этого расширения будет скрыта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-155">If a user attempts to delete your extension, Windows Explorer will instead hide the extension.</span></span>
-   <span data-ttu-id="eaab4-156">Хидеасделетеперусер.</span><span class="sxs-lookup"><span data-stu-id="eaab4-156">HideAsDeletePerUser.</span></span> <span data-ttu-id="eaab4-157">Это значение имеет тот же результат, что и Хидеасделете, но для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="eaab4-157">This value has the same effect as HideAsDelete but on a per-user basis.</span></span> <span data-ttu-id="eaab4-158">Расширение скрыто только для тех пользователей, которые пытались удалить его.</span><span class="sxs-lookup"><span data-stu-id="eaab4-158">The extension is hidden only for those users who have attempted to delete it.</span></span> <span data-ttu-id="eaab4-159">Расширение видимо для всех остальных пользователей.</span><span class="sxs-lookup"><span data-stu-id="eaab4-159">The extension is visible to all other users.</span></span>
-   <span data-ttu-id="eaab4-160">Куерифороверлай.</span><span class="sxs-lookup"><span data-stu-id="eaab4-160">QueryForOverlay.</span></span> <span data-ttu-id="eaab4-161">Установите это значение, чтобы указать, что значок корневой папки может иметь наложение значка.</span><span class="sxs-lookup"><span data-stu-id="eaab4-161">Set this value to indicate that the root folder's icon can have an icon overlay.</span></span> <span data-ttu-id="eaab4-162">Объект folder должен поддерживать интерфейс [**ишелликоноверлай**](/windows/win32/api/shlobj_core/nn-shlobj_core-ishelliconoverlay) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-162">The folder object must support the [**IShellIconOverlay**](/windows/win32/api/shlobj_core/nn-shlobj_core-ishelliconoverlay) interface.</span></span> <span data-ttu-id="eaab4-163">Прежде чем в проводнике Windows отобразится значок корневой папки, он запросит значок оверлея, вызвав один из двух методов **ишелликоноверлай** с параметром *пидлитем* , для которого задано пустое значение Пидл.</span><span class="sxs-lookup"><span data-stu-id="eaab4-163">Before Windows Explorer displays the root folder's icon, it will request an overlay icon by calling one of the two **IShellIconOverlay** methods with *pidlItem* set to an empty PIDL.</span></span>

<span data-ttu-id="eaab4-164">Остальные значения и подразделы применяются ко всем расширениям:</span><span class="sxs-lookup"><span data-stu-id="eaab4-164">The remaining values and subkeys apply to all extensions:</span></span>

-   <span data-ttu-id="eaab4-165">Чтобы указать отображаемое имя папки точек соединения расширения, задайте в качестве значения по умолчанию для подраздела CLSID расширения соответствующую строку.</span><span class="sxs-lookup"><span data-stu-id="eaab4-165">To specify the display name of the extension's junction point folder, set the default value of the extension's CLSID subkey to an appropriate string.</span></span>
-   <span data-ttu-id="eaab4-166">Когда курсор наведен на папку, обычно отображается всплывающая подсказка, описывающая содержимое папки.</span><span class="sxs-lookup"><span data-stu-id="eaab4-166">When the cursor hovers over a folder, an infotip is typically displayed that describes the contents of the folder.</span></span> <span data-ttu-id="eaab4-167">Чтобы создать всплывающую подсказку для корневой папки расширения, создайте значение **реестра подсказки \_ SZ** для ключа CLSID расширения и задайте для него соответствующую строку.</span><span class="sxs-lookup"><span data-stu-id="eaab4-167">To provide an infotip for your extension's root folder, create an InfoTip **REG\_SZ** value for the extension's CLSID key, and set it to an appropriate string.</span></span>
-   <span data-ttu-id="eaab4-168">Чтобы указать пользовательский значок для корневой папки расширения, создайте подраздел в подразделе CLSID расширения с именем **дефаултикон**.</span><span class="sxs-lookup"><span data-stu-id="eaab4-168">To specify a custom icon for your extension's root folder, create a subkey of the extension's CLSID subkey named **DefaultIcon**.</span></span> <span data-ttu-id="eaab4-169">Присвойте параметру **дефаултикон** по умолчанию значение **reg \_ SZ** , содержащее имя файла, содержащего значок, за которым следует запятая, знак минус, а затем индекс значка в этом файле.</span><span class="sxs-lookup"><span data-stu-id="eaab4-169">Set the default value of **DefaultIcon** to a **REG\_SZ** value containing the name of the file that contains the icon, followed by a comma, followed by a minus sign, followed by the index of the icon in that file.</span></span>
-   <span data-ttu-id="eaab4-170">По умолчанию контекстное меню корневой папки расширения будет содержать элементы, определенные в **\_ \_ корневой \\ папке классов hKey**.</span><span class="sxs-lookup"><span data-stu-id="eaab4-170">By default, the shortcut menu of your extension's root folder will contain the items defined under **HKEY\_CLASSES\_ROOT\\Folder**.</span></span> <span data-ttu-id="eaab4-171">Элементы « **Удалить**», « **Переименовать**» и « **Свойства** » добавляются, если установлены соответствующие \_ Флаги сфгао XXX.</span><span class="sxs-lookup"><span data-stu-id="eaab4-171">The **Delete**, **Rename**, and **Properties** items are added if you have set the appropriate SFGAO\_XXX flags.</span></span> <span data-ttu-id="eaab4-172">Можно добавить другие элементы в контекстное меню корневой папки или переопределить существующие элементы так же, как и для [типа файла](fa-file-types.md).</span><span class="sxs-lookup"><span data-stu-id="eaab4-172">You can add other items to the root folder's shortcut menu, or override existing items, much as you would for a [file type](fa-file-types.md).</span></span> <span data-ttu-id="eaab4-173">Создайте подраздел **Shell** с ключом CLSID расширения и определите команды, как описано в разделе [расширение контекстных меню](context.md).</span><span class="sxs-lookup"><span data-stu-id="eaab4-173">Create a **Shell** subkey under the extension's CLSID key, and define commands as discussed in [Extending Shortcut Menus](context.md).</span></span>
-   <span data-ttu-id="eaab4-174">Если требуется более гибкий способ обработки контекстного меню корневой папки, можно реализовать [обработчик контекстного меню](context-menu-handlers.md).</span><span class="sxs-lookup"><span data-stu-id="eaab4-174">If you need a more flexible way to handle the root folder's shortcut menu, you can implement a [shortcut menu handler](context-menu-handlers.md).</span></span> <span data-ttu-id="eaab4-175">Чтобы зарегистрировать обработчик контекстного меню, создайте ключ **шеллекс** в ключе CLSID расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-175">To register the shortcut menu handler, create a **ShellEx** key under the extension's CLSID key.</span></span> <span data-ttu-id="eaab4-176">Зарегистрируйте CLSID обработчика так же, как для обычных [обработчиков расширения оболочки](handlers.md).</span><span class="sxs-lookup"><span data-stu-id="eaab4-176">Register the handler's CLSID as you would for a conventional [Creating Shell Extension Handlers](handlers.md).</span></span>
-   <span data-ttu-id="eaab4-177">Чтобы добавить страницу к странице свойств свойств корневой папки, присвойте папке атрибут **сфгао \_ хаспропшит** и реализуйте [обработчик страницы свойств](propsheet-handlers.md).</span><span class="sxs-lookup"><span data-stu-id="eaab4-177">To add a page to the root folder's Properties property sheet, give the folder the **SFGAO\_HASPROPSHEET** attribute and implement a [property sheet handler](propsheet-handlers.md).</span></span> <span data-ttu-id="eaab4-178">Чтобы зарегистрировать обработчик страницы свойств, создайте ключ **шеллекс** в ключе CLSID расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-178">To register the property sheet handler, create a **ShellEx** key under the extension's CLSID key.</span></span> <span data-ttu-id="eaab4-179">Зарегистрируйте CLSID обработчика так же, как для обычных [обработчиков расширения оболочки](handlers.md).</span><span class="sxs-lookup"><span data-stu-id="eaab4-179">Register the handler's CLSID as you would for a conventional [Creating Shell Extension Handlers](handlers.md).</span></span>
-   <span data-ttu-id="eaab4-180">Чтобы указать атрибуты корневой папки, добавьте подраздел **ShellFolder** в подраздел CLSID расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-180">To specify the attributes of the root folder, add a **ShellFolder** subkey to the extension's CLSID subkey.</span></span> <span data-ttu-id="eaab4-181">Создайте значение атрибута и задайте для него соответствующее сочетание флагов [**сфгао \_ xxx**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-181">Create an Attributes value, and set it to the appropriate combination of [**SFGAO\_XXX**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof) flags.</span></span>

<span data-ttu-id="eaab4-182">В следующей таблице перечислены некоторые часто используемые атрибуты для корневых папок.</span><span class="sxs-lookup"><span data-stu-id="eaab4-182">The following table lists some commonly used attributes for root folders.</span></span>



| <span data-ttu-id="eaab4-183">Флаг</span><span class="sxs-lookup"><span data-stu-id="eaab4-183">Flag</span></span>                | <span data-ttu-id="eaab4-184">Значение</span><span class="sxs-lookup"><span data-stu-id="eaab4-184">Value</span></span>      | <span data-ttu-id="eaab4-185">Описание</span><span class="sxs-lookup"><span data-stu-id="eaab4-185">Description</span></span>                                                                                                                                                                                                                                                                                                       |
|---------------------|------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="eaab4-186">\_Папка сфгао</span><span class="sxs-lookup"><span data-stu-id="eaab4-186">SFGAO\_FOLDER</span></span>       | <span data-ttu-id="eaab4-187">0x20000000</span><span class="sxs-lookup"><span data-stu-id="eaab4-187">0x20000000</span></span> | <span data-ttu-id="eaab4-188">Корневая папка расширения содержит один или несколько элементов.</span><span class="sxs-lookup"><span data-stu-id="eaab4-188">The extension's root folder contains one or more items.</span></span>                                                                                                                                                                                                                                                           |
| <span data-ttu-id="eaab4-189">СФГАО \_ хассубфолдер</span><span class="sxs-lookup"><span data-stu-id="eaab4-189">SFGAO\_HASSUBFOLDER</span></span> | <span data-ttu-id="eaab4-190">0x80000000</span><span class="sxs-lookup"><span data-stu-id="eaab4-190">0x80000000</span></span> | <span data-ttu-id="eaab4-191">Корневая папка расширения содержит одну или несколько вложенных папок.</span><span class="sxs-lookup"><span data-stu-id="eaab4-191">The extension's root folder contains one or more subfolders.</span></span> <span data-ttu-id="eaab4-192">Проводник Windows поместит знак «плюс» (+) рядом со значком папки.</span><span class="sxs-lookup"><span data-stu-id="eaab4-192">Windows Explorer will place a plus sign ( + ) next to the folder icon.</span></span>                                                                                                                                                                               |
| <span data-ttu-id="eaab4-193">СФГАО \_ канделете</span><span class="sxs-lookup"><span data-stu-id="eaab4-193">SFGAO\_CANDELETE</span></span>    | <span data-ttu-id="eaab4-194">0x00000020</span><span class="sxs-lookup"><span data-stu-id="eaab4-194">0x00000020</span></span> | <span data-ttu-id="eaab4-195">Пользователь может удалить корневую папку расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-195">The extension's root folder can be deleted by the user.</span></span> <span data-ttu-id="eaab4-196">Контекстное меню папки будет содержать элемент " **Удалить** ".</span><span class="sxs-lookup"><span data-stu-id="eaab4-196">The folder's shortcut menu will have a **Delete** item.</span></span> <span data-ttu-id="eaab4-197">Этот флаг должен быть установлен для точек соединения, размещенных в одной из [виртуальных папок](nse-junction.md).</span><span class="sxs-lookup"><span data-stu-id="eaab4-197">This flag should be set for junction points that are placed under one of the [virtual folders](nse-junction.md).</span></span>                                                                                 |
| <span data-ttu-id="eaab4-198">СФГАО \_ канренаме</span><span class="sxs-lookup"><span data-stu-id="eaab4-198">SFGAO\_CANRENAME</span></span>    | <span data-ttu-id="eaab4-199">0x00000010</span><span class="sxs-lookup"><span data-stu-id="eaab4-199">0x00000010</span></span> | <span data-ttu-id="eaab4-200">Пользователь может переименовать корневую папку расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-200">The extension's root folder can be renamed by the user.</span></span> <span data-ttu-id="eaab4-201">Контекстное меню папки будет содержать элемент **Rename** .</span><span class="sxs-lookup"><span data-stu-id="eaab4-201">The folder's shortcut menu will have a **Rename** item.</span></span>                                                                                                                                                                                                   |
| <span data-ttu-id="eaab4-202">СФГАО \_ хаспропшит</span><span class="sxs-lookup"><span data-stu-id="eaab4-202">SFGAO\_HASPROPSHEET</span></span> | <span data-ttu-id="eaab4-203">0x00000040</span><span class="sxs-lookup"><span data-stu-id="eaab4-203">0x00000040</span></span> | <span data-ttu-id="eaab4-204">В корневой папке расширения есть страница **свойств.**</span><span class="sxs-lookup"><span data-stu-id="eaab4-204">The extension's root folder has a **Properties** property sheet.</span></span> <span data-ttu-id="eaab4-205">Контекстное меню папки будет содержать элемент **Свойства** .</span><span class="sxs-lookup"><span data-stu-id="eaab4-205">The folder's shortcut menu will have a **Properties** item.</span></span> <span data-ttu-id="eaab4-206">Чтобы предоставить страницу свойств, необходимо реализовать [обработчик страницы свойств](propsheet-handlers.md).</span><span class="sxs-lookup"><span data-stu-id="eaab4-206">To provide the property sheet, you must implement a [property sheet handler](propsheet-handlers.md).</span></span> <span data-ttu-id="eaab4-207">Зарегистрируйте обработчик в ключе CLSID расширения, как обсуждалось ранее.</span><span class="sxs-lookup"><span data-stu-id="eaab4-207">Register the handler under the extension's CLSID key, as discussed previously.</span></span> |



 

<span data-ttu-id="eaab4-208">В следующем примере показана запись реестра CLSID для расширения с отображаемым именем Мекстенсион.</span><span class="sxs-lookup"><span data-stu-id="eaab4-208">The following example shows the CLSID registry entry for an extension with a display name of MyExtension.</span></span> <span data-ttu-id="eaab4-209">Расширение имеет пользовательский значок, содержащийся в библиотеке DLL расширения с индексом 1.</span><span class="sxs-lookup"><span data-stu-id="eaab4-209">The extension has a custom icon that is contained in the extension's DLL with an index of 1.</span></span> <span data-ttu-id="eaab4-210">Заданы атрибуты **\_ Папка сфгао**, **сфгао \_ хассубфолдер** и **сфгао \_ канделете** .</span><span class="sxs-lookup"><span data-stu-id="eaab4-210">The **SFGAO\_FOLDER**, **SFGAO\_HASSUBFOLDER**, and **SFGAO\_CANDELETE** attributes are set.</span></span>

```
HKEY_CLASSES_ROOT
   CLSID
      {Extension CLSID}
         (Default) = MyExtension
         InfoTip = Some appropriate text
      DefaultIcon
         (Default) = c:\MyDir\MyExtension.dll,-1
      InProcServer32
         (Default) = c:\MyDir\MyExtension.dll
         ThreadingModel = Apartment
      ShellFolder
         Attributes = 0xA00000020
```

## <a name="handling-pidls"></a><span data-ttu-id="eaab4-211">Обработка PIDL</span><span class="sxs-lookup"><span data-stu-id="eaab4-211">Handling PIDLs</span></span>

<span data-ttu-id="eaab4-212">Каждый элемент в пространстве имен Shell должен иметь уникальный ПИДЛ.</span><span class="sxs-lookup"><span data-stu-id="eaab4-212">Every item in the Shell namespace must have a unique PIDL.</span></span> <span data-ttu-id="eaab4-213">Проводник Windows назначает ПИДЛ корневой папке и передает значение в расширение во время инициализации.</span><span class="sxs-lookup"><span data-stu-id="eaab4-213">Windows Explorer assigns a PIDL to your root folder and passes the value to your extension during initialization.</span></span> <span data-ttu-id="eaab4-214">После этого расширение отвечает за назначение правильно сконструированного ПИДЛ для каждого из объектов и предоставление этих PIDL в проводнике Windows по запросу.</span><span class="sxs-lookup"><span data-stu-id="eaab4-214">Your extension is then responsible for assigning a properly constructed PIDL to each of its objects and providing those PIDLs to Windows Explorer on request.</span></span> <span data-ttu-id="eaab4-215">Если оболочка использует ПИДЛ для определения одного из объектов расширения, расширение должно иметь возможность интерпретировать ПИДЛ и определить конкретный объект.</span><span class="sxs-lookup"><span data-stu-id="eaab4-215">When the Shell uses a PIDL to identify one of your extension's objects, your extension must be able to interpret the PIDL and identify the particular object.</span></span> <span data-ttu-id="eaab4-216">Расширение должно также назначать каждому объекту [**Отображаемое имя**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-setnameof) и *имя анализа* .</span><span class="sxs-lookup"><span data-stu-id="eaab4-216">Your extension must also assign a [**display name**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-setnameof) and a *parsing name* to each object.</span></span> <span data-ttu-id="eaab4-217">Поскольку PIDL используются практически всеми интерфейсами папок, расширения обычно реализуют один *Пидл менеджер* для обработки всех этих задач.</span><span class="sxs-lookup"><span data-stu-id="eaab4-217">Because PIDLs are used by virtually every folder interface, extensions commonly implement a single *PIDL manager* to handle all these tasks.</span></span>

<span data-ttu-id="eaab4-218">Термин ПИДЛ является коротким для структуры [**итемидлист**](/windows/desktop/api/Shtypes/ns-shtypes-itemidlist) или указателя на такую структуру в зависимости от контекста.</span><span class="sxs-lookup"><span data-stu-id="eaab4-218">The term PIDL is short for an [**ITEMIDLIST**](/windows/desktop/api/Shtypes/ns-shtypes-itemidlist) structure or a pointer to such a structure, depending on context.</span></span> <span data-ttu-id="eaab4-219">Как объявлено, структура **итемидлист** имеет один элемент — структуру [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-219">As declared, an **ITEMIDLIST** structure has a single member, an [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure.</span></span> <span data-ttu-id="eaab4-220">Структура **итемидлист** объекта фактически является упакованным массивом из двух или более структур **шитемид** .</span><span class="sxs-lookup"><span data-stu-id="eaab4-220">An object's **ITEMIDLIST** structure is actually a packed array of two or more **SHITEMID** structures.</span></span> <span data-ttu-id="eaab4-221">Порядок этих структур определяет путь через пространство имен, точно так же, как c: \\ MyDirectory \\ MyFile определяет путь через файловую систему.</span><span class="sxs-lookup"><span data-stu-id="eaab4-221">The order of these structures defines a path through the namespace, in much the same way that c:\\MyDirectory\\MyFile defines a path through the file system.</span></span> <span data-ttu-id="eaab4-222">Как правило, ПИДЛ объекта состоит из ряда структур **шитемид** , которые соответствуют папкам, определяющим путь к пространству имен, за которым следует структура **шитемид** объекта, за которым следует признак конца.</span><span class="sxs-lookup"><span data-stu-id="eaab4-222">Typically, an object's PIDL will consist of a series of **SHITEMID** structures that correspond to the folders that define the namespace path, followed by the object's **SHITEMID** structure, followed by a terminator.</span></span>

<span data-ttu-id="eaab4-223">Признаком конца является структура [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) , в которой для элемента *CB* задано **значение NULL**.</span><span class="sxs-lookup"><span data-stu-id="eaab4-223">The terminator is an [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure, with the *cb* member set to **NULL**.</span></span> <span data-ttu-id="eaab4-224">Признак конца необходим, поскольку количество структур **шитемид** в Пидл объекта зависит от расположения объекта в пространстве имен оболочки и начальной точки пути.</span><span class="sxs-lookup"><span data-stu-id="eaab4-224">The terminator is necessary because the number of **SHITEMID** structures in an object's PIDL depends on the location of the object in the Shell namespace, and the starting point of the path.</span></span> <span data-ttu-id="eaab4-225">Кроме того, размер различных структур **шитемид** может быть различным.</span><span class="sxs-lookup"><span data-stu-id="eaab4-225">In addition, the size of the various **SHITEMID** structures can vary.</span></span> <span data-ttu-id="eaab4-226">Когда вы получаете ПИДЛ, нет простого способа определить его размер или даже общее число структур **шитемид** .</span><span class="sxs-lookup"><span data-stu-id="eaab4-226">When you receive a PIDL, you have no simple way of determining its size or even the total number of **SHITEMID** structures.</span></span> <span data-ttu-id="eaab4-227">Вместо этого необходимо «пройти» упакованный массив, структура по структуре, пока не дойдет до конца.</span><span class="sxs-lookup"><span data-stu-id="eaab4-227">Instead, you must "walk" the packed array, structure by structure, until you reach the terminator.</span></span>

<span data-ttu-id="eaab4-228">Чтобы создать ПИДЛ, приложение должно выполнить следующие действия:</span><span class="sxs-lookup"><span data-stu-id="eaab4-228">To create a PIDL, your application needs to:</span></span>

1.  <span data-ttu-id="eaab4-229">Создайте структуру [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) для каждого из своих объектов.</span><span class="sxs-lookup"><span data-stu-id="eaab4-229">Create an [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure for each of its objects.</span></span>
2.  <span data-ttu-id="eaab4-230">Соберите соответствующие структуры [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) в Пидл.</span><span class="sxs-lookup"><span data-stu-id="eaab4-230">Assemble the relevant [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structures into a PIDL.</span></span>

### <a name="creating-an-shitemid-structure"></a><span data-ttu-id="eaab4-231">Создание структуры ШИТЕМИД</span><span class="sxs-lookup"><span data-stu-id="eaab4-231">Creating an SHITEMID Structure</span></span>

<span data-ttu-id="eaab4-232">Структура [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) объекта однозначно определяет объект в его папке.</span><span class="sxs-lookup"><span data-stu-id="eaab4-232">An object's [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure uniquely identifies the object within its folder.</span></span> <span data-ttu-id="eaab4-233">Фактически, тип ПИДЛ, используемый многими методами [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) , состоит только из структуры **шитемид** объекта, за которой следует признак конца.</span><span class="sxs-lookup"><span data-stu-id="eaab4-233">In fact, a type of PIDL used by many of the [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) methods consists of just the object's **SHITEMID** structure, followed by a terminator.</span></span> <span data-ttu-id="eaab4-234">Определение структуры **шитемид** :</span><span class="sxs-lookup"><span data-stu-id="eaab4-234">The definition of an **SHITEMID** structure is:</span></span>


```C++
typedef struct _SHITEMID { 
    USHORT cb; 
    BYTE   abID[1]; 
} SHITEMID, * LPSHITEMID;
```



<span data-ttu-id="eaab4-235">Элемент *Абид* является идентификатором объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-235">The *abID* member is the object's identifier.</span></span> <span data-ttu-id="eaab4-236">Так как длина *Абид* не определена и может варьироваться, для элемента *CB* задается размер структуры [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) в байтах.</span><span class="sxs-lookup"><span data-stu-id="eaab4-236">Because the length of *abID* is not defined and can vary, the *cb* member is set to the size of the [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure, in bytes.</span></span>

<span data-ttu-id="eaab4-237">Поскольку ни длина, ни содержимое *Абид* не стандартизированы, можно использовать любую схему, которой требуется назначить значения *Абид* для объектов.</span><span class="sxs-lookup"><span data-stu-id="eaab4-237">Because neither the length nor the content of *abID* is standardized, you can use any scheme you want to assign *abID* values to your objects.</span></span> <span data-ttu-id="eaab4-238">Единственное требование заключается в том, что у вас не может быть двух объектов в одной папке с одинаковыми значениями.</span><span class="sxs-lookup"><span data-stu-id="eaab4-238">The only requirement is that you cannot have two objects in the same folder with identical values.</span></span> <span data-ttu-id="eaab4-239">Однако по соображениям производительности структура [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) должна быть выровняйтеся с помощью **параметра DWORD**.</span><span class="sxs-lookup"><span data-stu-id="eaab4-239">However, for performance reasons, your [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure should be **DWORD**-aligned.</span></span> <span data-ttu-id="eaab4-240">Иными словами, следует создать значения *Абид* таким образом, чтобы *CB* был целым числом, кратным 4.</span><span class="sxs-lookup"><span data-stu-id="eaab4-240">In other words, you should construct your *abID* values such that *cb* is an integral multiple of 4.</span></span>

<span data-ttu-id="eaab4-241">Как правило, *Абид* указывает на структуру, определенную расширением.</span><span class="sxs-lookup"><span data-stu-id="eaab4-241">Typically, *abID* points to an extension-defined structure.</span></span> <span data-ttu-id="eaab4-242">В дополнение к ИДЕНТИФИКАТОРу объекта Эта структура часто используется для хранения разнообразных связанных данных, например типа или атрибутов объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-242">In addition to the object's ID, this structure is often used to hold a variety of related information, such as the object's type or attributes.</span></span> <span data-ttu-id="eaab4-243">Затем объекты папки расширения могут быстро извлекать данные из ПИДЛ, а не запрашивать их.</span><span class="sxs-lookup"><span data-stu-id="eaab4-243">Your extension's folder objects can then quickly extract the information from the PIDL instead of having to query for it.</span></span>

> [!Note]  
> <span data-ttu-id="eaab4-244">Одним из наиболее важных аспектов разработки структуры данных для ПИДЛ является обеспечение возможности сохранения и передачи структуры.</span><span class="sxs-lookup"><span data-stu-id="eaab4-244">One of the most important aspects of designing a data structure for a PIDL is to make the structure persistable and transportable.</span></span> <span data-ttu-id="eaab4-245">В контексте PIDL смысл этих терминов:</span><span class="sxs-lookup"><span data-stu-id="eaab4-245">In the context of PIDLs, the meaning of these terms is:</span></span>
>
> -   <span data-ttu-id="eaab4-246">Восстанавливаемого.</span><span class="sxs-lookup"><span data-stu-id="eaab4-246">Persistable.</span></span> <span data-ttu-id="eaab4-247">Система часто помещает PIDL в различные типы долгосрочного хранения, например файлы ярлыков.</span><span class="sxs-lookup"><span data-stu-id="eaab4-247">The system frequently places PIDLs in various types of long-term storage, such as shortcut files.</span></span> <span data-ttu-id="eaab4-248">Затем он может восстановить эти PIDL из хранилища позже, возможно, после перезагрузки системы.</span><span class="sxs-lookup"><span data-stu-id="eaab4-248">It can then recover these PIDLs from storage later, possibly after the system has been rebooted.</span></span> <span data-ttu-id="eaab4-249">ПИДЛ, который был восстановлен из хранилища, должен быть допустимым и осмысленным для вашего расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-249">A PIDL that has been recovered from storage must still be valid and meaningful to your extension.</span></span> <span data-ttu-id="eaab4-250">Это требование означает, например, что не следует использовать указатели или дескрипторы в структуре ПИДЛ.</span><span class="sxs-lookup"><span data-stu-id="eaab4-250">This requirement means, for instance, that you should not use pointers or handles in your PIDL structure.</span></span> <span data-ttu-id="eaab4-251">PIDL, содержащие данные такого типа, обычно не имеют смысла, когда система впоследствии восстанавливает их из хранилища.</span><span class="sxs-lookup"><span data-stu-id="eaab4-251">PIDLs containing this type of data will normally be meaningless when the system later recovers them from storage.</span></span>
> -   <span data-ttu-id="eaab4-252">Переносимыми.</span><span class="sxs-lookup"><span data-stu-id="eaab4-252">Transportable.</span></span> <span data-ttu-id="eaab4-253">ПИДЛ должен оставаться осмысленным при переносе с одного компьютера на другой.</span><span class="sxs-lookup"><span data-stu-id="eaab4-253">A PIDL must remain meaningful when transported from one computer to another.</span></span> <span data-ttu-id="eaab4-254">Например, ПИДЛ можно записать в файл ярлыка, скопировать на гибкий диск и перенести на другой компьютер.</span><span class="sxs-lookup"><span data-stu-id="eaab4-254">For example, a PIDL can be written to a shortcut file, copied to a floppy disk, and transported to another computer.</span></span> <span data-ttu-id="eaab4-255">Это ПИДЛ должно быть осмысленным для вашего расширения, работающего на втором компьютере.</span><span class="sxs-lookup"><span data-stu-id="eaab4-255">That PIDL should still be meaningful to your extension running on the second computer.</span></span> <span data-ttu-id="eaab4-256">Например, чтобы обеспечить возможность передачи PIDL, используйте явные символы ANSI или Unicode.</span><span class="sxs-lookup"><span data-stu-id="eaab4-256">For instance, to ensure that your PIDLs are transportable, use either ANSI or Unicode characters explicitly.</span></span> <span data-ttu-id="eaab4-257">Избегайте таких типов данных, как **TCHAR** или **LPTSTR**.</span><span class="sxs-lookup"><span data-stu-id="eaab4-257">Avoid data types such as **TCHAR** or **LPTSTR**.</span></span> <span data-ttu-id="eaab4-258">Если вы используете эти типы данных, ПИДЛ, созданный на компьютере с версией Юникод расширения, не будет читаться с помощью ANSI-версии этого расширения, работающего на другом компьютере.</span><span class="sxs-lookup"><span data-stu-id="eaab4-258">If you use those data types, a PIDL created on a computer running a Unicode version of your extension will not be readable by an ANSI version of that extension running on a different computer.</span></span>

 

<span data-ttu-id="eaab4-259">В следующем объявлении показан простой пример структуры данных.</span><span class="sxs-lookup"><span data-stu-id="eaab4-259">The following declaration shows a simple example of a data structure.</span></span>


```C++
typedef struct tagMYPIDLDATA {
  USHORT cb;
  DWORD dwType;
  WCHAR wszDisplayName[40];
} MYPIDLDATA, *LPMYPIDLDATA;
```



<span data-ttu-id="eaab4-260">Для элемента **CB** задается размер структуры **мипидлдата** .</span><span class="sxs-lookup"><span data-stu-id="eaab4-260">The **cb** member is set to the size of the **MYPIDLDATA** structure.</span></span> <span data-ttu-id="eaab4-261">Этот член делает **мипидлдата** допустимой структурой [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) в и самой.</span><span class="sxs-lookup"><span data-stu-id="eaab4-261">This member makes **MYPIDLDATA** a valid [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure, in and of itself.</span></span> <span data-ttu-id="eaab4-262">Остальные члены эквивалентны элементу **Абид** структуры **шитемид** и содержат закрытые данные.</span><span class="sxs-lookup"><span data-stu-id="eaab4-262">The rest of the members are equivalent to the **abID** member of an **SHITEMID** structure and hold private data.</span></span> <span data-ttu-id="eaab4-263">Элемент **двтипе** является определяемым расширением значением, указывающим тип объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-263">The **dwType** member is an extension-defined value that indicates the type of object.</span></span> <span data-ttu-id="eaab4-264">В этом примере **двтипе** имеет значение **true** для папок и **false** в противном случае.</span><span class="sxs-lookup"><span data-stu-id="eaab4-264">For this example, **dwType** is set to **TRUE** for folders and **FALSE** otherwise.</span></span> <span data-ttu-id="eaab4-265">Этот член позволяет, например, быстро определить, является ли объект папкой.</span><span class="sxs-lookup"><span data-stu-id="eaab4-265">This member allows you, for instance, to quickly determine whether the object is a folder or not.</span></span> <span data-ttu-id="eaab4-266">Элемент **всздисплайнаме** содержит отображаемое имя объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-266">The **wszDisplayName** member contains the object's display name.</span></span> <span data-ttu-id="eaab4-267">Так как вы не назначите одно и то же отображаемое имя двум разным объектам в одной и той же папке, отображаемое имя также будет служить ИДЕНТИФИКАТОРом объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-267">Since you would not assign the same display name to two different objects in the same folder, the display name also serves as the object ID.</span></span> <span data-ttu-id="eaab4-268">В этом примере для **всздисплайнаме** задано значение 40 символов, чтобы гарантировать, что структура **шитемид** будет выставляться по **двойному** алфавиту.</span><span class="sxs-lookup"><span data-stu-id="eaab4-268">In this example, **wszDisplayName** is set to 40 characters to guarantee that the **SHITEMID** structure will be **DWORD**-aligned.</span></span> <span data-ttu-id="eaab4-269">Чтобы ограничить размер PIDL, вместо этого можно использовать массив символов переменной длины и соответствующим образом настроить значение CB.</span><span class="sxs-lookup"><span data-stu-id="eaab4-269">To limit the size of your PIDLs, you can instead use a variable-length character array and adjust the value of cb accordingly.</span></span> <span data-ttu-id="eaab4-270">Выведите отображаемую строку с достаточным количеством \\ символов "0" для поддержки выравнивания **DWORD** структуры.</span><span class="sxs-lookup"><span data-stu-id="eaab4-270">Pad the display string with enough '\\0' characters to maintain the structure's **DWORD** alignment.</span></span> <span data-ttu-id="eaab4-271">Другие члены, которые могут быть полезны для размещения структуры, включают размер, атрибуты или имя синтаксического анализа объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-271">Other members that might be useful to put in the structure include the object's size, attributes, or parsing name.</span></span>

### <a name="constructing-a-pidl"></a><span data-ttu-id="eaab4-272">Создание ПИДЛ</span><span class="sxs-lookup"><span data-stu-id="eaab4-272">Constructing a PIDL</span></span>

<span data-ttu-id="eaab4-273">После определения структур [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) для объектов их можно использовать для создания Пидл.</span><span class="sxs-lookup"><span data-stu-id="eaab4-273">Once you have defined [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structures for your objects, you can then use them to construct a PIDL.</span></span> <span data-ttu-id="eaab4-274">PIDL может быть сконструирован для различных целей, но большинство задач используют один из двух типов ПИДЛ.</span><span class="sxs-lookup"><span data-stu-id="eaab4-274">PIDLs can be constructed for a variety of purposes, but most tasks use one of two types of PIDL.</span></span> <span data-ttu-id="eaab4-275">Простейший одноуровневый ПИДЛ определяет объект относительно его родительской папки.</span><span class="sxs-lookup"><span data-stu-id="eaab4-275">The simplest, a single-level PIDL, identifies the object relative to its parent folder.</span></span> <span data-ttu-id="eaab4-276">Этот тип ПИДЛ используется многими методами [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-276">This type of PIDL is used by many of the [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) methods.</span></span> <span data-ttu-id="eaab4-277">Одноуровневая ПИДЛ содержит структуру **шитемид** объекта, за которой следует признак конца.</span><span class="sxs-lookup"><span data-stu-id="eaab4-277">A single-level PIDL contains the object's **SHITEMID** structure, followed by a terminator.</span></span> <span data-ttu-id="eaab4-278">Полный ПИДЛ определяет путь через иерархию пространства имен от рабочего стола к объекту.</span><span class="sxs-lookup"><span data-stu-id="eaab4-278">A fully qualified PIDL defines a path through the namespace hierarchy from the desktop to the object.</span></span> <span data-ttu-id="eaab4-279">Этот тип ПИДЛ начинается на рабочем столе и содержит одну структуру **шитемид** для каждой папки в пути, за которой следует объект и признак конца.</span><span class="sxs-lookup"><span data-stu-id="eaab4-279">This type of PIDL starts at the desktop and contains one **SHITEMID** structure for each folder in the path, followed by the object and the terminator.</span></span> <span data-ttu-id="eaab4-280">Полный ПИДЛ уникально идентифицирует объект во всем пространстве имен оболочки.</span><span class="sxs-lookup"><span data-stu-id="eaab4-280">A fully qualified PIDL uniquely identifies the object within the entire Shell namespace.</span></span>

<span data-ttu-id="eaab4-281">Самый простой способ создать ПИДЛ — работать непосредственно с самой структурой [**итемидлист**](/windows/desktop/api/Shtypes/ns-shtypes-itemidlist) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-281">The simplest way to construct a PIDL is to work directly with the [**ITEMIDLIST**](/windows/desktop/api/Shtypes/ns-shtypes-itemidlist) structure itself.</span></span> <span data-ttu-id="eaab4-282">Создайте структуру **итемидлист** , но выделите достаточно памяти для хранения всех структур [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-282">Create an **ITEMIDLIST** structure, but allocate enough memory to hold all the [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structures.</span></span> <span data-ttu-id="eaab4-283">Адрес этой структуры будет указывать на начальную структуру **шитемид** .</span><span class="sxs-lookup"><span data-stu-id="eaab4-283">The address of this structure will point to the initial **SHITEMID** structure.</span></span> <span data-ttu-id="eaab4-284">Определите значения для элементов этой начальной структуры, а затем добавьте столько дополнительных структур **шитемид** , сколько необходимо, в соответствующем порядке.</span><span class="sxs-lookup"><span data-stu-id="eaab4-284">Define values for the members of this initial structure, and then append as many additional **SHITEMID** structures as you need, in the appropriate order.</span></span> <span data-ttu-id="eaab4-285">В следующей процедуре показано, как создать одноуровневое ПИДЛ.</span><span class="sxs-lookup"><span data-stu-id="eaab4-285">The following procedure outlines how to create a single-level PIDL.</span></span> <span data-ttu-id="eaab4-286">Он содержит две структуры **шитемид** — структуру **мипидлдата** , за которой следует признак конца:</span><span class="sxs-lookup"><span data-stu-id="eaab4-286">It contains two **SHITEMID** structures—a **MYPIDLDATA** structure followed by a terminator:</span></span>

1.  <span data-ttu-id="eaab4-287">Используйте функцию [**CoTaskMemAlloc**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemalloc) , чтобы выделить память для Пидл.</span><span class="sxs-lookup"><span data-stu-id="eaab4-287">Use the [**CoTaskMemAlloc**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemalloc) function to allocate memory for the PIDL.</span></span> <span data-ttu-id="eaab4-288">Выделите в качестве терминатора достаточно памяти для личных данных и **UShort** (2 байта).</span><span class="sxs-lookup"><span data-stu-id="eaab4-288">Allocate enough memory for your private data plus a **USHORT** (two bytes) for the terminator.</span></span> <span data-ttu-id="eaab4-289">Приведите результат к ЛПМИПИДЛДАТА.</span><span class="sxs-lookup"><span data-stu-id="eaab4-289">Cast the result to LPMYPIDLDATA.</span></span>
2.  <span data-ttu-id="eaab4-290">Задайте для элемента CB первой структуры **мипидлдата** размер этой структуры.</span><span class="sxs-lookup"><span data-stu-id="eaab4-290">Set the cb member of the first **MYPIDLDATA** structure to the size of that structure.</span></span> <span data-ttu-id="eaab4-291">В этом примере для параметра **CB** задается значение sizeof (мипидлдата).</span><span class="sxs-lookup"><span data-stu-id="eaab4-291">For this example, you would set **cb** to sizeof(MYPIDLDATA).</span></span> <span data-ttu-id="eaab4-292">Если вы хотите использовать структуру переменной длины, вам потребуется вычислить значение **CB**.</span><span class="sxs-lookup"><span data-stu-id="eaab4-292">If you want to use a variable-length structure, you will have to calculate the value of **cb**.</span></span>
3.  <span data-ttu-id="eaab4-293">Присвойте соответствующие значения закрытым элементам данных.</span><span class="sxs-lookup"><span data-stu-id="eaab4-293">Assign appropriate values to the private data members.</span></span>
4.  <span data-ttu-id="eaab4-294">Вычислите адрес следующей структуры [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-294">Calculate the address of the next [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure.</span></span> <span data-ttu-id="eaab4-295">Приведите адрес текущей структуры МИПИДЛДАТА к LPBYTE и добавьте это значение в значение **CB** , определенное на шаге 3.</span><span class="sxs-lookup"><span data-stu-id="eaab4-295">Cast the address of the current MYPIDLDATA structure to LPBYTE, and add that value to the value of **cb** determined in step 3.</span></span>
5.  <span data-ttu-id="eaab4-296">В этом случае следующая [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) структура — это признак конца.</span><span class="sxs-lookup"><span data-stu-id="eaab4-296">In this case, the next [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure is the terminator.</span></span> <span data-ttu-id="eaab4-297">Присвойте элементу **CB** структуры значение 0.</span><span class="sxs-lookup"><span data-stu-id="eaab4-297">Set the structure's **cb** member to zero.</span></span>

<span data-ttu-id="eaab4-298">Для более длительного PIDL выделите достаточно памяти и повторите шаги 3-5 для каждой дополнительной структуры [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-298">For longer PIDLs, allocate sufficient memory and repeat steps 3-5 for each additional [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure.</span></span>

<span data-ttu-id="eaab4-299">Следующий пример функции принимает тип и отображаемое имя объекта и возвращает одноуровневый ПИДЛ объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-299">The following sample function takes an object's type and display name and returns the object's single-level PIDL.</span></span> <span data-ttu-id="eaab4-300">Функция предполагает, что отображаемое имя, включая завершающий **нуль** символ, не превышает число символов, объявленных для структуры **мипидлдата** .</span><span class="sxs-lookup"><span data-stu-id="eaab4-300">The function assumes that the display name, including its terminating **null** character, does not exceed the number of characters declared for the **MYPIDLDATA** structure.</span></span> <span data-ttu-id="eaab4-301">Если это допущено к ошибке, функция [**стрингкбкопив**](/windows/win32/api/strsafe/nf-strsafe-stringcbcopya) усекает отображаемое имя.</span><span class="sxs-lookup"><span data-stu-id="eaab4-301">If that assumption turns out to be erroneous, the [**StringCbCopyW**](/windows/win32/api/strsafe/nf-strsafe-stringcbcopya) function will truncate the display name.</span></span> <span data-ttu-id="eaab4-302">Переменная **g \_ пмаллок** — [**это указатель,**](/windows/win32/api/objidlbase/nn-objidlbase-imalloc) созданный в других местах и хранящийся в глобальной переменной.</span><span class="sxs-lookup"><span data-stu-id="eaab4-302">The **g\_pMalloc** variable is an [**IMalloc**](/windows/win32/api/objidlbase/nn-objidlbase-imalloc) pointer created elsewhere and stored in a global variable.</span></span>


```C++
LPITEMIDLIST CreatePIDL(DWORD dwType, LPCWSTR pwszDisplayName)
{
    LPMYPIDLDATA   pidlOut;
    USHORT         uSize;

    pidlOut = NULL;

    //Calculate the size of the MYPIDLDATA structure.
    uSize = sizeof(MYPIDLDATA);

    // Allocate enough memory for the PIDL to hold a MYPIDLDATA structure 
    // plus the terminator
    pidlOut = (LPMYPIDLDATA)m_pMalloc->Alloc(uSize + sizeof(USHORT));

    if(pidlOut)
    {
       //Assign values to the members of the MYPIDLDATA structure
       //that is the PIDL's first SHITEMID structure
       pidlOut->cb = uSize;
       pidlOut->dwType = dwType;
       hr = StringCbCopyW(pidlOut->wszDisplayName, 
                          sizeof(pidlOut->wszDisplayName), pwszDisplayName);
       
       // TODO: Add error handling here to verify the HRESULT returned 
       // by StringCbCopyW.

       //Advance the pointer to the start of the next SHITEMID structure.
       pidlOut = (LPMYPIDLDATA)((LPBYTE)pidlOut + pidlOut->cb);

       //Create the terminating null character by setting cb to 0.
       pidlOut->cb = 0;
    }

    return pidlOut;
```



<span data-ttu-id="eaab4-303">Полный ПИДЛ должен иметь структуры [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) для каждого объекта из рабочего стола в объект.</span><span class="sxs-lookup"><span data-stu-id="eaab4-303">A fully qualified PIDL must have [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structures for every object from the desktop to your object.</span></span> <span data-ttu-id="eaab4-304">Расширение получает полный ПИДЛ для корневой папки, когда оболочка вызывает [**иперсистфолдер:: Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipersistfolder-initialize).</span><span class="sxs-lookup"><span data-stu-id="eaab4-304">Your extension receives a fully qualified PIDL for your root folder when the Shell calls [**IPersistFolder::Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipersistfolder-initialize).</span></span> <span data-ttu-id="eaab4-305">Чтобы создать полное ПИДЛ для объекта, возьмите ПИДЛ, что оболочка присвоена корневой папке, и добавьте структуры **шитемид** , необходимые для перезаписи из корневой папки в объект.</span><span class="sxs-lookup"><span data-stu-id="eaab4-305">To construct a fully qualified PIDL for an object, take the PIDL that the Shell has assigned to your root folder, and append the **SHITEMID** structures that are needed to take you from the root folder to the object.</span></span>

### <a name="interpreting-pidls"></a><span data-ttu-id="eaab4-306">Интерпретация PIDL</span><span class="sxs-lookup"><span data-stu-id="eaab4-306">Interpreting PIDLs</span></span>

<span data-ttu-id="eaab4-307">Когда оболочка или приложение вызывает один из интерфейсов расширения для запроса сведений об объекте, он обычно определяет объект с помощью ПИДЛ.</span><span class="sxs-lookup"><span data-stu-id="eaab4-307">When the Shell or an application calls one of your extension's interfaces to request information about an object, it will usually identify the object by a PIDL.</span></span> <span data-ttu-id="eaab4-308">Некоторые методы, такие как [**ишеллфолдер:: жетуиобжектоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof), используют PIDL, которые относятся к родительской папке и просты для интерпретации.</span><span class="sxs-lookup"><span data-stu-id="eaab4-308">Some methods, such as [**IShellFolder::GetUIObjectOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof), use PIDLs that are relative to the parent folder and are straightforward to interpret.</span></span> <span data-ttu-id="eaab4-309">Однако расширение, вероятно, также будет иметь полный PIDL.</span><span class="sxs-lookup"><span data-stu-id="eaab4-309">However, your extension will probably also receive fully qualified PIDLs.</span></span> <span data-ttu-id="eaab4-310">Затем Диспетчер ПИДЛ должен определить, на какой из объектов, на который ссылается ПИДЛ.</span><span class="sxs-lookup"><span data-stu-id="eaab4-310">Your PIDL manager must then determine which of your objects that PIDL is referring to.</span></span>

<span data-ttu-id="eaab4-311">Что усложняет задачу связывания объекта с полным ПИДЛом, так как одна или несколько начальных структур [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) в Пидл могут принадлежать к объектам, находящимся за пределами расширения в пространстве имен Shell.</span><span class="sxs-lookup"><span data-stu-id="eaab4-311">What complicates the task of associating an object with a fully qualified PIDL is that one or more of the initial [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structures in the PIDL might belong to objects that lie outside your extension in the Shell namespace.</span></span> <span data-ttu-id="eaab4-312">У вас нет способа интерпретации значения элемента *Абид* этих структур.</span><span class="sxs-lookup"><span data-stu-id="eaab4-312">You have no way of interpreting the meaning of the *abID* member of those structures.</span></span> <span data-ttu-id="eaab4-313">Для расширения необходимо «пройти» по списку структур **шитемид** , пока не будет достигнута структура, соответствующая корневой папке.</span><span class="sxs-lookup"><span data-stu-id="eaab4-313">What your extension must do is to "walk" the list of **SHITEMID** structures, until you reach the structure that corresponds to your root folder.</span></span> <span data-ttu-id="eaab4-314">После этого вы узнаете, как интерпретировать информацию в структурах **шитемид** .</span><span class="sxs-lookup"><span data-stu-id="eaab4-314">From then on, you will know how to interpret the information in the **SHITEMID** structures.</span></span>

<span data-ttu-id="eaab4-315">Чтобы проанализировать ПИДЛ, возьмите первое значение *CB* и добавьте его в адрес Пидл, чтобы переместить указатель на начало следующей структуры [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-315">To walk the PIDL, take the first *cb* value and add it to the address of the PIDL to advance the pointer to the start of the next [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure.</span></span> <span data-ttu-id="eaab4-316">Затем он будет указывать на элемент *CB* этой структуры, который можно использовать, чтобы переместить указатель на начало следующей структуры **шитемид** и т. д.</span><span class="sxs-lookup"><span data-stu-id="eaab4-316">It then will be pointing to that structure's *cb* member, which you can use to advance the pointer to the start of the next **SHITEMID** structure, and so on.</span></span> <span data-ttu-id="eaab4-317">Каждый раз при перемещении указателя Проверьте структуру **шитемид** , чтобы определить, достигнут ли корень пространства имен расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-317">Each time you advance the pointer, examine the **SHITEMID** structure to determine whether you have reached the root of your extension's namespace.</span></span>

## <a name="implementing-the-primary-interfaces"></a><span data-ttu-id="eaab4-318">Реализация основных интерфейсов</span><span class="sxs-lookup"><span data-stu-id="eaab4-318">Implementing the Primary Interfaces</span></span>

<span data-ttu-id="eaab4-319">Как и для всех COM-объектов, реализация расширения в основном зависит от реализации коллекции интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="eaab4-319">As with all COM objects, implementing an extension is largely a matter of implementing a collection of interfaces.</span></span> <span data-ttu-id="eaab4-320">В этом разделе обсуждаются три основных интерфейса, которые должны быть реализованы всеми расширениями.</span><span class="sxs-lookup"><span data-stu-id="eaab4-320">This section discusses the three primary interfaces that must be implemented by all extensions.</span></span> <span data-ttu-id="eaab4-321">Они используются для инициализации и предоставляют проводнику Windows Основные сведения о содержимом расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-321">They are used for initialization and to provide Windows Explorer with basic information about the contents of the extension.</span></span> <span data-ttu-id="eaab4-322">Эти интерфейсы и [представление папок](../lwef/nse-folderview.md)являются обязательными для функционального расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-322">These interfaces, plus a [folder view](../lwef/nse-folderview.md), are all that is required for a functional extension.</span></span> <span data-ttu-id="eaab4-323">Однако, чтобы полностью использовать возможности проводника Windows, большинство расширений также реализуют один или несколько дополнительных интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="eaab4-323">However, to fully exploit the features of Windows Explorer, most extensions also implement one or more of the optional interfaces.</span></span>

### <a name="ipersistfolder-interface"></a><span data-ttu-id="eaab4-324">Интерфейс Иперсистфолдер</span><span class="sxs-lookup"><span data-stu-id="eaab4-324">IPersistFolder Interface</span></span>

<span data-ttu-id="eaab4-325">Интерфейс [**иперсистфолдер**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ipersistfolder) вызывается для инициализации нового объекта Folder.</span><span class="sxs-lookup"><span data-stu-id="eaab4-325">The [**IPersistFolder**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ipersistfolder) interface is called to initialize a new folder object.</span></span> <span data-ttu-id="eaab4-326">Метод [**иперсистфолдер:: Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipersistfolder-initialize) присваивает новому объекту полное имя Пидл.</span><span class="sxs-lookup"><span data-stu-id="eaab4-326">The [**IPersistFolder::Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipersistfolder-initialize) method assigns a fully qualified PIDL to the new object.</span></span> <span data-ttu-id="eaab4-327">Сохраните этот ПИДЛ для последующего использования.</span><span class="sxs-lookup"><span data-stu-id="eaab4-327">Store this PIDL for later use.</span></span> <span data-ttu-id="eaab4-328">Например, объект Folder должен использовать этот ПИДЛ для создания полного PIDL для дочерних объектов объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-328">For instance, a folder object must use this PIDL to construct fully qualified PIDLs for the object's children.</span></span> <span data-ttu-id="eaab4-329">Создатель объекта Folder также может вызвать [**IPersist::**](/windows/win32/api/objidl/nf-objidl-ipersist-getclassid) GetObject, чтобы запросить CLSID объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-329">The folder object's creator can also call [**IPersist::GetClassID**](/windows/win32/api/objidl/nf-objidl-ipersist-getclassid) to request the object's CLSID.</span></span>

<span data-ttu-id="eaab4-330">Как правило, объект Folder создается и инициализируется с помощью метода [**ишеллфолдер:: биндтубжект**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject) родительской папки.</span><span class="sxs-lookup"><span data-stu-id="eaab4-330">Typically, a folder object is created and initialized by its parent folder's [**IShellFolder::BindToObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject) method.</span></span> <span data-ttu-id="eaab4-331">Однако при просмотре пользователем расширения проводник Windows создает и инициализирует объект корневой папки расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-331">However, when a user browses into your extension, Windows Explorer creates and initializes the extension's root folder object.</span></span> <span data-ttu-id="eaab4-332">ПИДЛ, что объект корневой папки получает через [**иперсистфолдер:: Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipersistfolder-initialize) , содержит путь от рабочего стола к корневой папке, в которой потребуется создать полностью определенную PIDL для вашего расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-332">The PIDL that the root folder object receives through [**IPersistFolder::Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipersistfolder-initialize) contains the path from the desktop to the root folder that you will need to construct fully qualified PIDLs for your extension.</span></span>

### <a name="ishellfolder-interface"></a><span data-ttu-id="eaab4-333">Интерфейс Ишеллфолдер</span><span class="sxs-lookup"><span data-stu-id="eaab4-333">IShellFolder Interface</span></span>

<span data-ttu-id="eaab4-334">Оболочка обрабатывает расширение как иерархическую упорядоченную коллекцию объектов Folder.</span><span class="sxs-lookup"><span data-stu-id="eaab4-334">The Shell treats an extension as a hierarchically ordered collection of folder objects.</span></span> <span data-ttu-id="eaab4-335">Интерфейс [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) является ядром любой реализации расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-335">The [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface is the core of any extension implementation.</span></span> <span data-ttu-id="eaab4-336">Он представляет объект Folder и предоставляет проводнику Windows большую часть сведений, необходимых для просмотра содержимого папки.</span><span class="sxs-lookup"><span data-stu-id="eaab4-336">It represents a folder object and provides Windows Explorer with much of the information needed to display the contents of the folder.</span></span>

<span data-ttu-id="eaab4-337">[**Ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) обычно является единственным интерфейсом папок, отличным от [**иперсистфолдер**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ipersistfolder) , который напрямую предоставляется объектом Folder.</span><span class="sxs-lookup"><span data-stu-id="eaab4-337">[**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) is typically the only folder interface other than [**IPersistFolder**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ipersistfolder) that is directly exposed by a folder object.</span></span> <span data-ttu-id="eaab4-338">Хотя проводник Windows использует разнообразные обязательные и необязательные интерфейсы для получения сведений о содержимом папки, он получает указатели на эти интерфейсы через **ишеллфолдер**.</span><span class="sxs-lookup"><span data-stu-id="eaab4-338">While Windows Explorer uses a variety of required and optional interfaces to obtain information about the contents of the folder, it obtains pointers to those interfaces through **IShellFolder**.</span></span>

<span data-ttu-id="eaab4-339">Проводник Windows получает идентификатор CLSID корневой папки расширения различными способами.</span><span class="sxs-lookup"><span data-stu-id="eaab4-339">Windows Explorer obtains the CLSID of your extension's root folder in a variety of ways.</span></span> <span data-ttu-id="eaab4-340">Дополнительные сведения см. в разделе [Указание расположения расширения пространства имен](nse-junction.md) или [Отображение Self-Containedного представления расширения пространства имен](nse-view.md).</span><span class="sxs-lookup"><span data-stu-id="eaab4-340">For details, see [Specifying a Namespace Extension's Location](nse-junction.md) or [Displaying a Self-Contained View of a Namespace Extension](nse-view.md).</span></span> <span data-ttu-id="eaab4-341">Затем Проводник Windows использует этот идентификатор CLSID для создания и инициализации экземпляра корневой папки и запроса для интерфейса [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-341">Windows Explorer then uses that CLSID to create and initialize an instance of the root folder and query for an [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface.</span></span> <span data-ttu-id="eaab4-342">Расширение создает объект Folder для представления корневой папки и возвращает интерфейс **ишеллфолдер** объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-342">Your extension creates a folder object to represent the root folder and returns the object's **IShellFolder** interface.</span></span> <span data-ttu-id="eaab4-343">Большая часть оставшейся части взаимодействия между расширением и проводником Windows выполняется через **ишеллфолдер**.</span><span class="sxs-lookup"><span data-stu-id="eaab4-343">Much of the remainder of the interaction between your extension and Windows Explorer then takes place through **IShellFolder**.</span></span> <span data-ttu-id="eaab4-344">Проводник Windows вызывает **ишеллфолдер** в:</span><span class="sxs-lookup"><span data-stu-id="eaab4-344">Windows Explorer calls **IShellFolder** to:</span></span>

-   <span data-ttu-id="eaab4-345">Запросите объект, который может перечислить содержимое корневой папки.</span><span class="sxs-lookup"><span data-stu-id="eaab4-345">Request an object that can enumerate the contents of the root folder.</span></span>
-   <span data-ttu-id="eaab4-346">Получение различных типов сведений о содержимом корневой папки.</span><span class="sxs-lookup"><span data-stu-id="eaab4-346">Obtain various types of information about the contents of the root folder.</span></span>
-   <span data-ttu-id="eaab4-347">Запросите объект, предоставляющий один из дополнительных интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="eaab4-347">Request an object that exposes one of the optional interfaces.</span></span> <span data-ttu-id="eaab4-348">Затем эти интерфейсы могут быть запрошены для получения дополнительных сведений, таких как значки или контекстные меню.</span><span class="sxs-lookup"><span data-stu-id="eaab4-348">Those interfaces can then be queried for additional information, such as icons or shortcut menus.</span></span>
-   <span data-ttu-id="eaab4-349">Запросите объект папки, представляющий вложенную папку корневой папки.</span><span class="sxs-lookup"><span data-stu-id="eaab4-349">Request a folder object that represents a subfolder of the root folder.</span></span>

<span data-ttu-id="eaab4-350">Когда пользователь открывает вложенную папку корневой папки, проводник Windows вызывает [**ишеллфолдер:: биндтубжект**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject).</span><span class="sxs-lookup"><span data-stu-id="eaab4-350">When a user opens a subfolder of the root folder, Windows Explorer calls [**IShellFolder::BindToObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject).</span></span> <span data-ttu-id="eaab4-351">Расширение создает и инициализирует новый объект Folder, который представляет вложенную папку, и возвращает интерфейс [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-351">Your extension creates and initializes a new folder object to represent the subfolder and returns its [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface.</span></span> <span data-ttu-id="eaab4-352">После этого проводник Windows вызывает этот интерфейс для различных типов информации и так далее, пока пользователь не решит выполнить переход в другое место в пространстве имен оболочки или закрыть Проводник Windows.</span><span class="sxs-lookup"><span data-stu-id="eaab4-352">Windows Explorer then calls this interface for various types of information, and so on until the user decides to navigate elsewhere in the Shell namespace or close Windows Explorer.</span></span>

<span data-ttu-id="eaab4-353">В оставшейся части этого раздела кратко рассматриваются наиболее важные методы [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) и способы их реализации.</span><span class="sxs-lookup"><span data-stu-id="eaab4-353">The remainder of this section briefly discusses the more important [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) methods and how to implement them.</span></span>

### <a name="enumobjects"></a><span data-ttu-id="eaab4-354">енумобжектс</span><span class="sxs-lookup"><span data-stu-id="eaab4-354">EnumObjects</span></span>

<span data-ttu-id="eaab4-355">Перед отображением содержимого папки в представлении в виде дерева Обозреватель Windows должен сначала определить, что содержится в папке, вызвав метод [**ишеллфолдер:: енумобжектс**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-enumobjects) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-355">Before displaying the contents of a folder in the tree view, Windows Explorer must first determine what the folder contains by calling the [**IShellFolder::EnumObjects**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-enumobjects) method.</span></span> <span data-ttu-id="eaab4-356">Этот метод создает стандартный объект перечисления OLE, предоставляющий интерфейс [**иенумидлист**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) и возвращающий этот указатель интерфейса.</span><span class="sxs-lookup"><span data-stu-id="eaab4-356">This method creates a standard OLE enumeration object that exposes an [**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) interface and returns that interface pointer.</span></span> <span data-ttu-id="eaab4-357">Интерфейс **иенумидлист** позволяет проводнику Windows получить PIDL всех объектов, содержащихся в папке.</span><span class="sxs-lookup"><span data-stu-id="eaab4-357">The **IEnumIDList** interface allows Windows Explorer to obtain the PIDLs of all the objects contained by the folder.</span></span> <span data-ttu-id="eaab4-358">Затем эти PIDL используются для получения сведений об объектах, содержащихся в папке.</span><span class="sxs-lookup"><span data-stu-id="eaab4-358">These PIDLs are then used to obtain information about the objects contained by the folder.</span></span> <span data-ttu-id="eaab4-359">Дополнительные сведения см. в разделе [интерфейс иенумидлист](#ienumidlist-interface).</span><span class="sxs-lookup"><span data-stu-id="eaab4-359">For further details, see [IEnumIDList Interface](#ienumidlist-interface).</span></span>

> [!Note]  
> <span data-ttu-id="eaab4-360">Метод [**иенумидлист:: Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next) должен возвращать только PIDL, относящиеся к родительской папке.</span><span class="sxs-lookup"><span data-stu-id="eaab4-360">The [**IEnumIDList::Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next) method should only return PIDLs that are relative to the parent folder.</span></span> <span data-ttu-id="eaab4-361">ПИДЛ должен содержать только структуру [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) объекта, за которой следует признак конца.</span><span class="sxs-lookup"><span data-stu-id="eaab4-361">The PIDL should contain only the object's [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure, followed by a terminator.</span></span>

 

### <a name="createviewobject"></a><span data-ttu-id="eaab4-362">креатевиевобжект</span><span class="sxs-lookup"><span data-stu-id="eaab4-362">CreateViewObject</span></span>

<span data-ttu-id="eaab4-363">Перед отображением содержимого папки проводник Windows вызывает этот метод для запроса указателя на интерфейс [**ишеллвиев**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-363">Before the contents of a folder are displayed, Windows Explorer calls this method to request a pointer to an [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span> <span data-ttu-id="eaab4-364">Этот интерфейс используется проводником Windows для управления представлением папки.</span><span class="sxs-lookup"><span data-stu-id="eaab4-364">This interface is used by Windows Explorer to manage the folder view.</span></span> <span data-ttu-id="eaab4-365">Создайте объект представления папки и возвратите его интерфейс **ишеллвиев** .</span><span class="sxs-lookup"><span data-stu-id="eaab4-365">Create a folder view object and return its **IShellView** interface.</span></span>

<span data-ttu-id="eaab4-366">Метод [**ишеллфолдер:: креатевиевобжект**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) также вызывается для запроса одного из дополнительных интерфейсов, например [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu), для самой папки.</span><span class="sxs-lookup"><span data-stu-id="eaab4-366">The [**IShellFolder::CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) method is also called to request one of the optional interfaces, such as [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu), for the folder itself.</span></span> <span data-ttu-id="eaab4-367">Реализация этого метода должна создать объект, который предоставляет запрашиваемый интерфейс и возвращает указатель интерфейса.</span><span class="sxs-lookup"><span data-stu-id="eaab4-367">Your implementation of this method should create an object that exposes the requested interface and returns the interface pointer.</span></span> <span data-ttu-id="eaab4-368">Если проводнику Windows требуется необязательный интерфейс для одного из объектов, содержащихся в папке, он вызывает [**ишеллфолдер:: жетуиобжектоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof).</span><span class="sxs-lookup"><span data-stu-id="eaab4-368">If Windows Explorer needs an optional interface for one of the objects contained by the folder, it will call [**IShellFolder::GetUIObjectOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof).</span></span>

### <a name="getuiobjectof"></a><span data-ttu-id="eaab4-369">жетуиобжектоф</span><span class="sxs-lookup"><span data-stu-id="eaab4-369">GetUIObjectOf</span></span>

<span data-ttu-id="eaab4-370">Хотя основные сведения о содержимом папки доступны через методы [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) , расширение может также предоставлять проводнику Windows различные виды дополнительных сведений.</span><span class="sxs-lookup"><span data-stu-id="eaab4-370">While basic information about the contents of a folder is available through the [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) methods, your extension can also provide Windows Explorer with various kinds of additional information.</span></span> <span data-ttu-id="eaab4-371">Например, можно указать значки для содержимого папки или контекстного меню объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-371">For instance, you can specify icons for the contents of a folder or an object's shortcut menu.</span></span> <span data-ttu-id="eaab4-372">Проводник Windows вызывает метод [**ишеллфолдер:: жетуиобжектоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof) , чтобы попытаться получить дополнительные сведения об объекте, который содержится в папке.</span><span class="sxs-lookup"><span data-stu-id="eaab4-372">Windows Explorer calls the [**IShellFolder::GetUIObjectOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof) method to attempt to retrieve additional information about an object that is contained by a folder.</span></span> <span data-ttu-id="eaab4-373">Проводник Windows определяет, какой объект требуется для получения сведений, и идентификатор IID соответствующего интерфейса.</span><span class="sxs-lookup"><span data-stu-id="eaab4-373">Windows Explorer specifies which object it wants the information for, and the IID of the relevant interface.</span></span> <span data-ttu-id="eaab4-374">Затем объект Folder создает объект, предоставляющий запрошенный интерфейс, и возвращает указатель на интерфейс.</span><span class="sxs-lookup"><span data-stu-id="eaab4-374">The folder object then creates an object that exposes the requested interface and returns the interface pointer.</span></span>

<span data-ttu-id="eaab4-375">Если расширение позволяет пользователям передавать объекты с помощью перетаскивания или буфера обмена, проводник Windows вызывает [**ишеллфолдер:: жетуиобжектоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof) для запроса интерфейса [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) или [**интерфейс IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-375">If your extension allows users to transfer objects with drag-and-drop or the clipboard, Windows Explorer will call [**IShellFolder::GetUIObjectOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof) to request an [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) or [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span> <span data-ttu-id="eaab4-376">Дополнительные сведения см. [в разделе Передача объектов оболочки с помощью перетаскивания и буфера обмена](dragdrop.md).</span><span class="sxs-lookup"><span data-stu-id="eaab4-376">For details, see [Transferring Shell Objects with Drag-and-Drop and the Clipboard](dragdrop.md).</span></span>

<span data-ttu-id="eaab4-377">Проводник Windows вызывает [**ишеллфолдер:: креатевиевобжект**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) , когда ему требуется та же информация о самой папке.</span><span class="sxs-lookup"><span data-stu-id="eaab4-377">Windows Explorer calls [**IShellFolder::CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) when it wants the same sort of information about the folder itself.</span></span>

### <a name="bindtoobject"></a><span data-ttu-id="eaab4-378">биндтубжект</span><span class="sxs-lookup"><span data-stu-id="eaab4-378">BindToObject</span></span>

<span data-ttu-id="eaab4-379">Проводник Windows вызывает метод [**ишеллфолдер:: биндтубжект**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject) , когда пользователь пытается открыть одну из вложенных папок расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-379">Windows Explorer calls the [**IShellFolder::BindToObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject) method when a user attempts to open one of your extension's subfolders.</span></span> <span data-ttu-id="eaab4-380">Если для *riid* задано значение IID \_ ишеллфолдер, следует создать и инициализировать объект Folder, представляющий вложенную папку, и вернуть интерфейс [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-380">If *riid* is set to IID\_IShellFolder, you should create and initialize a folder object that represents the subfolder and return the object's [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface.</span></span>

> [!Note]  
> <span data-ttu-id="eaab4-381">В настоящее время проводник Windows вызывает этот метод только для запроса интерфейса [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-381">At present, Windows Explorer calls this method only to request an [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface.</span></span> <span data-ttu-id="eaab4-382">Однако не следует рассчитывать, что это всегда будет так.</span><span class="sxs-lookup"><span data-stu-id="eaab4-382">However, do not assume that this will always be the case.</span></span> <span data-ttu-id="eaab4-383">Перед продолжением всегда проверяйте значение *riid* .</span><span class="sxs-lookup"><span data-stu-id="eaab4-383">You should always check the value of *riid* before proceeding.</span></span>

 

### <a name="getdisplaynameof"></a><span data-ttu-id="eaab4-384">жетдисплайнамеоф</span><span class="sxs-lookup"><span data-stu-id="eaab4-384">GetDisplayNameOf</span></span>

<span data-ttu-id="eaab4-385">Проводник Windows вызывает метод [**ишеллфолдер:: жетдисплайнамеоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) для преобразования Пидл одного из объектов папки в имя.</span><span class="sxs-lookup"><span data-stu-id="eaab4-385">Windows Explorer calls the [**IShellFolder::GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) method to convert the PIDL of one of the folder's objects into a name.</span></span> <span data-ttu-id="eaab4-386">Этот ПИДЛ должен быть связан с родительской папкой объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-386">That PIDL must be relative to the object's parent folder.</span></span> <span data-ttu-id="eaab4-387">Иными словами, он должен содержать одну структуру [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) , не **равную NULL** .</span><span class="sxs-lookup"><span data-stu-id="eaab4-387">In other words, it must contain a single non-**NULL** [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure.</span></span> <span data-ttu-id="eaab4-388">Так как существует несколько возможных способов именования объектов, проводник Windows определяет тип имени, задав один или несколько флагов [**шгднф**](/windows/win32/api/shobjidl_core/ne-shobjidl_core-_shgdnf) в параметре *уфлагс* .</span><span class="sxs-lookup"><span data-stu-id="eaab4-388">Because there is more than one possible way to name objects, Windows Explorer specifies the type of name by setting one or more [**SHGDNF**](/windows/win32/api/shobjidl_core/ne-shobjidl_core-_shgdnf) flags in the *uFlags* parameter.</span></span> <span data-ttu-id="eaab4-389">Одно из двух значений, **шгдн \_ Обычная** или **шгдн \_**, будет задано, чтобы указать, должно ли имя относиться к папке или относительно рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="eaab4-389">One of two values, **SHGDN\_NORMAL** or **SHGDN\_INFOLDER**, will be set to specify whether the name should be relative to the folder or relative to the desktop.</span></span> <span data-ttu-id="eaab4-390">Одно из трех других значений, **шгдн \_ форедитинг**, **шгдн \_ фораддрессбар** или **шгдн \_ форпарсинг**, можно задать, чтобы указать, для чего будет использоваться имя.</span><span class="sxs-lookup"><span data-stu-id="eaab4-390">One of the other three values, **SHGDN\_FOREDITING**, **SHGDN\_FORADDRESSBAR**, or **SHGDN\_FORPARSING**, can be set to specify what the name will be used for.</span></span>

<span data-ttu-id="eaab4-391">Необходимо вернуть имя в виде структуры [**стррет**](/windows/desktop/api/Shtypes/ns-shtypes-strret) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-391">You must return the name in the form of an [**STRRET**](/windows/desktop/api/Shtypes/ns-shtypes-strret) structure.</span></span> <span data-ttu-id="eaab4-392">Если **шгдн \_ форедитинг**, **шгдн \_ фораддрессбар** и **шгдн \_ форпарсинг** не заданы, возвращается отображаемое имя объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-392">If **SHGDN\_FOREDITING**, **SHGDN\_FORADDRESSBAR**, and **SHGDN\_FORPARSING** are not set, return the object's display name.</span></span> <span data-ttu-id="eaab4-393">Если установлен флаг **шгдн \_ Форпарсинг** , проводник Windows запрашивает имя синтаксического анализа.</span><span class="sxs-lookup"><span data-stu-id="eaab4-393">If the **SHGDN\_FORPARSING** flag is set, Windows Explorer is requesting a parsing name.</span></span> <span data-ttu-id="eaab4-394">Синтаксический анализ имен передается в [**ишеллфолдер::P арседисплайнаме**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) для получения Пидл объекта, хотя он может располагаться на одном или нескольких уровнях ниже текущей папки в иерархии пространства имен.</span><span class="sxs-lookup"><span data-stu-id="eaab4-394">Parsing names are passed to [**IShellFolder::ParseDisplayName**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) to obtain an object's PIDL, even though it might be located one or more levels below the current folder in the namespace hierarchy.</span></span> <span data-ttu-id="eaab4-395">Например, имя синтаксического анализа объекта файловой системы — это путь к нему.</span><span class="sxs-lookup"><span data-stu-id="eaab4-395">For example, the parsing name of a file system object is its path.</span></span> <span data-ttu-id="eaab4-396">Полный путь к любому объекту в файловой системе можно передать в метод **ишеллфолдер::P арседисплайнаме** рабочего стола, и он вернет полное Пидл объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-396">You can pass the fully qualified path of any object in the file system to the desktop's **IShellFolder::ParseDisplayName** method, and it will return the object's fully qualified PIDL.</span></span>

<span data-ttu-id="eaab4-397">При синтаксическом анализе имен используются текстовые строки, они не обязательно должны включать отображаемое имя.</span><span class="sxs-lookup"><span data-stu-id="eaab4-397">While parsing names are text strings, they do not necessarily have to include the display name.</span></span> <span data-ttu-id="eaab4-398">Имена разбора следует назначать в зависимости от того, что будет работать наиболее эффективно при вызове [**ишеллфолдер::P арседисплайнаме**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-398">You should assign parsing names based on what will work most efficiently when [**IShellFolder::ParseDisplayName**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) is called.</span></span> <span data-ttu-id="eaab4-399">Например, многие из виртуальных папок оболочки не являются частью файловой системы и не имеют полного пути.</span><span class="sxs-lookup"><span data-stu-id="eaab4-399">For instance, many of the Shell's virtual folders are not part of the file system and do not have a fully qualified path.</span></span> <span data-ttu-id="eaab4-400">Вместо этого каждой папке назначается идентификатор GUID, а имя синтаксического анализа принимает вид:: {GUID}.</span><span class="sxs-lookup"><span data-stu-id="eaab4-400">Instead, each folder is assigned a GUID and the parsing name takes the form ::{GUID}.</span></span> <span data-ttu-id="eaab4-401">Независимо от используемой схемы, она должна иметь возможность надежного «кругового пути».</span><span class="sxs-lookup"><span data-stu-id="eaab4-401">Regardless of what scheme you use, it should be able to reliably "round trip."</span></span> <span data-ttu-id="eaab4-402">Например, если вызывающий объект передает имя синтаксического анализа в **ишеллфолдер::P арседисплайнаме** для получения Пидл объекта, а затем передает этот Пидл в [**Ишеллфолдер:: жетдисплайнамеоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) с установленным флагом **шгдн \_ форпарсинг** , вызывающий объект должен восстановить исходное имя анализа.</span><span class="sxs-lookup"><span data-stu-id="eaab4-402">For instance, if a caller passes a parsing name to **IShellFolder::ParseDisplayName** to retrieve an object's PIDL, and then passes that PIDL to [**IShellFolder::GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) with the **SHGDN\_FORPARSING** flag set, the caller should recover the original parsing name.</span></span>

### <a name="getattributesof"></a><span data-ttu-id="eaab4-403">жетаттрибутесоф</span><span class="sxs-lookup"><span data-stu-id="eaab4-403">GetAttributesOf</span></span>

<span data-ttu-id="eaab4-404">Проводник Windows вызывает метод [**ишеллфолдер:: жетаттрибутесоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof) для определения атрибутов одного или нескольких элементов, содержащихся в объекте Folder.</span><span class="sxs-lookup"><span data-stu-id="eaab4-404">Windows Explorer calls the [**IShellFolder::GetAttributesOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof) method to determine the attributes of one or more items contained by a folder object.</span></span> <span data-ttu-id="eaab4-405">Значение *Цидл* задает количество элементов в запросе, а *апидл* указывает на список их PIDL.</span><span class="sxs-lookup"><span data-stu-id="eaab4-405">The value of *cidl* gives the number of items in the query, and *aPidl* points to a list of their PIDLs.</span></span>

<span data-ttu-id="eaab4-406">Поскольку тестирование некоторых атрибутов может занимать много времени, проводник Windows обычно определяет запрос до подмножества доступных флагов, устанавливая их значения в *рфгинаут*.</span><span class="sxs-lookup"><span data-stu-id="eaab4-406">Because testing for some attributes can be time consuming, Windows Explorer typically restricts the query to a subset of the available flags by setting their values in *rfgInOut*.</span></span> <span data-ttu-id="eaab4-407">Метод должен проверять только те атрибуты, флаги которых установлены в *рфгинаут*.</span><span class="sxs-lookup"><span data-stu-id="eaab4-407">Your method should test for only those attributes whose flags are set in *rfgInOut*.</span></span> <span data-ttu-id="eaab4-408">Оставьте допустимыми установленные флаги и очистите остаток.</span><span class="sxs-lookup"><span data-stu-id="eaab4-408">Leave the valid flags set and clear the remainder.</span></span> <span data-ttu-id="eaab4-409">Если в запрос включено более одного элемента, установите только те флаги, которые применяются ко всем элементам.</span><span class="sxs-lookup"><span data-stu-id="eaab4-409">If more than one item is included in the query, set only those flags that apply to all items.</span></span>

> [!Note]  
> <span data-ttu-id="eaab4-410">Для правильного отображения элемента должны быть правильно заданы атрибуты.</span><span class="sxs-lookup"><span data-stu-id="eaab4-410">The attributes must be properly set for an item to be correctly displayed.</span></span> <span data-ttu-id="eaab4-411">Например, если элемент является папкой, содержащей вложенные папки, необходимо установить флаг **сфгао \_ хассубфолдер** .</span><span class="sxs-lookup"><span data-stu-id="eaab4-411">For instance, if an item is a folder that contains subfolders, you must set the **SFGAO\_HASSUBFOLDER** flag.</span></span> <span data-ttu-id="eaab4-412">В противном случае в проводнике Windows не будет отображаться значок + рядом с значком элемента в представлении в виде дерева.</span><span class="sxs-lookup"><span data-stu-id="eaab4-412">Otherwise, Windows Explorer will not display a + next to the item's icon in the tree view.</span></span>

 

### <a name="parsedisplayname"></a><span data-ttu-id="eaab4-413">парседисплайнаме</span><span class="sxs-lookup"><span data-stu-id="eaab4-413">ParseDisplayName</span></span>

<span data-ttu-id="eaab4-414">Метод [**ишеллфолдер::P арседисплайнаме**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) имеет более понятный зеркальный образ [**Ишеллфолдер:: жетдисплайнамеоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof).</span><span class="sxs-lookup"><span data-stu-id="eaab4-414">The [**IShellFolder::ParseDisplayName**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) method is in some sense a mirror image of [**IShellFolder::GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof).</span></span> <span data-ttu-id="eaab4-415">Чаще всего этот метод используется для преобразования имени синтаксического анализа объекта в связанный ПИДЛ.</span><span class="sxs-lookup"><span data-stu-id="eaab4-415">The most common use of this method is to convert an object's parsing name into the associated PIDL.</span></span> <span data-ttu-id="eaab4-416">Имя анализа может ссылаться на любой объект, который находится ниже папки в иерархии пространства имен.</span><span class="sxs-lookup"><span data-stu-id="eaab4-416">The parsing name can refer to any object that lies below the folder in the namespace hierarchy.</span></span> <span data-ttu-id="eaab4-417">Возвращаемый ПИДЛ задается относительно объекта Folder, предоставляющего метод и обычно не является полным.</span><span class="sxs-lookup"><span data-stu-id="eaab4-417">The returned PIDL is relative to the folder object that exposes the method and is usually not fully qualified.</span></span> <span data-ttu-id="eaab4-418">Иными словами, несмотря на то, что ПИДЛ может содержать несколько структур [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) , первый из них будет либо в самом объекте, либо в первой вложенной папке пути из папки в объект.</span><span class="sxs-lookup"><span data-stu-id="eaab4-418">In other words, although the PIDL can contain several [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structures, the first will either be that of the object itself or the first subfolder in the path from the folder to the object.</span></span> <span data-ttu-id="eaab4-419">Вызывающему объекту необходимо добавить этот ПИДЛ к полному ПИДЛу папки, чтобы получить полное имя ПИДЛ для объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-419">The caller will have to append this PIDL to the folder's fully qualified PIDL to obtain a fully qualified PIDL for the object.</span></span>

<span data-ttu-id="eaab4-420">[**Ишеллфолдер:**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) можно также вызвать метод:P арседисплайнаме, чтобы запросить атрибуты объекта.</span><span class="sxs-lookup"><span data-stu-id="eaab4-420">[**IShellFolder::ParseDisplayName**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) can also be called to request an object's attributes.</span></span> <span data-ttu-id="eaab4-421">Поскольку определение всех применимых атрибутов может занимать много времени, вызывающая сторона задаст только те флаги [**сфгао \_ xxx**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof) , которые представляют сведения, которые интересует вызывающий объект.</span><span class="sxs-lookup"><span data-stu-id="eaab4-421">Because determining all the applicable attributes can be time consuming, the caller will set only those [**SFGAO\_XXX**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof) flags that represent information that the caller is interested in.</span></span> <span data-ttu-id="eaab4-422">Необходимо определить, какие из этих атрибутов имеют значение true для объекта, и очистить оставшиеся флаги.</span><span class="sxs-lookup"><span data-stu-id="eaab4-422">You should determine which of those attributes are true for the object, and clear the remaining flags.</span></span>

### <a name="ienumidlist-interface"></a><span data-ttu-id="eaab4-423">Интерфейс Иенумидлист</span><span class="sxs-lookup"><span data-stu-id="eaab4-423">IEnumIDList Interface</span></span>

<span data-ttu-id="eaab4-424">Если проводнику Windows требуется перечислить объекты, содержащиеся в папке, вызывается [**ишеллфолдер:: енумобжектс**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-enumobjects).</span><span class="sxs-lookup"><span data-stu-id="eaab4-424">When Windows Explorer needs to enumerate the objects that are contained by a folder, it calls [**IShellFolder::EnumObjects**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-enumobjects).</span></span> <span data-ttu-id="eaab4-425">Объект folder должен создать объект перечисления, который предоставляет интерфейс [**иенумидлист**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) и возвращать этот указатель интерфейса.</span><span class="sxs-lookup"><span data-stu-id="eaab4-425">The folder object must create an enumeration object that exposes the [**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) interface and return that interface pointer.</span></span> <span data-ttu-id="eaab4-426">Проводник Windows, как правило, будет использовать **иенумидлист** для перечисления PIDL всех объектов, содержащихся в папке.</span><span class="sxs-lookup"><span data-stu-id="eaab4-426">Windows Explorer will then typically use **IEnumIDList** to enumerate the PIDLs of all the objects contained by the folder.</span></span>

<span data-ttu-id="eaab4-427">[**Иенумидлист**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) является стандартным интерфейсом перечисления OLE и реализуется обычным способом.</span><span class="sxs-lookup"><span data-stu-id="eaab4-427">[**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) is a standard OLE enumeration interface and is implemented in the usual way.</span></span> <span data-ttu-id="eaab4-428">Однако помните, что возвращаемый PIDL должен быть связан с папкой и содержать только структуру [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) объекта и признак конца.</span><span class="sxs-lookup"><span data-stu-id="eaab4-428">Remember, however, that the PIDLs that you return must be relative to the folder and contain only the object's [**SHITEMID**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) structure and a terminator.</span></span>

## <a name="implementing-the-optional-interfaces"></a><span data-ttu-id="eaab4-429">Реализация необязательных интерфейсов</span><span class="sxs-lookup"><span data-stu-id="eaab4-429">Implementing the Optional Interfaces</span></span>

<span data-ttu-id="eaab4-430">Существует ряд необязательных интерфейсов оболочки, которые могут поддерживаться объектами папки расширения.</span><span class="sxs-lookup"><span data-stu-id="eaab4-430">There are a number of optional Shell interfaces that your extension's folder objects can support.</span></span> <span data-ttu-id="eaab4-431">Многие из них, такие как [**иекстрактикон**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona), позволяют настраивать различные аспекты того, как пользователь просматривает расширение.</span><span class="sxs-lookup"><span data-stu-id="eaab4-431">Many of them, such as [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona), allow you to customize various aspects of the way the user views your extension.</span></span> <span data-ttu-id="eaab4-432">Другие, такие как [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject), позволяют вашему расширению поддерживать такие функции, как перетаскивание.</span><span class="sxs-lookup"><span data-stu-id="eaab4-432">Others, such as [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject), allow your extension to support features such as drag-and-drop.</span></span>

<span data-ttu-id="eaab4-433">Ни один из дополнительных интерфейсов не предоставляется непосредственно объектом Folder.</span><span class="sxs-lookup"><span data-stu-id="eaab4-433">None of the optional interfaces are exposed directly by a folder object.</span></span> <span data-ttu-id="eaab4-434">Вместо этого проводник Windows вызывает один из двух методов [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) для запроса интерфейса:</span><span class="sxs-lookup"><span data-stu-id="eaab4-434">Instead, Windows Explorer calls one of two [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) methods to request an interface:</span></span>

-   <span data-ttu-id="eaab4-435">Проводник Windows вызывает [**ишеллфолдер:: жетуиобжектоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof) объекта Folder, чтобы запросить интерфейс для одного из объектов, содержащихся в папке.</span><span class="sxs-lookup"><span data-stu-id="eaab4-435">Windows Explorer calls a folder object's [**IShellFolder::GetUIObjectOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getuiobjectof) to request an interface for one of the objects contained by the folder.</span></span>
-   <span data-ttu-id="eaab4-436">Проводник Windows вызывает [**ишеллфолдер:: креатевиевобжект**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) объекта Folder для запроса интерфейса для самой папки.</span><span class="sxs-lookup"><span data-stu-id="eaab4-436">Windows Explorer calls a folder object's [**IShellFolder::CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) to request an interface for the folder itself.</span></span>

<span data-ttu-id="eaab4-437">Для предоставления сведений объект Folder создает объект, который предоставляет запрошенный интерфейс, и возвращает указатель интерфейса.</span><span class="sxs-lookup"><span data-stu-id="eaab4-437">To provide the information, the folder object creates an object that exposes the requested interface and returns the interface pointer.</span></span> <span data-ttu-id="eaab4-438">Затем Проводник Windows вызывает этот интерфейс для получения необходимой информации.</span><span class="sxs-lookup"><span data-stu-id="eaab4-438">Windows Explorer then calls that interface to retrieve the needed information.</span></span> <span data-ttu-id="eaab4-439">В этом разделе обсуждаются наиболее часто используемые необязательные интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="eaab4-439">This section discusses the most commonly used optional interfaces.</span></span>

### <a name="iextracticon"></a><span data-ttu-id="eaab4-440">иекстрактикон</span><span class="sxs-lookup"><span data-stu-id="eaab4-440">IExtractIcon</span></span>

<span data-ttu-id="eaab4-441">Проводник Windows запрашивает интерфейс [**иекстрактикон**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) перед отображением содержимого папки.</span><span class="sxs-lookup"><span data-stu-id="eaab4-441">Windows Explorer requests an [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) interface before it displays the contents of a folder.</span></span> <span data-ttu-id="eaab4-442">Интерфейс позволяет вашему расширению указывать настраиваемые значки для объектов, содержащихся в папке.</span><span class="sxs-lookup"><span data-stu-id="eaab4-442">The interface allows your extension to specify custom icons for the objects that are contained by the folder.</span></span> <span data-ttu-id="eaab4-443">В противном случае будут использоваться стандартные значки файлов и папок.</span><span class="sxs-lookup"><span data-stu-id="eaab4-443">Otherwise, the standard file and folder icons will be used.</span></span> <span data-ttu-id="eaab4-444">Чтобы предоставить пользовательский значок, создайте объект извлечения значков, который предоставляет **иекстрактикон** и возвращает указатель на этот интерфейс.</span><span class="sxs-lookup"><span data-stu-id="eaab4-444">To provide a custom icon, create an icon extraction object that exposes **IExtractIcon** and return a pointer to that interface.</span></span> <span data-ttu-id="eaab4-445">Для дальнейшего обсуждения см. справочную документацию по **иекстрактикон** или [Создание обработчиков значков](./how-to-create-icon-handlers.md).</span><span class="sxs-lookup"><span data-stu-id="eaab4-445">For further discussion, see the **IExtractIcon** reference documentation or [Creating Icon Handlers](./how-to-create-icon-handlers.md).</span></span>

### <a name="icontextmenu"></a><span data-ttu-id="eaab4-446">IContextMenu</span><span class="sxs-lookup"><span data-stu-id="eaab4-446">IContextMenu</span></span>

<span data-ttu-id="eaab4-447">Когда пользователь щелкает правой кнопкой мыши объект, проводник Windows запрашивает интерфейс [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-447">When a user right-clicks an object, Windows Explorer requests an [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu) interface.</span></span> <span data-ttu-id="eaab4-448">Чтобы предоставить контекстные меню для объектов, создайте объект обработчика меню и возвратите его интерфейс **IContextMenu** .</span><span class="sxs-lookup"><span data-stu-id="eaab4-448">To provide shortcut menus for your objects, create a menu handler object and return its **IContextMenu** interface.</span></span>

<span data-ttu-id="eaab4-449">Процедуры создания объекта обработчика меню очень похожи на те, которые используются для создания расширения оболочки обработчика меню.</span><span class="sxs-lookup"><span data-stu-id="eaab4-449">The procedures for creating a menu handler object are very similar to those used to create a menu handler Shell extension.</span></span> <span data-ttu-id="eaab4-450">Дополнительные сведения см. в разделе [Создание обработчиков контекстного меню](context-menu-handlers.md) или ссылки [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu), [**IContextMenu2**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-icontextmenu2)или [**IContextMenu3**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-icontextmenu3) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-450">For details, see [Creating Context Menu Handlers](context-menu-handlers.md) or the [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu), [**IContextMenu2**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-icontextmenu2), or [**IContextMenu3**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-icontextmenu3) reference.</span></span>

### <a name="iqueryinfo"></a><span data-ttu-id="eaab4-451">икуеринфо</span><span class="sxs-lookup"><span data-stu-id="eaab4-451">IQueryInfo</span></span>

<span data-ttu-id="eaab4-452">Проводник Windows вызывает интерфейс [**икуеринфо**](/windows/win32/api/shlobj_core/nn-shlobj_core-iqueryinfo) для получения текстовой строки подсказки.</span><span class="sxs-lookup"><span data-stu-id="eaab4-452">Windows Explorer calls the [**IQueryInfo**](/windows/win32/api/shlobj_core/nn-shlobj_core-iqueryinfo) interface to retrieve an infotip text string.</span></span>

### <a name="idataobject-and-idroptarget"></a><span data-ttu-id="eaab4-453">IDataObject и интерфейс IDropTarget</span><span class="sxs-lookup"><span data-stu-id="eaab4-453">IDataObject and IDropTarget</span></span>

<span data-ttu-id="eaab4-454">Когда объекты отображаются проводником Windows, объект Folder не имеет непосредственного способа выяснить, когда пользователь пытается вырезать, скопировать или перетащить объект.</span><span class="sxs-lookup"><span data-stu-id="eaab4-454">When your objects are displayed by Windows Explorer, a folder object has no direct way to know when a user is attempting to cut, copy, or drag an object.</span></span> <span data-ttu-id="eaab4-455">Вместо этого проводник Windows запрашивает интерфейс [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-455">Instead, Windows Explorer requests an [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span> <span data-ttu-id="eaab4-456">Чтобы разрешить передачу объекта, создайте объект данных и верните указатель на его интерфейс **IDataObject** .</span><span class="sxs-lookup"><span data-stu-id="eaab4-456">To allow the object to be transferred, create a data object and return a pointer to its **IDataObject** interface.</span></span>

<span data-ttu-id="eaab4-457">Аналогичным образом пользователь может попытаться удалить объект данных в представлении проводника Windows одного из объектов, таких как значок или путь к адресной строке.</span><span class="sxs-lookup"><span data-stu-id="eaab4-457">Similarly, a user might attempt to drop a data object on a Windows Explorer representation of one of your objects, such as an icon or address bar path.</span></span> <span data-ttu-id="eaab4-458">Затем Проводник Windows запрашивает интерфейс [**интерфейс IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) .</span><span class="sxs-lookup"><span data-stu-id="eaab4-458">Windows Explorer then requests an [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span> <span data-ttu-id="eaab4-459">Чтобы разрешить удаление объекта данных, создайте объект, предоставляющий интерфейс **интерфейс IDropTarget** , и возвратите указатель интерфейса.</span><span class="sxs-lookup"><span data-stu-id="eaab4-459">To allow the data object to be dropped, create an object that exposes an **IDropTarget** interface and return the interface pointer.</span></span>

<span data-ttu-id="eaab4-460">Обработка передаваемых данных является одним из более замысловатых аспектов написания расширений пространства имен.</span><span class="sxs-lookup"><span data-stu-id="eaab4-460">Handling data transfer is one of the trickier aspects of writing namespace extensions.</span></span> <span data-ttu-id="eaab4-461">Подробное обсуждение см. в разделе [Передача объектов оболочки с помощью перетаскивания и буфера обмена](dragdrop.md).</span><span class="sxs-lookup"><span data-stu-id="eaab4-461">For a detailed discussion, see [Transferring Shell Objects with Drag-and-Drop and the Clipboard](dragdrop.md).</span></span>

## <a name="working-with-the-default-shell-folder-view-implementation"></a><span data-ttu-id="eaab4-462">Работа с реализацией представления папки оболочки по умолчанию</span><span class="sxs-lookup"><span data-stu-id="eaab4-462">Working With the Default Shell Folder View Implementation</span></span>

<span data-ttu-id="eaab4-463">Источники данных, использующие объект представления папок оболочки по умолчанию (Дефвиев), должны реализовывать следующие интерфейсы:</span><span class="sxs-lookup"><span data-stu-id="eaab4-463">Data sources that use the default Shell folder view object (DefView) must implement these interfaces:</span></span>

-   [<span data-ttu-id="eaab4-464">**ишеллфолдер**</span><span class="sxs-lookup"><span data-stu-id="eaab4-464">**IShellFolder**</span></span>](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder)
-   [<span data-ttu-id="eaab4-465">**IShellFolder2**</span><span class="sxs-lookup"><span data-stu-id="eaab4-465">**IShellFolder2**</span></span>](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellfolder2)
-   [<span data-ttu-id="eaab4-466">**иперсистфолдер**</span><span class="sxs-lookup"><span data-stu-id="eaab4-466">**IPersistFolder**</span></span>](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ipersistfolder)
-   [<span data-ttu-id="eaab4-467">**IPersistFolder2**</span><span class="sxs-lookup"><span data-stu-id="eaab4-467">**IPersistFolder2**</span></span>](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ipersistfolder2)

<span data-ttu-id="eaab4-468">При необходимости они также могут реализовывать [**IPersistFolder3**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ipersistfolder3).</span><span class="sxs-lookup"><span data-stu-id="eaab4-468">Optionally, they can also implement [**IPersistFolder3**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ipersistfolder3).</span></span>

 

 
