---
description: Windows Vista предоставляет более широкие особенности использования файловых эскизов, чем предыдущие версии Windows.
title: Обработчики эскизов
ms.topic: article
ms.date: 07/02/2018
ms.assetid: ed9e17bb-aa28-4f8c-8b5a-9b57cab1c438
api_name: ''
api_type: ''
api_location: ''
topic_type:
- kbArticle
ms.openlocfilehash: d81accf59401a46dd6b5611e15a67eeec68d5d82
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104266164"
---
# <a name="thumbnail-handlers"></a>Обработчики эскизов

Windows Vista предоставляет более широкие особенности использования файловых эскизов, чем предыдущие версии Windows. Windows Vista использует их во всех представлениях, в диалоговых окнах и для любого типа файлов, который их предоставляет. Другие приложения также могут использовать эскиз. Отображение эскиза также изменилось. Теперь доступен непрерывный спектр размеров, выбираемых пользователем, а не дискретные размеры, такие как значки и эскизы, предоставляемые в Windows XP.

> [!Note]  
> Вы можете услышать эти эскизы, которые называются значками Live.

 

Эскизы в пользовательском интерфейсе Windows Vista часто используются в виде миниатюр с 32-разрядным разрешением и размером до 256x256 пикселей. Владельцы форматов файлов должны быть готовы к отображению эскизов с таким размером. Они также должны предоставлять нестатические изображения для эскизов, отражающих содержимое конкретного файла. Например, эскиз текстового файла должен показывать миниатюрную версию документа, включая его текст.

Интерфейс [**исумбнаилпровидер**](/windows/desktop/api/Thumbcache/nn-thumbcache-ithumbnailprovider) был введен, чтобы сделать эскиз более простым и простым, чем раньше, когда вместо этого было бы использовано [**иекстрактимаже**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-iextractimage) . Обратите внимание, что существующий код, использующий **иекстрактимаже** , все еще действует в Windows Vista. Однако **иекстрактимаже** не поддерживается в области **сведений** .

В этом разделе обсуждается следующее.

-   [Эскизы процессов](#thumbnail-processes)
-   [Кэш и размер эскиза](#thumbnail-cache-and-sizing)
-   [Наложение эскизов](#thumbnail-overlays)
-   [Украшения эскизов](#thumbnail-adornments)
-   [Регистрация обработчика эскизов](#registering-your-thumbnail-handler)
-   [См. также](#related-topics)

## <a name="thumbnail-processes"></a>Эскизы процессов

Обработчики, включая обработчики эскизов, по умолчанию выполняются в отдельном процессе. Можно принудительно запустить обработчик в процессе, передав значение **null** в качестве контекста привязки в вызове [**интерфейса IShellItem:: биндтохандлер**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellitem-bindtohandler) , как показано ниже:


```
IShellItem::BindToHandler(NULL, BHID_ThumbnailHandler,..)
```



Можно также отказаться от выполнения процесса по умолчанию, задав в реестре запись Дисаблепроцессисолатион, как показано в этом примере. Идентификатор класса (CLSID) {E357FCCD-A995-4576-B01F-234630154E96} — это CLSID для реализаций [**исумбнаилпровидер**](/windows/desktop/api/Thumbcache/nn-thumbcache-ithumbnailprovider) .

```
HKEY_CLASSES_ROOT
   CLSID
      {E357FCCD-A995-4576-B01F-234630154E96}
         DisableProcessIsolation = 1
```

## <a name="thumbnail-cache-and-sizing"></a>Кэш и размер эскиза

Когда нужен эскиз, Windows сначала проверяет кэш эскизов для изображения. Средство извлечения эскизов вызывается, если изображение не найдено в кэше. Он также вызывается, когда время последнего изменения образа позже, чем у копии в кэше.

Эскизные изображения в этом кэше хранятся в наборе дискретных размеров. Все размеры задаются в пикселях.

-   32 x 32
-   96x96
-   256x256
-   1024x1024

> [!Note]  
> Эти значения могут быть изменены. В коде не следует рассчитывать, что любой определенный размер всегда будет использоваться.

 

Если изображение не является квадратным, вы не должны добавлять его самостоятельно. Windows отвечает за соблюдение исходных пропорций и заполнение изображения до квадратного размера.

При запросе изображения определенного размера, если не найдено точное соответствие, Windows Vista всегда извлекает следующее самое большое изображение и масштабирует его до требуемого размера. Изображение никогда не масштабируется по размеру, как в предыдущих версиях Windows.

В следующей таблице приведены некоторые примеры связи между запрошенным размером и доступным размером.



| Максимальный размер предоставленного образа | Размер, запрошенный средством извлечения | Вы предоставляете                                 |
|--------------------------------|---------------------------------|---------------------------------------------|
| 156x120                        | 256x256                         | 156x120 (не раскладка, сохранение пропорций) |
| 2048x1024                      | 256x256                         | 256x128 (не раскладка, сохранение пропорций) |



 

Точку отсечки можно объявить как часть идентификатора программы для связанного приложения в реестре. Под этим размером эскизы не используются.

```
HKEY_CLASSES_ROOT
   .{ProgId}
      ThumbnailCutoff
```

Запись Сумбнаилкутофф является одним из этих значений REG \_ .

| Значение | Cutoff | С учетом Хигхдпи |
|-------|--------|-------------------|
| 0     | 32 x 32  | Да               |
| 1     | 16 x 16  | Да               |
| 2     | 48x48  | Да               |
| 3     | 16 x 16  | Да               |


Высокая точка на дюйм (DPI) означает, что размеры изображения в пикселях эскиза автоматически корректируются для более высокого DPI. Например, изображение размером 32x32 в 96 dpi будет 40x40ным образом в 120 dpi.

Если запись Сумбнаилкутофф не указана, по умолчанию используется значение 20x20 (без учета DPI).

## <a name="thumbnail-overlays"></a>Наложение эскизов

Наложение эскизов — небольшое изображение, отображаемое в правом нижнем углу эскиза, предоставляет разработчикам возможность применять фирменную символику к эскизам. Перекрытия объявляются в реестре как часть идентификатора программы для связанного приложения, как показано ниже:

```
HKEY_CLASSES_ROOT
   .{ProgId}
      TypeOverlay
```

Запись Типеоверлай содержит \_ значение reg SZ, интерпретируемое следующим образом:

-   Если значение является ссылкой на ресурс ( **ICO** -файл, внедренный в библиотеку DLL), например `ISVComponent.dll,-155` , этот образ используется в качестве наложения для файлов с этим расширением имени файла. Обратите внимание, что в этом примере **155** является идентификатором ресурса, а если библиотека DLL отсутствует в стандартном пути (например, **C:/Windows/System32**), вместо имени библиотеки DLL требуется полный путь.
-   Если значение является пустой строкой, к изображению не применяется наложенный оверлей.
-   Если значение отсутствует, используется значок связанного приложения по умолчанию.

Перекрытия для эскизов должны предоставляться только с помощью этого механизма и применяться в Windows. Не применяйте перекрытия самостоятельно.

## <a name="thumbnail-adornments"></a>Украшения эскизов

Декоративные элементы, такие как тени, применяются к эскизам на основе выбранной темы пользователя. Элементы оформления обеспечиваются Windows; не создавайте их самостоятельно. Windows может в любое время изменить внешний вид определенных оформлений, поэтому, если вы указали свое владение, вы рискуете не синхронизироваться с системой. Эскизы могут быть в начале или на месте.

Потенциальные декоративные элементы объявляются в реестре как часть идентификатора программы для соответствующего приложения, как показано ниже:

```
HKEY_CLASSES_ROOT
   .{ProgId}
      Treatment
```

Запись лечения содержит одно из следующих значений REG \_ DWORD:



| Значение | Значение         |
|-------|-----------------|
| 0     | Нет оформления    |
| 1     | Тень     |
| 2     | Рамка фотографии    |
| 3     | Видео Спроккетс |


К изображениям по умолчанию применяется тень.

## <a name="registering-your-thumbnail-handler"></a>Регистрация обработчика эскизов

Регистрация обработчика эскиза основана на стандартных сопоставлениях файлов.

GUID для расширения оболочки обработчика эскизов — `E357FCCD-A995-4576-B01F-234630154E96` .

## <a name="related-topics"></a>См. также

<dl> <dt>

[**исумбнаилпровидер**](/windows/desktop/api/Thumbcache/nn-thumbcache-ithumbnailprovider)
</dt> <dt>

[Создание обработчиков эскизов](building-thumbnail-providers.md)
</dt> <dt>

[Рекомендации по обработке эскизов](thumbnail-provider-guidelines.md)
</dt> </dl>

 

 



