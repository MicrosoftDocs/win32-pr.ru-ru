---
description: Щелчок объекта правой кнопкой мыши обычно приводит к отображению контекстного меню. Это меню содержит список команд, которые пользователь может выбрать для выполнения различных действий с объектом. В этом разделе представлены общие сведения о контекстных меню для объектов файловой системы.
ms.assetid: d951d1e8-0f88-49c4-8373-e6db0e18cd72
title: Расширение контекстных меню
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 895550ff050d559b3523676ddaa2a58099398a97
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104569080"
---
# <a name="extending-shortcut-menus"></a><span data-ttu-id="90aef-105">Расширение контекстных меню</span><span class="sxs-lookup"><span data-stu-id="90aef-105">Extending Shortcut Menus</span></span>

<span data-ttu-id="90aef-106">Щелчок объекта правой кнопкой мыши обычно приводит к отображению *контекстного меню*.</span><span class="sxs-lookup"><span data-stu-id="90aef-106">Right-clicking an object normally causes the display of a *shortcut menu*.</span></span> <span data-ttu-id="90aef-107">Это меню содержит список команд, которые пользователь может выбрать для выполнения различных действий с объектом.</span><span class="sxs-lookup"><span data-stu-id="90aef-107">This menu contains a list of commands that the user can select to perform various actions on the object.</span></span> <span data-ttu-id="90aef-108">В этом разделе представлены общие сведения о контекстных меню для объектов файловой системы.</span><span class="sxs-lookup"><span data-stu-id="90aef-108">This section is an introduction to shortcut menus for file system objects.</span></span>

-   [<span data-ttu-id="90aef-109">Контекстные меню для объектов файловой системы</span><span class="sxs-lookup"><span data-stu-id="90aef-109">Shortcut Menus for File System Objects</span></span>](#shortcut-menus-for-file-system-objects)
-   [<span data-ttu-id="90aef-110">Команды контекстного меню</span><span class="sxs-lookup"><span data-stu-id="90aef-110">Shortcut Menu Verbs</span></span>](#shortcut-menu-verbs)
    -   [<span data-ttu-id="90aef-111">Канонические команды</span><span class="sxs-lookup"><span data-stu-id="90aef-111">Canonical Verbs</span></span>](#canonical-verbs)
    -   [<span data-ttu-id="90aef-112">Расширенные глаголы</span><span class="sxs-lookup"><span data-stu-id="90aef-112">Extended Verbs</span></span>](#extended-verbs)
-   [<span data-ttu-id="90aef-113">Расширение контекстного меню для типа файла</span><span class="sxs-lookup"><span data-stu-id="90aef-113">Extending the Shortcut Menu for a File Type</span></span>](#extending-the-shortcut-menu-for-a-file-type)
-   [<span data-ttu-id="90aef-114">Расширение контекстного меню для предопределенных объектов оболочки</span><span class="sxs-lookup"><span data-stu-id="90aef-114">Extending the Shortcut Menu for Predefined Shell Objects</span></span>](#extending-the-shortcut-menu-for-predefined-shell-objects)
-   [<span data-ttu-id="90aef-115">Регистрация приложения для управления произвольными типами файлов</span><span class="sxs-lookup"><span data-stu-id="90aef-115">Registering an Application to Handle Arbitrary File Types</span></span>](#registering-an-application-to-handle-arbitrary-file-types)
-   [<span data-ttu-id="90aef-116">Расширение нового подменю</span><span class="sxs-lookup"><span data-stu-id="90aef-116">Extending the New Submenu</span></span>](#extending-the-new-submenu)

<span data-ttu-id="90aef-117">Дополнительные сведения можно найти здесь:</span><span class="sxs-lookup"><span data-stu-id="90aef-117">Additional information is available here:</span></span>

-   [<span data-ttu-id="90aef-118">Определение расширенных команд</span><span class="sxs-lookup"><span data-stu-id="90aef-118">How To Define Extended Verbs</span></span>](how-to-define-extended-verbs.md)
-   [<span data-ttu-id="90aef-119">Связывание команд с командами DDE</span><span class="sxs-lookup"><span data-stu-id="90aef-119">How To Associate Verbs with DDE Commands</span></span>](how-to-associate-verbs-with-dde-commands.md)

## <a name="shortcut-menus-for-file-system-objects"></a><span data-ttu-id="90aef-120">Контекстные меню для объектов файловой системы</span><span class="sxs-lookup"><span data-stu-id="90aef-120">Shortcut Menus for File System Objects</span></span>

<span data-ttu-id="90aef-121">Когда пользователь щелкает правой кнопкой мыши объект, например файл, который отображается в проводнике Windows или на рабочем столе, отображается контекстное меню со списком команд.</span><span class="sxs-lookup"><span data-stu-id="90aef-121">When a user right-clicks an object, such as a file, that is displayed in Windows Explorer or on the desktop, a shortcut menu appears with a list of commands.</span></span> <span data-ttu-id="90aef-122">Затем пользователь может выполнить действие с файлом, например открыть или удалить его, выбрав соответствующую команду.</span><span class="sxs-lookup"><span data-stu-id="90aef-122">The user can then perform an action on the file, such as opening or deleting it, by selecting the appropriate command.</span></span>

<span data-ttu-id="90aef-123">Так как контекстные меню часто используются для управления файлами, оболочка предоставляет набор команд по умолчанию, таких как вырезание и копирование, которые отображаются в контекстном меню для любого файла.</span><span class="sxs-lookup"><span data-stu-id="90aef-123">Because shortcut menus are often used for file management, the Shell provides a set of default commands, such as Cut and Copy, that appear on the shortcut menu for any file.</span></span> <span data-ttu-id="90aef-124">Обратите внимание, что хотя команда Открыть с помощью является командой по умолчанию, она не отображается для некоторых стандартных типов файлов, таких как. wav.</span><span class="sxs-lookup"><span data-stu-id="90aef-124">Note that although Open With is a default command, it is not displayed for some standard file types, such as .wav.</span></span> <span data-ttu-id="90aef-125">На следующем рисунке примера каталога Мои документы, который также использовался в качестве примера при [настройке значков](icon.md), отображается контекстное меню по умолчанию, отображаемое при щелчке правой кнопкой мыши MyDocs4.xyz.</span><span class="sxs-lookup"><span data-stu-id="90aef-125">The following illustration of the sample My Documents directory, which was also used as an example in [Customizing Icons](icon.md), shows a default shortcut menu that was displayed by right-clicking MyDocs4.xyz.</span></span>

![снимок экрана контекстного меню по умолчанию для объектов файловой системы](images/context1.jpg)

<span data-ttu-id="90aef-127">Причина, по которой MyDocs4.xyz отображает контекстное меню по умолчанию, заключается в том, что она не является членом зарегистрированного [типа файла](fa-file-types.md).</span><span class="sxs-lookup"><span data-stu-id="90aef-127">The reason that MyDocs4.xyz shows a default shortcut menu is that it is not a member of a registered [file type](fa-file-types.md).</span></span> <span data-ttu-id="90aef-128">С другой стороны, txt — это зарегистрированный тип файла.</span><span class="sxs-lookup"><span data-stu-id="90aef-128">On the other hand, .txt is a registered file type.</span></span> <span data-ttu-id="90aef-129">Если щелкнуть правой кнопкой мыши один из TXT-файлов, в его верхней части появится контекстное меню с двумя дополнительными командами: **Открыть** и **напечатать**.</span><span class="sxs-lookup"><span data-stu-id="90aef-129">If you right-click one of the .txt files, you will instead see a shortcut menu with two additional commands in its upper section: **Open** and **Print**.</span></span>

![снимок экрана с пользовательским контекстным меню для объектов файловой системы](images/context2.jpg)

<span data-ttu-id="90aef-131">После регистрации типа файла можно расширить его контекстное меню с помощью дополнительных команд.</span><span class="sxs-lookup"><span data-stu-id="90aef-131">Once a file type is registered, you can extend its shortcut menu with additional commands.</span></span> <span data-ttu-id="90aef-132">Они отображаются над командами по умолчанию при щелчке правой кнопкой мыши любого файла этого типа.</span><span class="sxs-lookup"><span data-stu-id="90aef-132">They are displayed above the default commands when any file of that type is right-clicked.</span></span> <span data-ttu-id="90aef-133">Хотя большинство команд, добавленных таким способом, являются общими, например **Печать** или **Открытие**, вы можете добавить любую команду, которую может получить пользователь.</span><span class="sxs-lookup"><span data-stu-id="90aef-133">Although most of the commands added in this way are common ones, such as **Print** or **Open**, you are free to add any command that a user might find helpful.</span></span>

<span data-ttu-id="90aef-134">Все, что требуется для расширения контекстного меню для типа файла, — создание записи реестра для каждой команды.</span><span class="sxs-lookup"><span data-stu-id="90aef-134">All that is required to extend the shortcut menu for a file type is to create a registry entry for each command.</span></span> <span data-ttu-id="90aef-135">Более сложный подход заключается в реализации *обработчика контекстного меню*, который позволяет расширять контекстное меню для типа файла по отдельности для каждого файла.</span><span class="sxs-lookup"><span data-stu-id="90aef-135">A more sophisticated approach is to implement a *shortcut menu handler*, which allows you to extend the shortcut menu for a file type on a file-by-file basis.</span></span> <span data-ttu-id="90aef-136">Дополнительные сведения см. в разделе [Создание обработчиков контекстного меню](context-menu-handlers.md).</span><span class="sxs-lookup"><span data-stu-id="90aef-136">For more information, see [Creating Context Menu Handlers](context-menu-handlers.md).</span></span>

## <a name="shortcut-menu-verbs"></a><span data-ttu-id="90aef-137">Команды контекстного меню</span><span class="sxs-lookup"><span data-stu-id="90aef-137">Shortcut Menu Verbs</span></span>

<span data-ttu-id="90aef-138">Каждая команда контекстного меню определяется в реестре *командой.*</span><span class="sxs-lookup"><span data-stu-id="90aef-138">Each command on the shortcut menu is identified in the registry by its *verb*.</span></span> <span data-ttu-id="90aef-139">Эти команды аналогичны тем, которые используются [**ShellExecuteEx**](/windows/desktop/api/Shellapi/nf-shellapi-shellexecuteexa) при запуске приложений программным способом.</span><span class="sxs-lookup"><span data-stu-id="90aef-139">These verbs are the same as those used by [**ShellExecuteEx**](/windows/desktop/api/Shellapi/nf-shellapi-shellexecuteexa) when launching applications programmatically.</span></span> <span data-ttu-id="90aef-140">Дополнительные сведения об использовании **ShellExecuteEx** см. в обсуждении в разделе [Запуск приложений](launch.md).</span><span class="sxs-lookup"><span data-stu-id="90aef-140">For further information about the use of **ShellExecuteEx**, see the discussion in [Launching Applications](launch.md).</span></span>

<span data-ttu-id="90aef-141">Глагол — это простая текстовая строка, которая используется оболочкой для обнаружения связанной команды.</span><span class="sxs-lookup"><span data-stu-id="90aef-141">A verb is a simple text string that is used by the Shell to identify the associated command.</span></span> <span data-ttu-id="90aef-142">Каждая команда соответствует *строке команды* , используемой для запуска команды в окне консоли или в файле пакета (bat).</span><span class="sxs-lookup"><span data-stu-id="90aef-142">Each verb corresponds to the *command string* used to launch the command in a console window or batch (.bat) file.</span></span> <span data-ttu-id="90aef-143">Например, команда **Open** обычно запускает программу, чтобы открыть файл.</span><span class="sxs-lookup"><span data-stu-id="90aef-143">For example, the **open** verb normally launches a program to open a file.</span></span> <span data-ttu-id="90aef-144">Ее Командная строка обычно выглядит примерно так:</span><span class="sxs-lookup"><span data-stu-id="90aef-144">Its command string typically looks something like this:</span></span>

``` syntax
"My Program.exe" "%1"
```

<span data-ttu-id="90aef-145">"%1" — это стандартный заполнитель для параметра командной строки, предоставленного с именем файла.</span><span class="sxs-lookup"><span data-stu-id="90aef-145">"%1" is the standard placeholder for a command line parameter provided with the filename.</span></span> <span data-ttu-id="90aef-146">Например, он может указать конкретную страницу для отображения в представлении с вкладками.</span><span class="sxs-lookup"><span data-stu-id="90aef-146">For instance, it can specify a particular page to display in a tabbed view.</span></span>

> [!Note]  
> <span data-ttu-id="90aef-147">Если любой из элементов командной строки содержит или может содержать пробелы, его необходимо заключить в кавычки.</span><span class="sxs-lookup"><span data-stu-id="90aef-147">If any element of the command string contains or might contain spaces, it must be enclosed in quotation marks.</span></span> <span data-ttu-id="90aef-148">В противном случае, если элемент содержит пробел, он будет проанализирован неправильно.</span><span class="sxs-lookup"><span data-stu-id="90aef-148">Otherwise, if the element contains a space, it will not parse correctly.</span></span> <span data-ttu-id="90aef-149">Например, "My Program.exe" запустит приложение должным образом.</span><span class="sxs-lookup"><span data-stu-id="90aef-149">For instance, "My Program.exe" will launch the application properly.</span></span> <span data-ttu-id="90aef-150">Если используется Program.exe, система попытается запустить "My" с "Program.exe" в качестве первого аргумента командной строки.</span><span class="sxs-lookup"><span data-stu-id="90aef-150">If you use My Program.exe, the system will attempt to launch "My" with "Program.exe" as its first command line argument.</span></span> <span data-ttu-id="90aef-151">Следует всегда использовать кавычки с аргументами, такими как "%1", которые разворачиваются оболочкой, так как нельзя уверенно, что строка не будет содержать пробелов.</span><span class="sxs-lookup"><span data-stu-id="90aef-151">You should always use quotation marks with arguments such as "%1" that are expanded to strings by the Shell, because you cannot be certain that the string will not contain a space.</span></span>

 

<span data-ttu-id="90aef-152">С командами также может быть связана *отображаемая строка* , которая отображается в контекстном меню вместо самой строки команды.</span><span class="sxs-lookup"><span data-stu-id="90aef-152">Verbs can also have a *display string* associated with them, which is displayed on the shortcut menu instead of the verb string itself.</span></span> <span data-ttu-id="90aef-153">Например, отображаемая строка для **Опенас** открыта с помощью.</span><span class="sxs-lookup"><span data-stu-id="90aef-153">For example, the display string for **openas** is Open With.</span></span> <span data-ttu-id="90aef-154">Как и обычные строки меню, включая амперсанд (&) в отображаемой строке, позволяет выбрать команду с клавиатуры.</span><span class="sxs-lookup"><span data-stu-id="90aef-154">Like normal menu strings, including an ampersand (&) in the display string allows keyboard selection of the command.</span></span>

### <a name="canonical-verbs"></a><span data-ttu-id="90aef-155">Канонические команды</span><span class="sxs-lookup"><span data-stu-id="90aef-155">Canonical Verbs</span></span>

<span data-ttu-id="90aef-156">Как правило, приложения отвечают за предоставление локализованных отображаемых строк для глаголов, которые они определяют.</span><span class="sxs-lookup"><span data-stu-id="90aef-156">In general, applications are responsible for providing localized display strings for the verbs they define.</span></span> <span data-ttu-id="90aef-157">Однако для обеспечения степени независимости от языка система определяет стандартный набор часто используемых глаголов, называемых *каноническими глаголами*.</span><span class="sxs-lookup"><span data-stu-id="90aef-157">However, to provide a degree of language independence, the system defines a standard set of commonly used verbs called *canonical verbs*.</span></span> <span data-ttu-id="90aef-158">Каноническая команда может использоваться с любым языком, а система автоматически создает правильно локализованную отображаемую строку.</span><span class="sxs-lookup"><span data-stu-id="90aef-158">A canonical verb can be used with any language, and the system automatically generates a properly localized display string.</span></span> <span data-ttu-id="90aef-159">Например, отображаемая строка **открытия** команды будет открыта в английской системе и öффнен в системе на немецком языке.</span><span class="sxs-lookup"><span data-stu-id="90aef-159">For instance, the **open** verb's display string will be set to Open on an English system, and to Öffnen on a German system.</span></span>

<span data-ttu-id="90aef-160">Канонические команды включают:</span><span class="sxs-lookup"><span data-stu-id="90aef-160">The canonical verbs include:</span></span>



| <span data-ttu-id="90aef-161">Значение</span><span class="sxs-lookup"><span data-stu-id="90aef-161">Value</span></span>      | <span data-ttu-id="90aef-162">Описание</span><span class="sxs-lookup"><span data-stu-id="90aef-162">Description</span></span>                                                                                 |
|------------|---------------------------------------------------------------------------------------------|
| <span data-ttu-id="90aef-163">open</span><span class="sxs-lookup"><span data-stu-id="90aef-163">open</span></span>       | <span data-ttu-id="90aef-164">Открывает файл или папку.</span><span class="sxs-lookup"><span data-stu-id="90aef-164">Opens the file or folder.</span></span>                                                                   |
| <span data-ttu-id="90aef-165">опеннев</span><span class="sxs-lookup"><span data-stu-id="90aef-165">opennew</span></span>    | <span data-ttu-id="90aef-166">Открывает файл или папку в новом окне.</span><span class="sxs-lookup"><span data-stu-id="90aef-166">Opens the file or folder in a new window.</span></span>                                                   |
| <span data-ttu-id="90aef-167">print</span><span class="sxs-lookup"><span data-stu-id="90aef-167">print</span></span>      | <span data-ttu-id="90aef-168">Выводит файл.</span><span class="sxs-lookup"><span data-stu-id="90aef-168">Prints the file.</span></span>                                                                            |
| <span data-ttu-id="90aef-169">обзор</span><span class="sxs-lookup"><span data-stu-id="90aef-169">explore</span></span>    | <span data-ttu-id="90aef-170">Открывает проводник Windows с выбранной папкой.</span><span class="sxs-lookup"><span data-stu-id="90aef-170">Opens Windows Explorer with the folder selected.</span></span>                                            |
| <span data-ttu-id="90aef-171">поиск</span><span class="sxs-lookup"><span data-stu-id="90aef-171">find</span></span>       | <span data-ttu-id="90aef-172">Открывает диалоговое окно **Поиск Windows** с набором папок в качестве расположения поиска по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="90aef-172">Opens the **Windows Search** dialog box with the folder set as the default search location.</span></span> |
| <span data-ttu-id="90aef-173">опенас</span><span class="sxs-lookup"><span data-stu-id="90aef-173">openas</span></span>     | <span data-ttu-id="90aef-174">Открывает диалоговое окно **Открыть с помощью** .</span><span class="sxs-lookup"><span data-stu-id="90aef-174">Opens the **Open With** dialog box.</span></span>                                                         |
| <span data-ttu-id="90aef-175">properties</span><span class="sxs-lookup"><span data-stu-id="90aef-175">properties</span></span> | <span data-ttu-id="90aef-176">Открывает страницу свойств объекта.</span><span class="sxs-lookup"><span data-stu-id="90aef-176">Opens the object's property sheet.</span></span>                                                          |



 

<span data-ttu-id="90aef-177">Команда принтто также является канонической, но никогда не отображается.</span><span class="sxs-lookup"><span data-stu-id="90aef-177">The printto verb is also canonical but is never displayed.</span></span> <span data-ttu-id="90aef-178">Он позволяет пользователю распечатать файл, перетащив его на объект принтера.</span><span class="sxs-lookup"><span data-stu-id="90aef-178">It allows the user to print a file by dragging it to a printer object.</span></span>

### <a name="extended-verbs"></a><span data-ttu-id="90aef-179">Расширенные глаголы</span><span class="sxs-lookup"><span data-stu-id="90aef-179">Extended Verbs</span></span>

<span data-ttu-id="90aef-180">Когда пользователь щелкает правой кнопкой мыши объект, контекстное меню содержит все обычные команды.</span><span class="sxs-lookup"><span data-stu-id="90aef-180">When the user right-clicks an object, the shortcut menu contains all the normal verbs.</span></span> <span data-ttu-id="90aef-181">Однако могут существовать команды, которые должны поддерживаться, но не отображаться в каждом контекстном меню.</span><span class="sxs-lookup"><span data-stu-id="90aef-181">However, there could be commands that you want to support but not have displayed on every shortcut menu.</span></span> <span data-ttu-id="90aef-182">Например, можно использовать команды, которые обычно не используются или предназначены для опытных пользователей.</span><span class="sxs-lookup"><span data-stu-id="90aef-182">For example, you could have commands that are not commonly used or that are intended for experienced users.</span></span> <span data-ttu-id="90aef-183">По этой причине можно также определить одну или несколько *расширенных команд*.</span><span class="sxs-lookup"><span data-stu-id="90aef-183">For this reason, you can also define one or more *extended verbs*.</span></span> <span data-ttu-id="90aef-184">Эти глаголы также являются символьными строками и похожи на обычные команды.</span><span class="sxs-lookup"><span data-stu-id="90aef-184">These verbs are also character strings and are similar to normal verbs.</span></span> <span data-ttu-id="90aef-185">Они отличаются от обычных глаголов способом их регистрации.</span><span class="sxs-lookup"><span data-stu-id="90aef-185">They are distinguished from normal verbs by the way they are registered.</span></span> <span data-ttu-id="90aef-186">Чтобы получить доступ к командам, связанным с расширенными командами, пользователь должен щелкнуть правой кнопкой мыши объект, удерживая нажатой клавишу SHIFT.</span><span class="sxs-lookup"><span data-stu-id="90aef-186">To have access to the commands associated with extended verbs, the user must right-click an object while pressing the SHIFT key.</span></span> <span data-ttu-id="90aef-187">Расширенные команды будут отображаться вместе с обычными командами.</span><span class="sxs-lookup"><span data-stu-id="90aef-187">The extended verbs will then be displayed along with the normal verbs.</span></span>

## <a name="extending-the-shortcut-menu-for-a-file-type"></a><span data-ttu-id="90aef-188">Расширение контекстного меню для типа файла</span><span class="sxs-lookup"><span data-stu-id="90aef-188">Extending the Shortcut Menu for a File Type</span></span>

<span data-ttu-id="90aef-189">Самый простой способ расширить контекстное меню для типа файла — с помощью реестра.</span><span class="sxs-lookup"><span data-stu-id="90aef-189">The simplest way to extend the shortcut menu for a file type is with the registry.</span></span> <span data-ttu-id="90aef-190">Для этого добавьте подраздел **Shell** под ключом для идентификатора ProgID приложения, связанного с [типом файла](fa-file-types.md).</span><span class="sxs-lookup"><span data-stu-id="90aef-190">To do this, add a **Shell** subkey below the key for the ProgID of the application associated with the [file type](fa-file-types.md).</span></span> <span data-ttu-id="90aef-191">При необходимости можно определить *глагол по умолчанию* для типа файла, сделав его значением по умолчанию для подраздела **Shell** .</span><span class="sxs-lookup"><span data-stu-id="90aef-191">Optionally, you can define a *default verb* for the file type by making it the default value of the **Shell** subkey.</span></span>

<span data-ttu-id="90aef-192">Команда по умолчанию отображается в контекстном меню первой.</span><span class="sxs-lookup"><span data-stu-id="90aef-192">The default verb is displayed first on the shortcut menu.</span></span> <span data-ttu-id="90aef-193">Его целью является предоставление оболочки с глаголом, который может использоваться при вызове [**ShellExecuteEx**](/windows/desktop/api/Shellapi/nf-shellapi-shellexecuteexa) , но не задано ни одной команды.</span><span class="sxs-lookup"><span data-stu-id="90aef-193">Its purpose is to provide the Shell with a verb it can use when [**ShellExecuteEx**](/windows/desktop/api/Shellapi/nf-shellapi-shellexecuteexa) is called but no verb is specified.</span></span> <span data-ttu-id="90aef-194">Оболочка не обязательно выбирает команду по умолчанию, когда **ShellExecuteEx** используется таким образом.</span><span class="sxs-lookup"><span data-stu-id="90aef-194">The Shell does not necessarily select the default verb when **ShellExecuteEx** is used in this fashion.</span></span> <span data-ttu-id="90aef-195">Для оболочек [версии 5,0](versions.md) и более поздних, которые находятся в системах Windows 2000 и более поздних версий, оболочка использует первую доступную команду из следующего списка.</span><span class="sxs-lookup"><span data-stu-id="90aef-195">For Shell [versions 5.0](versions.md) and later, found on Windows 2000 and later systems, the Shell uses the first available verb from the following list.</span></span> <span data-ttu-id="90aef-196">Если они отсутствуют, операция завершается ошибкой.</span><span class="sxs-lookup"><span data-stu-id="90aef-196">If none are available, the operation fails.</span></span>

-   <span data-ttu-id="90aef-197">Команда открытия</span><span class="sxs-lookup"><span data-stu-id="90aef-197">The open verb</span></span>
-   <span data-ttu-id="90aef-198">Команда по умолчанию</span><span class="sxs-lookup"><span data-stu-id="90aef-198">The default verb</span></span>
-   <span data-ttu-id="90aef-199">Первая команда в реестре</span><span class="sxs-lookup"><span data-stu-id="90aef-199">The first verb in the registry</span></span>
-   <span data-ttu-id="90aef-200">Команда опенвис</span><span class="sxs-lookup"><span data-stu-id="90aef-200">The openwith verb</span></span>

<span data-ttu-id="90aef-201">Для версий оболочки, предшествовавших [версии 5,0](versions.md), опустите третий элемент.</span><span class="sxs-lookup"><span data-stu-id="90aef-201">For Shell versions prior to [version 5.0](versions.md), omit the third item.</span></span>

<span data-ttu-id="90aef-202">Под подразделом **Shell** создайте один подраздел для каждой добавляемой команды.</span><span class="sxs-lookup"><span data-stu-id="90aef-202">Below the **Shell** subkey, create one subkey for each verb you want to add.</span></span> <span data-ttu-id="90aef-203">Каждый из этих подразделов будет иметь значение **reg \_ SZ** , заданное для отображаемой строки команды.</span><span class="sxs-lookup"><span data-stu-id="90aef-203">Each of these subkeys will have a **REG\_SZ** value set to the verb's display string.</span></span> <span data-ttu-id="90aef-204">Можно опустить отображаемую строку для канонических команд, так как система автоматически отображает правильно локализованную строку.</span><span class="sxs-lookup"><span data-stu-id="90aef-204">You can omit the display string for canonical verbs because the system will automatically display a properly localized string.</span></span> <span data-ttu-id="90aef-205">Если не указать отображаемую строку для неканонических команд, будет отображена строка команды.</span><span class="sxs-lookup"><span data-stu-id="90aef-205">If you omit the display string for noncanonical verbs, the verb string will be displayed.</span></span> <span data-ttu-id="90aef-206">Для каждого подраздела команды создайте подраздел **команды** со значением по умолчанию, равным строке команды.</span><span class="sxs-lookup"><span data-stu-id="90aef-206">For each verb subkey, create a **command** subkey with the default value set to the command string.</span></span>

<span data-ttu-id="90aef-207">На следующем рисунке показано контекстное меню для типа файла МИП, используемого в [типах файлов](fa-file-types.md) и [настраиваемых значков](icon.md).</span><span class="sxs-lookup"><span data-stu-id="90aef-207">The following illustration shows a shortcut menu for the .myp file type used in [File Types](fa-file-types.md) and [Customizing Icons](icon.md).</span></span> <span data-ttu-id="90aef-208">Теперь у него есть команды Open, доит, Print и принтто в контекстном меню с доит в качестве глагола по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="90aef-208">It now has open, doit, print, and printto verbs on its shortcut menu, with doit as the default verb.</span></span> <span data-ttu-id="90aef-209">Контекстное меню выглядит следующим образом.</span><span class="sxs-lookup"><span data-stu-id="90aef-209">The shortcut menu looks like this.</span></span>

![снимок экрана настраиваемого контекстного меню](images/context3.jpg)

<span data-ttu-id="90aef-211">Для расширения контекстного меню, показанного на предыдущем рисунке, используются следующие записи реестра:</span><span class="sxs-lookup"><span data-stu-id="90aef-211">The registry entries used to extend the shortcut menu shown in the preceding illustration are:</span></span>

```
HKEY_CLASSES_ROOT
   .myp
      (Default) = MyProgram.1
   MyProgram.1
      (Default) = MyProgram Application
      Shell
         (Default) = doit
         open
            command
               (Default) = C:\MyDir\MyProgram.exe "%1"
         doit
            (Default) = &Do It
            command
               (Default) = C:\MyDir\MyProgram.exe /d "%1"
         print
            command
               (Default) = C:\MyDir\MyProgram.exe /p "%1"
         printto
            command
               (Default) = C:\MyDir\MyProgram.exe /p "%1" "%2" %3 %4
```

<span data-ttu-id="90aef-212">Хотя команда " **Открыть с помощью** " находится выше первого разделителя, она автоматически создается системой и не требует записи реестра.</span><span class="sxs-lookup"><span data-stu-id="90aef-212">Although the **Open With** command is above the first separator, it is automatically created by the system and does not require a registry entry.</span></span> <span data-ttu-id="90aef-213">Система автоматически создает отображаемые имена для канонических команд Open и Print.</span><span class="sxs-lookup"><span data-stu-id="90aef-213">The system automatically creates display names for the canonical verbs open and print.</span></span> <span data-ttu-id="90aef-214">Так как доит не является канонической командой, ей назначается отображаемое имя "&сделать", которое можно выбрать, нажав клавишу D.</span><span class="sxs-lookup"><span data-stu-id="90aef-214">Because doit is not a canonical verb, it is assigned a display name, "&Do It", which can be selected by pressing the D key.</span></span> <span data-ttu-id="90aef-215">Команда принтто не отображается в контекстном меню, но позволяет пользователю печатать файлы путем их перетаскивания на значок принтера.</span><span class="sxs-lookup"><span data-stu-id="90aef-215">The printto verb does not appear on the shortcut menu, but including it allows the user to print files by dropping them on a printer icon.</span></span> <span data-ttu-id="90aef-216">В этом примере %1 представляет имя файла и %2 имя принтера.</span><span class="sxs-lookup"><span data-stu-id="90aef-216">In this example, %1 represents the file name and %2 the printer name.</span></span>

<span data-ttu-id="90aef-217">Команды можно подавлять с помощью параметров политики, добавив значение Суппрессионполици в ключ команды.</span><span class="sxs-lookup"><span data-stu-id="90aef-217">Verbs can be suppressed through policy settings by adding a SuppressionPolicy value to the verb's key.</span></span> <span data-ttu-id="90aef-218">Присвойте параметру Суппрессионполици значение ID политики.</span><span class="sxs-lookup"><span data-stu-id="90aef-218">Set the value of SuppressionPolicy to the policy ID.</span></span> <span data-ttu-id="90aef-219">Если политика включена, команда и связанная с ней запись контекстного меню подавляются.</span><span class="sxs-lookup"><span data-stu-id="90aef-219">If the policy is turned on, the verb and its associated shortcut menu entry are suppressed.</span></span> <span data-ttu-id="90aef-220">Возможные значения идентификатора политики см. в описании перечисления [**ограничений**](/windows/desktop/api/shlobj_core/ne-shlobj_core-restrictions) .</span><span class="sxs-lookup"><span data-stu-id="90aef-220">For possible policy ID values, see the [**RESTRICTIONS**](/windows/desktop/api/shlobj_core/ne-shlobj_core-restrictions) enumeration.</span></span>

## <a name="extending-the-shortcut-menu-for-predefined-shell-objects"></a><span data-ttu-id="90aef-221">Расширение контекстного меню для предопределенных объектов оболочки</span><span class="sxs-lookup"><span data-stu-id="90aef-221">Extending the Shortcut Menu for Predefined Shell Objects</span></span>

<span data-ttu-id="90aef-222">У многих предопределенных объектов оболочки есть контекстные меню, которые можно расширять.</span><span class="sxs-lookup"><span data-stu-id="90aef-222">Many predefined Shell objects have shortcut menus that can be extended.</span></span> <span data-ttu-id="90aef-223">Зарегистрируйте команду практически так же, как при регистрации типов файлов, но используйте имя предопределенного объекта в качестве имени типа файла.</span><span class="sxs-lookup"><span data-stu-id="90aef-223">Register the command in much the same way that you register typical file types, but use the name of the predefined object as the file type name.</span></span>

<span data-ttu-id="90aef-224">Список предопределенных объектов можно найти в разделе *предопределенные объекты оболочки* [Создание обработчиков расширений оболочки](handlers.md).</span><span class="sxs-lookup"><span data-stu-id="90aef-224">A list of predefined objects can be found in the *Predefined Shell Objects* section of [Creating Shell Extension Handlers](handlers.md).</span></span> <span data-ttu-id="90aef-225">Эти предопределенные объекты оболочки, контекстные меню которых можно расширить путем добавления команд в реестр, помечаются в таблице словом "глагол".</span><span class="sxs-lookup"><span data-stu-id="90aef-225">Those predefined Shell objects whose shortcut menus can be extended by adding verbs in the registry are marked in the table with the word "Verb."</span></span>

## <a name="registering-an-application-to-handle-arbitrary-file-types"></a><span data-ttu-id="90aef-226">Регистрация приложения для управления произвольными типами файлов</span><span class="sxs-lookup"><span data-stu-id="90aef-226">Registering an Application to Handle Arbitrary File Types</span></span>

<span data-ttu-id="90aef-227">В предыдущих разделах этого документа обсуждалось, как определить пункты контекстного меню для конкретного типа файлов.</span><span class="sxs-lookup"><span data-stu-id="90aef-227">The preceding sections of this document have discussed how to define shortcut menu items for a particular file type.</span></span> <span data-ttu-id="90aef-228">Помимо прочего, определение контекстного меню позволяет указать, как связанное приложение открывает элемент типа файла.</span><span class="sxs-lookup"><span data-stu-id="90aef-228">Among other things, defining the shortcut menu allows you to specify how the associated application opens a member of the file type.</span></span> <span data-ttu-id="90aef-229">Однако, как описано в разделе [типы файлов](fa-file-types.md), приложения также могут зарегистрировать отдельную процедуру по умолчанию, которая будет использоваться, когда пользователь пытается использовать приложение для открытия типа файла, который не был связан с приложением.</span><span class="sxs-lookup"><span data-stu-id="90aef-229">However, as discussed in [File Types](fa-file-types.md), applications can also register a separate default procedure to be used when a user attempts to use your application to open a file type that you have not associated with the application.</span></span> <span data-ttu-id="90aef-230">Этот раздел описан здесь, поскольку процедура по умолчанию регистрируется практически так же, как и элементы контекстного меню.</span><span class="sxs-lookup"><span data-stu-id="90aef-230">This topic is discussed here because you register the default procedure in much the same way you register shortcut menu items.</span></span>

<span data-ttu-id="90aef-231">Процедура по умолчанию служит двум основным целям.</span><span class="sxs-lookup"><span data-stu-id="90aef-231">The default procedure serves two basic purposes.</span></span> <span data-ttu-id="90aef-232">Одним из них является указание способа вызова приложения для открытия произвольного типа файла.</span><span class="sxs-lookup"><span data-stu-id="90aef-232">One is to specify how your application should be invoked to open an arbitrary file type.</span></span> <span data-ttu-id="90aef-233">Например, можно использовать флаг командной строки, чтобы указать, что открывается неизвестный тип файла.</span><span class="sxs-lookup"><span data-stu-id="90aef-233">You could, for instance, use a command-line flag to indicate that an unknown file type is being opened.</span></span> <span data-ttu-id="90aef-234">Другой целью является определение различных характеристик типа файла, например пунктов контекстного меню и значка.</span><span class="sxs-lookup"><span data-stu-id="90aef-234">The other purpose is to define the various characteristics of a file type, such as the shortcut menu items and the icon.</span></span> <span data-ttu-id="90aef-235">Если пользователь связывает приложение с дополнительным типом файлов, этот тип будет иметь эти характеристики.</span><span class="sxs-lookup"><span data-stu-id="90aef-235">If a user associates your application with an additional file type, that type will have these characteristics.</span></span> <span data-ttu-id="90aef-236">Если дополнительный тип файла был ранее связан с другим приложением, эти характеристики заменят оригиналы.</span><span class="sxs-lookup"><span data-stu-id="90aef-236">If the additional file type was previously associated with another application, these characteristics will replace the originals.</span></span>

<span data-ttu-id="90aef-237">Чтобы зарегистрировать процедуру по умолчанию, поместите те же разделы реестра, которые были созданы для ProgID приложения, в подраздел приложения **\_ \_ корневые приложения классов hKey** \\ .</span><span class="sxs-lookup"><span data-stu-id="90aef-237">To register the default procedure, place the same registry keys you created for your application's ProgID under the application's subkey of **HKEY\_CLASSES\_ROOT**\\**Applications**.</span></span> <span data-ttu-id="90aef-238">Можно также включить значение Фриендляппнаме, чтобы предоставить системе понятное имя приложения.</span><span class="sxs-lookup"><span data-stu-id="90aef-238">You can also include a FriendlyAppName value to provide the system with a friendly name for your application.</span></span> <span data-ttu-id="90aef-239">Понятное имя приложения также может быть извлечено из исполняемого файла, но только в том случае, если значение Фриендляппнаме отсутствует.</span><span class="sxs-lookup"><span data-stu-id="90aef-239">The application's friendly name may also be extracted from its executable file, but only if the FriendlyAppName value is absent.</span></span> <span data-ttu-id="90aef-240">В следующем фрагменте реестра показан пример процедуры по умолчанию для MyProgram.exe, которая определяет понятное имя и несколько пунктов контекстного меню.</span><span class="sxs-lookup"><span data-stu-id="90aef-240">The following registry fragment shows a sample default procedure for MyProgram.exe that defines a friendly name and several shortcut menu items.</span></span> <span data-ttu-id="90aef-241">Командные строки включают флаг/a, чтобы уведомить приложение о том, что он открывает произвольный тип файла.</span><span class="sxs-lookup"><span data-stu-id="90aef-241">The command strings include the /a flag to notify the application that it is opening an arbitrary file type.</span></span> <span data-ttu-id="90aef-242">При включении подраздела **дефаултикон** следует использовать универсальный значок.</span><span class="sxs-lookup"><span data-stu-id="90aef-242">If you include a **DefaultIcon** subkey, you should use a generic icon.</span></span>

```
HKEY_CLASSES_ROOT
   Applications
      MyProgram.exe
         FriendlyAppName = Friendly Name
         shell
            open
               command
                  (Default) = C:\MyDir\MyProgram.exe /a "%1"
            print
               command
                  (Default) = C:\MyDir\MyProgram.exe /a /p "%1"
            printto
               command
                  (Default) = C:\MyDir\MyProgram.exe /a /p "%1" "%2" %3 %4
```

## <a name="extending-the-new-submenu"></a><span data-ttu-id="90aef-243">Расширение нового подменю</span><span class="sxs-lookup"><span data-stu-id="90aef-243">Extending the New Submenu</span></span>

<span data-ttu-id="90aef-244">Когда пользователь открывает меню **файл** в проводнике Windows, первая команда является **новой**.</span><span class="sxs-lookup"><span data-stu-id="90aef-244">When a user opens the **File** menu in Windows Explorer, the first command is **New**.</span></span> <span data-ttu-id="90aef-245">При выборе этой команды отображается подменю.</span><span class="sxs-lookup"><span data-stu-id="90aef-245">Selecting this command displays a submenu.</span></span> <span data-ttu-id="90aef-246">По умолчанию он содержит две команды, **папку** и **ярлык**, которые позволяют пользователям создавать вложенные папки и ярлыки.</span><span class="sxs-lookup"><span data-stu-id="90aef-246">By default, it contains two commands, **Folder** and **Shortcut**, that allow users to create subfolders and shortcuts.</span></span> <span data-ttu-id="90aef-247">Это подменю можно расширить, включив команды создания файлов для любого типа файлов.</span><span class="sxs-lookup"><span data-stu-id="90aef-247">This submenu can be extended to include file creation commands for any file type.</span></span>

<span data-ttu-id="90aef-248">Чтобы добавить команду создания файла в подменю **создать** , файлам приложения должен быть назначен [Тип файла](fa-file-types.md) .</span><span class="sxs-lookup"><span data-stu-id="90aef-248">To add a file-creation command to the **New** submenu, your application's files must have a [file type](fa-file-types.md) associated with them.</span></span> <span data-ttu-id="90aef-249">Включите подраздел **шеллнев** в ключ для расширения имени файла.</span><span class="sxs-lookup"><span data-stu-id="90aef-249">Include a **ShellNew** subkey under the key for the file name extension.</span></span> <span data-ttu-id="90aef-250">Если выбрана команда **создать** меню **файл** , оболочка добавит ее в подменю **создать** .</span><span class="sxs-lookup"><span data-stu-id="90aef-250">When the **File** menu's **New** command is selected, the Shell will add it to the **New** submenu.</span></span> <span data-ttu-id="90aef-251">Отображаемая строка команды будет представлять собой описательную строку, назначенную ProgID программы.</span><span class="sxs-lookup"><span data-stu-id="90aef-251">The command's display string will be the descriptive string that is assigned to the program's ProgID.</span></span>

<span data-ttu-id="90aef-252">Назначьте одно или несколько значений данных подразделу **шеллнев** , чтобы указать метод создания файла.</span><span class="sxs-lookup"><span data-stu-id="90aef-252">Assign one or more data values to the **ShellNew** subkey to specify the file creation method.</span></span> <span data-ttu-id="90aef-253">Доступные значения:</span><span class="sxs-lookup"><span data-stu-id="90aef-253">The available values follow.</span></span>



| <span data-ttu-id="90aef-254">Значение</span><span class="sxs-lookup"><span data-stu-id="90aef-254">Value</span></span>    | <span data-ttu-id="90aef-255">Описание</span><span class="sxs-lookup"><span data-stu-id="90aef-255">Description</span></span>                                                                                                                                                   |
|----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="90aef-256">Команда</span><span class="sxs-lookup"><span data-stu-id="90aef-256">Command</span></span>  | <span data-ttu-id="90aef-257">Выполняет приложение.</span><span class="sxs-lookup"><span data-stu-id="90aef-257">Executes an application.</span></span> <span data-ttu-id="90aef-258">Это значение **reg \_ SZ** , указывающее путь к выполняемому приложению.</span><span class="sxs-lookup"><span data-stu-id="90aef-258">This is a **REG\_SZ** value specifying the path of the application to be executed.</span></span> <span data-ttu-id="90aef-259">Например, можно задать запуск мастера.</span><span class="sxs-lookup"><span data-stu-id="90aef-259">For example, you could set it to launch a wizard.</span></span> |
| <span data-ttu-id="90aef-260">Данные</span><span class="sxs-lookup"><span data-stu-id="90aef-260">Data</span></span>     | <span data-ttu-id="90aef-261">Создает файл, содержащий указанные данные.</span><span class="sxs-lookup"><span data-stu-id="90aef-261">Creates a file containing specified data.</span></span> <span data-ttu-id="90aef-262">Данные — это **\_ двоичное значение reg** с данными файла.</span><span class="sxs-lookup"><span data-stu-id="90aef-262">Data is a **REG\_BINARY** value with the file's data.</span></span> <span data-ttu-id="90aef-263">Данные пропускаются, если указано либо Нуллфиле, либо FileName.</span><span class="sxs-lookup"><span data-stu-id="90aef-263">Data is ignored if either NullFile or FileName is specified.</span></span>  |
| <span data-ttu-id="90aef-264">FileName</span><span class="sxs-lookup"><span data-stu-id="90aef-264">FileName</span></span> | <span data-ttu-id="90aef-265">Создает файл, который является копией указанного файла.</span><span class="sxs-lookup"><span data-stu-id="90aef-265">Creates a file that is a copy of a specified file.</span></span> <span data-ttu-id="90aef-266">FileName — это значение **reg \_ SZ** , которое задает полный путь к копируемому файлу.</span><span class="sxs-lookup"><span data-stu-id="90aef-266">FileName is a **REG\_SZ** value, set to the fully qualified path of the file to be copied.</span></span>                 |
| <span data-ttu-id="90aef-267">нуллфиле</span><span class="sxs-lookup"><span data-stu-id="90aef-267">NullFile</span></span> | <span data-ttu-id="90aef-268">Создает пустой файл.</span><span class="sxs-lookup"><span data-stu-id="90aef-268">Creates an empty file.</span></span> <span data-ttu-id="90aef-269">Нуллфиле не присваивается значение.</span><span class="sxs-lookup"><span data-stu-id="90aef-269">NullFile is not assigned a value.</span></span> <span data-ttu-id="90aef-270">Если указан параметр Нуллфиле, значения данных и имен файлов не учитываются.</span><span class="sxs-lookup"><span data-stu-id="90aef-270">If NullFile is specified, the Data and FileName values are ignored.</span></span>                                  |



 

<span data-ttu-id="90aef-271">На следующем рисунке показано **новое** подменю для типа файла МИП, используемого в качестве примера в [типах файлов](fa-file-types.md) и [настройки значков](icon.md).</span><span class="sxs-lookup"><span data-stu-id="90aef-271">The following illustration shows the **New** submenu for the .myp file type used as an example in [File Types](fa-file-types.md) and [Customizing Icons](icon.md).</span></span> <span data-ttu-id="90aef-272">Теперь у него есть команда **MyProgram Application**.</span><span class="sxs-lookup"><span data-stu-id="90aef-272">It now has a command, **MyProgram Application**.</span></span> <span data-ttu-id="90aef-273">Когда пользователь выбирает **приложение MyProgram** из подменю " **создать** ", оболочка создает файл с именем "New MyProgram Application. МИП" и передает его в MyProgram.exe.</span><span class="sxs-lookup"><span data-stu-id="90aef-273">When a user selects **MyProgram Application** from the **New** submenu, the Shell creates a file named "New MyProgram Application.myp" and passes it to MyProgram.exe.</span></span>

![снимок экрана пользовательского меню "создать"](images/context5.png)

<span data-ttu-id="90aef-275">Запись реестра теперь выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="90aef-275">The registry entry is now as follows:</span></span>

```
HKEY_CLASSES_ROOT
   .myp
      (Default) = MyProgram.1
      MyProgram.1
         ShellNew
            NullFile
   MyProgram.1
      (Default) = MyProgram Application
      DefaultIcon
         (Default) = C:\MyDir\MyProgram.exe,2
      Shell
         (Default) = doit
         open
            command
               (Default) = C:\MyDir\MyProgram.exe "%1"
         doit
            (Default) = &Do It
            command
               (Default) = C:\MyDir\MyProgram.exe /d "%1"
         print
            command
               (Default) = C:\MyDir\MyProgram.exe /p "%1"
         printto
            command
               (Default) = C:\MyDir\MyProgram.exe /p "%1" "%2" %3 %4
```

 

 



