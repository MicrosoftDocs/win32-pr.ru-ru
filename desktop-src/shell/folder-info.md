---
description: В разделе Получение идентификатора папки обсуждаются два подхода к получению указателя объекта пространства имен на список идентификаторов элементов (ПИДЛ).
ms.assetid: c99a2f6c-3144-41ec-ad97-59a30bfec9ab
title: Получение сведений о содержимом папки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f7eb26e9df28af4811e74f2878eebb7af9d5c92a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104997210"
---
# <a name="getting-information-about-the-contents-of-a-folder"></a><span data-ttu-id="09e3e-103">Получение сведений о содержимом папки</span><span class="sxs-lookup"><span data-stu-id="09e3e-103">Getting Information About the Contents of a Folder</span></span>

<span data-ttu-id="09e3e-104">В разделе [Получение идентификатора папки](folder-id.md) обсуждаются два подхода к получению указателя объекта пространства имен на список идентификаторов элементов (Пидл).</span><span class="sxs-lookup"><span data-stu-id="09e3e-104">The [Getting a Folder's ID](folder-id.md) section discussed two approaches to getting a namespace object's pointer to an item identifier list (PIDL).</span></span> <span data-ttu-id="09e3e-105">Один из очевидных вопросов: когда у вас есть ПИДЛ, что можно делать с ним?</span><span class="sxs-lookup"><span data-stu-id="09e3e-105">One obvious question is: Once you have a PIDL, what can you do with it?</span></span> <span data-ttu-id="09e3e-106">Связанный вопрос: что делать, если ни один из подходов не работает или подходит для вашего приложения?</span><span class="sxs-lookup"><span data-stu-id="09e3e-106">A related question is: What if neither approach works, or is suitable for your application?</span></span> <span data-ttu-id="09e3e-107">Ответ на оба вопроса требует более подробного взгляда на то, как реализуется пространство имен.</span><span class="sxs-lookup"><span data-stu-id="09e3e-107">The answer to both questions requires taking a closer look at how the namespace is implemented.</span></span> <span data-ttu-id="09e3e-108">Ключом является интерфейс [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) .</span><span class="sxs-lookup"><span data-stu-id="09e3e-108">The key is the [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface.</span></span>

-   [<span data-ttu-id="09e3e-109">Использование интерфейса Ишеллфолдер</span><span class="sxs-lookup"><span data-stu-id="09e3e-109">Using the IShellFolder Interface</span></span>](#using-the-ishellfolder-interface)
-   [<span data-ttu-id="09e3e-110">Перечисление содержимого папки</span><span class="sxs-lookup"><span data-stu-id="09e3e-110">Enumerating the Contents of a Folder</span></span>](#enumerating-the-contents-of-a-folder)
-   [<span data-ttu-id="09e3e-111">Определение отображаемых имен и других свойств</span><span class="sxs-lookup"><span data-stu-id="09e3e-111">Determining Display Names and Other Properties</span></span>](#determining-display-names-and-other-properties)
-   [<span data-ttu-id="09e3e-112">Получение указателя на интерфейс Ишеллфолдер вложенной папки</span><span class="sxs-lookup"><span data-stu-id="09e3e-112">Getting a Pointer to a Subfolder's IShellFolder Interface</span></span>](#getting-a-pointer-to-a-subfolders-ishellfolder-interface)
-   [<span data-ttu-id="09e3e-113">Определение родительской папки объекта</span><span class="sxs-lookup"><span data-stu-id="09e3e-113">Determining an Object's Parent Folder</span></span>](#determining-an-objects-parent-folder)

## <a name="using-the-ishellfolder-interface"></a><span data-ttu-id="09e3e-114">Использование интерфейса Ишеллфолдер</span><span class="sxs-lookup"><span data-stu-id="09e3e-114">Using the IShellFolder Interface</span></span>

<span data-ttu-id="09e3e-115">Ранее в этой документации папки пространства имен назывались объектами.</span><span class="sxs-lookup"><span data-stu-id="09e3e-115">Earlier in this documentation, namespace folders were referred to as objects.</span></span> <span data-ttu-id="09e3e-116">Хотя в этот момент термин использовался в слабом смысле, на самом деле это верно и в строгом смысле.</span><span class="sxs-lookup"><span data-stu-id="09e3e-116">Although, at that point, the term was used in a loose sense, it is actually true in a strict sense as well.</span></span> <span data-ttu-id="09e3e-117">Каждая папка пространства имен представлена объектом модели COM.</span><span class="sxs-lookup"><span data-stu-id="09e3e-117">Every namespace folder is represented by a Component Object Model (COM) object.</span></span> <span data-ttu-id="09e3e-118">Каждый объект Folder предоставляет ряд интерфейсов, которые можно использовать для самых разных задач.</span><span class="sxs-lookup"><span data-stu-id="09e3e-118">Each folder object exposes a number of interfaces that can be used for a wide variety of tasks.</span></span> <span data-ttu-id="09e3e-119">Некоторые интерфейсы, которые являются необязательными, могут не предоставляться всеми папками.</span><span class="sxs-lookup"><span data-stu-id="09e3e-119">Some interfaces that are optional may not be exposed by all folders.</span></span> <span data-ttu-id="09e3e-120">Однако все папки должны предоставлять фундаментальный интерфейс [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder).</span><span class="sxs-lookup"><span data-stu-id="09e3e-120">However, all folders must expose the fundamental interface, [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder).</span></span>

<span data-ttu-id="09e3e-121">Первым шагом при использовании объекта Folder является получение указателя на его интерфейс [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) .</span><span class="sxs-lookup"><span data-stu-id="09e3e-121">The first step in using a folder object is to retrieve a pointer to its [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface.</span></span> <span data-ttu-id="09e3e-122">Помимо предоставления доступа к другим интерфейсам объекта, **ишеллфолдер** предоставляет группу методов, обрабатывающих ряд общих задач, некоторые из которых обсуждаются в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="09e3e-122">In addition to providing access to the object's other interfaces, **IShellFolder** exposes a group of methods that handle a number of common tasks, several of which are discussed in this section.</span></span>

<span data-ttu-id="09e3e-123">Чтобы получить указатель на интерфейс [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) объекта пространства имен, необходимо сначала вызвать [**шжетдесктопфолдер**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetdesktopfolder).</span><span class="sxs-lookup"><span data-stu-id="09e3e-123">To retrieve a pointer to a namespace object's [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface, you must first call [**SHGetDesktopFolder**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetdesktopfolder).</span></span> <span data-ttu-id="09e3e-124">Эта функция возвращает указатель на интерфейс **ишеллфолдер** корня пространства имен, рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="09e3e-124">This function returns a pointer to the **IShellFolder** interface of the namespace root, the desktop.</span></span> <span data-ttu-id="09e3e-125">Когда у вас есть интерфейс **ишеллфолдер** рабочего стола, существует множество способов продолжения.</span><span class="sxs-lookup"><span data-stu-id="09e3e-125">Once you have the desktop's **IShellFolder** interface, there a variety of ways to proceed.</span></span>

<span data-ttu-id="09e3e-126">Если у вас уже есть ПИДЛ интересующей вас папки — например, путем вызова [**шжетфолдерлокатион**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderlocation)— вы можете извлечь его интерфейс [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) , вызвав метод [**ишеллфолдер:: биндтубжект**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject) рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="09e3e-126">If you already have the PIDL of the folder you are interested in—for instance, by calling [**SHGetFolderLocation**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderlocation)—you can retrieve its [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface by calling the desktop's [**IShellFolder::BindToObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject) method.</span></span> <span data-ttu-id="09e3e-127">Если у вас есть путь к объекту файловой системы, необходимо сначала получить его ПИДЛ, вызвав метод [**ишеллфолдер::P арседисплайнаме**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) рабочего стола, а затем вызвать **Ишеллфолдер:: биндтубжект**.</span><span class="sxs-lookup"><span data-stu-id="09e3e-127">If you have the path of a file system object, you must first obtain its PIDL by calling the desktop's [**IShellFolder::ParseDisplayName**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-parsedisplayname) method and then call **IShellFolder::BindToObject**.</span></span> <span data-ttu-id="09e3e-128">Если ни один из этих подходов не применим, можно использовать другие методы **ишеллфолдер** для навигации по пространству имен.</span><span class="sxs-lookup"><span data-stu-id="09e3e-128">If neither of these approaches is applicable, you can use other **IShellFolder** methods to navigate the namespace.</span></span> <span data-ttu-id="09e3e-129">Дополнительные сведения см. [в разделе Навигация по пространству имен](navigate.md).</span><span class="sxs-lookup"><span data-stu-id="09e3e-129">For more information, see [Navigating the Namespace](navigate.md).</span></span>

## <a name="enumerating-the-contents-of-a-folder"></a><span data-ttu-id="09e3e-130">Перечисление содержимого папки</span><span class="sxs-lookup"><span data-stu-id="09e3e-130">Enumerating the Contents of a Folder</span></span>

<span data-ttu-id="09e3e-131">Первое, что обычно нужно сделать с папкой, — узнать, что она содержит.</span><span class="sxs-lookup"><span data-stu-id="09e3e-131">The first thing you usually want to do with a folder is to find out what it contains.</span></span> <span data-ttu-id="09e3e-132">Сначала необходимо вызвать метод [**ишеллфолдер:: енумобжектс**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-enumobjects) папки.</span><span class="sxs-lookup"><span data-stu-id="09e3e-132">You must first call the folder's [**IShellFolder::EnumObjects**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-enumobjects) method.</span></span> <span data-ttu-id="09e3e-133">Папка создаст стандартный объект перечисления OLE и возвратит его интерфейс [**иенумидлист**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) .</span><span class="sxs-lookup"><span data-stu-id="09e3e-133">The folder will create a standard OLE enumeration object and return its [**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) interface.</span></span> <span data-ttu-id="09e3e-134">Этот интерфейс предоставляет четыре стандартных метода:[**клонирование**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-clone), [**следующий**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next), [**Сброс**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-reset)и [**пропуск**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-skip)—, которые можно использовать для перечисления содержимого папки.</span><span class="sxs-lookup"><span data-stu-id="09e3e-134">This interface exposes four standard methods—[**Clone**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-clone), [**Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next), [**Reset**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-reset), and [**Skip**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-skip)—that can be used to enumerate the contents of the folder.</span></span>

<span data-ttu-id="09e3e-135">Базовая процедура перечисления содержимого папки:</span><span class="sxs-lookup"><span data-stu-id="09e3e-135">The basic procedure for enumerating a folder's contents is:</span></span>

1.  <span data-ttu-id="09e3e-136">Вызовите метод Folders [**ишеллфолдер:: енумобжектс**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-enumobjects) , чтобы получить указатель на интерфейс [**иенумидлист**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) объекта перечисления.</span><span class="sxs-lookup"><span data-stu-id="09e3e-136">Call the folders [**IShellFolder::EnumObjects**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-enumobjects) method to retrieve a pointer to an enumeration object's [**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) interface.</span></span>
2.  <span data-ttu-id="09e3e-137">Передайте нераспределенный ПИДЛ в [**иенумидлист:: Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next).</span><span class="sxs-lookup"><span data-stu-id="09e3e-137">Pass an unallocated PIDL to [**IEnumIDList::Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next).</span></span> <span data-ttu-id="09e3e-138">**Далее** необходимо выделить Пидл, но приложение должно освободить его, когда оно больше не требуется.</span><span class="sxs-lookup"><span data-stu-id="09e3e-138">**Next** takes care of allocating the PIDL, but the application must deallocate it when it is no longer needed.</span></span> <span data-ttu-id="09e3e-139">При **следующем** возврате Пидл будет содержать только идентификатор элемента объекта и завершающие символы **null** .</span><span class="sxs-lookup"><span data-stu-id="09e3e-139">When **Next** returns, the PIDL will contain just the object's item ID and the terminating **NULL** characters.</span></span> <span data-ttu-id="09e3e-140">Иными словами, это одноуровневая ПИДЛ, относительная для папки, а не полный ПИДЛ.</span><span class="sxs-lookup"><span data-stu-id="09e3e-140">In other words, it is a single-level PIDL, relative to the folder, not a fully qualified PIDL.</span></span>
3.  <span data-ttu-id="09e3e-141">Повторите шаг 2 до [**следующего**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next) возврата значения \_ false, чтобы указать, что были перечислены все элементы.</span><span class="sxs-lookup"><span data-stu-id="09e3e-141">Repeat step 2 until [**Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next) returns S\_FALSE to indicate that all items have been enumerated.</span></span>
4.  <span data-ttu-id="09e3e-142">Вызовите метод **иенумидлист:: Release** , чтобы освободить объект перечисления.</span><span class="sxs-lookup"><span data-stu-id="09e3e-142">Call **IEnumIDList::Release** to release the enumeration object.</span></span>

> [!Note]  
> <span data-ttu-id="09e3e-143">Важно отследить, работаете ли вы с полным или относительным ПИДЛ.</span><span class="sxs-lookup"><span data-stu-id="09e3e-143">It is important to keep track of whether you are working with a full or relative PIDL.</span></span> <span data-ttu-id="09e3e-144">Некоторые функции и методы принимают значение, но другие принимают только одну или другую.</span><span class="sxs-lookup"><span data-stu-id="09e3e-144">Some functions and methods will accept either, but others will only take one or the other.</span></span>

 

<span data-ttu-id="09e3e-145">Оставшиеся три метода [**иенумидлист**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) ([**Сброс**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-reset), [**пропуск**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-skip)и [**клонирование**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-clone)) полезны, если необходимо выполнить повторяющиеся перечисления папки.</span><span class="sxs-lookup"><span data-stu-id="09e3e-145">The remaining three [**IEnumIDList**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ienumidlist) methods ([**Reset**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-reset), [**Skip**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-skip), and [**Clone**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-clone)) are useful if you need to do repeated enumerations of the folder.</span></span> <span data-ttu-id="09e3e-146">Они позволяют сбрасывать перечисление, пропускать один или несколько объектов и создавать копию объекта перечисления для сохранения его состояния.</span><span class="sxs-lookup"><span data-stu-id="09e3e-146">They allow you to reset the enumeration, skip one or more objects, and make a copy of the enumeration object to preserve its state.</span></span>

## <a name="determining-display-names-and-other-properties"></a><span data-ttu-id="09e3e-147">Определение отображаемых имен и других свойств</span><span class="sxs-lookup"><span data-stu-id="09e3e-147">Determining Display Names and Other Properties</span></span>

<span data-ttu-id="09e3e-148">После перечисления всех PIDL, содержащихся в папке, можно узнать, какие объекты они представляют.</span><span class="sxs-lookup"><span data-stu-id="09e3e-148">Once you have enumerated all the PIDLs that are contained by a folder, you can find out what sort of objects they represent.</span></span> <span data-ttu-id="09e3e-149">Интерфейс [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) предоставляет ряд полезных методов, два из которых обсуждаются здесь.</span><span class="sxs-lookup"><span data-stu-id="09e3e-149">The [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface provides a number of useful methods, two of which are discussed here.</span></span> <span data-ttu-id="09e3e-150">Другие методы **ишеллфолдер** и другие интерфейсы папок оболочки обсуждаются далее.</span><span class="sxs-lookup"><span data-stu-id="09e3e-150">Other **IShellFolder** methods and other Shell folder interfaces are discussed later.</span></span>

<span data-ttu-id="09e3e-151">Одним из наиболее полезных свойств является отображаемое имя объекта.</span><span class="sxs-lookup"><span data-stu-id="09e3e-151">One of the most useful properties is the object's display name.</span></span> <span data-ttu-id="09e3e-152">Чтобы получить отображаемое имя объекта, передайте его ПИДЛ в [**ишеллфолдер:: жетдисплайнамеоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof).</span><span class="sxs-lookup"><span data-stu-id="09e3e-152">To retrieve the display name of an object, pass its PIDL to [**IShellFolder::GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof).</span></span> <span data-ttu-id="09e3e-153">Хотя объект может находиться в любом месте под родительской папкой в пространстве имен, его ПИДЛ должен быть указан относительно папки.</span><span class="sxs-lookup"><span data-stu-id="09e3e-153">Although the object can be located anywhere below the parent folder in the namespace, its PIDL must be relative to the folder.</span></span>

<span data-ttu-id="09e3e-154">[**Ишеллфолдер:: жетдисплайнамеоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) Возвращает отображаемое имя как часть структуры [**стррет**](/windows/desktop/api/Shtypes/ns-shtypes-strret) .</span><span class="sxs-lookup"><span data-stu-id="09e3e-154">[**IShellFolder::GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) returns the display name as part of of a [**STRRET**](/windows/desktop/api/Shtypes/ns-shtypes-strret) structure.</span></span> <span data-ttu-id="09e3e-155">Поскольку извлечение отображаемого имени из структуры **стррет** может быть немного сложным, оболочка предоставляет две функции, которые выполняют задание, [**стрреттостр**](/windows/desktop/api/Shlwapi/nf-shlwapi-strrettostra) и [**стрреттобуф**](/windows/desktop/api/Shlwapi/nf-shlwapi-strrettobufa).</span><span class="sxs-lookup"><span data-stu-id="09e3e-155">Because extracting the display name from a **STRRET** structure can be a little tricky, the Shell provides two functions that do the job for you, [**StrRetToStr**](/windows/desktop/api/Shlwapi/nf-shlwapi-strrettostra) and [**StrRetToBuf**](/windows/desktop/api/Shlwapi/nf-shlwapi-strrettobufa).</span></span> <span data-ttu-id="09e3e-156">Обе функции принимают структуру **стррет** и возвращают отображаемое имя как обычную строку.</span><span class="sxs-lookup"><span data-stu-id="09e3e-156">Both functions take a **STRRET** structure, and return the display name as a normal string.</span></span> <span data-ttu-id="09e3e-157">Они отличаются только тем, как выделяется строка.</span><span class="sxs-lookup"><span data-stu-id="09e3e-157">They differ only in how the string is allocated.</span></span>

<span data-ttu-id="09e3e-158">В дополнение к отображаемому имени объект может иметь ряд атрибутов, например, является ли он папкой или может ли он быть перемещен.</span><span class="sxs-lookup"><span data-stu-id="09e3e-158">In addition to its display name, an object can have a number of attributes, such as whether it is a folder or whether it can be moved.</span></span> <span data-ttu-id="09e3e-159">Атрибуты объекта можно получить, передав его ПИДЛ в [**ишеллфолдер:: жетаттрибутесоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof).</span><span class="sxs-lookup"><span data-stu-id="09e3e-159">You can retrieve an object's attributes by passing its PIDL to [**IShellFolder::GetAttributesOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof).</span></span> <span data-ttu-id="09e3e-160">Полный список атрибутов довольно большой, поэтому вы увидите ссылку для получения дополнительных сведений.</span><span class="sxs-lookup"><span data-stu-id="09e3e-160">The complete list of attributes is quite large, so you should see the reference for details.</span></span> <span data-ttu-id="09e3e-161">Обратите внимание, что ПИДЛ, передаваемый в **жетаттрибутесоф** , должны быть одноуровневые.</span><span class="sxs-lookup"><span data-stu-id="09e3e-161">Note that the PIDL that you pass to **GetAttributesOf** must be single-level.</span></span> <span data-ttu-id="09e3e-162">В частности, **ишеллфолдер:: жетаттрибутесоф** будет принимать PIDL, возвращаемый [**Иенумидлист:: Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next).</span><span class="sxs-lookup"><span data-stu-id="09e3e-162">In particular, **IShellFolder::GetAttributesOf** will accept the PIDLs returned by [**IEnumIDList::Next**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ienumidlist-next).</span></span> <span data-ttu-id="09e3e-163">Можно передать массив PIDL, и **жетаттрибутесоф** будет возвращать эти атрибуты, которые все объекты в массиве являются общими.</span><span class="sxs-lookup"><span data-stu-id="09e3e-163">You can pass in an array of PIDLs, and **GetAttributesOf** will return those attributes that all objects in the array have in common.</span></span>

<span data-ttu-id="09e3e-164">При наличии полного пути или ПИДЛ объекта [**шжетфилеинфо**](/windows/desktop/api/Shellapi/nf-shellapi-shgetfileinfoa) предоставляет простой способ получения сведений о объекте, который достаточно для многих целей.</span><span class="sxs-lookup"><span data-stu-id="09e3e-164">If you have an object's fully qualified path or PIDL, [**SHGetFileInfo**](/windows/desktop/api/Shellapi/nf-shellapi-shgetfileinfoa) provides a simple way to retrieve information about an object that is sufficient for many purposes.</span></span> <span data-ttu-id="09e3e-165">**Шжетфилеинфо** принимает полный путь или Пидл и возвращает разнообразные сведения об объекте, включая:</span><span class="sxs-lookup"><span data-stu-id="09e3e-165">**SHGetFileInfo** takes a fully qualified path or PIDL, and returns a variety of information about the object including:</span></span>

-   <span data-ttu-id="09e3e-166">Отображаемое имя объекта</span><span class="sxs-lookup"><span data-stu-id="09e3e-166">The object's display name</span></span>
-   <span data-ttu-id="09e3e-167">Атрибуты объекта</span><span class="sxs-lookup"><span data-stu-id="09e3e-167">The object's attributes</span></span>
-   <span data-ttu-id="09e3e-168">Дескрипторы значков объекта</span><span class="sxs-lookup"><span data-stu-id="09e3e-168">Handles to the object's icons</span></span>
-   <span data-ttu-id="09e3e-169">Маркер списка системных образов</span><span class="sxs-lookup"><span data-stu-id="09e3e-169">A handle to the system image list</span></span>
-   <span data-ttu-id="09e3e-170">Путь к файлу, содержащему значок объекта</span><span class="sxs-lookup"><span data-stu-id="09e3e-170">The path of the file containing the object's icon</span></span>

## <a name="getting-a-pointer-to-a-subfolders-ishellfolder-interface"></a><span data-ttu-id="09e3e-171">Получение указателя на интерфейс Ишеллфолдер вложенной папки</span><span class="sxs-lookup"><span data-stu-id="09e3e-171">Getting a Pointer to a Subfolder's IShellFolder Interface</span></span>

<span data-ttu-id="09e3e-172">Чтобы определить, содержит ли ваша папка вложенные папки, вызовите [**ишеллфолдер:: жетаттрибутесоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof) и проверьте, \_ установлен ли флаг папки сфгао.</span><span class="sxs-lookup"><span data-stu-id="09e3e-172">You can determine whether your folder contains any subfolders by calling [**IShellFolder::GetAttributesOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof) and checking to see if the SFGAO\_FOLDER flag is set.</span></span> <span data-ttu-id="09e3e-173">Если объект является папкой, можно выполнить привязку к нему, что дает указатель на его интерфейс [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) .</span><span class="sxs-lookup"><span data-stu-id="09e3e-173">If an object is a folder, you can bind to it, which provides you with a pointer to its [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface.</span></span>

<span data-ttu-id="09e3e-174">Чтобы выполнить привязку к вложенной папке, вызовите метод [**ишеллфолдер:: биндтубжект**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject) родительской папки.</span><span class="sxs-lookup"><span data-stu-id="09e3e-174">To bind to a subfolder, call the parent folder's [**IShellFolder::BindToObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-bindtoobject) method.</span></span> <span data-ttu-id="09e3e-175">Этот метод принимает ПИДЛ вложенной папки и возвращает указатель на его интерфейс [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) .</span><span class="sxs-lookup"><span data-stu-id="09e3e-175">This method takes the subfolder's PIDL and returns a pointer to its [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface.</span></span> <span data-ttu-id="09e3e-176">Получив этот указатель, можно использовать методы **ишеллфолдер** для перечисления содержимого вложенных папок, определения их свойств и т. д.</span><span class="sxs-lookup"><span data-stu-id="09e3e-176">Once you have this pointer, you can use the **IShellFolder** methods to enumerate the subfolders contents, determine their properties, and so on.</span></span>

## <a name="determining-an-objects-parent-folder"></a><span data-ttu-id="09e3e-177">Определение родительской папки объекта</span><span class="sxs-lookup"><span data-stu-id="09e3e-177">Determining an Object's Parent Folder</span></span>

<span data-ttu-id="09e3e-178">Если у вас есть объект ПИДЛ, может потребоваться обработчик для одного из интерфейсов, предоставляемых его родительской папкой.</span><span class="sxs-lookup"><span data-stu-id="09e3e-178">If you have an object's PIDL, you may need a handle to one of the interfaces exposed by its parent folder.</span></span> <span data-ttu-id="09e3e-179">Например, если необходимо определить отображаемое имя, связанное с ПИДЛ с помощью [**ишеллфолдер:: жетдисплайнамеоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof), необходимо сначала получить интерфейс [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) родительского объекта.</span><span class="sxs-lookup"><span data-stu-id="09e3e-179">For example, if you want to determine the display name associated with a PIDL by using [**IShellFolder::GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof), you must first retrieve the [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface of the object's parent.</span></span> <span data-ttu-id="09e3e-180">Это можно сделать с помощью методик, описанных в предыдущих разделах.</span><span class="sxs-lookup"><span data-stu-id="09e3e-180">It is possible to do this with the techniques discussed in the previous sections.</span></span> <span data-ttu-id="09e3e-181">Однако гораздо более простой подход заключается в использовании функции Shell, [**шбиндтопарент**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shbindtoparent).</span><span class="sxs-lookup"><span data-stu-id="09e3e-181">However, a much simpler approach is to use the Shell function, [**SHBindToParent**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shbindtoparent).</span></span> <span data-ttu-id="09e3e-182">Эта функция принимает полное ПИДЛ объекта и возвращает указанный указатель интерфейса в родительской папке.</span><span class="sxs-lookup"><span data-stu-id="09e3e-182">This function takes the fully qualified PIDL of an object and returns a specified interface pointer on the parent folder.</span></span> <span data-ttu-id="09e3e-183">При необходимости он также возвращает одноуровневый ПИДЛ элемента для использования в таких методах, как [**ишеллфолдер:: жетаттрибутесоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof).</span><span class="sxs-lookup"><span data-stu-id="09e3e-183">Optionally, it also returns the item's single-level PIDL for use in methods such as [**IShellFolder::GetAttributesOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getattributesof).</span></span>

<span data-ttu-id="09e3e-184">В следующем примере консольное приложение получает ПИДЛ из специальной папки системы и возвращает ее отображаемое имя.</span><span class="sxs-lookup"><span data-stu-id="09e3e-184">The following sample console application retrieves the PIDL of the System special folder and returns its display name.</span></span>


```
#include <shlobj.h>
#include <shlwapi.h>
#include <iostream.h>
#include <objbase.h>

int main()
{
    IShellFolder *psfParent = NULL;
    LPITEMIDLIST pidlSystem = NULL;
    LPCITEMIDLIST pidlRelative = NULL;
    STRRET strDispName;
    TCHAR szDisplayName[MAX_PATH];
    HRESULT hr;

    hr = SHGetFolderLocation(NULL, CSIDL_SYSTEM, NULL, NULL, &pidlSystem);

    hr = SHBindToParent(pidlSystem, IID_IShellFolder, (void **) &psfParent, &pidlRelative);

    if(SUCCEEDED(hr))
    {
        hr = psfParent->GetDisplayNameOf(pidlRelative, SHGDN_NORMAL, &strDispName);
        hr = StrRetToBuf(&strDispName, pidlSystem, szDisplayName, sizeof(szDisplayName));
        cout << "SHGDN_NORMAL - " <<szDisplayName << '\n';
    }

    psfParent->Release();
    CoTaskMemFree(pidlSystem);

    return 0;
}
```



<span data-ttu-id="09e3e-185">Сначала приложение использует [**шжетфолдерлокатион**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderlocation) для получения Пидл системной папки.</span><span class="sxs-lookup"><span data-stu-id="09e3e-185">The application first uses [**SHGetFolderLocation**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderlocation) to retrieve the System folder's PIDL.</span></span> <span data-ttu-id="09e3e-186">Затем он вызывает [**шбиндтопарент**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shbindtoparent), который возвращает указатель на интерфейс [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) родительской папки и Пидл системной папки относительно ее родителя.</span><span class="sxs-lookup"><span data-stu-id="09e3e-186">It then calls [**SHBindToParent**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shbindtoparent), which returns a pointer to the parent folder's [**IShellFolder**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) interface, and the System folder's PIDL relative to its parent.</span></span> <span data-ttu-id="09e3e-187">Затем он использует метод [**ишеллфолдер:: жетдисплайнамеоф**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) родительской папки для получения отображаемого имени системной папки.</span><span class="sxs-lookup"><span data-stu-id="09e3e-187">It then uses the parent folder's [**IShellFolder::GetDisplayNameOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-getdisplaynameof) method to retrieve the display name of the System folder.</span></span> <span data-ttu-id="09e3e-188">Поскольку **жетдисплайнамеоф** возвращает структуру [**стррет**](/windows/desktop/api/Shtypes/ns-shtypes-strret) , [**стрреттобуф**](/windows/desktop/api/Shlwapi/nf-shlwapi-strrettobufa) используется для преобразования отображаемого имени в обычную строку.</span><span class="sxs-lookup"><span data-stu-id="09e3e-188">Because **GetDisplayNameOf** returns a [**STRRET**](/windows/desktop/api/Shtypes/ns-shtypes-strret) structure, [**StrRetToBuf**](/windows/desktop/api/Shlwapi/nf-shlwapi-strrettobufa) is used to convert the display name into a normal string.</span></span> <span data-ttu-id="09e3e-189">После отображения отображаемого имени указатели интерфейса освобождаются и система ПИДЛ освобождена.</span><span class="sxs-lookup"><span data-stu-id="09e3e-189">After displaying the display name, the interface pointers are released and the System PIDL freed.</span></span> <span data-ttu-id="09e3e-190">Обратите внимание, что не следует освобождать относительные ПИДЛ, возвращенные **шбиндтопарент**.</span><span class="sxs-lookup"><span data-stu-id="09e3e-190">Note that you must not free the relative PIDL returned by **SHBindToParent**.</span></span>

 

 
