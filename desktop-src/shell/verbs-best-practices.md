---
description: Рекомендации по работе с обработчиками контекстного меню и несколькими глаголами при реализации пользовательского формата файлов в оболочке Windows.
title: Рекомендации по работе с обработчиками контекстного меню и несколькими командами
ms.topic: article
ms.date: 05/31/2018
ms.assetid: 4D352ECB-6214-4f6e-A3E5-F79E154D090A
api_name: ''
api_type: ''
api_location: ''
topic_type:
- kbArticle
ms.openlocfilehash: 14ec2e8915aa1df47ca21c6436ec963be3f590f5
ms.sourcegitcommit: 91530c19d26ba4c57a6af1f37b57f211f580464e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/19/2021
ms.locfileid: "112396449"
---
# <a name="best-practices-for-shortcut-menu-handlers-and-multiple-verbs"></a><span data-ttu-id="b30c4-103">Рекомендации по работе с обработчиками контекстного меню и несколькими командами</span><span class="sxs-lookup"><span data-stu-id="b30c4-103">Best Practices for Shortcut Menu Handlers and Multiple Verbs</span></span>

<span data-ttu-id="b30c4-104">Этот раздел организован следующим образом:</span><span class="sxs-lookup"><span data-stu-id="b30c4-104">This topic is organized as follows:</span></span>

-   [<span data-ttu-id="b30c4-105">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="b30c4-105">Best Practices</span></span>](#best-practices-for-shortcut-menu-handlers-and-multiple-verbs)
    -   [<span data-ttu-id="b30c4-106">Рекомендации по реализации команд</span><span class="sxs-lookup"><span data-stu-id="b30c4-106">Best Practices for Verb Implementations</span></span>](#best-practices-for-verb-implementations)
-   [<span data-ttu-id="b30c4-107">Рекомендации по использованию нескольких команд выбора</span><span class="sxs-lookup"><span data-stu-id="b30c4-107">Best Practices for Multiple Selection Verbs</span></span>](#best-practices-for-multiple-selection-verbs)
    -   [<span data-ttu-id="b30c4-108">Разнородных выбора</span><span class="sxs-lookup"><span data-stu-id="b30c4-108">Heterogenous Selections</span></span>](#heterogenous-selections)
-   [<span data-ttu-id="b30c4-109">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="b30c4-109">Related topics</span></span>](#related-topics)

## <a name="best-practices"></a><span data-ttu-id="b30c4-110">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="b30c4-110">Best Practices</span></span>

<span data-ttu-id="b30c4-111">Статическая команда — это простейшие глаголы для реализации и обеспечения широких функциональных возможностей.</span><span class="sxs-lookup"><span data-stu-id="b30c4-111">Static verb are simplest verbs to implement, and provide rich functionality.</span></span> <span data-ttu-id="b30c4-112">Мы настоятельно рекомендуем реализовать глагол с помощью одного из статических методов глагола.</span><span class="sxs-lookup"><span data-stu-id="b30c4-112">We strongly encourage you to implement a verb using one of the static verb methods.</span></span>

### <a name="best-practices-for-verb-implementations"></a><span data-ttu-id="b30c4-113">Рекомендации по реализации команд</span><span class="sxs-lookup"><span data-stu-id="b30c4-113">Best Practices for Verb Implementations</span></span>

<span data-ttu-id="b30c4-114">В следующем списке представлены рекомендации по реализации команд.</span><span class="sxs-lookup"><span data-stu-id="b30c4-114">The following list represents best practices for verb implementations:</span></span>

-   <span data-ttu-id="b30c4-115">Всегда выберете простейший метод глагола, соответствующий вашим потребностям.</span><span class="sxs-lookup"><span data-stu-id="b30c4-115">Always chose the simplest verb method that meets your needs.</span></span>
-   <span data-ttu-id="b30c4-116">По возможности используйте статический метод глагола.</span><span class="sxs-lookup"><span data-stu-id="b30c4-116">Use a static verb method, if possible.</span></span>
-   <span data-ttu-id="b30c4-117">Не выполняйте ресурсоемких операций или операции ввода-вывода в потоке пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="b30c4-117">Do not perform resource-intensive operations or I/O on the UI thread.</span></span> <span data-ttu-id="b30c4-118">[**Ишеллекстинит:: Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) и [**IContextMenu:: куериконтекстмену**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) должны быть очень консервативными в выполняемой ими работе.</span><span class="sxs-lookup"><span data-stu-id="b30c4-118">Both [**IShellExtInit::Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) and [**IContextMenu::QueryContextMenu**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) need to be very conservative in the work they perform.</span></span> <span data-ttu-id="b30c4-119">[**IContextMenu:: инвокекомманд**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) должен быть выполнен в другом процессе или необходимо создать новый поток, чтобы предотвратить блокировку вызывающего объекта.</span><span class="sxs-lookup"><span data-stu-id="b30c4-119">[**IContextMenu::InvokeCommand**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) must be performed in another process, or you must create a new thread to avoid blocking the caller.</span></span>
-   <span data-ttu-id="b30c4-120">Добавьте в префикс команды с именем независимого поставщика программного обеспечения (ISV) следующим образом: `ISVName.verb` .</span><span class="sxs-lookup"><span data-stu-id="b30c4-120">Prefix verbs with the independent software vendor (ISV) name as follows, `ISVName.verb`.</span></span> <span data-ttu-id="b30c4-121">Использование неквалифицированных имен может привести к конфликтам с несколькими независимыми поставщиками программного обеспечения, которые выбрали одно и то же имя команды.</span><span class="sxs-lookup"><span data-stu-id="b30c4-121">Using unqualified names can result in collisions with multiple ISVs that chose the same verb name.</span></span>
-   <span data-ttu-id="b30c4-122">Всегда используйте идентификатор ProgID для конкретного приложения.</span><span class="sxs-lookup"><span data-stu-id="b30c4-122">Always use an application-specific ProgID.</span></span> <span data-ttu-id="b30c4-123">Поскольку некоторые типы элементов не используют это сопоставление, существует потребность в уникальных именах поставщиков.</span><span class="sxs-lookup"><span data-stu-id="b30c4-123">Because some item types do not use this mapping, there is a need for vendor-unique names.</span></span>
-   <span data-ttu-id="b30c4-124">Расположите пользовательский интерфейс относительно вызывающего метода, но не выполняется в потоке вызывающего.</span><span class="sxs-lookup"><span data-stu-id="b30c4-124">Position the UI relative to the invoking method, but do not run on an invoker thread.</span></span>
-   <span data-ttu-id="b30c4-125">Не допускайте возвращаемое **значение \_ ОК** для канонических глаголов, передаваемых методу [**IContextMenu:: инвокекомманд**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) .</span><span class="sxs-lookup"><span data-stu-id="b30c4-125">Do not accept the return value **S\_OK** for canonical verbs passed to the [**IContextMenu::InvokeCommand**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) method.</span></span> <span data-ttu-id="b30c4-126">Это вызывает сбой при вызове реальной реализации глагола и возвращает код ошибки для канонических команд.</span><span class="sxs-lookup"><span data-stu-id="b30c4-126">Doing so causes a failure for the real verb implementation to be invoked, and returns a failure code for canonical verbs.</span></span> <span data-ttu-id="b30c4-127">Если канонические команды не поддерживаются, возвращается ошибка при обнаружении ненулевого значения HIWORD (Лпверб).</span><span class="sxs-lookup"><span data-stu-id="b30c4-127">If you do not support canonical verbs, then return failure when a nonzero HIWORD(lpVerb) value is encountered.</span></span>
-   <span data-ttu-id="b30c4-128">Избегайте использования **rundll32.exe** в качестве узла для команды.</span><span class="sxs-lookup"><span data-stu-id="b30c4-128">Avoid the use of **rundll32.exe** as the host for your verb.</span></span>
-   <span data-ttu-id="b30c4-129">При реализации [**IContextMenu:: куериконтекстмену**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) необходимо возвращать количество глаголов, добавленных в меню с помощью значения **HRESULT** , используя макрос ресултфромшорт.</span><span class="sxs-lookup"><span data-stu-id="b30c4-129">When implementing [**IContextMenu::QueryContextMenu**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) be sure to return the number of verbs that have been added to the menu through the **HRESULT** value using the ResultFromShort macro.</span></span>
-   <span data-ttu-id="b30c4-130">Если вы зарегистрировались в одной из следующих записей разделов реестра, соблюдайте осторожность и обязательно Зарегистрируйте обработчик для наиболее конкретного типа, чтобы уменьшить возможные непредвиденные последствия.</span><span class="sxs-lookup"><span data-stu-id="b30c4-130">If you register on one of the following registry key entries, then exercise caution and be sure to register your handler on the most specific type to reduce the possibly unintended consequences:</span></span>
    -   <span data-ttu-id="b30c4-131">**\_корневой узел классов hKey \_\\\***</span><span class="sxs-lookup"><span data-stu-id="b30c4-131">**HKEY\_CLASSES\_ROOT\\\***</span></span>
    -   <span data-ttu-id="b30c4-132">**\_ \_ Корневой АЛЛФИЛЕСИСТЕМОБЖЕКТС классов hKey \\**</span><span class="sxs-lookup"><span data-stu-id="b30c4-132">**HKEY\_CLASSES\_ROOT\\AllFileSystemObjects**</span></span>
    -   <span data-ttu-id="b30c4-133">**\_ \_ Корневая папка классов \\ hKey**</span><span class="sxs-lookup"><span data-stu-id="b30c4-133">**HKEY\_CLASSES\_ROOT\\Folder**</span></span>
    -   <span data-ttu-id="b30c4-134">**\_ \_ Корневой каталог классов hKey \\**</span><span class="sxs-lookup"><span data-stu-id="b30c4-134">**HKEY\_CLASSES\_ROOT\\Directory**</span></span>
-   <span data-ttu-id="b30c4-135">Установите ключ **майчанжедефаултмену** , только если предполагается, что в контекстном меню может потребоваться изменить команду по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="b30c4-135">Set the **MayChangeDefaultMenu** key only if you anticipate that you might need to change the default verb in the shortcut menu.</span></span> <span data-ttu-id="b30c4-136">Если обработчик не изменяет команду по умолчанию, этот ключ устанавливать не следует, так как это приводит к тому, что система загружает библиотеку DLL без необходимости.</span><span class="sxs-lookup"><span data-stu-id="b30c4-136">If your handler does not change the default verb, then you should not set this key because doing so causes the system to load your DLL unnecessarily.</span></span>
-   <span data-ttu-id="b30c4-137">Сократите работу, которую вы выполняете в [**ишеллекстинит:: Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize).</span><span class="sxs-lookup"><span data-stu-id="b30c4-137">Minimize the work you perform in [**IShellExtInit::Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize).</span></span> <span data-ttu-id="b30c4-138">Для обработчиков контекстного меню запишите объект данных, переданный в **ишеллекстинит:: Initialize**, а затем обработайте его в [**IContextMenu:: куериконтекстмену**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu)или [**IContextMenu:: инвокекомманд**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand).</span><span class="sxs-lookup"><span data-stu-id="b30c4-138">For shortcut menu handlers, capture the data object passed to **IShellExtInit::Initialize**, and then process it in [**IContextMenu::QueryContextMenu**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu), or [**IContextMenu::InvokeCommand**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand).</span></span>

## <a name="best-practices-for-multiple-selection-verbs"></a><span data-ttu-id="b30c4-139">Рекомендации по использованию нескольких команд выбора</span><span class="sxs-lookup"><span data-stu-id="b30c4-139">Best Practices for Multiple Selection Verbs</span></span>

<span data-ttu-id="b30c4-140">Поскольку количество элементов в сценарии с множественным выбором может быть большим, важно учитывать влияние реализации команд на производительность.</span><span class="sxs-lookup"><span data-stu-id="b30c4-140">Because the number of items in a multi-selection verb scenario can be large, it is important that you consider the performance implications of your verb implementations.</span></span> <span data-ttu-id="b30c4-141">Например, когда пользователь ищет " \* " над областью, включающей большое количество элементов, а затем нажимает кнопку **выбрать все** и щелкаете правой кнопкой мыши, команда представляет выделенный фрагмент, в котором могут содержаться тысячи элементов.</span><span class="sxs-lookup"><span data-stu-id="b30c4-141">For example, when a user searches for "\*" over a scope that includes large numbers of items, and then clicks **Select All** and right-clicks, the verb is presented with a selection that can have thousands of items in it.</span></span> <span data-ttu-id="b30c4-142">В результате глаголы должны учитывать только первый элемент в выделенном фрагменте и общее число элементов.</span><span class="sxs-lookup"><span data-stu-id="b30c4-142">As a result, verbs should only consider the first item in the selection, and the overall item count.</span></span> <span data-ttu-id="b30c4-143">Первый элемент определяется как элемент в верхней части представления или элемент, который пользователь впервые щелкнул правой кнопкой мыши.</span><span class="sxs-lookup"><span data-stu-id="b30c4-143">The first item is defined as either the item at the top of the view, or the item that the user first right-clicked.</span></span>

<span data-ttu-id="b30c4-144">В Windows 7 и более поздних версиях число элементов, передаваемых в команду, ограничено 16 при запросе контекстного меню.</span><span class="sxs-lookup"><span data-stu-id="b30c4-144">In Windows 7 and later, the number of items passed to a verb is limited to 16 when a shortcut menu is queried.</span></span> <span data-ttu-id="b30c4-145">Затем команда создается повторно и повторно инициализируется с полным выделением при вызове этой команды.</span><span class="sxs-lookup"><span data-stu-id="b30c4-145">The verb is then re-created and re-initialized with the full selection when that verb is invoked.</span></span>

<span data-ttu-id="b30c4-146">В некоторых случаях целесообразно учитывать небольшое количество фиксированных элементов.</span><span class="sxs-lookup"><span data-stu-id="b30c4-146">It is appropriate in some cases to consider a small number of fixed items.</span></span> <span data-ttu-id="b30c4-147">Например, для команды "diff" следует учитывать только первые два элемента.</span><span class="sxs-lookup"><span data-stu-id="b30c4-147">For example, it is appropriate for a "diff" verb to consider only the first two items.</span></span> <span data-ttu-id="b30c4-148">Как правило, не нужно проверять каждый элемент в выделенном фрагменте, чтобы определить, является ли он определенным типом, или запросить каждый элемент в выделенном фрагменте для его свойств.</span><span class="sxs-lookup"><span data-stu-id="b30c4-148">Generally, you need not test every item in the selection to see if it is a certain type, or query every item in the selection for its properties.</span></span> <span data-ttu-id="b30c4-149">Взгляните на первый элемент и решите, подходит ли он для добавления команды.</span><span class="sxs-lookup"><span data-stu-id="b30c4-149">Look rather at the first item and decide if it is appropriate to add your verb.</span></span>

### <a name="heterogenous-selections"></a><span data-ttu-id="b30c4-150">Разнородных выбора</span><span class="sxs-lookup"><span data-stu-id="b30c4-150">Heterogenous Selections</span></span>

<span data-ttu-id="b30c4-151">Оптимистичные глаголы автоматически добавляются в вариант множественного выбора, предполагая, что непроверенные элементы могут обрабатываться командой.</span><span class="sxs-lookup"><span data-stu-id="b30c4-151">Optimistic verbs are automatically added in the multi-selection case, assuming that uninspected items can be handled by the verb.</span></span> <span data-ttu-id="b30c4-152">С другой стороны, пессимистические команды не добавляются, если выделенный фрагмент содержит непроверенные элементы и добавляется только в тех случаях, когда количество элементов невелико.</span><span class="sxs-lookup"><span data-stu-id="b30c4-152">In contrast, pessimistic verbs are not added when the selection contains uninspected items, and are only added in cases where the number of items is small.</span></span>

<span data-ttu-id="b30c4-153">Команды стиля проигрывателя должны быть оптимистичными и автоматически пропускать необработанные элементы.</span><span class="sxs-lookup"><span data-stu-id="b30c4-153">Player style verbs should be optimistic, and silently skip the items that are not handled.</span></span> <span data-ttu-id="b30c4-154">Если сбой работы с элементами может привести к потере или путанице данных, команда должна предупредить пользователей об элементах, которые не могут быть обработаны.</span><span class="sxs-lookup"><span data-stu-id="b30c4-154">If a failure to act on items can cause data loss or confusion, then the verb should warn users about items that cannot be processed.</span></span> <span data-ttu-id="b30c4-155">Например, команда Backup должна указывать, что не удалось создать резервную копию некоторых элементов.</span><span class="sxs-lookup"><span data-stu-id="b30c4-155">For example a "backup" verb should indicate that some items could not be backed up.</span></span>

## <a name="related-topics"></a><span data-ttu-id="b30c4-156">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="b30c4-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b30c4-157">Выбор статической или динамической команды для контекстного меню</span><span class="sxs-lookup"><span data-stu-id="b30c4-157">Choosing a Static or Dynamic Verb for your Shortcut Menu</span></span>](shortcut-choose-method.md)
</dt> <dt>

[<span data-ttu-id="b30c4-158">Создание обработчиков контекстного меню</span><span class="sxs-lookup"><span data-stu-id="b30c4-158">Creating Shortcut Menu Handlers</span></span>](context-menu-handlers.md)
</dt> <dt>

[<span data-ttu-id="b30c4-159">Настройка контекстного меню с помощью динамических команд</span><span class="sxs-lookup"><span data-stu-id="b30c4-159">Customizing a Shortcut Menu Using Dynamic Verbs</span></span>](shortcut-menu-using-dynamic-verbs.md)
</dt> <dt>

[<span data-ttu-id="b30c4-160">Контекстное меню (контекст) и обработчики контекстного меню</span><span class="sxs-lookup"><span data-stu-id="b30c4-160">Shortcut (Context) Menus and Shortcut Menu Handlers</span></span>](context-menu.md)
</dt> <dt>

[<span data-ttu-id="b30c4-161">Команды и сопоставления файлов</span><span class="sxs-lookup"><span data-stu-id="b30c4-161">Verbs and File Associations</span></span>](fa-verbs.md)
</dt> <dt>

[<span data-ttu-id="b30c4-162">Справочник по контекстному меню</span><span class="sxs-lookup"><span data-stu-id="b30c4-162">Shortcut Menu Reference</span></span>](context-menu-reference.md)
</dt> </dl>

 

 



