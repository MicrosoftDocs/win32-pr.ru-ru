---
description: В этом разделе предоставляются независимые поставщики программного обеспечения (ISV) с кратким руководством по регистрации и управлению параметрами приложения по умолчанию в Windows Vista и более поздних версиях. Ссылки на более подробные статьи о каждом разделе.
ms.assetid: 649eb20d-07d3-4209-abff-45fc50f05631
title: Управление приложениями по умолчанию
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: de40d6c80aae4005fc015c08ef7bf2907289e795
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103909512"
---
# <a name="managing-default-applications"></a><span data-ttu-id="4353b-104">Управление приложениями по умолчанию</span><span class="sxs-lookup"><span data-stu-id="4353b-104">Managing Default Applications</span></span>

<span data-ttu-id="4353b-105">Функция **настройки доступа к программам и параметров по умолчанию** (SPAD) была добавлена в Windows XP и более поздних версиях Windows для управления параметрами по умолчанию для каждого компьютера.</span><span class="sxs-lookup"><span data-stu-id="4353b-105">The **Set Program Access and Computer Defaults** (SPAD) feature was added to Windows XP and later versions of Windows to manage per-computer defaults.</span></span> <span data-ttu-id="4353b-106">Помимо SPAD, в Windows Vista появилась концепция приложений по умолчанию для каждого пользователя и элемент **программы по умолчанию** в панели управления.</span><span class="sxs-lookup"><span data-stu-id="4353b-106">In addition to SPAD, Windows Vista introduced the concept of per-user default applications and the **Default Programs** item in Control Panel.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="4353b-107">Этот раздел не относится к Windows 10.</span><span class="sxs-lookup"><span data-stu-id="4353b-107">This topic does not apply for Windows 10.</span></span> <span data-ttu-id="4353b-108">Способ изменения связей файлов по умолчанию в Windows 10.</span><span class="sxs-lookup"><span data-stu-id="4353b-108">The way that default file associations work changed in Windows 10.</span></span> <span data-ttu-id="4353b-109">Дополнительные сведения см. в разделе об **изменениях в статье обработка приложений по умолчанию** в [этой записи](https://blogs.windows.com/bloggingwindows/2015/05/20/announcing-windows-10-insider-preview-build-10122-for-pcs/)в Windows 10.</span><span class="sxs-lookup"><span data-stu-id="4353b-109">For more information, see the section on **Changes to how Windows 10 handles default apps** in [this post](https://blogs.windows.com/bloggingwindows/2015/05/20/announcing-windows-10-insider-preview-build-10122-for-pcs/).</span></span>

 

<span data-ttu-id="4353b-110">Параметры по умолчанию для отдельных пользователей зависят от конкретной учетной записи пользователя в системе.</span><span class="sxs-lookup"><span data-stu-id="4353b-110">Per-user default settings are specific to an individual user account on the system.</span></span> <span data-ttu-id="4353b-111">Если заданы параметры по умолчанию для каждого пользователя, они имеют приоритет над соответствующими параметрами по умолчанию для каждой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="4353b-111">If per-user default settings are present, they take precedence over corresponding per-computer defaults for that account.</span></span> <span data-ttu-id="4353b-112">Начиная с Windows 8, система расширяемости по умолчанию для типов файлов и протоколов является строгой по умолчанию для каждого пользователя и для каждого компьютера не учитывается.</span><span class="sxs-lookup"><span data-stu-id="4353b-112">As of Windows 8, the extensibility system for file type and protocol defaults is strictly per-user and per-computer defaults are ignored.</span></span> <span data-ttu-id="4353b-113">Кроме того, Модуль SPAD был изменен в Windows 8 для установки параметров по умолчанию для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="4353b-113">SPAD also changed in Windows 8 to set per-user defaults.</span></span>

-   <span data-ttu-id="4353b-114">В системах под управлением более ранних версий Windows, чем Windows 8, созданная учетная запись пользователя получает значения по умолчанию для каждого компьютера до тех пор, пока не будут установлены значения по умолчанию для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="4353b-114">On systems running versions of Windows earlier than Windows 8, a newly created user account receives per-computer defaults until per-user defaults are established.</span></span> <span data-ttu-id="4353b-115">В Windows Vista и более поздних версиях пользователи могут использовать элемент **программы по умолчанию** на панели управления, чтобы задать или изменить параметры по умолчанию для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="4353b-115">In Windows Vista and later, users can use the **Default Programs** item in Control Panel to set or change their per-user defaults.</span></span> <span data-ttu-id="4353b-116">Кроме того, при первом запуске приложения значения по умолчанию для каждого пользователя можно задать с помощью рекомендаций, приведенных в разделе [первый запуск приложения и параметры по умолчанию](#application-first-run-and-defaults) .</span><span class="sxs-lookup"><span data-stu-id="4353b-116">In addition, when an application is run for the first time, per-user defaults can be set using the guidelines that follow in the [Application First Run and Defaults](#application-first-run-and-defaults) section.</span></span>
-   <span data-ttu-id="4353b-117">В системах под управлением Windows 8 вновь созданная учетная запись пользователя полагается на параметры по умолчанию для каждого пользователя, начиная с начала, и значения этих параметров по умолчанию при первом запуске, как описано в разделе [первый запуск приложения и параметры по умолчанию](#application-first-run-and-defaults) , больше не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="4353b-117">On systems running Windows 8, a newly created user account relies on per-user defaults from the start and the setting of those defaults on first run as explained in the [Application First Run and Defaults](#application-first-run-and-defaults) section is no longer supported.</span></span>

<span data-ttu-id="4353b-118">Приложение должно быть зарегистрировано как в SPAD, так и в программе по умолчанию, которое предлагается как программа по умолчанию в Windows Vista и более поздних версиях.</span><span class="sxs-lookup"><span data-stu-id="4353b-118">An application must register with both SPAD and the Default Programs feature to be offered as the default program in Windows Vista and later.</span></span>

<span data-ttu-id="4353b-119">В этом разделе предоставляются независимые поставщики программного обеспечения (ISV) с кратким руководством по регистрации и управлению параметрами приложения по умолчанию в Windows Vista и более поздних версиях.</span><span class="sxs-lookup"><span data-stu-id="4353b-119">This topic provides independent software vendors (ISVs) with a quick guide to the steps necessary to register and manage application defaults in Windows Vista and later.</span></span> <span data-ttu-id="4353b-120">Ссылки на более подробные статьи о каждом разделе.</span><span class="sxs-lookup"><span data-stu-id="4353b-120">Links are provided to more in-depth articles about each section's topic.</span></span>

-   [<span data-ttu-id="4353b-121">Элемент "программы по умолчанию" в панели управления</span><span class="sxs-lookup"><span data-stu-id="4353b-121">Default Programs Item in Control Panel</span></span>](#default-programs-item-in-control-panel)
-   [<span data-ttu-id="4353b-122">Настройка доступа к программе и параметров по умолчанию для компьютера</span><span class="sxs-lookup"><span data-stu-id="4353b-122">Set Program Access and Computer Defaults</span></span>](#set-program-access-and-computer-defaults)
    -   [<span data-ttu-id="4353b-123">Настройка значений по умолчанию в SPAD</span><span class="sxs-lookup"><span data-stu-id="4353b-123">Setting Defaults in SPAD</span></span>](#setting-defaults-in-spad)
    -   [<span data-ttu-id="4353b-124">Скрыть доступ в SPAD</span><span class="sxs-lookup"><span data-stu-id="4353b-124">Hide Access in SPAD</span></span>](#hide-access-in-spad)
-   [<span data-ttu-id="4353b-125">Регистрация для точек входа приложения</span><span class="sxs-lookup"><span data-stu-id="4353b-125">Registering for Application Entry Points</span></span>](#registering-for-application-entry-points)
    -   [<span data-ttu-id="4353b-126">Открыть с помощью</span><span class="sxs-lookup"><span data-stu-id="4353b-126">Open With</span></span>](#open-with)
    -   [<span data-ttu-id="4353b-127">Меню "Пуск" и панель быстрого запуска</span><span class="sxs-lookup"><span data-stu-id="4353b-127">Start Menu and Quick Launch Bar</span></span>](#start-menu-and-quick-launch-bar)
-   [<span data-ttu-id="4353b-128">Установка приложения и значения по умолчанию</span><span class="sxs-lookup"><span data-stu-id="4353b-128">Application Installation and Defaults</span></span>](#application-installation-and-defaults)
-   [<span data-ttu-id="4353b-129">Обновления и значения по умолчанию для приложения</span><span class="sxs-lookup"><span data-stu-id="4353b-129">Application Upgrades and Defaults</span></span>](#application-upgrades-and-defaults)
-   [<span data-ttu-id="4353b-130">Первый запуск приложения и значения по умолчанию</span><span class="sxs-lookup"><span data-stu-id="4353b-130">Application First Run and Defaults</span></span>](#application-first-run-and-defaults)
-   [<span data-ttu-id="4353b-131">Проверка значений по умолчанию и запрос согласия пользователя</span><span class="sxs-lookup"><span data-stu-id="4353b-131">Verifying Defaults and Asking for User Consent</span></span>](#verifying-defaults-and-asking-for-user-consent)
-   [<span data-ttu-id="4353b-132">Советы по совместимости приложений</span><span class="sxs-lookup"><span data-stu-id="4353b-132">Application Compatibility Tips</span></span>](#application-compatibility-tips)
    -   [<span data-ttu-id="4353b-133">Избегайте запуска виртуализации Per-User</span><span class="sxs-lookup"><span data-stu-id="4353b-133">Avoid Triggering Per-User Virtualization</span></span>](#avoid-triggering-per-user-virtualization)
    -   [<span data-ttu-id="4353b-134">Избегайте предупреждений или блоков совместимости приложений</span><span class="sxs-lookup"><span data-stu-id="4353b-134">Avoid AppCompat Warnings or Blocks from the Program Compatibility Assistant</span></span>](#avoid-appcompat-warnings-or-blocks-from-the-program-compatibility-assistant)
    -   [<span data-ttu-id="4353b-135">Поддержка предыдущих версий операционной системы Windows</span><span class="sxs-lookup"><span data-stu-id="4353b-135">Support for Previous Windows Operating System Versions</span></span>](#support-for-previous-windows-operating-system-versions)
-   [<span data-ttu-id="4353b-136">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="4353b-136">Additional Resources</span></span>](#additional-resources)
-   [<span data-ttu-id="4353b-137">См. также</span><span class="sxs-lookup"><span data-stu-id="4353b-137">Related topics</span></span>](#related-topics)

## <a name="default-programs-item-in-control-panel"></a><span data-ttu-id="4353b-138">Элемент "программы по умолчанию" в панели управления</span><span class="sxs-lookup"><span data-stu-id="4353b-138">Default Programs Item in Control Panel</span></span>

<span data-ttu-id="4353b-139">**Программы по умолчанию** — это функция, появившаяся в Windows Vista и доступная непосредственно из меню « **Пуск** », а также с панелью управления.</span><span class="sxs-lookup"><span data-stu-id="4353b-139">**Default Programs** is a feature introduced in Windows Vista, accessible directly from the **Start** menu as well as Control Panel.</span></span> <span data-ttu-id="4353b-140">Она предоставляет новую инфраструктуру, которая работает со стандартными привилегиями пользователя (без повышения прав) и разработана, чтобы позволить пользователям и приложениям управлять параметрами по умолчанию для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="4353b-140">It provides a new infrastructure that works with standard user privilege (not elevated) and is designed to enable users and applications to manage per-user defaults.</span></span> <span data-ttu-id="4353b-141">Для пользователей программы по умолчанию предоставляют унифицированный и простой способ управления параметрами по умолчанию, сопоставлениями файлов и настройками автозапуска во всех приложениях в системе.</span><span class="sxs-lookup"><span data-stu-id="4353b-141">For users, Default Programs provides a unified and easily accessible way to manage defaults, file associations, and Autoplay settings across all applications on the system.</span></span> <span data-ttu-id="4353b-142">Для приложений использование области "на пользователя", предоставляемой API-интерфейсами программ по умолчанию, обеспечивает следующие преимущества.</span><span class="sxs-lookup"><span data-stu-id="4353b-142">For applications, using the per-user scope provided by the Default Programs APIs offers the following advantages:</span></span>

-   <span data-ttu-id="4353b-143">**Без повышения прав**</span><span class="sxs-lookup"><span data-stu-id="4353b-143">**No Elevation**</span></span>

    <span data-ttu-id="4353b-144">Приложению не нужно повышать свои привилегии, чтобы запрашивать значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4353b-144">An application does not have to elevate its privileges to claim defaults.</span></span>

-   <span data-ttu-id="4353b-145">**Хорошее гражданство**</span><span class="sxs-lookup"><span data-stu-id="4353b-145">**Good Citizenship**</span></span>

    <span data-ttu-id="4353b-146">На компьютере с несколькими пользователями каждый пользователь может выбрать разные приложения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4353b-146">On a multiple-user computer, each user can select different default applications.</span></span>

-   <span data-ttu-id="4353b-147">**Управление по умолчанию**</span><span class="sxs-lookup"><span data-stu-id="4353b-147">**Default Management**</span></span>

    <span data-ttu-id="4353b-148">API-интерфейсы программ по умолчанию предлагают надежный и последовательный механизм для самостоятельной проверки состояния по умолчанию и освобождения потерянных параметров без внесения непосредственно в реестр.</span><span class="sxs-lookup"><span data-stu-id="4353b-148">Default Programs APIs offer a reliable and consistent mechanism for self-checking the default status and reclaiming lost settings without resorting to writing directly to the registry.</span></span> <span data-ttu-id="4353b-149">Однако в Windows 8 не рекомендуется, чтобы приложения запрашивают состояние по умолчанию, поскольку приложение больше не может изменять параметры по умолчанию — эти изменения могут вносить только пользователи.</span><span class="sxs-lookup"><span data-stu-id="4353b-149">However, as of Windows 8, we do not recommended that applications query the default status because an application can no longer change the default settings—those changes can be made only by the user.</span></span>

<span data-ttu-id="4353b-150">Чтобы обеспечить эффективное управление приложениями по умолчанию, необходимо зарегистрировать приложение в качестве потенциальной программы по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4353b-150">To enable your application to manage defaults effectively, you must register your application as a potential default program.</span></span> <span data-ttu-id="4353b-151">Дополнительные сведения о регистрации и использовании API-интерфейсов программ по умолчанию см. в разделе [программы по умолчанию](default-programs.md).</span><span class="sxs-lookup"><span data-stu-id="4353b-151">For details on registering and using the Default Programs APIs, see [Default Programs](default-programs.md).</span></span>

<span data-ttu-id="4353b-152">Программы по умолчанию также предоставляют следующие две функции:</span><span class="sxs-lookup"><span data-stu-id="4353b-152">Default Programs also provides these two features:</span></span>

-   <span data-ttu-id="4353b-153">**Пользовательский интерфейс по умолчанию для повторного использования**</span><span class="sxs-lookup"><span data-stu-id="4353b-153">**Reusable Defaults UI**</span></span>

    <span data-ttu-id="4353b-154">Пользовательский интерфейс обеих программ по умолчанию (**Установка программ по умолчанию**) и сопоставление файлов (**сопоставление типа файла или протокола с программой**) можно повторно использовать и вызывать из приложения.</span><span class="sxs-lookup"><span data-stu-id="4353b-154">The UI of both the program defaults (**Set your default programs**) and file associations (**Associate a file type or protocol with a program**) can be reused and called from within an application.</span></span> <span data-ttu-id="4353b-155">Это позволяет приложениям обеспечивать стандартный пользовательский интерфейс для управления параметрами по умолчанию и экономит независимые поставщики программного обеспечения от необходимости разработки пользовательского или эквивалентного пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="4353b-155">This enables applications to provide a standard user experience for managing defaults and saves ISVs from having to develop a custom or equivalent UI.</span></span>

-   <span data-ttu-id="4353b-156">**Включение URL-адреса и сведений о маркетинге**</span><span class="sxs-lookup"><span data-stu-id="4353b-156">**Inclusion of URL and Marketing Information**</span></span>

    <span data-ttu-id="4353b-157">Как часть страницы **Настройка программ по умолчанию** элемента **программы по умолчанию** в панели управления, приложение может предоставлять маркетинговую информацию и ссылку на веб-сайт поставщика.</span><span class="sxs-lookup"><span data-stu-id="4353b-157">As part of the **Set your default programs** page of the **Default Programs** item in Control Panel, an application can provide marketing information and a link to the vendor's website.</span></span> <span data-ttu-id="4353b-158">Этот URL-адрес является производным от сертификата Authenticode, с которым подписано приложение.</span><span class="sxs-lookup"><span data-stu-id="4353b-158">This URL is derived from the Authenticode certificate that the application has been signed with.</span></span> <span data-ttu-id="4353b-159">Это предотвращает неправильное использование и несанкционированную замену этой ссылки.</span><span class="sxs-lookup"><span data-stu-id="4353b-159">This prevents misuse and unauthorized replacement of this link.</span></span> <span data-ttu-id="4353b-160">Если у приложения есть сертификат Authenticode, включающий внедренный URL-адрес, Пользовательский интерфейс Windows отображает этот внедренный URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="4353b-160">If an application has an Authenticode certificate that includes an embedded URL, Windows UI displays that embedded URL.</span></span> <span data-ttu-id="4353b-161">Независимые поставщики программного обеспечения должны воспользоваться этой функцией, чтобы направить пользователей на свой веб-сайт для обновления и других Скачиваний.</span><span class="sxs-lookup"><span data-stu-id="4353b-161">ISVs should take advantage of this feature to direct users to their website for updates and other downloads.</span></span>

## <a name="set-program-access-and-computer-defaults"></a><span data-ttu-id="4353b-162">Настройка доступа к программе и параметров по умолчанию для компьютера</span><span class="sxs-lookup"><span data-stu-id="4353b-162">Set Program Access and Computer Defaults</span></span>

<span data-ttu-id="4353b-163">**Настройка доступа к программам и параметров по умолчанию** (SPAD) позволяет администраторам управлять параметрами по умолчанию на уровне компьютера, которые наследуются всеми новыми пользователями этого компьютера.</span><span class="sxs-lookup"><span data-stu-id="4353b-163">**Set Program Access and Computer Defaults** (SPAD) enables administrators to manage computer-wide defaults that are inherited by all new users of that computer.</span></span> <span data-ttu-id="4353b-164">До Windows 8, SPAD также включил администраторов для восстановления сопоставлений файлов, если программы были удалены из системы.</span><span class="sxs-lookup"><span data-stu-id="4353b-164">Prior to Windows 8, SPAD also enabled administrators to repair file associations should they become broken when programs were removed from the system.</span></span> <span data-ttu-id="4353b-165">Однако в Windows 8 SPAD влияет только на пользовательские значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4353b-165">However, as of Windows 8, SPAD affects only user-specific defaults.</span></span>

<span data-ttu-id="4353b-166">Дополнительные сведения о регистрации приложения в SPAD см. в разделе [Работа с настройками доступа к программам и параметров по умолчанию (SPAD)](cpl-setprogramaccess.md) и [Регистрация программ с помощью типов клиентов](reg-middleware-apps.md).</span><span class="sxs-lookup"><span data-stu-id="4353b-166">For more information on registering an application in SPAD, see [Working with Set Program Access and Computer Defaults (SPAD)](cpl-setprogramaccess.md) and [Registering Programs with Client Types](reg-middleware-apps.md).</span></span> <span data-ttu-id="4353b-167">Конкретные изменения и новые рекомендации обсуждаются в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="4353b-167">Specific changes and new recommendations are discussed in the sections that follow.</span></span>

### <a name="setting-defaults-in-spad"></a><span data-ttu-id="4353b-168">Настройка значений по умолчанию в SPAD</span><span class="sxs-lookup"><span data-stu-id="4353b-168">Setting Defaults in SPAD</span></span>

<span data-ttu-id="4353b-169">Параметры по умолчанию для каждого пользователя переопределяют параметры по умолчанию для каждого компьютера.</span><span class="sxs-lookup"><span data-stu-id="4353b-169">Per-user defaults override per-computer defaults.</span></span>

-   <span data-ttu-id="4353b-170">**До Windows 8**: значения по умолчанию, заданные в SPAD (для каждого компьютера), не будут видны пользователям, если заданы соответствующие значения по умолчанию для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="4353b-170">**Before Windows 8**: Defaults set in SPAD (which are per-computer) will not be seen by users if corresponding per-user defaults are set.</span></span> <span data-ttu-id="4353b-171">Если пользователь не установил значение по умолчанию для каждого пользователя, система использует соответствующий компьютер по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4353b-171">If a user has not set a per-user default, the system uses the corresponding computer default.</span></span> <span data-ttu-id="4353b-172">Новые учетные записи пользователей на компьютере изначально наследуют параметры компьютера по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4353b-172">New user accounts on a computer initially inherit the computer defaults.</span></span> <span data-ttu-id="4353b-173">При первом запуске приложения пользователь должен предложить пользователю назначить значения по умолчанию для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="4353b-173">The first time a user runs an application, the application should prompt the user to assign their per-user defaults.</span></span> <span data-ttu-id="4353b-174">См. раздел [первый запуск приложения и значения по умолчанию](#application-first-run-and-defaults).</span><span class="sxs-lookup"><span data-stu-id="4353b-174">See [Application First Run and Defaults](#application-first-run-and-defaults).</span></span>
-   <span data-ttu-id="4353b-175">Начиная с **Windows 8**: все значения по умолчанию для каждого пользователя и параметры по умолчанию для каждого компьютера игнорируются.</span><span class="sxs-lookup"><span data-stu-id="4353b-175">**As of Windows 8**: All defaults are per-user and any per-computer default setting is ignored.</span></span> <span data-ttu-id="4353b-176">Приложения больше не могут задавать параметры по умолчанию, поэтому они не могут проходить пользователя по назначению этих значений по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4353b-176">Applications can no longer set default choices, so they cannot walk the user through their assigning of those defaults.</span></span>

<span data-ttu-id="4353b-177">Если приложение предустановки Windows 8 реализует в SPAD **по умолчанию** , следует следовать приведенным ниже рекомендациям.</span><span class="sxs-lookup"><span data-stu-id="4353b-177">When a pre-Windows 8 application implements **Set as Default** in SPAD, these guidelines should be followed:</span></span>

-   <span data-ttu-id="4353b-178">Приложения должны запрашивать только параметры по умолчанию на уровне компьютера через SPAD.</span><span class="sxs-lookup"><span data-stu-id="4353b-178">Applications should claim only computer-level defaults through SPAD.</span></span>
-   <span data-ttu-id="4353b-179">Приложения *не* должны требовать применения параметров по умолчанию для каждого пользователя через SPAD.</span><span class="sxs-lookup"><span data-stu-id="4353b-179">Applications should *not* claim per-user defaults through SPAD.</span></span>

<span data-ttu-id="4353b-180">Если приложение Windows 8 реализует в SPAD **значение по умолчанию** , они должны регистрировать типы файлов и протоколы в [программах по умолчанию](default-programs.md), используя то же имя приложения, которое использовалось в SPAD.</span><span class="sxs-lookup"><span data-stu-id="4353b-180">When a Windows 8 application implements **Set as Default** in SPAD, they must register their file types and protocols in [Default Programs](default-programs.md), using the same application name used in SPAD.</span></span> <span data-ttu-id="4353b-181">Это позволяет изменить SPAD в соответствии с изменениями в соответствующей записи о программах по умолчанию для текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="4353b-181">This allows a change in SPAD to reflect as a change in the corresponding Default Programs entry for the current user.</span></span>

### <a name="hide-access-in-spad"></a><span data-ttu-id="4353b-182">Скрыть доступ в SPAD</span><span class="sxs-lookup"><span data-stu-id="4353b-182">Hide Access in SPAD</span></span>

<span data-ttu-id="4353b-183">Параметр "скрыть доступ" для каждого возможного значения по умолчанию в SPAD доступен одним из двух способов:</span><span class="sxs-lookup"><span data-stu-id="4353b-183">The hide access option for each possible default in SPAD is accessed in one of two ways:</span></span>

-   <span data-ttu-id="4353b-184">Выберите категорию по умолчанию ( **не Майкрософт** ), которая удаляет доступ ко всем значениям по умолчанию для Microsoft.</span><span class="sxs-lookup"><span data-stu-id="4353b-184">Choose the **Non-Microsoft** category of defaults, which removes access to all Microsoft defaults.</span></span>
-   <span data-ttu-id="4353b-185">Выберите **настраиваемую** категорию и снимите флажок **включить доступ к этой программе** .</span><span class="sxs-lookup"><span data-stu-id="4353b-185">Choose the **Custom** category and clear the **Enable access to this program** check box.</span></span>

<span data-ttu-id="4353b-186">Ранее при каждом из этих действий все точки входа были удалены в соответствующие приложения в системе.</span><span class="sxs-lookup"><span data-stu-id="4353b-186">Previously, taking either of those actions removed all entry points to the appropriate applications on the system.</span></span> <span data-ttu-id="4353b-187">Конкретные рекомендации для этой ситуации, например, для удаления ярлыков и значков из следующих расположений:</span><span class="sxs-lookup"><span data-stu-id="4353b-187">Specific guidelines for this situation say to remove shortcuts and icons from the following locations:</span></span>

-   <span data-ttu-id="4353b-188">Персональный компьютер</span><span class="sxs-lookup"><span data-stu-id="4353b-188">Desktop</span></span>
-   <span data-ttu-id="4353b-189">Меню "Пуск"</span><span class="sxs-lookup"><span data-stu-id="4353b-189">Start menu</span></span>
-   <span data-ttu-id="4353b-190">Панель быстрого запуска (только для Windows Vista и более ранних версий)</span><span class="sxs-lookup"><span data-stu-id="4353b-190">Quick Launch bar (Windows Vista and earlier only)</span></span>
-   <span data-ttu-id="4353b-191">Область "Уведомления"</span><span class="sxs-lookup"><span data-stu-id="4353b-191">Notification area</span></span>
-   <span data-ttu-id="4353b-192">Контекстные меню</span><span class="sxs-lookup"><span data-stu-id="4353b-192">Shortcut menus</span></span>
-   <span data-ttu-id="4353b-193">Полоса задач для папки</span><span class="sxs-lookup"><span data-stu-id="4353b-193">Folder task band</span></span>

<span data-ttu-id="4353b-194">Поставщикам рекомендуется реализовать эти рекомендации в функции обратного вызова для скрытого доступа приложения.</span><span class="sxs-lookup"><span data-stu-id="4353b-194">Vendors are encouraged to implement these guidelines in the application's Hide Access callback function.</span></span>

### <a name="alternate-hide-access-method-in-spad"></a><span data-ttu-id="4353b-195">Альтернативный метод доступа Hide в SPAD</span><span class="sxs-lookup"><span data-stu-id="4353b-195">Alternate Hide Access Method in SPAD</span></span>

<span data-ttu-id="4353b-196">Для некоторых устаревших приложений полная реализация скрытия доступа может оказаться непрактичной.</span><span class="sxs-lookup"><span data-stu-id="4353b-196">For some legacy applications, a full implementation of Hide Access may not be practical.</span></span> <span data-ttu-id="4353b-197">Альтернативный метод, который достигает одного и того же результата, но не может быть просто отменен пользователем, заключается в удалении приложения.</span><span class="sxs-lookup"><span data-stu-id="4353b-197">An alternate method that achieves the same effect, but is not easily reversible by the user, is to uninstall the application.</span></span> <span data-ttu-id="4353b-198">Ниже показан пример поведения и пример кода для его реализации.</span><span class="sxs-lookup"><span data-stu-id="4353b-198">The following shows sample behavior and example code to implement this.</span></span>

<span data-ttu-id="4353b-199">Для работы с этим альтернативным пользователем рекомендуется использовать следующий интерфейс:</span><span class="sxs-lookup"><span data-stu-id="4353b-199">The recommended user experience for this alternative is as follows:</span></span>

-   <span data-ttu-id="4353b-200">Когда пользователь снимает флажок **включить доступ к этой программе** в SPAD, отображается следующий пользовательский интерфейс.</span><span class="sxs-lookup"><span data-stu-id="4353b-200">When the user clears the **Enable access to this program** box in SPAD, the following UI is presented.</span></span>

    ![диалоговое окно Vista о скрытии доступа к программе](images/hideaccessvista.png)

-   <span data-ttu-id="4353b-202">Когда пользователь нажимает кнопку **ОК**, отображается элемент **программы и компоненты** на панели управления, чтобы пользователь мог удалить приложение.</span><span class="sxs-lookup"><span data-stu-id="4353b-202">When the user clicks **OK**, the **Programs and Features** item in Control Panel is displayed so that the user can uninstall the application.</span></span>
-   <span data-ttu-id="4353b-203">Пользователи Windows XP должны быть представлены в следующем диалоговом окне.</span><span class="sxs-lookup"><span data-stu-id="4353b-203">Windows XP users should be presented with the following dialog box.</span></span>

    ![диалоговое окно Windows XP о скрытии доступа к программе](images/hideaccessxp.png)

-   <span data-ttu-id="4353b-205">После нажатия кнопки **ОК** пользователем Windows XP появляется элемент **Установка и удаление программ** на панели управления, чтобы пользователь мог удалить приложение.</span><span class="sxs-lookup"><span data-stu-id="4353b-205">When the Windows XP user clicks **OK**, the **Add or Remove Programs** item in Control Panel is displayed so that the user can uninstall the application.</span></span>

<span data-ttu-id="4353b-206">Следующий код предоставляет многократно используемую реализацию для функции скрытия доступа, как описано выше.</span><span class="sxs-lookup"><span data-stu-id="4353b-206">The following code provides a reusable implementation for the Hide Access feature as outlined previously.</span></span> <span data-ttu-id="4353b-207">Его можно использовать в Windows XP, Windows Vista и Windows 7.</span><span class="sxs-lookup"><span data-stu-id="4353b-207">It can be used on Windows XP, Windows Vista, and Windows 7.</span></span>


```
#include <windows.h>
#include <shlwapi.h>
#include <strsafe.h>

PCWSTR c_pszMessage1 = L"To hide access to this program, you need to uninstall it by ";
PCWSTR c_pszMessage2 = L"using\n%s in Control Panel.\n\nWould you like to start %s?";
PCWSTR c_pszApplicationName  = L"Sample App";

int _tmain(int argc, WCHAR* argv[])
{
    OSVERSIONINFO version;
    version.dwOSVersionInfoSize = sizeof(version);

    if (GetVersionEx(&version))
    {
        PCWSTR pszCPLName = NULL;

        if (version.dwMajorVersion >= 6)
        {
            // Windows Vista and later
            pszCPLName = L"Programs and Features";
        }
        else if (version.dwMajorVersion == 5 &&
                 version.dwMinorVersion == 1)
        {
            // XP
            pszCPLName = L"Add/Remove Programs";
        }

        if (pszCPLName != NULL)
        {
            WCHAR szMessage[256], szScratch[256];
            if (SUCCEEDED(StringCchPrintf(szScratch, 
                                          ARRAYSIZE(szScratch), 
                                          c_pszMessage2, 
                                          pszCPLName, 
                                          pszCPLName)))
            {
                if (SUCCEEDED(StringCchCopy(szMessage, 
                                            ARRAYSIZE(szMessage), 
                                            c_pszMessage1)))
                {
                    if (SUCCEEDED(StringCchCat(szMessage, 
                                               ARRAYSIZE(szMessage), 
                                               szScratch)))
                    {
                        if (IDOK == MessageBox(NULL, 
                                               szMessage, 
                                               c_pszApplicationName, 
                                               MB_OKCANCEL))
                        {
                            ShellExecute(NULL, 
                                         NULL, 
                                         L"appwiz.cpl", 
                                         NULL, 
                                         NULL, 
                                         SW_SHOWNORMAL);
                        }
                    }
                }
            }
        }
    }
    return 0;
}
```



## <a name="registering-for-application-entry-points"></a><span data-ttu-id="4353b-208">Регистрация для точек входа приложения</span><span class="sxs-lookup"><span data-stu-id="4353b-208">Registering for Application Entry Points</span></span>

<span data-ttu-id="4353b-209">Приложение может иметь множество точек входа в операционной системе.</span><span class="sxs-lookup"><span data-stu-id="4353b-209">An application can have many entry points within the operating system.</span></span> <span data-ttu-id="4353b-210">Ниже приведены рекомендуемые расположения для точек входа.</span><span class="sxs-lookup"><span data-stu-id="4353b-210">The following are recommended locations for entry points:</span></span>

-   <span data-ttu-id="4353b-211">Персональный компьютер</span><span class="sxs-lookup"><span data-stu-id="4353b-211">Desktop</span></span>
-   <span data-ttu-id="4353b-212">Меню "Пуск"</span><span class="sxs-lookup"><span data-stu-id="4353b-212">Start menu</span></span>
-   <span data-ttu-id="4353b-213">Панель быстрого запуска (только для Windows Vista и более ранних версий)</span><span class="sxs-lookup"><span data-stu-id="4353b-213">Quick Launch bar (Windows Vista and earlier only)</span></span>
-   <span data-ttu-id="4353b-214">Область "Уведомления"</span><span class="sxs-lookup"><span data-stu-id="4353b-214">Notification area</span></span>
-   <span data-ttu-id="4353b-215">Контекстные меню</span><span class="sxs-lookup"><span data-stu-id="4353b-215">Shortcut menus</span></span>
-   <span data-ttu-id="4353b-216">Полоса задач для папки</span><span class="sxs-lookup"><span data-stu-id="4353b-216">Folder task band</span></span>

<span data-ttu-id="4353b-217">В этом разделе рассматриваются следующие вопросы:</span><span class="sxs-lookup"><span data-stu-id="4353b-217">This section focuses on these specific areas:</span></span>

-   [<span data-ttu-id="4353b-218">Открыть с помощью</span><span class="sxs-lookup"><span data-stu-id="4353b-218">Open With</span></span>](#open-with)
-   [<span data-ttu-id="4353b-219">Меню "Пуск" и панель быстрого запуска</span><span class="sxs-lookup"><span data-stu-id="4353b-219">Start Menu and Quick Launch Bar</span></span>](#start-menu-and-quick-launch-bar)

### <a name="open-with"></a><span data-ttu-id="4353b-220">Открыть с помощью</span><span class="sxs-lookup"><span data-stu-id="4353b-220">Open With</span></span>

<span data-ttu-id="4353b-221">Контекстное меню « **Открыть с помощью** » позволяет пользователю выбрать приложение, способное работать с конкретным типом файлов.</span><span class="sxs-lookup"><span data-stu-id="4353b-221">The **Open With** shortcut menu enables the user to select an application that can handle a specific file type.</span></span> <span data-ttu-id="4353b-222">Хотя **можно использовать для открытия файла** с приложением один раз, его также можно использовать для задания значения по умолчанию для этого расширения имени файла.</span><span class="sxs-lookup"><span data-stu-id="4353b-222">While **Open With** can be used to open a file with an application one time, it can also be used to set the default for that file name extension.</span></span> <span data-ttu-id="4353b-223">Таким образом, приложение всегда должно зарегистрироваться для **открытия с** таким образом, чтобы пользователи преддавали это приложение в качестве альтернативы.</span><span class="sxs-lookup"><span data-stu-id="4353b-223">Therefore, an application should always register for **Open With** so that users are presented with that application as a choice.</span></span> <span data-ttu-id="4353b-224">Приложения могут регистрировать типы файлов и протоколы для **открытия с помощью**.</span><span class="sxs-lookup"><span data-stu-id="4353b-224">Applications can register both file types and protocols for **Open With**.</span></span> <span data-ttu-id="4353b-225">Приложения, которые регистрируют протоколы в инфраструктуре программ по умолчанию, автоматически добавляются в параметры **Открыть с помощью** для протоколов.</span><span class="sxs-lookup"><span data-stu-id="4353b-225">Applications that register protocols in the Default Programs framework are automatically added to the **Open With** options for protocols.</span></span>

<span data-ttu-id="4353b-226">Сведения о регистрации для **Open с** см. в разделе [Введение в сопоставления файлов](fa-intro.md).</span><span class="sxs-lookup"><span data-stu-id="4353b-226">For information on registering for **Open With**, see [Introduction to File Associations](fa-intro.md).</span></span>

### <a name="start-menu-and-quick-launch-bar"></a><span data-ttu-id="4353b-227">Меню "Пуск" и панель быстрого запуска</span><span class="sxs-lookup"><span data-stu-id="4353b-227">Start Menu and Quick Launch Bar</span></span>

<span data-ttu-id="4353b-228">Чтобы стать более обнаруживаемым для пользователя, приложения могут добавлять ярлыки в различные места в Windows.</span><span class="sxs-lookup"><span data-stu-id="4353b-228">To become more discoverable to the user, applications can add shortcuts to various locations in Windows.</span></span> <span data-ttu-id="4353b-229">Самым распространенным местом для добавления ярлыка является меню « **Пуск** ».</span><span class="sxs-lookup"><span data-stu-id="4353b-229">The most common place to add a shortcut is the **Start** menu.</span></span> <span data-ttu-id="4353b-230">В Windows Vista и более поздних версиях приложение создает ярлык в папке «скрытая папка% папка ProgramData%» в меню «Пуск» для \\ \\ \\ \\ всех пользователей, которые отображаются в списке программ меню « **Пуск** ».</span><span class="sxs-lookup"><span data-stu-id="4353b-230">In Windows Vista and later, an application creates a shortcut in the hidden folder %ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs to appear in the **Start** menu's list of programs for all users.</span></span> <span data-ttu-id="4353b-231">Как правило, приложение добавляет вложенную папку, содержащую ярлык.</span><span class="sxs-lookup"><span data-stu-id="4353b-231">Commonly, an application adds a subfolder that contains the shortcut.</span></span>

<span data-ttu-id="4353b-232">Для программ обозревателя и электронной почты в меню « **Пуск** » Windows Vista также представлены две выделенные ссылки за пределами списка программ, « **Интернет** » и « **Электронная почта**».</span><span class="sxs-lookup"><span data-stu-id="4353b-232">For browser and email programs, the Windows Vista **Start** menu also presents two dedicated links outside of the program list, canonically titled **Internet** and **E-mail**.</span></span> <span data-ttu-id="4353b-233">После регистрации приложения для этих категорий платформа программ по умолчанию может управлять тем, что запускается с помощью этих ссылок.</span><span class="sxs-lookup"><span data-stu-id="4353b-233">After an application registers for those categories, the Default Programs framework can manage what is launched through those links.</span></span>

> [!Note]  
> <span data-ttu-id="4353b-234">Выделенные ссылки меню " **Пуск** " в **Интернете** и **электронной почте** больше не находятся в Windows 7.</span><span class="sxs-lookup"><span data-stu-id="4353b-234">The **Internet** and **E-mail** dedicated **Start** menu links are no longer present as of Windows 7.</span></span>

 

<span data-ttu-id="4353b-235">Для дальнейшего повышения обнаруживаемости приложения также могут добавлять ярлыки на Рабочий стол и панель быстрого запуска.</span><span class="sxs-lookup"><span data-stu-id="4353b-235">To further increase discoverability, applications can also add shortcuts to the desktop and the Quick Launch bar.</span></span> <span data-ttu-id="4353b-236">Перед добавлением значка в меню " **Пуск** ", "Рабочий стол" или "Быстрый запуск" приложения должны запрашивать у пользователя разрешение (обычно во время установки или при первом запуске).</span><span class="sxs-lookup"><span data-stu-id="4353b-236">Applications should ask the user for permission (usually during installation or on first run) before adding an icon to the **Start** menu, desktop, or Quick Launch bar.</span></span>

> [!Note]  
> <span data-ttu-id="4353b-237">Панель быстрого запуска больше не доступна в Windows 7.</span><span class="sxs-lookup"><span data-stu-id="4353b-237">The Quick Launch bar is no longer available as of Windows 7.</span></span> <span data-ttu-id="4353b-238">Альтернативой Windows 7 является то, что приложение закреплено на панели задач, но закрепление не может быть выполнено программно, так как оно является исключительно выбором пользователя.</span><span class="sxs-lookup"><span data-stu-id="4353b-238">The Windows 7 alternative is to have the application pinned to the Taskbar, but pinning cannot be done programmatically as it is strictly a user choice.</span></span>

 

<span data-ttu-id="4353b-239">Дополнительные сведения см. в следующих статьях:</span><span class="sxs-lookup"><span data-stu-id="4353b-239">For more information, see these topics:</span></span>

-   [<span data-ttu-id="4353b-240">Как зарегистрировать Интернет браузер или почтовый клиент в меню "Пуск" Windows</span><span class="sxs-lookup"><span data-stu-id="4353b-240">How to Register an Internet Browser or Email Client With the Windows Start Menu</span></span>](start-menu-reg.md)
-   [<span data-ttu-id="4353b-241">Регистрация программ с помощью клиентских типов</span><span class="sxs-lookup"><span data-stu-id="4353b-241">Registering Programs with Client Types</span></span>](reg-middleware-apps.md)

## <a name="application-installation-and-defaults"></a><span data-ttu-id="4353b-242">Установка приложения и значения по умолчанию</span><span class="sxs-lookup"><span data-stu-id="4353b-242">Application Installation and Defaults</span></span>

<span data-ttu-id="4353b-243">Процедуры установки приложений не были фундаментально изменены с момента выпуска Windows XP, за исключением новой рекомендации для систем под управлением более ранних версий Windows, чем Windows 8: при установке необходимо принимать значения по умолчанию для каждого компьютера, но не устанавливать значения по умолчанию для каждого пользователя, пока этот пользователь не запустит приложение.</span><span class="sxs-lookup"><span data-stu-id="4353b-243">Application installation procedures have not fundamentally changed since Windows XP, with the exception of a new guideline for systems running versions of Windows older than Windows 8: take per-computer defaults at installation time but do not set any per-user defaults until that user first runs the application.</span></span> <span data-ttu-id="4353b-244">(См. раздел [первый запуск приложения и значения по умолчанию](#application-first-run-and-defaults).) Приложения не должны устанавливать значения по умолчанию для каждого пользователя во время установки, поскольку существуют ситуации, когда пользователь, устанавливающий приложение, не является предполагаемым пользователем.</span><span class="sxs-lookup"><span data-stu-id="4353b-244">(See [Application First Run and Defaults](#application-first-run-and-defaults).) Applications should not set per-user defaults during installation because there are situations in which the person installing the application is not the intended user.</span></span> <span data-ttu-id="4353b-245">Начиная с Windows 8, значения по умолчанию для каждого компьютера не поддерживаются, и приложения не могут изменять параметры по умолчанию для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="4353b-245">As of Windows 8, per-computer defaults are not supported and applications cannot change per-user default settings.</span></span>

<span data-ttu-id="4353b-246">Во время установки приложение должно копировать свои двоичные файлы на жесткий диск и записывать идентификаторы ProgID в реестр.</span><span class="sxs-lookup"><span data-stu-id="4353b-246">During installation, an application should copy its binaries to the hard disk and write its ProgIDs to the registry.</span></span> <span data-ttu-id="4353b-247">Приложение также должно зарегистрироваться для работы с программами по умолчанию и **Открыть с помощью** в данный момент для каждого сопоставления файлов, которое является кандидатом на обработку.</span><span class="sxs-lookup"><span data-stu-id="4353b-247">The application should also register for Default Programs and **Open With** at this time for every file association it is a candidate to handle.</span></span> <span data-ttu-id="4353b-248">Приложение может использовать подключ **опенвиспрогидс** для регистрации в **Open с**.</span><span class="sxs-lookup"><span data-stu-id="4353b-248">The application can use the **OpenWithProgIds** subkey to register with **Open With**.</span></span>

<span data-ttu-id="4353b-249">Дополнительные сведения см. в следующих статьях:</span><span class="sxs-lookup"><span data-stu-id="4353b-249">For more information, see these topics:</span></span>

-   [<span data-ttu-id="4353b-250">Программы по умолчанию</span><span class="sxs-lookup"><span data-stu-id="4353b-250">Default Programs</span></span>](default-programs.md)
-   [<span data-ttu-id="4353b-251">Общие сведения о сопоставлении файлов</span><span class="sxs-lookup"><span data-stu-id="4353b-251">Introduction to File Associations</span></span>](fa-intro.md)

## <a name="application-upgrades-and-defaults"></a><span data-ttu-id="4353b-252">Обновления и значения по умолчанию для приложения</span><span class="sxs-lookup"><span data-stu-id="4353b-252">Application Upgrades and Defaults</span></span>

<span data-ttu-id="4353b-253">Многие приложения могут обновляться с течением времени.</span><span class="sxs-lookup"><span data-stu-id="4353b-253">Many applications have the ability to upgrade themselves over time.</span></span> <span data-ttu-id="4353b-254">Эта процедура обновления не должна изменять состояние параметров по умолчанию для каждого пользователя, так как это изменение будет неожиданным для пользователя.</span><span class="sxs-lookup"><span data-stu-id="4353b-254">This upgrade procedure should not change the state of per-user defaults because that change would be unexpected to the user.</span></span> <span data-ttu-id="4353b-255">Однако приложение может проверять сопоставления файлов на уровне компьютера и восстанавливать их, если они повреждены.</span><span class="sxs-lookup"><span data-stu-id="4353b-255">However, it is acceptable for an application to check computer-level file associations and repair them if they have been corrupted.</span></span>

## <a name="application-first-run-and-defaults"></a><span data-ttu-id="4353b-256">Первый запуск приложения и значения по умолчанию</span><span class="sxs-lookup"><span data-stu-id="4353b-256">Application First Run and Defaults</span></span>

> [!Note]  
> <span data-ttu-id="4353b-257">Начиная с Windows 8, система обрабатывает эту процедуру от имени всех приложений.</span><span class="sxs-lookup"><span data-stu-id="4353b-257">As of Windows 8, the system handles this procedure on behalf of all applications.</span></span> <span data-ttu-id="4353b-258">Сами приложения больше не могут запрашивать и изменять значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4353b-258">Applications themselves can no longer query and change defaults.</span></span> <span data-ttu-id="4353b-259">Это может сделать только пользователь.</span><span class="sxs-lookup"><span data-stu-id="4353b-259">Only the user can do that.</span></span> <span data-ttu-id="4353b-260">Поэтому приложения не должны пытаться запросить текущее значение по умолчанию или изменить это значение по умолчанию любым механизмом.</span><span class="sxs-lookup"><span data-stu-id="4353b-260">Therefore, applications should not attempt to query for the current default or change that default through any mechanism.</span></span> <span data-ttu-id="4353b-261">Однако приложения могут предоставить точку входа для программ по умолчанию на панели управления, вызвав метод [**лаунчадванцедассоЦиатионуи**](/windows/desktop/api/Shobjidl/nf-shobjidl-iapplicationassociationregistrationui-launchadvancedassociationui) интерфейса [**иаппликатионассоЦиатионрегистратионуи**](/windows/desktop/api/Shobjidl/nn-shobjidl-iapplicationassociationregistrationui) .</span><span class="sxs-lookup"><span data-stu-id="4353b-261">However, applications can provide an entry point to Default Programs in the Control Panel by calling the [**LaunchAdvancedAssociationUI**](/windows/desktop/api/Shobjidl/nf-shobjidl-iapplicationassociationregistrationui-launchadvancedassociationui) method of the [**IApplicationAssociationRegistrationUI**](/windows/desktop/api/Shobjidl/nn-shobjidl-iapplicationassociationregistrationui) interface.</span></span>

 

<span data-ttu-id="4353b-262">С появлением параметров по умолчанию для каждого пользователя в Windows Vista важно, чтобы приложения, которые конкурсируют популярные расширения имен файлов, применяют общий пользовательский интерфейс для получения этих расширений.</span><span class="sxs-lookup"><span data-stu-id="4353b-262">With the introduction of per-user defaults in Windows Vista, it is important that applications that contest for popular file name extensions all provide a common user experience to claim these extensions.</span></span> <span data-ttu-id="4353b-263">Поскольку эти значения по умолчанию теперь заданы в контексте пользователя, они должны представлять себя как возможность по умолчанию, только если пользователь запускает программу после установки.</span><span class="sxs-lookup"><span data-stu-id="4353b-263">Because these defaults are now set in the context of the user, they should present themselves as a default possibility only when the user runs the program after installation.</span></span>

<span data-ttu-id="4353b-264">Ниже приведена рекомендация по установке значений по умолчанию для каждого пользователя: при первом запуске приложения для определенного пользователя это приложение должно запрашивать пользовательские настройки для параметров по умолчанию и сопоставления файлов.</span><span class="sxs-lookup"><span data-stu-id="4353b-264">The guideline for establishing per-user defaults is this: When an application is first run for a specific user, that application should request user preferences for defaults and file associations for itself.</span></span>

<span data-ttu-id="4353b-265">Рекомендуемый пользовательский интерфейс должен предоставить пользователю два очевидных варианта:</span><span class="sxs-lookup"><span data-stu-id="4353b-265">The recommended UI should provide two clear choices to the user:</span></span>

1.  <span data-ttu-id="4353b-266">Примите все значения по умолчанию, которые приложение будет запрашивать.</span><span class="sxs-lookup"><span data-stu-id="4353b-266">Accept all defaults that the application would like to claim.</span></span> <span data-ttu-id="4353b-267">Этот параметр также может задавать другие свойства по умолчанию для приложения, такие как конфиденциальность или параметры автоматического обновления.</span><span class="sxs-lookup"><span data-stu-id="4353b-267">This option might also set other default properties of the application such as privacy or automatic update settings.</span></span> <span data-ttu-id="4353b-268">Этот параметр позволяет приложению запрашивать все зарегистрированные значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4353b-268">This option allows the application to claim all of its registered defaults.</span></span>
2.  <span data-ttu-id="4353b-269">Настройте, приняв или не принимая по отдельности значения по умолчанию и параметры программы.</span><span class="sxs-lookup"><span data-stu-id="4353b-269">Customize by accepting or not accepting default selections and program settings individually.</span></span> <span data-ttu-id="4353b-270">Этот параметр предоставляет дополнительный пользовательский интерфейс, позволяющий пользователю выбирать параметры по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4353b-270">This option presents further UI that enables the user to make granular choices for their default options.</span></span>

<span data-ttu-id="4353b-271">Дополнительные сведения см. в разделе [программы по умолчанию](default-programs.md).</span><span class="sxs-lookup"><span data-stu-id="4353b-271">For more information, see [Default Programs](default-programs.md).</span></span>

## <a name="verifying-defaults-and-asking-for-user-consent"></a><span data-ttu-id="4353b-272">Проверка значений по умолчанию и запрос согласия пользователя</span><span class="sxs-lookup"><span data-stu-id="4353b-272">Verifying Defaults and Asking for User Consent</span></span>

> [!Note]  
> <span data-ttu-id="4353b-273">Это не поддерживается в Windows 8.</span><span class="sxs-lookup"><span data-stu-id="4353b-273">This is not supported as of Windows 8.</span></span>

 

<span data-ttu-id="4353b-274">После того как приложение регистрируется в программах по умолчанию в Windows Vista и более поздних версиях, некоторые API становятся доступными для приложения.</span><span class="sxs-lookup"><span data-stu-id="4353b-274">After an application registers with Default Programs in Windows Vista and later, certain APIs become available to the application.</span></span> <span data-ttu-id="4353b-275">Например, приложению может потребоваться проверить, является ли оно программой по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4353b-275">For instance, an application might need to check whether it is the default program.</span></span> <span data-ttu-id="4353b-276">Интерфейс [**иаппликатионассоЦиатионрегистратион**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-iapplicationassociationregistration) предоставляет методы для этого.</span><span class="sxs-lookup"><span data-stu-id="4353b-276">The [**IApplicationAssociationRegistration**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-iapplicationassociationregistration) interface provides methods to do this.</span></span>

<span data-ttu-id="4353b-277">Любое приложение, желающее запросить значения по умолчанию, должно сначала запросить пользователя и никогда не запрашивать значения по умолчанию без разрешения.</span><span class="sxs-lookup"><span data-stu-id="4353b-277">Any application that wants to claim defaults must first ask the user and never claim defaults without permission.</span></span> <span data-ttu-id="4353b-278">Пользователю следует запросить, следует ли сделать приложение значением по умолчанию или оставить текущее значение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4353b-278">The user should be asked whether they want to make the application the default or leave the current default in place.</span></span> <span data-ttu-id="4353b-279">После того как пользователь внес свой выбор, также должен быть установлен параметр, чтобы не запрашивать этот вопрос снова.</span><span class="sxs-lookup"><span data-stu-id="4353b-279">There should also be an option not to be asked this question again after the user has made their choice.</span></span>

<span data-ttu-id="4353b-280">Дополнительные сведения см. в разделе [программы по умолчанию](default-programs.md).</span><span class="sxs-lookup"><span data-stu-id="4353b-280">For more information, see [Default Programs](default-programs.md).</span></span>

## <a name="application-compatibility-tips"></a><span data-ttu-id="4353b-281">Советы по совместимости приложений</span><span class="sxs-lookup"><span data-stu-id="4353b-281">Application Compatibility Tips</span></span>

<span data-ttu-id="4353b-282">В этом разделе приводятся некоторые советы по совместимости приложений, связанные с работой программ по умолчанию в Windows.</span><span class="sxs-lookup"><span data-stu-id="4353b-282">This section provides some application compatibility tips related to the Default Programs experience in Windows.</span></span>

### <a name="avoid-triggering-per-user-virtualization"></a><span data-ttu-id="4353b-283">Избегайте запуска виртуализации Per-User</span><span class="sxs-lookup"><span data-stu-id="4353b-283">Avoid Triggering Per-User Virtualization</span></span>

<span data-ttu-id="4353b-284">В среде контроля учетных записей (UAC) приложения всегда должны запускаться только с правами обычного пользователя для наилучшего взаимодействия с клиентами.</span><span class="sxs-lookup"><span data-stu-id="4353b-284">With the user account control (UAC) environment, applications should always run with only standard user rights for the best customer experience.</span></span> <span data-ttu-id="4353b-285">По соображениям безопасности приложениям с уровнем привилегий "Стандартный пользователь" заблокирована запись в определенные части реестра и на определенные системные файлы.</span><span class="sxs-lookup"><span data-stu-id="4353b-285">For security reasons, applications with a standard user privilege level are blocked from writing to certain parts of the registry and to certain system files.</span></span> <span data-ttu-id="4353b-286">Windows Vista и более поздние версии Windows предоставляют временный уровень совместимости приложений (AppCompat), позволяющий приложениям выполнять переход.</span><span class="sxs-lookup"><span data-stu-id="4353b-286">Windows Vista and later versions of Windows provide a temporary application compatibility (AppCompat) layer to help applications make the transition.</span></span> <span data-ttu-id="4353b-287">Заблокированные попытки записи в реестр или системные файлы являются виртуализированными, чтобы приложение продолжало работать, но конфиденциальные области системы не изменяются.</span><span class="sxs-lookup"><span data-stu-id="4353b-287">Blocked attempts to write to the registry or to system files are "virtualized" so that the application continues to run, but the sensitive areas of the system are not altered.</span></span> <span data-ttu-id="4353b-288">Однако в качестве долгосрочного решения приложения не должны полагаться на технологию AppCompat.</span><span class="sxs-lookup"><span data-stu-id="4353b-288">However, applications should not rely on the AppCompat technology as a long-term solution.</span></span> <span data-ttu-id="4353b-289">Вместо этого приложения должны использовать множество доступных средств, чтобы убедиться, что они могут успешно выполняться с правами обычного пользователя.</span><span class="sxs-lookup"><span data-stu-id="4353b-289">Instead, applications should use the many available tools to verify that they can run successfully under standard user rights.</span></span> <span data-ttu-id="4353b-290">Для этого может потребоваться некоторое перепрограммирование приложения, но оно должно выполняться с учетом долгосрочной совместимости.</span><span class="sxs-lookup"><span data-stu-id="4353b-290">Some reprogramming of the application might be required to accomplish this, but it should be done in the interest of long-term compatibility.</span></span>

### <a name="avoid-appcompat-warnings-or-blocks-from-the-program-compatibility-assistant"></a><span data-ttu-id="4353b-291">Избегайте предупреждений или блоков совместимости приложений</span><span class="sxs-lookup"><span data-stu-id="4353b-291">Avoid AppCompat Warnings or Blocks from the Program Compatibility Assistant</span></span>

<span data-ttu-id="4353b-292">Помощник по совместимости программ (PCA) предоставляется в Windows Vista и более поздних версиях.</span><span class="sxs-lookup"><span data-stu-id="4353b-292">The Program Compatibility Assistant (PCA) is provided in Windows Vista and later.</span></span> <span data-ttu-id="4353b-293">Его целью является предоставление автоматизированного метода для создания более старых программ с проблемами совместимости.</span><span class="sxs-lookup"><span data-stu-id="4353b-293">Its purpose is to provide an automated method to make older programs with compatibility issues work better.</span></span> <span data-ttu-id="4353b-294">PCA отслеживает известные проблемы в программах.</span><span class="sxs-lookup"><span data-stu-id="4353b-294">The PCA monitors programs for known issues.</span></span> <span data-ttu-id="4353b-295">При обнаружении проблемы он уведомляет пользователя о проблеме и предлагает применить эффективные решения, прежде чем пользователь снова запустит программу.</span><span class="sxs-lookup"><span data-stu-id="4353b-295">If an issue is detected, it notifies the user of the problem and offers to apply effective solutions before the user runs the program again.</span></span> <span data-ttu-id="4353b-296">Чтобы избежать этих предупреждений или блоков, независимые поставщики программного обеспечения должны использовать множество доступных средств, чтобы обеспечить совместимость их приложений с Windows Vista, Windows 7 и более поздними версиями.</span><span class="sxs-lookup"><span data-stu-id="4353b-296">To avoid seeing these warnings or blocks, ISVs should use the many available tools to ensure that their applications are compatible with Windows Vista, Windows 7, and later.</span></span>

### <a name="support-for-previous-windows-operating-system-versions"></a><span data-ttu-id="4353b-297">Поддержка предыдущих версий операционной системы Windows</span><span class="sxs-lookup"><span data-stu-id="4353b-297">Support for Previous Windows Operating System Versions</span></span>

<span data-ttu-id="4353b-298">Инфраструктура программ по умолчанию недоступна в любой операционной системе Windows до Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="4353b-298">The Default Programs infrastructure is not available on any Windows operating system before Windows Vista.</span></span> <span data-ttu-id="4353b-299">Таким образом, когда приложения переходят в новую инфраструктуру программ по умолчанию, они должны сохранить старый код приложения по умолчанию для обеспечения совместимости с предыдущими версиями Windows.</span><span class="sxs-lookup"><span data-stu-id="4353b-299">Therefore, when applications move to the new Default Programs infrastructure, they should retain their older application-defaults code to maintain compatibility with older versions of Windows.</span></span> <span data-ttu-id="4353b-300">Приложение должно выполнить проверку версии операционной системы в рамках своей установки, чтобы определить, какой код приложения по умолчанию следует запустить.</span><span class="sxs-lookup"><span data-stu-id="4353b-300">An application should run an operating system version check as part of its installation to determine which application-defaults code to run.</span></span>

<span data-ttu-id="4353b-301">Для поддержки обновления Windows XP до Windows Vista или более поздней версии приложения должны добавить все записи реестра, необходимые для программ по умолчанию, даже если они устанавливаются на компьютере под управлением Windows XP.</span><span class="sxs-lookup"><span data-stu-id="4353b-301">To support an upgrade from Windows XP to Windows Vista or later, applications should add all the registry entries required for Default Programs even when they are installing on a computer running Windows XP.</span></span> <span data-ttu-id="4353b-302">Регистрация не будет оказывать влияния на компьютер под управлением Windows XP, но если компьютер будет обновлен позже, приложение уже будет зарегистрировано и сможет воспользоваться преимуществами платформы.</span><span class="sxs-lookup"><span data-stu-id="4353b-302">The registration will have no effect on a computer running Windows XP, but if the computer is later upgraded, the application will be already registered and able to take advantage of the framework.</span></span>

<span data-ttu-id="4353b-303">Дополнительные сведения см. в разделе [**осверсионинфо**](/windows/win32/api/winnt/ns-winnt-osversioninfoa).</span><span class="sxs-lookup"><span data-stu-id="4353b-303">For more information, see [**OSVERSIONINFO**](/windows/win32/api/winnt/ns-winnt-osversioninfoa).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="4353b-304">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="4353b-304">Additional Resources</span></span>

-   [<span data-ttu-id="4353b-305">Общие сведения о сопоставлении файлов</span><span class="sxs-lookup"><span data-stu-id="4353b-305">Introduction to File Associations</span></span>](fa-intro.md)
-   [<span data-ttu-id="4353b-306">Как зарегистрировать Интернет браузер или почтовый клиент в меню "Пуск" Windows</span><span class="sxs-lookup"><span data-stu-id="4353b-306">How to Register an Internet Browser or Email Client With the Windows Start Menu</span></span>](start-menu-reg.md)
-   <span data-ttu-id="4353b-307">[Регистрация приложения в схеме URI](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa767914(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="4353b-307">[Registering an Application to a URI Scheme](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa767914(v=vs.85))</span></span>

## <a name="related-topics"></a><span data-ttu-id="4353b-308">См. также</span><span class="sxs-lookup"><span data-stu-id="4353b-308">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4353b-309">Рекомендации по сопоставлению файлов</span><span class="sxs-lookup"><span data-stu-id="4353b-309">Best Practices for File Associations</span></span>](fa-best-practices.md)
</dt> <dt>

[<span data-ttu-id="4353b-310">Пример сценария сопоставления файлов</span><span class="sxs-lookup"><span data-stu-id="4353b-310">File Association Sample Scenario</span></span>](fa-sample-scenarios.md)
</dt> <dt>

[<span data-ttu-id="4353b-311">Программы по умолчанию</span><span class="sxs-lookup"><span data-stu-id="4353b-311">Default Programs</span></span>](default-programs.md)
</dt> <dt>

[<span data-ttu-id="4353b-312">Работа с настройками доступа к программам и параметров по умолчанию (SPAD)</span><span class="sxs-lookup"><span data-stu-id="4353b-312">Working with Set Program Access and Computer Defaults (SPAD)</span></span>](cpl-setprogramaccess.md)
</dt> </dl>

 

 
