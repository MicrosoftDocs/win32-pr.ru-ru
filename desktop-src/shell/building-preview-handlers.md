---
description: В этом разделе обсуждаются конкретные интерфейсы и методы, необходимые для создания обработчика просмотра.
ms.assetid: 6c240a63-c184-4b65-9483-794f5de4d695
title: Создание обработчиков предварительного просмотра
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a309873cf082071d5f426ce0ba6d039107c59665
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104342852"
---
# <a name="building-preview-handlers"></a><span data-ttu-id="29603-103">Создание обработчиков предварительного просмотра</span><span class="sxs-lookup"><span data-stu-id="29603-103">Building Preview Handlers</span></span>

<span data-ttu-id="29603-104">В этом разделе обсуждаются конкретные интерфейсы и методы, необходимые для создания обработчика просмотра.</span><span class="sxs-lookup"><span data-stu-id="29603-104">This topic discusses the specific interfaces and methods required to create a preview handler.</span></span>

<span data-ttu-id="29603-105">Обработчик просмотра должен реализовывать следующие интерфейсы:</span><span class="sxs-lookup"><span data-stu-id="29603-105">A preview handler must implement the following interfaces:</span></span>

-   <span data-ttu-id="29603-106">[IInitializeWithStream:: Initialize](#iinitializewithstreaminitialize) (настоятельно рекомендуется), [**IInitializeWithFile**](/windows/desktop/api/Propsys/nn-propsys-iinitializewithfile)или [**иинитиализевиситем**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-iinitializewithitem)</span><span class="sxs-lookup"><span data-stu-id="29603-106">[IInitializeWithStream::Initialize](#iinitializewithstreaminitialize) (strongly preferred), [**IInitializeWithFile**](/windows/desktop/api/Propsys/nn-propsys-iinitializewithfile), or [**IInitializeWithItem**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-iinitializewithitem)</span></span>
-   [<span data-ttu-id="29603-107">IObjectWithSite</span><span class="sxs-lookup"><span data-stu-id="29603-107">IObjectWithSite</span></span>](#iobjectwithsite)
-   [<span data-ttu-id="29603-108">иолевиндов</span><span class="sxs-lookup"><span data-stu-id="29603-108">IOleWindow</span></span>](#iolewindow)
-   [<span data-ttu-id="29603-109">IPreviewHandler</span><span class="sxs-lookup"><span data-stu-id="29603-109">IPreviewHandler</span></span>](#ipreviewhandler)

<span data-ttu-id="29603-110">Если обработчик просмотра поддерживает визуальные параметры, предоставляемые узлом, например цвет фона и шрифт, он должен также реализовать следующий интерфейс:</span><span class="sxs-lookup"><span data-stu-id="29603-110">If your preview handler supports visual settings provided by the host such as background color and font, it must also implement the following interface:</span></span>

-   [<span data-ttu-id="29603-111">ипревиевхандлервисуалс</span><span class="sxs-lookup"><span data-stu-id="29603-111">IPreviewHandlerVisuals</span></span>](#ipreviewhandlervisuals)

<span data-ttu-id="29603-112">В этом разделе предполагается, что обработчик просмотра инициализируется потоком и зарегистрирован для определенного расширения имени файла.</span><span class="sxs-lookup"><span data-stu-id="29603-112">This topic assumes that the preview handler is initialized with a stream and is registered for a particular file name extension.</span></span>

## <a name="iinitializewithstreaminitialize"></a><span data-ttu-id="29603-113">IInitializeWithStream:: Initialize</span><span class="sxs-lookup"><span data-stu-id="29603-113">IInitializeWithStream::Initialize</span></span>

<span data-ttu-id="29603-114">Сохраните параметры [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) и Mode, чтобы вы могли считывать данные элемента, когда будете готовы к предварительному просмотру элемента.</span><span class="sxs-lookup"><span data-stu-id="29603-114">Store the [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) and mode parameters so that you can read the item's data when you are ready to preview the item.</span></span> <span data-ttu-id="29603-115">Не загружайте данные в [**Initialize**](/windows/desktop/api/Propsys/nf-propsys-iinitializewithstream-initialize).</span><span class="sxs-lookup"><span data-stu-id="29603-115">Do not load the data in [**Initialize**](/windows/desktop/api/Propsys/nf-propsys-iinitializewithstream-initialize).</span></span> <span data-ttu-id="29603-116">Загрузите данные в [**IPreviewHandler::D опревиев**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) непосредственно перед отрисовкой.</span><span class="sxs-lookup"><span data-stu-id="29603-116">Load the data in [**IPreviewHandler::DoPreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) just before you render.</span></span>

## <a name="iobjectwithsite"></a><span data-ttu-id="29603-117">IObjectWithSite</span><span class="sxs-lookup"><span data-stu-id="29603-117">IObjectWithSite</span></span>

-   [<span data-ttu-id="29603-118">IObjectWithSite:: SetSite</span><span class="sxs-lookup"><span data-stu-id="29603-118">IObjectWithSite::SetSite</span></span>](#iobjectwithsitesetsite)
-   [<span data-ttu-id="29603-119">IObjectWithSite::-сайт</span><span class="sxs-lookup"><span data-stu-id="29603-119">IObjectWithSite::GetSite</span></span>](#iobjectwithsitegetsite)

### <a name="iobjectwithsitesetsite"></a><span data-ttu-id="29603-120">IObjectWithSite:: SetSite</span><span class="sxs-lookup"><span data-stu-id="29603-120">IObjectWithSite::SetSite</span></span>

<span data-ttu-id="29603-121">Сохраните указатель [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) для последующего доступа.</span><span class="sxs-lookup"><span data-stu-id="29603-121">Store the [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer for later access.</span></span>

<span data-ttu-id="29603-122">Если в настоящее время имеется ссылка на объект [**IPreviewHandlerFrame**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlerframe) , освободите его.</span><span class="sxs-lookup"><span data-stu-id="29603-122">If you currently have a reference to an [**IPreviewHandlerFrame**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlerframe) object, release it.</span></span> <span data-ttu-id="29603-123">Используйте сохраненный указатель [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) для вызова [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) на сайте для новой ссылки **IPreviewHandlerFrame** .</span><span class="sxs-lookup"><span data-stu-id="29603-123">Use the stored [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer to call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on the site for a new **IPreviewHandlerFrame** reference.</span></span>

<span data-ttu-id="29603-124">Если у вас уже есть таблица сочетаний клавиш, удалите ее.</span><span class="sxs-lookup"><span data-stu-id="29603-124">If you currently have an accelerator table, destroy it.</span></span> <span data-ttu-id="29603-125">Вызовите [**IPreviewHandlerFrame:: GetWindowContext**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-getwindowcontext) , чтобы получить новую таблицу сочетаний клавиш.</span><span class="sxs-lookup"><span data-stu-id="29603-125">Call [**IPreviewHandlerFrame::GetWindowContext**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-getwindowcontext) to get a new accelerator table.</span></span> <span data-ttu-id="29603-126">Сохранить эту таблицу.</span><span class="sxs-lookup"><span data-stu-id="29603-126">Store this table.</span></span> <span data-ttu-id="29603-127">Обратите внимание, что он используется только в качестве списка сочетаний клавиш, поддерживаемых кадром.</span><span class="sxs-lookup"><span data-stu-id="29603-127">Note that it is used only as a list of accelerator keys that the frame supports.</span></span> <span data-ttu-id="29603-128">Команды в записи ускорителя игнорируются.</span><span class="sxs-lookup"><span data-stu-id="29603-128">Commands in the accelerator entries are ignored.</span></span>

### <a name="iobjectwithsitegetsite"></a><span data-ttu-id="29603-129">IObjectWithSite::-сайт</span><span class="sxs-lookup"><span data-stu-id="29603-129">IObjectWithSite::GetSite</span></span>

<span data-ttu-id="29603-130">Возврат указателя сайта, независимо от его значения.</span><span class="sxs-lookup"><span data-stu-id="29603-130">Return the site pointer, whatever it is.</span></span>

## <a name="iolewindow"></a><span data-ttu-id="29603-131">иолевиндов</span><span class="sxs-lookup"><span data-stu-id="29603-131">IOleWindow</span></span>

-   [<span data-ttu-id="29603-132">Иолевиндов:: Контекстсенситивехелп</span><span class="sxs-lookup"><span data-stu-id="29603-132">IOleWindow::ContextSensitiveHelp</span></span>](#iolewindowcontextsensitivehelp)
-   [<span data-ttu-id="29603-133">Иолевиндов::/Window</span><span class="sxs-lookup"><span data-stu-id="29603-133">IOleWindow::GetWindow</span></span>](#iolewindowgetwindow)

### <a name="iolewindowcontextsensitivehelp"></a><span data-ttu-id="29603-134">Иолевиндов:: Контекстсенситивехелп</span><span class="sxs-lookup"><span data-stu-id="29603-134">IOleWindow::ContextSensitiveHelp</span></span>

<span data-ttu-id="29603-135">\_Для этого метода возвращается E нотимпл.</span><span class="sxs-lookup"><span data-stu-id="29603-135">Return E\_NOTIMPL for this method.</span></span>

### <a name="iolewindowgetwindow"></a><span data-ttu-id="29603-136">Иолевиндов::/Window</span><span class="sxs-lookup"><span data-stu-id="29603-136">IOleWindow::GetWindow</span></span>

<span data-ttu-id="29603-137">Если окно обработчика просмотра в данный момент существует, возвратите **HWND** этого окна и \_ ОК.</span><span class="sxs-lookup"><span data-stu-id="29603-137">If the preview handler's window currently exists, return the **HWND** of that window and S\_OK.</span></span> <span data-ttu-id="29603-138">Если окно не существует, возвращается значение E \_ Fail.</span><span class="sxs-lookup"><span data-stu-id="29603-138">If the window does not exist, return E\_FAIL.</span></span>

## <a name="ipreviewhandler"></a><span data-ttu-id="29603-139">IPreviewHandler</span><span class="sxs-lookup"><span data-stu-id="29603-139">IPreviewHandler</span></span>

-   [<span data-ttu-id="29603-140">IPreviewHandler:: Сетвиндов</span><span class="sxs-lookup"><span data-stu-id="29603-140">IPreviewHandler::SetWindow</span></span>](#ipreviewhandlersetwindow)
-   [<span data-ttu-id="29603-141">IPreviewHandler:: SetRect</span><span class="sxs-lookup"><span data-stu-id="29603-141">IPreviewHandler::SetRect</span></span>](#ipreviewhandlersetrect)
-   [<span data-ttu-id="29603-142">IPreviewHandler::D Опревиев</span><span class="sxs-lookup"><span data-stu-id="29603-142">IPreviewHandler::DoPreview</span></span>](#ipreviewhandlerdopreview)
-   [<span data-ttu-id="29603-143">IPreviewHandler:: SetFocus</span><span class="sxs-lookup"><span data-stu-id="29603-143">IPreviewHandler::SetFocus</span></span>](#ipreviewhandlersetfocus)
-   [<span data-ttu-id="29603-144">IPreviewHandler:: Куерифокус</span><span class="sxs-lookup"><span data-stu-id="29603-144">IPreviewHandler::QueryFocus</span></span>](#ipreviewhandlerqueryfocus)
-   [<span data-ttu-id="29603-145">IPreviewHandler:: TranslateAccelerator</span><span class="sxs-lookup"><span data-stu-id="29603-145">IPreviewHandler::TranslateAccelerator</span></span>](#ipreviewhandlertranslateaccelerator)
-   [<span data-ttu-id="29603-146">IPreviewHandler:: unload</span><span class="sxs-lookup"><span data-stu-id="29603-146">IPreviewHandler::Unload</span></span>](#ipreviewhandlerunload)

### <a name="ipreviewhandlersetwindow"></a><span data-ttu-id="29603-147">IPreviewHandler:: Сетвиндов</span><span class="sxs-lookup"><span data-stu-id="29603-147">IPreviewHandler::SetWindow</span></span>

<span data-ttu-id="29603-148">Установите параметр *HWND* этого метода в родительский элемент **HWND** обработчика просмотра.</span><span class="sxs-lookup"><span data-stu-id="29603-148">Set the *hwnd* parameter of this method to the parent of your preview handler's **HWND**.</span></span> <span data-ttu-id="29603-149">Этот метод можно вызывать несколько раз.</span><span class="sxs-lookup"><span data-stu-id="29603-149">This method can be called multiple times.</span></span> <span data-ttu-id="29603-150">Измените размер предварительной версии так, чтобы она отображалась только в области, описанной параметром *PRC* .</span><span class="sxs-lookup"><span data-stu-id="29603-150">Resize your preview so that it renders only in the area described by the *prc* parameter.</span></span>

<span data-ttu-id="29603-151">Если предварительный просмотр находится в процессе подготовки к просмотру, используйте метод [**IPreviewHandler:: сетвиндов**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow) , чтобы изменить родительский элемент для предварительного просмотра.</span><span class="sxs-lookup"><span data-stu-id="29603-151">If the previewer is in the process of rendering, use the [**IPreviewHandler::SetWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow) method to change the parent of the previewer.</span></span> <span data-ttu-id="29603-152">Также измените область, в которой будет отображаться предварительный просмотр.</span><span class="sxs-lookup"><span data-stu-id="29603-152">Also change the area in which the previewer is rendering.</span></span>

### <a name="ipreviewhandlersetrect"></a><span data-ttu-id="29603-153">IPreviewHandler:: SetRect</span><span class="sxs-lookup"><span data-stu-id="29603-153">IPreviewHandler::SetRect</span></span>

<span data-ttu-id="29603-154">Измените размер предварительной версии так, чтобы она отображалась только в области, описанной в этом методе ( *PRC*).</span><span class="sxs-lookup"><span data-stu-id="29603-154">Resize your preview so that it only renders in the area described by this method's *prc*.</span></span>

<span data-ttu-id="29603-155">Если средство просмотра находится в процессе подготовки к просмотру, измените область, в которой будет отображаться средство предварительного просмотра.</span><span class="sxs-lookup"><span data-stu-id="29603-155">If the previewer is in the process of rendering, change the area in which your previewer renders.</span></span>

### <a name="ipreviewhandlerdopreview"></a><span data-ttu-id="29603-156">IPreviewHandler::D Опревиев</span><span class="sxs-lookup"><span data-stu-id="29603-156">IPreviewHandler::DoPreview</span></span>

<span data-ttu-id="29603-157">Именно здесь выполняется реальная работа.</span><span class="sxs-lookup"><span data-stu-id="29603-157">This is where the real work is done.</span></span> <span data-ttu-id="29603-158">Так как предварительная версия является динамической, содержимое для предварительного просмотра должно загружаться только тогда, когда оно требуется.</span><span class="sxs-lookup"><span data-stu-id="29603-158">Since a preview is dynamic, the preview content should only be loaded when it is needed.</span></span> <span data-ttu-id="29603-159">Не загружайте содержимое в инициализацию.</span><span class="sxs-lookup"><span data-stu-id="29603-159">Do not load content in the initialization.</span></span>

<span data-ttu-id="29603-160">Если окно обработчика просмотра не существует, создайте его.</span><span class="sxs-lookup"><span data-stu-id="29603-160">If the preview handler window does not exist, create it.</span></span> <span data-ttu-id="29603-161">Окна обработчика просмотра должны быть дочерними по отношению к окну, предоставленному [**IPreviewHandler:: сетвиндов**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow).</span><span class="sxs-lookup"><span data-stu-id="29603-161">Your preview handler's windows should be children of the window provided by [**IPreviewHandler::SetWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow).</span></span> <span data-ttu-id="29603-162">Они должны иметь размер, предоставляемый **IPreviewHandler:: сетвиндов** и [**IPreviewHandler:: SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect) (в зависимости от того, что вызывалось наиболее часто).</span><span class="sxs-lookup"><span data-stu-id="29603-162">They should be the size provided by **IPreviewHandler::SetWindow** and [**IPreviewHandler::SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect) (whichever was called most recently).</span></span>

<span data-ttu-id="29603-163">После создания окна Загрузите данные из [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) , который был инициализирован обработчиком просмотра, и выводит эти данные в окно обработчика просмотра.</span><span class="sxs-lookup"><span data-stu-id="29603-163">Once you have a window, load the data from the [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) that the preview handler was initialized with, and render that data to your preview handler's window.</span></span>

### <a name="ipreviewhandlersetfocus"></a><span data-ttu-id="29603-164">IPreviewHandler:: SetFocus</span><span class="sxs-lookup"><span data-stu-id="29603-164">IPreviewHandler::SetFocus</span></span>

<span data-ttu-id="29603-165">Этот метод вызывается, когда фокус переходит на панель чтения с помощью действия Tab.</span><span class="sxs-lookup"><span data-stu-id="29603-165">This method is called when the focus enters the reading pane through a tab action.</span></span> <span data-ttu-id="29603-166">Так как его можно указать в качестве вкладки пересылки или обратную табуляцию, используйте текущее состояние клавиши SHIFT, чтобы решить, должна ли фокус первой или последней позиции табуляции на панели чтения.</span><span class="sxs-lookup"><span data-stu-id="29603-166">Since it can be entered as a forward tab or reverse tab, use the current state of the SHIFT key to decide whether the first or last tab stop in the reading pane should receive the focus.</span></span>

### <a name="ipreviewhandlerqueryfocus"></a><span data-ttu-id="29603-167">IPreviewHandler:: Куерифокус</span><span class="sxs-lookup"><span data-stu-id="29603-167">IPreviewHandler::QueryFocus</span></span>

<span data-ttu-id="29603-168">Этот метод должен вызывать функцию [**Focus**](/windows/win32/api/winuser/nf-winuser-getfocus) и возвращать результат этого вызова в параметре *ФВНД* .</span><span class="sxs-lookup"><span data-stu-id="29603-168">This method should call the [**GetFocus**](/windows/win32/api/winuser/nf-winuser-getfocus) function and return the result of that call in the *phwnd* parameter.</span></span>

### <a name="ipreviewhandlertranslateaccelerator"></a><span data-ttu-id="29603-169">IPreviewHandler:: TranslateAccelerator</span><span class="sxs-lookup"><span data-stu-id="29603-169">IPreviewHandler::TranslateAccelerator</span></span>

<span data-ttu-id="29603-170">Этот метод вызывается конвейером сообщений процесса обработчика просмотра (prevhost.exe или настраиваемого локального сервера) в ответ на нажатие клавиш пользователя.</span><span class="sxs-lookup"><span data-stu-id="29603-170">This method is called by the message pump of the preview handler's process (whether prevhost.exe or a custom local server) in response to user keystrokes.</span></span> <span data-ttu-id="29603-171">Обработчики просмотра должны обменять эти нажатия клавиш или пересылать их на свои узлы в соответствии с алгоритмом, описанным ниже.</span><span class="sxs-lookup"><span data-stu-id="29603-171">Preview handlers should handle these keystrokes or forward them to their host according to the algorithm detailed below.</span></span>

<span data-ttu-id="29603-172">Тем не менее, поскольку предварительные версии доступны только для чтения, ввод с клавиатуры должен быть минимальным и оптимизацией, например, в большинстве случаев не требуется.</span><span class="sxs-lookup"><span data-stu-id="29603-172">However, because previews are read-only, keyboard input should be minimal and optimizations such as this are not needed in many cases.</span></span>

<span data-ttu-id="29603-173">Если сочетание клавиш, переданное этому методу с помощью конвейера сообщений, является ускорителем, который принимает обработчик предварительного просмотра, обработайте его и возвратит S \_ ОК.</span><span class="sxs-lookup"><span data-stu-id="29603-173">If the keyboard accelerator passed to this method through the message pump is an accelerator that your preview handler accepts, then process it and return S\_OK.</span></span> <span data-ttu-id="29603-174">Если обработчик не принимает этот ускоритель, сообщение ускорителя может быть отправлено назад, как и обрабатываемый кадр.</span><span class="sxs-lookup"><span data-stu-id="29603-174">If your handler does not accept that accelerator, the accelerator message can be sent back as far as the frame to be handled.</span></span>

<span data-ttu-id="29603-175">Есть два варианта перенаправления сочетаний клавиш в рамку:</span><span class="sxs-lookup"><span data-stu-id="29603-175">There are two options for forwarding keyboard accelerators back to the frame:</span></span>

<span data-ttu-id="29603-176">Простейшая модель заключается в пересылке всех нажатий клавиш на узел с помощью [**IPreviewHandlerFrame:: TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-translateaccelerator).</span><span class="sxs-lookup"><span data-stu-id="29603-176">The simplest model is to forward all keystrokes to the host using [**IPreviewHandlerFrame::TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-translateaccelerator).</span></span> <span data-ttu-id="29603-177">Это делается в образце обработчика просмотра, который предоставляется в пакете SDK для Windows.</span><span class="sxs-lookup"><span data-stu-id="29603-177">This is done in the preview handler sample provided with the Windows Software Development Kit (SDK).</span></span> <span data-ttu-id="29603-178">Все обработчики предварительной версии с низким уровнем целостности должны использовать эту модель.</span><span class="sxs-lookup"><span data-stu-id="29603-178">All low-integrity preview handlers must use this model.</span></span> <span data-ttu-id="29603-179">Если ускоритель не обрабатывается обработчиком просмотра, вызовите метод **IPreviewHandlerFrame:: TranslateAccelerator** и возвратите его результат.</span><span class="sxs-lookup"><span data-stu-id="29603-179">If the accelerator is not handled by your preview handler, call **IPreviewHandlerFrame::TranslateAccelerator** and return its result.</span></span>

<span data-ttu-id="29603-180">Другая модель заключается в использовании таблицы сочетаний клавиш в качестве оптимизации, чтобы избежать отправки слишком большого количества нажатий клавиш через границы процесса:</span><span class="sxs-lookup"><span data-stu-id="29603-180">The other model is to use an accelerator table as an optimization to avoid sending too many keystrokes across process boundaries:</span></span>

1.  <span data-ttu-id="29603-181">Когда в обработчике просмотра вызывается [**IObjectWithSite:: SetSite**](/windows/win32/api/ocidl/nf-ocidl-iobjectwithsite-setsite) , получите таблицу сочетаний клавиш через [**IPreviewHandlerFrame:: GetWindowContext**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-getwindowcontext).</span><span class="sxs-lookup"><span data-stu-id="29603-181">When [**IObjectWithSite::SetSite**](/windows/win32/api/ocidl/nf-ocidl-iobjectwithsite-setsite) is called on your preview handler, acquire the accelerator table through [**IPreviewHandlerFrame::GetWindowContext**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-getwindowcontext).</span></span> <span data-ttu-id="29603-182">(Не забудьте освободить маркер в таблице сочетаний клавиш при уничтожении предварительного просмотра.)</span><span class="sxs-lookup"><span data-stu-id="29603-182">(Be sure to free the handle to the accelerator table when your previewer is destroyed.)</span></span>
2.  <span data-ttu-id="29603-183">Если ускоритель обрабатывается обработчиком просмотра, его следует обработать и вернуть \_ ОК.</span><span class="sxs-lookup"><span data-stu-id="29603-183">If the accelerator is handled by your preview handler, handle it and return S\_OK.</span></span>
3.  <span data-ttu-id="29603-184">Если ускоритель не обрабатывается обработчиком просмотра, Сравните сообщение с помощью функции [**Accelerator**](/windows/win32/api/ole2/nf-ole2-isaccelerator) с полученной таблицей сочетаний клавиш.</span><span class="sxs-lookup"><span data-stu-id="29603-184">If the accelerator is not handled by your preview handler, compare the message using [**IsAccelerator**](/windows/win32/api/ole2/nf-ole2-isaccelerator) against the accelerator table acquired.</span></span>
4.  <span data-ttu-id="29603-185">Если ускоритель соответствует записи в этой таблице сочетаний клавиш, вызовите [**IPreviewHandlerFrame:: TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-translateaccelerator) и возвратите результат.</span><span class="sxs-lookup"><span data-stu-id="29603-185">If the accelerator matches an entry in that accelerator table, call [**IPreviewHandlerFrame::TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-translateaccelerator) and return its result.</span></span>
5.  <span data-ttu-id="29603-186">Если сочетание клавиш не соответствует ни одной записи в таблице сочетаний клавиш, возвращается \_ значение false.</span><span class="sxs-lookup"><span data-stu-id="29603-186">If the accelerator does not match any entry in the accelerator table, return S\_FALSE.</span></span>

### <a name="ipreviewhandlerunload"></a><span data-ttu-id="29603-187">IPreviewHandler:: unload</span><span class="sxs-lookup"><span data-stu-id="29603-187">IPreviewHandler::Unload</span></span>

<span data-ttu-id="29603-188">При вызове этого метода следует прекратить обработку, освободить все ресурсы, выделенные с помощью считывания данных из потока, и освободить сам [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) .</span><span class="sxs-lookup"><span data-stu-id="29603-188">When this method is called, stop any rendering, release any resources allocated by reading data from the stream, and release the [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) itself.</span></span>

<span data-ttu-id="29603-189">После вызова этого метода обработчик должен быть повторно инициализирован перед любой попыткой вызова [**IPreviewHandler::D опревиев**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) .</span><span class="sxs-lookup"><span data-stu-id="29603-189">Once this method is called, the handler must be reinitialized before any attempt to call [**IPreviewHandler::DoPreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) again.</span></span>

## <a name="ipreviewhandlervisuals"></a><span data-ttu-id="29603-190">ипревиевхандлервисуалс</span><span class="sxs-lookup"><span data-stu-id="29603-190">IPreviewHandlerVisuals</span></span>

-   [<span data-ttu-id="29603-191">Ипревиевхандлервисуалс:: Сетбаккграундколор</span><span class="sxs-lookup"><span data-stu-id="29603-191">IPreviewHandlerVisuals::SetBackgroundColor</span></span>](#ipreviewhandlervisualssetbackgroundcolor)
-   [<span data-ttu-id="29603-192">Ипревиевхандлервисуалс:: Сетфонт</span><span class="sxs-lookup"><span data-stu-id="29603-192">IPreviewHandlerVisuals::SetFont</span></span>](#ipreviewhandlervisualssetfont)
-   [<span data-ttu-id="29603-193">Ипревиевхандлервисуалс:: Сеттекстколор</span><span class="sxs-lookup"><span data-stu-id="29603-193">IPreviewHandlerVisuals::SetTextColor</span></span>](#ipreviewhandlervisualssettextcolor)

<span data-ttu-id="29603-194">Эти методы должны быть реализованы, когда обработчик предварительного просмотра направляет ответ на схемы цвета и шрифта узла.</span><span class="sxs-lookup"><span data-stu-id="29603-194">These methods should be implemented when directing the preview handler to respond to the host's color and font schemes.</span></span> <span data-ttu-id="29603-195">Узел запрашивает обработчик для [**ипревиевхандлервисуалс**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlervisuals).</span><span class="sxs-lookup"><span data-stu-id="29603-195">The host queries the handler for [**IPreviewHandlerVisuals**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlervisuals).</span></span> <span data-ttu-id="29603-196">Если обнаружена поддержка, узел предоставляет ему цвет, шрифт и цвет текста.</span><span class="sxs-lookup"><span data-stu-id="29603-196">If found to be supported, the host provides it with color, font, and text color.</span></span>

### <a name="ipreviewhandlervisualssetbackgroundcolor"></a><span data-ttu-id="29603-197">Ипревиевхандлервисуалс:: Сетбаккграундколор</span><span class="sxs-lookup"><span data-stu-id="29603-197">IPreviewHandlerVisuals::SetBackgroundColor</span></span>

<span data-ttu-id="29603-198">Сохраните этот цвет и используйте его при подготовке к просмотру, если требуется предоставить цвет фона.</span><span class="sxs-lookup"><span data-stu-id="29603-198">Store this color and use it during rendering when you want to provide a background color.</span></span> <span data-ttu-id="29603-199">Например, для заполнения окна при визуализации обработчика в область, меньшую, чем область, предоставленная [**IPreviewHandler:: сетвиндов**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow) и [**IPreviewHandler:: SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect).</span><span class="sxs-lookup"><span data-stu-id="29603-199">For instance, to fill the window when the handler renders to an area smaller than the area provided by [**IPreviewHandler::SetWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow) and [**IPreviewHandler::SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect).</span></span> <span data-ttu-id="29603-200">Однако обратите внимание, что не следует рисовать за пределами области, предоставляемой этими методами.</span><span class="sxs-lookup"><span data-stu-id="29603-200">Note, however, that you should not draw outside the area provided by those methods.</span></span>

<span data-ttu-id="29603-201">Если этот метод вызывается в то время, когда Предварительная версия уже готовится к просмотру, то отрисовку следует перезапустить с помощью этого цвета фона.</span><span class="sxs-lookup"><span data-stu-id="29603-201">If this method is called while the preview is already being rendered, the rendering should be restarted using this background color.</span></span>

### <a name="ipreviewhandlervisualssetfont"></a><span data-ttu-id="29603-202">Ипревиевхандлервисуалс:: Сетфонт</span><span class="sxs-lookup"><span data-stu-id="29603-202">IPreviewHandlerVisuals::SetFont</span></span>

<span data-ttu-id="29603-203">Сохраняйте сведения о шрифтах и используйте их при подготовке к просмотру, если требуется отображать текст, согласованный с текущими параметрами Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="29603-203">Store this font information and use it during rendering when you want to display text consistent with the current Windows Vista settings.</span></span>

### <a name="ipreviewhandlervisualssettextcolor"></a><span data-ttu-id="29603-204">Ипревиевхандлервисуалс:: Сеттекстколор</span><span class="sxs-lookup"><span data-stu-id="29603-204">IPreviewHandlerVisuals::SetTextColor</span></span>

<span data-ttu-id="29603-205">Сохраните эти сведения о цвете текста и используйте их во время подготовки к просмотру, если требуется отображать текст, согласованный с текущими параметрами Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="29603-205">Store this text color information and use it during rendering when you want to display text consistent with the current Windows Vista settings.</span></span>

## <a name="related-topics"></a><span data-ttu-id="29603-206">См. также</span><span class="sxs-lookup"><span data-stu-id="29603-206">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="29603-207">Обработчик предварительной версии и узел предварительной версии оболочки</span><span class="sxs-lookup"><span data-stu-id="29603-207">Preview Handlers and Shell Preview Host</span></span>](preview-handlers.md)
</dt> <dt>

[<span data-ttu-id="29603-208">Регистрация обработчика просмотра</span><span class="sxs-lookup"><span data-stu-id="29603-208">How to Register a Preview Handler</span></span>](how-to-register-a-preview-handler.md)
</dt> <dt>

[<span data-ttu-id="29603-209">Рекомендации по обработчику предварительной версии</span><span class="sxs-lookup"><span data-stu-id="29603-209">Preview Handler Guidelines</span></span>](preview-handler-guidelines.md)
</dt> </dl>

 

 
