---
title: Уровень совместимости приложений
description: Для запуска устаревших приложений в среде службы удаленных рабочих столов можно использовать службы удаленных рабочих столов уровень совместимости приложений.
ms.assetid: 6e61ed45-4fcb-4aee-b8cc-638a9b87ce00
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b3e7bbc5867e42951783d3666aa770cdcc45406f
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105681692"
---
# <a name="application-compatibility-layer"></a><span data-ttu-id="15f1b-103">Уровень совместимости приложений</span><span class="sxs-lookup"><span data-stu-id="15f1b-103">Application compatibility layer</span></span>

<span data-ttu-id="15f1b-104">Для запуска устаревших приложений в среде службы удаленных рабочих столов можно использовать службы удаленных рабочих столов уровень совместимости приложений.</span><span class="sxs-lookup"><span data-stu-id="15f1b-104">To run legacy applications in a Remote Desktop Services environment you can use the Remote Desktop Services Application Compatibility layer.</span></span> <span data-ttu-id="15f1b-105">Когда сервер узла сеансов удаленный рабочий стол (узел сеансов удаленных рабочих столов) загружает приложение, которое не поддерживает службы удаленных рабочих столов, оно также загружает библиотеку DLL, содержащую код совместимости.</span><span class="sxs-lookup"><span data-stu-id="15f1b-105">When the Remote Desktop Session Host (RD Session Host) server loads an application that is not Remote Desktop Services aware, it also loads a DLL that contains compatibility code.</span></span> <span data-ttu-id="15f1b-106">Чтобы использовать службы удаленных рабочих столов уровень совместимости приложений, можно установить флаг NOT TSAWARE при компиляции приложения.</span><span class="sxs-lookup"><span data-stu-id="15f1b-106">To use the Remote Desktop Services Application Compatibility layer, you can set the NOT TSAWARE flag when compiling an application.</span></span>

<span data-ttu-id="15f1b-107">Если ваше приложение службы удаленных рабочих столов осведомлено, можно избежать дополнительной нагрузки на загрузку этой дополнительной библиотеки DLL и выполнение кода совместимости.</span><span class="sxs-lookup"><span data-stu-id="15f1b-107">If your application is Remote Desktop Services aware, you can avoid the overhead of loading this extra DLL and running the compatibility code.</span></span>

<span data-ttu-id="15f1b-108">Чтобы указать, что приложение службы удаленных рабочих столов осведомлено, установите флаг **" \_ образ \_ DLLCHARACTERISTICS \_ терминалов \_** " для образа в необязательном заголовке.</span><span class="sxs-lookup"><span data-stu-id="15f1b-108">To indicate that your application is Remote Desktop Services aware, set the **IMAGE\_DLLCHARACTERISTICS\_TERMINAL\_SERVER\_AWARE** flag in the optional header.</span></span> <span data-ttu-id="15f1b-109">Если вы используете компоновщик, который поставляется с Microsoft Visual C++, для установки этого флага можно использовать параметр компоновщика **TSAWARE** .</span><span class="sxs-lookup"><span data-stu-id="15f1b-109">If you are using the linker that ships with Microsoft Visual C++, you can use the **TSAWARE** linker option to set this flag.</span></span> <span data-ttu-id="15f1b-110">Средство **dumpbin** , которое поставляется с Microsoft Visual C++, предоставляет параметр */headers* для определения состояния флага **TSAWARE** .</span><span class="sxs-lookup"><span data-stu-id="15f1b-110">The **DUMPBIN** tool that ships with Microsoft Visual C++ provides the */HEADERS* option to determine the state of the **TSAWARE** flag.</span></span> <span data-ttu-id="15f1b-111">Дополнительные сведения об использовании средства **dumpbin** см. в разделе [Справочник по DUMPBIN](/cpp/build/reference/dumpbin-reference?view=vs-2019).</span><span class="sxs-lookup"><span data-stu-id="15f1b-111">For more information about using the **DUMPBIN** tool, see [DUMPBIN Reference](/cpp/build/reference/dumpbin-reference?view=vs-2019).</span></span>

<span data-ttu-id="15f1b-112">Будьте внимательны при использовании флага **TSAWARE** , так как он позволяет приложению обходить любые службы удаленных рабочих столов оптимизации совместимости.</span><span class="sxs-lookup"><span data-stu-id="15f1b-112">Be careful when you use the **TSAWARE** flag because it enables your application to bypass any Remote Desktop Services compatibility optimizations.</span></span> <span data-ttu-id="15f1b-113">Флаг **TSAWARE** следует использовать только в том случае, если вы уверены, что приложение предназначено для среды службы удаленных рабочих столов.</span><span class="sxs-lookup"><span data-stu-id="15f1b-113">The **TSAWARE** flag should only be used if you are certain that your application is designed for the Remote Desktop Services environment.</span></span> <span data-ttu-id="15f1b-114">Если приложение соответствует следующим критериям, можно безопасно использовать флаг "DLLCHARACTERISTICS Image" для работы с **\_ \_ \_ сервером \_ терминалов** .</span><span class="sxs-lookup"><span data-stu-id="15f1b-114">If your application meets the following criteria, you can safely use the **IMAGE\_DLLCHARACTERISTICS\_TERMINAL\_SERVER\_AWARE** flag.</span></span>

-   <span data-ttu-id="15f1b-115">Приложение не использует ini-файлы.</span><span class="sxs-lookup"><span data-stu-id="15f1b-115">The application does not use .ini files.</span></span>
-   <span data-ttu-id="15f1b-116">Во время установки приложение не выполняет запись в **hKey \_ текущего \_ пользователя** .</span><span class="sxs-lookup"><span data-stu-id="15f1b-116">The application does not write to **HKEY\_CURRENT\_USER** during setup.</span></span> <span data-ttu-id="15f1b-117">Дополнительные сведения см. в разделе [Сохранение сведений о User-Specific](storing-user-specific-information.md).</span><span class="sxs-lookup"><span data-stu-id="15f1b-117">For more information, see [Storing User-Specific Information](storing-user-specific-information.md).</span></span>
-   <span data-ttu-id="15f1b-118">Приложение не запускается как системная служба (то есть LUID = System).</span><span class="sxs-lookup"><span data-stu-id="15f1b-118">The application does not run as a system service (that is, LUID=System).</span></span>
-   <span data-ttu-id="15f1b-119">Приложение не ждет монопольного доступа к системным каталогам Windows или.</span><span class="sxs-lookup"><span data-stu-id="15f1b-119">The application does not expect exclusive access to the Windows or other system directories.</span></span> <span data-ttu-id="15f1b-120">Это означает, что приложение не сохраняет временные или конфигурационные данные в Windows или других системных каталогах.</span><span class="sxs-lookup"><span data-stu-id="15f1b-120">This means that the application does not store per user temporary or configuration data in the Windows or other system directories.</span></span>
-   <span data-ttu-id="15f1b-121">Приложение не выполняет запись в куст реестра для **локального компьютера hKey** для данных или конфигурации конкретного пользователя.</span><span class="sxs-lookup"><span data-stu-id="15f1b-121">The application does not write to the **HKEY Local Machine** registry hive for user specific data or configuration.</span></span>
-   <span data-ttu-id="15f1b-122">Это приложение соответствует другим рекомендациям по совместимости службы удаленных рабочих столов, упомянутым в настоящем документе.</span><span class="sxs-lookup"><span data-stu-id="15f1b-122">The application follows other Remote Desktop Services compatibility guidelines mentioned in this document.</span></span>

 

 