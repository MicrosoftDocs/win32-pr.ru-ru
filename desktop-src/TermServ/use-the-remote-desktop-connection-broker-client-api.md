---
title: Как использовать API клиента компонента подключение к удаленному рабочему столу Broker
description: API клиента компонента подключение к удаленному рабочему столу Broker позволяет сторонним поставщикам протоколов использовать брокер подключений для ускорения обработки подключений, использующих протокол для подключения к виртуальным машинам или серверам удаленный рабочий стол в ферме.
ms.assetid: 05C2D6CA-C9C5-4783-B196-6A02918046EF
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c931245870cfb72aed54e5aaff24e12d03ddf9e7
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104338876"
---
# <a name="how-to-use-the-remote-desktop-connection-broker-client-api"></a><span data-ttu-id="49776-103">Как использовать API клиента компонента подключение к удаленному рабочему столу Broker</span><span class="sxs-lookup"><span data-stu-id="49776-103">How to use the Remote Desktop Connection Broker client API</span></span>

<span data-ttu-id="49776-104">API клиента компонента подключение к удаленному рабочему столу Broker позволяет сторонним поставщикам протоколов использовать брокер подключений для ускорения обработки подключений, использующих протокол для подключения к виртуальным машинам или серверам удаленный рабочий стол в ферме.</span><span class="sxs-lookup"><span data-stu-id="49776-104">The Remote Desktop Connection Broker client API allows third party protocol vendors to leverage the Connection Broker to expedite the handling of connections that use their protocol to connect to virtual machines or Remote Desktop servers in a farm.</span></span>

## <a name="instructions"></a><span data-ttu-id="49776-105">Инструкции</span><span class="sxs-lookup"><span data-stu-id="49776-105">Instructions</span></span>

### <a name="step-1-obtain-the-iconnectionbrokerclient-interface"></a><span data-ttu-id="49776-106">Шаг 1. Получение интерфейса Иконнектионброкерклиент</span><span class="sxs-lookup"><span data-stu-id="49776-106">Step 1: Obtain the IConnectionBrokerClient interface</span></span>

<span data-ttu-id="49776-107">После инициализации приложения или поставщика протокола выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="49776-107">When your application or protocol provider is initialized, perform the following steps.</span></span>

1.  <span data-ttu-id="49776-108">Вызовите функцию [**кбкреатеклиентинстанце**](cbcreateclientinstance.md) , чтобы получить интерфейс [**иконнектионброкерклиент**](iconnectionbrokerclient.md) .</span><span class="sxs-lookup"><span data-stu-id="49776-108">Call the [**CBCreateClientInstance**](cbcreateclientinstance.md) function to obtain the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface.</span></span>
2.  <span data-ttu-id="49776-109">Не заключайте интерфейс [**иконнектионброкерклиент**](iconnectionbrokerclient.md) , пока он вам нужен.</span><span class="sxs-lookup"><span data-stu-id="49776-109">Keep the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface as long as you need it.</span></span>
3.  <span data-ttu-id="49776-110">Если интерфейс [**иконнектионброкерклиент**](iconnectionbrokerclient.md) больше не нужен, вызовите метод [**Release**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-release) .</span><span class="sxs-lookup"><span data-stu-id="49776-110">When the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface is no longer needed, call the [**Release**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-release) method.</span></span>

### <a name="step-2-request-the-target-information"></a><span data-ttu-id="49776-111">Шаг 2. запрос сведений о целевом объекте</span><span class="sxs-lookup"><span data-stu-id="49776-111">Step 2: Request the target information</span></span>

<span data-ttu-id="49776-112">Когда поставщик протокола получает входящий запрос на подключение, выполните следующие действия, чтобы вызвать метод [**иконнектионброкерклиент:: жеттаржетинфо**](iconnectionbrokerclient-gettargetinfo.md) .</span><span class="sxs-lookup"><span data-stu-id="49776-112">When your protocol provider receives an incoming connection request, perform the following steps to call the [**IConnectionBrokerClient::GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) method.</span></span> <span data-ttu-id="49776-113">Этот метод получает от посредника подключений соответствующий сервер для перенаправления подключения.</span><span class="sxs-lookup"><span data-stu-id="49776-113">This method obtains, from the Connection Broker, the appropriate server to redirect the connection to.</span></span>

1.  <span data-ttu-id="49776-114">Создайте событие, которое может быть сигнальным с помощью функции [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa)или аналогичной, для использования в качестве параметра *хстатусевент* .</span><span class="sxs-lookup"><span data-stu-id="49776-114">Create an event that can be signaled using the [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa), or similar function, to use for the *hStatusEvent* parameter.</span></span>
2.  <span data-ttu-id="49776-115">Выделите память для параметров *птаржетинфо* и *пресулт* .</span><span class="sxs-lookup"><span data-stu-id="49776-115">Allocate memory for the *pTargetInfo* and *pResult* parameters.</span></span> <span data-ttu-id="49776-116">Эти блоки памяти должны оставаться на месте до тех пор, пока не завершится вся последовательность.</span><span class="sxs-lookup"><span data-stu-id="49776-116">These memory blocks must remain in place until after this entire sequence is complete.</span></span>
3.  <span data-ttu-id="49776-117">Заполните [**структуру \_ \_ сведений о соединении CB**](cb-connection-info.md) , содержащую всю информацию о входящем соединении.</span><span class="sxs-lookup"><span data-stu-id="49776-117">Fill out a [**CB\_CONNECTION\_INFO**](cb-connection-info.md) structure that contains all of the information about the incoming connection.</span></span>
4.  <span data-ttu-id="49776-118">Вызовите метод [**жеттаржетинфо**](iconnectionbrokerclient-gettargetinfo.md) , передав все необходимые параметры.</span><span class="sxs-lookup"><span data-stu-id="49776-118">Call the [**GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) method, passing all of the required parameters.</span></span> <span data-ttu-id="49776-119">Это асинхронный метод, который будет возвращать экземпляр интерфейса [**иконнектионброкеррекуест**](iconnectionbrokerrequest.md) .</span><span class="sxs-lookup"><span data-stu-id="49776-119">This is an asynchronous method that will return an instance of the [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) interface.</span></span>
5.  <span data-ttu-id="49776-120">Дождитесь, пока будет установлено событие *хстатусевент* .</span><span class="sxs-lookup"><span data-stu-id="49776-120">Wait for the *hStatusEvent* event to become set.</span></span>
6.  <span data-ttu-id="49776-121">Если задано событие *хстатусевент* , вызовите метод [**Иконнектионброкеррекуест:: CheckStatus**](iconnectionbrokerrequest-checkstatus.md) , чтобы определить состояние запроса.</span><span class="sxs-lookup"><span data-stu-id="49776-121">Whenever the *hStatusEvent* event is set, call the [**IConnectionBrokerRequest::CheckStatus**](iconnectionbrokerrequest-checkstatus.md) method to determine the status of the request.</span></span>
7.  <span data-ttu-id="49776-122">Когда [**CheckStatus**](iconnectionbrokerrequest-checkstatus.md) возвращает **\_ запрос о \_ состоянии \_ CB**, параметры *птаржетинфо* и *пресулт* будут содержать их сведения.</span><span class="sxs-lookup"><span data-stu-id="49776-122">When [**CheckStatus**](iconnectionbrokerrequest-checkstatus.md) returns **CB\_STATUS\_REQUEST\_COMPLETED**, the *pTargetInfo* and *pResult* parameters will contain their information.</span></span> <span data-ttu-id="49776-123">Цикл ожидания можно прервать, так как параметр *хстатусевент* больше не будет использоваться.</span><span class="sxs-lookup"><span data-stu-id="49776-123">You can break out of the wait loop because the *hStatusEvent* parameter will no longer be used.</span></span>
8.  <span data-ttu-id="49776-124">Используйте сведения в структуре [**\_ \_ сведений о целевом объекте CB**](cb-target-info.md) , представленной параметром *птаржетинфо* , чтобы определить, куда перенаправлять входящее подключение.</span><span class="sxs-lookup"><span data-stu-id="49776-124">Use the information in the [**CB\_TARGET\_INFO**](cb-target-info.md) structure represented by the *pTargetInfo* parameter to determine where to redirect the incoming connection to.</span></span>
9.  <span data-ttu-id="49776-125">Освободите интерфейс [**иконнектионброкеррекуест**](iconnectionbrokerrequest.md) .</span><span class="sxs-lookup"><span data-stu-id="49776-125">Release the [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) interface.</span></span>
10. <span data-ttu-id="49776-126">Закройте обработчик событий *хстатусевент* или повторно используйте его для последующих запросов на подключение.</span><span class="sxs-lookup"><span data-stu-id="49776-126">Close the *hStatusEvent* event handle, or you can reuse it for subsequent connection requests.</span></span>

 

 