---
title: Клиентская библиотека виртуальных каналов
description: Клиент приложения виртуальных каналов — это библиотека DLL, которая загружается во время инициализации службы удаленных рабочих столов на клиентском компьютере. Библиотека DLL должна быть зарегистрирована на клиентском компьютере.
ms.assetid: fca0505c-c4a9-4230-aeaa-ff3dfa62f581
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cfd7ffccda8b1da7dfc3920b0a47a12e97840e0a
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104068035"
---
# <a name="virtual-channel-client-dll"></a><span data-ttu-id="53953-104">Клиентская библиотека виртуальных каналов</span><span class="sxs-lookup"><span data-stu-id="53953-104">Virtual Channel Client DLL</span></span>

<span data-ttu-id="53953-105">Клиент приложения виртуальных каналов — это библиотека DLL, которая загружается во время инициализации службы удаленных рабочих столов на клиентском компьютере.</span><span class="sxs-lookup"><span data-stu-id="53953-105">The client of a virtual channels application is a DLL that is loaded during the Remote Desktop Services initialization on the client computer.</span></span> <span data-ttu-id="53953-106">Библиотека DLL должна быть зарегистрирована на клиентском компьютере.</span><span class="sxs-lookup"><span data-stu-id="53953-106">The DLL must be registered on the client computer.</span></span> <span data-ttu-id="53953-107">Дополнительные сведения см. в статье [Регистрация клиента для виртуального канала](virtual-channel-client-registration.md).</span><span class="sxs-lookup"><span data-stu-id="53953-107">For more information, see [Virtual Channel Client Registration](virtual-channel-client-registration.md).</span></span>

<span data-ttu-id="53953-108">Клиентская библиотека DLL должна экспортировать функцию [**виртуалчаннелентри**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) , которая службы удаленных рабочих столов вызовов во время инициализации.</span><span class="sxs-lookup"><span data-stu-id="53953-108">The client DLL must export a [**VirtualChannelEntry**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) function, which Remote Desktop Services calls during initialization.</span></span> <span data-ttu-id="53953-109">Точка входа **виртуалчаннелентри** получает указатель на структуру [**\_ \_ точек входа канала**](/windows/win32/api/cchannel/ns-cchannel-channel_entry_points) .</span><span class="sxs-lookup"><span data-stu-id="53953-109">The **VirtualChannelEntry** entry point receives a pointer to a [**CHANNEL\_ENTRY\_POINTS**](/windows/win32/api/cchannel/ns-cchannel-channel_entry_points) structure.</span></span> <span data-ttu-id="53953-110">Эта структура содержит указатели на функции, которые клиентский DLL вызывает для доступа к виртуальным каналам.</span><span class="sxs-lookup"><span data-stu-id="53953-110">This structure contains pointers to the functions that the client DLL calls to access virtual channels.</span></span>



| <span data-ttu-id="53953-111">Функция</span><span class="sxs-lookup"><span data-stu-id="53953-111">Function</span></span>                                                      | <span data-ttu-id="53953-112">Описание</span><span class="sxs-lookup"><span data-stu-id="53953-112">Description</span></span>                                                                                                                                                                                                                                                                           |
|---------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="53953-113">**виртуалчаннелинит**</span><span class="sxs-lookup"><span data-stu-id="53953-113">**VirtualChannelInit**</span></span>](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit)<br/>   | <span data-ttu-id="53953-114">Регистрирует имена виртуальных каналов, которые будут использоваться клиентом, и предоставляет функцию обратного вызова [**виртуалчаннелинитевент**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) , с помощью которой службы удаленных рабочих столов уведомляет клиента о событиях, влияющих на клиентское соединение.</span><span class="sxs-lookup"><span data-stu-id="53953-114">Registers the names of the virtual channels to be used by the client and provides a [**VirtualChannelInitEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) callback function through which Remote Desktop Services notifies the client about events that affect the client connection.</span></span><br/> |
| [<span data-ttu-id="53953-115">**виртуалчаннелопен**</span><span class="sxs-lookup"><span data-stu-id="53953-115">**VirtualChannelOpen**</span></span>](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen)<br/>   | <span data-ttu-id="53953-116">Открывает клиентский узел указанного виртуального канала и предоставляет функцию обратного вызова [**виртуалчаннелопеневент**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) , с помощью которой службы удаленных рабочих столов уведомляет клиента о событиях, влияющих на виртуальный канал.</span><span class="sxs-lookup"><span data-stu-id="53953-116">Opens the client end of a specified virtual channel and provides a [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) callback function through which Remote Desktop Services notifies the client about events that affect the virtual channel.</span></span><br/>                    |
| [<span data-ttu-id="53953-117">**виртуалчаннелврите**</span><span class="sxs-lookup"><span data-stu-id="53953-117">**VirtualChannelWrite**</span></span>](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelwrite)<br/> | <span data-ttu-id="53953-118">Записывает данные в виртуальный канал.</span><span class="sxs-lookup"><span data-stu-id="53953-118">Writes data to a virtual channel.</span></span> <span data-ttu-id="53953-119">Службы удаленных рабочих столов отправляет эти данные на серверный конец виртуального канала.</span><span class="sxs-lookup"><span data-stu-id="53953-119">Remote Desktop Services sends this data to the server end of the virtual channel.</span></span> <span data-ttu-id="53953-120">Серверная конечная точка вызывает функцию [**втсвиртуалчаннелреад**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) для чтения данных.</span><span class="sxs-lookup"><span data-stu-id="53953-120">The server end calls the [**WTSVirtualChannelRead**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) function to read the data.</span></span><br/>                                             |
| [<span data-ttu-id="53953-121">**виртуалчаннелклосе**</span><span class="sxs-lookup"><span data-stu-id="53953-121">**VirtualChannelClose**</span></span>](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelclose)<br/> | <span data-ttu-id="53953-122">Закрывает виртуальный канал.</span><span class="sxs-lookup"><span data-stu-id="53953-122">Closes a virtual channel.</span></span><br/>                                                                                                                                                                                                                                                  |



 

<span data-ttu-id="53953-123">Функция [**виртуалчаннелентри**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) библиотеки DLL должна вызывать функцию [**виртуалчаннелинит**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) для инициализации доступа к виртуальным каналам.</span><span class="sxs-lookup"><span data-stu-id="53953-123">Your DLL's [**VirtualChannelEntry**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) function must call the [**VirtualChannelInit**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) function to initialize access to virtual channels.</span></span> <span data-ttu-id="53953-124">При вызове **виртуалчаннелинит** необходимо передать указатель на функцию обратного вызова [**виртуалчаннелинитевент**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) .</span><span class="sxs-lookup"><span data-stu-id="53953-124">When you call **VirtualChannelInit**, you must pass a pointer to the [**VirtualChannelInitEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) callback function.</span></span> <span data-ttu-id="53953-125">Службы удаленных рабочих столов вызывает эту функцию ответного вызова после завершения инициализации и снова при установке соединения с сервером узла сеансов удаленный рабочий стол.</span><span class="sxs-lookup"><span data-stu-id="53953-125">Remote Desktop Services calls this callback function when initialization is complete and again when a connection has been established with a Remote Desktop Session Host (RD Session Host) server.</span></span>

<span data-ttu-id="53953-126">После установления соединения можно вызвать функцию [**виртуалчаннелопен**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) , чтобы открыть виртуальные каналы, зарегистрированные вызовом [**виртуалчаннелинит**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) .</span><span class="sxs-lookup"><span data-stu-id="53953-126">After the connection is established, you can call the [**VirtualChannelOpen**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) function to open the virtual channels registered by the [**VirtualChannelInit**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) call.</span></span> <span data-ttu-id="53953-127">Вызов **виртуалчаннелопен** указывает указатель на функцию обратного вызова [**виртуалчаннелопеневент**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) .</span><span class="sxs-lookup"><span data-stu-id="53953-127">The **VirtualChannelOpen** call specifies a pointer to your [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) callback function.</span></span>

<span data-ttu-id="53953-128">После возврата вызова [**виртуалчаннелопен**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) можно вызвать функцию [**виртуалчаннелврите**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelwrite) для записи в виртуальный канал.</span><span class="sxs-lookup"><span data-stu-id="53953-128">After the [**VirtualChannelOpen**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) call returns, you can call the [**VirtualChannelWrite**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelwrite) function to write to the virtual channel.</span></span> <span data-ttu-id="53953-129">Операция записи является асинхронной, поэтому вы не должны освобождать или повторно использовать буфер, переданный в **виртуалчаннелврите** , до тех пор, пока службы удаленных рабочих столов не вызовет функцию [**виртуалчаннелопеневент**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) , чтобы указать, что операция записи завершена.</span><span class="sxs-lookup"><span data-stu-id="53953-129">The write operation is asynchronous, so you must not free or reuse the buffer passed to **VirtualChannelWrite** until Remote Desktop Services calls your [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) function to indicate that the write operation has been completed.</span></span> <span data-ttu-id="53953-130">При вызове **виртуалчаннелврите** можно передать часть пользовательских данных, определяющих операцию записи.</span><span class="sxs-lookup"><span data-stu-id="53953-130">When you call **VirtualChannelWrite**, you can pass a piece of user data that identifies the write operation.</span></span> <span data-ttu-id="53953-131">Службы удаленных рабочих столов передает данные пользователя при вызове **виртуалчаннелопеневент** , чтобы уведомить о завершении операции.</span><span class="sxs-lookup"><span data-stu-id="53953-131">Remote Desktop Services passes this user data back when it calls **VirtualChannelOpenEvent** to notify you that the operation has completed.</span></span> <span data-ttu-id="53953-132">На сервере в конце виртуального канала надстройка сервера вызывает функцию [**втсвиртуалчаннелреад**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) для чтения данных.</span><span class="sxs-lookup"><span data-stu-id="53953-132">At the server end of the virtual channel, the server add-in calls the [**WTSVirtualChannelRead**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) function to read the data.</span></span>

<span data-ttu-id="53953-133">Службы удаленных рабочих столов также вызывает функцию [**виртуалчаннелопеневент**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) , когда данные записываются в виртуальный канал серверным модулем.</span><span class="sxs-lookup"><span data-stu-id="53953-133">Remote Desktop Services also calls your [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) function when data is written to the virtual channel by the server module.</span></span> <span data-ttu-id="53953-134">Серверный модуль вызывает функцию [**втсвиртуалчаннелврите**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelwrite) для записи данных на серверный конец виртуального канала.</span><span class="sxs-lookup"><span data-stu-id="53953-134">The server module calls the [**WTSVirtualChannelWrite**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelwrite) function to write data to the server end of the virtual channel.</span></span>

<span data-ttu-id="53953-135">Клиентские и серверные модули могут записывать блоки данных любого размера в виртуальный канал.</span><span class="sxs-lookup"><span data-stu-id="53953-135">The client and server modules can write data blocks of any size to the virtual channel.</span></span> <span data-ttu-id="53953-136">Однако перед отправкой данных службы удаленных рабочих столов сегменты данных на фрагменты \_ байтов длины фрагментов каналов \_ .</span><span class="sxs-lookup"><span data-stu-id="53953-136">Before sending the data, however, Remote Desktop Services segments the data into chunks of CHANNEL\_CHUNK\_LENGTH bytes.</span></span> <span data-ttu-id="53953-137">Службы удаленных рабочих столов вызывает функцию [**виртуалчаннелопеневент**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) один раз для каждого фрагмента данных, а не перестраивать данные в блок исходного размера.</span><span class="sxs-lookup"><span data-stu-id="53953-137">Remote Desktop Services calls your [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) function once for each chunk of data, rather than rebuilding the data into a block of the original size.</span></span> <span data-ttu-id="53953-138">Каждый вызов **виртуалчаннелопеневент** указывает размер блока, общий размер, записанный сервером, а также сведения о том, составляют ли данные начало, середину или конец блока, записанного сервером.</span><span class="sxs-lookup"><span data-stu-id="53953-138">Each call to **VirtualChannelOpenEvent** indicates the size of the chunk, the total size written by the server, and whether the data constitutes the beginning, middle, or end of a block written by the server.</span></span>

<span data-ttu-id="53953-139">Чтобы закрыть канал, можно вызвать функцию [**виртуалчаннелклосе**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelclose) .</span><span class="sxs-lookup"><span data-stu-id="53953-139">You can call the [**VirtualChannelClose**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelclose) function to close a channel.</span></span> <span data-ttu-id="53953-140">Однако вызывать его не нужно, так как службы удаленных рабочих столов автоматически закрывает все каналы при отключении клиента от сервера.</span><span class="sxs-lookup"><span data-stu-id="53953-140">However, it is not necessary to call it because Remote Desktop Services closes all channels automatically when the client disconnects from the server.</span></span>

 

 





