---
title: Рекомендации для клиентских и серверных приложений
description: Клиентские и серверные приложения не должны рассчитывать на то, что соединение с одним компьютером эквивалентно сеансу одного пользователя.
ms.assetid: 69822ef1-eca8-4302-b014-8e5894d52109
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cd0c1a71256f3ab469bfeb1c08b2d096b56ac1b5
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105681626"
---
# <a name="clientserver-application-guidelines"></a><span data-ttu-id="55ee1-103">Рекомендации для клиентских и серверных приложений</span><span class="sxs-lookup"><span data-stu-id="55ee1-103">Client/Server application guidelines</span></span>

<span data-ttu-id="55ee1-104">Клиентские и серверные приложения не должны рассчитывать на то, что соединение с одним компьютером эквивалентно сеансу одного пользователя.</span><span class="sxs-lookup"><span data-stu-id="55ee1-104">Client/server applications must not assume that a single computer connection is equivalent to a single user session.</span></span> <span data-ttu-id="55ee1-105">Это особый случай проблемы, описанной в разделе [IP-адреса и имена компьютеров](ip-addresses-and-computer-names.md).</span><span class="sxs-lookup"><span data-stu-id="55ee1-105">This is a special case of the issue discussed in [IP Addresses and Computer Names](ip-addresses-and-computer-names.md).</span></span>

<span data-ttu-id="55ee1-106">Для уникальной идентификации подключения клиента/сервера каждый модуль клиента должен использовать уникальное имя или идентификатор.</span><span class="sxs-lookup"><span data-stu-id="55ee1-106">To uniquely identify a client/server connection, each client module must use a unique name or identifier.</span></span> <span data-ttu-id="55ee1-107">Приложения могут использовать именованные объекты или каналы, сокеты или другие методы IPC.</span><span class="sxs-lookup"><span data-stu-id="55ee1-107">Applications can use named objects or pipes, sockets, or other IPC methods.</span></span> <span data-ttu-id="55ee1-108">Дополнительные сведения см. в разделе [пространства имен объектов ядра](kernel-object-namespaces.md).</span><span class="sxs-lookup"><span data-stu-id="55ee1-108">For more information, see [Kernel Object Namespaces](kernel-object-namespaces.md).</span></span>

<span data-ttu-id="55ee1-109">Чтобы обеспечить совместимость с службы удаленных рабочих столов, серверный модуль в приложении клиента или сервера должен иметь возможность обрабатывать несколько клиентов, подключающихся к одному и тому же компьютеру.</span><span class="sxs-lookup"><span data-stu-id="55ee1-109">To be Remote Desktop Services compatible, the server module in a client/server application must be able to handle multiple clients connecting from the same computer.</span></span> <span data-ttu-id="55ee1-110">Для этого серверный модуль должен принимать клиентские подключения через четко определенный глобальный интерфейс, например RPC или именованные каналы.</span><span class="sxs-lookup"><span data-stu-id="55ee1-110">To accomplish this, the server module must accept client connections through a well-defined global interface, such as RPC or named pipes.</span></span> <span data-ttu-id="55ee1-111">Сервер и клиент должны согласовывать разные каналы связи для каждого сеанса пользователя.</span><span class="sxs-lookup"><span data-stu-id="55ee1-111">The server and client must negotiate a different communication channel for each user session.</span></span> <span data-ttu-id="55ee1-112">Клиент должен установить соединение с сервером с помощью протоколов, которые легко поддерживают этот тип операции, например TCP/IP, где для каждого клиентского приложения может использоваться другое подключение к сокету.</span><span class="sxs-lookup"><span data-stu-id="55ee1-112">The client must establish a connection to the server by using protocols that easily support this type of operation, such as TCP/IP, where a different socket connection can be used for each client application.</span></span>

<span data-ttu-id="55ee1-113">Клиентский модуль может вызвать функцию [**процессидтосессионид**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-processidtosessionid) , чтобы получить идентификатор своего сеанса службы удаленных рабочих столов.</span><span class="sxs-lookup"><span data-stu-id="55ee1-113">The client module can call the [**ProcessIdToSessionId**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-processidtosessionid) function to retrieve the identifier of its Remote Desktop Services session.</span></span> <span data-ttu-id="55ee1-114">Затем клиент использует некоторую форму межпроцессного взаимодействия для передачи идентификатора сеанса в серверный модуль.</span><span class="sxs-lookup"><span data-stu-id="55ee1-114">The client then uses some form of interprocess communication to pass its session identifier to the server module.</span></span> <span data-ttu-id="55ee1-115">Затем клиентские и серверные модули могут использовать идентификатор сеанса для настройки частного канала связи.</span><span class="sxs-lookup"><span data-stu-id="55ee1-115">The client and server modules can then use the session identifier to set up a private communication channel.</span></span> <span data-ttu-id="55ee1-116">Например, серверный модуль может использовать идентификатор сеанса для доступа к объектам в пространстве имен сеанса для объектов ядра.</span><span class="sxs-lookup"><span data-stu-id="55ee1-116">For example, the server module can use a session identifier to access objects in the session's namespace for kernel objects.</span></span>

<span data-ttu-id="55ee1-117">Кроме того, серверный модуль может использовать идентификатор сеанса в вызове [**втскуерисессионинформатион**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsquerysessioninformationa) для получения дополнительных сведений о клиенте.</span><span class="sxs-lookup"><span data-stu-id="55ee1-117">Furthermore, the server module can use the session identifier in a [**WTSQuerySessionInformation**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsquerysessioninformationa) call to retrieve additional information about the client.</span></span> <span data-ttu-id="55ee1-118">Серверный модуль также может использовать идентификатор сеанса в вызове [**втссендмессаже**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtssendmessagea) для вывода сообщения в клиентском терминале.</span><span class="sxs-lookup"><span data-stu-id="55ee1-118">The server module can also use the session identifier in a [**WTSSendMessage**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtssendmessagea) call to display a message on the client terminal.</span></span> <span data-ttu-id="55ee1-119">Серверный модуль также может создавать два события для наблюдения за подключением клиентов к сеансу и отключения от него.</span><span class="sxs-lookup"><span data-stu-id="55ee1-119">The server module can also create two events to monitor client connection to and disconnection from a session.</span></span> <span data-ttu-id="55ee1-120">Однако для этого он должен быть зарегистрирован на сервере узла сеансов удаленный рабочий стол (узел сеансов удаленных рабочих столов).</span><span class="sxs-lookup"><span data-stu-id="55ee1-120">However, it must be registered on the Remote Desktop Session Host (RD Session Host) server to do this.</span></span> <span data-ttu-id="55ee1-121">Дополнительные сведения см. в разделе [наблюдение за подключениями и отсоединениями сеансов](monitoring-session-connections-and-disconnections.md).</span><span class="sxs-lookup"><span data-stu-id="55ee1-121">For more information, see [Monitoring Session Connections and Disconnections](monitoring-session-connections-and-disconnections.md).</span></span>

<span data-ttu-id="55ee1-122">Запросы на ввод пользователя являются потенциальным источником проблем для клиентских и серверных приложений.</span><span class="sxs-lookup"><span data-stu-id="55ee1-122">Prompts for user input are a potential source of problems for client/server applications.</span></span> <span data-ttu-id="55ee1-123">Например, если служба вызывает функцию [**MessageBox**](/windows/desktop/api/winuser/nf-winuser-messagebox) , окно сообщения отображается на рабочем столе сервера узла сеансов удаленных рабочих столов, а не на клиентском компьютере.</span><span class="sxs-lookup"><span data-stu-id="55ee1-123">For example, if a service calls the [**MessageBox**](/windows/desktop/api/winuser/nf-winuser-messagebox) function, the message box is displayed on the desktop of the RD Session Host server, not on the client desktop.</span></span> <span data-ttu-id="55ee1-124">Чтобы отобразить сообщение на клиентском компьютере, служба может вызвать функцию [**втссендмессаже**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtssendmessagea) .</span><span class="sxs-lookup"><span data-stu-id="55ee1-124">To display a message on a client desktop, the service can call the [**WtsSendMessage**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtssendmessagea) function.</span></span> <span data-ttu-id="55ee1-125">Кроме того, служба может запросить входные данные из клиентского модуля, а клиентский модуль может отобразить пользовательский интерфейс и отправить полученные входные данные обратно в службу.</span><span class="sxs-lookup"><span data-stu-id="55ee1-125">Alternatively, the service can request input from the client module, and the client module can display the user interface and send the resulting input back to the service.</span></span>

<span data-ttu-id="55ee1-126">Процессы, порождаемые из нескольких сеансов, могут отправлять и получать данные друг от друга с помощью блоков общей памяти.</span><span class="sxs-lookup"><span data-stu-id="55ee1-126">Processes spawned from multiple sessions can send data to and receive data from each other through the use of shared memory blocks.</span></span> <span data-ttu-id="55ee1-127">Дополнительные сведения см. в разделе [Создание именованной общей памяти](/windows/desktop/Memory/creating-named-shared-memory).</span><span class="sxs-lookup"><span data-stu-id="55ee1-127">For more information, see [Creating Named Shared Memory](/windows/desktop/Memory/creating-named-shared-memory).</span></span> <span data-ttu-id="55ee1-128">Общую память нельзя использовать при следующих условиях:</span><span class="sxs-lookup"><span data-stu-id="55ee1-128">Shared memory cannot be used under the following conditions:</span></span>

-   <span data-ttu-id="55ee1-129">Процессы, использующие блок общей памяти, порождены несколькими сеансами.</span><span class="sxs-lookup"><span data-stu-id="55ee1-129">The processes using the shared memory block were spawned by multiple sessions.</span></span>
-   <span data-ttu-id="55ee1-130">Сеансы совместно используют одни и те же учетные данные проверки подлинности пользователя.</span><span class="sxs-lookup"><span data-stu-id="55ee1-130">The sessions share the same user authentication credential.</span></span>

 

 