---
title: Арбитраж фильтра
description: Арбитраж фильтра — это логика, встроенная в платформу фильтрации Windows (WFP), которая используется для определения того, как фильтры взаимодействуют друг с другом при принятии решений о фильтрации сетевого трафика.
ms.assetid: d097f307-113e-4dc3-ad59-ddfb85061583
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9fd7df778d1c24b7480de3321e7a1ec126d8e642
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "103791406"
---
# <a name="filter-arbitration"></a><span data-ttu-id="03d84-103">Арбитраж фильтра</span><span class="sxs-lookup"><span data-stu-id="03d84-103">Filter Arbitration</span></span>

<span data-ttu-id="03d84-104">Арбитраж фильтра — это логика, встроенная в платформу фильтрации Windows (WFP), которая используется для определения того, как фильтры взаимодействуют друг с другом при принятии решений о фильтрации сетевого трафика.</span><span class="sxs-lookup"><span data-stu-id="03d84-104">Filter arbitration is the logic built into the Windows Filtering Platform (WFP) that is used to determine how filters interact with each other when making network traffic filtering decisions.</span></span>

## <a name="filter-arbitration-behaviors"></a><span data-ttu-id="03d84-105">Фильтрация поведения арбитража</span><span class="sxs-lookup"><span data-stu-id="03d84-105">Filter Arbitration Behaviors</span></span>

<span data-ttu-id="03d84-106">Следующие поведения характеризуются системой арбитража фильтра:</span><span class="sxs-lookup"><span data-stu-id="03d84-106">The following behaviors characterize the filter arbitration system:</span></span>

-   <span data-ttu-id="03d84-107">Весь трафик можно проверить.</span><span class="sxs-lookup"><span data-stu-id="03d84-107">All traffic can be inspected.</span></span> <span data-ttu-id="03d84-108">Трафик не может обходить фильтры на заданном слое.</span><span class="sxs-lookup"><span data-stu-id="03d84-108">No traffic can bypass filters at a given layer.</span></span>
-   <span data-ttu-id="03d84-109">Трафик может блокироваться фильтром выноски с помощью **запрета** , даже если он разрешен фильтром с более высоким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="03d84-109">Traffic can be blocked by a callout filter via a **Veto** even if a higher priority filter has permitted it.</span></span>
-   <span data-ttu-id="03d84-110">Несколько поставщиков могут проверять трафик на одном и том же уровне.</span><span class="sxs-lookup"><span data-stu-id="03d84-110">Multiple providers can inspect traffic at the same layer.</span></span> <span data-ttu-id="03d84-111">Например, брандмауэр, за которым следуют фильтры системы обнаружения вторжений, или IPsec, исследуя фильтры качества обслуживания (QoS), могут проверять трафик на одном и том же уровне.</span><span class="sxs-lookup"><span data-stu-id="03d84-111">For example, firewall followed by intrusion-detection system (IDS) filters, or IPsec followed by Quality of Service (QoS) filters may all examine the traffic at the same layer.</span></span>

## <a name="filtering-model"></a><span data-ttu-id="03d84-112">Модель фильтрации</span><span class="sxs-lookup"><span data-stu-id="03d84-112">Filtering Model</span></span>

<span data-ttu-id="03d84-113">Каждый слой фильтра делится на подуровни, упорядоченные по приоритету (также называемый весом).</span><span class="sxs-lookup"><span data-stu-id="03d84-113">Each filter layer is divided into sub-layers ordered by priority (also called weight).</span></span> <span data-ttu-id="03d84-114">Сетевой трафик проходит по подслоям с наивысшего приоритета до самого низкого приоритета.</span><span class="sxs-lookup"><span data-stu-id="03d84-114">Network traffic traverses sub-layers from the highest priority to the lowest priority.</span></span> <span data-ttu-id="03d84-115">Создание и управление Подслоями осуществляется разработчиками с помощью API WFP.</span><span class="sxs-lookup"><span data-stu-id="03d84-115">Sub-layers are created and managed by the developers using the WFP API.</span></span>

<span data-ttu-id="03d84-116">В каждом подуровне фильтры упорядочиваются по весу.</span><span class="sxs-lookup"><span data-stu-id="03d84-116">Within each sub-layer, filters are ordered by weight.</span></span> <span data-ttu-id="03d84-117">Сетевой трафик выдается для сопоставления фильтров от наивысшего веса до нижнего веса.</span><span class="sxs-lookup"><span data-stu-id="03d84-117">Network traffic is indicated to matching filters from highest weight to lowest weight.</span></span>

<span data-ttu-id="03d84-118">Алгоритм арбитража фильтра применяется ко всем подслоям в пределах слоя, и решение о фильтрации будет принято после оценки всех вложенных слоев.</span><span class="sxs-lookup"><span data-stu-id="03d84-118">The filter arbitration algorithm is applied to all sub-layers within a layer and the final filtering decision is made after all sub-layers have been evaluated.</span></span> <span data-ttu-id="03d84-119">Это обеспечивает несколько возможностей сопоставления.</span><span class="sxs-lookup"><span data-stu-id="03d84-119">This provides for multiple matching capability.</span></span>

<span data-ttu-id="03d84-120">Во вложенном слое арбитраж фильтра выполняется следующим образом:</span><span class="sxs-lookup"><span data-stu-id="03d84-120">Within a sub-layer, filter arbitration is performed as follows:</span></span>

-   <span data-ttu-id="03d84-121">Вычисление списка совпадающих фильтров, упорядоченных по весу, от высшего к меньшему.</span><span class="sxs-lookup"><span data-stu-id="03d84-121">Compute the list of matching filters ordered by weight from highest to lowest.</span></span>
-   <span data-ttu-id="03d84-122">Проверять соответствие фильтров по порядку до тех пор, пока не будет возвращен "разрешить" или "блок" (фильтры могут также возвращать "Continue") или пока список не будет исчерпан.</span><span class="sxs-lookup"><span data-stu-id="03d84-122">Evaluate matching filters in order until a "Permit" or a "Block" is returned (filters can also return "Continue") or until the list is exhausted.</span></span>
-   <span data-ttu-id="03d84-123">Пропустите оставшиеся фильтры и верните действие из последнего вычисленного фильтра.</span><span class="sxs-lookup"><span data-stu-id="03d84-123">Skip the remaining filters and return the action from the last evaluated filter.</span></span>

<span data-ttu-id="03d84-124">В пределах слоя арбитраж фильтра выполняется следующим образом:</span><span class="sxs-lookup"><span data-stu-id="03d84-124">Within a layer, filter arbitration is performed as follows:</span></span>

-   <span data-ttu-id="03d84-125">Выполняйте арбитраж фильтра на каждом подуровне в порядке убывания приоритета.</span><span class="sxs-lookup"><span data-stu-id="03d84-125">Perform filter arbitration at every sub-layer in order from highest priority to lowest priority.</span></span>
-   <span data-ttu-id="03d84-126">Оцените все подслои, даже если подслой с более высоким приоритетом решил блокировать трафик.</span><span class="sxs-lookup"><span data-stu-id="03d84-126">Evaluate all sub-layers even if a higher priority sub-layer has decided to block the traffic.</span></span>
-   <span data-ttu-id="03d84-127">Возврат результирующего действия на основе правил политики, описанных в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="03d84-127">Return the resulting action based on the policy rules described in the following section.</span></span>

<span data-ttu-id="03d84-128">На схеме ниже показан пример конфигурации вложенного слоя.</span><span class="sxs-lookup"><span data-stu-id="03d84-128">The diagram below illustrates a sample sub-layer configuration.</span></span> <span data-ttu-id="03d84-129">Внешние поля представляют слои.</span><span class="sxs-lookup"><span data-stu-id="03d84-129">The outer boxes represent layers.</span></span> <span data-ttu-id="03d84-130">Внутренние поля представляют вложенные слои, содержащие фильтры.</span><span class="sxs-lookup"><span data-stu-id="03d84-130">The inner boxes represent sub-layers that contain filters.</span></span> <span data-ttu-id="03d84-131">Подстановочный знак ( \* ) в фильтре означает, что весь трафик соответствует фильтру.</span><span class="sxs-lookup"><span data-stu-id="03d84-131">The wildcard (\*) in a filter means all traffic matches the filter.</span></span>

![Пример конфигурации подслоя](images/fwp-sub-config2.png)

<span data-ttu-id="03d84-133">Единственный способ обойти фильтр — если фильтр более высокого веса разрешает или блокирует трафик в пределах одного подслоя.</span><span class="sxs-lookup"><span data-stu-id="03d84-133">The only way for a filter to be bypassed is if a higher weight filter has permitted or blocked the traffic within the same sub-layer.</span></span> <span data-ttu-id="03d84-134">И наоборот, один из способов гарантировать, что фильтр всегда видит весь трафик внутри слоя, — добавить вложенный слой, содержащий один фильтр, который соответствует всему трафику.</span><span class="sxs-lookup"><span data-stu-id="03d84-134">Conversely, one way of ensuring that a filter always sees all traffic within a layer is to add a sub-layer that contains a single filter that matches all traffic.</span></span>

## <a name="configurable-override-policy"></a><span data-ttu-id="03d84-135">Настраиваемая политика переопределения</span><span class="sxs-lookup"><span data-stu-id="03d84-135">Configurable Override Policy</span></span>

<span data-ttu-id="03d84-136">Правила, описанные ниже, управляют решениями по арбитражу в пределах слоя.</span><span class="sxs-lookup"><span data-stu-id="03d84-136">The rules described below govern the arbitration decisions within a layer.</span></span> <span data-ttu-id="03d84-137">Эти правила используются обработчиком фильтров для определения того, какой из действий подслоя применяется к сетевому трафику.</span><span class="sxs-lookup"><span data-stu-id="03d84-137">These rules are used by the filter engine to decide which one of the sub-layer actions is applied to the network traffic.</span></span>

<span data-ttu-id="03d84-138">Базовая политика выглядит следующим образом.</span><span class="sxs-lookup"><span data-stu-id="03d84-138">The basic policy is as follows.</span></span>

-   <span data-ttu-id="03d84-139">Действия оцениваются в порядке приоритета дочерних слоев с наивысшим приоритетом до самого низкого.</span><span class="sxs-lookup"><span data-stu-id="03d84-139">Actions are evaluated in priority order of sub-layers from highest priority to lowest priority.</span></span>
-   <span data-ttu-id="03d84-140">"Block" переопределяет "разрешить".</span><span class="sxs-lookup"><span data-stu-id="03d84-140">"Block" overrides "Permit".</span></span>
-   <span data-ttu-id="03d84-141">"Block" является окончательным (не может быть переопределен) и останавливает вычисление.</span><span class="sxs-lookup"><span data-stu-id="03d84-141">"Block" is final (cannot be overridden) and stops the evaluation.</span></span> <span data-ttu-id="03d84-142">Пакет отбрасывается.</span><span class="sxs-lookup"><span data-stu-id="03d84-142">The packet is discarded.</span></span>

<span data-ttu-id="03d84-143">Базовая политика не поддерживает сценарий исключения, которое не переопределяется брандмауэром.</span><span class="sxs-lookup"><span data-stu-id="03d84-143">The basic policy does not support the scenario of an exception not overridden by a firewall.</span></span> <span data-ttu-id="03d84-144">Типичные примеры сценариев такого типа:</span><span class="sxs-lookup"><span data-stu-id="03d84-144">Typical examples of this type of scenario are:</span></span>

-   <span data-ttu-id="03d84-145">Порт удаленного администрирования должен быть открыт даже при наличии брандмауэра стороннего производителя.</span><span class="sxs-lookup"><span data-stu-id="03d84-145">Remote administration port required to be opened even in the presence of a third-party firewall.</span></span>
-   <span data-ttu-id="03d84-146">Компоненты, требующие открытия портов для работы (например, универсальный самонастраивающийся UPnP).</span><span class="sxs-lookup"><span data-stu-id="03d84-146">Components that require ports to be opened in order to function (for example, Universal Plug and Play UPnP).</span></span> <span data-ttu-id="03d84-147">Если администратор явно включил компонент, брандмауэр не должен автоматически блокировать трафик.</span><span class="sxs-lookup"><span data-stu-id="03d84-147">If the administrator has explicitly enabled the component, the firewall should not silently block the traffic.</span></span>

<span data-ttu-id="03d84-148">Для поддержки описанных выше сценариев решение о фильтрации должно быть сложнее переопределять, чем другое решение по фильтрации путем управления разрешением на переопределение действия.</span><span class="sxs-lookup"><span data-stu-id="03d84-148">In order to support the above scenarios, a filtering decision must be made more difficult to override than another filtering decision by managing the action override permission.</span></span> <span data-ttu-id="03d84-149">Это разрешение реализуется как флаг **\_ \_ \_ записи фвпс right** , и он задается отдельно для каждого фильтра.</span><span class="sxs-lookup"><span data-stu-id="03d84-149">This permission is implemented as the **FWPS\_RIGHT\_ACTION\_WRITE** flag and it is set on a per-filter basis.</span></span>

<span data-ttu-id="03d84-150">Алгоритм оценки сохраняет текущее действие ("разрешить" или "блокировать") вместе с флагом **записи фвпс \_ right \_ Action \_** .</span><span class="sxs-lookup"><span data-stu-id="03d84-150">The evaluation algorithm maintains the current action ("Permit" or "Block") along with the **FWPS\_RIGHT\_ACTION\_WRITE** flag.</span></span> <span data-ttu-id="03d84-151">Флаг определяет, может ли подслой с более низким приоритетом переопределять действие.</span><span class="sxs-lookup"><span data-stu-id="03d84-151">The flag controls whether a lower priority sub-layer is allowed to override the action.</span></span> <span data-ttu-id="03d84-152">Если установить или сбросить флаг **\_ \_ \_ записи Фвпс right** в структуре [фвпс \_ классифицировать \_ OUT0](/windows/win32/api/fwpstypes/ns-fwpstypes-fwps_classify_out0) , то поставщик определяет, как действия могут быть переопределены.</span><span class="sxs-lookup"><span data-stu-id="03d84-152">By setting or resetting the **FWPS\_RIGHT\_ACTION\_WRITE** flag in the [FWPS\_CLASSIFY\_OUT0](/windows/win32/api/fwpstypes/ns-fwpstypes-fwps_classify_out0) structure, a provider governs how actions can or cannot be overridden.</span></span> <span data-ttu-id="03d84-153">Если установлен флаг, это означает, что действие можно переопределить.</span><span class="sxs-lookup"><span data-stu-id="03d84-153">If the flag is set, it indicates that the action can be overridden.</span></span> <span data-ttu-id="03d84-154">Если флаг отсутствует, действие не может быть переопределено.</span><span class="sxs-lookup"><span data-stu-id="03d84-154">If the flag is absent, the action cannot be overridden.</span></span>



| <span data-ttu-id="03d84-155">Действие</span><span class="sxs-lookup"><span data-stu-id="03d84-155">Action</span></span> | <span data-ttu-id="03d84-156">Разрешить переопределение ( \_ \_ \_ задано право записи действия фвпс)</span><span class="sxs-lookup"><span data-stu-id="03d84-156">Allow override (FWPS\_RIGHT\_ACTION\_WRITE is set)</span></span> | <span data-ttu-id="03d84-157">Описание</span><span class="sxs-lookup"><span data-stu-id="03d84-157">Description</span></span>                                                                                                          |
|--------|----------------------------------------------------|----------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="03d84-158">Разрешение</span><span class="sxs-lookup"><span data-stu-id="03d84-158">Permit</span></span> | <span data-ttu-id="03d84-159">Да</span><span class="sxs-lookup"><span data-stu-id="03d84-159">Yes</span></span>                                                | <span data-ttu-id="03d84-160">Трафик может быть заблокирован на другом подслое.</span><span class="sxs-lookup"><span data-stu-id="03d84-160">The traffic can be blocked at another sub-layer.</span></span> <span data-ttu-id="03d84-161">Это называется мягким предоставлением.</span><span class="sxs-lookup"><span data-stu-id="03d84-161">This is called a soft permit.</span></span><br/>                            |
| <span data-ttu-id="03d84-162">Разрешение</span><span class="sxs-lookup"><span data-stu-id="03d84-162">Permit</span></span> | <span data-ttu-id="03d84-163">Нет</span><span class="sxs-lookup"><span data-stu-id="03d84-163">No</span></span>                                                 | <span data-ttu-id="03d84-164">Трафик можно заблокировать на другом подслое только с помощью **запрета** выноски.</span><span class="sxs-lookup"><span data-stu-id="03d84-164">The traffic can be blocked at another sub-layer only by a callout **Veto**.</span></span> <span data-ttu-id="03d84-165">Это называется жесткое разрешение.</span><span class="sxs-lookup"><span data-stu-id="03d84-165">This is called a hard permit.</span></span><br/> |
| <span data-ttu-id="03d84-166">Блокировать</span><span class="sxs-lookup"><span data-stu-id="03d84-166">Block</span></span>  | <span data-ttu-id="03d84-167">Да</span><span class="sxs-lookup"><span data-stu-id="03d84-167">Yes</span></span>                                                | <span data-ttu-id="03d84-168">Трафик может быть разрешен на другом подслое.</span><span class="sxs-lookup"><span data-stu-id="03d84-168">The traffic can be permitted at another sub-layer.</span></span> <span data-ttu-id="03d84-169">Это называется мягким блоком.</span><span class="sxs-lookup"><span data-stu-id="03d84-169">This is called a soft block.</span></span><br/>                           |
| <span data-ttu-id="03d84-170">Блокировать</span><span class="sxs-lookup"><span data-stu-id="03d84-170">Block</span></span>  | <span data-ttu-id="03d84-171">Нет</span><span class="sxs-lookup"><span data-stu-id="03d84-171">No</span></span>                                                 | <span data-ttu-id="03d84-172">Невозможно разрешить трафик на другом подуровне.</span><span class="sxs-lookup"><span data-stu-id="03d84-172">The traffic cannot be permitted at another sub-layer.</span></span> <span data-ttu-id="03d84-173">Это называется жестким блоком.</span><span class="sxs-lookup"><span data-stu-id="03d84-173">This is called a hard block.</span></span><br/>                        |



 

<span data-ttu-id="03d84-174">Действие фильтра можно задать, задав для члена **типа** в Structure [**Фвпм \_ ACTION0**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_action0) значение **FWP \_ Action \_** или **FWP \_ Action \_**.</span><span class="sxs-lookup"><span data-stu-id="03d84-174">The filter action can be set by setting the **type** member in the structure [**FWPM\_ACTION0**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_action0) to either **FWP\_ACTION\_BLOCK** or **FWP\_ACTION\_PERMIT**.</span></span> <span data-ttu-id="03d84-175">Наряду с типом действия фильтр также предоставляет флаг флага **\_ фильтра фвпм \_ \_ очистить \_ действие \_ вправо**.</span><span class="sxs-lookup"><span data-stu-id="03d84-175">Along with the action type, a filter also exposes the flag **FWPM\_FILTER\_FLAG\_CLEAR\_ACTION\_RIGHT**.</span></span> <span data-ttu-id="03d84-176">Если этот флаг сброшен, тип действия является жестким и не может быть переопределен, за исключением случаев, когда жесткое разрешение переопределяется с помощью **запрета** , как описано выше. в противном случае он является мягким, который может быть переопределен с помощью действия с высоким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="03d84-176">If this flag is cleared, then the action type is hard and cannot be overridden except when a hard permit is overridden by a **Veto** as explained later on, else it is soft which can be overridden by high priority action.</span></span>

<span data-ttu-id="03d84-177">В следующей таблице приведено поведение по умолчанию для действий фильтра и выноски.</span><span class="sxs-lookup"><span data-stu-id="03d84-177">The following table lists the default behavior for filter and callout actions.</span></span>

| <span data-ttu-id="03d84-178">Действие</span><span class="sxs-lookup"><span data-stu-id="03d84-178">Action</span></span>         | <span data-ttu-id="03d84-179">Поведение по умолчанию</span><span class="sxs-lookup"><span data-stu-id="03d84-179">Default Behavior</span></span> |
|----------------|------------------|
| <span data-ttu-id="03d84-180">Разрешение фильтра</span><span class="sxs-lookup"><span data-stu-id="03d84-180">Filter permit</span></span>  | <span data-ttu-id="03d84-181">Мягкое разрешение</span><span class="sxs-lookup"><span data-stu-id="03d84-181">Soft permit</span></span>      |
| <span data-ttu-id="03d84-182">Разрешается выноска</span><span class="sxs-lookup"><span data-stu-id="03d84-182">Callout permit</span></span> | <span data-ttu-id="03d84-183">Мягкое разрешение</span><span class="sxs-lookup"><span data-stu-id="03d84-183">Soft permit</span></span>      |
| <span data-ttu-id="03d84-184">Блок фильтра</span><span class="sxs-lookup"><span data-stu-id="03d84-184">Filter block</span></span>   | <span data-ttu-id="03d84-185">Жесткая блокировка</span><span class="sxs-lookup"><span data-stu-id="03d84-185">Hard block</span></span>       |
| <span data-ttu-id="03d84-186">Блок выноски</span><span class="sxs-lookup"><span data-stu-id="03d84-186">Callout block</span></span>  | <span data-ttu-id="03d84-187">Мягкая блокировка</span><span class="sxs-lookup"><span data-stu-id="03d84-187">Soft block</span></span>       |



 

<span data-ttu-id="03d84-188">**Запрет** — это действие "Block", возвращаемое фильтром при сбросе флага **\_ \_ \_ записи фвпс right** , прежде чем вызывать фильтр.</span><span class="sxs-lookup"><span data-stu-id="03d84-188">A **Veto** is a "Block" action returned by the filter when the **FWPS\_RIGHT\_ACTION\_WRITE** flag was reset prior to calling the filter.</span></span> <span data-ttu-id="03d84-189">**Запрет** блокирует трафик, который был разрешен с жестким разрешением.</span><span class="sxs-lookup"><span data-stu-id="03d84-189">A **Veto** will block traffic that was permitted with a hard permit.</span></span>

<span data-ttu-id="03d84-190">При выдаче **запрета** это указывает на конфликт в конфигурации.</span><span class="sxs-lookup"><span data-stu-id="03d84-190">When a **Veto** is issued, it is an indication of conflict in the configuration.</span></span> <span data-ttu-id="03d84-191">Чтобы устранить конфликт, выполняются следующие действия.</span><span class="sxs-lookup"><span data-stu-id="03d84-191">The following actions are taken to mitigate the conflict.</span></span>

-   <span data-ttu-id="03d84-192">Трафик блокируется.</span><span class="sxs-lookup"><span data-stu-id="03d84-192">The traffic is blocked.</span></span>
-   <span data-ttu-id="03d84-193">Создается событие аудита.</span><span class="sxs-lookup"><span data-stu-id="03d84-193">An audit event is generated.</span></span>
-   <span data-ttu-id="03d84-194">Создается уведомление.</span><span class="sxs-lookup"><span data-stu-id="03d84-194">A notification is generated.</span></span>
    > [!Note]  
    > <span data-ttu-id="03d84-195">Уведомление получается всеми сущностями, которые подписаны на него.</span><span class="sxs-lookup"><span data-stu-id="03d84-195">The notification is received by all entities that have subscribed to it.</span></span> <span data-ttu-id="03d84-196">Обычно это включает брандмауэр (для обнаружения неверных конфигураций) или приложения (для обнаружения переопределения их конкретного фильтра).</span><span class="sxs-lookup"><span data-stu-id="03d84-196">This will typically include the firewall (in order to detect mis-configurations), or applications (in order to detect if their particular filter is overridden).</span></span>

     

    > [!Note]  
    > <span data-ttu-id="03d84-197">При переопределении фильтра "жесткое разрешение" не создается ни один обязательный пользовательский интерфейс (UI).</span><span class="sxs-lookup"><span data-stu-id="03d84-197">There is no mandatory user interface (UI) instantiated when a "Hard Permit" filter is overridden.</span></span> <span data-ttu-id="03d84-198">Уведомления переопределения отправляются любому поставщику, зарегистрированному для получения, что позволяет брандмауэрам или приложениям, создавшим фильтры "разрешить", отображать пользовательский интерфейс, запрашивающий действия пользователя.</span><span class="sxs-lookup"><span data-stu-id="03d84-198">The notifications of the override are sent to any provider that registered to receive them, which allows firewalls, or the applications that created the "Permit" filters, to show UI asking for user action.</span></span> <span data-ttu-id="03d84-199">В пользовательском интерфейсе платформы нет значения для этих событий переопределения, так как независимые поставщики программного обеспечения, которые не хотят автоматически блокировать, могут сделать это путем регистрации в другом месте в WFP или (менее предпочтительно) обрабатывайте всю логику в драйвере вызова.</span><span class="sxs-lookup"><span data-stu-id="03d84-199">There is no value in having a platform UI notification for these override events since firewall ISVs that do not want to silently block can do so by registering at a different place in WFP, or (less preferred) handle all their logic in a call-out driver.</span></span> <span data-ttu-id="03d84-200">Независимым поставщикам программного обеспечения, которые считают, что пользователи запрашиваются, должны быть в порядке с учетом взаимодействия с пользователем и создания собственного пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="03d84-200">ISVs that do think prompting users is a good idea will want to own the user experience and create their own UI.</span></span>

     

<span data-ttu-id="03d84-201">Описанные выше действия по устранению рисков гарантируют, что фильтр "жесткое разрешение" не переопределяется автоматически с помощью "блочного" фильтра, и в нем рассматривается ситуация, когда порт удаленного администрирования не может быть заблокирован брандмауэром.</span><span class="sxs-lookup"><span data-stu-id="03d84-201">The mitigation behavior described above ensures that a "Hard Permit" filter is not silently overridden by a "Block" filter, and covers the scenario where a remote administration port is not allowed to be blocked by the firewall.</span></span> <span data-ttu-id="03d84-202">Для автоматического переопределения фильтров «жесткое разрешение» брандмауэр должен добавить свои фильтры в подуровне с более высоким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="03d84-202">In order to silently override "Hard Permit" filters a firewall has to add its filters within a higher priority sub-layer.</span></span>

> [!Note]  
> <span data-ttu-id="03d84-203">Поскольку не существует перекрестного разрешения, трафик, разрешенный с помощью "жесткое разрешение", по-прежнему может блокироваться на другом уровне.</span><span class="sxs-lookup"><span data-stu-id="03d84-203">Since there is no cross-layer arbitration, traffic permitted with "Hard Permit" may still be blocked at another layer.</span></span> <span data-ttu-id="03d84-204">Ответственность за трафик на каждом уровне при необходимости гарантируется автором политики.</span><span class="sxs-lookup"><span data-stu-id="03d84-204">It is the responsibility of the policy author to ensure that traffic is permitted at each layer if necessary.</span></span>

 

<span data-ttu-id="03d84-205">Пользовательские приложения, запрашивающие порты, которые нужно открыть, добавляют переопределяемые фильтры в подслой с низким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="03d84-205">User applications requesting ports to be opened add overridable filters to a low priority sub-layer.</span></span> <span data-ttu-id="03d84-206">Брандмауэр может подписываться на фильтр добавить события уведомлений и добавить фильтр сопоставления после проверки пользователя (или политики).</span><span class="sxs-lookup"><span data-stu-id="03d84-206">The firewall can subscribe to the filter add notification events and add a matching filter after user (or policy) validation.</span></span>

## <a name="related-topics"></a><span data-ttu-id="03d84-207">См. также</span><span class="sxs-lookup"><span data-stu-id="03d84-207">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="03d84-208">Назначение весов фильтрам</span><span class="sxs-lookup"><span data-stu-id="03d84-208">Filter Weight Assignment</span></span>](filter-weight-assignment.md)
</dt> </dl>

 

