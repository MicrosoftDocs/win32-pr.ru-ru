---
title: Операция WFP
description: Платформа фильтрации Windows (WFP) выполняет свои задачи, интегрируя следующие базовые уровни сущностей, фильтры, оболочки и выноски.
ms.assetid: bf88ace7-1160-434b-9be0-3f9db6aa2e87
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 44e7a7d38bd0de5b1f549e2187c414644bf68442
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "105661721"
---
# <a name="wfp-operation"></a><span data-ttu-id="e126f-103">Операция WFP</span><span class="sxs-lookup"><span data-stu-id="e126f-103">WFP Operation</span></span>

<span data-ttu-id="e126f-104">Платформа фильтрации Windows (WFP) выполняет свои задачи, интегрируя следующие основные сущности: *слои*, *фильтры*, *оболочки совместимости* и *выноски*.</span><span class="sxs-lookup"><span data-stu-id="e126f-104">Windows Filtering Platform (WFP) performs its tasks by integrating the following basic entities: *Layers*, *Filters*, *Shims*, and *Callouts*.</span></span>

## <a name="layers"></a><span data-ttu-id="e126f-105">Слои</span><span class="sxs-lookup"><span data-stu-id="e126f-105">Layers</span></span>

<span data-ttu-id="e126f-106">*Слой* — это контейнер, управляемый обработчиком фильтров, функция которого заключается в упорядочении фильтров по наборам.</span><span class="sxs-lookup"><span data-stu-id="e126f-106">A *layer* is a container managed by the filter engine whose function is to organize filters into sets.</span></span> <span data-ttu-id="e126f-107">Слой не является модулем в сетевом стеке.</span><span class="sxs-lookup"><span data-stu-id="e126f-107">A layer is not a module in the network stack.</span></span> <span data-ttu-id="e126f-108">Каждый слой имеет схему, определяющую тип фильтров, которые могут быть добавлены к нему.</span><span class="sxs-lookup"><span data-stu-id="e126f-108">Each layer has a schema that defines the type of filters that can be added to it.</span></span> <span data-ttu-id="e126f-109">Дополнительные сведения см. [в разделе условия фильтрации, доступные на каждом слое фильтрации](filtering-conditions-available-at-each-filtering-layer.md) .</span><span class="sxs-lookup"><span data-stu-id="e126f-109">See [Filtering Conditions Available at Each Filtering Layer](filtering-conditions-available-at-each-filtering-layer.md) for more information.</span></span>

<span data-ttu-id="e126f-110">Слои могут содержать вложенные слои для управления конфликтующими требованиями фильтра, например "блокировать TCP-порты выше 1024" и "открыть порт 1080".</span><span class="sxs-lookup"><span data-stu-id="e126f-110">Layers may contain sub-layers to manage conflicting filter requirements such as "Block TCP ports above 1024" and "Open port 1080".</span></span> <span data-ttu-id="e126f-111">Правила управления конфликтами фильтрации определяются посредством [арбитража фильтра](filter-arbitration.md).</span><span class="sxs-lookup"><span data-stu-id="e126f-111">The rules for managing filtering conflicts are determined by [Filter Arbitration](filter-arbitration.md).</span></span>

<span data-ttu-id="e126f-112">WFP содержит набор [встроенных подслоев](management-filtering-sublayer-identifiers.md).</span><span class="sxs-lookup"><span data-stu-id="e126f-112">WFP contains a set of [built-in sub-layers](management-filtering-sublayer-identifiers.md).</span></span> <span data-ttu-id="e126f-113">Каждый слой наследует все встроенные подслои.</span><span class="sxs-lookup"><span data-stu-id="e126f-113">Every layer inherits all the built-in sub-layers.</span></span> <span data-ttu-id="e126f-114">Пользователи также могут добавлять собственные подслои.</span><span class="sxs-lookup"><span data-stu-id="e126f-114">Users can also add their own sub-layers.</span></span>

<span data-ttu-id="e126f-115">Список уровней обработчика фильтров представлен в разделе "справочные данные" раздела [**Фильтрация идентификаторов слоев**](management-filtering-layer-identifiers-.md).</span><span class="sxs-lookup"><span data-stu-id="e126f-115">The list of filter engine layers is provided in the reference section topic [**Filtering Layer Identifiers**](management-filtering-layer-identifiers-.md).</span></span>

## <a name="filters"></a><span data-ttu-id="e126f-116">фильтры;</span><span class="sxs-lookup"><span data-stu-id="e126f-116">Filters</span></span>

<span data-ttu-id="e126f-117">*Фильтр* — это правило, которое сопоставляется с входящими или исходящими пакетами.</span><span class="sxs-lookup"><span data-stu-id="e126f-117">A *filter* is a rule that is matched against incoming or outgoing packets.</span></span> <span data-ttu-id="e126f-118">Правило сообщает обработчику фильтрации, что следует делать с пакетом, в том числе вызов модуля выноски для проверки глубокого пакета или потока.</span><span class="sxs-lookup"><span data-stu-id="e126f-118">The rule tells the filtering engine what to do with the packet, including to call a callout module for deep packet or stream inspection.</span></span> <span data-ttu-id="e126f-119">Например, фильтр может указать "блокировать трафик с TCP-портом, превышающим 1024" или "вызывать ИДЕНТИФИКАТОРы для всего незащищенного трафика".</span><span class="sxs-lookup"><span data-stu-id="e126f-119">For example, a filter may specify "Block traffic with a TCP port greater than 1024" or "Call out to IDS for all traffic that is not secured."</span></span>

<span data-ttu-id="e126f-120">Фильтр времени загрузки — это фильтр, который применяется во время загрузки, как только запускается драйвер стека TCP/IP (tcpip.sys).</span><span class="sxs-lookup"><span data-stu-id="e126f-120">A boot-time filter is a filter that is enforced at boot-time as soon as the TCP/IP stack driver (tcpip.sys) starts.</span></span> <span data-ttu-id="e126f-121">Фильтр времени загрузки отключается при запуске BFE.</span><span class="sxs-lookup"><span data-stu-id="e126f-121">A boot-time filter is disabled when BFE starts.</span></span> <span data-ttu-id="e126f-122">Фильтр помечается как время загрузки, устанавливая флаг [**\_ \_ \_ буттиме фильтра Фвпм**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_filter0) при вызове [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0) .</span><span class="sxs-lookup"><span data-stu-id="e126f-122">A filter is marked as boot-time by setting the [**FWPM\_FILTER\_FLAG\_BOOTTIME**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_filter0) flag when [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0) is invoked.</span></span>

<span data-ttu-id="e126f-123">Фильтр времени выполнения — это фильтр, который применяется после запуска BFE.</span><span class="sxs-lookup"><span data-stu-id="e126f-123">A run-time filter is a filter that is enforced after BFE starts.</span></span> <span data-ttu-id="e126f-124">Фильтр времени выполнения может быть статическим, динамическим или постоянным в зависимости от того, как он был создан.</span><span class="sxs-lookup"><span data-stu-id="e126f-124">A run-time filter can be static, dynamic, or persistent depending on the way it was created.</span></span> <span data-ttu-id="e126f-125">Дополнительные сведения о различных типах фильтров времени выполнения и их времени существовании см. в разделе [Управление объектами](object-management.md) .</span><span class="sxs-lookup"><span data-stu-id="e126f-125">See [Object Management](object-management.md) for more information on the different types of run-time filters and their lifetime.</span></span>

## <a name="shims"></a><span data-ttu-id="e126f-126">Оболочек совместимости</span><span class="sxs-lookup"><span data-stu-id="e126f-126">Shims</span></span>

<span data-ttu-id="e126f-127">*Оболочка совместимости* — это компонент режима ядра, который позволяет фильтровать решения с помощью классификации по слоям механизма фильтрации.</span><span class="sxs-lookup"><span data-stu-id="e126f-127">A *shim* is a kernel-mode component that makes filtering decisions by classifying against the filter engine layers.</span></span> <span data-ttu-id="e126f-128">Каждая оболочка совместимости классифицируется по одному или нескольким слоям.</span><span class="sxs-lookup"><span data-stu-id="e126f-128">Each shim classifies against one or more layers.</span></span> <span data-ttu-id="e126f-129">Например, оболочка совместимости модуля транспортного уровня классифицируется на транспортном уровне транспорта, исходящем транспортном уровне и уровнях подключения ALE и Receive-Accept для первого пакета последовательности.</span><span class="sxs-lookup"><span data-stu-id="e126f-129">For example, the Transport Layer Module shim classifies against the Inbound Transport layer, the Outbound Transport layer, and the ALE Connect and Receive-Accept layers for the first packet of a flow.</span></span>

<span data-ttu-id="e126f-130">По мере того, как пакеты, потоки и события проходят по сетевому стеку, оболочки совместимости анализируют их для извлечения и значения классификаторов, а затем вызывают механизм фильтрации, чтобы вычислить их в фильтрах на заданном слое.</span><span class="sxs-lookup"><span data-stu-id="e126f-130">As packets, streams, and events traverse the network stack, the shims parse them to extract the classifiable conditions and values, and then call into the filter engine to evaluate them against the filters in a given layer.</span></span> <span data-ttu-id="e126f-131">Обработчик фильтров может вызвать одну или несколько выносок в рамках классификации.</span><span class="sxs-lookup"><span data-stu-id="e126f-131">The filter engine may invoke one or more callouts as part of the classification.</span></span> <span data-ttu-id="e126f-132">Оболочки совместимости выполняют фактическое удаление пакетов, потоков и событий на основе результатов классификации, выполняемой механизмом фильтрации.</span><span class="sxs-lookup"><span data-stu-id="e126f-132">The shims do the actual dropping of packets, streams, and events based on the result of the classification performed by the filter engine.</span></span>

## <a name="callouts"></a><span data-ttu-id="e126f-133">Выноски</span><span class="sxs-lookup"><span data-stu-id="e126f-133">Callouts</span></span>

<span data-ttu-id="e126f-134">*Выноска* — это набор функций, предоставляемых драйвером и используемый для специализированной фильтрации.</span><span class="sxs-lookup"><span data-stu-id="e126f-134">A *callout* is a set of functions exposed by a driver and used for specialized filtering.</span></span> <span data-ttu-id="e126f-135">Они используются для анализа и обработки пакетов, таких как проверка на наличие вирусов, родительский контроль для поиска нежелательного содержимого, анализа данных пакетов для средств мониторинга.</span><span class="sxs-lookup"><span data-stu-id="e126f-135">They are used to perform analysis and manipulation of the packets, such as virus scan, parental controls scan for inappropriate content, packet data parsing for monitoring tools.</span></span> <span data-ttu-id="e126f-136">Некоторые выноски, например драйвер преобразования сетевых адресов (NAT), встроены в операционную систему.</span><span class="sxs-lookup"><span data-stu-id="e126f-136">Some callouts, such as the Network Address Translation (NAT) driver, are built into the operating system.</span></span> <span data-ttu-id="e126f-137">Другие, такие как внешний контрольный вызов HTTP или вызов системы обнаружения вторжений (IDS), могут предоставляться независимыми поставщиками программного обеспечения (ISV).</span><span class="sxs-lookup"><span data-stu-id="e126f-137">Others, such as an HTTP Parental Control callout or the Intrusion Detection System (IDS) callout, can be provided by independent software vendors (ISVs).</span></span> <span data-ttu-id="e126f-138">Функции выноски вызываются обработчиком фильтров, когда соответствующий фильтр выноски сопоставляется с заданным слоем.</span><span class="sxs-lookup"><span data-stu-id="e126f-138">The callout functions are invoked by the filter engine when a corresponding callout filter is matched at a given layer.</span></span>

<span data-ttu-id="e126f-139">Выноски могут быть зарегистрированы в любом из уровней ядра WFP.</span><span class="sxs-lookup"><span data-stu-id="e126f-139">Callouts can be registered at any of the kernel-mode WFP layers.</span></span> <span data-ttu-id="e126f-140">Выноски могут возвращать действие ("блокировать", "разрешить" и, при выполнении проверки потока, "отложить", "требуется больше данных", "удалить подключение"), а также изменять и защищать входящий и исходящий сетевой трафик.</span><span class="sxs-lookup"><span data-stu-id="e126f-140">Callouts can return an action ("Block", "Permit", and, when performing stream inspection, "Defer", "Need more data", "Drop connection") and can modify and secure inbound and outbound network traffic.</span></span>

<span data-ttu-id="e126f-141">После регистрации внешнего вызова с помощью обработчика фильтров он может получить сетевой трафик для обработки.</span><span class="sxs-lookup"><span data-stu-id="e126f-141">Once a callout is registered with the filter engine, it can receive network traffic to process.</span></span> <span data-ttu-id="e126f-142">Трафик может представлять собой пакеты, потоки или события в зависимости от слоя.</span><span class="sxs-lookup"><span data-stu-id="e126f-142">The traffic may be packets, streams, or events depending on the layer.</span></span> <span data-ttu-id="e126f-143">Агент приложения или брандмауэра вызывает передачу трафика в выноску, добавляя фильтр с действием "Выноска", ИДЕНТИФИКАТОРом выноски которого является идентификатор вызова.</span><span class="sxs-lookup"><span data-stu-id="e126f-143">An application or firewall agent causes traffic to be passed to a callout by adding a filter whose action is "Callout" and whose callout ID is that callout's identifier.</span></span> <span data-ttu-id="e126f-144">В выносках можно указать обработчику фильтров, что следует вернуть "Block" или "разрешить" в оболочку совместимости.</span><span class="sxs-lookup"><span data-stu-id="e126f-144">Callouts can instruct the filter engine to return "Block" or "Permit" to the shim.</span></span> <span data-ttu-id="e126f-145">Кроме того, выноски могут возвращать "Continue", чтобы разрешить другим фильтрам обработку пакета.</span><span class="sxs-lookup"><span data-stu-id="e126f-145">Callouts can also return "Continue" to allow other filters to process the packet.</span></span>

<span data-ttu-id="e126f-146">Один драйвер выноски может предоставлять несколько вызовов.</span><span class="sxs-lookup"><span data-stu-id="e126f-146">Multiple callouts may be exposed by one callout driver.</span></span>

<span data-ttu-id="e126f-147">Прежде чем можно будет использовать выноску, необходимо добавить (WITH [**FwpmCalloutAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmcalloutadd0)) и зарегистрировать (WITH [фвпскаллаутрегистер](/windows-hardware/drivers/ddi/_netvista/)).</span><span class="sxs-lookup"><span data-stu-id="e126f-147">A callout needs to be added (with [**FwpmCalloutAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmcalloutadd0)) and registered (with [FwpsCalloutRegister](/windows-hardware/drivers/ddi/_netvista/)) before it can be used.</span></span> <span data-ttu-id="e126f-148">Перед созданием фильтров, ссылающихся на выноску, требуется вызов **FwpmCalloutAdd0** .</span><span class="sxs-lookup"><span data-stu-id="e126f-148">A call to **FwpmCalloutAdd0** is required before the creation of filters that reference the callout.</span></span> <span data-ttu-id="e126f-149">Вызов Фвпскаллаутрегистер требуется, прежде чем WFP сможет вызвать вызов, когда будут сопоставлены фильтры выноски.</span><span class="sxs-lookup"><span data-stu-id="e126f-149">A call to FwpsCalloutRegister is required before WFP can invoke the callout when the callout filters are matched.</span></span> <span data-ttu-id="e126f-150">По умолчанию фильтры, которые ссылаются на вызываемые, но еще не зарегистрированные в обработчике фильтров, обрабатываются как фильтры блокировки.</span><span class="sxs-lookup"><span data-stu-id="e126f-150">By default filters that reference callouts that have been added but have not yet registered with the filter engine are treated as "Block" filters.</span></span> <span data-ttu-id="e126f-151">Порядок вызова **FwpmCalloutAdd0** и фвпскаллаутрегистер не имеет значения.</span><span class="sxs-lookup"><span data-stu-id="e126f-151">The order of calling **FwpmCalloutAdd0** and FwpsCalloutRegister does not matter.</span></span> <span data-ttu-id="e126f-152">Постоянная выноска должна быть добавлена только один раз и должна быть зарегистрирована при каждом запуске драйвера, реализующего выноску (например, после перезагрузки).</span><span class="sxs-lookup"><span data-stu-id="e126f-152">A persistent callout needs to be added just once and needs to be registered every time the driver that implements the callout starts (for example, after a reboot).</span></span>

## <a name="classification"></a><span data-ttu-id="e126f-153">Классификация</span><span class="sxs-lookup"><span data-stu-id="e126f-153">Classification</span></span>

<span data-ttu-id="e126f-154">Классификация — это процесс применения фильтров к сетевому трафику (пакету, потоку или событию), чтобы определить результат "разрешить" или "блокировать" для этого трафика.</span><span class="sxs-lookup"><span data-stu-id="e126f-154">Classification is the process of applying filters to network traffic (packet, stream, or event) in order to determine a result of "Permit" or "Block" for that traffic.</span></span> <span data-ttu-id="e126f-155">Для одного пакета, потока или события существует один вызов классификации для каждого уровня.</span><span class="sxs-lookup"><span data-stu-id="e126f-155">For one packet, stream, or event there is one classification call per layer.</span></span>

<span data-ttu-id="e126f-156">Во время классификации свойства (например, исходный адрес) пакета, потока или события сравниваются с условиями фильтра, заданными для фильтров на уровне, где вызывается классификация.</span><span class="sxs-lookup"><span data-stu-id="e126f-156">During classification, the properties (for example, source address) of the packet, stream, or event are compared with filter conditions set on filters at the layer where the classification is invoked.</span></span> <span data-ttu-id="e126f-157">При обнаружении совпадений используется алгоритм [арбитража фильтра](filter-arbitration.md) для определения результата процесса классификации.</span><span class="sxs-lookup"><span data-stu-id="e126f-157">When matches are found, the [Filter Arbitration](filter-arbitration.md) algorithm is used to determines the result of the classification process.</span></span>

<span data-ttu-id="e126f-158">Запрос классификации активируется оболочкой совместимости.</span><span class="sxs-lookup"><span data-stu-id="e126f-158">A classification request is triggered by a shim.</span></span>

<span data-ttu-id="e126f-159">Действия классификации могут быть либо:</span><span class="sxs-lookup"><span data-stu-id="e126f-159">Classification actions could be either:</span></span>

-   <span data-ttu-id="e126f-160">Разрешение</span><span class="sxs-lookup"><span data-stu-id="e126f-160">Permit</span></span>
-   <span data-ttu-id="e126f-161">Блокировать</span><span class="sxs-lookup"><span data-stu-id="e126f-161">Block</span></span>
-   <span data-ttu-id="e126f-162">Выноска</span><span class="sxs-lookup"><span data-stu-id="e126f-162">Callout</span></span>
    -   <span data-ttu-id="e126f-163">Разрешение</span><span class="sxs-lookup"><span data-stu-id="e126f-163">Permit</span></span>
    -   <span data-ttu-id="e126f-164">Блокировать</span><span class="sxs-lookup"><span data-stu-id="e126f-164">Block</span></span>
    -   <span data-ttu-id="e126f-165">Продолжить</span><span class="sxs-lookup"><span data-stu-id="e126f-165">Continue</span></span>
    -   <span data-ttu-id="e126f-166">Которого</span><span class="sxs-lookup"><span data-stu-id="e126f-166">Defer</span></span>
    -   <span data-ttu-id="e126f-167">Требуются дополнительные данные</span><span class="sxs-lookup"><span data-stu-id="e126f-167">Need more data</span></span>
    -   <span data-ttu-id="e126f-168">Удалить соединение</span><span class="sxs-lookup"><span data-stu-id="e126f-168">Drop connection</span></span>

## <a name="wfp-operation"></a><span data-ttu-id="e126f-169">Операция WFP</span><span class="sxs-lookup"><span data-stu-id="e126f-169">WFP Operation</span></span>

<span data-ttu-id="e126f-170">Во время загрузки, как только запускается драйвер стека TCP/IP (tcpip.sys), механизм фильтрации режима ядра применяет политику безопасности системы с помощью фильтров времени загрузки.</span><span class="sxs-lookup"><span data-stu-id="e126f-170">At boot-time, as soon as the TCP/IP stack driver (tcpip.sys) starts, the kernel-mode filter engine enforces the security policy of the system through boot-time filters.</span></span>

<span data-ttu-id="e126f-171">Когда модуль базовой фильтрации (BFE) запускается в пользовательском режиме, к платформе добавляются постоянные фильтры, фильтры времени загрузки отключаются, а уведомления отправляются в те драйверы выноски, которые подписаны с помощью [FwpmBfeStateSubscribeChanges0](/windows-hardware/drivers/ddi/fwpmk/nf-fwpmk-fwpmbfestatesubscribechanges0).</span><span class="sxs-lookup"><span data-stu-id="e126f-171">Once the Base Filtering Engine (BFE) starts in user mode, persistent filters are added to the platform, boot-time filters are disabled, and notifications are sent to those callout drivers that subscribed using [FwpmBfeStateSubscribeChanges0](/windows-hardware/drivers/ddi/fwpmk/nf-fwpmk-fwpmbfestatesubscribechanges0).</span></span> <span data-ttu-id="e126f-172">Уведомления отправляются сразу после завершения инициализации BFE.</span><span class="sxs-lookup"><span data-stu-id="e126f-172">The notifications are dispatched immediately after the BFE initialization is completed.</span></span> <span data-ttu-id="e126f-173">Теперь платформа готова к регистрации для вызовов и для добавления объектов времени выполнения.</span><span class="sxs-lookup"><span data-stu-id="e126f-173">The platform is now ready for callouts to be registered and for run-time objects to be added.</span></span>

<span data-ttu-id="e126f-174">Переход со времени загрузки на постоянные фильтры может составлять несколько секунд или даже дольше на медленных компьютерах.</span><span class="sxs-lookup"><span data-stu-id="e126f-174">The transition from boot-time to persistent filters could be several seconds, or even longer on a slow machine.</span></span> <span data-ttu-id="e126f-175">Он является атомарным, поэтому, если у поставщика есть как время загрузки, так и постоянный фильтр, окно никогда не будет отображаться, если ни один из них не действует.</span><span class="sxs-lookup"><span data-stu-id="e126f-175">It is atomic, so if a provider has both a boot-time and a persistent filter, there will never be a window when neither is in effect.</span></span>

<span data-ttu-id="e126f-176">После запуска BFE фильтры времени выполнения могут добавляться агентами брандмауэра или пользовательскими решениями брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="e126f-176">After BFE starts, run-time filters can be added by firewall agents, or by custom firewall solutions.</span></span> <span data-ttu-id="e126f-177">Процедура BFE обрабатывает эти фильтры и отправляет их на соответствующий уровень обработчика фильтров для принудительного применения.</span><span class="sxs-lookup"><span data-stu-id="e126f-177">BFE processes these filters and sends them to the appropriate filter engine layer for enforcement.</span></span> <span data-ttu-id="e126f-178">BFE также принимает параметры проверки подлинности и отправляет эти параметры в модули ключей IPsec (IKE/AuthIP).</span><span class="sxs-lookup"><span data-stu-id="e126f-178">BFE also accepts authentication settings and sends these settings to the IPsec keying modules (IKE/AuthIP).</span></span> <span data-ttu-id="e126f-179">Дополнительные сведения см. в разделе [конфигурация IPSec](ipsec-configuration.md) .</span><span class="sxs-lookup"><span data-stu-id="e126f-179">See [IPsec Configuration](ipsec-configuration.md) for more information.</span></span>

<span data-ttu-id="e126f-180">В любое время фильтры и параметры проверки подлинности можно добавлять, удалять или изменять в системе через интерфейс RPC, предоставляемый процедурой BFE.</span><span class="sxs-lookup"><span data-stu-id="e126f-180">At any time, filters and authentication settings can be added, removed or changed in the system through the RPC interface exposed by the BFE.</span></span> <span data-ttu-id="e126f-181">Дочерние слои и модули выноски также можно добавлять или удалять.</span><span class="sxs-lookup"><span data-stu-id="e126f-181">Sub-layers and callout modules can likewise be added or removed.</span></span>

<span data-ttu-id="e126f-182">Поток данных:</span><span class="sxs-lookup"><span data-stu-id="e126f-182">Data flow:</span></span>

1.  <span data-ttu-id="e126f-183">Пакет поступает в сетевой стек.</span><span class="sxs-lookup"><span data-stu-id="e126f-183">A packet comes into the network stack.</span></span>
2.  <span data-ttu-id="e126f-184">Сетевой стек находит и вызывает оболочку совместимости.</span><span class="sxs-lookup"><span data-stu-id="e126f-184">The network stack finds and calls a shim.</span></span>
3.  <span data-ttu-id="e126f-185">Оболочка совместимости вызывает процесс классификации на определенном уровне.</span><span class="sxs-lookup"><span data-stu-id="e126f-185">The shim invokes the classification process at a particular layer.</span></span>
4.  <span data-ttu-id="e126f-186">Во время классификации фильтры сопоставляются, а результирующее действие принимается.</span><span class="sxs-lookup"><span data-stu-id="e126f-186">During classification, filters are matched and the resultant action is taken.</span></span> <span data-ttu-id="e126f-187">(См. раздел [арбитраж фильтров](filter-arbitration.md).)</span><span class="sxs-lookup"><span data-stu-id="e126f-187">(See [Filter Arbitration](filter-arbitration.md).)</span></span>
5.  <span data-ttu-id="e126f-188">Если во время процесса классификации сопоставлены все фильтры выноски, вызываются соответствующие выноски.</span><span class="sxs-lookup"><span data-stu-id="e126f-188">If any callout filters are matched during the classification process, the corresponding callouts are invoked.</span></span>
6.  <span data-ttu-id="e126f-189">Оболочка совместимости действует на заключительное решение по фильтрации (например, удаление пакета).</span><span class="sxs-lookup"><span data-stu-id="e126f-189">The shim acts on the final filtering decision (for example, drop the packet).</span></span>

<span data-ttu-id="e126f-190">Поток исходящих данных соответствует аналогичному шаблону.</span><span class="sxs-lookup"><span data-stu-id="e126f-190">Outbound data flow follows a similar pattern.</span></span>

<span data-ttu-id="e126f-191">В следующих разделах описывается работа WFP.</span><span class="sxs-lookup"><span data-stu-id="e126f-191">The following topics further describe the operation of the WFP.</span></span>

-   [<span data-ttu-id="e126f-192">Потоки TCP-пакетов</span><span class="sxs-lookup"><span data-stu-id="e126f-192">TCP Packet Flows</span></span>](tcp-packet-flows.md)
-   [<span data-ttu-id="e126f-193">Потоки UDP-пакетов</span><span class="sxs-lookup"><span data-stu-id="e126f-193">UDP Packet Flows</span></span>](udp-packet-flows.md)
-   [<span data-ttu-id="e126f-194">Арбитраж фильтра</span><span class="sxs-lookup"><span data-stu-id="e126f-194">Filter Arbitration</span></span>](filter-arbitration.md)

## <a name="related-topics"></a><span data-ttu-id="e126f-195">См. также</span><span class="sxs-lookup"><span data-stu-id="e126f-195">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e126f-196">Объектная модель</span><span class="sxs-lookup"><span data-stu-id="e126f-196">Object Model</span></span>](object-model.md)
</dt> <dt>

[<span data-ttu-id="e126f-197">Управление объектами</span><span class="sxs-lookup"><span data-stu-id="e126f-197">Object Management</span></span>](object-management.md)
</dt> </dl>

 

 