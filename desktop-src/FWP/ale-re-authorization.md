---
title: Повторная авторизация ALE
description: Сетевой трафик на уровнях уровня приложения (ALE) платформы фильтрации Windows (WFP) фильтруется по потокам ALE.
ms.assetid: 3cc7f78e-3f9d-4a91-8ea0-9b64c299068a
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ed05c4c0767d449ec128250f852c365455bd0dc7
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "103791407"
---
# <a name="ale-reauthorization"></a><span data-ttu-id="d6a16-103">Повторная авторизация ALE</span><span class="sxs-lookup"><span data-stu-id="d6a16-103">ALE Reauthorization</span></span>

<span data-ttu-id="d6a16-104">Сетевой трафик на уровнях уровня приложения (ALE) платформы фильтрации Windows (WFP) фильтруется по [потокам ALE](ale-stateful-filtering.md).</span><span class="sxs-lookup"><span data-stu-id="d6a16-104">Network traffic at the Application Layer Enforcement (ALE) layers of the Windows Filtering Platform (WFP) is filtered by [ALE flows](ale-stateful-filtering.md).</span></span> <span data-ttu-id="d6a16-105">После разрешения потока ALE разрешен весь трафик, который является частью потока ALE.</span><span class="sxs-lookup"><span data-stu-id="d6a16-105">Once an ALE flow has been permitted, all traffic that is part of the ALE flow is permitted.</span></span> <span data-ttu-id="d6a16-106">Повторная Авторизация — это запрос на проверку разрешений потока ALE, обычно из-за изменения политики сети.</span><span class="sxs-lookup"><span data-stu-id="d6a16-106">Reauthorization is a request to validate the permissions of the ALE flow, typically due to a change in network policy.</span></span>

<span data-ttu-id="d6a16-107">Потокам ALE назначается направление, входящее или исходящее, в зависимости от направления первого пакета, который инициировал создание и авторизацию последовательности.</span><span class="sxs-lookup"><span data-stu-id="d6a16-107">ALE flows are assigned a direction, inbound or outbound, based on the direction of the first packet that triggered the creation and authorization of the flow.</span></span> <span data-ttu-id="d6a16-108">Входящие потоки ALE создаются и продаются авторизацией на уровне [**фвпм \_ \_ \_ проверки подлинности \_ recv \_ Accept \_ V {4 \| 6}**](management-filtering-layer-identifiers-.md) уровня.</span><span class="sxs-lookup"><span data-stu-id="d6a16-108">Inbound ALE flows are created and authorized at the [**FWPM\_LAYER\_ALE\_AUTH\_RECV\_ACCEPT\_V{4\|6}**](management-filtering-layer-identifiers-.md) layer.</span></span> <span data-ttu-id="d6a16-109">Исходящие потоки ALE создаются и продаются авторизацией на уровне **\_ \_ \_ проверки подлинности \_ подключения ALE \_ V {4 \| 6} уровня фвпм** .</span><span class="sxs-lookup"><span data-stu-id="d6a16-109">Outbound ALE flows are created and authorized at the **FWPM\_LAYER\_ALE\_AUTH\_CONNECT\_V{4\|6}** layer.</span></span> <span data-ttu-id="d6a16-110">Направление потока ALE не ограничивает направление пакетов, принадлежащих потоку.</span><span class="sxs-lookup"><span data-stu-id="d6a16-110">The direction of the ALE flow does not limit the direction of packets that belong to the flow.</span></span> <span data-ttu-id="d6a16-111">Потоки ALE содержат как входящие, так и исходящие пакеты независимо от направления самого потока ALE.</span><span class="sxs-lookup"><span data-stu-id="d6a16-111">ALE flows contain both inbound and outbound packets regardless of the direction of the ALE flow itself.</span></span>

<span data-ttu-id="d6a16-112">Повторная авторизация потока ALE активируется следующим образом:</span><span class="sxs-lookup"><span data-stu-id="d6a16-112">Reauthorization of an ALE flow is triggered by:</span></span>

-   <span data-ttu-id="d6a16-113">Изменение политики на слое, где изначально был разрешен или создан поток ALE.</span><span class="sxs-lookup"><span data-stu-id="d6a16-113">A policy change at the layer where the ALE flow was originally authorized or created.</span></span>
-   <span data-ttu-id="d6a16-114">Интерфейс прибытия отличается от интерфейса, где изначально был разрешен или создан поток ALE.</span><span class="sxs-lookup"><span data-stu-id="d6a16-114">An arrival interface different from the interface where the ALE flow was originally authorized or created.</span></span>
-   <span data-ttu-id="d6a16-115">Ожидающее подключение.</span><span class="sxs-lookup"><span data-stu-id="d6a16-115">A pending connection.</span></span>

<span data-ttu-id="d6a16-116">Повторная авторизация отличается от первоначальной авторизации на наличие [**\_ \_ флага \_ \_ условия FWP**](filtering-condition-flags-.md) .</span><span class="sxs-lookup"><span data-stu-id="d6a16-116">Reauthorization is distinguished from the initial authorization by the presence of the [**FWP\_CONDITION\_FLAG\_IS\_REAUTHORIZE**](filtering-condition-flags-.md) flag.</span></span>

<span data-ttu-id="d6a16-117">Повторная авторизация может выполняться только на уровнях [**фвпм на уровне \_ \_ \_ проверки подлинности \_ recv \_ Accept \_ v {4 \| 6}**](management-filtering-layer-identifiers-.md) и **фвпм \_ Layer \_ ALE \_ \_ Connect \_ v {4 \| 6}** .</span><span class="sxs-lookup"><span data-stu-id="d6a16-117">Reauthorization can take place only at the [**FWPM\_LAYER\_ALE\_AUTH\_RECV\_ACCEPT\_V{4\|6}**](management-filtering-layer-identifiers-.md) and **FWPM\_LAYER\_ALE\_AUTH\_CONNECT\_V{4\|6}** layers.</span></span>

### <a name="policy-change-reauthorization"></a><span data-ttu-id="d6a16-118">Политика-изменение повторной разработки</span><span class="sxs-lookup"><span data-stu-id="d6a16-118">Policy-Change Reauthorization</span></span>

<span data-ttu-id="d6a16-119">Изменение политики реализовано в виде добавления или удаления фильтров на уровне ALE.</span><span class="sxs-lookup"><span data-stu-id="d6a16-119">A policy change is implemented as a filter addition or removal at an ALE layer.</span></span> <span data-ttu-id="d6a16-120">После обнаружения изменения политики первый пакет, проходящий через поток ALE, созданный на затронутом слое, будет указан для переразработки слоя.</span><span class="sxs-lookup"><span data-stu-id="d6a16-120">Once a policy change is detected, the first packet that traverses an ALE flow created at the affected layer will be specified for reauthorization to the layer.</span></span> <span data-ttu-id="d6a16-121">Таким образом, для повторной разработки вполне возможно, что исходящий пакет классифицируется на уровне [**\_ \_ \_ проверки подлинности фвпм уровня " \_ recv \_ Accept \_ V {4 \| 6}**](management-filtering-layer-identifiers-.md) " и что входящий пакет классифицируется на уровне **\_ \_ \_ проверки подлинности \_ подключения ALE \_ v {4 \| 6} уровня фвпм** .</span><span class="sxs-lookup"><span data-stu-id="d6a16-121">Therefore, for reauthorization it is entirely possible that an outbound packet is classified at the [**FWPM\_LAYER\_ALE\_AUTH\_RECV\_ACCEPT\_V{4\|6}**](management-filtering-layer-identifiers-.md) layer and that an inbound packet is classified at the **FWPM\_LAYER\_ALE\_AUTH\_CONNECT\_V{4\|6}** layer.</span></span>

<span data-ttu-id="d6a16-122">Одной из причин для этой классификации с двунаправленным направлением является то, что может не быть дополнительного сетевого трафика из исходного направления (например, входящего пакета для входящего потока ALE).</span><span class="sxs-lookup"><span data-stu-id="d6a16-122">One reason for this mixed-direction classification is that there might not be further network traffic from the original direction (for example, inbound packet for inbound ALE flow).</span></span> <span data-ttu-id="d6a16-123">Одним из таких примеров является односторонняя потоковая передача UDP после первоначального двустороннего подтверждения.</span><span class="sxs-lookup"><span data-stu-id="d6a16-123">One such example is one-way UDP streaming after an initial two-way handshake.</span></span> <span data-ttu-id="d6a16-124">В этом случае рекомендуется как можно быстрее уничтожить потоковую передачу.</span><span class="sxs-lookup"><span data-stu-id="d6a16-124">In this case it is more desirable to tear down the streaming as soon as possible.</span></span>

### <a name="arrival-interface-reauthorization"></a><span data-ttu-id="d6a16-125">Повторная авторизация интерфейса прибытия</span><span class="sxs-lookup"><span data-stu-id="d6a16-125">Arrival Interface Reauthorization</span></span>

<span data-ttu-id="d6a16-126">Повторная авторизация интерфейса прибытия доступна начиная с Windows Server 2008 и Windows Vista с пакетом обновления 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="d6a16-126">Arrival interface reauthorization is available starting with Windows Server 2008 and Windows Vista with Service Pack 1 (SP1).</span></span>

<span data-ttu-id="d6a16-127">Пакеты, принадлежащие одной и той же последовательности ALE, могут поступать из нескольких интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="d6a16-127">Packets belonging to the same ALE flow can arrive from multiple interfaces.</span></span> <span data-ttu-id="d6a16-128">Первый пакет, поступающий через интерфейс, отличный от исходного интерфейса потока ALE, перерабатывается.</span><span class="sxs-lookup"><span data-stu-id="d6a16-128">The first packet to come in over an interface different from the original interface of the ALE flow is reauthorized.</span></span>

<span data-ttu-id="d6a16-129">В модели сильного узла, которая является моделью безопасности по умолчанию для стека TCP/IP, подключение к сетевому интерфейсу принимает только пакеты, входящие в тот же интерфейс.</span><span class="sxs-lookup"><span data-stu-id="d6a16-129">In a strong host model, which is the default security model for the TCP/IP stack, a connection on a network interface accepts only packets that come in on the same interface.</span></span> <span data-ttu-id="d6a16-130">Таким образом, повторная авторизация интерфейса прибытия не используется на сильном главном компьютере.</span><span class="sxs-lookup"><span data-stu-id="d6a16-130">Therefore, arrival interface reauthorization is not used on a strong host computer.</span></span>

<span data-ttu-id="d6a16-131">В модели слабого узла подключение к сетевому интерфейсу позволяет выполнять пакеты, входящие в любой другой сетевой интерфейс.</span><span class="sxs-lookup"><span data-stu-id="d6a16-131">In a weak host model, a connection on a network interface allows packets coming in on any other network interface.</span></span> <span data-ttu-id="d6a16-132">Повторная авторизация интерфейса прибытия используется на слабом узловом компьютере для реализации политик для конкретного интерфейса.</span><span class="sxs-lookup"><span data-stu-id="d6a16-132">Arrival interface reauthorization is used on a weak host computer to implement interface-specific policies.</span></span> <span data-ttu-id="d6a16-133">Дополнительные сведения см [. в разделе "модель беспроводных и слабых узлов".](/previous-versions/technet-magazine/cc137807(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="d6a16-133">For more information, see ["The Cable Guy: Strong and Weak Host Models."](/previous-versions/technet-magazine/cc137807(v=msdn.10))</span></span>

<span data-ttu-id="d6a16-134">Некоторые классифицированные [поля](filtering-conditions.md) могут быть неизвестны во время переразработки.</span><span class="sxs-lookup"><span data-stu-id="d6a16-134">Some [classifiable fields](filtering-conditions.md) may be unknown during reauthorization.</span></span> <span data-ttu-id="d6a16-135">Например, если исходящий пакет перерабатывается на уровне [**\_ \_ \_ проверки подлинности фвпм уровня " \_ recv \_ Accept \_ V {4 \| 6}**](management-filtering-layer-identifiers-.md) ", все поля, относящиеся к интерфейсу прибытия, неизвестны.</span><span class="sxs-lookup"><span data-stu-id="d6a16-135">For example, if an outbound packet is being reauthorized at the [**FWPM\_LAYER\_ALE\_AUTH\_RECV\_ACCEPT\_V{4\|6}**](management-filtering-layer-identifiers-.md) layer, all the fields pertaining to the arrival interface are unknown.</span></span> <span data-ttu-id="d6a16-136">В этом случае значения неизвестных полей указываются как [**FWP \_ Empty**](/windows/desktop/api/Fwptypes/ne-fwptypes-fwp_data_type).</span><span class="sxs-lookup"><span data-stu-id="d6a16-136">In that case, the values of the unknown fields are indicated as [**FWP\_EMPTY**](/windows/desktop/api/Fwptypes/ne-fwptypes-fwp_data_type).</span></span>

<span data-ttu-id="d6a16-137">Поля типа [**FWP \_ Empty**](/windows/desktop/api/Fwptypes/ne-fwptypes-fwp_data_type) могут сопоставляться со значением [**FWP \_ Match \_**](/windows/desktop/api/Fwptypes/ne-fwptypes-fwp_match_type).</span><span class="sxs-lookup"><span data-stu-id="d6a16-137">Fields of type [**FWP\_EMPTY**](/windows/desktop/api/Fwptypes/ne-fwptypes-fwp_data_type) can be matched with [**FWP\_MATCH\_EQUAL**](/windows/desktop/api/Fwptypes/ne-fwptypes-fwp_match_type).</span></span> <span data-ttu-id="d6a16-138">Таким образом, политика может быть настроена для блокировки повторных авторизаций и уничтожения потока ALE при получении запросов на переподготовку для потока ALE.</span><span class="sxs-lookup"><span data-stu-id="d6a16-138">Therefore, a policy can be set to block reauthorizations and tear down an ALE flow when reauthorization requests for the ALE flow arrive.</span></span>

## <a name="pending-connection-reauthorization"></a><span data-ttu-id="d6a16-139">Ожидается повторная авторизация подключения</span><span class="sxs-lookup"><span data-stu-id="d6a16-139">Pending Connection Reauthorization</span></span>

<span data-ttu-id="d6a16-140">Драйвер выноски может отложить операцию классификации на уровнях ALE и выполнить ее позже, когда решение по фильтрации можно будет безопасно принять.</span><span class="sxs-lookup"><span data-stu-id="d6a16-140">A callout driver may postpone a classify operation at ALE layers and complete it at a later time, when the filtering decision can be safely made.</span></span> <span data-ttu-id="d6a16-141">Функции отсрочки и завершения ALE поддерживаются с помощью функций [FwpsPendOperation0](/windows-hardware/drivers/ddi/fwpsk/nf-fwpsk-fwpspendoperation0) и [FwpsCompleteOperation0](/windows-hardware/drivers/ddi/fwpsk/nf-fwpsk-fwpscompleteoperation0)в режиме ядра.</span><span class="sxs-lookup"><span data-stu-id="d6a16-141">The ALE postpone/complete functionality is supported via the kernel-mode functions [FwpsPendOperation0](/windows-hardware/drivers/ddi/fwpsk/nf-fwpsk-fwpspendoperation0) and [FwpsCompleteOperation0](/windows-hardware/drivers/ddi/fwpsk/nf-fwpsk-fwpscompleteoperation0).</span></span>

<span data-ttu-id="d6a16-142">Повторная авторизация активируется сразу после вызова FwpsCompleteOperation0 и позволяет драйверу выноски разрешить или заблокировать поток.</span><span class="sxs-lookup"><span data-stu-id="d6a16-142">The reauthorization is triggered immediately following the FwpsCompleteOperation0 call, and it allows the callout driver to permit or to block the flow.</span></span>

<span data-ttu-id="d6a16-143">Только начальная авторизация может быть отложена.</span><span class="sxs-lookup"><span data-stu-id="d6a16-143">Only an initial authorization can be postponed.</span></span> <span data-ttu-id="d6a16-144">Вызов FwpsPendOperation0 завершится ошибкой, если установлен флаг условия FWP с флагом повторной [**\_ \_ \_ \_ авторизации**](filtering-condition-flags-.md) .</span><span class="sxs-lookup"><span data-stu-id="d6a16-144">A call to FwpsPendOperation0 will fail if [**FWP\_CONDITION\_FLAG\_IS\_REAUTHORIZE**](filtering-condition-flags-.md) flag is set.</span></span>

<span data-ttu-id="d6a16-145">Дополнительные сведения см. в документации к [пакету драйверов Windows](/windows-hardware/drivers/ddi/_netvista/) .</span><span class="sxs-lookup"><span data-stu-id="d6a16-145">For more information, see the [Windows Driver Kit](/windows-hardware/drivers/ddi/_netvista/) documentation.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d6a16-146">См. также</span><span class="sxs-lookup"><span data-stu-id="d6a16-146">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d6a16-147">Принудительное применение уровня приложения (ALE)</span><span class="sxs-lookup"><span data-stu-id="d6a16-147">Application Layer Enforcement (ALE)</span></span>](application-layer-enforcement--ale-.md)
</dt> <dt>

[<span data-ttu-id="d6a16-148">Уровни ALE</span><span class="sxs-lookup"><span data-stu-id="d6a16-148">ALE Layers</span></span>](ale-layers.md)
</dt> <dt>

[<span data-ttu-id="d6a16-149">Фильтрация с отслеживанием состояния ALE</span><span class="sxs-lookup"><span data-stu-id="d6a16-149">ALE Stateful Filtering</span></span>](ale-stateful-filtering.md)
</dt> <dt>

[<span data-ttu-id="d6a16-150">Многоадресный или широковещательный трафик ALE</span><span class="sxs-lookup"><span data-stu-id="d6a16-150">ALE Multicast/Broadcast Traffic</span></span>](ale-multicast-broadcast-traffic.md)
</dt> <dt>

[<span data-ttu-id="d6a16-151">Настройка потока ALE</span><span class="sxs-lookup"><span data-stu-id="d6a16-151">ALE Flow Customization</span></span>](ale-flow-customization.md)
</dt> </dl>

 

 