---
title: Планирование команд
description: С каждой командой связан приоритет.
ms.assetid: 63f6ba9d-0b87-403b-916b-aa8550f98a11
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 06512f0748aa88f6b32de3291e2ed1c262212ba2
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "105661583"
---
# <a name="command-scheduling"></a>Планирование команд

## <a name="command-scheduling"></a>Планирование команд

Команды можно отправить в TBS из нескольких контекстов в любое время. Однако физический доверенный платформенный модуль может обрабатывать только одну команду за раз, и некоторые команды могут выполняться в течение значительного периода времени. Если ожидаются несколько команд, TBS определяет, какая команда будет отправлена в доверенный платформенный модуль. При отправке команды с каждой из них связана приоритетная команда. TBS использует эти приоритеты, чтобы определить, какая Ожидающая команда должна отправляться каждый раз, когда доверенный платформенный модуль освободится. Четыре уровня приоритета: низкий, нормальный, высокий и системный. Приложения должны использовать низкий, нормальный или высокий приоритет. Хотя команды с высоким приоритетом обычно выполняются перед командами с низким приоритетом, планировщик команд TBS имеет политику устаревания, которая в конечном итоге дает очень высокий приоритет командам, которые были заблокированы в течение продолжительных периодов времени.

## <a name="context-management"></a>Управление контекстом

При \_ отправке команды TPM савеконтекст или TPM2 контекстсаве с виртуальным маркером в ресурс, управляемый TBS, TBS выполняет соответствующую команду на физическом ресурсе и возвращает результат вызывающему объекту, если ресурс физически находится в доверенном платформенном модуле. Если ресурс физически отсутствует в TPM, предварительная обработка \_ команды TPM савеконтекст или TPM2 \_ контекстсаве приводит к повторной загрузке ресурса, после чего контекст будет сохранен и возвращен вызывающему объекту. Если сохраняемый ресурс имеет тип, который обычно автоматически сбрасывается из TPM после сохранения, TBS делает виртуальный ресурс недействительным после завершения этой команды. Когда команда TPM \_ лоадконтекст или TPM2 \_ контекстлоад отправляется в TBS, TBS выполняет команду немедленно. Если команда завершается успешно, TBS выполняет виртуализацию ресурса и передает полученный поток байтов TPM вызывающему объекту. При \_ отправке команды TPM флушспеЦифик или TPM2 \_ флушконтекст с виртуальным маркером в ресурс, управляемый TBS, TBS выполняет \_ команду флушспеЦифик или TPM2 \_ флушконтекст, чтобы удалить ресурс из доверенного платформенного модуля, если он физически имеется. В этом случае TBS делает виртуальный ресурс недействительным и возвращает результат команды FLUSH вызывающему объекту. Если ресурс физически отсутствует в доверенном платформенном модуле, предварительная обработка \_ команды TPM флушспеЦифик или TPM2 \_ флушконтекст загрузит ресурс, соответствующий виртуальному обработчику, но он будет сброшен при обработке команды. TBS не поддерживает кэйконтроловнерный бит доверенного платформенного модуля \_ или функцию кифандле в \_ операции лоадконтекст TPM, поэтому он не будет предоставлять ресурсу тот же обработчик, который он имел до сохранения контекста.

## <a name="other-commands"></a>Другие команды

Команды, не упомянутые в этой документации, обрабатываются путем замены дескрипторов виртуальных ключей физическими ключевыми дескрипторами (при необходимости) и их отправки в доверенный платформенный модуль. Это делается после выполнения соответствующих операций, чтобы убедиться, что используемые ресурсы физически находятся в доверенном платформенном модуле. Дополнительные специальные операции обработки не выполняются. TBS не пытается улучшить точность виртуализации, изменяя данные, передаваемые из доверенного платформенного модуля в составе \_ запроса TPM2 или функции TPM \_ . TBS также поддерживает команды TCG физического присутствия. TBS выступает в качестве транзитного для команд физического присутствия; никакая специальная обработка TBS не выполняется.

## <a name="cleanup"></a>Очистка

При выходе из контекста все связанные с ним физические и виртуальные ресурсы очищаются, чтобы они больше не использовали системные ресурсы.

 

 




