---
title: Создание поставщика услуг
description: Создание поставщика услуг
ms.assetid: 7da27fe2-8a57-4adb-94b2-448b6362dc33
keywords:
- Диспетчер устройств Windows Media, создание поставщиков услуг
- Диспетчер устройств, создание поставщиков услуг
- Диспетчер устройств Windows Media, программное руководством
- Диспетчер устройств, программное руководством
- рекомендации по программированию, поставщики услуг
- инструкции по программированию, Windows Media диспетчер устройств
- инструкции по программированию, создание поставщиков услуг
- Диспетчер устройств Windows Media, поставщики услуг
- Диспетчер устройств, поставщики услуг
- поставщики услуг, создание
- Создание поставщиков услуг, сведения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8469c3d656d151457ed818ea6b4192a3c79ed061
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105691528"
---
# <a name="creating-a-service-provider"></a><span data-ttu-id="3a647-114">Создание поставщика услуг</span><span class="sxs-lookup"><span data-stu-id="3a647-114">Creating a Service Provider</span></span>

<span data-ttu-id="3a647-115">Поставщик услуг — это компонент, который выступает в качестве середины между приложением и устройством.</span><span class="sxs-lookup"><span data-stu-id="3a647-115">A service provider is component that serves as a middleman between an application and a device.</span></span> <span data-ttu-id="3a647-116">Windows Media диспетчер устройств направляет запросы от приложения к поставщику услуг, который затем отвечает за взаимодействие с устройством или выполнение запрошенного действия.</span><span class="sxs-lookup"><span data-stu-id="3a647-116">Windows Media Device Manager routes requests from the application to the service provider, which is then responsible for communicating with the device or performing the requested action.</span></span> <span data-ttu-id="3a647-117">Поставщик услуг обычно взаимодействует с драйвером для обеспечения взаимодействия с устройством.</span><span class="sxs-lookup"><span data-stu-id="3a647-117">A service provider usually communicates with a driver to enable communication with the device.</span></span> <span data-ttu-id="3a647-118">Поставщик услуг — это COM-компонент, реализующий интерфейсы, вызываемые Windows Media диспетчер устройств.</span><span class="sxs-lookup"><span data-stu-id="3a647-118">A service provider is a COM component that implements the interfaces called by Windows Media Device Manager.</span></span> <span data-ttu-id="3a647-119">Корневой интерфейс объекта поставщика услуг — [**имдсервицепровидер**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider).</span><span class="sxs-lookup"><span data-stu-id="3a647-119">The root interface of the service provider object is [**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider).</span></span> <span data-ttu-id="3a647-120">После получения этого интерфейса диспетчер устройств Windows Media может получить другие интерфейсы через реализацию различных методов поставщика услуг.</span><span class="sxs-lookup"><span data-stu-id="3a647-120">After obtaining this interface, Windows Media Device Manager can obtain other interfaces through the service provider's implementation of various methods.</span></span> <span data-ttu-id="3a647-121">Интерфейсы, которые должен реализовать поставщик службы, перечислены в списке [обязательные и необязательные интерфейсы](mandatory-and-optional-interfaces.md).</span><span class="sxs-lookup"><span data-stu-id="3a647-121">The interfaces that a service provider must implement are listed in [Mandatory and Optional Interfaces](mandatory-and-optional-interfaces.md).</span></span> <span data-ttu-id="3a647-122">Иерархия интерфейсов показана в [интерфейсах для поставщиков служб](interfaces-for-service-providers.md).</span><span class="sxs-lookup"><span data-stu-id="3a647-122">The hierarchy of interfaces is shown in [Interfaces for Service Providers](interfaces-for-service-providers.md).</span></span>

> [!Note]  
> <span data-ttu-id="3a647-123">Не пытайтесь создать поставщик службы MTP; Вместо этого следует использовать поставщик услуг MTP и драйверы, предоставляемые корпорацией Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="3a647-123">You should not try to create an MTP service provider; instead, you should use the MTP service provider and drivers provided by Microsoft.</span></span>

 

<span data-ttu-id="3a647-124">Прежде чем пытаться создать поставщик услуг, необходимо тщательно разобраться в том, какие вызовы приложение будет выполнять на поставщике услуг.</span><span class="sxs-lookup"><span data-stu-id="3a647-124">Before trying to create a service provider, you should thoroughly understand what calls an application will make on a service provider.</span></span> <span data-ttu-id="3a647-125">Ознакомьтесь с [созданием приложения Диспетчер устройств Windows Media](creating-a-windows-media-device-manager-application.md) , чтобы получить представление о базовых задачах и вызовах, которые приложение будет делать на поставщике услуг при попытке связаться с устройством.</span><span class="sxs-lookup"><span data-stu-id="3a647-125">Read [Creating a Windows Media Device Manager Application](creating-a-windows-media-device-manager-application.md) to get some idea of the basic tasks and calls that an application will make on a service provider when it is attempting to communicate with a device.</span></span>

<span data-ttu-id="3a647-126">В следующем списке приведены основные этапы разработки поставщика услуг.</span><span class="sxs-lookup"><span data-stu-id="3a647-126">The following list shows the key steps in developing a service provider:</span></span>

1.  <span data-ttu-id="3a647-127">Включите (и при необходимости Скомпилируйте) необходимые файлы заголовка и библиотеки для проекта.</span><span class="sxs-lookup"><span data-stu-id="3a647-127">Include (and optionally compile) the required header and library files for your project.</span></span> <span data-ttu-id="3a647-128">Список необходимых файлов см. в разделе [необходимые библиотеки и заголовки для поставщика услуг](required-libraries-and-headers-for-a-service-provider.md) .</span><span class="sxs-lookup"><span data-stu-id="3a647-128">See [Required Libraries and Headers for a Service Provider](required-libraries-and-headers-for-a-service-provider.md) for the list of required files.</span></span>
2.  <span data-ttu-id="3a647-129">Реализуйте все остальные обязательные или необязательные интерфейсы поставщика услуг (см. раздел [обязательные и необязательные интерфейсы](mandatory-and-optional-interfaces.md)).</span><span class="sxs-lookup"><span data-stu-id="3a647-129">Implement all the other required or optional service provider interfaces (see [Mandatory and Optional Interfaces](mandatory-and-optional-interfaces.md)).</span></span> <span data-ttu-id="3a647-130">Как правило, интерфейсы будут вызываться в следующем порядке:</span><span class="sxs-lookup"><span data-stu-id="3a647-130">Typically, interfaces will be called in this order:</span></span>
    -   [<span data-ttu-id="3a647-131">**икомпонентаусентикате**</span><span class="sxs-lookup"><span data-stu-id="3a647-131">**IComponentAuthenticate**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate)
    -   <span data-ttu-id="3a647-132">[**Имдсервицепровидер**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider)/2</span><span class="sxs-lookup"><span data-stu-id="3a647-132">[**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider)/2</span></span>
    -   [<span data-ttu-id="3a647-133">**имдспенумдевице**</span><span class="sxs-lookup"><span data-stu-id="3a647-133">**IMDSPEnumDevice**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-imdspenumdevice)
    -   <span data-ttu-id="3a647-134">[**Имдспдевице**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice)/2</span><span class="sxs-lookup"><span data-stu-id="3a647-134">[**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice)/2</span></span>
    -   [<span data-ttu-id="3a647-135">**имдспенумстораже**</span><span class="sxs-lookup"><span data-stu-id="3a647-135">**IMDSPEnumStorage**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-imdspenumstorage)
    -   <span data-ttu-id="3a647-136">[**Имдспстораже**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspstorage)/2/3</span><span class="sxs-lookup"><span data-stu-id="3a647-136">[**IMDSPStorage**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspstorage)/2/3</span></span>
3.  <span data-ttu-id="3a647-137">Убедитесь, что поставщик услуг или устройство установили правильные разделы реестра во время установки.</span><span class="sxs-lookup"><span data-stu-id="3a647-137">Be sure your service provider or device installs the proper registry keys during installation.</span></span> <span data-ttu-id="3a647-138">В этих разделах указываются параметры устройства, регистрируется поставщик услуг в качестве подключаемого модуля и включается самонастраивающийся уведомлений о доходе и удалении устройства.</span><span class="sxs-lookup"><span data-stu-id="3a647-138">These keys specify device parameters, register the service provider as a plug-in, and enable Plug and Play notifications for device arrival and removal.</span></span> <span data-ttu-id="3a647-139">См. раздел [Параметры устройства](device-parameters.md), [Регистрация поставщика услуг](registering-the-service-provider.md)и [Включение PnP для устройств](enabling-pnp-for-devices.md).</span><span class="sxs-lookup"><span data-stu-id="3a647-139">See [Device Parameters](device-parameters.md), [Registering the Service Provider](registering-the-service-provider.md), and [Enabling PnP for Devices](enabling-pnp-for-devices.md).</span></span>
4.  <span data-ttu-id="3a647-140">При создании экземпляра класса Проверьте подлинность поставщика службы в конструкторе.</span><span class="sxs-lookup"><span data-stu-id="3a647-140">On instantiation of your class, authenticate the service provider in the constructor.</span></span> <span data-ttu-id="3a647-141">Для этого создайте класс [ксекуречаннелсервер](csecurechannelserver-class.md) и задайте сертификат.</span><span class="sxs-lookup"><span data-stu-id="3a647-141">To do this, create a [CSecureChannelServer](csecurechannelserver-class.md) class and set the certificate.</span></span> <span data-ttu-id="3a647-142">Реализуйте интерфейс [**икомпонентаусентикате**](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate) и вызовите методы класса ксекуречаннелсервер, созданного ранее.</span><span class="sxs-lookup"><span data-stu-id="3a647-142">Implement the [**IComponentAuthenticate**](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate) interface and call the methods of the CSecureChannelServer class instantiated previously.</span></span> <span data-ttu-id="3a647-143">Сведения о том, как создать экземпляр класса Ксекуречаннелсервер и реализовать методы Икомпонентаусентикате, см. в разделе [Проверка подлинности поставщика услуг](authenticating-the-service-provider.md) .</span><span class="sxs-lookup"><span data-stu-id="3a647-143">See [Authenticating the Service Provider](authenticating-the-service-provider.md) to learn how to instantiate the CSecureChannelServer class and implement the IComponentAuthenticate methods.</span></span>
5.  <span data-ttu-id="3a647-144">Диспетчер устройств Windows Media запрашивает у поставщика услуг список подключенных устройств, вызывая [**IMDServiceProvider2:: креатедевице**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider2-createdevice) или [**Имдсервицепровидер:: енумдевицес**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider-enumdevices)в зависимости от того, обрабатывает ли поставщик службы Самонастраивающийся устройства.</span><span class="sxs-lookup"><span data-stu-id="3a647-144">Windows Media Device Manager will query your service provider for a list of connected devices by calling [**IMDServiceProvider2::CreateDevice**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider2-createdevice) or [**IMDServiceProvider::EnumDevices**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider-enumdevices), depending on whether the service provider handles Plug and Play devices.</span></span> <span data-ttu-id="3a647-145">Поставщик услуг должен возвращать список объектов [**имдспдевице**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice) , представляющих подключенные устройства.</span><span class="sxs-lookup"><span data-stu-id="3a647-145">The service provider must return a list of [**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice) objects representing connected devices.</span></span> <span data-ttu-id="3a647-146">Дополнительные сведения см. в разделе [Перечисление устройств](enumerating-devices-service-provider.md) .</span><span class="sxs-lookup"><span data-stu-id="3a647-146">See [Enumerating Devices](enumerating-devices-service-provider.md) for more details.</span></span>
6.  <span data-ttu-id="3a647-147">Перед обработкой любого вызова убедитесь, что установлен безопасный канал.</span><span class="sxs-lookup"><span data-stu-id="3a647-147">Before handling any call, verify that a secure channel has been established.</span></span> <span data-ttu-id="3a647-148">Вызовите метод [**ксекуречаннелсервер:: фисаусентикатед**](/previous-versions/bb231600(v=vs.85)) перед выполнением каких бы то ни было действий.</span><span class="sxs-lookup"><span data-stu-id="3a647-148">Call [**CSecureChannelServer::fIsAuthenticated**](/previous-versions/bb231600(v=vs.85)) before performing any actions.</span></span> <span data-ttu-id="3a647-149">Если этот вызов завершается неудачей, возвращается ВМДМ \_ E \_ нотцертифиед.</span><span class="sxs-lookup"><span data-stu-id="3a647-149">If this call fails, return WMDM\_E\_NOTCERTIFIED.</span></span>
7.  <span data-ttu-id="3a647-150">Для работы с материалами, защищенными с помощью DRM, вам потребуется пара сертификатов или ключей, выпущенная корпорацией Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="3a647-150">You will need a certificate/key pair issued by Microsoft to be able to handle DRM-protected material.</span></span> <span data-ttu-id="3a647-151">Дополнительные сведения см. [в разделе Обработка защищенного содержимого в поставщике услуг](handling-protected-content-in-the-service-provider.md) .</span><span class="sxs-lookup"><span data-stu-id="3a647-151">See [Handling Protected Content in the Service Provider](handling-protected-content-in-the-service-provider.md) for more information.</span></span>
8.  <span data-ttu-id="3a647-152">Чтобы устройство было автоматически синхронизировано с проигрывателем Windows Media, оно должно удовлетворять требованиям, перечисленным в подсистеме " [Включение синхронизации с помощью проигрывателя Windows Media](enabling-synchronization-with-windows-media-player.md)".</span><span class="sxs-lookup"><span data-stu-id="3a647-152">To enable your device to synchronize automatically with Windows Media Player, it must fulfill the requirements listed in [Enabling Synchronization with Windows Media Player](enabling-synchronization-with-windows-media-player.md).</span></span>
9.  <span data-ttu-id="3a647-153">Чтобы устройство отображалось в проводнике Windows, необходимо выполнить несколько специальных действий, а также подробное описание [требований к отображению портативных проигрывателей в проводнике Windows](requirements-for-portable-audio-players-to-appear-in-windows-explorer.md).</span><span class="sxs-lookup"><span data-stu-id="3a647-153">To enable your device to appear in Windows Explorer, you must take a few special steps, detailed in [Requirements for Portable Audio Players to Appear in Windows Explorer](requirements-for-portable-audio-players-to-appear-in-windows-explorer.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="3a647-154">См. также</span><span class="sxs-lookup"><span data-stu-id="3a647-154">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3a647-155">**Инструкции по программированию**</span><span class="sxs-lookup"><span data-stu-id="3a647-155">**Programming Guide**</span></span>](programming-guide.md)
</dt> </dl>

 

 