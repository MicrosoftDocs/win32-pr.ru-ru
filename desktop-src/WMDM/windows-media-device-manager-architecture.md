---
title: Архитектура диспетчер устройств Windows Media
description: Архитектура диспетчер устройств Windows Media
ms.assetid: 3c1b2da4-559d-427b-b502-5ef8dc055a8e
keywords:
- Диспетчер устройств Windows Media, архитектура
- Диспетчер устройств, архитектура
- Архитектура диспетчер устройств Windows Media
- Windows Media диспетчер устройств, классические приложения
- Диспетчер устройств, классические приложения
- Диспетчер устройств Windows Media, поставщики услуг
- Диспетчер устройств, поставщики услуг
- Диспетчер устройств Windows Media, подключаемые модули
- Диспетчер устройств, подключаемые модули
- Классические приложения, архитектура Windows Media диспетчер устройств
- поставщики услуг, архитектура диспетчер устройств Windows Media
- подключаемые модули, архитектура диспетчер устройств Windows Media
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9fda87e4ed4bce2c82bbb9c0863c119851965940
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104253002"
---
# <a name="windows-media-device-manager-architecture"></a><span data-ttu-id="af66a-115">Архитектура диспетчер устройств Windows Media</span><span class="sxs-lookup"><span data-stu-id="af66a-115">Windows Media Device Manager Architecture</span></span>

<span data-ttu-id="af66a-116">Windows Media диспетчер устройств позволяет приложению или подключаемому модулю взаимодействовать с устройством.</span><span class="sxs-lookup"><span data-stu-id="af66a-116">Windows Media Device Manager enables an application or plug-in to communicate with a device.</span></span> <span data-ttu-id="af66a-117">Приложения могут запрашивать метаданные устройства, перечислять и исследовать подключенные устройства, отправлять или получать объекты (папки, файлы, списки воспроизведения и т. д.).</span><span class="sxs-lookup"><span data-stu-id="af66a-117">Applications can request device metadata, enumerate and explore attached devices, and send or receive objects (folders, files, playlists, and so on).</span></span> <span data-ttu-id="af66a-118">Windows Media диспетчер устройств предоставляет один интерфейс API вызывающему приложению независимо от типа устройства (MTP или класс массового хранения, поставщики услуг, созданные на базе версии 10 или поставщики услуг, созданные на более ранних версиях Windows Media диспетчер устройств).</span><span class="sxs-lookup"><span data-stu-id="af66a-118">Windows Media Device Manager provides a single API to the calling application, no matter what type of device is being called (MTP or Mass Storage Class, service providers built on version 10 or service providers built on earlier versions of Windows Media Device Manager).</span></span>

<span data-ttu-id="af66a-119">Windows Media диспетчер устройств выступает в качестве посредника для трех основных компонентов системы: приложения, которое делает запросы (для получения информации, чтения или записи данных и т. д.); защищенный поставщик содержимого — компонент, который обрабатывает взаимодействие с файлами, защищенными с помощью DRM; и поставщик услуг, который получает запросы от приложения и взаимодействует с устройством для выполнения этих запросов.</span><span class="sxs-lookup"><span data-stu-id="af66a-119">Windows Media Device Manager acts as a go-between for the three major components of the system: the application, which makes requests (for information, to read or write data, and so on); a secure content provider, which is a component that handles communication with DRM-protected files; and a service provider, which receives requests from the application and communicates with the device to perform these requests.</span></span> <span data-ttu-id="af66a-120">Как приложение, так и поставщик службы построены на Windows Media диспетчер устройств SDK.</span><span class="sxs-lookup"><span data-stu-id="af66a-120">Both the application and the service provider are built on the Windows Media Device Manager SDK.</span></span>

<span data-ttu-id="af66a-121">На следующей схеме показано, как приложение для настольных компьютеров взаимодействует с устройством с помощью Windows Media диспетчер устройств 11.</span><span class="sxs-lookup"><span data-stu-id="af66a-121">The following diagram shows how a desktop application communicates with a device using Windows Media Device Manager 11.</span></span>

![Схема, показывающая приложение, взаимодействующее с четырьмя устройствами различных типов.](images/wmdm-device-communication.gif)

<span data-ttu-id="af66a-123">На предыдущей схеме показано приложение, взаимодействующее с четырьмя различными типами устройств, каждое из которых имеет собственный поставщик услуг.</span><span class="sxs-lookup"><span data-stu-id="af66a-123">The preceding diagram shows an application communicating with four different types of devices, each with its own service provider.</span></span> <span data-ttu-id="af66a-124">Каждый поставщик услуг предназначен для взаимодействия с устройством определенного типа. на этой схеме показаны три предоставленные корпорацией Майкрософт поставщики услуг (универсальные драйверы классов для устройств класса запоминающих носителей, устройства RAPI и устройства MTP), а также пользовательский поставщик услуг для собственного устройства, созданного третьим лицом.</span><span class="sxs-lookup"><span data-stu-id="af66a-124">Every service provider is designed to communicate with a specific type of device; this diagram shows the three Microsoft-provided service providers (generic class drivers for Mass Storage Class devices, RAPI devices, and MTP devices), as well as a custom service provider for a proprietary device built by a third party.</span></span> <span data-ttu-id="af66a-125">При подключении устройства диспетчер устройств Windows Media создает экземпляр поставщика служб, зарегистрированного для этого устройства.</span><span class="sxs-lookup"><span data-stu-id="af66a-125">When a device connects, Windows Media Device Manager instantiates an instance of the service provider registered for that device.</span></span> <span data-ttu-id="af66a-126">Поставщики услуг получают запросы от приложения через Windows Media диспетчер устройств интерфейсы, которые они реализуют, используют соответствующие драйверы для взаимодействия с устройством и возвращают соответствующие результаты.</span><span class="sxs-lookup"><span data-stu-id="af66a-126">The service providers get requests from the application through Windows Media Device Manager interfaces that they implement, use appropriate drivers to communicate with the device, and return appropriate results.</span></span> <span data-ttu-id="af66a-127">Связь между поставщиком службы и устройством выходит за пределы домена Windows Media диспетчер устройств.</span><span class="sxs-lookup"><span data-stu-id="af66a-127">Communication between the service provider and the device is outside the domain of Windows Media Device Manager.</span></span>

<span data-ttu-id="af66a-128">Поставщики услуг невидимы для приложения; приложение видит только список "устройства", так как Windows Media диспетчер устройств предоставляет стандартный набор методов и интерфейсов для всех устройств.</span><span class="sxs-lookup"><span data-stu-id="af66a-128">Service providers are invisible to the application; an application sees only a list of "devices" because Windows Media Device Manager exposes a standard set of methods and interfaces for all devices.</span></span> <span data-ttu-id="af66a-129">Если производитель создает настраиваемого поставщика услуг, он должен обрабатывать все стандартные методы диспетчер устройств Windows Media, если приложения могут использовать устройство.</span><span class="sxs-lookup"><span data-stu-id="af66a-129">If a manufacturer creates a custom service provider, it must handle all the standard Windows Media Device Manager methods if applications are to be able to use the device.</span></span>

<span data-ttu-id="af66a-130">На этой схеме также показан модуль безопасного поставщика содержимого (SCP).</span><span class="sxs-lookup"><span data-stu-id="af66a-130">This diagram also shows a secure content provider (SCP) module.</span></span> <span data-ttu-id="af66a-131">Этот модуль отвечает за обработку содержимого, защищенного с использованием управления цифровыми правами (DRM).</span><span class="sxs-lookup"><span data-stu-id="af66a-131">This module is responsible for handling digital rights management (DRM) protected content.</span></span> <span data-ttu-id="af66a-132">Корпорация Майкрософт предоставляет модуль SCP, который может работать с файлами WMA и WMV, защищенными с помощью DRM.</span><span class="sxs-lookup"><span data-stu-id="af66a-132">Microsoft provides an SCP module that can handle DRM-protected WMA and WMV files.</span></span> <span data-ttu-id="af66a-133">Если приложение или устройство планирует работать с другими защищенными форматами, оно должно предоставить собственный модуль SCP.</span><span class="sxs-lookup"><span data-stu-id="af66a-133">If an application or device intends to handle other protected formats, it must provide its own SCP module.</span></span> <span data-ttu-id="af66a-134">Ни приложение, ни поставщик услуг не взаимодействует с SCP напрямую.</span><span class="sxs-lookup"><span data-stu-id="af66a-134">Neither the application nor the service provider deals with the SCP directly.</span></span>

<span data-ttu-id="af66a-135">Как приложение, так и поставщик службы построены на диспетчер устройств Windows Media, который направляет вызовы между приложением и соответствующим поставщиком служб для устройства; поставщик услуг отвечает за взаимодействие непосредственно с устройством.</span><span class="sxs-lookup"><span data-stu-id="af66a-135">Both the application and the service provider are built on Windows Media Device Manager, which routes calls between the application and the appropriate service provider for a device; the service provider is responsible for communicating directly with the device.</span></span> <span data-ttu-id="af66a-136">Диспетчер устройств Windows Media выполняет некоторые действия (например, перечисление подключенных устройств, маршрутизацию вызовов и обработку проверки компонентов); Однако большая часть работы выполняется поставщиком услуг, который получает запросы от приложения и взаимодействует с устройством.</span><span class="sxs-lookup"><span data-stu-id="af66a-136">Windows Media Device Manager does perform some actions itself (such as enumerating connected devices, routing calls, and handling component verification); however, most of the work is done by the service provider, which receives requests from the application and communicates with the device.</span></span>

<span data-ttu-id="af66a-137">Приложение на основе Windows Media диспетчер устройств может взаимодействовать с устройствами и поставщиками услуг, созданными на более ранних версиях Windows Media диспетчер устройств; Однако эти старые устройства будут выполняться с помощью 9 компонентов серии (не показаны) и не будут поддерживать новейшие функции, в частности более расширенную технологию управления цифровыми правами.</span><span class="sxs-lookup"><span data-stu-id="af66a-137">An application built on Windows Media Device Manager can communicate with devices and service providers built on earlier versions of Windows Media Device Manager; however, these older devices will be run through 9 Series components (not shown), and will not support the newest features, particularly the more advanced digital rights management technology.</span></span>

<span data-ttu-id="af66a-138">Архитектура устройства</span><span class="sxs-lookup"><span data-stu-id="af66a-138">Architecture of a Device</span></span>

<span data-ttu-id="af66a-139">На следующей схеме показана упрощенная иерархия устройств и хранилищ, отображаемых приложением с помощью диспетчер устройств Windows Media.</span><span class="sxs-lookup"><span data-stu-id="af66a-139">The following diagram shows a simplified hierarchy of devices and storages as seen by an application using Windows Media Device Manager.</span></span>

![Схема, показывающая хранилища на устройстве.](images/wmdm-basic-device-layout.gif)

<span data-ttu-id="af66a-141">На предыдущей схеме показана упрощенная версия подключенного флэш-накопителя, как показано в приложении Windows Media диспетчер устройств.</span><span class="sxs-lookup"><span data-stu-id="af66a-141">The preceding diagram shows a simplified version of a connected flash drive, as seen by a Windows Media Device Manager application.</span></span> <span data-ttu-id="af66a-142">Устройство флэш-памяти имеет атрибуты и свойства, такие как серийный номер и поддерживаемые конфигурации формата.</span><span class="sxs-lookup"><span data-stu-id="af66a-142">The flash drive has attributes and properties, such as a serial number and supported format configurations.</span></span> <span data-ttu-id="af66a-143">Непосредственный дочерний элемент устройства Flash — это корневой объект хранилища, который содержит папку, содержащую изображение и песню.</span><span class="sxs-lookup"><span data-stu-id="af66a-143">An immediate child of the flash device is the root storage object, which contains a folder, which itself contains an image and a song.</span></span>

<span data-ttu-id="af66a-144">Приложение перечисляет список подключенных устройств, вызывая метод перечисления, предоставляемый корневым интерфейсом [**ивмдевицеманажер**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdevicemanager) .</span><span class="sxs-lookup"><span data-stu-id="af66a-144">An application enumerates the list of attached devices by calling an enumeration method exposed by the root [**IWMDeviceManager**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdevicemanager) interface.</span></span> <span data-ttu-id="af66a-145">Устройства представлены с помощью [**ивмдмдевице**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmdevice) (или производного) интерфейса.</span><span class="sxs-lookup"><span data-stu-id="af66a-145">Devices are represented by an [**IWMDMDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmdevice) (or a derived) interface.</span></span> <span data-ttu-id="af66a-146">Этот интерфейс предоставляет методы для получения имени устройства, возможностей форматирования, серийного номера и т. д., а также метода, который перечисляет *хранилища* на устройстве.</span><span class="sxs-lookup"><span data-stu-id="af66a-146">This interface exposes methods to retrieve the device name, format capabilities, serial number, and so on, as well as a method that enumerates *storages* on the device.</span></span> <span data-ttu-id="af66a-147">В Windows Media диспетчер устройств хранилище — это объект любого типа на устройстве, независимо от того, является ли он фактическим BLOB-объектом данных.</span><span class="sxs-lookup"><span data-stu-id="af66a-147">In Windows Media Device Manager, a storage is any kind of object on the device, whether or not it is an actual blob of data.</span></span> <span data-ttu-id="af66a-148">Например, звуковые файлы, текстовые файлы, папки, списки воспроизведения, хранящиеся в виде файлов, и списки воспроизведения, хранящиеся в виде метаданных, считаются хранилищами, даже если папки и элементы метаданных, вероятно, не представляют физический файл.</span><span class="sxs-lookup"><span data-stu-id="af66a-148">For example: audio files, text files, folders, playlists stored as files, and playlists stored as metadata are all considered storages, even though folders and metadata items probably do not represent a physical file.</span></span> <span data-ttu-id="af66a-149">Тип (или формат) хранилища можно получить путем вызова методов [**InAttribute**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-getattributes) (или [**метаданных**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage3-getmetadata), запросив формат хранилища).</span><span class="sxs-lookup"><span data-stu-id="af66a-149">The type (or format) of a storage can be retrieved by calling [**GetAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-getattributes) (or [**GetMetadata**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage3-getmetadata), requesting the format of the storage).</span></span>

<span data-ttu-id="af66a-150">Хранилища на устройстве хранятся иерархически, а все устройства имеют корневое хранилище.</span><span class="sxs-lookup"><span data-stu-id="af66a-150">Storages on a device are stored hierarchically, and all devices have a root storage.</span></span> <span data-ttu-id="af66a-151">Каждое хранилище может содержать ноль или более дочерних объектов, перечисленное путем вызова метода [**ивмдмстораже:: енумстораже**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-enumstorage) хранилища.</span><span class="sxs-lookup"><span data-stu-id="af66a-151">Each storage can hold zero or more child objects, enumerated by calling that storage's [**IWMDMStorage::EnumStorage**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-enumstorage) method.</span></span>

<span data-ttu-id="af66a-152">Обратите внимание, что каждое хранилище на схеме имеет связанные с ним атрибуты и метаданные (не все значения показаны).</span><span class="sxs-lookup"><span data-stu-id="af66a-152">Note that each storage in the diagram has attributes and metadata associated with it (not all values are shown).</span></span> <span data-ttu-id="af66a-153">Атрибуты являются простыми, логическими сведениями, которые часто описывают управление или сведения для навигации (например, "содержит папки" или "может удалять"), тогда как метаданные могут быть строковыми значениями, числами или сложными сведениями (например, возможностями отрисовки).</span><span class="sxs-lookup"><span data-stu-id="af66a-153">Attributes are simple, Boolean information often describing management or navigational information (such as "has folders" or "can delete"), whereas metadata can be string values, numbers, or complex information (such as rendering capabilities).</span></span> <span data-ttu-id="af66a-154">Атрибуты описываются достаточно ограниченным набором флагов, определенных пакетом SDK, и извлекаются путем вызова [**ивмдмстораже:: inattributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-getattributes) или [**IWMDMStorage2:: GetAttributes2**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage2-getattributes2).</span><span class="sxs-lookup"><span data-stu-id="af66a-154">Attributes are described by a fairly limited set of flags defined by the SDK and retrieved by calling [**IWMDMStorage::GetAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-getattributes) or [**IWMDMStorage2::GetAttributes2**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage2-getattributes2).</span></span> <span data-ttu-id="af66a-155">Значения метаданных извлекаются с помощью уникального имени; пакет SDK определяет ряд значений метаданных, которые должны поддерживать устройства, но устройства могут определять собственные [константы метаданных](metadata-constants.md).</span><span class="sxs-lookup"><span data-stu-id="af66a-155">Metadata values are retrieved by a unique name; the SDK defines a number of metadata values that devices should support, but devices can define their own [metadata constants](metadata-constants.md).</span></span> <span data-ttu-id="af66a-156">Однако если устройство или поставщик услуг определяет новую константу метаданных, приложения не смогут запрашивать или задавать это значение, если разработчикам приложений не известно о новой константе.</span><span class="sxs-lookup"><span data-stu-id="af66a-156">However, if a device or service provider defines a new metadata constant, applications won't be able to request or set this value unless the application developers were aware of this new constant.</span></span> <span data-ttu-id="af66a-157">Поставщик услуг должен поддерживать [**IWMDMStorage3**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmstorage3) или более позднюю версию для поддержки получения или установки метаданных.</span><span class="sxs-lookup"><span data-stu-id="af66a-157">A service provider must support [**IWMDMStorage3**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmstorage3) or later to support retrieving or setting metadata.</span></span> <span data-ttu-id="af66a-158">Дополнительные сведения см. в разделе [Получение и Настройка метаданных и атрибутов](getting-and-setting-metadata-and-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="af66a-158">For more information, see [Getting and Setting Metadata and Attributes](getting-and-setting-metadata-and-attributes.md).</span></span>

<span data-ttu-id="af66a-159">Поставщики услуг</span><span class="sxs-lookup"><span data-stu-id="af66a-159">Service Providers</span></span>

<span data-ttu-id="af66a-160">Поставщик услуг выступает в качестве середины между приложением и устройством.</span><span class="sxs-lookup"><span data-stu-id="af66a-160">The service provider acts as a middleman between the application and the device.</span></span> <span data-ttu-id="af66a-161">Поставщик услуг является невидимым для разработчика приложения, поэтому разработчику приложения не нужно ничего знать о разработке поставщика услуг.</span><span class="sxs-lookup"><span data-stu-id="af66a-161">The service provider is invisible to the application developer, so an application developer does not need to know anything about developing a service provider.</span></span> <span data-ttu-id="af66a-162">Однако это поставщик услуг, который выполняет работу по взаимодействию с устройством.</span><span class="sxs-lookup"><span data-stu-id="af66a-162">However, it is the service provider that does the work of communicating with a device.</span></span>

<span data-ttu-id="af66a-163">Поставщик услуг — это COM-библиотека DLL, созданная на основе Windows Media диспетчер устройств, которая получает запросы от приложения и взаимодействует с устройством для выполнения этих операций.</span><span class="sxs-lookup"><span data-stu-id="af66a-163">A service provider is a COM DLL built on Windows Media Device Manager that receives requests from an application and communicates with the device to perform them.</span></span> <span data-ttu-id="af66a-164">Обмен данными с настольным приложением осуществляется диспетчер устройств Windows Media. связь с устройством находится под контролем поставщика услуг.</span><span class="sxs-lookup"><span data-stu-id="af66a-164">Communication with the desktop application is mediated by Windows Media Device Manager; communication with the device is under the control of the service provider.</span></span>

<span data-ttu-id="af66a-165">Поставщик услуг получает от приложения запросы для перечисления содержимого устройства, запросов для возможностей устройств, запросов на чтение или запись данных и т. д.</span><span class="sxs-lookup"><span data-stu-id="af66a-165">A service provider receives requests from the application to enumerate device content, requests for device capabilities, requests to read or write data, and so on.</span></span> <span data-ttu-id="af66a-166">Это должно быть достаточно для того, чтобы правильно понять структуру устройства, чтобы она могла отправить команды в правильном формате и протоколе.</span><span class="sxs-lookup"><span data-stu-id="af66a-166">It must know the design of a device well enough that it can send commands in the proper format and protocol.</span></span> <span data-ttu-id="af66a-167">Он также должен иметь возможность скрывать особые требования для конкретных устройств, такие как требуемое расширение файлов для списков воспроизведения, чтобы приложениям не требовалось знать эти требования для использования устройства.</span><span class="sxs-lookup"><span data-stu-id="af66a-167">It should also be able to hide device-specific requirements, such as a required file extension for playlists, so that applications do not need to know these requirements in order to use the device.</span></span>

<span data-ttu-id="af66a-168">Корпорация Майкрософт предоставляет несколько поставщиков услуг для стандартных типов устройств, включая универсальные устройства MTP, устройства класса запоминающих устройств и устройства RAPI.</span><span class="sxs-lookup"><span data-stu-id="af66a-168">Microsoft provides a number of service providers for standard device types, including generic MTP devices, Mass Storage Class devices, and RAPI devices.</span></span> <span data-ttu-id="af66a-169">Единственная причина, по которой конструктору устройств необходимо создать пользовательский поставщик услуг, — если устройство имеет некоторые особые или необычные требования к хранению данных, которые поставщики стандартных служб не обрабатывали, например, если файлы должны храниться в определенных расположениях, а операционная система устройства не обрабатывает это автоматически.</span><span class="sxs-lookup"><span data-stu-id="af66a-169">The only reason a device designer should need to create a custom service provider is if a device has some specific or unusual data storage requirements that the standard service providers do not handle—for instance, if files must be stored in specific locations and the device operating system does not handle this automatically.</span></span>

<span data-ttu-id="af66a-170">При подключении устройства к компьютеру операционная система создает по одному экземпляру соответствующего поставщика услуг для каждого приложения Windows Media диспетчер устройств.</span><span class="sxs-lookup"><span data-stu-id="af66a-170">When a device is connected to the computer, the operating system creates one instance of the appropriate service provider for each Windows Media Device Manager application.</span></span> <span data-ttu-id="af66a-171">Если запускается второе приложение диспетчер устройств Windows Media, будет загружен второй экземпляр поставщика услуг.</span><span class="sxs-lookup"><span data-stu-id="af66a-171">If a second Windows Media Device Manager application starts, a second instance of the service provider will be loaded.</span></span> <span data-ttu-id="af66a-172">Однако каждый поставщик услуг может работать с несколькими устройствами.</span><span class="sxs-lookup"><span data-stu-id="af66a-172">However, each service provider can handle multiple devices.</span></span> <span data-ttu-id="af66a-173">Это показано на схеме ниже.</span><span class="sxs-lookup"><span data-stu-id="af66a-173">The following diagram illustrates this.</span></span>

![Схема, на которой показаны два устройства MTP, взаимодействующие с двумя приложениями.](images/wmdm-sp-to-device.gif)

<span data-ttu-id="af66a-175">На предыдущей схеме показаны два разных приложения, взаимодействующие с двумя устройствами MTP.</span><span class="sxs-lookup"><span data-stu-id="af66a-175">The preceding diagram shows two different applications communicating with two MTP devices.</span></span> <span data-ttu-id="af66a-176">Устройства используют один и тот же класс поставщика услуг, но каждое приложение имеет собственный экземпляр одного и того же поставщика услуг.</span><span class="sxs-lookup"><span data-stu-id="af66a-176">The devices use the same service provider class, but each application has its own instance of the same service provider.</span></span> <span data-ttu-id="af66a-177">Каждый экземпляр поставщика услуг взаимодействует с устройствами.</span><span class="sxs-lookup"><span data-stu-id="af66a-177">Each service provider instance is communicating with devices.</span></span> <span data-ttu-id="af66a-178">Разные экземпляры поставщика услуг не знают друг о друга.</span><span class="sxs-lookup"><span data-stu-id="af66a-178">The different instances of the service provider are not aware of each other.</span></span>

<span data-ttu-id="af66a-179">Многие методы приложений имеют метод поставщика услуг с соответствующим именем.</span><span class="sxs-lookup"><span data-stu-id="af66a-179">Many application methods have a correspondingly named service provider method.</span></span> <span data-ttu-id="af66a-180">Когда приложение вызывает метод, Windows Media диспетчер устройств направляет вызов соответствующему методу поставщика услуг (хотя сначала он может выполнить некоторые дополнительные внутренние действия).</span><span class="sxs-lookup"><span data-stu-id="af66a-180">When the application calls a method, Windows Media Device Manager routes the call to the corresponding method on the service provider (though it might perform some additional internal actions first).</span></span> <span data-ttu-id="af66a-181">Например, когда приложение вызывает [**IWMDMDevice3:: Property**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmdevice3-getproperty), Windows Media Диспетчер устройств направляет этот вызов в реализацию [**IMDSPDevice3::**](/windows/desktop/api/mswmdm/nf-mswmdm-imdspdevice3-getproperty)поставщика услуг.</span><span class="sxs-lookup"><span data-stu-id="af66a-181">For example, when the application calls [**IWMDMDevice3::GetProperty**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmdevice3-getproperty), Windows Media Device Manager routes this call to the service provider's implementation of [**IMDSPDevice3::GetProperty**](/windows/desktop/api/mswmdm/nf-mswmdm-imdspdevice3-getproperty).</span></span> <span data-ttu-id="af66a-182">(Большинство интерфейсов приложений начинаются с ИВМДМ, а соответствующий интерфейс поставщика услуг начинается с ИМДСП).</span><span class="sxs-lookup"><span data-stu-id="af66a-182">(Most application interfaces begin with IWMDM, and the corresponding service provider interface begins with IMDSP).</span></span> <span data-ttu-id="af66a-183">Ожидается, что поставщик услуг обрабатывает этот вызов метода и возвращает соответствующий результат.</span><span class="sxs-lookup"><span data-stu-id="af66a-183">The service provider is expected to handle this method call and return an appropriate result.</span></span>

<span data-ttu-id="af66a-184">Приложение не будет напрямую изучать устройство или взаимодействовать с ним (если оно не вызывает [**IWMDMDevice3::D евицеиоконтрол**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmdevice3-deviceiocontrol) или [**Ивмдмстораже:: сендопакуекомманд**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-sendopaquecommand)); приложение взаимодействует с поставщиком услуг, который должен представлять устройство самым логичным и простым способом.</span><span class="sxs-lookup"><span data-stu-id="af66a-184">An application never explores or communicates with a device directly (unless it calls [**IWMDMDevice3::DeviceIoControl**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmdevice3-deviceiocontrol) or [**IWMDMStorage::SendOpaqueCommand**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-sendopaquecommand)); the application communicates with the service provider, which must represent a device in the most logical and simple manner possible.</span></span> <span data-ttu-id="af66a-185">Когда приложение запрашивает сведения об устройстве или перечисляет объекты на устройстве, поставщик услуг запрашивает устройство соответствующим образом и получает и возвращает соответствующие сведения.</span><span class="sxs-lookup"><span data-stu-id="af66a-185">When the application requests information about the device, or enumerates objects on the device, the service provider queries the device in an appropriate manner and acquires and returns the appropriate information.</span></span> <span data-ttu-id="af66a-186">Она может предоставлять организацию файлов на устройстве иначе, чем она физически хранится на устройстве, если это уместно.</span><span class="sxs-lookup"><span data-stu-id="af66a-186">It may expose the file organization on the device differently from how it is physically stored on the device, if that is appropriate.</span></span> <span data-ttu-id="af66a-187">Однако оно предоставляет устройство, оно должно быть согласованным логическим способом, чтобы приложение было находить необходимое для него действие и обрабатывать отправляемые им команды.</span><span class="sxs-lookup"><span data-stu-id="af66a-187">However it exposes the device, it should be in a consistent, logical manner, to enable the application to find what it needs and handle the commands it sends.</span></span> <span data-ttu-id="af66a-188">Хороший поставщик услуг скрывает странностой для конкретного устройства, например, если устройство физически сохраняет список воспроизведения в виде файла с пользовательским расширением файла, поставщик услуг должен добавить это расширение автоматически при создании приложением списка воспроизведения на устройстве. При создании объекта списка воспроизведения приложению не следует предполагать, что оно должно иметь соответствующее расширение.</span><span class="sxs-lookup"><span data-stu-id="af66a-188">A good service provider will hide device-specific peculiarities—for example, if the device physically stores a playlist as a file with a custom file extension, the service provider should add that extension automatically when the application creates a playlist on the device; it should not expect the application to know the proper extension when creating a playlist object.</span></span>

<span data-ttu-id="af66a-189">Поставщики служб выполняются внутри процесса вызывающего приложения.</span><span class="sxs-lookup"><span data-stu-id="af66a-189">Service providers run inside the process of the calling application.</span></span> <span data-ttu-id="af66a-190">Единственным исключением является поставщик службы MTP, который выполняется в собственном процессе.</span><span class="sxs-lookup"><span data-stu-id="af66a-190">The only exception to this is the MTP service provider, which runs in its own process.</span></span> <span data-ttu-id="af66a-191">По этой причине существует некоторый риск того, что заблокированный поставщик услуг вызовет блокировку вызывающего приложения.</span><span class="sxs-lookup"><span data-stu-id="af66a-191">Because of this, there is some risk that a blocked service provider will cause the calling application to block.</span></span> <span data-ttu-id="af66a-192">Поэтому поставщики услуг должны быть надежными и предотвращать блокировку, а приложения должны быть спроектированы таким образом, чтобы предотвратить зависание, если конкретный вызов метода не возвращает быстрое возвращение.</span><span class="sxs-lookup"><span data-stu-id="af66a-192">Therefore, service providers should be designed to be robust and prevent blocking, and applications should be designed to avoid stalling if a particular method call does not return quickly.</span></span>

## <a name="related-topics"></a><span data-ttu-id="af66a-193">См. также</span><span class="sxs-lookup"><span data-stu-id="af66a-193">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="af66a-194">**начало работы**</span><span class="sxs-lookup"><span data-stu-id="af66a-194">**Getting Started**</span></span>](getting-started.md)
</dt> </dl>

 

 




