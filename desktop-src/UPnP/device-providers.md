---
title: Поставщики устройств
description: Поставщики устройств — это зарегистрированные объекты, которые компьютер запускает при каждом запуске системы.
ms.assetid: 80c08993-0a8b-4ee9-93cd-bcc3c00e843b
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 67fac270342830045fc3bac9f0573f283d87dc6a
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104133986"
---
# <a name="device-providers"></a><span data-ttu-id="991f7-103">Поставщики устройств</span><span class="sxs-lookup"><span data-stu-id="991f7-103">Device Providers</span></span>

<span data-ttu-id="991f7-104">Поставщики устройств — это зарегистрированные объекты, которые компьютер запускает при каждом запуске системы.</span><span class="sxs-lookup"><span data-stu-id="991f7-104">Device providers are registered objects that the computer starts on every system startup.</span></span> <span data-ttu-id="991f7-105">Поставщики устройств регистрируют и отменяют регистрацию выполняющихся устройств на узле устройства в ответ на определенное событие.</span><span class="sxs-lookup"><span data-stu-id="991f7-105">Device providers register and unregister running devices with the device host in response to some event.</span></span> <span data-ttu-id="991f7-106">Эти устройства — это устройства, которые автоматически запускаются во время запуска системы.</span><span class="sxs-lookup"><span data-stu-id="991f7-106">These devices are devices that have been automatically started at system startup time.</span></span> <span data-ttu-id="991f7-107">По соображениям безопасности поставщик устройства обычно работает как [Локальная](/windows/desktop/Services/localservice-account)служба, а не [LocalSystem](/windows/desktop/Services/localsystem-account).</span><span class="sxs-lookup"><span data-stu-id="991f7-107">For security reasons, a device provider should generally run as [LocalService](/windows/desktop/Services/localservice-account), rather than [LocalSystem](/windows/desktop/Services/localsystem-account).</span></span>

<span data-ttu-id="991f7-108">Поставщики устройств можно использовать для переходных устройств.</span><span class="sxs-lookup"><span data-stu-id="991f7-108">Device providers can be used for transient devices.</span></span> <span data-ttu-id="991f7-109">Поставщики устройств также можно использовать для моста устройств на просылаемые носители.</span><span class="sxs-lookup"><span data-stu-id="991f7-109">Device providers can also be used to bridge devices to polled media.</span></span> <span data-ttu-id="991f7-110">Например, периферийное устройство, например проигрыватель цифрового музыкального проигрывателя, подключается к компьютеру через последовательный порт.</span><span class="sxs-lookup"><span data-stu-id="991f7-110">For example, a peripheral device such as a digital music player is connected to a computer via a serial port.</span></span> <span data-ttu-id="991f7-111">Чтобы предоставить музыкальный проигрыватель в качестве устройства на основе UPnP, требуется объект управления устройством и набор объектов служб.</span><span class="sxs-lookup"><span data-stu-id="991f7-111">To expose the music player as a UPnP-based device, a device control object and a set of service objects are required.</span></span> <span data-ttu-id="991f7-112">Эти объекты реализуют действия музыкального проигрывателя на основе UPnP в качестве последовательных команд.</span><span class="sxs-lookup"><span data-stu-id="991f7-112">These objects implement the UPnP-based music player actions as serial commands.</span></span> <span data-ttu-id="991f7-113">Однако проигрыватель музыки должен быть подключен к последовательному порту и доступен для управления перед регистрацией этих объектов.</span><span class="sxs-lookup"><span data-stu-id="991f7-113">However, the music player must be plugged into the serial port and available for control before these objects are registered.</span></span>

<span data-ttu-id="991f7-114">Так как последовательный порт не предоставляет явный механизм уведомления при подключении устройств, требуется опрашивающий код.</span><span class="sxs-lookup"><span data-stu-id="991f7-114">Because the serial port does not offer an explicit notification mechanism when devices are connected, polling code is required.</span></span> <span data-ttu-id="991f7-115">Этот код может быть реализован в объекте поставщика устройства, в службе или в автономном приложении.</span><span class="sxs-lookup"><span data-stu-id="991f7-115">This code can be implemented in a device provider object, a service, or in a standalone application.</span></span> <span data-ttu-id="991f7-116">При запуске компьютера узел устройства создает экземпляр объекта поставщика устройства, а затем вызывает его метод [**Start**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpdeviceprovider-start) .</span><span class="sxs-lookup"><span data-stu-id="991f7-116">When the computer is started, the device host instantiates the device provider object, and then invokes its [**Start**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpdeviceprovider-start) method.</span></span> <span data-ttu-id="991f7-117">Когда поставщик устройства обнаруживает наличие устройства воспроизведения музыки, он создает экземпляр соответствующего объекта управления устройством и регистрирует его, вызывая [**иупнпрегистрар:: регистерруннингдевице**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpregistrar-registerrunningdevice).</span><span class="sxs-lookup"><span data-stu-id="991f7-117">When the device provider detects the presence of a music player device, it instantiates the appropriate device control object and registers it by calling [**IUPnPRegistrar::RegisterRunningDevice**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpregistrar-registerrunningdevice).</span></span> <span data-ttu-id="991f7-118">Этот метод публикует устройство и объявляет его сети на основе UPnP.</span><span class="sxs-lookup"><span data-stu-id="991f7-118">This method publishes the device and announces it to the UPnP-based network.</span></span>

<span data-ttu-id="991f7-119">Те же функциональные возможности можно реализовать с помощью службы, которая опрашивает последовательный порт.</span><span class="sxs-lookup"><span data-stu-id="991f7-119">The same functionality can also be achieved by implementing a service that polls the serial port.</span></span> <span data-ttu-id="991f7-120">Тем не менее поставщики устройств упрощают работу, так как для запуска и завершения работы поставщики устройств используют только основные функциональные возможности (опрос).</span><span class="sxs-lookup"><span data-stu-id="991f7-120">However, device providers simplify things by requiring only the core functionality—the polling—to be implemented because device providers rely on the device host to start and stop them.</span></span> <span data-ttu-id="991f7-121">Использование поставщиков устройств проще, чем реализация службы.</span><span class="sxs-lookup"><span data-stu-id="991f7-121">Using device providers is simpler than implementing a service.</span></span>

<span data-ttu-id="991f7-122">Во время регистрации и при каждом последующем запуске системы компьютер создает экземпляр объекта поставщика устройства, а затем вызывает метод [**иупнпдевицепровидер:: Start**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpdeviceprovider-start) , передавая ему строку инициализации, указанную во время регистрации.</span><span class="sxs-lookup"><span data-stu-id="991f7-122">At registration time, and on every subsequent system startup, the computer instantiates the device provider object, and then invokes its [**IUPnPDeviceProvider::Start**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpdeviceprovider-start) method, passing it the initialization string specified during registration.</span></span>

<span data-ttu-id="991f7-123">После вызова метода [**Start**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpdeviceprovider-start) поставщик устройства выполняет необходимую обработку, и при необходимости поставщик устройства регистрирует устройства путем вызова [**Иупнпрегистрар:: регистерруннингдевице**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpregistrar-registerrunningdevice), как описано в разделе [Регистрация размещенного устройства на узле устройства](registering-a-hosted-device-with-the-device-host.md).</span><span class="sxs-lookup"><span data-stu-id="991f7-123">Once the [**Start**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpdeviceprovider-start) method is called, the device provider performs any necessary processing, and when necessary, the device provider registers devices by calling [**IUPnPRegistrar::RegisterRunningDevice**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpregistrar-registerrunningdevice), as described in the section [Registering a Hosted Device with the Device Host](registering-a-hosted-device-with-the-device-host.md).</span></span>

<span data-ttu-id="991f7-124">Когда компьютер завершает работу, узел устройства вызывает метод [**иупнпдевицепровидер::**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpdeviceprovider-stop) Terminate, указывающий, что поставщик устройства прекращает работу.</span><span class="sxs-lookup"><span data-stu-id="991f7-124">When the computer is shut down, the device host invokes the [**IUPnPDeviceProvider::Stop**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpdeviceprovider-stop) method to indicate that the device provider terminate its operations.</span></span>

 

 