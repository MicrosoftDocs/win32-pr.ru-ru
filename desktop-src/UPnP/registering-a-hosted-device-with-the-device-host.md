---
title: Регистрация размещенного устройства на узле устройства
description: Регистрация размещенного устройства означает предоставление узлу устройства описания устройства и его объекта управления устройствами.
ms.assetid: 1d85b412-9b1b-415d-8664-8d96a6644793
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c4a607af4f6ada359a9ee32e98e416d8271fd502
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104253195"
---
# <a name="registering-a-hosted-device-with-the-device-host"></a><span data-ttu-id="13a2d-103">Регистрация размещенного устройства на узле устройства</span><span class="sxs-lookup"><span data-stu-id="13a2d-103">Registering a Hosted Device With the Device Host</span></span>

<span data-ttu-id="13a2d-104">Регистрация размещенного устройства означает предоставление узлу устройства описания устройства и его объекта управления устройствами.</span><span class="sxs-lookup"><span data-stu-id="13a2d-104">Registering a hosted device means providing the device host with the device description and its device control object.</span></span> <span data-ttu-id="13a2d-105">Затем узел устройства формирует полное описание UPnP-устройства, публикует его и объявляет об устройстве в сети с помощью протокола обнаружения UPnP.</span><span class="sxs-lookup"><span data-stu-id="13a2d-105">The device host then constructs a complete UPnP device description, publishes it, and announces the device on the network using the UPnP discovery protocol.</span></span> <span data-ttu-id="13a2d-106">После публикации устройство становится доступным для контрольных точек.</span><span class="sxs-lookup"><span data-stu-id="13a2d-106">Once a device is published, it is available to control points.</span></span>

<span data-ttu-id="13a2d-107">Устройства регистрируются двумя способами:</span><span class="sxs-lookup"><span data-stu-id="13a2d-107">Devices are registered in two ways:</span></span>

-   <span data-ttu-id="13a2d-108">Приложение создает экземпляр объекта управления устройством и передает на него указатель на узел устройства.</span><span class="sxs-lookup"><span data-stu-id="13a2d-108">An application creates an instance of the device control object and passes a pointer to it to the device host.</span></span>
-   <span data-ttu-id="13a2d-109">Приложение передает идентификатор ProgID для зарегистрированного объекта управления устройством на узел устройства.</span><span class="sxs-lookup"><span data-stu-id="13a2d-109">The application passes the ProgID for a registered device control object to the device host.</span></span> <span data-ttu-id="13a2d-110">Узел устройства создает его, когда узел устройства получает первый запрос для устройства.</span><span class="sxs-lookup"><span data-stu-id="13a2d-110">The device host instantiates it when the device host receives the first request for the device.</span></span>

<span data-ttu-id="13a2d-111">Независимо от того, какой метод используется, узел устройства публикует и уведомляет устройство сразу после регистрации.</span><span class="sxs-lookup"><span data-stu-id="13a2d-111">Regardless of which method is used, the device host publishes and announces the device as soon as it is registered.</span></span> <span data-ttu-id="13a2d-112">Разница между двумя подходами связана с тем, что при загрузке кода устройства.</span><span class="sxs-lookup"><span data-stu-id="13a2d-112">The difference between the two approaches has to do with when the device code is loaded.</span></span> <span data-ttu-id="13a2d-113">Когда приложение передает указатель на объект управления устройством, код устройства загружается и выполняется во время регистрации.</span><span class="sxs-lookup"><span data-stu-id="13a2d-113">When the application passes in a pointer to the device control object, the device code is loaded and running at the time of registration.</span></span> <span data-ttu-id="13a2d-114">Когда приложение передает идентификатор ProgID, код устройства загружается только при вызове действия, запросе свойства или получении запроса на подписку на событие.</span><span class="sxs-lookup"><span data-stu-id="13a2d-114">When the application passes a ProgID, the device code is only loaded when an action is invoked, a property is queried, or an event subscription request arrives.</span></span> <span data-ttu-id="13a2d-115">Второй подход немного более эффективен.</span><span class="sxs-lookup"><span data-stu-id="13a2d-115">The second approach is slightly more efficient.</span></span> <span data-ttu-id="13a2d-116">Однако он не подходит для устройств, которые должны быть установлены до появления любых запросов на управление или подписки на события, поскольку при таком подходе объекты управления устройствами создаются только тогда, когда они необходимы.</span><span class="sxs-lookup"><span data-stu-id="13a2d-116">However, it is not suitable for devices that must be running before any control or event subscription requests arrive, because using this approach, device control objects are only created when they are needed.</span></span> <span data-ttu-id="13a2d-117">Этот второй метод также может создавать проблемы с производительностью при получении первого запроса для типа устройства.</span><span class="sxs-lookup"><span data-stu-id="13a2d-117">This second method can also create performance issues when it receives the first request for a device type.</span></span>

<span data-ttu-id="13a2d-118">Если необходимо обеспечить автоматическое объявление устройства узлом устройства в сети при запуске компьютера, вызовите [**иупнпрегистрар:: RegisterDevice**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpregistrar-registerdevice).</span><span class="sxs-lookup"><span data-stu-id="13a2d-118">If you want to ensure that a device is announced by the device host on the network automatically when the computer is started, invoke [**IUPnPRegistrar::RegisterDevice**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpregistrar-registerdevice).</span></span> <span data-ttu-id="13a2d-119">**RegisterDevice** гарантирует, что код устройства будет загружен только при получении запроса на управление или на подписку на события.</span><span class="sxs-lookup"><span data-stu-id="13a2d-119">**RegisterDevice** ensures that your device code is only loaded when a control or event subscription request is received.</span></span>

<span data-ttu-id="13a2d-120">Если устройства являются временными или мостами, вызовите [**иупнпрегистрар:: регистерруннингдевице**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpregistrar-registerrunningdevice), и устройство не будет автоматически повторно объявлено при перезапуске компьютера.</span><span class="sxs-lookup"><span data-stu-id="13a2d-120">If your devices are transient or bridged, invoke [**IUPnPRegistrar::RegisterRunningDevice**](/windows/desktop/api/Upnphost/nf-upnphost-iupnpregistrar-registerrunningdevice), and the device is not automatically re-advertised when the computer is restarted.</span></span>

## <a name="discovery-announcement-lifetime"></a><span data-ttu-id="13a2d-121">Время существования объявления обнаружения</span><span class="sxs-lookup"><span data-stu-id="13a2d-121">Discovery Announcement Lifetime</span></span>

<span data-ttu-id="13a2d-122">Каждое устройство, зарегистрированное на узле устройства, связано со временем существования, которое задается устройством при регистрации.</span><span class="sxs-lookup"><span data-stu-id="13a2d-122">Each device registered with the device host is associated with a lifetime, which is specified by the device upon registration.</span></span> <span data-ttu-id="13a2d-123">Время существования устройства — это период времени, в течение которого объявления для обнаружения устройства являются действительными.</span><span class="sxs-lookup"><span data-stu-id="13a2d-123">The lifetime of the device is the period of time for which the device's discovery announcements are valid.</span></span> <span data-ttu-id="13a2d-124">Время существования передается в контрольную точку в виде заголовка в объявлении первоначального обнаружения.</span><span class="sxs-lookup"><span data-stu-id="13a2d-124">The lifetime is passed to the control point as a header in the initial discovery announcement.</span></span> <span data-ttu-id="13a2d-125">Узел устройства автоматически обновляет объявление до истечения срока действия.</span><span class="sxs-lookup"><span data-stu-id="13a2d-125">The device host automatically refreshes the announcement prior to the expiration time.</span></span> <span data-ttu-id="13a2d-126">Значения времени жизни объявления обнаружения должны составлять не более 15 минут (значение по умолчанию — 30 минут).</span><span class="sxs-lookup"><span data-stu-id="13a2d-126">The values of the discovery announcement lifetime should be 15 minutes or more (the default is 30 minutes).</span></span>

## <a name="device-identifiers-created-at-registration"></a><span data-ttu-id="13a2d-127">Идентификаторы устройств, созданные при регистрации</span><span class="sxs-lookup"><span data-stu-id="13a2d-127">Device Identifiers Created at Registration</span></span>

<span data-ttu-id="13a2d-128">При создании шаблона описания устройства разработчик устройства должен указать путь к ресурсу для описания службы и связанных значков.</span><span class="sxs-lookup"><span data-stu-id="13a2d-128">When creating a device description template, the device developer must provide the resource path to the service description and associated icons.</span></span> <span data-ttu-id="13a2d-129">Путь к ресурсу определяется приложением устройства.</span><span class="sxs-lookup"><span data-stu-id="13a2d-129">The resource path is determined by the device application.</span></span>

<span data-ttu-id="13a2d-130">Так как одно и то же устройство может быть зарегистрировано несколько раз на одном компьютере, УДН, указанный в шаблоне описания устройства, недостаточно для уникальной идентификации устройства.</span><span class="sxs-lookup"><span data-stu-id="13a2d-130">Since the same device can be registered multiple times on the same computer, the UDN specified in the device description template is not sufficient to uniquely identify a device.</span></span> <span data-ttu-id="13a2d-131">Поэтому при регистрации устройства узел устройства создает идентификатор устройства.</span><span class="sxs-lookup"><span data-stu-id="13a2d-131">Therefore, when a device is registered, the device host creates a device identifier.</span></span> <span data-ttu-id="13a2d-132">Этот идентификатор устройства в связи с УДН в шаблоне описания устройства может использоваться для уникальной идентификации устройства.</span><span class="sxs-lookup"><span data-stu-id="13a2d-132">This device identifier, in association with the UDN in the device description template, can be used to uniquely identify a device.</span></span>

<span data-ttu-id="13a2d-133">Этот идентификатор также используется при временной отмене регистрации устройства и повторной регистрации.</span><span class="sxs-lookup"><span data-stu-id="13a2d-133">This identifier is also used when the device is temporarily unregistered and then re-registered.</span></span> <span data-ttu-id="13a2d-134">При временном отмене регистрации устройства узел устройства не удаляет УДН.</span><span class="sxs-lookup"><span data-stu-id="13a2d-134">When a device is unregistered temporarily, the device host does not delete the UDN.</span></span> <span data-ttu-id="13a2d-135">Ниже перечислены причины, по которым не следует удалять УДН:</span><span class="sxs-lookup"><span data-stu-id="13a2d-135">Reasons for not deleting the UDN include:</span></span>

-   <span data-ttu-id="13a2d-136">Выполняется обновление устройства.</span><span class="sxs-lookup"><span data-stu-id="13a2d-136">The device is being upgraded.</span></span>
-   <span data-ttu-id="13a2d-137">Вы изменяете свойства устройства.</span><span class="sxs-lookup"><span data-stu-id="13a2d-137">You are changing the properties of the device.</span></span>
-   <span data-ttu-id="13a2d-138">Служба временно недоступна.</span><span class="sxs-lookup"><span data-stu-id="13a2d-138">A service is temporarily unavailable.</span></span>
-   <span data-ttu-id="13a2d-139">Вы добавляете новую службу на устройство.</span><span class="sxs-lookup"><span data-stu-id="13a2d-139">You are adding a new service to a device.</span></span>
-   <span data-ttu-id="13a2d-140">Вы обновляете библиотеку DLL.</span><span class="sxs-lookup"><span data-stu-id="13a2d-140">You are updating the DLL.</span></span>
-   <span data-ttu-id="13a2d-141">Устройство находится в режиме ожидания.</span><span class="sxs-lookup"><span data-stu-id="13a2d-141">The device is in stand-by mode.</span></span>

<span data-ttu-id="13a2d-142">Дополнительные сведения о регистрации см. в следующих разделах:</span><span class="sxs-lookup"><span data-stu-id="13a2d-142">Refer to the following sections for further information on registration:</span></span>

-   [<span data-ttu-id="13a2d-143">Как зарегистрировать устройство с помощью узла устройства</span><span class="sxs-lookup"><span data-stu-id="13a2d-143">How to Register a Device with the Device Host</span></span>](how-to-register-a-device-with-the-device-host.md)
-   [<span data-ttu-id="13a2d-144">Отмена регистрации устройства</span><span class="sxs-lookup"><span data-stu-id="13a2d-144">Unregistering a Device</span></span>](unregistering-a-device.md)
-   [<span data-ttu-id="13a2d-145">**Иупнпрегистрар:: Унрегистердевице**</span><span class="sxs-lookup"><span data-stu-id="13a2d-145">**IUPnPRegistrar::UnregisterDevice**</span></span>](/windows/desktop/api/Upnphost/nf-upnphost-iupnpregistrar-unregisterdevice)
-   [<span data-ttu-id="13a2d-146">**иупнпререгистрар**</span><span class="sxs-lookup"><span data-stu-id="13a2d-146">**IUPnPReregistrar**</span></span>](/windows/desktop/api/Upnphost/nn-upnphost-iupnpreregistrar)

 

 




