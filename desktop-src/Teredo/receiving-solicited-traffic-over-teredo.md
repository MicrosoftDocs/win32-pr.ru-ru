---
title: Получение запрошенного трафика через Teredo
description: Многие приложения, такие как Microsoft Internet Explorer и Microsoft Outlook, инициируют только подключения к Интернету.
ms.assetid: bff5d65e-050d-4b09-9982-8024612ffa6e
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 035d067afeb9c62795efb5acd0bb28adc3afcb16
ms.sourcegitcommit: 773fa6257ead6c74154ad3cf46d21e49adc900aa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/09/2020
ms.locfileid: "104533563"
---
# <a name="receiving-solicited-traffic-over-teredo"></a><span data-ttu-id="eb610-103">Получение запрошенного трафика через Teredo</span><span class="sxs-lookup"><span data-stu-id="eb610-103">Receiving Solicited Traffic Over Teredo</span></span>

<span data-ttu-id="eb610-104">Многие приложения, такие как Microsoft Internet Explorer и Microsoft Outlook, инициируют только подключения к Интернету.</span><span class="sxs-lookup"><span data-stu-id="eb610-104">Many applications such as Microsoft Internet Explorer and Microsoft Outlook only initiate connections to the Internet.</span></span> <span data-ttu-id="eb610-105">Для этих приложений [Teredo](about-teredo.md) может обеспечить бесперебойное подключение по протоколу IPv6 в отсутствие других интерфейсов IPv6.</span><span class="sxs-lookup"><span data-stu-id="eb610-105">For these applications, [Teredo](about-teredo.md) can provide seamless connectivity over IPv6 in the absence of other IPv6 interfaces.</span></span> <span data-ttu-id="eb610-106">Кроме того, запрошенный трафик может быть получен через интерфейс Teredo на более ранних платформах Microsoft Windows XP с пакетом обновления 2 (SP2) и Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="eb610-106">Additionally, solicited traffic can be received over the Teredo Interface on the earlier Microsoft Windows XP with Service Pack 2 (SP2) and Windows Server 2003 platforms.</span></span>

<span data-ttu-id="eb610-107">В следующей документации объясняется, как эти приложения достигают подключения, и обстоятельства, при которых используется Teredo.</span><span class="sxs-lookup"><span data-stu-id="eb610-107">The following documentation explains how these applications achieve connectivity, and the circumstances under which Teredo is used.</span></span>

## <a name="obtaining-a-destination-address"></a><span data-ttu-id="eb610-108">Получение адреса назначения</span><span class="sxs-lookup"><span data-stu-id="eb610-108">Obtaining a Destination Address</span></span>

<span data-ttu-id="eb610-109">Приложение пытается получить адрес назначения с помощью различных методов, таких как система доменных имен (DNS) или протокол PNRP (Peer Name Resolution Protocol).</span><span class="sxs-lookup"><span data-stu-id="eb610-109">An application attempts to obtain the destination address using various methods such as Domain Name System (DNS) or Peer Name Resolution Protocol (PNRP).</span></span> <span data-ttu-id="eb610-110">Приложение может получить несколько IP-адресов IPv4 и IPv6 с помощью этих методов.</span><span class="sxs-lookup"><span data-stu-id="eb610-110">It is possible for the application to obtain multiple IPv4 and IPv6 IP addresses using these methods.</span></span> <span data-ttu-id="eb610-111">Типичные API, используемые для получения IP-адресов, включают в себя Windows XP API [**gethostbyname**](/windows/desktop/api/wsipv6ok/nf-wsipv6ok-gethostbyname) и новый [**функцию getaddrinfo**](/windows/desktop/api/ws2tcpip/nf-ws2tcpip-getaddrinfo)API Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="eb610-111">The typical APIs used to obtain IP addresses include the Windows XP API [**GetHostByName**](/windows/desktop/api/wsipv6ok/nf-wsipv6ok-gethostbyname) and the new Windows Vista API [**GetAddrInfo**](/windows/desktop/api/ws2tcpip/nf-ws2tcpip-getaddrinfo).</span></span> <span data-ttu-id="eb610-112">Например, использование API функцию getaddrinfo с параметром *\_ семейства AI* , установленным в AF \_ INET6, в качестве подсказки аддринфо/Protocol позволяет пользователю запрашивать DNS-серверы в определенном формате.</span><span class="sxs-lookup"><span data-stu-id="eb610-112">For example, using the GetAddrInfo API with the *ai\_family* parameter set to AF\_INET6 as the addrinfo/protocol hint allows the user to query DNS servers for IPv6 addresses specifically.</span></span> <span data-ttu-id="eb610-113">API [**днскуери**](/windows/desktop/api/windns/nf-windns-dnsquery_a) с типом DNS \_ \_ AAAA можно также использовать для запроса DNS-серверов для записей AAAA.</span><span class="sxs-lookup"><span data-stu-id="eb610-113">The [**DnsQuery**](/windows/desktop/api/windns/nf-windns-dnsquery_a) API with the type DNS\_TYPE\_AAAA can also be used to query the DNS servers for AAAA records.</span></span>

## <a name="establishing-a-connection"></a><span data-ttu-id="eb610-114">Установление подключения</span><span class="sxs-lookup"><span data-stu-id="eb610-114">Establishing a Connection</span></span>

<span data-ttu-id="eb610-115">Соединение, установленное с помощью Teredo, описывается как "неэффективное", так как оно обрабатывается как любое другое подключение IPv6.</span><span class="sxs-lookup"><span data-stu-id="eb610-115">A connection established with Teredo is described as 'seamless' because it is handled like any other IPv6 connection.</span></span> <span data-ttu-id="eb610-116">При программировании приложения не требуется особое внимание на возможность использования интерфейса Teredo.</span><span class="sxs-lookup"><span data-stu-id="eb610-116">The programming of an application does not require special consideration to be capable of utilizing the Teredo interface.</span></span> <span data-ttu-id="eb610-117">Если между интерфейсами Teredo установлено подключение, то маршрутизатор ретрансляции, стандартный интерфейс 6to4 и другие собственные интерфейсы, не требуется.</span><span class="sxs-lookup"><span data-stu-id="eb610-117">When a connection is established between Teredo interfaces, a relay router, typical of 6to4 and other native interfaces, is not required.</span></span> <span data-ttu-id="eb610-118">Однако Teredo разработан в качестве последней технологии перехода на IPv6-подключения.</span><span class="sxs-lookup"><span data-stu-id="eb610-118">However, Teredo is designed as a last resort transition technology for IPv6 connectivity.</span></span>

> [!Note]  
> <span data-ttu-id="eb610-119">Teredo не используется, если предоставленное имя узла разрешается только по IPv4-адресам.</span><span class="sxs-lookup"><span data-stu-id="eb610-119">Teredo is not utilized if the supplied hostname resolves to IPv4 addresses only.</span></span>

 

<span data-ttu-id="eb610-120">Когда приложение пытается подключиться к месту назначения с использованием IPv6-адресов, произойдет следующее:</span><span class="sxs-lookup"><span data-stu-id="eb610-120">When an application attempts to connect to a destination using IPv6 addresses, the following will occur:</span></span>

-   <span data-ttu-id="eb610-121">Приложение получает список IPv6-адресов, вызывая API [**жетадаптерсаддрессес**](/windows/desktop/api/iphlpapi/nf-iphlpapi-getadaptersaddresses) .</span><span class="sxs-lookup"><span data-stu-id="eb610-121">The application obtains a list of IPv6 addresses by calling the [**GetAdaptersAddresses**](/windows/desktop/api/iphlpapi/nf-iphlpapi-getadaptersaddresses) API.</span></span> <span data-ttu-id="eb610-122">Стек Windows Vista возвращает список всех интерфейсов на основе порядка сортировки, указанного в [RFC 3484](https://www.irt.org/rfc/rfc3484.htm).</span><span class="sxs-lookup"><span data-stu-id="eb610-122">The Windows Vista stack returns a list of all interfaces based on the sorting order specified in [RFC 3484](https://www.irt.org/rfc/rfc3484.htm).</span></span> <span data-ttu-id="eb610-123">В результате интерфейсы IPv6 и 6to4 будут перечислены перед интерфейсом Teredo.</span><span class="sxs-lookup"><span data-stu-id="eb610-123">As a result, IPv6 and 6to4 IPv6 interfaces will be listed before Teredo interface.</span></span> <span data-ttu-id="eb610-124">Однако если неуправляемое подключение по протоколу IPv6 или 6to4 недоступно, то в списке будет использоваться единственный интерфейс, поддерживающий IPv6.</span><span class="sxs-lookup"><span data-stu-id="eb610-124">However, when native IPv6 or 6to4 connectivity is not available, Teredo will be the only IPv6 capable interface listed.</span></span>

    <span data-ttu-id="eb610-125">Важно помнить, что приложение может использовать любой интерфейс, предоставляемый стеком Windows Vista, однако порядок, в котором возвращается список интерфейсов, чаще всего приводит к появлению последней попытки.</span><span class="sxs-lookup"><span data-stu-id="eb610-125">It is important to remember that an application can use any interface provided by the Windows Vista stack, however the ordering of the interface list returned will most often result in Teredo being attempted last.</span></span>

-   <span data-ttu-id="eb610-126">Перед тем как система Windows Vista попытается подключиться через интерфейс Teredo, операционная система гарантирует, что IPv6-адрес будет изменяться.</span><span class="sxs-lookup"><span data-stu-id="eb610-126">Before Windows Vista attempts a connection over the Teredo interface, the operating system ensures that the IPv6 address has stabilized.</span></span> <span data-ttu-id="eb610-127">Это делается автоматически для исходящих подключений и не является ключевым фактором для приложения.</span><span class="sxs-lookup"><span data-stu-id="eb610-127">This is done automatically for outgoing connections and is not a crucial consideration for an application.</span></span> <span data-ttu-id="eb610-128">В случае, если приложение должно гарантировать стабильность адресов, можно вызвать API [**нотифистаблеуникастипаддресстабле**](/windows/desktop/api/netioapi/nf-netioapi-notifystableunicastipaddresstable) , чтобы убедиться, что адрес Teredo является стабильным.</span><span class="sxs-lookup"><span data-stu-id="eb610-128">In the event the application is required to guarantee address stability, the [**NotifyStableUnicastIpAddressTable**](/windows/desktop/api/netioapi/nf-netioapi-notifystableunicastipaddresstable) API can be called to ensure that the Teredo address is stable.</span></span>

-   <span data-ttu-id="eb610-129">Интерфейс Teredo будет пытаться подключиться к другому интерфейсу Teredo в месте назначения.</span><span class="sxs-lookup"><span data-stu-id="eb610-129">A Teredo interface will attempt to connect to another Teredo interface at the destination.</span></span> <span data-ttu-id="eb610-130">Если интерфейс Teredo отсутствует, подключение устанавливается с адресом назначения машинного кода или 6to4 через ретранслятор, относящийся к конкретному узлу.</span><span class="sxs-lookup"><span data-stu-id="eb610-130">If a Teredo interface is not present, a connection is established with a native or 6to4 destination address through a host-specific relay.</span></span>

<span data-ttu-id="eb610-131">Кроме того, приложения, которые инициируют подключения к Интернету, могут получить незапрошенный трафик.</span><span class="sxs-lookup"><span data-stu-id="eb610-131">It is also possible for applications that initiate connections to the Internet to receive unsolicited traffic.</span></span> <span data-ttu-id="eb610-132">Дополнительные сведения см. в статье [получение незапрошенного трафика через Teredo](receiving-unsolicited-traffic-over-teredo.md).</span><span class="sxs-lookup"><span data-stu-id="eb610-132">For more details see [Receiving Unsolicited Traffic Over Teredo](receiving-unsolicited-traffic-over-teredo.md).</span></span>

## <a name="using-the-wsaconnectbyname-api"></a><span data-ttu-id="eb610-133">Использование API WSAConnectByName</span><span class="sxs-lookup"><span data-stu-id="eb610-133">Using the WSAConnectByName API</span></span>

<span data-ttu-id="eb610-134">Вызывая API WSAConnectByName, приложение может подключиться к конечному имени вместо указания точного IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="eb610-134">By calling the WSAConnectByName API, it is possible for an application to connect to a destination name instead of specifying the exact IP address.</span></span> <span data-ttu-id="eb610-135">Стек Windows Vista предпочитает IPv6 по протоколу IPv4, и в результате все попытки подключения к IPv6-адресам будут выполняться первыми.</span><span class="sxs-lookup"><span data-stu-id="eb610-135">The Windows Vista stack prefers IPv6 over IPv4, and as a result any connection attempts will be made to IPv6 addresses first.</span></span>

<span data-ttu-id="eb610-136">Вызов API WSAConnectByName сортирует все целевые IP-адреса, полученные в следующем порядке:</span><span class="sxs-lookup"><span data-stu-id="eb610-136">Calling the WSAConnectByName API will sort all destination IP addresses obtained in the following order:</span></span>

-   <span data-ttu-id="eb610-137">Собственный IPv6-адрес</span><span class="sxs-lookup"><span data-stu-id="eb610-137">Native IPv6 address</span></span>
-   <span data-ttu-id="eb610-138">IP-адрес 6to4</span><span class="sxs-lookup"><span data-stu-id="eb610-138">6to4 IP address</span></span>
-   <span data-ttu-id="eb610-139">IPv4-адрес</span><span class="sxs-lookup"><span data-stu-id="eb610-139">IPv4 address</span></span>
-   <span data-ttu-id="eb610-140">Адрес Teredo</span><span class="sxs-lookup"><span data-stu-id="eb610-140">Teredo address</span></span>

<span data-ttu-id="eb610-141">После того как адреса назначения сортируются внутри, выполняется попытка подключения к назначению на основе лучшего маршрута, доступного на локальном узле для адреса назначения.</span><span class="sxs-lookup"><span data-stu-id="eb610-141">After the destination addresses are sorted internally, a connection to the destination is attempted based on the best route available on the local host for the destination address.</span></span> <span data-ttu-id="eb610-142">Как указано в порядке отсортированных адресов, если имя назначения разрешается в адрес IPv4 и Teredo, для установления соединения будет использоваться IPv4-адрес.</span><span class="sxs-lookup"><span data-stu-id="eb610-142">As indicated by the order of the sorted addresses, if the destination name resolves to a IPv4 and Teredo address, the IPv4 address will be used to establish the connection.</span></span>

<span data-ttu-id="eb610-143">API WSAConnectByName работает внутренне для поиска наилучшего соответствия между адресами.</span><span class="sxs-lookup"><span data-stu-id="eb610-143">The WSAConnectByName API works internally to find the best match between addresses.</span></span> <span data-ttu-id="eb610-144">Эта попыток основана на маршрутах, доступных на локальном узле и в адресах назначения.</span><span class="sxs-lookup"><span data-stu-id="eb610-144">This attempt is based on the routes available on the local host and the destination addresses.</span></span>

<span data-ttu-id="eb610-145">Из-за текущего отсутствия ретрансляторов Teredo в Интернете подключения к собственным IPv6-адресам вряд ли будут выполняться через интерфейс Teredo.</span><span class="sxs-lookup"><span data-stu-id="eb610-145">Due to current absence of Teredo relays on the Internet, connections to native IPv6 addresses are unlikely to succeed over the Teredo interface.</span></span> <span data-ttu-id="eb610-146">При вызове WSAConnectByName Windows Vista не будет выдавать запросы AAAA, если Teredo является единственным доступным интерфейсом с поддержкой IPv6.</span><span class="sxs-lookup"><span data-stu-id="eb610-146">If WSAConnectByName is called, Windows Vista will not issue AAAA queries when Teredo is the only IPv6 capable interface available.</span></span> <span data-ttu-id="eb610-147">Это гарантирует, что собственные IPv6-адреса не будут получены в качестве назначения и что попытки подключения попытаются по протоколу IPv4, что дает наибольшую вероятность успеха.</span><span class="sxs-lookup"><span data-stu-id="eb610-147">This ensures that native IPv6 addresses are not obtained as a destination and that connections are attempted over IPv4, which has the highest chance of success.</span></span> <span data-ttu-id="eb610-148">Чтобы получить IPv6-адреса, когда Teredo является единственным интерфейсом, поддерживающим IPv6, приложение должно явно использовать API Днскуери для записей AAAA.</span><span class="sxs-lookup"><span data-stu-id="eb610-148">In order to obtain IPv6 addresses when Teredo is the only IPv6 capable interface, an application must explicitly use the DnsQuery API for AAAA records.</span></span>

 

 