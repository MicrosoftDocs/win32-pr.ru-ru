---
description: При использовании нескольких окон просмотра тестингдетерминес на то, какие окна просмотра зависят от вводимых пользователем данных, занимая положение контакта на экране и определяя, какой прямоугольник окна просмотра обращается к контактам.
ms.assetid: 960EF92D-F439-4A84-AAF9-1469E2830573
title: Использование нескольких окон просмотра в Директманипулатион
ms.topic: article
ms.date: 02/03/2020
ms.openlocfilehash: 627a97a7c9563ca0af9decf79b18340343dda345
ms.sourcegitcommit: 3d718d8f69d3f86eaecf94c5705d761c5a9ef4a1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/20/2020
ms.locfileid: "104552175"
---
# <a name="using-multiple-viewports-in-directmanipulation"></a><span data-ttu-id="a9e63-103">Использование нескольких окон просмотра в Директманипулатион</span><span class="sxs-lookup"><span data-stu-id="a9e63-103">Using multiple viewports in DirectManipulation</span></span>

<span data-ttu-id="a9e63-104">При использовании нескольких окон просмотра Проверка *попадания* определяет, какие окна просмотра зависят от вводимых пользователем данных, путем получения расположения на экране контакта и определения того, какой прямоугольник окна просмотра обращается к контактам.</span><span class="sxs-lookup"><span data-stu-id="a9e63-104">When using multiple viewports, *Hit testing* determines which viewport(s) are affected by user input by taking the screen location of a contact and determining which viewport rectangle the contact hits.</span></span>

<span data-ttu-id="a9e63-105">Распространенным сценарием в [непосредственной манипуляции](direct-manipulation-portal.md) является размещение одного окна просмотра внутри другого, также известного как *вложенные окна просмотра*.</span><span class="sxs-lookup"><span data-stu-id="a9e63-105">A common scenario in [Direct Manipulation](direct-manipulation-portal.md) is to place one viewport inside another, also known as *nesting viewports*.</span></span> <span data-ttu-id="a9e63-106">Если контакт обращается более чем к одному окну просмотра, порядок вызовов  [**сетконтакт**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) в окне [*WndProc*](/previous-versions/windows/desktop/legacy/ms644975(v=vs.85)) определяет связь типа «родители-потомки» вложенных окон просмотра.</span><span class="sxs-lookup"><span data-stu-id="a9e63-106">If the contact hits more than one viewport, the order of  [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) calls by the window's [*WndProc*](/previous-versions/windows/desktop/legacy/ms644975(v=vs.85)) determines the parent-child relationship of the nested viewports.</span></span>

<span data-ttu-id="a9e63-107">Правило: дочерний элемент должен вызвать [**сетконтакт**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact)перед вызовом родителя.</span><span class="sxs-lookup"><span data-stu-id="a9e63-107">Rule: The child element should call [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact)before calling the parent.</span></span>

![Схема, показывающая иерархии проверки попадания](images/dm-art-8.png)

<span data-ttu-id="a9e63-109">Контакт появляется в окне просмотра.</span><span class="sxs-lookup"><span data-stu-id="a9e63-109">A contact comes down in a viewport.</span></span> <span data-ttu-id="a9e63-110">Сначала необходимо вызвать [**сетконтакт**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) для оранжевого (дочернего) окна просмотра, а затем выбрать зеленое (родительское) окно просмотра, чтобы установить правильную иерархию.</span><span class="sxs-lookup"><span data-stu-id="a9e63-110">[**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) should first be called on the orange (child) viewport and then the green (parent) viewport to establish the correct hierarchy.</span></span>

## <a name="targeting-the-correct-viewport"></a><span data-ttu-id="a9e63-111">Выбор правильного окна просмотра</span><span class="sxs-lookup"><span data-stu-id="a9e63-111">Targeting the correct viewport</span></span>

<span data-ttu-id="a9e63-112">Контакт может быть связан с любым количеством окна просмотра, и каждый контакт может быть назначен другому набору окна просмотра.</span><span class="sxs-lookup"><span data-stu-id="a9e63-112">A contact can be associated with any number of viewports and each contact can be assigned to a different set of viewports.</span></span>

<span data-ttu-id="a9e63-113">Каждое окно просмотра можно настроить для поддержки конкретных взаимодействий по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="a9e63-113">Each viewport can be configured to support specific interactions, as required.</span></span>

<span data-ttu-id="a9e63-114">На основе этих параметров [Direct манипуляция](direct-manipulation-portal.md) определяет, какое окно просмотра обрабатывает входные данные.</span><span class="sxs-lookup"><span data-stu-id="a9e63-114">Based on these settings, [Direct Manipulation](direct-manipulation-portal.md) identifies which viewport handles the input.</span></span> <span data-ttu-id="a9e63-115">Дочернее окно просмотра в иерархии проверки попадания имеет первую шанс обработки входных данных.</span><span class="sxs-lookup"><span data-stu-id="a9e63-115">The child-most viewport in the hit testing hierarchy has the first chance to handle the input.</span></span> <span data-ttu-id="a9e63-116">Однако как цепочка, так и родительское повышение могут изменить то, какое окно просмотра обрабатывает входные данные.</span><span class="sxs-lookup"><span data-stu-id="a9e63-116">However, both chaining and parent promotion can change which viewport handles the input.</span></span>

## <a name="chaining"></a><span data-ttu-id="a9e63-117">Построение цепочек</span><span class="sxs-lookup"><span data-stu-id="a9e63-117">Chaining</span></span>

<span data-ttu-id="a9e63-118">Когда конец содержимого достигается во время манипуляции, [Непосредственная манипуляция](direct-manipulation-portal.md) применяет границу, чтобы показать, что содержимое не может быть дальше.</span><span class="sxs-lookup"><span data-stu-id="a9e63-118">When the end of the content is reached during a manipulation, [Direct Manipulation](direct-manipulation-portal.md) applies a boundary effect to indicate that the content can go no further.</span></span> <span data-ttu-id="a9e63-119">Однако, если дочернее окно просмотра помещается в *цепочку* к родительскому области просмотра, этот результат подавляется.</span><span class="sxs-lookup"><span data-stu-id="a9e63-119">However, if a child viewport is *chained* to a parent viewport, this effect is suppressed.</span></span> <span data-ttu-id="a9e63-120">Вместо этого ближайшее окно просмотра предка в иерархии проверки попадания, которое поддерживает манипуляцию, обрабатывает входные данные.</span><span class="sxs-lookup"><span data-stu-id="a9e63-120">Instead, the closest ancestor viewport in the hit testing hierarchy that supports the manipulation, handles the input.</span></span> <span data-ttu-id="a9e63-121">Если направление манипуляции отменяется таким, что предок возвращается к точке, в которой была активирована цепочка, то манипуляции "разцепочки" и управления передаются обратно в дочернее окно просмотра.</span><span class="sxs-lookup"><span data-stu-id="a9e63-121">If the direction of the manipulation is reversed such that the ancestor returns to the point where chaining was triggered, the manipulation "unchains" and control transfers back to the child viewport.</span></span>

![Диаграмма, показывающая связанные манипуляции](images/dm-art-9.png)

<span data-ttu-id="a9e63-123">Когда пользователь переменяет дочернее окно просмотра на границу содержимого, управление цепочкой привязывается к родительскому области просмотра, а пользователь начинает панорамирование родительского содержимого.</span><span class="sxs-lookup"><span data-stu-id="a9e63-123">When the user pans the child viewport all the way to the edge of the content, the manipulation "chains" to the parent viewport, and the user begins panning the parent content instead.</span></span>

> [!Note]  
> <span data-ttu-id="a9e63-124">Цепочка осей X и Y независимо друг от друга, поэтому, если диагональный сдвиг достигает границы x до границы y, манипуляция перемещает родительский объект в направлении x, продолжая перемещать дочерний элемент в направлении y.</span><span class="sxs-lookup"><span data-stu-id="a9e63-124">The X and Y axes chain independently of one another, so if a diagonal pan hits the x boundary before the y boundary, the manipulation moves the parent in the x direction while continuing to move the child in the y direction.</span></span> <span data-ttu-id="a9e63-125">Чтобы включить или отключить цепочку, вызовите API [**сетчаининг**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setchaining) в дочернем окне просмотра.</span><span class="sxs-lookup"><span data-stu-id="a9e63-125">To enable or disable chaining, call the [**SetChaining**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setchaining) API on the child viewport.</span></span>

### <a name="rails"></a><span data-ttu-id="a9e63-126">Rails</span><span class="sxs-lookup"><span data-stu-id="a9e63-126">Rails</span></span>

<span data-ttu-id="a9e63-127">Указание границ в конфигурации окна просмотра влияет на способ сцепления входных данных из окна просмотра.</span><span class="sxs-lookup"><span data-stu-id="a9e63-127">Specifying rails in a viewport’s configuration affects the way input is chained from the viewport.</span></span> <span data-ttu-id="a9e63-128">В частности, входные данные не могут быть связаны с привязанным дочерним окном просмотра к его родителю в режиме панорамирования "не привязано".</span><span class="sxs-lookup"><span data-stu-id="a9e63-128">Specifically, input cannot chain from a railed child viewport to its parent in the “unrailed” panning mode of rails.</span></span> <span data-ttu-id="a9e63-129">Чтобы создать цепочку входов, когда задаются границы, пользователь должен иметь сдвигаемых вертикально или горизонтально и быть заблокированным для границ.</span><span class="sxs-lookup"><span data-stu-id="a9e63-129">To chain input when rails are set, the user must have panned vertically or horizontally and be locked to the rails.</span></span>

### <a name="zooming"></a><span data-ttu-id="a9e63-130">изменение масштаба;</span><span class="sxs-lookup"><span data-stu-id="a9e63-130">Zooming</span></span>

<span data-ttu-id="a9e63-131">Если дочернее окно просмотра вложено в родительский объект и оба настроены для масштабирования, то операция масштабирования может быть связана от дочернего объекта к родительскому.</span><span class="sxs-lookup"><span data-stu-id="a9e63-131">If a child viewport is nested inside a parent, and both are configured for zoom, a zoom manipulation can chain from child to parent.</span></span> <span data-ttu-id="a9e63-132">Однако если операция продолжится, она будет работать только в родительском элементе и не может "развязать" к дочернему элементу.</span><span class="sxs-lookup"><span data-stu-id="a9e63-132">However, if the manipulation continues, it works only on the parent and cannot “unchain” to the child.</span></span> <span data-ttu-id="a9e63-133">Если пользователь привязывает масштаб от дочернего объекта к родительскому, [прямое управление](direct-manipulation-portal.md) приостанавливает дочерний объект до тех пор, пока все контакты, связанные с манипуляцией, не будут удалены с экрана.</span><span class="sxs-lookup"><span data-stu-id="a9e63-133">If the user chains a zoom from child to parent, [Direct Manipulation](direct-manipulation-portal.md) suspends the child until all contacts associated with the manipulation are removed from the screen.</span></span> <span data-ttu-id="a9e63-134">На этом этапе дочерний элемент освобождается от приостановки и пользователь может сдвигать дочернее окно просмотра.</span><span class="sxs-lookup"><span data-stu-id="a9e63-134">At this point, the child is released from suspension and the user can pan the child viewport.</span></span>

## <a name="gesture-targeting-parent-promotion"></a><span data-ttu-id="a9e63-135">Нацеленность на жесты: родительская акция</span><span class="sxs-lookup"><span data-stu-id="a9e63-135">Gesture targeting: Parent promotion</span></span>

<span data-ttu-id="a9e63-136">*Нацеливание на жесты* — это процесс, с помощью которого [прямые манипуляции](direct-manipulation-portal.md) группируют контакты и определяют, какое окно просмотра обрабатывает входные данные.</span><span class="sxs-lookup"><span data-stu-id="a9e63-136">*Gesture targeting* is the process by which [Direct Manipulation](direct-manipulation-portal.md) groups contacts together and determines which viewport processes the input.</span></span> <span data-ttu-id="a9e63-137">*Родительское повышение* относится к случаям, когда входные данные передаются из дочернего элемента в родительский.</span><span class="sxs-lookup"><span data-stu-id="a9e63-137">*Parent promotion* refers to cases where the input is transferred from the child to the parent.</span></span> <span data-ttu-id="a9e63-138">Например, когда пользователь наводит два контакта и сжатие в пределах дочернего окна просмотра, настроенного только для прокрутки, входные данные помещаются в родительский объект, что позволяет увеличить масштаб.</span><span class="sxs-lookup"><span data-stu-id="a9e63-138">For example, when a user puts down two contacts and pinches within a child viewport configured only for scrolling, the input is promoted to the parent so that zooming occurs.</span></span> <span data-ttu-id="a9e63-139">Родительское продвижение происходит независимо от того, включена ли цепочка в дочернем окне просмотра.</span><span class="sxs-lookup"><span data-stu-id="a9e63-139">Parent promotion occurs regardless of whether chaining is enabled on the child viewport.</span></span>

<span data-ttu-id="a9e63-140">В отличие от цепочек, родительское продвижение не является обратным.</span><span class="sxs-lookup"><span data-stu-id="a9e63-140">Unlike chaining, parent promotion is not reversed.</span></span> <span data-ttu-id="a9e63-141">Родительское окно просмотра продолжит обрабатывать входные данные взаимодействия до тех пор, пока все контакты не будут ликвидированы (дочерние окна просмотра не прекращают обрабатывать входные данные).</span><span class="sxs-lookup"><span data-stu-id="a9e63-141">The parent viewport continues to process the interaction input until all contacts are lifted (child viewports stop processing the input).</span></span>
