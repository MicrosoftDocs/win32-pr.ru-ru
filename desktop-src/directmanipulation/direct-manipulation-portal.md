---
description: Интерфейсы API прямого управления позволяют создавать удобные возможности панорамирования, масштабирования и перетаскивания. Для этого он обрабатывает сенсорный ввод в области или объекте, создает преобразования вывода и применяет преобразования к элементам пользовательского интерфейса.
ms.assetid: 26358bc5-71e9-40f0-9243-9bddd961a0e5
title: Непосредственная манипуляция
ms.topic: article
ms.date: 02/03/2020
ms.openlocfilehash: 6db2a50893914dfb25050768f88cb289a1ecf3ea
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104139863"
---
# <a name="direct-manipulation"></a><span data-ttu-id="3bdb7-104">Непосредственная манипуляция</span><span class="sxs-lookup"><span data-stu-id="3bdb7-104">Direct Manipulation</span></span>

<span data-ttu-id="3bdb7-105">Интерфейсы API прямого управления позволяют создавать удобные возможности панорамирования, масштабирования и перетаскивания.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-105">The Direct Manipulation APIs let you create great pan, zoom, and drag user experiences.</span></span> <span data-ttu-id="3bdb7-106">Для этого он обрабатывает сенсорный ввод в области или объекте, создает преобразования вывода и применяет преобразования к элементам пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-106">To do this, it processes touch input on a region or object, generates output transforms, and applies the transforms to UI elements.</span></span> <span data-ttu-id="3bdb7-107">Прямую манипуляцию можно использовать для оптимизации скорости реагирования и сокращения задержки при обработке входных данных вне потока, необязательного тестирования нажатия входных данных вне потока, а также прогнозирования ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-107">You can use Direct Manipulation to optimize responsiveness and reduce latency through off-thread input processing, optional off-thread input hit testing, and input/output prediction.</span></span>

<span data-ttu-id="3bdb7-108">Любое приложение, использующее прямую манипуляцию с сенсорным взаимодействием, отображает жидкие эффекты анимации Windows 8 и реакции на взаимодействие, которые соответствуют [рекомендациям по распространению взаимодействия с пользователем](/windows/uwp/design/input/).</span><span class="sxs-lookup"><span data-stu-id="3bdb7-108">Any application that uses Direct Manipulation to process touch interactions displays the fluid Windows 8 animations and interaction feedback behaviors that conform to the [Guidelines for common user interactions](/windows/uwp/design/input/).</span></span>

## <a name="developer-audience"></a><span data-ttu-id="3bdb7-109">Аудитория разработчиков</span><span class="sxs-lookup"><span data-stu-id="3bdb7-109">Developer Audience</span></span>

<span data-ttu-id="3bdb7-110">API прямого управления предназначен для опытных разработчиков, знающих C/C++, имеющих полное представление об [объектной модели компонентов (com)](../com/component-object-model--com--portal.md)и знакомство с концепциями программирования Windows.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-110">The Direct Manipulation API is for experienced developers who know C/C++, have a solid understanding of the [Component Object Model (COM)](../com/component-object-model--com--portal.md), and are familiar with Windows programming concepts.</span></span>

## <a name="run-time-requirements"></a><span data-ttu-id="3bdb7-111">Требования к среде выполнения</span><span class="sxs-lookup"><span data-stu-id="3bdb7-111">Run-time requirements</span></span>

<span data-ttu-id="3bdb7-112">Прямая манипуляция появилась в Windows 8.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-112">Direct Manipulation was introduced in Windows 8.</span></span> <span data-ttu-id="3bdb7-113">Она включена как в 32-разрядных, так и в 64-разрядных версиях.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-113">It is included in both 32-bit and 64-bit versions.</span></span>

## <a name="why-use-directmanipulation"></a><span data-ttu-id="3bdb7-114">Зачем использовать Директманипулатион</span><span class="sxs-lookup"><span data-stu-id="3bdb7-114">Why use DirectManipulation</span></span>

### <a name="handles-interactions-in-a-straightforward-and-consistent-manner"></a><span data-ttu-id="3bdb7-115">Обрабатывает взаимодействия простым и согласованным способом</span><span class="sxs-lookup"><span data-stu-id="3bdb7-115">Handles interactions in a straightforward and consistent manner</span></span>

<span data-ttu-id="3bdb7-116">Непосредственная манипуляция заключается в предварительном объявлении поведения и взаимодействии для региона или объекта.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-116">Direct Manipulation works by pre-declaring the behaviors and interactions for a region or object.</span></span> <span data-ttu-id="3bdb7-117">Например, веб-страница часто настраивается для панорамы и масштабирования.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-117">For example, a web page is often configured for pan and zoom.</span></span> <span data-ttu-id="3bdb7-118">Во время выполнения входные данные затем связываются с этим регионом или объектом через простой вызов API.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-118">At runtime, input is then associated with this region/object through a simple API call.</span></span> <span data-ttu-id="3bdb7-119">С этого момента прямая манипуляция выполняет всю тяжелую работу по обработке входных данных, применению ограничений и индивидуальности и созданию преобразований вывода.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-119">From this point forward Direct Manipulation does all the heavy lifting of processing the input, applying constraints and personality, and generating the output transforms.</span></span>

### <a name="build-responsive-touch-applications"></a><span data-ttu-id="3bdb7-120">Создание сенсорных приложений для реагирования</span><span class="sxs-lookup"><span data-stu-id="3bdb7-120">Build responsive touch applications</span></span>

<span data-ttu-id="3bdb7-121">Чтобы оптимизировать скорость реагирования и сократить задержку, обработка прямого манипулирования выполняется в отдельном независимом потоке от потока пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-121">To optimize responsiveness and minimize latency, Direct Manipulation processing occurs on a separate, independent thread from the UI thread.</span></span> <span data-ttu-id="3bdb7-122">В результате преобразования выходных данных могут выполняться параллельно с действием в потоке пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-122">As a result, output transforms can run in parallel to activity on the UI thread.</span></span> <span data-ttu-id="3bdb7-123">Действие потока пользовательского интерфейса может включать логику приложения, отрисовку, макет и все остальное, которые используют циклы процессора.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-123">The UI thread activity may include application logic, rendering, layout, and anything else that consumes cycles on the processor.</span></span>

### <a name="implementation-flexibility"></a><span data-ttu-id="3bdb7-124">Гибкость реализации</span><span class="sxs-lookup"><span data-stu-id="3bdb7-124">Implementation flexibility</span></span>

<span data-ttu-id="3bdb7-125">Интерфейсы, входящие в прямую манипуляцию, обеспечивают комплексную поддержку для обработки ввода, распознавания взаимодействия, уведомлений о отзывах и обновлений пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-125">The interfaces included with Direct Manipulation provide comprehensive support for input handling, interaction recognition, feedback notifications, and UI updates.</span></span> <span data-ttu-id="3bdb7-126">Интерфейсы также включают в себя системные службы, такие как [DirectComposition](../directcomp/directcomposition-portal.md).</span><span class="sxs-lookup"><span data-stu-id="3bdb7-126">The interfaces also incorporate system services such as [DirectComposition](../directcomp/directcomposition-portal.md).</span></span>

## <a name="basic-concepts"></a><span data-ttu-id="3bdb7-127">Основные понятия</span><span class="sxs-lookup"><span data-stu-id="3bdb7-127">Basic concepts</span></span>

<span data-ttu-id="3bdb7-128">Самая базовая реализация прямого управления состоит из *окна просмотра*, *содержимого* и *взаимодействий*.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-128">The most basic Direct Manipulation implementation consists of a *viewport*, *content*, and *interactions*.</span></span> <span data-ttu-id="3bdb7-129">*Окно просмотра* — это регион, который способен получать и обрабатывать ввод данных при взаимодействии с пользователем.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-129">The *viewport* is a region that is able to receive and process input from user interactions.</span></span> <span data-ttu-id="3bdb7-130">Это также область содержимого, видимая для конечного пользователя.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-130">It is also the region of the content that is visible to the end-user.</span></span> <span data-ttu-id="3bdb7-131">*Содержимое* — это фактический объект, который пользователи могут видеть, а также перемещает или масштабирует в ответ на взаимодействие с пользователем.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-131">The *content* is the actual object that end-users can see and is what moves or scales in response to a user interaction.</span></span> <span data-ttu-id="3bdb7-132">*Взаимодействие* с основным пользователем (также известные как *манипуляции*), поддерживаемое непосредственной обработкой, — это панорамирование и изменение масштаба.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-132">The primary user *interactions* (also known as *manipulations*) supported by Direct Manipulation are panning and zooming.</span></span> <span data-ttu-id="3bdb7-133">Эти взаимодействия применяют преобразование преобразования или масштабирования к содержимому в окне просмотра, соответственно.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-133">These interactions apply a translate or scale transform to the content within the viewport, respectively.</span></span> <span data-ttu-id="3bdb7-134">Несколько окон просмотра (каждый с собственным содержимым) можно настроить в одном окне, чтобы создать богатый интерфейс.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-134">Multiple viewports (each with their own content) can be configured in a single window to create a rich UI experience.</span></span>

<span data-ttu-id="3bdb7-135">На этом рисунке показана базовая реализация прямого управления до и после панорамирования.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-135">This figure shows a basic Direct Manipulation implementation before and after panning.</span></span>

![Базовая реализация прямого управления до и после панорамирования.](images/dm-art-1.png)

<span data-ttu-id="3bdb7-137">Во время инициализации непосредственной манипуляции создается экземпляр объекта **дкомпдиректманипулатионкомпоситор** , который связывается с непосредственной манипуляцией.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-137">During initialization of Direct Manipulation a **DCompDirectManipulationCompositor** object is instantiated and is associated with Direct Manipulation.</span></span> <span data-ttu-id="3bdb7-138">Этот объект является оболочкой для [DirectComposition](../directcomp/directcomposition-portal.md), который является компоновщиком системы.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-138">This object is a wrapper around [DirectComposition](../directcomp/directcomposition-portal.md), which is the system compositor.</span></span> <span data-ttu-id="3bdb7-139">Объект отвечает за применение преобразований вывода и выполнение визуальных обновлений.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-139">The object is responsible for applying the output transforms and driving visual updates.</span></span>

<span data-ttu-id="3bdb7-140">Контакт представляет точку касания, определяемую **поинтерид** , указанной в сообщении [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) .</span><span class="sxs-lookup"><span data-stu-id="3bdb7-140">A contact represents a touch point identified by the **pointerId** provided in the [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) message.</span></span> <span data-ttu-id="3bdb7-141">При получении **сообщения \_ поинтердовн WM** приложение вызывает [**сетконтакт**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact).</span><span class="sxs-lookup"><span data-stu-id="3bdb7-141">When a **WM\_POINTERDOWN** message is received, the application calls [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact).</span></span> <span data-ttu-id="3bdb7-142">Приложение уведомляет напрямую Манипулатионабаут контакты, которые должны быть обработаны, и окна просмотра, которые должны реагировать на эти контакты.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-142">The application notifies Direct Manipulationabout the contacts that should be handled and the viewport(s) that should react to those contacts.</span></span> <span data-ttu-id="3bdb7-143">Ввод с клавиатуры и мыши имеет специальные значения **поинтерид** , поэтому они могут обрабатываться соответствующим образом путем непосредственной манипуляции.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-143">Keyboard and mouse input have special **pointerId** values so they can be handled appropriately by Direct Manipulation.</span></span>

<span data-ttu-id="3bdb7-144">В нашем базовом случае, когда [**сетконтакт**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) вызывается несколько вещей, происходит следующее:</span><span class="sxs-lookup"><span data-stu-id="3bdb7-144">In our basic case above, when [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) is called a few things happen:</span></span>

- <span data-ttu-id="3bdb7-145">Когда пользователь выполняет сдвиг, в приложение отправляется сообщение [WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) , уведомляющее о том, что контакт был использован непосредственно в процессе манипуляции.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-145">When the user performs a pan, a [WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) message is sent to the application to notify that the contact has been consumed by Direct Manipulation.</span></span>
- <span data-ttu-id="3bdb7-146">Когда пользователь перемещает перемещения, окно просмотра запускает события обновления, которые используются оболочкой [DirectComposition](../directcomp/directcomposition-portal.md) для создания визуальных обновлений на экране.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-146">When the user moves the moves, the viewport fires update events which are used by the [DirectComposition](../directcomp/directcomposition-portal.md) wrapper to drive visual updates to the screen.</span></span> <span data-ttu-id="3bdb7-147">Для панорамирования пользователя в окне просмотра, содержимое будет выглядеть плавно под контактом.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-147">To a user panning in a viewport, the content will appear to move smoothly under the contact.</span></span>
- <span data-ttu-id="3bdb7-148">Когда пользователь отрывает контакт, он видит, что содержимое продолжает перемещаться по мере перехода в анимацию инерции, постепенно замедление, пока не достигнет своего окончательного размещения.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-148">When the user lifts the contact, the user sees the content continue to move as it transitions into an inertia animation, gradually decelerating until it reaches its final resting place.</span></span>

## <a name="processing-keyboard-and-mouse-input"></a><span data-ttu-id="3bdb7-149">Обработка ввода с клавиатуры и мыши</span><span class="sxs-lookup"><span data-stu-id="3bdb7-149">Processing keyboard and mouse input</span></span>

<span data-ttu-id="3bdb7-150">Непосредственная манипуляция позволяет пересылать сообщения клавиатуры и мыши вручную из потока пользовательского интерфейса приложения через API [**ProcessInput**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-processinput) , так что они могут обрабатываться соответствующим образом путем непосредственной манипуляции.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-150">Direct Manipulation allows keyboard and mouse messages to be forwarded manually from the application UI thread via the [**ProcessInput**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-processinput) API such that they can be handled appropriately by Direct Manipulation.</span></span>

## <a name="directmanipulation-and-the-hwnd"></a><span data-ttu-id="3bdb7-151">Директманипулатион и HWND</span><span class="sxs-lookup"><span data-stu-id="3bdb7-151">DirectManipulation and the HWND</span></span>

<span data-ttu-id="3bdb7-152">Непосредственная манипуляция связана с Win32 HWND для получения и обработки сообщений ввода указателя для этого окна.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-152">Direct Manipulation is associated with a Win32 HWND in order to receive and process pointer input messages for that window.</span></span> <span data-ttu-id="3bdb7-153">При использовании прямой манипуляции выходные значения делают асинхронные обратные вызовы [com](../com/component-object-model--com--portal.md) -объектам, реализованным в приложении напрямую манипуляции.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-153">As Direct Manipulation computes output values, it makes asynchronous callbacks to the Direct Manipulation [Component Object Model (COM)](../com/component-object-model--com--portal.md) objects that are implemented in the application.</span></span> <span data-ttu-id="3bdb7-154">Эти обратные вызовы сообщают приложению о преобразовании, которое было применено к объектам.</span><span class="sxs-lookup"><span data-stu-id="3bdb7-154">These callbacks inform the application about the transform that was applied to the objects.</span></span> <span data-ttu-id="3bdb7-155">Непосредственная манипуляция активируется для указанного HWND путем вызова функции [**Activate**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-activate).</span><span class="sxs-lookup"><span data-stu-id="3bdb7-155">Direct Manipulation is activated on the specified HWND by calling [**Activate**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-activate).</span></span>

## <a name="supporting-documentation"></a><span data-ttu-id="3bdb7-156">Вспомогательная документация</span><span class="sxs-lookup"><span data-stu-id="3bdb7-156">Supporting documentation</span></span>

- [<span data-ttu-id="3bdb7-157">Окна просмотра и содержимое</span><span class="sxs-lookup"><span data-stu-id="3bdb7-157">Viewports and content</span></span>](directmanipulation-viewports-and-content.md)
- [<span data-ttu-id="3bdb7-158">Использование нескольких окон просмотра в Директманипулатион</span><span class="sxs-lookup"><span data-stu-id="3bdb7-158">Using multiple viewports in DirectManipulation</span></span>](directmanipulation-multiple-vieports.md)
- [<span data-ttu-id="3bdb7-159">Обработка входных данных с помощью Директманипулатион</span><span class="sxs-lookup"><span data-stu-id="3bdb7-159">Processing input with DirectManipulation</span></span>](directmanipulation-processing-input-with-directmanipulation.md)
- [<span data-ttu-id="3bdb7-160">Механизм композиции</span><span class="sxs-lookup"><span data-stu-id="3bdb7-160">Composition engine</span></span>](directmanipulation-composition-engine.md)
- [<span data-ttu-id="3bdb7-161">Ссылка на прямую манипуляцию</span><span class="sxs-lookup"><span data-stu-id="3bdb7-161">Direct Manipulation Reference</span></span>](direct-manipulation-reference.md)

- [<span data-ttu-id="3bdb7-162">Сборка 2013: вкл-022: Сделайте классическое приложение удобным с помощью сенсорного ввода, мыши и пера</span><span class="sxs-lookup"><span data-stu-id="3bdb7-162">BUILD 2013: WCL-022: Make your desktop app great with touch, mouse, and pen</span></span>](https://channel9.msdn.com/Events/Build/2013/4-022)
- [<span data-ttu-id="3bdb7-163">Пример обработки сенсорного ввода с помощью прямой манипуляции</span><span class="sxs-lookup"><span data-stu-id="3bdb7-163">Process touch input with Direct Manipulation sample</span></span>](https://github.com/microsoft/Windows-classic-samples/tree/1d363ff4bd17d8e20415b92e2ee989d615cc0d91/Samples/TouchInputDirectManipulation)
