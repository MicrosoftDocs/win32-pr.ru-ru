---
title: Разработка надстроек для обработчика протокола
description: Можно расширить Microsoft Windows Desktop Search (WDS) для включения новых хранилищ данных путем реализации пользовательского обработчика протокола.
ms.assetid: 2447d95f-5832-453c-8857-3b4f4c158177
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 45a8688621f7d2fda653d769c0e1dfdadd240f49
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104533173"
---
# <a name="developing-protocol-handler-add-ins"></a><span data-ttu-id="6689c-103">Разработка надстроек для обработчика протокола</span><span class="sxs-lookup"><span data-stu-id="6689c-103">Developing Protocol Handler Add-ins</span></span>

> [!NOTE]
> <span data-ttu-id="6689c-104">Windows Desktop Search 2. x — это устаревшая технология, которая изначально была доступна в качестве надстройки для Windows XP и Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="6689c-104">Windows Desktop Search 2.x is an obsolete technology that was originally available as an add-in for Windows XP and Windows Server 2003.</span></span> <span data-ttu-id="6689c-105">В более поздних выпусках используйте вместо этого [Поиск Windows](../search/-search-3x-wds-overview.md) .</span><span class="sxs-lookup"><span data-stu-id="6689c-105">On later releases, use [Windows Search](../search/-search-3x-wds-overview.md) instead.</span></span>

<span data-ttu-id="6689c-106">Можно расширить Microsoft Windows Desktop Search (WDS) для включения новых хранилищ данных путем реализации пользовательского обработчика протокола.</span><span class="sxs-lookup"><span data-stu-id="6689c-106">You can extend Microsoft Windows Desktop Search (WDS) to include new data stores by implementing a custom protocol handler.</span></span>

## <a name="indexing-data-stores-with-protocol-handlers"></a><span data-ttu-id="6689c-107">Индексирование хранилищ данных с помощью обработчиков протоколов</span><span class="sxs-lookup"><span data-stu-id="6689c-107">Indexing Data Stores with Protocol Handlers</span></span>

<span data-ttu-id="6689c-108">Хранилище данных — это источник содержимого (система базы данных, каталог, файловая система), где хранятся данные и которые можно просканировать с помощью индексатора WDS.</span><span class="sxs-lookup"><span data-stu-id="6689c-108">A data store is a content source (a database system, a directory, a file system) where data is stored and can be crawled by the WDS Indexer.</span></span> <span data-ttu-id="6689c-109">Хранилище может быть иерархическим (например, базой данных) или на основе ссылок (например, веб-сайт).</span><span class="sxs-lookup"><span data-stu-id="6689c-109">The store can be hierarchical (like a database) or link-based (like a website).</span></span> <span data-ttu-id="6689c-110">Обработчик протокола позволяет индексировать приложения, такие как WDS, для систематического сканирования узлов хранилища данных, чтобы извлечь релевантные сведения для включения в индекс.</span><span class="sxs-lookup"><span data-stu-id="6689c-110">A protocol handler enables indexing applications like WDS to systematically crawl the nodes of a data store to extract relevant information to include in the index.</span></span> <span data-ttu-id="6689c-111">Каждый обработчик протокола используется для индексации определенного типа хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="6689c-111">Each protocol handler is used to index a specific type of data store.</span></span> <span data-ttu-id="6689c-112">Службы WDS входят в состав обработчиков протоколов для хранилищ файловой системы, а также для хранилищ данных Microsoft Outlook и Microsoft Outlook Express (хранилища электронной почты,. PST-файлы и т. д.).</span><span class="sxs-lookup"><span data-stu-id="6689c-112">WDS ships with protocol handlers for file system stores and for both Microsoft Outlook and Microsoft Outlook Express data stores (email stores, .PST files, and so on).</span></span> <span data-ttu-id="6689c-113">Например, при индексировании электронной почты Outlook обработчик протокола выполняет сканирование всех сообщений во всех папках, извлекая сведения из каждого сообщения и вложения.</span><span class="sxs-lookup"><span data-stu-id="6689c-113">When indexing Outlook email, for example, the protocol handler crawls all messages in all folders extracting information from each message and attachment.</span></span> <span data-ttu-id="6689c-114">Эти сведения передаются индексатору для включения в каталог WDS.</span><span class="sxs-lookup"><span data-stu-id="6689c-114">This information is passed to the Indexer to include in the WDS catalog.</span></span>

<span data-ttu-id="6689c-115">Часто пользователям необходимо выполнять поиск в других хранилищах данных, таких как устаревшие базы данных, хранилища электронной почты или структуры данных, не поддерживаемые WDS.</span><span class="sxs-lookup"><span data-stu-id="6689c-115">Often users need to search other data stores such as legacy databases, email stores or data structures not supported by WDS.</span></span> <span data-ttu-id="6689c-116">WDS можно расширить для сканирования нового хранилища данных с помощью или реализации обработчика протокола специально для этого хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="6689c-116">You can extend WDS to crawl a new data store by using or implementing a protocol handler specifically for that data store.</span></span> <span data-ttu-id="6689c-117">Во-первых, сначала необходимо определить, существует ли обработчик протокола для хранилища данных, возможно, для использования с другим приложением, например службами SharePoint Services.</span><span class="sxs-lookup"><span data-stu-id="6689c-117">First, you should first determine if a protocol handler already exists for your data store, perhaps for use with another application like SharePoint Services.</span></span> <span data-ttu-id="6689c-118">В этом случае можно установить обработчик протокола в системе.</span><span class="sxs-lookup"><span data-stu-id="6689c-118">If so, you can install that protocol handler on the system.</span></span> <span data-ttu-id="6689c-119">Однако если еще не существует другого обработчика протокола, необходимо реализовать его.</span><span class="sxs-lookup"><span data-stu-id="6689c-119">If, however, another protocol handler does not exist, then you need to implement one.</span></span> <span data-ttu-id="6689c-120">Обработчики протоколов WDS используют те же спецификации, что и службы SharePoint Services, и часто взаимозаменяемы.</span><span class="sxs-lookup"><span data-stu-id="6689c-120">WDS protocol handlers use the same design specifications as SharePoint Services, and they can often be used interchangeably.</span></span>

<span data-ttu-id="6689c-121">Кроме того, если хранилище данных содержит данные или типы файлов, отличные от типов файлов 200, поддерживаемых WDS, необходимо также реализовать фильтр для доступа к содержимому элементов в хранилище и индексировать его.</span><span class="sxs-lookup"><span data-stu-id="6689c-121">Furthermore, if the data store contains data or file types other than one of the 200 file types supported by WDS, you also need to implement a filter to access and index the contents of items in the store.</span></span> <span data-ttu-id="6689c-122">WDS 2. x использует обработчик протокола и технологию [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter), используемые службами SharePoint Services.</span><span class="sxs-lookup"><span data-stu-id="6689c-122">WDS 2.x uses the protocol handler and [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter)technology used by SharePoint Services.</span></span> <span data-ttu-id="6689c-123">Если у вас уже есть фильтры для определенного хранилища и типа файлов, установленных в индексируемой системе, WDS использует существующие интерфейсы для индексирования этих данных.</span><span class="sxs-lookup"><span data-stu-id="6689c-123">If you already have filters for a specific store and file type installed on the system being indexed, WDS uses the existing interfaces to index this data.</span></span>

 

## <a name="roadmap-to-adding-new-data-stores"></a><span data-ttu-id="6689c-124">Стратегия добавления новых хранилищ данных</span><span class="sxs-lookup"><span data-stu-id="6689c-124">Roadmap to Adding New Data Stores</span></span>

<span data-ttu-id="6689c-125">Чтобы расширить возможности WDS для обхода новых хранилищ данных, можно создать обработчик протокола и одну или несколько следующих надстроек: обработчик контекстного меню, обработчик значков и надстройка Сеарчпротоколоптионс.</span><span class="sxs-lookup"><span data-stu-id="6689c-125">To extend WDS to crawl new data stores, you can create a protocol handler and one or more of the following add-ins: context menu handler, icon handler and a SearchProtocolOptions add-in.</span></span>

1.  <span data-ttu-id="6689c-126">Создание и регистрация многопоточного обработчика протокола для хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="6689c-126">Create and register a multithreaded protocol handler for the data store:</span></span>
    -   <span data-ttu-id="6689c-127">**Исеарчпротокол** — этот интерфейс обращается к протоколу и сопоставляет URL-адрес с иурлакцессор.</span><span class="sxs-lookup"><span data-stu-id="6689c-127">**ISearchProtocol** - This interface accesses a protocol and maps a URL to an IUrlAccessor.</span></span>
    -   <span data-ttu-id="6689c-128">**Иурлакцессор** — это основной интерфейс, используемый для доступа к элементам из источника содержимого и привязки содержимого к соответствующему фильтру.</span><span class="sxs-lookup"><span data-stu-id="6689c-128">**IUrlAccessor** - This is the main interface used for accessing items from the content source and binding the content to appropriate filter.</span></span>
    -   <span data-ttu-id="6689c-129">**Ипротоколхандлерсите** — этот интерфейс используется для запроса и загрузки дополнительных фильтров.</span><span class="sxs-lookup"><span data-stu-id="6689c-129">**IProtocolHandlerSite** - This interface is used to request and load additional filters.</span></span>
    -   <span data-ttu-id="6689c-130">**IFilter** . Этот интерфейс возвращает URL-адрес каждого элемента в папке в виде свойств значения для обработки.</span><span class="sxs-lookup"><span data-stu-id="6689c-130">**IFilter** - This interface returns the URL of each item in a folder as value properties for processing.</span></span>

    > [!Note]
    >
    > <span data-ttu-id="6689c-131">Минимальная функция надстройки, необходимая для возврата результатов поиска из неиерархического хранилища данных, является реализацией интерфейсов Исеарчпротокол и Иурлакцессор.</span><span class="sxs-lookup"><span data-stu-id="6689c-131">The minimum add-in functionality needed to return search results from a non-hierarchical data store is an implementation of ISearchProtocol and IUrlAccessor interfaces.</span></span>

     

2.  <span data-ttu-id="6689c-132">Реализуйте интерфейс Исеарчпротоколоптионс, чтобы включить настроенные параметры обработчика протоколов, такие как предопределенные начальные страницы:</span><span class="sxs-lookup"><span data-stu-id="6689c-132">Implement the ISearchProtocolOptions interface to include customized protocol handler options, like predefined start page(s):</span></span>
    -   <span data-ttu-id="6689c-133">**Исеарчпротоколоптионс** — этот интерфейс определяет URL-адреса по умолчанию для обработки обработчиком протокола, определяет требования к обработчику протокола и определяет, выполнены ли требования в данной системе.</span><span class="sxs-lookup"><span data-stu-id="6689c-133">**ISearchProtocolOptions** - This interface defines default URLs for the protocol handler to process, determines what the requirements are for a protocol handler, and determines whether the requirements have been met on a given system.</span></span>
3.  <span data-ttu-id="6689c-134">Расширение оболочки для включения элементов пользовательского интерфейса, таких как контекстные меню и значки файлов, путем реализации следующих интерфейсов:</span><span class="sxs-lookup"><span data-stu-id="6689c-134">Extend Shell to include user interface elements, like context menus and file-specific icons, by implementing the following interfaces:</span></span>
    -   <span data-ttu-id="6689c-135">**Ишеллфолдер** — этот интерфейс, используемый для управления папками, необходим для предоставления интерфейсов IContextMenu и иекстрактикон для URL-адреса в новом хранилище.</span><span class="sxs-lookup"><span data-stu-id="6689c-135">**IShellFolder** - This interface, which is used to manage folders, is required to provide the IContextMenu and IExtractIcon interfaces for a URL in a new store.</span></span>
    -   <span data-ttu-id="6689c-136">**Иперсистфолдер** — этот интерфейс необходим для указания объекту папки оболочки на инициализацию самого себя.</span><span class="sxs-lookup"><span data-stu-id="6689c-136">**IPersistFolder** - This interface is required to instruct a Shell folder object to initialize itself.</span></span>
    -   <span data-ttu-id="6689c-137">**IPersist** — этот интерфейс предоставляет идентификатор класса (CLSID) объекта, который может храниться в системе постоянно.</span><span class="sxs-lookup"><span data-stu-id="6689c-137">**IPersist** - This interface supplies the class identifier (CLSID) of an object that can be stored persistently in the system.</span></span>
    -   <span data-ttu-id="6689c-138">**IContextMenu** — этот интерфейс определяет контекстное меню щелчка правой кнопкой мыши для элемента, на который указывает URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="6689c-138">**IContextMenu** - This interface defines the right-click context menu for an item pointed to by URL.</span></span>
    -   <span data-ttu-id="6689c-139">**Иекстрактикон** — этот интерфейс определяет значок, отображаемый для элемента, на который указывает URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="6689c-139">**IExtractIcon** - This interface defines the icon to display for an item pointed to by URL.</span></span>
4.  <span data-ttu-id="6689c-140">Реализуйте механизм уведомления индексатора об изменениях в хранилище данных.</span><span class="sxs-lookup"><span data-stu-id="6689c-140">Implement a mechanism to notify the Indexer of changes to your data store:</span></span>
    -   <span data-ttu-id="6689c-141">**Исеарчитемсчанжедсинк** — этот интерфейс позволяет обработчику протокола уведомлять индекс изменений в хранилище данных.</span><span class="sxs-lookup"><span data-stu-id="6689c-141">**ISearchItemsChangedSink** - This interface enables your protocol handler to notify the Index of changes to your data store.</span></span> <span data-ttu-id="6689c-142">Это повышает производительность, гарантируя, что индексатор не выполняет сканирование всего хранилища по добавочным индексам.</span><span class="sxs-lookup"><span data-stu-id="6689c-142">This improves performance by ensuring the Indexer doesn't crawl the entire store on incremental indexes.</span></span>

## <a name="related-topics"></a><span data-ttu-id="6689c-143">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="6689c-143">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="6689c-144">**Reference**</span><span class="sxs-lookup"><span data-stu-id="6689c-144">**Reference**</span></span>
</dt> <dt>

[<span data-ttu-id="6689c-145">Реализация обработчика протокола для WDS</span><span class="sxs-lookup"><span data-stu-id="6689c-145">Implementing a Protocol Handler for WDS</span></span>](-search-2x-wds-phimplementing.md)
</dt> <dt>

[<span data-ttu-id="6689c-146">Добавление значков, предварительных версий и контекстных меню с расширениями оболочки</span><span class="sxs-lookup"><span data-stu-id="6689c-146">Adding Icons, Previews, and Context Menus with Shell Extensions</span></span>](-search-2x-wds-ph-ui-extensions.md)
</dt> <dt>

[<span data-ttu-id="6689c-147">Уведомление индекса изменений</span><span class="sxs-lookup"><span data-stu-id="6689c-147">Notifying the Index of Changes</span></span>](-search-2x-wds-notifyingofchanges.md)
</dt> <dt>

[<span data-ttu-id="6689c-148">Установка и регистрация обработчиков протоколов</span><span class="sxs-lookup"><span data-stu-id="6689c-148">Installing and Registering Protocol Handlers</span></span>](-search-2x-wds-ph-install-registration.md)
</dt> </dl>

 

 