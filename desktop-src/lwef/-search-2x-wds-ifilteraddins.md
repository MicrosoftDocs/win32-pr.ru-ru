---
title: Разработка надстроек IFilter
description: Для включения новых типов файлов можно расширить Microsoft Windows Desktop Search (WDS) с помощью надстроек фильтров, компонентов, реализующих Ифилтеринтерфаце.
ms.assetid: 71dd515d-a73e-4e0a-b0da-c8a6209d09fe
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 79f846cf2101eefc17b1e92fbd7992529a06fb43
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104487676"
---
# <a name="developing-ifilter-add-ins"></a><span data-ttu-id="81655-103">Разработка надстроек IFilter</span><span class="sxs-lookup"><span data-stu-id="81655-103">Developing IFilter Add-ins</span></span>

> [!NOTE]
> <span data-ttu-id="81655-104">Windows Desktop Search 2. x — это устаревшая технология, которая изначально была доступна в качестве надстройки для Windows XP и Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="81655-104">Windows Desktop Search 2.x is an obsolete technology that was originally available as an add-in for Windows XP and Windows Server 2003.</span></span> <span data-ttu-id="81655-105">В более поздних выпусках используйте вместо этого [Поиск Windows](../search/-search-3x-wds-overview.md) .</span><span class="sxs-lookup"><span data-stu-id="81655-105">On later releases, use [Windows Search](../search/-search-3x-wds-overview.md) instead.</span></span>

<span data-ttu-id="81655-106">Для включения новых типов файлов можно расширить Microsoft Windows Desktop Search (WDS) с помощью надстроек фильтров, компонентов, реализующих интерфейс [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter).</span><span class="sxs-lookup"><span data-stu-id="81655-106">You can extend Microsoft Windows Desktop Search (WDS) with filter add-ins, components that implement the [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter)interface, to include new file types.</span></span> <span data-ttu-id="81655-107">Фильтры отвечают за доступ и синтаксический анализ данных в файлах и для возврата пар свойств и значений, а также фрагментов текста для индексирования.</span><span class="sxs-lookup"><span data-stu-id="81655-107">Filters are responsible for accessing and parsing data in files and for returning pairs of properties and values as well as chunks of text for indexing.</span></span> <span data-ttu-id="81655-108">В процессе индексирования WDS вызывает соответствующий фильтр с URL-адресом для каждого файла или элемента.</span><span class="sxs-lookup"><span data-stu-id="81655-108">During the indexing process, WDS calls the appropriate filter with the URL for each file or item.</span></span> <span data-ttu-id="81655-109">Фильтр сначала извлекает метаданные, соответствующие свойствам, которые помечены как доступные для получения в схеме WDS, например заголовок, размер файла и Дата последнего изменения.</span><span class="sxs-lookup"><span data-stu-id="81655-109">The filter first extracts metadata that corresponds to properties that are marked retrievable in the WDS schema, such as title, file size, and last modified date.</span></span> <span data-ttu-id="81655-110">Затем содержимое элемента разбивается на фрагменты текста.</span><span class="sxs-lookup"><span data-stu-id="81655-110">Then it breaks the item content into chunks of text.</span></span> <span data-ttu-id="81655-111">WDS добавляет в каталог свойства и текст, возвращаемые фильтром.</span><span class="sxs-lookup"><span data-stu-id="81655-111">WDS adds the properties and text returned by the filter to the catalog.</span></span> <span data-ttu-id="81655-112">WDS может индексировать файлы любого типа, для которых имеется зарегистрированный фильтр.</span><span class="sxs-lookup"><span data-stu-id="81655-112">WDS can index any file type for which it has a registered filter.</span></span>

<span data-ttu-id="81655-113">В некоторых случаях не требуется создавать новый фильтр.</span><span class="sxs-lookup"><span data-stu-id="81655-113">In some circumstances, you do not need to write a new filter.</span></span> <span data-ttu-id="81655-114">WDS 2. x содержит фильтры для более чем 200 типов элементов (включая элементы с открытым текстом, такие как HTML, XML и файлы исходного кода) и использует ту же технологию [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter), что и службы SharePoint Services.</span><span class="sxs-lookup"><span data-stu-id="81655-114">WDS 2.x contains filters for over 200 types of items (including plaintext items such as HTML, XML, and source code files) and uses the same [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter)technology as SharePoint Services.</span></span> <span data-ttu-id="81655-115">Если вы уже установили фильтры для ваших типов файлов, службы WDS смогут использовать существующие фильтры для индексирования этих данных.</span><span class="sxs-lookup"><span data-stu-id="81655-115">If you already have filters installed for your file types, WDS can use those existing filters to index this data.</span></span> <span data-ttu-id="81655-116">Кроме того, WDS включает общий фильтр для типов файлов, основанных на тексте.</span><span class="sxs-lookup"><span data-stu-id="81655-116">Furthermore, WDS includes a general filter for file types that are plaintext-based.</span></span> <span data-ttu-id="81655-117">Если имеется тип файла, который может быть обработан либо существующим фильтром служб SharePoint, либо фильтром открытого текста, можно добавить расширение имени файла и идентификатор GUID фильтра в реестр, чтобы службы WDS могли найти и использовать его (см. раздел [Регистрация надстройки фильтра](#to-register-a-filter-add-in) для получения дополнительных сведений).</span><span class="sxs-lookup"><span data-stu-id="81655-117">If you have a file type that can be processed by either an existing SharePoint Services filter or the plaintext filter, you can add the file name extension and filter GUID to the Registry so WDS can locate and use it (see [To Register a Filter Add-in](#to-register-a-filter-add-in) for more information).</span></span>

<span data-ttu-id="81655-118">Однако если у вас есть необычный и собственный формат данных или файл, написание пользовательской реализации фильтра является единственным способом убедиться, что WDS может индексировать формат файла в каталоге.</span><span class="sxs-lookup"><span data-stu-id="81655-118">If, however, you have a non-plaintext and proprietary data or file format, writing a custom filter implementation is the only way to ensure WDS can index the file format in the catalog.</span></span> <span data-ttu-id="81655-119">У вас может быть только одна надстройка фильтра для типа файлов, поэтому можно переопределить существующий фильтр или перекрыть другой фильтр для конкретного типа файлов.</span><span class="sxs-lookup"><span data-stu-id="81655-119">You can have only one filter add-in for a file type, so it is possible to override an existing filter or to have another filter override yours for a specific file type.</span></span>

<span data-ttu-id="81655-120">В этом разделе рассматриваются следующие вопросы.</span><span class="sxs-lookup"><span data-stu-id="81655-120">This section contains the following topics:</span></span>

-   [<span data-ttu-id="81655-121">Требуемые интерфейсы фильтра</span><span class="sxs-lookup"><span data-stu-id="81655-121">Required Filter Interfaces</span></span>](#required-filter-interfaces)
    -   [<span data-ttu-id="81655-122">Интерфейс IFilter</span><span class="sxs-lookup"><span data-stu-id="81655-122">IFilter Interface</span></span>](#ifilter-interface)
    -   [<span data-ttu-id="81655-123">IPersistStream</span><span class="sxs-lookup"><span data-stu-id="81655-123">IPersistStream</span></span>](#ipersiststream)
    -   [<span data-ttu-id="81655-124">IPersistFile</span><span class="sxs-lookup"><span data-stu-id="81655-124">IPersistFile</span></span>](#ipersistfile)
    -   [<span data-ttu-id="81655-125">иперсистстораже</span><span class="sxs-lookup"><span data-stu-id="81655-125">IPersistStorage</span></span>](#ipersiststorage)
-   [<span data-ttu-id="81655-126">Вывод свойств с фильтрами</span><span class="sxs-lookup"><span data-stu-id="81655-126">Outputting Properties with Filters</span></span>](#outputting-properties-with-filters)
    -   [<span data-ttu-id="81655-127">Значения свойств</span><span class="sxs-lookup"><span data-stu-id="81655-127">Property Values</span></span>](#property-values)
-   [<span data-ttu-id="81655-128">Установка надстройки фильтра</span><span class="sxs-lookup"><span data-stu-id="81655-128">Filter Add-in Installation</span></span>](#filter-add-in-installation)
    -   [<span data-ttu-id="81655-129">Идентификаторы CLSID, необходимые для регистрации</span><span class="sxs-lookup"><span data-stu-id="81655-129">CLSIDs Required for Registration</span></span>](#clsids-required-for-registration)
    -   [<span data-ttu-id="81655-130">Модель регистрации</span><span class="sxs-lookup"><span data-stu-id="81655-130">Registration Model</span></span>](#registration-model)
    -   [<span data-ttu-id="81655-131">Регистрация надстройки фильтра</span><span class="sxs-lookup"><span data-stu-id="81655-131">To Register a Filter Add-in</span></span>](#to-register-a-filter-add-in)
-   [<span data-ttu-id="81655-132">См. также</span><span class="sxs-lookup"><span data-stu-id="81655-132">Related topics</span></span>](#related-topics)

## <a name="required-filter-interfaces"></a><span data-ttu-id="81655-133">Требуемые интерфейсы фильтра</span><span class="sxs-lookup"><span data-stu-id="81655-133">Required Filter Interfaces</span></span>

<span data-ttu-id="81655-134">Надстройка фильтра должна реализовывать интерфейс [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter)и один из следующих интерфейсов:</span><span class="sxs-lookup"><span data-stu-id="81655-134">A filter add-in must implement the [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter)interface and one of the following interfaces:</span></span>

-   <span data-ttu-id="81655-135">[IPersistStream](/windows/win32/api/objidl/nn-objidl-ipersiststream) — для загрузки данных из потока.</span><span class="sxs-lookup"><span data-stu-id="81655-135">[IPersistStream](/windows/win32/api/objidl/nn-objidl-ipersiststream) - To load data from a stream.</span></span> <span data-ttu-id="81655-136">Это более безопасно, чем использование файлов, так как на диск ничего не записывается.</span><span class="sxs-lookup"><span data-stu-id="81655-136">This is more secure than using files because nothing is written to disk.</span></span> <span data-ttu-id="81655-137">Интерфейс IPersistStream является предпочтительным методом для прямой совместимости с Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="81655-137">The IPersistStream interface is the preferred method for forward compatibility with Windows Vista.</span></span>
-   <span data-ttu-id="81655-138">[Интерфейс IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) — для загрузки данных из файла.</span><span class="sxs-lookup"><span data-stu-id="81655-138">[IPersistFile Interface](/windows/win32/api/objidl/nn-objidl-ipersistfile) - To load data from a file.</span></span> <span data-ttu-id="81655-139">Этот интерфейс не поддерживается в Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="81655-139">This interface is not supported in Windows Vista.</span></span>
-   <span data-ttu-id="81655-140">[Интерфейс иперсистстораже](/windows/win32/api/objidl/nn-objidl-ipersiststorage) — для загрузки данных из структурированного хранилища OLE COM.</span><span class="sxs-lookup"><span data-stu-id="81655-140">[IPersistStorage Interface](/windows/win32/api/objidl/nn-objidl-ipersiststorage) - To load data from an OLE COM Structured Storage.</span></span>

<span data-ttu-id="81655-141">Надстройка фильтра использует эти интерфейсы, чтобы получить содержимое элемента и вернуть их в индекс до конца файла.</span><span class="sxs-lookup"><span data-stu-id="81655-141">A filter add-in uses these interfaces to get the contents of the item and return them iteratively to the index until the end of the file is reached.</span></span> <span data-ttu-id="81655-142">Надстройка фильтра должна быть как можно более надежной для обработки поврежденных файлов и тех, которые не соответствуют ожидаемым входным форматам.</span><span class="sxs-lookup"><span data-stu-id="81655-142">A filter add-in should be as robust as possible to handle corrupt files and those that do not meet expected input formats.</span></span>

### <a name="ifilter-interface"></a><span data-ttu-id="81655-143">Интерфейс IFilter</span><span class="sxs-lookup"><span data-stu-id="81655-143">IFilter Interface</span></span>

<span data-ttu-id="81655-144">Это обязательный интерфейс для реализации фильтра.</span><span class="sxs-lookup"><span data-stu-id="81655-144">This is a required interface for a filter implementation.</span></span> <span data-ttu-id="81655-145">Дополнительные сведения см. в справочнике по интерфейсу [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter).</span><span class="sxs-lookup"><span data-stu-id="81655-145">For more information, see the [**IFilter**](/windows/desktop/api/filter/nn-filter-ifilter)interface reference.</span></span>



| <span data-ttu-id="81655-146">Метод</span><span class="sxs-lookup"><span data-stu-id="81655-146">Method</span></span>       | <span data-ttu-id="81655-147">Описание</span><span class="sxs-lookup"><span data-stu-id="81655-147">Description</span></span>                                                                            |
|--------------|----------------------------------------------------------------------------------------|
| <span data-ttu-id="81655-148">Init ()</span><span class="sxs-lookup"><span data-stu-id="81655-148">Init()</span></span>       | <span data-ttu-id="81655-149">Инициализирует сеанс фильтрации.</span><span class="sxs-lookup"><span data-stu-id="81655-149">Initializes a filtering session.</span></span>                                                       |
| <span data-ttu-id="81655-150">"Перефрагментировать" ()</span><span class="sxs-lookup"><span data-stu-id="81655-150">GetChunk()</span></span>   | <span data-ttu-id="81655-151">Размещает фильтр в начале первого или следующего фрагмента и возвращает дескриптор.</span><span class="sxs-lookup"><span data-stu-id="81655-151">Positions the filter at the beginning of first or next chunk and returns a descriptor.</span></span> |
| <span data-ttu-id="81655-152">Gettext ()</span><span class="sxs-lookup"><span data-stu-id="81655-152">GetText()</span></span>    | <span data-ttu-id="81655-153">Извлекает текст из текущего фрагмента.</span><span class="sxs-lookup"><span data-stu-id="81655-153">Retrieves text from the current chunk.</span></span>                                                 |
| <span data-ttu-id="81655-154">GetValue()</span><span class="sxs-lookup"><span data-stu-id="81655-154">GetValue()</span></span>   | <span data-ttu-id="81655-155">Извлекает значения свойств из текущего фрагмента.</span><span class="sxs-lookup"><span data-stu-id="81655-155">Retrieves property values from the current chunk.</span></span>                                      |
| <span data-ttu-id="81655-156">Биндрегион ()</span><span class="sxs-lookup"><span data-stu-id="81655-156">BindRegion()</span></span> | <span data-ttu-id="81655-157">В настоящее время зарезервировано для внутреннего использования; не реализуйте.</span><span class="sxs-lookup"><span data-stu-id="81655-157">Currently reserved for internal use; do not implement.</span></span> <span data-ttu-id="81655-158">Этот метод возвращает E \_ нотимпл.</span><span class="sxs-lookup"><span data-stu-id="81655-158">This method returns E\_NOTIMPL.</span></span> |



 

### <a name="ipersiststream"></a><span data-ttu-id="81655-159">IPersistStream</span><span class="sxs-lookup"><span data-stu-id="81655-159">IPersistStream</span></span>

<span data-ttu-id="81655-160">Этот интерфейс загружает файл из потока для более безопасной обработки, чем [интерфейс IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) , так как контекст, в котором выполняется фильтр [IPersistStream](/windows/win32/api/objidl/nn-objidl-ipersiststream) , не требует наличия прав на открытие файлов на диске или по сети.</span><span class="sxs-lookup"><span data-stu-id="81655-160">This interface loads a file from a stream for more secure processing than [IPersistFile Interface](/windows/win32/api/objidl/nn-objidl-ipersistfile) because the context in which a [IPersistStream](/windows/win32/api/objidl/nn-objidl-ipersiststream) filter runs does not need the rights to open any files on the disk or over the network.</span></span> <span data-ttu-id="81655-161">Из двух методов для доступа к одному файлу это предпочтительный метод для прямой совместимости с Windows.</span><span class="sxs-lookup"><span data-stu-id="81655-161">Of the two methods for accessing a single file, this is the preferred method for forward compatibility with Windows.</span></span>



| <span data-ttu-id="81655-162">Метод</span><span class="sxs-lookup"><span data-stu-id="81655-162">Method</span></span>       | <span data-ttu-id="81655-163">Описание</span><span class="sxs-lookup"><span data-stu-id="81655-163">Description</span></span>                                                                                                                                        |
|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="81655-164">IsDirty ()</span><span class="sxs-lookup"><span data-stu-id="81655-164">IsDirty()</span></span>    | <span data-ttu-id="81655-165">Проверяет, были ли изменения.</span><span class="sxs-lookup"><span data-stu-id="81655-165">Checks if there has been a change.</span></span> <span data-ttu-id="81655-166">Этот метод возвращает E \_ нотимпл в фильтрах.</span><span class="sxs-lookup"><span data-stu-id="81655-166">This method returns E\_NOTIMPL in filters.</span></span>                                                                      |
| <span data-ttu-id="81655-167">InitNew ()</span><span class="sxs-lookup"><span data-stu-id="81655-167">InitNew()</span></span>    | <span data-ttu-id="81655-168">Создает новое хранилище.</span><span class="sxs-lookup"><span data-stu-id="81655-168">Creates a new storage.</span></span> <span data-ttu-id="81655-169">Этот метод возвращает E \_ нотимпл в фильтрах.</span><span class="sxs-lookup"><span data-stu-id="81655-169">This method returns E\_NOTIMPL in filters.</span></span>                                                                                  |
| <span data-ttu-id="81655-170">Load ()</span><span class="sxs-lookup"><span data-stu-id="81655-170">Load()</span></span>       | <span data-ttu-id="81655-171">Инициализирует объект из потока, в котором он был предварительно сохранен.</span><span class="sxs-lookup"><span data-stu-id="81655-171">Initializes an object from the stream where it was previously saved.</span></span>                                                                               |
| <span data-ttu-id="81655-172">Save ()</span><span class="sxs-lookup"><span data-stu-id="81655-172">Save()</span></span>       | <span data-ttu-id="81655-173">Сохраняет объект в указанном потоке и указывает, должен ли объект сбрасывать свой «грязный» флаг.</span><span class="sxs-lookup"><span data-stu-id="81655-173">Saves an object into the specified stream and indicates whether the object should reset its dirty flag.</span></span> <span data-ttu-id="81655-174">Этот метод возвращает E \_ нотимпл в фильтрах.</span><span class="sxs-lookup"><span data-stu-id="81655-174">This method returns E\_NOTIMPL in filters.</span></span> |
| <span data-ttu-id="81655-175">Жетсиземакс ()</span><span class="sxs-lookup"><span data-stu-id="81655-175">GetSizeMax()</span></span> | <span data-ttu-id="81655-176">Возвращает размер потока, необходимого для сохранения объекта, в байтах.</span><span class="sxs-lookup"><span data-stu-id="81655-176">Returns the size in bytes of the stream needed to save the object.</span></span> <span data-ttu-id="81655-177">Этот метод возвращает E \_ нотимпл в фильтрах.</span><span class="sxs-lookup"><span data-stu-id="81655-177">This method returns E\_NOTIMPL in filters.</span></span>                                      |



 

### <a name="ipersistfile"></a><span data-ttu-id="81655-178">IPersistFile</span><span class="sxs-lookup"><span data-stu-id="81655-178">IPersistFile</span></span>

<span data-ttu-id="81655-179">Этот интерфейс загружает файл по абсолютному пути и не поддерживается в Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="81655-179">This interface loads a file by absolute path and is not supported in Windows Vista.</span></span>



| <span data-ttu-id="81655-180">Метод</span><span class="sxs-lookup"><span data-stu-id="81655-180">Method</span></span>          | <span data-ttu-id="81655-181">Описание</span><span class="sxs-lookup"><span data-stu-id="81655-181">Description</span></span>                                                                                                                  |
|-----------------|------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="81655-182">Жеткурфиле ()</span><span class="sxs-lookup"><span data-stu-id="81655-182">GetCurFile()</span></span>    | <span data-ttu-id="81655-183">Возвращает текущее имя файла, связанного с объектом.</span><span class="sxs-lookup"><span data-stu-id="81655-183">Gets the current name of the file associated with the object.</span></span> <span data-ttu-id="81655-184">Возвращает путь, указанный в Load ().</span><span class="sxs-lookup"><span data-stu-id="81655-184">Returns the path specified in Load().</span></span>                          |
| <span data-ttu-id="81655-185">Load ()</span><span class="sxs-lookup"><span data-stu-id="81655-185">Load()</span></span>          | <span data-ttu-id="81655-186">Открывает указанный файл и инициализирует объект из содержимого файла.</span><span class="sxs-lookup"><span data-stu-id="81655-186">Opens the specified file and initializes an object from the file contents.</span></span> <span data-ttu-id="81655-187">Вы можете отложить открытие файла, пока он не понадобится.</span><span class="sxs-lookup"><span data-stu-id="81655-187">You can delay opening the file until you need it.</span></span> |
| <span data-ttu-id="81655-188">-ClassID ()</span><span class="sxs-lookup"><span data-stu-id="81655-188">GetClassID()</span></span>    | <span data-ttu-id="81655-189">Возвращает идентификатор класса (CLSID) для нового типа файла.</span><span class="sxs-lookup"><span data-stu-id="81655-189">Returns the class identifier (CLSID) for the new file type.</span></span> <span data-ttu-id="81655-190">Для создания уникального идентификатора CLSID следует использовать uuidgen.exe.</span><span class="sxs-lookup"><span data-stu-id="81655-190">You should use uuidgen.exe to generate a unique CLSID.</span></span>           |
| <span data-ttu-id="81655-191">IsDirty ()</span><span class="sxs-lookup"><span data-stu-id="81655-191">IsDirty()</span></span>       | <span data-ttu-id="81655-192">Требуется только возврат E \_ нотимпл в фильтрах</span><span class="sxs-lookup"><span data-stu-id="81655-192">Need only return E\_NOTIMPL in filters</span></span>                                                                                       |
| <span data-ttu-id="81655-193">Save ()</span><span class="sxs-lookup"><span data-stu-id="81655-193">Save()</span></span>          | <span data-ttu-id="81655-194">Требуется только возврат E \_ нотимпл в фильтрах</span><span class="sxs-lookup"><span data-stu-id="81655-194">Need only return E\_NOTIMPL in filters</span></span>                                                                                       |
| <span data-ttu-id="81655-195">Савекомплетед ()</span><span class="sxs-lookup"><span data-stu-id="81655-195">SaveCompleted()</span></span> | <span data-ttu-id="81655-196">Требуется только возврат E \_ нотимпл в фильтрах</span><span class="sxs-lookup"><span data-stu-id="81655-196">Need only return E\_NOTIMPL in filters</span></span>                                                                                       |



 

### <a name="ipersiststorage"></a><span data-ttu-id="81655-197">иперсистстораже</span><span class="sxs-lookup"><span data-stu-id="81655-197">IPersistStorage</span></span>

<span data-ttu-id="81655-198">Этот интерфейс поддерживает структурированную модель хранения, в которой каждый содержащийся объект имеет собственное хранилище, вложенное в хранилище контейнера.</span><span class="sxs-lookup"><span data-stu-id="81655-198">This interface supports the structured storage model, in which each contained object has its own storage that is nested within the container's storage.</span></span> <span data-ttu-id="81655-199">Как и [интерфейс IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile), этот интерфейс загружается по абсолютному пути и не поддерживается в Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="81655-199">Like [IPersistFile Interface](/windows/win32/api/objidl/nn-objidl-ipersistfile), this interface loads by absolute path and is not supported in Windows Vista.</span></span>



| <span data-ttu-id="81655-200">Метод</span><span class="sxs-lookup"><span data-stu-id="81655-200">Method</span></span>            | <span data-ttu-id="81655-201">Описание</span><span class="sxs-lookup"><span data-stu-id="81655-201">Description</span></span>                                                                                                   |
|-------------------|---------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="81655-202">IsDirty ()</span><span class="sxs-lookup"><span data-stu-id="81655-202">IsDirty()</span></span>         | <span data-ttu-id="81655-203">Проверяет, были ли изменения.</span><span class="sxs-lookup"><span data-stu-id="81655-203">Checks if there has been a change.</span></span> <span data-ttu-id="81655-204">Этот метод возвращает E \_ нотимпл в фильтрах.</span><span class="sxs-lookup"><span data-stu-id="81655-204">This method returns E\_NOTIMPL in filters.</span></span>                                 |
| <span data-ttu-id="81655-205">InitNew ()</span><span class="sxs-lookup"><span data-stu-id="81655-205">InitNew()</span></span>         | <span data-ttu-id="81655-206">Создает новое хранилище.</span><span class="sxs-lookup"><span data-stu-id="81655-206">Creates a new storage.</span></span> <span data-ttu-id="81655-207">Этот метод возвращает E \_ нотимпл в фильтрах.</span><span class="sxs-lookup"><span data-stu-id="81655-207">This method returns E\_NOTIMPL in filters.</span></span>                                             |
| <span data-ttu-id="81655-208">Load ()</span><span class="sxs-lookup"><span data-stu-id="81655-208">Load()</span></span>            | <span data-ttu-id="81655-209">Сохраняет хранилище.</span><span class="sxs-lookup"><span data-stu-id="81655-209">Saves the storage.</span></span> <span data-ttu-id="81655-210">Этот метод возвращает E \_ нотимпл в фильтрах.</span><span class="sxs-lookup"><span data-stu-id="81655-210">This method returns E\_NOTIMPL in filters.</span></span>                                                 |
| <span data-ttu-id="81655-211">Save ()</span><span class="sxs-lookup"><span data-stu-id="81655-211">Save()</span></span>            | <span data-ttu-id="81655-212">Возвращает размер потока, необходимого для сохранения объекта, в байтах.</span><span class="sxs-lookup"><span data-stu-id="81655-212">Returns the size in bytes of the stream needed to save the object.</span></span> <span data-ttu-id="81655-213">Этот метод возвращает E \_ нотимпл в фильтрах.</span><span class="sxs-lookup"><span data-stu-id="81655-213">This method returns E\_NOTIMPL in filters.</span></span> |
| <span data-ttu-id="81655-214">Савекомплетед ()</span><span class="sxs-lookup"><span data-stu-id="81655-214">SaveCompleted()</span></span>   | <span data-ttu-id="81655-215">Зарезервировано для внутреннего использования.</span><span class="sxs-lookup"><span data-stu-id="81655-215">Reserved for internal use.</span></span> <span data-ttu-id="81655-216">Этот метод возвращает E \_ нотимпл в фильтрах.</span><span class="sxs-lookup"><span data-stu-id="81655-216">This method returns E\_NOTIMPL in filters.</span></span>                                         |
| <span data-ttu-id="81655-217">Хандсоффстораже ()</span><span class="sxs-lookup"><span data-stu-id="81655-217">HandsOffStorage()</span></span> | <span data-ttu-id="81655-218">Зарезервировано для внутреннего использования.</span><span class="sxs-lookup"><span data-stu-id="81655-218">Reserved for internal use.</span></span> <span data-ttu-id="81655-219">Этот метод возвращает E \_ нотимпл в фильтрах.</span><span class="sxs-lookup"><span data-stu-id="81655-219">This method returns E\_NOTIMPL in filters.</span></span>                                         |



 

## <a name="outputting-properties-with-filters"></a><span data-ttu-id="81655-220">Вывод свойств с фильтрами</span><span class="sxs-lookup"><span data-stu-id="81655-220">Outputting Properties with Filters</span></span>

<span data-ttu-id="81655-221">Назначение фильтра — извлечение содержимого и свойств файлов для включения в полнотекстовый индекс.</span><span class="sxs-lookup"><span data-stu-id="81655-221">The purpose of a filter is to extract the content and properties of files for inclusion in the full-text index.</span></span> <span data-ttu-id="81655-222">Сначала WDS вызывает метод Load для реализаций IPersistFile, IPersistStream или Иперсистстораже, а затем вызывает метод init реализации IFilter.</span><span class="sxs-lookup"><span data-stu-id="81655-222">WDS first calls the Load method on either the IPersistFile, IPersistStream, or IPersistStorage implementations and then invokes the Init method of the IFilter implementation.</span></span> <span data-ttu-id="81655-223">Метод **gettext вызывается** для извлечения фрагментов данных текста или значений свойств, а затем метод **gettext** или **GetValue** вызывается столько раз, сколько необходимо для получения всех значений текста или свойств, связанных с фрагментом.</span><span class="sxs-lookup"><span data-stu-id="81655-223">**GetChunk** is called to retrieve chunks of text or property value data, and then either **GetText** or **GetValue** is called as many times as needed to retrieve all of the text or property values associated with the chunk.</span></span> <span data-ttu-id="81655-224">Этот процесс повторяется до **тех** пор, пока не будет выводится сообщение о том, что в документе больше нет блоков.</span><span class="sxs-lookup"><span data-stu-id="81655-224">This process repeats until **GetChunk** reports that there are no more chunks in the document.</span></span>

<span data-ttu-id="81655-225">Метод **GetNext** извлекает сведения о первом или следующем логическом блоке данных из фильтруемого файла и возвращает эти сведения в \_ структуре блока Stat, включая монотонно увеличивающийся идентификатор блока, сведения о состоянии текущего фрагмента, относящиеся к предыдущему фрагменту, флаг, указывающий, содержит ли фрагмент текст или значение, языковой стандарт фрагмента и спецификацию свойства блока.</span><span class="sxs-lookup"><span data-stu-id="81655-225">The **GetChunk** method retrieves information about the first or next logical block of information from the file being filtered and returns that information in a STAT\_CHUNK structure, including a monotonically increasing chunk ID, status information about how the current chunk relates to the previous chunk, a flag indicating whether the chunk contains text or a value, the chunk's locale, and the chunk's property specification.</span></span> <span data-ttu-id="81655-226">Спецификация свойства — это [**фуллпропспек**](/windows/desktop/api/filter/ns-filter-fullpropspec) , состоящий из идентификатора CLSID и целочисленного или строкового свойства (например, D5CDD505-2E9C-101B-9397-08002B2CF9AE/PerceivedType).</span><span class="sxs-lookup"><span data-stu-id="81655-226">The property specification is a [**FULLPROPSPEC**](/windows/desktop/api/filter/ns-filter-fullpropspec) consisting of a CLSID and either an integer or string property identifier (for example, D5CDD505-2E9C-101B-9397-08002B2CF9AE/PerceivedType).</span></span> <span data-ttu-id="81655-227">Он определяет тип свойства, а не само значение свойства.</span><span class="sxs-lookup"><span data-stu-id="81655-227">It identifies the type of property rather than the property value itself.</span></span>

<span data-ttu-id="81655-228">Идентификатор локали блока используется для выбора подходящего средство разбиения по словам, и очень важно правильно его определить.</span><span class="sxs-lookup"><span data-stu-id="81655-228">The chunk locale identifier is used to choose an appropriate word breaker, and it is very important that you correctly identify it.</span></span> <span data-ttu-id="81655-229">Если фильтр не может определить языковой стандарт для текста, он должен использовать языковой стандарт системы по умолчанию, доступный с помощью **жетсистемдефаултлЦид**.</span><span class="sxs-lookup"><span data-stu-id="81655-229">If the filter cannot determine the locale of the text, it should assume the default system locale, available by using **GetSystemDefaultLCID**.</span></span> <span data-ttu-id="81655-230">Если вы управляете форматом файла и в настоящее время он не содержит сведений о языковых стандартах, необходимо добавить функцию пользователя, чтобы обеспечить правильную идентификацию языкового стандарта.</span><span class="sxs-lookup"><span data-stu-id="81655-230">If you control the file format and it currently does not contain locale information, you should add a user feature to enable proper locale identification.</span></span> <span data-ttu-id="81655-231">Использование непарного средства разбиения по словам может привести к неправильному использованию запросов пользователя.</span><span class="sxs-lookup"><span data-stu-id="81655-231">Using a mismatched word breaker can lead to a bad query experience for the user.</span></span>

<span data-ttu-id="81655-232"> Параметр gettext управляет доступом к блокам и не возвращает само значение текста или свойства.</span><span class="sxs-lookup"><span data-stu-id="81655-232">**GetChunk** only manages accessing chunks and does not return the text or property value itself.</span></span> <span data-ttu-id="81655-233">Вместо этого последующие вызовы **gettext** и **GetValue** извлекают текст фрагмента.</span><span class="sxs-lookup"><span data-stu-id="81655-233">Rather, subsequent calls to **GetText** and **GetValue** retrieve the body of the chunk.</span></span> <span data-ttu-id="81655-234">Функция **gettext Возвращает** фрагменты текста, которые являются строками в Юникоде, из текущего \_ ФРАГМЕНТа текста фрагмента.</span><span class="sxs-lookup"><span data-stu-id="81655-234">**GetText** returns text chunks, which are Unicode strings, from the current CHUNK\_TEXT chunk.</span></span> <span data-ttu-id="81655-235">Если текущий фрагмент слишком велик, может потребоваться более одного вызова метода **gettext** .</span><span class="sxs-lookup"><span data-stu-id="81655-235">If the current chunk is too large, more than one call to the **GetText** method can be required.</span></span> <span data-ttu-id="81655-236">Каждый вызов метода **gettext** извлекает текст, который сразу же следует за текстом из последнего вызова метода **gettext** .</span><span class="sxs-lookup"><span data-stu-id="81655-236">Each call to the **GetText** method retrieves text that immediately follows the text from the last call to the **GetText** method.</span></span> <span data-ttu-id="81655-237">Например, последний символ из одного вызова может располагаться в середине слова, а первый символ в следующем вызове продолжит это слово.</span><span class="sxs-lookup"><span data-stu-id="81655-237">For example, the last character from one call can be in the middle of a word, and the first character in the next call would continue that word.</span></span> <span data-ttu-id="81655-238">Механизм поиска должен справиться с этой ситуацией.</span><span class="sxs-lookup"><span data-stu-id="81655-238">Search engines must handle this situation.</span></span>

<span data-ttu-id="81655-239">Функция **GetValue** возвращает значения свойств для \_ фрагмента текущего значения фрагмента в структурах пропвариант, которые могут содержать разнообразные типы данных.</span><span class="sxs-lookup"><span data-stu-id="81655-239">**GetValue** returns property values for the current CHUNK\_VALUE chunk in PROPVARIANT structures, which can hold a wide variety of data types.</span></span> <span data-ttu-id="81655-240">**GetValue** должен выделить структуру пропвариант, используя CoTaskMemAlloc.</span><span class="sxs-lookup"><span data-stu-id="81655-240">**GetValue** must allocate the PROPVARIANT structure itself using CoTaskMemAlloc.</span></span> <span data-ttu-id="81655-241">Вызывающий метод **GetValue** отвечает за освобождение памяти, на которую указывает пропвариант, с помощью пропвариантклеар, а также освобождает структуру с помощью CoTaskMemFree.</span><span class="sxs-lookup"><span data-stu-id="81655-241">The caller of **GetValue** is responsible for freeing memory pointed to by the PROPVARIANT using PropVariantClear, and for freeing the structure itself with CoTaskMemFree.</span></span> <span data-ttu-id="81655-242">Дополнительные сведения о Пропвариантс см. в справочнике по [пропвариант](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) .</span><span class="sxs-lookup"><span data-stu-id="81655-242">For more information on PROPVARIANTs, see the [PROPVARIANT](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) reference.</span></span>

### <a name="property-values"></a><span data-ttu-id="81655-243">Значения свойств</span><span class="sxs-lookup"><span data-stu-id="81655-243">Property Values</span></span>

<span data-ttu-id="81655-244">Фильтры должны выводить как минимум следующие свойства, которые являются столбцами по умолчанию в представлении результатов WDS.</span><span class="sxs-lookup"><span data-stu-id="81655-244">Filters should output at a minimum the following properties which are the default columns in the WDS results view.</span></span>



| <span data-ttu-id="81655-245">Код GUID</span><span class="sxs-lookup"><span data-stu-id="81655-245">GUID</span></span>                                 | <span data-ttu-id="81655-246">пропспек</span><span class="sxs-lookup"><span data-stu-id="81655-246">PROPSPEC</span></span>      | <span data-ttu-id="81655-247">Понятное имя</span><span class="sxs-lookup"><span data-stu-id="81655-247">Friendly Name</span></span>  | <span data-ttu-id="81655-248">Описание</span><span class="sxs-lookup"><span data-stu-id="81655-248">Description</span></span>                                                                                                                                     |
|--------------------------------------|---------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="81655-249">F29F85E0-4FF9-1068-AB91-08002B27B3D9</span><span class="sxs-lookup"><span data-stu-id="81655-249">F29F85E0-4FF9-1068-AB91-08002B27B3D9</span></span> | <span data-ttu-id="81655-250">2</span><span class="sxs-lookup"><span data-stu-id="81655-250">2</span></span>             | <span data-ttu-id="81655-251">примарититле</span><span class="sxs-lookup"><span data-stu-id="81655-251">PrimaryTitle</span></span>   | <span data-ttu-id="81655-252">Заголовок, отображаемый для этого элемента.</span><span class="sxs-lookup"><span data-stu-id="81655-252">Title that displays for this item.</span></span>                                                                                                              |
| <span data-ttu-id="81655-253">F29F85E0-4FF9-1068-AB91-08002B27B3D9</span><span class="sxs-lookup"><span data-stu-id="81655-253">F29F85E0-4FF9-1068-AB91-08002B27B3D9</span></span> | <span data-ttu-id="81655-254">4</span><span class="sxs-lookup"><span data-stu-id="81655-254">4</span></span>             | <span data-ttu-id="81655-255">примаряусорс</span><span class="sxs-lookup"><span data-stu-id="81655-255">PrimaryAuthors</span></span> | <span data-ttu-id="81655-256">Лицо, наиболее связанное с этим элементом.</span><span class="sxs-lookup"><span data-stu-id="81655-256">Person most associated with this item.</span></span>                                                                                                          |
| <span data-ttu-id="81655-257">D5CDD505-2E9C-101B-9397-08002B2CF9AE</span><span class="sxs-lookup"><span data-stu-id="81655-257">D5CDD505-2E9C-101B-9397-08002B2CF9AE</span></span> | <span data-ttu-id="81655-258">примаридате</span><span class="sxs-lookup"><span data-stu-id="81655-258">PrimaryDate</span></span>   | <span data-ttu-id="81655-259">примаридате</span><span class="sxs-lookup"><span data-stu-id="81655-259">PrimaryDate</span></span>    | <span data-ttu-id="81655-260">Наиболее важная дата для элемента, например Дата получения сообщения электронной почты или изменения для файлов.</span><span class="sxs-lookup"><span data-stu-id="81655-260">Most important date for item, like date received for email or modified for files.</span></span>                                                               |
| <span data-ttu-id="81655-261">D5CDD505-2E9C-101B-9397-08002B2CF9AE</span><span class="sxs-lookup"><span data-stu-id="81655-261">D5CDD505-2E9C-101B-9397-08002B2CF9AE</span></span> | <span data-ttu-id="81655-262">PerceivedType</span><span class="sxs-lookup"><span data-stu-id="81655-262">PerceivedType</span></span> | <span data-ttu-id="81655-263">PerceivedType</span><span class="sxs-lookup"><span data-stu-id="81655-263">PerceivedType</span></span>  | <span data-ttu-id="81655-264">Тип анализируемого файла.</span><span class="sxs-lookup"><span data-stu-id="81655-264">Type of file being parsed.</span></span> <span data-ttu-id="81655-265">Должен соответствовать одному из типов поиска на рабочем столе Windows, перечисленных в списке [наблюдаемый тип](-search-2x-wds-perceivedtype.md)WDS.</span><span class="sxs-lookup"><span data-stu-id="81655-265">Must match one of the Windows Desktop Search types listed in WDS [Perceived Type](-search-2x-wds-perceivedtype.md).</span></span> |



 

<span data-ttu-id="81655-266">Для элементов с открытым текстом WDS извлекает все текстовые и определяемые системой свойства, такие как размер файла или расширение, в том числе новые типы файлов с открытым текстом в индексе).</span><span class="sxs-lookup"><span data-stu-id="81655-266">For plaintext items, WDS extracts all text and system-defined properties such as file size or extension on including new plaintext file types to the index).</span></span> <span data-ttu-id="81655-267">Другие типы свойств, которые могут быть возвращены в индекс, включают:</span><span class="sxs-lookup"><span data-stu-id="81655-267">Other types of properties that can be returned to the index include:</span></span>

-   <span data-ttu-id="81655-268">Для файлов: автор, заголовок, состояние, ключевые слова</span><span class="sxs-lookup"><span data-stu-id="81655-268">For files: author, title, status, keywords</span></span>
-   <span data-ttu-id="81655-269">Для мультимедиа: альбом, жанр, Марка камеры, Дата съемки</span><span class="sxs-lookup"><span data-stu-id="81655-269">For media: album, genre, camera make, date taken</span></span>
-   <span data-ttu-id="81655-270">Для связи: от, кому, копия, важность</span><span class="sxs-lookup"><span data-stu-id="81655-270">For communications: from, to, cc, importance</span></span>
-   <span data-ttu-id="81655-271">Для контактов: должность, Рабочий телефон, компания</span><span class="sxs-lookup"><span data-stu-id="81655-271">For contacts: job title, business phone, company</span></span>

<span data-ttu-id="81655-272">Приведенный выше список группирует свойства, общие с указанным распознанным типом. Однако любое свойство можно использовать независимо от типа.</span><span class="sxs-lookup"><span data-stu-id="81655-272">The list above groups properties common to a specified Perceived Type; however, any property can be used regardless of the type.</span></span> <span data-ttu-id="81655-273">Например, компания может использовать имя работодателя контакта и может также использоваться для ссылки на имя клиента, к которому относится файл.</span><span class="sxs-lookup"><span data-stu-id="81655-273">For example, company could be used for a contact's employer name and could also be used to refer to the name of a client the file relates to.</span></span> <span data-ttu-id="81655-274">Многие из этих свойств используются для отображения результатов поиска в представлении результатов WDS.</span><span class="sxs-lookup"><span data-stu-id="81655-274">Many of these properties are used to display search results in the WDS results view.</span></span> <span data-ttu-id="81655-275">Например, свойство Title файла отображается как основной столбец в представлении результатов по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="81655-275">For example, a file's Title property is shown as the main column in the default results view.</span></span> <span data-ttu-id="81655-276">Объекты IFilter должны выводить все свойства, связанные с типом элемента, который они анализируют.</span><span class="sxs-lookup"><span data-stu-id="81655-276">IFilter objects should output all the properties related to the item type they are parsing.</span></span> <span data-ttu-id="81655-277">Пользовательские свойства нельзя добавить в WDS 2. x.</span><span class="sxs-lookup"><span data-stu-id="81655-277">Custom properties cannot be added in WDS 2.x.</span></span> <span data-ttu-id="81655-278">Полный список доступных свойств см. в статье [схема WDS](-search-2x-wds-schematable.md).</span><span class="sxs-lookup"><span data-stu-id="81655-278">For a full list of properties available, see the [WDS Schema](-search-2x-wds-schematable.md).</span></span>

## <a name="filter-add-in-installation"></a><span data-ttu-id="81655-279">Установка надстройки фильтра</span><span class="sxs-lookup"><span data-stu-id="81655-279">Filter Add-in Installation</span></span>

<span data-ttu-id="81655-280">Установка фильтра предполагает копирование библиотеки DLL в соответствующее расположение в каталоге Program Files и его регистрацию.</span><span class="sxs-lookup"><span data-stu-id="81655-280">Installing the filter involves copying the DLL to an appropriate location in the Program Files directory and registering it.</span></span> <span data-ttu-id="81655-281">Фильтры должны реализовать самостоятельную регистрацию для установки и следовать приведенным ниже рекомендациям.</span><span class="sxs-lookup"><span data-stu-id="81655-281">Filters should implement self-registration for installation and should follow these guidelines:</span></span>

-   <span data-ttu-id="81655-282">Установщик должен использовать установщик EXE или MSI.</span><span class="sxs-lookup"><span data-stu-id="81655-282">The installer must use either EXE or MSI installer.</span></span>
-   <span data-ttu-id="81655-283">Необходимо указать заметки о выпуске.</span><span class="sxs-lookup"><span data-stu-id="81655-283">Release notes must be provided.</span></span>
-   <span data-ttu-id="81655-284">Для каждой установленной надстройки необходимо создать запись « **Установка и удаление программ** ».</span><span class="sxs-lookup"><span data-stu-id="81655-284">An **Add/Remove Programs** entry must be created for each add-in installed.</span></span>
-   <span data-ttu-id="81655-285">Установщик должен задействовать все параметры реестра для конкретного типа файлов или хранить данные, распознаваемые текущей надстройкой.</span><span class="sxs-lookup"><span data-stu-id="81655-285">The installer must take over all registry settings for the particular file type or store that the current add-in understands.</span></span>
-   <span data-ttu-id="81655-286">Если предыдущая надстройка перезаписывается, установщик должен уведомить пользователя.</span><span class="sxs-lookup"><span data-stu-id="81655-286">If a previous add-in is being overwritten, the installer should notify the user.</span></span>
-   <span data-ttu-id="81655-287">Если более новая надстройка перезаписала предыдущую надстройку, то должна быть возможность восстановить функциональность предыдущей надстройки и сделать ее надстройкой по умолчанию для этого типа файла или хранилища.</span><span class="sxs-lookup"><span data-stu-id="81655-287">If a newer add-in has overwritten the previous add-in, there should be the ability to restore the previous add-in's functionality and make it the default add-in for that file type or store again.</span></span>

### <a name="clsids-required-for-registration"></a><span data-ttu-id="81655-288">Идентификаторы CLSID, необходимые для регистрации</span><span class="sxs-lookup"><span data-stu-id="81655-288">CLSIDs Required for Registration</span></span>

<span data-ttu-id="81655-289">Существует три идентификатора класса (CLSID), связанных с каждым фильтром.</span><span class="sxs-lookup"><span data-stu-id="81655-289">There are three class identifiers, or CLSIDs, associated with every filter.</span></span> <span data-ttu-id="81655-290">Необходимо создать один или несколько из них (используйте uuidgen.exe) для регистрации надстройки фильтра.</span><span class="sxs-lookup"><span data-stu-id="81655-290">You'll need to generate one or more of these (use uuidgen.exe) to register your filter add-in.</span></span>

-   <span data-ttu-id="81655-291">Первый определяет постоянный обработчик, IID \_ IFilter, который имеет значение {89BCB740-6119-101A-BCB7-00DD010655AF}.</span><span class="sxs-lookup"><span data-stu-id="81655-291">The first identifies all filters' persistent handler, IID\_IFilter, which is {89BCB740-6119-101A-BCB7-00DD010655AF}.</span></span> <span data-ttu-id="81655-292">Этот идентификатор CLSID является константой для всех фильтров, реализующих интерфейс IFilter.</span><span class="sxs-lookup"><span data-stu-id="81655-292">This CLSID is constant for all filters that implement IFilter.</span></span>
-   <span data-ttu-id="81655-293">Второй (значение \_ ключа IFILTER IID) определяет реализацию IFilter для типа файла.</span><span class="sxs-lookup"><span data-stu-id="81655-293">The second (the value of the IID\_IFilter key) identifies the IFilter implementation for your file type.</span></span> <span data-ttu-id="81655-294">Этот ключ содержит значение InprocServer32, указывающее имя библиотеки DLL по пути и потоковой модели.</span><span class="sxs-lookup"><span data-stu-id="81655-294">This key contains an InprocServer32 value that specifies the DLL name by path and the threading model.</span></span> <span data-ttu-id="81655-295">Если фильтр находится в системном пути, например в каталоге System32, достаточно имени файла.</span><span class="sxs-lookup"><span data-stu-id="81655-295">If the filter is in the system path, like the system32 directory, a file name is sufficient.</span></span> <span data-ttu-id="81655-296">В противном случае это значение должно иметь полную спецификацию пути.</span><span class="sxs-lookup"><span data-stu-id="81655-296">Otherwise, this value should have a full path specification.</span></span>
-   <span data-ttu-id="81655-297">Третья определяет тип файла, который обрабатывает фильтр, и возвращается методом WebMethod в интерфейсе IPersist.</span><span class="sxs-lookup"><span data-stu-id="81655-297">The third identifies the file type the filter processes and is returned by the GetClassID method on your IPersist interface.</span></span>

> [!Note]
>
> <span data-ttu-id="81655-298">В будущих версиях операционных систем Майкрософт установка файлов в каталоге System32 может оказаться более сложной, поэтому рекомендуется установить их в разделе Program Files и включить полный путь к фильтру в реестре.</span><span class="sxs-lookup"><span data-stu-id="81655-298">In future versions of Microsoft operating systems, installing files in the system32 directory may get more difficult, so we recommend you install them under Program Files and include a full path to the filter in the registry.</span></span> <span data-ttu-id="81655-299">По соображениям безопасности также целесообразно указать полный путь к библиотеке DLL в реестре.</span><span class="sxs-lookup"><span data-stu-id="81655-299">For security reasons, it is also prudent to specify a full path to your DLL in the registry.</span></span> <span data-ttu-id="81655-300">В противном случае можно загрузить версию библиотеки DLL «троянский конь», если она будет находиться в пути обработки до вашей версии.</span><span class="sxs-lookup"><span data-stu-id="81655-300">Otherwise, a "Trojan horse" version of your DLL could be loaded if it happens to be in the process path before your version.</span></span>

 

### <a name="registration-model"></a><span data-ttu-id="81655-301">Модель регистрации</span><span class="sxs-lookup"><span data-stu-id="81655-301">Registration Model</span></span>

<span data-ttu-id="81655-302">Когда WDS готова к фильтрации файла, он ищет в реестре расширение файла, чтобы определить, какой именно фильтр нужно загрузить.</span><span class="sxs-lookup"><span data-stu-id="81655-302">When WDS is ready to filter a file, it looks in the registry under the file's extension to determine which filter to load.</span></span> <span data-ttu-id="81655-303">Затем он выполняет ряд ссылок реестра для поиска имени библиотеки DLL фильтра в следующем порядке:</span><span class="sxs-lookup"><span data-stu-id="81655-303">It then follows a series of registry links to find the name of the filter DLL, in this order:</span></span>

1.  <span data-ttu-id="81655-304">Из идентификаторов CLSID, расположенных по адресу:</span><span class="sxs-lookup"><span data-stu-id="81655-304">From CLSIDs located at:</span></span>

    <span data-ttu-id="81655-305">**HKEY \_ текущее \_ пользовательское \\ программное обеспечение \\ Microsoft \\ рссеарч \\ контентиндекскоммон \\ Filters \\ override \\ рсапп**</span><span class="sxs-lookup"><span data-stu-id="81655-305">**HKEY\_CURRENT\_USER\\SOFTWARE\\Microsoft\\RSSearch\\ContentIndexCommon\\Filters\\Override\\RSApp**</span></span>

    <span data-ttu-id="81655-306">**HKEY \_ текущее \_ пользовательское \\ программное обеспечение \\ Microsoft \\ рссеарч \\ контентиндекскоммон \\ Filters**</span><span class="sxs-lookup"><span data-stu-id="81655-306">**HKEY\_CURRENT\_USER\\SOFTWARE\\Microsoft\\RSSearch\\ContentIndexCommon\\Filters**</span></span>

2.  <span data-ttu-id="81655-307">Из типа содержимого файла в:</span><span class="sxs-lookup"><span data-stu-id="81655-307">From the file content type at:</span></span>

    <span data-ttu-id="81655-308">**\_ \_ \\ \\ \\ \\ Тип содержимого базы данных MIME для классов \\ по локальному компьютеру hKey**</span><span class="sxs-lookup"><span data-stu-id="81655-308">**HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Classes\\MIME\\Database\\Content Type**</span></span>

3.  <span data-ttu-id="81655-309">Из расширения имени файла (то же, что и Win32 Лоадифилтер API) в:</span><span class="sxs-lookup"><span data-stu-id="81655-309">From the file name extension (same as Win32 LoadIFilter API) at:</span></span>

    <span data-ttu-id="81655-310">**HKEY \_ текущее \_ пользовательское \\ программное обеспечение \\ Microsoft \\ рссеарч \\ контентиндекскоммон \\ Filters \\ override \\ рсапп**</span><span class="sxs-lookup"><span data-stu-id="81655-310">**HKEY\_CURRENT\_USER\\SOFTWARE\\Microsoft\\RSSearch\\ContentIndexCommon\\Filters\\Override\\RSApp**</span></span>

    <span data-ttu-id="81655-311">**HKEY \_ текущее \_ пользовательское \\ программное обеспечение \\ Microsoft \\ рссеарч \\ контентиндекскоммон \\ Filters**</span><span class="sxs-lookup"><span data-stu-id="81655-311">**HKEY\_CURRENT\_USER\\SOFTWARE\\Microsoft\\RSSearch\\ContentIndexCommon\\Filters**</span></span>

    <span data-ttu-id="81655-312">**\_Классы hKey \_ root \\ ЕКСТПЕРСИСТЕНСАНДЛЕР->CLSID->IID \_ IFilter->CLSID**</span><span class="sxs-lookup"><span data-stu-id="81655-312">**HKEY\_CLASSES\_ROOT\\extpersistentHandler->CLSID->IID\_IFilter->CLSID**</span></span>

4.  <span data-ttu-id="81655-313">По умолчанию:</span><span class="sxs-lookup"><span data-stu-id="81655-313">From Default at:</span></span>

    <span data-ttu-id="81655-314">**HKEY \_ локальный \_ компьютер \\ программное обеспечение \\ Microsoft \\ рссеарч \\ контентиндекскоммон \\ Filters**</span><span class="sxs-lookup"><span data-stu-id="81655-314">**HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\RSSearch\\ContentIndexCommon\\Filters**</span></span>

### <a name="to-register-a-filter-add-in"></a><span data-ttu-id="81655-315">Регистрация надстройки фильтра</span><span class="sxs-lookup"><span data-stu-id="81655-315">To Register a Filter Add-in</span></span>

<span data-ttu-id="81655-316">Чтобы зарегистрировать надстройку фильтра, необходимо сделать всего восемь записей в реестре, где:</span><span class="sxs-lookup"><span data-stu-id="81655-316">You need to make a total of eight entries in the registry to register your filter add-in, where:</span></span>

-   <span data-ttu-id="81655-317">**. ext** — новое расширение имени файла.</span><span class="sxs-lookup"><span data-stu-id="81655-317">**.ext** is the new file name extension</span></span>
-   <span data-ttu-id="81655-318">**GUID \_ 1** может быть любым новым идентификатором GUID, созданным для этого расширения.</span><span class="sxs-lookup"><span data-stu-id="81655-318">**GUID\_1** can be any new GUID generated for this extension</span></span>
-   <span data-ttu-id="81655-319">**89BCB740-6119-101A-BCB7-00DD010655AF** — это GUID интерфейса IFilter, который является константой для всех реализаций IFilter.</span><span class="sxs-lookup"><span data-stu-id="81655-319">**89BCB740-6119-101A-BCB7-00DD010655AF** is the IFilter interface GUID, which is a constant for all IFilter implementations.</span></span>

1.  <span data-ttu-id="81655-320">Зарегистрируйте постоянный обработчик для расширения имени файла со следующими ключами и значениями:</span><span class="sxs-lookup"><span data-stu-id="81655-320">Register the persistent handler for the file name extension with the following keys and values:</span></span>

    ```
    HKEY_CLASSES_ROOT\<.ext>\PersistentHandler
       (Default) = {GUID_1}
    ```

    ```
    HKEY_CLASSES_ROOT\CLSID\{GUID_1}
       (Default) = <Persistent Handler Description>
    ```

    ```
    HKEY_CLASSES_ROOT\CLSID\{GUID_1}\PersistentAddinsRegistered
       (Default) = (Value Not Set)
    ```

    ```
    HKEY_CLASSES_ROOT\CLSID\{GUID_1}\PersistentAddinsRegistered\{89BCB740-6119-101A-BCB7-00DD010655AF}
       (Default) = {CLSID of IFilter implementation}
    ```

    ```
    HKEY_CLASSES_ROOT\CLSID\{GUID_1}\PersistentHandler
       (Default) = {GUID_1}
    ```

2.  <span data-ttu-id="81655-321">Зарегистрируйте реализацию IFilter со следующими ключами и значениями:</span><span class="sxs-lookup"><span data-stu-id="81655-321">Register the IFilter implementation with the following keys and values:</span></span>

    ```
    HKEY_CLASSES_ROOT\CLSID\{CLSID of IFilter implementation}
       (Default) = Extension IFilter Description">
    ```

    ```
    HKEY_CLASSES_ROOT\CLSID\{CLSID of IFilter implementation}\InprocServer32
       (Default) = <DLL Install Path>
       ThreadingModel = Both
    ```

3.  <span data-ttu-id="81655-322">Зарегистрируйте реализацию IFilter с помощью Windows Desktop Search со следующим ключом и значением:</span><span class="sxs-lookup"><span data-stu-id="81655-322">Register the IFilter implementation with Windows Desktop Search with the following key and value:</span></span>

    ```
    HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\RSSearch\ContentIndexCommon\Filters\Extension\<.ext>
       (Default) = {CLSID of IFilter implementation}"
    ```

## <a name="related-topics"></a><span data-ttu-id="81655-323">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="81655-323">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="81655-324">**Reference**</span><span class="sxs-lookup"><span data-stu-id="81655-324">**Reference**</span></span>
</dt> <dt>

[<span data-ttu-id="81655-325">счематабле</span><span class="sxs-lookup"><span data-stu-id="81655-325">SchemaTable</span></span>](-search-2x-wds-schematable.md)
</dt> <dt>

[<span data-ttu-id="81655-326">Наблюдаемые типы</span><span class="sxs-lookup"><span data-stu-id="81655-326">Perceived Types</span></span>](-search-2x-wds-perceivedtype.md)
</dt> <dt>

[<span data-ttu-id="81655-327">Разработка обработчиков протоколов</span><span class="sxs-lookup"><span data-stu-id="81655-327">Developing Protocol Handlers</span></span>](-search-2x-wds-phaddins.md)
</dt> <dt>

<span data-ttu-id="81655-328">**Другие ресурсы**</span><span class="sxs-lookup"><span data-stu-id="81655-328">**Other Resources**</span></span>
</dt> <dt>

[<span data-ttu-id="81655-329">**IFilter**</span><span class="sxs-lookup"><span data-stu-id="81655-329">**IFilter**</span></span>](/windows/desktop/api/filter/nn-filter-ifilter)
</dt> </dl>

 

 