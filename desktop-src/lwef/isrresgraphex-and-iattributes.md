---
title: Исрресграфекс и Иаттрибутес
description: Исрресграфекс и Иаттрибутес
ms.assetid: 6eb37da1-5252-4c41-891c-c19cca6fb7d1
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 659d7d4723bfc5145fb8abcc77043031a0e48e8b
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104069832"
---
# <a name="isrresgraphex-and-iattributes"></a><span data-ttu-id="5963b-103">Исрресграфекс и Иаттрибутес</span><span class="sxs-lookup"><span data-stu-id="5963b-103">ISRResGraphEx and IAttributes</span></span>

<span data-ttu-id="5963b-104">\[Microsoft Agent является устаревшим в Windows 7 и может быть недоступен в последующих версиях Windows.\]</span><span class="sxs-lookup"><span data-stu-id="5963b-104">\[Microsoft Agent is deprecated as of Windows 7, and may be unavailable in subsequent versions of Windows.\]</span></span>

<span data-ttu-id="5963b-105">Объекты результатов, возвращаемые ядром, должны поддерживать интерфейс Исрресграфекс и интерфейс Иаттрибутес.</span><span class="sxs-lookup"><span data-stu-id="5963b-105">The results objects returned by the engine must support the ISRResGraphEx interface and the IAttributes interface.</span></span> <span data-ttu-id="5963b-106">Достаточно поддерживать интерфейс Исрресграфекс, чтобы позволить редактору звуковых данных предоставлять информацию о разбиении на слова, но не предоставляет необходимую поддержку информации о phoneme.</span><span class="sxs-lookup"><span data-stu-id="5963b-106">Merely supporting the ISRResGraphEx interface is enough to enable the sound editor to provide word break information, but does not provide the necessary support for phoneme information.</span></span>

<span data-ttu-id="5963b-107">Для работы редактора звука требуется, чтобы модули поддерживали специальный атрибут DWord, **сраттр \_ фонесег**.</span><span class="sxs-lookup"><span data-stu-id="5963b-107">The sound editor requires that engines also support a special DWord attribute, **SRATTR\_PHONESEG**.</span></span> <span data-ttu-id="5963b-108">Редактор запрашивает у обработчиков интерфейс Иаттрибутес и пытается установить **сраттр \_ фонесег** в значение 1.</span><span class="sxs-lookup"><span data-stu-id="5963b-108">The editor queries the engines to see IAttributes interface and attempts to set the **SRATTR\_PHONESEG** to 1.</span></span> <span data-ttu-id="5963b-109">Если этот вызов завершится удачно, в звуковом редакторе предполагается, что результаты ядра будут поддерживать сбор сведений о phoneme сегментации из объекта Results.</span><span class="sxs-lookup"><span data-stu-id="5963b-109">If that call succeeds, the sound editor assumes that the engine's results will support the gathering of phoneme-segmentation information from results object.</span></span>

`#define    SRATTR_PHONESEG    MAKELONG (1, SRVEN_MICROSOFT)`

<span data-ttu-id="5963b-110">Когда объект результатов передается в редактор звука, он запрашивает этот объект для своей реализации Исрресграфекс.</span><span class="sxs-lookup"><span data-stu-id="5963b-110">When a results object is transmitted to the sound editor, it queries that object for its implementation of ISRResGraphEx.</span></span> <span data-ttu-id="5963b-111">Исрресграфекс содержит функцию-член Датажет с сигнатурой типа</span><span class="sxs-lookup"><span data-stu-id="5963b-111">ISRResGraphEx contains a member function, DataGet, with type signature</span></span>

`HRESULT  DataGet  (DWord, dwID, GUID gAttrib, SDATA *psData)`

<span data-ttu-id="5963b-112">Где **ДВИД** — это идентификатор объекта Graph, **ГАТТРИБ** — это GUID, соответствующий искомому атрибуту, а **psData** — это указатель на объект sdata, содержащий возвращаемые данные.</span><span class="sxs-lookup"><span data-stu-id="5963b-112">Where **dwID** is the identifier of the graph object, **gAttrib** is a GUID corresponding to the attribute sought, and **psData** is a pointer to an SDATA object containing the data returned.</span></span> <span data-ttu-id="5963b-113">Модуль отвечает за выделение данных, хранящихся в **psData** , с помощью [**CoTaskMemAlloc**](/windows/desktop/api/combaseapi/nf-combaseapi-cotaskmemalloc).</span><span class="sxs-lookup"><span data-stu-id="5963b-113">The engine is responsible for allocating the data stored in **psData** through [**CoTaskMemAlloc**](/windows/desktop/api/combaseapi/nf-combaseapi-cotaskmemalloc).</span></span> <span data-ttu-id="5963b-114">Вызывающее приложение (в данном случае это редактор звука) отвечает за его освобождение через [**CoTaskMemFree**](/windows/desktop/api/combaseapi/nf-combaseapi-cotaskmemfree) по завершении.</span><span class="sxs-lookup"><span data-stu-id="5963b-114">The calling application (in this case the sound editor) is responsible for freeing it through [**CoTaskMemFree**](/windows/desktop/api/combaseapi/nf-combaseapi-cotaskmemfree) when it is finished.</span></span>

<span data-ttu-id="5963b-115">Датажет требуется для распознавания трех стандартных идентификаторов GUID, которые перечислены в документации по SAPI.</span><span class="sxs-lookup"><span data-stu-id="5963b-115">DataGet is required to recognize three predefined GUIDs, which are listed in the SAPI documentation.</span></span> <span data-ttu-id="5963b-116">Ядро, возвращающее код успешного выполнения для вызова **типа DWORD (сраттр \_ фонесег, 1)** , также требуется для распознавания определенного идентификатора GUID, **сргарк \_ Фонемесегментатион** при вызове с **ДВИД** , соответствующим границе в графе.</span><span class="sxs-lookup"><span data-stu-id="5963b-116">An engine which returns a success code to the call to **DWORDSet(SRATTR\_PHONESEG, 1)** is also required to recognize a specific GUID, **SRGARC\_PHONEMESEGMENTATION**, when called with a **dwID** that corresponds to an edge in the graph.</span></span>

`DEFINE_GUID(SRGARC_PHONMESEGMENTATION, 0xd05405b0, 0x1db1, 0x11d2, 0x94, 0x2, 0x0, 0xc0, 0x4f, 0x8e, 0xf4, 0x8f);`

<span data-ttu-id="5963b-117">Когда вызов возвращает, **psData** должен указывать на массив структуры типа **фонесег**, ВЫзываемой с параметром DWORD, определяемый:</span><span class="sxs-lookup"><span data-stu-id="5963b-117">When the call returns, **psData** should point to an array of DWORD-aligned structure of type **PHONESEG**, defined by:</span></span>

``` syntax
typedef struct tagSRPHONESEG {
   DWORD   dwSize;       // Size of the SRPHONESEG structure + phone data
   QWORD   qwStartTime;  // SAPI timestamp of the start of the seqment
   …QWORD   qwEndTime;    // SAPI timestamp of the end of the seqment
   int      nScore;      // The segment's score
   WCHAR   aPhones[0];   // Array of phone(s) making up the segment
} SRPHONESEG,  *PSRPHONESEG;
```

<span data-ttu-id="5963b-118">где **квстарттиме** и **квендтиме** указывают на начало и конец каждого phoneme, охватывающего слово, и **Афонес** представляет собой массив символов Юникода, соответствующий IPA представлению телефона, которое было создано в этом сегменте.</span><span class="sxs-lookup"><span data-stu-id="5963b-118">where **qwStartTime** and **qwEndTime** point to the beginning and end of each phoneme making up the word covered by the edge, and **aPhones** is an array of Unicode characters corresponding to the IPA representation of the phone, which were produced in this segment.</span></span> <span data-ttu-id="5963b-119">(В некоторых языках есть фонемы, которые написаны несколько IPA phoneme.</span><span class="sxs-lookup"><span data-stu-id="5963b-119">(In some languages, there are phonemes which are spelled with more than one IPA phoneme.</span></span> <span data-ttu-id="5963b-120">Например, на английском языке «длинный I» в слове «Live» на самом деле является дифсонг, который состоит из двух более простых фонемы сцепленных друг с другом.) Массив **афонес** должен быть нулевым нулем и дополняются в конце, чтобы каждая структура **срфонесег** в массиве стала четным кратной четырем байтам.</span><span class="sxs-lookup"><span data-stu-id="5963b-120">In English, for instance, the "long I" sound in the word "live" is actually a diphthong, made up of two simpler phonemes concatenated together.) The **aPhones** array should be zero terminated and padded at the end to make each **SRPHONESEG** structure in the array an even multiple of four bytes long.</span></span>

<span data-ttu-id="5963b-121">Например, предположим, что слово, произнесенное на дугу 4, было «сделано».</span><span class="sxs-lookup"><span data-stu-id="5963b-121">For example, suppose the word spoken on arc 4 was "made".</span></span> <span data-ttu-id="5963b-122">Затем вызов Датажет (4, **сргарк \_ фонемесегментатион**, &SD) может вернуть массив из трех сегментов phoneme,/м/, выполняемых от **квстарттиме**= 328434 байт до **квендтиме**= 330354 байт,/1E/с **квстарттиме**= 330354 байт до **квендтиме**= 344114 байт и/d/с **qwStartTime**= 344114 байт до **qwEndTime**= 347314 байт.</span><span class="sxs-lookup"><span data-stu-id="5963b-122">Then the call to DataGet(4, **SRGARC\_PHONEMESEGMENTATION**, &sd) might return an array of three phoneme segments, /m/ running from **qwStartTime**=328434 bytes to **qwEndTime**=330354 bytes, /1e/ running from **qwStartTime**=330354 bytes to **qwEndTime**=344114 bytes, and /d/ running from **qwStartTime**=344114 bytes to **qwEndTime**=347314 bytes.</span></span> <span data-ttu-id="5963b-123">Они будут представлены в виде упакованного массива из трех **срфонесег** структур размером 28, 32 и 28 байтов соответственно.</span><span class="sxs-lookup"><span data-stu-id="5963b-123">These would be presented as a packed array of three **SRPHONESEG** structures of sizes 28, 32, and 28 bytes, respectively.</span></span> <span data-ttu-id="5963b-124">Обратите внимание, что в конце средней **срфонесег** структуры имеется некоторое внутреннее поле, чтобы следующий элемент массива начинался с 4-байтной границы.</span><span class="sxs-lookup"><span data-stu-id="5963b-124">Notice that there is some padding at the end of the middle **SRPHONESEG** structure, so that the next item in the array starts at a 4-byte boundary.</span></span>

<span data-ttu-id="5963b-125">Пакет SDK для SAPI 4,0 включает средство (Срфунк) для тестирования соответствия спецификации SAPI 4,0. В этот инструмент входит проверка соответствия с этим набором интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="5963b-125">The SAPI 4.0 SDK includes a tool (SRFunc) for testing compliance with the SAPI 4.0 spec. Included in that tool is a test for compliance with this set of interfaces.</span></span> <span data-ttu-id="5963b-126">Исходный код этого средства является хорошим местом для начала работы, чтобы понять, как эти интерфейсы взаимодействуют с звуковым редактором и будут отлаживать интерфейсы во время разработки.</span><span class="sxs-lookup"><span data-stu-id="5963b-126">The source code for that tool is a good place to start in order to understand how these interfaces will interact with the sound editor, and to debug the interfaces during development.</span></span>

 

 