---
title: Реализация представления папок
description: Оболочка Windows предоставляет стандартную реализацию представления папок разговорной речи, известного как Дефвиев, что позволяет избежать большей части работы по реализации расширения пространства имен.
ms.assetid: 8c6712d8-c3cb-4450-8277-3a8675622651
keywords:
- Объект представления папки
- ишеллвиев
- Ишеллбровсер, объекты представления папок
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 48c7b86d587154a034f276d4bdab903e5337ed4b
ms.sourcegitcommit: 469b6de41e2a565b7ead231d7f282ec4071ac158
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/11/2020
ms.locfileid: "104414024"
---
# <a name="implementing-a-folder-view"></a><span data-ttu-id="e3626-106">Реализация представления папок</span><span class="sxs-lookup"><span data-stu-id="e3626-106">Implementing a Folder View</span></span>

<span data-ttu-id="e3626-107">Оболочка Windows предоставляет стандартную реализацию представления папок разговорной речи, известного как Дефвиев, что позволяет избежать большей части работы по реализации расширения пространства имен.</span><span class="sxs-lookup"><span data-stu-id="e3626-107">Windows Shell provides a default implementation of the folder view, colloquially known as DefView, so that you can avoid much of the work of implementing your own namespace extension.</span></span> <span data-ttu-id="e3626-108">Поскольку некоторые функции представления не могут быть реализованы с помощью пользовательских представлений, часто рекомендуется использовать объект представления системной папки по умолчанию вместо пользовательского представления.</span><span class="sxs-lookup"><span data-stu-id="e3626-108">Because some view features cannot be achieved through custom views, it is often recommended that the default system folder view object is used in place of a custom view.</span></span> <span data-ttu-id="e3626-109">Дополнительные сведения см. в разделе [**шкреатешеллфолдервиев**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shcreateshellfolderview).</span><span class="sxs-lookup"><span data-stu-id="e3626-109">For more information, see [**SHCreateShellFolderView**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shcreateshellfolderview).</span></span> <span data-ttu-id="e3626-110">В оставшейся части этого раздела обсуждается реализация пользовательского представления папки, которое не поддерживает новые функции представления.</span><span class="sxs-lookup"><span data-stu-id="e3626-110">The remainder of this topic discusses implementing a custom folder view that cannot support newer view features.</span></span>

<span data-ttu-id="e3626-111">В отличие от древовидного представления, проводник Windows не управляет содержимым представления папок.</span><span class="sxs-lookup"><span data-stu-id="e3626-111">Unlike the tree view, Windows Explorer does not manage the contents of a folder view.</span></span> <span data-ttu-id="e3626-112">Вместо этого в окне представления папок размещается дочернее окно, предоставляемое объектом Folder.</span><span class="sxs-lookup"><span data-stu-id="e3626-112">Instead, the folder view window hosts a child window that is provided by the folder object.</span></span> <span data-ttu-id="e3626-113">Объект Folder отвечает за создание объекта представления папок для отображения содержимого папки в дочернем окне.</span><span class="sxs-lookup"><span data-stu-id="e3626-113">The folder object is responsible for creating a folder view object to display the folder's contents in the child window.</span></span>

<span data-ttu-id="e3626-114">Ключом к реализации объекта представления папки является интерфейс [**ишеллвиев**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) .</span><span class="sxs-lookup"><span data-stu-id="e3626-114">The key to implementing a folder view object is the [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span> <span data-ttu-id="e3626-115">Этот интерфейс используется проводником Windows для связи с объектом представления папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-115">This interface is used by Windows Explorer to communicate with the folder view object.</span></span> <span data-ttu-id="e3626-116">Перед отображением представления папок проводник Windows вызывает метод [**ишеллфолдер:: креатевиевобжект**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) объекта Folder с параметром *riid* , равным IID \_ ишеллвиев.</span><span class="sxs-lookup"><span data-stu-id="e3626-116">Before displaying a folder view, Windows Explorer calls the folder object's [**IShellFolder::CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) method with *riid* set to IID\_IShellView.</span></span> <span data-ttu-id="e3626-117">Создайте объект представления папки и возвратите его интерфейс **ишеллвиев** .</span><span class="sxs-lookup"><span data-stu-id="e3626-117">Create a folder view object and return its **IShellView** interface.</span></span> <span data-ttu-id="e3626-118">Объект представления папок должен затем создать дочернее окно в окне представления папок и использовать дочернее окно для отображения сведений о содержимом папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-118">The folder view object must then create a child window of the folder view window and use the child window to display information about the folder's contents.</span></span>

<span data-ttu-id="e3626-119">Помимо управления отображением данных, расширения также могут настраивать ряд функций проводника Windows.</span><span class="sxs-lookup"><span data-stu-id="e3626-119">In addition to controlling how data is displayed, extensions can also customize a number of the features of Windows Explorer.</span></span> <span data-ttu-id="e3626-120">Например, расширение может добавлять элементы на панель инструментов или в строку меню или отображать сведения в строке состояния.</span><span class="sxs-lookup"><span data-stu-id="e3626-120">For instance, an extension can add items to the toolbar or menu bar, or display information on the status bar.</span></span>

-   [<span data-ttu-id="e3626-121">Объект представления папки</span><span class="sxs-lookup"><span data-stu-id="e3626-121">The Folder View Object</span></span>](#the-folder-view-object)
-   [<span data-ttu-id="e3626-122">Инициализация объекта представления папки</span><span class="sxs-lookup"><span data-stu-id="e3626-122">Initializing the Folder View Object</span></span>](#initializing-the-folder-view-object)
-   [<span data-ttu-id="e3626-123">Отображение представления папок</span><span class="sxs-lookup"><span data-stu-id="e3626-123">Displaying the Folder View</span></span>](#displaying-the-folder-view)
-   [<span data-ttu-id="e3626-124">Реализация Ишеллвиев</span><span class="sxs-lookup"><span data-stu-id="e3626-124">Implementing IShellView</span></span>](#implementing-ishellview)
    -   [<span data-ttu-id="e3626-125">аддпропертишитпажес</span><span class="sxs-lookup"><span data-stu-id="e3626-125">AddPropertySheetPages</span></span>](#addpropertysheetpages)
    -   [<span data-ttu-id="e3626-126">жеткуррентинфо</span><span class="sxs-lookup"><span data-stu-id="e3626-126">GetCurrentInfo</span></span>](#getcurrentinfo)
    -   [<span data-ttu-id="e3626-127">Обновить</span><span class="sxs-lookup"><span data-stu-id="e3626-127">Refresh</span></span>](#refresh)
    -   [<span data-ttu-id="e3626-128">SaveViewState</span><span class="sxs-lookup"><span data-stu-id="e3626-128">SaveViewState</span></span>](#saveviewstate)
    -   [<span data-ttu-id="e3626-129">транслатеацелератор</span><span class="sxs-lookup"><span data-stu-id="e3626-129">TranslateAcelerator</span></span>](#translateacelerator)
-   [<span data-ttu-id="e3626-130">Использование Ишеллбровсер для взаимодействия с проводником Windows</span><span class="sxs-lookup"><span data-stu-id="e3626-130">Using IShellBrowser to Communicate with Windows Explorer</span></span>](#using-ishellbrowser-to-communicate-with-windows-explorer)
    -   [<span data-ttu-id="e3626-131">Изменение строки меню проводника Windows</span><span class="sxs-lookup"><span data-stu-id="e3626-131">Modifying the Windows Explorer Menu Bar</span></span>](#modifying-the-windows-explorer-menu-bar)
    -   [<span data-ttu-id="e3626-132">Изменение панели инструментов проводника Windows</span><span class="sxs-lookup"><span data-stu-id="e3626-132">Modifying the Windows Explorer Toolbar</span></span>](#modifying-the-windows-explorer-toolbar)
    -   [<span data-ttu-id="e3626-133">Изменение строки состояния проводника Windows</span><span class="sxs-lookup"><span data-stu-id="e3626-133">Modifying the Windows Explorer Status Bar</span></span>](#modifying-the-windows-explorer-status-bar)
    -   [<span data-ttu-id="e3626-134">Хранение сведений, относящихся к представлению</span><span class="sxs-lookup"><span data-stu-id="e3626-134">Storing View-specific Information</span></span>](#storing-view-specific-information)

## <a name="the-folder-view-object"></a><span data-ttu-id="e3626-135">Объект представления папки</span><span class="sxs-lookup"><span data-stu-id="e3626-135">The Folder View Object</span></span>

<span data-ttu-id="e3626-136">Объект представления папок — это объект модели COM, предоставляющий интерфейс [**ишеллвиев**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) .</span><span class="sxs-lookup"><span data-stu-id="e3626-136">A folder view object is a Component Object Model (COM) object that exposes an [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span> <span data-ttu-id="e3626-137">Этот объект отвечает за:</span><span class="sxs-lookup"><span data-stu-id="e3626-137">This object is responsible for:</span></span>

-   <span data-ttu-id="e3626-138">Создание дочернего окна в окне представления папок и его использование для отображения содержимого папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-138">Creating a child window of the folder view window and using it to display the contents of the folder.</span></span>
-   <span data-ttu-id="e3626-139">Обработка связи с проводником Windows.</span><span class="sxs-lookup"><span data-stu-id="e3626-139">Handling communication with Windows Explorer.</span></span>
-   <span data-ttu-id="e3626-140">Добавление команд для конкретных папок в строку меню и панель инструментов проводника Windows и обработка этих команд при их выборе.</span><span class="sxs-lookup"><span data-stu-id="e3626-140">Adding folder-specific commands to the Windows Explorer menu bar and toolbar and handling those commands when they are selected.</span></span>
-   <span data-ttu-id="e3626-141">Управление взаимодействием пользователей с окном представления папок, например отображение контекстных меню или обработка операций перетаскивания.</span><span class="sxs-lookup"><span data-stu-id="e3626-141">Managing user interaction with the folder view window, such as displaying shortcut menus or handling drag-and-drop operations.</span></span>

<span data-ttu-id="e3626-142">В этом документе обсуждаются первые три раздела.</span><span class="sxs-lookup"><span data-stu-id="e3626-142">This document discusses the first three topics.</span></span> <span data-ttu-id="e3626-143">Так как пользователь взаимодействует с представлением папки в дочернем окне, объект представления папки отвечает за его обработку так же, как и для любого другого окна.</span><span class="sxs-lookup"><span data-stu-id="e3626-143">Because user interaction with the folder view takes place within your child window, your folder view object is responsible for handling it as it would for any other window.</span></span>

<span data-ttu-id="e3626-144">Проводник Windows запрашивает объект представления папки, вызывая для объекта папки [**ишеллфолдер:: креатевиевобжект**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) с *riid* , равным IID \_ ишеллвиев.</span><span class="sxs-lookup"><span data-stu-id="e3626-144">Windows Explorer requests a folder view object by calling your folder object's [**IShellFolder::CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) with *riid* set to IID\_IShellView.</span></span> <span data-ttu-id="e3626-145">Процедура создания представления папок:</span><span class="sxs-lookup"><span data-stu-id="e3626-145">The procedure for creating a folder view is:</span></span>

1.  <span data-ttu-id="e3626-146">Объект Folder создает новый экземпляр объекта представления папок и возвращает указатель на его интерфейс [**ишеллвиев**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) .</span><span class="sxs-lookup"><span data-stu-id="e3626-146">Your folder object creates a new instance of your folder view object and returns a pointer to its [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span>
2.  <span data-ttu-id="e3626-147">Проводник Windows Инициализирует объект представления папки, вызывая метод [**ишеллвиев:: креатевиеввиндов**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) .</span><span class="sxs-lookup"><span data-stu-id="e3626-147">Windows Explorer initializes the folder view object by calling the [**IShellView::CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) method.</span></span> <span data-ttu-id="e3626-148">Создайте дочернее окно окна представления папок и верните его маркер в проводник Windows.</span><span class="sxs-lookup"><span data-stu-id="e3626-148">Create a child window of the folder view window and return its handle to Windows Explorer.</span></span>
3.  <span data-ttu-id="e3626-149">Объект представления папок использует интерфейс [**Ишеллбровсер**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) проводника для настройки панели инструментов проводника Windows, строки меню и строки состояния.</span><span class="sxs-lookup"><span data-stu-id="e3626-149">The folder view object uses the Windows Explorer [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) interface to customize the Windows Explorer toolbar, menu bar, and status bar.</span></span>
4.  <span data-ttu-id="e3626-150">Объект представления папки отображает содержимое папки в дочернем окне.</span><span class="sxs-lookup"><span data-stu-id="e3626-150">The folder view object displays the contents of the folder in the child window.</span></span>
5.  <span data-ttu-id="e3626-151">Объект представления папок обрабатывает взаимодействие пользователя с представлением папки и любой панелью инструментов или элементами меню для конкретной папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-151">The folder view object handles user interaction with the folder view and any folder-specific toolbar or menu bar items.</span></span>

## <a name="initializing-the-folder-view-object"></a><span data-ttu-id="e3626-152">Инициализация объекта представления папки</span><span class="sxs-lookup"><span data-stu-id="e3626-152">Initializing the Folder View Object</span></span>

<span data-ttu-id="e3626-153">Проводник Windows Инициализирует объект представления папки, вызывая метод [**ишеллвиев:: креатевиеввиндов**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) .</span><span class="sxs-lookup"><span data-stu-id="e3626-153">Windows Explorer initializes the folder view object by calling the [**IShellView::CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) method.</span></span> <span data-ttu-id="e3626-154">Параметры метода предоставляют объекту представления папки сведения, необходимые для создания дочернего окна, которое будет использоваться для отображения содержимого папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-154">The method's parameters provide the folder view object with the information it needs to create the child window that will be used to display the folder's contents:</span></span>

-   <span data-ttu-id="e3626-155">Указатель на интерфейс [**ишеллвиев**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) предыдущего объекта представления папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-155">A pointer to the previous folder view object's [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span> <span data-ttu-id="e3626-156">Этому параметру можно присвоить **значение NULL**.</span><span class="sxs-lookup"><span data-stu-id="e3626-156">This parameter can be set to **NULL**.</span></span>
-   <span data-ttu-id="e3626-157">Структура [**фолдерсеттингс**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) , содержащая параметры предыдущего представления папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-157">A [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) structure that contains the previous folder view's settings.</span></span>
-   <span data-ttu-id="e3626-158">Указатель на интерфейс [**Ишеллбровсер**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) проводника Windows.</span><span class="sxs-lookup"><span data-stu-id="e3626-158">A pointer to the Windows Explorer [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) interface.</span></span>
-   <span data-ttu-id="e3626-159">Структура [Rect](/previous-versions//ms536136(v=vs.85)) с размерами окна представления папок.</span><span class="sxs-lookup"><span data-stu-id="e3626-159">A [RECT](/previous-versions//ms536136(v=vs.85)) structure with the dimensions of the folder view window.</span></span>

<span data-ttu-id="e3626-160">Метод [**ишеллвиев:: креатевиеввиндов**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) вызывается перед уничтожением предыдущего объекта представления папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-160">The [**IShellView::CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) method is called before the previous folder view object is destroyed.</span></span> <span data-ttu-id="e3626-161">Таким образом, указатель интерфейса [**ишеллвиев**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) позволяет взаимодействовать с предыдущим объектом представления папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-161">The [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface pointer thus allows you to communicate with the previous folder view object.</span></span> <span data-ttu-id="e3626-162">Этот интерфейс в основном полезен, если предыдущая папка принадлежала расширению и использовала ту же схему вывода.</span><span class="sxs-lookup"><span data-stu-id="e3626-162">This interface is primarily useful if the previous folder belonged to your extension and used the same display scheme.</span></span> <span data-ttu-id="e3626-163">В этом случае можно взаимодействовать с предыдущим объектом представления папки для таких целей, как обмен закрытыми параметрами.</span><span class="sxs-lookup"><span data-stu-id="e3626-163">If so, you can communicate with the previous folder view object for such purposes as exchanging private settings.</span></span>

<span data-ttu-id="e3626-164">Простой способ определить, принадлежит ли [**ишеллвиев**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) указатель к своему расширению, заключается в том, что все объекты представления папок предоставляют частный интерфейс.</span><span class="sxs-lookup"><span data-stu-id="e3626-164">A simple way to determine whether the [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) pointer belongs to your extension is to have all your folder view objects expose a private interface.</span></span> <span data-ttu-id="e3626-165">Вызовите метод [ишеллвиев:: QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) , чтобы запросить частный интерфейс, и изучите возвращаемое значение, чтобы определить, является ли объект представления папки одним из ваших.</span><span class="sxs-lookup"><span data-stu-id="e3626-165">Call [IShellView::QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) to request the private interface, and examine the return value to determine whether the folder view object is one of yours.</span></span> <span data-ttu-id="e3626-166">Затем можно использовать для обмена информацией частный метод этого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="e3626-166">You can then use a private method on that interface to exchange information.</span></span>

<span data-ttu-id="e3626-167">Структура [**фолдерсеттингс**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) содержит параметры отображения предыдущего представления папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-167">The [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) structure contains the previous folder view's display settings.</span></span> <span data-ttu-id="e3626-168">Основным параметром является режим просмотра: крупный значок, маленький значок, список или сведения.</span><span class="sxs-lookup"><span data-stu-id="e3626-168">The primary setting is the viewing mode: large icon, small icon, list, or details.</span></span> <span data-ttu-id="e3626-169">Также имеется флаг, который содержит параметры различных параметров отображения, например, должно ли представление быть вычислено по левому краю.</span><span class="sxs-lookup"><span data-stu-id="e3626-169">There is also a flag that contains the settings of a variety of display options, such as whether the view should be left-aligned.</span></span> <span data-ttu-id="e3626-170">Чтобы обеспечить пользователям единообразное взаимодействие при переходе из одной папки в другую, для просмотра папки должны быть доступны эти параметры.</span><span class="sxs-lookup"><span data-stu-id="e3626-170">Your folder display should follow these settings to the extent possible, to give users a consistent experience as they go from one folder to another.</span></span> <span data-ttu-id="e3626-171">Эту структуру следует хранить и обновлять при изменении параметров.</span><span class="sxs-lookup"><span data-stu-id="e3626-171">You should store this structure and update it as the settings change.</span></span> <span data-ttu-id="e3626-172">Проводник Windows вызывает [**ишеллвиев:: жеткуррентинфо**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-getcurrentinfo) , чтобы получить самое последнее значение этой структуры перед открытием следующего представления папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-172">Windows Explorer calls [**IShellView::GetCurrentInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-getcurrentinfo) to obtain the most recent value of this structure before it opens the next folder view.</span></span>

<span data-ttu-id="e3626-173">Интерфейс [**ишеллбровсер**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) предоставляется проводником Windows.</span><span class="sxs-lookup"><span data-stu-id="e3626-173">The [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) interface is exposed by Windows Explorer.</span></span> <span data-ttu-id="e3626-174">Этот интерфейс является вспомогательным для [**ишеллвиев**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) и позволяет объекту представления папки взаимодействовать с проводником Windows.</span><span class="sxs-lookup"><span data-stu-id="e3626-174">This interface is a companion to [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) and allows a folder view object to communicate with Windows Explorer.</span></span> <span data-ttu-id="e3626-175">Нет другого способа получить этот указатель на интерфейс, поэтому объект представления папки должен сохранить его для последующего использования.</span><span class="sxs-lookup"><span data-stu-id="e3626-175">There is no other way to retrieve this interface pointer, so your folder view object should store it for later use.</span></span> <span data-ttu-id="e3626-176">В частности, необходимо вызвать [ишеллбровсер:: Onwindow](/windows/win32/api/oleidl/nf-oleidl-iolewindow-getwindow) , чтобы получить окно представления родительской папки, которое будет использоваться для создания дочернего окна.</span><span class="sxs-lookup"><span data-stu-id="e3626-176">In particular, you will need to call [IShellBrowser::GetWindow](/windows/win32/api/oleidl/nf-oleidl-iolewindow-getwindow) to retrieve the parent folder view window that you will use to create your child window.</span></span> <span data-ttu-id="e3626-177">Обратите внимание, что метод Ишеллбровсер::-Window не включен в документацию **ишеллбровсер** , так как он унаследован от [иолевиндов](/windows/win32/api/oleidl/nn-oleidl-iolewindow).</span><span class="sxs-lookup"><span data-stu-id="e3626-177">Note that the IShellBrowser::GetWindow method is not included in the **IShellBrowser** documentation because it is inherited from [IOleWindow](/windows/win32/api/oleidl/nn-oleidl-iolewindow).</span></span> <span data-ttu-id="e3626-178">После сохранения указателя интерфейса не забудьте вызвать метод [ишеллбровсер:: AddRef](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) , чтобы увеличить число ссылок интерфейса.</span><span class="sxs-lookup"><span data-stu-id="e3626-178">After storing the interface pointer, remember to call [IShellBrowser::AddRef](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) to increment the interface's reference count.</span></span> <span data-ttu-id="e3626-179">Если интерфейс больше не нужен, вызовите [ишеллбровсер:: Release](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span><span class="sxs-lookup"><span data-stu-id="e3626-179">When you no longer need the interface, call [IShellBrowser::Release](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span></span>

<span data-ttu-id="e3626-180">Чтобы создать дочернее окно, сделайте следующее:</span><span class="sxs-lookup"><span data-stu-id="e3626-180">To create your child window:</span></span>

1.  <span data-ttu-id="e3626-181">Изучите структуры [**фолдерсеттингс**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) и [Rect](/previous-versions//ms536136(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="e3626-181">Examine the [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) and [RECT](/previous-versions//ms536136(v=vs.85)) structures.</span></span>
2.  <span data-ttu-id="e3626-182">При необходимости получите частные настройки из предыдущего объекта представления папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-182">If needed, obtain private settings from the previous folder view object.</span></span>
3.  <span data-ttu-id="e3626-183">Вызовите [ишеллбровсер:: Onwindow](/windows/win32/api/oleidl/nf-oleidl-iolewindow-getwindow) , чтобы получить окно представления родительской папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-183">Call [IShellBrowser::GetWindow](/windows/win32/api/oleidl/nf-oleidl-iolewindow-getwindow) to retrieve the parent folder view window.</span></span>
4.  <span data-ttu-id="e3626-184">Создайте дочерний элемент для окна представления папок, полученного на предыдущем шаге, и верните его в проводник Windows.</span><span class="sxs-lookup"><span data-stu-id="e3626-184">Create a child of the folder view window obtained in the previous step and return it to Windows Explorer.</span></span>

## <a name="displaying-the-folder-view"></a><span data-ttu-id="e3626-185">Отображение представления папок</span><span class="sxs-lookup"><span data-stu-id="e3626-185">Displaying the Folder View</span></span>

<span data-ttu-id="e3626-186">После создания дочернего окна и возврата его в проводник Windows можно отобразить содержимое папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-186">Once you have created the child window and returned it to Windows Explorer, you can display the folder's contents.</span></span> <span data-ttu-id="e3626-187">Как правило, расширения отображают свою информацию, размещающий узел дочернего окна — [элемент управления представления списка](../controls/list-view-control-reference.md) или **элемент управления WebBrowser**.</span><span class="sxs-lookup"><span data-stu-id="e3626-187">Typically, extensions display their information by having the child window host either a [list view control](../controls/list-view-control-reference.md) or a **WebBrowser control**.</span></span> <span data-ttu-id="e3626-188">Элемент управления "представление списка" позволяет реплицировать [классический вид](web-view.md)проводника Windows.</span><span class="sxs-lookup"><span data-stu-id="e3626-188">The list view control allows you to replicate the Windows Explorer [classic view](web-view.md).</span></span> <span data-ttu-id="e3626-189">Элемент управления WebBrowser позволяет использовать динамический HTML (DHTML) для отображения информации, подобно веб-представлению проводника Windows.</span><span class="sxs-lookup"><span data-stu-id="e3626-189">The WebBrowser control allows you to use a Dynamic HTML (DHTML) document to display your information, much like the Windows Explorer Web view.</span></span> <span data-ttu-id="e3626-190">Дополнительные сведения см. в документации по этим элементам управления.</span><span class="sxs-lookup"><span data-stu-id="e3626-190">For further information, refer to the documentation of those controls.</span></span>

<span data-ttu-id="e3626-191">Окно представления папок всегда существует, даже если оно не имеет фокуса.</span><span class="sxs-lookup"><span data-stu-id="e3626-191">The folder view window always exists, even if it does not have focus.</span></span> <span data-ttu-id="e3626-192">Поэтому необходимо поддерживать три состояния для своего дочернего окна:</span><span class="sxs-lookup"><span data-stu-id="e3626-192">You should therefore maintain three states for your child window:</span></span>

-   <span data-ttu-id="e3626-193">Активировано с фокусом.</span><span class="sxs-lookup"><span data-stu-id="e3626-193">Activated with focus.</span></span> <span data-ttu-id="e3626-194">Представление папки создано и имеет фокус.</span><span class="sxs-lookup"><span data-stu-id="e3626-194">The folder view has been created and has focus.</span></span> <span data-ttu-id="e3626-195">Задать строку меню или элементы панели инструментов, соответствующие определенному состоянию.</span><span class="sxs-lookup"><span data-stu-id="e3626-195">Set the menu bar or toolbar items that are appropriate for a focused state.</span></span>
-   <span data-ttu-id="e3626-196">Активирован без фокусировки.</span><span class="sxs-lookup"><span data-stu-id="e3626-196">Activated without focus.</span></span> <span data-ttu-id="e3626-197">Представление папки создано и активно, но не имеет фокуса.</span><span class="sxs-lookup"><span data-stu-id="e3626-197">The folder view has been created and is active, but it does not have focus.</span></span> <span data-ttu-id="e3626-198">Задать строку меню или элементы панели инструментов, подходящие для нефокусного состояния.</span><span class="sxs-lookup"><span data-stu-id="e3626-198">Set the menu bar or toolbar items that are appropriate for a nonfocused state.</span></span> <span data-ttu-id="e3626-199">Пропускать любые элементы, относящиеся к выделению элементов в представлении папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-199">Omit any items that apply to the selection of items within the folder view.</span></span>
-   <span data-ttu-id="e3626-200">Деактивирован.</span><span class="sxs-lookup"><span data-stu-id="e3626-200">Deactivated.</span></span> <span data-ttu-id="e3626-201">Представление папки будет уничтожено.</span><span class="sxs-lookup"><span data-stu-id="e3626-201">The folder view is about to be destroyed.</span></span> <span data-ttu-id="e3626-202">Удаление всех пунктов меню, относящихся к папке.</span><span class="sxs-lookup"><span data-stu-id="e3626-202">Remove all folder-specific menu items.</span></span>

<span data-ttu-id="e3626-203">Проводник Windows уведомляет объект представления папки при изменении состояния окна путем вызова [**ишеллвиев:: уиактивате**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate).</span><span class="sxs-lookup"><span data-stu-id="e3626-203">Windows Explorer notifies your folder view object when the window state changes by calling [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate).</span></span> <span data-ttu-id="e3626-204">В свою очередь, объект представления папок должен уведомлять проводник Windows о том, что пользователь активирует окно представления папки, вызывая [**ишеллбровсер:: онвиеввиндовактиве**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-onviewwindowactive).</span><span class="sxs-lookup"><span data-stu-id="e3626-204">In turn, the folder view object should notify Windows Explorer when a user activates the folder view window by calling [**IShellBrowser::OnViewWindowActive**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-onviewwindowactive).</span></span> <span data-ttu-id="e3626-205">Дополнительные сведения об этом интерфейсе см. [в статье Использование ишеллбровсер для взаимодействия с проводником Windows](#using-ishellbrowser-to-communicate-with-windows-explorer).</span><span class="sxs-lookup"><span data-stu-id="e3626-205">For further discussion of this interface, see [Using IShellBrowser to Communicate with Windows Explorer](#using-ishellbrowser-to-communicate-with-windows-explorer).</span></span>

<span data-ttu-id="e3626-206">Пока представление папки активно, необходимо обработать все сообщения Windows, например [ \_ Размер WM](../winmsg/wm-size.md), который принадлежит дочернему окну.</span><span class="sxs-lookup"><span data-stu-id="e3626-206">While the folder view is active, you need to process any Windows messages, such as [WM\_SIZE](../winmsg/wm-size.md), that belong to your child window.</span></span> <span data-ttu-id="e3626-207">Процедура окна также будет принимать [ \_ Командные сообщения WM](../menurc/wm-command.md) для всех элементов, добавленных в строку меню или панель инструментов проводника Windows.</span><span class="sxs-lookup"><span data-stu-id="e3626-207">Your window procedure will also receive [WM\_COMMAND](../menurc/wm-command.md) messages for any items you have added to the Windows Explorer menu bar or toolbar.</span></span>

<span data-ttu-id="e3626-208">После создания представления папок проводник Windows вызывает интерфейс [**ишеллвиев**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) объекта представления папки для передачи ему разнообразной информации.</span><span class="sxs-lookup"><span data-stu-id="e3626-208">After creating the folder view, Windows Explorer calls the folder view object's [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface to pass it a variety of information.</span></span> <span data-ttu-id="e3626-209">Объект должен соответствующим образом изменить его отображение.</span><span class="sxs-lookup"><span data-stu-id="e3626-209">Your object must modify its display accordingly.</span></span> <span data-ttu-id="e3626-210">Когда представление папки собирается уничтожиться, проводник Windows уведомляет объект представления папки, вызвав его метод [**ишеллвиев::D естройвиеввиндов**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-destroyviewwindow) .</span><span class="sxs-lookup"><span data-stu-id="e3626-210">When the folder view is about to be destroyed, Windows Explorer notifies the folder view object by calling its [**IShellView::DestroyViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-destroyviewwindow) method.</span></span>

## <a name="implementing-ishellview"></a><span data-ttu-id="e3626-211">Реализация Ишеллвиев</span><span class="sxs-lookup"><span data-stu-id="e3626-211">Implementing IShellView</span></span>

<span data-ttu-id="e3626-212">После создания объекта Folder проводник Windows вызывает различные методы [**ишеллвиев**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) для запроса информации или уведомления объекта об изменении в состоянии проводника Windows.</span><span class="sxs-lookup"><span data-stu-id="e3626-212">After the folder object has been created, Windows Explorer calls various [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) methods to either request information or notify the object of a change in the state of Windows Explorer.</span></span> <span data-ttu-id="e3626-213">В этом разделе описано, как реализовать эти методы **ишеллвиев** .</span><span class="sxs-lookup"><span data-stu-id="e3626-213">This section outlines how to implement those **IShellView** methods.</span></span> <span data-ttu-id="e3626-214">Остальные методы используются в более специализированных целях, например в диалоговом окне Открыть общий файл.</span><span class="sxs-lookup"><span data-stu-id="e3626-214">The remaining methods are used for more specialized purposes, such as the File Open common dialog box.</span></span> <span data-ttu-id="e3626-215">Дополнительные сведения см. в документации по **ишеллвиев** .</span><span class="sxs-lookup"><span data-stu-id="e3626-215">For details, see the **IShellView** documentation.</span></span>

### <a name="addpropertysheetpages"></a><span data-ttu-id="e3626-216">аддпропертишитпажес</span><span class="sxs-lookup"><span data-stu-id="e3626-216">AddPropertySheetPages</span></span>

<span data-ttu-id="e3626-217">Когда пользователь выбирает **Параметры папки** в меню **Сервис** проводника Windows, отображается страница свойств, позволяющая пользователю изменять параметры папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-217">When a user selects **Folder Options** from the Windows Explorer **Tools** menu, a property sheet is displayed that allows the user to modify the folder options.</span></span> <span data-ttu-id="e3626-218">Проводник Windows вызывает метод [**ишеллвиев:: аддпропертишитпажес**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-addpropertysheetpages) объекта представления папки, чтобы можно было добавить страницу в эту вкладку свойств.</span><span class="sxs-lookup"><span data-stu-id="e3626-218">Windows Explorer calls your folder view object's [**IShellView::AddPropertySheetPages**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-addpropertysheetpages) method to allow you to add a page to this property sheet.</span></span>

<span data-ttu-id="e3626-219">Проводник Windows передает указатель на функцию обратного вызова [аддпропшитпажепрок](/windows/win32/api/prsht/nc-prsht-lpfnaddpropsheetpage) в параметре *лпфн* объекта [**ишеллвиев:: аддпропертишитпажес**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-addpropertysheetpages).</span><span class="sxs-lookup"><span data-stu-id="e3626-219">Windows Explorer passes a pointer to an [AddPropSheetPageProc](/windows/win32/api/prsht/nc-prsht-lpfnaddpropsheetpage) callback function in the *lpfn* parameter of [**IShellView::AddPropertySheetPages**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-addpropertysheetpages).</span></span> <span data-ttu-id="e3626-220">Вызовите [креатепропертишитпаже](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) , чтобы создать страницу, а затем вызовите аддпропшитпажепрок, чтобы добавить ее в страницу свойств.</span><span class="sxs-lookup"><span data-stu-id="e3626-220">Call [CreatePropertySheetPage](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) to create the page, and then call the AddPropSheetPageProc to add it to the property sheet.</span></span> <span data-ttu-id="e3626-221">Дополнительные сведения об обработке страниц свойств см. в статье [страницы свойств](../controls/property-sheets.md).</span><span class="sxs-lookup"><span data-stu-id="e3626-221">For further discussion of how to handle property sheets, see [Property Sheets](../controls/property-sheets.md).</span></span>

### <a name="getcurrentinfo"></a><span data-ttu-id="e3626-222">жеткуррентинфо</span><span class="sxs-lookup"><span data-stu-id="e3626-222">GetCurrentInfo</span></span>

<span data-ttu-id="e3626-223">Когда пользователь переключается из одной папки в другую, проводник Windows пытается сохранить аналогичное представление папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-223">When the user switches from one folder to another, Windows Explorer attempts to maintain a similar folder view.</span></span> <span data-ttu-id="e3626-224">Например, если в предыдущем представлении папки были показаны крупные значки, то также следует и следующее.</span><span class="sxs-lookup"><span data-stu-id="e3626-224">For instance, if the previous folder view showed large icons, the next should as well.</span></span> <span data-ttu-id="e3626-225">Когда проводник Windows вызывает [**ишеллвиев:: креатевиеввиндов**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) для инициализации объекта представления папки, метод получает структуру [**фолдерсеттингс**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) .</span><span class="sxs-lookup"><span data-stu-id="e3626-225">When Windows Explorer calls [**IShellView::CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) to initialize your folder view object, the method receives a [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) structure.</span></span> <span data-ttu-id="e3626-226">Эта структура содержит сведения, позволяющие сделать представление папки совместимым с предыдущим представлением папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-226">This structure contains information that allows you to make your folder view display consistent with the previous folder view.</span></span>

<span data-ttu-id="e3626-227">Чтобы обеспечить соответствие следующего представления текущему представлению, сохраните структуру [**фолдерсеттингс**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) .</span><span class="sxs-lookup"><span data-stu-id="e3626-227">To help ensure that the next view is consistent with the current view, store the [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) structure.</span></span> <span data-ttu-id="e3626-228">Если представление изменяется, например, с большого до мелких значков, соответствующим образом обновите структуру.</span><span class="sxs-lookup"><span data-stu-id="e3626-228">If the view changes, for instance from large to small icons, update the structure accordingly.</span></span> <span data-ttu-id="e3626-229">Перед переключением представлений проводник Windows вызовите [**ишеллвиев:: жеткуррентинфо**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-getcurrentinfo) , чтобы запросить текущие значения **фолдерсеттингс** , чтобы передать их в следующий объект представления папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-229">Prior to switching views, Windows Explorer will call [**IShellView::GetCurrentInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-getcurrentinfo) to request the current **FOLDERSETTINGS** values to pass them to the next folder view object.</span></span>

### <a name="refresh"></a><span data-ttu-id="e3626-230">Обновить</span><span class="sxs-lookup"><span data-stu-id="e3626-230">Refresh</span></span>

<span data-ttu-id="e3626-231">Пользователь может убедиться, что представление папки отражает текущее состояние папки, выбрав пункт **Обновить** в меню **вид** или нажав клавишу F5.</span><span class="sxs-lookup"><span data-stu-id="e3626-231">The user can ensure that the folder view reflects the current state of the folder by selecting **Refresh** from the **View** menu or pressing the F5 key.</span></span> <span data-ttu-id="e3626-232">Когда пользователь делает это, проводник Windows вызывает метод [**ишеллвиев:: Refresh**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-refresh) .</span><span class="sxs-lookup"><span data-stu-id="e3626-232">When the user does so, Windows Explorer calls the [**IShellView::Refresh**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-refresh) method.</span></span> <span data-ttu-id="e3626-233">Объект представления папок должен немедленно обновить отображение представления папок.</span><span class="sxs-lookup"><span data-stu-id="e3626-233">Your folder view object should immediately update the folder view display.</span></span>

### <a name="saveviewstate"></a><span data-ttu-id="e3626-234">SaveViewState</span><span class="sxs-lookup"><span data-stu-id="e3626-234">SaveViewState</span></span>

<span data-ttu-id="e3626-235">Проводник Windows вызывает метод [**ишеллвиев:: SaveViewState**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-saveviewstate) для запроса объекта представления папки на сохранение состояния представления.</span><span class="sxs-lookup"><span data-stu-id="e3626-235">Windows Explorer calls the [**IShellView::SaveViewState**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-saveviewstate) method to prompt your folder view object to save its view state.</span></span> <span data-ttu-id="e3626-236">Затем можно восстановить состояние при следующем просмотре этой папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-236">You can then recover the state the next time the folder is viewed.</span></span> <span data-ttu-id="e3626-237">Предпочтительным способом сохранения состояния представления является вызов метода [**ишеллбровсер:: жетвиевстатестреам**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-getviewstatestream) .</span><span class="sxs-lookup"><span data-stu-id="e3626-237">The preferred way to save a view state is by calling the [**IShellBrowser::GetViewStateStream**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-getviewstatestream) method.</span></span> <span data-ttu-id="e3626-238">Этот метод возвращает интерфейс [IStream](/windows/win32/api/objidl/nn-objidl-istream) , который объект представления папки может использовать для сохранения своего состояния.</span><span class="sxs-lookup"><span data-stu-id="e3626-238">This method returns an [IStream](/windows/win32/api/objidl/nn-objidl-istream) interface that your folder view object can use to save its state.</span></span> <span data-ttu-id="e3626-239">При создании другого представления папок можно вызвать тот же метод **ишеллбровсер:: жетвиевстатестреам** , чтобы получить указатель IStream, позволяющий считывать параметры, сохраненные в предыдущих представлениях папок.</span><span class="sxs-lookup"><span data-stu-id="e3626-239">When you create another folder view, you can call the same **IShellBrowser::GetViewStateStream** method to obtain an IStream pointer that allows you to read the settings saved by previous folder views.</span></span>

### <a name="translateacelerator"></a><span data-ttu-id="e3626-240">транслатеацелератор</span><span class="sxs-lookup"><span data-stu-id="e3626-240">TranslateAcelerator</span></span>

<span data-ttu-id="e3626-241">Когда пользователь нажимает клавишу, проводник Windows передает сообщение в объект представления папок путем вызова [**ишеллвиев:: TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-translateaccelerator).</span><span class="sxs-lookup"><span data-stu-id="e3626-241">When the user presses a shortcut key, Windows Explorer passes the message to the folder view object by calling [**IShellView::TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-translateaccelerator).</span></span> <span data-ttu-id="e3626-242">Возвращает \_ значение false, чтобы Проводник Windows обрабатывал сообщение.</span><span class="sxs-lookup"><span data-stu-id="e3626-242">Return S\_FALSE to have Windows Explorer process the message.</span></span> <span data-ttu-id="e3626-243">Если объект представления папки обработал сообщение, возвращается значение S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="e3626-243">If your folder view object has processed the message, return S\_OK.</span></span>

<span data-ttu-id="e3626-244">Когда окно представления папок находится в фокусе, проводник Windows вызывает [**ишеллвиев:: TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-translateaccelerator) перед обработкой сообщения.</span><span class="sxs-lookup"><span data-stu-id="e3626-244">When the folder view window has focus, Windows Explorer calls [**IShellView::TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-translateaccelerator) before it processes the message.</span></span> <span data-ttu-id="e3626-245">Так как большинство сообщений обычно связаны с панелью меню или командами панели инструментов проводника Windows, объект представления папки должен обычно возвращать \_ значение false.</span><span class="sxs-lookup"><span data-stu-id="e3626-245">Because most of the messages are typically associated with Windows Explorer menu bar or toolbar commands, your folder view object should normally return S\_FALSE.</span></span> <span data-ttu-id="e3626-246">Проводник Windows может обработать сообщение в обычном режиме.</span><span class="sxs-lookup"><span data-stu-id="e3626-246">Windows Explorer can then process the message normally.</span></span> <span data-ttu-id="e3626-247">Вернуть \_ значение ОК, только если сообщение зависит от папки и вы не хотите, чтобы Проводник Windows пройдет дальнейшую обработку.</span><span class="sxs-lookup"><span data-stu-id="e3626-247">Return S\_OK only if the message is folder-specific and you do not want Windows Explorer to do any further processing.</span></span> <span data-ttu-id="e3626-248">Если представление папки не имеет фокуса, проводник Windows сначала обрабатывает сообщение.</span><span class="sxs-lookup"><span data-stu-id="e3626-248">If the folder view does not have focus, Windows Explorer processes the message first.</span></span> <span data-ttu-id="e3626-249">Он вызывает [**ишеллбровсер:: транслатеакцелераторсб**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-translateacceleratorsb) только в том случае, если он не обрабатывает сообщение.</span><span class="sxs-lookup"><span data-stu-id="e3626-249">It calls [**IShellBrowser::TranslateAcceleratorSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-translateacceleratorsb) only if it does not handle the message.</span></span>

## <a name="using-ishellbrowser-to-communicate-with-windows-explorer"></a><span data-ttu-id="e3626-250">Использование Ишеллбровсер для взаимодействия с проводником Windows</span><span class="sxs-lookup"><span data-stu-id="e3626-250">Using IShellBrowser to Communicate with Windows Explorer</span></span>

<span data-ttu-id="e3626-251">Интерфейс [**ишеллбровсер**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) используется объектом представления папок для взаимодействия с проводником Windows в различных целях, в том числе:</span><span class="sxs-lookup"><span data-stu-id="e3626-251">The [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) interface is used by the folder view object to communicate with Windows Explorer for a variety of purposes, including:</span></span>

-   [<span data-ttu-id="e3626-252">Изменение строки меню проводника Windows</span><span class="sxs-lookup"><span data-stu-id="e3626-252">Modifying the Windows Explorer Menu Bar</span></span>](#modifying-the-windows-explorer-menu-bar)
-   [<span data-ttu-id="e3626-253">Изменение панели инструментов проводника Windows</span><span class="sxs-lookup"><span data-stu-id="e3626-253">Modifying the Windows Explorer Toolbar</span></span>](#modifying-the-windows-explorer-toolbar)
-   [<span data-ttu-id="e3626-254">Изменение строки состояния проводника Windows</span><span class="sxs-lookup"><span data-stu-id="e3626-254">Modifying the Windows Explorer Status Bar</span></span>](#modifying-the-windows-explorer-status-bar)
-   [<span data-ttu-id="e3626-255">Хранение сведений, относящихся к представлению</span><span class="sxs-lookup"><span data-stu-id="e3626-255">Storing View-specific Information</span></span>](#storing-view-specific-information)

### <a name="modifying-the-windows-explorer-menu-bar"></a><span data-ttu-id="e3626-256">Изменение строки меню проводника Windows</span><span class="sxs-lookup"><span data-stu-id="e3626-256">Modifying the Windows Explorer Menu Bar</span></span>

<span data-ttu-id="e3626-257">Панель меню проводника Windows позволяет пользователю запускать разнообразные команды.</span><span class="sxs-lookup"><span data-stu-id="e3626-257">The Windows Explorer menu bar allows the user to launch a variety of commands.</span></span> <span data-ttu-id="e3626-258">По умолчанию в строке меню поддерживаются только команды, характерные для проводника Windows.</span><span class="sxs-lookup"><span data-stu-id="e3626-258">By default, the menu bar only supports commands that are specific to Windows Explorer.</span></span> <span data-ttu-id="e3626-259">Соответствующие [ \_ Командные сообщения WM](../menurc/wm-command.md) обрабатываются проводником Windows и не передаются в объект представления папок.</span><span class="sxs-lookup"><span data-stu-id="e3626-259">The related [WM\_COMMAND](../menurc/wm-command.md) messages are processed by Windows Explorer and are not passed to your folder view object.</span></span> <span data-ttu-id="e3626-260">Однако можно изменить строку меню, включив в нее один или несколько элементов меню для конкретной папки с помощью [**ишеллбровсер**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser).</span><span class="sxs-lookup"><span data-stu-id="e3626-260">However, you can modify the menu bar to include one or more folder-specific menu items with [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser).</span></span> <span data-ttu-id="e3626-261">Проводник Windows передает связанные с ними \_ Командные сообщения WM в процедуру окна объекта папки для обработки.</span><span class="sxs-lookup"><span data-stu-id="e3626-261">Windows Explorer passes the associated WM\_COMMAND messages of those items to your folder object's window procedure for processing.</span></span> <span data-ttu-id="e3626-262">Можно также удалить или отключить любые стандартные команды, которые не применяются к приложению.</span><span class="sxs-lookup"><span data-stu-id="e3626-262">You can also remove or disable any standard commands that do not apply to your application.</span></span>

<span data-ttu-id="e3626-263">Объекты представления папок обычно изменяют строку меню перед первым отображением представления папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-263">Folder view objects typically modify the menu bar before the folder view is first displayed.</span></span> <span data-ttu-id="e3626-264">При удалении представления папки они должны вернуть строку меню в исходное состояние.</span><span class="sxs-lookup"><span data-stu-id="e3626-264">They must return the menu bar to its original state when the folder view is destroyed.</span></span> <span data-ttu-id="e3626-265">Также может потребоваться изменить строку меню при каждом получении или потере фокуса представлением папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-265">You might also need to modify the menu bar each time your folder view gains or loses focus.</span></span>

<span data-ttu-id="e3626-266">Так как проводник Windows вызывает [**ишеллвиев:: уиактивате**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) каждый раз при изменении состояния окна представления папок, изменение строки меню обычно включается в реализацию этого метода.</span><span class="sxs-lookup"><span data-stu-id="e3626-266">Because Windows Explorer calls [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) each time the folder view window's state changes, menu bar modification is normally included in that method's implementation.</span></span> <span data-ttu-id="e3626-267">Ниже приведена основная процедура изменения строки меню проводника Windows.</span><span class="sxs-lookup"><span data-stu-id="e3626-267">The basic procedure for modifying the Windows Explorer menu bar is:</span></span>

1.  <span data-ttu-id="e3626-268">Вызовите [креатемену](/windows/win32/api/winuser/nf-winuser-createmenu) , чтобы создать маркер меню.</span><span class="sxs-lookup"><span data-stu-id="e3626-268">Call [CreateMenu](/windows/win32/api/winuser/nf-winuser-createmenu) to create a menu handle.</span></span>
2.  <span data-ttu-id="e3626-269">Передайте этот маркер меню в проводник Windows, вызвав [**ишеллбровсер:: инсертменуссб**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb).</span><span class="sxs-lookup"><span data-stu-id="e3626-269">Pass that menu handle to Windows Explorer by calling [**IShellBrowser::InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb).</span></span> <span data-ttu-id="e3626-270">В проводнике Windows будут заполняться сведения о меню.</span><span class="sxs-lookup"><span data-stu-id="e3626-270">Windows Explorer will fill in its menu information.</span></span>
3.  <span data-ttu-id="e3626-271">При необходимости измените меню.</span><span class="sxs-lookup"><span data-stu-id="e3626-271">Modify the menu as needed.</span></span>
4.  <span data-ttu-id="e3626-272">Вызовите [**ишеллбровсер:: сетменусб**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setmenusb) , чтобы Проводник Windows отображал измененную строку меню.</span><span class="sxs-lookup"><span data-stu-id="e3626-272">Call [**IShellBrowser::SetMenuSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setmenusb) to have Windows Explorer display the modified menu bar.</span></span>

<span data-ttu-id="e3626-273">В строке меню проводника Windows есть шесть всплывающих меню.</span><span class="sxs-lookup"><span data-stu-id="e3626-273">Windows Explorer has six pop-up menus on its menu bar.</span></span> <span data-ttu-id="e3626-274">Как и в случае со всеми контейнерами OLE, меню проводника Windows делится на шесть групп: файл, Правка, контейнер, объект, окно и Справка.</span><span class="sxs-lookup"><span data-stu-id="e3626-274">As with all OLE containers, the Windows Explorer menu is divided into six groups: File, Edit, Container, Object, Window, and Help.</span></span> <span data-ttu-id="e3626-275">В следующей таблице перечислены всплывающие меню проводника Windows и связанные с ними группы, а также идентификаторы меню.</span><span class="sxs-lookup"><span data-stu-id="e3626-275">The following table lists the Windows Explorer pop-up menus and their associated group, along with the menu IDs.</span></span>



| <span data-ttu-id="e3626-276">Всплывающее меню</span><span class="sxs-lookup"><span data-stu-id="e3626-276">Pop-up menu</span></span> | <span data-ttu-id="e3626-277">ID</span><span class="sxs-lookup"><span data-stu-id="e3626-277">ID</span></span>                     | <span data-ttu-id="e3626-278">Группа</span><span class="sxs-lookup"><span data-stu-id="e3626-278">Group</span></span>     |
|-------------|------------------------|-----------|
| <span data-ttu-id="e3626-279">Файл</span><span class="sxs-lookup"><span data-stu-id="e3626-279">File</span></span>        | <span data-ttu-id="e3626-280">\_файл меню \_ фЦидм</span><span class="sxs-lookup"><span data-stu-id="e3626-280">FCIDM\_MENU\_FILE</span></span>      | <span data-ttu-id="e3626-281">Файл</span><span class="sxs-lookup"><span data-stu-id="e3626-281">File</span></span>      |
| <span data-ttu-id="e3626-282">Изменить</span><span class="sxs-lookup"><span data-stu-id="e3626-282">Edit</span></span>        | <span data-ttu-id="e3626-283">\_изменить меню \_ фЦидм</span><span class="sxs-lookup"><span data-stu-id="e3626-283">FCIDM\_MENU\_EDIT</span></span>      | <span data-ttu-id="e3626-284">Файл</span><span class="sxs-lookup"><span data-stu-id="e3626-284">File</span></span>      |
| <span data-ttu-id="e3626-285">Представление</span><span class="sxs-lookup"><span data-stu-id="e3626-285">View</span></span>        | <span data-ttu-id="e3626-286">\_представление меню \_ фЦидм</span><span class="sxs-lookup"><span data-stu-id="e3626-286">FCIDM\_MENU\_VIEW</span></span>      | <span data-ttu-id="e3626-287">Контейнер</span><span class="sxs-lookup"><span data-stu-id="e3626-287">Container</span></span> |
| <span data-ttu-id="e3626-288">Избранное</span><span class="sxs-lookup"><span data-stu-id="e3626-288">Favorites</span></span>   | <span data-ttu-id="e3626-289">\_Избранное меню \_ фЦидм</span><span class="sxs-lookup"><span data-stu-id="e3626-289">FCIDM\_MENU\_FAVORITES</span></span> | <span data-ttu-id="e3626-290">Контейнер</span><span class="sxs-lookup"><span data-stu-id="e3626-290">Container</span></span> |
| <span data-ttu-id="e3626-291">Инструменты</span><span class="sxs-lookup"><span data-stu-id="e3626-291">Tools</span></span>       | <span data-ttu-id="e3626-292">\_средства меню \_ фЦидм</span><span class="sxs-lookup"><span data-stu-id="e3626-292">FCIDM\_MENU\_TOOLS</span></span>     | <span data-ttu-id="e3626-293">Контейнер</span><span class="sxs-lookup"><span data-stu-id="e3626-293">Container</span></span> |
| <span data-ttu-id="e3626-294">Справка</span><span class="sxs-lookup"><span data-stu-id="e3626-294">Help</span></span>        | <span data-ttu-id="e3626-295">\_ \_ Справка по меню фЦидм</span><span class="sxs-lookup"><span data-stu-id="e3626-295">FCIDM\_MENU\_HELP</span></span>      | <span data-ttu-id="e3626-296">Окно</span><span class="sxs-lookup"><span data-stu-id="e3626-296">Window</span></span>    |



 

<span data-ttu-id="e3626-297">При передаче маркера меню в проводник Windows путем вызова [**ишеллбровсер:: инсертменуссб**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb)необходимо также передать указатель на структуру [олеменуграупвидсс](/windows/win32/api/oleidl/ns-oleidl-olemenugroupwidths) , члены которой были инициализированы нулем.</span><span class="sxs-lookup"><span data-stu-id="e3626-297">When you pass the menu handle to Windows Explorer by calling [**IShellBrowser::InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb), you must also pass a pointer to an [OLEMENUGROUPWIDTHS](/windows/win32/api/oleidl/ns-oleidl-olemenugroupwidths) structure whose members have been initialized to zero.</span></span>

<span data-ttu-id="e3626-298">При возвращении [**ишеллбровсер:: инсертменуссб**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb) в проводнике Windows будут добавлены элементы меню.</span><span class="sxs-lookup"><span data-stu-id="e3626-298">When [**IShellBrowser::InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb) returns, Windows Explorer will have added its menu items.</span></span> <span data-ttu-id="e3626-299">Затем можно использовать возвращенный маркер меню с стандартными функциями меню Windows, такими как [инсертменуитем](/windows/win32/api/winuser/nf-winuser-insertmenuitema) :</span><span class="sxs-lookup"><span data-stu-id="e3626-299">You can then use the returned menu handle with standard Windows menu functions such as [InsertMenuItem](/windows/win32/api/winuser/nf-winuser-insertmenuitema) to:</span></span>

-   <span data-ttu-id="e3626-300">Добавьте элементы во всплывающие меню проводника Windows.</span><span class="sxs-lookup"><span data-stu-id="e3626-300">Add items to the Windows Explorer pop-up menus.</span></span>
-   <span data-ttu-id="e3626-301">Изменение или удаление существующих элементов во всплывающих меню проводника Windows.</span><span class="sxs-lookup"><span data-stu-id="e3626-301">Modify or delete existing items in the Windows Explorer pop-up menus.</span></span>
-   <span data-ttu-id="e3626-302">Добавление новых всплывающих меню.</span><span class="sxs-lookup"><span data-stu-id="e3626-302">Add new pop-up menus.</span></span>

<span data-ttu-id="e3626-303">Используйте идентификаторы, перечисленные в таблице, чтобы указать различные всплывающие меню проводника Windows.</span><span class="sxs-lookup"><span data-stu-id="e3626-303">Use the IDs listed in the table to identify the various Windows Explorer pop-up menus.</span></span>

> [!Note]  
> <span data-ttu-id="e3626-304">Чтобы избежать конфликтов с идентификаторами команд проводника Windows, идентификаторы всех добавляемых элементов меню должны находиться между ФЦИДМ \_ швиевфирст и фЦидм \_ швиевласт.</span><span class="sxs-lookup"><span data-stu-id="e3626-304">To avoid conflicts with Windows Explorer command IDs, the IDs of any menu items that you add must fall between FCIDM\_SHVIEWFIRST and FCIDM\_SHVIEWLAST.</span></span> <span data-ttu-id="e3626-305">Эти два значения определены в Шлобж. h.</span><span class="sxs-lookup"><span data-stu-id="e3626-305">These two values are defined in Shlobj.h.</span></span>

 

<span data-ttu-id="e3626-306">После завершения изменения меню вызовите [**ишеллбровсер:: сетменусб**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setmenusb) , чтобы Проводник Windows отображал новую строку меню.</span><span class="sxs-lookup"><span data-stu-id="e3626-306">Once you have finished modifying the menu, call [**IShellBrowser::SetMenuSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setmenusb) to have Windows Explorer display the new menu bar.</span></span>

<span data-ttu-id="e3626-307">После первоначального отображения представления папок проводник Windows вызывает [**ишеллвиев:: уиактивате**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) каждый раз, когда представление папки получает или теряет фокус.</span><span class="sxs-lookup"><span data-stu-id="e3626-307">After the folder view is initially displayed, Windows Explorer calls [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) each time the folder view gains or loses focus.</span></span> <span data-ttu-id="e3626-308">Если у вас есть элементы меню, которые чувствительны к состоянию представления папки, следует соответствующим образом изменить это меню при каждом изменении состояния.</span><span class="sxs-lookup"><span data-stu-id="e3626-308">If you have any menu items that are sensitive to the state of the folder view, you should modify the menu accordingly, each time the state changes.</span></span> <span data-ttu-id="e3626-309">Например, у вас может быть пункт меню, который работает с элементом в представлении папки, выбранным пользователем.</span><span class="sxs-lookup"><span data-stu-id="e3626-309">For instance, you might have a menu item that acts on an item in the folder view that has been selected by the user.</span></span> <span data-ttu-id="e3626-310">Этот пункт меню следует отключать или удалять при потере фокуса представлением папки.</span><span class="sxs-lookup"><span data-stu-id="e3626-310">You should disable or remove this menu item when the folder view loses focus.</span></span>

<span data-ttu-id="e3626-311">Когда проводник Windows вызывает [**ишеллвиев:: уиактивате**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) , чтобы указать, что представление папки деактивировано, восстановите его исходное состояние, вызвав [**Ишеллбровсер:: ремовеменуссб**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-removemenussb).</span><span class="sxs-lookup"><span data-stu-id="e3626-311">When Windows Explorer calls [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) to indicate that the folder view is being deactivated, restore the menu bar to its original state by calling [**IShellBrowser::RemoveMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-removemenussb).</span></span>

### <a name="modifying-the-windows-explorer-toolbar"></a><span data-ttu-id="e3626-312">Изменение панели инструментов проводника Windows</span><span class="sxs-lookup"><span data-stu-id="e3626-312">Modifying the Windows Explorer Toolbar</span></span>

<span data-ttu-id="e3626-313">В дополнение к изменению строки меню проводника Windows можно также добавлять кнопки на панель инструментов.</span><span class="sxs-lookup"><span data-stu-id="e3626-313">In addition to modifying the Windows Explorer menu bar, you can also add buttons to the toolbar.</span></span> <span data-ttu-id="e3626-314">Как и в строке меню, изменение панели инструментов обычно является частью реализации [**ишеллвиев:: уиактивате**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) .</span><span class="sxs-lookup"><span data-stu-id="e3626-314">As with the menu bar, toolbar modification is usually part of the [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) implementation.</span></span> <span data-ttu-id="e3626-315">Процедура добавления кнопок на панель инструментов проводника Windows:</span><span class="sxs-lookup"><span data-stu-id="e3626-315">The procedure for adding buttons to the Windows Explorer toolbar is:</span></span>

1.  <span data-ttu-id="e3626-316">Добавьте точечный рисунок кнопки в список изображений панели инструментов.</span><span class="sxs-lookup"><span data-stu-id="e3626-316">Add the button's bitmap to the toolbar's image list.</span></span>
2.  <span data-ttu-id="e3626-317">Определите текстовую строку кнопки.</span><span class="sxs-lookup"><span data-stu-id="e3626-317">Define the button's text string.</span></span>
3.  <span data-ttu-id="e3626-318">Добавьте кнопку на панель инструментов.</span><span class="sxs-lookup"><span data-stu-id="e3626-318">Add the button to the toolbar.</span></span>

<span data-ttu-id="e3626-319">Чтобы добавить растровое изображение в список изображений панели инструментов, отправьте панель инструментов с сообщением [ \_ Аддбитмап (ТБ](../controls/tb-addbitmap.md) ), вызвав [**ишеллбровсер:: сендконтролмсг**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg).</span><span class="sxs-lookup"><span data-stu-id="e3626-319">To add a bitmap to a toolbar's image list, send the toolbar a [TB\_ADDBITMAP](../controls/tb-addbitmap.md) message by calling [**IShellBrowser::SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg).</span></span> <span data-ttu-id="e3626-320">Чтобы указать элемент управления ToolBar, задайте для параметра *ID* метода значение **ФКВ \_ Toolbar**.</span><span class="sxs-lookup"><span data-stu-id="e3626-320">To specify the toolbar control, set the method's *id* parameter to **FCW\_TOOLBAR**.</span></span> <span data-ttu-id="e3626-321">Присвойте параметру *wParam* число изображений кнопок в битовой карте и *lParam* на адрес структуры [тбаддбитмап](/windows/win32/api/commctrl/ns-commctrl-tbaddbitmap) .</span><span class="sxs-lookup"><span data-stu-id="e3626-321">Set *wParam* to the number of button images in the bitmap, and *lParam* to the address of a [TBADDBITMAP](/windows/win32/api/commctrl/ns-commctrl-tbaddbitmap) structure.</span></span> <span data-ttu-id="e3626-322">Индекс изображения возвращается в параметре *Прет* .</span><span class="sxs-lookup"><span data-stu-id="e3626-322">The image index is returned in the *pret* parameter.</span></span>

<span data-ttu-id="e3626-323">Существует два способа определения строки для кнопки:</span><span class="sxs-lookup"><span data-stu-id="e3626-323">There are two ways to define a string for the button:</span></span>

-   <span data-ttu-id="e3626-324">Присвойте строку элементу **истринг** структуры [тббуттон](/windows/win32/api/commctrl/ns-commctrl-tbbutton) кнопки.</span><span class="sxs-lookup"><span data-stu-id="e3626-324">Assign the string to the **iString** member of the button's [TBBUTTON](/windows/win32/api/commctrl/ns-commctrl-tbbutton) structure.</span></span>
-   <span data-ttu-id="e3626-325">Вызовите [**ишеллбровсер:: сендконтролмсг**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg) , чтобы отправить элемент управления ToolBar с сообщением [ \_ ADDSTRING](../controls/tb-addstring.md) в виде ТБ.</span><span class="sxs-lookup"><span data-stu-id="e3626-325">Call [**IShellBrowser::SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg) to send the toolbar control a [TB\_ADDSTRING](../controls/tb-addstring.md) message.</span></span> <span data-ttu-id="e3626-326">Параметру *wParam* должно быть присвоено значение 0, а параметру *lParam* — строка.</span><span class="sxs-lookup"><span data-stu-id="e3626-326">The *wParam* parameter should be set to zero and the *lParam* parameter to the string.</span></span> <span data-ttu-id="e3626-327">Индекс строки возвращается в параметре *Прет* .</span><span class="sxs-lookup"><span data-stu-id="e3626-327">The string index is returned in the *pret* parameter.</span></span>

<span data-ttu-id="e3626-328">Чтобы добавить кнопку на панель инструментов, заполните структуру [тббуттон](/windows/win32/api/commctrl/ns-commctrl-tbbutton) и передайте ее в [**Ишеллбровсер:: сеттулбаритемс**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-settoolbaritems).</span><span class="sxs-lookup"><span data-stu-id="e3626-328">To add the button to the toolbar, fill in a [TBBUTTON](/windows/win32/api/commctrl/ns-commctrl-tbbutton) structure and pass it to [**IShellBrowser::SetToolbarItems**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-settoolbaritems).</span></span> <span data-ttu-id="e3626-329">Как и в меню, идентификатор команды должен находиться между ФЦИДМ \_ швиевфирст и фЦидм \_ швиевласт.</span><span class="sxs-lookup"><span data-stu-id="e3626-329">As with the menu, your command ID must fall between FCIDM\_SHVIEWFIRST and FCIDM\_SHVIEWLAST.</span></span> <span data-ttu-id="e3626-330">Затем Панель инструментов добавит кнопку справа от существующих кнопок.</span><span class="sxs-lookup"><span data-stu-id="e3626-330">The toolbar will then append the button to the right of the existing buttons.</span></span>

<span data-ttu-id="e3626-331">Например, следующий фрагмент кода добавляет одну стандартную кнопку на панель инструментов проводника Windows с ИДЕНТИФИКАТОРом IDB \_ MYBUTTON.</span><span class="sxs-lookup"><span data-stu-id="e3626-331">For instance, the following code fragment adds one standard button to the Windows Explorer toolbar with a command ID of IDB\_MYBUTTON.</span></span>


```
TBADDBITMAP tbadbm;
int iButtonIndex;
TBBUTTON tbb;

tbadbm.hInst = g_hInstance;    // The module's instance handle
tbadbm.nID = IDB_BUTTONIMAGE;  // The bitmap's resource ID

psb->SendControlMsg(FCW_TOOLBAR, TB_ADDBITMAP, 1,
                    reinterpret_cast<LPARAM>(&tbadbm), &iButtonIndex);

psb->SendControlMsg(FCW_TOOLBAR, TB_ADDSTRING, NULL,
                    reinterpret_cast<LPARAM>(szLabel), &iStringIndex);

ZeroMemory(&tbb, sizeof(TBBUTTON));
tbb.iBitmap = iButtonIndex;
tbb.iCommand = IDB_MYBUTTON;
tbb.iString = iStringIndex;
tbb.fsState = TBSTATE_ENABLED;
tbb.fsStyle = TBSTYLE_BUTTON;

psb->SetToolbarItems(&tbb, 1, FCT_MERGE);
```



<span data-ttu-id="e3626-332">Дополнительные сведения об обработке элементов управления панели инструментов см. в разделе [элементы управления ToolBar](../controls/toolbar-control-reference.md).</span><span class="sxs-lookup"><span data-stu-id="e3626-332">For further discussion of how to handle toolbar controls, see [Toolbar Controls](../controls/toolbar-control-reference.md).</span></span>

### <a name="modifying-the-windows-explorer-status-bar"></a><span data-ttu-id="e3626-333">Изменение строки состояния проводника Windows</span><span class="sxs-lookup"><span data-stu-id="e3626-333">Modifying the Windows Explorer Status Bar</span></span>

<span data-ttu-id="e3626-334">Строку состояния проводника Windows можно использовать для вывода различных полезных сведений.</span><span class="sxs-lookup"><span data-stu-id="e3626-334">You can use the Windows Explorer status bar to display a variety of useful information.</span></span> <span data-ttu-id="e3626-335">Существует два способа использования строки состояния.</span><span class="sxs-lookup"><span data-stu-id="e3626-335">There are two ways to use the status bar:</span></span>

-   <span data-ttu-id="e3626-336">Используйте [**ишеллбровсер:: сетстатустекстсб**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setstatustextsb) для вывода текстовой строки в строке состояния.</span><span class="sxs-lookup"><span data-stu-id="e3626-336">Use [**IShellBrowser::SetStatusTextSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setstatustextsb) to display a text string on the status bar.</span></span>
-   <span data-ttu-id="e3626-337">Отправка сообщений непосредственно в элемент управления "строка состояния" с помощью [**ишеллбровсер:: сендконтролмсг**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg).</span><span class="sxs-lookup"><span data-stu-id="e3626-337">Send messages directly to the status bar control with [**IShellBrowser::SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg).</span></span>

<span data-ttu-id="e3626-338">Первый метод прост, но достаточно для многих целей.</span><span class="sxs-lookup"><span data-stu-id="e3626-338">The first method is straightforward but sufficient for many purposes.</span></span> <span data-ttu-id="e3626-339">Для большей гибкости можно отправить сообщения непосредственно в элемент управления "строка состояния", вызвав [**ишеллбровсер:: сендконтролмсг**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg) с параметром *ID* , имеющим значение **ФКВ \_ Status**.</span><span class="sxs-lookup"><span data-stu-id="e3626-339">For greater flexibility, you can send messages directly to the status bar control by calling [**IShellBrowser::SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg) with the *id* parameter set to **FCW\_STATUS**.</span></span> <span data-ttu-id="e3626-340">Дальнейшее обсуждение элементов управления "строка состояния" см. в разделе [строки состояния](../controls/status-bars.md).</span><span class="sxs-lookup"><span data-stu-id="e3626-340">For further discussion of status bar controls, see [Status Bars](../controls/status-bars.md).</span></span>

### <a name="storing-view-specific-information"></a><span data-ttu-id="e3626-341">Хранение сведений, относящихся к представлению</span><span class="sxs-lookup"><span data-stu-id="e3626-341">Storing View-specific Information</span></span>

<span data-ttu-id="e3626-342">Когда представление собирается уничтожиться, часто бывает полезно хранить такие сведения, как состояние или параметры представления.</span><span class="sxs-lookup"><span data-stu-id="e3626-342">When a view is about to be destroyed, it is often useful to store information such as the view's state or settings.</span></span> <span data-ttu-id="e3626-343">Проводник Windows предлагает выполнить эту задачу, вызвав [**ишеллвиев:: SaveViewState**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-saveviewstate).</span><span class="sxs-lookup"><span data-stu-id="e3626-343">Windows Explorer prompts you to do this task by calling [**IShellView::SaveViewState**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-saveviewstate).</span></span> <span data-ttu-id="e3626-344">Предпочтительным способом сохранения сведений, относящихся к конкретным представлениям, является вызов [**ишеллбровсер:: жетвиевстатестреам**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-getviewstatestream).</span><span class="sxs-lookup"><span data-stu-id="e3626-344">The preferred way to save view-specific information is to call [**IShellBrowser::GetViewStateStream**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-getviewstatestream).</span></span> <span data-ttu-id="e3626-345">Этот метод предоставляет интерфейс [IStream](/windows/win32/api/objidl/nn-objidl-istream) , который можно использовать для хранения информации.</span><span class="sxs-lookup"><span data-stu-id="e3626-345">This method provides you with an [IStream](/windows/win32/api/objidl/nn-objidl-istream) interface that you can use to store the information.</span></span> <span data-ttu-id="e3626-346">Вы можете использовать любой подходящий формат данных.</span><span class="sxs-lookup"><span data-stu-id="e3626-346">You are free to use any suitable data format.</span></span>

 

 
