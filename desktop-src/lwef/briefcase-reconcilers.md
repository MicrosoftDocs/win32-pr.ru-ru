---
title: Создание подверяющих портфелей
description: Средство согласования портфелей позволяет портфелу выверять различные версии документа.
ms.assetid: 86d66291-96ae-40ea-98ef-ef263f25aa82
keywords:
- посредники по портфелю
- процессе
- иреконЦилаблеобжект
- иреконЦилеинитиатор
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b925e7055e15f6c7a49408aa28d147fb2eef5a7e
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104412805"
---
# <a name="creating-briefcase-reconcilers"></a><span data-ttu-id="ed366-107">Создание подверяющих портфелей</span><span class="sxs-lookup"><span data-stu-id="ed366-107">Creating Briefcase Reconcilers</span></span>

<span data-ttu-id="ed366-108">Средство согласования портфелей позволяет портфелу выверять различные версии документа.</span><span class="sxs-lookup"><span data-stu-id="ed366-108">A briefcase reconciler gives Briefcase the means to reconcile different versions of a document.</span></span>

-   [<span data-ttu-id="ed366-109">О подверяющих портфелях</span><span class="sxs-lookup"><span data-stu-id="ed366-109">About Briefcase Reconcilers</span></span>](#about-briefcase-reconcilers)
    -   [<span data-ttu-id="ed366-110">Процессе</span><span class="sxs-lookup"><span data-stu-id="ed366-110">Reconciliation</span></span>](#reconciliation)
    -   [<span data-ttu-id="ed366-111">Создание синхронизатора портфеля</span><span class="sxs-lookup"><span data-stu-id="ed366-111">Creating a Briefcase Reconciler</span></span>](#creating-a-briefcase-reconciler)
    -   [<span data-ttu-id="ed366-112">Взаимодействие с пользователем при выверке</span><span class="sxs-lookup"><span data-stu-id="ed366-112">User Interaction in Reconciliation</span></span>](#user-interaction-in-reconciliation)
    -   [<span data-ttu-id="ed366-113">Согласование внедренных объектов</span><span class="sxs-lookup"><span data-stu-id="ed366-113">Reconciling Embedded Objects</span></span>](#reconciling-embedded-objects)
    -   [<span data-ttu-id="ed366-114">ресидуес</span><span class="sxs-lookup"><span data-stu-id="ed366-114">Residues</span></span>](#residues)
-   [<span data-ttu-id="ed366-115">Справочник по выверке портфеля</span><span class="sxs-lookup"><span data-stu-id="ed366-115">Briefcase Reconciler Reference</span></span>](#briefcase-reconciler-reference)
    -   [<span data-ttu-id="ed366-116">Интерфейсы и методы посредника портфеля</span><span class="sxs-lookup"><span data-stu-id="ed366-116">Briefcase Reconciler Interfaces and Methods</span></span>](#briefcase-reconciler-interfaces-and-methods)

## <a name="about-briefcase-reconcilers"></a><span data-ttu-id="ed366-117">О подверяющих портфелях</span><span class="sxs-lookup"><span data-stu-id="ed366-117">About Briefcase Reconcilers</span></span>

<span data-ttu-id="ed366-118">Синхронизатор портфеля объединяет различные входные версии документа для создания одной новой выходной версии документа.</span><span class="sxs-lookup"><span data-stu-id="ed366-118">A briefcase reconciler combines different input versions of a document to produce a single, new output version of the document.</span></span> <span data-ttu-id="ed366-119">Возможно, потребуется создать посредник портфеля для поддержки вашего типа документа.</span><span class="sxs-lookup"><span data-stu-id="ed366-119">You might need to create a briefcase reconciler to support your type of document.</span></span> <span data-ttu-id="ed366-120">В этом обзоре описываются посредники по портфелю и способы их создания.</span><span class="sxs-lookup"><span data-stu-id="ed366-120">This overview describes briefcase reconcilers and explains how to create them.</span></span>

<span data-ttu-id="ed366-121">Рассматриваются следующие темы:</span><span class="sxs-lookup"><span data-stu-id="ed366-121">The following topics are discussed:</span></span>

-   [<span data-ttu-id="ed366-122">Процессе</span><span class="sxs-lookup"><span data-stu-id="ed366-122">Reconciliation</span></span>](#reconciliation)
-   [<span data-ttu-id="ed366-123">Создание синхронизатора портфеля</span><span class="sxs-lookup"><span data-stu-id="ed366-123">Creating a Briefcase Reconciler</span></span>](#creating-a-briefcase-reconciler)
-   [<span data-ttu-id="ed366-124">Взаимодействие с пользователем при выверке</span><span class="sxs-lookup"><span data-stu-id="ed366-124">User Interaction in Reconciliation</span></span>](#user-interaction-in-reconciliation)
-   [<span data-ttu-id="ed366-125">Согласование внедренных объектов</span><span class="sxs-lookup"><span data-stu-id="ed366-125">Reconciling Embedded Objects</span></span>](#reconciling-embedded-objects)
-   [<span data-ttu-id="ed366-126">ресидуес</span><span class="sxs-lookup"><span data-stu-id="ed366-126">Residues</span></span>](#residues)

### <a name="reconciliation"></a><span data-ttu-id="ed366-127">Процессе</span><span class="sxs-lookup"><span data-stu-id="ed366-127">Reconciliation</span></span>

<span data-ttu-id="ed366-128">Документ представляет собой коллекцию данных, которые можно копировать и изменять.</span><span class="sxs-lookup"><span data-stu-id="ed366-128">A document is a collection of information that can be copied and changed.</span></span> <span data-ttu-id="ed366-129">Документ имеет разные версии, если содержимое по крайней мере двух копий документа отличается.</span><span class="sxs-lookup"><span data-stu-id="ed366-129">A document has different versions if the contents of at least two copies of the document are different.</span></span> <span data-ttu-id="ed366-130">Выверка создает одну версию документа из двух или более первоначальных версий.</span><span class="sxs-lookup"><span data-stu-id="ed366-130">Reconciliation produces a single version of a document from two or more initial versions.</span></span> <span data-ttu-id="ed366-131">Как правило, выверенная версия представляет собой сочетание информации из первоначальных версий с самой последней или наиболее полезной сохраненной информацией.</span><span class="sxs-lookup"><span data-stu-id="ed366-131">Typically, the reconciled version is a combination of information from the initial versions with the most recent or most useful information preserved.</span></span>

<span data-ttu-id="ed366-132">Сверка инициируется портфелем, когда он определяет, что две или более копии одного и того же документа отличаются.</span><span class="sxs-lookup"><span data-stu-id="ed366-132">Reconciliation is initiated by Briefcase when it determines that two or more copies of the same document are different.</span></span> <span data-ttu-id="ed366-133">Портфель, который выступает в качестве инициатора в этом контексте, находит и запускает посредника портфеля, связанный с данным типом документа.</span><span class="sxs-lookup"><span data-stu-id="ed366-133">Briefcase, which acts as the initiator in this context, locates and starts the briefcase reconciler associated with the given document type.</span></span> <span data-ttu-id="ed366-134">Посредник сравнивает документы и определяет, какие части документов следует хранить.</span><span class="sxs-lookup"><span data-stu-id="ed366-134">The reconciler compares the documents and determines which portions of the documents to retain.</span></span> <span data-ttu-id="ed366-135">Для завершения сверки некоторых посредников может потребоваться вмешательство пользователя.</span><span class="sxs-lookup"><span data-stu-id="ed366-135">Some reconcilers might require user interaction to complete reconciliation.</span></span> <span data-ttu-id="ed366-136">Другие могут выполнить выверку без взаимодействия с пользователем.</span><span class="sxs-lookup"><span data-stu-id="ed366-136">Others might complete reconciliation without user interaction.</span></span> <span data-ttu-id="ed366-137">Посредник может содержаться в приложении или быть расширением, реализованным в виде библиотеки DLL.</span><span class="sxs-lookup"><span data-stu-id="ed366-137">The reconciler can be contained within an application or be an extension implemented as a DLL.</span></span>

<span data-ttu-id="ed366-138">Некоторые посредники по портфелю могут создать ресидуес.</span><span class="sxs-lookup"><span data-stu-id="ed366-138">Some briefcase reconcilers might create residues.</span></span> <span data-ttu-id="ed366-139">Ресидуе — это документ, обычно имеющий тот же тип файлов, что и исходный документ, который содержит сведения, не сохраненные в объединенной версии.</span><span class="sxs-lookup"><span data-stu-id="ed366-139">A residue is a document, usually having the same file type as the initial document, that contains information not saved in the merged version.</span></span> <span data-ttu-id="ed366-140">Ресидуес обычно используются, чтобы дать авторам возможность быстро определить, какая информация из их исходного документа не входит в окончательную объединенную версию.</span><span class="sxs-lookup"><span data-stu-id="ed366-140">Residues are typically used to give authors a quick way to determine what information from their original document is not in the final merged version.</span></span> <span data-ttu-id="ed366-141">Если посредник поддерживает ресидуес, он создает один ресидуе для каждой из исходных версий документа.</span><span class="sxs-lookup"><span data-stu-id="ed366-141">If a reconciler supports residues, it creates one residue for each of the original versions of the document.</span></span> <span data-ttu-id="ed366-142">Ресидуес не создаются, если инициатор не запрашивает их.</span><span class="sxs-lookup"><span data-stu-id="ed366-142">Residues are not created unless the initiator requests them.</span></span>

<span data-ttu-id="ed366-143">Некоторые посредники портфелей работают с портфелем, чтобы позволить пользователю завершить выверку.</span><span class="sxs-lookup"><span data-stu-id="ed366-143">Some briefcase reconcilers work with Briefcase to allow the user to terminate reconciliation.</span></span> <span data-ttu-id="ed366-144">Это важная функция для пользователя, который может решить, что сверка не должна выполняться.</span><span class="sxs-lookup"><span data-stu-id="ed366-144">This is an important feature for a user who might decide that the reconciliation should not proceed.</span></span> <span data-ttu-id="ed366-145">Как правило, посредник предоставляет объект завершения, когда для сверки требуется взаимодействие с пользователем и его длина может быть длительной.</span><span class="sxs-lookup"><span data-stu-id="ed366-145">A reconciler typically provides a termination object when the reconciliation requires user interaction and might be lengthy.</span></span> <span data-ttu-id="ed366-146">В некоторых средах посредник может разрешать частичную выверку, позволяя пользователю временно приостановить выверку и возобновить ее работу позже.</span><span class="sxs-lookup"><span data-stu-id="ed366-146">In some environments, a reconciler might allow partial reconciliation, enabling a user to temporarily suspend a reconciliation and resume it later.</span></span> <span data-ttu-id="ed366-147">Однако портфель в настоящее время не поддерживает частичную выверку.</span><span class="sxs-lookup"><span data-stu-id="ed366-147">Briefcase does not currently support partial reconciliation, however.</span></span>

### <a name="creating-a-briefcase-reconciler"></a><span data-ttu-id="ed366-148">Создание синхронизатора портфеля</span><span class="sxs-lookup"><span data-stu-id="ed366-148">Creating a Briefcase Reconciler</span></span>

<span data-ttu-id="ed366-149">Вы создаете посредник портфеля, реализуя интерфейсы сверки.</span><span class="sxs-lookup"><span data-stu-id="ed366-149">You create a briefcase reconciler by implementing the reconciliation interfaces.</span></span> <span data-ttu-id="ed366-150">Как минимум, посредник реализует интерфейс [**иреконЦилаблеобжект**](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) и интерфейс [иперсистстораже](/windows/win32/api/objidl/nn-objidl-ipersiststorage) или [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) .</span><span class="sxs-lookup"><span data-stu-id="ed366-150">At a minimum, a reconciler implements the [**IReconcilableObject**](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) interface and the [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) or [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface.</span></span> <span data-ttu-id="ed366-151">Как инициатор, портфель определяет, когда требуется сверка, и вызывает метод [**иреконЦилаблеобжект:: Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) для инициации выверки.</span><span class="sxs-lookup"><span data-stu-id="ed366-151">As the initiator, Briefcase determines when reconciliation is needed and calls the [**IReconcilableObject::Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) method to initiate reconciliation.</span></span>

<span data-ttu-id="ed366-152">Хотя [**иреконЦилаблеобжект:: Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) предоставляет широкий набор возможностей сверки, в большинстве случаев он выполняет только минимальную выверку.</span><span class="sxs-lookup"><span data-stu-id="ed366-152">Although [**IReconcilableObject::Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) provides a wide-ranging set of reconciliation capabilities, a briefcase reconciler carries out only minimal reconciliation in most cases.</span></span> <span data-ttu-id="ed366-153">В частности, портфель не требует от посредника поддержки создания ресидуе или поддержки объекта завершения.</span><span class="sxs-lookup"><span data-stu-id="ed366-153">In particular, Briefcase does not require the reconciler to support residue generation or to support the termination object.</span></span> <span data-ttu-id="ed366-154">Кроме того, посредник выполняет единую сверку "сверху вниз" и не должен возвращать \_ значение REC E \_ ноткомплете. Это означает, что не следует пытаться выполнить частичную выверку.</span><span class="sxs-lookup"><span data-stu-id="ed366-154">Also, the reconciler carries out a single top-to-bottom reconciliation and must not return the REC\_E\_NOTCOMPLETE value; that is, it should not attempt partial reconciliation.</span></span>

<span data-ttu-id="ed366-155">Портфель предоставляет интерфейс [**иреконЦилеинитиатор**](ireconcileinitiator.md) .</span><span class="sxs-lookup"><span data-stu-id="ed366-155">Briefcase provides the [**IReconcileInitiator**](ireconcileinitiator.md) interface.</span></span> <span data-ttu-id="ed366-156">Чтобы задать объект завершения, синхронизатор портфеля может использовать метод [**иреконЦилеинитиатор:: сетаборткаллбакк**](/windows/win32/api/reconcil/nf-reconcil-ireconcileinitiator-setabortcallback) .</span><span class="sxs-lookup"><span data-stu-id="ed366-156">The briefcase reconciler can use the [**IReconcileInitiator::SetAbortCallback**](/windows/win32/api/reconcil/nf-reconcil-ireconcileinitiator-setabortcallback) method to set the termination object.</span></span> <span data-ttu-id="ed366-157">Портфель не использует идентификаторы версий и не может, следовательно, предоставлять предыдущие версии документа, если посредник запрашивает их с помощью соответствующих методов в **иреконЦилеинитиатор**.</span><span class="sxs-lookup"><span data-stu-id="ed366-157">Briefcase does not use version identifiers and cannot, therefore, provide previous versions of a document if a reconciler requests them using the corresponding methods in **IReconcileInitiator**.</span></span>

<span data-ttu-id="ed366-158">Портфель передается в [**иреконЦилаблеобжект:: согласовать**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) моникеры файлов, представляющие версии документа для сверки.</span><span class="sxs-lookup"><span data-stu-id="ed366-158">Briefcase passes to [**IReconcilableObject::Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) file monikers representing the versions of the document to be reconciled.</span></span> <span data-ttu-id="ed366-159">Синхронизатор по портфелю получает доступ к версиям с помощью метода [IMoniker:: биндтубжект](/windows/win32/api/objidl/nf-objidl-imoniker-bindtoobject) или [IMoniker:: биндтостораже](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage) .</span><span class="sxs-lookup"><span data-stu-id="ed366-159">The briefcase reconciler gains access to the versions by using either the [IMoniker::BindToObject](/windows/win32/api/objidl/nf-objidl-imoniker-bindtoobject) or [IMoniker::BindToStorage](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage) method.</span></span> <span data-ttu-id="ed366-160">Последнее обычно выполняется быстрее и рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="ed366-160">The latter is generally faster and is recommended.</span></span> <span data-ttu-id="ed366-161">Посредник должен освободить все объекты или хранилище, к которым он привязан.</span><span class="sxs-lookup"><span data-stu-id="ed366-161">The reconciler must release any objects or storage to which it binds.</span></span>

<span data-ttu-id="ed366-162">Когда синхронизатор по портфелю использует [IMoniker:: биндтостораже](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage), он привязывается к хранилищу, которое является плоским хранилищем (потоком) или структурированным хранилищем, определяемым OLE.</span><span class="sxs-lookup"><span data-stu-id="ed366-162">When the briefcase reconciler uses [IMoniker::BindToStorage](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage), it binds to storage that is either flat storage (a stream) or OLE-defined structured storage.</span></span> <span data-ttu-id="ed366-163">Если для посредника требуется плоское хранилище, то для запроса интерфейса [IStream](/windows/win32/api/objidl/nn-objidl-istream) следует использовать IMoniker:: биндтостораже.</span><span class="sxs-lookup"><span data-stu-id="ed366-163">If the reconciler expects flat storage, it should use IMoniker::BindToStorage to request the [IStream](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span> <span data-ttu-id="ed366-164">Если посреднику требуется структурированное хранилище, он должен запросить интерфейс [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="ed366-164">If the reconciler expects structured storage, it should request the [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="ed366-165">В обоих случаях он должен запрашивать доступ к хранилищу только для чтения (не т. е.). доступ для чтения и записи может быть недоступен.</span><span class="sxs-lookup"><span data-stu-id="ed366-165">In both cases, it should request read-only direct (nontransacted) access to the storage; read/write access might not be available.</span></span>

<span data-ttu-id="ed366-166">Как правило, синхронизатор портфеля выглядит непосредственно на хранении других версий и работает с внедренными объектами очень примитивным образом, например путем объединения двух версий объекта, включая обе версии в выходной версии.</span><span class="sxs-lookup"><span data-stu-id="ed366-166">A minimal briefcase reconciler typically looks directly at the storage of the other versions and deals with embedded objects in a very primitive manner, such as merging two versions of the object by including both versions in the output version.</span></span>

<span data-ttu-id="ed366-167">Инициатор находит соответствующий синхронизатор портфеля с помощью подмножества логики, реализованной функцией [жетклассфиле](/windows/win32/api/objbase/nf-objbase-getclassfile) , чтобы определить тип данного файла, а затем просматривает реестр для класса-посредника, связанного с заданным типом файла.</span><span class="sxs-lookup"><span data-stu-id="ed366-167">The initiator locates the appropriate briefcase reconciler by using a subset of the logic implemented by the [GetClassFile](/windows/win32/api/objbase/nf-objbase-getclassfile) function to determine the type of a given file and then looks in the registry for the reconciler class associated with the given file type.</span></span> <span data-ttu-id="ed366-168">Портфель, как и другие компоненты оболочки, определяет тип файла только по расширению имени файла.</span><span class="sxs-lookup"><span data-stu-id="ed366-168">Briefcase, like other Shell components, determines the type of a file solely by the file name extension.</span></span> <span data-ttu-id="ed366-169">Расширение файла должно иметь зарегистрированный тип файлов для портфеля, чтобы вызвать посредника для файла.</span><span class="sxs-lookup"><span data-stu-id="ed366-169">A file's extension must have a registered file type for Briefcase to invoke a reconciler for the file.</span></span> <span data-ttu-id="ed366-170">При установке посредника необходимо задать запись реестра следующего вида.</span><span class="sxs-lookup"><span data-stu-id="ed366-170">You must set a registry entry of the following form when installing your reconciler.</span></span>

```
CLSID
   {the file CLSID}
      Roles
         Reconciler
            (Default) = {the reconciler-classid}
```

<span data-ttu-id="ed366-171">Класс должен быть быстрой загрузкой, должен быть назначен \_ мултиплеусе, и, если для интерфейса сверки не предоставлены маршалером, то должен быть внутрипроцессный сервер (содержащийся в библиотеке DLL), а не локальный сервер (реализован в exe-файле).</span><span class="sxs-lookup"><span data-stu-id="ed366-171">The class must be quick loading, must be designated \_MULTIPLEUSE, and, unless marshalers are provided for the reconciliation interface, must be an in-process server (contained in a DLL) rather than a local server (implemented in an .exe file).</span></span>

### <a name="user-interaction-in-reconciliation"></a><span data-ttu-id="ed366-172">Взаимодействие с пользователем при выверке</span><span class="sxs-lookup"><span data-stu-id="ed366-172">User Interaction in Reconciliation</span></span>

<span data-ttu-id="ed366-173">Посредник портфеля должен попытаться выполнить выверку без участия пользователя.</span><span class="sxs-lookup"><span data-stu-id="ed366-173">A briefcase reconciler should attempt to carry out reconciliation without user interaction.</span></span> <span data-ttu-id="ed366-174">Чем более автоматизирована сверка, тем лучше восприятие процесса пользователем.</span><span class="sxs-lookup"><span data-stu-id="ed366-174">The more automated the reconciliation, the better the user's perception of the process.</span></span>

<span data-ttu-id="ed366-175">В некоторых случаях вмешательство пользователя может быть ценным.</span><span class="sxs-lookup"><span data-stu-id="ed366-175">In some cases, user intervention can be valuable.</span></span> <span data-ttu-id="ed366-176">Например, системе документов может потребоваться, чтобы пользователь мог проверить изменения перед принятием объединенной версии документа или потребовать от пользователя комментарии, объясняющие внесенные изменения.</span><span class="sxs-lookup"><span data-stu-id="ed366-176">For example, a document system might require a user to review changes before accepting the merged version of a document or might require comments from the user explaining the changes that have been made.</span></span> <span data-ttu-id="ed366-177">В таких случаях инициатор, а не синхронизатор портфеля, отвечает за запрос пользователя и выполнение инструкций пользователя.</span><span class="sxs-lookup"><span data-stu-id="ed366-177">In these cases, the initiator, not the briefcase reconciler, is responsible for querying the user and carrying out the user's instructions.</span></span>

<span data-ttu-id="ed366-178">В других случаях может потребоваться вмешательство пользователя, например, если две версии были изменены с учетом несовместимых способов.</span><span class="sxs-lookup"><span data-stu-id="ed366-178">In other cases, user intervention might be necessary—for example, when two versions have been edited in incompatible ways.</span></span> <span data-ttu-id="ed366-179">В таких случаях инициатор или синхронизатор должен запросить у пользователя инструкции по устранению конфликта.</span><span class="sxs-lookup"><span data-stu-id="ed366-179">In such cases, either the initiator or briefcase reconciler must query the user for instructions on how to resolve the conflict.</span></span> <span data-ttu-id="ed366-180">Как правило, инициатор не может полагаться на завершение сверки, не ожидая какого-либо взаимодействия с пользователем.</span><span class="sxs-lookup"><span data-stu-id="ed366-180">In general, no initiator can rely on completing a reconciliation without expecting some user interaction.</span></span> <span data-ttu-id="ed366-181">У посредников, с другой стороны, есть возможность взаимодействовать с пользователем для разрешения конфликтов или для запроса инициатора.</span><span class="sxs-lookup"><span data-stu-id="ed366-181">Reconcilers, on the other hand, have the option of interacting with the user to resolve conflicts or requiring the initiator to do so.</span></span>

### <a name="reconciling-embedded-objects"></a><span data-ttu-id="ed366-182">Согласование внедренных объектов</span><span class="sxs-lookup"><span data-stu-id="ed366-182">Reconciling Embedded Objects</span></span>

<span data-ttu-id="ed366-183">При выверке документа сам посредник портфеля может стать инициатором, если обнаруживает внедренный объект типа, который не может выполнить выверку.</span><span class="sxs-lookup"><span data-stu-id="ed366-183">When reconciling a document, the briefcase reconciler itself can become an initiator if it discovers an embedded object of a type that it cannot reconcile.</span></span> <span data-ttu-id="ed366-184">В этом случае посреднику необходимо рекурсивно согласовать каждый из внедренных объектов и предположить все обязанности инициатора.</span><span class="sxs-lookup"><span data-stu-id="ed366-184">In this case, the reconciler needs to recursively reconcile each of the embedded objects and assume all the responsibilities of an initiator.</span></span>

<span data-ttu-id="ed366-185">Чтобы выполнить рекурсию, синхронизатор портфеля загружает объект и запросы для соответствующего интерфейса.</span><span class="sxs-lookup"><span data-stu-id="ed366-185">To carry out the recursion, the briefcase reconciler loads the object and queries for the appropriate interface.</span></span> <span data-ttu-id="ed366-186">Обработчик для объекта должен поддерживать интерфейс.</span><span class="sxs-lookup"><span data-stu-id="ed366-186">The handler for the object must support the interface.</span></span> <span data-ttu-id="ed366-187">Если любой метод интерфейса возвращает \_ значение OLE E \_ нотруннинг, то посредник должен запустить объект, чтобы выполнить операцию.</span><span class="sxs-lookup"><span data-stu-id="ed366-187">If any method of the interface returns the OLE\_E\_NOTRUNNING value, the reconciler must run the object in order to carry out the operation.</span></span> <span data-ttu-id="ed366-188">Поскольку код для внедренных объектов не всегда доступен, посредник должен предоставить решение для этого условия.</span><span class="sxs-lookup"><span data-stu-id="ed366-188">Because code for embedded objects is not always available, a reconciler must provide a solution for this condition.</span></span> <span data-ttu-id="ed366-189">Например, посредник может включать в выверенную версию как старые, так и новые версии внедренного объекта.</span><span class="sxs-lookup"><span data-stu-id="ed366-189">For example, the reconciler might include both old and new versions of the embedded object in the reconciled version.</span></span> <span data-ttu-id="ed366-190">Посредник не должен пытаться согласовать по ссылкам.</span><span class="sxs-lookup"><span data-stu-id="ed366-190">The reconciler must not attempt to reconcile across links.</span></span>

<span data-ttu-id="ed366-191">Инициатор сохраняет объединяемые версии документа.</span><span class="sxs-lookup"><span data-stu-id="ed366-191">The initiator stores the document versions being merged.</span></span> <span data-ttu-id="ed366-192">Во многих случаях инициатор имеет доступ к хранилищу каждой версии и сохраняет результат сверки с помощью аналогичного хранилища.</span><span class="sxs-lookup"><span data-stu-id="ed366-192">In many cases, the initiator has access to the storage of each version and saves the result of reconciliation using similar storage.</span></span> <span data-ttu-id="ed366-193">Однако иногда инициатор может иметь объект в памяти, для которого не доступна постоянная версия.</span><span class="sxs-lookup"><span data-stu-id="ed366-193">Sometimes, however, the initiator might have an in-memory object for which no persistent version is available.</span></span> <span data-ttu-id="ed366-194">Такая ситуация может возникнуть, когда документ, содержащий открытые внедренные объекты, должен быть согласован перед сохранением.</span><span class="sxs-lookup"><span data-stu-id="ed366-194">This situation can occur when a document containing open embedded objects must be reconciled before being saved.</span></span> <span data-ttu-id="ed366-195">В таких случаях инициатор сохраняет результат сверки в версии, найденной в памяти.</span><span class="sxs-lookup"><span data-stu-id="ed366-195">In such cases, the initiator saves the result of the reconciliation in the version found in memory.</span></span>

<span data-ttu-id="ed366-196">Инициатор использует интерфейс [иперсистстораже](/windows/win32/api/objidl/nn-objidl-ipersiststorage) для привязки (загрузки) Объединенной версии.</span><span class="sxs-lookup"><span data-stu-id="ed366-196">The initiator uses the [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) interface to bind (load) the merged version.</span></span> <span data-ttu-id="ed366-197">Инициатор использует метод [иперсистстораже:: Load](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) , если исходная версия уже создана, и использует метод [Иперсистстораже:: InitNew](/windows/win32/api/objidl/nf-objidl-ipersiststorage-initnew) для первоначальной версии.</span><span class="sxs-lookup"><span data-stu-id="ed366-197">The initiator uses the [IPersistStorage::Load](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) method if an initial version has already been created and uses the [IPersistStorage::InitNew](/windows/win32/api/objidl/nf-objidl-ipersiststorage-initnew) method for the initial version.</span></span> <span data-ttu-id="ed366-198">При загрузке объединенной версии инициатор использует [QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) для получения адреса интерфейса [**иреконЦилаблеобжект**](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) .</span><span class="sxs-lookup"><span data-stu-id="ed366-198">When the merged version is loaded, the initiator uses [QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) to retrieve the address of the [**IReconcilableObject**](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) interface.</span></span> <span data-ttu-id="ed366-199">Этот интерфейс предоставляет инициатору доступ к хранилищу существующих ресидуес и дает возможность создавать хранилище для всех новых ресидуес.</span><span class="sxs-lookup"><span data-stu-id="ed366-199">This interface gives the initiator access to the storage of the existing residues and gives it a way to create storage for any new residues.</span></span> <span data-ttu-id="ed366-200">Затем инициатор направляет интерфейс для выполнения сверки.</span><span class="sxs-lookup"><span data-stu-id="ed366-200">Then the initiator directs the interface to carry out the reconciliation.</span></span> <span data-ttu-id="ed366-201">Инициатор фактически запрашивает интерфейс [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) перед иперсистстораже.</span><span class="sxs-lookup"><span data-stu-id="ed366-201">The initiator actually queries for the [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface before IPersistStorage.</span></span> <span data-ttu-id="ed366-202">Если посредник поддерживает IPersistFile, инициатор управляет репликой через IPersistFile, а не с помощью методов Иперсистстораже.</span><span class="sxs-lookup"><span data-stu-id="ed366-202">If the reconciler supports IPersistFile, the initiator manipulates the replica through the IPersistFile rather than the IPersistStorage methods.</span></span> <span data-ttu-id="ed366-203">Это позволяет выверять файлы, которые не хранятся в виде составных документов.</span><span class="sxs-lookup"><span data-stu-id="ed366-203">This permits reconciliation of files that are not stored as compound documents.</span></span>

<span data-ttu-id="ed366-204">После завершения сверки инициатор может сохранить объединенную версию с помощью интерфейса [иперсистстораже](/windows/win32/api/objidl/nn-objidl-ipersiststorage) или [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) .</span><span class="sxs-lookup"><span data-stu-id="ed366-204">When the reconciliation is complete, the initiator can save the merged version by using the [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) or [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface.</span></span> <span data-ttu-id="ed366-205">Во время сверки с помощью синхронизатора портфеля создает ресидуес по мере необходимости и записывает их постоянные биты в хранилище.</span><span class="sxs-lookup"><span data-stu-id="ed366-205">During reconciliation, the briefcase reconciler creates residues as needed and writes their persistent bits to storage.</span></span> <span data-ttu-id="ed366-206">Если Объединенная версия является потоком, интерфейс [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) , переданный в [Иперсистстораже:: Load](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) , содержит поток с именем Content и состоянием хранилища, установленным в статебитс \_ Flat.</span><span class="sxs-lookup"><span data-stu-id="ed366-206">If the merged version is a stream, the [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) interface passed to [IPersistStorage::Load](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) contains a stream named "Contents" with its storage state set to STATEBITS\_FLAT.</span></span> <span data-ttu-id="ed366-207">(Можно задать биты состояния с помощью метода [IStorage:: stat](/windows/win32/api/objidl/nf-objidl-istorage-stat) .) После объединения инициатор сохраняет объединенную версию, записывая данные соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="ed366-207">(You can set the state bits by using the [IStorage::Stat](/windows/win32/api/objidl/nf-objidl-istorage-stat) method.) After the merge, the initiator saves the merged version by writing the data in an appropriate manner.</span></span> <span data-ttu-id="ed366-208">Он должен гарантировать, что СТАТЕБИТС \_ Flat задано соответствующим образом для хранилища.</span><span class="sxs-lookup"><span data-stu-id="ed366-208">It should ensure that STATEBITS\_FLAT is set as appropriate for the storage.</span></span>

### <a name="residues"></a><span data-ttu-id="ed366-209">ресидуес</span><span class="sxs-lookup"><span data-stu-id="ed366-209">Residues</span></span>

<span data-ttu-id="ed366-210">Инициатор указывает, требуется ли ресидуес, установив для параметра *пстгневресидуес* допустимый адрес при вызове метода [**ИреконЦилаблеобжект:: Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) .</span><span class="sxs-lookup"><span data-stu-id="ed366-210">The initiator indicates whether it wants residues by setting the *pstgNewResidues* parameter to a valid address when calling the [**IReconcilableObject::Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) method.</span></span> <span data-ttu-id="ed366-211">Если посредник не поддерживает создание ресидуес, он должен вернуть \_ значение REC E \_ норесидуес, если только параметр *dwFlags* не указывает значение **реконЦилеф \_ норесидуесок** .</span><span class="sxs-lookup"><span data-stu-id="ed366-211">If the reconciler does not support the creation of residues, it must return immediately the REC\_E\_NORESIDUES value, unless the *dwFlags* parameter specifies the **RECONCILEF\_NORESIDUESOK** value.</span></span>

<span data-ttu-id="ed366-212">Синхронизатор по портфелю возвращает ресидуес инициатору, создавая новые элементы хранения и копируя их в массив, на который указывает *пстгневресидуес*.</span><span class="sxs-lookup"><span data-stu-id="ed366-212">The briefcase reconciler returns residues to the initiator by creating new storage elements and copying them to the array pointed to by *pstgNewResidues*.</span></span> <span data-ttu-id="ed366-213">Для структурированного хранилища ресидуес посредник копирует интерфейс [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) , а для неструктурированного ресидуес хранилища копирует интерфейс [IStream](/windows/win32/api/objidl/nn-objidl-istream) или IStorage с \_ установленным флагом плоской статебитс.</span><span class="sxs-lookup"><span data-stu-id="ed366-213">For structured storage residues, the reconciler copies an [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) interface, and for flat storage residues, it copies either an [IStream](/windows/win32/api/objidl/nn-objidl-istream) or an IStorage interface with the STATEBITS\_FLAT flag set.</span></span> <span data-ttu-id="ed366-214">Посредник использует IStorage для создания необходимого хранилища, используя [IStorage:: креатестреам](/windows/win32/api/objidl/nf-objidl-istorage-createstream) для создания плоского хранилища для ресидуе, который является потоком, и [IStorage:: креатестораже](/windows/win32/api/objidl/nf-objidl-istorage-createstorage) для создания структурированного хранилища.</span><span class="sxs-lookup"><span data-stu-id="ed366-214">The reconciler uses IStorage to create the necessary storage, using [IStorage::CreateStream](/windows/win32/api/objidl/nf-objidl-istorage-createstream) to create flat storage for a residue that is a stream and [IStorage::CreateStorage](/windows/win32/api/objidl/nf-objidl-istorage-createstorage) to create structured storage.</span></span>

<span data-ttu-id="ed366-215">Инициатор подготавливает *пстгневресидуес* , чтобы он не содержал элементов в нерезервированной части пространства имен [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="ed366-215">The initiator prepares *pstgNewResidues* so that it contains no elements in the nonreserved part of the [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) namespace.</span></span> <span data-ttu-id="ed366-216">Синхронизатор портфеля помещает каждый ресидуе в элемент, имя которого соответствует порядку начальной версии.</span><span class="sxs-lookup"><span data-stu-id="ed366-216">The briefcase reconciler places each residue in an element whose name corresponds to the order of its initial version.</span></span> <span data-ttu-id="ed366-217">Например, первый ресидуе содержится в «1», второй — в «2» и т. д.</span><span class="sxs-lookup"><span data-stu-id="ed366-217">For example, the first residue is contained in "1", the second in "2", and so on.</span></span> <span data-ttu-id="ed366-218">Если выверенный объект создает ресидуе, он находится в элементе с именем "0".</span><span class="sxs-lookup"><span data-stu-id="ed366-218">If the reconciled object itself produces a residue, it is found in the element named "0".</span></span>

<span data-ttu-id="ed366-219">Синхронизатор по портфелю фиксирует каждый созданный элемент по отдельности, гарантируя, что инициатор получает доступ к информации.</span><span class="sxs-lookup"><span data-stu-id="ed366-219">The briefcase reconciler commits each of the newly created elements individually, ensuring that the initiator has access to the information.</span></span> <span data-ttu-id="ed366-220">Однако посредник не фиксирует сам *пстгневресидуес* .</span><span class="sxs-lookup"><span data-stu-id="ed366-220">The reconciler does not, however, commit *pstgNewResidues* itself.</span></span> <span data-ttu-id="ed366-221">Инициатор отвечает за фиксацию этого или его уничтожения.</span><span class="sxs-lookup"><span data-stu-id="ed366-221">The initiator is responsible for committing this or otherwise disposing of it.</span></span>

## <a name="briefcase-reconciler-reference"></a><span data-ttu-id="ed366-222">Справочник по выверке портфеля</span><span class="sxs-lookup"><span data-stu-id="ed366-222">Briefcase Reconciler Reference</span></span>

<span data-ttu-id="ed366-223">В этом разделе содержатся сведения об интерфейсах сверки.</span><span class="sxs-lookup"><span data-stu-id="ed366-223">This section contains information about the reconciliation interfaces.</span></span> <span data-ttu-id="ed366-224">При обработке ошибок метод может возвращать только те значения ошибок, которые явно определены как возможные возвращаемые значения.</span><span class="sxs-lookup"><span data-stu-id="ed366-224">When handling errors, a method can return only those error values that are explicitly defined as possible return values.</span></span> <span data-ttu-id="ed366-225">Кроме того, метод должен установить все переменные, адреса которых передаются в качестве параметров в **значение NULL** перед возвратом из ошибки.</span><span class="sxs-lookup"><span data-stu-id="ed366-225">Furthermore, the method must set all variables whose addresses are passed as parameters to **NULL** before returning from the error.</span></span>

### <a name="briefcase-reconciler-interfaces-and-methods"></a><span data-ttu-id="ed366-226">Интерфейсы и методы посредника портфеля</span><span class="sxs-lookup"><span data-stu-id="ed366-226">Briefcase Reconciler Interfaces and Methods</span></span>

-   [<span data-ttu-id="ed366-227">**иреконЦилаблеобжект**</span><span class="sxs-lookup"><span data-stu-id="ed366-227">**IReconcilableObject**</span></span>](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) 
    -   -   [<span data-ttu-id="ed366-228">**ИреконЦилаблеобжект:: Жетпрогрессфидбаккмаксестимате**</span><span class="sxs-lookup"><span data-stu-id="ed366-228">**IReconcilableObject::GetProgressFeedbackMaxEstimate**</span></span>](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-getprogressfeedbackmaxestimate)
        -   [<span data-ttu-id="ed366-229">**ИреконЦилаблеобжект:: Reconcile**</span><span class="sxs-lookup"><span data-stu-id="ed366-229">**IReconcilableObject::Reconcile**</span></span>](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile)

-   [<span data-ttu-id="ed366-230">**иреконЦилеинитиатор**</span><span class="sxs-lookup"><span data-stu-id="ed366-230">**IReconcileInitiator**</span></span>](ireconcileinitiator.md) 
    -   -   [<span data-ttu-id="ed366-231">**ИреконЦилеинитиатор:: Сетаборткаллбакк**</span><span class="sxs-lookup"><span data-stu-id="ed366-231">**IReconcileInitiator::SetAbortCallback**</span></span>](/windows/win32/api/reconcil/nf-reconcil-ireconcileinitiator-setabortcallback)
        -   [<span data-ttu-id="ed366-232">**ИреконЦилеинитиатор:: Сетпрогрессфидбакк**</span><span class="sxs-lookup"><span data-stu-id="ed366-232">**IReconcileInitiator::SetProgressFeedback**</span></span>](/windows/win32/api/reconcil/nf-reconcil-ireconcileinitiator-setprogressfeedback)

-   [<span data-ttu-id="ed366-233">**инотифиреплика**</span><span class="sxs-lookup"><span data-stu-id="ed366-233">**INotifyReplica**</span></span>](/windows/desktop/api/reconcil/nn-reconcil-inotifyreplica) 
    -   -   [<span data-ttu-id="ed366-234">**Инотифиреплика:: Йоуареареплика**</span><span class="sxs-lookup"><span data-stu-id="ed366-234">**INotifyReplica::YouAreAReplica**</span></span>](/windows/desktop/api/reconcil/nf-reconcil-inotifyreplica-youareareplica)

 

 