---
title: Добавление функциональных возможностей агента Microsoft Agent в приложение
description: Добавление функциональных возможностей агента Microsoft Agent в приложение
ms.assetid: 2b4816dd-11bf-4c17-873e-4bdbb7fa1ccf
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8a2972b0251a4114e5d280d8f739d416ebc5dc1c
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104337076"
---
# <a name="adding-microsoft-agent-functionality-to-your-application"></a><span data-ttu-id="be89e-103">Добавление функциональных возможностей агента Microsoft Agent в приложение</span><span class="sxs-lookup"><span data-stu-id="be89e-103">Adding Microsoft Agent Functionality to Your Application</span></span>

<span data-ttu-id="be89e-104">\[Microsoft Agent является устаревшим в Windows 7 и может быть недоступен в последующих версиях Windows.\]</span><span class="sxs-lookup"><span data-stu-id="be89e-104">\[Microsoft Agent is deprecated as of Windows 7, and may be unavailable in subsequent versions of Windows.\]</span></span>

<span data-ttu-id="be89e-105">Для доступа к интерфейсам сервера Microsoft Agent агент должен быть уже установлен в целевой системе.</span><span class="sxs-lookup"><span data-stu-id="be89e-105">To access Microsoft Agent's server interfaces, Agent must already be installed on the target system.</span></span> <span data-ttu-id="be89e-106">Установка, отличная от использования автономного исполняемого файла агента, например попытки копирования и регистрации файлов компонентов агента, не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="be89e-106">Installation other than using Agent's self-installing executable file, such as attempting to copy and register Agent component files, is not supported.</span></span> <span data-ttu-id="be89e-107">Это гарантирует последовательную и полную установку.</span><span class="sxs-lookup"><span data-stu-id="be89e-107">This ensures consistent and complete installation.</span></span> <span data-ttu-id="be89e-108">Обратите внимание, что самостоятельно устанавливаемый файл Microsoft Agent не будет установлен в Microsoft Windows 2000 и более поздних операционных системах, так как эти версии операционной системы уже содержат собственную версию агента.</span><span class="sxs-lookup"><span data-stu-id="be89e-108">Note that the Microsoft Agent self-installing file will not install on Microsoft Windows 2000 and later operating systems because these versions of the operating system already include their own version of Agent.</span></span>

<span data-ttu-id="be89e-109">Чтобы успешно установить агент в целевой системе с предыдущей операционной системой Microsoft Windows, необходимо также убедиться в том, что в целевой системе установлена последняя версия среды выполнения Microsoft Visual C++ (Msvcrt.dll), средство регистрации Майкрософт (Regsvr32.dll) и библиотеки DLL Microsoft COM.</span><span class="sxs-lookup"><span data-stu-id="be89e-109">To successfully install Agent on a target system with a prior Microsoft Windows operating system, you must also ensure that the target system has a recent version of the Microsoft Visual C++ runtime (Msvcrt.dll), Microsoft registration tool (Regsvr32.dll), and Microsoft COM dlls.</span></span> <span data-ttu-id="be89e-110">Самый простой способ убедиться, что необходимые компоненты находятся в целевой системе, — это требовать установки Microsoft Internet Explorer 3,02 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="be89e-110">The easiest way to ensure that the necessary components are on the target system is to require that Microsoft Internet Explorer 3.02 or later is installed.</span></span> <span data-ttu-id="be89e-111">Кроме того, можно установить два первых компонента, которые доступны в составе Microsoft Visual C++.</span><span class="sxs-lookup"><span data-stu-id="be89e-111">Alternatively, you can install the first two components which are available as part of Microsoft Visual C++.</span></span> <span data-ttu-id="be89e-112">Необходимые DLL-библиотеки COM можно установить в рамках обновления Microsoft DCOM, доступного на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="be89e-112">The necessary COM dlls can be installed as part of the Microsoft DCOM update, available at the Microsoft website.</span></span> <span data-ttu-id="be89e-113">Дополнительные сведения и сведения о лицензировании для этих компонентов можно найти на веб-сайте Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="be89e-113">You can find further information and licensing information for these components at the Microsoft website.</span></span>

<span data-ttu-id="be89e-114">Компоненты языка агента можно установить таким же образом.</span><span class="sxs-lookup"><span data-stu-id="be89e-114">Agent's language components can be installed the same way.</span></span> <span data-ttu-id="be89e-115">Аналогичным образом можно использовать этот метод, чтобы установить формат ACS символов Майкрософт, доступных для распространения, с веб-сайта Microsoft Agent.</span><span class="sxs-lookup"><span data-stu-id="be89e-115">Similarly, you can use this technique to install the ACS format of the Microsoft characters available for distribution from the Microsoft Agent website.</span></span> <span data-ttu-id="be89e-116">Файлы символов автоматически устанавливаются в подкаталог Microsoft Agent \\ chars.</span><span class="sxs-lookup"><span data-stu-id="be89e-116">The character files automatically install to the Microsoft Agent \\Chars subdirectory.</span></span>

<span data-ttu-id="be89e-117">Поскольку компоненты Microsoft Agent разработаны как компоненты операционной системы, агент может не быть удален.</span><span class="sxs-lookup"><span data-stu-id="be89e-117">Because Microsoft Agent's components are designed as operating system components, Agent may not be uninstalled.</span></span> <span data-ttu-id="be89e-118">Аналогично, когда агент уже установлен в составе операционной системы Windows, сам установочный CAB-файл агента может не устанавливаться.</span><span class="sxs-lookup"><span data-stu-id="be89e-118">Similarly, where Agent is already installed as part of the Windows operating system, the Agent self-installing cabinet may not install.</span></span>

<span data-ttu-id="be89e-119">После установки для вызова интерфейсов агента создайте экземпляр сервера и запросите указатель на конкретный интерфейс, который сервер поддерживает, используя стандартное соглашение COM.</span><span class="sxs-lookup"><span data-stu-id="be89e-119">Once installed, to call Agent's interfaces, create an instance of the server and request a pointer to a specific interface that the server supports using the standard COM convention.</span></span> <span data-ttu-id="be89e-120">В частности, Библиотека COM предоставляет функцию API, [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance), которая создает экземпляр объекта и возвращает указатель на запрашиваемый интерфейс объекта.</span><span class="sxs-lookup"><span data-stu-id="be89e-120">In particular, the COM library provides an API function, [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance), that creates an instance of the object and returns a pointer to the requested interface of the object.</span></span> <span data-ttu-id="be89e-121">Запросите указатель на интерфейс [**иажент**](iagent.md) или [**иажентекс**](iagentex.md) в вызове **CoCreateInstance** или в последующем вызове [**QueryInterface**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-queryinterface(q)).</span><span class="sxs-lookup"><span data-stu-id="be89e-121">Request a pointer to the [**IAgent**](iagent.md) or [**IAgentEx**](iagentex.md) interface in your **CoCreateInstance** call or in a subsequent call to [**QueryInterface**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-queryinterface(q)).</span></span>

<span data-ttu-id="be89e-122">Следующий код иллюстрирует это в C/C++.</span><span class="sxs-lookup"><span data-stu-id="be89e-122">The following code illustrates this in C/C++.</span></span>


```
hRes = CoCreateInstance(CLSID_AgentServer,
                     NULL,
                     CLSCTX_SERVER,
                     IID_IAgentEx,
                     (LPVOID *)&amp;pAgentEx);
```



<span data-ttu-id="be89e-123">Если сервер Microsoft Agent работает, эта функция подключается к серверу; в противном случае запускается сервер.</span><span class="sxs-lookup"><span data-stu-id="be89e-123">If the Microsoft Agent server is running, this function connects to the server; otherwise, it starts up the server.</span></span>

<span data-ttu-id="be89e-124">Обратите внимание, что интерфейсы сервера Microsoft Agent часто включают в себя расширенные интерфейсы, включающие суффикс "ex".</span><span class="sxs-lookup"><span data-stu-id="be89e-124">Note that the Microsoft Agent server interfaces often include extended interfaces that include an "Ex" suffix.</span></span> <span data-ttu-id="be89e-125">Эти интерфейсы являются производными от и, следовательно, включают все функции, их аналоги, не относящиеся к ex.</span><span class="sxs-lookup"><span data-stu-id="be89e-125">These interfaces are derived from, and therefore include all the functionality of, their non-Ex counterparts.</span></span> <span data-ttu-id="be89e-126">Если вы хотите использовать любой из расширенных функций, используйте интерфейсы ex.</span><span class="sxs-lookup"><span data-stu-id="be89e-126">If you want to use any of the extended features, use the Ex interfaces.</span></span>

<span data-ttu-id="be89e-127">Функции, которые принимают указатели на BSTR, выделяют память с помощью [**сисаллокстринг**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-sysallocstring).</span><span class="sxs-lookup"><span data-stu-id="be89e-127">Functions that take pointers to BSTRs allocate memory using [**SysAllocString**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-sysallocstring).</span></span> <span data-ttu-id="be89e-128">Он отвечает за освобождение этой памяти с помощью [**сисфристринг**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-sysfreestring).</span><span class="sxs-lookup"><span data-stu-id="be89e-128">It is the caller's responsibility to free this memory using [**SysFreeString**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-sysfreestring).</span></span>

 

 