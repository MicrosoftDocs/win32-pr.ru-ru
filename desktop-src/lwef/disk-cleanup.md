---
title: Создание обработчика очистки диска
description: Один аксиома проверенное время и еще раз в мире компьютеров заключается в том, что независимо от размера хранилища вашего компьютера, вы в конечном итоге заполните его.
ms.assetid: f85e0db7-fbdb-452e-90c8-672f716b5692
keywords:
- обработчики очистки диска
- Очистка диска
- датадривенклеанер
- регистрация, обработчики очистки диска
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 30584439ae2c38ae8a9b7106dae96f69eea5df37
ms.sourcegitcommit: ae73f4dd3cf5a3c6a1ea7d191ca32a5b01f6686b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/08/2020
ms.locfileid: "105691686"
---
# <a name="creating-a-disk-cleanup-handler"></a><span data-ttu-id="784f5-107">Создание обработчика очистки диска</span><span class="sxs-lookup"><span data-stu-id="784f5-107">Creating a Disk Cleanup Handler</span></span>

<span data-ttu-id="784f5-108">Один аксиома проверенное время и еще раз в мире компьютеров заключается в том, что независимо от размера хранилища вашего компьютера, вы в конечном итоге заполните его.</span><span class="sxs-lookup"><span data-stu-id="784f5-108">One axiom proven time and again in the world of computers is that regardless of the size of your computer's storage capacity, you will eventually fill it up.</span></span> <span data-ttu-id="784f5-109">Хотя средний размер жесткого диска компьютера значительно увеличился со временем, приложения также увеличились соответствующим образом, оставляя пользователям возможность создавать больше свободного пространства на жестком диске.</span><span class="sxs-lookup"><span data-stu-id="784f5-109">While the average size of a computer's hard disk has increased dramatically over time, applications have also grown accordingly, leaving users looking for ways to create more free hard disk space.</span></span> <span data-ttu-id="784f5-110">Доступное пространство также сокращается по количеству временных файлов, создаваемых приложениями для резервного копирования или по соображениям производительности.</span><span class="sxs-lookup"><span data-stu-id="784f5-110">Available space is also reduced by the many temporary files that applications create for backup or performance reasons.</span></span> <span data-ttu-id="784f5-111">Когда место на диске оказывается низким, необходимо уменьшить объем пространства, используемого приложениями.</span><span class="sxs-lookup"><span data-stu-id="784f5-111">When disk space becomes low, it becomes necessary to reduce the amount of space used by applications.</span></span> <span data-ttu-id="784f5-112">Свободное место на диске можно освободить с помощью различных средств, включая следующие.</span><span class="sxs-lookup"><span data-stu-id="784f5-112">Disk space can be freed using a variety of means, including the following:</span></span>

-   <span data-ttu-id="784f5-113">Удаление файлов.</span><span class="sxs-lookup"><span data-stu-id="784f5-113">Deleting files.</span></span>
-   <span data-ttu-id="784f5-114">Сжатие файлов.</span><span class="sxs-lookup"><span data-stu-id="784f5-114">Compressing files.</span></span>
-   <span data-ttu-id="784f5-115">Перемещение файлов на носитель резервной копии.</span><span class="sxs-lookup"><span data-stu-id="784f5-115">Moving files to a backup medium.</span></span>
-   <span data-ttu-id="784f5-116">Передача файлов на удаленный сервер.</span><span class="sxs-lookup"><span data-stu-id="784f5-116">Transferring files to a remote server.</span></span>

<span data-ttu-id="784f5-117">Ниже перечислены файлы, которые являются хорошими кандидатами для очистки.</span><span class="sxs-lookup"><span data-stu-id="784f5-117">Files that are good candidates for cleanup include:</span></span>

-   <span data-ttu-id="784f5-118">Файлы, которые пользователю больше не понадобятся.</span><span class="sxs-lookup"><span data-stu-id="784f5-118">Files that the user will never need again.</span></span>
-   <span data-ttu-id="784f5-119">Временные файлы, которые существуют только в целях повышения производительности.</span><span class="sxs-lookup"><span data-stu-id="784f5-119">Temporary files that exist only for performance reasons.</span></span>
-   <span data-ttu-id="784f5-120">Файлы, которые можно восстановить (при необходимости) с установочного компакт-диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-120">Files that can be restored, if needed, from an installation CD.</span></span>
-   <span data-ttu-id="784f5-121">Файлы данных, которые могут быть заменены более новыми версиями, например старые файлы резервных копий.</span><span class="sxs-lookup"><span data-stu-id="784f5-121">Data files that have possibly been superseded by newer versions, such as old backup files.</span></span>
-   <span data-ttu-id="784f5-122">Старые файлы, которые не использовались в течение длительного времени.</span><span class="sxs-lookup"><span data-stu-id="784f5-122">Older files that have not been used in a long time.</span></span>

<span data-ttu-id="784f5-123">Удаление особенно подходит для файлов, которые пользователю больше не понадобятся, например, для файлов, временно кэшируемых в целях повышения производительности.</span><span class="sxs-lookup"><span data-stu-id="784f5-123">Deletion is particularly appropriate for files that the user will never need again for example, files that are temporarily cached for performance reasons.</span></span> <span data-ttu-id="784f5-124">Удаление также подходит для файлов, которые легко восстановить, например графические файлы, которые можно загрузить с установочного компакт-диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-124">Deletion is also appropriate for files that are easily restored, such as graphics files that can be reloaded from an installation CD.</span></span> <span data-ttu-id="784f5-125">Файлы, которые может потребовать пользователь, или которые трудно воссоздать, лучше подходят для сжатия или резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="784f5-125">Files that the user might need later or that would be difficult to reconstruct are better candidates for compression or backup.</span></span>

<span data-ttu-id="784f5-126">Ожидается, что пользователь вручную очищать файловую систему не является хорошим решением.</span><span class="sxs-lookup"><span data-stu-id="784f5-126">Expecting a user to manually clean the file system is not a good solution.</span></span> <span data-ttu-id="784f5-127">Пользователь может не знать, где находится много файлов, или узнать, какие из них можно безопасно удалить.</span><span class="sxs-lookup"><span data-stu-id="784f5-127">The user may not know where many of the files are located or how to recognize which ones can be safely removed.</span></span> <span data-ttu-id="784f5-128">Кроме того, существует риск, что пользователь может удалить нужные файлы.</span><span class="sxs-lookup"><span data-stu-id="784f5-128">In addition, there's the risk that the user might delete essential files.</span></span>

<span data-ttu-id="784f5-129">В этом разделе обсуждаются следующие аспекты служебной программы очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-129">The following facets of the Disk Cleanup utility are discussed in this topic.</span></span>

-   [<span data-ttu-id="784f5-130">Служебная программа для очистки диска Windows</span><span class="sxs-lookup"><span data-stu-id="784f5-130">The Windows Disk Cleanup Utility</span></span>](#the-windows-disk-cleanup-utility)
-   [<span data-ttu-id="784f5-131">Основы реализации</span><span class="sxs-lookup"><span data-stu-id="784f5-131">Implementation Basics</span></span>](#implementation-basics)
    -   [<span data-ttu-id="784f5-132">Инициализация/Инитиализикс</span><span class="sxs-lookup"><span data-stu-id="784f5-132">Initialize/InitializeEx</span></span>](#initializeinitializeex)
    -   [<span data-ttu-id="784f5-133">жетспацеусед</span><span class="sxs-lookup"><span data-stu-id="784f5-133">GetSpaceUsed</span></span>](#getspaceused)
    -   [<span data-ttu-id="784f5-134">шовпропертиес</span><span class="sxs-lookup"><span data-stu-id="784f5-134">ShowProperties</span></span>](#showproperties)
    -   [<span data-ttu-id="784f5-135">Purge</span><span class="sxs-lookup"><span data-stu-id="784f5-135">Purge</span></span>](#purge)
    -   [<span data-ttu-id="784f5-136">Отключение</span><span class="sxs-lookup"><span data-stu-id="784f5-136">Deactivate</span></span>](#deactivate)
-   [<span data-ttu-id="784f5-137">Регистрация обработчика очистки диска</span><span class="sxs-lookup"><span data-stu-id="784f5-137">Registering a Disk Cleanup Handler</span></span>](#registering-a-disk-cleanup-handler)
    -   [<span data-ttu-id="784f5-138">Регистрация CLSID обработчика</span><span class="sxs-lookup"><span data-stu-id="784f5-138">Registering a Handler's CLSID</span></span>](#registering-a-handlers-clsid)
    -   [<span data-ttu-id="784f5-139">Регистрация обработчика с помощью диспетчера очистки диска: общие</span><span class="sxs-lookup"><span data-stu-id="784f5-139">Registering a Handler with the Disk Cleanup Manager: General</span></span>](#registering-a-handler-with-the-disk-cleanup-manager-general)
    -   [<span data-ttu-id="784f5-140">Регистрация обработчика с помощью диспетчера очистки диска: Windows 2000 или более поздние системы</span><span class="sxs-lookup"><span data-stu-id="784f5-140">Registering a Handler with the Disk Cleanup Manager: Windows 2000 or Later Systems</span></span>](#registering-a-handler-with-the-disk-cleanup-manager-windows-2000-or-later-systems)
    -   [<span data-ttu-id="784f5-141">Использование объекта Датадривенклеанер</span><span class="sxs-lookup"><span data-stu-id="784f5-141">Using the DataDrivenCleaner Object</span></span>](#using-the-datadrivencleaner-object)
    -   [<span data-ttu-id="784f5-142">Пример регистрации обработчика очистки диска</span><span class="sxs-lookup"><span data-stu-id="784f5-142">Example Registration of a Disk Cleanup Handler</span></span>](#example-registration-of-a-disk-cleanup-handler)

## <a name="the-windows-disk-cleanup-utility"></a><span data-ttu-id="784f5-143">Служебная программа для очистки диска Windows</span><span class="sxs-lookup"><span data-stu-id="784f5-143">The Windows Disk Cleanup Utility</span></span>

<span data-ttu-id="784f5-144">Начиная с Windows 98, операционная система Windows включает в себя программу очистки диска, которая упрощает для пользователя управление доступным местом на жестком диске.</span><span class="sxs-lookup"><span data-stu-id="784f5-144">Starting on Windows 98, the Windows operating system includes Disk Cleanup, a utility that makes it much easier for the user to manage available hard disk space.</span></span> <span data-ttu-id="784f5-145">Служебная программа для очистки диска разработана таким образом, чтобы освободить максимально возможное дисковое пространство и снизить риск случайного удаления пользователем необходимых файлов.</span><span class="sxs-lookup"><span data-stu-id="784f5-145">The Disk Cleanup utility is designed to free up as much disk space as possible and decrease the risk that the user will delete essential files accidentally.</span></span>

<span data-ttu-id="784f5-146">Очистка диска может быть инициирована тремя способами.</span><span class="sxs-lookup"><span data-stu-id="784f5-146">Disk cleanup can be initiated in three ways.</span></span>

-   <span data-ttu-id="784f5-147">Пользователь может инициировать очистку диска, нажав кнопку **Пуск**; Указание на **все программы**, **стандартные** и **системные средства**; и выберите пункт **Очистка диска**.</span><span class="sxs-lookup"><span data-stu-id="784f5-147">The user can initiate disk cleanup by clicking **Start**; pointing to **All Programs**, **Accessories**, and **System Tools**; and then clicking **Disk Cleanup**.</span></span>
-   <span data-ttu-id="784f5-148">Система уведомляет пользователя с сообщением о том, что неиспользуемое дисковое пространство достигло критического режима.</span><span class="sxs-lookup"><span data-stu-id="784f5-148">The system notifies the user with a message box that unused disk space has reached critical mode.</span></span> <span data-ttu-id="784f5-149">Пороговое значение критического режима для диска размером более 2,25 гигабайт (ГБ) составляет 200 МБ.</span><span class="sxs-lookup"><span data-stu-id="784f5-149">The critical mode threshold for a drive larger than 2.25 gigabytes (GB) is 200 megabytes (MB).</span></span> <span data-ttu-id="784f5-150">Последующие предупреждения приведены в 80, 50 и 1 МБ.</span><span class="sxs-lookup"><span data-stu-id="784f5-150">Subsequent warnings are given at 80, 50, and 1 MB.</span></span> <span data-ttu-id="784f5-151">Пользователю предоставляется возможность освободить место на диске вручную или запустить служебную программу очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-151">The user is given the option of freeing disk space manually or starting the Disk Cleanup utility.</span></span>
-   <span data-ttu-id="784f5-152">У пользователя может быть мастер планирования заданий Windows (известный как мастер обслуживания в старых системах) запускать служебную программу очистки диска автоматически в запланированное время.</span><span class="sxs-lookup"><span data-stu-id="784f5-152">The user can have the Windows Scheduled Task Wizard (known as the Maintenance Wizard on older systems) run the Disk Cleanup utility automatically at scheduled times.</span></span>

<span data-ttu-id="784f5-153">Основная задача, характерная для очистки диска, — освободить столько дисковых пространств, сколько возможно, без удаления необходимых файлов.</span><span class="sxs-lookup"><span data-stu-id="784f5-153">The basic challenge inherent in disk cleanup is to free as much disk space as possible without deleting essential files.</span></span> <span data-ttu-id="784f5-154">Поскольку нет стандартного способа маркировки файлов для очистки, ни одно приложение не может надежно обнаруживать и очищать все ненужные файлы.</span><span class="sxs-lookup"><span data-stu-id="784f5-154">Because there is no standard way to mark files for cleanup, no single application can reliably detect and clean all unessential files.</span></span> <span data-ttu-id="784f5-155">Служебная программа для очистки диска решает эту проблему, разбивая операцию очистки между одним *диспетчером очистки диска* и набором *обработчиков очистки диска*.</span><span class="sxs-lookup"><span data-stu-id="784f5-155">The Disk Cleanup utility addresses this problem by splitting the cleanup operation between a single *disk cleanup manager* and a collection of *disk cleanup handlers*.</span></span>

<span data-ttu-id="784f5-156">При запуске служебной программы очистки диска пользователь видит следующее диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="784f5-156">When the Disk Cleanup utility is run, the user sees the following dialog box.</span></span> <span data-ttu-id="784f5-157">(Если на компьютере существует более одного диска или раздела диска, пользователю сначала предлагается выбрать диск перед отображением этого диалогового окна.)</span><span class="sxs-lookup"><span data-stu-id="784f5-157">(If more than one disk or disk partition exists on the computer, the user is first asked to choose a drive before this dialog is displayed.)</span></span>

![снимок экрана диалогового окна "Очистка"](images/cleanup1.png)

<span data-ttu-id="784f5-159">Диспетчер очистки диска является частью операционной системы.</span><span class="sxs-lookup"><span data-stu-id="784f5-159">The disk cleanup manager is part of the operating system.</span></span> <span data-ttu-id="784f5-160">Он отображает диалоговое окно, показанное на предыдущем рисунке, обрабатывает ввод пользователя и управляет операцией очистки.</span><span class="sxs-lookup"><span data-stu-id="784f5-160">It displays the dialog box shown in the preceding illustration, handles user input, and manages the cleanup operation.</span></span> <span data-ttu-id="784f5-161">Фактический выбор и очистка ненужных файлов выполняются обработчиками очистки отдельных дисков, показанными в списке Диспетчер очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-161">The actual selection and cleanup of unneeded files is done by the individual disk cleanup handlers shown in the disk cleanup manager's list box.</span></span> <span data-ttu-id="784f5-162">Пользователь может включить или отключить отдельные обработчики, установив или сняв флажок в пользовательском интерфейсе диспетчера очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-162">The user has the option of enabling or disabling individual handlers by selecting or clearing their check box in the disk cleanup manager's UI.</span></span>

<span data-ttu-id="784f5-163">Каждый обработчик отвечает за хорошо определенный набор файлов.</span><span class="sxs-lookup"><span data-stu-id="784f5-163">Each handler is responsible for a well defined set of files.</span></span> <span data-ttu-id="784f5-164">Например, выбранный обработчик на рисунке отвечает за очистку скачанных программных файлов.</span><span class="sxs-lookup"><span data-stu-id="784f5-164">For example, the selected handler in the illustration is responsible for cleaning up downloaded program files.</span></span> <span data-ttu-id="784f5-165">Обработчик, выбранный на рисунке, также предоставляет кнопку **просмотра файлов** .</span><span class="sxs-lookup"><span data-stu-id="784f5-165">The handler selected in the illustration also provides a **View Files** button.</span></span> <span data-ttu-id="784f5-166">Нажимая кнопку, пользователь может запросить, чтобы обработчик отображал пользовательский интерфейс, обычно это окно проводника Windows, позволяющее пользователю указать, какие файлы или классы файлов следует очистить.</span><span class="sxs-lookup"><span data-stu-id="784f5-166">By clicking the button, the user can request that the handler display a UI typically a Windows Explorer window that allows the user to specify which files or classes of files to clean.</span></span>

<span data-ttu-id="784f5-167">Хотя Windows поставляется с несколькими обработчиками очистки диска, они не предназначены для обработки файлов, созданных другими приложениями.</span><span class="sxs-lookup"><span data-stu-id="784f5-167">Although Windows comes with a number of disk cleanup handlers, they aren't designed to handle files produced by other applications.</span></span> <span data-ttu-id="784f5-168">Вместо этого диспетчер очистки диска предназначен для гибкого и расширяемого, позволяя любому разработчику реализовывать и регистрировать собственный обработчик очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-168">Instead, the disk cleanup manager is designed to be flexible and extensible by enabling any developer to implement and register their own disk cleanup handler.</span></span> <span data-ttu-id="784f5-169">Любой разработчик может расширить доступные службы очистки диска, реализовав и зарегистрировав обработчик очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-169">Any developer can extend the available disk cleanup services by implementing and registering a disk cleanup handler.</span></span>

<span data-ttu-id="784f5-170">Все приложения, которые создают временные файлы, могут и должны реализовывать и регистрировать обработчик очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-170">All applications that produce temporary files can and should implement and register a disk cleanup handler.</span></span> <span data-ttu-id="784f5-171">Это дает пользователям удобный и надежный способ управления временными файлами приложения.</span><span class="sxs-lookup"><span data-stu-id="784f5-171">Doing so gives users a convenient and reliable way to manage the application's temporary files.</span></span> <span data-ttu-id="784f5-172">При реализации обработчика можно решить, какие файлы затрагиваются, и определить, как происходит фактическая очистка.</span><span class="sxs-lookup"><span data-stu-id="784f5-172">When you implement the handler, you can decide which files are affected and determine how the actual cleanup happens.</span></span>

## <a name="implementation-basics"></a><span data-ttu-id="784f5-173">Основы реализации</span><span class="sxs-lookup"><span data-stu-id="784f5-173">Implementation Basics</span></span>

<span data-ttu-id="784f5-174">Обработчики очистки — это объекты модели COM, выполняющие внутрипроцессный сервер.</span><span class="sxs-lookup"><span data-stu-id="784f5-174">Cleanup handlers are in-process server Component Object Model (COM) objects.</span></span> <span data-ttu-id="784f5-175">Windows предоставляет существующий объект обработчика, именуемый Датадривенклеанер, для использования.</span><span class="sxs-lookup"><span data-stu-id="784f5-175">Windows provides an existing handler object called the DataDrivenCleaner for your use.</span></span> <span data-ttu-id="784f5-176">Вы также можете явно реализовать обработчик для большей гибкости.</span><span class="sxs-lookup"><span data-stu-id="784f5-176">You can also opt to implement a handler yourself for more flexibility.</span></span> <span data-ttu-id="784f5-177">Затем эти объекты позволяют указать, как выбрать файлы, освободить место на диске и, в случае реализованного обработчика, отобразить дополнительный пользовательский интерфейс для более детального управления.</span><span class="sxs-lookup"><span data-stu-id="784f5-177">These objects then allow you to specify how to select files, free disk space, and, in the case of an implemented handler, display the optional UI for more granular control.</span></span> <span data-ttu-id="784f5-178">В этом разделе рассматривается вопрос реализации собственного обработчика.</span><span class="sxs-lookup"><span data-stu-id="784f5-178">This section addresses the matter of implementing your own handler.</span></span> <span data-ttu-id="784f5-179">Дополнительные сведения об использовании объекта Датадривенклеанер см. [в разделе Использование объекта датадривенклеанер](#using-the-datadrivencleaner-object).</span><span class="sxs-lookup"><span data-stu-id="784f5-179">For details concerning the use of the DataDrivenCleaner object, see [Using the DataDrivenCleaner Object](#using-the-datadrivencleaner-object).</span></span>

<span data-ttu-id="784f5-180">Обработчик очистки диска должен выполнить пять основных задач.</span><span class="sxs-lookup"><span data-stu-id="784f5-180">A disk cleanup handler should perform these five basic tasks.</span></span>

-   <span data-ttu-id="784f5-181">Инициализируйте объект обработчика.</span><span class="sxs-lookup"><span data-stu-id="784f5-181">Initialize the handler object.</span></span>
-   <span data-ttu-id="784f5-182">Проверьте диск, чтобы определить, сколько места на диске можно освободить.</span><span class="sxs-lookup"><span data-stu-id="784f5-182">Scan the disk to determine how much disk space can be freed.</span></span>
-   <span data-ttu-id="784f5-183">Отображение пользовательского интерфейса для получения отзывов пользователей о том, какие файлы нужно очистить.</span><span class="sxs-lookup"><span data-stu-id="784f5-183">Display the UI to obtain user feedback about which files to clean.</span></span> <span data-ttu-id="784f5-184">(необязательно)</span><span class="sxs-lookup"><span data-stu-id="784f5-184">(Optional)</span></span>
-   <span data-ttu-id="784f5-185">Выполните очистку.</span><span class="sxs-lookup"><span data-stu-id="784f5-185">Do the cleanup.</span></span>
-   <span data-ttu-id="784f5-186">"Завершение работы".</span><span class="sxs-lookup"><span data-stu-id="784f5-186">Shut down.</span></span>

<span data-ttu-id="784f5-187">Чтобы разрешить диспетчеру очистки дисков управлять этими задачами, обработчик должен экспортировать либо [**иемптиволумекаче**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache) для Windows 98, либо [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2) для Windows Millennium Edition (Windows Me), Windows 2000 и Windows XP.</span><span class="sxs-lookup"><span data-stu-id="784f5-187">To allow the disk cleanup manager to manage these tasks, a handler must export either [**IEmptyVolumeCache**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache) for Windows 98 or [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2) for Windows Millennium Edition (Windows Me), Windows 2000, and Windows XP.</span></span> <span data-ttu-id="784f5-188">Поскольку **IEmptyVolumeCache2** наследует от **иемптиволумекаче**, для реализации обеих задач требуется только дополнительный метод **инитиализикс**, относительно небольшая дополнительная работа.</span><span class="sxs-lookup"><span data-stu-id="784f5-188">Because **IEmptyVolumeCache2** inherits from **IEmptyVolumeCache**, adding only the additional method **InitializeEx**, relatively little extra work is required to implement both.</span></span> <span data-ttu-id="784f5-189">Если обработчик не предназначен только для одной из этих операционных систем, он должен экспортировать оба интерфейса.</span><span class="sxs-lookup"><span data-stu-id="784f5-189">Unless your handler is intended for only one of these operating systems, it should export both interfaces.</span></span>

<span data-ttu-id="784f5-190">Для экспорта этих интерфейсов необходимо реализовать эти методы, соответствующие пяти основным задачам.</span><span class="sxs-lookup"><span data-stu-id="784f5-190">To export these interfaces, you must implement these methods corresponding to the five basic tasks.</span></span>

-   [<span data-ttu-id="784f5-191">Инициализация/Инитиализикс</span><span class="sxs-lookup"><span data-stu-id="784f5-191">Initialize/InitializeEx</span></span>](#initializeinitializeex)
-   [<span data-ttu-id="784f5-192">жетспацеусед</span><span class="sxs-lookup"><span data-stu-id="784f5-192">GetSpaceUsed</span></span>](#getspaceused)
-   [<span data-ttu-id="784f5-193">шовпропертиес</span><span class="sxs-lookup"><span data-stu-id="784f5-193">ShowProperties</span></span>](#showproperties)
-   [<span data-ttu-id="784f5-194">Purge</span><span class="sxs-lookup"><span data-stu-id="784f5-194">Purge</span></span>](#purge)
-   [<span data-ttu-id="784f5-195">Отключение</span><span class="sxs-lookup"><span data-stu-id="784f5-195">Deactivate</span></span>](#deactivate)

### <a name="initializeinitializeex"></a><span data-ttu-id="784f5-196">Инициализация/Инитиализикс</span><span class="sxs-lookup"><span data-stu-id="784f5-196">Initialize/InitializeEx</span></span>

<span data-ttu-id="784f5-197">Два метода инициализации, которые похожи на, вызываются при запуске служебной программы очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-197">The two initialization methods, which are quite similar, are called when the Disk Cleanup utility is run.</span></span> <span data-ttu-id="784f5-198">Диспетчер очистки диска Windows 98 вызывает метод [**иемптиволумекаче:: Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize) обработчика.</span><span class="sxs-lookup"><span data-stu-id="784f5-198">The Windows 98 disk cleanup manager calls a handler's [**IEmptyVolumeCache::Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize) method.</span></span> <span data-ttu-id="784f5-199">Однако диспетчер очистки диска Windows Millennium Edition (Windows Me), Windows 2000 или Windows XP сначала пытается вызвать [**IEmptyVolumeCache2:: инитиализикс**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex) и использует только **Иемптиволумекаче:: Initialize** , если обработчик не имеет доступ к [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2) .</span><span class="sxs-lookup"><span data-stu-id="784f5-199">The Windows Millennium Edition (Windows Me), Windows 2000, or Windows XP disk cleanup manager, however, first tries calling [**IEmptyVolumeCache2::InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex) and only uses **IEmptyVolumeCache::Initialize** if [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2) is not exposed by the handler.</span></span> <span data-ttu-id="784f5-200">Диспетчер очистки диска передает сведения в метод, например раздел реестра обработчика и том диска, который необходимо очистить.</span><span class="sxs-lookup"><span data-stu-id="784f5-200">The disk cleanup manager passes information to the method, such as the handler's registry key and the disk volume that is to be cleaned.</span></span>

<span data-ttu-id="784f5-201">Любой из методов может возвращать различные отображаемые строки и устанавливать один или несколько флагов.</span><span class="sxs-lookup"><span data-stu-id="784f5-201">Either method can return various display strings and set one or more flags.</span></span> <span data-ttu-id="784f5-202">Основное различие между двумя методами заключается в способе обработки текста, отображаемого в диспетчере очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-202">The primary difference between the two methods is how the text displayed in the disk cleanup manager is handled.</span></span> <span data-ttu-id="784f5-203">Затрагиваются следующие три строки.</span><span class="sxs-lookup"><span data-stu-id="784f5-203">The following three strings are affected.</span></span>



| <span data-ttu-id="784f5-204">Строка</span><span class="sxs-lookup"><span data-stu-id="784f5-204">String</span></span>       | <span data-ttu-id="784f5-205">Назначение</span><span class="sxs-lookup"><span data-stu-id="784f5-205">Purpose</span></span>                                                                            | <span data-ttu-id="784f5-206">Инициализация</span><span class="sxs-lookup"><span data-stu-id="784f5-206">Initialize</span></span>                                                                           | <span data-ttu-id="784f5-207">инитиализикс</span><span class="sxs-lookup"><span data-stu-id="784f5-207">InitializeEx</span></span>                                                                                     |
|--------------|------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|
| <span data-ttu-id="784f5-208">Отображаемое имя</span><span class="sxs-lookup"><span data-stu-id="784f5-208">Display Name</span></span> | <span data-ttu-id="784f5-209">Имя обработчика, отображаемое в списке диспетчера очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-209">The handler's name displayed in the disk cleanup manager's list box.</span></span>               | <span data-ttu-id="784f5-210">Если *ппвсздисплайнаме* имеет значение **null**, значение по умолчанию извлекается из реестра.</span><span class="sxs-lookup"><span data-stu-id="784f5-210">If *ppwszDisplayName* is **NULL**, the default value is retrieved from the registry.</span></span> | <span data-ttu-id="784f5-211">Правильно локализованная строка должна быть указана в *ппвсздисплайнаме* . значения реестра не используются.</span><span class="sxs-lookup"><span data-stu-id="784f5-211">A properly localized string must be specified in *ppwszDisplayName* no registry values are used.</span></span> |
| <span data-ttu-id="784f5-212">Описание</span><span class="sxs-lookup"><span data-stu-id="784f5-212">Description</span></span>  | <span data-ttu-id="784f5-213">Описательный текст, отображаемый под списком при выборе имени обработчика.</span><span class="sxs-lookup"><span data-stu-id="784f5-213">Descriptive text displayed below the list box when the handler's name is selected.</span></span> | <span data-ttu-id="784f5-214">Если *ппвсздескриптион* имеет значение **null**, значение по умолчанию извлекается из реестра.</span><span class="sxs-lookup"><span data-stu-id="784f5-214">If *ppwszDescription* is **NULL**, the default value is retrieved from the registry.</span></span> | <span data-ttu-id="784f5-215">Правильно локализованная строка должна быть указана в *ппвсздескриптион* . значения реестра не используются.</span><span class="sxs-lookup"><span data-stu-id="784f5-215">A properly localized string must be specified in *ppwszDescription* no registry values are used.</span></span> |
| <span data-ttu-id="784f5-216">Текст кнопки</span><span class="sxs-lookup"><span data-stu-id="784f5-216">Button Text</span></span>  | <span data-ttu-id="784f5-217">Текст для необязательной кнопки, которая позволяет пользователям отображать пользовательский интерфейс обработчика.</span><span class="sxs-lookup"><span data-stu-id="784f5-217">Text for the optional button that allows users to display the handler's UI.</span></span>        | <span data-ttu-id="784f5-218">Нет доступных параметров.</span><span class="sxs-lookup"><span data-stu-id="784f5-218">No parameter available.</span></span> <span data-ttu-id="784f5-219">Должен быть указан в реестре.</span><span class="sxs-lookup"><span data-stu-id="784f5-219">Must be specified in the registry.</span></span>                           | <span data-ttu-id="784f5-220">Правильно локализованная строка должна быть указана в *ппвсзбтнтекст* . значения реестра не используются.</span><span class="sxs-lookup"><span data-stu-id="784f5-220">A properly localized string must be specified in *ppwszBtnText* no registry values are used.</span></span>     |



 

<span data-ttu-id="784f5-221">Параметр *пдвфлагс* , находящийся в обоих методах инициализации, распознает один и тот же набор флагов.</span><span class="sxs-lookup"><span data-stu-id="784f5-221">The *pdwFlags* parameter found in both initialization methods recognizes the same set of flags.</span></span> <span data-ttu-id="784f5-222">Два из этих флагов передаются в метод диспетчером очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-222">Two of these flags are passed to the method by the disk cleanup manager.</span></span>

-   <span data-ttu-id="784f5-223">**ЕВКФ \_ сеттингсмоде**</span><span class="sxs-lookup"><span data-stu-id="784f5-223">**EVCF\_SETTINGSMODE**</span></span>

    <span data-ttu-id="784f5-224">Если диспетчер очистки диска выполняется по расписанию, он устанавливает флаг **евкф \_ сеттингсмоде** .</span><span class="sxs-lookup"><span data-stu-id="784f5-224">If the disk cleanup manager is being run on a schedule, it sets the **EVCF\_SETTINGSMODE** flag.</span></span> <span data-ttu-id="784f5-225">Если этот флаг установлен, диспетчер очистки диска не вызывает методы [жетспацеусед](#getspaceused), [очистки](#purge)или [шовпропертиес](#showproperties) .</span><span class="sxs-lookup"><span data-stu-id="784f5-225">If this flag is set, the disk cleanup manager does not call the [GetSpaceUsed](#getspaceused), [Purge](#purge), or [ShowProperties](#showproperties) methods.</span></span> <span data-ttu-id="784f5-226">Метод [**Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize) или [**инитиализикс**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex) обработчика должен выполнять все задачи, обычно выполняемые [**жетспацеусед**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) и [**очистки**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-purge).</span><span class="sxs-lookup"><span data-stu-id="784f5-226">The handler's [**Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize) or [**InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex) method must handle all of the tasks normally performed by [**GetSpaceUsed**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) and [**Purge**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-purge).</span></span> <span data-ttu-id="784f5-227">Поскольку нет возможности отзыва пользователей, следует затронуть только те файлы, которые чрезвычайно надежны для очистки.</span><span class="sxs-lookup"><span data-stu-id="784f5-227">Because there is no opportunity for user feedback, only those files that are extremely safe to clean up should be touched.</span></span> <span data-ttu-id="784f5-228">Следует игнорировать параметр *пквсзволуме* метода инициализации и очистить ненужные файлы независимо от того, на каком диске они находятся.</span><span class="sxs-lookup"><span data-stu-id="784f5-228">You should ignore the initialization method's *pcwszVolume* parameter and clean unneeded files regardless of what drive they are on.</span></span>

-   <span data-ttu-id="784f5-229">**ЕВКФ \_ аутофдискспаце**</span><span class="sxs-lookup"><span data-stu-id="784f5-229">**EVCF\_OUTOFDISKSPACE**</span></span>

    <span data-ttu-id="784f5-230">Если установлен флаг **евкф \_ аутофдискспаце** , то диск пользователя является критически коротким местом.</span><span class="sxs-lookup"><span data-stu-id="784f5-230">If the **EVCF\_OUTOFDISKSPACE** flag is set, the user's disk drive is critically short of space.</span></span> <span data-ttu-id="784f5-231">Обработчик должен быть агрессивным для удаления файлов, даже если это приводит к снижению производительности.</span><span class="sxs-lookup"><span data-stu-id="784f5-231">The handler should be aggressive about deleting files, even if it results in a performance loss.</span></span> <span data-ttu-id="784f5-232">Однако, очевидно, что обработчик не должен удалять файлы, которые приведут к сбою приложения или потере данных пользователем.</span><span class="sxs-lookup"><span data-stu-id="784f5-232">However, the handler obviously should not delete files that would cause an application to fail or the user to lose data.</span></span>

<span data-ttu-id="784f5-233">Остальные флаги задаются обработчиком очистки диска и возвращаются в Диспетчер очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-233">The remaining flags are set by the disk cleanup handler and returned to the disk cleanup manager.</span></span> <span data-ttu-id="784f5-234">Дополнительные сведения см. на страницах справочника по методам для [**иемптиволумекаче:: Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize) и [**IEmptyVolumeCache2:: инитиализикс**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex).</span><span class="sxs-lookup"><span data-stu-id="784f5-234">For more information, see the method reference pages for [**IEmptyVolumeCache::Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize) and [**IEmptyVolumeCache2::InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex).</span></span>

-   <span data-ttu-id="784f5-235">ЕВКФ \_ донтшовифзеро</span><span class="sxs-lookup"><span data-stu-id="784f5-235">EVCF\_DONTSHOWIFZERO</span></span>

    <span data-ttu-id="784f5-236">Отображать обработчик в списке диспетчера очистки диска, только если значение, возвращаемое функцией [**жетспацеусед**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) , указывает, что обработчик может освободить место на диске.</span><span class="sxs-lookup"><span data-stu-id="784f5-236">Display the handler in the disk cleanup manager's list box only if the value returned by [**GetSpaceUsed**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) indicates that the handler can free some disk space.</span></span>

-   <span data-ttu-id="784f5-237">ЕВКФ \_ енаблебидефаулт</span><span class="sxs-lookup"><span data-stu-id="784f5-237">EVCF\_ENABLEBYDEFAULT</span></span>

    <span data-ttu-id="784f5-238">Указывает, что обработчик включен по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="784f5-238">Specifies that the handler is enabled by default.</span></span> <span data-ttu-id="784f5-239">Он будет выполняться при каждом выполнении очистки диска, если пользователь не отключил его, сняв флажок в списке обработчиков диспетчера очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-239">It will run every time a disk cleanup takes place unless the user disables it by clearing its check box in the disk cleanup manager's list of handlers.</span></span>

-   <span data-ttu-id="784f5-240">ЕВКФ \_ енаблебидефаулт \_ Auto</span><span class="sxs-lookup"><span data-stu-id="784f5-240">EVCF\_ENABLEBYDEFAULT\_AUTO</span></span>

    <span data-ttu-id="784f5-241">Указывает, что обработчик автоматически включается во время выполнения запланированной очистки.</span><span class="sxs-lookup"><span data-stu-id="784f5-241">Specifies that the handler is automatically enabled to run during scheduled cleanups.</span></span>

-   <span data-ttu-id="784f5-242">ЕВКФ \_ хассеттингс</span><span class="sxs-lookup"><span data-stu-id="784f5-242">EVCF\_HASSETTINGS</span></span>

    <span data-ttu-id="784f5-243">Установите этот флаг, если обработчик содержит пользовательский интерфейс для вывода.</span><span class="sxs-lookup"><span data-stu-id="784f5-243">Set this flag if your handler has a UI to display.</span></span> <span data-ttu-id="784f5-244">В ответ диспетчер очистки диска отображает кнопку, когда этот обработчик выбран в списке.</span><span class="sxs-lookup"><span data-stu-id="784f5-244">In response, the disk cleanup manager displays a button when that handler is selected in the list box.</span></span> <span data-ttu-id="784f5-245">При нажатии этой кнопки диспетчер очистки диска вызывает [**шовпропертиес**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-showproperties).</span><span class="sxs-lookup"><span data-stu-id="784f5-245">If that button is clicked, the disk cleanup manager calls [**ShowProperties**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-showproperties).</span></span>

-   <span data-ttu-id="784f5-246">ЕВКФ \_ ремовефромлист</span><span class="sxs-lookup"><span data-stu-id="784f5-246">EVCF\_REMOVEFROMLIST</span></span>

    <span data-ttu-id="784f5-247">Удалите имя обработчика из списка доступных обработчиков после того, как обработчик будет выполнен один раз.</span><span class="sxs-lookup"><span data-stu-id="784f5-247">Delete the handler's name from the list of available handlers after the handler has been run once.</span></span> <span data-ttu-id="784f5-248">Данные реестра обработчика также удаляются.</span><span class="sxs-lookup"><span data-stu-id="784f5-248">The handler's registry information is also deleted.</span></span>

### <a name="getspaceused"></a><span data-ttu-id="784f5-249">жетспацеусед</span><span class="sxs-lookup"><span data-stu-id="784f5-249">GetSpaceUsed</span></span>

<span data-ttu-id="784f5-250">Диспетчер очистки диска вызывает этот метод, чтобы определить, сколько места может быть освобождено обработчиком очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-250">The disk cleanup manager calls this method to determine how much space a disk cleanup handler can potentially free.</span></span> <span data-ttu-id="784f5-251">Затем Диспетчер очистки диска отображает это значение справа от имени обработчика в списке.</span><span class="sxs-lookup"><span data-stu-id="784f5-251">The disk cleanup manager then displays that value to the right of the handler's name in the list box.</span></span> <span data-ttu-id="784f5-252">Эта операция выполняется для всех обработчиков, зарегистрированных в диспетчере очистки диска при запуске диспетчера и перед отображением основного пользовательского интерфейса диспетчера.</span><span class="sxs-lookup"><span data-stu-id="784f5-252">This operation is performed on all of the handlers registered with the disk cleanup manager when the manager is launched and before the manager's main UI is displayed.</span></span> <span data-ttu-id="784f5-253">При вызове [**жетспацеусед**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) обработчик должен проверять файлы, за которые он отвечает, определять, какие из них являются кандидатами на очистку, и возвращать объем дискового пространства, который может быть освобожден.</span><span class="sxs-lookup"><span data-stu-id="784f5-253">When [**GetSpaceUsed**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) is called, the handler should scan the files that it is responsible for, determine which of them are cleanup candidates, and return the amount of disk space that it can free.</span></span>

<span data-ttu-id="784f5-254">Поскольку сканирование может быть длительным процессом, диспетчер очистки диска использует параметр *ПИКБ* этого метода для передачи указателя на интерфейс [**иемптиволумекачекаллбакк**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecachecallback) .</span><span class="sxs-lookup"><span data-stu-id="784f5-254">Because scanning can be a lengthy process, the disk cleanup manager uses this method's *picb* parameter to pass a pointer to an [**IEmptyVolumeCacheCallBack**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecachecallback) interface.</span></span> <span data-ttu-id="784f5-255">Обработчик периодически использует этот интерфейс во время сканирования для вызова [**иемптиволумекачекаллбакк:: сканпрогресс**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecachecallback-scanprogress), который служит двум целям.</span><span class="sxs-lookup"><span data-stu-id="784f5-255">The handler uses the interface periodically during the scan to call [**IEmptyVolumeCacheCallBack::ScanProgress**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecachecallback-scanprogress), which serves two purposes.</span></span>

-   <span data-ttu-id="784f5-256">Позволяет диспетчеру очистки дисков обновлять индикатор выполнения, уведомляя пользователя о ходе проверки.</span><span class="sxs-lookup"><span data-stu-id="784f5-256">Allows the disk cleanup manager to update a progress bar, informing the user how the scan is progressing.</span></span>
-   <span data-ttu-id="784f5-257">Уведомляет обработчик о необходимости остановить проверку в случае нажатия кнопки **отмены** в окне хода выполнения.</span><span class="sxs-lookup"><span data-stu-id="784f5-257">Notifies the handler to stop the scan in the event that the progress window's **Cancel** button is clicked.</span></span> <span data-ttu-id="784f5-258">Это событие кнопки не передается непосредственно в обработчик; Вместо этого диспетчер очистки диска возвращает «E \_ Abort» в следующий раз, когда [**Жетспацеусед**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) вызывает [**иемптиволумекачекаллбакк:: сканпрогресс**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecachecallback-scanprogress).</span><span class="sxs-lookup"><span data-stu-id="784f5-258">That button event is not communicated directly to the handler; instead, the disk cleanup manager returns E\_ABORT the next time [**GetSpaceUsed**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) calls [**IEmptyVolumeCacheCallBack::ScanProgress**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecachecallback-scanprogress).</span></span>

### <a name="showproperties"></a><span data-ttu-id="784f5-259">шовпропертиес</span><span class="sxs-lookup"><span data-stu-id="784f5-259">ShowProperties</span></span>

<span data-ttu-id="784f5-260">Перед запуском очистки обработчик может отобразить пользовательский интерфейс, как правило, в виде окна проводника Windows, позволяющего пользователю просмотреть список файлов или классов файлов, выбранных для очистки обработчиком.</span><span class="sxs-lookup"><span data-stu-id="784f5-260">Before starting cleanup, the handler can display a UI typically in the form of a Windows Explorer window that allows the user to see a list of files or classes of files selected for cleanup by the handler.</span></span> <span data-ttu-id="784f5-261">Если обработчик устанавливает флаг **евкф \_ хассеттингс** при вызове [**Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize) или [**инитиализикс**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex) , пользователь может запросить пользовательский интерфейс, нажав кнопку, отображаемую для этой цели в диспетчере очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-261">If the handler sets the **EVCF\_HASSETTINGS** flag when [**Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize) or [**InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex) is called, the user can request the UI by clicking the button displayed for that purpose in the disk cleanup manager.</span></span> <span data-ttu-id="784f5-262">Текст кнопки зависит от обработчика, но "файлы представления", "Просмотр страниц" и "Параметры" являются общими метками.</span><span class="sxs-lookup"><span data-stu-id="784f5-262">The button text varies from handler to handler, but "View Files," "View Pages," and "Options" are common labels.</span></span>

<span data-ttu-id="784f5-263">При нажатии кнопки диспетчер очистки диска вызывает [**шовпропертиес**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-showproperties) , чтобы вывести запрос обработчику на отображение пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="784f5-263">When the button is clicked, the disk cleanup manager calls [**ShowProperties**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-showproperties) to prompt the handler to display the UI.</span></span> <span data-ttu-id="784f5-264">Пользовательский интерфейс должен быть создан как дочерний для окна, дескриптор которого передается в параметре *HWND* метода **шовпропертиес** .</span><span class="sxs-lookup"><span data-stu-id="784f5-264">The UI should be created as a child of the window whose handle is passed in the **ShowProperties** method's *hwnd* parameter.</span></span>

### <a name="purge"></a><span data-ttu-id="784f5-265">Purge</span><span class="sxs-lookup"><span data-stu-id="784f5-265">Purge</span></span>

<span data-ttu-id="784f5-266">Диспетчер очистки диска вызывает метод [**очистки**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-purge) обработчика, чтобы задать очистку в перемещении.</span><span class="sxs-lookup"><span data-stu-id="784f5-266">The disk cleanup manager calls the handler's [**Purge**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-purge) method to set the cleanup in motion.</span></span> <span data-ttu-id="784f5-267">Параметр *ПИКБ* метода — это указатель на интерфейс [**иемптиволумекачекаллбакк**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecachecallback) диспетчера очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-267">The method's *picb* parameter is a pointer to the disk cleanup manager's [**IEmptyVolumeCacheCallBack**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecachecallback) interface.</span></span> <span data-ttu-id="784f5-268">Как и в случае с методом [**жетспацеусед**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) , обработчик должен периодически использовать интерфейс обратного вызова для передачи сведений о ходе выполнения и запроса диспетчера очистки диска о том, что пользователь щелкнул **отмену**.</span><span class="sxs-lookup"><span data-stu-id="784f5-268">As with the [**GetSpaceUsed**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-getspaceused) method, the handler should use the callback interface periodically to report its progress and query the disk cleanup manager whether the user has clicked **Cancel**.</span></span> <span data-ttu-id="784f5-269">Однако обратите внимание, что метод **очистки** должен вызывать [**Иемптиволумекачекаллбакк::P уржепрогресс**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecachecallback-purgeprogress), а не [**сканпрогресс**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecachecallback-scanprogress).</span><span class="sxs-lookup"><span data-stu-id="784f5-269">However, note that the **Purge** method must call [**IEmptyVolumeCacheCallBack::PurgeProgress**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecachecallback-purgeprogress), not [**ScanProgress**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecachecallback-scanprogress).</span></span>

### <a name="deactivate"></a><span data-ttu-id="784f5-270">Отключение</span><span class="sxs-lookup"><span data-stu-id="784f5-270">Deactivate</span></span>

<span data-ttu-id="784f5-271">Метод [**Deactivate**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-deactivate) вызывается, когда диспетчер очистки диска готовится к завершению работы.</span><span class="sxs-lookup"><span data-stu-id="784f5-271">The [**Deactivate**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-deactivate) method is called when the disk cleanup manager is preparing to shut down.</span></span> <span data-ttu-id="784f5-272">Обработчик должен выполнять все необходимые задачи очистки и возвращать.</span><span class="sxs-lookup"><span data-stu-id="784f5-272">The handler should perform any needed cleanup tasks and return.</span></span> <span data-ttu-id="784f5-273">Если вы не хотите, чтобы обработчик запускался снова, установите флаг **евкф \_ ремовефромлист** в параметре *пдвфлагс* метода инициализации.</span><span class="sxs-lookup"><span data-stu-id="784f5-273">If you don't want the handler to be run again, set the **EVCF\_REMOVEFROMLIST** flag in the initialization method's *pdwFlags* parameter.</span></span> <span data-ttu-id="784f5-274">Если этот флаг установлен, диспетчер очистки диска удаляет обработчик из списка и удаляет записи реестра обработчика.</span><span class="sxs-lookup"><span data-stu-id="784f5-274">If this flag is set, the disk cleanup manager removes the handler from its list and deletes the handler's registry entries.</span></span> <span data-ttu-id="784f5-275">Необходимо повторно добавить записи реестра для повторного запуска обработчика.</span><span class="sxs-lookup"><span data-stu-id="784f5-275">You must re-add the registry entries to run the handler again.</span></span> <span data-ttu-id="784f5-276">Этот флаг обычно используется для обработчиков, которые выполняются только один раз.</span><span class="sxs-lookup"><span data-stu-id="784f5-276">This flag is typically used for handlers that are run only once.</span></span>

## <a name="registering-a-disk-cleanup-handler"></a><span data-ttu-id="784f5-277">Регистрация обработчика очистки диска</span><span class="sxs-lookup"><span data-stu-id="784f5-277">Registering a Disk Cleanup Handler</span></span>

<span data-ttu-id="784f5-278">Чтобы добавить обработчик в список диспетчера очистки диска, необходимо добавить в реестр Windows определенные ключи и значения.</span><span class="sxs-lookup"><span data-stu-id="784f5-278">To add a handler to the disk cleanup manager's list, certain keys and values must be added to the Windows registry.</span></span>

-   [<span data-ttu-id="784f5-279">Регистрация CLSID обработчика</span><span class="sxs-lookup"><span data-stu-id="784f5-279">Registering a Handler's CLSID</span></span>](#registering-a-handlers-clsid)
-   [<span data-ttu-id="784f5-280">Регистрация обработчика с помощью диспетчера очистки диска: общие</span><span class="sxs-lookup"><span data-stu-id="784f5-280">Registering a Handler with the Disk Cleanup Manager: General</span></span>](#registering-a-handler-with-the-disk-cleanup-manager-general)
-   [<span data-ttu-id="784f5-281">Регистрация обработчика с помощью диспетчера очистки диска: Windows 2000 или более поздние системы</span><span class="sxs-lookup"><span data-stu-id="784f5-281">Registering a Handler with the Disk Cleanup Manager: Windows 2000 or Later Systems</span></span>](#registering-a-handler-with-the-disk-cleanup-manager-windows-2000-or-later-systems)
-   [<span data-ttu-id="784f5-282">Использование объекта Датадривенклеанер</span><span class="sxs-lookup"><span data-stu-id="784f5-282">Using the DataDrivenCleaner Object</span></span>](#using-the-datadrivencleaner-object)
-   [<span data-ttu-id="784f5-283">Пример регистрации обработчика очистки диска</span><span class="sxs-lookup"><span data-stu-id="784f5-283">Example Registration of a Disk Cleanup Handler</span></span>](#example-registration-of-a-disk-cleanup-handler)

### <a name="registering-a-handlers-clsid"></a><span data-ttu-id="784f5-284">Регистрация CLSID обработчика</span><span class="sxs-lookup"><span data-stu-id="784f5-284">Registering a Handler's CLSID</span></span>

<span data-ttu-id="784f5-285">Как и для всех COM-объектов, идентификатор GUID объекта обработчика и библиотека DLL должны быть зарегистрированы в ключе **CLSID** в **\_ \_ корневом каталоге классов hKey**.</span><span class="sxs-lookup"><span data-stu-id="784f5-285">As with all COM objects, the handler object's GUID and DLL must be registered under the **CLSID** key in **HKEY\_CLASSES\_ROOT**.</span></span> <span data-ttu-id="784f5-286">Также можно зарегистрировать значок, который отображается рядом с именем обработчика в списке диспетчера очистки диска, но это необязательно.</span><span class="sxs-lookup"><span data-stu-id="784f5-286">You can also register an icon that is displayed next to the handler's name in the disk cleanup manager's list box, but this is optional.</span></span> <span data-ttu-id="784f5-287">В следующем примере показаны ключи, значения и участвующие в нем данные.</span><span class="sxs-lookup"><span data-stu-id="784f5-287">The following example shows the keys, values, and data involved.</span></span>

```
HKEY_CLASSES_ROOT
   CLSID
      Handler's GUID
         DefaultIcon
            (Default) = Handler's Icon Path, Icon Index
         InprocServer32
            (Default) = Handler's DLL path
            ThreadingModel = Apartment
```

### <a name="registering-a-handler-with-the-disk-cleanup-manager-general"></a><span data-ttu-id="784f5-288">Регистрация обработчика с помощью диспетчера очистки диска: общие</span><span class="sxs-lookup"><span data-stu-id="784f5-288">Registering a Handler with the Disk Cleanup Manager: General</span></span>

<span data-ttu-id="784f5-289">Для завершения регистрации обработчик должен добавить ключ, содержащий его особенности, как показано здесь.</span><span class="sxs-lookup"><span data-stu-id="784f5-289">To complete the registration, a handler must add a key holding its specifics as shown here.</span></span> <span data-ttu-id="784f5-290">В оставшейся части этого раздела рассматривается содержимое этого ключа.</span><span class="sxs-lookup"><span data-stu-id="784f5-290">The remainder of this section discusses the contents of this key.</span></span>

```
HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows
            CurrentVersion
               Explorer
                  VolumeCaches
                     Handler's Key
```

<span data-ttu-id="784f5-291">Как правило, имя ключа, содержащего определенные обработчики, называется типом обрабатываемого файла, например **загруженные файлы программы**, но это не является обязательным.</span><span class="sxs-lookup"><span data-stu-id="784f5-291">In general, the name of the key holding a handler's particulars is named for the type of file that it handles, such as **Downloaded Program Files**, but this is not a requirement.</span></span> <span data-ttu-id="784f5-292">В следующей таблице приведены возможные значения, найденные в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="784f5-292">The following table details the possible values found under this key.</span></span>

> [!Note]  
> <span data-ttu-id="784f5-293">Только значение по умолчанию, задающее идентификатор класса обработчика (CLSID), обязательно для всех остальных значений.</span><span class="sxs-lookup"><span data-stu-id="784f5-293">Only the Default value specifying the handler's class identifier (CLSID) is required all other values are optional.</span></span>

 



<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th><span data-ttu-id="784f5-294">Значение</span><span class="sxs-lookup"><span data-stu-id="784f5-294">Value</span></span></th>
<th><span data-ttu-id="784f5-295">Тип</span><span class="sxs-lookup"><span data-stu-id="784f5-295">Type</span></span></th>
<th><span data-ttu-id="784f5-296">Значение</span><span class="sxs-lookup"><span data-stu-id="784f5-296">Meaning</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="784f5-297">Значение по умолчанию</span><span class="sxs-lookup"><span data-stu-id="784f5-297">Default</span></span></td>
<td><span data-ttu-id="784f5-298">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="784f5-298">REG_SZ</span></span></td>
<td><span data-ttu-id="784f5-299">CLSID обработчика, зарегистрированный в <strong>HKEY_CLASSES_ROOT</strong> \ <strong>CLSID</strong>.</span><span class="sxs-lookup"><span data-stu-id="784f5-299">The handler's CLSID as registered under <strong>HKEY_CLASSES_ROOT</strong>\<strong>CLSID</strong>.</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="784f5-300">адванцедбуттонтекст</span><span class="sxs-lookup"><span data-stu-id="784f5-300">AdvancedButtonText</span></span></td>
<td><span data-ttu-id="784f5-301">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="784f5-301">REG_SZ</span></span></td>
<td><span data-ttu-id="784f5-302">Текст для необязательной кнопки, которую пользователь может щелкнуть для вывода пользовательского интерфейса обработчика.</span><span class="sxs-lookup"><span data-stu-id="784f5-302">Text for the optional button that users can click to display the handler's UI.</span></span> <span data-ttu-id="784f5-303">Символ & можно поместить перед символом, чтобы назначить сочетание клавиш для кнопки.</span><span class="sxs-lookup"><span data-stu-id="784f5-303">The & character can be placed before a character to assign a keyboard shortcut for the button.</span></span> <span data-ttu-id="784f5-304">Значение Адванцедбуттонтекст игнорируется обработчиками, которые предоставляют <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex"><strong>IEmptyVolumeCache2:: инитиализикс</strong></a>.</span><span class="sxs-lookup"><span data-stu-id="784f5-304">The AdvancedButtonText value is ignored by handlers exposing <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex"><strong>IEmptyVolumeCache2::InitializeEx</strong></a>.</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="784f5-305">клеанупстринг</span><span class="sxs-lookup"><span data-stu-id="784f5-305">CleanupString</span></span></td>
<td><span data-ttu-id="784f5-306">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="784f5-306">REG_SZ</span></span></td>
<td><span data-ttu-id="784f5-307">Командная строка, указывающая исполняемый файл и необязательные параметры командной строки.</span><span class="sxs-lookup"><span data-stu-id="784f5-307">Command line specifying an executable file and optional command line parameters.</span></span> <span data-ttu-id="784f5-308">Эта командная строка выполняется после завершения очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-308">This command line is run at the completion of the disk cleanup.</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="784f5-309">CSID</span><span class="sxs-lookup"><span data-stu-id="784f5-309">CSIDL</span></span></td>
<td><span data-ttu-id="784f5-310">REG_DWORD</span><span class="sxs-lookup"><span data-stu-id="784f5-310">REG_DWORD</span></span></td>
<td><span data-ttu-id="784f5-311">Независимый от системы идентификатор для специальной папки, включаемой в поиск файлов.</span><span class="sxs-lookup"><span data-stu-id="784f5-311">A system-independent identifier for a special folder to include in the file search.</span></span> <span data-ttu-id="784f5-312">Это значение должно быть указано в виде числового значения для instance, 0x0000001c, а не CSIDL_LOCAL_APPDATA.</span><span class="sxs-lookup"><span data-stu-id="784f5-312">This value must be entered as a numerical value for instance, 0x0000001c rather than CSIDL_LOCAL_APPDATA.</span></span> <span data-ttu-id="784f5-313">Список возможных значений см. в разделе <a href="/windows/desktop/shell/csidl"><strong>CSid</strong></a>.</span><span class="sxs-lookup"><span data-stu-id="784f5-313">For a list of possible values, see <a href="/windows/desktop/shell/csidl"><strong>CSIDL</strong></a>.</span></span> <span data-ttu-id="784f5-314">Можно использовать только одно значение.</span><span class="sxs-lookup"><span data-stu-id="784f5-314">Only a single value can be used.</span></span><br/> <span data-ttu-id="784f5-315">Если указано значение папки, то расположение, указанное в качестве значения CSID, добавляется в начале этой информации для создания пути поиска.</span><span class="sxs-lookup"><span data-stu-id="784f5-315">If the Folder value is specified, the location indicated by the CSIDL value is prepended to that information to compose a search path.</span></span> <span data-ttu-id="784f5-316">Например, рассмотрим следующий сценарий.</span><span class="sxs-lookup"><span data-stu-id="784f5-316">For instance, consider the following scenario.</span></span><br/>
<ul>
<li><span data-ttu-id="784f5-317">Значение CSID указано как 0x0000000d (CSIDL_MYMUSIC)</span><span class="sxs-lookup"><span data-stu-id="784f5-317">The CSIDL value is specified as 0x0000000d (CSIDL_MYMUSIC)</span></span></li>
<li><span data-ttu-id="784f5-318">Папка Моя музыка находится в папке C:\Documents и параметры \<em>имя_пользователя</em>\ музыка</span><span class="sxs-lookup"><span data-stu-id="784f5-318">Your My Music folder is located at C:\Documents and Settings\<em>username</em>\My Music</span></span></li>
<li><span data-ttu-id="784f5-319">Значение папки содержит &quot; жазз\синжерс&quot;</span><span class="sxs-lookup"><span data-stu-id="784f5-319">The Folder value contains &quot;Jazz\Singers&quot;</span></span></li>
</ul>
<span data-ttu-id="784f5-320">Результатом этого сценария является то, что обработчик очистки диска выполняет поиск в папке C:\Documents и Settings \<em>username</em>\ мусик\жазз\синжерс.</span><span class="sxs-lookup"><span data-stu-id="784f5-320">The result of that scenario is that the disk cleanup handler searches the C:\Documents and Settings\<em>username</em>\My Music\Jazz\Singers folder.</span></span> <span data-ttu-id="784f5-321">Обратите внимание, что если он отсутствует, добавляется косая черта перед значением папки.</span><span class="sxs-lookup"><span data-stu-id="784f5-321">Note that the slash preceding the Folder value is added if it is not present.</span></span><br/></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="784f5-322">Описание</span><span class="sxs-lookup"><span data-stu-id="784f5-322">Description</span></span></td>
<td><span data-ttu-id="784f5-323">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="784f5-323">REG_SZ</span></span></td>
<td><span data-ttu-id="784f5-324">Описательный текст, отображаемый под списком диспетчера очистки диска, когда выбрано имя обработчика.</span><span class="sxs-lookup"><span data-stu-id="784f5-324">Descriptive text displayed below the disk cleanup manager's list box when the handler's name is selected.</span></span> <span data-ttu-id="784f5-325">Здесь можно объяснить, что делает обработчик, какие файлы он сам имеет в себе и какая другая информация елуЦидатори пользователю.</span><span class="sxs-lookup"><span data-stu-id="784f5-325">Here you can explain what the handler does, what files it concerns itself with, and any other information elucidatory to the user.</span></span> <span data-ttu-id="784f5-326">Если <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex"><strong>IEmptyVolumeCache2:: инитиализикс</strong></a> не предоставляется обработчиком, этот текст можно переопределить с помощью метода <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize"><strong>Иемптиволумекаче:: Initialize</strong></a> обработчика, указав альтернативную строку в параметре <em>ппвсздескриптион</em> при вызове метода.</span><span class="sxs-lookup"><span data-stu-id="784f5-326">If <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex"><strong>IEmptyVolumeCache2::InitializeEx</strong></a> is not exposed by the handler, this text can be overridden through the handler's <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize"><strong>IEmptyVolumeCache::Initialize</strong></a> method by specifying an alternate string in the <em>ppwszDescription</em> parameter when the method is called.</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="784f5-327">Отображение</span><span class="sxs-lookup"><span data-stu-id="784f5-327">Display</span></span></td>
<td><span data-ttu-id="784f5-328">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="784f5-328">REG_SZ</span></span></td>
<td><span data-ttu-id="784f5-329">Имя обработчика, отображаемое в списке диспетчера очистки диска.</span><span class="sxs-lookup"><span data-stu-id="784f5-329">The handler's name to be displayed in the disk cleanup manager's list box.</span></span> <span data-ttu-id="784f5-330">Если <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex"><strong>IEmptyVolumeCache2:: инитиализикс</strong></a> не предоставляется обработчиком, этот текст можно переопределить с помощью метода <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize"><strong>Иемптиволумекаче:: Initialize</strong></a> обработчика, указав альтернативную строку в параметре <em>ппвсздисплайнаме</em> при вызове метода.</span><span class="sxs-lookup"><span data-stu-id="784f5-330">If <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex"><strong>IEmptyVolumeCache2::InitializeEx</strong></a> is not exposed by the handler, this text can be overridden through the handler's <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize"><strong>IEmptyVolumeCache::Initialize</strong></a> method by specifying an alternate string in the <em>ppwszDisplayName</em> parameter when the method is called.</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="784f5-331">Список файлов</span><span class="sxs-lookup"><span data-stu-id="784f5-331">FileList</span></span></td>
<td><span data-ttu-id="784f5-332">REG_SZ или REG_MULTI_SZ</span><span class="sxs-lookup"><span data-stu-id="784f5-332">REG_SZ or REG_MULTI_SZ</span></span></td>
<td><span data-ttu-id="784f5-333">Список файлов, Поиск и очистка которых выполняется этим обработчиком.</span><span class="sxs-lookup"><span data-stu-id="784f5-333">A list of files searched for and cleaned by this handler.</span></span> <span data-ttu-id="784f5-334">Подстановочные знаки можно указать с помощью команды?</span><span class="sxs-lookup"><span data-stu-id="784f5-334">You can specify wildcards using the ?</span></span> <span data-ttu-id="784f5-335">или \* символов.</span><span class="sxs-lookup"><span data-stu-id="784f5-335">or \* characters.</span></span> <span data-ttu-id="784f5-336">Если значение имеет тип REG_SZ, несколько расширений разделяются с помощью | или: символы без пробелов на обеих сторонах.</span><span class="sxs-lookup"><span data-stu-id="784f5-336">If the value is of type REG_SZ, multiple extensions are separated using the | or : characters, with no spaces on either side of them.</span></span><br/> <span data-ttu-id="784f5-337">Если флаг DDEVCF_REMOVEDIRS установлен в значении флагов, эти значения могут указывать имена каталогов, а также файлы.</span><span class="sxs-lookup"><span data-stu-id="784f5-337">If the DDEVCF_REMOVEDIRS flag is set in the Flags value, these values can specify directory names as well as files.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="784f5-338">Флаги</span><span class="sxs-lookup"><span data-stu-id="784f5-338">Flags</span></span></td>
<td><span data-ttu-id="784f5-339">REG_DWORD или REG_BINARY</span><span class="sxs-lookup"><span data-stu-id="784f5-339">REG_DWORD or REG_BINARY</span></span></td>
<td><span data-ttu-id="784f5-340">Помечает управляющие элементы процедуры поиска и очистки.</span><span class="sxs-lookup"><span data-stu-id="784f5-340">Flags controlling elements of the search and cleaning procedure.</span></span> <span data-ttu-id="784f5-341">Одно или несколько из следующих значений.</span><span class="sxs-lookup"><span data-stu-id="784f5-341">One or more of the following values.</span></span>
<ul>
<li><span data-ttu-id="784f5-342">DDEVCF_DOSUBDIRS (0x00000001).</span><span class="sxs-lookup"><span data-stu-id="784f5-342">DDEVCF_DOSUBDIRS (0x00000001).</span></span> <span data-ttu-id="784f5-343">Рекурсивный поиск и удаление.</span><span class="sxs-lookup"><span data-stu-id="784f5-343">Search and remove recursively.</span></span></li>
<li><span data-ttu-id="784f5-344">DDEVCF_REMOVEAFTERCLEAN (0x00000002).</span><span class="sxs-lookup"><span data-stu-id="784f5-344">DDEVCF_REMOVEAFTERCLEAN (0x00000002).</span></span> <span data-ttu-id="784f5-345">После запуска обработчика удалите его из реестра.</span><span class="sxs-lookup"><span data-stu-id="784f5-345">After the handler is run once, remove it from the registry.</span></span></li>
<li><span data-ttu-id="784f5-346">DDEVCF_REMOVEREADONLY (0x00000004).</span><span class="sxs-lookup"><span data-stu-id="784f5-346">DDEVCF_REMOVEREADONLY (0x00000004).</span></span> <span data-ttu-id="784f5-347">Удалите файлы, соответствующие условиям поиска, даже если они доступны только для чтения.</span><span class="sxs-lookup"><span data-stu-id="784f5-347">Remove files that meet the search criteria even if they are read-only.</span></span></li>
<li><span data-ttu-id="784f5-348">DDEVCF_REMOVESYSTEM (0x00000008).</span><span class="sxs-lookup"><span data-stu-id="784f5-348">DDEVCF_REMOVESYSTEM (0x00000008).</span></span> <span data-ttu-id="784f5-349">Удалите файлы, соответствующие условиям поиска, даже если они являются системными файлами.</span><span class="sxs-lookup"><span data-stu-id="784f5-349">Remove files that meet the search criteria even if they are system files.</span></span></li>
<li><span data-ttu-id="784f5-350">DDEVCF_REMOVEHIDDEN (0x00000010).</span><span class="sxs-lookup"><span data-stu-id="784f5-350">DDEVCF_REMOVEHIDDEN (0x00000010).</span></span> <span data-ttu-id="784f5-351">Удалите файлы, соответствующие условиям поиска, даже если они скрыты.</span><span class="sxs-lookup"><span data-stu-id="784f5-351">Remove files that meet the search criteria even if they are hidden files.</span></span></li>
<li><span data-ttu-id="784f5-352">DDEVCF_DONTSHOWIFZERO (0x00000020).</span><span class="sxs-lookup"><span data-stu-id="784f5-352">DDEVCF_DONTSHOWIFZERO (0x00000020).</span></span> <span data-ttu-id="784f5-353">Не выводит этот обработчик в диспетчере очистки диска, если нет файлов, соответствующих условиям поиска.</span><span class="sxs-lookup"><span data-stu-id="784f5-353">Do not display this handler in the disk cleanup manager if no files match its search criteria.</span></span></li>
<li><span data-ttu-id="784f5-354">DDEVCF_REMOVEDIRS (0x00000040).</span><span class="sxs-lookup"><span data-stu-id="784f5-354">DDEVCF_REMOVEDIRS (0x00000040).</span></span> <span data-ttu-id="784f5-355">Сопоставление значения FileList с каталогами и удаление совпадений и всех подкаталогов.</span><span class="sxs-lookup"><span data-stu-id="784f5-355">Match the FileList value against directories and remove matches and all of their subdirectories.</span></span></li>
<li><span data-ttu-id="784f5-356">DDEVCF_RUNIFOUTOFDISKSPACE (0x00000080).</span><span class="sxs-lookup"><span data-stu-id="784f5-356">DDEVCF_RUNIFOUTOFDISKSPACE (0x00000080).</span></span> <span data-ttu-id="784f5-357">Этот обработчик следует запускать только в том случае, если свободное место на диске превышает критическое значение, определяемое диспетчером очистки диска с установкой флага EVCF_OUTOFDISKSPACE с помощью <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize"><strong>иемптиволумекаче:: Initialize</strong></a> или <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex"><strong>IEmptyVolumeCache2:: инитиализикс</strong></a>.</span><span class="sxs-lookup"><span data-stu-id="784f5-357">Run this handler only if available disk space has fallen below the critical value, determined by the disk cleanup manager setting the EVCF_OUTOFDISKSPACE flag through <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize"><strong>IEmptyVolumeCache::Initialize</strong></a> or <a href="/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex"><strong>IEmptyVolumeCache2::InitializeEx</strong></a>.</span></span></li>
<li><span data-ttu-id="784f5-358">DDEVCF_REMOVEPARENTDIR (0x00000100).</span><span class="sxs-lookup"><span data-stu-id="784f5-358">DDEVCF_REMOVEPARENTDIR (0x00000100).</span></span> <span data-ttu-id="784f5-359">Удалить родительский каталог указанных файлов после запуска очистки.</span><span class="sxs-lookup"><span data-stu-id="784f5-359">Remove the parent directory of the specified files once the cleaner has run.</span></span></li>
<li><span data-ttu-id="784f5-360">DDEVCF_PRIVATE_LASTACCESS (0x10000000).</span><span class="sxs-lookup"><span data-stu-id="784f5-360">DDEVCF_PRIVATE_LASTACCESS (0x10000000).</span></span> <span data-ttu-id="784f5-361">Используйте значение Ластакцесс, если оно предоставлено, для определения того, какие файлы следует очищать.</span><span class="sxs-lookup"><span data-stu-id="784f5-361">Use the LastAccess value, if provided, in ascertaining which files should be cleaned.</span></span> <span data-ttu-id="784f5-362">Этот флаг пропускается при использовании параметра <a href="#using-the-datadrivencleaner-object">датадривенклеанер</a> любое предоставленное ластакцесс значение всегда используется.</span><span class="sxs-lookup"><span data-stu-id="784f5-362">This flag is ignored when using the <a href="#using-the-datadrivencleaner-object">DataDrivenCleaner</a> any provided LastAccess value is always used.</span></span></li>
</ul></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="784f5-363">Папка</span><span class="sxs-lookup"><span data-stu-id="784f5-363">Folder</span></span></td>
<td><span data-ttu-id="784f5-364">REG_SZ, REG_MULTI_SZ или REG_EXPAND_SZ</span><span class="sxs-lookup"><span data-stu-id="784f5-364">REG_SZ, REG_MULTI_SZ, or REG_EXPAND_SZ</span></span></td>
<td><span data-ttu-id="784f5-365">Конкретная папка или папки для поиска элементов, соответствующих записям в значении FileList.</span><span class="sxs-lookup"><span data-stu-id="784f5-365">A specific folder or folders to search for items matching entries in the FileList value.</span></span> <span data-ttu-id="784f5-366">Подстановочные знаки можно указать с помощью команды?</span><span class="sxs-lookup"><span data-stu-id="784f5-366">You can specify wildcards using the ?</span></span> <span data-ttu-id="784f5-367">или \* символов.</span><span class="sxs-lookup"><span data-stu-id="784f5-367">or \* characters.</span></span> <span data-ttu-id="784f5-368">Если значение имеет тип REG_SZ, несколько имен папок разделяются с помощью | символ без пробелов с обеих сторон.</span><span class="sxs-lookup"><span data-stu-id="784f5-368">If the value is of type REG_SZ, multiple folder names are separated using the | character, without spaces on either side of it.</span></span><br/> <span data-ttu-id="784f5-369">Если указано значение CSID, в этом значении можно указать только одну папку.</span><span class="sxs-lookup"><span data-stu-id="784f5-369">If a CSIDL value is present, only one folder can be specified in this value.</span></span> <span data-ttu-id="784f5-370">Расположение, указанное в качестве значения CSID, добавляется в начало пути к папке для создания пути поиска.</span><span class="sxs-lookup"><span data-stu-id="784f5-370">The location indicated by the CSIDL value is prepended to that folder path to compose a search path.</span></span> <span data-ttu-id="784f5-371">Пример см. в описании значения CSID.</span><span class="sxs-lookup"><span data-stu-id="784f5-371">For an example, see the CSIDL value description.</span></span><br/> <span data-ttu-id="784f5-372">Если это значение отсутствует в Windows Vista с пакетом обновления 1 (SP1) и более поздних версий, обработчик очистки игнорируется и возвращается S_FALSE при инициализации.</span><span class="sxs-lookup"><span data-stu-id="784f5-372">If this value is absent on Windows Vista Service Pack 1 (SP1) and later, the cleanup handler is ignored and it returns S_FALSE on initialization.</span></span><br/> <span data-ttu-id="784f5-373">Если это значение отсутствует в первоначальном выпуске Windows Vista и более ранних версий, используется корневая папка текущего тома.</span><span class="sxs-lookup"><span data-stu-id="784f5-373">If this value is absent on the original release of Windows Vista and earlier, the root folder of the current volume is used.</span></span> <span data-ttu-id="784f5-374">В этом случае для поиска по всему диску требуется флаг DDEVCF_DOSUBDIRS.</span><span class="sxs-lookup"><span data-stu-id="784f5-374">The DDEVCF_DOSUBDIRS flag is needed in that case to search the entire drive.</span></span> <span data-ttu-id="784f5-375">Без него выполняется поиск только в самой корневой папке.</span><span class="sxs-lookup"><span data-stu-id="784f5-375">Without it, only the root folder itself is searched.</span></span><br/> <span data-ttu-id="784f5-376">Необходимо указать диск или диски.</span><span class="sxs-lookup"><span data-stu-id="784f5-376">A drive or drives must be specified.</span></span> <span data-ttu-id="784f5-377">Это можно сделать с помощью значения CSID или строки REG_EXPAND_SZ.</span><span class="sxs-lookup"><span data-stu-id="784f5-377">This can be provided through the CSIDL value or through a REG_EXPAND_SZ string.</span></span> <span data-ttu-id="784f5-378">При запрете этих параметров диск для поиска должен быть указан в имени папки.</span><span class="sxs-lookup"><span data-stu-id="784f5-378">Barring those options, however, the drive to search must be specified in the folder name.</span></span> <span data-ttu-id="784f5-379">Используйте?: для поиска в папке на текущем диске.</span><span class="sxs-lookup"><span data-stu-id="784f5-379">Use ?: to search the folder on the current drive.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="784f5-380">IconPath</span><span class="sxs-lookup"><span data-stu-id="784f5-380">IconPath</span></span></td>
<td><span data-ttu-id="784f5-381">REG_SZ или REG_EXPAND_SZ</span><span class="sxs-lookup"><span data-stu-id="784f5-381">REG_SZ or REG_EXPAND_SZ</span></span></td>
<td><span data-ttu-id="784f5-382">Путь к ресурсу, из которого получается значок, используемый для связи с обработчиком.</span><span class="sxs-lookup"><span data-stu-id="784f5-382">The path to the resource from which to obtain an icon to use in association with the handler.</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="784f5-383">ластакцесс</span><span class="sxs-lookup"><span data-stu-id="784f5-383">LastAccess</span></span></td>
<td><span data-ttu-id="784f5-384">REG_DWORD или REG_BINARY</span><span class="sxs-lookup"><span data-stu-id="784f5-384">REG_DWORD or REG_BINARY</span></span></td>
<td><span data-ttu-id="784f5-385">Число дней, которое должно пройти с момента последнего обращения к файлу, или создать каталог для этого файла или каталога, который будет учитываться при очистке.</span><span class="sxs-lookup"><span data-stu-id="784f5-385">The number of days that must have elapsed since a file was last accessed or a directory was created for that file or directory to be considered for cleanup.</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="784f5-386">Приоритет</span><span class="sxs-lookup"><span data-stu-id="784f5-386">Priority</span></span></td>
<td><span data-ttu-id="784f5-387">REG_DWORD или REG_BINARY</span><span class="sxs-lookup"><span data-stu-id="784f5-387">REG_DWORD or REG_BINARY</span></span></td>
<td><span data-ttu-id="784f5-388">Определяет порядок выполнения обработчика относительно других обработчиков.</span><span class="sxs-lookup"><span data-stu-id="784f5-388">Determines the order that the handler is run with respect to other handlers.</span></span> <span data-ttu-id="784f5-389">Чем выше число, тем выше в процессе, в котором выполняется обработчик.</span><span class="sxs-lookup"><span data-stu-id="784f5-389">The higher the number, the earlier in the process that the handler runs.</span></span> <span data-ttu-id="784f5-390">Определенного диапазона нет допустимого числа.</span><span class="sxs-lookup"><span data-stu-id="784f5-390">There is no defined range any number is acceptable.</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="784f5-391">PropertyBag</span><span class="sxs-lookup"><span data-stu-id="784f5-391">PropertyBag</span></span></td>
<td><span data-ttu-id="784f5-392">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="784f5-392">REG_SZ</span></span></td>
<td><span data-ttu-id="784f5-393">Идентификатор CLSID ресурса, используемый для предоставления локализованного текста для отображаемого имени, описания и текста кнопки.</span><span class="sxs-lookup"><span data-stu-id="784f5-393">The CLSID of a resource used to provide localized text for the display name, description, and button text.</span></span> <span data-ttu-id="784f5-394">Этот ресурс полезен в ситуации, когда обработчик не реализует <a href="/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache"><strong>иемптиволумекаче</strong></a> , а обработчик выполняется под управлением Microsoft Windows NT или Windows XP.</span><span class="sxs-lookup"><span data-stu-id="784f5-394">This resource is useful in the situation where a handler does not implement <a href="/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache"><strong>IEmptyVolumeCache</strong></a> and the handler is being run under Microsoft Windows NT or Windows XP.</span></span><br/> <span data-ttu-id="784f5-395">Диспетчер очистки диска сначала проверяет, вернул ли подпрограмма инициализации обработчика эти строки, как в случае реализации <a href="/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2"><strong>IEmptyVolumeCache2</strong></a> .</span><span class="sxs-lookup"><span data-stu-id="784f5-395">The disk cleanup manager first checks whether the handler's initialization routine returned those strings, as would be the case when <a href="/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2"><strong>IEmptyVolumeCache2</strong></a> is implemented.</span></span> <span data-ttu-id="784f5-396">После этого руководитель переключается в контейнер свойств с именем в этом значении.</span><span class="sxs-lookup"><span data-stu-id="784f5-396">Failing that, the manager next turns to a property bag named in this value.</span></span> <span data-ttu-id="784f5-397">Если ничего не указано, он извлекает текст из реестра.</span><span class="sxs-lookup"><span data-stu-id="784f5-397">If none has been provided, it retrieves the text from the registry.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="784f5-398">статефлагс</span><span class="sxs-lookup"><span data-stu-id="784f5-398">StateFlags</span></span></td>
<td><span data-ttu-id="784f5-399">REG_DWORD</span><span class="sxs-lookup"><span data-stu-id="784f5-399">REG_DWORD</span></span></td>
<td><span data-ttu-id="784f5-400">Запустив исполняемый файл диспетчера очистки диска Cleanmgr.exe из командной строки, можно объявить <em>Профили</em>очистки.</span><span class="sxs-lookup"><span data-stu-id="784f5-400">By running the disk cleanup manager's executable file Cleanmgr.exe from a command line, you can declare cleanup <em>profiles</em>.</span></span> <span data-ttu-id="784f5-401">Эти профили состоят из подмножества доступных обработчиков и получают уникальную цифровую метку.</span><span class="sxs-lookup"><span data-stu-id="784f5-401">These profiles are composed of a subset of the available handlers and are given a unique numeric label.</span></span> <span data-ttu-id="784f5-402">Это позволяет автоматизировать выполнение различных наборов обработчиков в разное время.</span><span class="sxs-lookup"><span data-stu-id="784f5-402">This allows you to automate the running of different sets of handlers at different times.</span></span><br/> <span data-ttu-id="784f5-403">Командная строка &quot;cleanmgr.exe/sageset:<strong>nnnn</strong> &quot; , где <strong>nnnn</strong> — уникальная цифровая метка, отображает пользовательский интерфейс, позволяющий выбирать обработчики, включаемые в этот профиль.</span><span class="sxs-lookup"><span data-stu-id="784f5-403">The command line &quot;cleanmgr.exe /sageset:<strong>nnnn</strong>&quot;, where <strong>nnnn</strong> is a unique numeric label, displays a UI allowing you to choose the handlers to be included in that profile.</span></span> <span data-ttu-id="784f5-404">Кроме определения профиля, параметр сажесет также записывает значение с именем Статефлагс<strong>nnnn</strong>, где <strong>nnnn</strong> — это метка, используемая в параметре, для всех подразделов в разделе <strong>волумекачес</strong>.</span><span class="sxs-lookup"><span data-stu-id="784f5-404">As well as defining the profile, the sageset parameter also writes a value named StateFlags<strong>nnnn</strong>, where <strong>nnnn</strong> is the label you used in the parameter, to all of the subkeys under <strong>VolumeCaches</strong>.</span></span> <span data-ttu-id="784f5-405">Для этих записей существует два возможных значения данных.</span><span class="sxs-lookup"><span data-stu-id="784f5-405">There are two possible data values for those entries.</span></span>
<ul>
<li><span data-ttu-id="784f5-406">0: не запускать этот обработчик при выполнении этого профиля.</span><span class="sxs-lookup"><span data-stu-id="784f5-406">0: Do not run this handler when this profile is run.</span></span></li>
<li><span data-ttu-id="784f5-407">2: включить этот обработчик при выполнении этого профиля.</span><span class="sxs-lookup"><span data-stu-id="784f5-407">2: Include this handler when this profile is run.</span></span></li>
</ul>
<br/> <span data-ttu-id="784f5-408">Например, предположим, что выполняется Командная строка &quot;cleanmgr.exe/sageset: 1234 &quot; .</span><span class="sxs-lookup"><span data-stu-id="784f5-408">For example, suppose that the command line &quot;cleanmgr.exe /sageset:1234&quot; is run.</span></span> <span data-ttu-id="784f5-409">В представленном пользовательском интерфейсе пользователь выбирает <strong>загруженные файлы программы</strong>, но не выбирает <strong>временные файлы Интернета</strong>.</span><span class="sxs-lookup"><span data-stu-id="784f5-409">In the UI that is presented, the user chooses <strong>Downloaded Program Files</strong>, but does not choose <strong>Temporary Internet Files</strong>.</span></span> <span data-ttu-id="784f5-410">Затем в реестр записываются следующие значения.</span><span class="sxs-lookup"><span data-stu-id="784f5-410">The following values are then written to the registry.</span></span><br/>
<pre data-space="preserve"><code>HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows
            CurrentVersion
               Explorer
                  VolumeCaches
                     Downloaded Program Files
                        StateFlags1234 = 0x00000002
                     Internet Cache Files
                        StateFlags1234 = 0x00000000</code></pre>
<br/> <span data-ttu-id="784f5-411">Командная строка &quot;cleanmgr.exe/сажерун:<strong>nnnn</strong> &quot; , где значение <strong>nnnn</strong> совпадает с меткой, объявленной с параметром сажесет, запускает все обработчики, выбранные в этом профиле.</span><span class="sxs-lookup"><span data-stu-id="784f5-411">The command line &quot;cleanmgr.exe /sagerun:<strong>nnnn</strong>&quot;, where the value of <strong>nnnn</strong> matches the label declared with the sageset parameter, runs all of the handlers selected in that profile.</span></span><br/> <span data-ttu-id="784f5-412">Универсальное значение Статефлагс записывается в реестр, когда Очистка диска выполняется обычным образом.</span><span class="sxs-lookup"><span data-stu-id="784f5-412">A generic StateFlags value is written to the registry when Disk Cleanup is run normally.</span></span> <span data-ttu-id="784f5-413">Это значение просто сохраняет состояние обработчика (флажок установлен или снят) в момент последнего представления в качестве параметра для пользователя.</span><span class="sxs-lookup"><span data-stu-id="784f5-413">This value simply stores the state (checked or unchecked) of the handler the last time it was presented as an option to the user.</span></span> <span data-ttu-id="784f5-414">Для этих записей существует два возможных значения данных.</span><span class="sxs-lookup"><span data-stu-id="784f5-414">There are two possible data values for those entries.</span></span>
<ul>
<li><span data-ttu-id="784f5-415">0: обработчик не выбран.</span><span class="sxs-lookup"><span data-stu-id="784f5-415">0: The handler was not selected.</span></span></li>
<li><span data-ttu-id="784f5-416">1: обработчик был выбран.</span><span class="sxs-lookup"><span data-stu-id="784f5-416">1: The handler was selected.</span></span></li>
</ul>
<br/></td>
</tr>
</tbody>
</table>



 

### <a name="registering-a-handler-with-the-disk-cleanup-manager-windows-2000-or-later-systems"></a><span data-ttu-id="784f5-417">Регистрация обработчика с помощью диспетчера очистки диска: Windows 2000 или более поздние системы</span><span class="sxs-lookup"><span data-stu-id="784f5-417">Registering a Handler with the Disk Cleanup Manager: Windows 2000 or Later Systems</span></span>

<span data-ttu-id="784f5-418">Указание отображаемого текста в реестре может усложнить локализацию программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="784f5-418">Specifying display text in the registry can make it difficult to localize software.</span></span> <span data-ttu-id="784f5-419">По этой причине Windows 2000 и Windows XP поддерживают интерфейс [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2) с предпочтительным методом инициализации [**инитиализикс**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex).</span><span class="sxs-lookup"><span data-stu-id="784f5-419">For this reason, Windows 2000 and Windows XP support the [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2) interface with its preferred initialization method [**InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex).</span></span> <span data-ttu-id="784f5-420">В Windows 2000 или более поздней версии всегда выполняется попытка вызвать **IEmptyVolumeCache2:: инитиализикс** перед [**Иемптиволумекаче:: Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize).</span><span class="sxs-lookup"><span data-stu-id="784f5-420">Under Windows 2000 or later, an attempt is always made to call **IEmptyVolumeCache2::InitializeEx** before [**IEmptyVolumeCache::Initialize**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache-initialize).</span></span> <span data-ttu-id="784f5-421">Система использует **инициализацию** только для инициализации обработчика, если **IEmptyVolumeCache2** не предоставлен.</span><span class="sxs-lookup"><span data-stu-id="784f5-421">The system only uses **Initialize** to initialize a handler if **IEmptyVolumeCache2** is not exposed.</span></span>

<span data-ttu-id="784f5-422">В отношении реестра единственным различием в Windows 2000 или более поздней версии является то, что можно опустить значения Адванцедбуттонтекст, дисплея и описания, если обработчику предоставлено [**IEmptyVolumeCache2:: инитиализикс**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex) .</span><span class="sxs-lookup"><span data-stu-id="784f5-422">In regard to the registry, the only difference under Windows 2000 or later is that you can omit the AdvancedButtonText, Display, and Description values when [**IEmptyVolumeCache2::InitializeEx**](/windows/desktop/api/Emptyvc/nf-emptyvc-iemptyvolumecache2-initializeex) is exposed by the handler.</span></span> <span data-ttu-id="784f5-423">Эти значения, содержащие правильно локализованный текст, предоставляются диспетчеру очистки диска при вызове **инитиализикс**.</span><span class="sxs-lookup"><span data-stu-id="784f5-423">Those values, containing properly localized text, are provided to the disk cleanup manager when it calls **InitializeEx**.</span></span>

### <a name="using-the-datadrivencleaner-object"></a><span data-ttu-id="784f5-424">Использование объекта Датадривенклеанер</span><span class="sxs-lookup"><span data-stu-id="784f5-424">Using the DataDrivenCleaner Object</span></span>

<span data-ttu-id="784f5-425">Базовый обработчик очистки диска, называемый Датадривенклеанер, предоставляется операционной системой.</span><span class="sxs-lookup"><span data-stu-id="784f5-425">A basic disk cleanup handler, called the DataDrivenCleaner, is provided by the operating system.</span></span> <span data-ttu-id="784f5-426">Чтобы использовать этот объект в качестве обработчика вместо реализации собственного, используйте CLSID {C0E13E61-0CC6-11d1-BBB6-0060978B2AE6} в качестве значения по умолчанию для подраздела обработчика в разделе **волумекачес** , как описано в статье [Регистрация обработчика с помощью диспетчера очистки диска: общие](#registering-a-handler-with-the-disk-cleanup-manager-general).</span><span class="sxs-lookup"><span data-stu-id="784f5-426">To use this object as a handler rather than implementing your own, use the CLSID {C0E13E61-0CC6-11d1-BBB6-0060978B2AE6} as the Default value for the handler's subkey under **VolumeCaches** as described in [Registering a Handler with the Disk Cleanup Manager: General](#registering-a-handler-with-the-disk-cleanup-manager-general).</span></span>

<span data-ttu-id="784f5-427">Датадривенклеанер не предоставляет [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2), поэтому значения отображения и описания предоставляются в реестре.</span><span class="sxs-lookup"><span data-stu-id="784f5-427">The DataDrivenCleaner does not expose [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2), so the Display and Description values are provided through the registry.</span></span> <span data-ttu-id="784f5-428">При объявлении этих строк имейте в виду, что это может привести к проблемам локализации.</span><span class="sxs-lookup"><span data-stu-id="784f5-428">When declaring those strings, be aware that this could cause localization issues.</span></span> <span data-ttu-id="784f5-429">Локализованный текст можно предоставить с помощью значения PropertyBag.</span><span class="sxs-lookup"><span data-stu-id="784f5-429">Localized text can be provided through the PropertyBag value.</span></span> <span data-ttu-id="784f5-430">Значение Адванцедбуттонтекст игнорируется, так как отсутствует пользовательский интерфейс, и поэтому кнопка не отображается, доступна для этого обработчика.</span><span class="sxs-lookup"><span data-stu-id="784f5-430">The AdvancedButtonText value is ignored since no UI, and thus no button to display it, is available for this handler.</span></span>

### <a name="example-registration-of-a-disk-cleanup-handler"></a><span data-ttu-id="784f5-431">Пример регистрации обработчика очистки диска</span><span class="sxs-lookup"><span data-stu-id="784f5-431">Example Registration of a Disk Cleanup Handler</span></span>

<span data-ttu-id="784f5-432">Ниже приведен пример регистрации для обработчика очистки диска, реализованного телефонной компанией.</span><span class="sxs-lookup"><span data-stu-id="784f5-432">The following shows an example registration for a disk cleanup handler implemented by The Phone Company.</span></span> <span data-ttu-id="784f5-433">Этот обработчик реализует как [**иемптиволумекаче**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache) , так и [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2), поэтому предоставляет Адванцедбуттонтекст, описание и отображаемые значения на тот случай, если он используется на компьютере под Windows 98.</span><span class="sxs-lookup"><span data-stu-id="784f5-433">This handler implements both [**IEmptyVolumeCache**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache) and [**IEmptyVolumeCache2**](/windows/desktop/api/Emptyvc/nn-emptyvc-iemptyvolumecache2), and so provides AdvancedButtonText, Description, and Display values in case it is used on a computer running Windows 98.</span></span> <span data-ttu-id="784f5-434">Этот обработчик объединяет значения CSID и Folder для поиска файлов в папке C: \\ Program Files \\ в каталоге Temp телефонной компании \\ , а \_ флаг ддевкф досубдирс установлен таким образом, чтобы его подкаталоги также были просмотрены.</span><span class="sxs-lookup"><span data-stu-id="784f5-434">The handler combines the CSIDL and Folder values to search for files in the C:\\Program Files\\The Phone Company\\Temp directory, and the DDEVCF\_DOSUBDIRS flag is set so that its subdirectories are also searched.</span></span> <span data-ttu-id="784f5-435">Учитываются только те файлы с расширениями TMP и TPC, которые используются для очистки, а \_ флаг ддевкф Private \_ ластакцесс установлен таким образом, чтобы из этих файлов не выполнялся доступ в течение 14 или более дней.</span><span class="sxs-lookup"><span data-stu-id="784f5-435">Only those files with .tmp and .tpc extensions are considered for cleanup, and the DDEVCF\_PRIVATE\_LASTACCESS flag is set so that out of those files, only those that have not been accessed for 14 days or more are considered.</span></span> <span data-ttu-id="784f5-436">\_Также устанавливается флаг ддевкф донтшовифзеро, чтобы обработчик не отображался в списке, если он не нашел кандидатов для очистки.</span><span class="sxs-lookup"><span data-stu-id="784f5-436">The DDEVCF\_DONTSHOWIFZERO flag is also set so that the handler does not appear on the list unless it has found cleanup candidates.</span></span>

```
HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows
            CurrentVersion
               Explorer
                  VolumeCaches
                     The Phone Company Files
                        (Default) = {the CLSID GUID}
                        AdvancedButtonText = &View Files
                        CleanupString = c:\tpc.exe
                        CSIDL = 0x00000026
                        Description = Old temporary files.
                        Display = The Phone Company Files
                        FileList = *.tmp|*.tpc
                        Flags = 0x10000021
                        Folder = \The Phone Company\Temp
                        IconPath = c:\Program Files\The Phone Company\tpc.dll,2
                        LastAccess = 0x0000000e
                        Priority = 200
                        PropertyBag = {Property Bag CLSID GUID}
```

 

