---
title: Кодирование контента
description: Начиная с Windows Server 2008 и Windows Vista, приложение может направить WinINet для выполнения декодирования содержимого gzip и Deflate схем кодирования содержимого.
ms.assetid: 136f22a6-e5ca-41c5-8651-6e132655d268
keywords:
- Кодирование контента
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 09b089ae2aa4cbacdfc9b6ebefe5cbdfc1bfc10e
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104070488"
---
# <a name="content-encoding"></a><span data-ttu-id="5f452-104">Кодирование контента</span><span class="sxs-lookup"><span data-stu-id="5f452-104">Content Encoding</span></span>

<span data-ttu-id="5f452-105">Как указано в приложениях протокола HTTP (RFC 2616), может запросить, чтобы сервер возвращал HTTP-ответы в закодированном формате.</span><span class="sxs-lookup"><span data-stu-id="5f452-105">As specified in the HTTP protocol (RFC 2616) applications can request that the server return HTTP responses in encoded format.</span></span> <span data-ttu-id="5f452-106">До Windows Server 2008 и Windows Vista запросы с кодировкой содержимого были отправлены приложению для обработки на их уровне.</span><span class="sxs-lookup"><span data-stu-id="5f452-106">Prior to Windows Server 2008 and Windows Vista, requests with content encoding were sent to the application for processing at their level.</span></span> <span data-ttu-id="5f452-107">Начиная с Windows Server 2008 и Windows Vista, приложение может направить WinINet для выполнения декодирования содержимого gzip и Deflate схем кодирования содержимого.</span><span class="sxs-lookup"><span data-stu-id="5f452-107">Starting in Windows Server 2008 and Windows Vista, the application can direct WinINet to perform content decoding for the gzip and deflate content encoding schemes.</span></span>

<span data-ttu-id="5f452-108">Чтобы включить декодирование содержимого, приложение устанавливает параметр декодирования, запрашивающий, что WinINet выполняет декодирование от своего имени.</span><span class="sxs-lookup"><span data-stu-id="5f452-108">To enable content decoding, the application sets the decoding option requesting that WinINet perform decoding on their behalf.</span></span> <span data-ttu-id="5f452-109">Однако включение декодирования не гарантирует, что WinINet будет выполнять декодирование содержимого, и приложение должно быть подготовлено к обработке декодирования.</span><span class="sxs-lookup"><span data-stu-id="5f452-109">However, enabling decoding does not guarantee that WinINet will perform content decoding, and the application should be prepared to handle decoding.</span></span> <span data-ttu-id="5f452-110">WinINet отделяет заголовок Content-Encoding от ответа при успешном выполнении декодирования содержимого.</span><span class="sxs-lookup"><span data-stu-id="5f452-110">WinINet strips the content-encoding header from the response when content decoding is successfully performed.</span></span> <span data-ttu-id="5f452-111">Предполагается, что приложения обрабатывают декодирование содержимого независимо от того, включен или отключен параметр декодирования при наличии в ответе заголовка Content-Encoding.</span><span class="sxs-lookup"><span data-stu-id="5f452-111">Applications are expected to handle content decoding regardless of whether the decoding option is enabled or disabled when the content-encoding header is present in the response.</span></span>

<span data-ttu-id="5f452-112">При включении декодирования приложение должно указать список поддерживаемых кодировок в заголовке Accept-Encoding запроса.</span><span class="sxs-lookup"><span data-stu-id="5f452-112">When decoding is enabled, the application must specify the list of supported encodings in the Accept-Encoding header of the request.</span></span> <span data-ttu-id="5f452-113">Однако заголовок Accept-Encoding не обязан отсылать закодированный ответ серверу.</span><span class="sxs-lookup"><span data-stu-id="5f452-113">The Accept-Encoding header, however, does not obligate the server to send an encoded response.</span></span> <span data-ttu-id="5f452-114">WinINet будет отправлять ответы, не соответствующие списку допустимых кодировок, обратно в приложение.</span><span class="sxs-lookup"><span data-stu-id="5f452-114">WinINet will send responses that do not match the list of acceptable encodings back to the application.</span></span>

<span data-ttu-id="5f452-115">В следующем списке описаны условия, при которых WinINet будет выполнять декодирование содержимого при включенном параметре.</span><span class="sxs-lookup"><span data-stu-id="5f452-115">The following list describes the conditions under which WinINet will perform content decoding when the option is enabled:</span></span>

-   <span data-ttu-id="5f452-116">Заголовок Accept-Encoding должен присутствовать в запросе, и он должен указывать файлы gzip, Deflate, а также схемы кодирования gzip и Deflate.</span><span class="sxs-lookup"><span data-stu-id="5f452-116">The Accept-Encoding header must be present in the request, and it must specify the gzip, deflate, or both gzip and deflate encoding schemes.</span></span>
-   <span data-ttu-id="5f452-117">Схема кодирования, указанная в заголовке Content-Encoding, должна соответствовать одной из схем кодирования, указанных в заголовке Accept-Encoding.</span><span class="sxs-lookup"><span data-stu-id="5f452-117">The encoding scheme specified in the Content-Encoding header must match one of the encoding schemes specified in the Accept-Encoding header.</span></span>
-   <span data-ttu-id="5f452-118">В заголовке Content-Encoding в ответе указывается только одна схема кодирования.</span><span class="sxs-lookup"><span data-stu-id="5f452-118">The Content-Encoding header in the response specifies only one encoding scheme.</span></span>
-   <span data-ttu-id="5f452-119">Ответ должен содержать только один заголовок Content-Encoding.</span><span class="sxs-lookup"><span data-stu-id="5f452-119">The response must contain only one Content- Encoding header.</span></span> <span data-ttu-id="5f452-120">WinINet декодирует содержимое, закодированное только одной схемой кодирования.</span><span class="sxs-lookup"><span data-stu-id="5f452-120">WinINet decodes content that is encoded with only one encoding scheme.</span></span>
-   <span data-ttu-id="5f452-121">Заголовок Cache-Control не должен содержать директивы без преобразования.</span><span class="sxs-lookup"><span data-stu-id="5f452-121">The Cache-Control header must not contain the no-transform directive.</span></span>
-   <span data-ttu-id="5f452-122">Заголовок Content-Range не должен присутствовать в ответе.</span><span class="sxs-lookup"><span data-stu-id="5f452-122">The Content-Range header must not be present in the response.</span></span>

## <a name="setting-the-decompression-option"></a><span data-ttu-id="5f452-123">Установка параметра распаковки</span><span class="sxs-lookup"><span data-stu-id="5f452-123">Setting the Decompression Option</span></span>

<span data-ttu-id="5f452-124">Параметр декодирования может быть установлен для обработчика сеанса, маркера запроса или маркера соединения.</span><span class="sxs-lookup"><span data-stu-id="5f452-124">The decoding option can be set on the session handle, the request handle or the connection handle.</span></span> <span data-ttu-id="5f452-125">Маркер, для которого задан параметр декодирования, определяет область действия параметра декодирования.</span><span class="sxs-lookup"><span data-stu-id="5f452-125">The handle on which the decoding option is set, defines the scope of the decoding option.</span></span> <span data-ttu-id="5f452-126">Например, установка декодирования в сеансе позволит декодировать все соединения и запросы, созданные в этом обработчике.</span><span class="sxs-lookup"><span data-stu-id="5f452-126">For example, setting decoding on the session will enable decoding an all connections and requests created under that handle.</span></span>

<span data-ttu-id="5f452-127">Чтобы задать параметр декодирования, приложение вызывает [**интернетсетоптион**](/windows/desktop/api/Wininet/nf-wininet-internetsetoptiona) с маркером, возвращенным из [**интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena), [**интернетконнект**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta)или [**хттпопенрекуест**](/windows/desktop/api/Wininet/nf-wininet-httpopenrequesta).</span><span class="sxs-lookup"><span data-stu-id="5f452-127">To set the decoding option, the application calls [**InternetSetOption**](/windows/desktop/api/Wininet/nf-wininet-internetsetoptiona) with the handle returned from [**InternetOpen**](/windows/desktop/api/Wininet/nf-wininet-internetopena), [**InternetConnect**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta), or [**HttpOpenRequest**](/windows/desktop/api/Wininet/nf-wininet-httpopenrequesta).</span></span> <span data-ttu-id="5f452-128">Параметр **Интернета \_ " \_ параметр \_ декодирования HTTP** " указан в параметре *элемент dwoption* , а параметр *лпбуффер* указывает на логическую переменную, для которой установлено значение true.</span><span class="sxs-lookup"><span data-stu-id="5f452-128">The **INTERNET\_OPTION\_HTTP\_DECODING** option is specified in the *dwOption* parameter, and the *lpBuffer* parameter points to a boolean variable set to true.</span></span> <span data-ttu-id="5f452-129">Чтобы отключить декодирование, приложение вызывает **интернетсетоптион** с параметром **Интернет \_ \_ - \_ декодирования HTTP** , а логическая переменная имеет значение false.</span><span class="sxs-lookup"><span data-stu-id="5f452-129">To disable decoding, the application calls **InternetSetOption** with the **INTERNET\_OPTION\_HTTP\_DECODING** option and the boolean variable set to false.</span></span>

<span data-ttu-id="5f452-130">Если задан параметр декодирования, WinINet выполняет Декодирование запроса, когда приложение вызывает [**интернетреадфиле**](/windows/desktop/api/Wininet/nf-wininet-internetreadfile).</span><span class="sxs-lookup"><span data-stu-id="5f452-130">When the decoding option is set, WinINet performs decoding on the request when the application calls [**InternetReadFile**](/windows/desktop/api/Wininet/nf-wininet-internetreadfile).</span></span> <span data-ttu-id="5f452-131">Если WinINet обнаруживает ошибку при выполнении декодирования содержимого, вызов **интернетреадфиле** завершается сбоем с **ошибкой \_ \_ декодирования \_ в Интернете**.</span><span class="sxs-lookup"><span data-stu-id="5f452-131">If WinINet encounters an error while performing content decoding, the call to **InternetReadFile** fails with an **ERROR\_INTERNET\_DECODING\_FAILED**.</span></span> <span data-ttu-id="5f452-132">При неудачном декодировании приложение имеет два варианта: оно может удалить заголовок Accept-Encoding и повторно отправить запрос или установить параметр **Интернет \_ \_ - \_ декодирования HTTP** в запросе в значение false, а затем повторно отправить запрос.</span><span class="sxs-lookup"><span data-stu-id="5f452-132">When decoding fails, the application has two options: it can remove the Accept-Encoding header and resend the request, or it can set the **INTERNET\_OPTION\_HTTP\_DECODING** option on the request to false and then resend the request.</span></span> <span data-ttu-id="5f452-133">Если для параметра декодирования задано значение false, приложение должно проверить заголовок Content-Encoding и выполнить декодирование на уровне приложения.</span><span class="sxs-lookup"><span data-stu-id="5f452-133">If the decoding option is set to false, the application must check the Content-Encoding header and perform any decoding at the application level.</span></span>

> [!Note]  
> <span data-ttu-id="5f452-134">WinINet не поддерживает реализации серверов.</span><span class="sxs-lookup"><span data-stu-id="5f452-134">WinINet does not support server implementations.</span></span> <span data-ttu-id="5f452-135">Кроме того, его не следует использовать из службы.</span><span class="sxs-lookup"><span data-stu-id="5f452-135">In addition, it should not be used from a service.</span></span> <span data-ttu-id="5f452-136">Для серверных реализаций или служб используйте [службы Microsoft Windows HTTP Services (WinHTTP)](/windows/desktop/WinHttp/winhttp-start-page).</span><span class="sxs-lookup"><span data-stu-id="5f452-136">For server implementations or services use [Microsoft Windows HTTP Services (WinHTTP)](/windows/desktop/WinHttp/winhttp-start-page).</span></span>

 

 

 