---
title: Как AMSI помогает защититься от вредоносных программ
description: Разработчик приложения может активно участвовать в защите от вредоносных программ. В частности, вы можете защитить своих клиентов от вредоносных программ на основе динамических сценариев, а также от нетрадиционных поправок кибератаках.
ms.topic: article
ms.date: 02/27/2019
ms.openlocfilehash: 0d6aee30034312073123f5ab14b1924fd01e6eac
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "103773685"
---
# <a name="how-the-antimalware-scan-interface-amsi-helps-you-defend-against-malware"></a><span data-ttu-id="f72df-104">Как интерфейс проверки на наличие вредоносных программ (AMSI) помогает защититься от вредоносных программ</span><span class="sxs-lookup"><span data-stu-id="f72df-104">How the Antimalware Scan Interface (AMSI) helps you defend against malware</span></span>

<span data-ttu-id="f72df-105">Общие сведения о интерфейсе проверки на наличие вредоносных программ Windows (AMSI) см. в разделе [интерфейс проверки наличия вредоносных программ (AMSI)](antimalware-scan-interface-portal.md).</span><span class="sxs-lookup"><span data-stu-id="f72df-105">For an introduction to the Windows Antimalware Scan Interface (AMSI), see [Antimalware Scan Interface (AMSI)](antimalware-scan-interface-portal.md).</span></span>

<span data-ttu-id="f72df-106">Разработчик приложения может активно участвовать в защите от вредоносных программ.</span><span class="sxs-lookup"><span data-stu-id="f72df-106">As an application developer, you can actively participate in malware defense.</span></span> <span data-ttu-id="f72df-107">В частности, вы можете защитить своих клиентов от вредоносных программ на основе динамических сценариев, а также от нетрадиционных поправок кибератаках.</span><span class="sxs-lookup"><span data-stu-id="f72df-107">Specifically, you can help protect your customers from dynamic script-based malware, and from non-traditional avenues of cyberattack.</span></span>

<span data-ttu-id="f72df-108">В качестве примера предположим, что ваше приложение является сценарным: оно принимает произвольный скрипт и выполняет его через обработчик сценариев.</span><span class="sxs-lookup"><span data-stu-id="f72df-108">By way of an example, let's say that your application is scriptable: it accepts arbitrary script, and executes it via a scripting engine.</span></span> <span data-ttu-id="f72df-109">В момент, когда сценарий готов к работе с обработчиком скриптов, приложение может вызвать API AMSI Windows, чтобы запросить проверку содержимого.</span><span class="sxs-lookup"><span data-stu-id="f72df-109">At the point when a script is ready to be supplied to the scripting engine, your application can call the Windows AMSI APIs to request a scan of the content.</span></span> <span data-ttu-id="f72df-110">Таким образом, можно безопасно определить, является ли сценарий вредоносным, прежде чем продолжить его выполнение.</span><span class="sxs-lookup"><span data-stu-id="f72df-110">That way, you can safely determine whether or not the script is malicious before you decide to go ahead and execute it.</span></span>

<span data-ttu-id="f72df-111">Это справедливо, даже если скрипт был создан во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="f72df-111">This is true even if the script was generated at runtime.</span></span> <span data-ttu-id="f72df-112">Скрипт (вредоносный или другой) может пройти несколько этапов отмены запутывания.</span><span class="sxs-lookup"><span data-stu-id="f72df-112">Script (malicious or otherwise), might go through several passes of de-obfuscation.</span></span> <span data-ttu-id="f72df-113">Но в конечном итоге необходимо предоставить обработчик скриптов с обычным немаскированным кодом.</span><span class="sxs-lookup"><span data-stu-id="f72df-113">But you ultimately need to supply the scripting engine with plain, un-obfuscated code.</span></span> <span data-ttu-id="f72df-114">И это точка, в которой вызываются API-интерфейсы AMSI.</span><span class="sxs-lookup"><span data-stu-id="f72df-114">And that's the point at which you invoke the AMSI APIs.</span></span>

<span data-ttu-id="f72df-115">Ниже приведена иллюстрация архитектуры AMSI, в которой собственное приложение представлено одним из полей "другое приложение".</span><span class="sxs-lookup"><span data-stu-id="f72df-115">Here's an illustration of the AMSI architecture, where your own application is represented by one of the "Other Application" boxes.</span></span>

![Архитектура AMSI](images/AMSI7Archi.jpg)

<span data-ttu-id="f72df-117">Интерфейс Windows AMSI открыт.</span><span class="sxs-lookup"><span data-stu-id="f72df-117">The Windows AMSI interface is open.</span></span> <span data-ttu-id="f72df-118">Это означает, что любое приложение может вызвать его; и любой зарегистрированный модуль защиты от вредоносных программ может обработать переданное содержимое.</span><span class="sxs-lookup"><span data-stu-id="f72df-118">Which means that any application can call it; and any registered Antimalware engine can process the content submitted to it.</span></span>

<span data-ttu-id="f72df-119">Мы не, что обсуждение будет ограничено обработчиками сценариев.</span><span class="sxs-lookup"><span data-stu-id="f72df-119">We needn't limit the discussion to scripting engines, either.</span></span> <span data-ttu-id="f72df-120">Возможно, приложение является приложением для обмена данными и просматривает мгновенные сообщения об обнаруженных вирусах, прежде чем оно покажет их клиентам.</span><span class="sxs-lookup"><span data-stu-id="f72df-120">Perhaps your application is a communication app, and it scans instant messages for viruses before it shows them to your customers.</span></span> <span data-ttu-id="f72df-121">Или, возможно, ваше программное обеспечение — это игра, которая проверяет подключаемые модули перед установкой.</span><span class="sxs-lookup"><span data-stu-id="f72df-121">Or maybe your software is a game that validates plugins before installing them.</span></span> <span data-ttu-id="f72df-122">Существует множество возможностей и сценариев использования AMSI.</span><span class="sxs-lookup"><span data-stu-id="f72df-122">There are plenty of opportunities and scenarios for using AMSI.</span></span>

## <a name="amsi-in-action"></a><span data-ttu-id="f72df-123">AMSI в действии</span><span class="sxs-lookup"><span data-stu-id="f72df-123">AMSI in action</span></span>

<span data-ttu-id="f72df-124">Давайте взглянем на AMSI в действии.</span><span class="sxs-lookup"><span data-stu-id="f72df-124">Let's take a look at AMSI in action.</span></span> <span data-ttu-id="f72df-125">В этом примере защитник Windows — это приложение, вызывающее интерфейсы API AMSI.</span><span class="sxs-lookup"><span data-stu-id="f72df-125">In this example, Windows Defender is the application that's calling AMSI APIs.</span></span> <span data-ttu-id="f72df-126">Но вы можете вызывать те же интерфейсы API из своего приложения.</span><span class="sxs-lookup"><span data-stu-id="f72df-126">But you can call the same APIs from within your own application.</span></span>

<span data-ttu-id="f72df-127">Ниже приведен пример сценария, который использует методику XOR-кодирования, чтобы скрыть его намерение (независимо от того, является ли это условие мягким или нет).</span><span class="sxs-lookup"><span data-stu-id="f72df-127">Here's a sample of a script that uses the XOR-encoding technique to hide its intent (whether that intent is benign or not).</span></span> <span data-ttu-id="f72df-128">На этом рисунке мы можем представить, что этот сценарий был загружен из Интернета.</span><span class="sxs-lookup"><span data-stu-id="f72df-128">For this illustration, we can imagine that this script was downloaded from the Internet.</span></span>

![Пример скрипта, закодированный в Base64](images/AMSI8.png)

<span data-ttu-id="f72df-130">Чтобы сделать кое-что более интересным, мы можем ввести этот сценарий вручную в командной строке, чтобы нет фактического файла для отслеживания.</span><span class="sxs-lookup"><span data-stu-id="f72df-130">To make things more interesting, we can enter this script manually at the command line so that there is no actual file to monitor.</span></span> <span data-ttu-id="f72df-131">Это отражает то, что известно как «безфайловая угроза».</span><span class="sxs-lookup"><span data-stu-id="f72df-131">This mirrors what's known as a "fileless threat".</span></span> <span data-ttu-id="f72df-132">Это не так просто, как сканирование файлов на диске.</span><span class="sxs-lookup"><span data-stu-id="f72df-132">It's not as simple as scanning files on disk.</span></span> <span data-ttu-id="f72df-133">Угроза может быть программы трояныой, которая находится только в памяти компьютера.</span><span class="sxs-lookup"><span data-stu-id="f72df-133">The threat might be a backdoor that lives only in the memory of a machine.</span></span>

<span data-ttu-id="f72df-134">Ниже показан результат выполнения скрипта в Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f72df-134">Below, we see the result of running the script in Windows PowerShell.</span></span> <span data-ttu-id="f72df-135">Вы увидите, что защитник Windows может обнаружить пример теста AMSI в этом сложном сценарии, просто используя стандартную сигнатуру примера теста AMSI.</span><span class="sxs-lookup"><span data-stu-id="f72df-135">You'll see that Windows Defender is able to detect the AMSI test sample in this complicated scenario, merely by using the standard AMSI test sample signature.</span></span>

![Пример теста AMSI в Защитнике Windows](images/AMSI9proper.png)

## <a name="amsi-integration-with-javascriptvba"></a><span data-ttu-id="f72df-137">Интеграция AMSI с JavaScript/VBA</span><span class="sxs-lookup"><span data-stu-id="f72df-137">AMSI integration with JavaScript/VBA</span></span>

<span data-ttu-id="f72df-138">Показанный ниже рабочий процесс описывает сквозной поток другого примера, в котором мы демонстрируем интеграцию AMSI с выполнением макросов в Microsoft Office.</span><span class="sxs-lookup"><span data-stu-id="f72df-138">The illustrated workflow below describes the end-to-end flow of another example, in which we demonstrate AMSI's integration with macro execution within Microsoft Office.</span></span>

![Интеграция AMSI с JavaScript/VBA](images/integ-js-vba.png)

- <span data-ttu-id="f72df-140">Пользователь получает документ, содержащий (вредоносный) макрос, который евадес статическое сканирование антивирусного по, применяя такие методы, как запутывания, защищенные паролем файлы и т. д.</span><span class="sxs-lookup"><span data-stu-id="f72df-140">The user receives a document containing a (malicious) macro, which evades static antivirus software scans by employing techniques such as obfuscation, password-protected files, or other.</span></span>
- <span data-ttu-id="f72df-141">Затем пользователь открывает документ, содержащий макрос (вредоносный).</span><span class="sxs-lookup"><span data-stu-id="f72df-141">The user then opens the document containing the (malicious) macro.</span></span> <span data-ttu-id="f72df-142">Если документ открывается в режиме защищенного просмотра, пользователь нажимает кнопку **включить редактирование** для выхода из защищенного представления.</span><span class="sxs-lookup"><span data-stu-id="f72df-142">If the document opens in Protected View, then the user clicks **Enable Editing** to exit Protected View.</span></span>
- <span data-ttu-id="f72df-143">Пользователь нажимает кнопку **Enable Macros (включить макросы** ), чтобы разрешить выполнение макросов.</span><span class="sxs-lookup"><span data-stu-id="f72df-143">The user clicks **Enable Macros** to allow macros to run.</span></span>
- <span data-ttu-id="f72df-144">При выполнении макроса среда выполнения VBA использует круглый буфер для регистрации \[ 1 \] данных и параметров, связанных с вызовами интерфейсов Win32, com и VBA.</span><span class="sxs-lookup"><span data-stu-id="f72df-144">As the macro runs, the VBA runtime uses a circular buffer to log \[1\] data and parameters related to calls to Win32, COM, and VBA APIs.</span></span>
- <span data-ttu-id="f72df-145">При обнаружении конкретных API Win32 или COM, которые считаются высоким уровнем риска ( *триггеры*) \[ 2 \] , выполнение макроса прерывается, а содержимое круглого буфера передается в AMSI.</span><span class="sxs-lookup"><span data-stu-id="f72df-145">When specific Win32 or COM APIs that are considered high risk (also known as *triggers*) \[2\] are observed, macro execution is halted, and the contents of the circular buffer are passed to AMSI.</span></span>
- <span data-ttu-id="f72df-146">Зарегистрированный поставщик услуг защиты от вредоносных программ AMSI реагирует на вердикт, чтобы указать, является ли поведение макроса вредоносным.</span><span class="sxs-lookup"><span data-stu-id="f72df-146">The registered AMSI anti-malware service provider responds with a verdict to indicate whether or not the macro behavior is malicious.</span></span>
- <span data-ttu-id="f72df-147">Если поведение не является вредоносным, выполнение макроса продолжается.</span><span class="sxs-lookup"><span data-stu-id="f72df-147">If the behavior is non-malicious, then macro execution proceeds.</span></span>
- <span data-ttu-id="f72df-148">В противном случае, если поведение является вредоносным, Microsoft Office закрывает сеанс в ответ на предупреждение \[ 3 \] , а AV может помещать файл в карантин.</span><span class="sxs-lookup"><span data-stu-id="f72df-148">Otherwise, if the behavior is malicious, then Microsoft Office closes the session in response to the alert \[3\], and the AV can quarantine the file.</span></span>

## <a name="what-does-this-mean-for-you"></a><span data-ttu-id="f72df-149">Что это означает?</span><span class="sxs-lookup"><span data-stu-id="f72df-149">What does this mean for you?</span></span>

<span data-ttu-id="f72df-150">Для пользователей Windows Любая вредоносная программа, использующая методы запутывания и обход на встроенных в Windows 10 узлах со сценариями, автоматически проверяется на более глубоком уровне, чем когда-либо ранее, предоставляя дополнительные уровни защиты.</span><span class="sxs-lookup"><span data-stu-id="f72df-150">For Windows users, any malicious software that uses obfuscation and evasion techniques on Windows 10's built-in scripting hosts is automatically inspected at a much deeper level than ever before, providing additional levels of protection.</span></span>

<span data-ttu-id="f72df-151">Разработчикам приложений следует подумать о том, что приложение должно вызывать интерфейс AMSI Windows, если вы хотите воспользоваться преимуществами (и защитить клиентов с помощью) дополнительного сканирования и анализа потенциально вредоносного содержимого.</span><span class="sxs-lookup"><span data-stu-id="f72df-151">For you as an application developer, consider having your application call the Windows AMSI interface if you want to benefit from (and protect your customers with) extra scanning and analysis of potentially malicious content.</span></span>

<span data-ttu-id="f72df-152">Как поставщик антивирусного по вы можете реализовать поддержку интерфейса AMSI.</span><span class="sxs-lookup"><span data-stu-id="f72df-152">As an antivirus software vendor, you can consider implementing support for the AMSI interface.</span></span> <span data-ttu-id="f72df-153">Когда вы сделаете это, ваш модуль будет иметь намного более глубокое понимание данных, которые приложения (включая встроенные узлы сценариев Windows 10) могут быть потенциально вредоносными.</span><span class="sxs-lookup"><span data-stu-id="f72df-153">When you do, your engine will have much deeper insight into the data that applications (including Windows 10's built-in scripting hosts) consider to be potentially malicious.</span></span>

## <a name="more-background-info-about-fileless-threats"></a><span data-ttu-id="f72df-154">Дополнительные сведения о безфайловых угрозах</span><span class="sxs-lookup"><span data-stu-id="f72df-154">More background info about fileless threats</span></span>

<span data-ttu-id="f72df-155">Вы можете получить дополнительные сведения о типах безфайловых угроз, разработанных Windows AMSI для защиты от.</span><span class="sxs-lookup"><span data-stu-id="f72df-155">You may be curious for more background info about the kinds of fileless threats that Windows AMSI is designed to help you defend against.</span></span> <span data-ttu-id="f72df-156">В этом разделе мы рассмотрим традиционную игру Cat-and-Mouse, которая воспринимается в экосистеме вредоносных программ.</span><span class="sxs-lookup"><span data-stu-id="f72df-156">In this section, we'll take a look at the traditional cat-and-mouse game that plays out in the malware ecosystem.</span></span>

<span data-ttu-id="f72df-157">В качестве примера мы будем использовать PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f72df-157">We'll use PowerShell as an example.</span></span> <span data-ttu-id="f72df-158">Но вы можете использовать те же методы и процессы, которые мы продемонстрируем в любом динамическом языке &mdash; VBScript, Perl, Python, Ruby и т. д.</span><span class="sxs-lookup"><span data-stu-id="f72df-158">But you can leverage the same techniques and processes we'll demonstrate with any dynamic language&mdash;VBScript, Perl, Python, Ruby, and more.</span></span>

<span data-ttu-id="f72df-159">Ниже приведен пример вредоносного сценария PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f72df-159">Here's an example of a malicious PowerShell script.</span></span>

![Пример вредоносного сценария PowerShell](images/AMSI1.png)

<span data-ttu-id="f72df-161">Хотя этот сценарий просто записывает сообщение на экран, вредоносные программы обычно более злостный.</span><span class="sxs-lookup"><span data-stu-id="f72df-161">While this script simply writes a message to the screen, malware is typically more nefarious.</span></span> <span data-ttu-id="f72df-162">Но вы можете легко написать подпись, чтобы обнаружить ее.</span><span class="sxs-lookup"><span data-stu-id="f72df-162">But you could easily write a signature to detect this one.</span></span> <span data-ttu-id="f72df-163">Например, подпись может искать строку "Write-Host" приводится! "</span><span class="sxs-lookup"><span data-stu-id="f72df-163">For example, the signature could search for the string "Write-Host 'pwnd!'"</span></span> <span data-ttu-id="f72df-164">в любом файле, открываемом пользователем.</span><span class="sxs-lookup"><span data-stu-id="f72df-164">in any file that the user opens.</span></span> <span data-ttu-id="f72df-165">Отлично: Мы обнаружили первую вредоносную программу!</span><span class="sxs-lookup"><span data-stu-id="f72df-165">Great: we've detected our first malware!</span></span>

<span data-ttu-id="f72df-166">Однако после обнаружения нашей первой сигнатурой авторы вредоносных программ будут отвечать.</span><span class="sxs-lookup"><span data-stu-id="f72df-166">After being detected by our first signature, though, malware authors will respond.</span></span> <span data-ttu-id="f72df-167">Они реагируют на создание динамических скриптов, таких как этот пример.</span><span class="sxs-lookup"><span data-stu-id="f72df-167">They respond by creating dynamic scripts such as this example.</span></span>

![Пример динамического скрипта](images/AMSI2.png)

<span data-ttu-id="f72df-169">В этом сценарии авторы вредоносных программ создают строку, представляющую сценарий PowerShell для выполнения.</span><span class="sxs-lookup"><span data-stu-id="f72df-169">In that scenario, malware authors create a string representing the PowerShell script to run.</span></span> <span data-ttu-id="f72df-170">Но они используют простую методику сцепления строк для разбиения предыдущей сигнатуры.</span><span class="sxs-lookup"><span data-stu-id="f72df-170">But they use a simple string concatenation technique to break our earlier signature.</span></span> <span data-ttu-id="f72df-171">Если вы когда-либо видите источник веб-страницы Ладен, вы увидите много экземпляров этого метода, которые используются для предотвращения блокирования AD.</span><span class="sxs-lookup"><span data-stu-id="f72df-171">If you ever view the source of an ad-laden web page, you'll see many instances of this technique being used to avoid ad-blocking software.</span></span>

<span data-ttu-id="f72df-172">Наконец, автор вредоносной программы передает эту объединенную строку `Invoke-Expression` &mdash; механизму PowerShell командлета для вычисления скриптов, которые состоят или создаются во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="f72df-172">Finally, the malware author passes this concatenated string to the `Invoke-Expression` cmdlet&mdash;PowerShell's mechanism to evaluate scripts that are composed or created at runtime.</span></span>

<span data-ttu-id="f72df-173">В ответ программа защиты от вредоносных программ начинает выполнять базовую эмуляцию языка.</span><span class="sxs-lookup"><span data-stu-id="f72df-173">In response, antimalware software starts to do basic language emulation.</span></span> <span data-ttu-id="f72df-174">Например, если мы видим две объединяемые строки, мы будем эмулировать объединение этих двух строк, а затем запустили сигнатуры в результате.</span><span class="sxs-lookup"><span data-stu-id="f72df-174">For example, if we see two strings being concatenated, then we emulate the concatenation of those two strings, and then run our signatures on the result.</span></span> <span data-ttu-id="f72df-175">К сожалению, это довольно непрочный подход, поскольку языки, как правило, предоставляют множество способов представления и сцепления строк.</span><span class="sxs-lookup"><span data-stu-id="f72df-175">Unfortunately, this is a fairly fragile approach, because languages tend to have a lot of ways to represent and concatenate strings.</span></span>

<span data-ttu-id="f72df-176">Итак, после того, как эта подпись будет перехвачена, авторы вредоносных программ переходят на нечто более сложное &mdash; , например кодирование содержимого скриптов в Base64, как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="f72df-176">So, after being caught by this signature, malware authors will move to something more complicated&mdash;for example, encoding script content in Base64, as in this next example.</span></span>

![Пример содержимого скрипта в Base64](images/AMSI3.png)

<span data-ttu-id="f72df-178">При переисточнике большинство механизмов защиты от вредоносных программ также реализуют эмуляцию декодирования Base64.</span><span class="sxs-lookup"><span data-stu-id="f72df-178">Being resourceful, most antimalware engines implement Base64 decoding emulation, as well.</span></span> <span data-ttu-id="f72df-179">Так как мы также реализуем эмуляцию декодирования Base64, мы готовы к моменту времени.</span><span class="sxs-lookup"><span data-stu-id="f72df-179">So, since we also implement Base64 decoding emulation, we're ahead for a time.</span></span>

<span data-ttu-id="f72df-180">В ответ авторы вредоносных программ переходят к алгоритму запутывания, &mdash; такому как простой механизм кодирования XOR в сценариях, которые они выполняют.</span><span class="sxs-lookup"><span data-stu-id="f72df-180">In response, malware authors move to algorithmic obfuscation&mdash;such as a simple XOR-encoding mechanism in the scripts they run.</span></span>

![Пример скрипта алгоритма запутывания](images/AMSI4.png)

<span data-ttu-id="f72df-182">На этом этапе мы обычно работаем с тем, какие антивирусные ядра будут эмулироваться или выявляться, поэтому мы не обязательно определим, что делает этот сценарий.</span><span class="sxs-lookup"><span data-stu-id="f72df-182">At this point, we're generally past what antivirus engines will emulate or detect, so we won't necessarily detect what this script is doing.</span></span> <span data-ttu-id="f72df-183">Однако можно начать писать подписи для методов запутывания и кодирования.</span><span class="sxs-lookup"><span data-stu-id="f72df-183">However, we can start to write signatures against the obfuscation and encoding techniques.</span></span> <span data-ttu-id="f72df-184">На самом деле, это учетные записи для большинства подписей вредоносных программ на основе сценариев.</span><span class="sxs-lookup"><span data-stu-id="f72df-184">In fact, that's what accounts for the vast majority of signatures for script-based malware.</span></span>

<span data-ttu-id="f72df-185">Но что делать, если маскировка настолько проста, что выглядит так, как многие хорошо выполняющиеся сценарии?</span><span class="sxs-lookup"><span data-stu-id="f72df-185">But what if the obfuscator is so trivial that it looks like many well-behaved scripts?</span></span> <span data-ttu-id="f72df-186">Сигнатура для него приведет к неприемлемому числу ложных срабатываний.</span><span class="sxs-lookup"><span data-stu-id="f72df-186">A signature for it would generate an unacceptable number of false positives.</span></span> <span data-ttu-id="f72df-187">Ниже приведен пример сценария *этапа* , который слишком немягк для самостоятельного обнаружения.</span><span class="sxs-lookup"><span data-stu-id="f72df-187">Here's a sample *stager* script that's too benign to detect on its own.</span></span>

![Пример скрипта этапа, который слишком немягк для самостоятельного обнаружения](images/AMSI5.png)

<span data-ttu-id="f72df-189">В этом примере мы скачиваем веб-страницу и получаем из нее некоторое содержимое.</span><span class="sxs-lookup"><span data-stu-id="f72df-189">In that example, we're downloading a web page, and invoking some content from it.</span></span> <span data-ttu-id="f72df-190">Ниже приведен эквивалент в сценарии Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="f72df-190">Here's the equivalent in Visual Basic script.</span></span>

![эквивалент в скрипте Visual Basic](images/AMSI6.png)

<span data-ttu-id="f72df-192">Что еще хуже в обоих этих примерах заключается в том, что антивирусный механизм проверяет файлы, открываемые пользователем.</span><span class="sxs-lookup"><span data-stu-id="f72df-192">What makes things worse in both of these examples is that the antivirus engine inspects files being opened by the user.</span></span> <span data-ttu-id="f72df-193">Если вредоносное содержимое находится только в памяти, возможно, атака может оказаться необнаруженной.</span><span class="sxs-lookup"><span data-stu-id="f72df-193">If the malicious content lives only in memory, then the attack can potentially go undetected.</span></span>

<span data-ttu-id="f72df-194">В этом разделе показаны ограничения на обнаружение с использованием традиционных подписей.</span><span class="sxs-lookup"><span data-stu-id="f72df-194">This section showed the limitations of detection using traditional signatures.</span></span> <span data-ttu-id="f72df-195">Но хотя вредоносный сценарий может пройти несколько этапов дезапутывания, ему, в конечном итоге, необходимо предоставить обработчику сценариев простой, незамаскированный код.</span><span class="sxs-lookup"><span data-stu-id="f72df-195">But, while a malicious script might go through several passes of de-obfuscation, it ultimately needs to supply the scripting engine with plain, unobfuscated code.</span></span> <span data-ttu-id="f72df-196">И на этом этапе, &mdash; как мы описывали в первом разделе на &mdash; основе встроенных в Windows 10 приложений для создания сценариев, вызывают интерфейсы API AMSI, чтобы запросить проверку этого незащищенного содержимого.</span><span class="sxs-lookup"><span data-stu-id="f72df-196">And at that point&mdash;as we described in the first section above&mdash;Windows 10's built-in scripting hosts call the AMSI APIs to request a scan of this unprotected content.</span></span> <span data-ttu-id="f72df-197">И ваше приложение может сделать то же самое.</span><span class="sxs-lookup"><span data-stu-id="f72df-197">And your application can do the same thing.</span></span>

## <a name="related-resources"></a><span data-ttu-id="f72df-198">Связанные ресурсы</span><span class="sxs-lookup"><span data-stu-id="f72df-198">Related resources</span></span>

* [<span data-ttu-id="f72df-199">Безфайловые угрозы</span><span class="sxs-lookup"><span data-stu-id="f72df-199">Fileless threats</span></span>](/windows/security/threat-protection/intelligence/fileless-threats)
* [<span data-ttu-id="f72df-200">Office VBA + AMSI: участие в оказывающихся вредоносных макросов</span><span class="sxs-lookup"><span data-stu-id="f72df-200">Office VBA + AMSI: Parting the veil on malicious macros</span></span>](https://cloudblogs.microsoft.com/microsoftsecure/2018/09/12/office-vba-amsi-parting-the-veil-on-malicious-macros/)
* [<span data-ttu-id="f72df-201">Не все, но невидимые: уменьшение вредоносных программ без файлов с помощью мониторинга поведения, AMSI и следующего поколения AV</span><span class="sxs-lookup"><span data-stu-id="f72df-201">Out of sight but not invisible: Defeating fileless malware with behavior monitoring, AMSI, and next-gen AV</span></span>](https://cloudblogs.microsoft.com/microsoftsecure/2018/09/27/out-of-sight-but-not-invisible-defeating-fileless-malware-with-behavior-monitoring-amsi-and-next-gen-av/)
