---
description: Вы можете импортировать и экспортировать симметричные ключи и асимметричные ключи с помощью CNG. Вы также можете использовать функции экспорта и импорта ключей для перемещения ключей между компьютерами.
ms.assetid: 37bda1e0-5dd2-455c-9627-4e7e1b0e04d3
title: Импорт и экспорт ключей
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8be59cc5f5c4b3d1a98fa30cf4e967d5469d2f1f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105662124"
---
# <a name="key-import-and-export"></a><span data-ttu-id="1b7d1-104">Импорт и экспорт ключей</span><span class="sxs-lookup"><span data-stu-id="1b7d1-104">Key Import and Export</span></span>

<span data-ttu-id="1b7d1-105">Вы можете импортировать и экспортировать [*симметричные ключи*](/windows/desktop/SecGloss/s-gly) и асимметричные ключи с помощью CNG.</span><span class="sxs-lookup"><span data-stu-id="1b7d1-105">You can import and export [*symmetric keys*](/windows/desktop/SecGloss/s-gly) and asymmetric keys with CNG.</span></span> <span data-ttu-id="1b7d1-106">Вы также можете использовать функции экспорта и импорта ключей для перемещения ключей между компьютерами.</span><span class="sxs-lookup"><span data-stu-id="1b7d1-106">And you can use key export and import functionality to move keys between machines.</span></span>

## <a name="symmetric-keys"></a><span data-ttu-id="1b7d1-107">симметричные ключи;</span><span class="sxs-lookup"><span data-stu-id="1b7d1-107">Symmetric keys</span></span>

<span data-ttu-id="1b7d1-108">Чтобы импортировать или экспортировать симметричные (или сеансовые) ключи, в которых один и тот же ключ используется для шифрования и расшифровки некоторых данных, можно использовать функции [**бкриптимпорткэй**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkey) и [**BCryptExportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptexportkey) .</span><span class="sxs-lookup"><span data-stu-id="1b7d1-108">To import or export symmetric (or session) keys in which the same key is used to encrypt and decrypt some data, you can use the [**BCryptImportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkey) and [**BCryptExportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptexportkey) functions.</span></span> <span data-ttu-id="1b7d1-109">Как правило, сначала выполняется экспорт ключа с помощью функции **BCryptExportKey** перед импортом с помощью функции **бкриптимпорткэй** .</span><span class="sxs-lookup"><span data-stu-id="1b7d1-109">Typically, you first export a key by using the **BCryptExportKey** function before importing by using the **BCryptImportKey** function.</span></span> <span data-ttu-id="1b7d1-110">Функции предназначены для включения шифрования экспортированных и импортированных ключей с помощью параметров *хекспорткэй* и *химпорткэй* . Однако реализация этих функций корпорацией Майкрософт не поддерживает шифрование экспортированных и импортированных ключей.</span><span class="sxs-lookup"><span data-stu-id="1b7d1-110">The functions are designed to enable encryption of exported and imported keys by using the *hExportKey* and *hImportKey* parameters; however, the Microsoft implementation of these functions does not support encryption of exported and imported keys.</span></span>

## <a name="asymmetric-keys"></a><span data-ttu-id="1b7d1-111">асимметричные ключи;</span><span class="sxs-lookup"><span data-stu-id="1b7d1-111">Asymmetric keys</span></span>

<span data-ttu-id="1b7d1-112">Чтобы импортировать асимметричные (или [*открытые/закрытые*](/windows/desktop/SecGloss/p-gly)) пары ключей, в которых используется один ключ для шифрования, а другой используется для расшифровки некоторых данных, можно использовать любую из функций [**BCryptImportKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkeypair) или [**нкриптимпорткэй**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptimportkey) .</span><span class="sxs-lookup"><span data-stu-id="1b7d1-112">To import asymmetric (or [*public/private*](/windows/desktop/SecGloss/p-gly)) key pairs in which one key is used to encrypt and the other is used to decrypt some data, you can use either of the [**BCryptImportKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkeypair) or [**NCryptImportKey**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptimportkey) functions.</span></span> <span data-ttu-id="1b7d1-113">Поставщик CNG должен кодировать пару ключей, используя поддерживаемый тип [*BLOB-объекта ключа*](/windows/desktop/SecGloss/k-gly) .</span><span class="sxs-lookup"><span data-stu-id="1b7d1-113">A CNG provider must encode the key pair by using a supported [*key BLOB*](/windows/desktop/SecGloss/k-gly) type.</span></span> <span data-ttu-id="1b7d1-114">[**BCryptExportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptexportkey) можно использовать для создания большого двоичного объекта с закодированным ключом.</span><span class="sxs-lookup"><span data-stu-id="1b7d1-114">[**BCryptExportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptexportkey) can be used to create the encoded key BLOB.</span></span> <span data-ttu-id="1b7d1-115">[Структуры CNG](cng-structures.md) описывают основные типы и структуры больших двоичных объектов, поддерживаемые поставщиком хранилища ключей (Майкрософт).</span><span class="sxs-lookup"><span data-stu-id="1b7d1-115">[CNG Structures](cng-structures.md) describes the key BLOB types and structures that Microsoft Key Storage Provider supports.</span></span>

<span data-ttu-id="1b7d1-116">Чтобы [**BCryptExportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptexportkey) создать сохраненную пару ключей, BLOB-объект входного ключа должен содержать [*закрытый ключ*](/windows/desktop/SecGloss/p-gly).</span><span class="sxs-lookup"><span data-stu-id="1b7d1-116">For [**BCryptExportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptexportkey) to create a persisted key pair, the input key BLOB must contain a [*private key*](/windows/desktop/SecGloss/p-gly).</span></span> <span data-ttu-id="1b7d1-117">[*Открытые ключи*](/windows/desktop/SecGloss/p-gly) не сохраняются.</span><span class="sxs-lookup"><span data-stu-id="1b7d1-117">[*Public keys*](/windows/desktop/SecGloss/p-gly) are not persisted.</span></span>

<span data-ttu-id="1b7d1-118">Имя ключа и политика экспорта не являются частью структуры [*большого двоичного объекта*](/windows/desktop/SecGloss/b-gly) , определенной в [структурах CNG](cng-structures.md).</span><span class="sxs-lookup"><span data-stu-id="1b7d1-118">The key name and export policy are not part of the [*BLOB*](/windows/desktop/SecGloss/b-gly) structure defined in [CNG Structures](cng-structures.md).</span></span> <span data-ttu-id="1b7d1-119">Однако если большой двоичный объект имеет непрозрачный тип большого двоичного объекта (например, образ памяти внутреннего ключа), то BLOB-объект может содержать имя ключа и свойства политики экспорта.</span><span class="sxs-lookup"><span data-stu-id="1b7d1-119">However, if a BLOB is of an opaque BLOB type (such as the memory image of an internal key state), the BLOB might contain the key name and export-policy properties.</span></span>

<span data-ttu-id="1b7d1-120">В следующей процедуре описывается импорт сохраненного закрытого ключа с его свойствами.</span><span class="sxs-lookup"><span data-stu-id="1b7d1-120">The following procedure describes how to import a persisted private key with its properties.</span></span>

<span data-ttu-id="1b7d1-121">**Импорт постоянного ключа**</span><span class="sxs-lookup"><span data-stu-id="1b7d1-121">**To import a persisted key**</span></span>

1.  <span data-ttu-id="1b7d1-122">Создайте постоянный ключ с помощью функции [**нкрипткреатеперсистедкэй**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptcreatepersistedkey) .</span><span class="sxs-lookup"><span data-stu-id="1b7d1-122">Create a persisted key by using the [**NCryptCreatePersistedKey**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptcreatepersistedkey) function.</span></span>
2.  <span data-ttu-id="1b7d1-123">Задайте необходимые свойства для объекта ключа с помощью функции [**нкриптсетпроперти**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptsetproperty) .</span><span class="sxs-lookup"><span data-stu-id="1b7d1-123">Set any desired properties on the key object by using the [**NCryptSetProperty**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptsetproperty) function.</span></span>
3.  <span data-ttu-id="1b7d1-124">Установите BLOB-объект ключа импорта в качестве свойства для ключа с типом большого двоичного объекта в качестве имени свойства.</span><span class="sxs-lookup"><span data-stu-id="1b7d1-124">Set the import key BLOB as a property on the key, with the BLOB type as the property name.</span></span>
4.  <span data-ttu-id="1b7d1-125">Завершите импорт сохраненного ключа с помощью функции [**нкриптфинализекэй**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptfinalizekey) .</span><span class="sxs-lookup"><span data-stu-id="1b7d1-125">Finalize the persisted key import by using the [**NCryptFinalizeKey**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptfinalizekey) function.</span></span>

 

 
