---
description: API CNG реализует расширяемую модель поставщика, которая позволяет загрузить поставщик, указав необходимый криптографический алгоритм, а не конкретный поставщик.
ms.assetid: a88a089b-4afe-4201-96f7-97f19bce18a1
title: Типичное программирование CNG
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1119da63ca1ea0613444b150914c06664f36c121
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103809893"
---
# <a name="typical-cng-programming"></a><span data-ttu-id="66814-103">Типичное программирование CNG</span><span class="sxs-lookup"><span data-stu-id="66814-103">Typical CNG Programming</span></span>

<span data-ttu-id="66814-104">API CNG реализует расширяемую модель поставщика, которая позволяет загрузить поставщик, указав необходимый криптографический алгоритм, а не конкретный поставщик.</span><span class="sxs-lookup"><span data-stu-id="66814-104">The CNG API implements an extensible provider model that lets you load a provider by specifying the required cryptographic algorithm rather than a particular provider.</span></span> <span data-ttu-id="66814-105">Преимущество заключается в том, что поставщик алгоритма можно заменить или обновить, и вам не придется изменять код каким-либо способом для использования нового поставщика.</span><span class="sxs-lookup"><span data-stu-id="66814-105">The advantage is that an algorithm provider can be replaced or upgraded and you will not have to change your code in any way to use the new provider.</span></span> <span data-ttu-id="66814-106">Кроме того, если в будущем некоторый алгоритм определен как небезопасный, более безопасная версия этого алгоритма может быть установлена без влияния на код.</span><span class="sxs-lookup"><span data-stu-id="66814-106">Also, if some algorithm is determined to be unsafe in the future, a more secure version of that algorithm can be installed without affecting your code.</span></span> <span data-ttu-id="66814-107">Для большинства API-интерфейсов CNG требуется поставщик или объект, созданный поставщиком.</span><span class="sxs-lookup"><span data-stu-id="66814-107">Most of the CNG APIs require a provider or an object created by a provider.</span></span>

<span data-ttu-id="66814-108">Ниже приведены типичные действия, связанные с использованием API CNG для криптографических операций шифрования.</span><span class="sxs-lookup"><span data-stu-id="66814-108">The typical steps involved in using the CNG API for cryptographic primitive operations are as follows:</span></span>

1.  <span data-ttu-id="66814-109">Открытие поставщика алгоритма</span><span class="sxs-lookup"><span data-stu-id="66814-109">Opening the Algorithm Provider</span></span>
2.  <span data-ttu-id="66814-110">Получение или установка свойств алгоритма</span><span class="sxs-lookup"><span data-stu-id="66814-110">Getting or Setting Algorithm Properties</span></span>
3.  <span data-ttu-id="66814-111">Создание или импорт ключа</span><span class="sxs-lookup"><span data-stu-id="66814-111">Creating or Importing a Key</span></span>
4.  <span data-ttu-id="66814-112">Выполнение криптографических операций</span><span class="sxs-lookup"><span data-stu-id="66814-112">Performing Cryptographic Operations</span></span>
5.  <span data-ttu-id="66814-113">Закрытие поставщика алгоритма</span><span class="sxs-lookup"><span data-stu-id="66814-113">Closing the Algorithm Provider</span></span>

<span data-ttu-id="66814-114">Дополнительные сведения см. в разделе примеры программирования.</span><span class="sxs-lookup"><span data-stu-id="66814-114">For more information, see Programming Examples.</span></span>

## <a name="opening-the-algorithm-provider"></a><span data-ttu-id="66814-115">Открытие поставщика алгоритма</span><span class="sxs-lookup"><span data-stu-id="66814-115">Opening the Algorithm Provider</span></span>

<span data-ttu-id="66814-116">Функция [**BCryptOpenAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptopenalgorithmprovider) предоставляет обработчик поставщика алгоритмов, который используется в последующих API-интерфейсах CNG, таких как [**BCryptCreateHash**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptcreatehash) или [**бкриптженератекэйпаир**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair).</span><span class="sxs-lookup"><span data-stu-id="66814-116">The [**BCryptOpenAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptopenalgorithmprovider) function provides you with an algorithm provider handle that is used in subsequent CNG APIs, such as [**BCryptCreateHash**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptcreatehash) or [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair).</span></span>

## <a name="getting-or-setting-algorithm-properties"></a><span data-ttu-id="66814-117">Получение или установка свойств алгоритма</span><span class="sxs-lookup"><span data-stu-id="66814-117">Getting or Setting Algorithm Properties</span></span>

<span data-ttu-id="66814-118">Для получения сведений о реализации алгоритма, например размера ключа или текущего режима работы, можно использовать маркер поставщика алгоритма.</span><span class="sxs-lookup"><span data-stu-id="66814-118">You can use the algorithm provider handle to get implementation details for the algorithm, such as the key size or the current mode of operation.</span></span> <span data-ttu-id="66814-119">Для получения конкретных свойств используется функция [**BCryptGetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgetproperty) .</span><span class="sxs-lookup"><span data-stu-id="66814-119">You use the [**BCryptGetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgetproperty) function to obtain specific properties.</span></span>

<span data-ttu-id="66814-120">Также можно изменить свойства алгоритма.</span><span class="sxs-lookup"><span data-stu-id="66814-120">You can also modify the properties of the algorithm.</span></span> <span data-ttu-id="66814-121">Например, если вы хотите использовать цепочку блочных шифров в стандарте AES, задайте для **свойства \_ \_ режим цепочки BCRYPT** алгоритма AES значение **BCrypt \_ цепочки \_ в \_ ECB**; свойство назначается всем ключам AES, созданным с помощью этого обработчика алгоритма, без необходимости настройки каждого ключа AES.</span><span class="sxs-lookup"><span data-stu-id="66814-121">For example, If you want to use ECB block cipher chaining with AES, you set the **BCRYPT\_CHAINING\_MODE** property of an AES algorithm to **BCRYPT\_CHAIN\_MODE\_ECB**; the property is assigned to all AES keys created using this algorithm handle, without the need to configure each and every AES key.</span></span> <span data-ttu-id="66814-122">Для изменения этих свойств используется функция [**бкриптсетпроперти**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptsetproperty) .</span><span class="sxs-lookup"><span data-stu-id="66814-122">You use the [**BCryptSetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptsetproperty) function to modify these properties.</span></span>

## <a name="creating-or-importing-a-key"></a><span data-ttu-id="66814-123">Создание или импорт ключа</span><span class="sxs-lookup"><span data-stu-id="66814-123">Creating or Importing a Key</span></span>

<span data-ttu-id="66814-124">В зависимости от типа используемого алгоритма может потребоваться создать или загрузить ключ.</span><span class="sxs-lookup"><span data-stu-id="66814-124">Depending on the type of algorithm you use, you may need to create or load a key.</span></span> <span data-ttu-id="66814-125">Например, функция [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) принимает маркер ключа для первого параметра.</span><span class="sxs-lookup"><span data-stu-id="66814-125">For example, the [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) function takes a key handle for the first parameter.</span></span> <span data-ttu-id="66814-126">Если требуется, чтобы функция зашифрует данные с помощью алгоритма симметричного шифрования, такого как AES, сначала необходимо получить ключ.</span><span class="sxs-lookup"><span data-stu-id="66814-126">If you want that function to encrypt data with a symmetric encryption algorithm such as AES, you must first obtain a key.</span></span> <span data-ttu-id="66814-127">Получение ключа зависит от типа используемого алгоритма и источника ключа.</span><span class="sxs-lookup"><span data-stu-id="66814-127">How you obtain the key depends on the type of algorithm being used and the source of the key.</span></span>

<span data-ttu-id="66814-128">Вы можете создать временные ключи с помощью функций [**BCryptGenerateSymmetricKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratesymmetrickey) и [**бкриптженератекэйпаир**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair) .</span><span class="sxs-lookup"><span data-stu-id="66814-128">You can create ephemeral keys with the [**BCryptGenerateSymmetricKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratesymmetrickey) and [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair) functions.</span></span> <span data-ttu-id="66814-129">Вы также можете импортировать временные ключи из большого двоичного объекта памяти с помощью функций [**бкриптимпорткэй**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkey) и [**BCryptImportKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkeypair) .</span><span class="sxs-lookup"><span data-stu-id="66814-129">You can also import ephemeral keys from a memory BLOB with the [**BCryptImportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkey) and [**BCryptImportKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkeypair) functions.</span></span>

<span data-ttu-id="66814-130">Для сохраненных ключей используются функции хранилища ключей, чтобы загрузить поставщик хранилища ключей, а затем создать или загрузить ключи.</span><span class="sxs-lookup"><span data-stu-id="66814-130">For persisted keys, you use the key storage functions to load a key storage provider, and then create or load the keys.</span></span> <span data-ttu-id="66814-131">Эти функции также можно использовать для создания или загрузки временных ключей путем передачи **значения NULL** для любых имен контейнеров.</span><span class="sxs-lookup"><span data-stu-id="66814-131">You can also use these functions to create or load ephemeral keys by passing **NULL** for any container names.</span></span> <span data-ttu-id="66814-132">Дополнительные сведения о функциях хранилища ключей см. в разделе [функции хранилища ключей CNG](cng-key-storage-functions.md).</span><span class="sxs-lookup"><span data-stu-id="66814-132">For more information about the key storage functions, see [CNG Key Storage Functions](cng-key-storage-functions.md).</span></span>

## <a name="performing-cryptographic-operations"></a><span data-ttu-id="66814-133">Выполнение криптографических операций</span><span class="sxs-lookup"><span data-stu-id="66814-133">Performing Cryptographic Operations</span></span>

<span data-ttu-id="66814-134">Теперь все готово для выполнения криптографической операции, например для шифрования или расшифровки данных с помощью функций [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) или [**BCryptDecrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptdecrypt) соответственно.</span><span class="sxs-lookup"><span data-stu-id="66814-134">You are now ready to perform the cryptographic operation, such as encrypting or decrypting data by using the [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) or [**BCryptDecrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptdecrypt) functions, respectively.</span></span>

## <a name="closing-the-algorithm-provider"></a><span data-ttu-id="66814-135">Закрытие поставщика алгоритма</span><span class="sxs-lookup"><span data-stu-id="66814-135">Closing the Algorithm Provider</span></span>

<span data-ttu-id="66814-136">Если поставщик больше не нужен, необходимо передать этот обработчик функции [**бкриптклосеалгорисмпровидер**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptclosealgorithmprovider) , чтобы закрыть поставщик.</span><span class="sxs-lookup"><span data-stu-id="66814-136">When the provider is no longer needed, you must pass the handle to the [**BCryptCloseAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptclosealgorithmprovider) function to close the provider.</span></span> <span data-ttu-id="66814-137">В результате поставщик освобождает все ресурсы, выделенные для этого экземпляра поставщика алгоритма.</span><span class="sxs-lookup"><span data-stu-id="66814-137">This causes the provider to release any resources that have been allocated for that algorithm provider instance.</span></span> <span data-ttu-id="66814-138">После закрытия обработчика поставщика его нельзя использовать повторно.</span><span class="sxs-lookup"><span data-stu-id="66814-138">After a provider handle is closed, it cannot be reused.</span></span>

<span data-ttu-id="66814-139">Загрузка поставщика может быть достаточно трудоемким процессом.</span><span class="sxs-lookup"><span data-stu-id="66814-139">Loading a provider can be a relatively time-intensive process.</span></span> <span data-ttu-id="66814-140">Поэтому следует кэшировать все дескрипторы поставщика, которые будут ссылаться несколько раз в течение времени существования приложения.</span><span class="sxs-lookup"><span data-stu-id="66814-140">You should therefore cache any provider handles that you will reference multiple times during the lifetime of your application.</span></span>

## <a name="programming-examples"></a><span data-ttu-id="66814-141">Примеры программирования</span><span class="sxs-lookup"><span data-stu-id="66814-141">Programming Examples</span></span>

<span data-ttu-id="66814-142">В следующих примерах описывается выполнение конкретных криптографических операций с помощью CNG.</span><span class="sxs-lookup"><span data-stu-id="66814-142">The following examples describe how to perform specific cryptographic operations using CNG.</span></span>

-   [<span data-ttu-id="66814-143">Создание хэша с помощью CNG</span><span class="sxs-lookup"><span data-stu-id="66814-143">Creating a Hash with CNG</span></span>](creating-a-hash-with-cng.md)
-   [<span data-ttu-id="66814-144">Подписывание данных с помощью CNG</span><span class="sxs-lookup"><span data-stu-id="66814-144">Signing Data with CNG</span></span>](signing-data-with-cng.md)
-   [<span data-ttu-id="66814-145">Шифрование данных с помощью CNG</span><span class="sxs-lookup"><span data-stu-id="66814-145">Encrypting Data with CNG</span></span>](encrypting-data-with-cng.md)

 

 



