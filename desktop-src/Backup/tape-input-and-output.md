---
title: Входные и выходные данные на ленте
description: Существует несколько функций, которые могут использоваться приложениями для выполнения ввода-вывода на ленточном накопителе. Ввод-вывод на магнитную ленту аналогичен вводу-выводу, выполняемому на коммуникационном устройстве.
ms.assetid: 1862c267-0070-4fe8-bb77-40167913978a
keywords:
- Резервная копия входных и выходных данных на ленте
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5946659f1ad0246e37981201e4e08611b45b70b1
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104338492"
---
# <a name="tape-input-and-output"></a><span data-ttu-id="b1449-105">Входные и выходные данные на ленте</span><span class="sxs-lookup"><span data-stu-id="b1449-105">Tape Input and Output</span></span>

<span data-ttu-id="b1449-106">Существует несколько функций, которые могут использоваться приложениями для выполнения ввода-вывода на ленточном накопителе.</span><span class="sxs-lookup"><span data-stu-id="b1449-106">There are several functions that applications can use to perform input and output (I/O) on a tape drive.</span></span> <span data-ttu-id="b1449-107">Ввод-вывод на магнитную ленту аналогичен вводу-выводу, выполняемому на коммуникационном устройстве.</span><span class="sxs-lookup"><span data-stu-id="b1449-107">Tape I/O is similar to I/O performed on a communications device.</span></span>

<span data-ttu-id="b1449-108">При выполнении операций ввода-вывода на магнитной ленте некоторые ленточные накопители хранят сведения о встроенном по ленты в первых нескольких блоках на ленте, обычно используя некоторую часть первых 100 блоков.</span><span class="sxs-lookup"><span data-stu-id="b1449-108">When performing tape I/O, some tape drives store tape firmware information in the first few blocks on a tape, typically using some portion of the first 100 blocks.</span></span> <span data-ttu-id="b1449-109">Приложения не должны использовать эти блоки.</span><span class="sxs-lookup"><span data-stu-id="b1449-109">Applications should not use those blocks.</span></span> <span data-ttu-id="b1449-110">Более подробные сведения об этой теме можно найти у отдельных производителей ленточных накопителей.</span><span class="sxs-lookup"><span data-stu-id="b1449-110">More specific information on this subject is available from individual tape system manufacturers.</span></span> <span data-ttu-id="b1449-111">Как правило, приложение, которое пропускает первые 100 блоков на ленте, не позволяет использовать особенности ленточного накопителя.</span><span class="sxs-lookup"><span data-stu-id="b1449-111">In general, an application that skips the first 100 blocks on a tape will avoid tape drive idiosyncrasies.</span></span>

<span data-ttu-id="b1449-112">Функции [**жеттапепоситион**](/windows/desktop/api/Winbase/nf-winbase-gettapeposition) и [**сеттапепоситион**](/windows/desktop/api/Winbase/nf-winbase-settapeposition) извлекают и перемещают текущую положение ленты.</span><span class="sxs-lookup"><span data-stu-id="b1449-112">The [**GetTapePosition**](/windows/desktop/api/Winbase/nf-winbase-gettapeposition) and [**SetTapePosition**](/windows/desktop/api/Winbase/nf-winbase-settapeposition) functions retrieve and move the current tape position.</span></span> <span data-ttu-id="b1449-113">Функция [**вритетапемарк**](/windows/desktop/api/Winbase/nf-winbase-writetapemark) записывает заданное число сетмаркс, филемаркс, Short филемаркс и long филемаркс.</span><span class="sxs-lookup"><span data-stu-id="b1449-113">The [**WriteTapemark**](/windows/desktop/api/Winbase/nf-winbase-writetapemark) function writes a specified number of setmarks, filemarks, short filemarks, and long filemarks.</span></span> <span data-ttu-id="b1449-114">Функция [**ерасетапе**](/windows/desktop/api/Winbase/nf-winbase-erasetape) стирает всю ленту или ее часть.</span><span class="sxs-lookup"><span data-stu-id="b1449-114">The [**EraseTape**](/windows/desktop/api/Winbase/nf-winbase-erasetape) function erases all or part of a tape.</span></span>

<span data-ttu-id="b1449-115">Функции [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) и [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) считывают и записывают файловые данные с ленты и на ленту.</span><span class="sxs-lookup"><span data-stu-id="b1449-115">The [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) and [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) functions read and write file data from and to the tape.</span></span> <span data-ttu-id="b1449-116">Данные считываются и записываются на полных блоках.</span><span class="sxs-lookup"><span data-stu-id="b1449-116">The data is read and written in complete blocks.</span></span> <span data-ttu-id="b1449-117">Если размер блока ленты составляет 512 байт, все операции чтения и записи должны использовать буферы, которые являются простым целым числом, кратным этому размеру блока: 512, 1024, 1536, 2048 и т. д.</span><span class="sxs-lookup"><span data-stu-id="b1449-117">If the tape's block size is 512 bytes, all read and write operations must use buffers that are simple integer multiples of that block size: 512, 1024, 1536, 2048, and so on.</span></span> <span data-ttu-id="b1449-118">Большинство, если не все, диски разрешают операцию записи только после перезапуска ленты или после того, как операция чтения выдаст сообщение об ошибке конца данных.</span><span class="sxs-lookup"><span data-stu-id="b1449-118">Most, if not all, drives only allow a write operation after the tape is rewound or after a read operation produces an end-of-data error message.</span></span>

<span data-ttu-id="b1449-119">Для чтения или записи данных файлов на ленту или из нее в режиме блокировки с переменной длиной выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="b1449-119">To read or write file data to or from a tape in variable-length block mode, perform the following steps:</span></span>

1.  <span data-ttu-id="b1449-120">Определите, поддерживает ли ленточный накопитель блочный режим переменной длины, вызвав функцию [**жеттапепараметерс**](/windows/desktop/api/Winbase/nf-winbase-gettapeparameters) и проверив \_ бит блокировки накопителя на магнитной ленте \_ \_ элемента **феатуреслов** в структуре возвращаемых [**\_ \_ \_ параметров накопителя ленты**](/windows/desktop/api/Winnt/ns-winnt-tape_get_drive_parameters) .</span><span class="sxs-lookup"><span data-stu-id="b1449-120">Determine whether the tape drive supports variable-length block mode by calling the [**GetTapeParameters**](/windows/desktop/api/Winbase/nf-winbase-gettapeparameters) function and checking the TAPE\_DRIVE\_VARIABLE\_BLOCK bit of the **FeaturesLow** member of the returned [**TAPE\_GET\_DRIVE\_PARAMETERS**](/windows/desktop/api/Winnt/ns-winnt-tape_get_drive_parameters) structure.</span></span>
2.  <span data-ttu-id="b1449-121">Укажите режим размера блока переменной, вызвав функцию [**сеттапепараметерс**](/windows/desktop/api/Winbase/nf-winbase-settapeparameters) , установив **для элемента размерности в** структуре [**\_ \_ \_ параметров носителя набора лент**](/windows/desktop/api/Winnt/ns-winnt-tape_set_media_parameters) нулевое значение.</span><span class="sxs-lookup"><span data-stu-id="b1449-121">Specify the variable block size mode by calling the [**SetTapeParameters**](/windows/desktop/api/Winbase/nf-winbase-settapeparameters) function, setting the **BlockSize** member of the [**TAPE\_SET\_MEDIA\_PARAMETERS**](/windows/desktop/api/Winnt/ns-winnt-tape_set_media_parameters) structure to zero.</span></span> <span data-ttu-id="b1449-122">Затем используйте [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) или [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) для чтения или записи данных файла.</span><span class="sxs-lookup"><span data-stu-id="b1449-122">Then, use [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) or [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) to read or write the file data.</span></span>

<span data-ttu-id="b1449-123">Если в [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) обнаруживается метка файла, то считываются данные до метка файла и функция завершается ошибкой.</span><span class="sxs-lookup"><span data-stu-id="b1449-123">If [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) encounters a filemark, the data up to the filemark is read and the function fails.</span></span> <span data-ttu-id="b1449-124">(Функция [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) возвращает код ошибки, указывающий тип обнаруженной метка файла.) Операционная система перемещает ленту после метка файла, и приложение может снова вызвать программу **ReadFile** , чтобы продолжить чтение.</span><span class="sxs-lookup"><span data-stu-id="b1449-124">(The [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function returns an error code indicating the type of filemark that was encountered.) The operating system moves the tape past the filemark, and an application can call **ReadFile** again to continue reading.</span></span>

<span data-ttu-id="b1449-125">[**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) и [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) считывают и записывают только поток данных.</span><span class="sxs-lookup"><span data-stu-id="b1449-125">[**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) and [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) read and write only the data stream.</span></span> <span data-ttu-id="b1449-126">Функции [**баккупреад**](/windows/desktop/api/Winbase/nf-winbase-backupread) и [**баккупврите**](/windows/desktop/api/Winbase/nf-winbase-backupwrite) считывают и записывают все потоки, связанные с файлом.</span><span class="sxs-lookup"><span data-stu-id="b1449-126">The [**BackupRead**](/windows/desktop/api/Winbase/nf-winbase-backupread) and [**BackupWrite**](/windows/desktop/api/Winbase/nf-winbase-backupwrite) functions read and write all the streams associated with a file.</span></span> <span data-ttu-id="b1449-127">К ним относятся данные, расширенные атрибуты, безопасность и альтернативные потоки данных.</span><span class="sxs-lookup"><span data-stu-id="b1449-127">These include data, extended attributes, security, and alternative data streams.</span></span> <span data-ttu-id="b1449-128">Безопасность и альтернативные потоки данных относятся только к разделу файловой системы NTFS.</span><span class="sxs-lookup"><span data-stu-id="b1449-128">The security and alternate data streams are relevant only on the NTFS file system partition.</span></span>

<span data-ttu-id="b1449-129">Функция [**баккупсик**](/windows/desktop/api/Winbase/nf-winbase-backupseek) ищет файл вперед в файле, изначально доступном с помощью [**баккупреад**](/windows/desktop/api/Winbase/nf-winbase-backupread) или [**баккупврите**](/windows/desktop/api/Winbase/nf-winbase-backupwrite).</span><span class="sxs-lookup"><span data-stu-id="b1449-129">The [**BackupSeek**](/windows/desktop/api/Winbase/nf-winbase-backupseek) function seeks forward in a file initially accessed by [**BackupRead**](/windows/desktop/api/Winbase/nf-winbase-backupread) or [**BackupWrite**](/windows/desktop/api/Winbase/nf-winbase-backupwrite).</span></span> <span data-ttu-id="b1449-130">Эта функция позволяет приложению пропустить сведения, вызывающие ошибки доступа.</span><span class="sxs-lookup"><span data-stu-id="b1449-130">This function enables an application to skip information that causes access errors.</span></span>

<span data-ttu-id="b1449-131">Если приложению требуется доступ только к файловым данным, следует использовать [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) и [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile).</span><span class="sxs-lookup"><span data-stu-id="b1449-131">If an application needs to access only the file data, it should use [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) and [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile).</span></span> <span data-ttu-id="b1449-132">Эти функции также могут считывать альтернативные потоки данных, если потоки были созданы с помощью функции [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) .</span><span class="sxs-lookup"><span data-stu-id="b1449-132">These functions can also read alternative data streams if the streams were created by using the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function.</span></span>

<span data-ttu-id="b1449-133">Приложение для резервного копирования на магнитной ленте должно использовать [**баккупреад**](/windows/desktop/api/Winbase/nf-winbase-backupread) и [**баккупврите**](/windows/desktop/api/Winbase/nf-winbase-backupwrite) для копирования всех данных, относящихся к файлу.</span><span class="sxs-lookup"><span data-stu-id="b1449-133">A tape-backup application must use [**BackupRead**](/windows/desktop/api/Winbase/nf-winbase-backupread) and [**BackupWrite**](/windows/desktop/api/Winbase/nf-winbase-backupwrite) to copy all information pertaining to a file.</span></span> <span data-ttu-id="b1449-134">Однако эти функции не считывают и не записывают такие характеристики файлов, как атрибуты, время создания файла и т. д.</span><span class="sxs-lookup"><span data-stu-id="b1449-134">However, these functions do not read or write file characteristics such as attributes, file creation time, and so on.</span></span> <span data-ttu-id="b1449-135">Приложения должны использовать входные и выходные функции, такие как [**GetFileAttributes**](/windows/desktop/api/fileapi/nf-fileapi-getfileattributesa) и [**сетфилеаттрибутес**](/windows/desktop/api/fileapi/nf-fileapi-setfileattributesa), для извлечения и установки этих значений.</span><span class="sxs-lookup"><span data-stu-id="b1449-135">Applications must use the file input and output functions, such as [**GetFileAttributes**](/windows/desktop/api/fileapi/nf-fileapi-getfileattributesa) and [**SetFileAttributes**](/windows/desktop/api/fileapi/nf-fileapi-setfileattributesa), to retrieve and set those values.</span></span>

 

 