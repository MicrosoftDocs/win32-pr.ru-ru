---
description: 'VSS допускает существование нескольких теневых копий одновременно, но позволяет выполнять только один процесс создания теневых копий между вызовом Ивссбаккупкомпонентс:: Стартснапшотсет и возвратом из вызова Ивссбаккупкомпонентс::D Оснапшотсет.'
ms.assetid: 26657fc2-180f-4ebb-820c-2159e7fe7584
title: Обработка ошибок в поставщиках теневого копирования
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f5f040526f63a0fe57fc5a49ac903e8b60b76646
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105651144"
---
# <a name="error-handling-in-shadow-copy-providers"></a><span data-ttu-id="825a7-103">Обработка ошибок в поставщиках теневого копирования</span><span class="sxs-lookup"><span data-stu-id="825a7-103">Error Handling in Shadow Copy Providers</span></span>

<span data-ttu-id="825a7-104">VSS допускает существование нескольких теневых копий одновременно, но позволяет выполнять только один процесс создания теневых копий между вызовом [**ивссбаккупкомпонентс:: стартснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) и возвратом из вызова [**Ивссбаккупкомпонентс::D оснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="825a7-104">VSS allows many shadow copies to exist at once, but it only allows one shadow copy set creation to be in-progress between the call to [**IVssBackupComponents::StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) and the return from the call to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span>

## <a name="no-partial-commit"></a><span data-ttu-id="825a7-105">Без частичной фиксации</span><span class="sxs-lookup"><span data-stu-id="825a7-105">No Partial Commit</span></span>

<span data-ttu-id="825a7-106">Если какой-либо поставщик не может создать теневую копию на любом томе или LUN в наборе теневых копий, создание всего набора теневых копий завершается сбоем.</span><span class="sxs-lookup"><span data-stu-id="825a7-106">If any provider fails a shadow copy on any volume or LUN in the shadow copy set, then the creation of the entire shadow copy set fails.</span></span> <span data-ttu-id="825a7-107">Это сделано намеренно.</span><span class="sxs-lookup"><span data-stu-id="825a7-107">This is by design.</span></span> <span data-ttu-id="825a7-108">Такая схема упрощает проблемы поведения, связанные с семантикой частичного сбоя, и поддерживает согласованную точку во времени для всех теневых копий в наборе.</span><span class="sxs-lookup"><span data-stu-id="825a7-108">This design simplifies the behavioral issues associated with partial failure semantics and maintains a consistent point-in-time across all shadow copies in the set.</span></span>

## <a name="reporting-fault-conditions"></a><span data-ttu-id="825a7-109">Отчеты об условиях сбоя</span><span class="sxs-lookup"><span data-stu-id="825a7-109">Reporting Fault Conditions</span></span>

<span data-ttu-id="825a7-110">При возникновении ошибки или состояния сбоя поставщика поставщик должен зарегистрировать ошибку в журнале событий приложений.</span><span class="sxs-lookup"><span data-stu-id="825a7-110">If a provider error or fault condition occurs, the provider must log an error to the Application event log.</span></span> <span data-ttu-id="825a7-111">К ним относятся, помимо прочего, любые специфические для поставщика ошибки при создании или импорте набора теневых копий или при сбое выделения ресурсов для теневой копии при записи после создания.</span><span class="sxs-lookup"><span data-stu-id="825a7-111">This includes, but is not limited to, any provider-specific errors when creating or importing a Shadow Copy Set, or resource allocation failure for copy-on-write shadow copy after creation.</span></span> <span data-ttu-id="825a7-112">Это ведение журнала не должно выполняться в течение времени, когда тома в наборе теневых копий находятся в замороженном состоянии.</span><span class="sxs-lookup"><span data-stu-id="825a7-112">This logging must not take place during the time the volumes in the shadow copy set are in a frozen state.</span></span>

## <a name="valid-provider-return-values"></a><span data-ttu-id="825a7-113">Допустимые возвращаемые значения поставщика</span><span class="sxs-lookup"><span data-stu-id="825a7-113">Valid Provider Return Values</span></span>

<span data-ttu-id="825a7-114">В следующей таблице перечислены допустимые коды возврата для методов поставщика и их значений.</span><span class="sxs-lookup"><span data-stu-id="825a7-114">The following table lists the valid return codes for provider methods and their meanings.</span></span>



| <span data-ttu-id="825a7-115">Значение</span><span class="sxs-lookup"><span data-stu-id="825a7-115">Value</span></span>                                                                                                                                                                              | <span data-ttu-id="825a7-116">Описание</span><span class="sxs-lookup"><span data-stu-id="825a7-116">Description</span></span>                                                                                                                                                                                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="825a7-117"><span id="S_OK"></span><span id="s_ok"></span>\_ОК</span><span class="sxs-lookup"><span data-stu-id="825a7-117"><span id="S_OK"></span><span id="s_ok"></span>S\_OK</span></span><br/>                                                                                                                     | <span data-ttu-id="825a7-118">Метод успешно выполнен.</span><span class="sxs-lookup"><span data-stu-id="825a7-118">The method was successful.</span></span><br/>                                                                                                                                                                                                                  |
| <span data-ttu-id="825a7-119"><span id="E_OUTOFMEMORY"></span><span id="e_outofmemory"></span>E \_ OUTOFMEMORY</span><span class="sxs-lookup"><span data-stu-id="825a7-119"><span id="E_OUTOFMEMORY"></span><span id="e_outofmemory"></span>E\_OUTOFMEMORY</span></span><br/>                                                                                          | <span data-ttu-id="825a7-120">Поставщик не хватает памяти или других системных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="825a7-120">The provider is out of memory or other system resources.</span></span><br/>                                                                                                                                                                                    |
| <span data-ttu-id="825a7-121"><span id="E_INVALIDARG"></span><span id="e_invalidarg"></span>E \_ INVALIDARG</span><span class="sxs-lookup"><span data-stu-id="825a7-121"><span id="E_INVALIDARG"></span><span id="e_invalidarg"></span>E\_INVALIDARG</span></span><br/>                                                                                             | <span data-ttu-id="825a7-122">Одно из значений параметра недопустимо.</span><span class="sxs-lookup"><span data-stu-id="825a7-122">One of the parameter values is not valid.</span></span><br/>                                                                                                                                                                                                   |
| <span data-ttu-id="825a7-123"><span id="E_ACCESSDENIED"></span><span id="e_accessdenied"></span>E \_ ACCESSDENIED</span><span class="sxs-lookup"><span data-stu-id="825a7-123"><span id="E_ACCESSDENIED"></span><span id="e_accessdenied"></span>E\_ACCESSDENIED</span></span><br/>                                                                                       | <span data-ttu-id="825a7-124">Непривилегированный клиент пытался вызвать поставщик.</span><span class="sxs-lookup"><span data-stu-id="825a7-124">A non-privileged client has tried to call into the provider.</span></span><br/>                                                                                                                                                                                |
| <span data-ttu-id="825a7-125"><span id="VSS_E_BAD_STATE"></span><span id="vss_e_bad_state"></span>\_ \_ неправильное \_ состояние VSS</span><span class="sxs-lookup"><span data-stu-id="825a7-125"><span id="VSS_E_BAD_STATE"></span><span id="vss_e_bad_state"></span>VSS\_E\_BAD\_STATE</span></span><br/>                                                                                  | <span data-ttu-id="825a7-126">Либо поставщик не поддерживает запрошенную операцию, либо операция не может быть выполнена над объектом, так как объект находится в неправильном состоянии.</span><span class="sxs-lookup"><span data-stu-id="825a7-126">Either no provider supports the requested operation, or the operation cannot be performed on the object because the object is not in the correct state.</span></span><br/>                                                                                     |
| <span data-ttu-id="825a7-127"><span id="VSS_E_OBJECT_NOT_FOUND"></span><span id="vss_e_object_not_found"></span>\_объект VSS \_ E \_ не \_ найден</span><span class="sxs-lookup"><span data-stu-id="825a7-127"><span id="VSS_E_OBJECT_NOT_FOUND"></span><span id="vss_e_object_not_found"></span>VSS\_E\_OBJECT\_NOT\_FOUND</span></span><br/>                                                            | <span data-ttu-id="825a7-128">Параметр ссылается на объект, который не был найден (например, идентификатор теневой копии, идентификатор набора теневых копий или том).</span><span class="sxs-lookup"><span data-stu-id="825a7-128">A parameter refers to an object that was not found (such as a shadow copy ID, shadow copy set ID, or volume.)</span></span><br/>                                                                                                                               |
| <span data-ttu-id="825a7-129"><span id="VSS_E_INSUFFICIENT_STORAGE"></span><span id="vss_e_insufficient_storage"></span>\_ \_ недостаточно места в \_ хранилище VSS</span><span class="sxs-lookup"><span data-stu-id="825a7-129"><span id="VSS_E_INSUFFICIENT_STORAGE"></span><span id="vss_e_insufficient_storage"></span>VSS\_E\_INSUFFICIENT\_STORAGE</span></span><br/>                                                 | <span data-ttu-id="825a7-130">Поставщик не может выполнить операцию из-за нехватки места на диске.</span><span class="sxs-lookup"><span data-stu-id="825a7-130">The provider cannot perform the operation because there is not enough disk space.</span></span><br/>                                                                                                                                                           |
| <span data-ttu-id="825a7-131"><span id="VSS_E_VOLUME_NOT_SUPPORTED"></span><span id="vss_e_volume_not_supported"></span>том с VSS \_ E \_ \_ не \_ поддерживается</span><span class="sxs-lookup"><span data-stu-id="825a7-131"><span id="VSS_E_VOLUME_NOT_SUPPORTED"></span><span id="vss_e_volume_not_supported"></span>VSS\_E\_VOLUME\_NOT\_SUPPORTED</span></span><br/>                                                | <span data-ttu-id="825a7-132">На этом компьютере нет поставщика, поддерживающего запрошенную операцию на томе.</span><span class="sxs-lookup"><span data-stu-id="825a7-132">No provider on this computer supports the requested operation on the volume.</span></span><br/>                                                                                                                                                                |
| <span data-ttu-id="825a7-133"><span id="VSS_E_VOLUME_NOT_SUPPORTED_BY_PROVIDER"></span><span id="vss_e_volume_not_supported_by_provider"></span>\_тома VSS \_ E \_ не \_ поддерживаются \_ \_ поставщиком</span><span class="sxs-lookup"><span data-stu-id="825a7-133"><span id="VSS_E_VOLUME_NOT_SUPPORTED_BY_PROVIDER"></span><span id="vss_e_volume_not_supported_by_provider"></span>VSS\_E\_VOLUME\_NOT\_SUPPORTED\_BY\_PROVIDER</span></span><br/>          | <span data-ttu-id="825a7-134">Поставщик не поддерживает том.</span><span class="sxs-lookup"><span data-stu-id="825a7-134">The provider does not support the volume.</span></span><br/>                                                                                                                                                                                                   |
| <span data-ttu-id="825a7-135"><span id="VSS_E_MAXIMUM_NUMBER_OF_SNAPSHOTS_REACHED"></span><span id="vss_e_maximum_number_of_snapshots_reached"></span>\_ \_ \_ достигнуто максимальное число \_ \_ моментальных снимков \_ VSS E</span><span class="sxs-lookup"><span data-stu-id="825a7-135"><span id="VSS_E_MAXIMUM_NUMBER_OF_SNAPSHOTS_REACHED"></span><span id="vss_e_maximum_number_of_snapshots_reached"></span>VSS\_E\_MAXIMUM\_NUMBER\_OF\_SNAPSHOTS\_REACHED</span></span><br/> | <span data-ttu-id="825a7-136">Поставщик достиг максимального количества теневых копий, которое он может поддерживать.</span><span class="sxs-lookup"><span data-stu-id="825a7-136">The provider has reached the maximum number of shadow copies that it can support.</span></span><br/>                                                                                                                                                           |
| <span data-ttu-id="825a7-137"><span id="VSS_E_PROVIDER_VETO"></span><span id="vss_e_provider_veto"></span>\_ \_ запрет поставщика VSS \_ E</span><span class="sxs-lookup"><span data-stu-id="825a7-137"><span id="VSS_E_PROVIDER_VETO"></span><span id="vss_e_provider_veto"></span>VSS\_E\_PROVIDER\_VETO</span></span><br/>                                                                      | <span data-ttu-id="825a7-138">Поставщик обнаружил внутреннюю ошибку во время выполнения, которая не соответствует другому возвращаемому значению.</span><span class="sxs-lookup"><span data-stu-id="825a7-138">The provider has encountered an internal run-time error that does not map to another return value.</span></span> <span data-ttu-id="825a7-139">Поставщик также должен записать в журнал событий приложений событие, предоставляющее пользователю сведения о том, как устранить эту проблему.</span><span class="sxs-lookup"><span data-stu-id="825a7-139">The provider must also write an event into the Application event log providing the user with information on how to resolve this problem.</span></span><br/> |
| <span data-ttu-id="825a7-140"><span id="VSS_E_CANNOT_REVERT_DISKID"></span><span id="vss_e_cannot_revert_diskid"></span>VSS \_ E \_ не может \_ вернуть \_ DISKID</span><span class="sxs-lookup"><span data-stu-id="825a7-140"><span id="VSS_E_CANNOT_REVERT_DISKID"></span><span id="vss_e_cannot_revert_diskid"></span>VSS\_E\_CANNOT\_REVERT\_DISKID</span></span><br/>                                                | <span data-ttu-id="825a7-141">Не удалось установить запрошенное значение для подписи MBR или идентификатора GPT для одного или нескольких дисков.</span><span class="sxs-lookup"><span data-stu-id="825a7-141">The MBR signature or GPT ID for one or more disks could not be set to the requested value.</span></span> <span data-ttu-id="825a7-142">Дополнительные сведения см. в журнале событий приложений.</span><span class="sxs-lookup"><span data-stu-id="825a7-142">Check the Application event log for more information.</span></span><br/>                                                                                            |



 

<span data-ttu-id="825a7-143">Поставщик не должен пытаться вернуть другие коды ошибок.</span><span class="sxs-lookup"><span data-stu-id="825a7-143">The provider should not attempt to return any other error codes.</span></span>

<span data-ttu-id="825a7-144">Если поставщик возвращает код ошибки, который не является ожидаемым (например, **" \_ false**", " **e \_ Fail** **", "e expected \_**" или " **\_ прервано**"), VSS записывает событие в журнал событий, в котором упоминается поставщик и метод со сбоем, а затем преобразует ошибку в **VSS \_ E \_ непредвиденную \_ \_ ошибку поставщика** перед возвратом в инициатор запроса.</span><span class="sxs-lookup"><span data-stu-id="825a7-144">If the provider returns an error code that is not expected (for example **S\_FALSE**, **E\_FAIL**, **E\_UNEXPECTED**, or **E\_ABORT**), VSS writes an event into the event log mentioning the provider and failed method and translates the error to **VSS\_E\_UNEXPECTED\_PROVIDER\_ERROR** before returning to the requester.</span></span> <span data-ttu-id="825a7-145">Это не делается для каких-либо операций возврата из [**ивсспровидеркреатеснапшотсет:: абортснапшотс**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-abortsnapshots) или [**ивсспровидернотификатионс:: unload**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidernotifications-onunload).</span><span class="sxs-lookup"><span data-stu-id="825a7-145">This is not done for any returns from [**IVssProviderCreateSnapshotSet::AbortSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-abortsnapshots) or [**IVssProviderNotifications::OnUnload**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidernotifications-onunload).</span></span>

 

 




