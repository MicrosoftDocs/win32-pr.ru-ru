---
description: 'На этом этапе резервного копирования инициализируются модуль записи и инициатор запроса, заполняются их внутренние структуры данных, задаются резервные копии и устанавливаются данные модуля записи или инициатора запроса через требуемый вызов Ивссбаккупкомпонентс:: Гасервритерметадата. Дополнительные сведения см. в разделе Общие сведения об обработке резервной копии в VSS.'
ms.assetid: 1fc46062-c4a0-4aa2-ae05-3d7cded18584
title: Общие сведения об инициализации резервного копирования
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 53fb97b43cf19ca60e3e4601899700e35bdad3aa
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692899"
---
# <a name="overview-of-backup-initialization"></a><span data-ttu-id="1183b-104">Общие сведения об инициализации резервного копирования</span><span class="sxs-lookup"><span data-stu-id="1183b-104">Overview of Backup Initialization</span></span>

<span data-ttu-id="1183b-105">На этом этапе резервного копирования инициализируются модуль записи и инициатор запроса, заполняются их внутренние структуры данных, задаются резервные копии и устанавливаются данные модуля записи или инициатора запроса через требуемый вызов [**ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span><span class="sxs-lookup"><span data-stu-id="1183b-105">This stage of the backup initializes both the writer and the requester, filling in their internal data structures, specifying the backup and establishes writer/requester communication through the required call to [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span> <span data-ttu-id="1183b-106">Дополнительные сведения см. в разделе Общие сведения об [обработке резервной копии в VSS](overview-of-processing-a-backup-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="1183b-106">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md).</span></span>

<span data-ttu-id="1183b-107">В следующей таблице показана последовательность действий и событий, необходимых для инициализации резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="1183b-107">The following table shows the sequence of actions and events that are required for backup initialization.</span></span>



| <span data-ttu-id="1183b-108">Действие запросившего</span><span class="sxs-lookup"><span data-stu-id="1183b-108">Requester action</span></span>                                                                                                                                                                                                                                                                                                                            | <span data-ttu-id="1183b-109">Событие</span><span class="sxs-lookup"><span data-stu-id="1183b-109">Event</span></span>                                                     | <span data-ttu-id="1183b-110">Действие записи</span><span class="sxs-lookup"><span data-stu-id="1183b-110">Writer action</span></span>                                                                                                                                                                                                                                              |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="1183b-111">Создает интерфейс [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) и инициализирует его для управления резервной копией (см. раздел [**креатевссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents), [**ивссбаккупкомпонентс:: инитиализефорбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup)) и при необходимости включает или отключает модули записи в системе.</span><span class="sxs-lookup"><span data-stu-id="1183b-111">Creates an [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface and initializes it to manage a backup (see [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents), [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup)) and optionally enable or disable writers on the system.</span></span> | <span data-ttu-id="1183b-112">Нет</span><span class="sxs-lookup"><span data-stu-id="1183b-112">None</span></span>                                                      | <span data-ttu-id="1183b-113">Нет</span><span class="sxs-lookup"><span data-stu-id="1183b-113">None</span></span>                                                                                                                                                                                                                                                       |
| <span data-ttu-id="1183b-114">При необходимости задайте контекст для операций теневого копирования и при необходимости запросите систему о поставщиках и теневых копиях, которые он поддерживает (см. [**ивссбаккупкомпонентс:: SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext), [**Ивссбаккупкомпонентс:: Query**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-query)).</span><span class="sxs-lookup"><span data-stu-id="1183b-114">Optionally set the context for shadow copy operations and optionally query the system about the providers and shadow copies it supports (see [**IVssBackupComponents::SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext), [**IVssBackupComponents::Query**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-query)).</span></span>                                               | <span data-ttu-id="1183b-115">Нет</span><span class="sxs-lookup"><span data-stu-id="1183b-115">None</span></span>                                                      | <span data-ttu-id="1183b-116">Нет</span><span class="sxs-lookup"><span data-stu-id="1183b-116">None</span></span>                                                                                                                                                                                                                                                       |
| <span data-ttu-id="1183b-117">Инициатор запроса может предоставить дополнительные сведения об обработке операций резервного копирования и восстановления (см [**. раздел ивссбаккупкомпонентс:: сетбаккупстате**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate)).</span><span class="sxs-lookup"><span data-stu-id="1183b-117">The requester can provide additional information on handling backup and restore operations (see [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate))</span></span>                                                                                                                                                        | <span data-ttu-id="1183b-118">Нет</span><span class="sxs-lookup"><span data-stu-id="1183b-118">None</span></span>                                                      | <span data-ttu-id="1183b-119">Нет</span><span class="sxs-lookup"><span data-stu-id="1183b-119">None</span></span>                                                                                                                                                                                                                                                       |
| <span data-ttu-id="1183b-120">Инициирует асинхронное обращение с помощью модулей записи (см [**. ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata))</span><span class="sxs-lookup"><span data-stu-id="1183b-120">Initiates asynchronous contact with writers (see [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata))</span></span>                                                                                                                                                                                           | [<span data-ttu-id="1183b-121">*Указывается*</span><span class="sxs-lookup"><span data-stu-id="1183b-121">*Identify*</span></span>](vssgloss-i.md) | <span data-ttu-id="1183b-122">Создает документ метаданных модуля записи (см. раздел [Работа с документом метаданных модуля записи](working-with-the-writer-metadata-document.md), [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), [**ивсскреатевритерметадата**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata)).</span><span class="sxs-lookup"><span data-stu-id="1183b-122">Creates a Writer Metadata Document (see [Working with the Writer Metadata Document](working-with-the-writer-metadata-document.md), [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata))</span></span> |



 

## <a name="requester-actions-during-backup-initialization"></a><span data-ttu-id="1183b-123">Действия запросившего во время инициализации резервного копирования</span><span class="sxs-lookup"><span data-stu-id="1183b-123">Requester Actions during Backup Initialization</span></span>

<span data-ttu-id="1183b-124">Объект [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) можно использовать только для одной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="1183b-124">An [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) object can be used for only one backup.</span></span> <span data-ttu-id="1183b-125">Таким образом, инициатор запроса должен перейти к концу резервного копирования, включая освобождение интерфейса **ивссбаккупкомпонентс** .</span><span class="sxs-lookup"><span data-stu-id="1183b-125">Therefore, a requester must proceed through to the end of the backup, including releasing the **IVssBackupComponents** interface.</span></span> <span data-ttu-id="1183b-126">Если резервная копия должна преждевременно завершиться, инициатору запроса необходимо вызвать [**ивссбаккупкомпонентс:: абортбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) , а затем освободить объект **ивссбаккупкомпонентс** (Дополнительные сведения см. в разделе [Прерывание операций VSS](aborting-vss-operations.md) ).</span><span class="sxs-lookup"><span data-stu-id="1183b-126">If the backup needs to terminate prematurely, the requester needs to call [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) and then release the **IVssBackupComponents** object (see [Aborting VSS Operations](aborting-vss-operations.md) for more information).</span></span> <span data-ttu-id="1183b-127">Не пытайтесь возобновить интерфейс **ивссбаккупкомпонентс** .</span><span class="sxs-lookup"><span data-stu-id="1183b-127">Do not attempt to resume the **IVssBackupComponents** interface.</span></span>

<span data-ttu-id="1183b-128">Как правило, документ компонентов резервного копирования инициатора запроса инициализируется как пустой.</span><span class="sxs-lookup"><span data-stu-id="1183b-128">Typically, a requester's Backup Components Document is initialized as empty.</span></span> <span data-ttu-id="1183b-129">Документ с сохраненными компонентами резервного копирования может быть загружен при вызове [**ивссбаккупкомпонентс:: инитиализефорбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) , как правило, в поддержке переносимых теневых скопированных томов.</span><span class="sxs-lookup"><span data-stu-id="1183b-129">A stored Backup Components Document can be loaded when [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) is called, typically in support of transportable shadow copied volumes.</span></span> <span data-ttu-id="1183b-130">В этом случае модуль записи с инициатором запроса будет немного отличаться от описанного ниже.</span><span class="sxs-lookup"><span data-stu-id="1183b-130">In this case, the writer-requester communication will be somewhat different than what is described below.</span></span> <span data-ttu-id="1183b-131">(Дополнительные сведения см. в разделе [Импорт переносимых теневых томов](importing-transportable-shadow-copied-volumes.md) .)</span><span class="sxs-lookup"><span data-stu-id="1183b-131">(See [Importing Transportable Shadow Copied Volumes](importing-transportable-shadow-copied-volumes.md) for more information.)</span></span>

<span data-ttu-id="1183b-132">Чтобы добавить тома в набор теневых копий, инициатор запроса должен сначала задать контекст для операции теневого копирования, вызвав [**ивссбаккупкомпонентс:: SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext).</span><span class="sxs-lookup"><span data-stu-id="1183b-132">To add volumes to the shadow copy set, a requester must first set the context for the shadow copy operation by calling [**IVssBackupComponents::SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext).</span></span> <span data-ttu-id="1183b-133">Если этот метод не вызывается, используется контекст по умолчанию для теневых копий, \_ CTX \_ резервное копирование VSS.</span><span class="sxs-lookup"><span data-stu-id="1183b-133">If this method is not called, the default context for shadow copies, VSS\_CTX\_BACKUP, is used.</span></span> <span data-ttu-id="1183b-134">Сведения о настройке контекста теневой копии см. в разделе [конфигурации контекста теневого копирования](shadow-copy-context-configurations.md).</span><span class="sxs-lookup"><span data-stu-id="1183b-134">For information about setting the shadow copy context, see [Shadow Copy Context Configurations](shadow-copy-context-configurations.md).</span></span>

<span data-ttu-id="1183b-135">Чтобы начать выполнение программы установки до создания резервной копии, инициатор запроса должен вызвать [**ивссбаккупкомпонентс:: сетбаккупстате**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span><span class="sxs-lookup"><span data-stu-id="1183b-135">To begin the completion of its setup prior to backup, a requester must call [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span></span> <span data-ttu-id="1183b-136">Это означает, что инициатор запроса сообщает средствам записи:</span><span class="sxs-lookup"><span data-stu-id="1183b-136">By doing this, a requester indicates to the writers:</span></span>

-   <span data-ttu-id="1183b-137">Тип резервной копии (как определено [**в \_ \_ поле Тип резервной копии VSS**](/windows/desktop/api/Vss/ne-vss-vss_backup_type))</span><span class="sxs-lookup"><span data-stu-id="1183b-137">The type of backup (as defined in [**VSS\_BACKUP\_TYPE**](/windows/desktop/api/Vss/ne-vss-vss_backup_type))</span></span>
-   <span data-ttu-id="1183b-138">Содержит ли резервная копия состояние загрузочной системы</span><span class="sxs-lookup"><span data-stu-id="1183b-138">Whether the backup includes a bootable system state</span></span>
-   <span data-ttu-id="1183b-139">Поддерживает ли инициатор запроса выбор отдельных компонентов или резервное копирование целых томов.</span><span class="sxs-lookup"><span data-stu-id="1183b-139">Whether the requester supports the selection of individual components or backs up entire volumes.</span></span>

<span data-ttu-id="1183b-140">Все запрашивающие стороны, участвующие в операциях резервного копирования и восстановления, всегда должны вызывать [**ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span><span class="sxs-lookup"><span data-stu-id="1183b-140">All requesters participating in backup and restore operations must always call [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span> <span data-ttu-id="1183b-141">Этот метод инициирует обмен данными с инициатором записи, создавая событие [*Identify*](vssgloss-i.md) (инициализация) VSS, в ответ на то, что модуль записи создает свой документ метаданных.</span><span class="sxs-lookup"><span data-stu-id="1183b-141">This method initiates writer-requester communication by generating a VSS [*Identify*](vssgloss-i.md) event, in response to which a writer creates its metadata document.</span></span>

<span data-ttu-id="1183b-142">Перед вызовом [**ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata)у инициатора запроса есть возможность явно включать или отключать определенные конкретные классы записи и записи с помощью [**Ивссбаккупкомпонентс:: енаблевритерклассес**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-enablewriterclasses), [**IVssBackupComponents::D Isablewriterinstances**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-disablewriterinstances)и [**IVssBackupComponents::D isablewriterclasses**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-disablewriterclasses) (по умолчанию включены все классы).</span><span class="sxs-lookup"><span data-stu-id="1183b-142">Prior to calling [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), a requester has an opportunity to explicitly enable or disable certain specific writers and writer classes using [**IVssBackupComponents::EnableWriterClasses**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-enablewriterclasses), [**IVssBackupComponents::DisableWriterInstances**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-disablewriterinstances), and [**IVssBackupComponents::DisableWriterClasses**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-disablewriterclasses) (by default, all classes are enabled).</span></span> <span data-ttu-id="1183b-143">После вызова **ивссбаккупкомпонентс:: гасервритерметадата** эти вызовы не оказывают никакого влияния.</span><span class="sxs-lookup"><span data-stu-id="1183b-143">After **IVssBackupComponents::GatherWriterMetadata** is called, these calls have no effect.</span></span>

<span data-ttu-id="1183b-144">Поскольку невозможно получить список модулей записи в системе до вызова [**ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), запрашивающие стороны могут рассмотреть создание и удаление второго экземпляра [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) для получения списка.</span><span class="sxs-lookup"><span data-stu-id="1183b-144">Because there is no way to obtain a list of writers on the system prior to calling [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), requesters may consider creating and then deleting a second instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) to obtain the list.</span></span>

<span data-ttu-id="1183b-145">Не нужно вызывать метод [**ивссбаккупкомпонентс:: гасервритерстатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) после завершения [**Ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span><span class="sxs-lookup"><span data-stu-id="1183b-145">It is not necessary to call [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) following the completion of [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span> <span data-ttu-id="1183b-146">Модули записи, которые не обрабатывали событие [*определения*](vssgloss-i.md) , сформированное вызовами, не будут частью списка модулей записи, предоставляющих метаданные, обнаруженные [**Ивссбаккупкомпонентс:: жетвритерметадатакаунт**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadatacount) и [**ивссбаккупкомпонентс:: Жетвритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) (см. раздел [Определение состояния модуля записи](determining-writer-status.md)).</span><span class="sxs-lookup"><span data-stu-id="1183b-146">Writers that fail to process the [*Identify*](vssgloss-i.md) event generated by the calls will not be part of the list of writers providing metadata found by [**IVssBackupComponents::GetWriterMetadataCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadatacount) and [**IVssBackupComponents::GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) (see [Determining Writer Status](determining-writer-status.md)).</span></span>

## <a name="writer-actions-during-backup-initialization"></a><span data-ttu-id="1183b-147">Действия модуля записи во время инициализации резервного копирования</span><span class="sxs-lookup"><span data-stu-id="1183b-147">Writer Actions during Backup Initialization</span></span>

<span data-ttu-id="1183b-148">В ответ на событие Identify служба VSS вызывает метод виртуального обработчика каждого средства записи [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify).</span><span class="sxs-lookup"><span data-stu-id="1183b-148">In response to the Identify event, VSS calls each writer's virtual handler method, [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify).</span></span> <span data-ttu-id="1183b-149">Модуль записи создает документ метаданных модуля записи путем переопределения реализации **квссвритер:: onidentify** по умолчанию и использования интерфейса [**ивсскреатевритерметадата**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) .</span><span class="sxs-lookup"><span data-stu-id="1183b-149">A writer creates its Writer Metadata Document by overriding the default implementation of **CVssWriter::OnIdentify** and using the [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) interface.</span></span>

<span data-ttu-id="1183b-150">Обратите внимание, что приложения, отличные от текущего запрашивающего (например, системных приложений), могут создавать события, которые должны обрабатываться модулем записи.</span><span class="sxs-lookup"><span data-stu-id="1183b-150">Note that applications other than the current requester (for instance, system applications) can generate Identify events that must be handled by the writer.</span></span> <span data-ttu-id="1183b-151">Кроме того, разработчик не может определить, какое приложение создало событие Identify, с помощью [**квссвритер:: \ Identify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) .</span><span class="sxs-lookup"><span data-stu-id="1183b-151">In addition, there is no way for a writer to determine from within [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) which application has generated the Identify event.</span></span>

<span data-ttu-id="1183b-152">Это происходит, если при обработке операции резервного копирования модуль записи может получить несколько событий типа Identify, модуль записи никогда не должен задавать сведения о состоянии в обработчике [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) .</span><span class="sxs-lookup"><span data-stu-id="1183b-152">This being the case, given that a writer may receive several Identify events while processing a backup operation, a writer should never set state information in the [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) handler.</span></span>

<span data-ttu-id="1183b-153">Вместо этого [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) должен выполнить последовательный алгоритм создания документа метаданных модуля записи модуля записи, особенно потому, что после того, как модуль записи создаст документ, ни инициатор запроса, ни модуль записи не смогут его изменить.</span><span class="sxs-lookup"><span data-stu-id="1183b-153">Instead, [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) should perform a consistent algorithm to create the writer's Writer Metadata Document, particularly because after a writer creates the document, neither the requester nor the writer can modify it.</span></span> <span data-ttu-id="1183b-154">С этого момента это документ, предназначенный только для чтения.</span><span class="sxs-lookup"><span data-stu-id="1183b-154">From this point forward, it is a read-only document.</span></span>

<span data-ttu-id="1183b-155">Это означает, что число и тип [*компонентов*](vssgloss-c.md) , связанных с модулем записи, какие файлы являются частью каждого компонента, и явное исключение файлов из операций резервного копирования или восстановления после того, как модуль записи возвращает данные о событии Identify.</span><span class="sxs-lookup"><span data-stu-id="1183b-155">This means that the number and type of [*components*](vssgloss-c.md) associated with a writer, which files are part of each component, and the explicit exclusion of files from backup or restore operations cannot be changed after a writer returns from processing the Identify event.</span></span>

<span data-ttu-id="1183b-156">Все модули записи, участвующие в VSS, должны выполнять следующие действия:</span><span class="sxs-lookup"><span data-stu-id="1183b-156">All writers participating with VSS are required to do the following:</span></span>

1.  <span data-ttu-id="1183b-157">Укажите метод Restore для всех компонентов, управляемых модулем записи, с помощью [**ивсскреатевритерметадата:: сетресторемесод**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod).</span><span class="sxs-lookup"><span data-stu-id="1183b-157">Indicate a restore method for all components managed by the writer using [**IVssCreateWriterMetadata::SetRestoreMethod**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod).</span></span>
2.  <span data-ttu-id="1183b-158">Добавьте по крайней мере один компонент с помощью [**ивсскреатевритерметадата:: AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) (Дополнительные сведения о спецификации компонентов см. в разделе [Определение компонентов по модулям записи](definition-of-components-by-writers.md) ).</span><span class="sxs-lookup"><span data-stu-id="1183b-158">Add at least one component using [**IVssCreateWriterMetadata::AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) (see [Definition of Components by Writers](definition-of-components-by-writers.md) for more information on component specification).</span></span>

<span data-ttu-id="1183b-159">Модуль записи указывает файлы для участия в операциях резервного копирования или восстановления путем добавления [*наборов файлов*](vssgloss-f.md)— сочетания пути, спецификации файла и флага рекурсии к заданному компоненту с помощью [**Ивсскреатевритерметадата:: аддфилестофилеграуп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup), [**Ивсскреатевритерметадата:: Адддатабасефилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles)или [**IVssCreateWriterMetadata:: AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), в зависимости от типа (см. раздел [Добавление файлов в компоненты](definition-of-components-by-writers.md)).</span><span class="sxs-lookup"><span data-stu-id="1183b-159">A writer indicates the files to participate in a backup or restore operation by adding [*file sets*](vssgloss-f.md)—a combination of a path, file specification, and a recursion flag—to a given component using [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup), [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), or [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), depending on type (See [Adding Files to Components](definition-of-components-by-writers.md).)</span></span>

<span data-ttu-id="1183b-160">Модуль записи может также содержать один или несколько пустых компонентов, компонентов, к которым не были добавлены файлы.</span><span class="sxs-lookup"><span data-stu-id="1183b-160">A writer may also have one or more empty components, components to which no files have been added.</span></span> <span data-ttu-id="1183b-161">Они очень полезны при Организации компонентов модуля записи.</span><span class="sxs-lookup"><span data-stu-id="1183b-161">These are very useful in organizing the writer's components.</span></span> <span data-ttu-id="1183b-162">(См. раздел [логическое расположение компонентов](logical-pathing-of-components.md).)</span><span class="sxs-lookup"><span data-stu-id="1183b-162">(See [Logical Pathing of Components](logical-pathing-of-components.md).)</span></span>

<span data-ttu-id="1183b-163">Модуль записи использует [**ивсскреатевритерметадата:: аддексклудефилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addexcludefiles) , чтобы явно запретить включение файлов в резервную копию.</span><span class="sxs-lookup"><span data-stu-id="1183b-163">A writer uses [**IVssCreateWriterMetadata::AddExcludeFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addexcludefiles) to explicitly prevent files from being included in the backup.</span></span> <span data-ttu-id="1183b-164">Это явное исключение полезно, поскольку подстановочные знаки можно использовать для указания файлов для включения (см. раздел [исключение спецификации списка файлов](writer-metadata-document-contents.md)).</span><span class="sxs-lookup"><span data-stu-id="1183b-164">This explicit exclusion is useful because wildcard characters can be used to specify files for inclusion (see [Exclude File List Specification](writer-metadata-document-contents.md)).</span></span> <span data-ttu-id="1183b-165">Обратите внимание, что список исключить файлы имеет приоритет над списками файлов компонентов.</span><span class="sxs-lookup"><span data-stu-id="1183b-165">Note that the exclude file list takes precedence over component files lists.</span></span>

<span data-ttu-id="1183b-166">[**Ивсскреатевритерметадата:: аддалтернателокатионмаппинг**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addalternatelocationmapping) используется для создания [*сопоставлений альтернативного расположения*](vssgloss-a.md) для указанных наборов файлов, которые были добавлены в один из компонентов модуля записи.</span><span class="sxs-lookup"><span data-stu-id="1183b-166">[**IVssCreateWriterMetadata::AddAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addalternatelocationmapping) is used to create [*alternate location mappings*](vssgloss-a.md) for specified file sets that have been added to one of the writer's components.</span></span> <span data-ttu-id="1183b-167">Эти сопоставления используются при восстановлении файлов, так как восстановление в исходное расположение файла невозможно или нежелательно.</span><span class="sxs-lookup"><span data-stu-id="1183b-167">These mappings are used during file restore when restoring to a file's original location is not possible or desirable.</span></span> <span data-ttu-id="1183b-168">(См. раздел [Общие сведения о фактическом восстановлении файлов](overview-of-actual-file-restoration.md) и [расположениях резервного копирования и восстановления не по умолчанию](non-default-backup-and-restore-locations.md).)</span><span class="sxs-lookup"><span data-stu-id="1183b-168">(See [Overview of Actual File Restoration](overview-of-actual-file-restoration.md) and [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md).)</span></span>

<span data-ttu-id="1183b-169">Так как набор файлов резервной копии указан в документе метаданных модуля записи, он не может быть изменен позже.</span><span class="sxs-lookup"><span data-stu-id="1183b-169">Because the backup file set is specified in the Writer Metadata Document, it cannot later be modified.</span></span> <span data-ttu-id="1183b-170">Таким образом, модуль записи должен быть закодирован таким образом, чтобы определение набора файлов включало все файлы, необходимые в резервной копии, либо по имени, либо через подстановочные знаки.</span><span class="sxs-lookup"><span data-stu-id="1183b-170">Therefore, a writer should be coded so that the file set's definition will include all files needed in the backup, either by name or through wildcard characters.</span></span> <span data-ttu-id="1183b-171">Возможно, это могут быть некоторые файлы, которые могут быть созданы после события Identify.</span><span class="sxs-lookup"><span data-stu-id="1183b-171">Conceivably, this may include some files that might be created after the Identify event.</span></span>

 

 



