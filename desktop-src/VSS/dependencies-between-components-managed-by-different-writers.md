---
description: Существуют ситуации, когда данные из одного модуля записи зависят от данных, управляемых другим модулем записи. В таких случаях следует выполнять резервное копирование и восстановление данных из обоих модулей записи.
ms.assetid: 0413c289-74b7-4e83-a227-00bfb264e56e
title: Зависимости между компонентами, управляемыми разными модулями записи
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 91ba3be6a2c2f0a722c4c5f06ca95351e004e1cd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104349272"
---
# <a name="dependencies-between-components-managed-by-different-writers"></a><span data-ttu-id="e135e-104">Зависимости между компонентами, управляемыми разными модулями записи</span><span class="sxs-lookup"><span data-stu-id="e135e-104">Dependencies between Components Managed by Different Writers</span></span>

<span data-ttu-id="e135e-105">Существуют ситуации, когда данные из одного модуля записи зависят от данных, управляемых другим модулем записи.</span><span class="sxs-lookup"><span data-stu-id="e135e-105">There are situations where data from one writer depends on data managed by another writer.</span></span> <span data-ttu-id="e135e-106">В таких случаях следует выполнять резервное копирование и восстановление данных из обоих модулей записи.</span><span class="sxs-lookup"><span data-stu-id="e135e-106">In these cases, you should back up or restore data from both writers.</span></span>

<span data-ttu-id="e135e-107">VSS обрабатывает эту проблему, используя понятие явной зависимости компонента записи и интерфейса [**ивссвмдепенденци**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) .</span><span class="sxs-lookup"><span data-stu-id="e135e-107">VSS handles this problem through the notion of an explicit writer-component dependency and the [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) interface.</span></span>

<span data-ttu-id="e135e-108">Модуль записи добавляет одну или несколько зависимостей при создании документа метаданных модуля записи с помощью метода [**ивсскреатевритерметадата:: аддкомпонентдепенденци**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) .</span><span class="sxs-lookup"><span data-stu-id="e135e-108">A writer adds one or more dependencies while creating the Writer Metadata Document using the [**IVssCreateWriterMetadata::AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) method.</span></span> <span data-ttu-id="e135e-109">Модуль записи передает методу имя и логический путь зависимого компонента (которым он управляет), а также имя и логический путь и [*идентификатор класса модуля записи*](vssgloss-w.md) (идентификатор GUID, определяющий класс) компонента, от которого он зависит.</span><span class="sxs-lookup"><span data-stu-id="e135e-109">The writer passes the method the name and logical path of the dependent component (which it manages), as well as the name and logical path and the [*writer class ID*](vssgloss-w.md) (the GUID identifying the class) of the component upon which it depends.</span></span>

<span data-ttu-id="e135e-110">После установки эта зависимость информирует инициатор запроса, что во время любой операции резервного копирования или восстановления зависимый компонент и целевые объекты его зависимостей должны участвовать.</span><span class="sxs-lookup"><span data-stu-id="e135e-110">Once established, this dependency informs the requester that during any backup or restore operation both the dependent component and the targets of its dependencies must participate.</span></span>

<span data-ttu-id="e135e-111">Данный компонент может иметь несколько зависимостей, что требует, чтобы он и все зависимые целевые объекты участвовали в резервном копировании и восстановлении вместе.</span><span class="sxs-lookup"><span data-stu-id="e135e-111">A given component can have multiple dependencies, which requires that it and all its dependent targets participate in the backup and restore together.</span></span>

<span data-ttu-id="e135e-112">Зависимый компонент и (или) целевые объекты его зависимостей могут включаться [*явно*](vssgloss-e.md) или [*неявно*](vssgloss-i.md) в операции резервного копирования или восстановления.</span><span class="sxs-lookup"><span data-stu-id="e135e-112">The dependent component and/or the target(s) of its dependencies can be included either [*explicitly*](vssgloss-e.md) or [*implicitly*](vssgloss-i.md) in a backup or restore operations.</span></span>

<span data-ttu-id="e135e-113">Механизм зависимости для компонента явного модуля записи не следует использовать для создания зависимости между двумя компонентами в одном модуле записи.</span><span class="sxs-lookup"><span data-stu-id="e135e-113">The explicit writer component dependency mechanism should not be used to create a dependency between two components on the same writer.</span></span> <span data-ttu-id="e135e-114">Правила выбора могут более эффективно предоставлять одни и те же функции без риска циклических зависимостей.</span><span class="sxs-lookup"><span data-stu-id="e135e-114">The selection rules can supply the same functionality more efficiently without risk of circular dependencies.</span></span>

<span data-ttu-id="e135e-115">Например, [**ивсскреатевритерметадата:: аддкомпонентдепенденци**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) можно использовать для определения зависимости компонента вритердата (с логическим путем "") модуля записи мивритер в компоненте интернетдата (с логическим путем "Connections") модуля записи с именем INTERNETCONNECTOR с идентификатором класса модуля записи X. (хотя несколько модулей записи с ОДИНАКОВым идентификатором класса могут быть одновременно включены в систему, путаница будет избегать, так как сочетание логического пути и имени компонента уникально в системе под управлением VSS.)</span><span class="sxs-lookup"><span data-stu-id="e135e-115">As an example, [**IVssCreateWriterMetadata::AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) could be used to define the dependency of the component writerData (with logical path "") of the writer MyWriter on component internetData (with a logical path of "Connections") of a writer named InternetConnector with a writer Class ID X. (While it is possible for multiple writers with the same class ID to be on the system simultaneously, confusion will be avoided because the combination of logical path and component name is unique on the system under VSS.)</span></span>

<span data-ttu-id="e135e-116">Модуль записи добавляет несколько зависимостей к данному компоненту, просто вызывая [**ивсскреатевритерметадата:: аддкомпонентдепенденци**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) , повторяемый с различными компонентами из разных модулей записи.</span><span class="sxs-lookup"><span data-stu-id="e135e-116">A writer adds multiple dependencies to a given component simply by calling [**IVssCreateWriterMetadata::AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) repeated with different components from different writers.</span></span> <span data-ttu-id="e135e-117">Количество других компонентов, от которых зависит данный компонент, можно найти, изучив элемент **кдепенденЦиес** структуры [**\_ компонентинфо VSS**](/windows/desktop/api/VsBackup/ns-vsbackup-vss_componentinfo) .</span><span class="sxs-lookup"><span data-stu-id="e135e-117">The number of other components a given component depends on can be found by examining the **cDependencies** member of the [**VSS\_COMPONENTINFO**](/windows/desktop/api/VsBackup/ns-vsbackup-vss_componentinfo) structure.</span></span>

<span data-ttu-id="e135e-118">Модуль записи или инициатор запроса извлекает экземпляры интерфейса [**ивссвмдепенденци**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) с помощью [**Ивссвмкомпонент:: dependency**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdependency).</span><span class="sxs-lookup"><span data-stu-id="e135e-118">A writer or requester retrieves instances of the [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) interface with [**IVssWMComponent::GetDependency**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdependency).</span></span> <span data-ttu-id="e135e-119">**Ивссвмдепенденци** возвращает имя компонента, логический путь и идентификатор класса модуля записи, управляющего компонентом, который является целевым объектом зависимости.</span><span class="sxs-lookup"><span data-stu-id="e135e-119">The **IVssWMDependency** returns the component name, logical path, and class ID of the writer managing the component that is the target of the dependency.</span></span>

<span data-ttu-id="e135e-120">Механизм зависимости не предписывает определенный порядок предпочтения между зависимым компонентом и целями его зависимостей.</span><span class="sxs-lookup"><span data-stu-id="e135e-120">The dependency mechanism does not prescribe any particular order of preference between the dependent component and the targets of its dependencies.</span></span> <span data-ttu-id="e135e-121">Как отмечалось выше, все зависимости указывают на то, что каждый раз при резервном копировании или восстановлении какого-либо компонента или компонента, от которого он зависит, необходимо также создать резервную копию или восстановить компонент или компоненты, от которых они зависят.</span><span class="sxs-lookup"><span data-stu-id="e135e-121">As noted above, all a dependency indicates is that whenever a given component is either backed up or restored, the component or components it depends on must be backed up or restored as well.</span></span> <span data-ttu-id="e135e-122">Точная реализация зависимости является обязательной для приложения резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="e135e-122">The exact implementation of dependency is at the discretion of the backup application.</span></span>

<span data-ttu-id="e135e-123">Например, в приведенном выше случае компонент Вритердата (логический путь ") зависит от компонента Интернетконнектор (логический путь" соединения ").</span><span class="sxs-lookup"><span data-stu-id="e135e-123">For example, in the case above, the component writerData (logical path "") depends on component InternetConnector (logical path "Connections").</span></span> <span data-ttu-id="e135e-124">Инициатор запроса может интерпретировать его одним из следующих способов:</span><span class="sxs-lookup"><span data-stu-id="e135e-124">A requester is free to interpret this in either of the following ways:</span></span>

-   <span data-ttu-id="e135e-125">Если зависимый компонент Вритердата выбран (неявно или явно) для резервного копирования или восстановления, инициатор запроса должен выбрать (неявно или явно) целевой объект зависимости, Интернетдата</span><span class="sxs-lookup"><span data-stu-id="e135e-125">If the dependent component, writerData, is selected (implicitly or explicitly) for backup or restore, the requester must select (either implicitly or explicitly) the target of its dependency, internetData</span></span>
-   <span data-ttu-id="e135e-126">Если целевой объект зависимости Интернетдата не выбран для резервного копирования, то зависимый компонент Вритердата не должен быть выбран.</span><span class="sxs-lookup"><span data-stu-id="e135e-126">If the target of its dependency, internetData, is not selected for backup, then the dependent component, writerData, should not be selected.</span></span>

<span data-ttu-id="e135e-127">Однако при разработке поддержки зависимостей разработчикам инициатора запроса следует знать, что не существует способа, которым модуль записи может определить, является ли один из его компонентов целью зависимости.</span><span class="sxs-lookup"><span data-stu-id="e135e-127">However, when developing support for dependencies, requester developers should be aware that there is no way a writer can determine if one of its components is a target of a dependency.</span></span>

## <a name="declaring-remote-dependencies"></a><span data-ttu-id="e135e-128">Объявление удаленных зависимостей</span><span class="sxs-lookup"><span data-stu-id="e135e-128">Declaring Remote Dependencies</span></span>

<span data-ttu-id="e135e-129">Распределенное приложение — это приложение, которое можно настроить для использования одного или нескольких компьютеров за раз.</span><span class="sxs-lookup"><span data-stu-id="e135e-129">A distributed application is an application that can be configured to use one or more computers at a time.</span></span> <span data-ttu-id="e135e-130">Обычно приложение выполняется на одном или нескольких компьютерах серверов приложений и взаимодействует с (но может и не может выполняться) на одном или нескольких серверах баз данных.</span><span class="sxs-lookup"><span data-stu-id="e135e-130">Typically the application runs on one or more application server computers and communicates with (but may or may not actually run on) one or more database server computers.</span></span> <span data-ttu-id="e135e-131">Эта конфигурация иногда называется развертыванием в нескольких системах.</span><span class="sxs-lookup"><span data-stu-id="e135e-131">This configuration is sometimes referred to as a multi-system deployment.</span></span> <span data-ttu-id="e135e-132">Часто одно и то же приложение можно настроить для запуска на одном компьютере, на котором работают сервер приложений и сервер базы данных.</span><span class="sxs-lookup"><span data-stu-id="e135e-132">Often the same application can also be configured to run on a single computer that runs both an application server and a database server.</span></span> <span data-ttu-id="e135e-133">Такая конфигурация называется развертыванием с одной системой.</span><span class="sxs-lookup"><span data-stu-id="e135e-133">Such a configuration is called a single-system deployment.</span></span> <span data-ttu-id="e135e-134">В обеих конфигурациях сервер приложений и сервер базы данных имеют собственные независимые модули записи VSS.</span><span class="sxs-lookup"><span data-stu-id="e135e-134">In both configurations, the application server and database server each have their own independent VSS writers.</span></span>

<span data-ttu-id="e135e-135">В многосистемном развертывании, если компонент, управляемый модулем записи приложения, зависит от удаленного компонента, управляемого модулем записи сервера базы данных, это называется удаленной зависимостью.</span><span class="sxs-lookup"><span data-stu-id="e135e-135">In a multi-system deployment, if a component managed by the application's writer depends on a remote component managed by the database server's writer, this is called a remote dependency.</span></span> <span data-ttu-id="e135e-136">(Односистемное развертывание, напротив, имеет только локальные зависимости.)</span><span class="sxs-lookup"><span data-stu-id="e135e-136">(A single-system deployment, in contrast, has only local dependencies.)</span></span>

<span data-ttu-id="e135e-137">В качестве примера многосистемного развертывания рассмотрим сервер приложений, использующий сервер базы данных SQL Server в качестве хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="e135e-137">As an example of a multi-system deployment, consider an application server that uses a SQL Server database server as a data store.</span></span> <span data-ttu-id="e135e-138">Данные конкретного приложения, включая веб-части, файлы веб-содержимого и метабазу IIS, размещаются на одном или нескольких компьютерах, называемых интерфейсными веб-серверами.</span><span class="sxs-lookup"><span data-stu-id="e135e-138">The application-specific data, which includes the web parts, web content files, and the IIS metabase, resides on one or more computers, called front-end web servers.</span></span> <span data-ttu-id="e135e-139">Фактическое хранилище данных SQL, включающее базу данных конфигурации и несколько баз данных содержимого, находится на одном или нескольких компьютерах, называемых серверными серверами баз данных.</span><span class="sxs-lookup"><span data-stu-id="e135e-139">The actual SQL data store, which includes the Config database and multiple Content databases, resides on one or more other computers, called back-end database servers.</span></span> <span data-ttu-id="e135e-140">Каждый интерфейсный веб-сервер содержит одно и то же содержимое и конфигурацию конкретного приложения.</span><span class="sxs-lookup"><span data-stu-id="e135e-140">Each of the front-end web servers contains the same application-specific content and configuration.</span></span> <span data-ttu-id="e135e-141">На каждом сервере серверных баз данных могут размещаться любые базы данных содержимого или базы данных конфигурации.</span><span class="sxs-lookup"><span data-stu-id="e135e-141">Each of the back-end database servers can host any of the Content databases or the Config database.</span></span> <span data-ttu-id="e135e-142">Программное обеспечение приложения выполняется только на интерфейсных веб-серверах, а не на серверах баз данных.</span><span class="sxs-lookup"><span data-stu-id="e135e-142">The application software runs only on the front-end web servers, not on the database servers.</span></span> <span data-ttu-id="e135e-143">В этой конфигурации модуль записи VSS приложения имеет удаленную зависимость от компонентов, управляемых модулем записи SQL.</span><span class="sxs-lookup"><span data-stu-id="e135e-143">In this configuration, the application's VSS writer has remote dependencies on the components managed by the SQL writer.</span></span>

<span data-ttu-id="e135e-144">Модуль записи может объявить удаленную зависимость, вызвав метод [**аддкомпонентдепенденци**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) , предъявив " \\ \\ *имя_удаленного_компьютера* \\ ", где *имя_удаленного_компьютера* — это имя компьютера, на котором находится удаленный компонент, в логический путь в параметре *всзонлогикалпас* .</span><span class="sxs-lookup"><span data-stu-id="e135e-144">A writer can declare a remote dependency by calling the [**AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) method, prepending "\\\\*RemoteComputerName*\\", where *RemoteComputerName* is the name of the computer where the remote component resides, to the logical path in the *wszOnLogicalPath* parameter.</span></span> <span data-ttu-id="e135e-145">Значение *имя_удаленного_компьютера* может быть IP-адресом или именем компьютера, возвращаемым функцией [**предполагался сбой getcomputernameex**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getcomputernameexa) .</span><span class="sxs-lookup"><span data-stu-id="e135e-145">The value of *RemoteComputerName* can be an IP address or a computer name returned by the [**GetComputerNameEx**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getcomputernameexa) function.</span></span>

<span data-ttu-id="e135e-146">**Windows Server 2003:** Модуль записи не может объявлять удаленные зависимости до Windows Server 2003 с пакетом обновления 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="e135e-146">**Windows Server 2003:** A writer cannot declare remote dependencies until Windows Server 2003 with Service Pack 1 (SP1).</span></span>

<span data-ttu-id="e135e-147">Для обнаружения зависимости инициатор запроса вызывает методы [**жетвритерид**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmdependency-getwriterid), [**жетлогикалпас**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getlogicalpath)и [**жеткомпонентнаме**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmdependency-getcomponentname) интерфейса [**ивссвмдепенденци**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) .</span><span class="sxs-lookup"><span data-stu-id="e135e-147">To identify a dependency, a requester calls the [**GetWriterId**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmdependency-getwriterid), [**GetLogicalPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getlogicalpath), and [**GetComponentName**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmdependency-getcomponentname) methods of the [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) interface.</span></span> <span data-ttu-id="e135e-148">Инициатор запроса должен проверить имя компонента, возвращаемое **жеткомпонентнаме** , в параметре *пбстркомпонентнаме* .</span><span class="sxs-lookup"><span data-stu-id="e135e-148">The requester must examine the component name that **GetComponentName** returns in the *pbstrComponentName* parameter.</span></span> <span data-ttu-id="e135e-149">Если имя компонента начинается с " \\ \\ ", инициатор запроса должен предположить, что он указывает удаленную зависимость, а первый компонент, следующий за " \\ \\ ", является *имя_удаленного_компьютера* , который был указан при вызове модуля записи с именем [**аддкомпонентдепенденци**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency).</span><span class="sxs-lookup"><span data-stu-id="e135e-149">If the component name begins with "\\\\", the requester must assume that it specifies a remote dependency and that the first component following "\\\\" is the *RemoteComputerName* that was specified when the writer called [**AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency).</span></span> <span data-ttu-id="e135e-150">Если имя компонента не начинается с " \\ \\ ", инициатор запроса должен предположить, что он указывает локальную зависимость.</span><span class="sxs-lookup"><span data-stu-id="e135e-150">If the component name does not begin with "\\\\", the requester should assume that it specifies a local dependency.</span></span>

<span data-ttu-id="e135e-151">При наличии удаленной зависимости инициатор запроса должен создать резервную копию удаленного компонента, когда он создает резервную копию локального компонента.</span><span class="sxs-lookup"><span data-stu-id="e135e-151">If there is a remote dependency, the requester must back up the remote component when it backs up the local component.</span></span> <span data-ttu-id="e135e-152">Чтобы создать резервную копию удаленного компонента, запрашивающая сторона должна иметь агент на удаленном компьютере и инициировать резервное копирование на удаленном компьютере.</span><span class="sxs-lookup"><span data-stu-id="e135e-152">To back up the remote component, the requester should have an agent on the remote computer and should initiate the backup on the remote computer.</span></span>

## <a name="structuring-remote-dependencies"></a><span data-ttu-id="e135e-153">Структурирование удаленных зависимостей</span><span class="sxs-lookup"><span data-stu-id="e135e-153">Structuring Remote Dependencies</span></span>

<span data-ttu-id="e135e-154">Важно понимать, что зависимость не является компонентом в и самой.</span><span class="sxs-lookup"><span data-stu-id="e135e-154">It is important to understand that a dependency is not a component in and of itself.</span></span> <span data-ttu-id="e135e-155">Компонент необходим для хранения зависимости.</span><span class="sxs-lookup"><span data-stu-id="e135e-155">A component is necessary to hold the dependency.</span></span>

<span data-ttu-id="e135e-156">В следующих примерах показаны два способа структурирования набора зависимостей.</span><span class="sxs-lookup"><span data-stu-id="e135e-156">The following examples show two ways to structure a set of dependencies.</span></span>

``` syntax
Example 1:
    Writer 1
        Component A
            File A
            File B
            Dependency (SQL/MSDE Writer, Component X, "\")
            Dependency (SQL/MSDE Writer, Component Y, "\")

Example 2:
    Writer 2
        Component A
            File A
            File B
        Component B
            Dependency (SQL/MSDE Writer, Component X, "\")
            Dependency (SQL/MSDE Writer, Component Y, "\")
```

<span data-ttu-id="e135e-157">В примере 1 зависимости удерживаются компонентом а. Поскольку могут быть выбраны только компоненты, а не отдельные файлы, структурирование компонента A зависимостей таким образом потребует, чтобы весь компонент, как файлы, так и зависимости, всегда находился в резервной копии и восстановлен вместе.</span><span class="sxs-lookup"><span data-stu-id="e135e-157">In example 1, the dependencies are held by Component A. Because only components can be selected, not individual files, structuring Component A's dependencies this way would require that the entire component, both the files and the dependencies, must always be backed up and restored together.</span></span> <span data-ttu-id="e135e-158">Они не могут быть архивированы или восстановлены по отдельности.</span><span class="sxs-lookup"><span data-stu-id="e135e-158">They cannot be backed up or restored individually.</span></span>

<span data-ttu-id="e135e-159">В примере 2 отдельные компоненты (компоненты A и B) хранят все зависимости.</span><span class="sxs-lookup"><span data-stu-id="e135e-159">In example 2, separate components (Components A and B) hold each of the dependencies.</span></span> <span data-ttu-id="e135e-160">В этом случае можно выбирать два компонента независимо друг от друга и, следовательно, выполнять их резервное копирование и восстановление независимо друг от друга.</span><span class="sxs-lookup"><span data-stu-id="e135e-160">In this case, the two components can be selected independently, and therefore backed up and restored independently.</span></span> <span data-ttu-id="e135e-161">Структурирование зависимостей таким образом позволяет распределенному приложению значительно повысить гибкость управления удаленными зависимостями.</span><span class="sxs-lookup"><span data-stu-id="e135e-161">Structuring the dependencies this way gives a distributed application much more flexibility in managing its remote dependencies.</span></span>

## <a name="supporting-remote-dependencies"></a><span data-ttu-id="e135e-162">Поддержка удаленных зависимостей</span><span class="sxs-lookup"><span data-stu-id="e135e-162">Supporting Remote Dependencies</span></span>

<span data-ttu-id="e135e-163">Инициатор запроса может предоставлять полную или частичную поддержку удаленных зависимостей.</span><span class="sxs-lookup"><span data-stu-id="e135e-163">A requester can provide full or partial support for remote dependencies.</span></span>

<span data-ttu-id="e135e-164">Чтобы обеспечить полную поддержку, инициатор запроса должен выполнить следующие действия во время резервного копирования и восстановления.</span><span class="sxs-lookup"><span data-stu-id="e135e-164">To provide full support, the requester should do the following at backup and restore time.</span></span>

<span data-ttu-id="e135e-165">Во время резервного копирования инициатор запроса должен запустить резервное копирование на внешнем (локальном) компьютере, определить имеющиеся зависимости и добавить в очередь дополнительные задания резервного копирования для записи серверных баз данных.</span><span class="sxs-lookup"><span data-stu-id="e135e-165">At backup time, the requester must start the backup on the front-end (local) computer, determine the dependencies that exist, and spool additional backup jobs to capture the back-end databases.</span></span> <span data-ttu-id="e135e-166">Перед вызовом методов [**ивссбаккупкомпонентс:: сетбаккупсукцеедед**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded) и [**Ивссбаккупкомпонентс:: баккупкомплете**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) инициатору запроса необходимо подождать, пока не завершится выполнение заданий фонового резервного копирования на удаленном компьютере.</span><span class="sxs-lookup"><span data-stu-id="e135e-166">The requester must wait until after the back-end backup jobs on the remote computer have completed before calling the [**IVssBackupComponents::SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded) and [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) methods.</span></span> <span data-ttu-id="e135e-167">Если инициатор запроса ожидает завершения резервного копирования компонентов серверной части перед вызовом **баккупкомплете**, это приведет к более легкому восстанавливаемому резервному копированию для модуля записи, который реализует дополнительные улучшения (например, блокировку топологии) во время резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="e135e-167">If the requester waits until the backup of back-end components is complete before calling **BackupComplete**, this will produce a more easily recoverable backup for a writer that implements additional enhancements—such as topology locking, for example—during the backup.</span></span> <span data-ttu-id="e135e-168">В следующей процедуре показано, что должен делать инициатор запроса:</span><span class="sxs-lookup"><span data-stu-id="e135e-168">The following procedure outlines what the requester should do:</span></span>

1.  <span data-ttu-id="e135e-169">На локальном компьютере инициатор запроса вызывает методы [**ивссбаккупкомпонентс:: инитиализефорбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup), [**Ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**IVssBackupComponents::P Repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)и [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) .</span><span class="sxs-lookup"><span data-stu-id="e135e-169">On the local computer, the requester calls the [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup), [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), and [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) methods.</span></span>
2.  <span data-ttu-id="e135e-170">После завершения локальной теневой копии, но до завершения резервного копирования инициатор запроса заставит в очередь дополнительные задания резервного копирования, отправив запрос агенту на удаленном компьютере.</span><span class="sxs-lookup"><span data-stu-id="e135e-170">After the local shadow copy is completed, but before the backup is completed, the requester spools additional backup jobs by sending a request to its agent on the remote computer.</span></span>
3.  <span data-ttu-id="e135e-171">На удаленном компьютере агент инициатора запроса выполняет последовательность резервного копирования в очереди, вызывая [**инитиализефорбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup), [**гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), [**доснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), [**сетбаккупсукцеедед**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded)и [**баккупкомплете**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span><span class="sxs-lookup"><span data-stu-id="e135e-171">On the remote computer, the requester's agent performs the spooled backup sequence by calling [**InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), [**DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), [**SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded), and [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span></span>
4.  <span data-ttu-id="e135e-172">Когда агент инициатора запроса завершает задания, помещенные в очередь на удаленном компьютере, инициатор запроса завершает последовательность резервного копирования, вызывая [**сетбаккупсукцеедед**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded) и [**баккупкомплете**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span><span class="sxs-lookup"><span data-stu-id="e135e-172">When the requester's agent has completed the spooled jobs on the remote computer, the requester completes the backup sequence by calling [**SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded) and [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span></span>

<span data-ttu-id="e135e-173">Во время восстановления инициатор запроса должен начать восстановление, включающее внешний (локальный) компьютер, выбрать компоненты и их зависимости для восстановления, а затем отправить событие предварительного [**восстановления**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) , вызвав метод **ивссбаккупкомпонентс::P rerestore** .</span><span class="sxs-lookup"><span data-stu-id="e135e-173">At restore time, the requester must start the restore involving the front-end (local) computer, select the components and their dependencies to be restored, and then send the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event by calling the **IVssBackupComponents::PreRestore** method.</span></span> <span data-ttu-id="e135e-174">После этого инициатор запроса должен поочередно заставить в очередь задания восстановления на удаленном компьютере и вызвать метод [**ивссбаккупкомпонентс::P остресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) после завершения восстановления серверной части.</span><span class="sxs-lookup"><span data-stu-id="e135e-174">The requester should then spool the back-end restore jobs on the remote computer and call the [**IVssBackupComponents::PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) method when the back-end restores are complete.</span></span> <span data-ttu-id="e135e-175">Это требование обеспечивает более полное управление процессом восстановления, а также улучшает работу пользователя с администратором.</span><span class="sxs-lookup"><span data-stu-id="e135e-175">This requirement gives the front-end writer more control over the restore experience and a better administrator user experience overall.</span></span> <span data-ttu-id="e135e-176">Поскольку резервные копии в каждой из систем не происходят в одной точке во времени, модуль записи внешнего интерфейса должен выполнить некоторую очистку данных серверной части.</span><span class="sxs-lookup"><span data-stu-id="e135e-176">Because the backups across each of the systems do not occur at the same point in time, the front-end writer will need to perform some cleanup of the back-end data.</span></span> <span data-ttu-id="e135e-177">В примере приложения, рассмотренного в предыдущем разделе "объявление удаленных зависимостей", модуль записи должен инициировать повторное сопоставление или повторную индексацию сайта после завершения восстановления одной из серверных баз данных.</span><span class="sxs-lookup"><span data-stu-id="e135e-177">In the example application discussed in the preceding "Declaring Remote Dependencies", the writer should initiate a site remapping or reindexing after a restore of one of the back-end databases has completed.</span></span> <span data-ttu-id="e135e-178">Для этого модуль записи должен получить события на сервере переднего плана.</span><span class="sxs-lookup"><span data-stu-id="e135e-178">To do this, the writer must receive events on the front-end server.</span></span> <span data-ttu-id="e135e-179">В следующей процедуре показано, что должен делать инициатор запроса:</span><span class="sxs-lookup"><span data-stu-id="e135e-179">The following procedure outlines what the requester should do:</span></span>

1.  <span data-ttu-id="e135e-180">На локальном компьютере инициатор запроса вызывает [**ивссбаккупкомпонентс:: инитиализефорресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore), [**гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**ивссбаккупкомпонентс:: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) (или [**IVssBackupComponentsEx:: SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)) и [**предвосстановление**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).</span><span class="sxs-lookup"><span data-stu-id="e135e-180">On the local computer, the requester calls [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) (or [**IVssBackupComponentsEx::SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)), and [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).</span></span>
2.  <span data-ttu-id="e135e-181">После завершения этапа предварительного [**восстановления**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) , но до начала этапа [**восстановления**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) , инициатор запроса заставит в очередь дополнительные задания восстановления, отправив запрос агенту на удаленном компьютере.</span><span class="sxs-lookup"><span data-stu-id="e135e-181">After the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) phase is completed, but before the [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) phase begins, the requester spools additional restore jobs by sending a request to its agent on the remote computer.</span></span>
3.  <span data-ttu-id="e135e-182">На удаленном компьютере агент инициатора запроса выполняет задания восстановления в очереди, вызывая [**инитиализефорресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore), [**гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**сетселектедфорресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore), [**RESTORE**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore), [**сетфилересторестатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus) (или [**SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)) и [**инструкцию RESTORE**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span><span class="sxs-lookup"><span data-stu-id="e135e-182">On the remote computer, the requester's agent performs the spooled restore jobs by calling [**InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore), [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore), [**SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus) (or [**SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)), and [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span></span>
4.  <span data-ttu-id="e135e-183">Когда агент инициатора запроса завершает задания, помещенные в очередь на удаленном компьютере, инициатор запроса завершает последовательность восстановления, вызывая [**ивссбаккупкомпонентс:: сетфилересторестатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus) и [**инструкцию RESTORE**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span><span class="sxs-lookup"><span data-stu-id="e135e-183">When the requester's agent has completed the spooled jobs on the remote computer, the requester completes the restore sequence by calling [**IVssBackupComponents::SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus) and [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span></span>

<span data-ttu-id="e135e-184">Чтобы обеспечить частичную поддержку удаленных зависимостей, запрашивающая сторона должна следовать удаленным зависимостям и включать их в состав резервной копии, но порядок событий в системах внешнего интерфейса и серверной части, как описано в предыдущих двух процедурах, не потребуется.</span><span class="sxs-lookup"><span data-stu-id="e135e-184">To provide partial support for remote dependencies, the requester must follow remote dependencies and include them as part of the backup, but the ordering of events on front-end and back-end systems as detailed in the previous two procedures would not be required.</span></span> <span data-ttu-id="e135e-185">Для инициатора запроса, который реализует только частичную поддержку, инициатор запроса должен обратиться к документации по резервному копированию и восстановлению приложения записи, чтобы понять, какие сценарии поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="e135e-185">For a requester that implements only partial support, the requester should refer to the writer application's backup/restore documentation to understand what scenarios can be supported.</span></span>

 

 
