---
description: Сведения о роли модуля записи в добавочных и разностных резервных копиях, требующих тесного взаимодействия между запрашивающими и модулями записи.
ms.assetid: 3cf5dd1f-dc58-42bc-925f-fee7d34053c5
title: Роль модуля записи при резервном копировании сложных хранилищ
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 30e34952cc4a2184d2f9abcc43283d24f64bdcc3
ms.sourcegitcommit: d0eb44d0a95f5e5efbfec3d3e9c143f5cba25bc3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/17/2021
ms.locfileid: "112262156"
---
# <a name="writer-role-in-backing-up-complex-stores"></a><span data-ttu-id="72b2e-103">Роль модуля записи при резервном копировании сложных хранилищ</span><span class="sxs-lookup"><span data-stu-id="72b2e-103">Writer Role in Backing Up Complex Stores</span></span>

<span data-ttu-id="72b2e-104">Как и все важные операции в VSS, [*добавочные*](vssgloss-i.md) и [*разностные*](vssgloss-d.md) резервные копии потребовали тесного взаимодействия между запрашивающими стороны и модулями записи.</span><span class="sxs-lookup"><span data-stu-id="72b2e-104">As with all important operations under VSS, [*incremental*](vssgloss-i.md) and [*differential*](vssgloss-d.md) backups require close cooperation between requesters and writers.</span></span>

## <a name="backup-types"></a><span data-ttu-id="72b2e-105">Типы резервного копирования</span><span class="sxs-lookup"><span data-stu-id="72b2e-105">Backup Types</span></span>

<span data-ttu-id="72b2e-106">Инфраструктура обеспечивает специальную поддержку пяти типов резервных копий.</span><span class="sxs-lookup"><span data-stu-id="72b2e-106">The infrastructure provides special support for five types of backup.</span></span> <span data-ttu-id="72b2e-107">Они описаны ниже.</span><span class="sxs-lookup"><span data-stu-id="72b2e-107">They are described as follows:</span></span>

-   <span data-ttu-id="72b2e-108">Full (**\_ \_ полная резервная служба VSS**).</span><span class="sxs-lookup"><span data-stu-id="72b2e-108">Full (**VSS\_BT\_FULL**).</span></span> <span data-ttu-id="72b2e-109">Файлы будут архивироваться независимо от даты их последнего резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72b2e-109">Files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="72b2e-110">Будет обновлен Журнал резервного копирования каждого файла, и этот тип резервного копирования можно использовать в качестве основы для добавочной или разностной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="72b2e-110">The backup history of each file will be updated, and this type of backup can be used as the basis of an incremental or differential backup.</span></span> <span data-ttu-id="72b2e-111">Если имеются файлы журнала, они могут быть усечены в результате резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72b2e-111">If there are log files, they may be truncated as a result of this backup.</span></span>

    <span data-ttu-id="72b2e-112">Для восстановления полной резервной копии требуется только один образ резервной копии.</span><span class="sxs-lookup"><span data-stu-id="72b2e-112">Restoring a full backup requires only a single backup image.</span></span>

-   <span data-ttu-id="72b2e-113">Разностная (**VSS \_ BT \_ разностная**).</span><span class="sxs-lookup"><span data-stu-id="72b2e-113">Differential (**VSS\_BT\_DIFFERENTIAL**).</span></span> <span data-ttu-id="72b2e-114">API VSS используется, чтобы гарантировать копирование только тех файлов, которые были изменены или добавлены с момента последнего полного резервного копирования, на носитель. все промежуточные резервные копии игнорируются.</span><span class="sxs-lookup"><span data-stu-id="72b2e-114">The VSS API is used to ensure that only files that have been changed or added since the last full backup are to be copied to a storage medium; all intermediate backup information is ignored.</span></span> <span data-ttu-id="72b2e-115">Это могут быть целые файлы или определенные диапазоны в файлах.</span><span class="sxs-lookup"><span data-stu-id="72b2e-115">This may include entire files, or specific ranges within files.</span></span> <span data-ttu-id="72b2e-116">Разностная резервная копия связана с полной резервной копией и обычно не может быть восстановлена до тех пор, пока не будет восстановлена полная резервная копия.</span><span class="sxs-lookup"><span data-stu-id="72b2e-116">A differential backup is associated with a full backup, and generally cannot be restored until the full backup has been restored.</span></span> <span data-ttu-id="72b2e-117">Если имеются файлы журнала, они обычно не усекаются в результате резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72b2e-117">If there are log files, they will usually not be truncated as a result of this backup.</span></span>

    <span data-ttu-id="72b2e-118">Для восстановления разностной резервной копии требуется исходный образ резервной копии и последняя разностная резервная копия, созданная с момента последнего полного резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72b2e-118">Restoring a differential backup requires the original backup image and the most recent differential backup image made since the last full backup.</span></span>

-   <span data-ttu-id="72b2e-119">Добавочная **( \_ \_ добавочная служба VSS**).</span><span class="sxs-lookup"><span data-stu-id="72b2e-119">Incremental (**VSS\_BT\_INCREMENTAL**).</span></span> <span data-ttu-id="72b2e-120">API VSS используется, чтобы гарантировать копирование только тех файлов, которые были изменены или добавлены с момента последнего полного или добавочного резервного копирования, на носитель.</span><span class="sxs-lookup"><span data-stu-id="72b2e-120">The VSS API is used to ensure that only files that have been changed or added since the last full or incremental backup are to be copied to a storage medium.</span></span> <span data-ttu-id="72b2e-121">Это могут быть целые файлы или определенные диапазоны в файлах.</span><span class="sxs-lookup"><span data-stu-id="72b2e-121">This may include entire files, or specific ranges within files.</span></span> <span data-ttu-id="72b2e-122">Некоторые модули записи не позволяют смешивать добавочные резервные копии с разностными резервными копиями.</span><span class="sxs-lookup"><span data-stu-id="72b2e-122">Some writers do not allow incremental backups to be mixed with differential backups.</span></span> <span data-ttu-id="72b2e-123">Если имеются файлы журнала, они могут быть усечены в результате резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72b2e-123">If there are log files, they may be truncated as a result of this backup.</span></span>

    <span data-ttu-id="72b2e-124">Для восстановления добавочной резервной копии требуется исходный образ резервного копирования и все добавочные образы резервных копий, созданные с момента создания исходной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="72b2e-124">Restoring an incremental backup requires the original backup image and all incremental backup images made since the initial backup.</span></span>

-   <span data-ttu-id="72b2e-125">Резервная копия журнала (**\_ \_ Журнал VSS BT**).</span><span class="sxs-lookup"><span data-stu-id="72b2e-125">Log Backup (**VSS\_BT\_LOG**).</span></span> <span data-ttu-id="72b2e-126">Будет создана резервная копия только файлов журнала модуля записи (файлов, добавленных в компонент с помощью метода [**ивсскреатевритерметадата:: адддатабаселогфилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) и получаемых путем вызова [**Ивссвмкомпонент:: жетдатабаселогфиле**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile)).</span><span class="sxs-lookup"><span data-stu-id="72b2e-126">Only a writer's log files (files added to a component with the [**IVssCreateWriterMetadata::AddDataBaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) method, and retrieved by a call to [**IVssWMComponent::GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile)) will be backed up.</span></span> <span data-ttu-id="72b2e-127">Этот тип резервного копирования относится только к VSS.</span><span class="sxs-lookup"><span data-stu-id="72b2e-127">This backup type is specific to VSS.</span></span> <span data-ttu-id="72b2e-128">Резервные копии журналов обычно выполняются довольно часто.</span><span class="sxs-lookup"><span data-stu-id="72b2e-128">Log backups tend to be taken quite frequently.</span></span> <span data-ttu-id="72b2e-129">Как правило, файл журнала будет усечен в результате резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72b2e-129">Typically, the log file will be truncated as a result of this backup.</span></span>
-   <span data-ttu-id="72b2e-130">Копирование резервной копии (**\_ BT- \_ копия VSS**).</span><span class="sxs-lookup"><span data-stu-id="72b2e-130">Copy Backup (**VSS\_BT\_COPY**).</span></span> <span data-ttu-id="72b2e-131">Как и в \_ \_ случае с типом данных BT Full, резервное копирование файлов выполняется независимо от даты их последнего резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72b2e-131">Like the VSS\_BT\_FULL backup type, files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="72b2e-132">Однако журнал резервного копирования каждого файла не будет обновлен, и этот тип резервного копирования нельзя использовать в качестве основы для добавочной или разностной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="72b2e-132">However, the backup history of each file will not be updated, and this type of backup cannot be used as the basis of an incremental or differential backup.</span></span> <span data-ttu-id="72b2e-133">Файлы журнала никогда не следует усекать в результате резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72b2e-133">Log files should never be truncated as a result of a copy backup.</span></span>

<dl> <dt>

<span data-ttu-id="72b2e-134"><span id="Partial_File_Support"></span><span id="partial_file_support"></span><span id="PARTIAL_FILE_SUPPORT"></span>Частичная поддержка файлов</span><span class="sxs-lookup"><span data-stu-id="72b2e-134"><span id="Partial_File_Support"></span><span id="partial_file_support"></span><span id="PARTIAL_FILE_SUPPORT"></span>Partial File Support</span></span>
</dt> <dd>

<span data-ttu-id="72b2e-135">Некоторые модули записи поддерживают восстановление файлов с помощью перезаписи частей файлов, которыми они управляют.</span><span class="sxs-lookup"><span data-stu-id="72b2e-135">Some writers support file restoration through the overwriting of parts of the files they manage.</span></span> <span data-ttu-id="72b2e-136">Инициатор запроса может воспользоваться преимуществами этого метода, и если да, то он указывает, что нужно установить сведения в [**ивссбаккупкомпонентс:: сетбаккупстате**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span><span class="sxs-lookup"><span data-stu-id="72b2e-136">A requester may be designed to take advantage of this, and if so it indicates this by setting the information in [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span></span>

</dd> </dl>

<span data-ttu-id="72b2e-137">Модули записи указывают, какие типы резервных копий поддерживаются путем вызова [**ивсскреатевритерметадата:: сетбаккупсчема**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) при обработке события [*Identify*](vssgloss-i.md) .</span><span class="sxs-lookup"><span data-stu-id="72b2e-137">The writers indicate what type of backups are supported by calling [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) while processing the [*Identify*](vssgloss-i.md) event.</span></span> <span data-ttu-id="72b2e-138">Параметр *дссчемамаск* метода **Ивсскреатевритерметадата:: сетбаккупсчема** является битовой маской, указывающей, какие типы резервного копирования поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="72b2e-138">The *dsSchemaMask* parameter to the **IVssCreateWriterMetadata::SetBackupSchema** method is a bit mask indicating what types of backup are supported.</span></span> <span data-ttu-id="72b2e-139">Все модули записи должны поддерживать полное резервное копирование.</span><span class="sxs-lookup"><span data-stu-id="72b2e-139">All writers must support full backups.</span></span>

<dl> <dt>

<span data-ttu-id="72b2e-140"><span id="VSS_BS_DIFFERENTIAL"></span><span id="vss_bs_differential"></span>**\_ \_ разностный резерв VSS**</span><span class="sxs-lookup"><span data-stu-id="72b2e-140"><span id="VSS_BS_DIFFERENTIAL"></span><span id="vss_bs_differential"></span>**VSS\_BS\_DIFFERENTIAL**</span></span>
</dt> <dd>

<span data-ttu-id="72b2e-141">Указывает поддержку для разностных резервных копий.</span><span class="sxs-lookup"><span data-stu-id="72b2e-141">Indicates support for differential backups.</span></span>

</dd> <dt>

<span data-ttu-id="72b2e-142"><span id="VSS_BS_INCREMENTAL"></span><span id="vss_bs_incremental"></span>**\_ \_ добавочное УТОЧНЕНие VSS**</span><span class="sxs-lookup"><span data-stu-id="72b2e-142"><span id="VSS_BS_INCREMENTAL"></span><span id="vss_bs_incremental"></span>**VSS\_BS\_INCREMENTAL**</span></span>
</dt> <dd>

<span data-ttu-id="72b2e-143">Указывает поддержку добавочного резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72b2e-143">Indicates support for incremental backups.</span></span>

</dd> <dt>

<span data-ttu-id="72b2e-144"><span id="VSS_BS_LOG"></span><span id="vss_bs_log"></span>**\_Журнал "BS" VSS \_**</span><span class="sxs-lookup"><span data-stu-id="72b2e-144"><span id="VSS_BS_LOG"></span><span id="vss_bs_log"></span>**VSS\_BS\_LOG**</span></span>
</dt> <dd>

<span data-ttu-id="72b2e-145">Указывает на поддержку резервного копирования журналов.</span><span class="sxs-lookup"><span data-stu-id="72b2e-145">Indicates support for log backups.</span></span>

</dd> <dt>

<span data-ttu-id="72b2e-146"><span id="VSS_BS_COPY"></span><span id="vss_bs_copy"></span>**\_копия BS \_ VSS**</span><span class="sxs-lookup"><span data-stu-id="72b2e-146"><span id="VSS_BS_COPY"></span><span id="vss_bs_copy"></span>**VSS\_BS\_COPY**</span></span>
</dt> <dd>

<span data-ttu-id="72b2e-147">Указывает поддержку резервного копирования копий.</span><span class="sxs-lookup"><span data-stu-id="72b2e-147">Indicates support for copy backups.</span></span>

</dd> <dt>

<span data-ttu-id="72b2e-148"><span id="VSS_BS_EXCLUSIVE_INCREMENTAL_DIFFERENTIAL"></span><span id="vss_bs_exclusive_incremental_differential"></span>**\_ \_ монопольная \_ добавочная \_ разностная копия VSS**</span><span class="sxs-lookup"><span data-stu-id="72b2e-148"><span id="VSS_BS_EXCLUSIVE_INCREMENTAL_DIFFERENTIAL"></span><span id="vss_bs_exclusive_incremental_differential"></span>**VSS\_BS\_EXCLUSIVE\_INCREMENTAL\_DIFFERENTIAL**</span></span>
</dt> <dd>

<span data-ttu-id="72b2e-149">Указывает, что модуль записи не поддерживает смешивание добавочных резервных копий с разностными резервными копиями.</span><span class="sxs-lookup"><span data-stu-id="72b2e-149">Indicates that a writer does not support mixing incremental backups with differential backups.</span></span>

</dd> </dl>

<span data-ttu-id="72b2e-150">Модуль записи может определить, какой тип резервного копирования выполняется путем вызова [**квссвритер:: жетбаккуптипе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getbackuptype).</span><span class="sxs-lookup"><span data-stu-id="72b2e-150">The writer can determine what type of backup is being performed by calling [**CVssWriter::GetBackupType**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getbackuptype).</span></span> <span data-ttu-id="72b2e-151">Самый ранний момент, когда это может быть выполнено, — это обработка события PrepareForBackup.</span><span class="sxs-lookup"><span data-stu-id="72b2e-151">The earliest point when this can be performed is while processing the PrepareForBackup event.</span></span> <span data-ttu-id="72b2e-152">**Квссвритер:: жетбаккуптипе** будет возвращать элемент перечисления [**\_ \_ типа резервного копирования VSS**](/windows/desktop/api/Vss/ne-vss-vss_backup_type) .</span><span class="sxs-lookup"><span data-stu-id="72b2e-152">**CVssWriter::GetBackupType** will return a member of the [**VSS\_BACKUP\_TYPE**](/windows/desktop/api/Vss/ne-vss-vss_backup_type) enumeration.</span></span> <span data-ttu-id="72b2e-153">Если тип резервного копирования не поддерживается модулем записи, то модуль записи должен считать резервную копию полной резервной копией.</span><span class="sxs-lookup"><span data-stu-id="72b2e-153">If the backup type is not supported by the writer, then the writer should treat the backup as a full backup.</span></span>

## <a name="backup-stamps"></a><span data-ttu-id="72b2e-154">Метки резервного копирования</span><span class="sxs-lookup"><span data-stu-id="72b2e-154">Backup Stamps</span></span>

<span data-ttu-id="72b2e-155">Добавочные и разностные резервные копии всегда привязаны к предыдущей резервной копии.</span><span class="sxs-lookup"><span data-stu-id="72b2e-155">Incremental and differential backups are always tied to a previous backup.</span></span> <span data-ttu-id="72b2e-156">Существует два способа привязки резервных копий.</span><span class="sxs-lookup"><span data-stu-id="72b2e-156">There are two ways to tie backups.</span></span> <span data-ttu-id="72b2e-157">Для простых хранилищ данных инициатор запроса может вести отслеживание корреляции между резервными копиями.</span><span class="sxs-lookup"><span data-stu-id="72b2e-157">For simple data stores, the requester can keep track of the correlation between backups.</span></span> <span data-ttu-id="72b2e-158">Однако для более сложных хранилищ данных модуль записи должен поддерживать собственную метку времени с помощью резервной копии. Эта метка времени может вести отслеживание расположения журнала, сведений о контрольных точках и т. д.</span><span class="sxs-lookup"><span data-stu-id="72b2e-158">However, for more complex data stores, the writer will need to maintain its own timestamp with the backup; this timestamp may keep track of log position, checkpoint information, and so on.</span></span> <span data-ttu-id="72b2e-159">Модуль записи указывает, что ему требуются собственные метки времени, установив бит **" \_ \_ Метка времени** (в VSS)" в случае вызова [**ивсскреатевритерметадата:: сетбаккупсчема**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema).</span><span class="sxs-lookup"><span data-stu-id="72b2e-159">A writer indicates that it needs its own timestamps by setting the **VSS\_BS\_TIMESTAMPED** bit when it calls [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema).</span></span>

<span data-ttu-id="72b2e-160">Модуль записи может хранить метку времени в каждом компоненте, для которого выполняется резервное копирование.</span><span class="sxs-lookup"><span data-stu-id="72b2e-160">A writer can store a timestamp with each component that is being backed up.</span></span> <span data-ttu-id="72b2e-161">Модуль записи сохраняет метку времени путем вызова [**ивсскомпонент:: сетбаккупстамп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp)и передает строковое представление метки для параметра *всзбаккупстамп* .</span><span class="sxs-lookup"><span data-stu-id="72b2e-161">The writer stores the timestamp by calling [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp), and passing in a string representation of the stamp for the *wszBackupStamp* parameter.</span></span> <span data-ttu-id="72b2e-162">Как правило, модуль записи будет вызывать этот метод при обработке события [*моментального снимка*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="72b2e-162">Generally, a writer will call this method while processing the [*PostSnapshot*](vssgloss-p.md) event.</span></span> <span data-ttu-id="72b2e-163">Однако для резервных копий, которые не используют теневую копию, событие моментального снимка не будет отправлено.</span><span class="sxs-lookup"><span data-stu-id="72b2e-163">However, for backups that do not involve a shadow copy, the PostSnapshot event will not be sent.</span></span> <span data-ttu-id="72b2e-164">В этом случае при обработке события [*PrepareForBackup*](vssgloss-p.md) необходимо вызвать **Ивсскомпонент:: сетбаккупстамп** .</span><span class="sxs-lookup"><span data-stu-id="72b2e-164">In this case, **IVssComponent::SetBackupStamp** must be called while processing the [*PrepareForBackup*](vssgloss-p.md) event.</span></span>

<span data-ttu-id="72b2e-165">Когда выполняется добавочная или разностная резервная копия, инициатор запроса сообщает модулю записи о резервной копии предыдущей резервной копии, которая является базой для этой резервной копии.</span><span class="sxs-lookup"><span data-stu-id="72b2e-165">When an incremental or differential backup is being performed, the requester will indicate to the writer the backup stamp of the previous backup that is serving as a base for this backup.</span></span> <span data-ttu-id="72b2e-166">Модуль записи может получить доступ к предыдущей метке резервного копирования при обработке события PrepareForBackup или snapshot, вызвав [**ивсскомпонент:: жетпревиаусбаккупстамп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="72b2e-166">The writer can access this previous backup stamp while processing either the PrepareForBackup or PostSnapshot event, by calling [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span></span> <span data-ttu-id="72b2e-167">Модуль записи может использовать возвращенную отметку, чтобы определить, какие резервные копии необходимо создать.</span><span class="sxs-lookup"><span data-stu-id="72b2e-167">The writer can use the returned stamp to determine what needs to be backed up.</span></span>

## <a name="backup-strategies"></a><span data-ttu-id="72b2e-168">Стратегии резервного копирования</span><span class="sxs-lookup"><span data-stu-id="72b2e-168">Backup Strategies</span></span>

### <a name="file-backup-files-strategies"></a><span data-ttu-id="72b2e-169">Стратегии файлов резервных копий файлов</span><span class="sxs-lookup"><span data-stu-id="72b2e-169">File Backup Files Strategies</span></span>

<span data-ttu-id="72b2e-170">Часто при выполнении определенных типов резервного копирования некоторые файлы, зарегистрированные в метаданных модуля записи, должны быть резервными.</span><span class="sxs-lookup"><span data-stu-id="72b2e-170">Often, certain files reported in the writer metadata need only be backed up when performing certain types of backup.</span></span> <span data-ttu-id="72b2e-171">Некоторые файлы могут потребоваться только при выполнении полной архивации.</span><span class="sxs-lookup"><span data-stu-id="72b2e-171">Some files may only be required when performing a full backup.</span></span> <span data-ttu-id="72b2e-172">Другие файлы могут потребоваться только при выполнении добавочной или разностной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="72b2e-172">Other files may only be required when performing an incremental or differential backup.</span></span> <span data-ttu-id="72b2e-173">VSS предоставляет разработчикам метод для указания этой информации запрашивающей стороне.</span><span class="sxs-lookup"><span data-stu-id="72b2e-173">VSS provides a method for the writers to indicate this information to the requester.</span></span> <span data-ttu-id="72b2e-174">При добавлении файлов в компоненты с помощью [**ивсскреатевритерметадата:: адддатабасефилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**Ивсскреатевритерметадата:: адддатабаселогфилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)или [**IVssCreateWriterMetadata:: AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)параметр *dwBackupTypeMask* указывает, для каких типов резервного копирования должны быть резервные копии этих файлов.</span><span class="sxs-lookup"><span data-stu-id="72b2e-174">When adding files to components using [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup), the *dwBackupTypeMask* parameter indicates for which backup types these files must be backed up.</span></span> <span data-ttu-id="72b2e-175">Маска может содержать одно или несколько из следующих значений:</span><span class="sxs-lookup"><span data-stu-id="72b2e-175">The mask can contain one or more of the following values:</span></span>

<dl> <dt>

<span data-ttu-id="72b2e-176"><span id="VSS_FSBT_FULL_BACKUP_REQUIRED"></span><span id="vss_fsbt_full_backup_required"></span>**\_ \_ \_ требуется полная резервная копия VSS фсбт \_**</span><span class="sxs-lookup"><span data-stu-id="72b2e-176"><span id="VSS_FSBT_FULL_BACKUP_REQUIRED"></span><span id="vss_fsbt_full_backup_required"></span>**VSS\_FSBT\_FULL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="72b2e-177">Требуется для полных резервных копий.</span><span class="sxs-lookup"><span data-stu-id="72b2e-177">Required for full backups.</span></span>

</dd> <dt>

<span data-ttu-id="72b2e-178"><span id="VSS_FSBT_DIFFERENTIAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_differential_backup_required"></span>**\_ \_ требуется разностное \_ резервное копирование VSS фсбт \_**</span><span class="sxs-lookup"><span data-stu-id="72b2e-178"><span id="VSS_FSBT_DIFFERENTIAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_differential_backup_required"></span>**VSS\_FSBT\_DIFFERENTIAL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="72b2e-179">Требуется для разностного резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72b2e-179">Required for differential backups.</span></span>

</dd> <dt>

<span data-ttu-id="72b2e-180"><span id="VSS_FSBT_INCREMENTAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_incremental_backup_required"></span>**\_ \_ требуется добавочное \_ резервное копирование VSS фсбт \_**</span><span class="sxs-lookup"><span data-stu-id="72b2e-180"><span id="VSS_FSBT_INCREMENTAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_incremental_backup_required"></span>**VSS\_FSBT\_INCREMENTAL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="72b2e-181">Требуется для добавочного резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72b2e-181">Required for incremental backups.</span></span>

</dd> <dt>

<span data-ttu-id="72b2e-182"><span id="VSS_FSBT_LOG_BACKUP_REQUIRED"></span><span id="vss_fsbt_log_backup_required"></span>**\_ \_ \_ требуется резервная копия журнала фсбт для VSS \_**</span><span class="sxs-lookup"><span data-stu-id="72b2e-182"><span id="VSS_FSBT_LOG_BACKUP_REQUIRED"></span><span id="vss_fsbt_log_backup_required"></span>**VSS\_FSBT\_LOG\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="72b2e-183">Требуется для резервного копирования журнала.</span><span class="sxs-lookup"><span data-stu-id="72b2e-183">Required for log backups.</span></span>

</dd> <dt>

<span data-ttu-id="72b2e-184"><span id="VSS_FSBT_ALL_BACKUP_REQUIRED"></span><span id="vss_fsbt_all_backup_required"></span>**\_ФСБТ VSS \_ \_ требуется вся резервная копия \_**</span><span class="sxs-lookup"><span data-stu-id="72b2e-184"><span id="VSS_FSBT_ALL_BACKUP_REQUIRED"></span><span id="vss_fsbt_all_backup_required"></span>**VSS\_FSBT\_ALL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="72b2e-185">Требуется для всех типов резервных копий; Это значение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="72b2e-185">Required for all backup types; this is the default.</span></span>

</dd> </dl>

<span data-ttu-id="72b2e-186">Эта спецификация переопределяет спецификацию селективности компонента.</span><span class="sxs-lookup"><span data-stu-id="72b2e-186">This specification overrides the component's selectivity specification.</span></span> <span data-ttu-id="72b2e-187">Например, рассмотрим компонент, файлы которого все помечены с помощью **\_ \_ \_ резервной копии журнала \_ фсбт VSS** , но **не \_ \_ требуются для полной \_ резервной копии \_ фсбт VSS**.</span><span class="sxs-lookup"><span data-stu-id="72b2e-187">For example, consider a component whose files are all marked with **VSS\_FSBT\_LOG\_BACKUP\_REQUIRED** but not with **VSS\_FSBT\_FULL\_BACKUP\_REQUIRED**.</span></span> <span data-ttu-id="72b2e-188">Предположим, этот компонент не может быть выбран для резервного копирования (*бселектабле* был ложным при вызове [**Ивсскреатевритерметадата:: AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) ).</span><span class="sxs-lookup"><span data-stu-id="72b2e-188">Suppose this component is not selectable for backup (*bSelectable* was false when [**IVssCreateWriterMetadata::AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) was called).</span></span> <span data-ttu-id="72b2e-189">В случае резервного копирования журнала это означает, что все файлы в этом компоненте всегда должны быть резервными копиями.</span><span class="sxs-lookup"><span data-stu-id="72b2e-189">In the case of a log backup, this means that all the files in this component must always be backed up.</span></span> <span data-ttu-id="72b2e-190">Однако в случае полного резервного копирования ни один из файлов не нуждается в резервном копировании, несмотря на тот факт, что избирательность компонента требует резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72b2e-190">However, in the case of a full backup, none of the files need to be backed up, despite the fact that the component's selectivity implies it should be backed up.</span></span>

### <a name="backup-by-last-modify-time"></a><span data-ttu-id="72b2e-191">Резервное копирование по времени последнего изменения</span><span class="sxs-lookup"><span data-stu-id="72b2e-191">Backup By Last Modify Time</span></span>

<span data-ttu-id="72b2e-192">Один из способов, позволяющий модулю записи указать, какие файлы были изменены, — использовать механизм сравнения файлов.</span><span class="sxs-lookup"><span data-stu-id="72b2e-192">One way for a writer to indicate what files have changed is by using the differenced file mechanism.</span></span> <span data-ttu-id="72b2e-193">Модуль записи может указать, что необходимо создать резервную копию определенных файлов компонента, только если они были изменены с момента определенного времени.</span><span class="sxs-lookup"><span data-stu-id="72b2e-193">A writer can specify that certain files in a component should only be backed up if they have been modified since a certain time.</span></span> <span data-ttu-id="72b2e-194">Модуль записи вызывает [**ивсскомпонент:: адддифференцедфилесбиластмодифитиме**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) с указанием файла и последним временем изменения.</span><span class="sxs-lookup"><span data-stu-id="72b2e-194">The writer calls [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) with a file specification and a last modify time.</span></span> <span data-ttu-id="72b2e-195">**Ивсскомпонент:: адддифференцедфилесбиластмодифитиме** обычно вызывается при обработке события моментального снимка, хотя его можно вызвать при обработке события PrepareForBackup.</span><span class="sxs-lookup"><span data-stu-id="72b2e-195">**IVssComponent::AddDifferencedFilesByLastModifyTime** is typically called while processing the PostSnapshot event, although it can be called while processing the PrepareForBackup event.</span></span> <span data-ttu-id="72b2e-196">Затем инициатор запроса должен выполнить резервное копирование всех файлов, соответствующих спецификации файла, измененной с момента указанного времени.</span><span class="sxs-lookup"><span data-stu-id="72b2e-196">The requester must then back up all files matching the file specification that have changed since the specified time.</span></span> <span data-ttu-id="72b2e-197">Если модуль записи использует механизм отметки резервного копирования, это время последнего изменения будет определяться на основе предыдущей метки резервного копирования в документе резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72b2e-197">If the writer is using the backup stamp mechanism, this last modify time will be determined based on the previous backup stamp in the backup document.</span></span> <span data-ttu-id="72b2e-198">Кроме того, модуль записи может передать нулевое значение в течение последнего изменения. Это означает, что инициатор запроса отвечает за определение времени последней резервной копии и файлов, измененных с момента этого времени.</span><span class="sxs-lookup"><span data-stu-id="72b2e-198">The writer can also pass in zero for the last modify time, which indicates that the requester is responsible for determining the time of the last backup and the files changed since that time.</span></span>

### <a name="partial-file-backup"></a><span data-ttu-id="72b2e-199">Частичная Архивация файлов</span><span class="sxs-lookup"><span data-stu-id="72b2e-199">Partial File Backup</span></span>

<span data-ttu-id="72b2e-200">Другой способ, чтобы средство записи указывало изменения в инициаторе запроса, использует механизм частичного файла.</span><span class="sxs-lookup"><span data-stu-id="72b2e-200">Another way for a writer to indicate changes to the requester is by using the partial-file mechanism.</span></span> <span data-ttu-id="72b2e-201">Модуль записи может указывать диапазоны байтов в файлах компонентов, для которых необходимо создать резервную копию; модуль записи может указать эти диапазоны файлов при обработке события PrepareForBackup или моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="72b2e-201">A writer can specify byte ranges within component files that need to be backed up; the writer may specify these file ranges while processing either the PostSnapshot or PrepareForBackup event.</span></span> <span data-ttu-id="72b2e-202">Модуль записи вызывает [**ивсскомпонент:: аддпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) для добавления полных спецификаций файлов в резервную копию.</span><span class="sxs-lookup"><span data-stu-id="72b2e-202">The writer calls [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) to add partial file specifications to the backup.</span></span> <span data-ttu-id="72b2e-203">Частичная спецификация файла состоит из пути и имени файла вместе со сведениями о том, какие диапазоны в файле необходимо архивировать.</span><span class="sxs-lookup"><span data-stu-id="72b2e-203">A partial file specification consists of a path and file name together with information about what ranges in the file need to be backed up.</span></span>

### <a name="file-specification-rules"></a><span data-ttu-id="72b2e-204">Правила спецификации файла</span><span class="sxs-lookup"><span data-stu-id="72b2e-204">File Specification Rules</span></span>

<span data-ttu-id="72b2e-205">[**Ивсскомпонент:: адддифференцедфилесбиластмодифитиме**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) или [**Ивсскомпонент:: аддпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) можно использовать для изменения спецификаций файлов, заданных во время события Identify, или для добавления в спецификацию совершенно новых файлов.</span><span class="sxs-lookup"><span data-stu-id="72b2e-205">[**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) or [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) can both be used to modify file specifications given during the Identify event, or to add completely new files to the specification.</span></span> <span data-ttu-id="72b2e-206">Если модуль записи изменяет сведения, заданные во время события определения с помощью **ивсскомпонент:: адддифференцедфилесбиластмодифитиме**, спецификация файла должна точно соответствовать одной из спецификаций файла в текущем компоненте.</span><span class="sxs-lookup"><span data-stu-id="72b2e-206">If the writer is modifying information set during the Identify event using **IVssComponent::AddDifferencedFilesByLastModifyTime**, then the file specification must exactly match one of the file specifications in the current component.</span></span> <span data-ttu-id="72b2e-207">Спецификация файла не должна частично перекрывать файлы в текущем компоненте и не должна совпадать с файлами в других компонентах.</span><span class="sxs-lookup"><span data-stu-id="72b2e-207">The file specification must not partially overlap files in the current component, and it must not match files in any other components.</span></span> <span data-ttu-id="72b2e-208">Однако файлы, указанные с помощью **ивсскомпонент:: аддпартиалфиле** , могут частично перекрывать другую спецификацию файла.</span><span class="sxs-lookup"><span data-stu-id="72b2e-208">Files specified using **IVssComponent::AddPartialFile** can, however, partially overlap another file specification.</span></span> <span data-ttu-id="72b2e-209">Сведения, заданные с помощью **ивсскомпонент:: адддифференцедфилесбиластмодифитиме** или **Ивсскомпонент:: аддпартиалфиле** , переопределяют набор данных ранее с помощью интерфейса [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) в ответ на событие Identify.</span><span class="sxs-lookup"><span data-stu-id="72b2e-209">Information set by **IVssComponent::AddDifferencedFilesByLastModifyTime** or **IVssComponent::AddPartialFile** overrides the information set earlier using the [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) interface in response to the Identify event.</span></span>

<span data-ttu-id="72b2e-210">Общие спецификации файлов могут иметь значение альтернативного расположения (заданное параметром *всзалтернателокатион* параметра [**Ивсскреатевритерметадата:: аддфилестофилеграуп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)), которое указывает на альтернативное расположение для получения файла во время резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72b2e-210">General file specifications can have an alternate-location value (set by the *wszAlternateLocation* parameter of [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) that indicates an alternate location to obtain the file from at backup time.</span></span> <span data-ttu-id="72b2e-211">Если спецификация файла, заданная с помощью механизма Difference-File или разделяемого файла, совпадает с существующей спецификацией файла, имеющей альтернативное расположение, приложение резервного копирования получит данные из этого альтернативного расположения.</span><span class="sxs-lookup"><span data-stu-id="72b2e-211">If the file specification set through the differenced-file or partial-file mechanisms matches an existing file specification that has an alternate location, the backup application will obtain the data from this alternate location.</span></span>

<span data-ttu-id="72b2e-212">Если спецификация файла, заданная в [**ивсскомпонент:: адддифференцедфилесбиластмодифитиме**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) или в [**Ивсскомпонент:: аддпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) , не совпадает и файлы в компоненте, для которого выполняется резервное копирование, теперь все соответствующие файлы будут добавлены в резервную копию.</span><span class="sxs-lookup"><span data-stu-id="72b2e-212">If the file specification set in [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) or in [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) does not match and files in the component that are being backed up, then all matching files are now added to the backup.</span></span> <span data-ttu-id="72b2e-213">Необходимо принять во внимание, что модуль записи добавляет только те файлы, которые существуют на том, который уже скопирован в теневом виде. в противном случае инициатору может не удастся создать резервную копию этих файлов.</span><span class="sxs-lookup"><span data-stu-id="72b2e-213">Care must be taken that the writer only adds files that exist on a volume that is already being shadow copied while doing this; otherwise, the requester may fail to back up these files.</span></span> <span data-ttu-id="72b2e-214">Если эти функции вызываются во время обработки события моментального снимка, это можно определить с помощью метода [**квссвритер:: испасаффектед**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected) .</span><span class="sxs-lookup"><span data-stu-id="72b2e-214">If these functions are called while processing the PostSnapshot event, this can be determined by using the [**CVssWriter::IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected) method.</span></span> <span data-ttu-id="72b2e-215">При вызове во время обработки события PrepareForBackup модуль записи должен выполнить это определение с помощью другого метода.</span><span class="sxs-lookup"><span data-stu-id="72b2e-215">If called while handling the PrepareForBackup event, the writer must make this determination using another method.</span></span>

### <a name="backup-without-a-shadow-copy"></a><span data-ttu-id="72b2e-216">Резервное копирование без теневой копии</span><span class="sxs-lookup"><span data-stu-id="72b2e-216">Backup Without a Shadow Copy</span></span>

<span data-ttu-id="72b2e-217">Для некоторых типов файлов резервное копирование тома теневой копии может не требоваться.</span><span class="sxs-lookup"><span data-stu-id="72b2e-217">Certain types of files may not need to be backed up off of a shadow copy volume.</span></span> <span data-ttu-id="72b2e-218">Например, это часто справедливо для файлов журнала базы данных.</span><span class="sxs-lookup"><span data-stu-id="72b2e-218">For example, this will often be true of database log files.</span></span> <span data-ttu-id="72b2e-219">Так как файлы журналов увеличиваются монотонно, и модуль записи может указать, какие части файла нужно архивировать с помощью частичных файлов, можно создать резервную копию журнала с исходного тома.</span><span class="sxs-lookup"><span data-stu-id="72b2e-219">Since log files grow monotonically, and a writer can specify exactly what portions of the file to back up using partial files, it will often be possible to back up the log off the original volume.</span></span> <span data-ttu-id="72b2e-220">В качестве оптимизации модуль записи может отметить, какие файлы нуждаются в теневых копиях для различных типов резервных копий с помощью флагов, заданных в параметре *Двбаккуптипемаск* [**Ивсскреатевритерметадата:: адддатабасефилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**Ивсскреатевритерметадата:: AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)или [**IVssCreateWriterMetadata:: AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup).</span><span class="sxs-lookup"><span data-stu-id="72b2e-220">As an optimization, a writer can mark which files require shadow copies for different backup types using the flags set in the *dwBackupTypeMask* parameter of [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup).</span></span> <span data-ttu-id="72b2e-221">К поддерживаемым флагам относятся следующие:</span><span class="sxs-lookup"><span data-stu-id="72b2e-221">Supported flags include the following:</span></span>

<dl> <dt>

<span data-ttu-id="72b2e-222"><span id="VSS_FSBT_FULL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_full_snapshot_required"></span>**\_ \_ \_ требуется полный моментальный снимок VSS фсбт \_**</span><span class="sxs-lookup"><span data-stu-id="72b2e-222"><span id="VSS_FSBT_FULL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_full_snapshot_required"></span>**VSS\_FSBT\_FULL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="72b2e-223">Для полных резервных копий требуется теневая копия.</span><span class="sxs-lookup"><span data-stu-id="72b2e-223">Shadow copy required for full backups.</span></span>

</dd> <dt>

<span data-ttu-id="72b2e-224"><span id="VSS_FSBT_DIFFERENTIAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_differential_snapshot_required"></span>**\_ \_ требуется разностный \_ моментальный снимок VSS фсбт \_**</span><span class="sxs-lookup"><span data-stu-id="72b2e-224"><span id="VSS_FSBT_DIFFERENTIAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_differential_snapshot_required"></span>**VSS\_FSBT\_DIFFERENTIAL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="72b2e-225">Для разностного резервного копирования требуется теневая копия.</span><span class="sxs-lookup"><span data-stu-id="72b2e-225">Shadow copy required for differential backups.</span></span>

</dd> <dt>

<span data-ttu-id="72b2e-226"><span id="VSS_FSBT_INCREMENTAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_incremental_snapshot_required"></span>**\_ \_ требуется добавочный \_ моментальный снимок VSS фсбт \_**</span><span class="sxs-lookup"><span data-stu-id="72b2e-226"><span id="VSS_FSBT_INCREMENTAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_incremental_snapshot_required"></span>**VSS\_FSBT\_INCREMENTAL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="72b2e-227">Для добавочного резервного копирования требуется теневое копирование.</span><span class="sxs-lookup"><span data-stu-id="72b2e-227">Shadow copy required for incremental backups.</span></span>

</dd> <dt>

<span data-ttu-id="72b2e-228"><span id="VSS_FSBT_LOG_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_log_snapshot_required"></span>**\_ \_ \_ требуется моментальный снимок журнала фсбт для VSS \_**</span><span class="sxs-lookup"><span data-stu-id="72b2e-228"><span id="VSS_FSBT_LOG_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_log_snapshot_required"></span>**VSS\_FSBT\_LOG\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="72b2e-229">Для резервного копирования журналов требуется теневая копия.</span><span class="sxs-lookup"><span data-stu-id="72b2e-229">Shadow copy required for log backups.</span></span>

</dd> <dt>

<span data-ttu-id="72b2e-230"><span id="VSS_FSBT_ALL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_all_snapshot_required"></span>**\_ \_ \_ требуется моментальный снимок фсбт для VSS \_**</span><span class="sxs-lookup"><span data-stu-id="72b2e-230"><span id="VSS_FSBT_ALL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_all_snapshot_required"></span>**VSS\_FSBT\_ALL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="72b2e-231">Для всех типов резервных копий требуется теневая копия; Это значение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="72b2e-231">Shadow copy required for all backup types; this is the default.</span></span>

</dd> </dl>

<span data-ttu-id="72b2e-232">Если конкретный том содержит только те компоненты, для которых не требуется теневая копия для этой резервной копии, инициатор запроса может пропустить шаг создания теневой копии для этого тома.</span><span class="sxs-lookup"><span data-stu-id="72b2e-232">If a specific volume contains only components that do not require a shadow copy for this backup, the requester can skip the step of creating a shadow copy for this volume.</span></span> <span data-ttu-id="72b2e-233">Все данные на этом томе можно скопировать на носитель резервной копии непосредственно из исходного тома.</span><span class="sxs-lookup"><span data-stu-id="72b2e-233">All the data on this volume can be copied to the backup media directly from the original volume.</span></span>

## <a name="backup-cleanup"></a><span data-ttu-id="72b2e-234">Очистка резервной копии</span><span class="sxs-lookup"><span data-stu-id="72b2e-234">Backup Cleanup</span></span>

<span data-ttu-id="72b2e-235">Если модуль записи должен выполнить усечение журнала или другую очистку после резервного копирования, нужно выполнить это действие во время обработки события [*баккупкомплете*](vssgloss-b.md) .</span><span class="sxs-lookup"><span data-stu-id="72b2e-235">If the writer needs to perform log truncation or other post-backup cleanup, the proper place to do this is while processing the [*BackupComplete*](vssgloss-b.md) event.</span></span> <span data-ttu-id="72b2e-236">Событие [*баккупшутдовн*](vssgloss-b.md) будет отправлено через баккупкомплете через некоторое время, поэтому некоторые действия по очистке также можно выполнить в обработчике событий баккупшутдовн.</span><span class="sxs-lookup"><span data-stu-id="72b2e-236">The [*BackupShutdown*](vssgloss-b.md) event will be sent some time after BackupComplete, so some cleanup may also be done in the BackupShutdown event handler.</span></span>

<span data-ttu-id="72b2e-237">Событие Баккупшутдовн всегда отправляется после завершения резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72b2e-237">The BackupShutdown event is always sent after termination of a backup.</span></span> <span data-ttu-id="72b2e-238">Если инициатор запроса аварийно завершает работу во время выполнения резервного копирования, Баккупшутдовн будет отправлен немедленно, без предварительной отправки Баккупкомплете.</span><span class="sxs-lookup"><span data-stu-id="72b2e-238">If the requester terminates abnormally while performing a backup, BackupShutdown will be sent immediately, without first sending BackupComplete.</span></span> <span data-ttu-id="72b2e-239">Если модуль записи должен очистить любое состояние, это может быть сделано здесь; Однако усечение журнала не должно происходить в этом событии, так как резервная копия не обязательно была завершена.</span><span class="sxs-lookup"><span data-stu-id="72b2e-239">If the writer needs to clean up any state, that may be done here; however, log truncation should not happen in this event because the backup did not necessarily complete.</span></span>

## <a name="restore-strategies"></a><span data-ttu-id="72b2e-240">Стратегии восстановления</span><span class="sxs-lookup"><span data-stu-id="72b2e-240">Restore Strategies</span></span>

<span data-ttu-id="72b2e-241">Основными задачами модулей записи при восстановлении являются проверка того, что восстановление может выполняться при обработке события, выполняемого перед восстановлением, и что восстановление произошло в процессе обработки события восстановления.</span><span class="sxs-lookup"><span data-stu-id="72b2e-241">The basic tasks of writers at restore are to verify that the restore can happen in handling the PreRestore event, and that the restore has happened in handling the PostRestore event.</span></span> <span data-ttu-id="72b2e-242">Более сложные хранилища также будут выполнять процесс восстановления в обработчике восстановления.</span><span class="sxs-lookup"><span data-stu-id="72b2e-242">More complex stores will also perform a recovery process in the PostRestore handler.</span></span> <span data-ttu-id="72b2e-243">Если восстановление является частью добавочного или разностного восстановления, то модуль записи обычно захочет отложить процесс восстановления до завершения всех добавочных или разностных восстановлений.</span><span class="sxs-lookup"><span data-stu-id="72b2e-243">If the restore is part of an incremental or differential restore, the writer will generally want to delay this recovery process until all incremental or differential restores have been completed.</span></span> <span data-ttu-id="72b2e-244">[**Ивсскомпонент:: жетаддитионалресторес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) указывает, является ли это окончательным восстановлением этого компонента или требуется ли больше восстановлений.</span><span class="sxs-lookup"><span data-stu-id="72b2e-244">[**IVssComponent::GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) will indicate whether this is the final restore of this component, or whether there are more restores to come.</span></span> <span data-ttu-id="72b2e-245">Если **ивсскомпонент:: жетаддитионалресторес** возвращает **значение true**, модуль записи не должен выполнять процедуру восстановления этого компонента.</span><span class="sxs-lookup"><span data-stu-id="72b2e-245">If **IVssComponent::GetAdditionalRestores** returns **true**, the writer should not perform its recovery procedure on that component.</span></span>

## <a name="new-targets"></a><span data-ttu-id="72b2e-246">Новые цели</span><span class="sxs-lookup"><span data-stu-id="72b2e-246">New Targets</span></span>

<span data-ttu-id="72b2e-247">Если поддерживается модулем записи, инициатор запроса может восстановить файлы данных в расположении, отличном от исходного расположения времени резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="72b2e-247">If supported by the writer, the requester can restore data files to a location other than the original backup-time location.</span></span> <span data-ttu-id="72b2e-248">Модуль записи указывает на поддержку этого режима восстановления, настроив **модуль записи BS в VSS, который \_ \_ \_ поддерживает \_ новый \_ целевой** бит в параметре *дссчемамаск* при вызове [**ивсскреатевритерметадата:: сетбаккупсчема**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema).</span><span class="sxs-lookup"><span data-stu-id="72b2e-248">A writer indicates support for this restore mode by setting the **VSS\_BS\_WRITER\_SUPPORTS\_NEW\_TARGET** bit in the *dsSchemaMask* parameter when calling [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema).</span></span> <span data-ttu-id="72b2e-249">Модуль записи получает новые расположения для файлов компонентов во время восстановления путем вызова [**ивсскомпонент:: жетневтаржеткаунт**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) и [**Ивсскомпонент:: жетневтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget).</span><span class="sxs-lookup"><span data-stu-id="72b2e-249">A writer obtains the new locations for component files at restore time by calling [**IVssComponent::GetNewTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) and [**IVssComponent::GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget).</span></span>

## <a name="directed-targets"></a><span data-ttu-id="72b2e-250">Направленные целевые объекты</span><span class="sxs-lookup"><span data-stu-id="72b2e-250">Directed Targets</span></span>

<span data-ttu-id="72b2e-251">Для сложных сценариев восстановления разработчику может потребоваться сопоставлять диапазоны резервного файла с различными диапазонами того же или другого файла.</span><span class="sxs-lookup"><span data-stu-id="72b2e-251">For complicated restore scenarios, a writer may want to map ranges of a backed-up file onto different ranges of the same or a different file.</span></span> <span data-ttu-id="72b2e-252">Это можно сделать с помощью механизма направленного целевого объекта.</span><span class="sxs-lookup"><span data-stu-id="72b2e-252">This can be done by using the directed-target mechanism.</span></span> <span data-ttu-id="72b2e-253">Для этого модуль записи должен сначала указать, что это происходит путем вызова [**ивсскомпонент:: сетресторетаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), передавая **VSS RT \_ , \_ направленную** для *целевого* параметра.</span><span class="sxs-lookup"><span data-stu-id="72b2e-253">To do this, a writer must first indicate this is happening by calling [**IVssComponent::SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), passing in **VSS\_RT\_DIRECTED** for the *target* parameter.</span></span> <span data-ttu-id="72b2e-254">Затем для каждого сопоставления модуль записи вызывает [**ивсскомпонент:: адддиректедтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget).</span><span class="sxs-lookup"><span data-stu-id="72b2e-254">Then, for each mapping, the writer calls [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget).</span></span> <span data-ttu-id="72b2e-255">Этот метод принимает полный путь к исходному файлу в резервной копии и полный путь к целевому файлу, который будет восстановлен.</span><span class="sxs-lookup"><span data-stu-id="72b2e-255">This method takes a full path to a source file on the backup and a full path to a destination file that will be restored to.</span></span> <span data-ttu-id="72b2e-256">Он также принимает список диапазонов для каждого из этих файлов.</span><span class="sxs-lookup"><span data-stu-id="72b2e-256">It also takes a ranges list for each of these files.</span></span> <span data-ttu-id="72b2e-257">Модуль записи вызывает эти функции при обработке события перед восстановлением, а инициатор запроса отвечает за восстановление указанных диапазонов в исходном файле на сопоставленные диапазоны в целевом файле.</span><span class="sxs-lookup"><span data-stu-id="72b2e-257">The writer calls these functions while handling the PreRestore event, and the requester is then responsible for restoring the specified ranges in the source file to the mapped ranges in the destination file.</span></span> <span data-ttu-id="72b2e-258">Формат строки Ranges такой же, как в [ **ивсскомпонент:: аддпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile)</span><span class="sxs-lookup"><span data-stu-id="72b2e-258">The format of the ranges string is the same as in [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile)</span></span>

## <a name="private-writer-metadata"></a><span data-ttu-id="72b2e-259">Метаданные закрытого модуля записи</span><span class="sxs-lookup"><span data-stu-id="72b2e-259">Private Writer Metadata</span></span>

<span data-ttu-id="72b2e-260">Часто бывает полезно, чтобы средство записи поддерживало закрытые метаданные с помощью резервной копии, чтобы правильно выполнить добавочное или разностное восстановление.</span><span class="sxs-lookup"><span data-stu-id="72b2e-260">It is often useful for a writer to maintain private metadata with a backup to properly perform an incremental or differential restore.</span></span> <span data-ttu-id="72b2e-261">Модуль записи может вызывать [**ивсскомпонент:: сетбаккупметадата**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) при обработке PrepareForBackup или моментального снимка для хранения метаданных.</span><span class="sxs-lookup"><span data-stu-id="72b2e-261">A writer may call [**IVssComponent::SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) while handling either PrepareForBackup or PostSnapshot to store metadata.</span></span> <span data-ttu-id="72b2e-262">Доступ к этим метаданным может осуществляться модулем записи во время их предвосстановления или восстановления путем вызова [**ивсскомпонент:: жетбаккупметадата**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupmetadata).</span><span class="sxs-lookup"><span data-stu-id="72b2e-262">This metadata can be accessed by the writer during either PreRestore or PostRestore by calling [**IVssComponent::GetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupmetadata).</span></span> <span data-ttu-id="72b2e-263">Метаданные также могут храниться с частичной спецификацией файла с  помощью параметра всзметадата [**Ивсскомпонент:: аддпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile); доступ к этим метаданным осуществляется с помощью параметра *Пбстрметадата* [**Ивсскомпонент:: жетпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile).</span><span class="sxs-lookup"><span data-stu-id="72b2e-263">Metadata can also be stored with partial file specification by using the *wszMetadata* parameter of [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile); this metadata is accessed through the *pbstrMetadata* parameter of [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile).</span></span> <span data-ttu-id="72b2e-264">Модуль записи также может передавать метаданные между [**квссвритер:: онпрересторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) и [**Квссвритер:: онпостресторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore).</span><span class="sxs-lookup"><span data-stu-id="72b2e-264">The writer can also pass metadata to itself between [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) and [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore).</span></span> <span data-ttu-id="72b2e-265">В **квссвритер:: онпрересторе** метаданные задаются путем вызова [**Ивсскомпонент:: сетрестореметадата**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata).</span><span class="sxs-lookup"><span data-stu-id="72b2e-265">In **CVssWriter::OnPreRestore**, the metadata is set by calling [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata).</span></span> <span data-ttu-id="72b2e-266">В **квссвритер:: онпостресторе** метаданные извлекаются путем вызова [**Ивсскомпонент:: жетрестореметадата**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoremetadata).</span><span class="sxs-lookup"><span data-stu-id="72b2e-266">In **CVssWriter::OnPostRestore**, the metadata is retrieved by calling [**IVssComponent::GetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoremetadata).</span></span>

-   [<span data-ttu-id="72b2e-267">Роль модуля записи в добавочных и разностных резервных копиях VSS</span><span class="sxs-lookup"><span data-stu-id="72b2e-267">Writer Role in VSS Incremental and Differential Backups</span></span>](writer-role-in-vss-incremental-and-differential-backups.md)
-   [<span data-ttu-id="72b2e-268">Роль инициатора запроса в добавочных и разностных резервных копиях VSS</span><span class="sxs-lookup"><span data-stu-id="72b2e-268">Requester Role in VSS Incremental and Differential Backups</span></span>](requestor-role-in-vss-incremental-and-differential-backups.md)

 

 



