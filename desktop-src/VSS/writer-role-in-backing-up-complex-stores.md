---
description: Сведения о роли модуля записи в добавочных и разностных резервных копиях, требующих тесного взаимодействия между запрашивающими и модулями записи.
ms.assetid: 3cf5dd1f-dc58-42bc-925f-fee7d34053c5
title: Роль модуля записи при резервном копировании сложных хранилищ
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 30e34952cc4a2184d2f9abcc43283d24f64bdcc3
ms.sourcegitcommit: d0eb44d0a95f5e5efbfec3d3e9c143f5cba25bc3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/17/2021
ms.locfileid: "112262156"
---
# <a name="writer-role-in-backing-up-complex-stores"></a>Роль модуля записи при резервном копировании сложных хранилищ

Как и все важные операции в VSS, [*добавочные*](vssgloss-i.md) и [*разностные*](vssgloss-d.md) резервные копии потребовали тесного взаимодействия между запрашивающими стороны и модулями записи.

## <a name="backup-types"></a>Типы резервного копирования

Инфраструктура обеспечивает специальную поддержку пяти типов резервных копий. Они описаны ниже.

-   Full (**\_ \_ полная резервная служба VSS**). Файлы будут архивироваться независимо от даты их последнего резервного копирования. Будет обновлен Журнал резервного копирования каждого файла, и этот тип резервного копирования можно использовать в качестве основы для добавочной или разностной резервной копии. Если имеются файлы журнала, они могут быть усечены в результате резервного копирования.

    Для восстановления полной резервной копии требуется только один образ резервной копии.

-   Разностная (**VSS \_ BT \_ разностная**). API VSS используется, чтобы гарантировать копирование только тех файлов, которые были изменены или добавлены с момента последнего полного резервного копирования, на носитель. все промежуточные резервные копии игнорируются. Это могут быть целые файлы или определенные диапазоны в файлах. Разностная резервная копия связана с полной резервной копией и обычно не может быть восстановлена до тех пор, пока не будет восстановлена полная резервная копия. Если имеются файлы журнала, они обычно не усекаются в результате резервного копирования.

    Для восстановления разностной резервной копии требуется исходный образ резервной копии и последняя разностная резервная копия, созданная с момента последнего полного резервного копирования.

-   Добавочная **( \_ \_ добавочная служба VSS**). API VSS используется, чтобы гарантировать копирование только тех файлов, которые были изменены или добавлены с момента последнего полного или добавочного резервного копирования, на носитель. Это могут быть целые файлы или определенные диапазоны в файлах. Некоторые модули записи не позволяют смешивать добавочные резервные копии с разностными резервными копиями. Если имеются файлы журнала, они могут быть усечены в результате резервного копирования.

    Для восстановления добавочной резервной копии требуется исходный образ резервного копирования и все добавочные образы резервных копий, созданные с момента создания исходной резервной копии.

-   Резервная копия журнала (**\_ \_ Журнал VSS BT**). Будет создана резервная копия только файлов журнала модуля записи (файлов, добавленных в компонент с помощью метода [**ивсскреатевритерметадата:: адддатабаселогфилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) и получаемых путем вызова [**Ивссвмкомпонент:: жетдатабаселогфиле**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile)). Этот тип резервного копирования относится только к VSS. Резервные копии журналов обычно выполняются довольно часто. Как правило, файл журнала будет усечен в результате резервного копирования.
-   Копирование резервной копии (**\_ BT- \_ копия VSS**). Как и в \_ \_ случае с типом данных BT Full, резервное копирование файлов выполняется независимо от даты их последнего резервного копирования. Однако журнал резервного копирования каждого файла не будет обновлен, и этот тип резервного копирования нельзя использовать в качестве основы для добавочной или разностной резервной копии. Файлы журнала никогда не следует усекать в результате резервного копирования.

<dl> <dt>

<span id="Partial_File_Support"></span><span id="partial_file_support"></span><span id="PARTIAL_FILE_SUPPORT"></span>Частичная поддержка файлов
</dt> <dd>

Некоторые модули записи поддерживают восстановление файлов с помощью перезаписи частей файлов, которыми они управляют. Инициатор запроса может воспользоваться преимуществами этого метода, и если да, то он указывает, что нужно установить сведения в [**ивссбаккупкомпонентс:: сетбаккупстате**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).

</dd> </dl>

Модули записи указывают, какие типы резервных копий поддерживаются путем вызова [**ивсскреатевритерметадата:: сетбаккупсчема**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) при обработке события [*Identify*](vssgloss-i.md) . Параметр *дссчемамаск* метода **Ивсскреатевритерметадата:: сетбаккупсчема** является битовой маской, указывающей, какие типы резервного копирования поддерживаются. Все модули записи должны поддерживать полное резервное копирование.

<dl> <dt>

<span id="VSS_BS_DIFFERENTIAL"></span><span id="vss_bs_differential"></span>**\_ \_ разностный резерв VSS**
</dt> <dd>

Указывает поддержку для разностных резервных копий.

</dd> <dt>

<span id="VSS_BS_INCREMENTAL"></span><span id="vss_bs_incremental"></span>**\_ \_ добавочное УТОЧНЕНие VSS**
</dt> <dd>

Указывает поддержку добавочного резервного копирования.

</dd> <dt>

<span id="VSS_BS_LOG"></span><span id="vss_bs_log"></span>**\_Журнал "BS" VSS \_**
</dt> <dd>

Указывает на поддержку резервного копирования журналов.

</dd> <dt>

<span id="VSS_BS_COPY"></span><span id="vss_bs_copy"></span>**\_копия BS \_ VSS**
</dt> <dd>

Указывает поддержку резервного копирования копий.

</dd> <dt>

<span id="VSS_BS_EXCLUSIVE_INCREMENTAL_DIFFERENTIAL"></span><span id="vss_bs_exclusive_incremental_differential"></span>**\_ \_ монопольная \_ добавочная \_ разностная копия VSS**
</dt> <dd>

Указывает, что модуль записи не поддерживает смешивание добавочных резервных копий с разностными резервными копиями.

</dd> </dl>

Модуль записи может определить, какой тип резервного копирования выполняется путем вызова [**квссвритер:: жетбаккуптипе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getbackuptype). Самый ранний момент, когда это может быть выполнено, — это обработка события PrepareForBackup. **Квссвритер:: жетбаккуптипе** будет возвращать элемент перечисления [**\_ \_ типа резервного копирования VSS**](/windows/desktop/api/Vss/ne-vss-vss_backup_type) . Если тип резервного копирования не поддерживается модулем записи, то модуль записи должен считать резервную копию полной резервной копией.

## <a name="backup-stamps"></a>Метки резервного копирования

Добавочные и разностные резервные копии всегда привязаны к предыдущей резервной копии. Существует два способа привязки резервных копий. Для простых хранилищ данных инициатор запроса может вести отслеживание корреляции между резервными копиями. Однако для более сложных хранилищ данных модуль записи должен поддерживать собственную метку времени с помощью резервной копии. Эта метка времени может вести отслеживание расположения журнала, сведений о контрольных точках и т. д. Модуль записи указывает, что ему требуются собственные метки времени, установив бит **" \_ \_ Метка времени** (в VSS)" в случае вызова [**ивсскреатевритерметадата:: сетбаккупсчема**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema).

Модуль записи может хранить метку времени в каждом компоненте, для которого выполняется резервное копирование. Модуль записи сохраняет метку времени путем вызова [**ивсскомпонент:: сетбаккупстамп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp)и передает строковое представление метки для параметра *всзбаккупстамп* . Как правило, модуль записи будет вызывать этот метод при обработке события [*моментального снимка*](vssgloss-p.md) . Однако для резервных копий, которые не используют теневую копию, событие моментального снимка не будет отправлено. В этом случае при обработке события [*PrepareForBackup*](vssgloss-p.md) необходимо вызвать **Ивсскомпонент:: сетбаккупстамп** .

Когда выполняется добавочная или разностная резервная копия, инициатор запроса сообщает модулю записи о резервной копии предыдущей резервной копии, которая является базой для этой резервной копии. Модуль записи может получить доступ к предыдущей метке резервного копирования при обработке события PrepareForBackup или snapshot, вызвав [**ивсскомпонент:: жетпревиаусбаккупстамп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp). Модуль записи может использовать возвращенную отметку, чтобы определить, какие резервные копии необходимо создать.

## <a name="backup-strategies"></a>Стратегии резервного копирования

### <a name="file-backup-files-strategies"></a>Стратегии файлов резервных копий файлов

Часто при выполнении определенных типов резервного копирования некоторые файлы, зарегистрированные в метаданных модуля записи, должны быть резервными. Некоторые файлы могут потребоваться только при выполнении полной архивации. Другие файлы могут потребоваться только при выполнении добавочной или разностной резервной копии. VSS предоставляет разработчикам метод для указания этой информации запрашивающей стороне. При добавлении файлов в компоненты с помощью [**ивсскреатевритерметадата:: адддатабасефилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**Ивсскреатевритерметадата:: адддатабаселогфилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)или [**IVssCreateWriterMetadata:: AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)параметр *dwBackupTypeMask* указывает, для каких типов резервного копирования должны быть резервные копии этих файлов. Маска может содержать одно или несколько из следующих значений:

<dl> <dt>

<span id="VSS_FSBT_FULL_BACKUP_REQUIRED"></span><span id="vss_fsbt_full_backup_required"></span>**\_ \_ \_ требуется полная резервная копия VSS фсбт \_**
</dt> <dd>

Требуется для полных резервных копий.

</dd> <dt>

<span id="VSS_FSBT_DIFFERENTIAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_differential_backup_required"></span>**\_ \_ требуется разностное \_ резервное копирование VSS фсбт \_**
</dt> <dd>

Требуется для разностного резервного копирования.

</dd> <dt>

<span id="VSS_FSBT_INCREMENTAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_incremental_backup_required"></span>**\_ \_ требуется добавочное \_ резервное копирование VSS фсбт \_**
</dt> <dd>

Требуется для добавочного резервного копирования.

</dd> <dt>

<span id="VSS_FSBT_LOG_BACKUP_REQUIRED"></span><span id="vss_fsbt_log_backup_required"></span>**\_ \_ \_ требуется резервная копия журнала фсбт для VSS \_**
</dt> <dd>

Требуется для резервного копирования журнала.

</dd> <dt>

<span id="VSS_FSBT_ALL_BACKUP_REQUIRED"></span><span id="vss_fsbt_all_backup_required"></span>**\_ФСБТ VSS \_ \_ требуется вся резервная копия \_**
</dt> <dd>

Требуется для всех типов резервных копий; Это значение по умолчанию.

</dd> </dl>

Эта спецификация переопределяет спецификацию селективности компонента. Например, рассмотрим компонент, файлы которого все помечены с помощью **\_ \_ \_ резервной копии журнала \_ фсбт VSS** , но **не \_ \_ требуются для полной \_ резервной копии \_ фсбт VSS**. Предположим, этот компонент не может быть выбран для резервного копирования (*бселектабле* был ложным при вызове [**Ивсскреатевритерметадата:: AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) ). В случае резервного копирования журнала это означает, что все файлы в этом компоненте всегда должны быть резервными копиями. Однако в случае полного резервного копирования ни один из файлов не нуждается в резервном копировании, несмотря на тот факт, что избирательность компонента требует резервного копирования.

### <a name="backup-by-last-modify-time"></a>Резервное копирование по времени последнего изменения

Один из способов, позволяющий модулю записи указать, какие файлы были изменены, — использовать механизм сравнения файлов. Модуль записи может указать, что необходимо создать резервную копию определенных файлов компонента, только если они были изменены с момента определенного времени. Модуль записи вызывает [**ивсскомпонент:: адддифференцедфилесбиластмодифитиме**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) с указанием файла и последним временем изменения. **Ивсскомпонент:: адддифференцедфилесбиластмодифитиме** обычно вызывается при обработке события моментального снимка, хотя его можно вызвать при обработке события PrepareForBackup. Затем инициатор запроса должен выполнить резервное копирование всех файлов, соответствующих спецификации файла, измененной с момента указанного времени. Если модуль записи использует механизм отметки резервного копирования, это время последнего изменения будет определяться на основе предыдущей метки резервного копирования в документе резервного копирования. Кроме того, модуль записи может передать нулевое значение в течение последнего изменения. Это означает, что инициатор запроса отвечает за определение времени последней резервной копии и файлов, измененных с момента этого времени.

### <a name="partial-file-backup"></a>Частичная Архивация файлов

Другой способ, чтобы средство записи указывало изменения в инициаторе запроса, использует механизм частичного файла. Модуль записи может указывать диапазоны байтов в файлах компонентов, для которых необходимо создать резервную копию; модуль записи может указать эти диапазоны файлов при обработке события PrepareForBackup или моментального снимка. Модуль записи вызывает [**ивсскомпонент:: аддпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) для добавления полных спецификаций файлов в резервную копию. Частичная спецификация файла состоит из пути и имени файла вместе со сведениями о том, какие диапазоны в файле необходимо архивировать.

### <a name="file-specification-rules"></a>Правила спецификации файла

[**Ивсскомпонент:: адддифференцедфилесбиластмодифитиме**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) или [**Ивсскомпонент:: аддпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) можно использовать для изменения спецификаций файлов, заданных во время события Identify, или для добавления в спецификацию совершенно новых файлов. Если модуль записи изменяет сведения, заданные во время события определения с помощью **ивсскомпонент:: адддифференцедфилесбиластмодифитиме**, спецификация файла должна точно соответствовать одной из спецификаций файла в текущем компоненте. Спецификация файла не должна частично перекрывать файлы в текущем компоненте и не должна совпадать с файлами в других компонентах. Однако файлы, указанные с помощью **ивсскомпонент:: аддпартиалфиле** , могут частично перекрывать другую спецификацию файла. Сведения, заданные с помощью **ивсскомпонент:: адддифференцедфилесбиластмодифитиме** или **Ивсскомпонент:: аддпартиалфиле** , переопределяют набор данных ранее с помощью интерфейса [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) в ответ на событие Identify.

Общие спецификации файлов могут иметь значение альтернативного расположения (заданное параметром *всзалтернателокатион* параметра [**Ивсскреатевритерметадата:: аддфилестофилеграуп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)), которое указывает на альтернативное расположение для получения файла во время резервного копирования. Если спецификация файла, заданная с помощью механизма Difference-File или разделяемого файла, совпадает с существующей спецификацией файла, имеющей альтернативное расположение, приложение резервного копирования получит данные из этого альтернативного расположения.

Если спецификация файла, заданная в [**ивсскомпонент:: адддифференцедфилесбиластмодифитиме**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) или в [**Ивсскомпонент:: аддпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) , не совпадает и файлы в компоненте, для которого выполняется резервное копирование, теперь все соответствующие файлы будут добавлены в резервную копию. Необходимо принять во внимание, что модуль записи добавляет только те файлы, которые существуют на том, который уже скопирован в теневом виде. в противном случае инициатору может не удастся создать резервную копию этих файлов. Если эти функции вызываются во время обработки события моментального снимка, это можно определить с помощью метода [**квссвритер:: испасаффектед**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected) . При вызове во время обработки события PrepareForBackup модуль записи должен выполнить это определение с помощью другого метода.

### <a name="backup-without-a-shadow-copy"></a>Резервное копирование без теневой копии

Для некоторых типов файлов резервное копирование тома теневой копии может не требоваться. Например, это часто справедливо для файлов журнала базы данных. Так как файлы журналов увеличиваются монотонно, и модуль записи может указать, какие части файла нужно архивировать с помощью частичных файлов, можно создать резервную копию журнала с исходного тома. В качестве оптимизации модуль записи может отметить, какие файлы нуждаются в теневых копиях для различных типов резервных копий с помощью флагов, заданных в параметре *Двбаккуптипемаск* [**Ивсскреатевритерметадата:: адддатабасефилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**Ивсскреатевритерметадата:: AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)или [**IVssCreateWriterMetadata:: AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup). К поддерживаемым флагам относятся следующие:

<dl> <dt>

<span id="VSS_FSBT_FULL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_full_snapshot_required"></span>**\_ \_ \_ требуется полный моментальный снимок VSS фсбт \_**
</dt> <dd>

Для полных резервных копий требуется теневая копия.

</dd> <dt>

<span id="VSS_FSBT_DIFFERENTIAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_differential_snapshot_required"></span>**\_ \_ требуется разностный \_ моментальный снимок VSS фсбт \_**
</dt> <dd>

Для разностного резервного копирования требуется теневая копия.

</dd> <dt>

<span id="VSS_FSBT_INCREMENTAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_incremental_snapshot_required"></span>**\_ \_ требуется добавочный \_ моментальный снимок VSS фсбт \_**
</dt> <dd>

Для добавочного резервного копирования требуется теневое копирование.

</dd> <dt>

<span id="VSS_FSBT_LOG_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_log_snapshot_required"></span>**\_ \_ \_ требуется моментальный снимок журнала фсбт для VSS \_**
</dt> <dd>

Для резервного копирования журналов требуется теневая копия.

</dd> <dt>

<span id="VSS_FSBT_ALL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_all_snapshot_required"></span>**\_ \_ \_ требуется моментальный снимок фсбт для VSS \_**
</dt> <dd>

Для всех типов резервных копий требуется теневая копия; Это значение по умолчанию.

</dd> </dl>

Если конкретный том содержит только те компоненты, для которых не требуется теневая копия для этой резервной копии, инициатор запроса может пропустить шаг создания теневой копии для этого тома. Все данные на этом томе можно скопировать на носитель резервной копии непосредственно из исходного тома.

## <a name="backup-cleanup"></a>Очистка резервной копии

Если модуль записи должен выполнить усечение журнала или другую очистку после резервного копирования, нужно выполнить это действие во время обработки события [*баккупкомплете*](vssgloss-b.md) . Событие [*баккупшутдовн*](vssgloss-b.md) будет отправлено через баккупкомплете через некоторое время, поэтому некоторые действия по очистке также можно выполнить в обработчике событий баккупшутдовн.

Событие Баккупшутдовн всегда отправляется после завершения резервного копирования. Если инициатор запроса аварийно завершает работу во время выполнения резервного копирования, Баккупшутдовн будет отправлен немедленно, без предварительной отправки Баккупкомплете. Если модуль записи должен очистить любое состояние, это может быть сделано здесь; Однако усечение журнала не должно происходить в этом событии, так как резервная копия не обязательно была завершена.

## <a name="restore-strategies"></a>Стратегии восстановления

Основными задачами модулей записи при восстановлении являются проверка того, что восстановление может выполняться при обработке события, выполняемого перед восстановлением, и что восстановление произошло в процессе обработки события восстановления. Более сложные хранилища также будут выполнять процесс восстановления в обработчике восстановления. Если восстановление является частью добавочного или разностного восстановления, то модуль записи обычно захочет отложить процесс восстановления до завершения всех добавочных или разностных восстановлений. [**Ивсскомпонент:: жетаддитионалресторес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) указывает, является ли это окончательным восстановлением этого компонента или требуется ли больше восстановлений. Если **ивсскомпонент:: жетаддитионалресторес** возвращает **значение true**, модуль записи не должен выполнять процедуру восстановления этого компонента.

## <a name="new-targets"></a>Новые цели

Если поддерживается модулем записи, инициатор запроса может восстановить файлы данных в расположении, отличном от исходного расположения времени резервного копирования. Модуль записи указывает на поддержку этого режима восстановления, настроив **модуль записи BS в VSS, который \_ \_ \_ поддерживает \_ новый \_ целевой** бит в параметре *дссчемамаск* при вызове [**ивсскреатевритерметадата:: сетбаккупсчема**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema). Модуль записи получает новые расположения для файлов компонентов во время восстановления путем вызова [**ивсскомпонент:: жетневтаржеткаунт**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) и [**Ивсскомпонент:: жетневтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget).

## <a name="directed-targets"></a>Направленные целевые объекты

Для сложных сценариев восстановления разработчику может потребоваться сопоставлять диапазоны резервного файла с различными диапазонами того же или другого файла. Это можно сделать с помощью механизма направленного целевого объекта. Для этого модуль записи должен сначала указать, что это происходит путем вызова [**ивсскомпонент:: сетресторетаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), передавая **VSS RT \_ , \_ направленную** для *целевого* параметра. Затем для каждого сопоставления модуль записи вызывает [**ивсскомпонент:: адддиректедтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget). Этот метод принимает полный путь к исходному файлу в резервной копии и полный путь к целевому файлу, который будет восстановлен. Он также принимает список диапазонов для каждого из этих файлов. Модуль записи вызывает эти функции при обработке события перед восстановлением, а инициатор запроса отвечает за восстановление указанных диапазонов в исходном файле на сопоставленные диапазоны в целевом файле. Формат строки Ranges такой же, как в [ **ивсскомпонент:: аддпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile)

## <a name="private-writer-metadata"></a>Метаданные закрытого модуля записи

Часто бывает полезно, чтобы средство записи поддерживало закрытые метаданные с помощью резервной копии, чтобы правильно выполнить добавочное или разностное восстановление. Модуль записи может вызывать [**ивсскомпонент:: сетбаккупметадата**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) при обработке PrepareForBackup или моментального снимка для хранения метаданных. Доступ к этим метаданным может осуществляться модулем записи во время их предвосстановления или восстановления путем вызова [**ивсскомпонент:: жетбаккупметадата**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupmetadata). Метаданные также могут храниться с частичной спецификацией файла с  помощью параметра всзметадата [**Ивсскомпонент:: аддпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile); доступ к этим метаданным осуществляется с помощью параметра *Пбстрметадата* [**Ивсскомпонент:: жетпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile). Модуль записи также может передавать метаданные между [**квссвритер:: онпрересторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) и [**Квссвритер:: онпостресторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore). В **квссвритер:: онпрересторе** метаданные задаются путем вызова [**Ивсскомпонент:: сетрестореметадата**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata). В **квссвритер:: онпостресторе** метаданные извлекаются путем вызова [**Ивсскомпонент:: жетрестореметадата**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoremetadata).

-   [Роль модуля записи в добавочных и разностных резервных копиях VSS](writer-role-in-vss-incremental-and-differential-backups.md)
-   [Роль инициатора запроса в добавочных и разностных резервных копиях VSS](requestor-role-in-vss-incremental-and-differential-backups.md)

 

 



