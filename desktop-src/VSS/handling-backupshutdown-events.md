---
description: Приложение резервного копирования (инициатор запроса) может завершить работу и не создавать событие Баккупкомплете.
ms.assetid: 8e6a1f4f-ba62-46ea-965e-b0c6526ece89
title: Обработка событий Баккупшутдовн
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 939e8e64ca9ee463b0b8331e607f8068c3325d5c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692918"
---
# <a name="handling-backupshutdown-events"></a><span data-ttu-id="6c65c-103">Обработка событий Баккупшутдовн</span><span class="sxs-lookup"><span data-stu-id="6c65c-103">Handling BackupShutdown Events</span></span>

<span data-ttu-id="6c65c-104">Приложение резервного копирования (инициатор запроса) может завершить работу и не создавать событие [*баккупкомплете*](vssgloss-b.md) .</span><span class="sxs-lookup"><span data-stu-id="6c65c-104">It is possible for a backup application (requester) to terminate and not generate a [*BackupComplete*](vssgloss-b.md) event.</span></span> <span data-ttu-id="6c65c-105">Приложение резервного копирования может завершиться со сбоем или быть завершено (например, в диспетчере задач) и не может вызывать [**ивссбаккупкомпонентс:: баккупкомплете**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span><span class="sxs-lookup"><span data-stu-id="6c65c-105">The backup application could crash, or be terminated (from the Task Manager, for example) and not be able to call [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span></span>

<span data-ttu-id="6c65c-106">Таким образом, инфраструктура VSS (а не инициатор запроса) создает событие [*баккупшутдовн*](vssgloss-b.md) при освобождении экземпляра [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) , участвующего в резервной копии, независимо от того, освобождается ли он инициатором запроса или системой.</span><span class="sxs-lookup"><span data-stu-id="6c65c-106">Therefore, the VSS infrastructure (rather than the requester) generates a [*BackupShutdown*](vssgloss-b.md) event whenever an instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) participating in a backup is released, whether it is released by the requester or by the system.</span></span>

<span data-ttu-id="6c65c-107">Если резервная копия продолжает работать правильно, модуль записи получит событие Баккупкомплете, за которым следует событие Баккупшутдовн.</span><span class="sxs-lookup"><span data-stu-id="6c65c-107">If a backup proceeds properly, a writer will receive a BackupComplete event followed by a BackupShutdown event.</span></span>

<span data-ttu-id="6c65c-108">Если операция прерывается (инициатор запроса создает [*событие Abort*](vssgloss-a.md) путем вызова [**Ивссбаккупкомпонентс:: абортбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) или внезапно завершается ошибкой, модуль записи может получить только событие баккупшутдовн и не может получить другие события, выполняющие операции очистки.</span><span class="sxs-lookup"><span data-stu-id="6c65c-108">If the operation aborts (the requester generates an [*Abort event*](vssgloss-a.md) by calling [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) or fails abruptly, a writer may receive only a BackupShutdown event, and it may not receive other events that perform cleanup operations.</span></span> <span data-ttu-id="6c65c-109">Чтобы определить, соответствует ли событие Баккупшутдовн надлежащей последовательности событий, или представляет непредвиденную ошибку в операциях резервного копирования, разработчику необходимо.</span><span class="sxs-lookup"><span data-stu-id="6c65c-109">It is up to a writer to determine whether a BackupShutdown event follows a proper sequence of events, or represents an unexpected failure of the backup operations.</span></span>

<span data-ttu-id="6c65c-110">Обработчик событий Баккупшутдовн, [**квссвритер:: онбаккупшутдовн**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown), получает \_ идентификатор VSS (GUID) набора теневых копий для завершения операции резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="6c65c-110">The BackupShutdown event handler, [**CVssWriter::OnBackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown), receives the VSS\_ID (GUID) of the shadow copy set of the backup operation being shut down.</span></span> <span data-ttu-id="6c65c-111">Модуль записи может использовать этот параметр, чтобы определить, какая операция резервного копирования завершает работу, если она сохранила идентификатор набора теневых копий во время последовательности резервного копирования (например, из [**квссвритер:: onfreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze), [**квссвритер::**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)onfreezeи или [**квссвритер:: онпостснапшот**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)) с помощью [**квссвритер:: жеткуррентснапшотсетид**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getcurrentsnapshotsetid).</span><span class="sxs-lookup"><span data-stu-id="6c65c-111">The writer can use this to determine which backup operation is being shut down, if it has stored the shadow copy set ID during its backup sequence (for example, from within [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze), [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw), or [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)) by using [**CVssWriter::GetCurrentSnapshotSetId**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getcurrentsnapshotsetid).</span></span>

<span data-ttu-id="6c65c-112">Однако модуль записи не должен вызывать [**квссвритер:: жеткуррентснапшотсетид**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getcurrentsnapshotsetid) в [**Квссвритер:: онбаккупшутдовн**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown).</span><span class="sxs-lookup"><span data-stu-id="6c65c-112">However, a writer should not call [**CVssWriter::GetCurrentSnapshotSetId**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getcurrentsnapshotsetid) from within [**CVssWriter::OnBackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown).</span></span> <span data-ttu-id="6c65c-113">Кроме того, **квссвритер:: жеткуррентснапшотсетид** не может вызываться после возврата [**Квссвритер:: онпостснапшот**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) .</span><span class="sxs-lookup"><span data-stu-id="6c65c-113">Also, **CVssWriter::GetCurrentSnapshotSetId** cannot be called after [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) returns.</span></span>

<span data-ttu-id="6c65c-114">Модуль записи может участвовать в нескольких операциях резервного копирования, и если событие Баккупшутдовн вызывается из-за внезапного завершения работы инициатора запроса, то \_ возвращенный идентификатор VSS может быть вызван другой операцией резервного копирования, в которую участвовал модуль записи.</span><span class="sxs-lookup"><span data-stu-id="6c65c-114">It is possible for the writer to be involved in multiple backup operations, and if a BackupShutdown event is called because of an abrupt shutdown of a requester, the VSS\_ID returned could be that of another backup operation the writer was participating in.</span></span>

 

 



