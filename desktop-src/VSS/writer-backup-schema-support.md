---
description: Для полной реализации резервной копии требуется участие в системе записи системы.
ms.assetid: ea504f8e-26d9-499e-b3e9-03515b480a75
title: Поддержка схемы резервного копирования модуля записи
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 593df12f552f206d5d0eedbf8d021b69ef955c6d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104263094"
---
# <a name="writer-backup-schema-support"></a><span data-ttu-id="e0078-103">Поддержка схемы резервного копирования модуля записи</span><span class="sxs-lookup"><span data-stu-id="e0078-103">Writer Backup Schema Support</span></span>

<span data-ttu-id="e0078-104">Для полной реализации резервной копии требуется участие в системе записи системы.</span><span class="sxs-lookup"><span data-stu-id="e0078-104">To fully implement a backup requires participation of the system's writers.</span></span> <span data-ttu-id="e0078-105">Различные типы поддерживаемых резервных копий называются схемами и указываются с помощью битовой маски (или побитовой или) членов [**перечисления \_ \_ схемы резервного копирования VSS**](/windows/desktop/api/Vss/ne-vss-vss_backup_schema) .</span><span class="sxs-lookup"><span data-stu-id="e0078-105">Different types of supported backups are referred to as schemas and are indicated by a bitmask (or bitwise OR) of members of the [**VSS\_BACKUP\_SCHEMA**](/windows/desktop/api/Vss/ne-vss-vss_backup_schema) enumeration.</span></span> <span data-ttu-id="e0078-106">В настоящее время поддерживаются следующие допустимые схемы:</span><span class="sxs-lookup"><span data-stu-id="e0078-106">The currently supported valid schemas include the following:</span></span>

-   <span data-ttu-id="e0078-107">Схема по умолчанию: полная \_ ( \_ неопределенная область восстановления службы VSS). указывает, что модуль записи поддерживает резервную копию, в которой будут создаваться резервные копии всех файлов, независимо от даты последнего резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="e0078-107">Default Schema: Full (VSS\_BS\_UNDEFINED)—indicates that a writer supports a backup where all files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="e0078-108">Журнал резервного копирования каждого файла может быть обновлен инициатором запроса, и модули записи, поддерживающие \_ \_ значение перечисления с меткой времени "BS" VSS, будут хранить обновленную отметку времени с инициатором запроса.</span><span class="sxs-lookup"><span data-stu-id="e0078-108">The backup history of each file can be updated by the requester, and writers supporting the VSS\_BS\_TIMESTAMPED enumeration value, it will store an updated time stamp with the requester.</span></span> <span data-ttu-id="e0078-109">Эту схему резервного копирования можно использовать в качестве основы добавочной или разностной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="e0078-109">This backup scheme can be used as the basis of an incremental or differential backup.</span></span>

    <span data-ttu-id="e0078-110">Для восстановления полной резервной копии требуется только один образ резервной копии.</span><span class="sxs-lookup"><span data-stu-id="e0078-110">Restoring a full backup requires only a single backup image.</span></span>

-   <span data-ttu-id="e0078-111">Копирование резервной копии \_ ( \_ копия BS VSS), как \_ и \_ схема полного резервного копирования в VSS, указывает, что модуль записи поддерживает резервную копию, в которой будут создаваться резервные копии всех файлов независимо от даты последнего резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="e0078-111">Copy Backup (VSS\_BS\_COPY)—like the VSS\_BS\_FULL backup schema, indicates that a writer supports a backup where all files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="e0078-112">Однако журнал резервного копирования каждого файла не будет обновлен ни инициатором запроса, ни модулем записи, и такая резервная копия не может использоваться в качестве основы для добавочной или разностной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="e0078-112">However, the backup history of each file will not be updated by either requester or writer, and this sort of backup cannot be used as the basis of an incremental or differential backup.</span></span>
-   <span data-ttu-id="e0078-113">Файл журнала ( \_ Журнал VSS \_ ) — резервное копирование требуется только для файлов журнала модуля записи.</span><span class="sxs-lookup"><span data-stu-id="e0078-113">Log File (VSS\_BS\_LOG)—only a writer's log files are to be backed up.</span></span> <span data-ttu-id="e0078-114">Для этого необходимо, чтобы модуль записи добавил хотя бы один файл по крайней мере в один компонент с помощью метода [**ивсскреатевритерметадата:: адддатабаселогфилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) .</span><span class="sxs-lookup"><span data-stu-id="e0078-114">This requires a writer to have added at least one file to at least one component using the [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) method.</span></span> <span data-ttu-id="e0078-115">Этот тип резервного копирования относится только к VSS.</span><span class="sxs-lookup"><span data-stu-id="e0078-115">This backup type is specific to VSS.</span></span>
-   <span data-ttu-id="e0078-116">Пользовательские расположения для восстановления ( \_ \_ модуль записи в VSS \_ поддерживает \_ новый \_ целевой объект) — указывает поддержку модуля записи для изменения инициатора запроса во время восстановления, где восстанавливаются файлы.</span><span class="sxs-lookup"><span data-stu-id="e0078-116">Custom Restore Locations (VSS\_BS\_WRITER\_SUPPORTS\_NEW\_TARGET)—indicates writer support for a requester changing, at restore time, where its files are restored.</span></span> <span data-ttu-id="e0078-117">Это означает, что модуль записи был закодирован для проверки такого перемещения (с помощью [**ивсскомпонент:: жетневтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget)) и имеет емкость для работы с перемещенными файлами.</span><span class="sxs-lookup"><span data-stu-id="e0078-117">This means that a writer has been coded to check for such relocation (using [**IVssComponent::GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget)), and has the capacity for working with relocated files.</span></span>
-   <span data-ttu-id="e0078-118">Восстановление с помощью Move ( \_ \_ модуль записи VSS \_ поддерживает \_ Восстановление \_ с \_ перемещением) — указывает, что модуль записи поддерживает запуск нескольких экземпляров модуля записи с одним и тем же идентификатором класса и поддерживает инициатор запроса, который перемещает компонент в другой экземпляр модуля записи во время восстановления.</span><span class="sxs-lookup"><span data-stu-id="e0078-118">Restore with Move (VSS\_BS\_WRITER\_SUPPORTS\_RESTORE\_WITH\_MOVE)—indicates that the writer supports running multiple writer instances with the same class ID, and it supports a requester moving a component to a different writer instance at restore time.</span></span> <span data-ttu-id="e0078-119">Экземпляр модуля записи указывается с помощью имени Постоянного экземпляра модуля записи, переданного в качестве параметра *всзвритеринстанценаме* в метод [**Квссвритер:: Initialize**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-initialize) .</span><span class="sxs-lookup"><span data-stu-id="e0078-119">The writer instance is specified by using a persistent writer instance name that was passed as the *wszWriterInstanceName* parameter to the [**CVssWriter::Initialize**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-initialize) method.</span></span> <span data-ttu-id="e0078-120">Инициатор запроса может получить имя экземпляра модуля записи с помощью [**ивссексаминевритерметадатаекс:: жетидентитекс**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadataex-getidentityex) и переместить компоненты во время восстановления с помощью [**Ивссбаккупкомпонентсекс:: сетселектедфорресторикс**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex).</span><span class="sxs-lookup"><span data-stu-id="e0078-120">A requester can obtain the writer instance name using [**IVssExamineWriterMetadataEx::GetIdentityEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadataex-getidentityex) and move components during restore using [**IVssBackupComponentsEx::SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex).</span></span>

    <span data-ttu-id="e0078-121">**Windows Server 2003 и Windows XP:** Это значение не поддерживается до Windows Server 2003 с пакетом обновления 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="e0078-121">**Windows Server 2003 and Windows XP:** This value is not supported until Windows Server 2003 with Service Pack 1 (SP1).</span></span>

-   <span data-ttu-id="e0078-122">Добавочное ( \_ \_ Добавочное изменение VSS) — указывает, что модуль записи использует API VSS, чтобы помочь инициатору запроса, гарантируя, что только файлы, которые были изменены или добавлены с момента последнего полного или добавочного резервного копирования, будут скопированы на носитель хранения.</span><span class="sxs-lookup"><span data-stu-id="e0078-122">Incremental (VSS\_BS\_INCREMENTAL)—indicates that the writer uses the VSS API to help the requester, ensuring that only files that have been changed or added since the last full or incremental backup are to be copied to a storage medium.</span></span>

    <span data-ttu-id="e0078-123">Для восстановления добавочной резервной копии требуется исходный образ резервного копирования и все добавочные образы резервных копий, созданные с момента создания исходной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="e0078-123">Restoring an incremental backup requires the original backup image and all incremental backup images made since the initial backup.</span></span>

-   <span data-ttu-id="e0078-124">Разностная ( \_ \_ разностная резервная копия VSS). указывает, что модуль записи использует API VSS, чтобы гарантировать, что только файлы, которые были изменены или добавлены с момента последнего полного резервного копирования, будут скопированы на носитель. все промежуточные данные резервных копий игнорируются.</span><span class="sxs-lookup"><span data-stu-id="e0078-124">Differential (VSS\_BS\_DIFFERENTIAL)—indicates that the writer uses the VSS API to help the requester ensure that only files that have been changed or added since the last full backup are to be copied to a storage medium; all intermediate backup information is ignored.</span></span>

    <span data-ttu-id="e0078-125">Для восстановления разностной резервной копии требуется исходный образ резервной копии и последняя разностная резервная копия, созданная с момента последнего полного резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="e0078-125">Restoring a differential backup requires the original backup image and the most recent differential backup image made since the last full backup.</span></span>

-   <span data-ttu-id="e0078-126">Добавочное или разностное: поддержка меток времени ( \_ Метка времени VSS \_ ) — указывает, что модуль записи поддерживает использование механизма временной метки VSS для включения файлов в добавочные или разностные операции.</span><span class="sxs-lookup"><span data-stu-id="e0078-126">Incremental/Differential: Time Stamping Support (VSS\_BS\_TIMESTAMPED)—indicates that a writer supports using the VSS time-stamp mechanism to include files in incremental or differential operations.</span></span> <span data-ttu-id="e0078-127">Во время резервного копирования модуль записи должен сохранить метку резервного копирования [*набора файлов*](vssgloss-f.md) с помощью метода [**Ивсскомпонент:: сетбаккупстамп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp) , а при восстановлении извлечь его с помощью [**ивсскомпонент:: жетпревиаусбаккупстамп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="e0078-127">At backup, the writer must store a [*file set's*](vssgloss-f.md) backup stamp with the [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp) method, and at restore retrieve it with [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span></span>
-   <span data-ttu-id="e0078-128">Добавочный/разностный: время последнего изменения ( \_ \_ Последнее изменение VSS \_ ) — указывает, что при реализации добавочных или разностных резервных копий с использованием различных файлов средство записи может предоставлять сведения о времени последнего изменения независимо друг от друга.</span><span class="sxs-lookup"><span data-stu-id="e0078-128">Incremental/Differential: Time of Last Modification Support (VSS\_BS\_LAST\_MODIFY)—indicates that when implementing incremental or differential backups with differenced files, a writer can provide last modification time information independently.</span></span> <span data-ttu-id="e0078-129">Эти сведения могут предоставляться инициатору запроса через метод [**ивсскомпонент:: адддифференцедфилесбиластмодифитиме**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) .</span><span class="sxs-lookup"><span data-stu-id="e0078-129">This information can be provided to a requester via the [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) method.</span></span>
-   <span data-ttu-id="e0078-130">Добавочное/разностное: ограничение поддержки \_ ( \_ \_ добавочная \_ разностная копия VSS) — указывает, поддерживает ли модуль записи как разностные, так и инкрементные схемы резервного копирования, но только монопольно: например, нельзя выполнить добавочное резервное копирование с разностной резервной копией.</span><span class="sxs-lookup"><span data-stu-id="e0078-130">Incremental/Differential: Support Limitation (VSS\_BS\_EXCLUSIVE\_INCREMENTAL\_DIFFERENTIAL)—indicates writer support of both differential or increment backup schemas, but only exclusively: for example, you cannot follow an incremental backup with a differential backup.</span></span>
-   <span data-ttu-id="e0078-131">Независимое состояние системы ( \_ \_ состояние независимой \_ системы VSS \_ ) — указывает, что модуль записи поддерживает резервное копирование данных, которые являются частью состояния системы, но также могут создавать резервные копии независимо от состояния системы.</span><span class="sxs-lookup"><span data-stu-id="e0078-131">Independent System State (VSS\_BS\_INDEPENDENT\_SYSTEM\_STATE)—indicates that the writer supports backing up data that is part of the system state, but that can also be backed up independently of the system state.</span></span>

    <span data-ttu-id="e0078-132">**Windows Server 2003 и Windows XP:** Это значение не поддерживается до Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="e0078-132">**Windows Server 2003 and Windows XP:** This value is not supported until Windows Vista.</span></span>

-   <span data-ttu-id="e0078-133">Восстановление Roll-Forward ( \_ Восстановление VSS \_ Накату \_ ) — указывает, что модуль записи поддерживает инициатор запроса, устанавливающий точку отката с помощью [**IVssBackupComponentsEx2:: сетроллфорвард**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex2-setrollforward).</span><span class="sxs-lookup"><span data-stu-id="e0078-133">Roll-Forward Restore (VSS\_BS\_ROLLFORWARD\_RESTORE)—indicates that the writer supports a requester setting a roll-forward restore point using [**IVssBackupComponentsEx2::SetRollForward**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex2-setrollforward).</span></span>

    <span data-ttu-id="e0078-134">**Windows Server 2003 и Windows XP:** Это значение не поддерживается до Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="e0078-134">**Windows Server 2003 and Windows XP:** This value is not supported until Windows Vista.</span></span>

-   <span data-ttu-id="e0078-135">Restore Rename \_ ( \_ Rename, Restore, восстановление, переименование VSS \_ ) — указывает, что модуль записи поддерживает имя для восстановления с помощью [**IVssBackupComponentsEx2:: сетресторенаме**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex2-setrestorename).</span><span class="sxs-lookup"><span data-stu-id="e0078-135">Restore Rename (VSS\_BS\_RESTORE\_RENAME)—indicates that the writer supports a requester setting a restore name using [**IVssBackupComponentsEx2::SetRestoreName**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex2-setrestorename).</span></span>

    <span data-ttu-id="e0078-136">**Windows Server 2003 и Windows XP:** Это значение не поддерживается до Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="e0078-136">**Windows Server 2003 and Windows XP:** This value is not supported until Windows Vista.</span></span>

-   <span data-ttu-id="e0078-137">Полномочное восстановление ( \_ \_ полномочное \_ Восстановление VSS) — указывает, что модуль записи поддерживает параметр запрашивающего принудительного восстановления с помощью [**IVssBackupComponentsEx2:: сетаусоритативересторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex2-setauthoritativerestore).</span><span class="sxs-lookup"><span data-stu-id="e0078-137">Authoritative Restore (VSS\_BS\_AUTHORITATIVE\_RESTORE)—indicates that the writer supports a requester setting authoritative restore using [**IVssBackupComponentsEx2::SetAuthoritativeRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex2-setauthoritativerestore).</span></span>

<span data-ttu-id="e0078-138">Модули записи устанавливают свои схемы с помощью метода [**ивсскреатевритерметадата:: сетбаккупсчема**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) , а инициатор запроса получает схему каждого модуля записи путем вызова [**Ивссексаминевритерметадата:: жетбаккупсчема**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema).</span><span class="sxs-lookup"><span data-stu-id="e0078-138">Writers set their schemas using the [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) method, and a requester obtains each writer's schema by calling [**IVssExamineWriterMetadata::GetBackupSchema**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema).</span></span>

 

 



