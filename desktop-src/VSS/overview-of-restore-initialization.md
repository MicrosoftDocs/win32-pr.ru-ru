---
description: При инициализации операции восстановления VSS инициатору запроса необходимо получить документ компонента резервного копирования и каждый соответствующий документ метаданных модуля записи, созданный и сохраненный во время операции резервного копирования.
ms.assetid: 0a087125-c9d4-460a-8153-3e2e26633ac2
title: Общие сведения об инициализации восстановления
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6eb62e5282a74e38cd53d36c8ba004f4b8069746
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104156115"
---
# <a name="overview-of-restore-initialization"></a><span data-ttu-id="7c03e-103">Общие сведения об инициализации восстановления</span><span class="sxs-lookup"><span data-stu-id="7c03e-103">Overview of Restore Initialization</span></span>

<span data-ttu-id="7c03e-104">При инициализации операции восстановления VSS инициатору запроса необходимо получить документ компонента резервного копирования и каждый соответствующий документ метаданных модуля записи, созданный и сохраненный во время операции резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="7c03e-104">In initializing a VSS restore operation, a requester needs to retrieve the Backup Component Document and each relevant Writer Metadata Document created and saved during the backup operation.</span></span> <span data-ttu-id="7c03e-105">Текущее состояние модуля записи будет запрошено при обработке [*события Identify*](vssgloss-i.md) , формируемого инициатором запроса.</span><span class="sxs-lookup"><span data-stu-id="7c03e-105">The writer will have its current state queried in handling the [*Identify event*](vssgloss-i.md) that the requester generates.</span></span> <span data-ttu-id="7c03e-106">Дополнительные сведения см. в разделе Общие сведения об [обработке восстановления в VSS](overview-of-processing-a-restore-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="7c03e-106">For more information, see [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md).</span></span>

<span data-ttu-id="7c03e-107">В следующей таблице показана последовательность действий и событий, необходимых для инициализации операции восстановления.</span><span class="sxs-lookup"><span data-stu-id="7c03e-107">The following table shows the sequence of actions and events that are required to initialize a restore operation.</span></span>



| <span data-ttu-id="7c03e-108">Действие запросившего</span><span class="sxs-lookup"><span data-stu-id="7c03e-108">Requester action</span></span>                                                                                                                                                                                                                                                                                                       | <span data-ttu-id="7c03e-109">Событие</span><span class="sxs-lookup"><span data-stu-id="7c03e-109">Event</span></span>                                                     | <span data-ttu-id="7c03e-110">Действие записи</span><span class="sxs-lookup"><span data-stu-id="7c03e-110">Writer action</span></span>                                                                                                                                                                                                                                                                                                             |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="7c03e-111">Создание интерфейса [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) , его инициализация для управления восстановлением и загрузка сохраненных метаданных инициатора запроса (см. раздел [**креатевссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents), [**ивссбаккупкомпонентс:: инитиализефорресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore)).</span><span class="sxs-lookup"><span data-stu-id="7c03e-111">Create an [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface, initialize it to manage a restore, and load stored requester metadata (see [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents), [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore)).</span></span> | <span data-ttu-id="7c03e-112">Нет</span><span class="sxs-lookup"><span data-stu-id="7c03e-112">None</span></span>                                                      | <span data-ttu-id="7c03e-113">Нет</span><span class="sxs-lookup"><span data-stu-id="7c03e-113">None</span></span>                                                                                                                                                                                                                                                                                                                      |
| <span data-ttu-id="7c03e-114">Вызовите [**креатевссексаминевритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssexaminewritermetadata) , чтобы создать интерфейсы [**ивссексаминевритерметадата**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) и загрузить их с помощью хранимых метаданных модуля записи.</span><span class="sxs-lookup"><span data-stu-id="7c03e-114">Call [**CreateVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssexaminewritermetadata) to create [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) interfaces and load them with stored writer metadata.</span></span>                                                                                                           | <span data-ttu-id="7c03e-115">Нет</span><span class="sxs-lookup"><span data-stu-id="7c03e-115">None</span></span>                                                      | <span data-ttu-id="7c03e-116">Нет</span><span class="sxs-lookup"><span data-stu-id="7c03e-116">None</span></span>                                                                                                                                                                                                                                                                                                                      |
| <span data-ttu-id="7c03e-117">Инициация асинхронного обращения с модулями записи (см. [**ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).)</span><span class="sxs-lookup"><span data-stu-id="7c03e-117">Initiate asynchronous contact with writers (see [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).)</span></span>                                                                                                                                                                      | [<span data-ttu-id="7c03e-118">*Указывается*</span><span class="sxs-lookup"><span data-stu-id="7c03e-118">*Identify*</span></span>](vssgloss-i.md) | <span data-ttu-id="7c03e-119">Модуль записи начинает обработку событий при поддержке восстановления.</span><span class="sxs-lookup"><span data-stu-id="7c03e-119">The writer begins event handling in support of the restore.</span></span> <span data-ttu-id="7c03e-120">Создает документ метаданных модуля записи (см. раздел [Работа с документом метаданных модуля записи](working-with-the-writer-metadata-document.md), [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), [**ивсскреатевритерметадата**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata)).</span><span class="sxs-lookup"><span data-stu-id="7c03e-120">Creates the Writer Metadata Document (see [Working with the Writer Metadata Document](working-with-the-writer-metadata-document.md), [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata)).</span></span> |
| <span data-ttu-id="7c03e-121">Инициатор запроса ожидает инициализации модулей записи путем вызова [**ивссасинк**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span><span class="sxs-lookup"><span data-stu-id="7c03e-121">The requester waits for writers to initialize by calling [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span></span>                                                                                                                                                                                                                               | <span data-ttu-id="7c03e-122">Нет</span><span class="sxs-lookup"><span data-stu-id="7c03e-122">None</span></span>                                                      | <span data-ttu-id="7c03e-123">Нет</span><span class="sxs-lookup"><span data-stu-id="7c03e-123">None</span></span>                                                                                                                                                                                                                                                                                                                      |



 

## <a name="requester-actions-during-restore-initialization"></a><span data-ttu-id="7c03e-124">Действия запрашивающего во время инициализации восстановления</span><span class="sxs-lookup"><span data-stu-id="7c03e-124">Requester Actions during Restore Initialization</span></span>

<span data-ttu-id="7c03e-125">На этапе инициализации восстановления инициатору запроса должен быть предоставлен доступ к документу сохраненных компонентов резервного копирования и всем документам метаданных модуля записи.</span><span class="sxs-lookup"><span data-stu-id="7c03e-125">During the initialization phase of a restore, the requester needs to have access to the stored Backup Components Document and all the Writer Metadata Documents.</span></span>

<span data-ttu-id="7c03e-126">В зависимости от реализации это означает, что инициатор запроса потребует, чтобы носитель резервной копии был подключен и доступен для чтения, либо был доступен другой механизм доступа к сохраненным метаданным.</span><span class="sxs-lookup"><span data-stu-id="7c03e-126">Depending on the implementation, this will mean either that the requester will require that backup media be mounted and readable, or that some other mechanism for accessing the stored metadata be available.</span></span>

<span data-ttu-id="7c03e-127">Запрашивающий объект использует сохраненный XML-документ, содержащий компонент резервного копирования, который содержит документ, который выполнил резервное копирование, чтобы инициализировать его компоненты резервного копирования с помощью [**ивссбаккупкомпонентс:: инитиализефорресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore) , может получить доступ к данным.</span><span class="sxs-lookup"><span data-stu-id="7c03e-127">The requester uses the stored XML document containing the Backup Components Document of the requester that performed the backup to initialize its Backup Components Document using [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore) can access the information.</span></span>

<span data-ttu-id="7c03e-128">Как и в случае резервного копирования, документ компонентов резервного копирования содержит недостаточные сведения для поддержки восстановления. Таким образом, инициатору запроса требуется доступ к этим документам метаданных модуля записи, хранящимся во время резервного копирования (см. раздел [Использование компонентов инициатором запроса](use-of-components-by-the-requestor.md)).</span><span class="sxs-lookup"><span data-stu-id="7c03e-128">As was the case during the backup, the Backup Components Document has insufficient information to support a restore; therefore, the requester needs access to those Writer Metadata Documents stored during backup (see [Use of Components by the Requester](use-of-components-by-the-requestor.md)).</span></span>

<span data-ttu-id="7c03e-129">Инициатор запроса получает метаданные сохраненной записи, вызывая [**креатевссексаминевритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssexaminewritermetadata) для каждого модуля записи, чьи данные были сохранены и которые теперь должны быть восстановлены.</span><span class="sxs-lookup"><span data-stu-id="7c03e-129">The requester retrieves the stored writer metadata by calling [**CreateVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssexaminewritermetadata) for each writer whose data was backed up and now is to be restored.</span></span> <span data-ttu-id="7c03e-130">Эта функция создает объект [**ивссексаминевритерметадата**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) для каждого модуля записи и загружает в объект документ метаданных модуля записи модуля записи.</span><span class="sxs-lookup"><span data-stu-id="7c03e-130">This function creates an [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) object for each writer and loads the writer's Writer Metadata Document into the object.</span></span>

<span data-ttu-id="7c03e-131">Как и во время резервного копирования, чтобы начать сотрудничество между собой и модулями записи системы, инициатор запроса должен создать событие [*идентификации*](vssgloss-i.md) путем вызова [**Ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span><span class="sxs-lookup"><span data-stu-id="7c03e-131">As was the case during the backup, to initiate cooperation between itself and the system's writers, a requester must generate an [*Identify*](vssgloss-i.md) event by calling [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span> <span data-ttu-id="7c03e-132">Не нужно вызывать метод [**ивссбаккупкомпонентс:: гасервритерстатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) после завершения [**гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span><span class="sxs-lookup"><span data-stu-id="7c03e-132">It is not necessary to call [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) following the completion of [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span> <span data-ttu-id="7c03e-133">Модули записи, которые не обрабатывали событие [*определения*](vssgloss-i.md) , не будут включаться в список модулей записи, предоставляющих метаданные, возвращаемые [**Ивссбаккупкомпонентс:: жетвритерметадатакаунт**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadatacount) и [**ивссбаккупкомпонентс:: Жетвритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) (см. раздел [Определение состояния модуля записи](determining-writer-status.md)).</span><span class="sxs-lookup"><span data-stu-id="7c03e-133">Writers that fail to process the [*Identify*](vssgloss-i.md) event will not be included in the list of writers providing the metadata to be returned by [**IVssBackupComponents::GetWriterMetadataCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadatacount) and [**IVssBackupComponents::GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) (see [Determining Writer Status](determining-writer-status.md)).</span></span>

<span data-ttu-id="7c03e-134">Как и в случае с операцией резервного копирования, инициатору запроса потребуется запросить и проанализировать сведения в документе о компонентах резервного копирования и сравнить их с данными в документах метаданных модуля записи, чтобы определить, какие компоненты были скопированы, и выбрать восстанавливаемые данные (см. [Обзор подготовки к](overview-of-preparing-for-restore.md)восстановлению).</span><span class="sxs-lookup"><span data-stu-id="7c03e-134">As with the backup operation, a requester will need to query and parse the information in the Backup Components Document and compare it to data in the Writer Metadata Documents to determine which components were backed up and to choose those to be restored (see [Overview of Preparing for Restore](overview-of-preparing-for-restore.md)).</span></span> <span data-ttu-id="7c03e-135">Кроме того, инициатору запроса потребуется создать подробный список, содержащий сведения о файлах на носителе резервных копий, выбранном для восстановления, а также о том, как и где они будут восстановлены.</span><span class="sxs-lookup"><span data-stu-id="7c03e-135">In addition, the requester will need to generate a detailed list containing information about the files on the backup media selected for restore, as well as how and where they are to be restored.</span></span> <span data-ttu-id="7c03e-136">(См. раздел [Создание набора восстановления](generating-a-restore-set.md).)</span><span class="sxs-lookup"><span data-stu-id="7c03e-136">(See [Generating a Restore Set](generating-a-restore-set.md).)</span></span>

<span data-ttu-id="7c03e-137">Поэтому некоторые приложения резервного копирования могут оказаться полезными для хранения на носителе резервных копий (в собственном оптимизированном формате) файлов и связанных с ними модулей записи, компонента, процедуры восстановления и сведений о расположении.</span><span class="sxs-lookup"><span data-stu-id="7c03e-137">Therefore, some backup applications may find it useful to have stored on the backup media their own list (in their own optimized format) of the files and their associated writer, component, restore procedure, and location information.</span></span> <span data-ttu-id="7c03e-138">Этот список можно использовать для снижения объема синтаксического анализа и сравнения документов метаданных модуля записи и документов компонентов резервного копирования, необходимых для поддержки восстановления.</span><span class="sxs-lookup"><span data-stu-id="7c03e-138">This list can be used to minimize the amount of parsing and comparing of Writer Metadata Documents and the Backup Component Documents required to support a restore.</span></span>

## <a name="writer-actions-during-restore-initialization"></a><span data-ttu-id="7c03e-139">Действия модуля записи во время инициализации восстановления</span><span class="sxs-lookup"><span data-stu-id="7c03e-139">Writer Actions during Restore Initialization</span></span>

<span data-ttu-id="7c03e-140">Как и во время операции восстановления, в ответ на событие Identify служба VSS вызывает метод виртуального обработчика каждого средства записи [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify).</span><span class="sxs-lookup"><span data-stu-id="7c03e-140">Just as is done during a restore operation, in response to the Identify event, VSS calls each writer's virtual handler method [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify).</span></span>

<span data-ttu-id="7c03e-141">Обратите внимание, что приложения, отличные от текущего запрашивающего (например, системных приложений), могут создавать события, которые должны обрабатываться модулем записи.</span><span class="sxs-lookup"><span data-stu-id="7c03e-141">Note that applications other than the current requester (for instance, system applications) can generate Identify events, which must be handled by the writer.</span></span> <span data-ttu-id="7c03e-142">Кроме того, разработчик не может определить, какое приложение создало событие Identify, с помощью [**квссвритер:: \ Identify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) .</span><span class="sxs-lookup"><span data-stu-id="7c03e-142">In addition, there is no way for a writer to determine from within [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) which application has generated the Identify event.</span></span>

<span data-ttu-id="7c03e-143">Учитывая, что при обработке операции восстановления модуль записи может получить несколько событий Identify, модули записи не должны задавать сведения о состоянии в обработчике [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) .</span><span class="sxs-lookup"><span data-stu-id="7c03e-143">Given that a writer may receive several Identify events while processing a restore operation, writers should never set state information in the [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) handler.</span></span> <span data-ttu-id="7c03e-144">Вместо этого они должны использовать один и тот же алгоритм для создания документа метаданных модуля записи, как это было сделано во время операций резервного копирования (Дополнительные сведения см. в разделе [действия модуля записи во время инициализации резервной копии](overview-of-backup-initialization.md) ).</span><span class="sxs-lookup"><span data-stu-id="7c03e-144">Instead, they must use the same algorithm for creating their Writer Metadata Document as was done during backup operations (see [Writer Actions during Backup Initialization](overview-of-backup-initialization.md) for more information).</span></span>

 

 



