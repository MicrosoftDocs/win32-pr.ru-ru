---
description: VSS позволяет инициатору запроса получить доступ к теневой копии томов, содержащих данные для резервного копирования, и копировать их на носитель резервной копии.
ms.assetid: 187f26f2-f191-4703-9bde-3357f1ceef0c
title: Общие сведения о фактическом резервном копировании файлов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 98a504ff5a41725e33a2eb27792a3c6c89d00276
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692903"
---
# <a name="overview-of-actual-backup-of-files"></a><span data-ttu-id="a5e0b-103">Общие сведения о фактическом резервном копировании файлов</span><span class="sxs-lookup"><span data-stu-id="a5e0b-103">Overview of Actual Backup Of Files</span></span>

<span data-ttu-id="a5e0b-104">VSS позволяет инициатору запроса получить доступ к теневой копии томов, содержащих данные для резервного копирования, и копировать их на носитель резервной копии.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-104">VSS enables a requester to access the shadow copy of volumes containing data for backup and to copy data to backup media.</span></span> <span data-ttu-id="a5e0b-105">В ходе этого процесса модули записи обычно продолжают работать нормально.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-105">Writers generally proceed with normal operation during this process.</span></span> <span data-ttu-id="a5e0b-106">Дополнительные сведения см. в разделе Общие сведения об [обработке резервной копии в VSS](overview-of-processing-a-backup-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="a5e0b-106">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md).</span></span>

<span data-ttu-id="a5e0b-107">В следующей таблице показана последовательность действий и событий, необходимых для резервного копирования файлов.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-107">The following table shows the sequence of actions and events that are required for files to be backed up.</span></span>



<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th><span data-ttu-id="a5e0b-108">Действие запросившего</span><span class="sxs-lookup"><span data-stu-id="a5e0b-108">Requester action</span></span></th>
<th><span data-ttu-id="a5e0b-109">Событие</span><span class="sxs-lookup"><span data-stu-id="a5e0b-109">Event</span></span></th>
<th><span data-ttu-id="a5e0b-110">Действие записи</span><span class="sxs-lookup"><span data-stu-id="a5e0b-110">Writer action</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="a5e0b-111">Доступ к файлам на тенев скопированном томе (см <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties"><strong>. раздел ивссбаккупкомпонентс:: жетснапшотпропертиес</strong></a>, <a href="/windows/desktop/api/Vss/ns-vss-vss_snapshot_prop"><strong>VSS_SNAPSHOT_PROP</strong></a>)</span><span class="sxs-lookup"><span data-stu-id="a5e0b-111">Access files on the shadow-copied volume (see <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties"><strong>IVssBackupComponents::GetSnapshotProperties</strong></a>, <a href="/windows/desktop/api/Vss/ns-vss-vss_snapshot_prop"><strong>VSS_SNAPSHOT_PROP</strong></a>)</span></span></td>
<td><span data-ttu-id="a5e0b-112">Нет</span><span class="sxs-lookup"><span data-stu-id="a5e0b-112">None</span></span></td>
<td><span data-ttu-id="a5e0b-113">Нет</span><span class="sxs-lookup"><span data-stu-id="a5e0b-113">None</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="a5e0b-114">Создайте список файлов для резервного копирования и скопируйте данные файлов на носитель резервной копии.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-114">Generate the list of files to back up, and copy file data to backup media.</span></span></td>
<td><span data-ttu-id="a5e0b-115">Нет</span><span class="sxs-lookup"><span data-stu-id="a5e0b-115">None</span></span></td>
<td><span data-ttu-id="a5e0b-116">Нет</span><span class="sxs-lookup"><span data-stu-id="a5e0b-116">None</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="a5e0b-117">Укажите успешность или сбой резервного копирования с помощью <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded"><strong>ивссбаккупкомпонентс:: сетбаккупсукцеедед</strong></a>.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-117">Indicate the success or failure of the backup with <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded"><strong>IVssBackupComponents::SetBackupSucceeded</strong></a>.</span></span></td>
<td><span data-ttu-id="a5e0b-118">Нет</span><span class="sxs-lookup"><span data-stu-id="a5e0b-118">None</span></span></td>
<td><span data-ttu-id="a5e0b-119">Нет</span><span class="sxs-lookup"><span data-stu-id="a5e0b-119">None</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="a5e0b-120">Инициатор запроса указывает, что резервное копирование завершено путем вызова <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete"><strong>ивссбаккупкомпонентс:: баккупкомплете</strong></a>.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-120">The requester indicates that the backup has completed by calling <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete"><strong>IVssBackupComponents::BackupComplete</strong></a>.</span></span></td>
<td><span data-ttu-id="a5e0b-121"><a href="vssgloss-b.md"><em>баккупкомплете</em></a></span><span class="sxs-lookup"><span data-stu-id="a5e0b-121"><a href="vssgloss-b.md"><em>BackupComplete</em></a></span></span></td>
<td><span data-ttu-id="a5e0b-122">Выполните очистку после резервного копирования (см. раздел <a href="/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete"><strong>квссвритер:: онбаккупкомплете</strong></a>, <a href="/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents"><strong>ивссвритеркомпонентс</strong></a>, <a href="/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent"><strong>ивсскомпонент</strong></a>).</span><span class="sxs-lookup"><span data-stu-id="a5e0b-122">Perform any post-backup cleanup (see <a href="/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete"><strong>CVssWriter::OnBackupComplete</strong></a>, <a href="/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents"><strong>IVssWriterComponents</strong></a>, <a href="/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent"><strong>IVssComponent</strong></a>).</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="a5e0b-123">Инициатор запроса ждет, пока все модули записи заподтверждают получение события <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete"><strong>ивссбаккупкомпонентс:: баккупкомплете</strong></a> с помощью <a href="/windows/desktop/api/Vss/nn-vss-ivssasync"><strong>ивссасинк</strong></a>.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-123">The requester waits for all writers to acknowledge receipt of the <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete"><strong>IVssBackupComponents::BackupComplete</strong></a> event using <a href="/windows/desktop/api/Vss/nn-vss-ivssasync"><strong>IVssAsync</strong></a>.</span></span> <span data-ttu-id="a5e0b-124">Он также должен проверить состояние модуля записи (см. раздел <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus"><strong>ивссбаккупкомпонентс:: гасервритерстатус</strong></a>, <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus"><strong>Ивссбаккупкомпонентс:: жетвритерстатус</strong></a>).</span><span class="sxs-lookup"><span data-stu-id="a5e0b-124">It should also verify writer status (see <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus"><strong>IVssBackupComponents::GatherWriterStatus</strong></a>, <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus"><strong>IVssBackupComponents::GetWriterStatus</strong></a>).</span></span> <span data-ttu-id="a5e0b-125">Инициатор запроса должен вызвать <strong>гасервритерстатус</strong> в данный момент, чтобы сделать сеанс записи незавершенным.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-125">The requester must call <strong>GatherWriterStatus</strong> at this time to cause the writer session to be set to a completed state.</span></span>
<blockquote>
[!Note]<br />
<span data-ttu-id="a5e0b-126">Это необходимо только в Windows Server 2008 с пакетом обновления 2 (SP2) и более ранних версий.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-126">This is only necessary on Windows Server 2008 with Service Pack 2 (SP2) and earlier.</span></span>
</blockquote>
<br/></td>
<td><span data-ttu-id="a5e0b-127">Нет</span><span class="sxs-lookup"><span data-stu-id="a5e0b-127">None</span></span></td>
<td><span data-ttu-id="a5e0b-128">Нет</span><span class="sxs-lookup"><span data-stu-id="a5e0b-128">None</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="a5e0b-129">Сохраните документ компонентов резервного копирования и каждый документ метаданных модуля записи в XML-документы, которые можно записать на носитель резервной копии (см. <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml"><strong>ивссбаккупкомпонентс:: савеасксмл</strong></a> and <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml"><strong>Ивссексаминевритерметадата:: савеасксмл</strong></a>).</span><span class="sxs-lookup"><span data-stu-id="a5e0b-129">Save the Backup Components Document and each Writer Metadata Document to XML documents, which can be written to the backup media (see <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml"><strong>IVssBackupComponents::SaveAsXML</strong></a> and <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml"><strong>IVssExamineWriterMetadata::SaveAsXML</strong></a>).</span></span></td>
<td><span data-ttu-id="a5e0b-130">Нет</span><span class="sxs-lookup"><span data-stu-id="a5e0b-130">None</span></span></td>
<td><span data-ttu-id="a5e0b-131">Нет</span><span class="sxs-lookup"><span data-stu-id="a5e0b-131">None</span></span></td>
</tr>
</tbody>
</table>



 

## <a name="writer-actions-during-backup-of-files"></a><span data-ttu-id="a5e0b-132">Действия модуля записи во время резервного копирования файлов</span><span class="sxs-lookup"><span data-stu-id="a5e0b-132">Writer Actions during Backup of Files</span></span>

<span data-ttu-id="a5e0b-133">После завершения теневой копии все операции ввода-вывода в системе, для которой создается резервная копия, должны быть доступны для возобновления без нарушения целостности резервной копии.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-133">After the shadow copy has been completed, all I/O operations on the system that is being backed up should be able to resume without disrupting the integrity of the backup.</span></span> <span data-ttu-id="a5e0b-134">Это одна из основных причин для использования функции теневого копирования.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-134">This is one of the prime motivations for having the shadow copy functionality.</span></span>

<span data-ttu-id="a5e0b-135">Таким образом, как и на этапе обнаружения (см. [Обзор этапа обнаружения резервного копирования](overview-of-the-backup-discovery-phase.md)), при создании резервных копий файлов на самом деле помещаются незначительные требования.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-135">Therefore, as in the discovery phase (see [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md)), there are few demands placed on the writers while files are actually being backed up.</span></span>

<span data-ttu-id="a5e0b-136">После завершения резервного копирования и запроса, создавшего событие [*баккупкомплете*](vssgloss-b.md) , VSS вызывает метод [**Квссвритер:: онбаккупкомплете**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) средства записи, виртуальный метод, который по умолчанию просто возвращает **значение true**.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-136">After a backup has completed, and a requester has generated a [*BackupComplete*](vssgloss-b.md) event, VSS will call each writer's [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) method, a virtual method that by default simply returns **TRUE**.</span></span> <span data-ttu-id="a5e0b-137">Однако модули записи могут переопределить реализацию по умолчанию и предпринять такие действия, как удаление оставшихся временных файлов, или использовать интерфейс [**ивссвритеркомпонентс**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) , который вызывается вместе с для проверки состояния резервной копии каждого из [*включенных явно*](vssgloss-e.md) компонентов (и любого [*набора компонентов*](vssgloss-c.md) , которые они могут определить) путем получения соответствующего объекта [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .</span><span class="sxs-lookup"><span data-stu-id="a5e0b-137">However, writers can override the default implementation and take such actions as removing remaining temporary files, or use the [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface it is called with to check the state of the backup of each of its [*included explicitly*](vssgloss-e.md) components (and any [*component set*](vssgloss-c.md) they might define) by retrieving the corresponding [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) object.</span></span> <span data-ttu-id="a5e0b-138">Затем модуль записи может определить успешность или сбой резервного копирования, вызвав [**ивсскомпонент: жетбаккупсукцеедед**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupsucceeded).</span><span class="sxs-lookup"><span data-stu-id="a5e0b-138">The writer can then determine, and act on, the success or failure of the backup by calling [**IVssComponent:GetBackupSucceeded**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupsucceeded).</span></span> <span data-ttu-id="a5e0b-139">Значение, возвращаемое функцией **ивсскомпонент: жетбаккупсукцеедед** , будет иметь значение **true** , только если все явно включенные файлы в компоненте и все [*неявные включения*](vssgloss-i.md) всех его [*компонентов*](vssgloss-s.md) были успешно созданы.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-139">The value returned by **IVssComponent:GetBackupSucceeded** will be **TRUE** only if all explicitly included files in the component and all [*implicitly included*](vssgloss-i.md) of any of its [*subcomponents*](vssgloss-s.md) have been successfully backed up.</span></span>

<span data-ttu-id="a5e0b-140">Когда вызов [**квссвритер:: онбаккупкомплете**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) завершится, инициатор запроса должен вызвать [**Ивссбаккупкомпонентс:: гасервритерстатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) и [**ивссбаккупкомпонентс:: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) (для каждого модуля записи) один раз в последнее время.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-140">When the call to [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) has completed, the requester should call [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) and [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) (for each writer) one last time.</span></span> <span data-ttu-id="a5e0b-141">Память состояния сеанса модуля записи — это ограниченный ресурс, и модули записи должны в конечном итоге повторно использовать состояния сеанса.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-141">The writer session state memory is a limited resource and writers must eventually reuse session states.</span></span> <span data-ttu-id="a5e0b-142">Этот шаг помечает состояние сеанса резервного копирования модуля записи как завершенное и уведомляет VSS о том, что этот слот сеанса резервного копирования может быть повторно использован последующей операцией резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-142">This step marks the writer’s backup session state as completed and notifies VSS that this backup session slot can be reused by a subsequent backup operation.</span></span>

## <a name="requester-actions-during-backup-of-files"></a><span data-ttu-id="a5e0b-143">Действия запросившего во время резервного копирования файлов</span><span class="sxs-lookup"><span data-stu-id="a5e0b-143">Requester Actions during Backup of Files</span></span>

<span data-ttu-id="a5e0b-144">Как указано в разделе [Общие сведения об этапе обнаружения резервных копий](overview-of-the-backup-discovery-phase.md), не следует создавать фактический список файлов для резервного копирования до завершения теневой копии.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-144">As noted in [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md), you should not generate the actual list of files to be backed up until the shadow copy has completed.</span></span>

<span data-ttu-id="a5e0b-145">[*Объект устройства*](vssgloss-d.md) , соответствующий теневой копии заданного тома, используется для получения доступа к файлам на тенев скопированном томе после завершения теневой копии.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-145">The [*device object*](vssgloss-d.md) corresponding to the shadow copy of a given volume is used to get access to files on the shadow copied volume once the shadow copy has completed.</span></span> <span data-ttu-id="a5e0b-146">Объект устройства получается из объекта [**\_ \_ prop снимка VSS**](/windows/desktop/api/Vss/ns-vss-vss_snapshot_prop) , возвращенного [**ивссбаккупкомпонентс:: жетснапшотпропертиес**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties).</span><span class="sxs-lookup"><span data-stu-id="a5e0b-146">The device object is obtained from the [**VSS\_SNAPSHOT\_PROP**](/windows/desktop/api/Vss/ns-vss-vss_snapshot_prop) object returned by [**IVssBackupComponents::GetSnapshotProperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties).</span></span> <span data-ttu-id="a5e0b-147">Каждая теневая копия набора теневых копий будет иметь собственный объект устройства.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-147">Each shadow copy of a shadow copy set will have its own device object.</span></span>

<span data-ttu-id="a5e0b-148">Затем для выбора файлов для резервного копирования используются объект устройства и пути, полученные из спецификации документа метаданных модуля записи.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-148">The device object and the paths obtained from the Writer Metadata Document specifications of components are then used to select files for backup.</span></span> <span data-ttu-id="a5e0b-149">Дополнительные сведения см. [в разделе доступ инициатора запросов к теневым скопированным данным](requestor-access-to-shadow-copied-data.md) .</span><span class="sxs-lookup"><span data-stu-id="a5e0b-149">See [Requester Access to Shadow Copied Data](requestor-access-to-shadow-copied-data.md) for more information.</span></span>

<span data-ttu-id="a5e0b-150">Файлы, включаемые в список резервных копий, зависят от природы конкретной резервной копии, от [*выбора компонентов для резервного копирования*](vssgloss-s.md)и структуры записи (см. раздел [Работа с выборкой для резервного копирования](working-with-selectability-for-backup.md)).</span><span class="sxs-lookup"><span data-stu-id="a5e0b-150">Which files will be included in the backup list depends on the nature of the particular backup, upon component [*selectability for backup*](vssgloss-s.md), and the logical path structure of the writer (see [Working with Selectability for Backup](working-with-selectability-for-backup.md)).</span></span>

<span data-ttu-id="a5e0b-151">Помимо файлов, указанных в компонентах, данный модуль записи может также иметь явно исключенные файлы.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-151">In addition to files specified in the components, a given writer may also have explicitly excluded files.</span></span> <span data-ttu-id="a5e0b-152">Исключение файлов всегда следует учитывать независимо от того, какие компоненты выбраны.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-152">File exclusion must always be respected, regardless of which components are selected.</span></span>

<span data-ttu-id="a5e0b-153">Кроме того, как указано в [обзоре этапа обнаружения резервного копирования](overview-of-the-backup-discovery-phase.md), подключенная папка или точка повторного анализа могут быть отображены в теневой копии и могут быть архивированы.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-153">Also as noted in [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md), a mounted folder or reparse point can appear in a shadow copy and can be backed up.</span></span> <span data-ttu-id="a5e0b-154">Однако не удается просмотреть подключенную папку или точку повторного анализа на томе, скопированном с помощью теневого копирования (см. раздел [Работа с подключенными папками и точки повторного анализа](working-with-reparse-and-mount-points.md)).</span><span class="sxs-lookup"><span data-stu-id="a5e0b-154">However, a mounted folder or reparse point cannot be traversed on the shadow-copied volume (see [Working with Mounted Folders and Reparse Points](working-with-reparse-and-mount-points.md)).</span></span>

<span data-ttu-id="a5e0b-155">Во время операции резервного копирования следует также соблюдать осторожность, если [*альтернативный путь*](vssgloss-a.md) , возвращенный [**Ивссвмфиледеск:: жеталтернателокатион**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) , не является пустым.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-155">Care should also be taken during a backup operation, if the [*alternate path*](vssgloss-a.md) returned by [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) is not blank.</span></span> <span data-ttu-id="a5e0b-156">Альтернативный путь отличается от [*сопоставления альтернативного расположения*](vssgloss-a.md) тем, что он используется только во время резервного копирования, а сопоставление альтернативного расположения используется только во время восстановления.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-156">An alternate path differs from an [*alternate location mapping*](vssgloss-a.md) in that it is used only during backups, while an alternate location mapping is used only during restores.</span></span>

<span data-ttu-id="a5e0b-157">В этом случае данные не должны архивироваться из их нормального расположения (обозначено [**ивссвмфиледеск::**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)ивссвмфиледеск), но из расположения, возвращенного в [**жеталтернателокатион**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation).</span><span class="sxs-lookup"><span data-stu-id="a5e0b-157">In this case, the data is not to be backed up from its normal location (indicated by [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)), but from the location returned by [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation).</span></span> <span data-ttu-id="a5e0b-158">При восстановлении файл возвращается в обычное расположение.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-158">On restore, the file should be returned to its normal location.</span></span> <span data-ttu-id="a5e0b-159">Дополнительные сведения см. в разделе [расположения резервного копирования и восстановления не по умолчанию](non-default-backup-and-restore-locations.md) .</span><span class="sxs-lookup"><span data-stu-id="a5e0b-159">See [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md) for more information.</span></span>

<span data-ttu-id="a5e0b-160">Служба VSS не накладывает никаких ограничений на фактический механизм резервного копирования данных на носитель или выбранный носитель.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-160">VSS places no restrictions on the actual mechanism of backing up data to a storage medium or the choice of that medium.</span></span> <span data-ttu-id="a5e0b-161">Однако рекомендуется обрабатывать файлы каждого компонента каждого [*экземпляра модуля записи*](vssgloss-w.md) как единое целое.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-161">However, it is recommended that the files of each component of each [*writer instance*](vssgloss-w.md) be processed as a unit.</span></span> <span data-ttu-id="a5e0b-162">См. раздел [Создание резервного набора данных](generating-a-backup-set.md) для обсуждения рекомендаций по созданию списка файлов резервных копий.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-162">See [Generating A Backup Set](generating-a-backup-set.md) for a discussion of best practices in generating the backup file list.</span></span>

<span data-ttu-id="a5e0b-163">Успешное или неуспешное выполнение резервного копирования любого файла, управляемого заданным компонентом, и (если он определяет [*набор компонентов*](vssgloss-c.md)) его [*подкомпоненты*](vssgloss-s.md) для данного экземпляра модуля записи должны быть сохранены в документе компонента резервного копирования путем вызова [**ивссбаккупкомпонентс:: сетбаккупсукцеедед**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded).</span><span class="sxs-lookup"><span data-stu-id="a5e0b-163">The success or failure of backing up any of the files managed by a given component and (if it defines a [*component set*](vssgloss-c.md)) its [*subcomponents*](vssgloss-s.md) for a given writer instance should be preserved in the Backup Components Document by calling [**IVssBackupComponents::SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded).</span></span> <span data-ttu-id="a5e0b-164">Если какой-либо файл, управляемый компонентом или набором компонентов, не может выполнить резервное копирование, происходит сбой всего компонента.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-164">If any file managed by a component or component set fails to back up, the entire component is said to fail.</span></span> <span data-ttu-id="a5e0b-165">Точные сведения о том, какой файл не удалось архивировать, всегда следует записывать в журнал.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-165">Exact information about which file failed to back up should always be logged.</span></span>

<span data-ttu-id="a5e0b-166">Разработчикам может оказаться полезным хранить записи на резервных носителях, для которых архивируются файлы, компоненты и набор компонентов, в которых они были членами, их спецификации и исходные пути.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-166">Developers may find it helpful to store a record on the backup media of which files are backed up, the components and component set they were a member of, their specification, and what their original paths were.</span></span> <span data-ttu-id="a5e0b-167">Также может быть полезно хранить такие сведения, как определение компонента каждого модуля записи.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-167">It may also be useful to store information such as each writer's component definition.</span></span> <span data-ttu-id="a5e0b-168">Это может упростить операцию извлечения.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-168">Doing this may make the retrieval operation simpler.</span></span> <span data-ttu-id="a5e0b-169">Однако эти сведения оставлены разработчику инициатора запроса.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-169">However, such details are left to the requester developer.</span></span>

<span data-ttu-id="a5e0b-170">Поскольку модули записи могут изменять документ резервных компонентов при обработке события [**моментального снимка**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) , созданного вызовом [**Ивссбаккупкомпонентс::D Оснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), документ резервного копирования не следует сохранять до тех пор, пока не завершится этот асинхронный вызов.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-170">Because writers can modify the Backup Components Document while handling the [**PostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) event generated by the requester's call to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), the Backup Components Document should not be saved until after that asynchronous call has completed.</span></span>

<span data-ttu-id="a5e0b-171">Несмотря на то, что он может выполняться раньше, это удобное время для сохранения документа метаданных модуля записи.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-171">Although it may take place earlier, this is also a convenient time to save the Writer Metadata Document.</span></span>

<span data-ttu-id="a5e0b-172">Очень важно, чтобы и документ компонентов резервного копирования, и документы метаданных модуля записи сохранялись с помощью [**ивссбаккупкомпонентс:: савеасксмл**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) и [**Ивссексаминевритерметадата:: савеасксмл**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml).</span><span class="sxs-lookup"><span data-stu-id="a5e0b-172">It is very important that both the Backup Components Document and the Writer Metadata Documents be preserved using [**IVssBackupComponents::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) and [**IVssExamineWriterMetadata::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml).</span></span> <span data-ttu-id="a5e0b-173">Если это не так, использование VSS во время восстановления файлов будет невозможно.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-173">If they are not, it will not be possible to make use of VSS during file restoration.</span></span>

<span data-ttu-id="a5e0b-174">Помимо хранения исходных метаданных, некоторые приложения резервного копирования могут оказаться полезными для сохранения копии собственного списка файлов (в их оптимизированном формате), а также связанных с ними модулей записи, компонента, процедуры восстановления и сведений о расположении — на носителе резервной копии для последующего извлечения.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-174">In addition to storing the original metadata, some backup applications may find it useful to save a copy of their own list of the files (in their own optimized format)—and their associated writer, component, restore procedure, and location information—to the backup media for later retrieval.</span></span> <span data-ttu-id="a5e0b-175">Такой список можно использовать, чтобы избежать некоторых синтаксических анализов и сравнений документов метаданных модуля записи и документов компонента резервного копирования во время восстановления.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-175">Such a list can be used to avoid some of the parsing and comparing of Writer Metadata Documents and the Backup Component Documents during restore.</span></span>

<span data-ttu-id="a5e0b-176">Тома, для которых выполняется резервное копирование, могут содержать данные, не управляемые модулями записи VSS.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-176">Volumes being backed up may have data that is not managed by VSS writers.</span></span> <span data-ttu-id="a5e0b-177">Эти данные могут и должны быть созданы из теневой копии тома, где они будут находиться в [*состоянии*](vssgloss-c.md)отказоустойчивости.</span><span class="sxs-lookup"><span data-stu-id="a5e0b-177">This data can and should be backed up from the shadow copied volume, where it will be in a [*crash-consistent state*](vssgloss-c.md).</span></span> <span data-ttu-id="a5e0b-178">Дополнительные сведения см. в статье [резервное копирование без участия в записи](backups-without-writer-participation.md) .</span><span class="sxs-lookup"><span data-stu-id="a5e0b-178">See [Backups without Writer Participation](backups-without-writer-participation.md) for more information.</span></span>

 

 




