---
description: Ниже приведены указания по взаимоправильному взаимодействии с различными функциями файловой системы и безопасности, которые появились в Windows Vista и Windows Server 2008.
ms.assetid: 3e8a1fd2-59e5-4f18-aafc-0ce5ac1e1cfa
title: Работа с файловой системой и функциями безопасности
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 12903599beb7ed153965f4b803ad8147fd32067a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104145184"
---
# <a name="working-with-file-system-and-security-features"></a>Работа с файловой системой и функциями безопасности

Ниже приведены указания по взаимоправильному взаимодействии с различными функциями файловой системы и безопасности, которые появились в Windows Vista и Windows Server 2008.

## <a name="interoperability-with-transactions"></a>Взаимодействие с транзакциями

Для поддержки транзакций служба VSS гарантирует, что диспетчер транзакций ядра (KTM) и координатор распределенных транзакций (DTC) фиксируются до создания теневых копий томов. Если системе не удается заморозить или разморозить KTM или DTC, то метод [**ивссбаккупкомпонентс::D оснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) может вернуть следующие ошибки времени ожидания:

<dl> \_ \_ \_ время ожидания замораживания транзакции VSS E \_  
\_ \_ \_ время ожидания размораживание транзакции VSS E \_  
</dl>

Если инициатор запроса получает один из этих кодов ошибок, необходимо повторить попытку создания теневой копии.

Операции с реестром и файловой системой также могут быть транзакционными. В случае с реестром модуль записи реестра отвечает за обеспечение согласованности транзакций. В случае транзакционных операций файловой системы NTFS поставщик системы отвечает за обеспечение согласованности транзакций. Это достигается путем подключения теневой копии как для чтения и записи после ее создания, чтобы разрешить автоматическое восстановление. На этапе автоматического восстановления KTM выполняет откат всех незавершенных транзакций.

## <a name="identifying-and-creating-hard-links"></a>Определение и создание жестких связей

При резервном копировании файлов приложение резервного копирования должно указывать все жесткие связи для каждого файла, чтобы избежать повторного резервного копирования одного и того же файла. Для перечисления жестких связей доступны две новые функции: [**финдфирстфиленамев**](/windows/win32/api/fileapi/nf-fileapi-findfirstfilenamew) и [**финднекстфиленамев**](/windows/win32/api/fileapi/nf-fileapi-findnextfilenamew).

Аналогичным образом при восстановлении файлов приложение резервного копирования должно восстанавливать жесткие связи с помощью функции [**креатехардлинк**](/windows/win32/api/winbase/nf-winbase-createhardlinka) .

Приложения резервного копирования должны также утверждать \_ \_ привилегию SE Backup Name во время фазы резервного копирования и \_ имя восстановления SE на \_ этапе восстановления.

## <a name="permissions-and-privileges-required-by-backup-applications"></a>Разрешения и привилегии, необходимые для резервного копирования приложений

Приложениям резервного копирования, которые восстанавливают системные файлы, требуются следующие права:

<dl> SE \_ имя резервной копии \_  
SE \_ \_ имя восстановления  
\_имя безопасности \_ SE  
SE \_ . \_ Получение \_ имени владельца  
</dl>

Приложения резервного копирования должны также запрашивать \_ права доступа владельца записи на этапе восстановления.

## <a name="windows-media-digital-rights-management"></a>Цифровой Rights Management Windows Media

Клиент Windows Media Digital Rights Management (DRM) поддерживает каталог с конфиденциальными файлами состояния и лицензий в каталоге% папка ProgramData% \\ Microsoft \\ Windows \\ DRM. Файлы в этом каталоге должны быть очищены одновременно с временными и файлами кэша. Чтобы обеспечить целостность клиента Windows DRM, следует избегать резервного копирования и восстановления этих файлов. Этот каталог указан в разделе реестра Филесноттобаккуп. Дополнительные сведения о ключе Филесноттобаккуп см. в разделе [Создание резервного набора данных](generating-a-backup-set.md).

## <a name="user-account-control"></a>контроль учетных записей

Введение контроля учетных записей (UAC) в Windows Vista означает, что, если не указано иное, приложения должны работать под учетной записью обычного пользователя. Кроме того, функция виртуализации файлов и реестра в контроле учетных записей изменяет расположения, в которых хранятся пользовательские данные. Дополнительные сведения о работе с UAC и виртуализации файлов и реестра см. по следующим ссылкам:

<dl>

[Статья для разработчиков Windows Vista и Windows Server 2008: требования к разработке приложений Windows Vista для контроля учетных записей пользователей (UAC)](/previous-versions/aa905330(v=msdn.10))  
[Требования к разработке приложений Windows Vista для обеспечения совместимости управления учетными записями пользователей](/previous-versions/dotnet/articles/bb530410(v=msdn.10))  
[Исправление контроля учетных записей пользователей (UAC)](../msi/user-account-control--uac--patching.md)  
</dl>

## <a name="bitlocker-drive-encryption"></a>Шифрование диска BitLocker

Шифрование диска BitLocker — это новая функция в Windows Vista Enterprise, Windows Vista Ultimate и Windows Server 2008, которая обеспечивает безопасный запуск и полное шифрование тома. Понимание этой функции важно для разработчиков приложений резервного копирования, которые выполняют автономное восстановление, где данные могут потребоваться восстановить на зашифрованном диске.

Чтобы восстановить данные на зашифрованный диск, выполните следующие действия.

1.  Разблокируйте диск.
2.  Отключите шифрование диска BitLocker.
3.  Выполните восстановление.
4.  Загрузите восстановленную операционную систему и включите шифрование диска BitLocker.

Подробные сведения о шифрование диска BitLocker, включая пошаговые инструкции, см. в разделе [Шифрование диска BitLocker](https://www.microsoft.com/technet/windowsvista/security/bitlockr.mspx) на веб-сайте Microsoft TechNet Windows Vista. Дополнительные сведения о поставщике шифрование диска BitLocker WMI см. в разделе [поставщик шифрование диска BitLocker](../secprov/bitlocker-drive-encryption-provider.md).

 

 
