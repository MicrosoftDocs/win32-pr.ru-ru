---
description: Ниже приведены указания по взаимоправильному взаимодействии с различными функциями файловой системы и безопасности, которые появились в Windows Vista и Windows Server 2008.
ms.assetid: 3e8a1fd2-59e5-4f18-aafc-0ce5ac1e1cfa
title: Работа с файловой системой и функциями безопасности
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 12903599beb7ed153965f4b803ad8147fd32067a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104145184"
---
# <a name="working-with-file-system-and-security-features"></a><span data-ttu-id="7580d-103">Работа с файловой системой и функциями безопасности</span><span class="sxs-lookup"><span data-stu-id="7580d-103">Working with File System and Security Features</span></span>

<span data-ttu-id="7580d-104">Ниже приведены указания по взаимоправильному взаимодействии с различными функциями файловой системы и безопасности, которые появились в Windows Vista и Windows Server 2008.</span><span class="sxs-lookup"><span data-stu-id="7580d-104">The following are hints for interoperating correctly with various file system and security features that were introduced in Windows Vista and Windows Server 2008.</span></span>

## <a name="interoperability-with-transactions"></a><span data-ttu-id="7580d-105">Взаимодействие с транзакциями</span><span class="sxs-lookup"><span data-stu-id="7580d-105">Interoperability with Transactions</span></span>

<span data-ttu-id="7580d-106">Для поддержки транзакций служба VSS гарантирует, что диспетчер транзакций ядра (KTM) и координатор распределенных транзакций (DTC) фиксируются до создания теневых копий томов.</span><span class="sxs-lookup"><span data-stu-id="7580d-106">To support transactions, VSS ensures that both the Kernel Transaction Manager (KTM) and the Distributed Transaction Coordinator (DTC) are frozen prior to the creation of volume shadow copies.</span></span> <span data-ttu-id="7580d-107">Если системе не удается заморозить или разморозить KTM или DTC, то метод [**ивссбаккупкомпонентс::D оснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) может вернуть следующие ошибки времени ожидания:</span><span class="sxs-lookup"><span data-stu-id="7580d-107">If the system fails to freeze or thaw KTM or DTC, the following timeout errors may be returned by the [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) method:</span></span>

<dl> <span data-ttu-id="7580d-108">\_ \_ \_ время ожидания замораживания транзакции VSS E \_</span><span class="sxs-lookup"><span data-stu-id="7580d-108">VSS\_E\_TRANSACTION\_FREEZE\_TIMEOUT</span></span>  
<span data-ttu-id="7580d-109">\_ \_ \_ время ожидания размораживание транзакции VSS E \_</span><span class="sxs-lookup"><span data-stu-id="7580d-109">VSS\_E\_TRANSACTION\_THAW\_TIMEOUT</span></span>  
</dl>

<span data-ttu-id="7580d-110">Если инициатор запроса получает один из этих кодов ошибок, необходимо повторить попытку создания теневой копии.</span><span class="sxs-lookup"><span data-stu-id="7580d-110">If the requester receives one of these error codes, it must retry the shadow copy creation.</span></span>

<span data-ttu-id="7580d-111">Операции с реестром и файловой системой также могут быть транзакционными.</span><span class="sxs-lookup"><span data-stu-id="7580d-111">Registry and file system operations can also be transacted.</span></span> <span data-ttu-id="7580d-112">В случае с реестром модуль записи реестра отвечает за обеспечение согласованности транзакций.</span><span class="sxs-lookup"><span data-stu-id="7580d-112">In the case of the registry, the registry writer is responsible for ensuring transactional consistency.</span></span> <span data-ttu-id="7580d-113">В случае транзакционных операций файловой системы NTFS поставщик системы отвечает за обеспечение согласованности транзакций.</span><span class="sxs-lookup"><span data-stu-id="7580d-113">In the case of Transactional NTFS (TxF) file system operations, the system provider is responsible for ensuring transactional consistency.</span></span> <span data-ttu-id="7580d-114">Это достигается путем подключения теневой копии как для чтения и записи после ее создания, чтобы разрешить автоматическое восстановление.</span><span class="sxs-lookup"><span data-stu-id="7580d-114">This is accomplished by mounting the shadow copy as read/write after it is created to allow for auto-recovery.</span></span> <span data-ttu-id="7580d-115">На этапе автоматического восстановления KTM выполняет откат всех незавершенных транзакций.</span><span class="sxs-lookup"><span data-stu-id="7580d-115">During the auto-recovery phase, KTM rolls back any incomplete transactions.</span></span>

## <a name="identifying-and-creating-hard-links"></a><span data-ttu-id="7580d-116">Определение и создание жестких связей</span><span class="sxs-lookup"><span data-stu-id="7580d-116">Identifying and Creating Hard Links</span></span>

<span data-ttu-id="7580d-117">При резервном копировании файлов приложение резервного копирования должно указывать все жесткие связи для каждого файла, чтобы избежать повторного резервного копирования одного и того же файла.</span><span class="sxs-lookup"><span data-stu-id="7580d-117">When backing up files, a backup application must identify all hard links to each file to avoid backing up the same file more than once.</span></span> <span data-ttu-id="7580d-118">Для перечисления жестких связей доступны две новые функции: [**финдфирстфиленамев**](/windows/win32/api/fileapi/nf-fileapi-findfirstfilenamew) и [**финднекстфиленамев**](/windows/win32/api/fileapi/nf-fileapi-findnextfilenamew).</span><span class="sxs-lookup"><span data-stu-id="7580d-118">Two new functions are available for enumerating hard links: [**FindFirstFileNameW**](/windows/win32/api/fileapi/nf-fileapi-findfirstfilenamew) and [**FindNextFileNameW**](/windows/win32/api/fileapi/nf-fileapi-findnextfilenamew).</span></span>

<span data-ttu-id="7580d-119">Аналогичным образом при восстановлении файлов приложение резервного копирования должно восстанавливать жесткие связи с помощью функции [**креатехардлинк**](/windows/win32/api/winbase/nf-winbase-createhardlinka) .</span><span class="sxs-lookup"><span data-stu-id="7580d-119">Similarly, when restoring files, the backup application must restore hard links using the [**CreateHardLink**](/windows/win32/api/winbase/nf-winbase-createhardlinka) function.</span></span>

<span data-ttu-id="7580d-120">Приложения резервного копирования должны также утверждать \_ \_ привилегию SE Backup Name во время фазы резервного копирования и \_ имя восстановления SE на \_ этапе восстановления.</span><span class="sxs-lookup"><span data-stu-id="7580d-120">Backup applications must also assert the SE\_BACKUP\_NAME privilege during the backup phase and the SE\_RESTORE\_NAME during the restore phase.</span></span>

## <a name="permissions-and-privileges-required-by-backup-applications"></a><span data-ttu-id="7580d-121">Разрешения и привилегии, необходимые для резервного копирования приложений</span><span class="sxs-lookup"><span data-stu-id="7580d-121">Permissions and Privileges Required by Backup Applications</span></span>

<span data-ttu-id="7580d-122">Приложениям резервного копирования, которые восстанавливают системные файлы, требуются следующие права:</span><span class="sxs-lookup"><span data-stu-id="7580d-122">Backup applications that restore system files require the following privileges:</span></span>

<dl> <span data-ttu-id="7580d-123">SE \_ имя резервной копии \_</span><span class="sxs-lookup"><span data-stu-id="7580d-123">SE\_BACKUP\_NAME</span></span>  
<span data-ttu-id="7580d-124">SE \_ \_ имя восстановления</span><span class="sxs-lookup"><span data-stu-id="7580d-124">SE\_RESTORE\_NAME</span></span>  
<span data-ttu-id="7580d-125">\_имя безопасности \_ SE</span><span class="sxs-lookup"><span data-stu-id="7580d-125">SE\_SECURITY\_NAME</span></span>  
<span data-ttu-id="7580d-126">SE \_ . \_ Получение \_ имени владельца</span><span class="sxs-lookup"><span data-stu-id="7580d-126">SE\_TAKE\_OWNERSHIP\_NAME</span></span>  
</dl>

<span data-ttu-id="7580d-127">Приложения резервного копирования должны также запрашивать \_ права доступа владельца записи на этапе восстановления.</span><span class="sxs-lookup"><span data-stu-id="7580d-127">Backup applications must also request WRITE\_OWNER access rights during the restore phase.</span></span>

## <a name="windows-media-digital-rights-management"></a><span data-ttu-id="7580d-128">Цифровой Rights Management Windows Media</span><span class="sxs-lookup"><span data-stu-id="7580d-128">Windows Media Digital Rights Management</span></span>

<span data-ttu-id="7580d-129">Клиент Windows Media Digital Rights Management (DRM) поддерживает каталог с конфиденциальными файлами состояния и лицензий в каталоге% папка ProgramData% \\ Microsoft \\ Windows \\ DRM.</span><span class="sxs-lookup"><span data-stu-id="7580d-129">Windows Media Digital Rights Management (DRM) client maintains a directory of sensitive state and license files in the %ProgramData%\\Microsoft\\Windows\\DRM directory.</span></span> <span data-ttu-id="7580d-130">Файлы в этом каталоге должны быть очищены одновременно с временными и файлами кэша.</span><span class="sxs-lookup"><span data-stu-id="7580d-130">The files in this directory should be purged at the same time as temporary and cache files.</span></span> <span data-ttu-id="7580d-131">Чтобы обеспечить целостность клиента Windows DRM, следует избегать резервного копирования и восстановления этих файлов.</span><span class="sxs-lookup"><span data-stu-id="7580d-131">To ensure that the Windows DRM client remains in a consistent state, you must avoid backing up or restoring these files.</span></span> <span data-ttu-id="7580d-132">Этот каталог указан в разделе реестра Филесноттобаккуп.</span><span class="sxs-lookup"><span data-stu-id="7580d-132">This directory is listed in the FilesNotToBackup registry key.</span></span> <span data-ttu-id="7580d-133">Дополнительные сведения о ключе Филесноттобаккуп см. в разделе [Создание резервного набора данных](generating-a-backup-set.md).</span><span class="sxs-lookup"><span data-stu-id="7580d-133">For more information about the FilesNotToBackup key, see [Generating a Backup Set](generating-a-backup-set.md).</span></span>

## <a name="user-account-control"></a><span data-ttu-id="7580d-134">контроль учетных записей</span><span class="sxs-lookup"><span data-stu-id="7580d-134">User Account Control</span></span>

<span data-ttu-id="7580d-135">Введение контроля учетных записей (UAC) в Windows Vista означает, что, если не указано иное, приложения должны работать под учетной записью обычного пользователя.</span><span class="sxs-lookup"><span data-stu-id="7580d-135">The introduction of User Account Control (UAC) in Windows Vista means that unless specified otherwise, applications must run under a standard user account.</span></span> <span data-ttu-id="7580d-136">Кроме того, функция виртуализации файлов и реестра в контроле учетных записей изменяет расположения, в которых хранятся пользовательские данные.</span><span class="sxs-lookup"><span data-stu-id="7580d-136">Additionally, the file and registry virtualization feature of UAC alters the locations where user data is stored.</span></span> <span data-ttu-id="7580d-137">Дополнительные сведения о работе с UAC и виртуализации файлов и реестра см. по следующим ссылкам:</span><span class="sxs-lookup"><span data-stu-id="7580d-137">For more information about how to work with UAC and file and registry virtualization, see the following references:</span></span>

<dl>

<span data-ttu-id="7580d-138">[Статья для разработчиков Windows Vista и Windows Server 2008: требования к разработке приложений Windows Vista для контроля учетных записей пользователей (UAC)](/previous-versions/aa905330(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="7580d-138">[The Windows Vista and Windows Server 2008 Developer Story: Windows Vista Application Development Requirements for User Account Control (UAC)](/previous-versions/aa905330(v=msdn.10))</span></span>  
<span data-ttu-id="7580d-139">[Требования к разработке приложений Windows Vista для обеспечения совместимости управления учетными записями пользователей](/previous-versions/dotnet/articles/bb530410(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="7580d-139">[Windows Vista Application Development Requirements for User Account Control Compatibility](/previous-versions/dotnet/articles/bb530410(v=msdn.10))</span></span>  
[<span data-ttu-id="7580d-140">Исправление контроля учетных записей пользователей (UAC)</span><span class="sxs-lookup"><span data-stu-id="7580d-140">User Account Control (UAC) Patching</span></span>](../msi/user-account-control--uac--patching.md)  
</dl>

## <a name="bitlocker-drive-encryption"></a><span data-ttu-id="7580d-141">Шифрование диска BitLocker</span><span class="sxs-lookup"><span data-stu-id="7580d-141">BitLocker Drive Encryption</span></span>

<span data-ttu-id="7580d-142">Шифрование диска BitLocker — это новая функция в Windows Vista Enterprise, Windows Vista Ultimate и Windows Server 2008, которая обеспечивает безопасный запуск и полное шифрование тома.</span><span class="sxs-lookup"><span data-stu-id="7580d-142">BitLocker Drive Encryption is a new feature in Windows Vista Enterprise, Windows Vista Ultimate, and Windows Server 2008 that offers secure startup and full volume encryption.</span></span> <span data-ttu-id="7580d-143">Понимание этой функции важно для разработчиков приложений резервного копирования, которые выполняют автономное восстановление, где данные могут потребоваться восстановить на зашифрованном диске.</span><span class="sxs-lookup"><span data-stu-id="7580d-143">Understanding this feature is important for developers of backup applications that perform offline restores where data may need to be restored onto an encrypted drive.</span></span>

<span data-ttu-id="7580d-144">Чтобы восстановить данные на зашифрованный диск, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="7580d-144">To restore data onto an encrypted drive, perform the following steps:</span></span>

1.  <span data-ttu-id="7580d-145">Разблокируйте диск.</span><span class="sxs-lookup"><span data-stu-id="7580d-145">Unlock the drive.</span></span>
2.  <span data-ttu-id="7580d-146">Отключите шифрование диска BitLocker.</span><span class="sxs-lookup"><span data-stu-id="7580d-146">Turn off BitLocker Drive Encryption.</span></span>
3.  <span data-ttu-id="7580d-147">Выполните восстановление.</span><span class="sxs-lookup"><span data-stu-id="7580d-147">Perform the restore.</span></span>
4.  <span data-ttu-id="7580d-148">Загрузите восстановленную операционную систему и включите шифрование диска BitLocker.</span><span class="sxs-lookup"><span data-stu-id="7580d-148">Boot into the restored operating system and turn on BitLocker Drive Encryption.</span></span>

<span data-ttu-id="7580d-149">Подробные сведения о шифрование диска BitLocker, включая пошаговые инструкции, см. в разделе [Шифрование диска BitLocker](https://www.microsoft.com/technet/windowsvista/security/bitlockr.mspx) на веб-сайте Microsoft TechNet Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="7580d-149">For detailed information about BitLocker Drive Encryption, including a step-by-step guide, see [BitLocker Drive Encryption](https://www.microsoft.com/technet/windowsvista/security/bitlockr.mspx) on the Microsoft TechNet Windows Vista website.</span></span> <span data-ttu-id="7580d-150">Дополнительные сведения о поставщике шифрование диска BitLocker WMI см. в разделе [поставщик шифрование диска BitLocker](../secprov/bitlocker-drive-encryption-provider.md).</span><span class="sxs-lookup"><span data-stu-id="7580d-150">For information about the BitLocker Drive Encryption WMI provider, see [BitLocker Drive Encryption Provider](../secprov/bitlocker-drive-encryption-provider.md).</span></span>

 

 
