---
description: Модуль записи может завершиться ошибкой для многочисленных программных причин.
ms.assetid: 50eced73-3917-4d7e-96cc-2d793b448738
title: Ошибки и запреты модуля записи
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7c24c15ad10766fc6ec395ed058ab3cb72a689d9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104263093"
---
# <a name="writer-errors-and-vetoes"></a><span data-ttu-id="2c89c-103">Ошибки и запреты модуля записи</span><span class="sxs-lookup"><span data-stu-id="2c89c-103">Writer Errors and Vetoes</span></span>

<span data-ttu-id="2c89c-104">Модуль записи может завершиться ошибкой для многочисленных программных причин.</span><span class="sxs-lookup"><span data-stu-id="2c89c-104">A writer can fail for numerous programmatic reasons.</span></span> <span data-ttu-id="2c89c-105">В этом случае он должен отменять текущую операцию резервного копирования, восстановления или теневого копирования путем вызова метода [**квссвритер:: сетвритерфаилуре**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-setwriterfailure) в одном из методов обработчика (например, [**квссвритер:: onfreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) или [**квссвритер:: Онпрересторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)) и возвращая **значение true**.</span><span class="sxs-lookup"><span data-stu-id="2c89c-105">When this happens, it should veto the ongoing backup, restore, or shadow copy operation by calling the [**CVssWriter::SetWriterFailure**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-setwriterfailure) method in one of its handler methods (for example, [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) or [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)) and returning **TRUE**.</span></span> <span data-ttu-id="2c89c-106">При необходимости можно также задать строку сообщения об ошибке в ответ на условие сбоя в некоторых методах обработчика с помощью методов [**ивсскомпонентекс:: сетпрепарефорбаккупфаилуремсг**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setprepareforbackupfailuremsg), [**Ивсскомпонентекс:: сетпостснапшотфаилуремсг**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setpostsnapshotfailuremsg), [**IVssComponent:: SetPreRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setprerestorefailuremsg)и [**IVssComponent:: SetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setpostrestorefailuremsg) .</span><span class="sxs-lookup"><span data-stu-id="2c89c-106">It can also optionally set an error message string in response to a failure condition in certain handler methods with the [**IVssComponentEx::SetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setprepareforbackupfailuremsg), [**IVssComponentEx::SetPostSnapshotFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setpostsnapshotfailuremsg), [**IVssComponent::SetPreRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setprerestorefailuremsg), and [**IVssComponent::SetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setpostrestorefailuremsg) methods.</span></span> <span data-ttu-id="2c89c-107">Инициатор запроса может принять запрет или продолжить резервное копирование, игнорируя запрет.</span><span class="sxs-lookup"><span data-stu-id="2c89c-107">The requester can accept the veto or continue with the backup, ignoring the veto.</span></span>

<span data-ttu-id="2c89c-108">Инициатор запроса должен проверить состояние модуля записи (с помощью [**ивссбаккупкомпонентс:: гасервритерстатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) и [**Ивссбаккупкомпонентс:: жетвритерстатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)) после каждого создаваемого события.</span><span class="sxs-lookup"><span data-stu-id="2c89c-108">A requester should check the writer status (using [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) and [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)) following each event it generates.</span></span>

<span data-ttu-id="2c89c-109">В некоторых случаях сообщения об ошибках могут быть получены из этих сбоев (с помощью методов [**ивсскомпонентекс:: жетпрепарефорбаккупфаилуремсг**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg), [**Ивсскомпонент:: жетпрересторефаилуремсг**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getprerestorefailuremsg), [**IVssComponentEx:: GetPostSnapshotFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getpostsnapshotfailuremsg)и [**IVssComponent:: GetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpostrestorefailuremsg) ), либо модуль записи может задать метаданные (с помощью [**IVssComponent:: SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata) и [**IVssComponent:: SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) со сведениями о состоянии ошибки).</span><span class="sxs-lookup"><span data-stu-id="2c89c-109">In some cases, error messages can be retrieved from these failures (using the [**IVssComponentEx::GetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg), [**IVssComponent::GetPreRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getprerestorefailuremsg), [**IVssComponentEx::GetPostSnapshotFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getpostsnapshotfailuremsg), and [**IVssComponent::GetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpostrestorefailuremsg) methods), or a writer may choose to set metadata (using [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata) and [**IVssComponent::SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) with error state information).</span></span> <span data-ttu-id="2c89c-110">Пример кода, демонстрирующий, как просмотреть такие сообщения об ошибках, см. в разделе [**ивсскомпонентекс:: жетпрепарефорбаккупфаилуремсг**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg).</span><span class="sxs-lookup"><span data-stu-id="2c89c-110">For example code that shows how to view such error messages, see [**IVssComponentEx::GetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg).</span></span>

<span data-ttu-id="2c89c-111">В зависимости от состояния ошибки инициатор запроса или его оператор может перезапустить резервное копирование и теневую копию с любыми необходимыми изменениями в состоянии задания резервного копирования или системы.</span><span class="sxs-lookup"><span data-stu-id="2c89c-111">Depending on the error state, a requester or its operator could restart the backup and shadow copy with any necessary modification to the state of the backup job or system.</span></span>

<span data-ttu-id="2c89c-112">Например, предположим, что [**жетвритерстатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) вернул следующее:</span><span class="sxs-lookup"><span data-stu-id="2c89c-112">For example, suppose [**GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) returned the following:</span></span>

-   <span data-ttu-id="2c89c-113">Служба **VSS \_ E \_ вритереррор \_ инконсистентснапшот** предлагает, что инициатор запроса может добавлять дополнительные тома к теневой копии.</span><span class="sxs-lookup"><span data-stu-id="2c89c-113">**VSS\_E\_WRITERERROR\_INCONSISTENTSNAPSHOT** suggests that a requester might add additional volumes to the shadow copy</span></span>
-   <span data-ttu-id="2c89c-114">Служба **VSS \_ E \_ вритереррор \_ retryingости** указывает, что повторная попытка без перенастройки может быть выполнена.</span><span class="sxs-lookup"><span data-stu-id="2c89c-114">**VSS\_E\_WRITERERROR\_RETRYABLE** indicates that retrying without reconfiguration might work.</span></span> <span data-ttu-id="2c89c-115">Если модуль записи продолжит возвращать ошибку после нескольких повторных попыток, попробуйте перезапустить службу, в которой размещается модуль записи.</span><span class="sxs-lookup"><span data-stu-id="2c89c-115">If the writer continues to return the error after several retries, try restarting the service that hosts the writer.</span></span> <span data-ttu-id="2c89c-116">Следующие модули записи размещаются в службе VSS: модуль записи реестра, модуль записи базы данных регистрации классов COM+, модуль записи оптимизации теневого копирования и модуль записи автоматического восстановления системы (ASR Writer).</span><span class="sxs-lookup"><span data-stu-id="2c89c-116">The following writers are hosted in the VSS service: registry writer, COM+ class registration database writer, shadow copy optimization writer, and Automated System Recovery (ASR) writer.</span></span> <span data-ttu-id="2c89c-117">Если модуль записи принадлежит приложению, в котором размещается модуль записи в собственном процессе, попробуйте перезапустить приложение.</span><span class="sxs-lookup"><span data-stu-id="2c89c-117">If the writer belongs to an application that hosts the writer in its own process, try restarting the application.</span></span>

    <span data-ttu-id="2c89c-118">**Windows Server 2003 и Windows XP:** Следующие модули записи размещаются в службе VSS: модуль записи реестра, модуль записи базы данных регистрации классов COM+, модуль записи журнала событий приложений и модуль записи Microsoft SQL Server 2000 Desktop Engine (MSDE).</span><span class="sxs-lookup"><span data-stu-id="2c89c-118">**Windows Server 2003 and Windows XP:** The following writers are hosted in the VSS service: registry writer, COM+ class registration database writer, application event log writer, and Microsoft SQL Server 2000 Desktop Engine (MSDE) writer.</span></span>

-   <span data-ttu-id="2c89c-119">\_ \_ Состояние модуля записи \_ VSS \_ \_ в недоступном состоянии указывает, что модуль записи может достигнуть максимального количества доступных сеансов резервного копирования и восстановления, и повторная попытка может быть выполнена, когда система будет менее загружена.</span><span class="sxs-lookup"><span data-stu-id="2c89c-119">VSS\_E\_WRITER\_STATUS\_NOT\_AVAILABLE indicates that a writer may have reached the maximum number of available backup and restore sessions, and retrying might work when the system is less busy.</span></span>
-   <span data-ttu-id="2c89c-120">Служба **VSS \_ E \_ вритереррор \_ Аутофресаурцес** или **VSS \_ e \_ вритереррор \_ timeout** может предложить сократить нагрузку на систему перед повторной попыткой</span><span class="sxs-lookup"><span data-stu-id="2c89c-120">**VSS\_E\_WRITERERROR\_OUTOFRESOURCES** or **VSS\_E\_WRITERERROR\_TIMEOUT** might suggest that system load be reduced prior to retrying</span></span>
-   <span data-ttu-id="2c89c-121">Служба **VSS \_ E \_ вритереррор \_ Нонретрябле** или **VSS \_ e \_ WRITER \_ \_** , скорее всего, покажет ошибку модуля записи настолько серьезно, что не попытается выполнить резервное копирование своих данных с помощью VSS.</span><span class="sxs-lookup"><span data-stu-id="2c89c-121">**VSS\_E\_WRITERERROR\_NONRETRYABLE** or **VSS\_E\_WRITER\_NOT\_RESPONDING** would likely indicate a writer error so severe as to preclude trying to back up its data with VSS.</span></span>

<span data-ttu-id="2c89c-122">В зависимости от того, какой модуль записи и какие компоненты их создают, это не всегда требуется для аварийного завершения работы приложения резервного копирования после запрета или ошибки.</span><span class="sxs-lookup"><span data-stu-id="2c89c-122">Depending on which writer and which components generate them, it is not always necessary for a backup application to abort following a veto or error.</span></span>

<span data-ttu-id="2c89c-123">Например, инициатор запроса может решить, что теневая копия предназначена для резервного копирования приложения а, а также от модуля записи для приложения резервного копирования B. В этом случае вполне допустимо продолжать резервное копирование приложения а, не пропуская запрет.</span><span class="sxs-lookup"><span data-stu-id="2c89c-123">For example, a requester may decide that the intent of the shadow copy is to back up application A and the veto has been received from the writer for backup application B. In this case, it is perfectly acceptable to continue to back up application A while ignoring the veto.</span></span>

<span data-ttu-id="2c89c-124">Ниже приведены примеры запрета записи.</span><span class="sxs-lookup"><span data-stu-id="2c89c-124">The following are examples of a writer veto:</span></span>

-   <span data-ttu-id="2c89c-125">Модуль записи отменяет процесс создания теневой копии, когда ему не удалось приостановить действия во время создания теневой копии.</span><span class="sxs-lookup"><span data-stu-id="2c89c-125">The writer vetoes the shadow copy creation process when it could not suspend its activities during the time the shadow copy was being created.</span></span> <span data-ttu-id="2c89c-126">Это указывает на высокую вероятность того, что теневая копия является недопустимой, так как в состоянии замораживания произошла операция записи.</span><span class="sxs-lookup"><span data-stu-id="2c89c-126">This indicates that there is a high probability that the shadow copy is not valid because a write operation has occurred during the Freeze state.</span></span>
-   <span data-ttu-id="2c89c-127">Приложение резервного копирования запросило теневую копию только тома C:, а модуль записи определяет, что теневая копия C: и D: предназначена для резервного копирования данных.</span><span class="sxs-lookup"><span data-stu-id="2c89c-127">A backup application has requested a shadow copy of only volume C: and a writer determines that a shadow copy of C: and D: is to back up its data.</span></span> <span data-ttu-id="2c89c-128">В этом случае модуль записи отменяет.</span><span class="sxs-lookup"><span data-stu-id="2c89c-128">In this case, the writer will veto.</span></span> <span data-ttu-id="2c89c-129">Приложение резервного копирования может проверить метаданные и определить, будет ли игнорироваться модуль записи или процесс создания теневой копии будет прерван и позднее перезапуститься.</span><span class="sxs-lookup"><span data-stu-id="2c89c-129">The backup application may examine the metadata and determine whether the writer will be ignored or the shadow copy creation process will be aborted and later restarted.</span></span>

 

 



