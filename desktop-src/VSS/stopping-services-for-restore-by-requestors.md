---
description: Может потребоваться остановить службу до и перезапустить после операции восстановления.
ms.assetid: 111d1281-ad83-49bc-868c-1106a0e25a2a
title: Остановка служб для восстановления с помощью инициаторов запроса
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 548af25a4b4550d35a8e6fa4d4c0e791897b6e0a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105693052"
---
# <a name="stopping-services-for-restore-by-requesters"></a><span data-ttu-id="7554d-103">Остановка служб для восстановления с помощью инициаторов запроса</span><span class="sxs-lookup"><span data-stu-id="7554d-103">Stopping Services for Restore by Requesters</span></span>

<span data-ttu-id="7554d-104">Может потребоваться остановить службу до и перезапустить после операции восстановления.</span><span class="sxs-lookup"><span data-stu-id="7554d-104">It may be necessary for a service to be stopped prior to and restarted following a restore operation.</span></span>

<span data-ttu-id="7554d-105">Как правило, остановка и запуск службы для поддержки восстановления выполняется модулем записи при обработке события, выполняемого перед [*восстановлением*](vssgloss-p.md) (с помощью [**Квссвритер:: онпрересторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)), и события [*восстановления*](vssgloss-p.md) (с [**квссвритер:: онпостресторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore)).</span><span class="sxs-lookup"><span data-stu-id="7554d-105">Typically, stopping and starting a service to support a restore would be performed by a writer when handling the [*PreRestore*](vssgloss-p.md) event (with [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)) and the [*PostRestore*](vssgloss-p.md) event (with [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore)).</span></span>

<span data-ttu-id="7554d-106">Однако могут возникнуть ситуации, когда инициатору запроса необходимо явным образом отключить работающую службу.</span><span class="sxs-lookup"><span data-stu-id="7554d-106">However, there may be cases when it is necessary for a requester to explicitly stop a running service.</span></span> <span data-ttu-id="7554d-107">Модули записи указывают, есть ли в этом случае, задав в качестве аргумента метода Restore в методе \_ \_ \_ \_ ивсскреатевритерметадата:: сетресторемесод начальное значение Start Restore рме остановить или остановить восстановление VSS для \_ перечисления VSS \_ \_ \_ [**\_ ресторемесод \_ enum**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) , а также указать имя службы, которая должна быть остановлена. [](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod)</span><span class="sxs-lookup"><span data-stu-id="7554d-107">Writers indicate if this is the case by setting the VSS\_RME\_STOP\_RESTORE\_START or VSS\_RME\_RESTORE\_STOP\_START value of the [**VSS\_RESTOREMETHOD\_ENUM**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) enumeration as the restore method argument of a call to the [**IVssCreateWriterMetadata::SetRestoreMethod**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod) method and specifying the name of the service to be stopped.</span></span>

<span data-ttu-id="7554d-108">Инициатор запроса получает сведения о методе RESTORE и имя службы, которая должна быть остановлена при работе с метаданными модуля записи с помощью метода [**ивссексаминевритерметадата:: жетресторемесод**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod) .</span><span class="sxs-lookup"><span data-stu-id="7554d-108">A requester obtains information about the restore method and the name of the service to be stopped when working with writer metadata by using the [**IVssExamineWriterMetadata::GetRestoreMethod**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod) method.</span></span>

<span data-ttu-id="7554d-109">Важно, чтобы средство записи при указании имени останавливаемой службы использовало правильное известное имя этой службы.</span><span class="sxs-lookup"><span data-stu-id="7554d-109">It is important that the writer, when specifying the name of a service to be stopped, uses the correct publicly known name of that service.</span></span> <span data-ttu-id="7554d-110">Неоднозначное или неверное имя может привести к тому, что инициаторы запросов останавливают неправильную службу или не смогут определить, какая служба должна быть остановлена.</span><span class="sxs-lookup"><span data-stu-id="7554d-110">An ambiguous or inaccurate name may result in requesters stopping the wrong service or being unable to determine which service to stop.</span></span>

<span data-ttu-id="7554d-111">После завершения операции восстановления запрашивающие стороны должны перезапустить службу.</span><span class="sxs-lookup"><span data-stu-id="7554d-111">After the completion of the restore operation, requesters must restart the service.</span></span>

<span data-ttu-id="7554d-112">Необходимо соблюдать осторожность при проектировании и реализации модулей записи, поддерживающих службы, которые запрашивающие стороны должны останавливаться и перезапускать.</span><span class="sxs-lookup"><span data-stu-id="7554d-112">You must be careful in designing and implementing writers that support services that requesters must stop and restart.</span></span> <span data-ttu-id="7554d-113">В частности, такие модули записи не должны быть частью службы, то есть сам модуль записи не нужно останавливать, а затем перезапускаться в ходе операции восстановления.</span><span class="sxs-lookup"><span data-stu-id="7554d-113">Specifically, such writers should not actually be part of the service—that is, the writer itself should not need to be stopped and then restarted in the course of the restore operation.</span></span>

<span data-ttu-id="7554d-114">Модуль записи, процесс которого остановлен, будет иметь другой экземпляр модуля записи после перезапуска.</span><span class="sxs-lookup"><span data-stu-id="7554d-114">A writer whose process is stopped will have a different writer instance upon restart.</span></span> <span data-ttu-id="7554d-115">Новый экземпляр модуля записи не будет принимать события VSS, предназначенные для исходного экземпляра модуля записи.</span><span class="sxs-lookup"><span data-stu-id="7554d-115">The new instance of the writer will not receive VSS events intended for the original instance of the writer.</span></span> <span data-ttu-id="7554d-116">В частности, если процесс экземпляра модуля записи остановлен после обработки события, созданного при предварительном восстановлении, новый экземпляр не будет принимать событие о восстановлении.</span><span class="sxs-lookup"><span data-stu-id="7554d-116">Specifically, if the process of a writer instance is stopped after handling a PreRestore event, the new instance will not receive the PostRestore event.</span></span> <span data-ttu-id="7554d-117">Кроме того, VSS выдаст ошибку, указывающую на утрату записи участия в операции восстановления, и [**ивссбаккупкомпонентс::P остресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) может возвращать ошибку.</span><span class="sxs-lookup"><span data-stu-id="7554d-117">Further, VSS will generate an error indicating the loss of a participating writer in the restore operation, and [**IVssBackupComponents::PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) may return a failure.</span></span>

 

 



