---
description: 'Участие в добавочных и разностных резервных копиях, как правило, происходит при обработке событий Identify (Квссвритер:: onidentify), PrepareForBackup (Квссвритер: Онпрепаребаккуп) и моментального снимка (Квссвритер: Онпостснапшот).'
ms.assetid: 85c4e003-b531-4283-83aa-dd5cc53f35b1
title: Роль модуля записи в добавочных и разностных резервных копиях VSS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f2cda57d907bed4572f0c0f71f9ee829bee18299
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104541698"
---
# <a name="writer-role-in-vss-incremental-and-differential-backups"></a><span data-ttu-id="66287-103">Роль модуля записи в добавочных и разностных резервных копиях VSS</span><span class="sxs-lookup"><span data-stu-id="66287-103">Writer Role in VSS Incremental and Differential Backups</span></span>

<span data-ttu-id="66287-104">Участие в добавочных и разностных резервных копиях, как правило, происходит при обработке событий [*Identify*](vssgloss-i.md) ([**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify)), [*PrepareForBackup*](vssgloss-p.md) ([**Квссвритер: онпрепаребаккуп**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup)) и *моментального снимка* ([**квссвритер: онпостснапшот**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)).</span><span class="sxs-lookup"><span data-stu-id="66287-104">A writer's participation in incremental and differential backups typically takes place while handling [*Identify*](vssgloss-i.md) ([**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify)), [*PrepareForBackup*](vssgloss-p.md) ([**CVssWriter:OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup)), and *PostSnapshot* ([**CVssWriter:OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)) events.</span></span> <span data-ttu-id="66287-105">Способ, которым участвует модуль записи, состоит в том, поддерживает ли он метки резервного копирования и время последнего изменения, а также указывает, поддерживает ли инициатор выполнения резервного копирования [*частичные операции с файлами*](vssgloss-p.md).</span><span class="sxs-lookup"><span data-stu-id="66287-105">How a writer participates is shaped by whether it supports backup stamps and last modification times, and whether the requester running the backup supports [*partial file operations*](vssgloss-p.md).</span></span>

## <a name="handling-identify-events-during-incremental-and-differential-backups"></a><span data-ttu-id="66287-106">Обработка событий Identify во время добавочных и разностных резервных копий</span><span class="sxs-lookup"><span data-stu-id="66287-106">Handling Identify Events during Incremental and Differential Backups</span></span>

<span data-ttu-id="66287-107">При обработке события Identify модули записи устанавливают базовую архитектуру для добавочных и разностных операций резервного копирования через схему резервного копирования ([**\_ \_ схема резервного копирования VSS**](/windows/desktop/api/Vss/ne-vss-vss_backup_schema)) и тип резервной копии спецификации файлов ([**\_ \_ \_ \_ тип резервного копирования спецификаций файлов VSS**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type)).</span><span class="sxs-lookup"><span data-stu-id="66287-107">While handling the Identify event, writers establish their basic architecture for incremental and differential backup operation through the backup schema ([**VSS\_BACKUP\_SCHEMA**](/windows/desktop/api/Vss/ne-vss-vss_backup_schema)) and file specification backup type ([**VSS\_FILE\_SPEC\_BACKUP\_TYPE**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type)) masks.</span></span>

<span data-ttu-id="66287-108">Модуль записи указывает, какие операции он поддерживает в документе метаданных модуля записи, путем создания битовой маски значений [**\_ \_ схемы резервного копирования VSS**](/windows/desktop/api/Vss/ne-vss-vss_backup_schema) и передачи ее в метод [**ивсскреатевритерметадата:: сетбаккупсчема**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) .</span><span class="sxs-lookup"><span data-stu-id="66287-108">A writer indicates which operations it supports in its Writer Metadata Document by creating a bit mask of [**VSS\_BACKUP\_SCHEMA**](/windows/desktop/api/Vss/ne-vss-vss_backup_schema) values and passing it to the [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) method.</span></span> <span data-ttu-id="66287-109">В результате модуль записи может указать, поддерживает ли он следующее:</span><span class="sxs-lookup"><span data-stu-id="66287-109">With this, a writer can indicate whether it supports the following:</span></span>

-   <span data-ttu-id="66287-110">Добавочное резервное копирование (**\_ \_ добавочное создание VSS**)</span><span class="sxs-lookup"><span data-stu-id="66287-110">Incremental backups (**VSS\_BS\_INCREMENTAL**)</span></span>
-   <span data-ttu-id="66287-111">Разностные резервные копии (**\_ \_ разностное** резервное копирование VSS)</span><span class="sxs-lookup"><span data-stu-id="66287-111">Differential backups (**VSS\_BS\_DIFFERENTIAL**)</span></span>
-   <span data-ttu-id="66287-112">Добавочные и разностные резервные копии не могут быть смешанными (**\_ \_ \_ добавочная \_ разностная копия VSS**)</span><span class="sxs-lookup"><span data-stu-id="66287-112">Incremental and differential backups cannot be mixed (**VSS\_BS\_EXCLUSIVE\_INCREMENTAL\_DIFFERENTIAL**)</span></span>
-   <span data-ttu-id="66287-113">Добавочные и разностные резервные копии с использованием меток резервного копирования (**\_ \_ метки времени VSS**)</span><span class="sxs-lookup"><span data-stu-id="66287-113">Incremental and differential backups using backup stamps (**VSS\_BS\_TIMESTAMPED**)</span></span>
-   <span data-ttu-id="66287-114">Добавочные и разностные резервные копии на основе сведений о последнем изменении файла (**\_ \_ Последнее \_ изменение VSS**)</span><span class="sxs-lookup"><span data-stu-id="66287-114">Incremental and differential backups on the basis of information about a file's last modification (**VSS\_BS\_LAST\_MODIFY**)</span></span>

<span data-ttu-id="66287-115">Модули записи используют маску типа резервной копии спецификации файлов, чтобы предоставить сведения на уровне набора файлов запрашивающей стороны о том, как включить файлы в добавочную или разностную резервную копию.</span><span class="sxs-lookup"><span data-stu-id="66287-115">Writers use the file specification backup type mask to provide file set level information to requesters on how to include files in an incremental or differential backup.</span></span>

<span data-ttu-id="66287-116">Модуль записи может задать файловую маску типа резервной копии спецификации файлов при добавлении набора файлов в компонент путем создания битовой маски значений [**\_ \_ \_ \_ типа резервных копий спецификации файлов VSS**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type) и передачи их в [**ивсскреатевритерметадата:: Адддатабасефилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**ивсскреатевритерметадата:: адддатабаселогфилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)или [**IVssCreateWriterMetadata:: AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup).</span><span class="sxs-lookup"><span data-stu-id="66287-116">A writer can set a file set's file specification backup type mask when it adds the file set to a component by creating a bit mask of [**VSS\_FILE\_SPEC\_BACKUP\_TYPE**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type) values and passing it to [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup).</span></span>

<span data-ttu-id="66287-117">Существует три значения параметра "требуется резервное копирование" для перечисления [**\_ \_ \_ \_ типов резервных копий спецификации файлов VSS**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type) , которые влияют на разностное и добавочное резервное копирование.</span><span class="sxs-lookup"><span data-stu-id="66287-117">There are three "backup required" values of the [**VSS\_FILE\_SPEC\_BACKUP\_TYPE**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type) enumeration that affect differential and incremental backups:</span></span>

-   <span data-ttu-id="66287-118">**\_ФСБТ VSS \_ \_ требуется вся резервная копия \_**</span><span class="sxs-lookup"><span data-stu-id="66287-118">**VSS\_FSBT\_ALL\_BACKUP\_REQUIRED**</span></span>
-   <span data-ttu-id="66287-119">**\_ \_ требуется добавочное \_ резервное копирование VSS фсбт \_**</span><span class="sxs-lookup"><span data-stu-id="66287-119">**VSS\_FSBT\_INCREMENTAL\_BACKUP\_REQUIRED**</span></span>
-   <span data-ttu-id="66287-120">**\_ \_ требуется разностное \_ резервное копирование VSS фсбт \_**</span><span class="sxs-lookup"><span data-stu-id="66287-120">**VSS\_FSBT\_DIFFERENTIAL\_BACKUP\_REQUIRED**</span></span>

<span data-ttu-id="66287-121">Есть три значения "требуется теневая копия":</span><span class="sxs-lookup"><span data-stu-id="66287-121">There are three "shadow copy required" values:</span></span>

-   <span data-ttu-id="66287-122">**\_ \_ \_ требуется моментальный снимок фсбт для VSS \_**</span><span class="sxs-lookup"><span data-stu-id="66287-122">**VSS\_FSBT\_ALL\_SNAPSHOT\_REQUIRED**</span></span>
-   <span data-ttu-id="66287-123">**\_ \_ требуется добавочный \_ моментальный снимок VSS фсбт \_**</span><span class="sxs-lookup"><span data-stu-id="66287-123">**VSS\_FSBT\_INCREMENTAL\_SNAPSHOT\_REQUIRED**</span></span>
-   <span data-ttu-id="66287-124">**\_ \_ требуется разностный \_ моментальный снимок VSS фсбт \_**</span><span class="sxs-lookup"><span data-stu-id="66287-124">**VSS\_FSBT\_DIFFERENTIAL\_SNAPSHOT\_REQUIRED**</span></span>

<span data-ttu-id="66287-125">Наборы файлов с меткой "требуется теневая копия" указывает, нужно ли инициатору запроса копировать данные из теневой копии при выполнении операций ДОБАВОЧной, РАЗНОСТной или полной резервной копии (которая включает операции добавочного и разностного копирования).</span><span class="sxs-lookup"><span data-stu-id="66287-125">File sets tagged with a file specification backup type of "shadow copy required" indicate whether a requester needs to copy data from a shadow copy when performing INCREMENTAL, DIFFERENTIAL, or ALL (which includes both incremental and differential operations) backup operations.</span></span>

<span data-ttu-id="66287-126">Флаг "требуется резервное копирование", применяемый к операциям ДОБАВОЧного, РАЗНОСТного или всех операций резервного копирования, указывает, что модуль записи требует, чтобы копия текущей версии набора файлов была доступна после восстановления любой операции резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="66287-126">The "backup required" flag, applied to INCREMENTAL, DIFFERENTIAL, or ALL backup operations, indicates that the writer expects a copy of the current version of the file set to be available following the restore of any backup operation.</span></span> <span data-ttu-id="66287-127">Как правило, это означает, что если набор файлов помечен как "требуется резервное копирование", все его члены будут скопированы на носитель резервных копий во время добавочной или разностной резервной копии независимо от того, когда произошло их резервное копирование или изменение.</span><span class="sxs-lookup"><span data-stu-id="66287-127">Typically, this means that if a file set is tagged with "backup required," all its members will be copied to backup media during an incremental or differential backup, regardless of when their backup or modification last occurred.</span></span>

<span data-ttu-id="66287-128">По умолчанию наборы файлов добавляются в компоненты со спецификацией файлов тип резервной **копии \_ фсбт для \_ всех необходимых \_ резервных копий \_** \| **VSS \_ фсбт \_ все \_ \_ необходимые снимки**.</span><span class="sxs-lookup"><span data-stu-id="66287-128">By default, file sets are added to components with a file specification backup type of **VSS\_FSBT\_ALL\_BACKUP\_REQUIRED** \| **VSS\_FSBT\_ALL\_SNAPSHOT\_REQUIRED**.</span></span> <span data-ttu-id="66287-129">Таким образом, если разработчик модуля записи не решил использовать значение по умолчанию (выбрав другой тип резервной копии, используя частичные операции с файлами или файлы с разной разницей), файлы большинства наборов файлов обычно копируются в резервные носители целиком.</span><span class="sxs-lookup"><span data-stu-id="66287-129">Therefore, unless a writer developer decides not to use the default (by choosing another file specification backup type, using partial file operations, or using differenced files), the files in most file sets will typically be copied in their entirety to backup media.</span></span>

<span data-ttu-id="66287-130">На этом этапе документ метаданных модуля записи модуля записи полностью заполняется большей частью информации, которую инициатору запроса потребуется запустить разностную или добавочную архивацию.</span><span class="sxs-lookup"><span data-stu-id="66287-130">At this point, the writer's Writer Metadata Document is fully populated with most of information a requester will need to start a differential or incremental backup.</span></span> <span data-ttu-id="66287-131">Дополнительные сведения о наборе файлов или данных на уровне файлов для поддержки резервного копирования будут обрабатываться во время события [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) .</span><span class="sxs-lookup"><span data-stu-id="66287-131">Addition specification of file set or file level information to support the backup will be handled during the [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event.</span></span>

## <a name="handling-prepareforbackup-events-during-incremental-and-differential-backups"></a><span data-ttu-id="66287-132">Обработка событий PrepareForBackup во время добавочных и разностных резервных копий</span><span class="sxs-lookup"><span data-stu-id="66287-132">Handling PrepareForBackup Events during Incremental and Differential Backups</span></span>

<span data-ttu-id="66287-133">Прежде чем инициатор запроса продолжит фактическую операцию резервного копирования, модули записи могут изменить спецификацию [*добавочной*](vssgloss-i.md) или [*разностной*](vssgloss-d.md) резервной копии, изменив документ компонентов резервного копирования инициатора запроса через интерфейс [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .</span><span class="sxs-lookup"><span data-stu-id="66287-133">Before the requester proceeds with the actual backup operation, writers can modify the specification of an [*incremental*](vssgloss-i.md) or [*differential*](vssgloss-d.md) backup by altering the requester's Backup Components Document through the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface.</span></span>

<span data-ttu-id="66287-134">Поскольку модули записи используют интерфейс [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , они обычно выполняют эти подготовительные действия при обработке события [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) .</span><span class="sxs-lookup"><span data-stu-id="66287-134">Because the writers use the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface, they typically perform these preparations while handling the [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event.</span></span>

<span data-ttu-id="66287-135">В [**квссвритер: онпрепаребаккуп**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup)модули записи могут точнее указать, как некоторые файлы должны оцениваться для резервного копирования, указать, какие механизмы следует использовать при их резервном копировании и, возможно, установить метки резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="66287-135">In [**CVssWriter:OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), writers can more precisely specify how some files are to be evaluated for backup, specify what mechanisms should be used in backing them up, and possibly set backup stamps.</span></span>

<dl> <dt>

<span data-ttu-id="66287-136"><span id="Partial_Files"></span><span id="partial_files"></span><span id="PARTIAL_FILES"></span>Частичные файлы</span><span class="sxs-lookup"><span data-stu-id="66287-136"><span id="Partial_Files"></span><span id="partial_files"></span><span id="PARTIAL_FILES"></span>Partial Files</span></span>
</dt> <dd>

<span data-ttu-id="66287-137">Если инициатор запроса поддерживает их, то модуль записи может создать добавочную или разностную резервную копию, реализованную с помощью частичных операций с файлами.</span><span class="sxs-lookup"><span data-stu-id="66287-137">If a requester supports them, a writer can choose to have an incremental or differential backup implemented by using partial file operations.</span></span> <span data-ttu-id="66287-138">(Модули записи могут определить, поддерживает ли инициатор запросов частичные операции с файлами, вызвав [**квссвритер:: испартиалфилесуппортенаблед**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispartialfilesupportenabled).)</span><span class="sxs-lookup"><span data-stu-id="66287-138">(Writers can determine if a requester supports partial file operations by calling [**CVssWriter::IsPartialFileSupportEnabled**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispartialfilesupportenabled).)</span></span>

<span data-ttu-id="66287-139">Модули записи используют [**ивсскомпонент:: аддпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) , чтобы указать, какие части выбранных файлов будут архивироваться во время добавочной или разностной операции.</span><span class="sxs-lookup"><span data-stu-id="66287-139">Writers use [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) to indicate those portions of the selected files to be backed up during the incremental or differential operation.</span></span> <span data-ttu-id="66287-140">Запрашивающие стороны должны учитывать эту спецификацию и всегда должно создавать резервные копии указанных разделов файлов.</span><span class="sxs-lookup"><span data-stu-id="66287-140">Requesters must respect this specification, and must always back up the specified sections of the files.</span></span> <span data-ttu-id="66287-141">(Дополнительные сведения о частичных операциях с файлами см. в разделе [Работа с частичными файлами](working-with-partial-files.md) .)</span><span class="sxs-lookup"><span data-stu-id="66287-141">(See [Working with Partial Files](working-with-partial-files.md) for more information on partial file operations.)</span></span>

<span data-ttu-id="66287-142">С помощью [**ивсскомпонент:: аддпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile)модуль записи может добавить в резервную копию файл, который ранее не был добавлен в один из его наборов компонентов ( [**Ивсскреатевритерметадата:: адддатабасефилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**Ивсскреатевритерметадата:: AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)или [**IVssCreateWriterMetadata:: AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) в качестве частичного файла.</span><span class="sxs-lookup"><span data-stu-id="66287-142">Using [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile), a writer can add a file to the backup that was not previously added to one of its component sets (by [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) as a partial file.</span></span> <span data-ttu-id="66287-143">Все новые файлы, добавляемые в резервную копию таким образом, должны находиться на томе, который уже поддается теневому копированию для этой резервной копии.</span><span class="sxs-lookup"><span data-stu-id="66287-143">Any new files added to the backup in this manner must be on a volume that already is being shadow copied for this backup.</span></span>

<span data-ttu-id="66287-144">Если файл участвует в операциях с частичными файлами, это замещает все типы резервных копий спецификаций файлов, которые игнорируются.</span><span class="sxs-lookup"><span data-stu-id="66287-144">If a file is involved with partial file operations, this supersedes any file specification backup type, which is ignored.</span></span>

</dd> <dt>

<span data-ttu-id="66287-145"><span id="Differenced_Files"></span><span id="differenced_files"></span><span id="DIFFERENCED_FILES"></span>Файлы различий</span><span class="sxs-lookup"><span data-stu-id="66287-145"><span id="Differenced_Files"></span><span id="differenced_files"></span><span id="DIFFERENCED_FILES"></span>Differenced Files</span></span>
</dt> <dd>

<span data-ttu-id="66287-146">Модули записи, поддерживающие последнюю измененную схему резервного копирования (**\_ \_ схема BS VSS**), могут добавлять [*файлы различий*](vssgloss-d.md) в добавочную или разностную резервную копию.</span><span class="sxs-lookup"><span data-stu-id="66287-146">Writers that support a last modified backup schema (**VSS\_BS\_SCHEMA**) can add [*differenced files*](vssgloss-d.md) to an incremental or differential backup.</span></span>

<span data-ttu-id="66287-147">При указании файла различий модуль записи использует [**ивсскомпонент:: адддифференцедфилебиластмодифитиме**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) и задает путь, имя файла и рекурсивный флаг, однако они не должны совпадать с набором файлов, входящим в какие-либо компоненты.</span><span class="sxs-lookup"><span data-stu-id="66287-147">In specifying a differenced file, a writer uses [**IVssComponent::AddDifferencedFileByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) and specifies a path, a file name, and a recursive flag—however, these do not have to match a file set included in any component.</span></span>

<span data-ttu-id="66287-148">На самом деле, модуль записи может добавить файл, не добавленный ранее в один из его наборов компонентов ( [**ивсскреатевритерметадата:: адддатабасефилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**Ивсскреатевритерметадата:: адддатабаселогфилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)или [**IVssCreateWriterMetadata:: AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)), в резервную копию как файл с разной кодировкой.</span><span class="sxs-lookup"><span data-stu-id="66287-148">In fact, a writer can add a file not previously added to one of its component sets (by [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) to the backup as a differenced file.</span></span> <span data-ttu-id="66287-149">Все новые файлы, добавляемые в резервную копию таким образом, должны находиться на томе, который уже поддается теневому копированию для этой резервной копии.</span><span class="sxs-lookup"><span data-stu-id="66287-149">Any new files added to the backup in this manner must be on a volume that already is being shadow copied for this backup.</span></span>

<span data-ttu-id="66287-150">Как правило, модуль записи также задает время последнего изменения при добавлении файла различий, основываясь на собственном механизме записи журнала.</span><span class="sxs-lookup"><span data-stu-id="66287-150">Typically, a writer will also specify a time of last modification when adding a differenced file—based on the writer's own history mechanism.</span></span> <span data-ttu-id="66287-151">Это время последнего изменения, если оно указано, должно всегда использоваться запрашивающими стороны при определении необходимости включения файла в добавочную или разностную резервную копию.</span><span class="sxs-lookup"><span data-stu-id="66287-151">This last modification time, if specified, must always be used by requesters in determining if a file needs to be included in an incremental or differential backup.</span></span>

<span data-ttu-id="66287-152">Модуль записи может не указывать время последнего изменения при добавлении файла различий в добавочный или разностный резервный набор данных.</span><span class="sxs-lookup"><span data-stu-id="66287-152">A writer may choose not to specify a last modification time when adding a differenced file to an incremental or differential backup set.</span></span> <span data-ttu-id="66287-153">В этом случае запрашивающие стороны могут свободно использовать собственные механизмы (например, журналы предыдущих резервных копий или сведения о файловой системе), чтобы определить, следует ли включать файл в добавочную или разностную резервную копию.</span><span class="sxs-lookup"><span data-stu-id="66287-153">If this is the case, requesters are free to use their own mechanisms—for instance, logs of previous backups or file system information—to determine whether the differenced file should be included in an incremental or differential backup.</span></span>

<span data-ttu-id="66287-154">Тип резервной копии спецификации файла для любого файла различий игнорируется.</span><span class="sxs-lookup"><span data-stu-id="66287-154">The file specification backup type of any differenced file is ignored.</span></span>

</dd> <dt>

<span data-ttu-id="66287-155"><span id="Backup_Stamps"></span><span id="backup_stamps"></span><span id="BACKUP_STAMPS"></span>Метки резервного копирования</span><span class="sxs-lookup"><span data-stu-id="66287-155"><span id="Backup_Stamps"></span><span id="backup_stamps"></span><span id="BACKUP_STAMPS"></span>Backup Stamps</span></span>
</dt> <dd>

<span data-ttu-id="66287-156">Модули записи, поддерживающие метки резервного копирования (**\_ \_ Метка времени VSS**), имеют собственный частный формат для хранения сведений о времени последнего резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="66287-156">Writers that support backup stamps (**VSS\_BS\_TIMESTAMP**) have their own private format for storing information about when a backup last occurred.</span></span> <span data-ttu-id="66287-157">Эта информация создается модулем записи во время резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="66287-157">This information is generated by the writer during backup.</span></span>

<span data-ttu-id="66287-158">Метка резервного копирования хранится в документе компоненты резервного копирования в виде строки методом [**ивсскомпонент:: сетбаккупстамп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp) .</span><span class="sxs-lookup"><span data-stu-id="66287-158">The backup stamp is stored in the Backup Components Document as a string by the [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp) method.</span></span> <span data-ttu-id="66287-159">Метка резервного копирования применяется ко всем наборам файлов в компоненте (или наборе компонентов), соответствующем экземпляру [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent).</span><span class="sxs-lookup"><span data-stu-id="66287-159">The backup stamp applies to all file sets in the component (or component set) corresponding to the instance of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent).</span></span>

<span data-ttu-id="66287-160">Если у инициатора запроса есть доступ к метке резервной копии предыдущей резервной копии, она будет доступна для модуля записи путем вызова [**ивссбаккупкомпонентс:: сетпревиаусбаккупстамп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="66287-160">If a requester has access to the backup stamp of a previous backup, it will have made it available to the writer by calling [**IVssBackupComponents::SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp).</span></span>

<span data-ttu-id="66287-161">Затем модуль записи может проверить эту метку времени с помощью [**ивсскомпонент:: жетпревиаусбаккупстамп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="66287-161">A writer then can examine this time stamp using [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span></span>

<span data-ttu-id="66287-162">Обратите внимание, что инициатор запроса просто сохраняет и возвращает строку, содержащую метку резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="66287-162">Note that the requester merely stores and returns the string containing the backup stamp.</span></span> <span data-ttu-id="66287-163">Он не знает ничего о формате строки или его использовании; Эти сведения имеют только модуль записи.</span><span class="sxs-lookup"><span data-stu-id="66287-163">It does not know anything about the string's format or how to use it; only the writer has that information.</span></span>

<span data-ttu-id="66287-164">Модуль записи может обновить текущую метку резервного копирования с помощью [**ивсскомпонент:: сетбаккупстамп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp) после вызова [**Ивсскомпонент:: жетпревиаусбаккупстамп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp), тем самым записывая в его собственном формате дату текущей операции добавочного или разностного резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="66287-164">A writer may choose to update the current backup stamp using [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp) after it has called [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp), thus recording in its own format the date of the current incremental or differential backup operation.</span></span>

</dd> </dl>

 

 



