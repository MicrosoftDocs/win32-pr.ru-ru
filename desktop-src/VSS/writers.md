---
description: Модули записи — это приложения или службы, хранящие постоянные данные в файлах на диске и предоставляющие имена и расположения этих файлов запрашивающим устройствам с помощью интерфейса теневого копирования.
ms.assetid: 24fc2d7c-f8d6-49ca-9bb5-0179bef68e78
title: Writers
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 52ca409e8dc6153a6b3e2b747dc23cc391055471
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692326"
---
# <a name="writers"></a><span data-ttu-id="7eebe-103">Writers</span><span class="sxs-lookup"><span data-stu-id="7eebe-103">Writers</span></span>

<span data-ttu-id="7eebe-104">[*Модули записи*](vssgloss-w.md) — это приложения или службы, хранящие постоянные данные в файлах на диске и предоставляющие имена и расположения этих файлов запрашивающим устройствам с помощью интерфейса теневого копирования.</span><span class="sxs-lookup"><span data-stu-id="7eebe-104">[*Writers*](vssgloss-w.md) are applications or services that store persistent information in files on disk and that provide the names and locations of these files to requesters by using the shadow copy interface.</span></span>

<span data-ttu-id="7eebe-105">Во время операций резервного копирования модули записи гарантируют, что их данные загружена и стабильны — подходят для теневого копирования и резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="7eebe-105">During backup operations, writers ensure that their data is quiescent and stable—suitable for shadow copy and backup.</span></span> <span data-ttu-id="7eebe-106">Авторы взаимодействуют с восстановлением путем разблокировки файлов, когда это возможно, и указывая альтернативные расположения при необходимости.</span><span class="sxs-lookup"><span data-stu-id="7eebe-106">Writers collaborate with restores by unlocking files when possible and indicating alternate locations when necessary.</span></span>

<span data-ttu-id="7eebe-107">Если во время операции резервного копирования VSS нет модулей записи, то создать теневую копию все еще можно.</span><span class="sxs-lookup"><span data-stu-id="7eebe-107">If no writers are present during a VSS backup operation, a shadow copy can still be created.</span></span> <span data-ttu-id="7eebe-108">В этом случае все данные в томе, скопированном с помощью теневого копирования, будут находиться в [*состоянии*](vssgloss-c.md)отказоустойчивости.</span><span class="sxs-lookup"><span data-stu-id="7eebe-108">In this case, all data on the shadow-copied volume will be in the [*crash-consistent state*](vssgloss-c.md).</span></span>

## <a name="writer-state"></a><span data-ttu-id="7eebe-109">Состояние модуля записи</span><span class="sxs-lookup"><span data-stu-id="7eebe-109">Writer State</span></span>

<span data-ttu-id="7eebe-110">Модули записи сохраняют свое состояние в объекте метаданных на основе XML, в [*документе метаданных модуля записи*](vssgloss-w.md).</span><span class="sxs-lookup"><span data-stu-id="7eebe-110">Writers maintain their state in an XML-based metadata object, the [*Writer Metadata Document*](vssgloss-w.md).</span></span>

<span data-ttu-id="7eebe-111">Метаданные модуля записи являются единственной структурой данных, содержащей [*набор файлов*](vssgloss-f.md)— путь, спецификация файла и флаг рекурсии — для архивируемых и восстанавливаемых данных.</span><span class="sxs-lookup"><span data-stu-id="7eebe-111">This writer metadata is the only data structure that contains the [*file set*](vssgloss-f.md)—path, file specification, and recursion flag—of the data to be backed up and restored.</span></span>

<span data-ttu-id="7eebe-112">Документ метаданных модуля записи упорядочивает наборы файлов модуля записи в группы или [*компоненты*](vssgloss-c.md).</span><span class="sxs-lookup"><span data-stu-id="7eebe-112">The Writer Metadata Document organizes the writer's file sets into groups or [*components*](vssgloss-c.md).</span></span> <span data-ttu-id="7eebe-113">Связь одного из этих компонентов во время операций резервного копирования и восстановления с другими компонентами, управляемыми модулем записи, описывается в документе метаданных модуля записи путем [*выбора компонента для резервного копирования*](vssgloss-s.md), его [*выбора для восстановления*](vssgloss-s.md)и [*логических путей*](vssgloss-l.md).</span><span class="sxs-lookup"><span data-stu-id="7eebe-113">The relationship of one of these components during backup and restore operations to the other components managed by the writer is described in the Writer Metadata Document by the component's [*selectability for backup*](vssgloss-s.md), its [*selectability for restore*](vssgloss-s.md), and its [*logical paths*](vssgloss-l.md).</span></span> <span data-ttu-id="7eebe-114">(Дополнительные сведения см. в разделе [Настройка организации компонентов](definition-of-components-by-writers.md) и [Работа с выборкой и логическими путями](working-with-selectability-and-logical-paths.md).)</span><span class="sxs-lookup"><span data-stu-id="7eebe-114">(For more information, see [Setting up Component Organization](definition-of-components-by-writers.md) and [Working with Selectability and Logical Paths](working-with-selectability-and-logical-paths.md).)</span></span>

<span data-ttu-id="7eebe-115">Дополнительные сведения, управляющие восстановлением файлов, и другие проблемы также содержатся в этом документе.</span><span class="sxs-lookup"><span data-stu-id="7eebe-115">Additional information that governs file restoration and other issues is also contained in this document.</span></span>

<span data-ttu-id="7eebe-116">Инициатору запроса требуются метаданные модуля записи в сочетании с собственным документом компонентов резервного копирования для обработки резервной копии или восстановления.</span><span class="sxs-lookup"><span data-stu-id="7eebe-116">The requester needs the writer metadata, in conjunction with its own Backup Components Document, to process a backup or a restore.</span></span>

<span data-ttu-id="7eebe-117">В отличие от документации по компонентам резервного копирования, документ метаданных модуля записи следует рассматривать как структуру, доступную только для чтения.</span><span class="sxs-lookup"><span data-stu-id="7eebe-117">Unlike the Backup Components Document, the Writer Metadata Document should be thought of as a read-only structure.</span></span> <span data-ttu-id="7eebe-118">После того как модуль записи создаст его, документ не изменится.</span><span class="sxs-lookup"><span data-stu-id="7eebe-118">Once a writer creates it, the document is not altered.</span></span>

## <a name="writer-event-handling"></a><span data-ttu-id="7eebe-119">Обработка событий модуля записи</span><span class="sxs-lookup"><span data-stu-id="7eebe-119">Writer Event Handling</span></span>

<span data-ttu-id="7eebe-120">Операции VSS модуля записи инициируются через получение COM-событий.</span><span class="sxs-lookup"><span data-stu-id="7eebe-120">A writer's VSS operations are initiated through the receipt of COM events.</span></span>

<span data-ttu-id="7eebe-121">Если события отсутствуют, модуль записи не выполняет операции VSS (такие как резервное копирование или восстановление VSS).</span><span class="sxs-lookup"><span data-stu-id="7eebe-121">When no events are present, a writer does not perform VSS operations (such as a VSS backup or restore).</span></span> <span data-ttu-id="7eebe-122">Вместо этого он выполняет нормальную работу, например реагирование на запросы к базе данных, управление данными пользователя или предоставление других служб.</span><span class="sxs-lookup"><span data-stu-id="7eebe-122">Instead, it performs its normal work, such as responding to database queries, managing user data, or providing other services.</span></span>

<span data-ttu-id="7eebe-123">Чтобы обеспечить правильную обработку ошибок для нескольких параллельных сеансов резервного копирования и восстановления, а также для того, чтобы один сеанс резервного копирования или восстановления не был поврежден, необходимо выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="7eebe-123">To ensure that error handling for multiple parallel backup and restore sessions is performed correctly, and to ensure that one backup or restore session does not corrupt another, you must do the following:</span></span>

-   <span data-ttu-id="7eebe-124">Если обработчик событий модуля записи (например, [**квссвритер:: onfreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze)) вызывает метод [**CVssWriterEx2::-SessionID**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriterex2-getsessionid), [**Квссвритер:: Сетвритерфаилуре**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-setwriterfailure)или [**CVssWriterEx2:: сетвритерфаилурикс**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriterex2-setwriterfailureex) , обработчик событий должен вызвать метод в том же потоке, который вызвал обработчик события.</span><span class="sxs-lookup"><span data-stu-id="7eebe-124">If a writer's event handler (such as [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze)) calls the [**CVssWriterEx2::GetSessionId**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriterex2-getsessionid), [**CVssWriter::SetWriterFailure**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-setwriterfailure), or [**CVssWriterEx2::SetWriterFailureEx**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriterex2-setwriterfailureex) method, the event handler must call the method in the same thread that called the event handler.</span></span>
-   <span data-ttu-id="7eebe-125">Реализация обработчика событий, например [**onfreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) , может при необходимости разгружать работу в рабочие потоки при условии, что каждый рабочий поток маршалирует все необходимые ошибки в исходный поток обработчика событий.</span><span class="sxs-lookup"><span data-stu-id="7eebe-125">Your writer’s implementation of an event handler such as [**OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) can offload work to worker threads if desired, as long as each worker thread marshals any needed error reporting back to the original event handler thread.</span></span>

## <a name="handling-identify-events"></a><span data-ttu-id="7eebe-126">Обработка событий Identify</span><span class="sxs-lookup"><span data-stu-id="7eebe-126">Handling Identify Events</span></span>

<span data-ttu-id="7eebe-127">За исключением события Identify, тип и порядок событий, получаемых средством записи, зависит от типа выполняемых в настоящее время операций VSS.</span><span class="sxs-lookup"><span data-stu-id="7eebe-127">With the exception of the Identify event, the type and order of the events a writer receives depends uniquely on the type of VSS operations that are currently ongoing.</span></span>

<span data-ttu-id="7eebe-128">Для события Identify требуются модули записи для предоставления системных сведений о конфигурации и управляемых ими файлах с помощью их [*документа метаданных модуля записи*](vssgloss-w.md).</span><span class="sxs-lookup"><span data-stu-id="7eebe-128">The Identify event requires writers to provide the system information about their configuration and the files they manage through their [*Writer Metadata Document*](vssgloss-w.md).</span></span> <span data-ttu-id="7eebe-129">Событие Identify создается при поддержке почти любой операции VSS, включая системные запросы, а также операции теневого копирования и резервного копирования и восстановления.</span><span class="sxs-lookup"><span data-stu-id="7eebe-129">An Identify event is generated in support of almost any VSS operation, including system queries as well as shadow copy and backup and restore operations.</span></span> <span data-ttu-id="7eebe-130">Таким образом, любая реализация модуля записи [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) должна иметь возможность обрабатывать событие Identify в любое время, в том числе в процессе обработки другой операции VSS, такой как резервное копирование или восстановление.</span><span class="sxs-lookup"><span data-stu-id="7eebe-130">Therefore, any writer's implementation of the Identify event handler [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) must be able to handle an Identify event at any time—including in the middle of processing another VSS operation, such as a backup or restore.</span></span> <span data-ttu-id="7eebe-131">Событие Identify никогда не должно рассматриваться как часть жизненного цикла операции VSS, несмотря на то, что его создание может быть ожидаемым и обязательным до начала этой операции.</span><span class="sxs-lookup"><span data-stu-id="7eebe-131">An Identify event should never be thought of as part of the life cycle of a VSS operation, even though its generation may be expected and required prior to the start of that operation.</span></span>

<span data-ttu-id="7eebe-132">Особенно важно, чтобы сведения о состоянии операции VSS не изменялись в [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), поскольку получение неупорядоченного события приведет к сбросу этой информации.</span><span class="sxs-lookup"><span data-stu-id="7eebe-132">It is particularly important that state information about a VSS operation not be modified in [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), because receipt of an out-of-order event would reset that information.</span></span>

## <a name="backup-and-restore-events"></a><span data-ttu-id="7eebe-133">События резервного копирования и восстановления</span><span class="sxs-lookup"><span data-stu-id="7eebe-133">Backup and Restore Events</span></span>

<span data-ttu-id="7eebe-134">В зависимости от того, участвует ли он в резервном копировании или восстановлении, в дополнение к первоначальному событию Identify, модуль записи получит от двух до семи событий.</span><span class="sxs-lookup"><span data-stu-id="7eebe-134">Depending on whether it is participating in a backup or restore, a writer will receive between two and seven events, in addition to an initial Identify event.</span></span>

<span data-ttu-id="7eebe-135">Обработка этих событий представляет собой жизненный цикл операции резервного копирования или восстановления (с точки зрения записи).</span><span class="sxs-lookup"><span data-stu-id="7eebe-135">Handling these events constitutes (from the point of view of a writer) the life cycle of a backup or restore operation.</span></span>

<span data-ttu-id="7eebe-136">В типичной операции резервного копирования (см. раздел [Общие сведения об обработке резервной копии в VSS](overview-of-processing-a-backup-under-vss.md)) модуль записи будет обрабатывать следующие события (в дополнение к начальному событию Identify):</span><span class="sxs-lookup"><span data-stu-id="7eebe-136">In a typical backup operation (see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md)), a writer would handle the following events (in addition to an initial Identify event):</span></span>

-   <span data-ttu-id="7eebe-137">PrepareForBackup</span><span class="sxs-lookup"><span data-stu-id="7eebe-137">PrepareForBackup</span></span>
-   <span data-ttu-id="7eebe-138">препарефорснапшот</span><span class="sxs-lookup"><span data-stu-id="7eebe-138">PrepareForSnapshot</span></span>
-   <span data-ttu-id="7eebe-139">Freeze</span><span class="sxs-lookup"><span data-stu-id="7eebe-139">Freeze</span></span>
-   <span data-ttu-id="7eebe-140">Разморозить</span><span class="sxs-lookup"><span data-stu-id="7eebe-140">Thaw</span></span>
-   <span data-ttu-id="7eebe-141">Моментальный снимок</span><span class="sxs-lookup"><span data-stu-id="7eebe-141">PostSnapshot</span></span>
-   <span data-ttu-id="7eebe-142">баккупкомплете</span><span class="sxs-lookup"><span data-stu-id="7eebe-142">BackupComplete</span></span>
-   <span data-ttu-id="7eebe-143">баккупшутдовн</span><span class="sxs-lookup"><span data-stu-id="7eebe-143">BackupShutdown</span></span>

<span data-ttu-id="7eebe-144">В стандартной операции восстановления (см. [Обзор обработки восстановления в VSS](overview-of-processing-a-restore-under-vss.md)) средство записи будет обрабатывать следующие события:</span><span class="sxs-lookup"><span data-stu-id="7eebe-144">In a typical restore operation (see [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md)), a writer would handle the following events:</span></span>

-   <span data-ttu-id="7eebe-145">Предвосстановление</span><span class="sxs-lookup"><span data-stu-id="7eebe-145">PreRestore</span></span>
-   <span data-ttu-id="7eebe-146">Восстановление после восстановления</span><span class="sxs-lookup"><span data-stu-id="7eebe-146">PostRestore</span></span>

 

 



