---
description: Модули записи — это приложения или службы, хранящие постоянные данные в файлах на диске и предоставляющие имена и расположения этих файлов запрашивающим устройствам с помощью интерфейса теневого копирования.
ms.assetid: 24fc2d7c-f8d6-49ca-9bb5-0179bef68e78
title: Writers
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 52ca409e8dc6153a6b3e2b747dc23cc391055471
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692326"
---
# <a name="writers"></a>Writers

[*Модули записи*](vssgloss-w.md) — это приложения или службы, хранящие постоянные данные в файлах на диске и предоставляющие имена и расположения этих файлов запрашивающим устройствам с помощью интерфейса теневого копирования.

Во время операций резервного копирования модули записи гарантируют, что их данные загружена и стабильны — подходят для теневого копирования и резервного копирования. Авторы взаимодействуют с восстановлением путем разблокировки файлов, когда это возможно, и указывая альтернативные расположения при необходимости.

Если во время операции резервного копирования VSS нет модулей записи, то создать теневую копию все еще можно. В этом случае все данные в томе, скопированном с помощью теневого копирования, будут находиться в [*состоянии*](vssgloss-c.md)отказоустойчивости.

## <a name="writer-state"></a>Состояние модуля записи

Модули записи сохраняют свое состояние в объекте метаданных на основе XML, в [*документе метаданных модуля записи*](vssgloss-w.md).

Метаданные модуля записи являются единственной структурой данных, содержащей [*набор файлов*](vssgloss-f.md)— путь, спецификация файла и флаг рекурсии — для архивируемых и восстанавливаемых данных.

Документ метаданных модуля записи упорядочивает наборы файлов модуля записи в группы или [*компоненты*](vssgloss-c.md). Связь одного из этих компонентов во время операций резервного копирования и восстановления с другими компонентами, управляемыми модулем записи, описывается в документе метаданных модуля записи путем [*выбора компонента для резервного копирования*](vssgloss-s.md), его [*выбора для восстановления*](vssgloss-s.md)и [*логических путей*](vssgloss-l.md). (Дополнительные сведения см. в разделе [Настройка организации компонентов](definition-of-components-by-writers.md) и [Работа с выборкой и логическими путями](working-with-selectability-and-logical-paths.md).)

Дополнительные сведения, управляющие восстановлением файлов, и другие проблемы также содержатся в этом документе.

Инициатору запроса требуются метаданные модуля записи в сочетании с собственным документом компонентов резервного копирования для обработки резервной копии или восстановления.

В отличие от документации по компонентам резервного копирования, документ метаданных модуля записи следует рассматривать как структуру, доступную только для чтения. После того как модуль записи создаст его, документ не изменится.

## <a name="writer-event-handling"></a>Обработка событий модуля записи

Операции VSS модуля записи инициируются через получение COM-событий.

Если события отсутствуют, модуль записи не выполняет операции VSS (такие как резервное копирование или восстановление VSS). Вместо этого он выполняет нормальную работу, например реагирование на запросы к базе данных, управление данными пользователя или предоставление других служб.

Чтобы обеспечить правильную обработку ошибок для нескольких параллельных сеансов резервного копирования и восстановления, а также для того, чтобы один сеанс резервного копирования или восстановления не был поврежден, необходимо выполнить следующие действия.

-   Если обработчик событий модуля записи (например, [**квссвритер:: onfreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze)) вызывает метод [**CVssWriterEx2::-SessionID**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriterex2-getsessionid), [**Квссвритер:: Сетвритерфаилуре**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-setwriterfailure)или [**CVssWriterEx2:: сетвритерфаилурикс**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriterex2-setwriterfailureex) , обработчик событий должен вызвать метод в том же потоке, который вызвал обработчик события.
-   Реализация обработчика событий, например [**onfreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) , может при необходимости разгружать работу в рабочие потоки при условии, что каждый рабочий поток маршалирует все необходимые ошибки в исходный поток обработчика событий.

## <a name="handling-identify-events"></a>Обработка событий Identify

За исключением события Identify, тип и порядок событий, получаемых средством записи, зависит от типа выполняемых в настоящее время операций VSS.

Для события Identify требуются модули записи для предоставления системных сведений о конфигурации и управляемых ими файлах с помощью их [*документа метаданных модуля записи*](vssgloss-w.md). Событие Identify создается при поддержке почти любой операции VSS, включая системные запросы, а также операции теневого копирования и резервного копирования и восстановления. Таким образом, любая реализация модуля записи [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) должна иметь возможность обрабатывать событие Identify в любое время, в том числе в процессе обработки другой операции VSS, такой как резервное копирование или восстановление. Событие Identify никогда не должно рассматриваться как часть жизненного цикла операции VSS, несмотря на то, что его создание может быть ожидаемым и обязательным до начала этой операции.

Особенно важно, чтобы сведения о состоянии операции VSS не изменялись в [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), поскольку получение неупорядоченного события приведет к сбросу этой информации.

## <a name="backup-and-restore-events"></a>События резервного копирования и восстановления

В зависимости от того, участвует ли он в резервном копировании или восстановлении, в дополнение к первоначальному событию Identify, модуль записи получит от двух до семи событий.

Обработка этих событий представляет собой жизненный цикл операции резервного копирования или восстановления (с точки зрения записи).

В типичной операции резервного копирования (см. раздел [Общие сведения об обработке резервной копии в VSS](overview-of-processing-a-backup-under-vss.md)) модуль записи будет обрабатывать следующие события (в дополнение к начальному событию Identify):

-   PrepareForBackup
-   препарефорснапшот
-   Freeze
-   Разморозить
-   Моментальный снимок
-   баккупкомплете
-   баккупшутдовн

В стандартной операции восстановления (см. [Обзор обработки восстановления в VSS](overview-of-processing-a-restore-under-vss.md)) средство записи будет обрабатывать следующие события:

-   Предвосстановление
-   Восстановление после восстановления

 

 



