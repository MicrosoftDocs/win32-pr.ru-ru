---
description: 'После вызова Ивссбаккупкомпонентс:: Гасервритерметадата инициатор запроса использует экземпляр интерфейса Ивссасинк, возвращенный этим вызовом, чтобы определить, когда все модули записи в системе завершат создание документов метаданных модуля записи.'
ms.assetid: 04658d50-04f0-4189-8b88-ff152f1bf482
title: Обзор фазы обнаружения резервных копий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3d2d2a2d05220ecf3e25c77c18cc62b07726964f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692891"
---
# <a name="overview-of-the-backup-discovery-phase"></a><span data-ttu-id="729e1-103">Обзор фазы обнаружения резервных копий</span><span class="sxs-lookup"><span data-stu-id="729e1-103">Overview of the Backup Discovery Phase</span></span>

<span data-ttu-id="729e1-104">После вызова [**ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata)инициатор запроса использует экземпляр интерфейса [**ивссасинк**](/windows/desktop/api/Vss/nn-vss-ivssasync) , возвращенный этим вызовом, чтобы определить, когда все модули записи в системе завершат создание документов метаданных модуля записи.</span><span class="sxs-lookup"><span data-stu-id="729e1-104">After calling [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), a requester uses the instance of the [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync) interface returned from this call to determine when all writers on the system have finished constructing their Writer Metadata Documents.</span></span> <span data-ttu-id="729e1-105">Дополнительные сведения см. в разделе Общие сведения об [обработке резервной копии в VSS](overview-of-processing-a-backup-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="729e1-105">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md).</span></span>

<span data-ttu-id="729e1-106">На этом этапе инициатор запроса может начать фазу обнаружения, проверив метаданные, чтобы определить, какие приложения выполняются и какие тома необходимо скопировать, чтобы получить полную резервную копию.</span><span class="sxs-lookup"><span data-stu-id="729e1-106">At this point, the requester can begin a discovery phase, examining metadata to determine what applications are running and which volumes must be shadow copied to get a complete backup.</span></span> <span data-ttu-id="729e1-107">В следующей таблице показана последовательность действий и событий, необходимых для фазы обнаружения резервных копий.</span><span class="sxs-lookup"><span data-stu-id="729e1-107">The following table shows the sequence of actions and events that are required for the backup discovery phase.</span></span>



| <span data-ttu-id="729e1-108">Действие запросившего</span><span class="sxs-lookup"><span data-stu-id="729e1-108">Requester action</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | <span data-ttu-id="729e1-109">Событие</span><span class="sxs-lookup"><span data-stu-id="729e1-109">Event</span></span> | <span data-ttu-id="729e1-110">Действие записи</span><span class="sxs-lookup"><span data-stu-id="729e1-110">Writer action</span></span>                                                                     |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------|-----------------------------------------------------------------------------------|
| <span data-ttu-id="729e1-111">Получение документов метаданных модуля записи (см. [**ивссбаккупкомпонентс:: жетвритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata), [**ивссексаминевритерметадата**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata)).</span><span class="sxs-lookup"><span data-stu-id="729e1-111">Retrieve Writer Metadata Documents (see [**IVssBackupComponents::GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata), [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata)).</span></span>                                                                                                                                                                                                                                                                                                                                                 | <span data-ttu-id="729e1-112">Нет</span><span class="sxs-lookup"><span data-stu-id="729e1-112">None</span></span>  | <span data-ttu-id="729e1-113">В течение этого периода модули записи могут продолжать работу с обычными операциями.</span><span class="sxs-lookup"><span data-stu-id="729e1-113">During this period, writers may be able to continue with their normal operations.</span></span> |
| <span data-ttu-id="729e1-114">Используйте список компонентов и их [*наборов файлов*](vssgloss-f.md), а также исключенных файлов, чтобы получить список томов и файлов, участвующих в резервной копии (см. раздел [**ивссвмкомпонент**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent), [**ивссвмфиледеск**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc)).</span><span class="sxs-lookup"><span data-stu-id="729e1-114">Use the list of components and their [*file sets*](vssgloss-f.md), as well as excluded files, to obtain a list of volumes and files involved in the backup (see [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent), [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc)).</span></span>                                                                                                                                                                                                                                                                      | <span data-ttu-id="729e1-115">Нет</span><span class="sxs-lookup"><span data-stu-id="729e1-115">None</span></span>  | <span data-ttu-id="729e1-116">Нет</span><span class="sxs-lookup"><span data-stu-id="729e1-116">None</span></span>                                                                              |
| <span data-ttu-id="729e1-117">Выберите компоненты в документе метаданных модуля записи модуля записи для резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="729e1-117">Choose which components in the writer's Writer Metadata Document to back up.</span></span> <span data-ttu-id="729e1-118">Вызовите метод [**ивссбаккупкомпонентс:: AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent) для каждого компонента, чтобы добавить его в документ компонентов резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="729e1-118">Call [**IVssBackupComponents::AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent) for each component to add it to the Backup Components Document.</span></span> <span data-ttu-id="729e1-119">(См. статью [Работа с выборкой для резервного копирования](working-with-selectability-for-backup.md) и [Работа с документом резервных компонентов](working-with-the-backup-components-document.md).)</span><span class="sxs-lookup"><span data-stu-id="729e1-119">(See [Working with Selectability for Backup](working-with-selectability-for-backup.md) and [Working with the Backup Components Document](working-with-the-backup-components-document.md).)</span></span>                                                                                                                      | <span data-ttu-id="729e1-120">Нет</span><span class="sxs-lookup"><span data-stu-id="729e1-120">None</span></span>  | <span data-ttu-id="729e1-121">Нет</span><span class="sxs-lookup"><span data-stu-id="729e1-121">None</span></span>                                                                              |
| <span data-ttu-id="729e1-122">Инициализация набора теневых копий, контекста и проверки поддерживаемых томов (см. раздел [**ивссбаккупкомпонентс:: стартснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset), [**Ивссбаккупкомпонентс:: исволумесуппортед**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-isvolumesupported)).</span><span class="sxs-lookup"><span data-stu-id="729e1-122">Initialize the shadow copy set, context and check for supported volumes (see [**IVssBackupComponents::StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset), [**IVssBackupComponents::IsVolumeSupported**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-isvolumesupported)).</span></span>                                                                                                                                                                                                                                                                                   | <span data-ttu-id="729e1-123">Нет</span><span class="sxs-lookup"><span data-stu-id="729e1-123">None</span></span>  | <span data-ttu-id="729e1-124">Нет</span><span class="sxs-lookup"><span data-stu-id="729e1-124">None</span></span>                                                                              |
| <span data-ttu-id="729e1-125">При выполнении резервного копирования, не являющейся компонентом, добавьте требуемые целевые тома из документа метаданных модуля записи в набор теневых копий, вызвав [**ивссбаккупкомпонентс:: аддтоснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset) для каждого тома.</span><span class="sxs-lookup"><span data-stu-id="729e1-125">If performing a non-component backup, add the desired target volumes from the Writer Metadata Document to the shadow copy set by calling [**IVssBackupComponents::AddToSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset) for each volume.</span></span> <span data-ttu-id="729e1-126">В противном случае для компонентов в документе метаданных модуля записи, которые уже были добавлены в документ компонентов резервного копирования (путем вызова метода [**AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent)), запрашивающая сторона должна также вызвать **Ивссбаккупкомпонентс:: аддтоснапшотсет** для каждого соответствующего тома.</span><span class="sxs-lookup"><span data-stu-id="729e1-126">Otherwise, for the components in the Writer Metadata Document that were already added to the Backup Components Document (by calling [**AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent)), the requester must also call **IVssBackupComponents::AddToSnapshotSet** for each affected volume.</span></span> | <span data-ttu-id="729e1-127">Нет</span><span class="sxs-lookup"><span data-stu-id="729e1-127">None</span></span>  | <span data-ttu-id="729e1-128">Нет</span><span class="sxs-lookup"><span data-stu-id="729e1-128">None</span></span>                                                                              |



 

## <a name="writer-actions-during-the-discovery-phase"></a><span data-ttu-id="729e1-129">Действия модуля записи на этапе обнаружения</span><span class="sxs-lookup"><span data-stu-id="729e1-129">Writer Actions during the Discovery Phase</span></span>

<span data-ttu-id="729e1-130">Поскольку фаза обнаружения резервной копии состоит в основном с инициатором запроса, обрабатывающим информацию, полученную из документов метаданных модуля записи, существует несколько требований к модулю записи.</span><span class="sxs-lookup"><span data-stu-id="729e1-130">Because the discovery phase of a backup consists primarily of a requester processing the information it has retrieved from Writer Metadata Documents, there are few if any requirements on a writer.</span></span>

<span data-ttu-id="729e1-131">Теоретически, модуль записи может продолжать нормально работать на этом этапе.</span><span class="sxs-lookup"><span data-stu-id="729e1-131">In theory, a writer could continue to run normally at this point.</span></span> <span data-ttu-id="729e1-132">Тем не менее, может быть желательно, чтобы модули записи начали подготовку к появлению операций теневого копирования и архивации.</span><span class="sxs-lookup"><span data-stu-id="729e1-132">However, it may be desirable for writers to begin preparations for the coming shadow copy and backup operations.</span></span>

## <a name="requester-actions-during-the-discovery-phase"></a><span data-ttu-id="729e1-133">Действия запросившего на этапе обнаружения</span><span class="sxs-lookup"><span data-stu-id="729e1-133">Requester Actions during the Discovery Phase</span></span>

<span data-ttu-id="729e1-134">Инициатор запроса использует объекты [**ивссексаминевритерметадата**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) , полученные с помощью [**Ивссбаккупкомпонентс:: жетвритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) , для прохода по всем метаданным модулей записи и выбора тех модулей записи, данные которых планируется архивировать.</span><span class="sxs-lookup"><span data-stu-id="729e1-134">A requester uses the [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) objects obtained through [**IVssBackupComponents::GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) to iterate over all the writers' metadata and selecting those writers whose data it intends to back up.</span></span>

<span data-ttu-id="729e1-135">На этом этапе инициатору запроса потребуется создать исходный список кандидатов для резервного копирования каждого средства записи, пересматривая компоненты модуля записи с помощью [**ивссексаминевритерметадата::**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent)at.</span><span class="sxs-lookup"><span data-stu-id="729e1-135">At this point, the requester will need to generate an initial list of each writer's backup candidates by iterating over the writer's components using [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent).</span></span> <span data-ttu-id="729e1-136">Это предоставляет инициатору запроса объекты [**ивссвмкомпонент**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) , из которых можно получить спецификации файлов для резервного копирования с помощью [**ивссвмкомпонент::**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile), [**Ивссвмкомпонент:: Жетдатабасефиле**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabasefile)и [**ивссвмкомпонент:: GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile).</span><span class="sxs-lookup"><span data-stu-id="729e1-136">This provides the requester with [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) objects, from which you can get the specifications for the files to be backed up using [**IVssWMComponent::GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile), [**IVssWMComponent::GetDatabaseFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabasefile), and [**IVssWMComponent::GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile).</span></span>

<span data-ttu-id="729e1-137">Так как объект [**ивссвмфиледеск**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) может использовать подстановочные знаки для хранения сведений о расположении файлов, может потребоваться использовать такие функции, как [**FindFirstFile**](/windows/win32/api/fileapi/nf-fileapi-findfirstfilea), [**финдфирстфиликс**](/windows/win32/api/fileapi/nf-fileapi-findfirstfileexa)и [**FindNextFile**](/windows/win32/api/fileapi/nf-fileapi-findnextfilea).</span><span class="sxs-lookup"><span data-stu-id="729e1-137">Because the [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) object can use wildcard characters to hold file location information, it may be necessary to use functions such as [**FindFirstFile**](/windows/win32/api/fileapi/nf-fileapi-findfirstfilea), [**FindFirstFileEx**](/windows/win32/api/fileapi/nf-fileapi-findfirstfileexa), and [**FindNextFile**](/windows/win32/api/fileapi/nf-fileapi-findnextfilea).</span></span>

<span data-ttu-id="729e1-138">Пока теневая копия не будет завершена, модули записи могут добавлять или удалять файлы с диска в обычном процессе работы, поэтому не следует создавать фактический список файлов для резервного копирования в данный момент.</span><span class="sxs-lookup"><span data-stu-id="729e1-138">Until the shadow copy has been completed, it is still possible for writers to add or remove files from disk in the normal course of their work, so you should not generate the actual list of files to be backed up at this time.</span></span>

<span data-ttu-id="729e1-139">Вместо этого на этом этапе можно найти исходный список файлов и томов для резервного копирования, выполнив следующие действия.</span><span class="sxs-lookup"><span data-stu-id="729e1-139">Instead, the initial list of files and volumes to be backed up is found at this point by doing the following:</span></span>

1.  <span data-ttu-id="729e1-140">Изучение всех выбранных для резервного копирования и невыбираемых компонентов в документе метаданных модуля записи (с помощью [**ивссексаминевритерметадата**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata)) и их упорядочения в [*Наборы компонентов*](vssgloss-c.md) используют [*логический путь*](vssgloss-l.md) (см. раздел [Работа с выборкой и логические пути](working-with-selectability-and-logical-paths.md)).</span><span class="sxs-lookup"><span data-stu-id="729e1-140">Examining all selectable for backup and nonselectable components in each writer's Writer Metadata Document (using [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata)) and organizing them into [*component sets*](vssgloss-c.md) use [*logical path*](vssgloss-l.md) (see [Working with Selectability and Logical Paths](working-with-selectability-and-logical-paths.md))</span></span>
2.  <span data-ttu-id="729e1-141">[*Включение явным образом*](vssgloss-e.md) всех обязательных компонентов (невыбираемых для компонентов резервного копирования без выбора для предков резервной копии) в документе компоненты резервного копирования с помощью [ **ивссбаккупкомпонентс:: AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent)</span><span class="sxs-lookup"><span data-stu-id="729e1-141">[*Including explicitly*](vssgloss-e.md) all required components (nonselectable for backup components without selectable for backup ancestors) in the Backup Components Document using [**IVssBackupComponents::AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent)</span></span>
3.  <span data-ttu-id="729e1-142">Выбор явного включения необязательного выбора для компонентов резервного копирования, не определяющих набор компонентов (с помощью [**ивссбаккупкомпонентс:: AddComponent).**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent)</span><span class="sxs-lookup"><span data-stu-id="729e1-142">Choosing to explicitly include optional selectable for backup components that do not define a component set (using [**IVssBackupComponents::AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent))</span></span>
4.  <span data-ttu-id="729e1-143">Выбор [*наборов компонентов*](vssgloss-c.md) для участия в резервной копии путем явного добавления их определяемого для выбора компонента резервного копирования (с помощью [**Ивссбаккупкомпонентс:: AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent)), который [*неявно включает*](vssgloss-i.md) [*подкомпоненты*](vssgloss-s.md)набора компонентов.</span><span class="sxs-lookup"><span data-stu-id="729e1-143">Selecting [*component sets*](vssgloss-c.md) for participation in a backup by explicitly adding their defining selectable for backup component (using [**IVssBackupComponents::AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent)), which [*implicitly includes*](vssgloss-i.md) the component set's [*subcomponents*](vssgloss-s.md).</span></span>
5.  <span data-ttu-id="729e1-144">Используя сведения о [*наборе файлов*](vssgloss-f.md) в выбранных функциях управления документами и томами метаданных модуля записи, инициатор запроса определяет пути к файлам для резервного копирования и тома, которые необходимо скопировать.</span><span class="sxs-lookup"><span data-stu-id="729e1-144">Using [*file set*](vssgloss-f.md) information in the selected writers' Writer Metadata Document and volume management functions, a requester determines the paths of files to be backed up and the volumes that will need to be shadow copied</span></span>

<span data-ttu-id="729e1-145">Обратите внимание, что только явно включенные компоненты (с использованием [**ивссбаккупкомпонентс:: AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent)) в резервной копии и в документе компоненты резервного копирования будут иметь экземпляры интерфейса [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , добавленные в этот документ.</span><span class="sxs-lookup"><span data-stu-id="729e1-145">Note that only the components explicitly included (using [**IVssBackupComponents::AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent)) in the backup and in the Backup Components Document will have instances of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface added to that document.</span></span> <span data-ttu-id="729e1-146">Эти экземпляры будут использоваться для проверки и изменения параметров компонентов для явно включаемых компонентов и любых их неявно включаемых компонентов (см. раздел [Выбор варианта и работа со свойствами компонентов](selectability-and-working-with-component-properties.md)).</span><span class="sxs-lookup"><span data-stu-id="729e1-146">These instances will be used to examine and modify component settings for both explicitly included components and any of their implicitly included subcomponents (see [Selectability and Working with Component Properties](selectability-and-working-with-component-properties.md)).</span></span>

<span data-ttu-id="729e1-147">Если модуль записи включает какие-либо компоненты модуля записи, он должен добавить все необходимые компоненты.</span><span class="sxs-lookup"><span data-stu-id="729e1-147">If a writer includes any of a writer's components, it must add all of its required components.</span></span> <span data-ttu-id="729e1-148">Однако инициатор запроса также может полностью пропустить все наборы компонентов модуля записи.</span><span class="sxs-lookup"><span data-stu-id="729e1-148">However, a requester is also free to entirely skip all of a writer's component sets.</span></span> <span data-ttu-id="729e1-149">Если ни один из компонентов модуля записи не выбран явным образом, модуль записи не выбирается, а VSS препятствует участию в оставшейся части операции резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="729e1-149">If none of a writer's components are explicitly selected, the writer is not selected, and VSS inhibits that writer from participating in the rest of the backup operation.</span></span>

<span data-ttu-id="729e1-150">Инициатор запроса инициирует набор теневых копий, который будет содержать выбранные тома, вызвав [**ивссбаккупкомпонентс:: стартснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset).</span><span class="sxs-lookup"><span data-stu-id="729e1-150">The requester initiates the shadow copy set that will contain the selected volumes by calling [**IVssBackupComponents::StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset).</span></span>

<span data-ttu-id="729e1-151">Если том может участвовать в теневой копии (которую можно проверить с помощью [**ивссбаккупкомпонентс:: исволумесуппортед**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-isvolumesupported)), инициатор запроса может добавить этот том в набор теневых копий с помощью [**Ивссбаккупкомпонентс:: аддтоснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="729e1-151">If the volume can participate in a shadow copy (which can be checked with [**IVssBackupComponents::IsVolumeSupported**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-isvolumesupported)), the requester can add that volume to the shadow copy set using [**IVssBackupComponents::AddToSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset).</span></span>

<span data-ttu-id="729e1-152">Хотя в общем случае он не полезен, инициатор запроса иногда также может выбрать, какой [*поставщик*](vssgloss-p.md) будет поддерживать теневую копию для заданного тома (Дополнительные сведения см. в разделе [Выбор поставщиков](selecting-providers.md) ).</span><span class="sxs-lookup"><span data-stu-id="729e1-152">Although it is not generally useful, a requester can sometimes also choose which [*provider*](vssgloss-p.md) will maintain the shadow copy for a given volume (see [Selecting Providers](selecting-providers.md) for details).</span></span>

<span data-ttu-id="729e1-153">Следует соблюдать осторожность при обработке тома, содержащего подключенные папки или точки повторного анализа.</span><span class="sxs-lookup"><span data-stu-id="729e1-153">Care should be given to the handling of a volume containing mounted folders or reparse points.</span></span> <span data-ttu-id="729e1-154">Подключенная папка или точка повторной обработки могут быть отображены в теневой копии и могут быть резервными копиями.</span><span class="sxs-lookup"><span data-stu-id="729e1-154">A mounted folder or reparse point can appear in a shadow copy and can be backed up.</span></span> <span data-ttu-id="729e1-155">Однако не удается просмотреть подключенную папку или точку повторного анализа на тенев скопированном томе (см. раздел [Работа с подключенными папками и точки повторного анализа](working-with-reparse-and-mount-points.md)).</span><span class="sxs-lookup"><span data-stu-id="729e1-155">However, a mounted folder or reparse point cannot be traversed on the shadow copied volume (see [Working with Mounted Folders and Reparse Points](working-with-reparse-and-mount-points.md)).</span></span>

<span data-ttu-id="729e1-156">На этом этапе резервного копирования документ компонентов резервного копирования инициализируется и заполняется.</span><span class="sxs-lookup"><span data-stu-id="729e1-156">At this point in the backup, the Backup Components Document is initialized and filled.</span></span> <span data-ttu-id="729e1-157">В будущих операциях записи и запрашивающие стороны могут использовать интерфейс [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) для взаимодействия друг с другом.</span><span class="sxs-lookup"><span data-stu-id="729e1-157">In future operations, writers and requesters can use the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface to communicate with each other.</span></span>

<span data-ttu-id="729e1-158">Модули записи получают доступ к интерфейсу [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) при обработке событий [*PrepareForBackup*](vssgloss-p.md), [*моментального снимка*](vssgloss-p.md)и [*баккупкомплете*](vssgloss-b.md) .</span><span class="sxs-lookup"><span data-stu-id="729e1-158">Writers are given access to the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface when handling the [*PrepareForBackup*](vssgloss-p.md), [*PostSnapshot*](vssgloss-p.md), and [*BackupComplete*](vssgloss-b.md) events.</span></span>

 

 
