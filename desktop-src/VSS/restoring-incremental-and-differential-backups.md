---
description: Восстановление добавочной или разностной резервной копии в VSS не сильно отличается от других операций восстановления VSS.
ms.assetid: 67143f6f-0bb8-4740-9289-8bbfeb7caadf
title: Восстановление добавочных и разностных резервных копий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 639919ea24f12fbc036116bd89b1630321cbae54
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104544962"
---
# <a name="restoring-incremental-and-differential-backups"></a><span data-ttu-id="6a045-103">Восстановление добавочных и разностных резервных копий</span><span class="sxs-lookup"><span data-stu-id="6a045-103">Restoring Incremental and Differential Backups</span></span>

<span data-ttu-id="6a045-104">Восстановление добавочной или разностной резервной копии в VSS не сильно отличается от других операций восстановления VSS.</span><span class="sxs-lookup"><span data-stu-id="6a045-104">Restoring an incremental or differential backup under VSS is not significantly different from any other VSS restore operation.</span></span>

<span data-ttu-id="6a045-105">Модуль записи может изменять целевые объекты восстановления или перенаправлять целевой объект, а инициатор запроса должен управлять сопоставлениями альтернативного расположения и новыми целями, как и при любом другом восстановлении.</span><span class="sxs-lookup"><span data-stu-id="6a045-105">A writer can modify restore targets or request directed targeting, and a requester must handle alternate location mappings and new targets, just as with any other restore.</span></span> <span data-ttu-id="6a045-106">Однако есть две важные проблемы, которые необходимо учитывать при обработке восстановления добавочной или разностной резервной копии: дополнительные восстановления и метки резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="6a045-106">There are, however, two significant issues to be aware of in handling the restore of an incremental or differential backup: additional restores and backup stamps.</span></span>

## <a name="additional-restores"></a><span data-ttu-id="6a045-107">Дополнительные восстановления</span><span class="sxs-lookup"><span data-stu-id="6a045-107">Additional Restores</span></span>

<span data-ttu-id="6a045-108">Первая причина заключается в том, что дополнительные восстановления.</span><span class="sxs-lookup"><span data-stu-id="6a045-108">The first issue is that of additional restores.</span></span> <span data-ttu-id="6a045-109">Оператору резервного копирования может потребоваться выполнить несколько операций восстановления с использованием начального полного и последующего добавочного или разностного носителя резервных копий в качестве источника.</span><span class="sxs-lookup"><span data-stu-id="6a045-109">A backup operator may need to run several restore operations using an initial full and subsequent incremental or differential backup media as a source.</span></span>

<span data-ttu-id="6a045-110">Некоторые модули записи, как правило, являются частью обработки события [*восстановления*](vssgloss-p.md) с помощью [**Квссвритер:: онпостресторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), используют восстановленные файлы для обновления данных, находящихся на диске.</span><span class="sxs-lookup"><span data-stu-id="6a045-110">Some writers, typically as part of their handling of a [*PostRestore*](vssgloss-p.md) event using [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), use restored files to perform updates of data currently on disk.</span></span> <span data-ttu-id="6a045-111">Некоторые из этих средств записи не являются эффективными (или опасными) для многократного обновления данных на диске из восстановленных файлов.</span><span class="sxs-lookup"><span data-stu-id="6a045-111">For some of these writers it is inefficient—or dangerous—to repeatedly update on-disk data from restored files.</span></span>

<span data-ttu-id="6a045-112">Поэтому важно, чтобы приложения резервного копирования указывали, когда компонент или набор компонентов может потребовать последующих восстановлений путем вызова [**ивссбаккупкомпонентс:: сетаддитионалресторес**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores).</span><span class="sxs-lookup"><span data-stu-id="6a045-112">Therefore, it is important that backup applications indicate when a component or component set may require subsequent restores by calling [**IVssBackupComponents::SetAdditionalRestores**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores).</span></span>

<span data-ttu-id="6a045-113">Модуль записи вызовет метод [**ивсскомпонент:: жетаддитионалресторес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) , чтобы определить, является ли оператор резервного копирования более восстановлением из набора компонентов или компонентов.</span><span class="sxs-lookup"><span data-stu-id="6a045-113">A writer would call [**IVssComponent::GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) to determine whether the backup operator planned more restores of the component or component set.</span></span>

<span data-ttu-id="6a045-114">Если инициатор запроса не вызывал [**ивссбаккупкомпонентс:: сетаддитионалресторес**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores), то [**Ивсскомпонент:: жетаддитионалресторес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) возвращает значение false, а модуль записи может выполнять любые операции, необходимые для обработки после восстановления.</span><span class="sxs-lookup"><span data-stu-id="6a045-114">If the requester had not called [**IVssBackupComponents::SetAdditionalRestores**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores), then [**IVssComponent::GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) returns false, and the writer can perform any post-restore processing it needs to.</span></span>

<span data-ttu-id="6a045-115">Если был вызван [**ивссбаккупкомпонентс:: сетаддитионалресторес**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores) , то [**Ивсскомпонент:: жетаддитионалресторес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) возвращает **значение true**, а модуль записи должен решить, как следует выполнять операции после восстановления. Например, модуль записи может не обновлять свои данные на диске.</span><span class="sxs-lookup"><span data-stu-id="6a045-115">If [**IVssBackupComponents::SetAdditionalRestores**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores) had been called, then [**IVssComponent::GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) returns **true**, and a writer should decide how to handle post-restore operations—for instance, the writer may choose not to update its on-disk data.</span></span>

## <a name="backup-stamps"></a><span data-ttu-id="6a045-116">Метки резервного копирования</span><span class="sxs-lookup"><span data-stu-id="6a045-116">Backup Stamps</span></span>

<span data-ttu-id="6a045-117">В рамках предыдущей операции полного резервного копирования модуль записи может сохранить метку резервной копии в документе компонентов резервного копирования инициатора запроса.</span><span class="sxs-lookup"><span data-stu-id="6a045-117">As part of the previous full backup operation, a writer may have stored a backup stamp in the requester's Backup Components Document.</span></span>

<span data-ttu-id="6a045-118">Метка резервного копирования хранится в виде строки, и ее формат и сведения не могут быть прочитаемы для инициатора запроса.</span><span class="sxs-lookup"><span data-stu-id="6a045-118">The backup stamp is stored as a string, and its format and information are not intelligible to the requester.</span></span> <span data-ttu-id="6a045-119">Таким образом, инициатор запроса не может напрямую использовать сведения о метке резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="6a045-119">Therefore, the requester cannot make direct use of the backup stamp information.</span></span>

<span data-ttu-id="6a045-120">Вместо этого ее задача заключается в том, чтобы сделать эту информацию доступной для модуля записи, вызвав метод [**ивссбаккупкомпонентс:: сетпревиаусбаккупстамп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp) до создания события [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) для добавочного резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="6a045-120">Instead, its task is to make that information available to the writer, by calling the [**IVssBackupComponents::SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp) method prior to the generation of a [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event for an incremental backup.</span></span>

<span data-ttu-id="6a045-121">Инициатор запроса делает это на основе компонентов.</span><span class="sxs-lookup"><span data-stu-id="6a045-121">The requester does this on a component-by-component basis.</span></span> <span data-ttu-id="6a045-122">Инициатор запроса проверяет сведения о резервном копировании хранимого компонента или компонента с помощью [**ивсскомпонент:: жетбаккупстамп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="6a045-122">A requester examines stored component or component set backup stamp information using [**IVssComponent::GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp).</span></span>

<span data-ttu-id="6a045-123">Если сведения о метках резервного копирования подходят для типа восстановления, запрашивающего, он становится доступным как метка времени последней резервной копии компонента с помощью метода [**ивссбаккупкомпонентс:: сетпревиаусбаккупстамп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp) .</span><span class="sxs-lookup"><span data-stu-id="6a045-123">If backup stamp information is appropriate to the type of restore the requester is undertaking, it makes it available as the time stamp of the last backup of a component with the [**IVssBackupComponents::SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp) method.</span></span>

<span data-ttu-id="6a045-124">Модуль записи восстанавливает сведения о метке резервного копирования с помощью [**ивсскомпонент:: жетпревиаусбаккупстамп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="6a045-124">A writer recovers the backup stamp information using [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span></span> <span data-ttu-id="6a045-125">Модуль записи этого класса создал метку начальной резервной копии, поэтому модуль записи может декодировать эту метку и использовать информацию.</span><span class="sxs-lookup"><span data-stu-id="6a045-125">A writer of this class generated the initial backup stamp, so the writer is able to decode this stamp and use the information.</span></span> <span data-ttu-id="6a045-126">На основе этого при обработке события, выполняемого перед [**восстановлением**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) , модуль записи может предпринять такие действия, как изменение целевых объектов восстановления или запрос направленной нацеливания.</span><span class="sxs-lookup"><span data-stu-id="6a045-126">Based on this, while handling a [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event, a writer may choose to take actions such as changing restore targets or requesting directed targeting.</span></span>

 

 



