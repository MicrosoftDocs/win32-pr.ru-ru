---
description: Восстановление добавочной или разностной резервной копии в VSS не сильно отличается от других операций восстановления VSS.
ms.assetid: 67143f6f-0bb8-4740-9289-8bbfeb7caadf
title: Восстановление добавочных и разностных резервных копий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 639919ea24f12fbc036116bd89b1630321cbae54
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104544962"
---
# <a name="restoring-incremental-and-differential-backups"></a>Восстановление добавочных и разностных резервных копий

Восстановление добавочной или разностной резервной копии в VSS не сильно отличается от других операций восстановления VSS.

Модуль записи может изменять целевые объекты восстановления или перенаправлять целевой объект, а инициатор запроса должен управлять сопоставлениями альтернативного расположения и новыми целями, как и при любом другом восстановлении. Однако есть две важные проблемы, которые необходимо учитывать при обработке восстановления добавочной или разностной резервной копии: дополнительные восстановления и метки резервного копирования.

## <a name="additional-restores"></a>Дополнительные восстановления

Первая причина заключается в том, что дополнительные восстановления. Оператору резервного копирования может потребоваться выполнить несколько операций восстановления с использованием начального полного и последующего добавочного или разностного носителя резервных копий в качестве источника.

Некоторые модули записи, как правило, являются частью обработки события [*восстановления*](vssgloss-p.md) с помощью [**Квссвритер:: онпостресторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), используют восстановленные файлы для обновления данных, находящихся на диске. Некоторые из этих средств записи не являются эффективными (или опасными) для многократного обновления данных на диске из восстановленных файлов.

Поэтому важно, чтобы приложения резервного копирования указывали, когда компонент или набор компонентов может потребовать последующих восстановлений путем вызова [**ивссбаккупкомпонентс:: сетаддитионалресторес**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores).

Модуль записи вызовет метод [**ивсскомпонент:: жетаддитионалресторес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) , чтобы определить, является ли оператор резервного копирования более восстановлением из набора компонентов или компонентов.

Если инициатор запроса не вызывал [**ивссбаккупкомпонентс:: сетаддитионалресторес**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores), то [**Ивсскомпонент:: жетаддитионалресторес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) возвращает значение false, а модуль записи может выполнять любые операции, необходимые для обработки после восстановления.

Если был вызван [**ивссбаккупкомпонентс:: сетаддитионалресторес**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores) , то [**Ивсскомпонент:: жетаддитионалресторес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) возвращает **значение true**, а модуль записи должен решить, как следует выполнять операции после восстановления. Например, модуль записи может не обновлять свои данные на диске.

## <a name="backup-stamps"></a>Метки резервного копирования

В рамках предыдущей операции полного резервного копирования модуль записи может сохранить метку резервной копии в документе компонентов резервного копирования инициатора запроса.

Метка резервного копирования хранится в виде строки, и ее формат и сведения не могут быть прочитаемы для инициатора запроса. Таким образом, инициатор запроса не может напрямую использовать сведения о метке резервного копирования.

Вместо этого ее задача заключается в том, чтобы сделать эту информацию доступной для модуля записи, вызвав метод [**ивссбаккупкомпонентс:: сетпревиаусбаккупстамп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp) до создания события [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) для добавочного резервного копирования.

Инициатор запроса делает это на основе компонентов. Инициатор запроса проверяет сведения о резервном копировании хранимого компонента или компонента с помощью [**ивсскомпонент:: жетбаккупстамп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp).

Если сведения о метках резервного копирования подходят для типа восстановления, запрашивающего, он становится доступным как метка времени последней резервной копии компонента с помощью метода [**ивссбаккупкомпонентс:: сетпревиаусбаккупстамп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp) .

Модуль записи восстанавливает сведения о метке резервного копирования с помощью [**ивсскомпонент:: жетпревиаусбаккупстамп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp). Модуль записи этого класса создал метку начальной резервной копии, поэтому модуль записи может декодировать эту метку и использовать информацию. На основе этого при обработке события, выполняемого перед [**восстановлением**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) , модуль записи может предпринять такие действия, как изменение целевых объектов восстановления или запрос направленной нацеливания.

 

 



