---
description: События прерывания могут создаваться во время операции резервного копирования в любом из следующих случаев.
ms.assetid: c2e39cdd-0ff8-4030-9bec-9e003b4d9520
title: Прерывание операций VSS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 35e4b82ba4227dfeb02e3da91c9bc1e77f10f492
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105650836"
---
# <a name="aborting-vss-operations"></a><span data-ttu-id="d0e29-103">Прерывание операций VSS</span><span class="sxs-lookup"><span data-stu-id="d0e29-103">Aborting VSS Operations</span></span>

<span data-ttu-id="d0e29-104">События [*прерывания*](vssgloss-a.md) могут создаваться во время операции резервного копирования в любом из следующих случаев.</span><span class="sxs-lookup"><span data-stu-id="d0e29-104">[*Abort*](vssgloss-a.md) events can be generated during a backup operation in any of the following cases:</span></span>

-   <span data-ttu-id="d0e29-105">Инициатор запроса явно создает [*событие Abort*](vssgloss-a.md) , вызывая [**Ивссбаккупкомпонентс:: абортбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span><span class="sxs-lookup"><span data-stu-id="d0e29-105">A requester explicitly generates an [*Abort event*](vssgloss-a.md) by calling [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span></span>
-   <span data-ttu-id="d0e29-106">Обработчики событий [*Freeze*](vssgloss-f.md) и [*разморозки*](vssgloss-t.md) модуля записи ([**квссвритер:: onfreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) и [**квссвритер:: размораживание**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) возвращают **значение false** или не могут быть завершены в временном окне, указанном в [**квссвритер:: Initialize**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-initialize).</span><span class="sxs-lookup"><span data-stu-id="d0e29-106">A writer's [*Freeze*](vssgloss-f.md) and [*Thaw*](vssgloss-t.md) event handlers ([**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) and [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) return **false**, or cannot complete in the time window specified in [**CVssWriter::Initialize**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-initialize).</span></span>
-   <span data-ttu-id="d0e29-107">При создании теневой копии после события [*препарефорснапшот*](vssgloss-p.md) возникает ошибка поставщика или VSS.</span><span class="sxs-lookup"><span data-stu-id="d0e29-107">There is any failure of the provider or VSS during the creation of a shadow copy following the [*PrepareForSnapshot*](vssgloss-p.md) event.</span></span>

<span data-ttu-id="d0e29-108">Для операций восстановления не поддерживаются прерывания.</span><span class="sxs-lookup"><span data-stu-id="d0e29-108">Aborts are not supported for restore operations.</span></span>

## <a name="requester-handling-and-creation-of-abort-events"></a><span data-ttu-id="d0e29-109">Обработка и создание запросов событий прерывания</span><span class="sxs-lookup"><span data-stu-id="d0e29-109">Requester Handling and Creation of Abort Events</span></span>

<span data-ttu-id="d0e29-110">Экземпляр интерфейса [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) можно использовать только для одной резервной копии, поэтому, если при обработке резервной копии возникает ошибка, лучше всего освободить текущий экземпляр и начать заново.</span><span class="sxs-lookup"><span data-stu-id="d0e29-110">An instance of the [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface can be used for only one backup, so if an error occurs in processing a backup it is generally best to release the current instance and start over.</span></span>

<span data-ttu-id="d0e29-111">Инициатор запроса должен явно сообщить, что операция резервного копирования прервана (с помощью [**ивссбаккупкомпонентс:: абортбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) только после фактической подготовки к резервному копированию, включающей модули записи или создания теневой копии.</span><span class="sxs-lookup"><span data-stu-id="d0e29-111">A requester should explicitly signal that it is aborting a backup operation (using [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) only after the actual preparation for a backup, involving writers, or the creation of a shadow copy has taken place.</span></span>

<span data-ttu-id="d0e29-112">Фактически, это означает, что каждый раз, когда инициатору запроса требуется прерывать операцию резервного копирования после создания события [*PrepareForBackup*](vssgloss-p.md) путем вызова [**Ивссбаккупкомпонентс::P репарефорбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), он должен вызвать [**ивссбаккупкомпонентс:: абортбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) и ожидать его возврата до освобождения текущего экземпляра [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) .</span><span class="sxs-lookup"><span data-stu-id="d0e29-112">Effectively, this means that any time a requester needs to stop a backup operation after generating a [*PrepareForBackup*](vssgloss-p.md) event by calling [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), it should call [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) and await its return prior to releasing the current [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) instance.</span></span>

<span data-ttu-id="d0e29-113">Например, если модуль записи запретил операцию резервного копирования, запрашивающая сторона должна использовать [**ивссбаккупкомпонентс:: абортбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) для уведомления всех остальных модулей записи о том, что операция резервного копирования не будет завершена.</span><span class="sxs-lookup"><span data-stu-id="d0e29-113">For example, if a writer vetoed a backup operation, a requester should use [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) to notify all other writers that the backup operation will not be completed.</span></span>

<span data-ttu-id="d0e29-114">Перед вызовом [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)или при сбое вызова **PrepareForBackup** инициатор запроса может освободить текущий экземпляр интерфейса [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) , не требуя создания события прерывания.</span><span class="sxs-lookup"><span data-stu-id="d0e29-114">Prior to calling [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), or if the call to **PrepareForBackup** fails, a requester can release the current instance of the [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface without needing to generate an Abort event.</span></span>

<span data-ttu-id="d0e29-115">Например, если текущий экземпляр [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) используется только для получения информации путем вызова [**Ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) и создания события [*определения*](vssgloss-i.md) , после того как информация возвращена, экземпляр **ивссбаккупкомпонентс** можно просто освободить.</span><span class="sxs-lookup"><span data-stu-id="d0e29-115">For example, if the current instance of [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) is being used merely to obtain information by calling [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) and generating an [*Identify*](vssgloss-i.md) event, once information has been returned the instance of **IVSSBackupComponents** can simply be released.</span></span>

<span data-ttu-id="d0e29-116">Инициатор запроса создает ряд событий ([*препарефорснапшот*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*разморозить*](vssgloss-t.md)и [*моментальный снимок*](vssgloss-p.md)) при вызове [**ивссбаккупкомпонентс::D оснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="d0e29-116">A requester generates a number of events ([*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*Thaw*](vssgloss-t.md), and [*PostSnapshot*](vssgloss-p.md)) when it calls [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="d0e29-117">При обработке событий замораживания и разморозки может произойти сбой модуля записи, и можно создать событие прерывания самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="d0e29-117">While handling the Freeze and Thaw events, a writer may fail and can generate an Abort event on its own.</span></span> <span data-ttu-id="d0e29-118">Сбой при обработке событий Препарефорснапшот и SNAPSHOT не приводит к созданию события прерывания.</span><span class="sxs-lookup"><span data-stu-id="d0e29-118">Failure to handle PrepareForSnapshot and PostSnapshot events does not generate an Abort event.</span></span>

<span data-ttu-id="d0e29-119">Не всегда возможно, что инициатору запроса известно, было ли событие Abort создано, когда [**ивссбаккупкомпонентс::D оснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) указывает на ошибку.</span><span class="sxs-lookup"><span data-stu-id="d0e29-119">It is not always possible for a requester to know if an Abort event was generated when [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) indicates failure.</span></span> <span data-ttu-id="d0e29-120">Таким образом, инициатор запроса, которому требуется завершить операцию резервного копирования, потому что состояние **ивссбаккупкомпонентс::D оснапшотсет** указывает, что проблема все равно должна вызывать [**Ивссбаккупкомпонентс:: абортбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span><span class="sxs-lookup"><span data-stu-id="d0e29-120">Therefore, a requester that needs to terminate a backup operation because the status of **IVssBackupComponents::DoSnapshotSet** indicates a problem should still call [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span></span>

<span data-ttu-id="d0e29-121">Если запросивший объект вызвал [**ивссбаккупкомпонентс:: абортбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup), то перед освобождением экземпляра [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents)не нужно вызывать [**ивссбаккупкомпонентс:: баккупкомплете**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) .</span><span class="sxs-lookup"><span data-stu-id="d0e29-121">If a requester has called [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup), it is not necessary to call [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) prior to releasing an instance of [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span></span>

## <a name="writer-handling-and-creation-of-abort-events"></a><span data-ttu-id="d0e29-122">Обработка и создание событий прерывания записи</span><span class="sxs-lookup"><span data-stu-id="d0e29-122">Writer Handling and Creation of Abort Events</span></span>

<span data-ttu-id="d0e29-123">Как отмечалось ранее, модуль записи может получить событие прерывания от инициатора запроса или поставщик может активировать его.</span><span class="sxs-lookup"><span data-stu-id="d0e29-123">As noted previously, a writer can receive an Abort event from a requester, or the provider can trigger one itself.</span></span> <span data-ttu-id="d0e29-124">Кроме того, при определенных обстоятельствах средство записи может принимать несколько событий прерывания.</span><span class="sxs-lookup"><span data-stu-id="d0e29-124">Also, it is possible for a writer to receive multiple Abort events under certain circumstances.</span></span> <span data-ttu-id="d0e29-125">Разработчикам модуля записи следует запрограммировать любую реализацию [**квссвритер:: OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) с учетом этого.</span><span class="sxs-lookup"><span data-stu-id="d0e29-125">Writer developers should code any implementation of [**CVssWriter::OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) with this in mind.</span></span>

<span data-ttu-id="d0e29-126">При обработке события прерывания модуль записи должен попытаться восстановить все управляемые им процессы в нормальном состоянии, а также выполнять обработку ошибок и ведение журнала.</span><span class="sxs-lookup"><span data-stu-id="d0e29-126">In handling an Abort event, a writer should attempt to restore whatever process it managed to its normal running state, as well as perform any error handling and logging.</span></span>

<span data-ttu-id="d0e29-127">Это может означать, что реализация [**квссвритер:: OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) может потребоваться выполнить многие из тех же задач, что и обработчик событий разморозки ([**квссвритер:: OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)), и обработчик событий моментального снимка ([**квссвритер:: онпостснапшот**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)), и эти обработчики можно вызывать из **квссвритер:: OnAbort**.</span><span class="sxs-lookup"><span data-stu-id="d0e29-127">This may mean that an implementation of [**CVssWriter::OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) might have to perform many, if not all, of the same tasks as the Thaw event handler ([**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) and the PostSnapshot event handler ([**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)), and these handlers can be called from within **CVssWriter::OnAbort**.</span></span>

 

 



