---
description: Настройка операций восстановления на самом деле начинается во время резервного копирования данных, когда модули записи указывают, как должны быть восстановлены данные в документах метаданных модуля записи.
ms.assetid: b1f948cd-d3b0-4637-b76d-b54a74bb5948
title: Настройка методов восстановления VSS
ms.topic: reference
ms.date: 05/31/2018
ms.openlocfilehash: 412cb699fb791a973e280f63fec03bd2854ccd1d
ms.sourcegitcommit: 37f276b5d887a3aad04b1ba86e390dea9d87e591
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2021
ms.locfileid: "104273175"
---
# <a name="setting-vss-restore-methods"></a><span data-ttu-id="7c1e0-103">Настройка методов восстановления VSS</span><span class="sxs-lookup"><span data-stu-id="7c1e0-103">Setting VSS Restore Methods</span></span>

<span data-ttu-id="7c1e0-104">Настройка операций восстановления на самом деле начинается во время резервного копирования данных, когда модули записи указывают, как должны быть восстановлены данные в документах метаданных модуля записи.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-104">The configuration of restore operations actually begins during data backup, when writers specify, in their Writer Metadata Documents, how their data should be restored.</span></span>

<span data-ttu-id="7c1e0-105">Эти спецификации, которые называются [*методами восстановления*](vssgloss-r.md) или исходными [*целевыми объектами восстановления*](vssgloss-r.md), могут быть изменены во время восстановления с помощью модуля записи, задавая новые целевые объекты восстановления или инициаторами запроса, восстанавливающимися в новые расположения (см. раздел [нестандартные расположения резервного копирования и восстановления](non-default-backup-and-restore-locations.md)).</span><span class="sxs-lookup"><span data-stu-id="7c1e0-105">These specifications, referred to either as [*restore methods*](vssgloss-r.md) or original [*restore targets*](vssgloss-r.md), can be modified during restore by writers setting new restore targets or by requesters restoring to new locations (see [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md)).</span></span>

<span data-ttu-id="7c1e0-106">Вызывая [**ивсскреатевритерметадата:: сетресторемесод**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod), модуль записи указывает, какой метод Restore следует использовать в документе метаданных модуля записи.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-106">By calling [**IVssCreateWriterMetadata::SetRestoreMethod**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod), a writer indicates which restore method should be used in its Writer Metadata Document.</span></span> <span data-ttu-id="7c1e0-107">Метод Restore задает ширину модуля записи и применяется ко всем файлам во всех компонентах, которыми управляет модуль записи.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-107">The restore method is set writer wide and applied to all files in all components that a writer manages.</span></span>

<span data-ttu-id="7c1e0-108">Инициатор запроса получает (и должен учитывать) эту информацию, вызывая [**ивссексаминевритерметадата:: жетресторемесод**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod).</span><span class="sxs-lookup"><span data-stu-id="7c1e0-108">A requester obtains (and must respect) this information by calling [**IVssExamineWriterMetadata::GetRestoreMethod**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod).</span></span>

<span data-ttu-id="7c1e0-109">Метод Restore определяется перечислением [**перечисления \_ Ресторемесод \_ для VSS**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) , которое передается в [**ивсскреатевритерметадата:: сетресторемесод**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod) и возвращается из [**ивссексаминевритерметадата:: GetRestoreMethod**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod).</span><span class="sxs-lookup"><span data-stu-id="7c1e0-109">The restore method is defined by a [**VSS\_RESTOREMETHOD\_ENUM**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) enumeration, which is passed to [**IVssCreateWriterMetadata::SetRestoreMethod**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod) and returned from [**IVssExamineWriterMetadata::GetRestoreMethod**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod).</span></span>

<span data-ttu-id="7c1e0-110">Документ метаданных модуля записи поддерживает следующие допустимые методы восстановления (метод Restore в VSS \_ рме \_ undefine указывает на ошибку модуля записи).</span><span class="sxs-lookup"><span data-stu-id="7c1e0-110">The Writer Metadata Document supports the following valid restore methods (a restore method of VSS\_RME\_UNDEFINED indicates a writer error).</span></span> <span data-ttu-id="7c1e0-111">На рисунках показано, как должны быть реализованы различные поддерживаемые и определенные методы восстановления ( \_ для пользовательской службы VSS рме \_ не связана никакая фигура, так как по определению он относится к модулю записи и должен соответствовать конкретным API-интерфейсам и документации модуля записи):</span><span class="sxs-lookup"><span data-stu-id="7c1e0-111">The figures summarize how the various supported and defined restore methods should be implemented (VSS\_RME\_CUSTOM has no figure associated with it, because by definition it is specific to the writer and must follow the specific writer APIs and documentation):</span></span>

-   <span data-ttu-id="7c1e0-112">VSS \_ рме \_ RESTORE \_ \_ , если это не так \_ .</span><span class="sxs-lookup"><span data-stu-id="7c1e0-112">VSS\_RME\_RESTORE\_IF\_NOT\_THERE.</span></span> <span data-ttu-id="7c1e0-113">Восстановление файлов компонента на диск, если ни один из файлов не находится на диске.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-113">Restore component files to disk if none of the files are on the disk already.</span></span> <span data-ttu-id="7c1e0-114">Состояние целевого файла должно быть проверено после события перед [**восстановлением**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) .</span><span class="sxs-lookup"><span data-stu-id="7c1e0-114">Target file status should be checked after a [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event.</span></span>
    <span data-ttu-id="7c1e0-115">![Схема, на которой показано дерево устранения неполадок для VSS_RME_RESTORE_IF_NOT_THERE.](images/rint.png)</span><span class="sxs-lookup"><span data-stu-id="7c1e0-115">![Diagram that shows a troubleshooting tree for VSS_RME_RESTORE_IF_NOT_THERE.](images/rint.png)</span></span>
-   <span data-ttu-id="7c1e0-116">\_рме VSS \_ RESTORE \_ \_ , если может \_ заменить.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-116">VSS\_RME\_RESTORE\_IF\_CAN\_REPLACE.</span></span> <span data-ttu-id="7c1e0-117">Восстановление файлов на диск, если все файлы можно заменить.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-117">Restore files to disk if all the files can be replaced.</span></span> <span data-ttu-id="7c1e0-118">Состояние целевого файла должно быть проверено после события перед [**восстановлением**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) .</span><span class="sxs-lookup"><span data-stu-id="7c1e0-118">Target file status should be checked after a [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event.</span></span>
    <span data-ttu-id="7c1e0-119">![Схема, на которой показано дерево устранения неполадок для VSS_RME_RESTORE_IF_CAN_REPLACE.](images/ricr.png)</span><span class="sxs-lookup"><span data-stu-id="7c1e0-119">![Diagram that shows a troubleshooting tree for VSS_RME_RESTORE_IF_CAN_REPLACE.](images/ricr.png)</span></span>
-   <span data-ttu-id="7c1e0-120">\_ \_ \_ Запуск восстановления рме VSS \_ .</span><span class="sxs-lookup"><span data-stu-id="7c1e0-120">VSS\_RME\_STOP\_RESTORE\_START.</span></span> <span data-ttu-id="7c1e0-121">Служба будет остановлена перед восстановлением файлов.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-121">A service will be stopped prior to restoring the files.</span></span>
    <span data-ttu-id="7c1e0-122">![Схема, на которой показано дерево устранения неполадок для VSS_RME_STOP_RESTORE_START.](images/srr.png)</span><span class="sxs-lookup"><span data-stu-id="7c1e0-122">![Diagram that shows a troubleshooting tree for VSS_RME_STOP_RESTORE_START.](images/srr.png)</span></span>
-   <span data-ttu-id="7c1e0-123">\_рме VSS \_ Восстановление \_ в \_ альтернативное \_ расположение.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-123">VSS\_RME\_RESTORE\_TO\_ALTERNATE\_LOCATION.</span></span> <span data-ttu-id="7c1e0-124">Восстановление файлов на диск в альтернативном расположении.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-124">Restore files to disk in an alternate location.</span></span> <span data-ttu-id="7c1e0-125">Сопоставления альтернативного расположения указываются в документе метаданных модуля записи.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-125">The alternate location mappings are specified in the Writer Metadata Document.</span></span>
    <span data-ttu-id="7c1e0-126">![Схема, на которой показано дерево устранения неполадок для VSS_RME_RESTORE_TO_ALTERNATE_LOCATION.](images/rtal.png)</span><span class="sxs-lookup"><span data-stu-id="7c1e0-126">![Diagram that shows a troubleshooting tree for VSS_RME_RESTORE_TO_ALTERNATE_LOCATION.](images/rtal.png)</span></span>
-   <span data-ttu-id="7c1e0-127">\_Восстановление рме \_ VSS \_ при \_ перезагрузке.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-127">VSS\_RME\_RESTORE\_AT\_REBOOT.</span></span> <span data-ttu-id="7c1e0-128">Приводит к восстановлению файлов (перезаписывается) при перезагрузке компьютера.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-128">Cause files to be restored (overwritten) when the computer is rebooted.</span></span>
    <span data-ttu-id="7c1e0-129">![Схема, на которой показано дерево устранения неполадок для VSS_RME_RESTORE_AT_REBOOT.](images/rar.png)</span><span class="sxs-lookup"><span data-stu-id="7c1e0-129">![Diagram that shows a troubleshooting tree for VSS_RME_RESTORE_AT_REBOOT.](images/rar.png)</span></span>
-   <span data-ttu-id="7c1e0-130">\_Восстановление рме VSS при \_ \_ \_ перезагрузке \_ \_ , если не может \_ заменить.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-130">VSS\_RME\_RESTORE\_AT\_REBOOT\_IF\_CANNOT\_REPLACE.</span></span> <span data-ttu-id="7c1e0-131">Если файл не удалось восстановить на диск в работающей системе, то он будет восстановлен (перезаписывается) при перезагрузке компьютера.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-131">If a file could not be restored to disk on a running system, then it is restored (overwritten) when the computer is rebooted.</span></span>
    <span data-ttu-id="7c1e0-132">![Схема, на которой показано дерево устранение неполадок forVSS_RME_RESTORE_AT_REBOOT_IF_CANNOT_REPLACE.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-132">![Diagram that shows a troubleshooting tree forVSS_RME_RESTORE_AT_REBOOT_IF_CANNOT_REPLACE.</span></span> ](images/raricr.png)
-   <span data-ttu-id="7c1e0-133">\_рме VSS \_ Custom.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-133">VSS\_RME\_CUSTOM.</span></span> <span data-ttu-id="7c1e0-134">Ни один из предопределенных методов не будет работать. для выполнения операции восстановления приложение резервного копирования должно использовать специализированные API.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-134">None of the predefined methods will work; the backup application must use specialized APIs to perform the restore operation.</span></span> <span data-ttu-id="7c1e0-135">Для этого метода резервного копирования инициатор запроса должен полностью разобраться в вопросе модуля записи.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-135">For this backup method, the requester must completely understand the writer in question.</span></span> <span data-ttu-id="7c1e0-136">Ознакомьтесь с [особыми вариантами использования VSS](special-vss-usage-cases.md) для текущих поддерживаемых экземпляров.</span><span class="sxs-lookup"><span data-stu-id="7c1e0-136">See [Special VSS Usage Cases](special-vss-usage-cases.md) for currently supported instances.</span></span>

 

 



