---
description: Для обработки одного из наборов файлов компонента может потребоваться рекурсивный обход дерева каталогов, что может потребовать от инициатора запроса обрабатывать подключенные папки и точки повторного анализа (например, ссылки), которые указывают на данные, которые не находятся на текущем томе.
ms.assetid: d0e08598-a8a2-489b-9cb2-e989bed1ce53
title: Работа с подключенными папками и точками повторного анализа
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 397a7aa88f39361f788f9aac882b4f9d337fd6f8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692335"
---
# <a name="working-with-mounted-folders-and-reparse-points"></a><span data-ttu-id="deca6-103">Работа с подключенными папками и точками повторного анализа</span><span class="sxs-lookup"><span data-stu-id="deca6-103">Working with Mounted Folders and Reparse Points</span></span>

<span data-ttu-id="deca6-104">Для обработки одного из наборов файлов компонента может потребоваться рекурсивный обход дерева каталогов, что может потребовать от инициатора запроса обрабатывать подключенные папки и точки повторного анализа (например, ссылки), которые указывают на данные, которые не находятся на текущем томе.</span><span class="sxs-lookup"><span data-stu-id="deca6-104">Processing one of a component's file sets may require a requester to traverse a directory tree recursively, which can require the requester to handle mounted folders and reparse points (such as links) that point to data that is not on the current volume.</span></span>

<span data-ttu-id="deca6-105">Ожидающие запросы должны следовать за подключенными папками и точками повторного анализа при просмотре дерева каталогов, а VSS имеет четко определенные рекомендации по их обработке для операций резервного копирования и восстановления.</span><span class="sxs-lookup"><span data-stu-id="deca6-105">Requesters are expected to follow mounted folders and reparse points when traversing a directory tree, and VSS has well-defined guidelines for handling them for backup and restore operations.</span></span>

<span data-ttu-id="deca6-106">Чтобы продемонстрировать эти рекомендации, рассмотрим следующий пример.</span><span class="sxs-lookup"><span data-stu-id="deca6-106">To illustrate these guidelines, consider the following example:</span></span>

-   <span data-ttu-id="deca6-107">Том \\ \\ ? \\ Том {GUID \_ 1} имеет букву C: \\ .</span><span class="sxs-lookup"><span data-stu-id="deca6-107">The volume \\\\?\\Volume{GUID\_1} has the drive letter C:\\.</span></span>
-   <span data-ttu-id="deca6-108">Набор файлов имеет путь C: \\ вритердата.</span><span class="sxs-lookup"><span data-stu-id="deca6-108">A file set has a path of C:\\WriterData.</span></span>
-   <span data-ttu-id="deca6-109">Файл Specification \* . dat используется набором файлов.</span><span class="sxs-lookup"><span data-stu-id="deca6-109">A file specification \*.dat is used by the file set.</span></span>
-   <span data-ttu-id="deca6-110">Для рекурсии набора файлов задано **значение true**.</span><span class="sxs-lookup"><span data-stu-id="deca6-110">The file set's recursion is set to **TRUE**.</span></span>
-   <span data-ttu-id="deca6-111">Каталог C: \\ вритердата расположен на томе \\ \\ ? \\ Том {GUID \_ 1}.</span><span class="sxs-lookup"><span data-stu-id="deca6-111">The directory C:\\WriterData is located on the volume \\\\?\\Volume{GUID\_1}.</span></span>
-   <span data-ttu-id="deca6-112">Каталог C: \\ вритердата \\ Archive является подключенной папкой.</span><span class="sxs-lookup"><span data-stu-id="deca6-112">The directory C:\\WriterData\\Archive is a mounted folder.</span></span>
-   <span data-ttu-id="deca6-113">Том \\ \\ ? \\ Том {GUID \_ 2} связан с подключенной папкой C: \\ вритердата \\ Archive.</span><span class="sxs-lookup"><span data-stu-id="deca6-113">The volume \\\\?\\Volume{GUID\_2} is associated with the mounted folder C:\\WriterData\\Archive.</span></span>

## <a name="handling-mounted-folders-and-reparse-points-during-backup"></a><span data-ttu-id="deca6-114">Обработка подключенных папок и точек повторного анализа во время резервного копирования</span><span class="sxs-lookup"><span data-stu-id="deca6-114">Handling Mounted Folders and Reparse Points during Backup</span></span>

<span data-ttu-id="deca6-115">Основные правила обработки подключенных папок и точек повторного анализа в VSS при выполнении рекурсивного резервного копирования можно суммировать следующим образом.</span><span class="sxs-lookup"><span data-stu-id="deca6-115">The basic rules for handling mounted folders and reparse points under VSS when performing a recursive backup can be summarized as follows:</span></span>

-   <span data-ttu-id="deca6-116">Пути следуют в подключенных папках и точках повторного анализа.</span><span class="sxs-lookup"><span data-stu-id="deca6-116">Paths are followed across mounted folders and reparse points.</span></span>
-   <span data-ttu-id="deca6-117">Если подключенная папка или точка повторной обработки указывает на том, этот том должен быть теневым копированием.</span><span class="sxs-lookup"><span data-stu-id="deca6-117">If a mounted folder or reparse point points to a volume, that volume should be shadow copied.</span></span>
-   <span data-ttu-id="deca6-118">Если том содержит подключенные папки или точки повторного анализа, они будут отображаться в теневой копии тома.</span><span class="sxs-lookup"><span data-stu-id="deca6-118">If a volume contains mounted folders or reparse points, these will appear in the shadow copy of the volume.</span></span>
-   <span data-ttu-id="deca6-119">Данные, наявляющиеся в подключенной папке или точке повторной обработки, фиксируются в теневой копии тома, на который указывает подключенная папка или точка повторной обработки.</span><span class="sxs-lookup"><span data-stu-id="deca6-119">Data that is under the mounted folder or reparse point is captured in the shadow copy of the volume that the mounted folder or reparse point points to.</span></span>

<span data-ttu-id="deca6-120">Чтобы продемонстрировать использование приведенного выше примера, так как задан рекурсивный флаг, инициатор запроса должен проверить все данные в папке C: \\ вритердата \\ Archive и ниже.</span><span class="sxs-lookup"><span data-stu-id="deca6-120">To illustrate using the example above, because the recursive flag is set, the requester must examine all data under C:\\WriterData\\Archive and below.</span></span>

<span data-ttu-id="deca6-121">Инициатор запроса должен добавить как том с буквой диска C: \\ ( \\ \\ ? \\ Том {GUID \_ 1}) и том, связанный с подключенной папкой C: \\ вритердата \\ Archive ( \\ \\ ? \\ Том {GUID \_ 2}) в набор теневых копий с помощью [**ивссбаккупкомпонентс:: аддтоснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="deca6-121">The requester must add both the volume with drive letter C:\\ (\\\\?\\Volume{GUID\_1}) and the volume associated with the mounted folder C:\\WriterData\\Archive (\\\\?\\Volume{GUID\_2}) to the shadow copy set using [**IVssBackupComponents::AddToSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset).</span></span>

<span data-ttu-id="deca6-122">\\ \\ В теневой копии тома отображается архивная папка C: вритердата \\ \\ ? \\ Том {GUID \_ 1} с объектом устройства с именем deviceObject1.</span><span class="sxs-lookup"><span data-stu-id="deca6-122">The mounted folder C:\\WriterData\\Archive appears in the shadow copy of volume \\\\?\\Volume{GUID\_1}, which has a device object named deviceObject1.</span></span>

<span data-ttu-id="deca6-123">Однако VSS не будет копировать данные в эту подключенную папку (данные включены \\ \\ ? \\ Том {GUID \_ 2}) к теневой копии, на которую ссылается deviceObject1.</span><span class="sxs-lookup"><span data-stu-id="deca6-123">However, VSS will not copy any data under that mounted folder (data on \\\\?\\Volume{GUID\_2}) to the shadow copy referenced by deviceObject1.</span></span> <span data-ttu-id="deca6-124">Вместо этого эти данные фиксируются в теневой копии \\ \\ ? \\ Том {GUID \_ 2} с объектом устройства с именем deviceObject2.</span><span class="sxs-lookup"><span data-stu-id="deca6-124">Instead, that data is captured in the shadow copy of \\\\?\\Volume{GUID\_2}, which has a device object named deviceObject2.</span></span>

<span data-ttu-id="deca6-125">Таким образом, инициатор запроса, который создает резервную копию теневых копий файлов в C: \\ вритердата, будет использовать путь deviceObject1 \\ вритердата для поиска файлов, соответствующих C: \\ вритердата \\ \* . dat.</span><span class="sxs-lookup"><span data-stu-id="deca6-125">Therefore, a requester that is backing up shadow copied files under C:\\WriterData will use a path of deviceObject1\\WriterData to search for files matching C:\\WriterData\\\*.dat.</span></span>

<span data-ttu-id="deca6-126">Чтобы выполнить резервное копирование теневых копий файлов в файле C: \\ вритердата \\ Archive, инициатор запроса будет использовать путь deviceObject2 (поскольку корневой каталог \\ \\ ? \\ Том {GUID \_ 2} связан с подключенной папкой c: \\ Архив модуля записи, \\ чтобы найти файлы, соответствующие C: \\ вритердата \\ Archive \\ \* . dat.</span><span class="sxs-lookup"><span data-stu-id="deca6-126">To back up shadow copied files under C:\\WriterData\\Archive, the requester will use a path of deviceObject2 (because the root directory of \\\\?\\Volume{GUID\_2} was associated with the mounted folder C:\\Writer\\Archive) to search for files matching C:\\WriterData\\Archive\\\*.dat.</span></span>

<span data-ttu-id="deca6-127">Обратите внимание, что точка повторного анализа обрабатывается так же, как и подключенная папка.</span><span class="sxs-lookup"><span data-stu-id="deca6-127">Note that a reparse point is handled in the same way as a mounted folder.</span></span> <span data-ttu-id="deca6-128">Точка повторного анализа отображается в теневой копии первого тома.</span><span class="sxs-lookup"><span data-stu-id="deca6-128">The reparse point appears in the shadow copy of the first volume.</span></span> <span data-ttu-id="deca6-129">Данные в точке повторного анализа отображаются в теневой копии второго тома.</span><span class="sxs-lookup"><span data-stu-id="deca6-129">The data under the reparse point appears in the shadow copy of the second volume.</span></span>

<span data-ttu-id="deca6-130">Во время резервного копирования запрашивающие стороны должны хранить сведения о подключенных папках и связанных с ними томах, а также о точках повторного анализа и их целевых объектах, чтобы обеспечить правильную архивацию и восстановление всех данных.</span><span class="sxs-lookup"><span data-stu-id="deca6-130">During backup, requesters should store information about mounted folders and the volumes associated with them as well as reparse points and their targets to ensure that all data is backed up and restored correctly.</span></span>

## <a name="handling-mount-and-reparse-points-during-restore"></a><span data-ttu-id="deca6-131">Обработка точек подключения и повторного анализа во время восстановления</span><span class="sxs-lookup"><span data-stu-id="deca6-131">Handling Mount and Reparse Points during Restore</span></span>

<span data-ttu-id="deca6-132">При восстановлении файлов инициатор запроса должен следовать рекомендациям, отличным от тех, которые использовались во время резервного копирования (без учета таких проблем, как [*сопоставление альтернативного расположения*](vssgloss-a.md) и [*новое целевое расположение*](vssgloss-n.md)):</span><span class="sxs-lookup"><span data-stu-id="deca6-132">When restoring files, the requester must follow guidelines somewhat different from those that were used during backup (ignoring issues such as [*alternate location mapping*](vssgloss-a.md) and [*new target location*](vssgloss-n.md)):</span></span>

-   <span data-ttu-id="deca6-133">Как и раньше, если требуется рекурсия, то пути должны находиться в подключенных папках и точках повторного анализа.</span><span class="sxs-lookup"><span data-stu-id="deca6-133">As before, if recursion is required, paths are followed across mounted folders and reparse points.</span></span>
-   <span data-ttu-id="deca6-134">Подключенные папки будут восстановлены.</span><span class="sxs-lookup"><span data-stu-id="deca6-134">Mounted folders are to be restored.</span></span>
-   <span data-ttu-id="deca6-135">Местами восстановления подключенных папок и точек повторного анализа являются их исходные пути.</span><span class="sxs-lookup"><span data-stu-id="deca6-135">The restoration locations of mounted folders and reparse points are those determined by their original paths.</span></span>

<span data-ttu-id="deca6-136">Если имена томов сохраняются между резервным копированием и восстановлением, то есть не создаются повторно тома — восстановленные подключенные папки и точки повторного анализа должны указывать на правильные тома.</span><span class="sxs-lookup"><span data-stu-id="deca6-136">If the volume names persist between backup and restore—that is, you do not re-create the volumes—restored mounted folders and reparse points should point to the correct volumes.</span></span>

<span data-ttu-id="deca6-137">Поэтому в приведенном выше примере, если папка C: \\ вритердата \\ Archive была восстановлена до ( \\ \\ ? \\ Том {GUID \_ 1}) и ранее связанный с ним том был восстановлен в ( \\ \\ ? \\ Том {GUID \_ 2}), восстановленные файлы и структура файлов будут правильными и единообразными.</span><span class="sxs-lookup"><span data-stu-id="deca6-137">Therefore, in the example discussed above, if the mounted folder C:\\WriterData\\Archive was restored to (\\\\?\\Volume{GUID\_1}) and the volume previously associated with it was restored to (\\\\?\\Volume{GUID\_2}), the restored files and file structure would be correct and consistent.</span></span>

<span data-ttu-id="deca6-138">Возможно, данные восстанавливаются в систему, в которой имена томов изменились.</span><span class="sxs-lookup"><span data-stu-id="deca6-138">It may happen that data is restored to a system where volume names changed.</span></span> <span data-ttu-id="deca6-139">Это может быть вызвано аварийным завершением работы диска, в котором может потребоваться ручное восстановление системы и повторное создание томов.</span><span class="sxs-lookup"><span data-stu-id="deca6-139">This could be due to disk crashes, where you might need to perform a manual system recovery and re-create volumes.</span></span> <span data-ttu-id="deca6-140">В такой ситуации подключенные папки и точки повторного анализа станут недействительными после восстановления.</span><span class="sxs-lookup"><span data-stu-id="deca6-140">In this type of situation, mounted folders and reparse points will no longer be valid after restore.</span></span> <span data-ttu-id="deca6-141">Чтобы повторно создать файлы и структуру файлов на восстановленном томе, потребуется удалить восстановленные подключенные папки и точки повторного анализа и создать их заново на диске.</span><span class="sxs-lookup"><span data-stu-id="deca6-141">To re-create the files and file structure on the restored volume will require deleting the restored mounted folders and reparse points and re-creating them on disk.</span></span> <span data-ttu-id="deca6-142">Приложение резервного копирования должно решить, подходит ли это.</span><span class="sxs-lookup"><span data-stu-id="deca6-142">It is up to the backup application to decide whether this is appropriate.</span></span>

<span data-ttu-id="deca6-143">Обратите внимание, что назначение восстановления для подключенной папки уже занято.</span><span class="sxs-lookup"><span data-stu-id="deca6-143">Note that it is possible that the restore destination for a mounted folder is already occupied.</span></span> <span data-ttu-id="deca6-144">Например, C: \\ вритердата \\ Archive может уже содержать некоторые файлы.</span><span class="sxs-lookup"><span data-stu-id="deca6-144">For example, C:\\WriterData\\Archive might already contain some files.</span></span> <span data-ttu-id="deca6-145">Для принятия решения о том, как следует решить эту ситуацию, требуется приложение резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="deca6-145">It is up to the backup application to decide how to handle this situation.</span></span>

 

 



