---
description: После выполнения действий, описанных в разделе Обзор инициализации восстановления и общих сведений о подготовке к восстановлению, запрашивающая сторона имеет достаточные сведения для начала восстановления файлов.
ms.assetid: 15df39fa-1eb1-4e96-9e26-14470f391de4
title: Общие сведения о фактическом восстановлении файлов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6527a10d0880b1e599377abb797449816019ab89
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692900"
---
# <a name="overview-of-actual-file-restoration"></a><span data-ttu-id="80cb7-103">Общие сведения о фактическом восстановлении файлов</span><span class="sxs-lookup"><span data-stu-id="80cb7-103">Overview of Actual File Restoration</span></span>

<span data-ttu-id="80cb7-104">После выполнения действий, описанных в разделе [Обзор инициализации восстановления](overview-of-restore-initialization.md) и общих сведений о [подготовке к восстановлению](overview-of-preparing-for-restore.md), запрашивающая сторона имеет достаточные сведения для начала восстановления файлов.</span><span class="sxs-lookup"><span data-stu-id="80cb7-104">After performing the actions described in [Overview of Restore Initialization](overview-of-restore-initialization.md) and [Overview of Preparing for Restore](overview-of-preparing-for-restore.md), the requester has sufficient information to begin restoring files.</span></span> <span data-ttu-id="80cb7-105">Восстановление файлов не влечет за собой взаимодействие с модулем записи или создание событий.</span><span class="sxs-lookup"><span data-stu-id="80cb7-105">File restoration does not involve writer interactions or the generation of events.</span></span> <span data-ttu-id="80cb7-106">Дополнительные сведения см. в разделе Общие сведения об [обработке восстановления в VSS](overview-of-processing-a-restore-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="80cb7-106">For more information, see [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md).</span></span>

<span data-ttu-id="80cb7-107">В следующей таблице показана последовательность действий и событий, необходимых для восстановления файлов.</span><span class="sxs-lookup"><span data-stu-id="80cb7-107">The following table shows the sequence of actions and events that are required to restore files.</span></span>



| <span data-ttu-id="80cb7-108">Действие запросившего</span><span class="sxs-lookup"><span data-stu-id="80cb7-108">Requester action</span></span>                                                                                                                                                                                                                                                                                                          | <span data-ttu-id="80cb7-109">Событие</span><span class="sxs-lookup"><span data-stu-id="80cb7-109">Event</span></span> | <span data-ttu-id="80cb7-110">Действие записи</span><span class="sxs-lookup"><span data-stu-id="80cb7-110">Writer action</span></span> |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------|---------------|
| <span data-ttu-id="80cb7-111">Создание списка восстановления набора для файлов на носителе резервных копий.</span><span class="sxs-lookup"><span data-stu-id="80cb7-111">Generate a restore set listing for files on backup media.</span></span>                                                                                                                                                                                                                                                                 | <span data-ttu-id="80cb7-112">Нет</span><span class="sxs-lookup"><span data-stu-id="80cb7-112">None</span></span>  | <span data-ttu-id="80cb7-113">Нет</span><span class="sxs-lookup"><span data-stu-id="80cb7-113">None</span></span>          |
| <span data-ttu-id="80cb7-114">Обрабатывает [*направленные целевые объекты*](vssgloss-d.md) или [*частичное восстановление файлов*](vssgloss-p.md) (см. раздел [**ивсскомпонент:: Жетдиректедтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget), [**ивсскомпонент:: жетпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile)).</span><span class="sxs-lookup"><span data-stu-id="80cb7-114">Handle [*directed targets*](vssgloss-d.md) or [*partial file*](vssgloss-p.md) restoration (see [**IVssComponent::GetDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget), [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile)).</span></span> | <span data-ttu-id="80cb7-115">Нет</span><span class="sxs-lookup"><span data-stu-id="80cb7-115">None</span></span>  | <span data-ttu-id="80cb7-116">Нет</span><span class="sxs-lookup"><span data-stu-id="80cb7-116">None</span></span>          |
| <span data-ttu-id="80cb7-117">При необходимости проигнорируйте все указанные расположения для восстановления и выполните восстановление в новое расположение, указанное в предыдущем вызове метода [**ивссбаккупкомпонентс:: аддневтаржет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget).</span><span class="sxs-lookup"><span data-stu-id="80cb7-117">If necessary, ignore all specified restore locations and restore to a new location specified in an earlier call to [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget).</span></span>                                                                                                                       | <span data-ttu-id="80cb7-118">Нет</span><span class="sxs-lookup"><span data-stu-id="80cb7-118">None</span></span>  | <span data-ttu-id="80cb7-119">Нет</span><span class="sxs-lookup"><span data-stu-id="80cb7-119">None</span></span>          |
| <span data-ttu-id="80cb7-120">Если восстановление является добавочным и требуется дальнейшее восстановление, укажите (см. раздел [**ивссбаккупкомпонентс:: сетаддитионалресторес**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores) и [добавочные и разностные резервные копии](incremental-and-differential-backups.md)).</span><span class="sxs-lookup"><span data-stu-id="80cb7-120">If the restore is incremental and further restores are needed, indicate (see [**IVssBackupComponents::SetAdditionalRestores**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores) and [Incremental and Differential Backups](incremental-and-differential-backups.md)).</span></span>                                                     | <span data-ttu-id="80cb7-121">Нет</span><span class="sxs-lookup"><span data-stu-id="80cb7-121">None</span></span>  | <span data-ttu-id="80cb7-122">Нет</span><span class="sxs-lookup"><span data-stu-id="80cb7-122">None</span></span>          |
| <span data-ttu-id="80cb7-123">Чтобы узнать, изменил ли модуль записи содержимое документа компонентов резервного копирования, вызовите метод [**ивссбаккупкомпонентс:: жетвритеркомпонентс**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span><span class="sxs-lookup"><span data-stu-id="80cb7-123">To learn whether a writer has modified the contents of the Backup Components Document, call [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span></span> <span data-ttu-id="80cb7-124">Например, модуль записи мог изменить целевой объект восстановления.</span><span class="sxs-lookup"><span data-stu-id="80cb7-124">For example, the writer might have changed the restore target.</span></span>                                                                 | <span data-ttu-id="80cb7-125">Нет</span><span class="sxs-lookup"><span data-stu-id="80cb7-125">None</span></span>  | <span data-ttu-id="80cb7-126">Нет</span><span class="sxs-lookup"><span data-stu-id="80cb7-126">None</span></span>          |



 

## <a name="requester-actions-during-restoring-files"></a><span data-ttu-id="80cb7-127">Действия запросившего во время восстановления файлов</span><span class="sxs-lookup"><span data-stu-id="80cb7-127">Requester Actions during Restoring Files</span></span>

<span data-ttu-id="80cb7-128">Для большинства файлов на носителе резервной копии инициатору запроса необходимо определить их исходные расположения и новые расположения или сопоставления альтернативного расположения, которые применяются к ним.</span><span class="sxs-lookup"><span data-stu-id="80cb7-128">For most files on the backup media, the requester needs to determine their original locations and any new locations or alternate location mappings that apply to them.</span></span> <span data-ttu-id="80cb7-129">(См. статью [Создание набора восстановления](generating-a-restore-set.md) для обсуждения рекомендаций по определению файлов для восстановления и их восстановлению.)</span><span class="sxs-lookup"><span data-stu-id="80cb7-129">(See [Generating a Restore Set](generating-a-restore-set.md) for a discussion of best practices in determining which files to restore and where to restore them.)</span></span>

<span data-ttu-id="80cb7-130">Кроме того, некоторые файлы могут [*направлять целевые объекты*](vssgloss-d.md) или поддерживать [*частичное восстановление файлов*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="80cb7-130">In addition, some files may have [*directed targets*](vssgloss-d.md) or support [*partial file*](vssgloss-p.md) restoration.</span></span> <span data-ttu-id="80cb7-131">Количество таких файлов можно найти путем вызова [**ивсскомпонент:: жетдиректедтаржеткаунт**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) и [**Ивсскомпонент:: жетпартиалфилекаунт**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfilecount), а сведения о подробных инструкциях по восстановлению можно найти, вызвав [**Ивсскомпонент:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) и [**IVssComponent:: GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile).</span><span class="sxs-lookup"><span data-stu-id="80cb7-131">The number of such files can be found by calling [**IVssComponent::GetDirectedTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) and [**IVssComponent::GetPartialFileCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfilecount), and information on detailed restoration instructions can be found by calling [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) and [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile).</span></span> <span data-ttu-id="80cb7-132">(Частичные и перенаправленные файлы могут быть частью компонентов, добавленных неявно или явно к исходной резервной копии. Дополнительные сведения см. в разделе [Работа с выборкой для восстановления и подкомпонентов](working-with-selectability-for-restore-and-subcomponents.md) .)</span><span class="sxs-lookup"><span data-stu-id="80cb7-132">(Partial and directed files can be part of components added implicitly or explicitly to the original backup, see [Working with Selectability For Restore and Subcomponents](working-with-selectability-for-restore-and-subcomponents.md) for more information.)</span></span>

<span data-ttu-id="80cb7-133">Успешное или неуспешное выполнение восстановления указывается в зависимости от компонента с помощью [**ивссбаккупкомпонентс:: сетфилересторестатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus).</span><span class="sxs-lookup"><span data-stu-id="80cb7-133">Success or failure of a restore is indicated on a component-by-component basis using [**IVssBackupComponents::SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus).</span></span> <span data-ttu-id="80cb7-134">Необходимость в дальнейших операциях восстановления (в случае добавочных или разностных восстановлений) также указывается для каждого компонента по компоненту с помощью [**ивссбаккупкомпонентс:: сетаддитионалресторес**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores).</span><span class="sxs-lookup"><span data-stu-id="80cb7-134">The need for further restore operations (in the case of incremental or differential restores) is also indicated on a component-by-component basis using [**IVssBackupComponents::SetAdditionalRestores**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores).</span></span>

<span data-ttu-id="80cb7-135">В общем случае служба VSS не указывает механизм для получения данных с носителя хранилища, выбор носителя или определение файлов, которые нужно восстановить.</span><span class="sxs-lookup"><span data-stu-id="80cb7-135">In general, VSS does not specify a mechanism for retrieving data from a storage media, a choice of storage medium, or how to determine which files should be restored where.</span></span>

<span data-ttu-id="80cb7-136">Однако для некоторых модулей записи восстановление файлов может привести к использованию документированного пользовательского интерфейса и процедуры.</span><span class="sxs-lookup"><span data-stu-id="80cb7-136">However, for certain writers, restoring files may involve the use of a documented custom interface and procedure.</span></span> <span data-ttu-id="80cb7-137">Модули записи системы Windows, которые в настоящее время нуждаются в такой поддержке, описаны в [специальных сценариях использования VSS](special-vss-usage-cases.md).</span><span class="sxs-lookup"><span data-stu-id="80cb7-137">Windows system writers, which currently require such support, are documented in [Special VSS Usage Cases](special-vss-usage-cases.md).</span></span>

<span data-ttu-id="80cb7-138">Как правило, рекомендуется обрабатывать файлы каждого компонента каждого [*экземпляра модуля записи*](vssgloss-w.md) как единое целое.</span><span class="sxs-lookup"><span data-stu-id="80cb7-138">In general, it is recommended that the files of each component of each [*writer instance*](vssgloss-w.md) be processed as a unit.</span></span> <span data-ttu-id="80cb7-139">Для этого требуется следующее:</span><span class="sxs-lookup"><span data-stu-id="80cb7-139">This requires the following:</span></span>

-   <span data-ttu-id="80cb7-140">Связывание каждого восстанавливаемого файла с управляемым им компонентом.</span><span class="sxs-lookup"><span data-stu-id="80cb7-140">Associating each file to be restored with the component that managed it.</span></span> <span data-ttu-id="80cb7-141">Для этого необходимо использовать документы метаданных модуля записи.</span><span class="sxs-lookup"><span data-stu-id="80cb7-141">This requires the use of Writer Metadata Documents.</span></span>
-   <span data-ttu-id="80cb7-142">Получение правильных сведений о целевом восстановлении.</span><span class="sxs-lookup"><span data-stu-id="80cb7-142">Obtaining correct restoration target information.</span></span> <span data-ttu-id="80cb7-143">Для этого требуются сведения из документа о компонентах резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="80cb7-143">This requires information from the Backup Components Document.</span></span>

 

 



