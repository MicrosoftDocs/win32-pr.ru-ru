---
description: После выполнения действий, описанных в разделе Обзор инициализации восстановления и общих сведений о подготовке к восстановлению, запрашивающая сторона имеет достаточные сведения для начала восстановления файлов.
ms.assetid: 15df39fa-1eb1-4e96-9e26-14470f391de4
title: Общие сведения о фактическом восстановлении файлов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6527a10d0880b1e599377abb797449816019ab89
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692900"
---
# <a name="overview-of-actual-file-restoration"></a>Общие сведения о фактическом восстановлении файлов

После выполнения действий, описанных в разделе [Обзор инициализации восстановления](overview-of-restore-initialization.md) и общих сведений о [подготовке к восстановлению](overview-of-preparing-for-restore.md), запрашивающая сторона имеет достаточные сведения для начала восстановления файлов. Восстановление файлов не влечет за собой взаимодействие с модулем записи или создание событий. Дополнительные сведения см. в разделе Общие сведения об [обработке восстановления в VSS](overview-of-processing-a-restore-under-vss.md).

В следующей таблице показана последовательность действий и событий, необходимых для восстановления файлов.



| Действие запросившего                                                                                                                                                                                                                                                                                                          | Событие | Действие записи |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------|---------------|
| Создание списка восстановления набора для файлов на носителе резервных копий.                                                                                                                                                                                                                                                                 | Нет  | Нет          |
| Обрабатывает [*направленные целевые объекты*](vssgloss-d.md) или [*частичное восстановление файлов*](vssgloss-p.md) (см. раздел [**ивсскомпонент:: Жетдиректедтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget), [**ивсскомпонент:: жетпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile)). | Нет  | Нет          |
| При необходимости проигнорируйте все указанные расположения для восстановления и выполните восстановление в новое расположение, указанное в предыдущем вызове метода [**ивссбаккупкомпонентс:: аддневтаржет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget).                                                                                                                       | Нет  | Нет          |
| Если восстановление является добавочным и требуется дальнейшее восстановление, укажите (см. раздел [**ивссбаккупкомпонентс:: сетаддитионалресторес**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores) и [добавочные и разностные резервные копии](incremental-and-differential-backups.md)).                                                     | Нет  | Нет          |
| Чтобы узнать, изменил ли модуль записи содержимое документа компонентов резервного копирования, вызовите метод [**ивссбаккупкомпонентс:: жетвритеркомпонентс**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents). Например, модуль записи мог изменить целевой объект восстановления.                                                                 | Нет  | Нет          |



 

## <a name="requester-actions-during-restoring-files"></a>Действия запросившего во время восстановления файлов

Для большинства файлов на носителе резервной копии инициатору запроса необходимо определить их исходные расположения и новые расположения или сопоставления альтернативного расположения, которые применяются к ним. (См. статью [Создание набора восстановления](generating-a-restore-set.md) для обсуждения рекомендаций по определению файлов для восстановления и их восстановлению.)

Кроме того, некоторые файлы могут [*направлять целевые объекты*](vssgloss-d.md) или поддерживать [*частичное восстановление файлов*](vssgloss-p.md) . Количество таких файлов можно найти путем вызова [**ивсскомпонент:: жетдиректедтаржеткаунт**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) и [**Ивсскомпонент:: жетпартиалфилекаунт**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfilecount), а сведения о подробных инструкциях по восстановлению можно найти, вызвав [**Ивсскомпонент:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) и [**IVssComponent:: GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile). (Частичные и перенаправленные файлы могут быть частью компонентов, добавленных неявно или явно к исходной резервной копии. Дополнительные сведения см. в разделе [Работа с выборкой для восстановления и подкомпонентов](working-with-selectability-for-restore-and-subcomponents.md) .)

Успешное или неуспешное выполнение восстановления указывается в зависимости от компонента с помощью [**ивссбаккупкомпонентс:: сетфилересторестатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus). Необходимость в дальнейших операциях восстановления (в случае добавочных или разностных восстановлений) также указывается для каждого компонента по компоненту с помощью [**ивссбаккупкомпонентс:: сетаддитионалресторес**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores).

В общем случае служба VSS не указывает механизм для получения данных с носителя хранилища, выбор носителя или определение файлов, которые нужно восстановить.

Однако для некоторых модулей записи восстановление файлов может привести к использованию документированного пользовательского интерфейса и процедуры. Модули записи системы Windows, которые в настоящее время нуждаются в такой поддержке, описаны в [специальных сценариях использования VSS](special-vss-usage-cases.md).

Как правило, рекомендуется обрабатывать файлы каждого компонента каждого [*экземпляра модуля записи*](vssgloss-w.md) как единое целое. Для этого требуется следующее:

-   Связывание каждого восстанавливаемого файла с управляемым им компонентом. Для этого необходимо использовать документы метаданных модуля записи.
-   Получение правильных сведений о целевом восстановлении. Для этого требуются сведения из документа о компонентах резервного копирования.

 

 



