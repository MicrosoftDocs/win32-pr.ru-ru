---
description: Теневая копия — это моментальный снимок тома, который дублирует все данные, удерживаемые на этом томе, в один четко определенный момент времени. VSS определяет каждую теневую копию по постоянному идентификатору GUID.
ms.assetid: 8ef2478a-c8bc-4517-9a14-e1d9226ec4cd
title: Теневые копии и наборы теневых копий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 18709842b1fb0fbf6d6cce2557b51042dfb024ea
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692873"
---
# <a name="shadow-copies-and-shadow-copy-sets"></a><span data-ttu-id="9186f-104">Теневые копии и наборы теневых копий</span><span class="sxs-lookup"><span data-stu-id="9186f-104">Shadow Copies and Shadow Copy Sets</span></span>

<span data-ttu-id="9186f-105">[*Теневая копия*](vssgloss-s.md) — это моментальный снимок тома, который дублирует все данные, удерживаемые на этом томе, в один четко определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="9186f-105">A [*shadow copy*](vssgloss-s.md) is a snapshot of a volume that duplicates all of the data that is held on that volume at one well-defined instant in time.</span></span> <span data-ttu-id="9186f-106">VSS определяет каждую теневую копию по постоянному идентификатору GUID.</span><span class="sxs-lookup"><span data-stu-id="9186f-106">VSS identifies each shadow copy by a persistent GUID.</span></span>

<span data-ttu-id="9186f-107">[*Набор теневых копий*](vssgloss-s.md) — это набор теневых копий различных томов, которые выполняются одновременно.</span><span class="sxs-lookup"><span data-stu-id="9186f-107">A [*shadow copy set*](vssgloss-s.md) is a collection of shadow copies of various volumes all taken at the same time.</span></span> <span data-ttu-id="9186f-108">VSS идентифицирует каждый набор теневых копий с помощью постоянного идентификатора GUID.</span><span class="sxs-lookup"><span data-stu-id="9186f-108">VSS identifies each shadow copy set by a persistent GUID.</span></span>

<span data-ttu-id="9186f-109">Как конкретный поставщик оборудования или программного обеспечения выбирает для реализации теневых копий по своему усмотрению.</span><span class="sxs-lookup"><span data-stu-id="9186f-109">How a particular hardware or software vendor chooses to implement shadow copies is completely at its discretion.</span></span> <span data-ttu-id="9186f-110">После создания теневой копии в системе доступны два образа тома, скопированного с помощью теневого копирования: исходный том, к которому можно обращаться по соглашению. и скопированные данные, к которым можно получить доступ через API VSS.</span><span class="sxs-lookup"><span data-stu-id="9186f-110">Once a shadow copy is created, there are effectively two images of the shadow-copied volume available to the system: the original volume, which can be accessed conventionally; and the copied data, which can be accessed through the VSS API.</span></span>

<span data-ttu-id="9186f-111">Это позволяет выполнять два набора действий одновременно:</span><span class="sxs-lookup"><span data-stu-id="9186f-111">This allows two sets of activities to take place at the same time:</span></span>

-   <span data-ttu-id="9186f-112">Обычные приложения в системе можно быстро продолжить или возобновить с помощью исходного тома, обновив данные на диске.</span><span class="sxs-lookup"><span data-stu-id="9186f-112">Ordinary applications on the system can quickly continue or resume using the original volume, updating data on the disk.</span></span>
-   <span data-ttu-id="9186f-113">Приложения, использующие API инициатора VSS для доступа к тому теневого копирования, могут выполнять резервное копирование или аналогичные операции.</span><span class="sxs-lookup"><span data-stu-id="9186f-113">Applications that are using the VSS requester API to access the shadow-copied volume can perform backups or similar operations.</span></span>

<span data-ttu-id="9186f-114">Теневые копии не должны быть реализованы одинаковым образом для каждого файла, каталога или тома.</span><span class="sxs-lookup"><span data-stu-id="9186f-114">Shadow copies need not be implemented in the same way for every file, directory, or volume.</span></span> <span data-ttu-id="9186f-115">Различные реализации механизма теневого копирования ([*поставщиков*](vssgloss-p.md)) могут использовать разные подходы к созданию теневой копии.</span><span class="sxs-lookup"><span data-stu-id="9186f-115">Different implementations of the shadow copy mechanism ([*providers*](vssgloss-p.md)) may use different approaches to creating a shadow copy.</span></span> <span data-ttu-id="9186f-116">Однако для всех приложений, использующих API VSS, все теневые копии должны отображаться одинаково.</span><span class="sxs-lookup"><span data-stu-id="9186f-116">However, to all applications that are using the VSS API, all shadow copies should appear the same.</span></span>

<span data-ttu-id="9186f-117">Сведения о реализации поставщика Windows по умолчанию см. в разделе [поставщик системы](providers.md).</span><span class="sxs-lookup"><span data-stu-id="9186f-117">For information on the default Windows provider implementation, see [System Provider](providers.md).</span></span>

## <a name="default-shadow-copy-state"></a><span data-ttu-id="9186f-118">Состояние теневой копии по умолчанию</span><span class="sxs-lookup"><span data-stu-id="9186f-118">Default Shadow Copy State</span></span>

<span data-ttu-id="9186f-119">Несмотря на то, что файловая система очищает все буферы ввода-вывода перед созданием теневой копии, это не обеспечит надлежащей обработке незавершенных операций ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="9186f-119">Even though the file system flushes all I/O buffers prior to creating a shadow copy, this will not ensure that incomplete I/O is properly handled.</span></span>

<span data-ttu-id="9186f-120">Таким образом, предполагая, что в системе нет приложений с поддержкой VSS, данные в теневой копии говорят о том, что они находятся в [*состоянии сбоя*](vssgloss-c.md).</span><span class="sxs-lookup"><span data-stu-id="9186f-120">Therefore, assuming that the system has no VSS-enabled applications, the data in a shadow copy is said to be in a [*crash-consistent state*](vssgloss-c.md).</span></span> <span data-ttu-id="9186f-121">Теневая копия в состоянии с состоянием отказоустойчивости содержит образ диска, аналогичный тому, который существовал после аварийного завершения работы системы.</span><span class="sxs-lookup"><span data-stu-id="9186f-121">A shadow copy in a crash-consistent state contains an image of the disk that is the same as that which would exist following a catastrophic system shutdown.</span></span> <span data-ttu-id="9186f-122">Все открытые файлы по-прежнему будут существовать на томе, но они не гарантируют освобождения незавершенных операций ввода-вывода или повреждения данных.</span><span class="sxs-lookup"><span data-stu-id="9186f-122">All files that were open will still exist on the volume, but they are not guaranteed to be free of incomplete I/O operations or data corruption.</span></span>

<span data-ttu-id="9186f-123">В то время как отказоустойчивое состояние не полностью связано со всеми проблемами, связанными с определением стабильного резервного набора данных (см. раздел [Общие проблемы резервного копирования томов](common-volume-backup-issues.md)), у него есть несколько преимуществ по сравнению с резервным набором данных, которые должны использоваться для выполнения стандартных операций резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="9186f-123">While the crash-consistent state does not fully deal with all the issues associated with defining a stable backup set (see [Common Volume Backup Issues](common-volume-backup-issues.md)), it has several advantages over the backup set that conventional backup operations would have to use:</span></span>

-   <span data-ttu-id="9186f-124">Том, содержащийся в теневой копии (даже в состоянии отказоустойчивости), по-прежнему содержит все файлы.</span><span class="sxs-lookup"><span data-stu-id="9186f-124">A volume contained in a shadow copy, even in a crash-consistent state, still contains all files.</span></span> <span data-ttu-id="9186f-125">Резервный набор данных, созданный без теневой копии, не будет содержать все файлы, открытые во время резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="9186f-125">A backup set created without a shadow copy would not contain all files open at the time of the backup.</span></span> <span data-ttu-id="9186f-126">Файлы, удерживаемые во время операции резервного копирования, исключаются из резервной копии.</span><span class="sxs-lookup"><span data-stu-id="9186f-126">Files held open at the time of the backup operation are excluded from the backup.</span></span>
-   <span data-ttu-id="9186f-127">Теневая копия тома создается за один момент времени, а не путем обхода активной файловой системы, которая обычно требует гораздо больше времени.</span><span class="sxs-lookup"><span data-stu-id="9186f-127">The shadow copy of the volume is created at one instant in time, and not by traversing an active file system, which typically requires much more time.</span></span>

<span data-ttu-id="9186f-128">Приложения в системе, не поддерживающие VSS, — текстовые редакторы и т. д., скорее всего, будут оставаться в состоянии сбоя.</span><span class="sxs-lookup"><span data-stu-id="9186f-128">Applications on a system that are not VSS-aware—word processors, editors, and so on—will likely have their files left in a crash-consistent state.</span></span> <span data-ttu-id="9186f-129">Однако приложения, поддерживающие VSS (модули записи), могут координировать свои действия, чтобы состояние их файлов в теневой копии было четко определено и согласовано.</span><span class="sxs-lookup"><span data-stu-id="9186f-129">However, VSS-aware applications (writers) can coordinate their actions so that the state of their files in the shadow copy is well defined and consistent.</span></span>

## <a name="shadow-copy-freeze-and-thaw"></a><span data-ttu-id="9186f-130">Замораживание и размораживание теневого копирования</span><span class="sxs-lookup"><span data-stu-id="9186f-130">Shadow Copy Freeze and Thaw</span></span>

<span data-ttu-id="9186f-131">Создание каждой операции теневого копирования VSS производится в скобках с помощью событий [*Freeze*](vssgloss-f.md) и [*разморозки*](vssgloss-t.md) , которые модули записи используют для помещения файлов в стабильное состояние до теневого копирования.</span><span class="sxs-lookup"><span data-stu-id="9186f-131">The creation of every VSS shadow copy operation is bracketed by [*Freeze*](vssgloss-f.md) and [*Thaw*](vssgloss-t.md) events, which writers use to put their files in a stable state prior to shadow copy.</span></span>

<span data-ttu-id="9186f-132">Наличие событий заморозки и разморозки в рамках модели VSS означает:</span><span class="sxs-lookup"><span data-stu-id="9186f-132">Having Freeze and Thaw events as part of the VSS model means:</span></span>

-   <span data-ttu-id="9186f-133">Обработка события Freeze означает, что те, кто разрабатывает модули записи, должны иметь четко разделенную точку в цикле резервного копирования, где они гарантируют, что все операции записи на диск останавливаются и что файлы находятся в четко определенном состоянии для резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="9186f-133">Handling the Freeze event means that those who are developing writers must have a clearly delineated point in the backup cycle where they ensure that all write operations to the disk are stopped and that files are in a well-defined state for backup.</span></span>
-   <span data-ttu-id="9186f-134">Обработка события разморозки предоставляет механизму записи возможность возобновления записи на диск и очистки всех временных файлов или других временных сведений о состоянии, созданных в связи с теневой копией.</span><span class="sxs-lookup"><span data-stu-id="9186f-134">Handling the Thaw event provides the mechanism for writers to resume writes to the disk and clean up any temporary files or other temporary state information that were created in association with the shadow copy.</span></span>
-   <span data-ttu-id="9186f-135">Окно по умолчанию между событиями замораживания и разморозки является коротким (обычно 60 секунд); Таким образом, может быть уменьшено фактическое прерывание любой службы, предоставляемой модулем записи.</span><span class="sxs-lookup"><span data-stu-id="9186f-135">The default window between the Freeze and Thaw events is short (typically 60 seconds); therefore, actual interruption of any service that a writer provides can be minimized.</span></span>
-   <span data-ttu-id="9186f-136">Обработка других событий (например, Препарефорснапшот), предшествующих и следующих за событиями замораживания и разморозки, соответственно, обеспечивает необходимую гибкость, позволяющую авторам выполнять сложные операции для поддержки теневых копий.</span><span class="sxs-lookup"><span data-stu-id="9186f-136">Handling of other events (such as PrepareForSnapshot) preceding and following the Freeze and Thaw events, respectively, provides the necessary flexibility to allow writers to complete complicated operations to support shadow copies.</span></span>

 

 



