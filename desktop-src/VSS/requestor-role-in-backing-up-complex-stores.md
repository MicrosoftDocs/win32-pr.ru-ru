---
description: Как и все важные операции в VSS, добавочные и разностные резервные копии потребовали тесного взаимодействия между запрашивающими стороны и модулями записи.
ms.assetid: 00391a49-8c81-4518-88a2-741ad5ee4ac3
title: Роль инициатора запроса при резервном копировании сложных хранилищ
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 197351e76b6861ee9b9d1e0589ef028c911430ed
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104080618"
---
# <a name="requester-role-in-backing-up-complex-stores"></a><span data-ttu-id="b1483-103">Роль инициатора запроса при резервном копировании сложных хранилищ</span><span class="sxs-lookup"><span data-stu-id="b1483-103">Requester Role in Backing Up Complex Stores</span></span>

<span data-ttu-id="b1483-104">Как и все важные операции в VSS, [*добавочные*](vssgloss-i.md) и [*разностные*](vssgloss-d.md) резервные копии потребовали тесного взаимодействия между запрашивающими стороны и модулями записи.</span><span class="sxs-lookup"><span data-stu-id="b1483-104">As with all important operations under VSS, [*incremental*](vssgloss-i.md) and [*differential*](vssgloss-d.md) backups require close cooperation between requesters and writers.</span></span>

## <a name="backup-type"></a><span data-ttu-id="b1483-105">Тип резервного копирования</span><span class="sxs-lookup"><span data-stu-id="b1483-105">Backup Type</span></span>

<span data-ttu-id="b1483-106">Инфраструктура обеспечивает специальную поддержку пяти типов резервных копий.</span><span class="sxs-lookup"><span data-stu-id="b1483-106">The infrastructure provides special support for five types of backup.</span></span> <span data-ttu-id="b1483-107">Они описаны ниже.</span><span class="sxs-lookup"><span data-stu-id="b1483-107">They are described as follows:</span></span>

-   <span data-ttu-id="b1483-108">Full (**\_ \_ полная резервная служба VSS**).</span><span class="sxs-lookup"><span data-stu-id="b1483-108">Full (**VSS\_BT\_FULL**).</span></span> <span data-ttu-id="b1483-109">Файлы будут архивироваться независимо от даты их последнего резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-109">Files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="b1483-110">Будет обновлен Журнал резервного копирования каждого файла, и этот тип резервного копирования можно использовать в качестве основы для добавочной или разностной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="b1483-110">The backup history of each file will be updated, and this type of backup can be used as the basis of an incremental or differential backup.</span></span> <span data-ttu-id="b1483-111">Если имеются файлы журнала, они могут быть усечены в результате резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-111">If there are log files, they may be truncated as a result of this backup.</span></span>

    <span data-ttu-id="b1483-112">Для восстановления полной резервной копии требуется только один образ резервной копии.</span><span class="sxs-lookup"><span data-stu-id="b1483-112">Restoring a full backup requires only a single backup image.</span></span>

-   <span data-ttu-id="b1483-113">Разностная (**VSS \_ BT \_ разностная**).</span><span class="sxs-lookup"><span data-stu-id="b1483-113">Differential (**VSS\_BT\_DIFFERENTIAL**).</span></span> <span data-ttu-id="b1483-114">API VSS используется, чтобы гарантировать копирование только тех файлов, которые были изменены или добавлены с момента последнего полного резервного копирования, на носитель. все промежуточные резервные копии игнорируются.</span><span class="sxs-lookup"><span data-stu-id="b1483-114">The VSS API is used to ensure that only files that have been changed or added since the last full backup are to be copied to a storage medium; all intermediate backup information is ignored.</span></span> <span data-ttu-id="b1483-115">Это могут быть целые файлы или определенные диапазоны в файлах.</span><span class="sxs-lookup"><span data-stu-id="b1483-115">This may include entire files, or specific ranges within files.</span></span> <span data-ttu-id="b1483-116">Разностная резервная копия связана с полной резервной копией и обычно не может быть восстановлена до тех пор, пока не будет восстановлена полная резервная копия.</span><span class="sxs-lookup"><span data-stu-id="b1483-116">A differential backup is associated with a full backup, and generally cannot be restored until the full backup has been restored.</span></span> <span data-ttu-id="b1483-117">Если имеются файлы журнала, они обычно не усекаются в результате резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-117">If there are log files, they will usually not be truncated as a result of this backup.</span></span>

    <span data-ttu-id="b1483-118">Для восстановления разностной резервной копии требуется исходный образ резервной копии и последняя разностная резервная копия, созданная с момента последнего полного резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-118">Restoring a differential backup requires the original backup image and the most recent differential backup image made since the last full backup.</span></span>

-   <span data-ttu-id="b1483-119">Добавочная **( \_ \_ добавочная служба VSS**).</span><span class="sxs-lookup"><span data-stu-id="b1483-119">Incremental (**VSS\_BT\_INCREMENTAL**).</span></span> <span data-ttu-id="b1483-120">API VSS используется, чтобы гарантировать копирование только тех файлов, которые были изменены или добавлены с момента последнего полного или добавочного резервного копирования, на носитель.</span><span class="sxs-lookup"><span data-stu-id="b1483-120">The VSS API is used to ensure that only files that have been changed or added since the last full or incremental backup are to be copied to a storage medium.</span></span> <span data-ttu-id="b1483-121">Это могут быть целые файлы или определенные диапазоны в файлах.</span><span class="sxs-lookup"><span data-stu-id="b1483-121">This may include entire files, or specific ranges within files.</span></span> <span data-ttu-id="b1483-122">Некоторые модули записи не позволяют смешивать добавочные резервные копии с разностными резервными копиями.</span><span class="sxs-lookup"><span data-stu-id="b1483-122">Some writers do not allow incremental backups to be mixed with differential backups.</span></span> <span data-ttu-id="b1483-123">Если имеются файлы журнала, они могут быть усечены в результате резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-123">If there are log files, they may be truncated as a result of this backup.</span></span>

    <span data-ttu-id="b1483-124">Для восстановления добавочной резервной копии требуется исходный образ резервного копирования и все добавочные образы резервных копий, созданные с момента создания исходной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="b1483-124">Restoring an incremental backup requires the original backup image and all incremental backup images made since the initial backup.</span></span>

-   <span data-ttu-id="b1483-125">Резервная копия журнала (**\_ \_ Журнал VSS BT**).</span><span class="sxs-lookup"><span data-stu-id="b1483-125">Log Backup (**VSS\_BT\_LOG**).</span></span> <span data-ttu-id="b1483-126">Будет создана резервная копия только файлов журнала модуля записи (файлов, добавленных в компонент с помощью метода [**ивсскреатевритерметадата:: адддатабаселогфилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) и получаемых путем вызова [**Ивссвмкомпонент:: жетдатабаселогфиле**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile)).</span><span class="sxs-lookup"><span data-stu-id="b1483-126">Only a writer's log files (files added to a component with the [**IVssCreateWriterMetadata::AddDataBaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) method, and retrieved by a call to [**IVssWMComponent::GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile)) will be backed up.</span></span> <span data-ttu-id="b1483-127">Этот тип резервного копирования относится только к VSS.</span><span class="sxs-lookup"><span data-stu-id="b1483-127">This backup type is specific to VSS.</span></span> <span data-ttu-id="b1483-128">Резервные копии журналов обычно выполняются довольно часто.</span><span class="sxs-lookup"><span data-stu-id="b1483-128">Log backups tend to be taken quite frequently.</span></span> <span data-ttu-id="b1483-129">Как правило, файл журнала будет усечен в результате резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-129">Typically, the log file will be truncated as a result of this backup.</span></span>
-   <span data-ttu-id="b1483-130">Копирование резервной копии (**\_ BT- \_ копия VSS**).</span><span class="sxs-lookup"><span data-stu-id="b1483-130">Copy Backup (**VSS\_BT\_COPY**).</span></span> <span data-ttu-id="b1483-131">Как и в \_ \_ случае с типом данных BT Full, резервное копирование файлов выполняется независимо от даты их последнего резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-131">Like the VSS\_BT\_FULL backup type, files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="b1483-132">Однако журнал резервного копирования каждого файла не будет обновлен, и такой тип резервного копирования нельзя использовать в качестве основы для добавочной или разностной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="b1483-132">However, the backup history of each file will not be updated, and this sort of backup cannot be used as the basis of an incremental or differential backup.</span></span> <span data-ttu-id="b1483-133">Файлы журнала никогда не следует усекать в результате резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-133">Log files should never be truncated as a result of a copy backup.</span></span>

<dl> <dt>

<span data-ttu-id="b1483-134"><span id="Partial_File_Support"></span><span id="partial_file_support"></span><span id="PARTIAL_FILE_SUPPORT"></span>Частичная поддержка файлов</span><span class="sxs-lookup"><span data-stu-id="b1483-134"><span id="Partial_File_Support"></span><span id="partial_file_support"></span><span id="PARTIAL_FILE_SUPPORT"></span>Partial File Support</span></span>
</dt> <dd>

<span data-ttu-id="b1483-135">Некоторые модули записи поддерживают восстановление файлов с помощью перезаписи частей файлов, которыми они управляют.</span><span class="sxs-lookup"><span data-stu-id="b1483-135">Some writers support file restoration through the overwriting of parts of the files they manage.</span></span> <span data-ttu-id="b1483-136">Инициатор запроса может воспользоваться преимуществами этого метода, и если да, то он указывает, что нужно установить сведения в [**ивссбаккупкомпонентс:: сетбаккупстате**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span><span class="sxs-lookup"><span data-stu-id="b1483-136">A requester may be designed to take advantage of this, and if so it indicates this by setting the information in [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span></span>

</dd> </dl>

<span data-ttu-id="b1483-137">Инициатор запроса указывает, какой тип резервного копирования выполняется с помощью параметра *BackupType* [**Ивссбаккупкомпонентс:: сетбаккупстате**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span><span class="sxs-lookup"><span data-stu-id="b1483-137">The requester specifies what type of backup is being performed through the *backupType* parameter of [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span></span> <span data-ttu-id="b1483-138">Различные модули записи поддерживают разные типы резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-138">Different writers will support different types of backup.</span></span> <span data-ttu-id="b1483-139">После вызова [**ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) инициатор запроса может определить, какие типы резервного копирования поддерживает данный модуль записи, вызвав [**Ивссексаминевритерметадата:: жетбаккупсчема**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema).</span><span class="sxs-lookup"><span data-stu-id="b1483-139">After [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) has been called, the requester can determine what types of backup a given writer supports by calling [**IVssExamineWriterMetadata::GetBackupSchema**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema).</span></span> <span data-ttu-id="b1483-140">Возвращаемое значение является битовой маской, обозначающей поддержку различных типов резервных копий.</span><span class="sxs-lookup"><span data-stu-id="b1483-140">The returned value is a bit mask indicating support for different backup types.</span></span> <span data-ttu-id="b1483-141">Служба **VSS \_ В \_ разностной** резервной копии указана поддержка разностного резервного копирования, **\_ \_ добавочного обновления VSS** для добавочного резервного копирования, **\_ \_ журнала "BS** " для резервных копий журналов и **копии " \_ BS \_ " VSS** для резервного копирования. все модули записи должны поддерживать</span><span class="sxs-lookup"><span data-stu-id="b1483-141">**VSS\_BS\_DIFFERENTIAL** indicates support for differential backups, **VSS\_BS\_INCREMENTAL** for incremental backups, **VSS\_BS\_LOG** for log backups, and **VSS\_BS\_COPY** for copy backups; all writers must support full backups.</span></span> <span data-ttu-id="b1483-142">Если модуль записи не поддерживает смешивание добавочных резервных копий с разностными резервными копиями, также будет добавлен флаг с **\_ \_ эксклюзивным \_ добавочным \_ разностным** копированием в VSS.</span><span class="sxs-lookup"><span data-stu-id="b1483-142">If a writer does not support mixing incremental backups with differential backups, the **VSS\_BS\_EXCLUSIVE\_INCREMENTAL\_DIFFERENTIAL** flag will be added as well.</span></span> <span data-ttu-id="b1483-143">Если инициатор запроса выполняет добавочную или разностную архивацию, а данный модуль записи не поддерживает этот тип резервного копирования, то для этого модуля записи должно быть выполнено полное резервное копирование.</span><span class="sxs-lookup"><span data-stu-id="b1483-143">If the requester is performing an incremental or differential backup and a given writer does not support that backup type, a full backup should be performed on that writer.</span></span>

## <a name="backup-stamps"></a><span data-ttu-id="b1483-144">Метки резервного копирования</span><span class="sxs-lookup"><span data-stu-id="b1483-144">Backup Stamps</span></span>

<span data-ttu-id="b1483-145">Добавочные и разностные резервные копии всегда привязаны к предыдущей резервной копии.</span><span class="sxs-lookup"><span data-stu-id="b1483-145">Incremental and differential backups are always tied to a previous backup.</span></span> <span data-ttu-id="b1483-146">Существует два способа привязки резервных копий.</span><span class="sxs-lookup"><span data-stu-id="b1483-146">There are two ways to tie backups.</span></span> <span data-ttu-id="b1483-147">Для простых хранилищ данных инициатор запроса может вести отслеживание корреляции между резервными копиями.</span><span class="sxs-lookup"><span data-stu-id="b1483-147">For simple data stores, the requester can keep track of the correlation between backups.</span></span> <span data-ttu-id="b1483-148">Однако для более сложных хранилищ данных модуль записи должен поддерживать собственную метку времени с помощью резервной копии. Эта метка времени может вести отслеживание расположения журнала, сведений о контрольных точках и т. д.</span><span class="sxs-lookup"><span data-stu-id="b1483-148">However, for more complex data stores, the writer will need to maintain its own timestamp with the backup; this timestamp may keep track of log position, checkpoint information, and so on.</span></span> <span data-ttu-id="b1483-149">Инициатор запроса может определить, должен ли заданный модуль записи хранить собственную метку времени, проверяя наличие бита **\_ \_ метки времени в VSS** в значении, возвращаемом функцией [**ивссексаминевритерметадата:: жетбаккупсчема**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema).</span><span class="sxs-lookup"><span data-stu-id="b1483-149">The requester can determine whether a given writer needs to store its own timestamp by checking for the **VSS\_BS\_TIMESTAMPED** bit in the value returned by [**IVssExamineWriterMetadata::GetBackupSchema**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema).</span></span>

<span data-ttu-id="b1483-150">Для модулей записи, которые хранят метку времени в резервной копии, будет добавлена метка времени при обработке [**ивссбаккупкомпонентс::P репарефорбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) или при обработке [**Ивссбаккупкомпонентс::D оснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="b1483-150">Writers that store a timestamp in a backup will add the timestamp either while processing [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) or while processing [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="b1483-151">Инициатор запроса может получить эту метку времени путем вызова [**ивсскомпонент:: жетбаккупстамп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="b1483-151">The requester can obtain this timestamp by calling [**IVssComponent::GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp).</span></span> <span data-ttu-id="b1483-152">При выполнении добавочной или разностной резервной копии инициатору запроса необходимо связать текущую резервную копию с предыдущей резервной копией.</span><span class="sxs-lookup"><span data-stu-id="b1483-152">When performing an incremental or differential backup, the requester needs to tie the current backup to some previous backup.</span></span> <span data-ttu-id="b1483-153">Для этого необходимо получить метку времени из предыдущей резервной копии определенного компонента и передать ее в функцию [**ивссбаккупкомпонентс:: сетпревиаусбаккупстамп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp) . Это необходимо сделать для каждого компонента, резервная копия которого была создана в предыдущей резервной копии.</span><span class="sxs-lookup"><span data-stu-id="b1483-153">This is done by obtaining the timestamp from the previous backup of a specific component and passing it into the [**IVssBackupComponents::SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp) function; this needs to be done for each component that was backed up in the previous backup.</span></span>

## <a name="backing-up-files"></a><span data-ttu-id="b1483-154">Резервное копирование файлов</span><span class="sxs-lookup"><span data-stu-id="b1483-154">Backing Up Files</span></span>

### <a name="backing-up-files-reported-by-writer"></a><span data-ttu-id="b1483-155">Резервное копирование файлов, сообщаемых модулем записи</span><span class="sxs-lookup"><span data-stu-id="b1483-155">Backing Up Files Reported by Writer</span></span>

<span data-ttu-id="b1483-156">Каждая спецификация файла, которую модуль записи добавляет к своим метаданным на этапе Гасервритерметадата, содержит маску типа резервной копии, которая указывает, когда следует выполнять резервное копирование файла.</span><span class="sxs-lookup"><span data-stu-id="b1483-156">Every file specification that a writer adds to its metadata during the GatherWriterMetadata phase contains a backup type mask that specifies when the file should be backed up.</span></span> <span data-ttu-id="b1483-157">Инициатор запроса определяет, что это за маску, вызывая [**ивссвмфиледеск:: жетбаккуптипемаск**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getbackuptypemask).</span><span class="sxs-lookup"><span data-stu-id="b1483-157">The requester determines what this mask is by calling [**IVssWMFiledesc::GetBackupTypeMask**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getbackuptypemask).</span></span> <span data-ttu-id="b1483-158">Значения в этой маске используются, чтобы определить, для каких типов резервного копирования необходимо создать резервную копию спецификации файла.</span><span class="sxs-lookup"><span data-stu-id="b1483-158">The values in this mask are used to determine for which backup types the file specification needs to be backed up.</span></span> <span data-ttu-id="b1483-159">Маска может содержать одно или несколько следующих битовых значений:</span><span class="sxs-lookup"><span data-stu-id="b1483-159">The mask can contain one or more of the following bit values:</span></span>

<dl> <dt>

<span data-ttu-id="b1483-160"><span id="VSS_FSBT_FULL_BACKUP_REQUIRED"></span><span id="vss_fsbt_full_backup_required"></span>**\_ \_ \_ требуется полная резервная копия VSS фсбт \_**</span><span class="sxs-lookup"><span data-stu-id="b1483-160"><span id="VSS_FSBT_FULL_BACKUP_REQUIRED"></span><span id="vss_fsbt_full_backup_required"></span>**VSS\_FSBT\_FULL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="b1483-161">Требуется для полных резервных копий.</span><span class="sxs-lookup"><span data-stu-id="b1483-161">Required for full backups.</span></span>

</dd> <dt>

<span data-ttu-id="b1483-162"><span id="VSS_FSBT_DIFFERENTIAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_differential_backup_required"></span>**\_ \_ требуется разностное \_ резервное копирование VSS фсбт \_**</span><span class="sxs-lookup"><span data-stu-id="b1483-162"><span id="VSS_FSBT_DIFFERENTIAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_differential_backup_required"></span>**VSS\_FSBT\_DIFFERENTIAL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="b1483-163">Требуется для разностного резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-163">Required for differential backups.</span></span>

</dd> <dt>

<span data-ttu-id="b1483-164"><span id="VSS_FSBT_INCREMENTAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_incremental_backup_required"></span>**\_ \_ требуется добавочное \_ резервное копирование VSS фсбт \_**</span><span class="sxs-lookup"><span data-stu-id="b1483-164"><span id="VSS_FSBT_INCREMENTAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_incremental_backup_required"></span>**VSS\_FSBT\_INCREMENTAL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="b1483-165">Требуется для добавочного резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-165">Required for incremental backups.</span></span>

</dd> <dt>

<span data-ttu-id="b1483-166"><span id="VSS_FSBT_LOG_BACKUP_REQUIRED"></span><span id="vss_fsbt_log_backup_required"></span>**\_ \_ \_ требуется резервная копия журнала фсбт для VSS \_**</span><span class="sxs-lookup"><span data-stu-id="b1483-166"><span id="VSS_FSBT_LOG_BACKUP_REQUIRED"></span><span id="vss_fsbt_log_backup_required"></span>**VSS\_FSBT\_LOG\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="b1483-167">Требуется для резервного копирования журнала.</span><span class="sxs-lookup"><span data-stu-id="b1483-167">Required for log backups.</span></span>

</dd> <dt>

<span data-ttu-id="b1483-168"><span id="VSS_FSBT_ALL_BACKUP_REQUIRED"></span><span id="vss_fsbt_all_backup_required"></span>**\_ФСБТ VSS \_ \_ требуется вся резервная копия \_**</span><span class="sxs-lookup"><span data-stu-id="b1483-168"><span id="VSS_FSBT_ALL_BACKUP_REQUIRED"></span><span id="vss_fsbt_all_backup_required"></span>**VSS\_FSBT\_ALL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="b1483-169">Требуется для всех типов резервных копий; Это значение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="b1483-169">Required for all backup types; this is the default.</span></span>

</dd> </dl>

<span data-ttu-id="b1483-170">Эта спецификация переопределяет спецификацию селективности компонента.</span><span class="sxs-lookup"><span data-stu-id="b1483-170">This specification overrides the component's selectivity specification.</span></span> <span data-ttu-id="b1483-171">Например, рассмотрим компонент, файлы которого все помечены с помощью **\_ \_ \_ резервной копии журнала \_ фсбт VSS** , но **не \_ \_ требуются для полной \_ резервной копии \_ фсбт VSS**.</span><span class="sxs-lookup"><span data-stu-id="b1483-171">For example, consider a component whose files are all marked with **VSS\_FSBT\_LOG\_BACKUP\_REQUIRED** but not with **VSS\_FSBT\_FULL\_BACKUP\_REQUIRED**.</span></span> <span data-ttu-id="b1483-172">Предположим, этот компонент не может быть выбран для резервного копирования (*бселектабле* был ложным при вызове [**Ивсскреатевритерметадата:: AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) ).</span><span class="sxs-lookup"><span data-stu-id="b1483-172">Suppose this component is not selectable for backup (*bSelectable* was false when [**IVssCreateWriterMetadata::AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) was called).</span></span> <span data-ttu-id="b1483-173">В случае резервного копирования журнала это означает, что все файлы в этом компоненте всегда должны быть резервными копиями.</span><span class="sxs-lookup"><span data-stu-id="b1483-173">In the case of a log backup, this means that all the files in this component must always be backed up.</span></span> <span data-ttu-id="b1483-174">Однако в случае полного резервного копирования ни один из файлов не нуждается в резервном копировании, несмотря на тот факт, что избирательность компонента требует резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-174">However, in the case of a full backup, none of the files need to be backed up, despite the fact that the component's selectivity implies it should be backed up.</span></span>

### <a name="backup-by-last-modify-time"></a><span data-ttu-id="b1483-175">Резервное копирование по времени последнего изменения</span><span class="sxs-lookup"><span data-stu-id="b1483-175">Backup by Last Modify Time</span></span>

<span data-ttu-id="b1483-176">Сведения о спецификации файла, указанные на этапе [**ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) , не предоставляют запрашивающей стороне сведения об изменениях с момента последнего резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-176">The file specification information specified in the [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) phase does not give the requester information about what has changed since the last backup.</span></span> <span data-ttu-id="b1483-177">Один из способов, с помощью которого модуль записи указывает изменения в инициаторе запроса, — использование механизма сравнения файлов.</span><span class="sxs-lookup"><span data-stu-id="b1483-177">One way for a writer to indicate changes to the requester is by using the differenced file mechanism.</span></span> <span data-ttu-id="b1483-178">Модуль записи может указать, что необходимо архивировать определенные файлы компонента, только если они были изменены с момента определенного времени; модуль записи может указывать эти файлы либо в [**ивссбаккупкомпонентс::P репарефорбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) , либо в [**Ивссбаккупкомпонентс::D оснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="b1483-178">A writer can specify that certain files in a component should be backed up only if they have been modified since a certain time; the writer may specify these files either in [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) or in [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="b1483-179">Инициатор запроса может определить эти файлы, вызвав [**ивсскомпонент:: жетдифференцедфилескаунт**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdifferencedfilescount) и [**Ивсскомпонент:: жетдифференцедфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdifferencedfile).</span><span class="sxs-lookup"><span data-stu-id="b1483-179">A requester can determine these files by calling [**IVssComponent::GetDifferencedFilesCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdifferencedfilescount) and [**IVssComponent::GetDifferencedFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdifferencedfile).</span></span> <span data-ttu-id="b1483-180">Если спецификация файла соответствует одному набору в **ивссбаккупкомпонентс:: гасервритерметадата** (который в настоящее время является допустимым на основе маски типа резервной копии), то сведения о различиях в файле переопределяют предыдущую информацию. то есть файлы, соответствующие спецификации файла, теперь архивируются только в том случае, если они были изменены с момента указанного времени.</span><span class="sxs-lookup"><span data-stu-id="b1483-180">If the file specification matches one set in **IVssBackupComponents::GatherWriterMetadata** (that is currently valid based on the backup type mask) the differenced file information overrides the previous information; that is, the files matching that file specification are now backed up only if they have been modified since the specified time.</span></span> <span data-ttu-id="b1483-181">Время последнего изменения передается с помощью структуры [**fileTime**](/windows/win32/api/minwinbase/ns-minwinbase-filetime) .</span><span class="sxs-lookup"><span data-stu-id="b1483-181">The last-modify time is communicated using a [**FILETIME**](/windows/win32/api/minwinbase/ns-minwinbase-filetime) structure.</span></span> <span data-ttu-id="b1483-182">Если значение этой структуры равно нулю, это означает, что время последнего изменения должно быть определено на основе записи времени последнего резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-182">If the value of this structure is zero, this implies that the last-modify time should be determined based on the requester's record of the time of last backup.</span></span>

### <a name="partial-file-backup"></a><span data-ttu-id="b1483-183">Частичная Архивация файлов</span><span class="sxs-lookup"><span data-stu-id="b1483-183">Partial File Backup</span></span>

<span data-ttu-id="b1483-184">Другой способ, позволяющий модулю записи указать изменения в инициаторе запроса, — использовать частичный механизм файлов.</span><span class="sxs-lookup"><span data-stu-id="b1483-184">Another way for a writer to indicate changes to the requester is by using the partial file mechanism.</span></span> <span data-ttu-id="b1483-185">Модуль записи может указывать диапазоны байтов в файлах компонентов, для которых необходимо создать резервную копию; модуль записи может указывать эти диапазоны файлов либо в [**ивссбаккупкомпонентс::P репарефорбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) , либо в [**Ивссбаккупкомпонентс::D оснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="b1483-185">A writer can specify byte ranges within component files that need to be backed up; the writer can specify these file ranges either in [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) or in [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="b1483-186">Инициатор запроса может определить эти файлы, вызвав [**ивсскомпонент:: жетпартиалфилекаунт**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfilecount) и [**Ивсскомпонент:: жетпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile).</span><span class="sxs-lookup"><span data-stu-id="b1483-186">A requester can determine these files by calling [**IVssComponent::GetPartialFileCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfilecount) and [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile).</span></span> <span data-ttu-id="b1483-187">**Ивсскомпонент:: жетпартиалфиле** будет возвращать путь и имя файла, указывающие на файл, и строку диапазонов, указывающую, что необходимо архивировать в файле.</span><span class="sxs-lookup"><span data-stu-id="b1483-187">**IVssComponent::GetPartialFile** will return a path and a file name pointing to the file, and a ranges string indicating what needs to be backed up in the file.</span></span> <span data-ttu-id="b1483-188">Как и в случае с различными файлами, если путь и имя файла соответствуют спецификации файла, заданной модулем записи в [**ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), сведения о частичном файле переопределяют предыдущий параметр.</span><span class="sxs-lookup"><span data-stu-id="b1483-188">As with differenced files, if the path and file name matches a file specification set by the writer in [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), the partial-file information overrides the previous setting.</span></span> <span data-ttu-id="b1483-189">Строка Ranges может иметь два формата: она может либо указать диапазоны напрямую, либо указать файл, содержащий сведения о диапазонах.</span><span class="sxs-lookup"><span data-stu-id="b1483-189">The ranges string can have two formats: it can either specify the ranges directly, or it can specify a file containing ranges information.</span></span> <span data-ttu-id="b1483-190">Если указать диапазоны напрямую, синтаксис представляет собой разделенный запятыми список в формате offset1: length1, offset2: length2, где каждое смещение и длина представляют собой 64-разрядное целое число без знака.</span><span class="sxs-lookup"><span data-stu-id="b1483-190">If specifying ranges directly, the syntax is a comma-separated list of the form offset1:length1, offset2:length2, where each offset and length is a 64-bit unsigned integer.</span></span> <span data-ttu-id="b1483-191">При указании файла диапазонов необходимо задать для строки Ranges значение File = *filename*, где *filename* — это полный путь к файлу Ranges.</span><span class="sxs-lookup"><span data-stu-id="b1483-191">If specifying a ranges file, the ranges string should be set to File= *filename*, where *filename* is the full path to the ranges file.</span></span> <span data-ttu-id="b1483-192">Сам файл Ranges представляет собой двоичный файл, отформатированный как список из 64-разрядных целых чисел без знака.</span><span class="sxs-lookup"><span data-stu-id="b1483-192">The ranges file itself is a binary file that is formatted as a list of 64-bit unsigned integers.</span></span> <span data-ttu-id="b1483-193">Первое целое число указывает, сколько диапазонов представлено в файле.</span><span class="sxs-lookup"><span data-stu-id="b1483-193">The first integer indicates how many ranges are represented in the file.</span></span> <span data-ttu-id="b1483-194">Каждая последующая пара целых чисел представляет смещение и длину диапазона.</span><span class="sxs-lookup"><span data-stu-id="b1483-194">Each subsequent pair of integers represents the offset and length of a range.</span></span> <span data-ttu-id="b1483-195">Инициатору запроса необходимо также выполнить резервное копирование и восстановление этого файла Ranges.</span><span class="sxs-lookup"><span data-stu-id="b1483-195">The requester must take care to back up and restore this ranges file as well.</span></span>

### <a name="file-specification-rules"></a><span data-ttu-id="b1483-196">Правила спецификации файла</span><span class="sxs-lookup"><span data-stu-id="b1483-196">File Specification Rules</span></span>

<span data-ttu-id="b1483-197">Спецификации файлов, добавленные с помощью механизмов сравнения и частичного файла, либо изменяют спецификации файлов, заданные в [**ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) , либо добавляют совершенно новые файлы.</span><span class="sxs-lookup"><span data-stu-id="b1483-197">File specifications added through the differenced-file and the partial-file mechanisms will either modify file specifications set in [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) or add completely new files.</span></span> <span data-ttu-id="b1483-198">Если при изменении спецификаций файлов, заданных в **ивссбаккупкомпонентс:: гасервритерметадата** с помощью механизма частичного файла, запрашивающая сторона может заждать, что спецификация файла будет точно соответствовать одной из спецификаций файлов, заданных в компоненте в **Ивссбаккупкомпонентс:: гасервритерметадата**.</span><span class="sxs-lookup"><span data-stu-id="b1483-198">If modifying files specifications set in **IVssBackupComponents::GatherWriterMetadata** using the partial-file mechanism, then a requester can expect the file specification to exactly match one of the file specifications set in the component in **IVssBackupComponents::GatherWriterMetadata**.</span></span> <span data-ttu-id="b1483-199">Спецификация файла не будет частично перекрываться с другой спецификацией файла и не будет соответствовать спецификациям файлов в других компонентах этого модуля.</span><span class="sxs-lookup"><span data-stu-id="b1483-199">The file specification will not partially overlap another file specification, and it will not match any file specifications in any other of that writer's components.</span></span> <span data-ttu-id="b1483-200">Однако спецификации файлов, добавленные с помощью механизма частичного файла, могут частично перекрывать другую спецификацию файла.</span><span class="sxs-lookup"><span data-stu-id="b1483-200">File specifications added using the partial-file mechanism can, however, partially overlap another file specification.</span></span> <span data-ttu-id="b1483-201">Если это так, то спецификация Difference-File или partial-File переопределяет спецификацию, заданную в **ивссбаккупкомпонентс:: гасервритерметадата**.</span><span class="sxs-lookup"><span data-stu-id="b1483-201">When this is true, the differenced-file or partial-file specification overrides the specification set in **IVssBackupComponents::GatherWriterMetadata**.</span></span> <span data-ttu-id="b1483-202">Общие спецификации файлов могут иметь значение альтернативного расположения (возвращаемое функцией [**ивссвмфиледеск:: жеталтернателокатион**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation)), которое указывает на альтернативное место для получения файла во время резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-202">General file specifications can have an alternate-location value (returned by [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation)) that indicates an alternate place to obtain the file from at backup time.</span></span> <span data-ttu-id="b1483-203">Если спецификации файлов, заданные с помощью механизма Difference-File или частичного файла, соответствуют существующей спецификации файлов с альтернативным расположением, данные должны быть получены из этого альтернативного расположения.</span><span class="sxs-lookup"><span data-stu-id="b1483-203">If the file specifications set through the differenced-file or partial file mechanisms match an existing files specification that has an alternate location, the data should be picked up from this alternate location.</span></span> <span data-ttu-id="b1483-204">Если спецификации файлов, заданные с помощью механизмов Difference-File или partial-File, не соответствуют ни одной из существующих спецификаций для компонента, то эти диапазоны файлов теперь должны быть добавлены в резервную копию.</span><span class="sxs-lookup"><span data-stu-id="b1483-204">If the file specifications set through the differenced-file or partial-file mechanisms do not match any existing specifications for the component, then these file ranges should now be added to the backup.</span></span> <span data-ttu-id="b1483-205">Инициатор запроса может предполагать, что только файлы на томах, которые уже были включены в набор теневых копий, будут добавлены с помощью одного из этих механизмов.</span><span class="sxs-lookup"><span data-stu-id="b1483-205">The requester can expect that only files on volumes that have already been included in the shadow copy set will be added using one of these mechanisms.</span></span>

### <a name="backup-without-a-shadow-copy"></a><span data-ttu-id="b1483-206">Резервное копирование без теневой копии</span><span class="sxs-lookup"><span data-stu-id="b1483-206">Backup without a Shadow Copy</span></span>

<span data-ttu-id="b1483-207">Для некоторых типов файлов резервное копирование тома теневой копии может не требоваться.</span><span class="sxs-lookup"><span data-stu-id="b1483-207">Certain types of files may not need to be backed up off of a shadow copy volume.</span></span> <span data-ttu-id="b1483-208">Например, это часто справедливо для файлов журнала базы данных.</span><span class="sxs-lookup"><span data-stu-id="b1483-208">For example, this will often be true of database log files.</span></span> <span data-ttu-id="b1483-209">Так как файлы журналов увеличиваются монотонно, и модуль записи может указать, какие части файла нужно архивировать с помощью частичных файлов, можно создать резервную копию журнала, который будет находиться на исходном томе.</span><span class="sxs-lookup"><span data-stu-id="b1483-209">Since log files grow monotonically, and a writer can specify exactly what portions of the file to back up using partial files, it will often be possible to backup the log off the original volume.</span></span> <span data-ttu-id="b1483-210">В качестве оптимизации модуль записи может отметить, какие файлы нуждаются в теневых копиях для различных типов резервного копирования, используя маску типа резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-210">As an optimization, a writer can mark which files require shadow copies for different backup types using the backup-type mask.</span></span> <span data-ttu-id="b1483-211">Значение, возвращаемое из [**ивссвмфиледеск:: жетбаккуптипемаск**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getbackuptypemask) , может содержать одно или несколько из следующих битовых значений:</span><span class="sxs-lookup"><span data-stu-id="b1483-211">The value returned from [**IVssWMFiledesc::GetBackupTypeMask**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getbackuptypemask) can contain one or more of the following bit values:</span></span>

<dl> <dt>

<span data-ttu-id="b1483-212"><span id="VSS_FSBT_FULL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_full_snapshot_required"></span>**\_ \_ \_ требуется полный моментальный снимок VSS фсбт \_**</span><span class="sxs-lookup"><span data-stu-id="b1483-212"><span id="VSS_FSBT_FULL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_full_snapshot_required"></span>**VSS\_FSBT\_FULL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="b1483-213">Для полных резервных копий требуется теневая копия.</span><span class="sxs-lookup"><span data-stu-id="b1483-213">Shadow copy required for full backups.</span></span>

</dd> <dt>

<span data-ttu-id="b1483-214"><span id="VSS_FSBT_DIFFERENTIAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_differential_snapshot_required"></span>**\_ \_ требуется разностный \_ моментальный снимок VSS фсбт \_**</span><span class="sxs-lookup"><span data-stu-id="b1483-214"><span id="VSS_FSBT_DIFFERENTIAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_differential_snapshot_required"></span>**VSS\_FSBT\_DIFFERENTIAL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="b1483-215">Для разностного резервного копирования требуется теневая копия.</span><span class="sxs-lookup"><span data-stu-id="b1483-215">Shadow copy required for differential backups.</span></span>

</dd> <dt>

<span data-ttu-id="b1483-216"><span id="VSS_FSBT_INCREMENTAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_incremental_snapshot_required"></span>**\_ \_ требуется добавочный \_ моментальный снимок VSS фсбт \_**</span><span class="sxs-lookup"><span data-stu-id="b1483-216"><span id="VSS_FSBT_INCREMENTAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_incremental_snapshot_required"></span>**VSS\_FSBT\_INCREMENTAL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="b1483-217">Для добавочного резервного копирования требуется теневое копирование.</span><span class="sxs-lookup"><span data-stu-id="b1483-217">Shadow copy required for incremental backups.</span></span>

</dd> <dt>

<span data-ttu-id="b1483-218"><span id="VSS_FSBT_LOG_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_log_snapshot_required"></span>**\_ \_ \_ требуется моментальный снимок журнала фсбт для VSS \_**</span><span class="sxs-lookup"><span data-stu-id="b1483-218"><span id="VSS_FSBT_LOG_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_log_snapshot_required"></span>**VSS\_FSBT\_LOG\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="b1483-219">Для резервного копирования журналов требуется теневая копия.</span><span class="sxs-lookup"><span data-stu-id="b1483-219">Shadow copy required for log backups.</span></span>

</dd> <dt>

<span data-ttu-id="b1483-220"><span id="VSS_FSBT_ALL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_all_snapshot_required"></span>**\_ \_ \_ требуется моментальный снимок фсбт для VSS \_**</span><span class="sxs-lookup"><span data-stu-id="b1483-220"><span id="VSS_FSBT_ALL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_all_snapshot_required"></span>**VSS\_FSBT\_ALL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="b1483-221">Для всех типов резервных копий требуется теневая копия; Это значение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="b1483-221">Shadow copy required for all backup types; this is the default.</span></span>

</dd> </dl>

<span data-ttu-id="b1483-222">Если конкретный том содержит только те компоненты, для которых не требуется теневая копия для этой резервной копии, инициатор запроса может пропустить шаг создания теневой копии для этого тома.</span><span class="sxs-lookup"><span data-stu-id="b1483-222">If a specific volume contains only components that do not require a shadow copy for this backup, the requester can skip the step of creating a shadow copy for this volume.</span></span> <span data-ttu-id="b1483-223">Все данные на этом томе можно скопировать на носитель резервной копии непосредственно из исходного тома.</span><span class="sxs-lookup"><span data-stu-id="b1483-223">All the data on this volume can be copied to the backup media directly from the original volume.</span></span>

## <a name="restoring-files"></a><span data-ttu-id="b1483-224">Восстановление файлов</span><span class="sxs-lookup"><span data-stu-id="b1483-224">Restoring Files</span></span>

### <a name="sequential-restores"></a><span data-ttu-id="b1483-225">Последовательные восстановления</span><span class="sxs-lookup"><span data-stu-id="b1483-225">Sequential Restores</span></span>

<span data-ttu-id="b1483-226">После выполнения операции восстановления инициатор запроса отправляет событие, выполняемое при восстановлении, во все модули записи.</span><span class="sxs-lookup"><span data-stu-id="b1483-226">After the requester is done performing a restore operation, it sends the PostRestore event to all writers.</span></span> <span data-ttu-id="b1483-227">Как правило, модули записи обрабатывали это событие, выполняя восстановление или другие операции, выполняемые после восстановления.</span><span class="sxs-lookup"><span data-stu-id="b1483-227">Generally, writers handle this event by performing recovery or other post-restore operations.</span></span> <span data-ttu-id="b1483-228">Однако восстановление добавочных резервных копий обычно происходит в виде последовательности операций восстановления, по одному на добавочное резервное копирование.</span><span class="sxs-lookup"><span data-stu-id="b1483-228">Restoration of incremental backups, however, usually happen as a sequence of restore operations, one per incremental backup.</span></span> <span data-ttu-id="b1483-229">Инициатору запроса необходимо сообщить средству записи о том, что выполняется такое восстановление, чтобы предотвратить восстановление или другие нежелательные операции до полного завершения восстановления.</span><span class="sxs-lookup"><span data-stu-id="b1483-229">The requester needs to inform the writer that such a restoration is in progress in order to prevent recovery or other undesirable operations from happening until the restore is completely done.</span></span> <span data-ttu-id="b1483-230">Это делается путем вызова [**ивссбаккупкомпонентс:: сетаддитионалресторес**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores).</span><span class="sxs-lookup"><span data-stu-id="b1483-230">This is done by calling [**IVssBackupComponents::SetAdditionalRestores**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores).</span></span> <span data-ttu-id="b1483-231">Этот метод вызывается для каждого компонента и указывает средству записи, что для этого компонента поступают дополнительные восстановления.</span><span class="sxs-lookup"><span data-stu-id="b1483-231">This method is called per component, and indicates to the writer that more restores are coming for that component.</span></span> <span data-ttu-id="b1483-232">Для окончательного восстановления в последовательности флагу дополнительных восстановлений следует присвоить значение false (по умолчанию), которое указывает, что это последнее восстановление в последовательности для этого компонента.</span><span class="sxs-lookup"><span data-stu-id="b1483-232">For the final restore in the sequence, the additional-restores flag should be set to false (its default value), which indicates that this is the last restore in the sequence for that component.</span></span>

### <a name="new-targets"></a><span data-ttu-id="b1483-233">Новые цели</span><span class="sxs-lookup"><span data-stu-id="b1483-233">New Targets</span></span>

<span data-ttu-id="b1483-234">Если поддерживается модулем записи, инициатор запроса может восстановить файлы данных в расположении, отличном от исходного расположения времени резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1483-234">If supported by the writer, the requester can restore data files to a location other than the original backup-time location.</span></span> <span data-ttu-id="b1483-235">Инициатор запроса может проверить эту поддержку, вызвав [**ивссексаминевритерметадата:: жетбаккупсчема**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema).</span><span class="sxs-lookup"><span data-stu-id="b1483-235">The requester can check for this support by calling [**IVssExamineWriterMetadata::GetBackupSchema**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema).</span></span> <span data-ttu-id="b1483-236">**\_ Модуль записи "BS" VSS \_ \_ поддерживает \_ новый \_ целевой** бит, если модуль записи поддерживает такое поведение.</span><span class="sxs-lookup"><span data-stu-id="b1483-236">The **VSS\_BS\_WRITER\_SUPPORTS\_NEW\_TARGET** bit will be set if the writer supports this behavior.</span></span> <span data-ttu-id="b1483-237">Инициатор запроса информирует средство записи о новом расположении, вызывая [**ивссбаккупкомпонентс:: аддневтаржет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget) для каждой переходящей спецификации файла.</span><span class="sxs-lookup"><span data-stu-id="b1483-237">The requester informs the writer of the new location by calling [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget) for each relocated file specification.</span></span> <span data-ttu-id="b1483-238">Инициатор запроса может также решить восстановить заданный файл диапазонов в другом расположении.</span><span class="sxs-lookup"><span data-stu-id="b1483-238">The requester can also decide to restore a specific ranges file to a different location.</span></span> <span data-ttu-id="b1483-239">Инициатор запроса информирует средство записи об этом изменении, вызывая [**ивссбаккупкомпонентс:: сетранжесфилепас**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrangesfilepath).</span><span class="sxs-lookup"><span data-stu-id="b1483-239">The requester informs the writer of this change by calling [**IVssBackupComponents::SetRangesFilePath**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrangesfilepath).</span></span>

### <a name="directed-targets"></a><span data-ttu-id="b1483-240">Направленные целевые объекты</span><span class="sxs-lookup"><span data-stu-id="b1483-240">Directed Targets</span></span>

<span data-ttu-id="b1483-241">Для сложных сценариев восстановления разработчику может потребоваться сопоставлять диапазоны резервного файла с различными диапазонами того же или другого файла.</span><span class="sxs-lookup"><span data-stu-id="b1483-241">For complicated restore scenarios, a writer may want to map ranges of a backed-up file onto different ranges of the same or a different file.</span></span> <span data-ttu-id="b1483-242">Это можно сделать с помощью направленного целевого механизма.</span><span class="sxs-lookup"><span data-stu-id="b1483-242">This can be done by using the directed target mechanism.</span></span> <span data-ttu-id="b1483-243">Инициатор запроса может определить после этапа повторного [**восстановления ивссбаккупкомпонентс::P**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) , что этот механизм используется для компонента путем вызова [**Ивсскомпонент:: жетресторетаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoretarget) и проверки возврата **службы VSS \_ RT \_**.</span><span class="sxs-lookup"><span data-stu-id="b1483-243">The requester can determine after the [**IVssBackupComponents::PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) phase that this mechanism is being used for a component by calling [**IVssComponent::GetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoretarget) and checking for a return of **VSS\_RT\_DIRECTED**.</span></span> <span data-ttu-id="b1483-244">Инициатор запроса может по сравнению с получением всех этих перенаправленных восстановлений путем вызова [**ивсскомпонент:: жетдиректедтаржеткаунт**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) и [**Ивсскомпонент:: жетдиректедтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget).</span><span class="sxs-lookup"><span data-stu-id="b1483-244">The requester can than obtain all of these redirected restores by calling [**IVssComponent::GetDirectedTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) and [**IVssComponent::GetDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget).</span></span> <span data-ttu-id="b1483-245">**Ивсскомпонент:: жетдиректедтаржет** будет возвращать полный путь к исходному файлу в резервной копии и полный путь к целевому файлу, который будет восстановлен.</span><span class="sxs-lookup"><span data-stu-id="b1483-245">**IVssComponent::GetDirectedTarget** will return a full path to a source file on the backup and a full path to a destination file that will be restored to.</span></span> <span data-ttu-id="b1483-246">Он также возвращает список диапазонов для каждого из этих файлов.</span><span class="sxs-lookup"><span data-stu-id="b1483-246">It also returns a ranges list for each of these files.</span></span> <span data-ttu-id="b1483-247">Затем инициатор запроса отвечает за восстановление указанных диапазонов в исходном файле на сопоставленные диапазоны в целевом файле.</span><span class="sxs-lookup"><span data-stu-id="b1483-247">The requester is then responsible for restoring the specified ranges in the source file to the mapped ranges in the destination file.</span></span> <span data-ttu-id="b1483-248">Формат строки диапазонов такой же, как и в [**ивсскомпонент:: жетпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile).</span><span class="sxs-lookup"><span data-stu-id="b1483-248">The format of the ranges string is the same as in [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile).</span></span>

-   [<span data-ttu-id="b1483-249">Роль модуля записи в добавочных и разностных резервных копиях VSS</span><span class="sxs-lookup"><span data-stu-id="b1483-249">Writer Role in VSS Incremental and Differential Backups</span></span>](writer-role-in-vss-incremental-and-differential-backups.md)
-   [<span data-ttu-id="b1483-250">Роль инициатора запроса в добавочных и разностных резервных копиях VSS</span><span class="sxs-lookup"><span data-stu-id="b1483-250">Requester Role in VSS Incremental and Differential Backups</span></span>](requestor-role-in-vss-incremental-and-differential-backups.md)

 

 
