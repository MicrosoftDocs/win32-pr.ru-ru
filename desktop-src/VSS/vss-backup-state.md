---
description: 'Во время операции резервного копирования инициатор запроса использует Ивссбаккупкомпонентс:: Сетбаккупстате для определения типа выполняемой операции.'
ms.assetid: 43dcdac7-ed8e-4150-83eb-585e0e92f13c
title: Состояние резервного копирования VSS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e9aa9250139aee9f48f9880fd4a657fa7c6c4991
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103809826"
---
# <a name="vss-backup-state"></a><span data-ttu-id="0c408-103">Состояние резервного копирования VSS</span><span class="sxs-lookup"><span data-stu-id="0c408-103">VSS Backup State</span></span>

<span data-ttu-id="0c408-104">Во время операции резервного копирования инициатор запроса использует [**ивссбаккупкомпонентс:: сетбаккупстате**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate) для определения типа выполняемой операции.</span><span class="sxs-lookup"><span data-stu-id="0c408-104">During a backup operation, the requester uses [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate) to define the type of operation in progress.</span></span>

<span data-ttu-id="0c408-105">Эта информация не включается в форму с простым извлечением в документе компоненты резервного копирования, поэтому разработчики инициаторов должны хранить эти сведения отдельно на любом носителе резервных копий.</span><span class="sxs-lookup"><span data-stu-id="0c408-105">This information is not included in an easily retrievable form in the Backup Components Document, so requester developers should store this information independently on any backup media.</span></span>

<span data-ttu-id="0c408-106">Состояние резервного копирования содержит следующее:</span><span class="sxs-lookup"><span data-stu-id="0c408-106">The backup state contains the following:</span></span>

<dl> <dt>

<span data-ttu-id="0c408-107"><span id="Backup_Type"></span><span id="backup_type"></span><span id="BACKUP_TYPE"></span>Тип резервного копирования</span><span class="sxs-lookup"><span data-stu-id="0c408-107"><span id="Backup_Type"></span><span id="backup_type"></span><span id="BACKUP_TYPE"></span>Backup Type</span></span>
</dt> <dd>

<span data-ttu-id="0c408-108">Тип резервного копирования задает критерии для идентификации файлов для резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="0c408-108">The backup type specifies criteria for identifying files to be backed up.</span></span> <span data-ttu-id="0c408-109">Оценка этих критериев должна выполняться с помощью API VSS.</span><span class="sxs-lookup"><span data-stu-id="0c408-109">The evaluation of these criteria must be made using the VSS API.</span></span>

<span data-ttu-id="0c408-110">При принятии решения о типе резервной копии и о том, какие модули записи будут работать, запрашивающие стороны должны проанализировать типы (или схемы — см. раздел [поддержка схемы резервного копирования](writer-backup-schema-support.md)) операций резервного копирования, которые поддерживает каждый из модулей записи системы.</span><span class="sxs-lookup"><span data-stu-id="0c408-110">When deciding on the type of backup to pursue and which writers to work with, requesters should examine the kinds (or schemas—see [Writer Backup Schema Support](writer-backup-schema-support.md)) of backup operations that each of the system's writers supports.</span></span> <span data-ttu-id="0c408-111">Резервные копии в VSS могут иметь следующие типы:</span><span class="sxs-lookup"><span data-stu-id="0c408-111">Backups under VSS can be the following types:</span></span>

-   <span data-ttu-id="0c408-112">Full ( \_ \_ полная очистка VSS) — файлы будут архивироваться независимо от даты последнего резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="0c408-112">Full (VSS\_BT\_FULL)—files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="0c408-113">Будет обновлен Журнал резервного копирования каждого файла, и этот тип резервного копирования можно использовать в качестве основы для добавочной или разностной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="0c408-113">The backup history of each file will be updated, and this type of backup can be used as the basis of an incremental or differential backup.</span></span> <span data-ttu-id="0c408-114">Для восстановления полной резервной копии требуется только один образ резервной копии.</span><span class="sxs-lookup"><span data-stu-id="0c408-114">Restoring a full backup requires only a single backup image.</span></span>
-   <span data-ttu-id="0c408-115">Копировать резервную копию \_ ( \_ в виде BT-копии VSS), как и в \_ случае с типом "BT-полная резервная копия VSS" \_ , резервное копирование файлов выполняется независимо от даты последнего резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="0c408-115">Copy Backup (VSS\_BT\_COPY)—like the VSS\_BT\_FULL backup type, files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="0c408-116">Однако журнал резервного копирования каждого файла не будет обновлен, и такой тип резервного копирования нельзя использовать в качестве основы для добавочной или разностной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="0c408-116">However, the backup history of each file will not be updated, and this sort of backup cannot be used as the basis of an incremental or differential backup.</span></span>
-   <span data-ttu-id="0c408-117">Добавочная ( \_ \_ добавочная служба VSS) — API VSS используется, чтобы гарантировать копирование только тех файлов, которые были изменены или добавлены с момента последнего полного или добавочного резервного копирования на носитель.</span><span class="sxs-lookup"><span data-stu-id="0c408-117">Incremental (VSS\_BT\_INCREMENTAL)—the VSS API is used to ensure that only files that have been changed or added since the last full or incremental backup are to be copied to a storage medium.</span></span> <span data-ttu-id="0c408-118">Для восстановления добавочной резервной копии требуется исходный образ резервного копирования и все добавочные образы резервных копий, созданные с момента создания исходной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="0c408-118">Restoring an incremental backup requires the original backup image and all incremental backup images made since the initial backup.</span></span>
-   <span data-ttu-id="0c408-119">Разностная (VSS \_ BT \_ разностная) — API VSS используется, чтобы гарантировать копирование только тех файлов, которые были изменены или добавлены с момента последнего полного резервного копирования, на носитель. все промежуточные данные резервных копий игнорируются.</span><span class="sxs-lookup"><span data-stu-id="0c408-119">Differential (VSS\_BT\_DIFFERENTIAL)—the VSS API is used to ensure that only files that have been changed or added since the last full backup are to be copied to a storage media; all intermediate backup information is ignored.</span></span> <span data-ttu-id="0c408-120">Для восстановления разностной резервной копии требуется исходный образ резервной копии и последняя разностная резервная копия, созданная с момента последнего полного резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="0c408-120">Restoring a differential backup requires the original backup image and the most recent differential backup image made since the last full backup.</span></span>
-   <span data-ttu-id="0c408-121">Файл журнала ( \_ Журнал VSS BT \_ ) — резервное копирование выполняется только для файлов журнала модуля записи (файлов, добавленных в компонент с помощью метода [**Ивсскреатевритерметадата:: адддатабаселогфилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) и получаемых путем вызова [**ивссвмкомпонент:: жетдатабаселогфиле**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile)).</span><span class="sxs-lookup"><span data-stu-id="0c408-121">Log File (VSS\_BT\_LOG)—only a writer's log files (files added to a component with the [**IVssCreateWriterMetadata::AddDataBaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) method, and retrieved by a call to [**IVssWMComponent::GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile)) will be backed up.</span></span> <span data-ttu-id="0c408-122">Этот тип резервного копирования относится только к VSS.</span><span class="sxs-lookup"><span data-stu-id="0c408-122">This backup type is specific to VSS.</span></span>

<span data-ttu-id="0c408-123">Разработчики могут реализовать эти резервные копии с помощью сведений и методов за пределами VSS.</span><span class="sxs-lookup"><span data-stu-id="0c408-123">It is possible for requesters to implement these backups using information and methods outside of VSS.</span></span> <span data-ttu-id="0c408-124">Только когда инициатор запроса реализует резервную копию с помощью API VSS, должна иметься один из перечисленных типов резервных копий.</span><span class="sxs-lookup"><span data-stu-id="0c408-124">Only when a requester implements a backup using the VSS API should it be said to have one of the listed backup types.</span></span> <span data-ttu-id="0c408-125">Например, инициатор запроса участвует в \_ \_ резервной копии журнала VSS BT только в том случае, если он использовал сведения, возвращенные [**Ивссвмкомпонент:: жетдатабаселогфиле**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile) для обнаружения файлов журнала.</span><span class="sxs-lookup"><span data-stu-id="0c408-125">For instance, a requester participates in a VSS\_BT\_LOG type of backup only if it used the information returned by [**IVssWMComponent::GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile) to identify log files.</span></span> <span data-ttu-id="0c408-126">Аналогичным образом, \_ \_ добавочные разностные и VSS BT \_ \_ могут применяться только к операциям добавочного или разностного копирования, как описано в разделе [добавочные и разностные резервные копии](incremental-and-differential-backups.md).</span><span class="sxs-lookup"><span data-stu-id="0c408-126">Similarly, the VSS\_BT\_INCREMENTAL and VSS\_BT\_DIFFERENTIAL types apply only to incremental or differential operations, as described in [Incremental and Differential Backups](incremental-and-differential-backups.md).</span></span>

</dd> <dt>

<span data-ttu-id="0c408-127"><span id="Specification_about_Selectability"></span><span id="specification_about_selectability"></span><span id="SPECIFICATION_ABOUT_SELECTABILITY"></span>Спецификация выбора</span><span class="sxs-lookup"><span data-stu-id="0c408-127"><span id="Specification_about_Selectability"></span><span id="specification_about_selectability"></span><span id="SPECIFICATION_ABOUT_SELECTABILITY"></span>Specification about Selectability</span></span>
</dt> <dd>

<span data-ttu-id="0c408-128">Резервное копирование VSS может принять во внимание концепцию выбора компонентов в VSS — это называется запуском в [*режиме компонента*](vssgloss-c.md)или для их пропуска.</span><span class="sxs-lookup"><span data-stu-id="0c408-128">A VSS backup may choose to respect VSS notions of component selectability—this is referred to as running in [*component mode*](vssgloss-c.md)—or to ignore them.</span></span>

<span data-ttu-id="0c408-129">Примером, не выполняющимся в режиме компонента, будет создание резервной копии образа системы, где приложение резервного копирования потребовало бы от модуля записи обеспечить стабильность данных, но при этом выбор компонентов будет неважен.</span><span class="sxs-lookup"><span data-stu-id="0c408-129">An example of not running in component mode would be performing a system image backup, where the backup application would need writer cooperation to ensure data stability but where selection of components would be irrelevant.</span></span>

</dd> <dt>

<span data-ttu-id="0c408-130"><span id="Saving_Bootable_State"></span><span id="saving_bootable_state"></span><span id="SAVING_BOOTABLE_STATE"></span>Сохранение загрузочного состояния</span><span class="sxs-lookup"><span data-stu-id="0c408-130"><span id="Saving_Bootable_State"></span><span id="saving_bootable_state"></span><span id="SAVING_BOOTABLE_STATE"></span>Saving Bootable State</span></span>
</dt> <dd>

<span data-ttu-id="0c408-131">VSS поддерживает сохранение работающего состояния системы в полностью загрузочной конфигурации.</span><span class="sxs-lookup"><span data-stu-id="0c408-131">VSS supports saving the running system state in a fully bootable configuration.</span></span> <span data-ttu-id="0c408-132">Однако это не всегда требуется, и подготовка модуля записи к сохранению загрузочного состояния может иногда снизить производительность работающей системы в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="0c408-132">However, this is not always necessary, and writer preparation to save a bootable state can sometimes degrade real-time performance of a running system.</span></span>

<span data-ttu-id="0c408-133">Таким образом, запрашивающие стороны указывают, будет ли резервная копия включать загрузочное состояние системы в качестве аргумента для [**ивссбаккупкомпонентс:: сетбаккупстате**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span><span class="sxs-lookup"><span data-stu-id="0c408-133">Therefore, requesters indicate whether a backup will include a bootable system state as an argument to [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span></span> <span data-ttu-id="0c408-134">Модули записи определяют, должны ли они поддерживать сохранение состояния загрузочной системы путем вызова [**квссвритер:: исбутаблестатебаккедуп**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-isbootablesystemstatebackedup).</span><span class="sxs-lookup"><span data-stu-id="0c408-134">Writers determine whether they have to support saving the bootable system state by calling [**CVssWriter::IsBootableStateBackedUp**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-isbootablesystemstatebackedup).</span></span>

<span data-ttu-id="0c408-135">Даже если состояние загрузочной системы не выбрано, будут созданы теневые копии системных файлов и резервные копии файлов.</span><span class="sxs-lookup"><span data-stu-id="0c408-135">Even if bootable system state is not selected, shadow copies of the system files will be made and the files may be backed up.</span></span>

<span data-ttu-id="0c408-136">Тем не менее, если резервная копия не сохранила состояние загрузочной системы (см. раздел [резервное копирование и восстановление состояния системы в Windows server 2003 R2 и Windows server 2003 SP1](backing-up-and-restoring-system-state-under-vss.md)), следует проявлять значительную осторожность в восстановлении системных файлов.</span><span class="sxs-lookup"><span data-stu-id="0c408-136">However, great care should be exercised in restoring system files if the backup did not save the bootable system state (see [Backing Up and Restoring System State in Windows Server 2003 R2 and Windows Server 2003 SP1](backing-up-and-restoring-system-state-under-vss.md)).</span></span>

<span data-ttu-id="0c408-137">Вы не можете восстановить эту информацию из полученного документа компонентов резервного копирования, поэтому авторы инициаторов должны сохранить наличие резервной копии системы с загрузочным состоянием.</span><span class="sxs-lookup"><span data-stu-id="0c408-137">It is not possible to recover this information from a retrieved Backup Components Document, so requester authors should store whether the system was backed up with a bootable system state or not.</span></span>

</dd> <dt>

<span data-ttu-id="0c408-138"><span id="Partial_File_Support"></span><span id="partial_file_support"></span><span id="PARTIAL_FILE_SUPPORT"></span>Частичная поддержка файлов</span><span class="sxs-lookup"><span data-stu-id="0c408-138"><span id="Partial_File_Support"></span><span id="partial_file_support"></span><span id="PARTIAL_FILE_SUPPORT"></span>Partial File Support</span></span>
</dt> <dd>

<span data-ttu-id="0c408-139">Некоторые модули записи поддерживают восстановление файлов с помощью перезаписи частей файлов, которыми они управляют.</span><span class="sxs-lookup"><span data-stu-id="0c408-139">Some writers support file restoration through the overwriting of parts of the files they manage.</span></span> <span data-ttu-id="0c408-140">Инициатор запроса может воспользоваться преимуществами этого метода, и если да, то он указывает, что нужно установить сведения в [**ивссбаккупкомпонентс:: сетбаккупстате**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span><span class="sxs-lookup"><span data-stu-id="0c408-140">A requester may be designed to take advantage of this, and if so it indicates this by setting the information in [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span></span>

</dd> </dl>

 

 



