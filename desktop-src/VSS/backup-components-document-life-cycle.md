---
description: У запрашивающих стороны есть основная ответственность за жизненный цикл документа резервных компонентов.
ms.assetid: 287b7b9a-ac04-4a74-83c1-2cdd4a571ac1
title: Жизненный цикл документа компонентов резервного копирования
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a4bcb0263f46466d7be2bc19f3c8809167b2da08
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105693698"
---
# <a name="backup-components-document-life-cycle"></a><span data-ttu-id="b1afa-103">Жизненный цикл документа компонентов резервного копирования</span><span class="sxs-lookup"><span data-stu-id="b1afa-103">Backup Components Document Life Cycle</span></span>

<span data-ttu-id="b1afa-104">У запрашивающих стороны есть основная ответственность за жизненный цикл документа резервных компонентов.</span><span class="sxs-lookup"><span data-stu-id="b1afa-104">Requesters have primary responsibility for the life cycle of a Backup Components Document.</span></span>

<span data-ttu-id="b1afa-105">Этот элемент управления используется экземпляром объекта интерфейса [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) , возвращенного [**креатевссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents).</span><span class="sxs-lookup"><span data-stu-id="b1afa-105">This control is exercised by an instance of the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface object returned by [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents).</span></span>

<span data-ttu-id="b1afa-106">Перед резервным копированием или восстановлением инициатор запроса должен инициализировать документ компонентов резервного копирования, вызвав [**ивссбаккупкомпонентс:: инитиализефорбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) или [**Ивссбаккупкомпонентс:: инитиализефорресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore).</span><span class="sxs-lookup"><span data-stu-id="b1afa-106">A requester must initialize a Backup Components Document prior to a backup or restore by calling [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) or [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore).</span></span> <span data-ttu-id="b1afa-107">Инициатор запроса может инициализировать документ как пустой или загрузить ранее сохраненную копию документа.</span><span class="sxs-lookup"><span data-stu-id="b1afa-107">The requester can initialize the document as empty, or it can load a previously stored copy of the document.</span></span>

<span data-ttu-id="b1afa-108">Для операций резервного копирования документ компонентов резервного копирования обычно инициализируется как пустой.</span><span class="sxs-lookup"><span data-stu-id="b1afa-108">For backup operations, a Backup Components Document is typically initialized as empty.</span></span> <span data-ttu-id="b1afa-109">В процессе обработки резервной копии его данные будут заполняться в ходе взаимодействия с системными модулями записи.</span><span class="sxs-lookup"><span data-stu-id="b1afa-109">Its data will be filled in with cooperation from the system's writers in the course of processing the backup.</span></span>

<span data-ttu-id="b1afa-110">Для операций восстановления документ компонентов резервного копирования, как правило, инициализируется из сохраненного документа, созданного во время первоначального резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1afa-110">For restore operations, a Backup Components Document is typically initialized from a stored document generated during the initial backup.</span></span> <span data-ttu-id="b1afa-111">Это позволяет выполнить восстановление (вместе с проверкой сохраненных документов для записи метаданных), чтобы определить, какие данные были изначально архивированы и как они должны быть восстановлены.</span><span class="sxs-lookup"><span data-stu-id="b1afa-111">This allows the restore (in conjunction with examination of stored Writer Metadata Documents) to determine what data was initially backed up and how it should be restored.</span></span>

<span data-ttu-id="b1afa-112">Резервное копирование [*переносимых теневых копий*](vssgloss-t.md) является исключением из этого правила.</span><span class="sxs-lookup"><span data-stu-id="b1afa-112">Backing up [*transportable shadow copies*](vssgloss-t.md) is an exception to this rule.</span></span> <span data-ttu-id="b1afa-113">В этом случае теневая копия могла быть перемещена из одной системы (где она была создана вместе с исходным документом компонентов резервного копирования) на другую с помощью повторного назначения логического устройства общего хранилища.</span><span class="sxs-lookup"><span data-stu-id="b1afa-113">In this case, a shadow copy could have been moved from one system (where it was created along with the initial Backup Components Document) to another by means of reassigning a shared storage device's logical unit.</span></span> <span data-ttu-id="b1afa-114">Чтобы создать резервную копию в этих обстоятельствах, инициатор запроса загружает сохраненное состояние резервного копирования и переходит с того места, где была отключена начальная система.</span><span class="sxs-lookup"><span data-stu-id="b1afa-114">To back up under these circumstances, a requester loads the stored backup state and proceeds from where the initial system left off.</span></span> <span data-ttu-id="b1afa-115">(Дополнительные сведения см. в разделе [Импорт переносимых теневых скопированных томов](importing-transportable-shadow-copied-volumes.md).)</span><span class="sxs-lookup"><span data-stu-id="b1afa-115">(For more information, see [Importing Transportable Shadow Copied Volumes](importing-transportable-shadow-copied-volumes.md).)</span></span>

<span data-ttu-id="b1afa-116">В процессе обработки резервной копии инициатор запроса решает, какие компоненты на самом деле копируются на основе того, какие компоненты помечены как [*выбираемые для резервного копирования*](vssgloss-s.md), [*логические пути*](vssgloss-l.md)компонента и собственная внутренняя логика.</span><span class="sxs-lookup"><span data-stu-id="b1afa-116">In the course of processing a backup, the requester decides which components to actually copy on the basis of which components are marked as [*selectable for backup*](vssgloss-s.md), the component's [*logical paths*](vssgloss-l.md), and its own internal logic.</span></span>

<span data-ttu-id="b1afa-117">Некоторые компоненты будут [*явно включаться*](vssgloss-e.md) в операцию резервного копирования. сведения о компоненте будут добавлены в документ компонентов резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1afa-117">Some of the components will be [*explicitly included*](vssgloss-e.md) in the backup operation; information about the component will be added to the Backup Components Document.</span></span> <span data-ttu-id="b1afa-118">Другие будут [*неявно включаться*](vssgloss-i.md) в резервную копию; сведения о добавленных компонентах не будут добавлены в документ компонентов резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="b1afa-118">Others will be [*implicitly included*](vssgloss-i.md) in the backup; information about the added components will not be added to the Backup Components Document.</span></span>

<span data-ttu-id="b1afa-119">Все компоненты модуля записи, невыбираемые для компонентов резервного копирования без выбора предка в их логическом пути и выбираемые для компонентов резервного копирования, которые инициатор запроса выбирает, будут добавлены явным образом.</span><span class="sxs-lookup"><span data-stu-id="b1afa-119">All of a writer's nonselectable for backup components without a selectable ancestor in their logical path, and those selectable for backup components the requester chooses, will be added explicitly.</span></span>

<span data-ttu-id="b1afa-120">Как невыбираемые, так и невыбираемые для компонентов резервного копирования можно добавлять неявно, если в их логическом пути есть выбираемый предок, который явно включен в резервную копию.</span><span class="sxs-lookup"><span data-stu-id="b1afa-120">Both nonselectable and selectable for backup components can be added implicitly if they have a selectable ancestor in their logical path, which is explicitly included in the backup.</span></span> <span data-ttu-id="b1afa-121">Эти компоненты ([*подкомпоненты*](vssgloss-s.md)) являются членами [*наборов компонентов*](vssgloss-s.md) , определенных их выбираемым предком.</span><span class="sxs-lookup"><span data-stu-id="b1afa-121">These components ([*subcomponents*](vssgloss-s.md)) are members of [*component sets*](vssgloss-s.md) defined by their selectable ancestor.</span></span>

<span data-ttu-id="b1afa-122">При обработке операций восстановления инициатор запроса использует возможность [*выбора для восстановления*](vssgloss-s.md) вместо выбора для резервного копирования вместе со сведениями о логическом пути и собственной внутренней логикой для выбора восстанавливаемых файлов.</span><span class="sxs-lookup"><span data-stu-id="b1afa-122">When handling restore operations, the requester uses [*selectability for restore*](vssgloss-s.md) instead of selectability for backup in conjunction with logical path information and its own internal logic to decide which files to restore.</span></span>

<span data-ttu-id="b1afa-123">Если компонент, который был неявно добавлен в резервную копию, теперь будет явно добавлен к восстановлению, инициатор запроса обновит в документе компоненты резервного копирования сведения о компоненте.</span><span class="sxs-lookup"><span data-stu-id="b1afa-123">If a component that had been implicitly added to the backup is now to be explicitly added to the restore, the requester will update the Backup Components Document with that component's information.</span></span>

<span data-ttu-id="b1afa-124">Сведения о хранимых компонентах доступны как для запросов, так и для модулей записи через экземпляры интерфейса [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .</span><span class="sxs-lookup"><span data-stu-id="b1afa-124">Information about the stored components is available both to requesters and writers through instances of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface.</span></span>

<span data-ttu-id="b1afa-125">Это осуществляется через интерфейсы [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , которые средства записи могут запрашивать и (до конца событий [**моментального снимка**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) и события, [**восстановите**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) ) в документе резервные копии компонентов.</span><span class="sxs-lookup"><span data-stu-id="b1afa-125">It is through [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interfaces that writers can query and (until the end of [**PostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) and [**PostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) events) modify information in the Backup Components Document.</span></span>

<span data-ttu-id="b1afa-126">При вызове обработчика событий [**квссвритер:: онпрепаребаккуп**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**Квссвритер:: онпрересторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**квссвритер:: Онпостснапшот**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot), [**квссвритер:: OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete)или [**CVssWriter:: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) средство записи получает экземпляр интерфейса [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) .</span><span class="sxs-lookup"><span data-stu-id="b1afa-126">When the [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot), [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete), or [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) event handler is called, a writer receives an instance of an [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface.</span></span>

<span data-ttu-id="b1afa-127">Обратите внимание, что после создания события [**Баккупкомплете**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) документ резервного копирования становится доступен только для чтения, поэтому [**Квссвритер:: онбаккупкомплете**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) не может использовать интерфейс [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) для его изменения.</span><span class="sxs-lookup"><span data-stu-id="b1afa-127">Note that upon generation of the [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) event, the Backup Components Document is made read-only, and therefore [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) cannot use the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface to modify it.</span></span>

<span data-ttu-id="b1afa-128">С помощью интерфейса [**ивссвритеркомпонентс**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) модуль записи может извлекать экземпляры интерфейса [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , который позволит ему получить доступ ко всем компонентам, явным образом добавленным в документ компонентов резервного копирования, и изменить их состояние.</span><span class="sxs-lookup"><span data-stu-id="b1afa-128">From the [**IVSSWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface, the writer can retrieve instances of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface that will allow it to access all of its components explicitly added to the Backup Components Document and to alter their state.</span></span> <span data-ttu-id="b1afa-129">Дополнительные сведения см. в разделе Общие сведения об [обработке резервной копии в VSS](overview-of-processing-a-backup-under-vss.md) и [Обзор обработки восстановления в VSS](overview-of-processing-a-restore-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="b1afa-129">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md) and [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md).</span></span>

<span data-ttu-id="b1afa-130">Документы компонентов резервного копирования удаляются из памяти при освобождении интерфейса [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) и должны храниться с помощью [**Ивссбаккупкомпонентс:: савеасксмл**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml), иначе все данные будут потеряны.</span><span class="sxs-lookup"><span data-stu-id="b1afa-130">Backup Components Documents are removed from memory when the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface is released, and must be stored using [**IVssBackupComponents::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml), or all their information will be lost.</span></span>

<span data-ttu-id="b1afa-131">Кроме того, при правильном освобождении документа [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) создается событие [**баккупшутдовн**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown) и удаляются [*теневые копии автоматического выпуска*](vssgloss-a.md) .</span><span class="sxs-lookup"><span data-stu-id="b1afa-131">In addition, when an [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) document is properly released, a [**BackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown) event is generated and [*auto-release shadow copies*](vssgloss-a.md) are deleted.</span></span>

 

 



