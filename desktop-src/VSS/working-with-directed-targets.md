---
description: Направленный целевой механизм позволяет модулям записи сопоставлять файлы во время восстановления.
ms.assetid: c0b4ab26-2bb6-4b0f-b837-01057983b49b
title: Работа с направленными целями
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8bd2e15ec873b87030a2d01be69d2c3e5f95a193
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104072760"
---
# <a name="working-with-directed-targets"></a><span data-ttu-id="9442b-103">Работа с направленными целями</span><span class="sxs-lookup"><span data-stu-id="9442b-103">Working with Directed Targets</span></span>

<span data-ttu-id="9442b-104">[*Направленный целевой*](vssgloss-d.md) механизм позволяет модулям записи сопоставлять файлы во время восстановления.</span><span class="sxs-lookup"><span data-stu-id="9442b-104">The [*directed target*](vssgloss-d.md) mechanism allows writers to remap files at restore time.</span></span> <span data-ttu-id="9442b-105">Это позволяет модулям записи выполнять следующие действия:</span><span class="sxs-lookup"><span data-stu-id="9442b-105">This allows writers to do the following:</span></span>

-   <span data-ttu-id="9442b-106">Укажите новые целевые расположения (аналогично Ивссбаккупкомпонентс инициатора запроса [**:: аддневтаржет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)).</span><span class="sxs-lookup"><span data-stu-id="9442b-106">Specify new target locations (analogous to a requester's [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)).</span></span>
-   <span data-ttu-id="9442b-107">Освободите место на диске, восстановив только необходимые части файла на диск, особенно при резервном копировании файла с помощью механизма [*частичного создания файлов*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="9442b-107">Reclaim disk space by restoring only needed parts of a file to disk, particularly when a file was backed up using the [*partial file*](vssgloss-p.md) mechanism.</span></span>
-   <span data-ttu-id="9442b-108">Измените формат файла в соответствии с текущими потребностями.</span><span class="sxs-lookup"><span data-stu-id="9442b-108">Change the file format to meet current needs.</span></span>

<span data-ttu-id="9442b-109">Любой файл, который будет использоваться с направленной целевой операцией, должен иметь [*целевой объект восстановления*](vssgloss-r.md) , \_ направленный службой VSS RT \_ .</span><span class="sxs-lookup"><span data-stu-id="9442b-109">Any file to be used with a directed target operation must have a [*restore target*](vssgloss-r.md) of VSS\_RT\_DIRECTED.</span></span>

<span data-ttu-id="9442b-110">После установки того, что инициатор запроса может поддерживать направленную целевую операцию, модуль записи (при обработке события, выполняемого перед [**восстановлением**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) ) использует [**Ивсскомпонент:: Адддиректедтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) для экземпляра [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , соответствующего компоненту, управляющему файлом (или компонентом, определяющим набор компонентов, который содержит файл) для определения способа повторного сопоставления файла при восстановлении.</span><span class="sxs-lookup"><span data-stu-id="9442b-110">Once it has been established that a requester can support a directed target operation, a writer (while handling the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event) uses the [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file) to define how the file is to be remapped on restore.</span></span>

<span data-ttu-id="9442b-111">При использовании [**ивсскомпонент:: адддиректедтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget)модули записи указывают имя файла и путь, используемые для резервного копирования файла, имя файла и путь к его назначению восстановления (эти значения могут совпадать с исходным именем и расположением файла), а также диапазонами исходных и целевых файлов.</span><span class="sxs-lookup"><span data-stu-id="9442b-111">In using [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget), writers specify the file name and path used to back up the file, the file name and path of its restore destination (these values can be the same as the original file name and path), and source and destination file ranges.</span></span>

<span data-ttu-id="9442b-112">Как и при выполнении частичных операций с файлами, списки диапазонов представляют собой пары смещений в копируемый файл (в байтах) и длину восстанавливаемого раздела (в байтах), смещение и длину, разделенные двоеточием, и каждую пару, разделенную запятой: \*Offset1 \***:**_length1_*_,_* \* Offset2 \***:**_length2_.</span><span class="sxs-lookup"><span data-stu-id="9442b-112">As with partial file operations, range lists are pairs of offsets into the file to be backed up (in bytes) and the length of the section to be restored (in bytes), the offset and length being separated by a colon, and each pair separated by a comma: *Offset1\***:**_Length1_*_,_\* \*Offset2\***:**_Length2_.</span></span> <span data-ttu-id="9442b-113">Каждое значение представляет собой 64-разрядное целое число в шестнадцатеричном или десятичном формате.</span><span class="sxs-lookup"><span data-stu-id="9442b-113">Each value is a 64-bit integer in either hexadecimal or decimal format.</span></span>

<span data-ttu-id="9442b-114">Если модуль записи должен использовать направленный целевой механизм для восстановления файла в новое расположение, он вызывал [**ивсскомпонент:: адддиректедтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) с исходным именем файла и путем и новым именем файла и путем, а также указать диапазоны исходных целевых объектов с нулевым смещением и длиной, равной значению для всего размера файла.</span><span class="sxs-lookup"><span data-stu-id="9442b-114">If a writer needs to use the directed target mechanism to have the requester restore a file to a new location, it would have called [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) with the original file name and path and the new file name and path, and specify source destination ranges with a zero offset and a length equal to that of the entire file size.</span></span>

<span data-ttu-id="9442b-115">Например, если модуль записи должен иметь файл 200 000 деятелей, C: \\ вритердата \\ index. dat, восстановлен как C: \\ вритердата \\ олдиндекс. dat, строка исходного и целевого диапазона будет иметь значение "**0:204880**".</span><span class="sxs-lookup"><span data-stu-id="9442b-115">For instance, if a writer needs to have a 200K file, C:\\WriterData\\Index.dat, restored as C:\\WriterData\\OldIndex.dat, the source and destination range string would be "**0:204880**."</span></span>

<span data-ttu-id="9442b-116">Чтобы переназначить большой файл с частичным резервным копированием, запрашивающий объект будет использовать исходный диапазон, используемый для резервного копирования файла, и диапазон назначения, который уменьшит размер файла.</span><span class="sxs-lookup"><span data-stu-id="9442b-116">To remap a large, partially backed-up file, the requester would use the source range used to back up the file and a destination range that will reduce the file size.</span></span> <span data-ttu-id="9442b-117">Данные исходного диапазона можно получить с помощью [**ивсскомпонент:: жетпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) для экземпляра [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , соответствующего компоненту, который управляет файлом (или компонентом, определяющим набор компонентов, который содержит файл).</span><span class="sxs-lookup"><span data-stu-id="9442b-117">The source range information can be obtained by using [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file).</span></span>

<span data-ttu-id="9442b-118">Если частично заархивированный файл изначально был файлом большого размера, заголовок, байт 64-512, содержит число записей, а также другие часто обновляемые сведения, а последние данные находятся в файле последних 65536 байт — байт, 0x1239E8577A в 0x1239E7577A, средство записи может указать список исходных диапазонов в виде строки "**64:448, 0x1239E8577A: 65536**."</span><span class="sxs-lookup"><span data-stu-id="9442b-118">If the partially backed-up file was initially a large file whose header, bytes 64-512, contains a records count and other frequently updated information, and whose most recent data is to be found in the file's last 65536 bytes—bytes 0x1239E8577A to 0x1239E7577A, a writer could specify a source range list as the string "**64:448,0x1239E8577A:65536**."</span></span>

<span data-ttu-id="9442b-119">Если модуль записи хочет сопоставить восстановленный файл с только заголовком и последними данными, то список диапазонов может быть строкой "**0:488488:65536**.".</span><span class="sxs-lookup"><span data-stu-id="9442b-119">If the writer wanted to remap the restored file to contain only the header and most recent data, the range list could be the string "**0:488,488:65536**."</span></span>

<span data-ttu-id="9442b-120">Перед фактическим выполнением операции восстановления инициатор запроса должен проверить, требует ли какие-либо файлов поддержку направленной цели.</span><span class="sxs-lookup"><span data-stu-id="9442b-120">Prior to actually performing a restore operation, a requester should check to see if any files require directed target support.</span></span>

<span data-ttu-id="9442b-121">Для этого инициатор запроса сначала выполняет перебор модулей записи с хранимыми компонентами в своем документе компонентов резервного копирования с помощью [**ивссбаккупкомпонентс:: жетвритеркомпонентскаунт**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) и [**Ивссбаккупкомпонентс:: жетвритеркомпонентс**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span><span class="sxs-lookup"><span data-stu-id="9442b-121">To do this, the requester first iterates over the writers with stored components in its Backup Components Document using [**IVssBackupComponents::GetWriterComponentsCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) and [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span></span>

<span data-ttu-id="9442b-122">Затем интерфейс [**ивссбаккупкомпонентс:: жетвритеркомпонентс**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) используется для возврата экземпляров интерфейса [**ивссвритеркомпонентсекст**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) , который предоставляет методы [**ивссвритеркомпонентсекст::-Component**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) и [**IVssWriterComponentsExt:: GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount) , позволяющие инициатору запроса получать экземпляры [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .</span><span class="sxs-lookup"><span data-stu-id="9442b-122">The [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) interface is then used to return instances of the [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) interface, which provides [**IVssWriterComponentsExt::GetComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) and [**IVssWriterComponentsExt::GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount) methods that allow the requester to obtain [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) instances.</span></span>

<span data-ttu-id="9442b-123">Это позволяет инициатору запроса получать направленные целевые кандидаты с помощью [**ивсскомпонент:: жетдиректедтаржеткаунт**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) и [**Ивсскомпонент:: Жетдиректедтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget) для экземпляра [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , соответствующего компоненту, который управляет файлом (или компонентом, определяющим набор компонентов, который содержит файл).</span><span class="sxs-lookup"><span data-stu-id="9442b-123">This allows a requester to obtain directed target candidates by using [**IVssComponent::GetDirectedTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) and [**IVssComponent::GetDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file).</span></span>

 

 
