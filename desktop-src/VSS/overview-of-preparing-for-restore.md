---
description: При подготовке к восстановлению инициатор запроса использует документы метаданных сохраненного модуля записи в сочетании с собственным извлеченным компонентом резервного копирования, чтобы определить, что нужно восстановить и как.
ms.assetid: 36cf188f-fce6-467c-a200-cbd9dc8f31a6
title: Общие сведения о подготовке к восстановлению
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d8b1bc3e429da5be9872e8345fe6da32a5340005
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692895"
---
# <a name="overview-of-preparing-for-restore"></a><span data-ttu-id="eb062-103">Общие сведения о подготовке к восстановлению</span><span class="sxs-lookup"><span data-stu-id="eb062-103">Overview of Preparing for Restore</span></span>

<span data-ttu-id="eb062-104">При подготовке к восстановлению инициатор запроса использует документы метаданных сохраненного модуля записи в сочетании с собственным извлеченным компонентом резервного копирования, чтобы определить, что нужно восстановить и как.</span><span class="sxs-lookup"><span data-stu-id="eb062-104">In preparing for a restore, a requester uses the stored Writer Metadata Documents in conjunction with its own retrieved Backup Components Document to determine what is to be restored and how.</span></span> <span data-ttu-id="eb062-105">Дополнительные сведения см. в разделе Общие сведения об [обработке восстановления в VSS](overview-of-processing-a-restore-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="eb062-105">For more information, see [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md).</span></span>

<span data-ttu-id="eb062-106">После выбора потенциальных компонентов для восстановления модули записи, выполняющиеся в системе, обращаются к документу компонентов резервного копирования инициатора запроса.</span><span class="sxs-lookup"><span data-stu-id="eb062-106">Following the selection of restore candidate components, writers currently running on the system access the requester's Backup Components Document.</span></span> <span data-ttu-id="eb062-107">Модули записи используют этот доступ, чтобы указать, как вызывать минимальную сложность при выполнении служб из-за восстановления.</span><span class="sxs-lookup"><span data-stu-id="eb062-107">Writers use this access to indicate how to cause minimum difficulty for running services due to the restore.</span></span>

<span data-ttu-id="eb062-108">После этого запрашивающая сторона получает достаточно информации, чтобы определить, какие файлы потребуется восстановить, а также то, где и как они должны быть восстановлены.</span><span class="sxs-lookup"><span data-stu-id="eb062-108">After this is completed, the requester has enough information to determine which files will need to be restored, as well as where and how they should be restored.</span></span> <span data-ttu-id="eb062-109">(Дополнительные сведения см. [в разделе Создание набора восстановления](generating-a-restore-set.md).)</span><span class="sxs-lookup"><span data-stu-id="eb062-109">(For more information, see [Generating a Restore Set](generating-a-restore-set.md).)</span></span>

<span data-ttu-id="eb062-110">В следующей таблице показана последовательность действий и событий, необходимых для подготовки к операции восстановления.</span><span class="sxs-lookup"><span data-stu-id="eb062-110">The following table shows the sequence of actions and events that are required to prepare for a restore operation.</span></span>



| <span data-ttu-id="eb062-111">Действие запросившего</span><span class="sxs-lookup"><span data-stu-id="eb062-111">Requester action</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | <span data-ttu-id="eb062-112">Событие</span><span class="sxs-lookup"><span data-stu-id="eb062-112">Event</span></span>                                                         | <span data-ttu-id="eb062-113">Действие записи</span><span class="sxs-lookup"><span data-stu-id="eb062-113">Writer action</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="eb062-114">Получение сведений из документа о компонентах резервного копирования о компонентах, [*явно включаемых*](vssgloss-e.md) в операцию резервного копирования (см. раздел [**Ивссбаккупкомпонентс:: жетвритеркомпонентс**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents)). Изучите извлеченные документы метаданных модуля записи, чтобы получить сведения о компонентах, явно включаемых в резервную копию, и любых обнаруженных [*неявно включаемых*](vssgloss-i.md) компонентов</span><span class="sxs-lookup"><span data-stu-id="eb062-114">Retrieve information from the Backup Components Document about the components [*explicitly included*](vssgloss-e.md) in the backup operation (see [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents)) Examine retrieved Writer Metadata Documents to get details about those components explicitly included in the backup, and any find [*implicitly included*](vssgloss-i.md) subcomponents.</span></span> <span data-ttu-id="eb062-115">(См. раздел [**ивссексаминевритерметадата**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata), [**ивссвмкомпонент**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent).)</span><span class="sxs-lookup"><span data-stu-id="eb062-115">(See [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata), [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent).)</span></span><br/> | <span data-ttu-id="eb062-116">Нет</span><span class="sxs-lookup"><span data-stu-id="eb062-116">None</span></span>                                                          | <span data-ttu-id="eb062-117">Нет</span><span class="sxs-lookup"><span data-stu-id="eb062-117">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| <span data-ttu-id="eb062-118">Выберите компоненты и наборы компонентов для восстановления (см. раздел [**ивссбаккупкомпонентс:: сетселектедфорресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) and [**Ивссбаккупкомпонентс:: аддресторесубкомпонент**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent).)</span><span class="sxs-lookup"><span data-stu-id="eb062-118">Select components and component sets to be restored (see [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) and [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent).)</span></span>                                                                                                                                                                                                                                                                                                                                                                                          | <span data-ttu-id="eb062-119">Нет</span><span class="sxs-lookup"><span data-stu-id="eb062-119">None</span></span>                                                          | <span data-ttu-id="eb062-120">Нет</span><span class="sxs-lookup"><span data-stu-id="eb062-120">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| <span data-ttu-id="eb062-121">Инициатор запроса позволяет модулю записи обновлять документ компонентов резервного копирования и при необходимости передавать в модуль записи любые специальные параметры восстановления.</span><span class="sxs-lookup"><span data-stu-id="eb062-121">The requester allows the writer to update the Backup Components Document and may optionally communicate any special restore options to the writer.</span></span> <span data-ttu-id="eb062-122">(См. раздел [**ивссбаккупкомпонентс:: сетрестореоптионс**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions), [**Ивссбаккупкомпонентс:: аддневтаржет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)и [**ивссбаккупкомпонентс::P rerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).)</span><span class="sxs-lookup"><span data-stu-id="eb062-122">(See [**IVssBackupComponents::SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions), [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget), and [**IVssBackupComponents::PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).)</span></span>                                                                                                                                                                                                                                         | [<span data-ttu-id="eb062-123">*Предвосстановление*</span><span class="sxs-lookup"><span data-stu-id="eb062-123">*PreRestore*</span></span>](vssgloss-p.md) | <span data-ttu-id="eb062-124">Модуль записи определяет участие в восстановлении, подготавливает файлы для восстановления и при необходимости изменяет документ резервных компонентов.</span><span class="sxs-lookup"><span data-stu-id="eb062-124">The writer determines participation in the restore, prepares files to restore, and optionally modifies Backup Components Document if necessary.</span></span> <span data-ttu-id="eb062-125">(См. раздел [**квссвритер:: онпрересторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**ивсскомпонент:: Исселектедфорресторе**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore), [**ивсскомпонент:: GetRestoreOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions), [**IVssComponent:: SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), [**IVssComponent:: SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata), [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget).)</span><span class="sxs-lookup"><span data-stu-id="eb062-125">(See [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponent::IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore), [**IVssComponent::GetRestoreOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions), [**IVssComponent::SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata), [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget).)</span></span> |
| <span data-ttu-id="eb062-126">Инициатор запроса ждет, пока модули записи не обрабатывали событие [**RESTORE**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) с помощью [**ивссасинк**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span><span class="sxs-lookup"><span data-stu-id="eb062-126">The requester waits on writers to handle the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event with [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span></span> <span data-ttu-id="eb062-127">Он также должен проверять состояние модуля записи.</span><span class="sxs-lookup"><span data-stu-id="eb062-127">It should also verify writer status.</span></span> <span data-ttu-id="eb062-128">(См. раздел [**ивссбаккупкомпонентс:: гасервритерстатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**Ивссбаккупкомпонентс:: жетвритерстатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus).)</span><span class="sxs-lookup"><span data-stu-id="eb062-128">(See [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus).)</span></span>                                                                                                                                                                                                                                                                                  | <span data-ttu-id="eb062-129">Нет</span><span class="sxs-lookup"><span data-stu-id="eb062-129">None</span></span>                                                          | <span data-ttu-id="eb062-130">Нет</span><span class="sxs-lookup"><span data-stu-id="eb062-130">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |



 

## <a name="requester-actions-during-restore-preparations"></a><span data-ttu-id="eb062-131">Действия запросившего во время подготовительной процедуры восстановления</span><span class="sxs-lookup"><span data-stu-id="eb062-131">Requester Actions during Restore Preparations</span></span>

<span data-ttu-id="eb062-132">Чтобы определить, какие компоненты являются кандидатами для восстановления, инициатор запроса должен выполнить следующие действия:</span><span class="sxs-lookup"><span data-stu-id="eb062-132">To determine which components are candidates for restore, the requester must do the following:</span></span>

-   <span data-ttu-id="eb062-133">Установите компонент и структуру [*набора компонентов*](vssgloss-c.md) , используемую для создания резервной копии.</span><span class="sxs-lookup"><span data-stu-id="eb062-133">Establish the component and the [*component set*](vssgloss-c.md) structure used to make the backup.</span></span>
-   <span data-ttu-id="eb062-134">Проверьте [*Выбор компонентов для восстановления*](vssgloss-s.md).</span><span class="sxs-lookup"><span data-stu-id="eb062-134">Examine the components' [*selectability for restore*](vssgloss-s.md).</span></span>
-   <span data-ttu-id="eb062-135">Используйте рекомендации по выбору ([Работа с выборкой для восстановления и подкомпонентов](working-with-selectability-for-restore-and-subcomponents.md)), чтобы выбрать компоненты для включения.</span><span class="sxs-lookup"><span data-stu-id="eb062-135">Use selectability guidelines ([Working with Selectability for Restore and Subcomponents](working-with-selectability-for-restore-and-subcomponents.md)) to choose components to include.</span></span>
-   <span data-ttu-id="eb062-136">Используйте сведения о [*наборе файлов*](vssgloss-f.md) компонента, чтобы определить, какие файлы на носителе резервной копии необходимо восстановить.</span><span class="sxs-lookup"><span data-stu-id="eb062-136">Use component [*file set*](vssgloss-f.md) information to determine which files on the backup media must be restored.</span></span>

<span data-ttu-id="eb062-137">Для этого инициатору запроса необходимо проверить [*явно включаемые*](vssgloss-e.md) компоненты в документе сохраненных компонентов резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="eb062-137">To do this, the requester needs to examine [*explicitly included*](vssgloss-e.md) components in the stored Backup Components Document.</span></span> <span data-ttu-id="eb062-138">Эти сведения о компоненте доступны на основе модуля записи с помощью [**ивссбаккупкомпонентс:: жетвритеркомпонентс**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents), который возвращает экземпляры интерфейса [**ивссвритеркомпонентсекст**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) , из которого можно извлечь данные модуля записи и экземпляры интерфейса [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .</span><span class="sxs-lookup"><span data-stu-id="eb062-138">This component information is available on a writer-by-writer basis using [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents), which returns instances of the [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) interface, from which both writer information and instances of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface can be retrieved.</span></span>

<span data-ttu-id="eb062-139">Как отмечалось в других местах ([Использование компонентов инициатором запроса](use-of-components-by-the-requestor.md)), документ компонентов резервного копирования и интерфейс **ивсскомпонент** не содержат достаточно информации для поддержки резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="eb062-139">As noted elsewhere ([Use of Components by the Requester](use-of-components-by-the-requestor.md)), the Backup Components Document and the **IVssComponent** interface do not contain enough information to support the backup.</span></span> <span data-ttu-id="eb062-140">Таким образом, инициатор запроса должен проверить соответствующий документ метаданных сохраненного модуля записи с помощью [**ивссексаминевритерметадата**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) (см. [сведения об идентификации модуля записи](writer-metadata-document-contents.md)).</span><span class="sxs-lookup"><span data-stu-id="eb062-140">Therefore, the requester must examine the corresponding stored Writer Metadata Document by using [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) (see [Writer Identification Information](writer-metadata-document-contents.md)).</span></span>

<span data-ttu-id="eb062-141">Число компонентов, которыми управляет каждый модуль записи, возвращается функцией [**ивссексаминевритерметадата:: жетфилекаунтс**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getfilecounts).</span><span class="sxs-lookup"><span data-stu-id="eb062-141">The number of components each writer manages is returned by [**IVssExamineWriterMetadata::GetFileCounts**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getfilecounts).</span></span> <span data-ttu-id="eb062-142">Затем инициатор запроса может использовать [**ивссексаминевритерметадата::-Component**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) , чтобы получить интерфейс [**ивссвмкомпонент**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) для каждого компонента, управляемого модулем записи.</span><span class="sxs-lookup"><span data-stu-id="eb062-142">The requester can then use [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) to get an [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) interface for each component a writer manages.</span></span>

<span data-ttu-id="eb062-143">Изучив возможности [*выбора компонентов для резервного копирования*](vssgloss-s.md) и [*логических путей*](vssgloss-l.md) (см. раздел [Работа с возможностью выбора и логическими путями](working-with-selectability-and-logical-paths.md)), инициатор запроса может определить компоненты, которые задают наборы компонентов времени резервного копирования (явно включенные компоненты), а также элементы подкомпонентов этих наборов (неявно включенные компоненты).</span><span class="sxs-lookup"><span data-stu-id="eb062-143">By examining the components' [*selectability for backup*](vssgloss-s.md) and [*logical paths*](vssgloss-l.md) (see [Working with Selectability and Logical Paths](working-with-selectability-and-logical-paths.md)), a requester is able to identify the components that defined backup-time component sets (explicitly included components), and the subcomponents members of those sets (implicitly included components).</span></span>

<span data-ttu-id="eb062-144">Запрашивающие стороны указывают через документ компонентов резервного копирования, если компонент необходимо явно восстановить, используя [**ивссбаккупкомпонентс:: сетселектедфорресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) или [**Ивссбаккупкомпонентс:: аддресторесубкомпонент**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent).</span><span class="sxs-lookup"><span data-stu-id="eb062-144">Requesters indicate through the Backup Components Document if a component is to be explicitly restored, using either [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) or [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent).</span></span> <span data-ttu-id="eb062-145">Выбор метода зависит от того, как изначально была создана резервная копия компонента и его [*Выбор для восстановления*](vssgloss-s.md).</span><span class="sxs-lookup"><span data-stu-id="eb062-145">The choice of method will depend on how the component was originally backed up and its [*selectability for restore*](vssgloss-s.md).</span></span> <span data-ttu-id="eb062-146">Эти компоненты, явно включаемые в инструкцию RESTORE, обозначают другие компоненты, которые неявно включены (Дополнительные сведения см. [в разделе Работа с выборкой для восстановления и подкомпонентов](working-with-selectability-for-restore-and-subcomponents.md) ).</span><span class="sxs-lookup"><span data-stu-id="eb062-146">These components explicitly included for restore designate other components which are implicitly included (see [Working with Selectability for Restore and Subcomponents](working-with-selectability-for-restore-and-subcomponents.md) for details).</span></span>

<span data-ttu-id="eb062-147">Инициатор запроса может явно включить ни один из компонентов текущего модуля записи для восстановления с помощью [**ивссбаккупкомпонентс:: сетселектедфорресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) или [**Ивссбаккупкомпонентс:: аддресторесубкомпонент**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent).</span><span class="sxs-lookup"><span data-stu-id="eb062-147">A requester may explicitly include none of a currently executing writer's components for restore using [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) or [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent).</span></span> <span data-ttu-id="eb062-148">В этом случае этот модуль записи не будет принимать события VSS для оставшейся части операции восстановления.</span><span class="sxs-lookup"><span data-stu-id="eb062-148">In this case, that writer will not receive any VSS events for the remainder of the restore operation.</span></span>

<span data-ttu-id="eb062-149">Явное использование [**ивссбаккупкомпонентс:: сетселектедфорресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) или [**Ивссбаккупкомпонентс:: аддресторесубкомпонент**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) для выбора компонента модуля записи, который не выполняется в данный момент, ВОЗВРАЩАЕТ \_ ошибку " \_ объект VSS \_ не найден" \_ .</span><span class="sxs-lookup"><span data-stu-id="eb062-149">Explicitly using either [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) or [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) to select a component of a writer that is not currently running returns a VSS\_E\_OBJECT\_NOT\_FOUND error.</span></span> <span data-ttu-id="eb062-150">Сведения о восстановлении данных отсутствующих модулей записи см. в статье восстановление [без участия в записи](restores-without-writer-participation.md) .</span><span class="sxs-lookup"><span data-stu-id="eb062-150">See [Restores without Writer Participation](restores-without-writer-participation.md) for information on restoring the data of missing writers.</span></span>

<span data-ttu-id="eb062-151">Чтобы разрешить модулю записи получать полные сведения о том, какие параметры восстановления для записи и указать, что добавочное восстановление может быть отправлено в модули записи инициаторами вызовов [**ивссбаккупкомпонентс:: сетрестореоптионс**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) и [**Ивссбаккупкомпонентс:: сетаддитионалресторес**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores)соответственно.</span><span class="sxs-lookup"><span data-stu-id="eb062-151">To enable a writer to have complete information upon which to act, writer-specific restore options and indication of an incremental restore can be sent to the writers by requester calls to [**IVssBackupComponents::SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) and [**IVssBackupComponents::SetAdditionalRestores**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores), respectively.</span></span>

<span data-ttu-id="eb062-152">На этом этапе инициатор запроса завершил подготовку и создаст событие для предварительного **восстановления** путем вызова [**ивссбаккупкомпонентс::P rerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore), что позволяет модулям записи подготовиться к фактическому восстановлению.</span><span class="sxs-lookup"><span data-stu-id="eb062-152">At this point, a requester has finished its preparation, and it generates a **PreRestore** event by calling [**IVssBackupComponents::PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore), allowing writers to prepare for the actual restore.</span></span>

## <a name="writer-actions-during-restore-preparations"></a><span data-ttu-id="eb062-153">Действия модуля записи во время подготовительных процедур восстановления</span><span class="sxs-lookup"><span data-stu-id="eb062-153">Writer Actions during Restore Preparations</span></span>

<span data-ttu-id="eb062-154">Подготовка модуля записи для операции восстановления выполняется при обработке события, выполняемого перед [**восстановлением**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) , с помощью виртуального метода [**Квссвритер:: онпрересторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore).</span><span class="sxs-lookup"><span data-stu-id="eb062-154">Writer preparation for the restore operation occurs when handling the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event with the virtual method [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore).</span></span> <span data-ttu-id="eb062-155">Реализация по умолчанию просто возвращает, не принимая никаких действий.</span><span class="sxs-lookup"><span data-stu-id="eb062-155">The default implementation simply returns without taking any action.</span></span> <span data-ttu-id="eb062-156">Модули записи могут переопределить реализацию по умолчанию, чтобы повысить управляемость:</span><span class="sxs-lookup"><span data-stu-id="eb062-156">Writers may choose to override the default implementation to exercise more control by:</span></span>

-   <span data-ttu-id="eb062-157">Переопределение [*методов Restore*](vssgloss-r.md) с помощью [*целевых объектов восстановления*](vssgloss-r.md)</span><span class="sxs-lookup"><span data-stu-id="eb062-157">Overriding [*restore methods*](vssgloss-r.md) with [*restore targets*](vssgloss-r.md)</span></span>
-   <span data-ttu-id="eb062-158">Определение [ *направленных целевых объектов*](vssgloss-d.md)</span><span class="sxs-lookup"><span data-stu-id="eb062-158">Defining [*directed targets*](vssgloss-d.md)</span></span>
-   <span data-ttu-id="eb062-159">Создание сообщений об ошибках и дополнительных данных</span><span class="sxs-lookup"><span data-stu-id="eb062-159">Creating error messages and additional data</span></span>
-   <span data-ttu-id="eb062-160">Предоставление сведений о метке резервного копирования</span><span class="sxs-lookup"><span data-stu-id="eb062-160">Supplying backup stamp information</span></span>

<span data-ttu-id="eb062-161">Обработчик событий [**квссвритер:: онпрересторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) получает экземпляр [**ивссвритеркомпонентс**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), из которого он может получить [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) интерфейсы для тех компонентов, которые явно включаются в документ компонентов резервного копирования во время резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="eb062-161">The event handler [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) receives an instance of the [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), from which it can obtain [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interfaces for those of its components explicitly included in the Backup Components Document during backup.</span></span>

<span data-ttu-id="eb062-162">Сведения о подкомпонентах неявно включаются в операции резервного копирования и явно включаются в восстановление с помощью экземпляра **ивсскомпонент** , соответствующего компоненту, который определил [*набор компонентов*](vssgloss-c.md)резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="eb062-162">Information about subcomponents implicitly included in backup operations and explicitly included in restores by using an instance of the **IVssComponent** corresponding to the component that defined its backup [*component set*](vssgloss-c.md).</span></span>

<span data-ttu-id="eb062-163">Метод [**ивсскомпонент:: исселектедфорресторе**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore) используется для определения того, следует ли восстанавливать явно включенный компонент резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="eb062-163">The [**IVssComponent::IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore) method is used to determine whether an explicitly included for backup component is to be restored.</span></span>

<span data-ttu-id="eb062-164">Чтобы определить, был ли подкомпонент резервного копирования явно добавлен в восстановление, модули записи используют [**ивсскомпонент:: жетресторесубкомпонент**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoresubcomponent).</span><span class="sxs-lookup"><span data-stu-id="eb062-164">To determine if a backup subcomponent was explicitly included in the restore, writers use [**IVssComponent::GetRestoreSubcomponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoresubcomponent).</span></span>

<span data-ttu-id="eb062-165">Модуль записи должен проверить [*набор файлов*](vssgloss-f.md) в каждом компоненте и определить, требуется ли выполнять действия для поддержки восстановления.</span><span class="sxs-lookup"><span data-stu-id="eb062-165">The writer should examine the [*file set*](vssgloss-f.md) in each component and determine if it needs to take actions to support the restore.</span></span> <span data-ttu-id="eb062-166">Модуль записи должен выполнить оценку, если он хочет, чтобы его текущие файлы были перезаписаны, или если потребуется восстановление в новом расположении.</span><span class="sxs-lookup"><span data-stu-id="eb062-166">The writer will need to evaluate if it wants its current files overwritten, or if it will require restoration to new locations.</span></span> <span data-ttu-id="eb062-167">Действия могут включать следующее.</span><span class="sxs-lookup"><span data-stu-id="eb062-167">Actions can include the following:</span></span>

-   <span data-ttu-id="eb062-168">Получение и работа с любыми параметрами записи или запрашивающей стороны, управляющими операциями восстановления (см [**. раздел ивсскомпонент:: жетрестореоптионс**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions)).</span><span class="sxs-lookup"><span data-stu-id="eb062-168">Getting and acting on any writer- or requester-specific options governing restore operations (see [**IVssComponent::GetRestoreOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions))</span></span>
-   <span data-ttu-id="eb062-169">Закрытие и запись всех открытых файлов в настоящий момент</span><span class="sxs-lookup"><span data-stu-id="eb062-169">Closing and making writable any currently open files</span></span>
-   <span data-ttu-id="eb062-170">Обновление целевого объекта восстановления (например, для принудительного восстановления в альтернативное сопоставление расположения).</span><span class="sxs-lookup"><span data-stu-id="eb062-170">Updating the restore target (for instance, to force restoration to an alternate location mapping).</span></span> <span data-ttu-id="eb062-171">См. раздел [**ивсскомпонент:: сетресторетаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget).</span><span class="sxs-lookup"><span data-stu-id="eb062-171">See [**IVssComponent::SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget).</span></span>
-   <span data-ttu-id="eb062-172">Взаимодействие с инициатором запроса через частные метаданные (см [**. ивсскомпонент:: сетрестореметадата**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata))</span><span class="sxs-lookup"><span data-stu-id="eb062-172">Communicating with the requester via private metadata (see [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata))</span></span>
-   <span data-ttu-id="eb062-173">Указывает, что файл должен быть восстановлен путем повторного сопоставления через определение [*направленных целевых объектов*](vssgloss-d.md) (см [**. Ивсскомпонент:: адддиректедтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget)).</span><span class="sxs-lookup"><span data-stu-id="eb062-173">Indicating that a file should be restored by remapping through the definition of [*directed targets*](vssgloss-d.md) (see [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget))</span></span>

<span data-ttu-id="eb062-174">Экземпляр [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) будет либо создан явным включением компонента в документ компонентов резервного копирования во время резервного копирования, либо компонентом, определяющим набор компонентов резервного копирования, членом которого он был (см. раздел [Работа с выборкой для восстановления и подкомпонентов](working-with-selectability-for-restore-and-subcomponents.md)).</span><span class="sxs-lookup"><span data-stu-id="eb062-174">The instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) used will either be that created by the component's explicit inclusion in the Backup Components Document during backup, or that of the component defining the backup component set of which it was a member (see [Working with Selectability For Restore and Subcomponents](working-with-selectability-for-restore-and-subcomponents.md)).</span></span>

 

 
