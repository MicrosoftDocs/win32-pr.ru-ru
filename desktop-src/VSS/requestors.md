---
description: Инициатор запроса — это любое приложение, использующее API VSS (в частности, интерфейс Ивссбаккупкомпонентс) для запроса служб служба теневого копирования томов для создания теневых копий и наборов теневого копирования одного или нескольких томов, а также управления ими.
ms.assetid: e49920d0-5b66-4aa1-b3ca-641629df5f8a
title: Инициаторы запроса
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b676b8cd287365b257e3b6ee85a7e47a70f88ef3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104264023"
---
# <a name="requesters"></a><span data-ttu-id="dafb0-103">Инициаторы запроса</span><span class="sxs-lookup"><span data-stu-id="dafb0-103">Requesters</span></span>

<span data-ttu-id="dafb0-104">[*Инициатор запроса*](vssgloss-r.md) — это любое приложение, ИСПОЛЬЗУЮЩЕЕ API VSS (в частности, интерфейс [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) ) для запроса служб Служба теневого копирования томов для создания теневых копий и наборов теневого копирования одного или нескольких томов, а также управления ими.</span><span class="sxs-lookup"><span data-stu-id="dafb0-104">A [*requester*](vssgloss-r.md) is any application that uses the VSS API (specifically the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface) to request the services of the Volume Shadow Copy Service to create and manage shadow copies and shadow copy sets of one or more volumes.</span></span>

<span data-ttu-id="dafb0-105">Наиболее типичный пример запроса (и единственный адрес, описанный в этой документации) — это приложение для резервного копирования и восстановления с поддержкой VSS, которое использует теневое копирование данных в качестве стабильного источника для своих операций резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="dafb0-105">The most typical example of a requester (and the only one addressed in this documentation) is a VSS-aware backup/restore application, which uses shadow-copied data as a stable source for its backup operations.</span></span>

<span data-ttu-id="dafb0-106">Помимо запуска теневого копирования, приложения инициатора запроса и резервного копирования и восстановления взаимодействуют с производителями данных (модулями записи) для сбора информации в системе и для подготовки к записи данных для резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="dafb0-106">In addition to initiating shadow copies, backup/recover requester applications communicate with data producers (writers) to gather information on the system and to signal writers to prepare their data for backup.</span></span>

## <a name="requester-state"></a><span data-ttu-id="dafb0-107">Состояние инициатора запроса</span><span class="sxs-lookup"><span data-stu-id="dafb0-107">Requester State</span></span>

<span data-ttu-id="dafb0-108">Инициатор запроса сохраняет свои сведения о состоянии в объекте метаданных на основе XML, который называется документом компонентов резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="dafb0-108">A requester maintains its state information in an XML-based metadata object called the Backup Components Document.</span></span> <span data-ttu-id="dafb0-109">Метаданные запросившего необходимы, но недостаточно, чтобы разрешить инициатору запроса резервное копирование и восстановление файловой системы.</span><span class="sxs-lookup"><span data-stu-id="dafb0-109">The requester metadata is necessary, but not sufficient to allow a requester to back up and then restore a file system.</span></span> <span data-ttu-id="dafb0-110">Это обусловлено следующими причинами.</span><span class="sxs-lookup"><span data-stu-id="dafb0-110">The reasons for this are the following:</span></span>

-   <span data-ttu-id="dafb0-111">Во время операции резервного копирования только подмножество компонентов, задействованных в резервной копии, не [*выбираемое для*](vssgloss-s.md) компонентов резервного копирования без выбора для предков резервной копии и выбираемых для компонентов резервного копирования, которые были [*явно включены*](vssgloss-e.md) в резервную копию, были добавлены в документ компонентов резервного копирования инициатора запроса.</span><span class="sxs-lookup"><span data-stu-id="dafb0-111">During a backup operation, only a subset of all the components involved in the backup—[*nonselectable for backup*](vssgloss-s.md) components without selectable for backup ancestors and selectable for backup components that have been [*included explicitly*](vssgloss-e.md) in the backup—have had their information added to the requester's Backup Components Document.</span></span>
-   <span data-ttu-id="dafb0-112">Данные даже для компонентов, добавленных в документ архивных компонентов, являются неполными — спецификации файлов и путей не включаются.</span><span class="sxs-lookup"><span data-stu-id="dafb0-112">The information even for those components added to the Backup Components Document is incomplete—file and path specifications are not included.</span></span>
-   <span data-ttu-id="dafb0-113">Во время операций восстановления компонент, [*неявно включаемый*](vssgloss-i.md) в резервную копию, может быть [*выбран для восстановления*](vssgloss-s.md) и поэтому может быть явно добавлен в восстановление.</span><span class="sxs-lookup"><span data-stu-id="dafb0-113">During restore operations, a component [*implicitly included*](vssgloss-i.md) in the backup may be [*selectable for restore*](vssgloss-s.md) and therefore can be explicitly included in the restore.</span></span> <span data-ttu-id="dafb0-114">Для этого потребуется обновить документ компонентов резервного копирования инициатора запроса информацией из сохраненных копий документа метаданных модуля записи модуля записи.</span><span class="sxs-lookup"><span data-stu-id="dafb0-114">This will require the updating of the requester's Backup Components Document with information from stored copies of a writer's Writer Metadata Document.</span></span>

<span data-ttu-id="dafb0-115">Чтобы обеспечить полную спецификацию операции резервного копирования или восстановления, API VSS позволяет инициатору запроса выполнять запросы к выполняемым метаданным модулей записи (во время резервного копирования) или анализировать метаданные сохраненного модуля записи (во время восстановления).</span><span class="sxs-lookup"><span data-stu-id="dafb0-115">To allow for full specification of a backup or restore operation, the VSS API allows the requester to query running writers' metadata (during backups) or examine stored writer metadata (during restores).</span></span> <span data-ttu-id="dafb0-116">Кроме того, модуль записи может изменять сведения о компонентах в документе резервных копий в ходе операции резервного копирования или восстановления.</span><span class="sxs-lookup"><span data-stu-id="dafb0-116">In addition, a writer can modify component information in the Backup Components Document in the course of a backup or restore operation.</span></span>

<span data-ttu-id="dafb0-117">Используя сведения о том, какие компоненты были выбраны для резервного копирования и восстановления, и правила, касающиеся выбора компонентов (Дополнительные сведения см. в разделе [Настройка организации компонентов](definition-of-components-by-writers.md) и [Работа с возможностью выбора и логическими путями](working-with-selectability-and-logical-paths.md)), инициатор запроса может определить, какие файлы модуля записи необходимо архивировать или восстанавливать, а также где он может найти эти файлы.</span><span class="sxs-lookup"><span data-stu-id="dafb0-117">Using the information about which components have been selected for backup and restore and the rules regarding component selection (for more information, see [Setting up Component Organization](definition-of-components-by-writers.md) and [Working with Selectability and Logical Paths](working-with-selectability-and-logical-paths.md)), a requester can determine which files of which writer it needs to back up or restore, and where it can find those files.</span></span>

<span data-ttu-id="dafb0-118">В рамках резервной копии необходимо сохранить метаданные запрашивающего и модуля записи, чтобы их можно было использовать в восстановлении.</span><span class="sxs-lookup"><span data-stu-id="dafb0-118">As part of a backup, both requester and writer metadata must be stored so that it can be used in the restore.</span></span> <span data-ttu-id="dafb0-119">И наоборот, для операций восстановления требуется получение старых компонентов резервного копирования и документов метаданных модуля записи для получения полных инструкций по восстановлению файлов.</span><span class="sxs-lookup"><span data-stu-id="dafb0-119">Conversely, restore operations require the retrieval of the old Backup Components and Writer Metadata Documents to obtain full instructions on restoring files.</span></span>

## <a name="requester-interprocess-communication"></a><span data-ttu-id="dafb0-120">Взаимодействие между процессами запросившего</span><span class="sxs-lookup"><span data-stu-id="dafb0-120">Requester Interprocess Communication</span></span>

<span data-ttu-id="dafb0-121">Инициатор запроса поддерживает управление операциями резервного копирования и восстановления VSS путем создания событий COM с помощью различных вызовов API инициатора запроса.</span><span class="sxs-lookup"><span data-stu-id="dafb0-121">The requester maintains control over VSS backup and restore operations by generating COM events through various calls in the requester API.</span></span> <span data-ttu-id="dafb0-122">Эти вызовы могут выполнять следующие действия:</span><span class="sxs-lookup"><span data-stu-id="dafb0-122">These calls can do the following:</span></span>

-   <span data-ttu-id="dafb0-123">Запросы поставщиков, например [**ивссбаккупкомпонентс::D оснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) , приводят к созданию теневой копии выбранного тома поставщиком.</span><span class="sxs-lookup"><span data-stu-id="dafb0-123">Make requests of the providers, for example, [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) causes the provider to create a shadow copy of the selected volume.</span></span>
-   <span data-ttu-id="dafb0-124">Активация модулей записи для возврата информации, например [**ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) , позволяет инициатору запроса получить документ метаданных модуля записи каждого модуля записи.</span><span class="sxs-lookup"><span data-stu-id="dafb0-124">Trigger the writers to return information, for example, [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) enables the requester to obtain each writer's Writer Metadata Document.</span></span>
-   <span data-ttu-id="dafb0-125">Необходимо, чтобы модули записи подготавливались к различным этапам операций теневого копирования и резервного копирования или обрабатывали их, например [**ивссбаккупкомпонентс::P репарефорбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) сигналы, которые можно настроить для закрепления ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="dafb0-125">Require writers to prepare for or handle various phases of the shadow copy and backup operations, for example, [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) signals writers to set up for the I/O freeze.</span></span>

<span data-ttu-id="dafb0-126">Инициатор запроса получает сведения от модулей записи через динамические или хранимые документы метаданных модуля записи, а также использует интерфейс [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , который модуль записи может обновить.</span><span class="sxs-lookup"><span data-stu-id="dafb0-126">A requester receives information from the writers through live or stored Writer Metadata Documents and through the use of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface, which the writer can update.</span></span>

## <a name="life-cycle-of-a-requester-during-backup"></a><span data-ttu-id="dafb0-127">Жизненный цикл инициатора запроса во время резервного копирования</span><span class="sxs-lookup"><span data-stu-id="dafb0-127">Life Cycle of a Requester during Backup</span></span>

<span data-ttu-id="dafb0-128">Ниже приведена сводка жизненного цикла инициатора запроса для резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="dafb0-128">The following is a summary of the requester life cycle for backup:</span></span>

1.  <span data-ttu-id="dafb0-129">Создание и инициализация интерфейсов API VSS.</span><span class="sxs-lookup"><span data-stu-id="dafb0-129">Instantiate and initialize VSS API interfaces.</span></span>
2.  <span data-ttu-id="dafb0-130">Свяжитесь с модулями записи и извлеките их информацию.</span><span class="sxs-lookup"><span data-stu-id="dafb0-130">Contact writers and retrieve their information.</span></span>
3.  <span data-ttu-id="dafb0-131">Выберите данные для резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="dafb0-131">Choose data to back up.</span></span>
4.  <span data-ttu-id="dafb0-132">Запросите теневую копию поставщика.</span><span class="sxs-lookup"><span data-stu-id="dafb0-132">Request a shadow copy of the provider.</span></span>
5.  <span data-ttu-id="dafb0-133">Создайте резервную копию данных.</span><span class="sxs-lookup"><span data-stu-id="dafb0-133">Back up the data.</span></span>
6.  <span data-ttu-id="dafb0-134">Освободите интерфейс и теневую копию.</span><span class="sxs-lookup"><span data-stu-id="dafb0-134">Release the interface and the shadow copy.</span></span>

## <a name="life-cycle-of-a-requester-during-restore"></a><span data-ttu-id="dafb0-135">Жизненный цикл инициатора запроса во время восстановления</span><span class="sxs-lookup"><span data-stu-id="dafb0-135">Life Cycle of a Requester during Restore</span></span>

<span data-ttu-id="dafb0-136">В жизненном цикле восстановления не требуется теневая копия, но по-прежнему требуется взаимодействие модуля записи:</span><span class="sxs-lookup"><span data-stu-id="dafb0-136">The restore life cycle does not require a shadow copy, but still requires writer cooperation:</span></span>

1.  <span data-ttu-id="dafb0-137">Создание экземпляров интерфейсов API VSS.</span><span class="sxs-lookup"><span data-stu-id="dafb0-137">Instantiate VSS API interfaces.</span></span>
2.  <span data-ttu-id="dafb0-138">Инициализируйте инициатор запроса для операции восстановления, загрузив сохраненный документ компонентов резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="dafb0-138">Initialize the requester for the restore operation by loading a stored Backup Components Document.</span></span>
3.  <span data-ttu-id="dafb0-139">Извлеките метаданные сохраненного модуля записи и документы компонентов резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="dafb0-139">Retrieve stored Writer Metadata and Backup Components Documents.</span></span>
4.  <span data-ttu-id="dafb0-140">Обратитесь к модулям записи для инициализации взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="dafb0-140">Contact the writers to initialize cooperation.</span></span>
5.  <span data-ttu-id="dafb0-141">Проверьте наличие обновлений модуля записи в документе архивных компонентов.</span><span class="sxs-lookup"><span data-stu-id="dafb0-141">Check for writer updates to the Backup Components Document.</span></span>
6.  <span data-ttu-id="dafb0-142">Восстановление данных.</span><span class="sxs-lookup"><span data-stu-id="dafb0-142">Restore the data.</span></span>

 

 



