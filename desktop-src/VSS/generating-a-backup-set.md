---
description: Резервный набор данных — это список всех файлов для резервного копирования, их расположения и архивации.
ms.assetid: 34a66a9c-c1bc-437d-b034-59dc0c88228c
title: Создание резервного набора данных
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 827d9ecb90ac376aa9818b61e8dab65550ff8c50
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692924"
---
# <a name="generating-a-backup-set"></a><span data-ttu-id="47711-103">Создание резервного набора данных</span><span class="sxs-lookup"><span data-stu-id="47711-103">Generating A Backup Set</span></span>

<span data-ttu-id="47711-104">Резервный набор данных — это список всех файлов для резервного копирования, их расположения и архивации.</span><span class="sxs-lookup"><span data-stu-id="47711-104">A backup set is a list of all files to be backed up, their locations, and how to back them up.</span></span>

<span data-ttu-id="47711-105">Запрашивающий объект должен использовать файлы, содержащиеся на тенев скопированных томах, после того, как [**ивссбаккупкомпонентс::D оснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) успешно возвращает полный список файлов для резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="47711-105">A requester must make use of the files contained on the shadow-copied volumes after the [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) returns successfully to generate the full list of files to be backed up.</span></span>

<span data-ttu-id="47711-106">Кроме того, инициатор запроса должен решить, что некоторые файлы имеют [*альтернативные пути*](vssgloss-a.md) и что некоторые файлы были исключены.</span><span class="sxs-lookup"><span data-stu-id="47711-106">In addition, a requester must deal with the possibility that some files have [*alternate paths*](vssgloss-a.md) and that some files have been excluded.</span></span>

<span data-ttu-id="47711-107">Алгоритм выбора файлов для резервного копирования должен передаваться на [*экземпляре модуля*](vssgloss-w.md) записи по экземпляру средства чтения, по отдельности по компонентам (как это будет происходить во время восстановления; см. статью [Создание набора восстановления](generating-a-restore-set.md)) и выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="47711-107">An algorithm for selecting files to back up should go on a [*writer instance*](vssgloss-w.md) by writer instance, component-by-component basis (as will be the case during restore; see [Generating a Restore Set](generating-a-restore-set.md)) and might proceed by doing the following:</span></span>

1.  <span data-ttu-id="47711-108">Определение томов, содержащих файлы модуля записи и соответствующие объекты устройств</span><span class="sxs-lookup"><span data-stu-id="47711-108">Determining the volumes that contain the writer's files and the corresponding device objects</span></span>
2.  <span data-ttu-id="47711-109">Использование сведений о [*наборе файлов*](vssgloss-f.md) (содержащихся в объектах [**ивссвмфиледеск**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) , возвращаемых [**ивссексаминевритерметадата:: жетексклудефиле**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getexcludefile)) для создания списка явно исключенных файлов при необходимости с помощью **финдфилефирст**, **финдфилефирстекс** и **FindNextFile**.</span><span class="sxs-lookup"><span data-stu-id="47711-109">Using the [*file set*](vssgloss-f.md) information (contained in [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) objects returned by [**IVssExamineWriterMetadata::GetExcludeFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getexcludefile)) to create a list of the explicitly excluded files, if necessary using **FindFileFirst**, **FindFileFirstEx**, and **FindNextFile**.</span></span>
3.  <span data-ttu-id="47711-110">Перебор всех компонентов модуля записи с помощью [**ивссексаминевритерметадата::-Component**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent).</span><span class="sxs-lookup"><span data-stu-id="47711-110">Iterating over all of a writer's components, using [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent).</span></span> <span data-ttu-id="47711-111">Если выбран выбираемый компонент, используйте [*логический путь*](vssgloss-l.md) , чтобы получить эти невыбираемые компоненты, связанные с ним, в наборе компонентов.</span><span class="sxs-lookup"><span data-stu-id="47711-111">If a selectable component is selected, use [*logical path*](vssgloss-l.md) to obtain those nonselectable components associated with it in a component set.</span></span> <span data-ttu-id="47711-112">(См. раздел [Работа с выборкой и логическими путями](working-with-selectability-and-logical-paths.md).)</span><span class="sxs-lookup"><span data-stu-id="47711-112">(See [Working with Selectability and Logical Paths](working-with-selectability-and-logical-paths.md).)</span></span>
4.  <span data-ttu-id="47711-113">Получение [*наборов файлов*](vssgloss-f.md) , содержащихся в каждом выбранном компоненте, с помощью интерфейса [**ивссвмкомпонент**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) , соответствующего каждому компоненту, который он содержит.</span><span class="sxs-lookup"><span data-stu-id="47711-113">Obtaining the [*file sets*](vssgloss-f.md) contained in each selected component by using the [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) interface corresponding to each component it contains.</span></span>
5.  <span data-ttu-id="47711-114">Создание списка файлов из спецификаций (при необходимости с помощью **финдфилефирст**, **финдфилефирстекс** и **FindNextFile**).</span><span class="sxs-lookup"><span data-stu-id="47711-114">Generating a list of files from the specifications—if necessary using **FindFileFirst**, **FindFileFirstEx**, and **FindNextFile**.</span></span>
6.  <span data-ttu-id="47711-115">Проверка каждого файла в списке, созданном на основе сведений о компоненте, по списку исключенных файлов, созданных выше.</span><span class="sxs-lookup"><span data-stu-id="47711-115">Checking each file in the list generated from component information against the list of excluded files generated above.</span></span> <span data-ttu-id="47711-116">Это следует сделать с помощью пути по умолчанию для файла (возвращаемого функцией [**ивссвмфиледеск:: путь**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)), а не из альтернативного пути, возвращенного [**Ивссвмфиледеск:: жеталтернателокатион**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation)).</span><span class="sxs-lookup"><span data-stu-id="47711-116">This should be done using the default path for the file (returned by [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)), not by the alternate path returned by [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation)).</span></span> <span data-ttu-id="47711-117">Если файл соответствует исключенному списку, резервное копирование не выполняется.</span><span class="sxs-lookup"><span data-stu-id="47711-117">If the file matches the excluded list, it will not be backed up.</span></span>
7.  <span data-ttu-id="47711-118">Выбор фактического расположения для резервного копирования (с использованием альтернативного пути, если он был задан)</span><span class="sxs-lookup"><span data-stu-id="47711-118">Choosing the actual location from which to back up (using the alternate path if it was set)</span></span>
8.  <span data-ttu-id="47711-119">На этом этапе доступен полный список файлов и их расположений, а также может начаться резервное копирование.</span><span class="sxs-lookup"><span data-stu-id="47711-119">At this point, a full list of files and their locations is available and a backup can begin.</span></span>

<span data-ttu-id="47711-120">После создания начального резервного набора данных для всех модулей записи, имеющихся в системе, инициатор запроса проверяет следующий раздел реестра:</span><span class="sxs-lookup"><span data-stu-id="47711-120">After an initial backup set has been generated for all writers that are present on the system, the requester then checks the following registry key:</span></span>

<span data-ttu-id="47711-121">**HKEY \_ локальный \_ компьютер \\ система \\ CurrentControlSet \\ элемент управления \\ баккупресторе \\ филесноттобаккуп**</span><span class="sxs-lookup"><span data-stu-id="47711-121">**HKEY\_LOCAL\_MACHINE\\System\\CurrentControlSet\\Control\\BackupRestore\\FilesNotToBackup**</span></span>

<span data-ttu-id="47711-122">Инициатор запроса использует подразделы в этом разделе следующим образом:</span><span class="sxs-lookup"><span data-stu-id="47711-122">The requester uses the subkeys under this key as follows:</span></span>

-   <span data-ttu-id="47711-123">Если модуль записи присутствует в системе и существует подраздел, имя которого совпадает с именем модуля записи, этот подраздел необходимо игнорировать.</span><span class="sxs-lookup"><span data-stu-id="47711-123">If a writer is present on the system, and there is a subkey whose name matches the writer's name, that subkey must be ignored.</span></span>
-   <span data-ttu-id="47711-124">Если модуль записи присутствовал в системе, но в настоящее время отсутствует в резервном наборе данных и имеется соответствующий подраздел, все файлы, указанные в подразделе, исключаются и должны быть удалены из резервного набора.</span><span class="sxs-lookup"><span data-stu-id="47711-124">If a writer was present on the system but is currently absent from the backup set, and there is a matching subkey, any files specified in the subkey data are excluded and must be removed from the backup set.</span></span>
-   <span data-ttu-id="47711-125">Приложение резервного копирования добавляет файлы в данные подраздела путем создания \_ значения Multi SZ, содержащего список спецификаций файлов для файлов, которые не должны быть резервными.</span><span class="sxs-lookup"><span data-stu-id="47711-125">The backup application adds files to the subkey data by creating a MULTI\_SZ value containing a list of file specifications for the files that must not be backed up.</span></span> <span data-ttu-id="47711-126">Каждая строка в \_ значении Multi SZ должна содержать одну спецификацию файла.</span><span class="sxs-lookup"><span data-stu-id="47711-126">Each string in the MULTI\_SZ value should contain one file specification.</span></span>
-   <span data-ttu-id="47711-127">Спецификации файла могут содержать?</span><span class="sxs-lookup"><span data-stu-id="47711-127">File specifications can contain the ?</span></span> <span data-ttu-id="47711-128">и \* подстановочные знаки.</span><span class="sxs-lookup"><span data-stu-id="47711-128">and \* wildcard characters.</span></span> <span data-ttu-id="47711-129">Спецификацию можно сделать рекурсивной, добавив/s в конец.</span><span class="sxs-lookup"><span data-stu-id="47711-129">A specification can be made recursive by appending /s to the end.</span></span> <span data-ttu-id="47711-130">Например, при указании "% TEMP% \\ \* /s" все файлы в каталоге% TEMP% и все его подкаталоги не будут создаваться.</span><span class="sxs-lookup"><span data-stu-id="47711-130">For example, specifying "%TEMP%\\\* /s" causes all files in the %TEMP% directory and all of its subdirectories not to be backed up.</span></span>

 

 



