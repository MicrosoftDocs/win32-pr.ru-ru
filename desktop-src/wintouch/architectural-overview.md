---
title: Основные сведения об архитектуре
description: В этом обзоре архитектуры представлен контекст для API сенсорного ввода Windows для технологий планшета и сенсорного ввода и объясняется, как он подходит для более крупной архитектуры Windows 7.
ms.assetid: b284e96f-0998-408c-ae84-92a3acdc3014
keywords:
- Windows Touch, обзор архитектуры
- Касание Windows, манипуляции
- Касание Windows, сообщения
- Касание Windows, инерция
- Касание Windows, жесты
- жесты, сведения
- манипуляции, о
- инерция, сведения
- процессор манипуляции, обзор архитектуры
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b807113211d77f0aad0ed01fc24570d033063474
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103987526"
---
# <a name="architectural-overview"></a><span data-ttu-id="4e54c-112">Основные сведения об архитектуре</span><span class="sxs-lookup"><span data-stu-id="4e54c-112">Architectural Overview</span></span>

<span data-ttu-id="4e54c-113">В этом обзоре архитектуры представлен контекст для API сенсорного ввода Windows для технологий планшета и сенсорного ввода и объясняется, как он подходит для более крупной архитектуры Windows 7.</span><span class="sxs-lookup"><span data-stu-id="4e54c-113">This architectural overview provides context for the Windows Touch API for Tablet and Touch Technologies and explains how it fits into the larger Windows 7 architecture.</span></span>

## <a name="messages-for-windows-touch-input-and-gestures"></a><span data-ttu-id="4e54c-114">Сообщения для сенсорного ввода и жестов Windows</span><span class="sxs-lookup"><span data-stu-id="4e54c-114">Messages for Windows Touch Input and Gestures</span></span>

<span data-ttu-id="4e54c-115">Функции обмена сообщениями для Windows Touch включены путем прослушивания и интерпретации сообщений во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="4e54c-115">Messaging features for Windows Touch are enabled by listening and interpreting messages during execution.</span></span> <span data-ttu-id="4e54c-116">На следующем рисунке показано, как сообщения формируются из оборудования и отправляются в приложения Windows 7.</span><span class="sxs-lookup"><span data-stu-id="4e54c-116">The following illustration shows how messages are generated from hardware and sent to applications by Windows 7.</span></span>

![Иллюстрация, показывающая, как Windows 7 отправляет сообщения от оборудования Мультисенсорная в приложение](images/wm-multitouch-messaging.png)

<span data-ttu-id="4e54c-118">В крайнем левом столбце иллюстрации сенсорно-чувствительное оборудование получает входные данные от пользователя.</span><span class="sxs-lookup"><span data-stu-id="4e54c-118">In the leftmost column of the illustration, touch-sensitive hardware receives input from a user.</span></span> <span data-ttu-id="4e54c-119">Затем драйвер взаимодействует между оборудованием и операционной системой.</span><span class="sxs-lookup"><span data-stu-id="4e54c-119">A driver then communicates between the hardware and the OS.</span></span> <span data-ttu-id="4e54c-120">Затем ОС создает сообщение [**\_ жеста**](wm-gesture.md) [**WM \_ Touch**](wm-touchdown.md) или WM, которое затем отправляется в HWND приложения.</span><span class="sxs-lookup"><span data-stu-id="4e54c-120">Next, the OS generates a [**WM\_TOUCH**](wm-touchdown.md) or [**WM\_GESTURE**](wm-gesture.md) message that is then sent to an application's HWND.</span></span> <span data-ttu-id="4e54c-121">Затем приложение обновляет пользовательский интерфейс, учитывая сведения, инкапсулированные в сообщении.</span><span class="sxs-lookup"><span data-stu-id="4e54c-121">The application then updates the UI given the information encapsulated in the message.</span></span>

<span data-ttu-id="4e54c-122">По умолчанию приложения получают жесты.</span><span class="sxs-lookup"><span data-stu-id="4e54c-122">Applications receive gestures by default.</span></span> <span data-ttu-id="4e54c-123">Если приложение не регистрирует входные сообщения касания Windows с помощью функции [**регистертаучвиндов**](/windows/desktop/api/winuser/nf-winuser-registertouchwindow) , уведомления для жестов ([**сообщения \_ жестов WM**](wm-gesture.md) ) создаются Windows и отправляются в это окно приложения.</span><span class="sxs-lookup"><span data-stu-id="4e54c-123">Unless an application registers for Windows Touch input messages with the [**RegisterTouchWindow**](/windows/desktop/api/winuser/nf-winuser-registertouchwindow) function, notifications for gestures ([**WM\_GESTURE**](wm-gesture.md) messages) are created by Windows and sent to that application window.</span></span> <span data-ttu-id="4e54c-124">Если окно приложения регистрируется для получения сенсорных сообщений, уведомления для сенсорного ввода Windows (сообщения [**\_ сенсорного экрана WM**](wm-touchdown.md) ) отправляются в это окно приложения.</span><span class="sxs-lookup"><span data-stu-id="4e54c-124">If an application Window registers to receive touch messages, notifications for Windows Touch input ([**WM\_TOUCH**](wm-touchdown.md) messages) are sent to that application window.</span></span> <span data-ttu-id="4e54c-125">Сообщения касания и жестов Windows являются жадными в том смысле, что после совершения касания или начала работы над окном приложения все сообщения отправляются в это приложение до тех пор, пока жест не завершится или не будет выполнено основное касание.</span><span class="sxs-lookup"><span data-stu-id="4e54c-125">Windows Touch and gesture messages are greedy in the sense that after a touch is made or a gesture begins on an application Window, all messages are sent to that application until the gesture completes or the primary touch is completed.</span></span>

<span data-ttu-id="4e54c-126">Для поддержки прежних версий Windows интерпретирует [**сообщения \_ жестов WM**](wm-gesture.md) , если они были собраны, а затем отправляют или разписывают соответствующие сообщения, сопоставленные с этим жестом.</span><span class="sxs-lookup"><span data-stu-id="4e54c-126">For legacy support, Windows interprets [**WM\_GESTURE**](wm-gesture.md) messages if they are bubbled up and then will SEND or POST appropriate messages that map to the gesture.</span></span> <span data-ttu-id="4e54c-127">Чтобы избежать нарушения поддержки устаревшей версии, убедитесь, что вы пересылаете \_ сообщения ЖЕСТОВ WM с помощью [дефвиндовпрок](/windows/win32/api/winuser/nf-winuser-defwindowproca).</span><span class="sxs-lookup"><span data-stu-id="4e54c-127">To avoid breaking legacy support, make sure that you forward WM\_GESTURE messages using [DefWindowProc](/windows/win32/api/winuser/nf-winuser-defwindowproca).</span></span> <span data-ttu-id="4e54c-128">Дополнительные сведения о поддержке устаревших версий можно найти в разделе [Общие сведения о сенсорных жестах Windows](windows-touch-gestures-overview.md).</span><span class="sxs-lookup"><span data-stu-id="4e54c-128">More information on legacy support can be found in the section [Windows Touch Gestures Overview](windows-touch-gestures-overview.md).</span></span>

## <a name="manipulations-and-inertia"></a><span data-ttu-id="4e54c-129">Манипуляции и инерция</span><span class="sxs-lookup"><span data-stu-id="4e54c-129">Manipulations and Inertia</span></span>

<span data-ttu-id="4e54c-130">Программисты Windows Touch должны уметь интерпретировать жесты из нескольких источников способом, который имеет смысл для жеста.</span><span class="sxs-lookup"><span data-stu-id="4e54c-130">Windows Touch programmers must be able to interpret gestures from multiple sources in a manner that is meaningful for the gesture taking place.</span></span> <span data-ttu-id="4e54c-131">Корпорация Майкрософт предоставляет API манипуляции для выполнения этих вычислений.</span><span class="sxs-lookup"><span data-stu-id="4e54c-131">Microsoft provides the manipulation API to perform these calculations.</span></span> <span data-ttu-id="4e54c-132">Манипуляции — это фактические жесты со связанными с ними значениями, описывающими весь жест.</span><span class="sxs-lookup"><span data-stu-id="4e54c-132">Manipulations are essentially gestures with values associated with them that describe the entire gesture.</span></span> <span data-ttu-id="4e54c-133">После подключения входных данных к обработчику манипуляции можно получить сведения, относящиеся к действиям, которые пользователь делает с объектом.</span><span class="sxs-lookup"><span data-stu-id="4e54c-133">After you connect the input data to the manipulation processor, you can retrieve information pertinent to action that the user makes on the object.</span></span> <span data-ttu-id="4e54c-134">На следующем рисунке показан один из способов использования манипуляций.</span><span class="sxs-lookup"><span data-stu-id="4e54c-134">The following figure shows one way you can use manipulations.</span></span>

![Иллюстрация, показывающая сообщения Windows Touch, переданные обработчику манипуляции объекта, который обрабатывает события с помощью \- интерфейса иманипулатионевентс](images/manipulation-arch.png)

<span data-ttu-id="4e54c-136">В верхнем левом углу экрана пользователь затронул экран, который создает сенсорные сообщения.</span><span class="sxs-lookup"><span data-stu-id="4e54c-136">In the top left of the illustration, the user has touched the screen, which creates touch messages.</span></span> <span data-ttu-id="4e54c-137">Эти сообщения содержат координаты x и y-координаты, используемые для определения объекта, наданного фокус.</span><span class="sxs-lookup"><span data-stu-id="4e54c-137">These messages contain an x-coordinate and a y-coordinate that are used to determine the object that is in focus.</span></span> <span data-ttu-id="4e54c-138">Объект в фокусе содержит обработчик манипуляции.</span><span class="sxs-lookup"><span data-stu-id="4e54c-138">The object in focus contains a manipulation processor.</span></span> <span data-ttu-id="4e54c-139">Затем в сообщении [**WM \_ Touch**](wm-touchdown.md) с флагом **таучевентф \_ up** выбирается объект в фокусе пользователя, выполняется ссылка на обработчик манипуляций, а сообщение отправляется обработчику манипуляции.</span><span class="sxs-lookup"><span data-stu-id="4e54c-139">Next, on the [**WM\_TOUCH**](wm-touchdown.md) message with the **TOUCHEVENTF\_UP** flag, the object in the user's focus is selected, the manipulation processor is referenced, and the message is sent to the manipulation processor.</span></span> <span data-ttu-id="4e54c-140">Последующие сообщения **WM \_ Touch** , связанные с этим контактом, отправляются в обработчик манипуляции до тех пор, пока не будет получено сообщение **WM \_ Touch** с флагом **таучевентф \_ up** , а выбранный объект не является разыменованным.</span><span class="sxs-lookup"><span data-stu-id="4e54c-140">Subsequent **WM\_TOUCH** messages associated with this contact are sent to the manipulation processor until the **WM\_TOUCH** message with the **TOUCHEVENTF\_UP** flag is received and the selected object is dereferenced.</span></span> <span data-ttu-id="4e54c-141">В нижней правой части иллюстрации показан приемник событий манипуляции, реализующий интерфейс [**\_ иманипулатионевентс**](/windows/win32/api/manipulations/nn-manipulations-_imanipulationevents) , для обработки событий манипуляции, которые вызываются во время создания сенсорных сообщений.</span><span class="sxs-lookup"><span data-stu-id="4e54c-141">In the bottom right section of the illustration, a manipulation event sink that implements the [**\_IManipulationEvents**](/windows/win32/api/manipulations/nn-manipulations-_imanipulationevents) interface is used to handle the manipulation events, which are raised while the touch messages are being created.</span></span> <span data-ttu-id="4e54c-142">Приемник событий может выполнять обновления интерфейса на основе событий манипуляции во время их возникновения.</span><span class="sxs-lookup"><span data-stu-id="4e54c-142">The event sink can perform updates to the interface based on the manipulation events while they occur.</span></span>

<span data-ttu-id="4e54c-143">В приложениях Windows Touch можно реализовать простую физику, чтобы объекты плавно приступили к прекращению, а не внезапно останавливаться, когда они больше не затрагиваются.</span><span class="sxs-lookup"><span data-stu-id="4e54c-143">In Windows Touch applications, it's common to incorporate simple physics so that objects smoothly come to a stop, rather than abruptly stop when they are no longer being touched.</span></span> <span data-ttu-id="4e54c-144">Корпорация Майкрософт предоставляет API инерции для выполнения вычислений для этой простой физикы, что позволяет приложению работать так же, как и другие приложения.</span><span class="sxs-lookup"><span data-stu-id="4e54c-144">Microsoft provides the Inertia API to perform the calculations for these simple physics so that your application can behave in a manner similar to other applications.</span></span> <span data-ttu-id="4e54c-145">Это также экономит усилия, необходимые для создания надежных физических функций.</span><span class="sxs-lookup"><span data-stu-id="4e54c-145">This also saves you the effort required to create robust physics functionality.</span></span> <span data-ttu-id="4e54c-146">На следующем рисунке показано, как можно использовать инерцию.</span><span class="sxs-lookup"><span data-stu-id="4e54c-146">The following figure shows how you can use inertia.</span></span>

![Иллюстрация, демонстрирующая передачу сообщений Windows Touch в интерфейс IInertiaProcessor объекта, который вызывает события с помощью \- интерфейса иманипулатионевентс](images/inertia-arch.png)

<span data-ttu-id="4e54c-148">Обратите внимание на сходства между инерцией и манипуляцией.</span><span class="sxs-lookup"><span data-stu-id="4e54c-148">Note the similarities between inertia and manipulation.</span></span> <span data-ttu-id="4e54c-149">Единственное различие между ними заключается в том, что в случае инерции интерпретируемые сообщения передаются в Процессор инерции, а не в обработчик манипуляции, и обработчик инерции создает события.</span><span class="sxs-lookup"><span data-stu-id="4e54c-149">The only difference between the two is that in the case of inertia, interpreted messages are handed to an inertia processor rather than a manipulation processor and the inertia processor raises the events.</span></span> <span data-ttu-id="4e54c-150">В верхнем левом углу экрана в сообщении [**WM \_ Touch**](wm-touchdown.md) с флагом **таучевентф \_ up** сообщения Touch используются для обозначения объекта в фокусе, который содержит процессор инерции и обработчик манипуляции.</span><span class="sxs-lookup"><span data-stu-id="4e54c-150">In the top left of the illustration, on the [**WM\_TOUCH**](wm-touchdown.md) message with the **TOUCHEVENTF\_UP** flag, touch messages are used to identify an object in focus that contains an inertia processor and a manipulation processor.</span></span> <span data-ttu-id="4e54c-151">Последующие сообщения **WM \_ Touch** отправляются в обработчик манипуляций, а обработчик манипуляции ВЫПОЛНЯЕТ обновления пользовательского интерфейса приложения.</span><span class="sxs-lookup"><span data-stu-id="4e54c-151">Subsequent **WM\_TOUCH** messages are sent to the manipulation processor and the manipulation processor performs updates to the application UI.</span></span> <span data-ttu-id="4e54c-152">После завершения манипуляции значения скорости из манипуляции используются для настройки процессора инерции.</span><span class="sxs-lookup"><span data-stu-id="4e54c-152">After the manipulation completes, velocity values from the manipulation are used to set up an inertia processor.</span></span> <span data-ttu-id="4e54c-153">Как показано в среднем столбце, метод [**Process**](/windows/desktop/api/manipulations/nf-manipulations-iinertiaprocessor-process) или [**процесстиме**](/windows/desktop/api/manipulations/nf-manipulations-iinertiaprocessor-processtime) вызывается в интерфейсе [**IInertiaProcessor**](/windows/desktop/api/manipulations/nn-manipulations-iinertiaprocessor) с помощью таймера или другого цикла в отдельном потоке, пока вызовы не указывают, что процессор завершает обработку.</span><span class="sxs-lookup"><span data-stu-id="4e54c-153">As illustrated in the middle column, the [**Process**](/windows/desktop/api/manipulations/nf-manipulations-iinertiaprocessor-process) or [**ProcessTime**](/windows/desktop/api/manipulations/nf-manipulations-iinertiaprocessor-processtime) method is called on the [**IInertiaProcessor**](/windows/desktop/api/manipulations/nn-manipulations-iinertiaprocessor) interface using a timer or other loop in a separate thread until the calls indicate the processor is finished processing.</span></span> <span data-ttu-id="4e54c-154">Хотя эти вызовы выполняются, создаются события манипуляции, которые обрабатываются приемником событий манипуляции на основе интерфейса [**\_ иманипулатионевентс**](/windows/win32/api/manipulations/nn-manipulations-_imanipulationevents) .</span><span class="sxs-lookup"><span data-stu-id="4e54c-154">While these calls are made, manipulation events are raised, which are handled by a manipulation event sink based on the [**\_IManipulationEvents**](/windows/win32/api/manipulations/nn-manipulations-_imanipulationevents) interface.</span></span> <span data-ttu-id="4e54c-155">В нижней правой части иллюстрации этот приемник событий выполняет обновления пользовательского интерфейса приложения на основе событий манипуляции, когда они происходят через обработчики событий в приемнике событий.</span><span class="sxs-lookup"><span data-stu-id="4e54c-155">At the bottom right section of the illustration, this event sink then performs updates to the application UI based on manipulation events when they occur through event handlers in the event sink.</span></span>

## <a name="related-topics"></a><span data-ttu-id="4e54c-156">См. также</span><span class="sxs-lookup"><span data-stu-id="4e54c-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4e54c-157">Руководство по программированию</span><span class="sxs-lookup"><span data-stu-id="4e54c-157">Programming Guide</span></span>](programming-guide.md)
</dt> </dl>

 

 