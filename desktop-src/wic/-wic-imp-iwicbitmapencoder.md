---
description: Реализация Ивикбитмапенкодер
ms.assetid: b671e941-ded6-4bde-bc4d-461f13feade0
title: Реализация Ивикбитмапенкодер
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 590dffcf762d22155a89a8143994d9a4d8bcab02
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103911952"
---
# <a name="implementing-iwicbitmapencoder"></a><span data-ttu-id="98f8d-103">Реализация Ивикбитмапенкодер</span><span class="sxs-lookup"><span data-stu-id="98f8d-103">Implementing IWICBitmapEncoder</span></span>

-   [<span data-ttu-id="98f8d-104">ивикбитмапенкодер</span><span class="sxs-lookup"><span data-stu-id="98f8d-104">IWICBitmapEncoder</span></span>](#implementing-iwicbitmapencoder)
    -   [<span data-ttu-id="98f8d-105">Инициализация</span><span class="sxs-lookup"><span data-stu-id="98f8d-105">Initialize</span></span>](#initialize)
    -   [<span data-ttu-id="98f8d-106">жетконтаинерформат</span><span class="sxs-lookup"><span data-stu-id="98f8d-106">GetContainerFormat</span></span>](#getcontainerformat)
    -   [<span data-ttu-id="98f8d-107">жетенкодеринфо</span><span class="sxs-lookup"><span data-stu-id="98f8d-107">GetEncoderInfo</span></span>](#getencoderinfo)
    -   [<span data-ttu-id="98f8d-108">CreateNewFrame</span><span class="sxs-lookup"><span data-stu-id="98f8d-108">CreateNewFrame</span></span>](#createnewframe)
    -   [<span data-ttu-id="98f8d-109">Фиксация</span><span class="sxs-lookup"><span data-stu-id="98f8d-109">Commit</span></span>](#commit)
    -   [<span data-ttu-id="98f8d-110">сетпревиев</span><span class="sxs-lookup"><span data-stu-id="98f8d-110">SetPreview</span></span>](#setpreview)
-   [<span data-ttu-id="98f8d-111">См. также</span><span class="sxs-lookup"><span data-stu-id="98f8d-111">Related topics</span></span>](#related-topics)

## <a name="iwicbitmapencoder"></a><span data-ttu-id="98f8d-112">ивикбитмапенкодер</span><span class="sxs-lookup"><span data-stu-id="98f8d-112">IWICBitmapEncoder</span></span>

-   [<span data-ttu-id="98f8d-113">Инициализация</span><span class="sxs-lookup"><span data-stu-id="98f8d-113">Initialize</span></span>](#initialize)
-   [<span data-ttu-id="98f8d-114">жетконтаинерформат</span><span class="sxs-lookup"><span data-stu-id="98f8d-114">GetContainerFormat</span></span>](#getcontainerformat)
-   [<span data-ttu-id="98f8d-115">жетенкодеринфо</span><span class="sxs-lookup"><span data-stu-id="98f8d-115">GetEncoderInfo</span></span>](#getencoderinfo)
-   [<span data-ttu-id="98f8d-116">CreateNewFrame</span><span class="sxs-lookup"><span data-stu-id="98f8d-116">CreateNewFrame</span></span>](#createnewframe)
-   [<span data-ttu-id="98f8d-117">Фиксация</span><span class="sxs-lookup"><span data-stu-id="98f8d-117">Commit</span></span>](#commit)
-   [<span data-ttu-id="98f8d-118">сетпревиев</span><span class="sxs-lookup"><span data-stu-id="98f8d-118">SetPreview</span></span>](#setpreview)

<span data-ttu-id="98f8d-119">Этот интерфейс является аналогом интерфейса [**ивикбитмапдекодер**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapdecoder) и является отправной точкой для кодирования файла изображения.</span><span class="sxs-lookup"><span data-stu-id="98f8d-119">This interface is the counterpart to the [**IWICBitmapDecoder**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapdecoder) interface and is the starting point for encoding an image file.</span></span> <span data-ttu-id="98f8d-120">Так же как **ивикбитмапдекодер** используется для получения свойств уровня контейнера и отдельных кадров из контейнера Image, [**ивикбитмапенкодер**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder) используется для установки свойств уровня контейнера и сериализации отдельных кадров изображения в контейнер.</span><span class="sxs-lookup"><span data-stu-id="98f8d-120">Just as **IWICBitmapDecoder** is used for retrieving container-level properties and individual frames from the image container, [**IWICBitmapEncoder**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder) is used for setting container-level properties and serializing individual image frames into the container.</span></span> <span data-ttu-id="98f8d-121">Этот интерфейс реализуется в классе кодировщика уровня контейнера.</span><span class="sxs-lookup"><span data-stu-id="98f8d-121">You implement this interface on your container-level encoder class.</span></span>

``` syntax
interface IWICBitmapEncoder : public IUnknown
{
   // Required methods
   HRESULT Initialize ( IStream *pIStream,
              WICBitmapEncoderCacheOption cacheOption );
   HRESULT GetContainerFormat ( GUID *pguidContainerFormat );
   HRESULT GetEncoderInfo ( IWICBitmapEncoderInfo **pIEncoderInfo );
   HRESULT CreateNewFrame ( IWICBitmapFrameEncode **ppIFrameEncode,
              IPropertyBag2 **ppIEncoderOptions );
   HRESULT Commit ( void );

   // Optional methods
   HRESULT SetPreview ( IWICBitmapSource *pIPreview );
   HRESULT SetThumbnail ( IWICBitmapSource *pIThumbnail );
   HRESULT SetColorContexts ( UINT cCount,
              IWICColorContext **ppIColorContext );
   HRESULT GetMetadataQueryWriter ( IWICMetadataQueryWriter 
              **ppIMetadataQueryWriter );
   HRESULT SetPalette ( IWICPalette *pIPalette);
};
```

<span data-ttu-id="98f8d-122">Как обсуждалось в разделе [Реализация ивикбитмапдекодер](-wic-imp-iwicbitmapdecoder.md), некоторые форматы изображений имеют глобальные эскизы, цветовые контексты или метаданные, а многие форматы изображений предоставляют их только для каждого фрейма.</span><span class="sxs-lookup"><span data-stu-id="98f8d-122">As discussed in [Implementing IWICBitmapDecoder](-wic-imp-iwicbitmapdecoder.md), some image formats have global thumbnails, color contexts, or metadata, while many image formats provide these only on a per-frame basis.</span></span> <span data-ttu-id="98f8d-123">Поэтому методы для их установки являются необязательными для [**ивикбитмапенкодер**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder), но требуются для [**ивикбитмапфраминкоде**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode).</span><span class="sxs-lookup"><span data-stu-id="98f8d-123">Therefore, the methods for setting these are optional on [**IWICBitmapEncoder**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder), but are required on [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode).</span></span> <span data-ttu-id="98f8d-124">Мы обсудим методы, которые являются необязательными в **ивикбитмапенкодер** в разделе **ивикбитмапфраминкоде**, где они чаще всего реализуются.</span><span class="sxs-lookup"><span data-stu-id="98f8d-124">We’ll discuss the methods that are optional on **IWICBitmapEncoder** in the section on **IWICBitmapFrameEncode**, where they’re most commonly implemented.</span></span>

<span data-ttu-id="98f8d-125">Если глобальные эскизы не поддерживаются, возвратите ВИНКОДЕК \_ Err \_ кодекносумбнаил из метода Сетсумбнаил в [**ивикбитмапенкодер**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder).</span><span class="sxs-lookup"><span data-stu-id="98f8d-125">If you don’t support global thumbnails, return WINCODEC\_ERR\_CODECNOTHUMBNAIL from the SetThumbnail method on [**IWICBitmapEncoder**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder).</span></span> <span data-ttu-id="98f8d-126">Если вы не поддерживаете палитру уровня контейнера или если закодированное изображение не имеет индексированного формата, то возвратите ВИНКОДЕК \_ Err \_ палеттеунаваилабле из метода сетпалетте.</span><span class="sxs-lookup"><span data-stu-id="98f8d-126">If you don’t support a container-level palette, or if the image you are encoding doesn’t have an indexed format, return WINCODEC\_ERR\_PALETTEUNAVAILABLE from the SetPalette method.</span></span> <span data-ttu-id="98f8d-127">Для любых других неподдерживаемых методов следует возвращать ВИНКОДЕК \_ Err \_ унсуппортедоператион.</span><span class="sxs-lookup"><span data-stu-id="98f8d-127">For any other unsupported methods, return WINCODEC\_ERR\_UNSUPPORTEDOPERATION.</span></span>

### <a name="initialize"></a><span data-ttu-id="98f8d-128">Инициализация</span><span class="sxs-lookup"><span data-stu-id="98f8d-128">Initialize</span></span>

<span data-ttu-id="98f8d-129">[**Initialize**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-initialize) — это первый метод, вызываемый в [**ивикбитмапенкодер**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder) после создания экземпляра.</span><span class="sxs-lookup"><span data-stu-id="98f8d-129">[**Initialize**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-initialize) is the first method invoked on an [**IWICBitmapEncoder**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder) after it has been instantiated.</span></span> <span data-ttu-id="98f8d-130">Поток изображения передается кодировщику, и вызывающий объект может дополнительно указать параметр кэширования.</span><span class="sxs-lookup"><span data-stu-id="98f8d-130">An image stream is passed to the encoder, and a caller may optionally specify a cache option.</span></span> <span data-ttu-id="98f8d-131">В случае декодера поток доступен только для чтения, но поток, передаваемый кодировщику, является записываемым потоком, в который кодировщик будет выполнять сериализацию всех данных и метаданных изображения.</span><span class="sxs-lookup"><span data-stu-id="98f8d-131">In the case of the decoder, the stream is read-only, but the stream passed to an encoder is a writeable stream, into which the encoder will serialize all of the image data and metadata.</span></span> <span data-ttu-id="98f8d-132">Параметры кэша в кодировщике также отличаются.</span><span class="sxs-lookup"><span data-stu-id="98f8d-132">The cache options on the encoder are different as well.</span></span>

``` syntax
enum WICBitmapEncoderCacheOption
{
   WICBitmapEncoderCacheInMemory,
   WICBitmapEncoderCacheTempFile,
   WICBitmapEncoderNoCache
}
```

<span data-ttu-id="98f8d-133">Приложение может запросить кодировщик для кэширования данных изображения в памяти, кэшировать его во временном файле или записать непосредственно в файл диска без кэширования.</span><span class="sxs-lookup"><span data-stu-id="98f8d-133">The application has a choice of requesting the encoder to cache the image data in memory, cache it in a temporary file, or to write it directly into the disk file with no caching.</span></span> <span data-ttu-id="98f8d-134">При появлении запроса на кэширование данных во временном файле кодировщик должен создать временный файл на диске и выполнить запись непосредственно в этот файл без кэширования в памяти.</span><span class="sxs-lookup"><span data-stu-id="98f8d-134">When asked to cache the data in a temporary file, the encoder should create a temporary file on disk and write directly to that file without caching in memory.</span></span> <span data-ttu-id="98f8d-135">Когда вызывающий объект выбирает параметр без кэширования, каждый кадр должен быть зафиксирован по порядку, прежде чем можно будет создать следующий кадр.</span><span class="sxs-lookup"><span data-stu-id="98f8d-135">When the caller selects the no cache option, each frame must be committed in order before the next frame can be created.</span></span>

### <a name="getcontainerformat"></a><span data-ttu-id="98f8d-136">жетконтаинерформат</span><span class="sxs-lookup"><span data-stu-id="98f8d-136">GetContainerFormat</span></span>

<span data-ttu-id="98f8d-137">[**Жетконтаинерформат**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-getcontainerformat) реализуется так же, как метод [Жетконтаинерформат](-wic-imp-iwicbitmapdecoder.md) в [реализации ивикбитмапдекодер](-wic-imp-iwicbitmapdecoder.md).</span><span class="sxs-lookup"><span data-stu-id="98f8d-137">[**GetContainerFormat**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-getcontainerformat) is implemented the same way as the [GetContainerFormat](-wic-imp-iwicbitmapdecoder.md) method in [Implementing IWICBitmapDecoder](-wic-imp-iwicbitmapdecoder.md).</span></span>

### <a name="getencoderinfo"></a><span data-ttu-id="98f8d-138">жетенкодеринфо</span><span class="sxs-lookup"><span data-stu-id="98f8d-138">GetEncoderInfo</span></span>

<span data-ttu-id="98f8d-139">[**Жетенкодеринфо**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-getencoderinfo) возвращает объект [**ивикбитмапенкодеринфо**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapencoderinfo) .</span><span class="sxs-lookup"><span data-stu-id="98f8d-139">[**GetEncoderInfo**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-getencoderinfo) returns an [**IWICBitmapEncoderInfo**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapencoderinfo) object.</span></span> <span data-ttu-id="98f8d-140">Чтобы получить объект **ивикбитмапенкодеринфо** , просто передайте идентификатор GUID кодировщика в метод [**креатекомпонентинфо**](/windows/desktop/api/Wincodec/nf-wincodec-iwicimagingfactory-createcomponentinfo) в [**IWICImagingFactory**](/windows/desktop/api/Wincodec/nn-wincodec-iwicimagingfactory), а затем запросите в нем интерфейс **ивикбитмапенкодеринфо** .</span><span class="sxs-lookup"><span data-stu-id="98f8d-140">To get the **IWICBitmapEncoderInfo** object, just pass the GUID of your encoder to the [**CreateComponentInfo**](/windows/desktop/api/Wincodec/nf-wincodec-iwicimagingfactory-createcomponentinfo) method on [**IWICImagingFactory**](/windows/desktop/api/Wincodec/nn-wincodec-iwicimagingfactory), and then request the **IWICBitmapEncoderInfo** interface on it.</span></span>

<span data-ttu-id="98f8d-141">См. пример в разделе [Реализация ивикбитмапдекодер](-wic-imp-iwicbitmapdecoder.md) в [жетдекодеринфо](-wic-imp-iwicbitmapdecoder.md).</span><span class="sxs-lookup"><span data-stu-id="98f8d-141">See the example in [Implementing IWICBitmapDecoder](-wic-imp-iwicbitmapdecoder.md) under [GetDecoderInfo](-wic-imp-iwicbitmapdecoder.md).</span></span>

### <a name="createnewframe"></a><span data-ttu-id="98f8d-142">CreateNewFrame</span><span class="sxs-lookup"><span data-stu-id="98f8d-142">CreateNewFrame</span></span>

<span data-ttu-id="98f8d-143">[**CreateNewFrame**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-createnewframe) является аналогом [**noframes**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapdecoder-getframe) в [**ивикбитмапдекодер**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapdecoder).</span><span class="sxs-lookup"><span data-stu-id="98f8d-143">[**CreateNewFrame**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-createnewframe) is the encoder counterpart of [**GetFrame**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapdecoder-getframe) on [**IWICBitmapDecoder**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapdecoder).</span></span> <span data-ttu-id="98f8d-144">Этот метод возвращает объект [**ивикбитмапфраминкоде**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) , который представляет собой объект, который фактически сериализует данные изображения для определенного кадра в контейнере.</span><span class="sxs-lookup"><span data-stu-id="98f8d-144">This method returns an [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) object, which is the object that actually serializes the image data for a specific frame within the container.</span></span>

<span data-ttu-id="98f8d-145">Одним из преимуществ компонента Windows Imaging Component (WIC) является то, что он предоставляет уровень абстракции для приложений, которые позволяют им работать со всеми форматами изображений одинаковым образом.</span><span class="sxs-lookup"><span data-stu-id="98f8d-145">One of the benefits of Windows Imaging Component (WIC) is that it provides a layer of abstraction for applications that enables them to work with all image formats in the same way.</span></span> <span data-ttu-id="98f8d-146">Однако не все форматы изображений одинаковы.</span><span class="sxs-lookup"><span data-stu-id="98f8d-146">However, not all image formats are exactly the same.</span></span> <span data-ttu-id="98f8d-147">Некоторые форматы изображений имеют возможности, которые у других пользователей нет.</span><span class="sxs-lookup"><span data-stu-id="98f8d-147">Some image formats have capabilities that others don’t have.</span></span> <span data-ttu-id="98f8d-148">Чтобы приложения могли воспользоваться преимуществами этих уникальных возможностей, необходимо предоставить кодеку способ их предоставления.</span><span class="sxs-lookup"><span data-stu-id="98f8d-148">For applications to be able to take advantage of those unique capabilities, it’s necessary to provide a way for the codec to expose them.</span></span> <span data-ttu-id="98f8d-149">Это назначение параметров кодировщика.</span><span class="sxs-lookup"><span data-stu-id="98f8d-149">This is the purpose of encoder options.</span></span> <span data-ttu-id="98f8d-150">Если кодек поддерживает любые параметры кодировщика, следует создать объект [IPropertyBag2](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768192(v=vs.85)) , предоставляющий Поддерживаемые параметры кодировщика, и вернуть его в параметр *ппиенкодероптионс* этого метода.</span><span class="sxs-lookup"><span data-stu-id="98f8d-150">If your codec supports any encoder options, you should create an [IPropertyBag2](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768192(v=vs.85)) object that exposes the encoder options you support, and return it in the *ppIEncoderOptions* parameter of this method.</span></span> <span data-ttu-id="98f8d-151">Затем вызывающий может использовать этот объект IPropertyBag2, чтобы определить, какие параметры кодировщика поддерживает кодек.</span><span class="sxs-lookup"><span data-stu-id="98f8d-151">The caller can then use this IPropertyBag2 object to determine what encoder options your codec supports.</span></span> <span data-ttu-id="98f8d-152">Если вызывающий объект хочет указать значения для любого из поддерживаемых параметров кодировщика, он присвоит значение соответствующему свойству в объекте IPropertyBag2 и передаст его в созданный объект [**ивикбитмапфраминкоде**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) в его методе Initialize.</span><span class="sxs-lookup"><span data-stu-id="98f8d-152">If the caller wants to specify values for any of the supported encoder options, they will assign the value to the relevant property in the IPropertyBag2 object and pass it to the newly created [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) object in its Initialize method.</span></span>

<span data-ttu-id="98f8d-153">Чтобы создать экземпляр объекта [IPropertyBag2](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768192(v=vs.85)) , необходимо сначала создать структуру PROPBAG2, чтобы указать каждый параметр кодировщика, поддерживаемый кодировщиком, и его тип данных для каждого свойства.</span><span class="sxs-lookup"><span data-stu-id="98f8d-153">To instantiate an [IPropertyBag2](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768192(v=vs.85)) object, you first need to create a PROPBAG2 struct to specify each encoder option your encoder supports and its data type for each property.</span></span> <span data-ttu-id="98f8d-154">Затем необходимо реализовать объект IPropertyBag2, который применяет диапазоны значений для каждого свойства при записи и согласовывает любые конфликтующие или перекрывающиеся значения.</span><span class="sxs-lookup"><span data-stu-id="98f8d-154">Then you must implement an IPropertyBag2 object that enforces the value ranges for each property on write, and reconciles any conflicting or overlapping values.</span></span> <span data-ttu-id="98f8d-155">Для простых наборов неконфликтующих параметров кодировщика можно вызвать метод [**креатинкодерпропертибаг**](/windows/desktop/api/Wincodecsdk/nf-wincodecsdk-iwiccomponentfactory-createencoderpropertybag) , который создаст простой объект IPropertyBag2, используя свойства, указанные в структуре PROPBAG2.</span><span class="sxs-lookup"><span data-stu-id="98f8d-155">For simple sets of non-conflicting encoder options, you can invoke the [**CreateEncoderPropertyBag**](/windows/desktop/api/Wincodecsdk/nf-wincodecsdk-iwiccomponentfactory-createencoderpropertybag) method, which will create a simple IPropertyBag2 object using the properties you specify in your PROPBAG2 struct.</span></span> <span data-ttu-id="98f8d-156">По-прежнему необходимо применять диапазоны значений.</span><span class="sxs-lookup"><span data-stu-id="98f8d-156">You must still enforce the value ranges.</span></span> <span data-ttu-id="98f8d-157">Для более сложных вариантов кодировщика или при необходимости согласования конфликтующих значений следует написать собственную реализацию IPropertyBag2.</span><span class="sxs-lookup"><span data-stu-id="98f8d-157">For more advanced encoder options, or if you need to reconcile conflicting values, you should write your own IPropertyBag2 implementation.</span></span>


```C++
UINT cuiPropertyCount = 0;
IPropertyBag2* pPropertyBag = NULL;
PROPBAG2* pPropBagOptions;
HRESULT hr;

// Insert code here to initialize piPropertyBag with the 
// supported options for your encoder, and to initialize 
// cuiPropertyCount to the number of encoder option properties
// you are exposing.
...

hr = pComponentFactory->CreateEncoderPropertyBag( 
   pPropBagOptions, cuiPropertyCount, &pPropertyBag);
```



<span data-ttu-id="98f8d-158">Компонент WIC предоставляет небольшой набор стандартных параметров кодировщика, используемых некоторыми распространенными форматами изображений.</span><span class="sxs-lookup"><span data-stu-id="98f8d-158">WIC provides a small set of canonical encoder options that are used by some of the common image formats.</span></span> <span data-ttu-id="98f8d-159">Все канонические параметры кодировщика являются необязательными, и кодеки не обязательно должны поддерживать их.</span><span class="sxs-lookup"><span data-stu-id="98f8d-159">All of the canonical encoder options are optional, and codecs are not required to support any of them.</span></span> <span data-ttu-id="98f8d-160">Причина, по которой они предоставляются как канонические параметры, заключается в том, что многие приложения предоставляют пользователям пользовательский интерфейс для указания этих параметров при сохранении файла изображения в формате, который их поддерживает.</span><span class="sxs-lookup"><span data-stu-id="98f8d-160">The reason they are provided as canonical options is because many applications expose the user interface for users to specify these options when saving an image file in a format that supports them.</span></span> <span data-ttu-id="98f8d-161">Предоставление канонического способа указания этих параметров упрощает для приложений передачу их кодировщикам согласованным образом.</span><span class="sxs-lookup"><span data-stu-id="98f8d-161">Providing a canonical way to specify these options makes it easy for applications to communicate them to encoders in a consistent way.</span></span> <span data-ttu-id="98f8d-162">Параметры канонического кодировщика перечислены в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="98f8d-162">The canonical encoder options are listed in the following table.</span></span>



| <span data-ttu-id="98f8d-163">Параметр кодировщика</span><span class="sxs-lookup"><span data-stu-id="98f8d-163">Encoder Option</span></span>     | <span data-ttu-id="98f8d-164">VARTYPE</span><span class="sxs-lookup"><span data-stu-id="98f8d-164">VARTYPE</span></span>  | <span data-ttu-id="98f8d-165">Диапазон значений:</span><span class="sxs-lookup"><span data-stu-id="98f8d-165">Value Range</span></span>               |
|--------------------|----------|---------------------------|
| <span data-ttu-id="98f8d-166">Lossless</span><span class="sxs-lookup"><span data-stu-id="98f8d-166">Lossless</span></span>           | <span data-ttu-id="98f8d-167">Логическое значение VT \_</span><span class="sxs-lookup"><span data-stu-id="98f8d-167">VT\_BOOL</span></span> | <span data-ttu-id="98f8d-168">Истина/ложь</span><span class="sxs-lookup"><span data-stu-id="98f8d-168">True/False</span></span>                |
| <span data-ttu-id="98f8d-169">ImageQuality</span><span class="sxs-lookup"><span data-stu-id="98f8d-169">ImageQuality</span></span>       | <span data-ttu-id="98f8d-170">VT \_ R4</span><span class="sxs-lookup"><span data-stu-id="98f8d-170">VT\_R4</span></span>   | <span data-ttu-id="98f8d-171">0.0 – 1,0</span><span class="sxs-lookup"><span data-stu-id="98f8d-171">0.0-1.0</span></span>                   |
| <span data-ttu-id="98f8d-172">CompressionQuality</span><span class="sxs-lookup"><span data-stu-id="98f8d-172">CompressionQuality</span></span> | <span data-ttu-id="98f8d-173">VT \_ R4</span><span class="sxs-lookup"><span data-stu-id="98f8d-173">VT\_R4</span></span>   | <span data-ttu-id="98f8d-174">0.0 – 1,0</span><span class="sxs-lookup"><span data-stu-id="98f8d-174">0.0-1.0</span></span>                   |
| <span data-ttu-id="98f8d-175">битмаптрансформ</span><span class="sxs-lookup"><span data-stu-id="98f8d-175">BitmapTransform</span></span>    | <span data-ttu-id="98f8d-176">VT \_ UI1</span><span class="sxs-lookup"><span data-stu-id="98f8d-176">VT\_UI1</span></span>  | <span data-ttu-id="98f8d-177">викбитмаптрансформоптионс</span><span class="sxs-lookup"><span data-stu-id="98f8d-177">WICBitmapTransformOptions</span></span> |



 

<span data-ttu-id="98f8d-178">Если кодек поддерживает кодирование без потерь, следует использовать параметр кодировщика без потерь, чтобы приложения запрашивают, что образ будет кодироваться без потерь.</span><span class="sxs-lookup"><span data-stu-id="98f8d-178">If your codec supports lossless encoding, you should expose the Lossless encoder option as a way for applications to request that an image be losslessly encoded.</span></span> <span data-ttu-id="98f8d-179">Если вызывающий объект устанавливает для этого свойства значение true, следует игнорировать параметр Имажекуалити и кодировать изображение без потерь.</span><span class="sxs-lookup"><span data-stu-id="98f8d-179">If a caller sets this property to True, you should ignore the ImageQuality option and encode the image losslessly.</span></span>

<span data-ttu-id="98f8d-180">Параметр Имажекуалити позволяет приложению указать степень точности, с которой будет кодироваться изображение.</span><span class="sxs-lookup"><span data-stu-id="98f8d-180">The ImageQuality option allows an application to specify the degree of fidelity with which to encode the image.</span></span> <span data-ttu-id="98f8d-181">Этот параметр позволяет пользователю установить компромисс между качеством изображения и скоростью и (или) размером файла.</span><span class="sxs-lookup"><span data-stu-id="98f8d-181">This option lets a user make a tradeoff between image quality versus speed and/or file size.</span></span> <span data-ttu-id="98f8d-182">JPEG — это пример формата изображения, поддерживающего это компромисс.</span><span class="sxs-lookup"><span data-stu-id="98f8d-182">JPEG is an example of an image format that supports this tradeoff.</span></span> <span data-ttu-id="98f8d-183">Значение 0,0 указывает, что качество имеет низкую важность, а кодировщик должен использовать его самый новый алгоритм потери данных.</span><span class="sxs-lookup"><span data-stu-id="98f8d-183">A value of 0.0 indicates that fidelity is of low importance and the encoder should use its most lossy algorithm.</span></span> <span data-ttu-id="98f8d-184">Значение 1,0 указывает, что наиболее важной является точность, и кодировщик должен сохранить максимально возможную точность.</span><span class="sxs-lookup"><span data-stu-id="98f8d-184">A value of 1.0 indicates that fidelity is the most important and the encoder should preserve the highest fidelity possible.</span></span> <span data-ttu-id="98f8d-185">(В зависимости от кодека это может быть синонимом параметра без потерь.</span><span class="sxs-lookup"><span data-stu-id="98f8d-185">(Depending on your codec, this may be synonymous with the Lossless option.</span></span> <span data-ttu-id="98f8d-186">Однако если кодек поддерживает кодирование без потерь, а параметр без потерь имеет значение true, параметр Имажекуалити следует игнорировать.)</span><span class="sxs-lookup"><span data-stu-id="98f8d-186">However, if your codec supports lossless encoding, and if the Lossless option is set to True, the ImageQuality option should be ignored.)</span></span>

<span data-ttu-id="98f8d-187">Параметр Компрессионкуалити позволяет приложению указать эффективность сжатия для использования при кодировании изображения.</span><span class="sxs-lookup"><span data-stu-id="98f8d-187">The CompressionQuality option allows an application to specify the efficiency of compression to use when encoding the image.</span></span> <span data-ttu-id="98f8d-188">Очень эффективный алгоритм может создать файл изображения меньшего размера с тем же качеством, что и менее эффективный алгоритм сжатия, но кодирование может занять больше времени.</span><span class="sxs-lookup"><span data-stu-id="98f8d-188">A very efficient algorithm may produce a smaller image file with the same quality as a less efficient compression algorithm, but may take longer to encode.</span></span> <span data-ttu-id="98f8d-189">Этот параметр позволяет пользователю задать компромисс между размером файла и скоростью кодирования, сохраняя тот же уровень качества.</span><span class="sxs-lookup"><span data-stu-id="98f8d-189">This option lets a user specify a tradeoff between file size versus speed of encoding, while preserving the same level of quality.</span></span> <span data-ttu-id="98f8d-190">TIFF — это пример формата изображения, поддерживающего такое компромиссное соотношение.</span><span class="sxs-lookup"><span data-stu-id="98f8d-190">TIFF is an example of an image format that supports this tradeoff.</span></span> <span data-ttu-id="98f8d-191">(Обратите внимание, что формат JPEG поддерживает различные уровни сжатия, но более высокая скорость сжатия приводит к более низкому качеству изображения.</span><span class="sxs-lookup"><span data-stu-id="98f8d-191">(Note that a format such as JPEG supports different levels of compression, but a higher rate of compression results in lower image quality.</span></span> <span data-ttu-id="98f8d-192">Поэтому формат изображения JPEG будет предоставлять параметр Имажекуалити, а не параметр Компрессионкуалити.) Значение 0,0 для этого параметра указывает, что следует как можно быстрее сжимать образ без снижения точности, за счет увеличения размера файла.</span><span class="sxs-lookup"><span data-stu-id="98f8d-192">Therefore, a JPEG image format would expose the ImageQuality option rather than the CompressionQuality option.) A value of 0.0 for this option indicates that you should compress the image as quickly as possible, without reducing fidelity, at the expense of a larger file size.</span></span> <span data-ttu-id="98f8d-193">Значение 1,0 указывает, что следует создать наименьший возможный размер файла (с тем же уровнем качества), независимо от того, сколько времени может потребоваться для его кодирования.</span><span class="sxs-lookup"><span data-stu-id="98f8d-193">A value of 1.0 indicates that you should create the smallest possible file size (at the same level of quality), regardless of how long it may take to encode it.</span></span> <span data-ttu-id="98f8d-194">Кодек может поддерживать как параметр Имажекуалити, так и параметр Компрессионкуалити, где параметр Имажекуалити задает приемлемую степень потери, а параметр Компрессионкуалити обеспечивает компромисс по размеру и скорости на указанном уровне качества.</span><span class="sxs-lookup"><span data-stu-id="98f8d-194">A codec can support both the ImageQuality option and the CompressionQuality option, where the ImageQuality option specifies the acceptable degree of lossiness, and the CompressionQuality option offers a size/speed tradeoff at the specified quality level.</span></span>

<span data-ttu-id="98f8d-195">Параметр Битмаптрансформ позволяет вызывающему объекту указать угол поворота или вертикальную или горизонтальную ориентацию при кодировании.</span><span class="sxs-lookup"><span data-stu-id="98f8d-195">The BitmapTransform option provides a way for the caller to specify a rotation angle or vertical or horizontal flip orientation when encoding.</span></span> <span data-ttu-id="98f8d-196">Перечисление Викбитмаптрансформоптионс, используемое для указания запрошенного преобразования, — это то же перечисление, которое используется при запросе преобразования во время декодирования через интерфейс Ивикбитмапсаурцетрансформ.</span><span class="sxs-lookup"><span data-stu-id="98f8d-196">The WICBitmapTransformOptions enum used to specify the requested transform is the same enum used when requesting a transform during decoding through the IWICBitmapSourceTransform interface.</span></span>

<span data-ttu-id="98f8d-197">Обратите внимание, что кодировщики не ограничиваются стандартными параметрами кодировщика.</span><span class="sxs-lookup"><span data-stu-id="98f8d-197">Note that encoders are not limited to the canonical encoder options.</span></span> <span data-ttu-id="98f8d-198">Назначение параметров кодировщика заключается в том, чтобы позволить кодировщикам предоставлять свои возможности, а также не ограничивать типы возможностей, которые можно предоставлять.</span><span class="sxs-lookup"><span data-stu-id="98f8d-198">The purpose of encoder options is to enable encoders to expose their capabilities, and there is no limit to the types of capabilities you can expose.</span></span> <span data-ttu-id="98f8d-199">Убедитесь, что параметры кодировщика хорошо документированы.</span><span class="sxs-lookup"><span data-stu-id="98f8d-199">Make sure your encoder options are well-documented.</span></span> <span data-ttu-id="98f8d-200">Несмотря на то, что приложение может использовать контейнер свойств, возвращаемый этим методом для обнаружения имен, типов и диапазонов значений для поддерживаемых параметров, единственный способ найти их значения или как предоставить их в пользовательском интерфейсе — из вашей документации.</span><span class="sxs-lookup"><span data-stu-id="98f8d-200">Even though an application can use the property bag you return from this method to discover the names, types, and value ranges for the options you support, the only way for them to find out their meanings, or how to expose them in the user interface, is from your documentation.</span></span>

### <a name="commit"></a><span data-ttu-id="98f8d-201">Commit</span><span class="sxs-lookup"><span data-stu-id="98f8d-201">Commit</span></span>

<span data-ttu-id="98f8d-202">[**Commit**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-commit) — это метод, который вызывается после сериализации всех данных изображения и метаданных в поток.</span><span class="sxs-lookup"><span data-stu-id="98f8d-202">[**Commit**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-commit) is the method you call after all the image data and metadata have been serialized into the stream.</span></span> <span data-ttu-id="98f8d-203">Этот метод следует использовать для сериализации данных предварительного просмотра изображения в поток и всех глобальных эскизов, метаданных, палитры или других элементов, если применимо.</span><span class="sxs-lookup"><span data-stu-id="98f8d-203">You should use this method to serialize the Preview image data into the stream, and any global thumbnails, metadata, palette, or other items, if applicable.</span></span> <span data-ttu-id="98f8d-204">Этот метод не должен закрывать файловый поток, так как ожидается, что приложение, открывшие поток, закроет его.</span><span class="sxs-lookup"><span data-stu-id="98f8d-204">This method should not close the file stream, because the application that opened the stream is expected to close it.</span></span>

<span data-ttu-id="98f8d-205">В разделе метода Ивикбитмапфраминкоде: Commit содержатся подробные сведения о влиянии Ивикбитмапенкодеркачеоптионс на поведение этого метода.</span><span class="sxs-lookup"><span data-stu-id="98f8d-205">The section on the IWICBitmapFrameEncode:Commit method has details on how the IWICBitmapEncoderCacheOptions affect the behavior of this method.</span></span>

### <a name="setpreview"></a><span data-ttu-id="98f8d-206">сетпревиев</span><span class="sxs-lookup"><span data-stu-id="98f8d-206">SetPreview</span></span>

<span data-ttu-id="98f8d-207">[**Сетпревиев**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-setpreview) используется для создания предварительной версии изображения.</span><span class="sxs-lookup"><span data-stu-id="98f8d-207">[**SetPreview**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-setpreview) is used to create a preview of the image.</span></span> <span data-ttu-id="98f8d-208">Хотя для каждого образа Предварительная версия не является обязательной, настоятельно рекомендуется использовать его.</span><span class="sxs-lookup"><span data-stu-id="98f8d-208">While it is not strictly required that every image have a preview, it is highly recommended.</span></span> <span data-ttu-id="98f8d-209">Современные цифровые камеры и сканеры создают высококачественные образы, которые, как правило, очень велики, и, следовательно, принимают значительное время обработки для декодирования.</span><span class="sxs-lookup"><span data-stu-id="98f8d-209">Modern digital cameras and scanners generate very high resolution images, which tend to be very large and, consequently, take significant processing time to decode.</span></span> <span data-ttu-id="98f8d-210">Изображения, создаваемые камерами следующего поколения, будут еще больше.</span><span class="sxs-lookup"><span data-stu-id="98f8d-210">Images from the next generation of cameras will be even larger.</span></span> <span data-ttu-id="98f8d-211">Рекомендуется предоставлять более низкую версию изображения с низким разрешением, обычно в формате JPEG, которую можно быстро декодировать и отображать мгновенно, когда пользователь запросит его.</span><span class="sxs-lookup"><span data-stu-id="98f8d-211">It’s a good idea to provide a smaller, lower resolution version of an image, typically in JPEG format, that can be quickly decoded and displayed “instantly” when a user requests it.</span></span> <span data-ttu-id="98f8d-212">Приложение может запросить предварительную версию перед запросом на декодирование действительного образа, чтобы обеспечить лучшую работу для пользователей, и отобразить их представление размера экрана, сэйаре в ожидании декодирования фактического изображения.</span><span class="sxs-lookup"><span data-stu-id="98f8d-212">An application may request a preview before requesting the actual image to be decoded to provide a better experience for users, and show them a screen-size representation of the image while theyare waiting to decode the actual image.</span></span> <span data-ttu-id="98f8d-213">Хотя кодеки должны предоставлять предварительные версии, кодеки, не поддерживающие [**ивикбитмапсаурцетрансформ**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform) , должны в определенном времени делать это.</span><span class="sxs-lookup"><span data-stu-id="98f8d-213">Although codecs should provide previews, codecs that do not support [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform) should definitely do so.</span></span>

<span data-ttu-id="98f8d-214">Если вы предписываете предварительный просмотр JPEG, вам не нужно писать кодировщик JPEG для его кодирования.</span><span class="sxs-lookup"><span data-stu-id="98f8d-214">If you provide a JPEG preview, you don’t have to write a JPEG encoder to encode it.</span></span> <span data-ttu-id="98f8d-215">Необходимо делегировать кодировщику JPEG, который поставляется с платформой WIC, для кодирования как предварительных, так и эскизов.</span><span class="sxs-lookup"><span data-stu-id="98f8d-215">You should delegate to the JPEG encoder that ships with the WIC platform for encoding both previews and thumbnails.</span></span>

## <a name="related-topics"></a><span data-ttu-id="98f8d-216">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="98f8d-216">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="98f8d-217">**Reference**</span><span class="sxs-lookup"><span data-stu-id="98f8d-217">**Reference**</span></span>
</dt> <dt>

[<span data-ttu-id="98f8d-218">**ивикбитмапенкодер**</span><span class="sxs-lookup"><span data-stu-id="98f8d-218">**IWICBitmapEncoder**</span></span>](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder)
</dt> <dt>

[<span data-ttu-id="98f8d-219">**ивикбитмапфраминкоде**</span><span class="sxs-lookup"><span data-stu-id="98f8d-219">**IWICBitmapFrameEncode**</span></span>](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode)
</dt> <dt>

<span data-ttu-id="98f8d-220">**Зрения**</span><span class="sxs-lookup"><span data-stu-id="98f8d-220">**Conceptual**</span></span>
</dt> <dt>

[<span data-ttu-id="98f8d-221">Интерфейсы кодировщика</span><span class="sxs-lookup"><span data-stu-id="98f8d-221">Encoder Interfaces</span></span>](-wic-encoderinterfaces.md)
</dt> <dt>

[<span data-ttu-id="98f8d-222">Реализация Ивикбитмапкодекпрогресснотификатион (кодировщик)</span><span class="sxs-lookup"><span data-stu-id="98f8d-222">Implementing IWICBitmapCodecProgressNotification (Encoder)</span></span>](-wic-imp-iwicbitmapcodecprogressnotification-encoder.md)
</dt> <dt>

[<span data-ttu-id="98f8d-223">Написание WIC-Enabled КОДЕка</span><span class="sxs-lookup"><span data-stu-id="98f8d-223">How to Write a WIC-Enabled CODEC</span></span>](-wic-howtowriteacodec.md)
</dt> <dt>

[<span data-ttu-id="98f8d-224">Общие сведения о компоненте создания образов Windows</span><span class="sxs-lookup"><span data-stu-id="98f8d-224">Windows Imaging Component Overview</span></span>](-wic-about-windows-imaging-codec.md)
</dt> </dl>

 

 
