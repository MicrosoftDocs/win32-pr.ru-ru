---
description: Рекомендации по реализации сериализации параметров Ивикдевелоправ
ms.assetid: 4ecff5cc-24f3-4b89-b681-85c867b053e7
title: Рекомендации по реализации сериализации параметров Ивикдевелоправ
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 48cdc78f68e6d63ee7870b9296ae4cfa4f85547a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103816081"
---
# <a name="implementation-guidelines-for-serializing-iwicdevelopraw-settings"></a><span data-ttu-id="81d03-103">Рекомендации по реализации сериализации параметров Ивикдевелоправ</span><span class="sxs-lookup"><span data-stu-id="81d03-103">Implementation Guidelines for Serializing IWICDevelopRaw Settings</span></span>

<span data-ttu-id="81d03-104">Интерфейс [**ивикдевелоправ**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) предоставляет параметры, которые приложение может использовать для изменения обработки необработанного изображения.</span><span class="sxs-lookup"><span data-stu-id="81d03-104">The [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) interface exposes settings that the application can use to modify the processing of the RAW image.</span></span> <span data-ttu-id="81d03-105">Параметры должны быть сериализованы, чтобы они сохранялись в разных сеансах.</span><span class="sxs-lookup"><span data-stu-id="81d03-105">The settings should be able to be serialized so that they persist across sessions.</span></span> <span data-ttu-id="81d03-106">Хотя это может быть сделано несколькими способами, рекомендуется кодировать эти данные способом, согласованным с другими метаданными.</span><span class="sxs-lookup"><span data-stu-id="81d03-106">Although this can be done in several ways, it is recommended to encode this data in a manner that is consistent with other metadata.</span></span>

<span data-ttu-id="81d03-107">Ниже приведены некоторые общие рекомендации по реализации.</span><span class="sxs-lookup"><span data-stu-id="81d03-107">The following are some general implementation guidelines:</span></span>

-   <span data-ttu-id="81d03-108">Любые параметры, сделанные через [**ивикдевелоправ**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) (например, поворот или белый баланс), должны избегать перезаписи параметров камеры или данных "как-снимок", если только тег не используется в качестве текущего параметра.</span><span class="sxs-lookup"><span data-stu-id="81d03-108">Any settings made via [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) (such as rotation or white balance) should avoid overwriting camera setting or "as-shot" data unless the tag is commonly used as a "current setting."</span></span> <span data-ttu-id="81d03-109">Например, Теги ориентации EXIF можно использовать для сохранения вращения.</span><span class="sxs-lookup"><span data-stu-id="81d03-109">For example, EXIF orientation tags can be used to persist rotation.</span></span>
-   <span data-ttu-id="81d03-110">Предпочтительно не сохранять весь файл (включая мозаику данных пикселей) каждый раз, когда запрашивается сериализация параметров [**ивикдевелоправ**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) .</span><span class="sxs-lookup"><span data-stu-id="81d03-110">It is preferable not to have to save the entire file (including the mosaic pixel data) each time that the [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) settings are asked to be serialized.</span></span>
-   <span data-ttu-id="81d03-111">Процесс сериализации параметров [**ивикдевелоправ**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) , как правило, соответствует этому порядку событий.</span><span class="sxs-lookup"><span data-stu-id="81d03-111">The process of serializing [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) settings will generally follow this order of events.</span></span> <span data-ttu-id="81d03-112">Характеристики этого приложения:</span><span class="sxs-lookup"><span data-stu-id="81d03-112">The application:</span></span>

    1.  <span data-ttu-id="81d03-113">Создает экземпляр [**ивикбитмапдекодер**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapdecoder) для необработанного файла.</span><span class="sxs-lookup"><span data-stu-id="81d03-113">Instantiates an [**IWICBitmapDecoder**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapdecoder) on a RAW file.</span></span>
    2.  <span data-ttu-id="81d03-114">Вызывает [**ивикбитмапдекодер**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapdecoder)::[**noframes**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapdecoder-getframe) , чтобы получить [**IWICBitmapFrameDecode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframedecode) для необработанного кадра.</span><span class="sxs-lookup"><span data-stu-id="81d03-114">Calls [**IWICBitmapDecoder**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapdecoder)::[**GetFrame**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapdecoder-getframe) to get an [**IWICBitmapFrameDecode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframedecode) for the RAW frame.</span></span>
    3.  <span data-ttu-id="81d03-115">Вызывает QueryInterface в интерфейсе IWICBitmapFrameDecode для интерфейса Ивикдевелоправ.</span><span class="sxs-lookup"><span data-stu-id="81d03-115">Calls QueryInterface on the IWICBitmapFrameDecode interface for the IWICDevelopRaw interface.</span></span>
    4.  <span data-ttu-id="81d03-116">Вызывает метод [**ивикдевелоправ**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw)::[**жеткуррентпараметерсет**](/windows/desktop/api/Wincodec/nf-wincodec-iwicdevelopraw-getcurrentparameterset), который возвращает интерфейс IPropertyBag2 со всеми текущими свойствами, хранящимися в нем.</span><span class="sxs-lookup"><span data-stu-id="81d03-116">Calls [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw)::[**GetCurrentParameterSet**](/windows/desktop/api/Wincodec/nf-wincodec-iwicdevelopraw-getcurrentparameterset), which returns an IPropertyBag2 interface with all of the current properties stored in it.</span></span>

        <span data-ttu-id="81d03-117">На этом этапе процесса целью является сериализация параметров в интерфейсе IPropertyBag2 в необработанный файл.</span><span class="sxs-lookup"><span data-stu-id="81d03-117">At this point of the process, the goal is to serialize the settings in the IPropertyBag2 interface into the RAW file.</span></span> <span data-ttu-id="81d03-118">Для этого требуется вращение кодировщика и т. д., что подробно описано в следующих шагах.</span><span class="sxs-lookup"><span data-stu-id="81d03-118">To do so requires spinning up an encoder and so on, which is detailed in the following steps.</span></span>

    5.  <span data-ttu-id="81d03-119">Создает [**ивикбитмапенкодер**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder) для необработанного файла.</span><span class="sxs-lookup"><span data-stu-id="81d03-119">Creates an [**IWICBitmapEncoder**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder) for the RAW file.</span></span>
    6.  <span data-ttu-id="81d03-120">Вызывает [**ивикбитмапенкодер**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder)::[**Initialize**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-initialize), передавая новый (пустой) поток для кодирования.</span><span class="sxs-lookup"><span data-stu-id="81d03-120">Calls [**IWICBitmapEncoder**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder)::[**Initialize**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-initialize), passing in a new (blank) stream to encode.</span></span>
    7.  <span data-ttu-id="81d03-121">Вызывает [**ивикбитмапенкодер**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder)::[**CreateNewFrame**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-createnewframe) , чтобы создать новый ивикбитмапфраминкоде для необработанного кадра.</span><span class="sxs-lookup"><span data-stu-id="81d03-121">Calls [**IWICBitmapEncoder**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder)::[**CreateNewFrame**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-createnewframe) to create a new IWICBitmapFrameEncode for the RAW frame.</span></span>
    8.  <span data-ttu-id="81d03-122">Вызывает [**ивикбитмапфраминкоде**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode)::[**Initialize**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-initialize)и передает интерфейс IPropertyBag2 из шага 4.</span><span class="sxs-lookup"><span data-stu-id="81d03-122">Calls [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode)::[**Initialize**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-initialize), and passes in the IPropertyBag2 interface from step 4.</span></span>
    9.  <span data-ttu-id="81d03-123">Вызывает [**ивикбитмапфраминкоде**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode)::[**вритесаурце**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapframeencode-writesource) с [**IWICBitmapSource**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsource) из необработанного кадра изображения декодера.</span><span class="sxs-lookup"><span data-stu-id="81d03-123">Calls [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode)::[**WriteSource**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapframeencode-writesource) with [**IWICBitmapSource**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsource) from decoder's RAW image frame.</span></span>
    10. <span data-ttu-id="81d03-124">Вызывает [**ивикбитмапфраминкоде**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode)::[**commit**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-commit).</span><span class="sxs-lookup"><span data-stu-id="81d03-124">Calls [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode)::[**Commit**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-commit).</span></span> <span data-ttu-id="81d03-125">Затем кодек Сериализует свойства в IPropertyBag2 из шага 8 в файл.</span><span class="sxs-lookup"><span data-stu-id="81d03-125">The codec then serializes the properties in the IPropertyBag2 from step 8 into the file.</span></span> <span data-ttu-id="81d03-126">Наиболее распространенным методом сериализации свойств является их запись в виде метаданных в файле.</span><span class="sxs-lookup"><span data-stu-id="81d03-126">The most common method of serializing the properties is assumed to be by writing them out as metadata in the file.</span></span>
    11. <span data-ttu-id="81d03-127">Вызывает [**ивикбитмапенкодер**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder)::[**commit**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-commit).</span><span class="sxs-lookup"><span data-stu-id="81d03-127">Calls [**IWICBitmapEncoder**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder)::[**Commit**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapencoder-commit).</span></span>
    12. <span data-ttu-id="81d03-128">Вызывает метод IStream:: Commit в потоке на шаге 6.</span><span class="sxs-lookup"><span data-stu-id="81d03-128">Calls IStream::Commit on the stream in step 6.</span></span>

    <span data-ttu-id="81d03-129">Параметры сериализуются в файле.</span><span class="sxs-lookup"><span data-stu-id="81d03-129">The settings are serialized in the file.</span></span>

    <span data-ttu-id="81d03-130">Этот метод вызывает стоимость перезаписи всего необработанного файла каждый раз при сериализации параметров.</span><span class="sxs-lookup"><span data-stu-id="81d03-130">This method does incur the cost of rewriting the entire RAW file each time the settings are serialized.</span></span> <span data-ttu-id="81d03-131">Это можно избежать, если вы реализуете [**ивикфастметадатаенкодер**](/windows/desktop/api/Wincodec/nn-wincodec-iwicfastmetadataencoder) или если ваш формат файла изображения поддерживает XMP или EXIF, так как WIC предоставляет [**ивикфастметадатаенкодер**](/windows/desktop/api/Wincodec/nn-wincodec-iwicfastmetadataencoder) для обоих форматов.</span><span class="sxs-lookup"><span data-stu-id="81d03-131">This can be avoided if you implement [**IWICFastMetadataEncoder**](/windows/desktop/api/Wincodec/nn-wincodec-iwicfastmetadataencoder) or if your image file format supports XMP or EXIF, as WIC provides [**IWICFastMetadataEncoder**](/windows/desktop/api/Wincodec/nn-wincodec-iwicfastmetadataencoder) for both of these formats.</span></span> <span data-ttu-id="81d03-132">Кроме того, если ваш кодек записывает изменения в конец файла изображения, то вы не сможете переписать весь файл изображения.</span><span class="sxs-lookup"><span data-stu-id="81d03-132">Also, if your codec writes changes to the end of the image file, then you won't end up rewriting the entire image file.</span></span>

-   <span data-ttu-id="81d03-133">Наборы параметров загружаются из сериализованного состояния, когда приложение задает перечисление [**викравпараметерсет. викусераджустедпараметерсет**](/windows/desktop/api/Wincodec/ne-wincodec-wicrawparameterset) в методе [**Ивикдевелоправ**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw)::[**лоадпараметерсет**](/windows/desktop/api/Wincodec/nf-wincodec-iwicdevelopraw-loadparameterset) .</span><span class="sxs-lookup"><span data-stu-id="81d03-133">Parameter sets are loaded from the serialized state when the application sets the [**WICRawParameterSet.WICUserAdjustedParameterSet**](/windows/desktop/api/Wincodec/ne-wincodec-wicrawparameterset) enumeration on the [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw)::[**LoadParameterSet**](/windows/desktop/api/Wincodec/nf-wincodec-iwicdevelopraw-loadparameterset) method.</span></span> <span data-ttu-id="81d03-134">Флаг [**викравпараметерсет. викусераджустедпараметерсет**](/windows/desktop/api/Wincodec/ne-wincodec-wicrawparameterset) ссылается на последний сохраненный набор параметров, поэтому загрузка с этим флагом должна привести к восстановлению последнего сохраненного состояния.</span><span class="sxs-lookup"><span data-stu-id="81d03-134">The [**WICRawParameterSet.WICUserAdjustedParameterSet**](/windows/desktop/api/Wincodec/ne-wincodec-wicrawparameterset) flag refers to the last-saved parameter set, so a load with this flag should result in restoring parameters to the last-saved state.</span></span>
-   <span data-ttu-id="81d03-135">После начальной загрузки необходимо загрузить последний сохраненный набор параметров, если он доступен.</span><span class="sxs-lookup"><span data-stu-id="81d03-135">Upon initial load, the last-saved parameter set should be loaded, if available.</span></span> <span data-ttu-id="81d03-136">В противном случае в качестве предустановок для переменных интерфейса [**ивикдевелоправ**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) следует использовать параметры "как-то".</span><span class="sxs-lookup"><span data-stu-id="81d03-136">If not, then the "as-shot" settings should be used as presets on the [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) interface variables.</span></span> <span data-ttu-id="81d03-137">Эти параметры можно также загрузить с помощью флага [**викравпараметерсет. викасшотпараметерсет**](/windows/desktop/api/Wincodec/ne-wincodec-wicrawparameterset) .</span><span class="sxs-lookup"><span data-stu-id="81d03-137">These as-shot settings can also be loaded by using the [**WICRawParameterSet.WICAsShotParameterSet**](/windows/desktop/api/Wincodec/ne-wincodec-wicrawparameterset) flag.</span></span>
-   <span data-ttu-id="81d03-138">Идентификатор [**викравпараметерсет. викаутоаджустедпараметерсет**](/windows/desktop/api/Wincodec/ne-wincodec-wicrawparameterset) предназначен для представления параметра Auto.</span><span class="sxs-lookup"><span data-stu-id="81d03-138">The identifier [**WICRawParameterSet.WICAutoAdjustedParameterSet**](/windows/desktop/api/Wincodec/ne-wincodec-wicrawparameterset) is meant to represent an "Auto" setting.</span></span> <span data-ttu-id="81d03-139">Конструктор кодеков может выбрать любой из следующих подходов к настройке параметров [**ивикдевелоправ**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) при установке этого параметра:</span><span class="sxs-lookup"><span data-stu-id="81d03-139">The codec designer can elect any of the following approaches on how to set [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) parameters when this setting is made:</span></span>

    -   <span data-ttu-id="81d03-140">Выполните алгоритмную оптимизацию некоторых параметров, например раскрытия или цвета.</span><span class="sxs-lookup"><span data-stu-id="81d03-140">Perform an algorithmic optimization of some parameters, such as exposure or color.</span></span> <span data-ttu-id="81d03-141">Таким образом, функции Auto в стандартных редакторах изображений и основаны на анализе пиксельных данных.</span><span class="sxs-lookup"><span data-stu-id="81d03-141">This is how Auto functions in typical image editors and is based primarily on pixel data analysis.</span></span>
    -   <span data-ttu-id="81d03-142">Задайте параметры камеры так же, как при автоматическом задании параметров.</span><span class="sxs-lookup"><span data-stu-id="81d03-142">Set camera settings similar to how an Auto setting would have behaved.</span></span> <span data-ttu-id="81d03-143">Это полезно, если образ был установлен вручную и позволяет пользователю переопределить параметры вручную.</span><span class="sxs-lookup"><span data-stu-id="81d03-143">This is useful if the image was shot on a Manual setting and allows the user to override manual settings.</span></span>
    -   <span data-ttu-id="81d03-144">Не делать ничего.</span><span class="sxs-lookup"><span data-stu-id="81d03-144">Do nothing.</span></span> <span data-ttu-id="81d03-145">Не все элементы управления должны быть заданы, если выбран параметр "Авто", и можно оставить параметры без изменений.</span><span class="sxs-lookup"><span data-stu-id="81d03-145">Not all controls need to be set when Auto is selected, and it is OK to leave settings unchanged.</span></span>

<span data-ttu-id="81d03-146">Фотоальбом Windows Vista и средства редактирования фотоальбома Windows Live и другие приложения для редактирования используют автоматическую загрузку параметров [**ивикдевелоправ**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) , когда пользователь выбирает автозамену для всех обычных настроек элемента управления кодека, таких как цвет и экспозиция для получения лучших результатов.</span><span class="sxs-lookup"><span data-stu-id="81d03-146">The Windows Vista Photo Gallery and Windows Live Photo Gallery editing tools and other editing applications use the [**IWICDevelopRaw**](/windows/desktop/api/Wincodec/nn-wincodec-iwicdevelopraw) Auto parameter load when the user selects Auto Correct for all normal codec control adjustments such as color and exposure to get the best results.</span></span>

## <a name="related-topics"></a><span data-ttu-id="81d03-147">См. также</span><span class="sxs-lookup"><span data-stu-id="81d03-147">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="81d03-148">**Зрения**</span><span class="sxs-lookup"><span data-stu-id="81d03-148">**Conceptual**</span></span>
</dt> <dt>

[<span data-ttu-id="81d03-149">Общие сведения о компоненте создания образов Windows</span><span class="sxs-lookup"><span data-stu-id="81d03-149">Windows Imaging Component Overview</span></span>](-wic-about-windows-imaging-codec.md)
</dt> <dt>

[<span data-ttu-id="81d03-150">Рекомендации по WIC для форматов необработанных изображений Camera</span><span class="sxs-lookup"><span data-stu-id="81d03-150">WIC Guidelines for Camera RAW Image Formats</span></span>](-wic-rawguidelines.md)
</dt> <dt>

[<span data-ttu-id="81d03-151">Написание WIC-Enabled КОДЕка</span><span class="sxs-lookup"><span data-stu-id="81d03-151">How to Write a WIC-Enabled CODEC</span></span>](-wic-howtowriteacodec.md)
</dt> </dl>

 

 



