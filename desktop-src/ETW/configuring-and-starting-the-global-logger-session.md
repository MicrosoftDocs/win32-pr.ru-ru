---
description: Сеанс трассировки глобального журнала событий регистрирует события, происходящие на ранних этапах процесса загрузки операционной системы.
ms.assetid: 1462bbef-ef32-4053-9930-5b4a0ab46b47
title: Настройка и запуск сеанса глобального журнала
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7a928cba5eb782ca4a57f7dba4776de79f42d7af
ms.sourcegitcommit: 9b5faa61c38b2d0c432b7f2dbee8c127b0e28a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2021
ms.locfileid: "122477050"
---
# <a name="configuring-and-starting-the-global-logger-session"></a>Настройка и запуск сеанса глобального журнала

Сеанс трассировки глобального журнала событий регистрирует события, происходящие на ранних этапах процесса загрузки операционной системы. Приложения и драйверы устройств могут использовать глобальный сеанс ведения журнала для записи трассировок перед входом пользователя в систему. Обратите внимание, что некоторые драйверы устройств, например драйверы дисковых устройств, не загружаются при запуске глобального сеанса ведения журнала.

> [!Note]  
> при создании глобального сеанса ведения журнала в Windows Vista следует рассмотреть возможность создания [сеанса авторегистратора](configuring-and-starting-an-autologger-session.md) .

 

Для настройки сеанса глобального журнала используется реестр. Добавьте ключ **глобаллогжер** в следующий раздел реестра, если он еще не указан:

```
HKEY_LOCAL_MACHINE
   \SYSTEM
      \CurrentControlSet
         \Control
            \WMI
```

В следующей таблице описаны значения, которые можно определить для ключа **глобаллогжер** . Для задания этих значений реестра необходимо иметь права администратора. Значения реестра влияют на всех поставщиков, которые регистрируют события в сеансе глобального журнала. **Начальное** значение — это единственное значение, необходимое для запуска глобального сеанса ведения журнала. все остальные значения имеют параметры по умолчанию, которые используются, если значение отсутствует в реестре. Как правило, следует использовать значения по умолчанию. Если указано значение, которое ETW не поддерживает, ETW переопределит это значение.




| Значение | Тип | Описание | 
|-------|------|-------------|
| <strong>Запуск</strong> | <strong>REG_DWORD</strong> | Присвойте этому параметру значение 1 (включено), чтобы запустить глобальный сеанс ведения журнала при следующем запуске системы. Чтобы предотвратить запуск сеанса, присвойте этому параметру значение 0 (выкл.). <br /> | 
| <strong>BufferSize</strong> | <strong>REG_DWORD</strong> | Размер каждого буфера в килобайтах. Это значение должно быть меньше одного мегабайта. Для вычисления этого значения ETW использует размер физической памяти. <br /> | 
| <strong>клокктипе</strong> | <strong>REG_DWORD</strong> | Таймер, используемый при записи отметки времени для каждого события.<ul><li>1 = значение счетчика производительности (высокое разрешение)</li><li>2 = системный таймер</li><li>3 = счетчик циклов ЦП</li></ul>Описание каждого типа часов см. в описании элемента <strong>ClientContext</strong> в <a href="wnode-header.md"><strong>WNODE_HEADER</strong></a>.<br /> значение по умолчанию — 1 (значение счетчика производительности) в Windows Vista и более поздних версиях. до Windows Vista значение по умолчанию — 2 (системный таймер).<br /> | 
| <strong>енаблекернелфлагс</strong> | <strong>REG_BINARY</strong> | Используйте это значение для включения одного или нескольких поставщиков ядра. При включении поставщиков ядра глобальный сеанс ведения журнала будет переименован в средство ведения журнала ядра NT при запуске. Возможные значения см. в разделе <strong>енаблефлагс</strong> элемента <a href="/windows/win32/api/evntrace/ns-evntrace-event_trace_properties"><strong>EVENT_TRACE_PROPERTIES</strong></a>.<br /> | 
| <strong>филекаунтер</strong> | <strong>REG_DWORD</strong> | Число файлов журнала трассировки событий, создаваемых сеансами глобального журнала. Система увеличивает это значение до тех пор, пока не достигнет значения <strong>филемакс</strong>. Затем он сбрасывает значение в 0. Этот счетчик не даст системе перезаписывать файл журнала трассировки глобального регистратора. <br /> | 
| <strong>филемакс</strong> | <strong>REG_DWORD</strong> | Максимальное число файлов журнала трассировки событий, разрешенных в системе. Когда количество журналов трассировки достигает заданного максимума, система начинает перезаписывать журналы, начиная с самого старого. <br /> Если файл журнала, указанный в файле <strong>filename</strong> , существует, ETW добавляет значение <strong>филекаунтер</strong> к имени файла. Например, если используется имя файла журнала по умолчанию, то это форма%SystemRoot%\System32\LogFiles\WMI\GlobalLogger.etl.NNNN. <br /> Значение по умолчанию равно 0, то есть не имеет максимального значения. <br /> | 
| <strong>FileName</strong> | <strong>REG_SZ</strong> | Полный путь к файлу журнала. Путь к этому файлу должен существовать. Файл журнала является последовательным файлом журнала. Обратите внимание, что все поставщики, записывающие события в сеанс глобального журнала, записывают события в этот файл журнала. Длина пути ограничена 1024 символами. Если <strong>имя файла</strong> не указано, события записываются в%systemroot%\System32\LogFiles\WMI\GlobalLogger.ETL.. <strong>до Windows Vista:</strong> Файл по умолчанию —%SystemRoot%\System32\LogFiles\WMI\Trace.log.<br /><br /> | 
| <strong>флуштимер</strong> | <strong>REG_DWORD</strong> | Частота принудительного сброса буферов трассировки в секундах. Минимальное время записи на диск — 1 секунда. Этот принудительный сброс находится в дополнение к автоматическому сбросу, который происходит при заполнении буфера и остановке сеанса трассировки. <br /> В случае средства ведения журнала в реальном времени значение 0 (значение по умолчанию) означает, что время очистки будет равно 1 секунде. Средство ведения журнала в режиме реального времени используется, когда <strong>логфилемоде</strong> имеет значение <strong>EVENT_TRACE_REAL_TIME_MODE</strong>.<br /> Значение по умолчанию — 0. По умолчанию буферы сбрасываются только в том случае, если они заполнены. <br /> | 
| <strong>логфилемоде</strong> | <strong>REG_DWORD</strong> | Задает параметры сеанса журнала. Значения см. в разделе <a href="logging-mode-constants.md">константы режима ведения журнала</a>. эти значения поддерживаются в Windows Vista и более поздних версиях. <br /> | 
| <strong>MaximumBuffers</strong> | <strong>REG_DWORD</strong> | Максимальное количество выделяемых буферов. Обычно это значение является минимальным числом буферов плюс двадцать. Для вычисления этого значения ETW использует размер буфера и размер физической памяти. Это значение должно быть больше или равно значению для <strong>MinimumBuffers</strong>.<br /> | 
| <strong>MaxFileSize</strong> | <strong>REG_DWORD</strong> | Максимальный размер файла журнала трассировки событий (в мегабайтах). По умолчанию максимальный размер файла отсутствует.<br /> | 
| <strong>MinimumBuffers</strong> | <strong>REG_DWORD</strong> | Минимальное число буферов, выделяемых при запуске глобального сеанса ведения журнала. Минимальное число буферов, которые можно указать, — два буфера на процессор. Например, на компьютере с одним процессором минимальное число буферов равно двум. <br /> Значение по умолчанию в системе с одним процессором — 0x3.<br /> | 
| <strong>Состояние</strong> | <strong>REG_DWORD</strong> | Состояние запуска глобального средства ведения журнала. Если не удалось запустить глобальное средство ведения журнала, значением этого ключа является соответствующий код ошибки Win32. Если глобальное средство ведения журнала успешно запущено, значение этого параметра — ERROR_SUCCESS (0).<br /> | 




 

После изменения реестра и перезапуска компьютера глобальный сеанс ведения журнала запускается автоматически и используется так же, как любой другой сеанс с одним исключением: \_ \_ \_ для ссылки на глобальный сеанс ведения журнала используется идентификационный номер глобального средства ведения журнала WMI (определенный в вмистр. h). Эту константу можно использовать в качестве аргумента для любой функции трассировки событий, принимающей обработчик сеанса. В функциях, которые принимают имя сеанса, используйте глобальное \_ имя средства ведения журнала \_ .

Глобальный контроллер ведения журнала не вызывает функцию [**енаблетраце**](/windows/win32/api/evntrace/nf-evntrace-enabletrace) для включения поставщиков. Поставщик отвечает за определение того, запущен ли глобальный сеанс ведения журнала, а затем включает сам его.

Чтобы определить, запущен ли глобальный сеанс ведения журнала, можно вызвать функцию [**контролтраце**](/windows/win32/api/evntrace/nf-evntrace-controltracea) , установив для *сессионхандле* \_ \_ идентификатор глобального регистратора WMI \_ и *контролкоде* в **\_ \_ управляющий \_ запрос трассировки событий**. Если вызов **контролтраце** успешно выполнен, то существует глобальный сеанс регистратора, и поставщик может включить себя и регистрировать события в глобальном сеансе ведения журнала (функция **контролтраце** возвращает экземпляр WMI об ошибке, \_ \_ \_ не \_ найденный, если глобальное средство ведения журнала неактивно).

Как правило, контроллер отвечает за передачу флагов и уровней включения поставщику, когда он включает поставщик, но поскольку глобальный контроллер ведения журнала не включает поставщик, ответственность за передачу этих сведений в себя при необходимости несет поставщик.

Глобальный сеанс ведения журнала — это ограниченный ресурс, который следует использовать с осторожностью. Службы, которые хотят собирать информацию во время процесса загрузки, должны рассмотреть возможность добавления логики контроллера к себе вместо использования глобального сеанса ведения журнала.

Дополнительные сведения о запуске сеанса трассировки событий см. в разделе [Настройка и запуск сеанса трассировки событий](configuring-and-starting-an-event-tracing-session.md).

Дополнительные сведения о запуске закрытого сеанса ведения журнала см. в разделе [Настройка и запуск закрытого сеанса ведения журнала](configuring-and-starting-a-private-logger-session.md).

Дополнительные сведения о запуске сеанса ведения журнала ядра NT см. в разделе [Настройка и запуск сеанса ведения журнала ядра NT](configuring-and-starting-the-nt-kernel-logger-session.md).

