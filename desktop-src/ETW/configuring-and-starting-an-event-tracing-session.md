---
description: Чтобы настроить сеанс трассировки событий, используйте \_ структуру Свойства трассировки событий, \_ чтобы указать свойства сеанса.
ms.assetid: 8a6aa39c-ec81-42ac-a26e-29f1f6960220
title: Настройка и запуск сеанса трассировки событий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0f86ec57975e8f12ede17e5e2cda962c010aa1af
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104986136"
---
# <a name="configuring-and-starting-an-event-tracing-session"></a><span data-ttu-id="005de-103">Настройка и запуск сеанса трассировки событий</span><span class="sxs-lookup"><span data-stu-id="005de-103">Configuring and Starting an Event Tracing Session</span></span>

<span data-ttu-id="005de-104">Чтобы настроить сеанс трассировки событий, используйте структуру [**\_ \_ Свойства трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_properties) , чтобы указать свойства сеанса.</span><span class="sxs-lookup"><span data-stu-id="005de-104">To configure an event tracing session, use the [**EVENT\_TRACE\_PROPERTIES**](/windows/win32/api/evntrace/ns-evntrace-event_trace_properties) structure to specify the properties of the session.</span></span> <span data-ttu-id="005de-105">Память, выделенная для структуры **\_ \_ свойств трассировки событий** , должна быть достаточно большой, чтобы также содержать имена сеансов и файлов журналов, которые следуют за структурой в памяти.</span><span class="sxs-lookup"><span data-stu-id="005de-105">The memory you allocate for the **EVENT\_TRACE\_PROPERTIES** structure must be large enough to also contain the session and log file names that follow the structure in memory.</span></span>

<span data-ttu-id="005de-106">После указания свойств сеанса вызовите функцию [**старттраце**](/windows/win32/api/evntrace/nf-evntrace-starttracea) , чтобы запустить сеанс.</span><span class="sxs-lookup"><span data-stu-id="005de-106">After you specify the properties of the session, call the [**StartTrace**](/windows/win32/api/evntrace/nf-evntrace-starttracea) function to start the session.</span></span> <span data-ttu-id="005de-107">Если функция выполнена, параметр *сессионхандле* будет содержать обработчик сеанса, а свойство **логжернамеоффсет** будет содержать смещение к имени сеанса.</span><span class="sxs-lookup"><span data-stu-id="005de-107">If the function succeeds, the *SessionHandle* parameter will contain the session handle, and the **LoggerNameOffset** property will contain the offset to the name of the session.</span></span>

<span data-ttu-id="005de-108">Чтобы включить поставщиков, которые будут регистрировать события в сеансе, вызовите функцию [**енаблетраце**](/windows/win32/api/evntrace/nf-evntrace-enabletrace) , чтобы включить классические поставщики и функцию [**енаблетрацеекс**](/windows/win32/api/evntrace/nf-evntrace-enabletraceex) для включения поставщиков [на основе манифеста](about-event-tracing.md) .</span><span class="sxs-lookup"><span data-stu-id="005de-108">To enable the providers that you want to log events to your session, call the [**EnableTrace**](/windows/win32/api/evntrace/nf-evntrace-enabletrace) function to enable classic providers and the [**EnableTraceEx**](/windows/win32/api/evntrace/nf-evntrace-enabletraceex) function to enable [manifest-based](about-event-tracing.md) providers.</span></span> <span data-ttu-id="005de-109">Чтобы включить поставщиков, которые должны записывать события в журнал при фильтрации сеанса при определенных условиях Windows 8.1, Windows Server 2012 R2 и более поздних версиях, вызовите функцию [**EnableTraceEx2**](/windows/win32/api/evntrace/nf-evntrace-enabletraceex2) .</span><span class="sxs-lookup"><span data-stu-id="005de-109">To enable providers that you want log events to your session filtering on specific conditions on Windows 8.1,Windows Server 2012 R2, and later, call the [**EnableTraceEx2**](/windows/win32/api/evntrace/nf-evntrace-enabletraceex2) function.</span></span>

<span data-ttu-id="005de-110">Кроме того, можно также отслеживать дополнительные сведения о событии с помощью вызова функции [**трацесетинформатион**](/windows/win32/api/evntrace/nf-evntrace-tracesetinformation) .</span><span class="sxs-lookup"><span data-stu-id="005de-110">In addition, you can also trace additional information on an event with a call to the [**TraceSetInformation**](/windows/win32/api/evntrace/nf-evntrace-tracesetinformation) function.</span></span> <span data-ttu-id="005de-111">**Трацесетинформатион** помещает дополнительные сведения о трассировке в раздел расширенных данных события и может включать такие сведения, как сведения о версии трассировки или о том, какие поставщики в настоящее время зарегистрированы в системе.</span><span class="sxs-lookup"><span data-stu-id="005de-111">**TraceSetInformation** puts additional trace information into the extended data section of an event, and can include information such as the trace version info, or what providers are currently registered on the system.</span></span> <span data-ttu-id="005de-112">Дополнительные сведения см. в разделе [Получение дополнительных данных трассировки событий](retrieving-additional-event-tracing-data.md).</span><span class="sxs-lookup"><span data-stu-id="005de-112">For more information, see [Retrieving Additional Event Tracing Data](retrieving-additional-event-tracing-data.md).</span></span>

<span data-ttu-id="005de-113">До восьми сеансов трассировки можно включить и получить события из одного и того же поставщика [на основе манифеста](about-event-tracing.md) .</span><span class="sxs-lookup"><span data-stu-id="005de-113">Up to eight trace sessions can enable and receive events from the same [manifest-based](about-event-tracing.md) provider.</span></span> <span data-ttu-id="005de-114">Однако [классический](about-event-tracing.md) поставщик может включить только один сеанс трассировки.</span><span class="sxs-lookup"><span data-stu-id="005de-114">However, only one trace session can enable a [classic](about-event-tracing.md) provider.</span></span> <span data-ttu-id="005de-115">Если несколько сеансов трассировки пытаются включить классический поставщик, первый сеанс перестанет получать события, когда второй сеанс включит поставщик.</span><span class="sxs-lookup"><span data-stu-id="005de-115">If more than one trace session tries to enable a classic provider, the first session would stop receiving events when the second session enables the provider.</span></span> <span data-ttu-id="005de-116">Например, если в сеансе включен поставщик 1, а затем в сеансе B включен поставщик 1, то только сеанс б будет принимать события от поставщика 1.</span><span class="sxs-lookup"><span data-stu-id="005de-116">For example, if Session A enabled Provider 1 and then Session B enabled Provider 1, only Session B would receive events from Provider 1.</span></span>

<span data-ttu-id="005de-117">Вы можете использовать любую из трех функций для включения поставщика, но при использовании [**енаблетраце**](/windows/win32/api/evntrace/nf-evntrace-enabletrace) для включения поставщика на основе манифеста можно потерять функциональность, так как вы не сможете предоставить значение матчаллкэйворд, указать расширенные элементы данных для включения в событие или предоставить данные фильтра, определенные поставщиком.</span><span class="sxs-lookup"><span data-stu-id="005de-117">You can use any of the three functions to enable a provider but you may lose functionality if you use [**EnableTrace**](/windows/win32/api/evntrace/nf-evntrace-enabletrace) to enable a manifest-based provider because you will not be able to provide a MatchAllKeyword value, specify extended data items to include in the event, or provide provider-defined filter data.</span></span> <span data-ttu-id="005de-118">Дополнительные сведения см. в разделе "Примечания" каждой функции.</span><span class="sxs-lookup"><span data-stu-id="005de-118">For more information, see the Remarks section of each function.</span></span>

<span data-ttu-id="005de-119">В Windows 8.1, в Windows Server 2012 R2 и более поздних версиях фильтры анализа полезных данных события, области действия и стека могут использоваться функцией [**EnableTraceEx2**](/windows/win32/api/evntrace/nf-evntrace-enabletraceex2) , [**а \_ \_ параметры включения трассировки**](/windows/win32/api/evntrace/ns-evntrace-enable_trace_parameters) и [**\_ \_ дескриптора фильтра событий**](/windows/desktop/api/Evntprov/ns-evntprov-event_filter_descriptor) — для фильтрации по конкретным условиям сеанса ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="005de-119">On Windows 8.1,Windows Server 2012 R2, and later, event payload , scope, and stack walk filters can be used by the [**EnableTraceEx2**](/windows/win32/api/evntrace/nf-evntrace-enabletraceex2) function and the [**ENABLE\_TRACE\_PARAMETERS**](/windows/win32/api/evntrace/ns-evntrace-enable_trace_parameters) and [**EVENT\_FILTER\_DESCRIPTOR**](/windows/desktop/api/Evntprov/ns-evntprov-event_filter_descriptor) structures to filter on specific conditions in a logger session.</span></span> <span data-ttu-id="005de-120">Дополнительные сведения о фильтрах полезных данных событий см. в статьях функции [**тдхкреатепайлоадфилтер**](/windows/desktop/api/Tdh/nf-tdh-tdhcreatepayloadfilter)и [**тдхаггрегатепайлоадфилтерс**](/windows/desktop/api/Tdh/nf-tdh-tdhaggregatepayloadfilters) , а также структуры [**\_ \_ предикатов**](/windows/desktop/api/Tdh/ns-tdh-payload_filter_predicate) **включения \_ трассировки \_**, **\_ \_ дескриптора фильтра событий** и фильтра полезных данных.</span><span class="sxs-lookup"><span data-stu-id="005de-120">For more information on event payload filters, see the [**TdhCreatePayloadFilter**](/windows/desktop/api/Tdh/nf-tdh-tdhcreatepayloadfilter), and [**TdhAggregatePayloadFilters**](/windows/desktop/api/Tdh/nf-tdh-tdhaggregatepayloadfilters) functions and the **ENABLE\_TRACE\_PARAMETERS**, **EVENT\_FILTER\_DESCRIPTOR**, and [**PAYLOAD\_FILTER\_PREDICATE**](/windows/desktop/api/Tdh/ns-tdh-payload_filter_predicate) structures.</span></span>

<span data-ttu-id="005de-121">Чтобы определить уровень и ключевые слова, используемые для включения поставщика на основе манифеста, используйте одну из следующих команд:</span><span class="sxs-lookup"><span data-stu-id="005de-121">To determine the level and keywords used to enable a manifest-based provider, use one of the following commands:</span></span>

-   <span data-ttu-id="005de-122">*Имя поставщика* **запроса** **Logman**</span><span class="sxs-lookup"><span data-stu-id="005de-122">**Logman** **query** *provider-name*</span></span>
-   <span data-ttu-id="005de-123">Средство **wevtutil** **GP** *provider-Name*</span><span class="sxs-lookup"><span data-stu-id="005de-123">**Wevtutil** **gp** *provider-name*</span></span>

<span data-ttu-id="005de-124">Команды выводит только уровень и ключевые слова. поставщик должен документировать требования к данным фильтра для потенциальных контроллеров.</span><span class="sxs-lookup"><span data-stu-id="005de-124">The commands list the level and keywords only, the provider must document any filter data requirements for potential controllers.</span></span>

<span data-ttu-id="005de-125">Для перечисления поставщиков на основе манифеста используется средство **wevtutil** **EP**.</span><span class="sxs-lookup"><span data-stu-id="005de-125">To enumerate the manifest-based providers use **Wevtutil** **ep**.</span></span>

<span data-ttu-id="005de-126">Для классических поставщиков поставщику необходимо документировать и сделать доступным для потенциальных контроллеров уровни серьезности или включить поддерживаемые им флаги.</span><span class="sxs-lookup"><span data-stu-id="005de-126">For classic providers, it is up to the provider to document and make available to potential controllers the severity levels or enable flags that it supports.</span></span> <span data-ttu-id="005de-127">Если поставщик хочет включить какой-либо контроллер, поставщик должен принять значение 0 для уровня серьезности и включить флаги и интерпретировать 0 как запрос на выполнение журнала по умолчанию (что может быть).</span><span class="sxs-lookup"><span data-stu-id="005de-127">If the provider wants to be enabled by any controller, the provider should accept 0 for the severity level and enable flags and interpret 0 as a request to perform default logging (whatever that may be).</span></span>

<span data-ttu-id="005de-128">Вы можете включить поставщик до или после того, как поставщик зарегистрировал свою регистрацию.</span><span class="sxs-lookup"><span data-stu-id="005de-128">You can enable the provider before or after the provider registers itself.</span></span> <span data-ttu-id="005de-129">После включения поставщика ETW будет вызывать функцию обратного вызова поставщика.</span><span class="sxs-lookup"><span data-stu-id="005de-129">After enabling the provider, ETW will then call the provider's callback function.</span></span> <span data-ttu-id="005de-130">Если поставщик не зарегистрирован, ETW будет вызывать функцию обратного вызова поставщика после регистрации.</span><span class="sxs-lookup"><span data-stu-id="005de-130">If the provider is not registered, ETW will call the provider's callback function after it registers itself.</span></span>

<span data-ttu-id="005de-131">Можно также использовать функцию [**енаблетраце**](/windows/win32/api/evntrace/nf-evntrace-enabletrace) , чтобы отключить поставщик (отключить его от ведения журнала событий в сеанс) или обновить уровень ведения журнала или включить флаги поставщика.</span><span class="sxs-lookup"><span data-stu-id="005de-131">You can also use the [**EnableTrace**](/windows/win32/api/evntrace/nf-evntrace-enabletrace) function to disable the provider (stop it from logging events to your session) or to update the logging level or enable flags of the provider.</span></span> <span data-ttu-id="005de-132">С помощью функции [**енаблетрацеекс**](/windows/win32/api/evntrace/nf-evntrace-enabletraceex) можно отключить поставщик или обновить уровень, ключевые слова, Расширенные данные и фильтровать данные.</span><span class="sxs-lookup"><span data-stu-id="005de-132">With the [**EnableTraceEx**](/windows/win32/api/evntrace/nf-evntrace-enabletraceex) function, you can disable the provider or update the level, keywords, extended data and filter data.</span></span> <span data-ttu-id="005de-133">Каждый раз при вызове функции **енаблетраце** или **енаблетрацеекс** ETW вызывает функцию обратного вызова поставщика.</span><span class="sxs-lookup"><span data-stu-id="005de-133">Each time you call the **EnableTrace** or **EnableTraceEx** function, ETW calls the provider's callback function.</span></span> <span data-ttu-id="005de-134">Поставщик остается включенным для сеанса, пока сеанс не отключается поставщиком.</span><span class="sxs-lookup"><span data-stu-id="005de-134">The provider remains enabled for the session until the session disables the provider.</span></span>

<span data-ttu-id="005de-135">Чтобы отключить сеанс трассировки после сбора событий, вызовите функцию [**контролтраце**](/windows/win32/api/evntrace/nf-evntrace-controltracea) и передайте \_ Управление трассировкой событий в \_ \_ качестве управляющего кода.</span><span class="sxs-lookup"><span data-stu-id="005de-135">To stop the trace session after collecting events, call the [**ControlTrace**](/windows/win32/api/evntrace/nf-evntrace-controltracea) function and pass EVENT\_TRACE\_CONTROL\_STOP as the control code.</span></span> <span data-ttu-id="005de-136">Чтобы указать сеанс для завершения, можно передать обработчик сеанса трассировки событий, полученный из предыдущего вызова функции [**старттраце**](/windows/win32/api/evntrace/nf-evntrace-starttracea) , или имя ранее запущенного сеанса.</span><span class="sxs-lookup"><span data-stu-id="005de-136">To specify the session to stop, you can pass the event tracing session handle obtained from an earlier call to the [**StartTrace**](/windows/win32/api/evntrace/nf-evntrace-starttracea) function, or the name of a previously started session.</span></span> <span data-ttu-id="005de-137">Перед остановкой сеанса обязательно отключите все поставщики.</span><span class="sxs-lookup"><span data-stu-id="005de-137">Be sure to disable all providers before stopping the session.</span></span> <span data-ttu-id="005de-138">Если вы останавливаете сеанс перед первым отключением поставщика, ETW отключит поставщик и попытается вызвать функцию обратного вызова элемента управления поставщика.</span><span class="sxs-lookup"><span data-stu-id="005de-138">If you stop the session before first disabling the provider, ETW will disable the provider and try to call the provider's control callback function.</span></span> <span data-ttu-id="005de-139">Если приложение, запустившего сеанс, завершается без отключения поставщика или вызова функции **контролтраце** , то поставщик остается включенным.</span><span class="sxs-lookup"><span data-stu-id="005de-139">If the application that started the session ends without disabling the provider or calling the **ControlTrace** function, the provider remains enabled.</span></span>

<span data-ttu-id="005de-140">Если [**контролтраце**](/windows/win32/api/evntrace/nf-evntrace-controltracea) успешно, свойства сеанса обновляются в соответствии с последними значениями свойств и запускают статистику для сеанса трассировки событий.</span><span class="sxs-lookup"><span data-stu-id="005de-140">If [**ControlTrace**](/windows/win32/api/evntrace/nf-evntrace-controltracea) is successful, the session properties are updated to reflect the final property values and run statistics for the event tracing session.</span></span>

<span data-ttu-id="005de-141">Пример, в котором запускается сеанс трассировки событий, см. в следующих статьях:</span><span class="sxs-lookup"><span data-stu-id="005de-141">For an example that starts an event tracing session, see the following:</span></span>

-   <span data-ttu-id="005de-142">[Пример создания сеанса и включения поставщика на основе манифеста](example-that-creates-a-session-and-enables-a-manifest-based-provider.md) — запуск сеанса трассировки, включение поставщика на основе манифеста, отключение поставщика и прекращение сеанса.</span><span class="sxs-lookup"><span data-stu-id="005de-142">[Example that Creates a Session and Enables a Manifest-based Provider](example-that-creates-a-session-and-enables-a-manifest-based-provider.md) - starts a trace session, enables a manifest-based provider, disables the provider and then stops the session.</span></span>

<span data-ttu-id="005de-143">Дополнительные сведения о запуске сеанса трассировки см. в описании одного из следующих действий.</span><span class="sxs-lookup"><span data-stu-id="005de-143">For details on starting a trace session, see one of the following:</span></span>

-   [<span data-ttu-id="005de-144">Настройка и запуск сеанса Системтрацепровидер</span><span class="sxs-lookup"><span data-stu-id="005de-144">Configuring and Starting a SystemTraceProvider Session</span></span>](configuring-and-starting-a-systemtraceprovider-session.md)
-   [<span data-ttu-id="005de-145">Настройка и запуск сеанса ведения журнала ядра NT</span><span class="sxs-lookup"><span data-stu-id="005de-145">Configuring and Starting the NT Kernel Logger Session</span></span>](configuring-and-starting-the-nt-kernel-logger-session.md)
-   [<span data-ttu-id="005de-146">Настройка и запуск сеанса авторегистратора</span><span class="sxs-lookup"><span data-stu-id="005de-146">Configuring and Starting an AutoLogger Session</span></span>](configuring-and-starting-an-autologger-session.md)
-   [<span data-ttu-id="005de-147">Настройка и запуск сеанса глобального журнала</span><span class="sxs-lookup"><span data-stu-id="005de-147">Configuring and Starting the Global Logger Session</span></span>](configuring-and-starting-the-global-logger-session.md)
-   [<span data-ttu-id="005de-148">Настройка и запуск закрытого сеанса ведения журнала</span><span class="sxs-lookup"><span data-stu-id="005de-148">Configuring and Starting a Private Logger Session</span></span>](configuring-and-starting-a-private-logger-session.md)

## <a name="related-topics"></a><span data-ttu-id="005de-149">См. также</span><span class="sxs-lookup"><span data-stu-id="005de-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="005de-150">Настройка и запуск закрытого сеанса ведения журнала</span><span class="sxs-lookup"><span data-stu-id="005de-150">Configuring and Starting a Private Logger Session</span></span>](configuring-and-starting-a-private-logger-session.md)
</dt> <dt>

[<span data-ttu-id="005de-151">Настройка и запуск сеанса Системтрацепровидер</span><span class="sxs-lookup"><span data-stu-id="005de-151">Configuring and Starting a SystemTraceProvider Session</span></span>](configuring-and-starting-a-systemtraceprovider-session.md)
</dt> <dt>

[<span data-ttu-id="005de-152">Настройка и запуск сеанса авторегистратора</span><span class="sxs-lookup"><span data-stu-id="005de-152">Configuring and Starting an AutoLogger Session</span></span>](configuring-and-starting-an-autologger-session.md)
</dt> <dt>

[<span data-ttu-id="005de-153">Настройка и запуск сеанса ведения журнала ядра NT</span><span class="sxs-lookup"><span data-stu-id="005de-153">Configuring and Starting the NT Kernel Logger Session</span></span>](configuring-and-starting-the-nt-kernel-logger-session.md)
</dt> <dt>

[<span data-ttu-id="005de-154">**контролтраце**</span><span class="sxs-lookup"><span data-stu-id="005de-154">**ControlTrace**</span></span>](/windows/win32/api/evntrace/nf-evntrace-controltracea)
</dt> <dt>

[<span data-ttu-id="005de-155">**енаблетраце**</span><span class="sxs-lookup"><span data-stu-id="005de-155">**EnableTrace**</span></span>](/windows/win32/api/evntrace/nf-evntrace-enabletrace)
</dt> <dt>

[<span data-ttu-id="005de-156">**енаблетрацеекс**</span><span class="sxs-lookup"><span data-stu-id="005de-156">**EnableTraceEx**</span></span>](/windows/win32/api/evntrace/nf-evntrace-enabletraceex)
</dt> <dt>

[<span data-ttu-id="005de-157">**EnableTraceEx2**</span><span class="sxs-lookup"><span data-stu-id="005de-157">**EnableTraceEx2**</span></span>](/windows/win32/api/evntrace/nf-evntrace-enabletraceex2)
</dt> <dt>

[<span data-ttu-id="005de-158">**ВКЛЮЧИТЬ \_ \_ Параметры трассировки**</span><span class="sxs-lookup"><span data-stu-id="005de-158">**ENABLE\_TRACE\_PARAMETERS**</span></span>](/windows/win32/api/evntrace/ns-evntrace-enable_trace_parameters)
</dt> <dt>

[<span data-ttu-id="005de-159">**\_дескриптор фильтра \_ событий**</span><span class="sxs-lookup"><span data-stu-id="005de-159">**EVENT\_FILTER\_DESCRIPTOR**</span></span>](/windows/desktop/api/Evntprov/ns-evntprov-event_filter_descriptor)
</dt> <dt>

[<span data-ttu-id="005de-160">**\_Свойства трассировки \_ событий**</span><span class="sxs-lookup"><span data-stu-id="005de-160">**EVENT\_TRACE\_PROPERTIES**</span></span>](/windows/win32/api/evntrace/ns-evntrace-event_trace_properties)
</dt> <dt>

[<span data-ttu-id="005de-161">**\_предикат фильтра полезных данных \_**</span><span class="sxs-lookup"><span data-stu-id="005de-161">**PAYLOAD\_FILTER\_PREDICATE**</span></span>](/windows/desktop/api/Tdh/ns-tdh-payload_filter_predicate)
</dt> <dt>

[<span data-ttu-id="005de-162">**старттраце**</span><span class="sxs-lookup"><span data-stu-id="005de-162">**StartTrace**</span></span>](/windows/win32/api/evntrace/nf-evntrace-starttracea)
</dt> <dt>

[<span data-ttu-id="005de-163">**тдхаггрегатепайлоадфилтерс**</span><span class="sxs-lookup"><span data-stu-id="005de-163">**TdhAggregatePayloadFilters**</span></span>](/windows/desktop/api/Tdh/nf-tdh-tdhaggregatepayloadfilters)
</dt> <dt>

[<span data-ttu-id="005de-164">**тдхкреатепайлоадфилтер**</span><span class="sxs-lookup"><span data-stu-id="005de-164">**TdhCreatePayloadFilter**</span></span>](/windows/desktop/api/Tdh/nf-tdh-tdhcreatepayloadfilter)
</dt> <dt>

[<span data-ttu-id="005de-165">Обновление сеанса трассировки событий</span><span class="sxs-lookup"><span data-stu-id="005de-165">Updating an Event Tracing Session</span></span>](updating-an-event-tracing-session.md)
</dt> </dl>

 

 
