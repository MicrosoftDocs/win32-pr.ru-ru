---
description: Трассировка событий для Windows (ETW) — это эффективный механизм трассировки на уровне ядра, позволяющий регистрировать события ядра или приложения в файле журнала.
ms.assetid: 0eaa7bd3-8537-483a-b0d6-db3b790a6f3d
title: Сведения о трассировке событий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3a2f13284cec1d9300c23241fafe154f277f72a3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103991272"
---
# <a name="about-event-tracing"></a>Сведения о трассировке событий

Трассировка событий для Windows (ETW) — это эффективный механизм трассировки на уровне ядра, позволяющий регистрировать события ядра или приложения в файле журнала. Вы можете использовать события в режиме реального времени или из файла журнала, используя их для отладки приложения или для определения того, где в приложении возникают проблемы с производительностью.

ETW позволяет динамически включать или отключать трассировку событий, позволяя выполнять подробную трассировку в рабочей среде без необходимости перезапуска компьютера или приложения.

API трассировки событий разбивается на три отдельных компонента:

-   [Контроллеры](#controllers), которые запускают и останавливают сеанс трассировки событий и включают поставщиков.
-   [Поставщики](#providers), которые предоставляют события
-   [Потребители](#consumers), которые используют события

На следующей диаграмме показана модель трассировки событий.

![модель трассировки событий](images/etdiag2.png)

## <a name="controllers"></a>Контроллеры

Контроллеры — это приложения, которые определяют размер и расположение файла журнала, запускает и останавливает [сеансы трассировки событий](event-tracing-sessions.md), включают поставщиков, чтобы они могли регистрировать события в сеансе, управлять размером буферного пула и получать статистику выполнения для сеансов. Статистика сеанса включает количество используемых буферов, количество доставленных буферов, а также количество потерянных событий и буферов. 

Дополнительные сведения см. в разделе [Управление сеансами трассировки событий](controlling-event-tracing-sessions.md).

## <a name="providers"></a>Поставщики

Поставщики — это приложения, которые содержат Инструментирование трассировки событий. После того как поставщик регистрируется, контроллер может включить или отключить трассировку событий в поставщике. Поставщик определяет его интерпретацию включения или отключения. Как правило, включенный поставщик создает события, а отключенный поставщик — нет. Это позволяет добавлять в приложение трассировку событий, не требуя, чтобы она создавала события все время. 

Хотя модель ETW разделяет контроллер и поставщика на отдельные приложения, приложение может включать оба компонента.

Дополнительные сведения см. в разделе [предоставление событий](providing-events.md).

### <a name="types-of-providers"></a>Типы поставщиков

Существует четыре основных типа поставщиков: поставщики MOF (классические), поставщики WPP, поставщики на основе манифестов и поставщики Трацелоггинг. При написании приложений для Windows Vista или более поздней версии, которые не нуждаются в поддержке устаревших систем, следует использовать поставщик на основе манифеста или поставщик Трацелоггинг.

#### <a name="mof-classic-providers"></a>Поставщики MOF (классические):

-   Используйте функции [регистертрацегуидс](/windows/win32/api/evntrace/nf-evntrace-registertraceguidsa) и [TraceEvent](/windows/win32/api/evntrace/nf-evntrace-traceevent) для регистрации и записи событий.
-   Используйте классы MOF для определения событий, чтобы потребители узнают, как их использовать.
-   Может быть включено только одним сеансом трассировки за раз.

#### <a name="wpp-providers"></a>Поставщики WPP:

-   Используйте функции [регистертрацегуидс](/windows/win32/api/evntrace/nf-evntrace-registertraceguidsa) и [TraceEvent](/windows/win32/api/evntrace/nf-evntrace-traceevent) для регистрации и записи событий.
-   Имеют связанные файлы ТМФ (скомпилированные в PDB-файл), содержащие сведения о декодировании, выведенные из проверки препроцессора на наличие инструментирования WPP в исходном коде.
-   Может быть включено только одним сеансом трассировки за раз.

#### <a name="manifest-based-providers"></a>Поставщики на основе манифеста:

-   Используйте [EventRegister](/windows/desktop/api/Evntprov/nf-evntprov-eventregister) и [EventWrite](/windows/desktop/api/Evntprov/nf-evntprov-eventwrite) для регистрации и записи событий.
-   Используйте манифест для определения событий, чтобы потребители узнают, как их использовать.
-   Может быть включено до восьми сеансов трассировки одновременно.

#### <a name="tracelogging-providers"></a>Поставщики [трацелоггинг](/windows/desktop/tracelogging/trace-logging-about) :

-   Используйте [трацелоггингрегистер](/windows/desktop/api/traceloggingprovider/nf-traceloggingprovider-traceloggingregister) и [трацелоггингврите](/windows/desktop/api/traceloggingprovider/nf-traceloggingprovider-traceloggingwrite) для регистрации и записи событий.
-   Используйте самостоятельное описание событий, чтобы сами события содержали все необходимые сведения для их использования.
-   Может быть включено до восьми сеансов трассировки одновременно.

Все поставщики событий используют семейство интерфейсов API для отслеживания событий ([TraceEvent](/windows/win32/api/evntrace/nf-evntrace-traceevent) для устаревших технологий и [EventWrite](/windows/desktop/api/Evntprov/nf-evntprov-eventwrite) / [евентвритикс](/windows/desktop/api/Evntprov/nf-evntprov-eventwriteex) для более новых версий). Поставщики событий просто отличаются тем, какие типы полей хранятся в полезных данных события, и где они хранят связанные сведения о декодировании событий.

## <a name="consumers"></a>Потребители

Потребители — это приложения, которые выбирают один или несколько сеансов трассировки событий в качестве источника событий. Потребитель может запрашивать события одновременно из нескольких сеансов трассировки событий; система предоставляет события в хронологическом порядке. Потребители могут получать события, хранящиеся в файлах журнала, или из сеансов, которые доставляют события в режиме реального времени. При обработке событий потребитель может указать время начала и окончания, и будут доставлены только те события, которые произошли в заданный промежуток времени. 

Дополнительные сведения см. в разделе [Использование событий](consuming-events.md).

## <a name="missing-events"></a>Отсутствующие события

PerfMon, диагностика системы и другие системные средства могут сообщать об отсутствующих событиях в журнале событий и указывать, что параметры трассировки событий для Windows (ETW) могут быть неоптимальными. События могут быть утрачены по ряду причин:

-   Общий размер события больше 64 КБ. Сюда входит заголовок ETW, а также данные или полезные данные. Пользователь не контролирует эти отсутствующие события, так как размер события настраивается приложением.

-   Размер буфера ETW меньше, чем общий размер события. Пользователь не может управлять этими отсутствующими событиями, так как размер события настраивается приложением для регистрации событий.

-   Для ведения журнала в реальном времени потребитель в режиме реального времени не потребляет события достаточно быстро или вообще не используется, а затем заполняется резервный файл. Это может произойти, если служба журнала событий остановлена и запущена при регистрации событий. Пользователь не контролирует эти отсутствующие события.

-   При ведении журнала в файл он работает слишком долго, чтобы не отследить скорость ведения журнала.

По любой из этих причин сообщите эти проблемы поставщику приложения или службы, которые создают события. Эти проблемы может устранить только разработчик приложения или служба, записывая в журнал события. Если в службе журнала событий содержатся сведения об отсутствующих событиях, это может указывать на проблему с конфигурацией службы журнала событий. Пользователь может иметь ограниченную возможность увеличить максимальное дисковое пространство, которое будет использоваться службой журнала событий, что может уменьшить количество отсутствующих событий.

 

 
