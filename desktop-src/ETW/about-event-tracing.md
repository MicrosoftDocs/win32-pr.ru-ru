---
description: Трассировка событий для Windows (ETW) — это эффективный механизм трассировки на уровне ядра, позволяющий регистрировать события ядра или приложения в файле журнала.
ms.assetid: 0eaa7bd3-8537-483a-b0d6-db3b790a6f3d
title: Сведения о трассировке событий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3a2f13284cec1d9300c23241fafe154f277f72a3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103991272"
---
# <a name="about-event-tracing"></a><span data-ttu-id="55718-103">Сведения о трассировке событий</span><span class="sxs-lookup"><span data-stu-id="55718-103">About Event Tracing</span></span>

<span data-ttu-id="55718-104">Трассировка событий для Windows (ETW) — это эффективный механизм трассировки на уровне ядра, позволяющий регистрировать события ядра или приложения в файле журнала.</span><span class="sxs-lookup"><span data-stu-id="55718-104">Event Tracing for Windows (ETW) is an efficient kernel-level tracing facility that lets you log kernel or application-defined events to a log file.</span></span> <span data-ttu-id="55718-105">Вы можете использовать события в режиме реального времени или из файла журнала, используя их для отладки приложения или для определения того, где в приложении возникают проблемы с производительностью.</span><span class="sxs-lookup"><span data-stu-id="55718-105">You can consume the events in real time or from a log file and use them to debug an application or to determine where performance issues are occurring in the application.</span></span>

<span data-ttu-id="55718-106">ETW позволяет динамически включать или отключать трассировку событий, позволяя выполнять подробную трассировку в рабочей среде без необходимости перезапуска компьютера или приложения.</span><span class="sxs-lookup"><span data-stu-id="55718-106">ETW lets you enable or disable event tracing dynamically, allowing you to perform detailed tracing in a production environment without requiring computer or application restarts.</span></span>

<span data-ttu-id="55718-107">API трассировки событий разбивается на три отдельных компонента:</span><span class="sxs-lookup"><span data-stu-id="55718-107">The Event Tracing API is broken into three distinct components:</span></span>

-   <span data-ttu-id="55718-108">[Контроллеры](#controllers), которые запускают и останавливают сеанс трассировки событий и включают поставщиков.</span><span class="sxs-lookup"><span data-stu-id="55718-108">[Controllers](#controllers), which start and stop an event tracing session and enable providers</span></span>
-   <span data-ttu-id="55718-109">[Поставщики](#providers), которые предоставляют события</span><span class="sxs-lookup"><span data-stu-id="55718-109">[Providers](#providers), which provide the events</span></span>
-   <span data-ttu-id="55718-110">[Потребители](#consumers), которые используют события</span><span class="sxs-lookup"><span data-stu-id="55718-110">[Consumers](#consumers), which consume the events</span></span>

<span data-ttu-id="55718-111">На следующей диаграмме показана модель трассировки событий.</span><span class="sxs-lookup"><span data-stu-id="55718-111">The following diagram shows the event tracing model.</span></span>

![модель трассировки событий](images/etdiag2.png)

## <a name="controllers"></a><span data-ttu-id="55718-113">Контроллеры</span><span class="sxs-lookup"><span data-stu-id="55718-113">Controllers</span></span>

<span data-ttu-id="55718-114">Контроллеры — это приложения, которые определяют размер и расположение файла журнала, запускает и останавливает [сеансы трассировки событий](event-tracing-sessions.md), включают поставщиков, чтобы они могли регистрировать события в сеансе, управлять размером буферного пула и получать статистику выполнения для сеансов.</span><span class="sxs-lookup"><span data-stu-id="55718-114">Controllers are applications that define the size and location of the log file, start and stop [event tracing sessions](event-tracing-sessions.md), enable providers so they can log events to the session, manage the size of the buffer pool, and obtain execution statistics for sessions.</span></span> <span data-ttu-id="55718-115">Статистика сеанса включает количество используемых буферов, количество доставленных буферов, а также количество потерянных событий и буферов.</span><span class="sxs-lookup"><span data-stu-id="55718-115">Session statistics include the number of buffers used, the number of buffers delivered, and the number of events and buffers lost.</span></span> 

<span data-ttu-id="55718-116">Дополнительные сведения см. в разделе [Управление сеансами трассировки событий](controlling-event-tracing-sessions.md).</span><span class="sxs-lookup"><span data-stu-id="55718-116">For more information, see [Controlling Event Tracing Sessions](controlling-event-tracing-sessions.md).</span></span>

## <a name="providers"></a><span data-ttu-id="55718-117">Поставщики</span><span class="sxs-lookup"><span data-stu-id="55718-117">Providers</span></span>

<span data-ttu-id="55718-118">Поставщики — это приложения, которые содержат Инструментирование трассировки событий.</span><span class="sxs-lookup"><span data-stu-id="55718-118">Providers are applications that contain event tracing instrumentation.</span></span> <span data-ttu-id="55718-119">После того как поставщик регистрируется, контроллер может включить или отключить трассировку событий в поставщике.</span><span class="sxs-lookup"><span data-stu-id="55718-119">After a provider registers itself, a controller can then enable or disable event tracing in the provider.</span></span> <span data-ttu-id="55718-120">Поставщик определяет его интерпретацию включения или отключения.</span><span class="sxs-lookup"><span data-stu-id="55718-120">The provider defines its interpretation of being enabled or disabled.</span></span> <span data-ttu-id="55718-121">Как правило, включенный поставщик создает события, а отключенный поставщик — нет.</span><span class="sxs-lookup"><span data-stu-id="55718-121">Generally, an enabled provider generates events, while a disabled provider does not.</span></span> <span data-ttu-id="55718-122">Это позволяет добавлять в приложение трассировку событий, не требуя, чтобы она создавала события все время.</span><span class="sxs-lookup"><span data-stu-id="55718-122">This lets you add event tracing to your application without requiring that it generate events all the time.</span></span> 

<span data-ttu-id="55718-123">Хотя модель ETW разделяет контроллер и поставщика на отдельные приложения, приложение может включать оба компонента.</span><span class="sxs-lookup"><span data-stu-id="55718-123">Although the ETW model separates the controller and provider into separate applications, an application can include both components.</span></span>

<span data-ttu-id="55718-124">Дополнительные сведения см. в разделе [предоставление событий](providing-events.md).</span><span class="sxs-lookup"><span data-stu-id="55718-124">For more information, see [Providing Events](providing-events.md).</span></span>

### <a name="types-of-providers"></a><span data-ttu-id="55718-125">Типы поставщиков</span><span class="sxs-lookup"><span data-stu-id="55718-125">Types of Providers</span></span>

<span data-ttu-id="55718-126">Существует четыре основных типа поставщиков: поставщики MOF (классические), поставщики WPP, поставщики на основе манифестов и поставщики Трацелоггинг.</span><span class="sxs-lookup"><span data-stu-id="55718-126">There are four main types of providers: MOF (classic) providers, WPP providers, manifest-based providers, and TraceLogging providers.</span></span> <span data-ttu-id="55718-127">При написании приложений для Windows Vista или более поздней версии, которые не нуждаются в поддержке устаревших систем, следует использовать поставщик на основе манифеста или поставщик Трацелоггинг.</span><span class="sxs-lookup"><span data-stu-id="55718-127">You should use a manifest-based provider or a TraceLogging provider if you are writing applications for Windows Vista or later that do not need to support legacy systems.</span></span>

#### <a name="mof-classic-providers"></a><span data-ttu-id="55718-128">Поставщики MOF (классические):</span><span class="sxs-lookup"><span data-stu-id="55718-128">MOF (classic) providers:</span></span>

-   <span data-ttu-id="55718-129">Используйте функции [регистертрацегуидс](/windows/win32/api/evntrace/nf-evntrace-registertraceguidsa) и [TraceEvent](/windows/win32/api/evntrace/nf-evntrace-traceevent) для регистрации и записи событий.</span><span class="sxs-lookup"><span data-stu-id="55718-129">Use the [RegisterTraceGuids](/windows/win32/api/evntrace/nf-evntrace-registertraceguidsa) and [TraceEvent](/windows/win32/api/evntrace/nf-evntrace-traceevent) functions to register and write events.</span></span>
-   <span data-ttu-id="55718-130">Используйте классы MOF для определения событий, чтобы потребители узнают, как их использовать.</span><span class="sxs-lookup"><span data-stu-id="55718-130">Use MOF classes to define events so that consumers know how to consume them.</span></span>
-   <span data-ttu-id="55718-131">Может быть включено только одним сеансом трассировки за раз.</span><span class="sxs-lookup"><span data-stu-id="55718-131">Can be enabled by only one trace session at a time.</span></span>

#### <a name="wpp-providers"></a><span data-ttu-id="55718-132">Поставщики WPP:</span><span class="sxs-lookup"><span data-stu-id="55718-132">WPP providers:</span></span>

-   <span data-ttu-id="55718-133">Используйте функции [регистертрацегуидс](/windows/win32/api/evntrace/nf-evntrace-registertraceguidsa) и [TraceEvent](/windows/win32/api/evntrace/nf-evntrace-traceevent) для регистрации и записи событий.</span><span class="sxs-lookup"><span data-stu-id="55718-133">Use the [RegisterTraceGuids](/windows/win32/api/evntrace/nf-evntrace-registertraceguidsa) and [TraceEvent](/windows/win32/api/evntrace/nf-evntrace-traceevent) functions to register and write events.</span></span>
-   <span data-ttu-id="55718-134">Имеют связанные файлы ТМФ (скомпилированные в PDB-файл), содержащие сведения о декодировании, выведенные из проверки препроцессора на наличие инструментирования WPP в исходном коде.</span><span class="sxs-lookup"><span data-stu-id="55718-134">Have associated TMF files (compiled into a binary's .pdb) containing decoding information inferred from the preprocessor's scan of WPP instrumentation in source code.</span></span>
-   <span data-ttu-id="55718-135">Может быть включено только одним сеансом трассировки за раз.</span><span class="sxs-lookup"><span data-stu-id="55718-135">Can be enabled by only one trace session at a time.</span></span>

#### <a name="manifest-based-providers"></a><span data-ttu-id="55718-136">Поставщики на основе манифеста:</span><span class="sxs-lookup"><span data-stu-id="55718-136">Manifest-based providers:</span></span>

-   <span data-ttu-id="55718-137">Используйте [EventRegister](/windows/desktop/api/Evntprov/nf-evntprov-eventregister) и [EventWrite](/windows/desktop/api/Evntprov/nf-evntprov-eventwrite) для регистрации и записи событий.</span><span class="sxs-lookup"><span data-stu-id="55718-137">Use [EventRegister](/windows/desktop/api/Evntprov/nf-evntprov-eventregister) and [EventWrite](/windows/desktop/api/Evntprov/nf-evntprov-eventwrite) to register and write events.</span></span>
-   <span data-ttu-id="55718-138">Используйте манифест для определения событий, чтобы потребители узнают, как их использовать.</span><span class="sxs-lookup"><span data-stu-id="55718-138">Use a manifest to define events so that consumers know how to consume them.</span></span>
-   <span data-ttu-id="55718-139">Может быть включено до восьми сеансов трассировки одновременно.</span><span class="sxs-lookup"><span data-stu-id="55718-139">Can be enabled by up to eight trace sessions simultaneously.</span></span>

#### <a name="tracelogging-providers"></a><span data-ttu-id="55718-140">Поставщики [трацелоггинг](/windows/desktop/tracelogging/trace-logging-about) :</span><span class="sxs-lookup"><span data-stu-id="55718-140">[TraceLogging](/windows/desktop/tracelogging/trace-logging-about) providers:</span></span>

-   <span data-ttu-id="55718-141">Используйте [трацелоггингрегистер](/windows/desktop/api/traceloggingprovider/nf-traceloggingprovider-traceloggingregister) и [трацелоггингврите](/windows/desktop/api/traceloggingprovider/nf-traceloggingprovider-traceloggingwrite) для регистрации и записи событий.</span><span class="sxs-lookup"><span data-stu-id="55718-141">Use [TraceLoggingRegister](/windows/desktop/api/traceloggingprovider/nf-traceloggingprovider-traceloggingregister) and [TraceLoggingWrite](/windows/desktop/api/traceloggingprovider/nf-traceloggingprovider-traceloggingwrite) to register and write events.</span></span>
-   <span data-ttu-id="55718-142">Используйте самостоятельное описание событий, чтобы сами события содержали все необходимые сведения для их использования.</span><span class="sxs-lookup"><span data-stu-id="55718-142">Use self-describing events so that the events themselves contain all required information for consuming them.</span></span>
-   <span data-ttu-id="55718-143">Может быть включено до восьми сеансов трассировки одновременно.</span><span class="sxs-lookup"><span data-stu-id="55718-143">Can be enabled by up to eight trace sessions simultaneously.</span></span>

<span data-ttu-id="55718-144">Все поставщики событий используют семейство интерфейсов API для отслеживания событий ([TraceEvent](/windows/win32/api/evntrace/nf-evntrace-traceevent) для устаревших технологий и [EventWrite](/windows/desktop/api/Evntprov/nf-evntprov-eventwrite) / [евентвритикс](/windows/desktop/api/Evntprov/nf-evntprov-eventwriteex) для более новых версий).</span><span class="sxs-lookup"><span data-stu-id="55718-144">All event providers fundamentally use the Event Tracing family of APIs ([TraceEvent](/windows/win32/api/evntrace/nf-evntrace-traceevent) for legacy technologies and [EventWrite](/windows/desktop/api/Evntprov/nf-evntprov-eventwrite)/[EventWriteEx](/windows/desktop/api/Evntprov/nf-evntprov-eventwriteex) for newer ones).</span></span> <span data-ttu-id="55718-145">Поставщики событий просто отличаются тем, какие типы полей хранятся в полезных данных события, и где они хранят связанные сведения о декодировании событий.</span><span class="sxs-lookup"><span data-stu-id="55718-145">Event providers simply differ in what field types they store in event payloads and where they store the associated event decoding information.</span></span>

## <a name="consumers"></a><span data-ttu-id="55718-146">Потребители</span><span class="sxs-lookup"><span data-stu-id="55718-146">Consumers</span></span>

<span data-ttu-id="55718-147">Потребители — это приложения, которые выбирают один или несколько сеансов трассировки событий в качестве источника событий.</span><span class="sxs-lookup"><span data-stu-id="55718-147">Consumers are applications that select one or more event tracing sessions as a source of events.</span></span> <span data-ttu-id="55718-148">Потребитель может запрашивать события одновременно из нескольких сеансов трассировки событий; система предоставляет события в хронологическом порядке.</span><span class="sxs-lookup"><span data-stu-id="55718-148">A consumer can request events from multiple event tracing sessions simultaneously; the system delivers the events in chronological order.</span></span> <span data-ttu-id="55718-149">Потребители могут получать события, хранящиеся в файлах журнала, или из сеансов, которые доставляют события в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="55718-149">Consumers can receive events stored in log files, or from sessions that deliver events in real time.</span></span> <span data-ttu-id="55718-150">При обработке событий потребитель может указать время начала и окончания, и будут доставлены только те события, которые произошли в заданный промежуток времени.</span><span class="sxs-lookup"><span data-stu-id="55718-150">When processing events, a consumer can specify start and end times, and only events that occur in the specified time frame will be delivered.</span></span> 

<span data-ttu-id="55718-151">Дополнительные сведения см. в разделе [Использование событий](consuming-events.md).</span><span class="sxs-lookup"><span data-stu-id="55718-151">For more information, see [Consuming Events](consuming-events.md).</span></span>

## <a name="missing-events"></a><span data-ttu-id="55718-152">Отсутствующие события</span><span class="sxs-lookup"><span data-stu-id="55718-152">Missing Events</span></span>

<span data-ttu-id="55718-153">PerfMon, диагностика системы и другие системные средства могут сообщать об отсутствующих событиях в журнале событий и указывать, что параметры трассировки событий для Windows (ETW) могут быть неоптимальными.</span><span class="sxs-lookup"><span data-stu-id="55718-153">Perfmon, System Diagnostics, and other system tools may report on missing events in the Event Log and indicate that the settings for Event Tracing for Windows (ETW) may not be optimal.</span></span> <span data-ttu-id="55718-154">События могут быть утрачены по ряду причин:</span><span class="sxs-lookup"><span data-stu-id="55718-154">Events can be lost for a number of reasons:</span></span>

-   <span data-ttu-id="55718-155">Общий размер события больше 64 КБ.</span><span class="sxs-lookup"><span data-stu-id="55718-155">The total event size is greater than 64K.</span></span> <span data-ttu-id="55718-156">Сюда входит заголовок ETW, а также данные или полезные данные.</span><span class="sxs-lookup"><span data-stu-id="55718-156">This includes the ETW header plus the data or payload.</span></span> <span data-ttu-id="55718-157">Пользователь не контролирует эти отсутствующие события, так как размер события настраивается приложением.</span><span class="sxs-lookup"><span data-stu-id="55718-157">A user has no control over these missing events since the event size is configured by the application.</span></span>

-   <span data-ttu-id="55718-158">Размер буфера ETW меньше, чем общий размер события.</span><span class="sxs-lookup"><span data-stu-id="55718-158">The ETW buffer size is smaller than the total event size.</span></span> <span data-ttu-id="55718-159">Пользователь не может управлять этими отсутствующими событиями, так как размер события настраивается приложением для регистрации событий.</span><span class="sxs-lookup"><span data-stu-id="55718-159">A user has no control over these missing events since the event size is configured by the application logging the events.</span></span>

-   <span data-ttu-id="55718-160">Для ведения журнала в реальном времени потребитель в режиме реального времени не потребляет события достаточно быстро или вообще не используется, а затем заполняется резервный файл.</span><span class="sxs-lookup"><span data-stu-id="55718-160">For real-time logging, the real-time consumer is not consuming events fast enough or is not present altogether and then the backing file is filling up.</span></span> <span data-ttu-id="55718-161">Это может произойти, если служба журнала событий остановлена и запущена при регистрации событий.</span><span class="sxs-lookup"><span data-stu-id="55718-161">This can result if the Event Log service is stopped and started when events are being logged.</span></span> <span data-ttu-id="55718-162">Пользователь не контролирует эти отсутствующие события.</span><span class="sxs-lookup"><span data-stu-id="55718-162">A user has no control over these missing events.</span></span>

-   <span data-ttu-id="55718-163">При ведении журнала в файл он работает слишком долго, чтобы не отследить скорость ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="55718-163">When logging to a file, the disk is too slow to keep up with the logging rate.</span></span>

<span data-ttu-id="55718-164">По любой из этих причин сообщите эти проблемы поставщику приложения или службы, которые создают события.</span><span class="sxs-lookup"><span data-stu-id="55718-164">For any of these reasons, please report these problems to the provider of the application or service that is generating the events.</span></span> <span data-ttu-id="55718-165">Эти проблемы может устранить только разработчик приложения или служба, записывая в журнал события.</span><span class="sxs-lookup"><span data-stu-id="55718-165">These issues can only be fixed by the application developer or the service logging the events.</span></span> <span data-ttu-id="55718-166">Если в службе журнала событий содержатся сведения об отсутствующих событиях, это может указывать на проблему с конфигурацией службы журнала событий.</span><span class="sxs-lookup"><span data-stu-id="55718-166">If the missing events are being reported in the Event Log Service, this may indicate a problem with the configuration of the Event Log service.</span></span> <span data-ttu-id="55718-167">Пользователь может иметь ограниченную возможность увеличить максимальное дисковое пространство, которое будет использоваться службой журнала событий, что может уменьшить количество отсутствующих событий.</span><span class="sxs-lookup"><span data-stu-id="55718-167">The user may have some limited ability to increase the maximum disk space to be used by the Event Log Service which may reduce the number of missing events.</span></span>

 

 
