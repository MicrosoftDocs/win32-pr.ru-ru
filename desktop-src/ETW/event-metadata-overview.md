---
description: 'В этой статье представлен обзор того, что следует рассчитывать на полное путешествие события для каждой из четырех технологий отслеживания, предоставляемых корпорацией Майкрософт: Трацелоггинг, на основе манифеста, WPP и MOF.'
ms.assetid: 6102593C-C6D5-4BDB-A0EF-067AF91DE00B
title: Общие сведения о метаданных событий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0c16853ef2639fd560f5b5da30447556119ec877
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104497025"
---
# <a name="event-metadata-overview"></a><span data-ttu-id="1f002-103">Общие сведения о метаданных событий</span><span class="sxs-lookup"><span data-stu-id="1f002-103">Event Metadata Overview</span></span>

<span data-ttu-id="1f002-104">В этой статье представлен обзор того, что следует рассчитывать на полное путешествие события для каждой из четырех технологий отслеживания, предоставляемых корпорацией Майкрософт: [трацелоггинг](../tracelogging/trace-logging-about.md), [на основе манифеста](writing-manifest-based-events.md), [WPP](windows-software-trace-preprocessor.md)и [MOF](tracing-events.md).</span><span class="sxs-lookup"><span data-stu-id="1f002-104">This is an overview of what to expect for the end-to-end journey of an event for each of the four tracing technologies furnished by Microsoft: [TraceLogging](../tracelogging/trace-logging-about.md), [Manifest-based](writing-manifest-based-events.md), [WPP](windows-software-trace-preprocessor.md), and [MOF](tracing-events.md).</span></span> <span data-ttu-id="1f002-105">Он приближается к проблеме в отношении полезных данных отдельного события и сопутствующих метаданных, описывающих его структуру, что позволяет впоследствии декодировать событие в разумные фрагменты данных.</span><span class="sxs-lookup"><span data-stu-id="1f002-105">It approaches the problem with respect to both an individual event's payload and the accompanying metadata that describes its structure, making it possible to later decode the event into sensible pieces of data.</span></span> <span data-ttu-id="1f002-106">Понимание пути к каждому элементу события важно при выборе технологии трассировки для проекта.</span><span class="sxs-lookup"><span data-stu-id="1f002-106">Understanding the journey of each piece of an event is important when choosing which tracing technology is appropriate for a project.</span></span> <span data-ttu-id="1f002-107">Для трассировки не существует такого решения.</span><span class="sxs-lookup"><span data-stu-id="1f002-107">There is no one-size-fits-all solution to tracing.</span></span>

## <a name="event-payloads"></a><span data-ttu-id="1f002-108">Полезные данные события</span><span class="sxs-lookup"><span data-stu-id="1f002-108">Event Payloads</span></span>

<span data-ttu-id="1f002-109">Для любой из технологий отслеживания, предоставляемых корпорацией Майкрософт, при вызове команды Write (для экземпляра [**EventWrite**](/windows/desktop/api/Evntprov/nf-evntprov-eventwrite) для манифеста или [**трацелоггингврите**](/windows/win32/api/traceloggingprovider/nf-traceloggingprovider-traceloggingwrite) для трацелоггинг) данные, предоставляемые для события во время выполнения, сведены в непрерывный двоичный BLOB-объект, называемый полезной нагрузкой событий.</span><span class="sxs-lookup"><span data-stu-id="1f002-109">For any of the Microsoft-provided tracing technologies, when calling the Write command (for instance [**EventWrite**](/windows/desktop/api/Evntprov/nf-evntprov-eventwrite) for manifest-based or [**TraceLoggingWrite**](/windows/win32/api/traceloggingprovider/nf-traceloggingprovider-traceloggingwrite) for TraceLogging), the data provided for the event at runtime is folded into a contiguous binary blob called the event payload.</span></span> <span data-ttu-id="1f002-110">Это отдельно от схемы событий или метаданных событий (описываемых ниже), описывающих структуру двоичного BLOB-объекта для средств декодирования.</span><span class="sxs-lookup"><span data-stu-id="1f002-110">This is separate from the event schema or event metadata (discussed below), which describes the layout of this binary blob for decoding tools.</span></span> <span data-ttu-id="1f002-111">То, как именно будет создаваться полезная нагрузка события, зависит от используемой технологии трассировки и в конечном итоге является ли событие классическим ([**TraceEvent**](/windows/win32/api/evntrace/nf-evntrace-traceevent) Style) или современным (**EventWrite** Style).</span><span class="sxs-lookup"><span data-stu-id="1f002-111">How exactly the generation of the event payload happens varies depending on the tracing technology used and ultimately whether the event is classic ([**TraceEvent**](/windows/win32/api/evntrace/nf-evntrace-traceevent) style) or modern (**EventWrite** style).</span></span>

<span data-ttu-id="1f002-112">Для классических событий флаг в [**\_ \_ заголовке трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_header) передается в [**TraceEvent**](/windows/win32/api/evntrace/nf-evntrace-traceevent) , который определяет, как это происходит:</span><span class="sxs-lookup"><span data-stu-id="1f002-112">For classic events, the flag in [**EVENT\_TRACE\_HEADER**](/windows/win32/api/evntrace/ns-evntrace-event_trace_header) is passed into [**TraceEvent**](/windows/win32/api/evntrace/nf-evntrace-traceevent) which determines how this occurs:</span></span>

<span data-ttu-id="1f002-113">\- Если **задан \_ флаг вноде \_ использовать \_ MOF \_ ptr** , массив [**\_ полей MOF**](/windows/win32/api/evntrace/ns-evntrace-mof_field) следует за [**\_ \_ заголовком трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_header) в памяти.</span><span class="sxs-lookup"><span data-stu-id="1f002-113">\- If **WNODE\_FLAG\_USE\_MOF\_PTR** is specified, an array of [**MOF\_FIELDS**](/windows/win32/api/evntrace/ns-evntrace-mof_field) follows the [**EVENT\_TRACE\_HEADER**](/windows/win32/api/evntrace/ns-evntrace-event_trace_header) in memory.</span></span> <span data-ttu-id="1f002-114">Среда выполнения ETW будет объединять данные событий, как указано в этих полях, для формирования полезных данных события.</span><span class="sxs-lookup"><span data-stu-id="1f002-114">The ETW runtime will concatenate the event data as specified in these fields to form the event payload.</span></span>

<span data-ttu-id="1f002-115">\- Если **\_ флаг вноде \_ использовать \_ MOF \_ ptr** не указан, полезные данные события создаются пользователем непосредственно в памяти после [**\_ \_ заголовка трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_header).</span><span class="sxs-lookup"><span data-stu-id="1f002-115">\- If **WNODE\_FLAG\_USE\_MOF\_PTR** is not specified, the event payload is constructed by the user directly in memory following the [**EVENT\_TRACE\_HEADER**](/windows/win32/api/evntrace/ns-evntrace-event_trace_header).</span></span>

<span data-ttu-id="1f002-116">MOF и WPP являются классическими поставщиками.</span><span class="sxs-lookup"><span data-stu-id="1f002-116">Both MOF and WPP are classic providers.</span></span> <span data-ttu-id="1f002-117">Тем не менее, реализация КОНВЕЙЕРа позаботится об этом.</span><span class="sxs-lookup"><span data-stu-id="1f002-117">However, the WPP implementation takes care of all of this for you.</span></span>

<span data-ttu-id="1f002-118">Для неклассических событий в [**EventWrite**](/windows/desktop/api/Evntprov/nf-evntprov-eventwrite)передается ряд [**\_ \_ дескрипторов данных событий**](/windows/desktop/api/Evntprov/ns-evntprov-event_data_descriptor) .</span><span class="sxs-lookup"><span data-stu-id="1f002-118">For non-classic events, a number of [**EVENT\_DATA\_DESCRIPTORS**](/windows/desktop/api/Evntprov/ns-evntprov-event_data_descriptor) are passed into [**EventWrite**](/windows/desktop/api/Evntprov/nf-evntprov-eventwrite).</span></span> <span data-ttu-id="1f002-119">Среда выполнения ETW будет объединять данные событий, как указано в дескрипторах, для формирования полезных данных события.</span><span class="sxs-lookup"><span data-stu-id="1f002-119">The ETW runtime will concatenate the event data as specified in these descriptors to form the event payload.</span></span>

<span data-ttu-id="1f002-120">Технологии на основе манифеста и Трацелоггинг обычно являются современными поставщиками.</span><span class="sxs-lookup"><span data-stu-id="1f002-120">Both Manifest-based and TraceLogging technologies are generally modern providers.</span></span> <span data-ttu-id="1f002-121">При использовании на основе манифеста, если вы разрешите mc.exe создать код ведения журнала для вас (коммутатор UM или км), будет создана полезная нагрузка.</span><span class="sxs-lookup"><span data-stu-id="1f002-121">With manifest-based, if you let mc.exe generate logging code for you (um or km switch), payload generation is taken care of for you.</span></span> <span data-ttu-id="1f002-122">Создание полезных данных всегда осуществляется с помощью Трацелоггинг.</span><span class="sxs-lookup"><span data-stu-id="1f002-122">Payload generation is always taken care of by TraceLogging.</span></span>

<span data-ttu-id="1f002-123">Конечным результатом является то, что полезная нагрузка для события создается во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="1f002-123">The end result is that a payload for an event is generated at runtime.</span></span> <span data-ttu-id="1f002-124">Все полезные данные в основном похожи на двоичные BLOB-объекты данных, содержащие только данные полей для конкретного события, независимо от используемой технологии трассировки и того, какие типы полей поддерживаются этой технологией трассировки.</span><span class="sxs-lookup"><span data-stu-id="1f002-124">All payloads are fundamentally similar in that they are binary blobs of data containing only the field data for that particular event, regardless of the tracing technology used and which field types are supported by that tracing technology.</span></span> <span data-ttu-id="1f002-125">Без метаданных событий полезные данные события не имеют смысла и заняться.</span><span class="sxs-lookup"><span data-stu-id="1f002-125">Without the event metadata, the event payload is meaningless and unintelligable.</span></span>

<span data-ttu-id="1f002-126">Затем обязанность среды выполнения ETW перемещает этот большой двоичный объект события от поставщика к потребителю, где он повторно связывается с метаданными и становится декодабле.</span><span class="sxs-lookup"><span data-stu-id="1f002-126">The ETW runtime's duty is then to carry this event blob from the provider to the consumer, where it is re-associated with its metadata and becomes decodable.</span></span> <span data-ttu-id="1f002-127">В среде выполнения ETW будет добавлено несколько дополнительных метаданных, указывающих на обстоятельства полезной нагрузки — например, отметка времени, идентификатор потока и ключевые слова события.</span><span class="sxs-lookup"><span data-stu-id="1f002-127">The ETW runtime will add a bit of extra metadata indicating the circumstances of the payload -- for instance things like the timestamp, thread ID, and keywords of the event.</span></span> <span data-ttu-id="1f002-128">Эта информация связана с тем, как событие направляется через среду выполнения, и оно также полезно для понимания удостоверения и контекста события во время декодирования.</span><span class="sxs-lookup"><span data-stu-id="1f002-128">This information is relevant to how the event was routed through the runtime, and it is also useful for understanding the identity and context of the event at decoding time.</span></span> <span data-ttu-id="1f002-129">В конечном итоге он отображается как часть [**\_ трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace) или [**\_ записи события**](/windows/win32/api/evntcons/ns-evntcons-event_record) для потребителя.</span><span class="sxs-lookup"><span data-stu-id="1f002-129">It is eventually surfaced as part of the [**EVENT\_TRACE**](/windows/win32/api/evntrace/ns-evntrace-event_trace) or [**EVENT\_RECORD**](/windows/win32/api/evntcons/ns-evntcons-event_record) for the consumer</span></span>

## <a name="event-metadata"></a><span data-ttu-id="1f002-130">Метаданные события</span><span class="sxs-lookup"><span data-stu-id="1f002-130">Event Metadata</span></span>

<span data-ttu-id="1f002-131">Путь к метаданным события отличается в зависимости от используемой технологии трассировки и является одним из самых крупных факторов при сравнении каждой технологии.</span><span class="sxs-lookup"><span data-stu-id="1f002-131">The journey for event metadata is different depending on which tracing technology is used, and it is one of the largest considerations when comparing each technology.</span></span>

### <a name="mof"></a><span data-ttu-id="1f002-132">MOF</span><span class="sxs-lookup"><span data-stu-id="1f002-132">MOF</span></span>

<span data-ttu-id="1f002-133">Метаданные события создаются вручную создателем события в виде специальной схемы MOF в MOF-файле.</span><span class="sxs-lookup"><span data-stu-id="1f002-133">Event metadata is authored by hand by the creator of the event in the form of a special MOF schema in a .mof file.</span></span> <span data-ttu-id="1f002-134">Созданная схема должна соответствовать полезной нагрузке, которая заносится в журнал, чтобы событие было правильно декодировано потребителями.</span><span class="sxs-lookup"><span data-stu-id="1f002-134">The schema authored must match the payload that is logged in order for the event to be correctly decoded by consumers.</span></span> <span data-ttu-id="1f002-135">Для использования декодеров событий необходимо, чтобы MOF-файл был зарегистрирован в системе с помощью [mofcomp.exe](../wmisdk/mofcomp.md).</span><span class="sxs-lookup"><span data-stu-id="1f002-135">Event decoders require that the .mof file is registered on the system using [mofcomp.exe](../wmisdk/mofcomp.md).</span></span> <span data-ttu-id="1f002-136">Дополнительные сведения о публикации схем MOF см. в статье [Публикация схемы событий для классического поставщика](publishing-your-event-schema-for-a-classic-provider.md).</span><span class="sxs-lookup"><span data-stu-id="1f002-136">For more information on publishing MOF schemas, see [Publishing Your Event Schema for a Classic Provider](publishing-your-event-schema-for-a-classic-provider.md).</span></span>

### <a name="wpp"></a><span data-ttu-id="1f002-137">ПУБЛИКАЦИИ</span><span class="sxs-lookup"><span data-stu-id="1f002-137">WPP</span></span>

<span data-ttu-id="1f002-138">Метаданные события создаются автоматически и сохраняются в файле. pdb путем tracewpp.exe в процессе сборки.</span><span class="sxs-lookup"><span data-stu-id="1f002-138">Event metadata is automatically generated and stored in your binary's .pdb by tracewpp.exe during the build process.</span></span> <span data-ttu-id="1f002-139">Эти метаданные впоследствии можно извлечь в виде автономного файла ТМФ, используя tracepdb.exe.</span><span class="sxs-lookup"><span data-stu-id="1f002-139">This metadata can later be extracted in the form of a standalone .tmf file by way of tracepdb.exe.</span></span> <span data-ttu-id="1f002-140">Для декодеров событий обычно требуется файл. pdb или. ТМФ.</span><span class="sxs-lookup"><span data-stu-id="1f002-140">Event decoders typically require either the .pdb or the .tmf file.</span></span> <span data-ttu-id="1f002-141">Дополнительные сведения о tracepdb.exe см. в разделе Общие сведения о [трацепдб](/windows-hardware/drivers/devtest/tracepdb-overview)и дополнительные сведения о tracewpp.exe см. в разделе [задача трацевпп](/windows-hardware/drivers/devtest/tracewpp-task).</span><span class="sxs-lookup"><span data-stu-id="1f002-141">For more information on tracepdb.exe, see [Tracepdb Overview](/windows-hardware/drivers/devtest/tracepdb-overview), and for more information on tracewpp.exe, see [TraceWPP task](/windows-hardware/drivers/devtest/tracewpp-task).</span></span>

### <a name="manifest-based"></a><span data-ttu-id="1f002-142">На основе манифеста</span><span class="sxs-lookup"><span data-stu-id="1f002-142">Manifest-based</span></span>

<span data-ttu-id="1f002-143">Определения событий создаются в man-файле.</span><span class="sxs-lookup"><span data-stu-id="1f002-143">Event definitions are authored in a .man file.</span></span> <span data-ttu-id="1f002-144">Манифесты событий выполняются с помощью компилятора манифеста ([mc.exe](../wes/message-compiler--mc-exe-.md)), создавая заголовки, необходимые для компиляции источника, а также несколько двоичных файлов ресурсов bin.</span><span class="sxs-lookup"><span data-stu-id="1f002-144">Event manifests are run through the manifest compiler ([mc.exe](../wes/message-compiler--mc-exe-.md)), generating the headers needed for source compilation as well as several .bin binary resource files.</span></span> <span data-ttu-id="1f002-145">Затем эти файлы ресурсов должны быть скомпилированы в виде ресурсов в двоичный файл, а результирующий двоичный файл, который планируется декодировать события из этого поставщика на основе манифеста, будет помещен в систему.</span><span class="sxs-lookup"><span data-stu-id="1f002-145">These resource files must then be compiled as resources into a binary and the resulting binary placed on the system that intends to decode events from that manifest-based provider.</span></span> <span data-ttu-id="1f002-146">Кроме того, манифест должен быть установлен в системе с помощью [wevtutil.exe](../wes/windows-event-log-tools.md) что самое важное, атрибуты **ресаурцефиленаме** и **мессажефиленаме** в XML-элементе provider в установленном манифесте события должны правильно определять полный абсолютный путь к двоичному файлу, в который были помещены файлы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="1f002-146">Additionally, the manifest must be installed on the system using [wevtutil.exe](../wes/windows-event-log-tools.md) Most importantly, the **resourceFileName** and **messageFileName** attributes on the provider XML element in the installed event manifest must correctly identify the full absolute path to the binary in which the resource files were placed.</span></span> <span data-ttu-id="1f002-147">Обратите внимание, что эти пути могут быть перезаписаны во время установки манифеста с помощью параметров wevtutil.exe/РФ и/МФ..</span><span class="sxs-lookup"><span data-stu-id="1f002-147">Note that these paths may be overwritten at manifest install time by using the wevtutil.exe switches /rf and /mf.</span></span> <span data-ttu-id="1f002-148">Система, которая неправильно и полностью выполнила эти действия, не сможет декодировать события от этого поставщика.</span><span class="sxs-lookup"><span data-stu-id="1f002-148">A system that has not correctly and fully performed these steps will be unable to decode events from this provider.</span></span> <span data-ttu-id="1f002-149">Поэтому для декодеров событий требуется установленный манифест и двоичный файл со связанными ресурсами, установленными в расположении, указанном в пути к ресурсам и файлам сообщений.</span><span class="sxs-lookup"><span data-stu-id="1f002-149">Event decoders thus require an installed manifest, and the binary with the associated resources installed in the location specified by resource and message file paths.</span></span> <span data-ttu-id="1f002-150">Дополнительные сведения о публикации схем на основе манифеста см. в статье [Публикация схемы событий для поставщика на основе манифеста](publishing-your-event-schema-for-a-manifest-base-provider.md).</span><span class="sxs-lookup"><span data-stu-id="1f002-150">For more information on publishing manifest-based schemas, see [Publishing Your Event Schema for a Manifest-based Provider](publishing-your-event-schema-for-a-manifest-base-provider.md).</span></span>

### <a name="tracelogging"></a><span data-ttu-id="1f002-151">TraceLogging</span><span class="sxs-lookup"><span data-stu-id="1f002-151">TraceLogging</span></span>

<span data-ttu-id="1f002-152">Все события Трацелоггинг являются самоописывающимися.</span><span class="sxs-lookup"><span data-stu-id="1f002-152">All TraceLogging events are self-describing.</span></span> <span data-ttu-id="1f002-153">Метаданные события, необходимые для декодирования события, автоматически создаются и передаются вместе с полезными данными в компактном двоичном формате.</span><span class="sxs-lookup"><span data-stu-id="1f002-153">The event metadata necessary to decode the event is automatically generated and transmitted along with the payload in a compact binary format.</span></span> <span data-ttu-id="1f002-154">Декодерам событий требуется только событие Трацелоггинг и понимание формата метаданных Трацелоггинг.</span><span class="sxs-lookup"><span data-stu-id="1f002-154">Event decoders need only the TraceLogging event and an understanding of the TraceLogging metadata format.</span></span>

## <a name="configuring-tdh-for-decoding"></a><span data-ttu-id="1f002-155">Настройка TDH для декодирования</span><span class="sxs-lookup"><span data-stu-id="1f002-155">Configuring TDH for Decoding</span></span>

<span data-ttu-id="1f002-156">Существует множество средств декодирования.</span><span class="sxs-lookup"><span data-stu-id="1f002-156">There are many decoding tools out there.</span></span> <span data-ttu-id="1f002-157">Однако рекомендуется использовать TDH там, где это возможно, так как он декодирует все технологии трассировки с помощью унифицированного API.</span><span class="sxs-lookup"><span data-stu-id="1f002-157">However, it is recommended that you use TDH where possible, as it decodes all tracing technologies with a unified API.</span></span> <span data-ttu-id="1f002-158">В зависимости от типа трассировки, которую вы хотите декодировать, TDH может потребовать явной настройки.</span><span class="sxs-lookup"><span data-stu-id="1f002-158">Depending on the type of tracing you are interested in decoding, TDH may require explicit configuration.</span></span>

### <a name="mof"></a><span data-ttu-id="1f002-159">MOF</span><span class="sxs-lookup"><span data-stu-id="1f002-159">MOF</span></span>

<span data-ttu-id="1f002-160">TDH использует данные для декодирования MOF, зарегистрированные в системе, с помощью mofcomp.exe.</span><span class="sxs-lookup"><span data-stu-id="1f002-160">TDH utilizes MOF decoding data registered on the system using mofcomp.exe.</span></span> <span data-ttu-id="1f002-161">Дополнительные сведения см. в статье [Публикация схемы событий для классического поставщика](publishing-your-event-schema-for-a-classic-provider.md).</span><span class="sxs-lookup"><span data-stu-id="1f002-161">For more information, see [Publishing Your Event Schema for a Classic Provider](publishing-your-event-schema-for-a-classic-provider.md).</span></span>

### <a name="wpp"></a><span data-ttu-id="1f002-162">ПУБЛИКАЦИИ</span><span class="sxs-lookup"><span data-stu-id="1f002-162">WPP</span></span>

<span data-ttu-id="1f002-163">TDH должен указывать на PDB-файл или связанный. ТМФ для поставщика WPP, который вы пытаетесь декодировать.</span><span class="sxs-lookup"><span data-stu-id="1f002-163">TDH must be pointed towards either the .pdb file or the associated .tmf for the WPP provider you are trying to decode.</span></span> <span data-ttu-id="1f002-164">Это можно выполнить путем вызова [**тдхсетдекодингпараметер**](/windows/desktop/api/Tdh/nf-tdh-tdhsetdecodingparameter).</span><span class="sxs-lookup"><span data-stu-id="1f002-164">This can be performed by calling [**TdhSetDecodingParameter**](/windows/desktop/api/Tdh/nf-tdh-tdhsetdecodingparameter).</span></span> <span data-ttu-id="1f002-165">В противном случае механизм декодирования будет возвращаться \_ \_ к пути поиска в формате трассировки переменной среды \_ .</span><span class="sxs-lookup"><span data-stu-id="1f002-165">Otherwise, the decoding engine will fall back on the environment variable TRACE\_FORMAT\_SEARCH\_PATH.</span></span>

### <a name="manifest-based"></a><span data-ttu-id="1f002-166">На основе манифеста</span><span class="sxs-lookup"><span data-stu-id="1f002-166">Manifest-based</span></span>

<span data-ttu-id="1f002-167">TDH использует все поставщики на основе манифеста, зарегистрированные в системе, с помощью wevtutil.exe.</span><span class="sxs-lookup"><span data-stu-id="1f002-167">TDH utilizes all manifest-based providers registered on the system using wevtutil.exe.</span></span>

### <a name="tracelogging"></a><span data-ttu-id="1f002-168">TraceLogging</span><span class="sxs-lookup"><span data-stu-id="1f002-168">TraceLogging</span></span>

<span data-ttu-id="1f002-169">Новейшие версии TDH автоматически обнаруживают и декодируются события Трацелоггинг без дополнительных действий.</span><span class="sxs-lookup"><span data-stu-id="1f002-169">The newest versions of TDH automatically detect and decode TraceLogging events with no additional steps.</span></span>

 

 
