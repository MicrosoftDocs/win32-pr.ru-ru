---
description: Потребители трассировки событий могут обрабатывать события от одного или нескольких поставщиков.
ms.assetid: 039a9f66-228e-4258-9967-2b2cd7d31091
title: Использование событий (трассировка событий)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 68ad8234cc66d07b5a52c10ab39c7d7b3c8aa029
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104986088"
---
# <a name="consuming-events-event-tracing"></a>Использование событий (трассировка событий)

Потребители трассировки событий могут обрабатывать события от одного или нескольких поставщиков. Потребители могут обрабатывать события из файла журнала или в режиме реального времени. События можно использовать в режиме реального времени только в том случае, если контроллер определяет режим ведения журнала в режиме реального времени для сеанса. По соображениям производительности обработка в режиме реального времени не рекомендуется до Windows Vista.

Чтобы указать сеанс трассировки, из которого нужно обрабатывать события, используйте структуру [**\_ \_ журнала трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_logfilea) . Необходимо инициализировать копию этой структуры для каждого файла журнала или сеанса в реальном времени, который требуется обработать.

Чтобы использовать события из файла журнала, задайте для элемента **LogFilename** имя файла журнала. Чтобы использовать события из сеанса в режиме реального времени, задайте для элемента **логжернаме** имя сеанса. Эту структуру также можно использовать для указания обратного вызова [*буфферкаллбакк*](/windows/win32/api/evntrace/nc-evntrace-pevent_trace_buffer_callbacka) и обратного вызова [*вложенный EventCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_callback) или [**евентрекордкаллбакк**](/windows/win32/api/evntrace/nc-evntrace-pevent_record_callback) , используемого для обработки событий.

-   [**Евентрекордкаллбакк**](/windows/win32/api/evntrace/nc-evntrace-pevent_record_callback)— получает и обрабатывает все события (включая событие заголовка) из одного или нескольких файлов журнала и сеанса в режиме реального времени. Этот обратный вызов реализуется, если для анализа данных события используются вспомогательные функции данных трассировки или требуется получить метаданные о событии.
-   [*Вложенный EventCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_callback)— получает и обрабатывает все события (включая событие заголовка) из одного или нескольких файлов журнала и сеанса в режиме реального времени.
-   [*Буфферкаллбакк*](/windows/win32/api/evntrace/nc-evntrace-pevent_trace_buffer_callbacka)— получает и обрабатывает сводные сведения о текущем буфере, такие как потерянные события. ETW вызывает обратный вызов после доставки всех событий в буфере потребителю. Потребитель может также использовать этот обратный вызов для отмены обработки событий; Однако если вы используете события в режиме реального времени, трассировка событий Windows доставляет события до тех пор, пока контроллер не остановит сеанс.

Определив один или несколько сеансов трассировки, вызовите функцию [**опентраце**](/windows/win32/api/evntrace/nf-evntrace-opentracea) для каждого сеанса трассировки, который необходимо обработать; события можно обрабатывать из одного или нескольких файлов журнала, но только из одного сеанса в режиме реального времени. Затем вы передаете список дескрипторов сеанса трассировки, возвращаемых **опентраце** в функцию [**процесстраце**](/windows/win32/api/evntrace/nf-evntrace-processtrace) . Функция **процесстраце** объединяет события, сортирует их в хронологическом порядке, а затем доставляет их в обратные вызовы по одному за раз. События можно фильтровать, чтобы включить только те, которые относятся к конкретному периоду времени, используя параметры *StartTime* и *EndTime* . Функция **процесстраце** блокирует поток до тех пор, пока потребитель не обработает все события в сеансах трассировки, [*Буфферкаллбакк*](/windows/win32/api/evntrace/nc-evntrace-pevent_trace_buffer_callbacka) возвращает **значение false** или вызывает [**клосетраце**](/windows/win32/api/evntrace/nf-evntrace-closetrace).

**До Windows Vista:** Метод [**клосетраце**](/windows/win32/api/evntrace/nf-evntrace-closetrace) можно вызвать только после возврата [**процесстраце**](/windows/win32/api/evntrace/nf-evntrace-processtrace) .

Пример, демонстрирующий использование событий, опубликованных с помощью файла манифеста, MOF или ТМФ, см. в разделе [Получение данных о событиях с помощью TDH](retrieving-event-data-using-tdh.md). Обратите внимание, что начиная с Windows Vista, для использования событий следует использовать функции модуля поддержки данных трассировки (TDH).

Пример, демонстрирующий использование событий, опубликованных с помощью MOF, см. в разделе [Получение данных о событиях с помощью MOF](retrieving-event-data-using-mof.md).

 

 
