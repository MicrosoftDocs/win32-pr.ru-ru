---
description: Потребители трассировки событий могут обрабатывать события от одного или нескольких поставщиков.
ms.assetid: 039a9f66-228e-4258-9967-2b2cd7d31091
title: Использование событий (трассировка событий)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 68ad8234cc66d07b5a52c10ab39c7d7b3c8aa029
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104986088"
---
# <a name="consuming-events-event-tracing"></a><span data-ttu-id="49405-103">Использование событий (трассировка событий)</span><span class="sxs-lookup"><span data-stu-id="49405-103">Consuming Events (Event Tracing)</span></span>

<span data-ttu-id="49405-104">Потребители трассировки событий могут обрабатывать события от одного или нескольких поставщиков.</span><span class="sxs-lookup"><span data-stu-id="49405-104">Event trace consumers can process events from one or more providers.</span></span> <span data-ttu-id="49405-105">Потребители могут обрабатывать события из файла журнала или в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="49405-105">Consumers can process events from a log file or in real time.</span></span> <span data-ttu-id="49405-106">События можно использовать в режиме реального времени только в том случае, если контроллер определяет режим ведения журнала в режиме реального времени для сеанса.</span><span class="sxs-lookup"><span data-stu-id="49405-106">You can consume events in real time only if the controller specifies the real time logging mode for the session.</span></span> <span data-ttu-id="49405-107">По соображениям производительности обработка в режиме реального времени не рекомендуется до Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="49405-107">For performance reasons, real-time processing is not recommended prior to Windows Vista.</span></span>

<span data-ttu-id="49405-108">Чтобы указать сеанс трассировки, из которого нужно обрабатывать события, используйте структуру [**\_ \_ журнала трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_logfilea) .</span><span class="sxs-lookup"><span data-stu-id="49405-108">To specify the trace session from which you want to process events, you use the [**EVENT\_TRACE\_LOGFILE**](/windows/win32/api/evntrace/ns-evntrace-event_trace_logfilea) structure.</span></span> <span data-ttu-id="49405-109">Необходимо инициализировать копию этой структуры для каждого файла журнала или сеанса в реальном времени, который требуется обработать.</span><span class="sxs-lookup"><span data-stu-id="49405-109">You must initialize a copy of this structure for each log file or real time session that you want to process.</span></span>

<span data-ttu-id="49405-110">Чтобы использовать события из файла журнала, задайте для элемента **LogFilename** имя файла журнала.</span><span class="sxs-lookup"><span data-stu-id="49405-110">To consume events from a log file, set the **LogFileName** member to the name of the log file.</span></span> <span data-ttu-id="49405-111">Чтобы использовать события из сеанса в режиме реального времени, задайте для элемента **логжернаме** имя сеанса.</span><span class="sxs-lookup"><span data-stu-id="49405-111">To consume events from real time session, set the **LoggerName** member to the session name.</span></span> <span data-ttu-id="49405-112">Эту структуру также можно использовать для указания обратного вызова [*буфферкаллбакк*](/windows/win32/api/evntrace/nc-evntrace-pevent_trace_buffer_callbacka) и обратного вызова [*вложенный EventCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_callback) или [**евентрекордкаллбакк**](/windows/win32/api/evntrace/nc-evntrace-pevent_record_callback) , используемого для обработки событий.</span><span class="sxs-lookup"><span data-stu-id="49405-112">You also use this structure to specify the [*BufferCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_trace_buffer_callbacka) callback and the [*EventCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_callback) or [**EventRecordCallback**](/windows/win32/api/evntrace/nc-evntrace-pevent_record_callback) callback used to process the events.</span></span>

-   <span data-ttu-id="49405-113">[**Евентрекордкаллбакк**](/windows/win32/api/evntrace/nc-evntrace-pevent_record_callback)— получает и обрабатывает все события (включая событие заголовка) из одного или нескольких файлов журнала и сеанса в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="49405-113">[**EventRecordCallback**](/windows/win32/api/evntrace/nc-evntrace-pevent_record_callback)—Receives and processes all events (including the header event) from one or more log files and a real-time session.</span></span> <span data-ttu-id="49405-114">Этот обратный вызов реализуется, если для анализа данных события используются вспомогательные функции данных трассировки или требуется получить метаданные о событии.</span><span class="sxs-lookup"><span data-stu-id="49405-114">You implement this callback if you use the trace data helper functions to parse the event data or you want to retrieve metadata about the event.</span></span>
-   <span data-ttu-id="49405-115">[*Вложенный EventCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_callback)— получает и обрабатывает все события (включая событие заголовка) из одного или нескольких файлов журнала и сеанса в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="49405-115">[*EventCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_callback)—Receives and processes all events (including the header event) from one or more log files and a real-time session.</span></span>
-   <span data-ttu-id="49405-116">[*Буфферкаллбакк*](/windows/win32/api/evntrace/nc-evntrace-pevent_trace_buffer_callbacka)— получает и обрабатывает сводные сведения о текущем буфере, такие как потерянные события.</span><span class="sxs-lookup"><span data-stu-id="49405-116">[*BufferCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_trace_buffer_callbacka)—Receives and processes summary information about the current buffer, such as events lost.</span></span> <span data-ttu-id="49405-117">ETW вызывает обратный вызов после доставки всех событий в буфере потребителю.</span><span class="sxs-lookup"><span data-stu-id="49405-117">ETW calls the callback after delivering all events in the buffer to the consumer.</span></span> <span data-ttu-id="49405-118">Потребитель может также использовать этот обратный вызов для отмены обработки событий; Однако если вы используете события в режиме реального времени, трассировка событий Windows доставляет события до тех пор, пока контроллер не остановит сеанс.</span><span class="sxs-lookup"><span data-stu-id="49405-118">The consumer can also use this callback to cancel event processing; however, if you are consuming events in real time, ETW delivers events until the controller stops the session.</span></span>

<span data-ttu-id="49405-119">Определив один или несколько сеансов трассировки, вызовите функцию [**опентраце**](/windows/win32/api/evntrace/nf-evntrace-opentracea) для каждого сеанса трассировки, который необходимо обработать; события можно обрабатывать из одного или нескольких файлов журнала, но только из одного сеанса в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="49405-119">After defining one or more trace sessions, call the [**OpenTrace**](/windows/win32/api/evntrace/nf-evntrace-opentracea) function for each trace session that you want to process; you can process events from one or more log files, but from only one real-time session.</span></span> <span data-ttu-id="49405-120">Затем вы передаете список дескрипторов сеанса трассировки, возвращаемых **опентраце** в функцию [**процесстраце**](/windows/win32/api/evntrace/nf-evntrace-processtrace) .</span><span class="sxs-lookup"><span data-stu-id="49405-120">You then pass the list of trace session handles that **OpenTrace** returns to the [**ProcessTrace**](/windows/win32/api/evntrace/nf-evntrace-processtrace) function.</span></span> <span data-ttu-id="49405-121">Функция **процесстраце** объединяет события, сортирует их в хронологическом порядке, а затем доставляет их в обратные вызовы по одному за раз.</span><span class="sxs-lookup"><span data-stu-id="49405-121">The **ProcessTrace** function combines the events, sorts them into chronological order, and then delivers them to the callbacks one at a time.</span></span> <span data-ttu-id="49405-122">События можно фильтровать, чтобы включить только те, которые относятся к конкретному периоду времени, используя параметры *StartTime* и *EndTime* .</span><span class="sxs-lookup"><span data-stu-id="49405-122">The events can be filtered to include only those that fall into a specific time frame using the *StartTime* and *EndTime* parameters.</span></span> <span data-ttu-id="49405-123">Функция **процесстраце** блокирует поток до тех пор, пока потребитель не обработает все события в сеансах трассировки, [*Буфферкаллбакк*](/windows/win32/api/evntrace/nc-evntrace-pevent_trace_buffer_callbacka) возвращает **значение false** или вызывает [**клосетраце**](/windows/win32/api/evntrace/nf-evntrace-closetrace).</span><span class="sxs-lookup"><span data-stu-id="49405-123">The **ProcessTrace** function blocks the thread until your consumer processes all events in the trace sessions, the [*BufferCallback*](/windows/win32/api/evntrace/nc-evntrace-pevent_trace_buffer_callbacka) returns **FALSE**, or you call [**CloseTrace**](/windows/win32/api/evntrace/nf-evntrace-closetrace).</span></span>

<span data-ttu-id="49405-124">**До Windows Vista:** Метод [**клосетраце**](/windows/win32/api/evntrace/nf-evntrace-closetrace) можно вызвать только после возврата [**процесстраце**](/windows/win32/api/evntrace/nf-evntrace-processtrace) .</span><span class="sxs-lookup"><span data-stu-id="49405-124">**Prior to Windows Vista:** You can call [**CloseTrace**](/windows/win32/api/evntrace/nf-evntrace-closetrace) only after [**ProcessTrace**](/windows/win32/api/evntrace/nf-evntrace-processtrace) returns.</span></span>

<span data-ttu-id="49405-125">Пример, демонстрирующий использование событий, опубликованных с помощью файла манифеста, MOF или ТМФ, см. в разделе [Получение данных о событиях с помощью TDH](retrieving-event-data-using-tdh.md).</span><span class="sxs-lookup"><span data-stu-id="49405-125">For an example that shows how to consume events published using a manifest, MOF, or TMF files, see [Retrieving Event Data Using TDH](retrieving-event-data-using-tdh.md).</span></span> <span data-ttu-id="49405-126">Обратите внимание, что начиная с Windows Vista, для использования событий следует использовать функции модуля поддержки данных трассировки (TDH).</span><span class="sxs-lookup"><span data-stu-id="49405-126">Note that beginning with Windows Vista, you should use the trace data helper (TDH) functions to consume events.</span></span>

<span data-ttu-id="49405-127">Пример, демонстрирующий использование событий, опубликованных с помощью MOF, см. в разделе [Получение данных о событиях с помощью MOF](retrieving-event-data-using-mof.md).</span><span class="sxs-lookup"><span data-stu-id="49405-127">For an example that shows how to consume events published using MOF, see [Retrieving Event Data Using MOF](retrieving-event-data-using-mof.md).</span></span>

 

 
