---
description: Работа с ролями устройств
ms.assetid: 3b2cb1fe-0f11-4509-a6f3-513d2755cd29
title: Работа с ролями устройств
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c21ea667a6974634c1f9f0657dd02c13a621641c
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103990330"
---
# <a name="working-with-device-roles"></a><span data-ttu-id="e9e00-103">Работа с ролями устройств</span><span class="sxs-lookup"><span data-stu-id="e9e00-103">Working with Device Roles</span></span>

<span data-ttu-id="e9e00-104">[API ммдевице](mmdevice-api.md) поддерживает роли устройств.</span><span class="sxs-lookup"><span data-stu-id="e9e00-104">The [MMDevice API](mmdevice-api.md) supports device roles.</span></span> <span data-ttu-id="e9e00-105">Перечисление [**ероле**](/windows/win32/api/mmdeviceapi/ne-mmdeviceapi-erole) определяет роли устройств, поддерживаемые API ммдевице.</span><span class="sxs-lookup"><span data-stu-id="e9e00-105">The [**ERole**](/windows/win32/api/mmdeviceapi/ne-mmdeviceapi-erole) enumeration defines the device roles that are supported by the MMDevice API.</span></span>

> [!Note]  
> <span data-ttu-id="e9e00-106">Хотя [API ммдевице](mmdevice-api.md) поддерживает роли устройств, Пользовательский интерфейс в Windows Vista не реализует поддержку этой функции.</span><span class="sxs-lookup"><span data-stu-id="e9e00-106">Although the [MMDevice API](mmdevice-api.md) supports device roles, the user interface in Windows Vista does not implement support for this feature.</span></span>

 

<span data-ttu-id="e9e00-107">Приложение может использовать API Ммдевице для поддержки [ролей устройств](device-roles.md) с помощью методов [**Иммдевицеенумератор:: жетдефаултаудиоендпоинт**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) и [**иммнотификатионклиент:: ондефаултдевицечанжед**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immnotificationclient-ondefaultdevicechanged) .</span><span class="sxs-lookup"><span data-stu-id="e9e00-107">An application can use MMDevice API to support [device roles](device-roles.md) through the [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) and [**IMMNotificationClient::OnDefaultDeviceChanged**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immnotificationclient-ondefaultdevicechanged) methods.</span></span> <span data-ttu-id="e9e00-108">Однако пользовательский интерфейс в Windows Vista не поддерживает назначение отдельных ролей различным устройствам.</span><span class="sxs-lookup"><span data-stu-id="e9e00-108">However, the user interface in Windows Vista does not support assignment of individual roles to different devices.</span></span> <span data-ttu-id="e9e00-109">В Windows Vista пользовательский интерфейс позволяет пользователю выбрать звуковое устройство по умолчанию для подготовки к просмотру и звуковое устройство по умолчанию для записи.</span><span class="sxs-lookup"><span data-stu-id="e9e00-109">In Windows Vista, the user interface enables the user to select a default audio device for rendering and a default audio device for capture.</span></span> <span data-ttu-id="e9e00-110">Когда пользователь выбирает устройство подготовки или записи по умолчанию, система назначает этому устройству все три роли устройств (Еконсоле, Емултимедиа и Екоммуникатионс).</span><span class="sxs-lookup"><span data-stu-id="e9e00-110">When the user selects a default rendering or capture device, the system assigns all three device roles (eConsole, eMultimedia, and eCommunications) to that device.</span></span> <span data-ttu-id="e9e00-111">Приложения не могут изменять роли, назначенные устройствам конечных точек звука.</span><span class="sxs-lookup"><span data-stu-id="e9e00-111">Applications cannot change the roles that are assigned to audio endpoint devices.</span></span> <span data-ttu-id="e9e00-112">Операционная система позволяет назначать роли устройства только пользователю.</span><span class="sxs-lookup"><span data-stu-id="e9e00-112">The operating system allows only the user to assign device roles.</span></span>

<span data-ttu-id="e9e00-113">Клиент может зарегистрироваться для получения уведомления от API Ммдевице каждый раз при возникновении изменений в назначении ролей для устройств конечных точек звука.</span><span class="sxs-lookup"><span data-stu-id="e9e00-113">A client can register itself to receive a notification from the MMDevice API each time a change occurs in the assignment of roles to audio endpoint devices.</span></span> <span data-ttu-id="e9e00-114">Когда роль перемещается с одного устройства на другое, клиент может выбрать, следует ли продолжить воспроизведение (или запись) своих потоков через то же устройство или переключить потоки на другое устройство.</span><span class="sxs-lookup"><span data-stu-id="e9e00-114">When a role shifts from one device to another, the client can choose whether to continue playing (or recording) its streams through the same device or to switch the streams to another device.</span></span> <span data-ttu-id="e9e00-115">По умолчанию потоки продолжают воспроизводиться (или записываются) через исходное устройство.</span><span class="sxs-lookup"><span data-stu-id="e9e00-115">By default, the streams continue to play (or be recorded) through the original device.</span></span> <span data-ttu-id="e9e00-116">Чтобы переключить потоки на другое устройство в Windows Vista, клиент должен удалить потоки на исходном устройстве и создать на новом устройстве потоки для замены.</span><span class="sxs-lookup"><span data-stu-id="e9e00-116">In Windows Vista, to switch the streams to another device, the client must delete the streams on the original device and create replacement streams on the new device.</span></span> <span data-ttu-id="e9e00-117">В Windows 7 клиент может прослушивать новые уведомления, чтобы реализовать простой коммутатор без прерывания воспроизведения или сеанса записи.</span><span class="sxs-lookup"><span data-stu-id="e9e00-117">In Windows 7, the client can listen for new notifications to implement a seamless switch without interrupting the playback or the capture session.</span></span> <span data-ttu-id="e9e00-118">Дополнительные сведения см. в статье [Маршрутизация потоков](stream-routing.md).</span><span class="sxs-lookup"><span data-stu-id="e9e00-118">For more information, see [Stream Routing](stream-routing.md).</span></span>

<span data-ttu-id="e9e00-119">Если вы планируете использовать Windows Vista для тестирования приложения, можно настроить тестовую среду, чтобы убедиться, что приложение ведет себя ожидаемым образом, когда пользователь может назначить отдельные роли устройств различным устройствам.</span><span class="sxs-lookup"><span data-stu-id="e9e00-119">If you plan to use Windows Vista to test your application, you can set up a test environment to verify that the application behaves as expected when the user can assign individual device roles to different devices.</span></span> <span data-ttu-id="e9e00-120">Чтобы узнать больше, отправьте электронное письмо по адресу uaa@microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="e9e00-120">For more information, send email to uaa@microsoft.com.</span></span>

## <a name="communication-devices"></a><span data-ttu-id="e9e00-121">Устройства связи</span><span class="sxs-lookup"><span data-stu-id="e9e00-121">Communication Devices</span></span>

<span data-ttu-id="e9e00-122">Пользовательский интерфейс Windows 7 обладает возможностью добавления *устройств связи*.</span><span class="sxs-lookup"><span data-stu-id="e9e00-122">The Windows 7 user interface has the capability of adding *communications devices*.</span></span> <span data-ttu-id="e9e00-123">Панель управления **звуком** позволяет пользователю выбрать устройство связи по умолчанию для отображения и записи звукового потока.</span><span class="sxs-lookup"><span data-stu-id="e9e00-123">The **Sound** control panel enables the user to select a default communication device each for rendering and capturing audio stream.</span></span> <span data-ttu-id="e9e00-124">По умолчанию при подключении нового устройства к компьютеру операционная система выполняет автоматическую определение роли и определяет, подходит ли устройство для роли Екоммуникатион.</span><span class="sxs-lookup"><span data-stu-id="e9e00-124">By default, when a new device is connected to the computer, the operating system performs automatic role detecting and determines whether the device is suitable for the eCommunication role.</span></span> <span data-ttu-id="e9e00-125">Нацеливание на устройства связи позволяет разрабатывать приложения, использующие основные API-интерфейсы для внедрения решений для обмена данными с телефоном.</span><span class="sxs-lookup"><span data-stu-id="e9e00-125">By targeting communication devices, you can develop applications that use Core Audio APIs to implement PC-phone communication solutions.</span></span> <span data-ttu-id="e9e00-126">Например, приложение VoIP может назначать потоковые входные и выходные потоки для записи по умолчанию и визуализации устройств конечных точек с помощью роли Екоммуникатионс.</span><span class="sxs-lookup"><span data-stu-id="e9e00-126">For example, a VoIP application might assign its voice input and output streams to the default capture and rendering endpoint devices with the eCommunications role.</span></span> <span data-ttu-id="e9e00-127">Как и любой другой поток, коммуникационное приложение должно получить ссылку на конечную точку коммуникационного устройства, вызвав [**иммдевицеенумератор:: жетдефаултаудиоендпоинт**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint).</span><span class="sxs-lookup"><span data-stu-id="e9e00-127">Like any other stream, a communication application must get a reference to the communication device's endpoint by calling [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint).</span></span> <span data-ttu-id="e9e00-128">В этом вызове приложение должно указать **екоммуникатионс** в параметре *Role* .</span><span class="sxs-lookup"><span data-stu-id="e9e00-128">In this call, the application must specify **eCommunications** in the *Role* parameter.</span></span> <span data-ttu-id="e9e00-129">Операции потока ВАСАПИ в потоке, открытом на коммуникационном устройстве, похожи на любой другой аудиопоток.</span><span class="sxs-lookup"><span data-stu-id="e9e00-129">The WASAPI stream operations on a stream, opened on a communication device, are similar to any other audio stream.</span></span> <span data-ttu-id="e9e00-130">Приложение для обмена данными может улучшить взаимодействие с пользователем, реализуя такие поведения, как дуккинг, обрабатывая уведомления из конечной точки устройства.</span><span class="sxs-lookup"><span data-stu-id="e9e00-130">The communication application can enhance user experience by implementing behaviors such as ducking by handling notifications from the device endpoint.</span></span> <span data-ttu-id="e9e00-131">Дополнительные сведения см. в разделе [Использование коммуникационного устройства](using-the-communication-device.md).</span><span class="sxs-lookup"><span data-stu-id="e9e00-131">For more information, see [Using a Communication Device](using-the-communication-device.md).</span></span>

## <a name="automatic-device-role-detection"></a><span data-ttu-id="e9e00-132">Автоматическое обнаружение роли устройства</span><span class="sxs-lookup"><span data-stu-id="e9e00-132">Automatic Device Role Detection</span></span>

<span data-ttu-id="e9e00-133">Рассмотрим ситуацию, в которой компьютер имеет устройство отрисовки по умолчанию, динамики и устройство записи по умолчанию — микрофон.</span><span class="sxs-lookup"><span data-stu-id="e9e00-133">Consider a scenario in which a computer has a default rendering device, the speakers, and a default capture device, a microphone.</span></span> <span data-ttu-id="e9e00-134">Пользователь подключает гарнитуру USB к компьютеру.</span><span class="sxs-lookup"><span data-stu-id="e9e00-134">The user connects a USB headset to the computer.</span></span> <span data-ttu-id="e9e00-135">После установки соответствующих драйверов операционная система пытается определить роль, которую нужно назначить новому звуковому устройству.</span><span class="sxs-lookup"><span data-stu-id="e9e00-135">After the appropriate drivers are installed, the operating system attempts to detect a role to assign for the new audio device.</span></span>

<span data-ttu-id="e9e00-136">В Windows 7 функция обнаружения ролей устройства значительно улучшилась, чтобы определить соответствующие роли для звуковых устройств.</span><span class="sxs-lookup"><span data-stu-id="e9e00-136">In Windows 7, the device role detection feature has been improved significantly to determine the appropriate roles suited for audio devices.</span></span> <span data-ttu-id="e9e00-137">Все звуковые устройства содержат набор параметров конфигурации, заполненных OEM-производителем устройства, что помогает системе решить, как использовать устройство.</span><span class="sxs-lookup"><span data-stu-id="e9e00-137">All audio devices contain a set of configuration settings populated by the device OEM, which help the system decide how to use the device.</span></span> <span data-ttu-id="e9e00-138">Эти параметры включают в себя такие сведения, как физическое расположение аудиоразъемов, тип устройства, подтип розетки и возможности обнаружения, чтобы система могла определить, подключено ли устройство.</span><span class="sxs-lookup"><span data-stu-id="e9e00-138">These settings include information such as the physical location of the audio jack the device type, the jack subtype, and detection capabilities so that the system can determine whether the device is plugged in.</span></span> <span data-ttu-id="e9e00-139">Извлекая эти значения с устройства, операционная система определяет роль, назначенную устройству.</span><span class="sxs-lookup"><span data-stu-id="e9e00-139">By retrieving these values from the device, the operating system determines the role to assign to the device.</span></span> <span data-ttu-id="e9e00-140">В этом сценарии система запросила USB-устройство гарнитуры, выполнил автоматическое обнаружение ролей и решил, что устройство лучше всего подходит для устройства связи.</span><span class="sxs-lookup"><span data-stu-id="e9e00-140">In this scenario, the system has queried the USB headset device, performed automatic role detection, and decided that the device is best suited to be a communication device.</span></span>

<span data-ttu-id="e9e00-141">Приложение также может получать сведения о гнездах с помощью основных API-интерфейсов аудио.</span><span class="sxs-lookup"><span data-stu-id="e9e00-141">An application can also get jack information by using the Core Audio APIs.</span></span> <span data-ttu-id="e9e00-142">Дополнительные сведения см. в разделе [**иксжаккдескриптион**](/windows/desktop/api/Devicetopology/nn-devicetopology-iksjackdescription) и [**IKsJackDescription2**](/windows/desktop/api/Devicetopology/nn-devicetopology-iksjackdescription2).</span><span class="sxs-lookup"><span data-stu-id="e9e00-142">For more information, see [**IKsJackDescription**](/windows/desktop/api/Devicetopology/nn-devicetopology-iksjackdescription) and [**IKsJackDescription2**](/windows/desktop/api/Devicetopology/nn-devicetopology-iksjackdescription2).</span></span>

## <a name="related-topics"></a><span data-ttu-id="e9e00-143">См. также</span><span class="sxs-lookup"><span data-stu-id="e9e00-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e9e00-144">Роли устройств</span><span class="sxs-lookup"><span data-stu-id="e9e00-144">Device Roles</span></span>](device-roles.md)
</dt> </dl>

 

 



