---
description: В Windows 7 на панели управления Windows (Mmsys.cpl) представлена новая вкладка связи.
ms.assetid: bec2127d-fb82-436d-beee-d43e8fef5c35
title: Использование коммуникационного устройства
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 93f677245e650cf11c71c879b2c26d3183ff4a0b
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103896058"
---
# <a name="using-a-communication-device"></a>Использование коммуникационного устройства

В Windows 7 на панели управления Windows (Mmsys.cpl) представлена новая вкладка **связи** . Эта вкладка содержит параметры, которые позволяют пользователю задавать параметры, определяющие, каким образом система управляет *устройством связи*. Устройство связи используется в основном для размещения или приема телефонных звонков на компьютере. Для компьютера, имеющего только одно устройство отрисовки (докладчик) и одно устройство записи (микрофон), эти аудиоустройства также работают как устройства связи по умолчанию. Когда пользователь подключает новое устройство, например гарнитуру USB, система выполняет автоматическое обнаружение роли устройства путем поиска параметров конфигурации, заполняемых поставщиком вычислительной техники. Если система определяет устройство, которое лучше всего подходит для обеспечения связи, система назначает устройству роль **екоммуникатионс** . Для этих устройств Mmsys.cpl Windows 7 предоставляет параметр **устройство связи по умолчанию** , которое позволяет пользователю выбрать устройство для передачи звука (вкладка **воспроизведения** ) и запись звука (вкладка "**запись** "). Система выполняет автоматическое обнаружение ролей, но не устанавливает конкретное устройство для обмена данными. Это должно сделать пользователь. Новая роль **екоммуникатионс** позволяет приложению отличать устройство, выбранное пользователем для обработки телефонных звонков, и устройство, которое будет использоваться в качестве устройства мультимедиа (воспроизведение музыки). Например, если у пользователя есть гарнитура и докладчик, подключенный к компьютеру, система назначает **еконсоле** роли докладчику и роли **екоммуникатионс** . После того как пользователь выберет гарнитуру, которая будет использоваться в качестве коммуникационного устройства, для разработки коммуникационного приложения можно выбрать гарнитуру, специально предназначенную для отрисовки звукового потока. Приложение, которое пользователь не может изменить роль устройства, назначенный системой. Дополнительные сведения о ролях устройств см. в разделе [роли устройств](device-roles.md).

Коммуникационные приложения, такие как VoIP и коммуникационные приложения, размещают и получают телефонные звонки через компьютер. Например, приложение VoIP может назначить поток, содержащий уведомление о соотношении, в конечную точку набора устройств связи для отрисовки аудио-потоков. Кроме того, приложение может открывать потоковые входные и выходные потоки для записи и подготовки к просмотру устройств конечных точек, настроенных как коммуникационные устройства.

Чтобы интегрировать возможности взаимодействия в приложения, можно использовать:

-   [ММДЕВИЦЕ API](mmdevice-api.md)— для получения ссылки на конечную точку коммуникационного устройства.
-   [Васапи](wasapi.md)— для отображения и записи звуковых потоков через коммуникационное устройство. Операционная система считает, что поток, Открытый на коммуникационном устройстве, является *потоком связи*.

Приложение для связи перечисляет устройства и обеспечивает управление потоками потока связи (отрисовки или записи) так же, как и поток, не связанный с обменом данными, с помощью основных API-интерфейсов аудио.

Одной из функций, которые можно интегрировать в приложение для обмена данными, является *дуккинг* или *потоковая затухание*. Это поведение определяет, что должно происходить с другими звуками при открытии коммуникационного потока, например при получении телефонного вызова на коммуникационном устройстве. Система может отключить или уменьшить громкость звука потока без связи в зависимости от выбора пользователя. Звуковая система создает события дуккинг при открытии или закрытии потока связи для отрисовки или записи потоков. По умолчанию операционная система предоставляет дуккинг работу по умолчанию. Приложение мультимедиа может заменить поведение по умолчанию и самостоятельно реализовать эти события, чтобы обеспечить пользовательский интерфейс дуккинг.

В следующих разделах описывается использование основных API-интерфейсов аудиоподсистемы для предоставления пользовательского интерфейса дуккинг.

-   [Интерфейс Дуккинг по умолчанию](stream-attenuation.md)
-   [Отключение интерфейса Дуккинг по умолчанию](disabling-the-ducking-experience.md)
-   [Предоставление пользовательского поведения Дуккинг](providing-a-custom-ducking-experience.md)
-   [Рекомендации по реализации для уведомлений Дуккинг](handling-audio-ducking-events-from-communication-devices.md)
-   [Получение событий Дуккинг](getting-ducking-events-from-a-communication-device.md)

### <a name="getting-a-reference-to-the-communication-device-endpoint"></a>Получение ссылки на конечную точку коммуникационного устройства

Чтобы использовать коммуникационное устройство, прямой ВАСАПИ клиент должен перечислить устройства с помощью перечислителя устройств. Получите ссылку на конечную точку устройства связи по умолчанию, вызвав [**иммдевицеенумератор:: жетдефаултаудиоендпоинт**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint). В этом вызове приложение должно указать **екоммуникатионс** в параметре *Role* , чтобы ограничить перечисление устройств устройствами связи. После получения ссылки на конечную точку устройства для устройства можно активировать службы, областью действия которых является конечная точка, вызвав [**иммдевице:: Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate). Например, можно передать идентификатор иаудиоклиент службы **IID \_** , чтобы активировать объект аудиопотока и использовать его для управления потоками, идентификатор **IID \_ иаудиоендпоинтволуме** для получения доступа к элементам управления громкостью конечной точки коммуникационного устройства или идентификатор **IID \_ иаудиосессионманажер** для активации диспетчера сеансов, позволяющего взаимодействовать с ядром политики конечной точки. Дополнительные сведения о потоковых операциях см. в разделе [Управление потоками](stream-management.md).

С помощью ссылки [**иммдевице**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) можно также получить доступ к хранилищу свойств для конечной точки устройства. Эти значения свойств, такие как понятное имя устройства и название производителя, заполняются поставщиком вычислительной техники и позволяют приложению определить характеристики коммуникационного устройства. Дополнительные сведения см. в разделе [Свойства устройства](device-properties.md).

В следующем примере кода возвращается ссылка на конечную точку устройства связи по умолчанию для отрисовки звукового потока.


```C++
IMMDevice *defaultDevice = NULL;

hr = CoCreateInstance(__uuidof(MMDeviceEnumerator), NULL,
            CLSCTX_INPROC_SERVER, 
            __uuidof(IMMDeviceEnumerator), 
            (LPVOID *)&deviceEnumerator);

hr = deviceEnumerator->GetDefaultAudioEndpoint(eRender, 
            eCommunications, &defaultDevice);
```



## <a name="related-topics"></a>См. также

<dl> <dt>

[Управление потоками](stream-management.md)
</dt> </dl>

 

 



