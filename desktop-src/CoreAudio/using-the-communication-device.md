---
description: В Windows 7 на панели управления Windows (Mmsys.cpl) представлена новая вкладка связи.
ms.assetid: bec2127d-fb82-436d-beee-d43e8fef5c35
title: Использование коммуникационного устройства
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 93f677245e650cf11c71c879b2c26d3183ff4a0b
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103896058"
---
# <a name="using-a-communication-device"></a><span data-ttu-id="e63cf-103">Использование коммуникационного устройства</span><span class="sxs-lookup"><span data-stu-id="e63cf-103">Using a Communication Device</span></span>

<span data-ttu-id="e63cf-104">В Windows 7 на панели управления Windows (Mmsys.cpl) представлена новая вкладка **связи** . Эта вкладка содержит параметры, которые позволяют пользователю задавать параметры, определяющие, каким образом система управляет *устройством связи*.</span><span class="sxs-lookup"><span data-stu-id="e63cf-104">In Windows 7, the Windows multimedia control panel, Mmsys.cpl, provides a new **Communications** tab. This tab contains options that enables a user to set options that defines how the system manages a *communication device*.</span></span> <span data-ttu-id="e63cf-105">Устройство связи используется в основном для размещения или приема телефонных звонков на компьютере.</span><span class="sxs-lookup"><span data-stu-id="e63cf-105">A communication device is used primarily for placing or receiving telephone calls on the computer.</span></span> <span data-ttu-id="e63cf-106">Для компьютера, имеющего только одно устройство отрисовки (докладчик) и одно устройство записи (микрофон), эти аудиоустройства также работают как устройства связи по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="e63cf-106">For a computer that has only one rendering device (speaker) and one capture device (microphone), these audio devices also act as the default communication devices.</span></span> <span data-ttu-id="e63cf-107">Когда пользователь подключает новое устройство, например гарнитуру USB, система выполняет автоматическое обнаружение роли устройства путем поиска параметров конфигурации, заполняемых поставщиком вычислительной техники.</span><span class="sxs-lookup"><span data-stu-id="e63cf-107">When a user connects a new device, such as a USB headset, the system performs automatic device role detection by looking up the configuration settings that are populated by the OEM.</span></span> <span data-ttu-id="e63cf-108">Если система определяет устройство, которое лучше всего подходит для обеспечения связи, система назначает устройству роль **екоммуникатионс** .</span><span class="sxs-lookup"><span data-stu-id="e63cf-108">If the system determines a device to be best suited for communication purposes, the system assigns the **eCommunications** role to the device.</span></span> <span data-ttu-id="e63cf-109">Для этих устройств Mmsys.cpl Windows 7 предоставляет параметр **устройство связи по умолчанию** , которое позволяет пользователю выбрать устройство для передачи звука (вкладка **воспроизведения** ) и запись звука (вкладка "**запись** ").</span><span class="sxs-lookup"><span data-stu-id="e63cf-109">For these devices, the Windows 7 Mmsys.cpl provides the option **Default Communication Device** that enables a user to select a communication device each for audio rendering (**Playback** tab) and audio capturing (**Recording** tab).</span></span> <span data-ttu-id="e63cf-110">Система выполняет автоматическое обнаружение ролей, но не устанавливает конкретное устройство для обмена данными.</span><span class="sxs-lookup"><span data-stu-id="e63cf-110">The system performs automatic role detection but does not set a particular device to be used for communications.</span></span> <span data-ttu-id="e63cf-111">Это должно сделать пользователь.</span><span class="sxs-lookup"><span data-stu-id="e63cf-111">This must be done by the user.</span></span> <span data-ttu-id="e63cf-112">Новая роль **екоммуникатионс** позволяет приложению отличать устройство, выбранное пользователем для обработки телефонных звонков, и устройство, которое будет использоваться в качестве устройства мультимедиа (воспроизведение музыки).</span><span class="sxs-lookup"><span data-stu-id="e63cf-112">The new **eCommunications** role lets an application distinguish between a device that is chosen by the user for handling phone calls and a device to be used as a multimedia device (music playback).</span></span> <span data-ttu-id="e63cf-113">Например, если у пользователя есть гарнитура и докладчик, подключенный к компьютеру, система назначает **еконсоле** роли докладчику и роли **екоммуникатионс** .</span><span class="sxs-lookup"><span data-stu-id="e63cf-113">For example, if the user has a headset and a speaker connected to the computer, the system assigns the **eConsole** role to the speaker and the **eCommunications** role to the headset.</span></span> <span data-ttu-id="e63cf-114">После того как пользователь выберет гарнитуру, которая будет использоваться в качестве коммуникационного устройства, для разработки коммуникационного приложения можно выбрать гарнитуру, специально предназначенную для отрисовки звукового потока.</span><span class="sxs-lookup"><span data-stu-id="e63cf-114">After the user selects the headset to be used as the communication device, to develop a communication application, you can target the headset specifically for rendering an audio stream.</span></span> <span data-ttu-id="e63cf-115">Приложение, которое пользователь не может изменить роль устройства, назначенный системой.</span><span class="sxs-lookup"><span data-stu-id="e63cf-115">An application the user cannot change the device role assigned by the system.</span></span> <span data-ttu-id="e63cf-116">Дополнительные сведения о ролях устройств см. в разделе [роли устройств](device-roles.md).</span><span class="sxs-lookup"><span data-stu-id="e63cf-116">For more information about device roles, see [Device Roles](device-roles.md).</span></span>

<span data-ttu-id="e63cf-117">Коммуникационные приложения, такие как VoIP и коммуникационные приложения, размещают и получают телефонные звонки через компьютер.</span><span class="sxs-lookup"><span data-stu-id="e63cf-117">Communication applications, such as VoIP and Unified Communication applications, place and receive phone calls through a computer.</span></span> <span data-ttu-id="e63cf-118">Например, приложение VoIP может назначить поток, содержащий уведомление о соотношении, в конечную точку набора устройств связи для отрисовки аудио-потоков.</span><span class="sxs-lookup"><span data-stu-id="e63cf-118">For example, a VoIP application might assign a stream that contains the ring-in notification to the endpoint of a communication device set for rendering audio streams.</span></span> <span data-ttu-id="e63cf-119">Кроме того, приложение может открывать потоковые входные и выходные потоки для записи и подготовки к просмотру устройств конечных точек, настроенных как коммуникационные устройства.</span><span class="sxs-lookup"><span data-stu-id="e63cf-119">In addition, the application might open the voice input and output streams on the capture and rendering endpoint devices that are set as communication devices.</span></span>

<span data-ttu-id="e63cf-120">Чтобы интегрировать возможности взаимодействия в приложения, можно использовать:</span><span class="sxs-lookup"><span data-stu-id="e63cf-120">To integrate communication capabilities into your applications, you can use:</span></span>

-   <span data-ttu-id="e63cf-121">[ММДЕВИЦЕ API](mmdevice-api.md)— для получения ссылки на конечную точку коммуникационного устройства.</span><span class="sxs-lookup"><span data-stu-id="e63cf-121">[MMDevice API](mmdevice-api.md)—to get a reference to the endpoint of the communication device.</span></span>
-   <span data-ttu-id="e63cf-122">[Васапи](wasapi.md)— для отображения и записи звуковых потоков через коммуникационное устройство.</span><span class="sxs-lookup"><span data-stu-id="e63cf-122">[WASAPI](wasapi.md)—to render and capture audio streams through the communication device.</span></span> <span data-ttu-id="e63cf-123">Операционная система считает, что поток, Открытый на коммуникационном устройстве, является *потоком связи*.</span><span class="sxs-lookup"><span data-stu-id="e63cf-123">The operating system considers the stream opened on a communication device to be a *communication stream*.</span></span>

<span data-ttu-id="e63cf-124">Приложение для связи перечисляет устройства и обеспечивает управление потоками потока связи (отрисовки или записи) так же, как и поток, не связанный с обменом данными, с помощью основных API-интерфейсов аудио.</span><span class="sxs-lookup"><span data-stu-id="e63cf-124">The communication application enumerates devices and provides stream management for a communication stream (rendering or capture) stream in the same manner as it would manage a non-communication stream by using the Core Audio APIs.</span></span>

<span data-ttu-id="e63cf-125">Одной из функций, которые можно интегрировать в приложение для обмена данными, является *дуккинг* или *потоковая затухание*.</span><span class="sxs-lookup"><span data-stu-id="e63cf-125">One of the features that you can integrate in your communication application is *ducking* or *stream attenuation*.</span></span> <span data-ttu-id="e63cf-126">Это поведение определяет, что должно происходить с другими звуками при открытии коммуникационного потока, например при получении телефонного вызова на коммуникационном устройстве.</span><span class="sxs-lookup"><span data-stu-id="e63cf-126">This behavior defines what must happen to other sounds when a communication stream is opened, such as when a phone call is received on the communication device.</span></span> <span data-ttu-id="e63cf-127">Система может отключить или уменьшить громкость звука потока без связи в зависимости от выбора пользователя.</span><span class="sxs-lookup"><span data-stu-id="e63cf-127">The system might mute or lower the audio volume of the non-communication stream depending on the user's choice.</span></span> <span data-ttu-id="e63cf-128">Звуковая система создает события дуккинг при открытии или закрытии потока связи для отрисовки или записи потоков.</span><span class="sxs-lookup"><span data-stu-id="e63cf-128">The audio system generates ducking events when a communication stream is opened or closed for rendering or capturing streams.</span></span> <span data-ttu-id="e63cf-129">По умолчанию операционная система предоставляет дуккинг работу по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="e63cf-129">By default, the operating system provides a default ducking experience.</span></span> <span data-ttu-id="e63cf-130">Приложение мультимедиа может заменить поведение по умолчанию и самостоятельно реализовать эти события, чтобы обеспечить пользовательский интерфейс дуккинг.</span><span class="sxs-lookup"><span data-stu-id="e63cf-130">A media application can replace the default behavior and handle these events itself to provide a customized ducking experience.</span></span>

<span data-ttu-id="e63cf-131">В следующих разделах описывается использование основных API-интерфейсов аудиоподсистемы для предоставления пользовательского интерфейса дуккинг.</span><span class="sxs-lookup"><span data-stu-id="e63cf-131">The following sections describe how to use Core Audio APIs to provide a custom ducking experience.</span></span>

-   [<span data-ttu-id="e63cf-132">Интерфейс Дуккинг по умолчанию</span><span class="sxs-lookup"><span data-stu-id="e63cf-132">Default Ducking Experience</span></span>](stream-attenuation.md)
-   [<span data-ttu-id="e63cf-133">Отключение интерфейса Дуккинг по умолчанию</span><span class="sxs-lookup"><span data-stu-id="e63cf-133">Disabling the Default Ducking Experience</span></span>](disabling-the-ducking-experience.md)
-   [<span data-ttu-id="e63cf-134">Предоставление пользовательского поведения Дуккинг</span><span class="sxs-lookup"><span data-stu-id="e63cf-134">Providing a Custom Ducking Behavior</span></span>](providing-a-custom-ducking-experience.md)
-   [<span data-ttu-id="e63cf-135">Рекомендации по реализации для уведомлений Дуккинг</span><span class="sxs-lookup"><span data-stu-id="e63cf-135">Implementation Considerations for Ducking Notifications</span></span>](handling-audio-ducking-events-from-communication-devices.md)
-   [<span data-ttu-id="e63cf-136">Получение событий Дуккинг</span><span class="sxs-lookup"><span data-stu-id="e63cf-136">Getting Ducking Events</span></span>](getting-ducking-events-from-a-communication-device.md)

### <a name="getting-a-reference-to-the-communication-device-endpoint"></a><span data-ttu-id="e63cf-137">Получение ссылки на конечную точку коммуникационного устройства</span><span class="sxs-lookup"><span data-stu-id="e63cf-137">Getting a Reference to the Communication Device Endpoint</span></span>

<span data-ttu-id="e63cf-138">Чтобы использовать коммуникационное устройство, прямой ВАСАПИ клиент должен перечислить устройства с помощью перечислителя устройств.</span><span class="sxs-lookup"><span data-stu-id="e63cf-138">To use the communication device, a direct WASAPI client must enumerate the devices by using the device enumerator.</span></span> <span data-ttu-id="e63cf-139">Получите ссылку на конечную точку устройства связи по умолчанию, вызвав [**иммдевицеенумератор:: жетдефаултаудиоендпоинт**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint).</span><span class="sxs-lookup"><span data-stu-id="e63cf-139">Get a reference to the endpoint of the default communication device by calling [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint).</span></span> <span data-ttu-id="e63cf-140">В этом вызове приложение должно указать **екоммуникатионс** в параметре *Role* , чтобы ограничить перечисление устройств устройствами связи.</span><span class="sxs-lookup"><span data-stu-id="e63cf-140">In this call, the application must specify **eCommunications** in the *Role* parameter to restrict the device enumeration to communication devices.</span></span> <span data-ttu-id="e63cf-141">После получения ссылки на конечную точку устройства для устройства можно активировать службы, областью действия которых является конечная точка, вызвав [**иммдевице:: Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate).</span><span class="sxs-lookup"><span data-stu-id="e63cf-141">After you get a reference to the device endpoint for the device, you can activate the services that are scoped for the endpoint by calling [**IMMDevice::Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate).</span></span> <span data-ttu-id="e63cf-142">Например, можно передать идентификатор иаудиоклиент службы **IID \_** , чтобы активировать объект аудиопотока и использовать его для управления потоками, идентификатор **IID \_ иаудиоендпоинтволуме** для получения доступа к элементам управления громкостью конечной точки коммуникационного устройства или идентификатор **IID \_ иаудиосессионманажер** для активации диспетчера сеансов, позволяющего взаимодействовать с ядром политики конечной точки.</span><span class="sxs-lookup"><span data-stu-id="e63cf-142">For example, you can pass the **IID\_IAudioClient** service identifier to activate an audio client object and use it for stream management, the **IID\_IAudioEndpointVolume** identifier to get access to the volume controls of the communication device endpoint, or the **IID\_IAudioSessionManager** identifier to activate the session manager that enables you to interact with the policy engine of the endpoint.</span></span> <span data-ttu-id="e63cf-143">Дополнительные сведения о потоковых операциях см. в разделе [Управление потоками](stream-management.md).</span><span class="sxs-lookup"><span data-stu-id="e63cf-143">For information about stream operations, see [Stream Management](stream-management.md).</span></span>

<span data-ttu-id="e63cf-144">С помощью ссылки [**иммдевице**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) можно также получить доступ к хранилищу свойств для конечной точки устройства.</span><span class="sxs-lookup"><span data-stu-id="e63cf-144">By using the [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) reference, you can also access the property store for the device endpoint.</span></span> <span data-ttu-id="e63cf-145">Эти значения свойств, такие как понятное имя устройства и название производителя, заполняются поставщиком вычислительной техники и позволяют приложению определить характеристики коммуникационного устройства.</span><span class="sxs-lookup"><span data-stu-id="e63cf-145">These property values, such as device friendly name and manufacturer name, are populated by the OEM and enable an application to determine the characteristics of a communication device.</span></span> <span data-ttu-id="e63cf-146">Дополнительные сведения см. в разделе [Свойства устройства](device-properties.md).</span><span class="sxs-lookup"><span data-stu-id="e63cf-146">For more information, see [Device Properties](device-properties.md).</span></span>

<span data-ttu-id="e63cf-147">В следующем примере кода возвращается ссылка на конечную точку устройства связи по умолчанию для отрисовки звукового потока.</span><span class="sxs-lookup"><span data-stu-id="e63cf-147">The following example code gets a reference to the endpoint of the default communication device for rendering an audio stream.</span></span>


```C++
IMMDevice *defaultDevice = NULL;

hr = CoCreateInstance(__uuidof(MMDeviceEnumerator), NULL,
            CLSCTX_INPROC_SERVER, 
            __uuidof(IMMDeviceEnumerator), 
            (LPVOID *)&deviceEnumerator);

hr = deviceEnumerator->GetDefaultAudioEndpoint(eRender, 
            eCommunications, &defaultDevice);
```



## <a name="related-topics"></a><span data-ttu-id="e63cf-148">См. также</span><span class="sxs-lookup"><span data-stu-id="e63cf-148">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e63cf-149">Управление потоками</span><span class="sxs-lookup"><span data-stu-id="e63cf-149">Stream Management</span></span>](stream-management.md)
</dt> </dl>

 

 



