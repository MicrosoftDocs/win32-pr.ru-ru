---
description: О ВАСАПИ
ms.assetid: 452b9725-b0b9-4888-bbb5-a23e0067e840
title: О ВАСАПИ
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f869319f3100b797e58c7b43597869c9767ac037
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103990609"
---
# <a name="about-wasapi"></a><span data-ttu-id="c6c24-103">О ВАСАПИ</span><span class="sxs-lookup"><span data-stu-id="c6c24-103">About WASAPI</span></span>

<span data-ttu-id="c6c24-104">API сеанса Windows Audio (ВАСАПИ) позволяет клиентским приложениям управлять потоком звуковых данных между приложением и [устройством конечной точки аудио](audio-endpoint-devices.md).</span><span class="sxs-lookup"><span data-stu-id="c6c24-104">The Windows Audio Session API (WASAPI) enables client applications to manage the flow of audio data between the application and an [audio endpoint device](audio-endpoint-devices.md).</span></span>

<span data-ttu-id="c6c24-105">Файлы заголовков Аудиоклиент. h и Аудиополици. h определяют интерфейсы ВАСАПИ.</span><span class="sxs-lookup"><span data-stu-id="c6c24-105">Header files Audioclient.h and Audiopolicy.h define the WASAPI interfaces.</span></span>

<span data-ttu-id="c6c24-106">Каждый звуковой поток является участником [сеанса аудио](audio-sessions.md).</span><span class="sxs-lookup"><span data-stu-id="c6c24-106">Every audio stream is a member of an [audio session](audio-sessions.md).</span></span> <span data-ttu-id="c6c24-107">С помощью абстракции сеанса клиент ВАСАПИ может опознать звуковой поток как член группы связанных звуковых потоков.</span><span class="sxs-lookup"><span data-stu-id="c6c24-107">Through the session abstraction, a WASAPI client can identify an audio stream as a member of a group of related audio streams.</span></span> <span data-ttu-id="c6c24-108">Система может управлять всеми потоками в сеансе как единым целым.</span><span class="sxs-lookup"><span data-stu-id="c6c24-108">The system can manage all of the streams in the session as a single unit.</span></span>

<span data-ttu-id="c6c24-109">Звуковая подсистема — это [звуковой компонент пользовательского режима](user-mode-audio-components.md) , через который приложения совместно используют доступ к устройству конечной точки аудио.</span><span class="sxs-lookup"><span data-stu-id="c6c24-109">The audio engine is the [user-mode audio component](user-mode-audio-components.md) through which applications share access to an audio endpoint device.</span></span> <span data-ttu-id="c6c24-110">Аудио подсистема транспортировать звуковые данные между буфером конечной точки и устройством конечной точки.</span><span class="sxs-lookup"><span data-stu-id="c6c24-110">The audio engine transports audio data between an endpoint buffer and an endpoint device.</span></span> <span data-ttu-id="c6c24-111">Чтобы воспроизвести аудиопоток с помощью устройства конечной точки визуализации, приложение периодически записывает аудиоданные в буфер конечной точки отрисовки.</span><span class="sxs-lookup"><span data-stu-id="c6c24-111">To play an audio stream through a rendering endpoint device, an application periodically writes audio data to a rendering endpoint buffer.</span></span> <span data-ttu-id="c6c24-112">Обработчик звука смешивает потоки из различных приложений.</span><span class="sxs-lookup"><span data-stu-id="c6c24-112">The audio engine mixes the streams from the various applications.</span></span> <span data-ttu-id="c6c24-113">Чтобы записать звуковой поток из устройства записи конечной точки, приложение периодически считывает звуковые данные из буфера конечной точки записи.</span><span class="sxs-lookup"><span data-stu-id="c6c24-113">To record an audio stream from a capture endpoint device, an application periodically reads audio data from a capture endpoint buffer.</span></span>

<span data-ttu-id="c6c24-114">ВАСАПИ состоит из нескольких интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="c6c24-114">WASAPI consists of several interfaces.</span></span> <span data-ttu-id="c6c24-115">Первый из них — интерфейс [**иаудиоклиент**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) .</span><span class="sxs-lookup"><span data-stu-id="c6c24-115">The first of these is the [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) interface.</span></span> <span data-ttu-id="c6c24-116">Чтобы получить доступ к интерфейсам ВАСАПИ, клиент сначала получает ссылку на интерфейс **иаудиоклиент** устройства конечной точки аудио, вызвав метод [**Иммдевице:: Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) с параметром *IID* , равным **рефиид** IID \_ иаудиоклиент.</span><span class="sxs-lookup"><span data-stu-id="c6c24-116">To access the WASAPI interfaces, a client first obtains a reference to the **IAudioClient** interface of an audio endpoint device by calling the [**IMMDevice::Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) method with parameter *iid* set to **REFIID** IID\_IAudioClient.</span></span> <span data-ttu-id="c6c24-117">Клиент вызывает метод [**иаудиоклиент:: Initialize**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-initialize) для инициализации потока на устройстве конечной точки.</span><span class="sxs-lookup"><span data-stu-id="c6c24-117">The client calls the [**IAudioClient::Initialize**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-initialize) method to initialize a stream on an endpoint device.</span></span> <span data-ttu-id="c6c24-118">После инициализации потока клиент может получить ссылки на другие интерфейсы ВАСАПИ, вызвав метод [**иаудиоклиент::-Service**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getservice) .</span><span class="sxs-lookup"><span data-stu-id="c6c24-118">After initializing a stream, the client can obtain references to the other WASAPI interfaces by calling the [**IAudioClient::GetService**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getservice) method.</span></span>

<span data-ttu-id="c6c24-119">Многие методы в ВАСАПИ возвращают ошибку с кодом АУДКЛНТ \_ E \_ \_ , если устройство конечной точки аудио, используемое клиентским приложением, становится недействительным.</span><span class="sxs-lookup"><span data-stu-id="c6c24-119">Many of the methods in WASAPI return error code AUDCLNT\_E\_DEVICE\_INVALIDATED if the audio endpoint device that a client application is using becomes invalid.</span></span> <span data-ttu-id="c6c24-120">Часто приложение может восстановиться после этой ошибки.</span><span class="sxs-lookup"><span data-stu-id="c6c24-120">Frequently, the application can recover from this error.</span></span> <span data-ttu-id="c6c24-121">Дополнительные сведения см. в разделе [восстановление после ошибки Invalid-Device](recovering-from-an-invalid-device-error.md).</span><span class="sxs-lookup"><span data-stu-id="c6c24-121">For more information, see [Recovering from an Invalid-Device Error](recovering-from-an-invalid-device-error.md).</span></span>

<span data-ttu-id="c6c24-122">ВАСАПИ реализует следующие интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="c6c24-122">WASAPI implements the following interfaces.</span></span>



| <span data-ttu-id="c6c24-123">Интерфейс</span><span class="sxs-lookup"><span data-stu-id="c6c24-123">Interface</span></span>                                            | <span data-ttu-id="c6c24-124">Описание</span><span class="sxs-lookup"><span data-stu-id="c6c24-124">Description</span></span>                                                                                                                                                     |
|------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="c6c24-125">**иаудиокаптуреклиент**</span><span class="sxs-lookup"><span data-stu-id="c6c24-125">**IAudioCaptureClient**</span></span>](/windows/desktop/api/Audioclient/nn-audioclient-iaudiocaptureclient)   | <span data-ttu-id="c6c24-126">Позволяет клиенту считывать входные данные из буфера конечной точки записи.</span><span class="sxs-lookup"><span data-stu-id="c6c24-126">Enables a client to read input data from a capture endpoint buffer.</span></span>                                                                                             |
| [<span data-ttu-id="c6c24-127">**иаудиоклиент**</span><span class="sxs-lookup"><span data-stu-id="c6c24-127">**IAudioClient**</span></span>](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient)                 | <span data-ttu-id="c6c24-128">Позволяет клиенту создавать и инициализировать аудио-поток между звуковым приложением и обработчиком аудио или аппаратным буфером устройства конечной точки аудио.</span><span class="sxs-lookup"><span data-stu-id="c6c24-128">Enables a client to create and initialize an audio stream between an audio application and the audio engine or the hardware buffer of an audio endpoint device.</span></span> |
| [<span data-ttu-id="c6c24-129">**иаудиоклокк**</span><span class="sxs-lookup"><span data-stu-id="c6c24-129">**IAudioClock**</span></span>](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclock)                   | <span data-ttu-id="c6c24-130">Позволяет клиенту отслеживать скорость передачи данных в потоке и текущую точку в потоке.</span><span class="sxs-lookup"><span data-stu-id="c6c24-130">Enables a client to monitor a stream's data rate and the current position in the stream.</span></span>                                                                        |
| [<span data-ttu-id="c6c24-131">**иаудиорендерклиент**</span><span class="sxs-lookup"><span data-stu-id="c6c24-131">**IAudioRenderClient**</span></span>](/windows/desktop/api/Audioclient/nn-audioclient-iaudiorenderclient)     | <span data-ttu-id="c6c24-132">Позволяет клиенту записывать выходные данные в буфер конечной точки отрисовки.</span><span class="sxs-lookup"><span data-stu-id="c6c24-132">Enables a client to write output data to a rendering endpoint buffer.</span></span>                                                                                           |
| [<span data-ttu-id="c6c24-133">**иаудиосессионконтрол**</span><span class="sxs-lookup"><span data-stu-id="c6c24-133">**IAudioSessionControl**</span></span>](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessioncontrol) | <span data-ttu-id="c6c24-134">Позволяет клиенту настраивать параметры управления для сеанса аудио и отслеживать события в сеансе.</span><span class="sxs-lookup"><span data-stu-id="c6c24-134">Enables a client to configure the control parameters for an audio session and to monitor events in the session.</span></span>                                                 |
| [<span data-ttu-id="c6c24-135">**иаудиосессионманажер**</span><span class="sxs-lookup"><span data-stu-id="c6c24-135">**IAudioSessionManager**</span></span>](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionmanager) | <span data-ttu-id="c6c24-136">Позволяет клиенту получать доступ к элементам управления сеансом и элементам управления томами как для межпроцессных, так и для отдельных процессов.</span><span class="sxs-lookup"><span data-stu-id="c6c24-136">Enables a client to access the session controls and volume controls for both cross-process and process-specific audio sessions.</span></span>                                 |
| [<span data-ttu-id="c6c24-137">**иаудиостреамволуме**</span><span class="sxs-lookup"><span data-stu-id="c6c24-137">**IAudioStreamVolume**</span></span>](/windows/desktop/api/Audioclient/nn-audioclient-iaudiostreamvolume)     | <span data-ttu-id="c6c24-138">Позволяет клиенту контролировать и отслеживать уровни громкости для всех каналов в аудиопотока.</span><span class="sxs-lookup"><span data-stu-id="c6c24-138">Enables a client to control and monitor the volume levels for all of the channels in an audio stream.</span></span>                                                           |
| [<span data-ttu-id="c6c24-139">**ичаннелаудиоволуме**</span><span class="sxs-lookup"><span data-stu-id="c6c24-139">**IChannelAudioVolume**</span></span>](/windows/desktop/api/Audioclient/nn-audioclient-ichannelaudiovolume)   | <span data-ttu-id="c6c24-140">Позволяет клиенту управлять уровнями громкости для всех каналов в сеансе звука, к которому принадлежит поток.</span><span class="sxs-lookup"><span data-stu-id="c6c24-140">Enables a client to control the volume levels for all of the channels in the audio session that the stream belongs to.</span></span>                                          |
| [<span data-ttu-id="c6c24-141">**исимплеаудиоволуме**</span><span class="sxs-lookup"><span data-stu-id="c6c24-141">**ISimpleAudioVolume**</span></span>](/windows/desktop/api/Audioclient/nn-audioclient-isimpleaudiovolume)     | <span data-ttu-id="c6c24-142">Позволяет клиенту управлять основным уровнем громкости звукового сеанса.</span><span class="sxs-lookup"><span data-stu-id="c6c24-142">Enables a client to control the master volume level of an audio session.</span></span>                                                                                        |



 

<span data-ttu-id="c6c24-143">Клиенты ВАСАПИ, которым требуется уведомление о событиях, связанных с сеансом, должны реализовать следующий интерфейс.</span><span class="sxs-lookup"><span data-stu-id="c6c24-143">WASAPI clients that require notification of session-related events should implement the following interface.</span></span>



| <span data-ttu-id="c6c24-144">Интерфейс</span><span class="sxs-lookup"><span data-stu-id="c6c24-144">Interface</span></span>                                          | <span data-ttu-id="c6c24-145">Описание</span><span class="sxs-lookup"><span data-stu-id="c6c24-145">Description</span></span>                                                                                                            |
|----------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="c6c24-146">**иаудиосессионевентс**</span><span class="sxs-lookup"><span data-stu-id="c6c24-146">**IAudioSessionEvents**</span></span>](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) | <span data-ttu-id="c6c24-147">Предоставляет уведомления о событиях, связанных с сеансом, таких как изменения на уровне тома, отображаемое имя и состояние сеанса.</span><span class="sxs-lookup"><span data-stu-id="c6c24-147">Provides notifications of session-related events such as changes in the volume level, display name, and session state.</span></span> |



 

## <a name="related-topics"></a><span data-ttu-id="c6c24-148">См. также</span><span class="sxs-lookup"><span data-stu-id="c6c24-148">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c6c24-149">Управление потоками</span><span class="sxs-lookup"><span data-stu-id="c6c24-149">Stream Management</span></span>](stream-management.md)
</dt> <dt>

[<span data-ttu-id="c6c24-150">**Справочник по программированию**</span><span class="sxs-lookup"><span data-stu-id="c6c24-150">**Programming Reference**</span></span>](programming-reference.md)
</dt> </dl>

 

 



