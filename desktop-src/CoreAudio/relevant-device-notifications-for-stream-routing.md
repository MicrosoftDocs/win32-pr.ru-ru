---
description: В Windows 7 API-интерфейсы высокоуровневой платформы, использующие основные API аудио, такие как Media Foundation, DirectSound и Wave API, реализуют функцию маршрутизации потоков путем обработки переключения потоков с существующего устройства на новую конечную точку звука по умолчанию.
ms.assetid: caf831bb-b8de-467f-bdb4-f9f8991dc7a8
title: Соответствующие уведомления для потоковой маршрутизации
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ef3d253ce2ec5d6e3bef025a33233a9d377ca44b
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104141617"
---
# <a name="relevant-notifications-for-stream-routing"></a><span data-ttu-id="4f702-103">Соответствующие уведомления для потоковой маршрутизации</span><span class="sxs-lookup"><span data-stu-id="4f702-103">Relevant Notifications for Stream Routing</span></span>

<span data-ttu-id="4f702-104">В Windows 7 API-интерфейсы высокоуровневой платформы, использующие основные API аудио, такие как Media Foundation, DirectSound и Wave API, реализуют функцию маршрутизации потоков путем обработки переключения потоков с существующего устройства на новую конечную точку звука по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4f702-104">In Windows 7, high-level platform APIs that use Core Audio APIs, such as Media Foundation, DirectSound, and Wave APIs, implement the stream routing feature by handling stream switching from an existing device to a new default audio endpoint.</span></span> <span data-ttu-id="4f702-105">Приложения мультимедиа, использующие эти API, используют поведение маршрутизации потока без каких-либо изменений в источнике.</span><span class="sxs-lookup"><span data-stu-id="4f702-105">Media applications that use these APIs use the stream routing behavior without any modifications to the source.</span></span> <span data-ttu-id="4f702-106">Клиенты Direct ВАСАПИ могут использовать уведомления, отправленные основными компонентами, и реализовать функцию маршрутизации потоков.</span><span class="sxs-lookup"><span data-stu-id="4f702-106">Direct WASAPI clients can use the notifications sent by Core Audio components and implement the stream routing feature.</span></span>

<span data-ttu-id="4f702-107">Чтобы реализовать функцию маршрутизации потоков, клиент должен прослушивать два типа событий: уведомления об изменении устройства и уведомления об отключении сеанса.</span><span class="sxs-lookup"><span data-stu-id="4f702-107">To implement the stream routing feature, a client must listen for two types of events: device change notifications and session disconnect notifications.</span></span> <span data-ttu-id="4f702-108">В реализации, предоставляемой интерфейсами API высокого уровня, эти события отправляются для конечных точек устройств по умолчанию, созданных путем вызова [**иммдевицеенумератор:: жетдефаултаудиоендпоинт**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint).</span><span class="sxs-lookup"><span data-stu-id="4f702-108">In the implementation provided by the high-level APIs, these events are sent for default device endpoints created by calling [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint).</span></span> <span data-ttu-id="4f702-109">Дополнительные сведения см. [в разделе Получение конечной точки устройства для маршрутизации потоков](getting-the-default-device-endpoint-for-stream-routing.md).</span><span class="sxs-lookup"><span data-stu-id="4f702-109">For more information, see [Getting the Device Endpoint for Stream Routing](getting-the-default-device-endpoint-for-stream-routing.md).</span></span>

<span data-ttu-id="4f702-110">Основной звуковой компонент Ммдевицеапи обеспечивает обратные вызовы уведомлений при добавлении, удалении или изменении звуковых устройств.</span><span class="sxs-lookup"><span data-stu-id="4f702-110">The Core Audio component MMDeviceAPI delivers notification callbacks when audio devices are added, removed, or modified.</span></span> <span data-ttu-id="4f702-111">Изменения формата и сеанса звука выводятся как события через ВАСАПИ.</span><span class="sxs-lookup"><span data-stu-id="4f702-111">The format and audio session changes are reported as events through WASAPI.</span></span>

## <a name="device-change-notifications"></a><span data-ttu-id="4f702-112">Уведомления об изменении устройств</span><span class="sxs-lookup"><span data-stu-id="4f702-112">Device Change Notifications</span></span>

<span data-ttu-id="4f702-113">Ммдевицеапи вызывает события при добавлении, удалении или изменении звуковых устройств.</span><span class="sxs-lookup"><span data-stu-id="4f702-113">MMDeviceAPI raises events when audio devices are added, removed, or modified.</span></span> <span data-ttu-id="4f702-114">Если клиент должен предоставлять функции маршрутизации потоковой передачи, необходимо реализовать интерфейс [**иммнотификатионклиент**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) и зарегистрировать его реализацию с помощью ммдевицеапи.</span><span class="sxs-lookup"><span data-stu-id="4f702-114">If the client is to provide stream routing functionality, it must implement the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) interface and register its implementation with MMDeviceAPI.</span></span>

<span data-ttu-id="4f702-115">Чтобы получать уведомления об изменении устройств, клиент должен выполнить следующие задачи:</span><span class="sxs-lookup"><span data-stu-id="4f702-115">To get device change notifications, the client must perform the following tasks:</span></span>

-   <span data-ttu-id="4f702-116">Реализуйте интерфейс [**иммнотификатионклиент**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) для управления уведомлениями об изменении устройств, отправленных ммдевицеапи.</span><span class="sxs-lookup"><span data-stu-id="4f702-116">Implement the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) interface to handle device change notifications sent by MMDeviceAPI.</span></span>
-   <span data-ttu-id="4f702-117">Зарегистрируйте реализацию [**иммнотификатионклиент**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) с помощью ммдевицеапи, вызвав метод [**Иммдевицеенумератор:: регистерендпоинтнотификатионкаллбакк**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-registerendpointnotificationcallback) .</span><span class="sxs-lookup"><span data-stu-id="4f702-117">Register the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) implementation with MMDeviceAPI by calling the [**IMMDeviceEnumerator::RegisterEndpointNotificationCallback**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-registerendpointnotificationcallback) method.</span></span>

<span data-ttu-id="4f702-118">После регистрации реализации этих интерфейсов клиентом клиент получает уведомления в форме обратных вызовов через методы этих интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="4f702-118">After the client's implementation of these interfaces is registered, the client receives notifications in the form of callbacks through the methods of these interfaces.</span></span> <span data-ttu-id="4f702-119">Методы [**иммнотификатионклиент**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) вызываются ммдевицеапи, когда он вызывает события уровня конечной точки (изменения состояния конечной точки, новые прибытия конечной точки, удаления конечных точек, изменения конечной точки по умолчанию и изменения свойств конечной точки).</span><span class="sxs-lookup"><span data-stu-id="4f702-119">[**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) methods are called by MMDeviceAPI when it raises endpoint-level events (endpoint state changes, new endpoint arrivals, endpoint deletions, default endpoint changes, and endpoint property changes).</span></span>

<span data-ttu-id="4f702-120">Если клиент хочет предоставить потоковую маршрутизацию для устройства по умолчанию, клиент должен реализовать поведение изменения устройства при получении уведомления с помощью обратного вызова [**иммнотификатионклиент:: ондефаултдевицечанжед**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immnotificationclient-ondefaultdevicechanged) .</span><span class="sxs-lookup"><span data-stu-id="4f702-120">If the client wants to provide stream routing for the default device, the client must implement the device change behavior when it receives the notification through the [**IMMNotificationClient::OnDefaultDeviceChanged**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immnotificationclient-ondefaultdevicechanged) callback.</span></span>

## <a name="audio-session-change-notifications"></a><span data-ttu-id="4f702-121">Уведомления об изменении сеанса аудио</span><span class="sxs-lookup"><span data-stu-id="4f702-121">Audio Session Change Notifications</span></span>

<span data-ttu-id="4f702-122">Изменения в сеансе аудио и изменении формата передаются в виде событий сеанса звука через ВАСАПИ.</span><span class="sxs-lookup"><span data-stu-id="4f702-122">Audio session changes and format changes are reported as audio session events through WASAPI.</span></span> <span data-ttu-id="4f702-123">Клиент ВАСАПИ реализует интерфейс [**иаудиосессионевентс**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) и регистрирует реализацию с помощью васапи.</span><span class="sxs-lookup"><span data-stu-id="4f702-123">A WASAPI client implements the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface and registers the implementation with WASAPI.</span></span>

<span data-ttu-id="4f702-124">Чтобы получать уведомления об изменении сеанса аудио, клиент должен выполнить следующие задачи:</span><span class="sxs-lookup"><span data-stu-id="4f702-124">To get audio session change notifications, the client must perform the following tasks:</span></span>

-   <span data-ttu-id="4f702-125">Реализуйте интерфейс [**иаудиосессионевентс**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) для работы с уведомлениями об изменении формата, отправленных васапи.</span><span class="sxs-lookup"><span data-stu-id="4f702-125">Implement the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface to handle format change notifications sent by WASAPI.</span></span>
-   <span data-ttu-id="4f702-126">Зарегистрируйте реализацию [**иаудиосессионевентс**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) с помощью васапи, вызвав метод [**Иаудиосессионконтрол:: регистераудиосессионнотификатион**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) .</span><span class="sxs-lookup"><span data-stu-id="4f702-126">Register the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) implementation with WASAPI by calling the [**IAudioSessionControl::RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) method.</span></span>

<span data-ttu-id="4f702-127">Методы [**иаудиосессионевентс**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) вызываются васапи, когда происходят изменения в сеансе звука.</span><span class="sxs-lookup"><span data-stu-id="4f702-127">[**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) methods are called by WASAPI when audio session changes occur.</span></span> <span data-ttu-id="4f702-128">Эти события возникают при изменении отображаемого имени сеанса, пути к значку, тома, параметра группирования или изменения состояния.</span><span class="sxs-lookup"><span data-stu-id="4f702-128">These events are raised when the session's display name, icon path, volume, grouping parameter, or state changes.</span></span>

<span data-ttu-id="4f702-129">Чтобы реализовать функцию маршрутизации потоков, клиент должен дождаться уведомления об отключении сеанса.</span><span class="sxs-lookup"><span data-stu-id="4f702-129">To implement the stream routing feature, the client must wait for the session-disconnect notification.</span></span> <span data-ttu-id="4f702-130">Если сеанс аудио отключен или изменился формат устройства, ВАСАПИ отправляет клиентские уведомления в виде обратных вызовов через [**иаудиосессионевентс:: онсессиондисконнектед**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected).</span><span class="sxs-lookup"><span data-stu-id="4f702-130">When an audio session is disconnected or a device's format is changed, WASAPI sends the client notifications in the form of callbacks through [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected).</span></span> <span data-ttu-id="4f702-131">С помощью уведомления о разрыве соединения ВАСАПИ также отправляет значение, указывающее, почему сеанс был отключен.</span><span class="sxs-lookup"><span data-stu-id="4f702-131">With the disconnection notification, WASAPI also sends a value that indicates why the session was disconnected.</span></span> <span data-ttu-id="4f702-132">Это может произойти по нескольким причинам, таким как устройство было удалено, сервер остановлен и т. д.</span><span class="sxs-lookup"><span data-stu-id="4f702-132">This can occur for several reasons, such as the device was removed, the server stopped, and so on.</span></span> <span data-ttu-id="4f702-133">Полный список причин см. в описании перечисления **аудиосессиондисконнектреасон** , определенного в аудиополици. h.</span><span class="sxs-lookup"><span data-stu-id="4f702-133">For the complete list of reasons, see the **AudioSessionDisconnectReason** enumeration defined in AudioPolicy.h.</span></span> <span data-ttu-id="4f702-134">Если устройство по умолчанию изменяется, клиент должен ждать уведомлений (если они еще не были получены), которые сопровождаются значением **дисконнектреасондевицеремовал** .</span><span class="sxs-lookup"><span data-stu-id="4f702-134">If the default device changes, the client must wait for the notifications (if they have not already been received) that are accompanied with a **DisconnectReasonDeviceRemoval** value.</span></span> <span data-ttu-id="4f702-135">В ответ на такие уведомления клиент может повторно открыть поток на новом устройстве по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4f702-135">In response to such notifications, the client might reopen the stream on the new default device.</span></span>

<span data-ttu-id="4f702-136">Так как все эти операции являются асинхронного, порядок, в котором приложение получает уведомления, не может быть прогнозируемым.</span><span class="sxs-lookup"><span data-stu-id="4f702-136">Because all of these operations are asychronous, the order in which the application receives notifications cannnot be predicted.</span></span> <span data-ttu-id="4f702-137">Однако обычно приложение получает значение **аудиосессиондисконнект** перед уведомлением об изменении устройства по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4f702-137">However, typically, the application receives **AudioSessionDisconnect** value before the default device change notification.</span></span>

### <a name="format-change-notifications"></a><span data-ttu-id="4f702-138">Уведомления об изменении формата</span><span class="sxs-lookup"><span data-stu-id="4f702-138">Format Change Notifications</span></span>

<span data-ttu-id="4f702-139">Изменения в звуковом формате происходят при изменении формата потока.</span><span class="sxs-lookup"><span data-stu-id="4f702-139">Audio format changes occur when the format of the stream changes.</span></span> <span data-ttu-id="4f702-140">Это может произойти, когда пользователь выбирает новый формат на панели управления **звуком** или новое устройство по умолчанию поддерживает новый формат (например, HDMI или некоторые профессиональные звуковые интерфейсы с ручной корректировкой курсов).</span><span class="sxs-lookup"><span data-stu-id="4f702-140">This can occur when the user selects a new format in the **Sound** control panel or the new default device supports a new format (for example, HDMI or certain professional audio interfaces with a manual sample-rate adjustment).</span></span> <span data-ttu-id="4f702-141">Чтобы уведомить клиента об этих типах изменений формата, ВАСАПИ отправляет уведомление сеанса зарегистрированной реализацией [**иаудиосессионевентс:: онсессиондисконнектед**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) с причиной отключения **дисконнектреасонформатчанжед**.</span><span class="sxs-lookup"><span data-stu-id="4f702-141">To notify the client about these types of format changes, WASAPI sends a session notification by the registered implementation of [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) with a disconnect reason of **DisconnectReasonFormatChanged**.</span></span> <span data-ttu-id="4f702-142">Клиент может справиться с уведомлением, повторно открыв поток в новом формате.</span><span class="sxs-lookup"><span data-stu-id="4f702-142">The client can handle the notification by reopening the stream in the new format.</span></span>

## <a name="related-topics"></a><span data-ttu-id="4f702-143">См. также</span><span class="sxs-lookup"><span data-stu-id="4f702-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4f702-144">Сведения об API Ммдевице</span><span class="sxs-lookup"><span data-stu-id="4f702-144">About MMDevice API</span></span>](mmdevice-api.md)
</dt> <dt>

[<span data-ttu-id="4f702-145">О ВАСАПИ</span><span class="sxs-lookup"><span data-stu-id="4f702-145">About WASAPI</span></span>](wasapi.md)
</dt> <dt>

[<span data-ttu-id="4f702-146">Потоковая маршрутизация</span><span class="sxs-lookup"><span data-stu-id="4f702-146">Stream Routing</span></span>](stream-routing.md)
</dt> </dl>

 

 



