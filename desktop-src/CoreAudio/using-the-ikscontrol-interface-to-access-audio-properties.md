---
description: Использование интерфейса Иксконтрол для доступа к свойствам аудио
ms.assetid: 72bf9164-96c6-4543-b858-19480b032fdb
title: Использование интерфейса Иксконтрол для доступа к свойствам аудио
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a67639a0e51334da80b7bff88293414a58bb204c
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104262683"
---
# <a name="using-the-ikscontrol-interface-to-access-audio-properties"></a><span data-ttu-id="5078e-103">Использование интерфейса Иксконтрол для доступа к свойствам аудио</span><span class="sxs-lookup"><span data-stu-id="5078e-103">Using the IKsControl Interface to Access Audio Properties</span></span>

<span data-ttu-id="5078e-104">В редких случаях специализированному звуковому приложению может потребоваться использовать интерфейс [**иксконтрол**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) для доступа к определенным аппаратным возможностям звукового адаптера, которые не предоставляются [API Девицетопологи](devicetopology-api.md) или [API ммдевице](mmdevice-api.md).</span><span class="sxs-lookup"><span data-stu-id="5078e-104">In rare cases, a specialized audio application might need to use the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface to access certain hardware capabilities of an audio adapter that are not exposed by the [DeviceTopology API](devicetopology-api.md) or the [MMDevice API](mmdevice-api.md).</span></span> <span data-ttu-id="5078e-105">Интерфейс **иксконтрол** делает свойства, события и методы устройств потоковой передачи (KS) доступными для приложений пользовательского режима.</span><span class="sxs-lookup"><span data-stu-id="5078e-105">The **IKsControl** interface makes the properties, events, and methods of kernel-streaming (KS) devices available to user-mode applications.</span></span> <span data-ttu-id="5078e-106">Основным интересом к звуковым приложениям являются свойства KS.</span><span class="sxs-lookup"><span data-stu-id="5078e-106">Of primary interest to audio applications are KS properties.</span></span> <span data-ttu-id="5078e-107">Интерфейс **иксконтрол** можно использовать совместно с API ДЕВИЦЕТОПОЛОГИ и API ммдевице для доступа к свойствам KS звуковых адаптеров.</span><span class="sxs-lookup"><span data-stu-id="5078e-107">The **IKsControl** interface can be used in conjunction with the DeviceTopology API and the MMDevice API to access the KS properties of audio adapters.</span></span>

<span data-ttu-id="5078e-108">Интерфейс [**иксконтрол**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) предназначен главным образом для использования поставщиками оборудования, которые пишут приложения панели управления для управления звуковым оборудованием.</span><span class="sxs-lookup"><span data-stu-id="5078e-108">The [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface is intended primarily for use by hardware vendors who write control-panel applications to manage their audio hardware.</span></span> <span data-ttu-id="5078e-109">**Иксконтрол** менее удобен для звуковых приложений общего назначения, которые не привязаны к определенным аппаратным устройствам.</span><span class="sxs-lookup"><span data-stu-id="5078e-109">**IKsControl** is less useful for general-purpose audio applications that are not tied to particular hardware devices.</span></span> <span data-ttu-id="5078e-110">Это связано с тем, что поставщики оборудования часто реализуют собственные механизмы для доступа к свойствам аудио своих устройств.</span><span class="sxs-lookup"><span data-stu-id="5078e-110">The reason is that hardware vendors frequently implement proprietary mechanisms to access the audio properties of their devices.</span></span> <span data-ttu-id="5078e-111">В отличие от API Девицетопологи, который скрывает особенности аппаратно-зависимых драйверов и предоставляет сравнительно единообразный интерфейс для доступа к свойствам аудио, приложения используют **иксконтрол** для непосредственного взаимодействия с драйверами.</span><span class="sxs-lookup"><span data-stu-id="5078e-111">In contrast to the DeviceTopology API, which hides hardware-specific driver quirks and provides a relatively uniform interface for accessing audio properties, applications use **IKsControl** to communicate directly with drivers.</span></span> <span data-ttu-id="5078e-112">Дополнительные сведения о **иксконтрол** см. в документации по Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="5078e-112">For more information about **IKsControl**, see the Windows DDK documentation.</span></span>

<span data-ttu-id="5078e-113">Как обсуждалось в разделе [топологии устройств](device-topologies.md), подразделение в топологии устройства адаптера может поддерживать один или несколько интерфейсов элементов управления, зависящих от функции, показанных в левом столбце следующей таблицы.</span><span class="sxs-lookup"><span data-stu-id="5078e-113">As discussed in [Device Topologies](device-topologies.md), a subunit in the topology of an adapter device might support one or more of the function-specific control interfaces shown in the left column of the following table.</span></span> <span data-ttu-id="5078e-114">Каждая запись в правом столбце таблицы — это свойство KS, соответствующее интерфейсу элемента управления слева.</span><span class="sxs-lookup"><span data-stu-id="5078e-114">Each entry in the right column of the table is the KS property that corresponds to the control interface on the left.</span></span> <span data-ttu-id="5078e-115">Интерфейс элемента управления предоставляет удобный доступ к свойству.</span><span class="sxs-lookup"><span data-stu-id="5078e-115">The control interface provides convenient access to the property.</span></span> <span data-ttu-id="5078e-116">Большинство аудио-драйверов используют свойства KS для представления возможностей обработки, характерных для функций подразделений (также называемых узлами KS) в топологиях своих звуковых адаптеров.</span><span class="sxs-lookup"><span data-stu-id="5078e-116">Most audio drivers use KS properties to represent the function-specific processing capabilities of the subunits (also referred to as KS nodes) in the topologies of their audio adapters.</span></span> <span data-ttu-id="5078e-117">Дополнительные сведения о свойствах KS и узлах KS см. в документации по Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="5078e-117">For more information about KS properties and KS nodes, see the Windows DDK documentation.</span></span>



| <span data-ttu-id="5078e-118">Интерфейс управления</span><span class="sxs-lookup"><span data-stu-id="5078e-118">Control interface</span></span>                                          | <span data-ttu-id="5078e-119">KS, свойство</span><span class="sxs-lookup"><span data-stu-id="5078e-119">KS property</span></span>                        |
|------------------------------------------------------------|------------------------------------|
| [<span data-ttu-id="5078e-120">**иаудиоаутогаинконтрол**</span><span class="sxs-lookup"><span data-stu-id="5078e-120">**IAudioAutoGainControl**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudioautogaincontrol)     | <span data-ttu-id="5078e-121">КСПРОПЕРТИ \_ Audio \_ АГК</span><span class="sxs-lookup"><span data-stu-id="5078e-121">KSPROPERTY\_AUDIO\_AGC</span></span>             |
| [<span data-ttu-id="5078e-122">**иаудиобасс**</span><span class="sxs-lookup"><span data-stu-id="5078e-122">**IAudioBass**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiobass)                           | <span data-ttu-id="5078e-123">КСПРОПЕРТИ \_ Audio \_ НЧ</span><span class="sxs-lookup"><span data-stu-id="5078e-123">KSPROPERTY\_AUDIO\_BASS</span></span>            |
| [<span data-ttu-id="5078e-124">**иаудиочаннелконфиг**</span><span class="sxs-lookup"><span data-stu-id="5078e-124">**IAudioChannelConfig**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiochannelconfig)         | <span data-ttu-id="5078e-125">\_ \_ Конфигурация канала кспроперти \_ Audio</span><span class="sxs-lookup"><span data-stu-id="5078e-125">KSPROPERTY\_AUDIO\_CHANNEL\_CONFIG</span></span> |
| [<span data-ttu-id="5078e-126">**иаудиоинпутселектор**</span><span class="sxs-lookup"><span data-stu-id="5078e-126">**IAudioInputSelector**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudioinputselector)         | <span data-ttu-id="5078e-127">\_ \_ источник мультиплексора кспроперти Audio \_</span><span class="sxs-lookup"><span data-stu-id="5078e-127">KSPROPERTY\_AUDIO\_MUX\_SOURCE</span></span>     |
| [<span data-ttu-id="5078e-128">**иаудиолауднесс**</span><span class="sxs-lookup"><span data-stu-id="5078e-128">**IAudioLoudness**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudioloudness)                   | <span data-ttu-id="5078e-129">КСПРОПЕРТИ \_ \_ громкости звука</span><span class="sxs-lookup"><span data-stu-id="5078e-129">KSPROPERTY\_AUDIO\_LOUDNESS</span></span>        |
| [<span data-ttu-id="5078e-130">**иаудиомидранже**</span><span class="sxs-lookup"><span data-stu-id="5078e-130">**IAudioMidrange**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiomidrange)                   | <span data-ttu-id="5078e-131">КСПРОПЕРТИ \_ аудио \_ середина</span><span class="sxs-lookup"><span data-stu-id="5078e-131">KSPROPERTY\_AUDIO\_MID</span></span>             |
| [<span data-ttu-id="5078e-132">**иаудиомуте**</span><span class="sxs-lookup"><span data-stu-id="5078e-132">**IAudioMute**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiomute)                           | <span data-ttu-id="5078e-133">\_Выключить звук \_ кспроперти</span><span class="sxs-lookup"><span data-stu-id="5078e-133">KSPROPERTY\_AUDIO\_MUTE</span></span>            |
| [<span data-ttu-id="5078e-134">**иаудиуутпутселектор**</span><span class="sxs-lookup"><span data-stu-id="5078e-134">**IAudioOutputSelector**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiooutputselector)       | <span data-ttu-id="5078e-135">\_приемник кспроперти Audio \_ демультиплексирование \_</span><span class="sxs-lookup"><span data-stu-id="5078e-135">KSPROPERTY\_AUDIO\_DEMUX\_DEST</span></span>     |
| [<span data-ttu-id="5078e-136">**иаудиопеакметер**</span><span class="sxs-lookup"><span data-stu-id="5078e-136">**IAudioPeakMeter**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiopeakmeter)                 | <span data-ttu-id="5078e-137">КСПРОПЕРТИ \_ Audio \_ пеакметер</span><span class="sxs-lookup"><span data-stu-id="5078e-137">KSPROPERTY\_AUDIO\_PEAKMETER</span></span>       |
| [<span data-ttu-id="5078e-138">**иаудиотребле**</span><span class="sxs-lookup"><span data-stu-id="5078e-138">**IAudioTreble**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiotreble)                       | <span data-ttu-id="5078e-139">КСПРОПЕРТИ \_ аудио \_ ВЧ</span><span class="sxs-lookup"><span data-stu-id="5078e-139">KSPROPERTY\_AUDIO\_TREBLE</span></span>          |
| [<span data-ttu-id="5078e-140">**иаудиоволумелевел**</span><span class="sxs-lookup"><span data-stu-id="5078e-140">**IAudioVolumeLevel**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiovolumelevel)             | <span data-ttu-id="5078e-141">КСПРОПЕРТИ \_ Audio \_ волумелевел</span><span class="sxs-lookup"><span data-stu-id="5078e-141">KSPROPERTY\_AUDIO\_VOLUMELEVEL</span></span>     |
| [<span data-ttu-id="5078e-142">**идевицеспеЦификпроперти**</span><span class="sxs-lookup"><span data-stu-id="5078e-142">**IDeviceSpecificProperty**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-idevicespecificproperty) | <span data-ttu-id="5078e-143">КСПРОПЕРТИ \_ для \_ разработки \_ аудио</span><span class="sxs-lookup"><span data-stu-id="5078e-143">KSPROPERTY\_AUDIO\_DEV\_SPECIFIC</span></span>   |



 

<span data-ttu-id="5078e-144">Топологии некоторых звуковых адаптеров могут содержать подединицы, имеющие свойства KS, которых нет в приведенной выше таблице.</span><span class="sxs-lookup"><span data-stu-id="5078e-144">The topologies of some audio adapters might contain subunits that have KS properties that are not listed in the preceding table.</span></span> <span data-ttu-id="5078e-145">Например, предположим, что вызов метода [**ипарт:: жетсубтипе**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) для определенной подединицы получает значение GUID кснодетипе \_ тон.</span><span class="sxs-lookup"><span data-stu-id="5078e-145">For example, assume that a call to the [**IPart::GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) method for a particular subunit retrieves the GUID value KSNODETYPE\_TONE.</span></span> <span data-ttu-id="5078e-146">Этот тип GUID этого подтипа указывает, что подединица поддерживает одно или несколько следующих свойств KS:</span><span class="sxs-lookup"><span data-stu-id="5078e-146">This subtype GUID indicates that the subunit supports one or more of the following KS properties:</span></span>

-   <span data-ttu-id="5078e-147">КСПРОПЕРТИ \_ Audio \_ НЧ</span><span class="sxs-lookup"><span data-stu-id="5078e-147">KSPROPERTY\_AUDIO\_BASS</span></span>
-   <span data-ttu-id="5078e-148">КСПРОПЕРТИ \_ аудио \_ середина</span><span class="sxs-lookup"><span data-stu-id="5078e-148">KSPROPERTY\_AUDIO\_MID</span></span>
-   <span data-ttu-id="5078e-149">КСПРОПЕРТИ \_ аудио \_ ВЧ</span><span class="sxs-lookup"><span data-stu-id="5078e-149">KSPROPERTY\_AUDIO\_TREBLE</span></span>
-   <span data-ttu-id="5078e-150">\_ \_ усиление кспроперти звука басов \_</span><span class="sxs-lookup"><span data-stu-id="5078e-150">KSPROPERTY\_AUDIO\_BASS\_BOOST</span></span>

<span data-ttu-id="5078e-151">Первые три свойства в этом списке можно получить с помощью интерфейсов элементов управления, которые отображаются в предыдущей таблице, но свойство КСПРОПЕРТИ \_ Audio \_ басов \_ Boost не имеет соответствующего интерфейса управления в API девицетопологи.</span><span class="sxs-lookup"><span data-stu-id="5078e-151">The first three properties in this list can be accessed through the control interfaces that appear in the preceding table, but the KSPROPERTY\_AUDIO\_BASS\_BOOST property has no corresponding control interface in the DeviceTopology API.</span></span> <span data-ttu-id="5078e-152">Однако приложение может использовать интерфейс [**иксконтрол**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) для доступа к этому свойству, если подединица поддерживает свойство.</span><span class="sxs-lookup"><span data-stu-id="5078e-152">However, an application can use the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface to access this property, if the subunit supports the property.</span></span>

<span data-ttu-id="5078e-153">Чтобы получить доступ к \_ свойству кспроперти Audio басов для \_ \_ подединицы подтипа кснодетипе тон, необходимо выполнить следующие действия \_ :</span><span class="sxs-lookup"><span data-stu-id="5078e-153">The following steps are required to access the KSPROPERTY\_AUDIO\_BASS\_BOOST property of a subunit of subtype KSNODETYPE\_TONE:</span></span>

1.  <span data-ttu-id="5078e-154">Вызовите метод [**иконнектор:: жетдевицеидконнектедто**](/windows/desktop/api/Devicetopology/nf-devicetopology-iconnector-getdeviceidconnectedto) или [**Идевицетопологи:: GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) , чтобы получить строку идентификатора устройства, идентифицирующее устройство адаптера.</span><span class="sxs-lookup"><span data-stu-id="5078e-154">Call the [**IConnector::GetDeviceIdConnectedTo**](/windows/desktop/api/Devicetopology/nf-devicetopology-iconnector-getdeviceidconnectedto) or [**IDeviceTopology::GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) method to obtain the device ID string that identifies the adapter device.</span></span> <span data-ttu-id="5078e-155">Эта строка похожа на [строку идентификатора конечной точки](endpoint-id-strings.md), за исключением того, что она определяет устройство адаптера вместо устройства конечной точки.</span><span class="sxs-lookup"><span data-stu-id="5078e-155">This string is similar to an [endpoint ID string](endpoint-id-strings.md), except that it identifies an adapter device instead of an endpoint device.</span></span> <span data-ttu-id="5078e-156">Дополнительные сведения о различиях между устройством адаптера и конечным устройством см. в статье [устройства конечных точек аудио](audio-endpoint-devices.md).</span><span class="sxs-lookup"><span data-stu-id="5078e-156">For more information about the difference between an adapter device and an endpoint device, see [Audio Endpoint Devices](audio-endpoint-devices.md).</span></span>
2.  <span data-ttu-id="5078e-157">Получите интерфейс [**иммдевице**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) устройства адаптера, вызвав метод [**иммдевицеенумератор::**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) GetString с идентификатором устройства.</span><span class="sxs-lookup"><span data-stu-id="5078e-157">Obtain the [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) interface of the adapter device by calling the [**IMMDeviceEnumerator::GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) method with the device ID string.</span></span> <span data-ttu-id="5078e-158">Этот интерфейс **иммдевице** тот же, что и интерфейс, описанный в **интерфейсе иммдевице**, но он представляет устройство адаптера вместо устройства конечной точки.</span><span class="sxs-lookup"><span data-stu-id="5078e-158">This **IMMDevice** interface is the same as the interface described in **IMMDevice Interface**, but it represents an adapter device instead of an endpoint device.</span></span>
3.  <span data-ttu-id="5078e-159">Получите интерфейс [**иксконтрол**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) в подразделении, вызвав метод [**Иммдевице:: Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) с параметром *IID* , равным **рефиид** IID \_ иксконтрол.</span><span class="sxs-lookup"><span data-stu-id="5078e-159">Obtain the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface on the subunit by calling the [**IMMDevice::Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) method with parameter *iid* set to **REFIID** IID\_IKsControl.</span></span> <span data-ttu-id="5078e-160">Обратите внимание, что интерфейсы, поддерживаемые этим методом **активации** , предназначенным для устройства адаптера, отличаются от интерфейсов, поддерживаемых методом **Activate** для устройства конечной точки.</span><span class="sxs-lookup"><span data-stu-id="5078e-160">Note that the interfaces supported by this **Activate** method, which is for an adapter device, are different from the interfaces supported by the **Activate** method for an endpoint device.</span></span> <span data-ttu-id="5078e-161">В частности, метод **Activate** для устройства адаптера поддерживает **иксконтрол**.</span><span class="sxs-lookup"><span data-stu-id="5078e-161">In particular, the **Activate** method for an adapter device supports **IKsControl**.</span></span>
4.  <span data-ttu-id="5078e-162">Вызовите метод [**ипарт:: жетлокалид**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getlocalid) , чтобы получить локальный идентификатор подединицы.</span><span class="sxs-lookup"><span data-stu-id="5078e-162">Call the [**IPart::GetLocalId**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getlocalid) method to obtain the local ID of the subunit.</span></span>
5.  <span data-ttu-id="5078e-163">Создание запроса свойства KS.</span><span class="sxs-lookup"><span data-stu-id="5078e-163">Construct a KS property request.</span></span> <span data-ttu-id="5078e-164">Идентификатор узла KS, необходимый для запроса, содержится в 16-значащих битах локального идентификатора, полученного на предыдущем шаге.</span><span class="sxs-lookup"><span data-stu-id="5078e-164">The KS node ID required for the request is contained in the 16 least-significant bits of the local ID obtained in the previous step.</span></span>
6.  <span data-ttu-id="5078e-165">Отправьте запрос свойства KS в звуковой драйвер, вызвав метод [**иксконтрол:: кспроперти**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) .</span><span class="sxs-lookup"><span data-stu-id="5078e-165">Send the KS property request to the audio driver by calling the [**IKsControl::KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) method.</span></span> <span data-ttu-id="5078e-166">Дополнительные сведения об этом методе см. в документации по Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="5078e-166">For more information about this method, see the Windows DDK documentation.</span></span>

<span data-ttu-id="5078e-167">В следующем примере кода извлекается значение \_ Свойства Boost кспроперти Audio \_ басов \_ из подединицы подтипа \_ тон кснодетипе:</span><span class="sxs-lookup"><span data-stu-id="5078e-167">The following code example retrieves the value of the KSPROPERTY\_AUDIO\_BASS\_BOOST property from a subunit of subtype KSNODETYPE\_TONE:</span></span>


```C++
//-----------------------------------------------------------
// This function calls the IKsControl::Property method to get
// the value of the KSPROPERTY_AUDIO_BASS_BOOST property of
// a subunit. Parameter pPart should point to a part that is
// a subunit with a subtype GUID value of KSNODETYPE_TONE.
//-----------------------------------------------------------
#define PARTID_MASK 0x0000ffff
#define EXIT_ON_ERROR(hres)  \
              if (FAILED(hres)) { goto Exit; }
#define SAFE_RELEASE(punk)  \
              if ((punk) != NULL)  \
                { (punk)->Release(); (punk) = NULL; }

const IID IID_IKsControl = __uuidof(IKsControl);

HRESULT GetBassBoost(IMMDeviceEnumerator *pEnumerator,
                     IPart *pPart, BOOL *pbValue)
{
    HRESULT hr;
    IDeviceTopology *pTopology = NULL;
    IMMDevice *pPnpDevice = NULL;
    IKsControl *pKsControl = NULL;
    LPWSTR pwszDeviceId = NULL;

    if (pEnumerator == NULL || pPart == NULL || pbValue == NULL)
    {
        return E_INVALIDARG;
    }

    // Get the topology object for the adapter device that contains
    // the subunit represented by the IPart interface.
    hr = pPart->GetTopologyObject(&pTopology);
    EXIT_ON_ERROR(hr)

    // Get the device ID string that identifies the adapter device.
    hr = pTopology->GetDeviceId(&pwszDeviceId);
    EXIT_ON_ERROR(hr)

    // Get the IMMDevice interface of the adapter device object.
    hr = pEnumerator->GetDevice(pwszDeviceId, &pPnpDevice);
    EXIT_ON_ERROR(hr)

    // Activate an IKsControl interface on the adapter device object.
    hr = pPnpDevice->Activate(IID_IKsControl, CLSCTX_ALL, NULL, (void**)&pKsControl);
    EXIT_ON_ERROR(hr)

    // Get the local ID of the subunit (contains the KS node ID).
    UINT localId = 0;
    hr = pPart->GetLocalId(&localId);
    EXIT_ON_ERROR(hr)

    KSNODEPROPERTY_AUDIO_CHANNEL ksprop;
    ZeroMemory(&ksprop, sizeof(ksprop));
    ksprop.NodeProperty.Property.Set = KSPROPSETID_Audio;
    ksprop.NodeProperty.Property.Id = KSPROPERTY_AUDIO_BASS_BOOST;
    ksprop.NodeProperty.Property.Flags = KSPROPERTY_TYPE_GET | KSPROPERTY_TYPE_TOPOLOGY;
    ksprop.NodeProperty.NodeId = localId & PARTID_MASK;
    ksprop.Channel = 0;

    // Send the property request.to the device driver.
    BOOL bValue = FALSE;
    ULONG valueSize;
    hr = pKsControl->KsProperty(
                         &ksprop.NodeProperty.Property, sizeof(ksprop),
                         &bValue, sizeof(bValue), &valueSize);
    EXIT_ON_ERROR(hr)

    *pbValue = bValue;

Exit:
    SAFE_RELEASE(pTopology)
    SAFE_RELEASE(pPnpDevice)
    SAFE_RELEASE(pKsControl)
    CoTaskMemFree(pwszDeviceId);
    return hr;
}

```



<span data-ttu-id="5078e-168">В предыдущем примере кода функция Жетбассбуст принимает следующие три параметра:</span><span class="sxs-lookup"><span data-stu-id="5078e-168">In the preceding code example, the GetBassBoost function takes the following three parameters:</span></span>

-   <span data-ttu-id="5078e-169">`pEnumerator` Указывает на интерфейс [**иммдевицеенумератор**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdeviceenumerator) перечислителя конечной точки аудио.</span><span class="sxs-lookup"><span data-stu-id="5078e-169">`pEnumerator` points to the [**IMMDeviceEnumerator**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdeviceenumerator) interface of an audio endpoint enumerator.</span></span>
-   <span data-ttu-id="5078e-170">`pPart` Указывает на интерфейс [**ипарт**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) подразделении с подтипом \_ тонового кснодетипе.</span><span class="sxs-lookup"><span data-stu-id="5078e-170">`pPart` points to the [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) interface of a subunit that has a subtype of KSNODETYPE\_TONE.</span></span>
-   <span data-ttu-id="5078e-171">`pbValue` Указывает на переменную **bool** , в которую функция записывает значение свойства.</span><span class="sxs-lookup"><span data-stu-id="5078e-171">`pbValue` points to a **BOOL** variable into which the function writes the property value.</span></span>

<span data-ttu-id="5078e-172">Программа вызывает Жетбассбуст только после вызова [**ипарт:: жетсубтипе**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) и определяет, что подединица подразделений кснодетипе \_ .</span><span class="sxs-lookup"><span data-stu-id="5078e-172">A program calls GetBassBoost only after it calls [**IPart::GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) and determines that the subtype of the subunit is KSNODETYPE\_TONE.</span></span> <span data-ttu-id="5078e-173">Значение свойства равно **true** , если включено усиление басов.</span><span class="sxs-lookup"><span data-stu-id="5078e-173">The property value is **TRUE** if bass boost is enabled.</span></span> <span data-ttu-id="5078e-174">**Значение false** , если усиление басов отключено.</span><span class="sxs-lookup"><span data-stu-id="5078e-174">It is **FALSE** if bass boost is disabled.</span></span>

<span data-ttu-id="5078e-175">В начале функции Жетбассбуст вызов метода [**ипарт:: жеттопологйобжект**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-gettopologyobject) получает интерфейс [**идевицетопологи**](/windows/desktop/api/Devicetopology/nn-devicetopology-idevicetopology) устройства адаптера, который содержит \_ подединицу тонового блока.</span><span class="sxs-lookup"><span data-stu-id="5078e-175">At the beginning of the GetBassBoost function, the call to the [**IPart::GetTopologyObject**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-gettopologyobject) method obtains the [**IDeviceTopology**](/windows/desktop/api/Devicetopology/nn-devicetopology-idevicetopology) interface of the adapter device that contains the KSNODETYPE\_TONE subunit.</span></span> <span data-ttu-id="5078e-176">Вызов метода [**идевицетопологи:: GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) ИЗВЛЕКАЕТ строку идентификатора устройства, идентифицирующее устройство адаптера.</span><span class="sxs-lookup"><span data-stu-id="5078e-176">The [**IDeviceTopology::GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) method call retrieves the device ID string that identifies the adapter device.</span></span> <span data-ttu-id="5078e-177">Вызов метода [**иммдевицеенумератор::**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) GetString принимает строку идентификатора устройства в качестве входного параметра и получает интерфейс [**иммдевице**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) устройства адаптера.</span><span class="sxs-lookup"><span data-stu-id="5078e-177">The [**IMMDeviceEnumerator::GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) method call takes the device ID string as an input parameter, and retrieves the [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) interface of the adapter device.</span></span> <span data-ttu-id="5078e-178">Затем вызов метода [**иммдевице:: Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) получает интерфейс [**иксконтрол**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) подразделений.</span><span class="sxs-lookup"><span data-stu-id="5078e-178">Next, the [**IMMDevice::Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) method call retrieves the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface of the subunit.</span></span> <span data-ttu-id="5078e-179">Дополнительные сведения об интерфейсе **иксконтрол** см. в документации по Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="5078e-179">For more information about the **IKsControl** interface, see the Windows DDK documentation.</span></span>

<span data-ttu-id="5078e-180">Затем в предыдущем примере кода создается структура [**кснодепроперти \_ Audio \_ Channel**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) , описывающая свойство басов-Boost.</span><span class="sxs-lookup"><span data-stu-id="5078e-180">Next, the preceding code example creates a [**KSNODEPROPERTY\_AUDIO\_CHANNEL**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) structure that describes the bass-boost property.</span></span> <span data-ttu-id="5078e-181">Пример кода передает указатель на структуру методу [**иксконтрол:: кспроперти**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) , который использует сведения в структуре для получения значения свойства.</span><span class="sxs-lookup"><span data-stu-id="5078e-181">The code example passes a pointer to the structure to the [**IKsControl::KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) method, which uses the information in the structure to retrieve the property value.</span></span> <span data-ttu-id="5078e-182">Дополнительные сведения о структуре **кснодепроперти \_ Audio \_ Channel** и методе **иксконтрол:: кспроперти** см. в документации по Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="5078e-182">For more information about the **KSNODEPROPERTY\_AUDIO\_CHANNEL** structure and the **IKsControl::KsProperty** method, see the Windows DDK documentation.</span></span>

<span data-ttu-id="5078e-183">Звуковые аппаратные устройства обычно присваивают каждому каналу звукового потока отдельное состояние басов-Boost.</span><span class="sxs-lookup"><span data-stu-id="5078e-183">Audio hardware typically assigns a separate bass-boost state to each channel in an audio stream.</span></span> <span data-ttu-id="5078e-184">В принципе, усиление басов можно включить для некоторых каналов и отключить для других.</span><span class="sxs-lookup"><span data-stu-id="5078e-184">In principle, bass boost can be enabled for some channels and disabled for others.</span></span> <span data-ttu-id="5078e-185">Структура [**\_ звукового \_ канала Кснодепроперти**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) содержит элемент **Channel** , указывающий номер канала.</span><span class="sxs-lookup"><span data-stu-id="5078e-185">The [**KSNODEPROPERTY\_AUDIO\_CHANNEL**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) structure contains a **Channel** member that specifies the channel number.</span></span> <span data-ttu-id="5078e-186">Если поток содержит *N* каналов, каналы нумеруются от 0 до *N*— 1.</span><span class="sxs-lookup"><span data-stu-id="5078e-186">If a stream contains *N* channels, the channels are numbered from 0 to *N*— 1.</span></span> <span data-ttu-id="5078e-187">Предыдущий пример кода получает значение свойства басов-Boost только для канала 0.</span><span class="sxs-lookup"><span data-stu-id="5078e-187">The preceding code example gets the value of the bass-boost property for channel 0 only.</span></span> <span data-ttu-id="5078e-188">Эта реализация неявно предполагает, что свойства басов-Boost для всех каналов устанавливаются единообразно в одно и то же состояние.</span><span class="sxs-lookup"><span data-stu-id="5078e-188">This implementation implicitly assumes that the bass-boost properties for all of the channels are set uniformly to the same state.</span></span> <span data-ttu-id="5078e-189">Поэтому, чтобы определить значение свойства для потока, достаточно прочесть свойство басов-Boost для канала 0.</span><span class="sxs-lookup"><span data-stu-id="5078e-189">Thus, reading the bass-boost property for channel 0 is sufficient to determine the bass-boost property value for the stream.</span></span> <span data-ttu-id="5078e-190">Чтобы обеспечить соответствие этому предположении, соответствующая функция, устанавливающая свойство басов-Boost, задаст всем каналам одно значение свойства басов-Boost.</span><span class="sxs-lookup"><span data-stu-id="5078e-190">To be consistent with this assumption, a corresponding function to set the bass-boost property would set all channels to the same bass-boost property value.</span></span> <span data-ttu-id="5078e-191">Это разумные соглашения, но не все поставщики оборудования должны следовать им.</span><span class="sxs-lookup"><span data-stu-id="5078e-191">These are reasonable conventions, but not all hardware vendors necessarily follow them.</span></span> <span data-ttu-id="5078e-192">Например, поставщик может предоставить приложение панели управления, которое обеспечивает увеличение басов только для каналов, которые могут использовать динамики с полным диапазоном.</span><span class="sxs-lookup"><span data-stu-id="5078e-192">For example, a vendor might supply a control-panel application that enables bass boost only for channels that drive full-range speakers.</span></span> <span data-ttu-id="5078e-193">(Динамик с полным диапазоном может воспроизводить звуки в пределах от басов до высоких частот.) В этом случае значение свойства, полученное в предыдущем примере кода, может не точно представлять состояние потока с частотой басов.</span><span class="sxs-lookup"><span data-stu-id="5078e-193">(A full-range speaker is capable of playing sounds over the full range from bass to treble.) In that case, the property value retrieved by the preceding code example might not accurately represent the bass-boost state of the stream.</span></span>

<span data-ttu-id="5078e-194">Клиенты, использующие интерфейсы управления, перечисленные в предыдущей таблице, могут вызывать метод [**ипарт:: регистерконтролчанжекаллбакк**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-registercontrolchangecallback) для регистрации уведомлений при изменении значения параметра элемента управления.</span><span class="sxs-lookup"><span data-stu-id="5078e-194">Clients that use the control interfaces listed in the preceding table can call the [**IPart::RegisterControlChangeCallback**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-registercontrolchangecallback) method to register for notifications when the value of a control parameter changes.</span></span> <span data-ttu-id="5078e-195">Обратите внимание, что интерфейс [**иксконтрол**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) не предоставляет клиентам аналогичные средства для регистрации уведомлений при изменении значения свойства.</span><span class="sxs-lookup"><span data-stu-id="5078e-195">Note that the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface does not provide a similar means for clients to register for notifications when a property value changes.</span></span> <span data-ttu-id="5078e-196">Если **иксконтрол** поддерживал уведомления об изменениях свойств, оно может сообщить приложению, когда другое приложение изменило значение свойства.</span><span class="sxs-lookup"><span data-stu-id="5078e-196">If **IKsControl** did support property-change notifications, it could inform an application when another application changed a property value.</span></span> <span data-ttu-id="5078e-197">Однако в отличие от наиболее часто используемых элементов управления, которые отслеживаются через [**ипарт**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) уведомления, свойства, управляемые **иксконтрол** , предназначены главным образом для использования поставщиками оборудования, и эти свойства, скорее всего, будут изменены только приложениями панели управления, написанными поставщиками.</span><span class="sxs-lookup"><span data-stu-id="5078e-197">However, in contrast to the more commonly used controls that are monitored through [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) notifications, the properties managed by **IKsControl** are intended primarily for use by hardware vendors, and those properties are likely to be changed only by control-panel applications written by the vendors.</span></span> <span data-ttu-id="5078e-198">Если приложение должно обнаруживать изменения свойств, внесенные другим приложением, оно может обнаружить изменения, периодически опрашивая значение свойства через **иксконтрол**.</span><span class="sxs-lookup"><span data-stu-id="5078e-198">If an application must detect property changes made by another application, it can detect the changes by periodically polling the property value through **IKsControl**.</span></span>

## <a name="related-topics"></a><span data-ttu-id="5078e-199">См. также</span><span class="sxs-lookup"><span data-stu-id="5078e-199">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="5078e-200">Руководство по программированию</span><span class="sxs-lookup"><span data-stu-id="5078e-200">Programming Guide</span></span>](programming-guide.md)
</dt> </dl>

 

 
