---
title: Перенос из Direct3D 11 в Direct3D 12
description: В этом разделе приводятся некоторые рекомендации по переносу из пользовательского графического подсистемы Direct3D 11 в Direct3D 12.
ms.assetid: 9EB4AC6B-AFDD-4673-8EB3-54272C151784
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 14b5bc6784d6f96c3c1599a601a57bf68b0d612d
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104549014"
---
# <a name="porting-from-direct3d-11-to-direct3d-12"></a><span data-ttu-id="329b5-103">Перенос из Direct3D 11 в Direct3D 12</span><span class="sxs-lookup"><span data-stu-id="329b5-103">Porting from Direct3D 11 to Direct3D 12</span></span>

<span data-ttu-id="329b5-104">В этом разделе приводятся некоторые рекомендации по переносу из пользовательского графического подсистемы Direct3D 11 в Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="329b5-104">This section provides some guidance on porting from a custom Direct3D 11 graphics engine to Direct3D 12.</span></span>

-   [<span data-ttu-id="329b5-105">Создание устройства</span><span class="sxs-lookup"><span data-stu-id="329b5-105">Device creation</span></span>](#device-creation)
-   [<span data-ttu-id="329b5-106">Зафиксированные ресурсы</span><span class="sxs-lookup"><span data-stu-id="329b5-106">Committed resources</span></span>](#committed-resources)
-   [<span data-ttu-id="329b5-107">Зарезервированные ресурсы</span><span class="sxs-lookup"><span data-stu-id="329b5-107">Reserved resources</span></span>](#reserved-resources)
-   [<span data-ttu-id="329b5-108">Идет отправка данных</span><span class="sxs-lookup"><span data-stu-id="329b5-108">Uploading data</span></span>](#uploading-data)
-   [<span data-ttu-id="329b5-109">Шейдеры и объекты шейдеров</span><span class="sxs-lookup"><span data-stu-id="329b5-109">Shaders and shader objects</span></span>](#shaders-and-shader-objects)
-   [<span data-ttu-id="329b5-110">Отправка работы в GPU</span><span class="sxs-lookup"><span data-stu-id="329b5-110">Submitting work to the GPU</span></span>](#submitting-work-to-the-gpu)
-   [<span data-ttu-id="329b5-111">Синхронизация ЦП и GPU</span><span class="sxs-lookup"><span data-stu-id="329b5-111">CPU/GPU Synchronization</span></span>](#cpugpu-synchronization)
-   [<span data-ttu-id="329b5-112">Привязка ресурсов</span><span class="sxs-lookup"><span data-stu-id="329b5-112">Resource Binding</span></span>](#resource-binding)
-   [<span data-ttu-id="329b5-113">Состояние ресурса</span><span class="sxs-lookup"><span data-stu-id="329b5-113">Resource state</span></span>](#resource-state)
-   [<span data-ttu-id="329b5-114">Цепочек переключений</span><span class="sxs-lookup"><span data-stu-id="329b5-114">Swapchains</span></span>](#swapchains)
-   [<span data-ttu-id="329b5-115">Фиксированная визуализация функции</span><span class="sxs-lookup"><span data-stu-id="329b5-115">Fixed function rendering</span></span>](#fixed-function-rendering)
-   [<span data-ttu-id="329b5-116">Вероятность и завершение</span><span class="sxs-lookup"><span data-stu-id="329b5-116">Odds and ends</span></span>](#odds-and-ends)
-   [<span data-ttu-id="329b5-117">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="329b5-117">Related topics</span></span>](#related-topics)

## <a name="device-creation"></a><span data-ttu-id="329b5-118">Создание устройства</span><span class="sxs-lookup"><span data-stu-id="329b5-118">Device creation</span></span>

<span data-ttu-id="329b5-119">Как Direct3D 11, так и Direct3D 12 используют шаблон создания устройств аналогичный.</span><span class="sxs-lookup"><span data-stu-id="329b5-119">Both Direct3D 11 and Direct3D 12 share a simliar device creation pattern.</span></span> <span data-ttu-id="329b5-120">Существующие драйверы Direct3D 12 **D3D_FEATURE_LEVEL_11_0** и более поздних версий, поэтому вы можете игнорировать старые уровни функций и связанные лмитатионс.</span><span class="sxs-lookup"><span data-stu-id="329b5-120">Existing Direct3D 12 drivers are all **D3D_FEATURE_LEVEL_11_0** or better, so you can ignore the older feature levels and associated lmitations.</span></span>

<span data-ttu-id="329b5-121">Также помните, что при использовании Direct3D 12 необходимо явно перечислить сведения об устройстве с помощью интерфейсов DXGI.</span><span class="sxs-lookup"><span data-stu-id="329b5-121">Also keep in mind that with Direct3D 12, you should explicitly enumerate device information using DXGI interfaces.</span></span> <span data-ttu-id="329b5-122">В Direct3D 11 вы можете *создать цепочку* на устройстве DXGI с устройства Direct3D, и это не поддерживается для Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="329b5-122">In Direct3D 11, you could *chain back* to the DXGI device from the Direct3D device, and this is not supported for Direct3D 12.</span></span>

<span data-ttu-id="329b5-123">Создание программного устройства деформации на Direct3D 12 выполняется путем предоставления явного адаптера, полученного из **IDXGIFcatory4:: енумварпадаптер**.</span><span class="sxs-lookup"><span data-stu-id="329b5-123">Creating a WARP software device on Direct3D 12 is done by providing an explicit adapter obtained from **IDXGIFcatory4::EnumWarpAdapter**.</span></span> <span data-ttu-id="329b5-124">Устройство деформации для Direct3D 12 доступно только в системах с включенным дополнительным компонентом " **графические средства** ".</span><span class="sxs-lookup"><span data-stu-id="329b5-124">The WARP device for Direct3D 12 is available only on systems with the **Graphics Tools** optional feature enabled.</span></span>

> [!NOTE]
> <span data-ttu-id="329b5-125">Эквивалента **D3D11CreateDeviceAndSwapChain** не существует.</span><span class="sxs-lookup"><span data-stu-id="329b5-125">There is no equivalent to **D3D11CreateDeviceAndSwapChain**.</span></span> <span data-ttu-id="329b5-126">Даже при использовании Direct3D 11 мы не рекомендуем использовать эту функцию, так как зачастую лучше создать устройство и имеющуюся цепочку буферов отдельные шаги.</span><span class="sxs-lookup"><span data-stu-id="329b5-126">Even with Direct3D 11, we discourage the use of this function as it's often better to create the device and swapchain in distinct steps.</span></span>

## <a name="committed-resources"></a><span data-ttu-id="329b5-127">Зафиксированные ресурсы</span><span class="sxs-lookup"><span data-stu-id="329b5-127">Committed resources</span></span>

<span data-ttu-id="329b5-128">Объекты, созданные со следующими интерфейсами в Direct3D 11, переводят на то, что называется "выделенными ресурсами" в Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="329b5-128">Objects created with the following interfaces in Direct3D 11, translate to what are called "committed resources" in Direct3D 12.</span></span> <span data-ttu-id="329b5-129">Зафиксированный ресурс — это ресурс, с которым связаны как виртуальное адресное пространство, так и физические страницы.</span><span class="sxs-lookup"><span data-stu-id="329b5-129">A committed resource is a resource which has both virtual address space and physical pages associated with it.</span></span> <span data-ttu-id="329b5-130">Это концепция модели памяти Microsoft Windows Device Driver 2 (WDD2), на которой основан Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="329b5-130">This is a concept of the Microsoft Windows Device Driver 2 (WDD2) Memory Model, on which Direct3D 12 is based.</span></span>

<span data-ttu-id="329b5-131">Ресурсы Direct3D 11:</span><span class="sxs-lookup"><span data-stu-id="329b5-131">Direct3D 11 resources:</span></span>

-   [<span data-ttu-id="329b5-132">**ID3D11Resource**</span><span class="sxs-lookup"><span data-stu-id="329b5-132">**ID3D11Resource**</span></span>](/windows/win32/api/d3d11/nn-d3d11-id3d11resource)
-   <span data-ttu-id="329b5-133">[**ID3D11Buffer**](/windows/win32/api/d3d11/nn-d3d11-id3d11buffer) и [ **ID3D11Device:: CreateBuffer**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createbuffer)</span><span class="sxs-lookup"><span data-stu-id="329b5-133">[**ID3D11Buffer**](/windows/win32/api/d3d11/nn-d3d11-id3d11buffer) and [**ID3D11Device::CreateBuffer**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createbuffer)</span></span>
-   <span data-ttu-id="329b5-134">[**ID3D11Texture1D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture1d) и [ **ID3D11Device: CreateTexture1D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture1d)</span><span class="sxs-lookup"><span data-stu-id="329b5-134">[**ID3D11Texture1D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture1d) and [**ID3D11Device:CreateTexture1D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture1d)</span></span>
-   <span data-ttu-id="329b5-135">[**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d) и [ **ID3D11Device:: CreateTexture2D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture2d)</span><span class="sxs-lookup"><span data-stu-id="329b5-135">[**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d) and [**ID3D11Device::CreateTexture2D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture2d)</span></span>
-   <span data-ttu-id="329b5-136">[**ID3D11Texture3D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture3d) и [ **ID3D11Device:: CreateTexture3D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture3d)</span><span class="sxs-lookup"><span data-stu-id="329b5-136">[**ID3D11Texture3D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture3d) and [**ID3D11Device::CreateTexture3D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture3d)</span></span>

<span data-ttu-id="329b5-137">В Direct3D 12 все они представлены [**ID3D12Resource**](/windows/win32/api/d3d12/nn-d3d12-id3d12resource) и [**ID3D12Device:: креатекоммиттедресаурце**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource).</span><span class="sxs-lookup"><span data-stu-id="329b5-137">In Direct3D 12 these are all represented by [**ID3D12Resource**](/windows/win32/api/d3d12/nn-d3d12-id3d12resource) and [**ID3D12Device::CreateCommittedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource).</span></span>

## <a name="reserved-resources"></a><span data-ttu-id="329b5-138">Зарезервированные ресурсы</span><span class="sxs-lookup"><span data-stu-id="329b5-138">Reserved resources</span></span>

<span data-ttu-id="329b5-139">Зарезервированные ресурсы — это ресурсы, где выделено только виртуальное адресное пространство, физическая память не выделяется до тех пор, пока не будет вызван вызов [**ID3D12Device:: CreateHeap**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap).</span><span class="sxs-lookup"><span data-stu-id="329b5-139">Reserved resources are resources where only virtual address space has been allocated, physical memory is not allocated until there is a call to [**ID3D12Device::CreateHeap**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap).</span></span> <span data-ttu-id="329b5-140">По сути, это та же концепция, что и мозаичные ресурсы в Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="329b5-140">This is essentially the same concept as tiled resources in Direct3D 11.</span></span>

<span data-ttu-id="329b5-141">Флаги ([**D3D11 \_ ресурса \_ \_**](/windows/win32/api/d3d11/ne-d3d11-d3d11_resource_misc_flag)), используемые в Direct3D 11 для настройки мозаичных ресурсов, а затем сопоставляют их с физической памятью.</span><span class="sxs-lookup"><span data-stu-id="329b5-141">The flags ([**D3D11\_RESOURCE\_MISC\_FLAG**](/windows/win32/api/d3d11/ne-d3d11-d3d11_resource_misc_flag)) used in Direct3D 11 to set up tiled resources, then map them to physical memory.</span></span>

-   <span data-ttu-id="329b5-142">D3D11 \_ ресурсов \_ для \_ перемозаики</span><span class="sxs-lookup"><span data-stu-id="329b5-142">D3D11\_RESOURCE\_MISC\_TILED</span></span>
-   <span data-ttu-id="329b5-143">\_ \_ \_ Пул ПЛИТок ресурсов \_ D3D11</span><span class="sxs-lookup"><span data-stu-id="329b5-143">D3D11\_RESOURCE\_MISC\_TILE\_POOL</span></span>

## <a name="uploading-data"></a><span data-ttu-id="329b5-144">Идет отправка данных</span><span class="sxs-lookup"><span data-stu-id="329b5-144">Uploading data</span></span>

<span data-ttu-id="329b5-145">В Direct3D 11 имеется одна временная шкала (вызовы, следующие за последовательностью, например данные, инициализированные [**\_ \_ данными подресурсов D3D11**](/windows/win32/api/d3d11/ns-d3d11-d3d11_subresource_data), выполняется вызов [**ссылку ID3D11DeviceContext:: упдатесубресаурце**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-updatesubresource), а затем вызывается [**ссылку ID3D11DeviceContext:: Map**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-map)).</span><span class="sxs-lookup"><span data-stu-id="329b5-145">In Direct3D 11 there is the appearance of a single timeline (calls following a sequence, such as data initialized with [**D3D11\_SUBRESOURCE\_DATA**](/windows/win32/api/d3d11/ns-d3d11-d3d11_subresource_data), then a call is made to [**ID3D11DeviceContext::UpdateSubresource**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-updatesubresource), and then a call to [**ID3D11DeviceContext::Map**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-map)).</span></span> <span data-ttu-id="329b5-146">Число копий, созданных для данных, не очевидно для разработчика Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="329b5-146">The number of copies created of the data is not obvious to a Direct3D 11 developer.</span></span>

<span data-ttu-id="329b5-147">В Direct3D 12 есть две временные шкалы: временная шкала GPU (настраивается вызовами [**копитекстуререгион**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-copytextureregion)и [**копибуфферрегион**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-copybufferregion) из памяти сопоставляемые) и временная шкала ЦП (определяется вызовами [**Map**](/windows/win32/api/d3d12/nf-d3d12-id3d12resource-map)).</span><span class="sxs-lookup"><span data-stu-id="329b5-147">In Direct3D 12 there are two timelines, the GPU timeline (set up by calls to [**CopyTextureRegion**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-copytextureregion), and [**CopyBufferRegion**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-copybufferregion) from mappable memory) and the CPU timeline (determined by calls to [**Map**](/windows/win32/api/d3d12/nf-d3d12-id3d12resource-map)).</span></span> <span data-ttu-id="329b5-148">Вспомогательные функции предоставляются (в файле d3dx12. h) с именем [**Updatesubresources**](updatesubresources1.md) , которые используют общую временную шкалу.</span><span class="sxs-lookup"><span data-stu-id="329b5-148">Helper functions are provided (in the d3dx12.h file) called [**Updatesubresources**](updatesubresources1.md) that use a shared timeline.</span></span> <span data-ttu-id="329b5-149">Существует несколько разновидностей этой вспомогательной функции, которая использует [**ID3D12Device:: GetCopyableFootprints**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcopyablefootprints), другой использует механизм выделения кучи и другой, использующий механизм выделения стека.</span><span class="sxs-lookup"><span data-stu-id="329b5-149">There are several variations of this helper function, one that uses [**ID3D12Device::GetCopyableFootprints**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcopyablefootprints), another that uses a heap-allocating mechanism, and another that uses a stack-allocating mechanism.</span></span> <span data-ttu-id="329b5-150">Эти вспомогательные функции копируют ресурсы в GPU и ЦП через промежуточную промежуточную область памяти.</span><span class="sxs-lookup"><span data-stu-id="329b5-150">These helper functions copy resources to both the GPU and CPU, via an intermediate staging area of memory.</span></span>

<span data-ttu-id="329b5-151">Как правило, GPU и ЦП имеют собственную копию ресурса, привязанную к собственной временной шкале.</span><span class="sxs-lookup"><span data-stu-id="329b5-151">Typically the GPU and CPU each have their own copy of a resource tied to their own timeline.</span></span> <span data-ttu-id="329b5-152">Подход общей временной шкалы аналогично поддерживает две копии.</span><span class="sxs-lookup"><span data-stu-id="329b5-152">The shared timeline approach similarly maintains two copies.</span></span>

## <a name="shaders-and-shader-objects"></a><span data-ttu-id="329b5-153">Шейдеры и объекты шейдеров</span><span class="sxs-lookup"><span data-stu-id="329b5-153">Shaders and shader objects</span></span>

<span data-ttu-id="329b5-154">В Direct3D 11 существует множество способов создания шейдеров и объектов состояния, а также установки состояния этих объектов с помощью методов создания [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) и методов [**ссылку ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) Set.</span><span class="sxs-lookup"><span data-stu-id="329b5-154">In Direct3D 11 there is a lot of creation of shader and state objects, and setting the state of those objects, using the [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) creation methods and the [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) set methods.</span></span> <span data-ttu-id="329b5-155">Обычно для этих методов выполняется большое количество вызовов, которые затем объединяются драйвером для установки правильного состояния конвейера.</span><span class="sxs-lookup"><span data-stu-id="329b5-155">Typically a large number of calls are made to these methods, which are then combined at draw time by the driver to set the correct pipeline state.</span></span>

<span data-ttu-id="329b5-156">В Direct3D 12 этот параметр состояния конвейера был объединен в один объект ([**креатекомпутепипелинестате**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcomputepipelinestate) для ядра вычислений и [**креатеграфикспипелинестате**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-creategraphicspipelinestate) для подсистемы графики), который затем прикрепляется к списку команд перед вызовом Draw с вызовом [**сетпипелинестате**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setpipelinestate).</span><span class="sxs-lookup"><span data-stu-id="329b5-156">In Direct3D 12 this setting of pipeline state has been combined into a single object ([**CreateComputePipelineState**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcomputepipelinestate) for a compute engine, and [**CreateGraphicsPipelineState**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-creategraphicspipelinestate) for a graphics engine), which is then attached to a command list before the draw call with a call to [**SetPipelineState**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setpipelinestate).</span></span>

<span data-ttu-id="329b5-157">Эти вызовы заменяют все отдельные вызовы для задания шейдеров, макета ввода, состояния смешения, состояния средства прорисовки, состояния трафарета глубины и т. д. в Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="329b5-157">These calls replace all the individual calls to set shaders, input layout, blend state, rasterizer state, depth stencil state, and so on, in Direct3D 11</span></span>

- <span data-ttu-id="329b5-158">Методы устройства 11: ``CreateInputLayout`` , ``CreateXShader`` , ``CreateDepthStencilState`` , андд ``CreateRasterizerState`` .</span><span class="sxs-lookup"><span data-stu-id="329b5-158">Device 11 methods: ``CreateInputLayout``, ``CreateXShader``, ``CreateDepthStencilState``, andD ``CreateRasterizerState``.</span></span>
- <span data-ttu-id="329b5-159">Методы контекста устройства 11:  ``IASetInputLayout`` , ``xxSetShader`` , ``OMSetBlendState`` , ``OMSetDepthStencilState`` и ``RSSetState`` .</span><span class="sxs-lookup"><span data-stu-id="329b5-159">Device Context 11 methods:  ``IASetInputLayout``, ``xxSetShader``, ``OMSetBlendState``, ``OMSetDepthStencilState``, and ``RSSetState``.</span></span>

<span data-ttu-id="329b5-160">Хотя Direct3D 12 может поддерживать старые скомпилированные BLOB-объекты шейдера, шейдеры следует создавать с помощью модели шейдеров 5,1 с интерфейсами API FXC/D3DCompile или с использованием модели шейдеров 6 с помощью компилятора ДКСИЛ ДКСК.</span><span class="sxs-lookup"><span data-stu-id="329b5-160">While Direct3D 12 can support older compiled shader blobs, shaders should be built using either Shader Model 5.1 with the FXC/D3DCompile APIs, or using Shader Model 6 using the DXIL DXC compiler.</span></span> <span data-ttu-id="329b5-161">Необходимо проверить поддержку Shader Model 6 с помощью [**чеккфеатуресуппорт**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-checkfeaturesupport) и **D3D12_FEATURE_SHADER_MODEL**.</span><span class="sxs-lookup"><span data-stu-id="329b5-161">You should validate Shader Model 6 support with [**CheckFeatureSupport**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-checkfeaturesupport) and **D3D12_FEATURE_SHADER_MODEL**.</span></span>

## <a name="submitting-work-to-the-gpu"></a><span data-ttu-id="329b5-162">Отправка работы в GPU</span><span class="sxs-lookup"><span data-stu-id="329b5-162">Submitting work to the GPU</span></span>

<span data-ttu-id="329b5-163">в Direct3D 11 Существует небольшой контроль над тем, как отправляются данные о работе, он в основном обрабатывается драйвером, хотя некоторые элементы управления поддерживаются вызовами [**ссылку ID3D11DeviceContext:: Flush**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-flush) и [**IDXGISwapChain1::P resent1**](/windows/win32/api/dxgi1_2/nf-dxgi1_2-idxgiswapchain1-present1) .</span><span class="sxs-lookup"><span data-stu-id="329b5-163">in Direct3D 11 there is little control over actually how work is submitted, it is largely handled by the driver, though some control is enabled through the [**ID3D11DeviceContext::Flush**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-flush) and [**IDXGISwapChain1::Present1**](/windows/win32/api/dxgi1_2/nf-dxgi1_2-idxgiswapchain1-present1) calls.</span></span>

<span data-ttu-id="329b5-164">В случае передачи работы Direct3D 12 это приложение очень явно и управляется приложением.</span><span class="sxs-lookup"><span data-stu-id="329b5-164">In Direct3D 12 work submission is very explicit and controlled by the app.</span></span> <span data-ttu-id="329b5-165">Основной конструкцией для отправки работы является [**ID3D12GraphicsCommandList**](/windows/win32/api/d3d12/nn-d3d12-id3d12graphicscommandlist), который используется для записи всех команд приложений (и весьма похож на концепцию отложенного контекста ID3D11).</span><span class="sxs-lookup"><span data-stu-id="329b5-165">The primary construct for submitting work is the [**ID3D12GraphicsCommandList**](/windows/win32/api/d3d12/nn-d3d12-id3d12graphicscommandlist), which is used to record all the apps commands (and is quite similar in concept to the ID3D11 deferred context).</span></span> <span data-ttu-id="329b5-166">Резервное хранилище для списка команд предоставляется [**ID3D12CommandAllocator**](/windows/win32/api/d3d12/nn-d3d12-id3d12commandallocator), что позволяет приложению управлять использованием памяти в списке команд, фактически предоставляя память, которую драйвер Direct3D 12 будет использовать для хранения списка команд.</span><span class="sxs-lookup"><span data-stu-id="329b5-166">Backing store for a command list is provided by the [**ID3D12CommandAllocator**](/windows/win32/api/d3d12/nn-d3d12-id3d12commandallocator), which enables the app to manage the memory utilization of the command list by actually exposing the memory that the Direct3D 12 driver is going to use to store the command list.</span></span>

<span data-ttu-id="329b5-167">Наконец, [**ID3D12CommandQueue**](/windows/win32/api/d3d12/nn-d3d12-id3d12commandqueue) является очередью первых поправок, которая сохраняет правильный порядок списков команд для отправки в GPU.</span><span class="sxs-lookup"><span data-stu-id="329b5-167">Finally the [**ID3D12CommandQueue**](/windows/win32/api/d3d12/nn-d3d12-id3d12commandqueue) is a first-in first-out queue, that stores the correct order of the command lists for submission to the GPU.</span></span> <span data-ttu-id="329b5-168">Следующий список команд из очереди будет отправлен драйвером только после того, как один из списков команд завершил выполнение на GPU.</span><span class="sxs-lookup"><span data-stu-id="329b5-168">Only when one command list has completed execution on the GPU, will the next command list from the queue be submitted by the driver.</span></span>

<span data-ttu-id="329b5-169">В Direct3D 11 нет явной концепции очереди команд.</span><span class="sxs-lookup"><span data-stu-id="329b5-169">In Direct3D 11 there is no explicit concept of a command queue.</span></span> <span data-ttu-id="329b5-170">В стандартной установке Direct3D 12 текущий список команд **D3D12_COMMAND_LIST_TYPE_DIRECT** для текущего кадра можно считать аналогом мгновенного контекста Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="329b5-170">In the common setup for Direct3D 12, the currently open **D3D12_COMMAND_LIST_TYPE_DIRECT** command list for the current frame can be considered analogous to the Direct3D 11 immediate context.</span></span> <span data-ttu-id="329b5-171">Это предоставляет многие из тех же функций.</span><span class="sxs-lookup"><span data-stu-id="329b5-171">This provides many of the same functions.</span></span>


| <span data-ttu-id="329b5-172">D3D11DeviceContext</span><span class="sxs-lookup"><span data-stu-id="329b5-172">D3D11DeviceContext</span></span>                  | <span data-ttu-id="329b5-173">Список ID3D12GraphicsCommand</span><span class="sxs-lookup"><span data-stu-id="329b5-173">ID3D12GraphicsCommand List</span></span>     |
|-------------------------------------|--------------------------------|
| <span data-ttu-id="329b5-174">ClearDepthStencilView</span><span class="sxs-lookup"><span data-stu-id="329b5-174">ClearDepthStencilView</span></span>               | <span data-ttu-id="329b5-175">ClearDepthStencilView</span><span class="sxs-lookup"><span data-stu-id="329b5-175">ClearDepthStencilView</span></span>          |
| <span data-ttu-id="329b5-176">ClearRenderTargetView</span><span class="sxs-lookup"><span data-stu-id="329b5-176">ClearRenderTargetView</span></span>               | <span data-ttu-id="329b5-177">ClearRenderTargetView</span><span class="sxs-lookup"><span data-stu-id="329b5-177">ClearRenderTargetView</span></span>          |
| <span data-ttu-id="329b5-178">Клеарунордередакцесс \*</span><span class="sxs-lookup"><span data-stu-id="329b5-178">ClearUnorderedAccess\*</span></span>               | <span data-ttu-id="329b5-179">Клеарунордередакцесс \*</span><span class="sxs-lookup"><span data-stu-id="329b5-179">ClearUnorderedAccess\*</span></span>          |
| <span data-ttu-id="329b5-180">Draw, Дравинстанцед</span><span class="sxs-lookup"><span data-stu-id="329b5-180">Draw, DrawInstanced</span></span>                 | <span data-ttu-id="329b5-181">дравинстанцед</span><span class="sxs-lookup"><span data-stu-id="329b5-181">DrawInstanced</span></span>                  |
| <span data-ttu-id="329b5-182">Дравиндексед, Дравиндексединстанцед</span><span class="sxs-lookup"><span data-stu-id="329b5-182">DrawIndexed, DrawIndexedInstanced</span></span>   | <span data-ttu-id="329b5-183">дравиндексединстанцед</span><span class="sxs-lookup"><span data-stu-id="329b5-183">DrawIndexedInstanced</span></span>           |
| <span data-ttu-id="329b5-184">Dispatch</span><span class="sxs-lookup"><span data-stu-id="329b5-184">Dispatch</span></span>                            | <span data-ttu-id="329b5-185">Dispatch</span><span class="sxs-lookup"><span data-stu-id="329b5-185">Dispatch</span></span>                       |
| <span data-ttu-id="329b5-186">Иасетинпутлайаут, Кскссетшадер и т. д.</span><span class="sxs-lookup"><span data-stu-id="329b5-186">IASetInputLayout, xxSetShader, etc.</span></span> | <span data-ttu-id="329b5-187">сетпипелинестате</span><span class="sxs-lookup"><span data-stu-id="329b5-187">SetPipelineState</span></span>               |
| <span data-ttu-id="329b5-188">омсетблендстате</span><span class="sxs-lookup"><span data-stu-id="329b5-188">OMSetBlendState</span></span>                     | <span data-ttu-id="329b5-189">омсетблендфактор</span><span class="sxs-lookup"><span data-stu-id="329b5-189">OMSetBlendFactor</span></span>               |
| <span data-ttu-id="329b5-190">омсетдепсстенЦилстате</span><span class="sxs-lookup"><span data-stu-id="329b5-190">OMSetDepthStencilState</span></span>              | <span data-ttu-id="329b5-191">омсетстенЦилреф</span><span class="sxs-lookup"><span data-stu-id="329b5-191">OMSetStencilRef</span></span>                |
| <span data-ttu-id="329b5-192">омсетрендертаржетс</span><span class="sxs-lookup"><span data-stu-id="329b5-192">OMSetRenderTargets</span></span>                  | <span data-ttu-id="329b5-193">омсетрендертаржетс</span><span class="sxs-lookup"><span data-stu-id="329b5-193">OMSetRenderTargets</span></span>             |
| <span data-ttu-id="329b5-194">рссетвиевпортс</span><span class="sxs-lookup"><span data-stu-id="329b5-194">RSSetViewports</span></span>                      | <span data-ttu-id="329b5-195">рссетвиевпортс</span><span class="sxs-lookup"><span data-stu-id="329b5-195">RSSetViewports</span></span>                 |
| <span data-ttu-id="329b5-196">рссетсЦиссорректс</span><span class="sxs-lookup"><span data-stu-id="329b5-196">RSSetScissorRects</span></span>                   | <span data-ttu-id="329b5-197">рссетсЦиссорректс</span><span class="sxs-lookup"><span data-stu-id="329b5-197">RSSetScissorRects</span></span>              |
| <span data-ttu-id="329b5-198">иасетпримитиветопологи</span><span class="sxs-lookup"><span data-stu-id="329b5-198">IASetPrimitiveTopology</span></span>              | <span data-ttu-id="329b5-199">иасетпримитиветопологи</span><span class="sxs-lookup"><span data-stu-id="329b5-199">IASetPrimitiveTopology</span></span>         |
| <span data-ttu-id="329b5-200">иасетвертексбуфферс</span><span class="sxs-lookup"><span data-stu-id="329b5-200">IASetVertexBuffers</span></span>                  | <span data-ttu-id="329b5-201">иасетвертексбуфферс</span><span class="sxs-lookup"><span data-stu-id="329b5-201">IASetVertexBuffers</span></span>             |
| <span data-ttu-id="329b5-202">иасетиндексбуффер</span><span class="sxs-lookup"><span data-stu-id="329b5-202">IASetIndexBuffer</span></span>                    | <span data-ttu-id="329b5-203">иасетиндексбуффер</span><span class="sxs-lookup"><span data-stu-id="329b5-203">IASetIndexBuffer</span></span>               |
| <span data-ttu-id="329b5-204">ресолвесубресаурце</span><span class="sxs-lookup"><span data-stu-id="329b5-204">ResolveSubresource</span></span>                  | <span data-ttu-id="329b5-205">ресолвесубресаурце</span><span class="sxs-lookup"><span data-stu-id="329b5-205">ResolveSubresource</span></span>             |
| <span data-ttu-id="329b5-206">кописубресаурцерегион</span><span class="sxs-lookup"><span data-stu-id="329b5-206">CopySubresourceRegion</span></span>               | <span data-ttu-id="329b5-207">копибуфферрегион</span><span class="sxs-lookup"><span data-stu-id="329b5-207">CopyBufferRegion</span></span>               |
| <span data-ttu-id="329b5-208">упдатесубресаурце</span><span class="sxs-lookup"><span data-stu-id="329b5-208">UpdateSubresource</span></span>                   | <span data-ttu-id="329b5-209">копитекстуререгион</span><span class="sxs-lookup"><span data-stu-id="329b5-209">CopyTextureRegion</span></span>              |
| <span data-ttu-id="329b5-210">копиресаурце</span><span class="sxs-lookup"><span data-stu-id="329b5-210">CopyResource</span></span>                        | <span data-ttu-id="329b5-211">копиресаурце</span><span class="sxs-lookup"><span data-stu-id="329b5-211">CopyResource</span></span>                   |

> [!NOTE]
> <span data-ttu-id="329b5-212">Список команд, созданный с помощью **D3D12_COMMAND_LIST_TYPE_BUNDLE** , аналогичный в отложенный контекст.</span><span class="sxs-lookup"><span data-stu-id="329b5-212">A command list created with **D3D12_COMMAND_LIST_TYPE_BUNDLE** is simliar to a deferred context.</span></span> <span data-ttu-id="329b5-213">Direct3D 12 также поддерживает абиилти для доступа к некоторым функциям *непосредственных контекстов* , одновременно выполняющих отрисовку с помощью **D3D12_COMMAND_LIST_TYPE_COPY** и **D3D12_COMMAND_LIST_TYPE_COMPUTE** типов списков команд.</span><span class="sxs-lookup"><span data-stu-id="329b5-213">Direct3D 12 also supports the abiilty to access some features of an *immediate context* simultaneous to rendering via **D3D12_COMMAND_LIST_TYPE_COPY** and **D3D12_COMMAND_LIST_TYPE_COMPUTE** command list types.</span></span>

## <a name="cpugpu-synchronization"></a><span data-ttu-id="329b5-214">Синхронизация ЦП и GPU</span><span class="sxs-lookup"><span data-stu-id="329b5-214">CPU/GPU Synchronization</span></span>

<span data-ttu-id="329b5-215">В Direct3D 11 синхронизация ЦП и GPU выполнялась в значительной степени автоматически, и не требуется, чтобы приложение поддерживало состояние физической памяти.</span><span class="sxs-lookup"><span data-stu-id="329b5-215">In Direct3D 11 CPU/GPU synchronization was largely automatic, and there was no need for the app to maintain the status of physical memory.</span></span>

<span data-ttu-id="329b5-216">в Direct3D 12 приложение должно явным образом управлять двумя временными шкалами (ЦП и GPU).</span><span class="sxs-lookup"><span data-stu-id="329b5-216">in Direct3D 12 the app must manage the two timelines (CPU and GPU) explicitly.</span></span> <span data-ttu-id="329b5-217">Для этого необходимо, чтобы сведения поддерживались приложением, какие ресурсы требуются для GPU и сколько времени.</span><span class="sxs-lookup"><span data-stu-id="329b5-217">This requires that information needs to be maintained, by the app, on what resources are required by the GPU, and for how long.</span></span> <span data-ttu-id="329b5-218">Это также означает, что приложение несет ответственность за то, чтобы содержимое ресурсов (например, зафиксированные ресурсы, кучи, распределителя команд) не изменялось до тех пор, пока GPU не завершит их использование.</span><span class="sxs-lookup"><span data-stu-id="329b5-218">This also means that the app is responsible for ensuring the contents of resources (committed resources, heaps, command allocators, for example) do not change until the GPU has finished using them.</span></span>

<span data-ttu-id="329b5-219">Основным объектом для синхронизации временных шкал является объект [**ID3D12Fence**](/windows/win32/api/d3d12/nn-d3d12-id3d12fence) .</span><span class="sxs-lookup"><span data-stu-id="329b5-219">The main object for synchronizing the timelines is the [**ID3D12Fence**](/windows/win32/api/d3d12/nn-d3d12-id3d12fence) object.</span></span> <span data-ttu-id="329b5-220">Операции с ограждениями выполняются непросто, они позволяют GPU отображать сигнал о завершении задачи.</span><span class="sxs-lookup"><span data-stu-id="329b5-220">The operation of fences is failry simple, they enable the GPU to signal when it has completed a task.</span></span> <span data-ttu-id="329b5-221">Как GPU, так и ЦП могут одновременно и ожидать ограждения.</span><span class="sxs-lookup"><span data-stu-id="329b5-221">The GPU and CPU can both signal, and can both wait on fences.</span></span>

<span data-ttu-id="329b5-222">Обычно подход заключается в том, что при отправке списка команд для выполнения сигнал ограждения передается GPU по завершении (после завершения чтения данных), что позволяет ПРОЦЕССОРу повторно использовать или уничтожать ресурсы.</span><span class="sxs-lookup"><span data-stu-id="329b5-222">Typically the approach is that when submitting a command list for execution, a fence signal is transmitted by the GPU on completion (when it has finished reading the data), enabling the CPU to reuse or destroy the resources.</span></span>

<span data-ttu-id="329b5-223">В Direct3D 11 [**ссылку ID3D11DeviceContext:: Map**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-map) флаг D3D11, \_ который \_ \_ отбрасывает запись, фактически обрабатывает каждый ресурс как неограниченный объем памяти, в которую приложение может выполнять запись (процесс, называемый переименованием).</span><span class="sxs-lookup"><span data-stu-id="329b5-223">In Direct3D 11 the [**ID3D11DeviceContext::Map**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-map) flag D3D11\_MAP\_WRITE\_DISCARD essentially treated each resource as an endless supply of memory the app could write to (a process known as "renaming").</span></span> <span data-ttu-id="329b5-224">В Direct3D 12 процесс выполняется явным образом: необходимо выделить дополнительную память, а для синхронизации операций следует использовать ограждения.</span><span class="sxs-lookup"><span data-stu-id="329b5-224">In Direct3D 12 again the process is explicit: additional memory needs to be allocated, and fences should be used to sync the operations.</span></span> <span data-ttu-id="329b5-225">Кольцевые буферы (состоящие из больших буферов) могут быть хорошим методом для этого, см. сценарий кольцевого буфера в разделе [Управление ресурсами на основе ограждений](fence-based-resource-management.md).</span><span class="sxs-lookup"><span data-stu-id="329b5-225">Ring buffers (consisting of large buffers) might be a good technique for this, refer to the ring buffer scenario in [Fence-Based Resource Management](fence-based-resource-management.md).</span></span>

![Использование кольцевого буфера](images/ring-buffer-1.png)

## <a name="resource-binding"></a><span data-ttu-id="329b5-227">Привязка ресурсов</span><span class="sxs-lookup"><span data-stu-id="329b5-227">Resource Binding</span></span>

<span data-ttu-id="329b5-228">Представления в Direct3D 11 (представления ресурсов шейдера, представления целевых объектов прорисовки и т. д.) в значительной мере заменены в Direct3D 12 понятием дескриптора.</span><span class="sxs-lookup"><span data-stu-id="329b5-228">Views in Direct3D 11 (shader resource views, render target views, and so on), have largely been replaced in Direct3D 12 with the concept of a descriptor.</span></span> <span data-ttu-id="329b5-229">Методы создания по-прежнему существуют в Direct3D 12 (например, [**креатешадерресаурцевиев**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createshaderresourceview) и [**креатерендертаржетвиев**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createrendertargetview)), которые вызываются после создания кучи дескрипторов, для записи данных в кучу.</span><span class="sxs-lookup"><span data-stu-id="329b5-229">The creation methods still exist in Direct3D 12 (such as [**CreateShaderResourceView**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createshaderresourceview) and [**CreateRenderTargetView**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createrendertargetview)), which are called after the descriptor heap has been created, to write the data into the heap.</span></span> <span data-ttu-id="329b5-230">Привязка в Direct3D 12 теперь обрабатывается дескрипторами дескрипторов, описанными в корневой сигнатуре, и отправляется с помощью методов [**сетграфиксрутдескриптортабле**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setgraphicsrootdescriptortable) или [**сеткомпутерутдескриптортабле**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setcomputerootdescriptortable) .</span><span class="sxs-lookup"><span data-stu-id="329b5-230">Binding in Direct3D 12 is now handled by descriptor handles described in a root signature, and submitted using the [**SetGraphicsRootDescriptorTable**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setgraphicsrootdescriptortable) or [**SetComputeRootDescriptorTable**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setcomputerootdescriptortable) methods.</span></span>

<span data-ttu-id="329b5-231">Сведения об корневых сигнатурах сопоставлений между номером корневого слота подписи и таблицами дескрипторов, где таблица дескрипторов может содержать ссылки на ресурсы, доступные для шейдеров вершин, шейдеров пикселей и других шейдеров, таких как константные буферы, представления ресурсов шейдеров и пробы.</span><span class="sxs-lookup"><span data-stu-id="329b5-231">Root signatures details mappings between the root signature slot number and descriptor tables, where the descriptor table can contain references to resources available to vertex shaders, pixel shaders, and the other shaders, such as constant buffers, shader resource views and samplers.</span></span> <span data-ttu-id="329b5-232">Эта гибкость позволяет отключать пространство регистра HLSL из пространства привязки API в Direct3D 12, в отличие от Direct3D 11, где между ними есть одно сопоставление.</span><span class="sxs-lookup"><span data-stu-id="329b5-232">This flexibility disconnects the HLSL register space from the API binding space in Direct3D 12, unlike Direct3D 11 where there is a one to one mapping between these.</span></span>

<span data-ttu-id="329b5-233">Одним из последствий этой системы является то, что приложение отвечает за переименование таблиц дескрипторов, что позволяет разработчикам понять стоимость производительности при изменении даже одного дескриптора на вызов Draw.</span><span class="sxs-lookup"><span data-stu-id="329b5-233">One of the implications of this system is that the app is responsible for renaming descriptor tables, which enables developers to understand the performance cost of changing even a single descriptor per draw call.</span></span>

<span data-ttu-id="329b5-234">Новая функция Direct3D 12 заключается в том, что приложение может контролировать, какие дескрипторы являются общими для каждого этапа шейдера.</span><span class="sxs-lookup"><span data-stu-id="329b5-234">A new feature of Direct3D 12 is that an app can control which descriptors are shared between which shader stages.</span></span> <span data-ttu-id="329b5-235">В таких ресурсах Direct3D 11, как Уавс, совместно используются всеми этапами шейдера.</span><span class="sxs-lookup"><span data-stu-id="329b5-235">In Direct3D 11 resources such as UAVs are shared between all shader stages.</span></span> <span data-ttu-id="329b5-236">Включение отключения дескрипторов для определенных стадий шейдера позволяет отключать регистры, используемые дескрипторами, которые были отключены, и использовать их в дескрипторах, которые включены для определенного этапа шейдера.</span><span class="sxs-lookup"><span data-stu-id="329b5-236">By enabling descriptors to be disabled for certain shader stages, the registers used by descriptors that have been disabled are available to be used by descriptors which are enabled for a particular shader stage.</span></span>

<span data-ttu-id="329b5-237">В следующей таблице показан пример корневой подписи.</span><span class="sxs-lookup"><span data-stu-id="329b5-237">The following table shows an example root signature.</span></span>



| <span data-ttu-id="329b5-238">Корневой слот параметров</span><span class="sxs-lookup"><span data-stu-id="329b5-238">Root Parameter Slot</span></span> | <span data-ttu-id="329b5-239">Запись таблицы дескрипторов</span><span class="sxs-lookup"><span data-stu-id="329b5-239">Descriptor Table Entry</span></span>         |
|---------------------|--------------------------------|
| <span data-ttu-id="329b5-240">0</span><span class="sxs-lookup"><span data-stu-id="329b5-240">0</span></span>                   | <span data-ttu-id="329b5-241">Диапазон дескрипторов VS — B13</span><span class="sxs-lookup"><span data-stu-id="329b5-241">VS Descriptor Range b0-b13</span></span>     |
| <span data-ttu-id="329b5-242">1</span><span class="sxs-lookup"><span data-stu-id="329b5-242">1</span></span>                   | <span data-ttu-id="329b5-243">Диапазон дескрипторов VS T0-T127</span><span class="sxs-lookup"><span data-stu-id="329b5-243">VS Descriptor Range t0-t127</span></span>    |
| <span data-ttu-id="329b5-244">2</span><span class="sxs-lookup"><span data-stu-id="329b5-244">2</span></span>                   | <span data-ttu-id="329b5-245">Диапазон дескрипторов VS S0-S16</span><span class="sxs-lookup"><span data-stu-id="329b5-245">VS Descriptor Range s0-s16</span></span>     |
| <span data-ttu-id="329b5-246">3</span><span class="sxs-lookup"><span data-stu-id="329b5-246">3</span></span>                   | <span data-ttu-id="329b5-247">Диапазон дескрипторов PS — B0-B13</span><span class="sxs-lookup"><span data-stu-id="329b5-247">PS Descriptor Range b0-b13</span></span>     |
| <span data-ttu-id="329b5-248">...</span><span class="sxs-lookup"><span data-stu-id="329b5-248">...</span></span>                 |                                |
| <span data-ttu-id="329b5-249">14</span><span class="sxs-lookup"><span data-stu-id="329b5-249">14</span></span>                  | <span data-ttu-id="329b5-250">Диапазон дескрипторов DS S0-16</span><span class="sxs-lookup"><span data-stu-id="329b5-250">DS Descriptor Range s0-16</span></span>      |
| <span data-ttu-id="329b5-251">15</span><span class="sxs-lookup"><span data-stu-id="329b5-251">15</span></span>                  | <span data-ttu-id="329b5-252">Диапазон общих дескрипторов U0-u63</span><span class="sxs-lookup"><span data-stu-id="329b5-252">Shared Descriptor Range u0-u63</span></span> |



 

## <a name="resource-state"></a><span data-ttu-id="329b5-253">Состояние ресурса</span><span class="sxs-lookup"><span data-stu-id="329b5-253">Resource state</span></span>

<span data-ttu-id="329b5-254">В Direct3D 11 состояние ресурсов не поддерживается приложением, а драйвером.</span><span class="sxs-lookup"><span data-stu-id="329b5-254">In Direct3D 11 resource state is not maintained by the app, but by the driver.</span></span>

<span data-ttu-id="329b5-255">В Direct3D 12 обслуживание состояния ресурсов превращается в приложение, чтобы обеспечить полный параллелизм при записи списков команд: приложение должно обрабатывать временные шкалы записи для списков команд (которые могут выполняться параллельно) и временные шкалы выполнения, которые должны быть последовательными.</span><span class="sxs-lookup"><span data-stu-id="329b5-255">In Direct3D 12 maintaining resource state becomes the responsibility of the app, to enable full parallelism in the recording of command lists: the app must handle the recording timelines for command lists (which can be done in parallel), and the execution timelines which must be sequential.</span></span>

<span data-ttu-id="329b5-256">Переход состояния ресурса обрабатывается методом [**ресаурцебарриер**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-resourcebarrier) .</span><span class="sxs-lookup"><span data-stu-id="329b5-256">A resource state transition is handled by the [**ResourceBarrier**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-resourcebarrier) method.</span></span> <span data-ttu-id="329b5-257">В основном приложение должно уведомлять драйвер об изменении использования ресурсов.</span><span class="sxs-lookup"><span data-stu-id="329b5-257">Primarily the app must inform the driver when resource usage is changing.</span></span> <span data-ttu-id="329b5-258">Например, если ресурс используется в качестве целевого объекта рендеринга, а затем он будет использоваться в качестве входных данных для шейдера вершин при следующем вызове Draw, это может потребовать кратковременной остановки в операции GPU для завершения операции целевого объекта прорисовки перед обработкой шейдера вершин.</span><span class="sxs-lookup"><span data-stu-id="329b5-258">For example if a resource is being used as a render target, and then it is to be used as input to a vertex shader on the next draw call, then this might require a short stall in GPU operation to complete the render target operation before handling the vertex shader.</span></span>

<span data-ttu-id="329b5-259">Эта система обеспечивает детальную синхронизацию (остановки GPU) графического конвейера, а также сброс кэша и, возможно, некоторые изменения макета памяти (например, представление целевого объекта прорисовки для распаковки представления набора элементов глубины).</span><span class="sxs-lookup"><span data-stu-id="329b5-259">This system enables fine grain synchronization (the GPU stalls) of the graphics pipeline, as well as cache flushes and possibly some memory layout changes (such as render target view to depth stencil view decompression).</span></span>

<span data-ttu-id="329b5-260">Это называется барьером перехода.</span><span class="sxs-lookup"><span data-stu-id="329b5-260">This is known as a transition barrier.</span></span> <span data-ttu-id="329b5-261">Существуют и другие виды барьеров. в Direct3D 11 [**ID3D11DeviceContext2:: тиледресаурцебарриер**](/windows/win32/api/d3d11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier) включил ту же физическую память, что и два разных мозаичных ресурса.</span><span class="sxs-lookup"><span data-stu-id="329b5-261">There are other kinds of barriers, in Direct3D 11 the [**ID3D11DeviceContext2::TiledResourceBarrier**](/windows/win32/api/d3d11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier) enabled the same physical memory to be used by two different tiled resources.</span></span> <span data-ttu-id="329b5-262">В Direct3D 12 это называется "барьером псевдонима".</span><span class="sxs-lookup"><span data-stu-id="329b5-262">In Direct3D 12 this is referred to as an "aliasing barrier".</span></span> <span data-ttu-id="329b5-263">Барьеры псевдонимов можно использовать как для мозаичных, так и для размещенных ресурсов в Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="329b5-263">Aliasing barriers can be used for both tiled and placed resources in Direct3D 12.</span></span> <span data-ttu-id="329b5-264">Кроме того, UAV барьер.</span><span class="sxs-lookup"><span data-stu-id="329b5-264">Additionally there is the UAV barrier.</span></span> <span data-ttu-id="329b5-265">В Direct3D 11 все операции диспетчеризации и прорисовки UAV должны быть сериализованы, хотя эти операции могут конвейерировать или работать параллельно.</span><span class="sxs-lookup"><span data-stu-id="329b5-265">In Direct3D 11 all UAV dispatch and draw operations are required to be serialized, even though these operations can be pipelined or work in parallel.</span></span> <span data-ttu-id="329b5-266">Для Direct3D 12 это ограничение удаляется путем добавления UAV барьера.</span><span class="sxs-lookup"><span data-stu-id="329b5-266">For Direct3D 12 this restriction is removed by the addition of a UAV barrier.</span></span> <span data-ttu-id="329b5-267">UAV барьер гарантирует, что операции UAV являются последовательными, поэтому, если вторая операция требует первого завершения, вторая будет вынуждена ждать добавления барьера.</span><span class="sxs-lookup"><span data-stu-id="329b5-267">A UAV barrier ensures that UAV operations are sequential, so if a second operation requires that the first complete, the second will be forced to wait by the addition of the barrier.</span></span> <span data-ttu-id="329b5-268">Операция по умолчанию для Уавс — это просто то, что операции будут выполняться как можно быстрее.</span><span class="sxs-lookup"><span data-stu-id="329b5-268">The default operation for UAVs is simply that the operations will proceed as quickly as possible.</span></span>

<span data-ttu-id="329b5-269">Очевидно, что при параллельной работе Рабочая нагрузка повышает производительность.</span><span class="sxs-lookup"><span data-stu-id="329b5-269">Clearly there are performance gains if a workload can be parallelized.</span></span>

## <a name="swapchains"></a><span data-ttu-id="329b5-270">Цепочек переключений</span><span class="sxs-lookup"><span data-stu-id="329b5-270">Swapchains</span></span>

<span data-ttu-id="329b5-271">Цепочка подкачки DXGI является основанием для цепочек подкачки в Direct3D 11 и 12.</span><span class="sxs-lookup"><span data-stu-id="329b5-271">The DXGI swap chain is the basis for swap chains in both Direct3D 11 and 12.</span></span> <span data-ttu-id="329b5-272">Существует несколько незначительных отличий, в Direct3D 11 три типа цепочки буферов перемещаются последовательно, отменяются и переворачиваются \_ последовательно.</span><span class="sxs-lookup"><span data-stu-id="329b5-272">There are some minor differences, in Direct3D 11 the three types of swap chain are SEQUENTIAL, DISCARD, and FLIP\_SEQUENTIAL.</span></span> <span data-ttu-id="329b5-273">Для Direct3D 12 существует только два типа: переворот \_ последовательных и зеркальных \_ отклонения.</span><span class="sxs-lookup"><span data-stu-id="329b5-273">For Direct3D 12 there are just two types: FLIP\_SEQUENTIAL and FLIP\_DISCARD.</span></span> <span data-ttu-id="329b5-274">Как отмечалось выше, необходимо явно создать имеющуюся цепочку буферов через **IDXGIFactory4** или более поздней версии и использовать тот же интерфейс для любого перечисления адаптера.</span><span class="sxs-lookup"><span data-stu-id="329b5-274">As noted above, you should be explicitly creating your swapchain via **IDXGIFactory4**, or later, and using the same interface for any adapter enumeration.</span></span>

<span data-ttu-id="329b5-275">В Direct3D 11 имеется автоматический поворот обратного буфера: для заднего буфера 0 требуется только одно представление целевого объекта прорисовки.</span><span class="sxs-lookup"><span data-stu-id="329b5-275">In Direct3D 11 there is automatic backbuffer rotation: only one render target view is needed for back buffer 0.</span></span> <span data-ttu-id="329b5-276">В режиме вращения буфера Direct3D 12 для каждого заднего буфера должно быть представление целевого объекта отрисовки.</span><span class="sxs-lookup"><span data-stu-id="329b5-276">In Direct3D 12 buffer rotation is explicit, there needs to be a render target view for each back buffer.</span></span> <span data-ttu-id="329b5-277">Используйте метод [**IDXGISwapChain3:: жеткуррентбаккбуффериндекс**](/windows/win32/api/dxgi1_4/nf-dxgi1_4-idxgiswapchain3-getcurrentbackbufferindex) , чтобы выбрать, в какой из них следует выполнить отрисовку.</span><span class="sxs-lookup"><span data-stu-id="329b5-277">Use the [**IDXGISwapChain3::GetCurrentBackBufferIndex**](/windows/win32/api/dxgi1_4/nf-dxgi1_4-idxgiswapchain3-getcurrentbackbufferindex) method to select which one to render to.</span></span> <span data-ttu-id="329b5-278">Еще раз такая дополнительная гибкость позволяет повысить параллелизм.</span><span class="sxs-lookup"><span data-stu-id="329b5-278">Again this additional flexibility enables greater parallelization.</span></span>

> [!NOTE]
> <span data-ttu-id="329b5-279">Хотя существует множество способов настройки приложения, обычно приложения имеют по одному **ID3D12CommandAllocator** на буфер цепочки подкачки.</span><span class="sxs-lookup"><span data-stu-id="329b5-279">While there are numerous ways to set up your application, generally applications have one **ID3D12CommandAllocator** per swap-chain buffer.</span></span> <span data-ttu-id="329b5-280">Это позволяет приложению перейти к созданию набора команд для следующего кадра, пока GPU визуализирует предыдущий.</span><span class="sxs-lookup"><span data-stu-id="329b5-280">This allows the application to proceed to building up a set of commands for the next frame while the GPU renders the previous.</span></span>

## <a name="fixed-function-rendering"></a><span data-ttu-id="329b5-281">Фиксированная визуализация функции</span><span class="sxs-lookup"><span data-stu-id="329b5-281">Fixed function rendering</span></span>

<span data-ttu-id="329b5-282">В Direct3D 11 существовало несколько методов, которые упрощают различные операции высшего уровня, такие как [**женератемипс**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-generatemips) (создание полных цепочек MIP) и [**дравауто**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-drawauto) (использование потокового вывода в качестве входных данных шейдера без дополнительных входов из приложения).</span><span class="sxs-lookup"><span data-stu-id="329b5-282">In Direct3D 11 there were a few methods that simplified various higher level operations, such as [**GenerateMips**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-generatemips) (creating full mip chains) and [**DrawAuto**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-drawauto) (using stream output as shader input without further input from the app).</span></span> <span data-ttu-id="329b5-283">Эти методы недоступны в Direct3D 12. приложению необходимо выполнить эти операции, создав шейдеры для их выполнения.</span><span class="sxs-lookup"><span data-stu-id="329b5-283">These methods are not available in Direct3D 12, the app needs to handle these operations by creating shaders to perform them.</span></span>

## <a name="odds-and-ends"></a><span data-ttu-id="329b5-284">Вероятность и завершение</span><span class="sxs-lookup"><span data-stu-id="329b5-284">Odds and ends</span></span>

<span data-ttu-id="329b5-285">В следующей таблице показано несколько функций, которые похожи на Direct3D 11 и 12, но не идентичны.</span><span class="sxs-lookup"><span data-stu-id="329b5-285">The following table shows a number of features that are similar between Direct3D 11 and 12, but are not identical.</span></span>



| <span data-ttu-id="329b5-286">Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="329b5-286">Direct3D 11</span></span>                                                                            | <span data-ttu-id="329b5-287">Direct3D 12</span><span class="sxs-lookup"><span data-stu-id="329b5-287">Direct3D 12</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                              |
|----------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="329b5-288">**ID3D11Query**</span><span class="sxs-lookup"><span data-stu-id="329b5-288">**ID3D11Query**</span></span>](/windows/win32/api/d3d11/nn-d3d11-id3d11query)                                              | <span data-ttu-id="329b5-289">[**ID3D12QueryHeap**](/windows/win32/api/d3d12/nn-d3d12-id3d12queryheap) позволяет объединять запросы в группу, уменьшая затраты.</span><span class="sxs-lookup"><span data-stu-id="329b5-289">[**ID3D12QueryHeap**](/windows/win32/api/d3d12/nn-d3d12-id3d12queryheap) allows queries to be grouped together, reducing the cost.</span></span>                                                                                                                                                                                                                                                                                                                                     |
| [<span data-ttu-id="329b5-290">**ID3D11Predicate**</span><span class="sxs-lookup"><span data-stu-id="329b5-290">**ID3D11Predicate**</span></span>](/windows/win32/api/d3d11/nn-d3d11-id3d11predicate)                                      | <span data-ttu-id="329b5-291">Затенения теперь включается, если данные находятся в полностью прозрачном буфере.</span><span class="sxs-lookup"><span data-stu-id="329b5-291">Predication is now enabled by having data in a fully transparent buffer.</span></span> <span data-ttu-id="329b5-292">Объект Direct3D 11 [**ID3D11Predicate**](/windows/win32/api/d3d11/nn-d3d11-id3d11predicate) заменяется [**ID3D12Resource:: Map**](/windows/win32/api/d3d12/nf-d3d12-id3d12resource-map), который должен следовать за вызовом [**РЕСОЛВЕКУЕРИДАТА**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-resolvequerydata) и операцией синхронизации GPU с использованием ограждения для ожидания готовности данных.</span><span class="sxs-lookup"><span data-stu-id="329b5-292">The Direct3D 11 [**ID3D11Predicate**](/windows/win32/api/d3d11/nn-d3d11-id3d11predicate) object is replaced by [**ID3D12Resource::Map**](/windows/win32/api/d3d12/nf-d3d12-id3d12resource-map), which must follow a call to [**ResolveQueryData**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-resolvequerydata) and a GPU sync operation using a fence to wait for the data to be ready.</span></span> <span data-ttu-id="329b5-293">См. [затенения](predication.md).</span><span class="sxs-lookup"><span data-stu-id="329b5-293">Refer to [Predication](predication.md).</span></span> |
| <span data-ttu-id="329b5-294">Скрытый счетчик UAV/SO</span><span class="sxs-lookup"><span data-stu-id="329b5-294">UAV/SO hidden counter</span></span>                                                                  | <span data-ttu-id="329b5-295">Приложение отвечает за выделение и Управление счетчиками SO/UAV.</span><span class="sxs-lookup"><span data-stu-id="329b5-295">The app is responsible for allocation and management of SO/UAV counters.</span></span> <span data-ttu-id="329b5-296">Ознакомьтесь со счетчиками [потокового вывода](stream-output-counters.md) и [счетчиками UAV](uav-counters.md).</span><span class="sxs-lookup"><span data-stu-id="329b5-296">Refer to [Stream Output Counters](stream-output-counters.md) and [UAV Counters](uav-counters.md).</span></span>                                                                                                                                                                                                                                                             |
| <span data-ttu-id="329b5-297">Динамический Минлод ресурсов (уровень детализации миниум)</span><span class="sxs-lookup"><span data-stu-id="329b5-297">Resource dynamic MinLOD (minium level of detail)</span></span>                                       | <span data-ttu-id="329b5-298">Он был перемещен в статический Минлод дескриптора SRV.</span><span class="sxs-lookup"><span data-stu-id="329b5-298">This has been moved to the SRV descriptor static MinLOD.</span></span>                                                                                                                                                                                                                                                                                                                                                                                 |
| <span data-ttu-id="329b5-299">Нарисовать \* косвенные/[**диспатчиндирект**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-dispatchindirect)</span><span class="sxs-lookup"><span data-stu-id="329b5-299">Draw\*Indirect/[**DispatchIndirect**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-dispatchindirect)</span></span> | <span data-ttu-id="329b5-300">Непрямые методы рисования объединяются в один метод [**ексекутеиндирект**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-executeindirect) .</span><span class="sxs-lookup"><span data-stu-id="329b5-300">Drawing indirect methods are all merged into the one [**ExecuteIndirect**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-executeindirect) method.</span></span>                                                                                                                                                                                                                                                                                                        |
| <span data-ttu-id="329b5-301">Форматы ДепсстенЦил чередуются</span><span class="sxs-lookup"><span data-stu-id="329b5-301">DepthStencil formats are interleaved</span></span>                                                   | <span data-ttu-id="329b5-302">Форматы ДепсстенЦил — плоские.</span><span class="sxs-lookup"><span data-stu-id="329b5-302">DepthStencil formats are planar.</span></span> <span data-ttu-id="329b5-303">Например, формат 24 бит глубины, 8 бит набора элементов будет храниться в формате 24/8/24/8... и т. д. в Direct3D 11, но как 24/24/24... за которым следует 8/8/8... в Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="329b5-303">For example a format of 24 bits of depth, 8 bits of stencil would be stored in the format 24/8/24/8... etc in Direct3D 11, but as 24/24/24... followed by 8/8/8... in Direct3D 12.</span></span> <span data-ttu-id="329b5-304">Обратите внимание, что каждая плоскость является собственным подресурсом в D3D12 (см. [подресурсы](subresources.md)).</span><span class="sxs-lookup"><span data-stu-id="329b5-304">Note that each plane is its own subresource in D3D12 (refer to [Subresources](subresources.md)).</span></span>                                                                                                                    |
| [<span data-ttu-id="329b5-305">**ресизетилепул**</span><span class="sxs-lookup"><span data-stu-id="329b5-305">**ResizeTilePool**</span></span>](/windows/win32/api/d3d11_2/nf-d3d11_2-id3d11devicecontext2-resizetilepool)                   | <span data-ttu-id="329b5-306">Зарезервированные ресурсы могут быть сопоставлены с несколькими кучами.</span><span class="sxs-lookup"><span data-stu-id="329b5-306">Reserved resources can be mapped to multiple heaps.</span></span> <span data-ttu-id="329b5-307">Когда пул плиток будет увеличился в D3D11, вместо этого можно выделить дополнительную кучу в D3D12.</span><span class="sxs-lookup"><span data-stu-id="329b5-307">When a tile pool would have been grown in D3D11, an additional heap can be allocated in D3D12 instead.</span></span>                                                                                                                                                                                                                                                                               |



 

## <a name="related-topics"></a><span data-ttu-id="329b5-308">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="329b5-308">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="329b5-309">Дополнительные обучающие видеоматериалы по DirectX: руководство по переносу с DirectX 11 на DirectX 12</span><span class="sxs-lookup"><span data-stu-id="329b5-309">DirectX advanced learning video tutorials : DirectX 11 to DirectX 12 porting guide</span></span>](https://www.youtube.com/watch?v=BV64mdOCgZo)
</dt> <dt>

[<span data-ttu-id="329b5-310">Основные сведения о Direct3D 12</span><span class="sxs-lookup"><span data-stu-id="329b5-310">Understanding Direct3D 12</span></span>](directx-12-getting-started.md)
</dt> <dt>

[<span data-ttu-id="329b5-311">Работа с Direct3D 11, Direct3D 10 и Direct2D</span><span class="sxs-lookup"><span data-stu-id="329b5-311">Working with Direct3D 11, Direct3D 10 and Direct2D</span></span>](direct3d-12-interop.md)
</dt> </dl>