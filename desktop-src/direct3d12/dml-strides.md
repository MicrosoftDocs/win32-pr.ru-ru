---
title: Использование STRIDE для выражения заполнения и макета памяти
description: Директмлные десятки описываются свойствами, которые называются *размерами* и *шагами* тензорные.
ms.custom: Windows 10 May 2019 Update
ms.localizationpriority: high
ms.topic: article
ms.date: 04/19/2019
ms.openlocfilehash: b944b1a2600febe27f209bffcc0e355c6a9fc7db
ms.sourcegitcommit: cba7f424a292fd7f3a8518947b9466439b455419
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/23/2019
ms.locfileid: "104548968"
---
# <a name="using-strides-to-express-padding-and-memory-layout"></a><span data-ttu-id="cf479-103">Использование STRIDE для выражения заполнения и макета памяти</span><span class="sxs-lookup"><span data-stu-id="cf479-103">Using strides to express padding and memory layout</span></span>

<span data-ttu-id="cf479-104">Директмлные десятки, которые поддерживаются &mdash; буферами Direct3D 12 &mdash; , описываются свойствами, которые называются *размерами* и *шагами* тензорные.</span><span class="sxs-lookup"><span data-stu-id="cf479-104">DirectML tensors&mdash;which are are backed by Direct3D 12 buffers&mdash;are described by properties known as the *sizes* and the *strides* of the tensor.</span></span> <span data-ttu-id="cf479-105">*Размеры* тензорные описывают логические измерения тензорные.</span><span class="sxs-lookup"><span data-stu-id="cf479-105">The tensor's *sizes* describe the logical dimensions of the tensor.</span></span> <span data-ttu-id="cf479-106">Например, 2D-тензорные может иметь высоту 2 и ширину 3.</span><span class="sxs-lookup"><span data-stu-id="cf479-106">For example, a 2D tensor might have a height of 2 and a width of 3.</span></span> <span data-ttu-id="cf479-107">Логически тензорные имеет 6 различных элементов, хотя размеры не указывают, как эти элементы хранятся в памяти.</span><span class="sxs-lookup"><span data-stu-id="cf479-107">Logically, the tensor has 6 distinct elements, although the sizes don't specify how those elements are stored in memory.</span></span> <span data-ttu-id="cf479-108">В *шагах* тензорные описывается структура физической памяти элементов тензорные.</span><span class="sxs-lookup"><span data-stu-id="cf479-108">The tensor's *strides* describe the physical memory layout of the tensor's elements.</span></span>

## <a name="two-dimensional-2d-arrays"></a><span data-ttu-id="cf479-109">Двухмерные массивы (2D)</span><span class="sxs-lookup"><span data-stu-id="cf479-109">Two-dimensional (2D) arrays</span></span>

<span data-ttu-id="cf479-110">Рассмотрим двумерный тензорные с высотой 2 и шириной 3. данные состоят из текстовых символов.</span><span class="sxs-lookup"><span data-stu-id="cf479-110">Consider a 2D tensor that has a height of 2 and a width of 3; the data comprises textual characters.</span></span> <span data-ttu-id="cf479-111">В C/C++ это может быть выражено с помощью многомерного массива.</span><span class="sxs-lookup"><span data-stu-id="cf479-111">In C/C++, this might be expressed using a multi-dimensional array.</span></span>

```cpp
constexpr int rows = 2;
constexpr int columns = 3;
char tensor[rows][columns];
tensor[0][0] = 'A';
tensor[0][1] = 'B';
tensor[0][2] = 'C';
tensor[1][0] = 'D';
tensor[1][1] = 'E';
tensor[1][2] = 'F';
```

<span data-ttu-id="cf479-112">Логическое представление приведенной выше тензорные визуализации показано ниже.</span><span class="sxs-lookup"><span data-stu-id="cf479-112">The logical view of the above tensor is visualized below.</span></span>

```console
A B C
D E F
```

<span data-ttu-id="cf479-113">В C/C++ многомерный массив хранится в основном порядке строк.</span><span class="sxs-lookup"><span data-stu-id="cf479-113">In C/C++, a multi-dimensional array is stored in row-major order.</span></span> <span data-ttu-id="cf479-114">Иными словами, последовательные элементы в измерении Width хранятся непрерывно в линейной области памяти.</span><span class="sxs-lookup"><span data-stu-id="cf479-114">In other words, the consecutive elements along the width dimension are stored contiguously in linear memory space.</span></span>

<span data-ttu-id="cf479-115">Offset:</span><span class="sxs-lookup"><span data-stu-id="cf479-115">Offset:</span></span>|<span data-ttu-id="cf479-116">0</span><span class="sxs-lookup"><span data-stu-id="cf479-116">0</span></span>|<span data-ttu-id="cf479-117">1</span><span class="sxs-lookup"><span data-stu-id="cf479-117">1</span></span>|<span data-ttu-id="cf479-118">2</span><span class="sxs-lookup"><span data-stu-id="cf479-118">2</span></span>|<span data-ttu-id="cf479-119">3</span><span class="sxs-lookup"><span data-stu-id="cf479-119">3</span></span>|<span data-ttu-id="cf479-120">4</span><span class="sxs-lookup"><span data-stu-id="cf479-120">4</span></span>|<span data-ttu-id="cf479-121">5</span><span class="sxs-lookup"><span data-stu-id="cf479-121">5</span></span>
-|-|-|-|-|-|-
<span data-ttu-id="cf479-122">Значение:</span><span class="sxs-lookup"><span data-stu-id="cf479-122">Value:</span></span>|<span data-ttu-id="cf479-123">Объект</span><span class="sxs-lookup"><span data-stu-id="cf479-123">A</span></span>|<span data-ttu-id="cf479-124">B</span><span class="sxs-lookup"><span data-stu-id="cf479-124">B</span></span>|<span data-ttu-id="cf479-125">C</span><span class="sxs-lookup"><span data-stu-id="cf479-125">C</span></span>|<span data-ttu-id="cf479-126">D</span><span class="sxs-lookup"><span data-stu-id="cf479-126">D</span></span>|<span data-ttu-id="cf479-127">E</span><span class="sxs-lookup"><span data-stu-id="cf479-127">E</span></span>|<span data-ttu-id="cf479-128">F</span><span class="sxs-lookup"><span data-stu-id="cf479-128">F</span></span>

<span data-ttu-id="cf479-129">*Шаг* измерения — это число пропускаемых элементов для доступа к следующему элементу в этом измерении.</span><span class="sxs-lookup"><span data-stu-id="cf479-129">The *stride* of a dimension is the number of elements to skip in order to access the next element in that dimension.</span></span> <span data-ttu-id="cf479-130">Шаг представляет макет тензорные в памяти.</span><span class="sxs-lookup"><span data-stu-id="cf479-130">Strides express the layout of the tensor in memory.</span></span> <span data-ttu-id="cf479-131">При использовании строкового порядка шаг измерения «ширина» всегда равен 1, так как соседние элементы в измерении хранятся непрерывно.</span><span class="sxs-lookup"><span data-stu-id="cf479-131">With a row-major order, the stride of the width dimension is always 1, since adjacent elements along the dimension are stored contiguously.</span></span> <span data-ttu-id="cf479-132">Шаг измерения высоты зависит от размера измерения Width. в приведенном выше примере расстояние между последовательными элементами в измерении высоты (например, A до D) равно ширине тензорные (то есть 3 в этом примере).</span><span class="sxs-lookup"><span data-stu-id="cf479-132">The stride of the height dimension depends on the size of the width dimension; in the above example, the distance between consecutive elements along the height dimension (for example, A to D) is equal to the width of the tensor (which is 3 in this example).</span></span>

<span data-ttu-id="cf479-133">Чтобы проиллюстрировать другой макет, рассмотрим основной порядок столбцов.</span><span class="sxs-lookup"><span data-stu-id="cf479-133">To illustrate a different layout, consider column-major order.</span></span> <span data-ttu-id="cf479-134">Иными словами, последовательные элементы вдоль измерения высоты хранятся непрерывно в линейной области памяти.</span><span class="sxs-lookup"><span data-stu-id="cf479-134">In other words, the consecutive elements along the height dimension are stored contiguously in linear memory space.</span></span> <span data-ttu-id="cf479-135">В этом случае шаг с высоты всегда равен 1, а шаг с шириной — 2 (размер измерения высоты).</span><span class="sxs-lookup"><span data-stu-id="cf479-135">In this case, the height-stride is always 1, and the width-stride is 2 (the size of the height dimension).</span></span>

<span data-ttu-id="cf479-136">Offset:</span><span class="sxs-lookup"><span data-stu-id="cf479-136">Offset:</span></span>|<span data-ttu-id="cf479-137">0</span><span class="sxs-lookup"><span data-stu-id="cf479-137">0</span></span>|<span data-ttu-id="cf479-138">1</span><span class="sxs-lookup"><span data-stu-id="cf479-138">1</span></span>|<span data-ttu-id="cf479-139">2</span><span class="sxs-lookup"><span data-stu-id="cf479-139">2</span></span>|<span data-ttu-id="cf479-140">3</span><span class="sxs-lookup"><span data-stu-id="cf479-140">3</span></span>|<span data-ttu-id="cf479-141">4</span><span class="sxs-lookup"><span data-stu-id="cf479-141">4</span></span>|<span data-ttu-id="cf479-142">5</span><span class="sxs-lookup"><span data-stu-id="cf479-142">5</span></span>
-|-|-|-|-|-|-
<span data-ttu-id="cf479-143">Значение:</span><span class="sxs-lookup"><span data-stu-id="cf479-143">Value:</span></span>|<span data-ttu-id="cf479-144">A</span><span class="sxs-lookup"><span data-stu-id="cf479-144">A</span></span>|<span data-ttu-id="cf479-145">D</span><span class="sxs-lookup"><span data-stu-id="cf479-145">D</span></span>|<span data-ttu-id="cf479-146">B</span><span class="sxs-lookup"><span data-stu-id="cf479-146">B</span></span>|<span data-ttu-id="cf479-147">E</span><span class="sxs-lookup"><span data-stu-id="cf479-147">E</span></span>|<span data-ttu-id="cf479-148">C</span><span class="sxs-lookup"><span data-stu-id="cf479-148">C</span></span>|<span data-ttu-id="cf479-149">F</span><span class="sxs-lookup"><span data-stu-id="cf479-149">F</span></span>

## <a name="higher-dimensions"></a><span data-ttu-id="cf479-150">Более высокие размеры</span><span class="sxs-lookup"><span data-stu-id="cf479-150">Higher dimensions</span></span>

<span data-ttu-id="cf479-151">Когда речь идет о более чем двух измерениях, неудобно ссылаться на макет как на строку, так и на основной столбец.</span><span class="sxs-lookup"><span data-stu-id="cf479-151">When it comes to greater than two dimensions, it's unwieldy to refer to a layout as either row-major or column-major.</span></span> <span data-ttu-id="cf479-152">Итак, в оставшейся части этого раздела используются термины и метки, такие как.</span><span class="sxs-lookup"><span data-stu-id="cf479-152">So, the rest of this topic uses terms and labels such as these.</span></span>

- <span data-ttu-id="cf479-153">2D: высота "HW" &mdash; — это измерение высшего порядка (Главная строка).</span><span class="sxs-lookup"><span data-stu-id="cf479-153">2D: "HW"&mdash;height is the highest-order dimension (row-major).</span></span>
- <span data-ttu-id="cf479-154">2D: «чем» &mdash; Ширина — это измерение высшего порядка (основной столбец).</span><span class="sxs-lookup"><span data-stu-id="cf479-154">2D: "WH"&mdash;width is the highest-order dimension (column-major).</span></span>
- <span data-ttu-id="cf479-155">3D: глубина "ДХВ" &mdash; — это измерение высшего порядка, за которым следует высота, а затем ширина.</span><span class="sxs-lookup"><span data-stu-id="cf479-155">3D: "DHW"&mdash;depth is the highest-order dimension, followed by height, and then width.</span></span>
- <span data-ttu-id="cf479-156">3D: ширина "ВХД" &mdash; — это измерение высшего порядка, за которым следует высота, а затем глубина.</span><span class="sxs-lookup"><span data-stu-id="cf479-156">3D: "WHD"&mdash;width is the highest-order dimension, followed by height, and then depth.</span></span>
- <span data-ttu-id="cf479-157">4D: "НЧВ" &mdash; число образов (размер пакета), число каналов, высота и ширина.</span><span class="sxs-lookup"><span data-stu-id="cf479-157">4D: "NCHW"&mdash;the number of images (batch size), then the number of channels, then height, then width.</span></span>

<span data-ttu-id="cf479-158">Как правило, *упакованный* шаг измерения равен произведению размеров измерений нижнего порядка.</span><span class="sxs-lookup"><span data-stu-id="cf479-158">In general, the *packed* stride of a dimension is equal to the product of the sizes of the lower-order dimensions.</span></span> <span data-ttu-id="cf479-159">Например, при использовании макета "ДХВ" D-STRIDE равен H \* W; H-шаг равен W; и W-STRIDE равен 1.</span><span class="sxs-lookup"><span data-stu-id="cf479-159">For example, with a "DHW" layout, the D-stride is equal to H \* W; the H-stride is equal to W; and the W-stride is equal to 1.</span></span> <span data-ttu-id="cf479-160">Считается, что шаг *упакован* , если общий физический размер тензорные равен общему логическому размеру тензорные. Иными словами, не существует дополнительного пространства и перекрывающихся элементов.</span><span class="sxs-lookup"><span data-stu-id="cf479-160">Strides are said to be *packed* when the total physical size of the tensor is equal to the total logical size of the tensor; in other words, there's no extra space nor overlapping elements.</span></span>

<span data-ttu-id="cf479-161">Добавим 2D-пример к трем измерениям, чтобы у нас был тензорные с глубиной 2, высота 2 и ширина 3 (для всего 12 логических элементов).</span><span class="sxs-lookup"><span data-stu-id="cf479-161">Let's extend the 2D example to three dimensions, so that we have a tensor with depth 2, height 2, and width 3 (for a total of 12 logical elements).</span></span>

```console
A B C
D E F

G H I
J K L
```

<span data-ttu-id="cf479-162">При использовании макета "ДХВ" Этот тензорные сохраняется следующим образом.</span><span class="sxs-lookup"><span data-stu-id="cf479-162">With a "DHW" layout, this tensor is stored as follows.</span></span>

<span data-ttu-id="cf479-163">Offset:</span><span class="sxs-lookup"><span data-stu-id="cf479-163">Offset:</span></span>|<span data-ttu-id="cf479-164">0</span><span class="sxs-lookup"><span data-stu-id="cf479-164">0</span></span>|<span data-ttu-id="cf479-165">1</span><span class="sxs-lookup"><span data-stu-id="cf479-165">1</span></span>|<span data-ttu-id="cf479-166">2</span><span class="sxs-lookup"><span data-stu-id="cf479-166">2</span></span>|<span data-ttu-id="cf479-167">3</span><span class="sxs-lookup"><span data-stu-id="cf479-167">3</span></span>|<span data-ttu-id="cf479-168">4</span><span class="sxs-lookup"><span data-stu-id="cf479-168">4</span></span>|<span data-ttu-id="cf479-169">5</span><span class="sxs-lookup"><span data-stu-id="cf479-169">5</span></span>|<span data-ttu-id="cf479-170">6</span><span class="sxs-lookup"><span data-stu-id="cf479-170">6</span></span>|<span data-ttu-id="cf479-171">7</span><span class="sxs-lookup"><span data-stu-id="cf479-171">7</span></span>|<span data-ttu-id="cf479-172">8</span><span class="sxs-lookup"><span data-stu-id="cf479-172">8</span></span>|<span data-ttu-id="cf479-173">9</span><span class="sxs-lookup"><span data-stu-id="cf479-173">9</span></span>|<span data-ttu-id="cf479-174">10</span><span class="sxs-lookup"><span data-stu-id="cf479-174">10</span></span>|<span data-ttu-id="cf479-175">11</span><span class="sxs-lookup"><span data-stu-id="cf479-175">11</span></span>|
-|-|-|-|-|-|-|-|-|-|-|-|-|
<span data-ttu-id="cf479-176">Значение:</span><span class="sxs-lookup"><span data-stu-id="cf479-176">Value:</span></span>|<span data-ttu-id="cf479-177">Объект</span><span class="sxs-lookup"><span data-stu-id="cf479-177">A</span></span>|<span data-ttu-id="cf479-178">B</span><span class="sxs-lookup"><span data-stu-id="cf479-178">B</span></span>|<span data-ttu-id="cf479-179">C</span><span class="sxs-lookup"><span data-stu-id="cf479-179">C</span></span>|<span data-ttu-id="cf479-180">D</span><span class="sxs-lookup"><span data-stu-id="cf479-180">D</span></span>|<span data-ttu-id="cf479-181">E</span><span class="sxs-lookup"><span data-stu-id="cf479-181">E</span></span>|<span data-ttu-id="cf479-182">F</span><span class="sxs-lookup"><span data-stu-id="cf479-182">F</span></span>|<span data-ttu-id="cf479-183">G</span><span class="sxs-lookup"><span data-stu-id="cf479-183">G</span></span>|<span data-ttu-id="cf479-184">H</span><span class="sxs-lookup"><span data-stu-id="cf479-184">H</span></span>|<span data-ttu-id="cf479-185">I</span><span class="sxs-lookup"><span data-stu-id="cf479-185">I</span></span>|<span data-ttu-id="cf479-186">J</span><span class="sxs-lookup"><span data-stu-id="cf479-186">J</span></span>|<span data-ttu-id="cf479-187">K</span><span class="sxs-lookup"><span data-stu-id="cf479-187">K</span></span>|<span data-ttu-id="cf479-188">L</span><span class="sxs-lookup"><span data-stu-id="cf479-188">L</span></span>|

- <span data-ttu-id="cf479-189">D-STRIDE = высота (2) \* Ширина (3) = 6 (например, расстояние между "A" и "G").</span><span class="sxs-lookup"><span data-stu-id="cf479-189">D-stride = height (2) \* width (3) = 6 (for example, the distance between 'A' and 'G').</span></span>
- <span data-ttu-id="cf479-190">H-STRIDE = ширина (3) = 3 (например, расстояние между "A" и "d").</span><span class="sxs-lookup"><span data-stu-id="cf479-190">H-stride = width (3) = 3 (for example, the distance between 'A' and 'D').</span></span>
- <span data-ttu-id="cf479-191">W-STRIDE = 1 (например, расстояние между "A" и "B").</span><span class="sxs-lookup"><span data-stu-id="cf479-191">W-stride = 1 (for example, the distance between 'A' and 'B').</span></span>

<span data-ttu-id="cf479-192">Скалярное произведение индексов и координат элемента, а также шаг предоставляет смещение для этого элемента в буфере.</span><span class="sxs-lookup"><span data-stu-id="cf479-192">The dot product of the indices/coordinates of an element and the strides provides the offset to that element in the buffer.</span></span> <span data-ttu-id="cf479-193">Например, смещение элемента H (d = 1, H = 0, w = 1) равно 7.</span><span class="sxs-lookup"><span data-stu-id="cf479-193">For example, the offset of the H element (d=1, h=0, w=1) is 7.</span></span>

<span data-ttu-id="cf479-194">{1, 0, 1} ⋅ {6, 3, 1} = 1 \* 6 + 0 \* 3 + 1 \* 1 = 7</span><span class="sxs-lookup"><span data-stu-id="cf479-194">{1, 0, 1} ⋅ {6, 3, 1} = 1 \* 6 + 0 \* 3 + 1 \* 1 = 7</span></span>

## <a name="packed-tensors"></a><span data-ttu-id="cf479-195">Упакованные десятки</span><span class="sxs-lookup"><span data-stu-id="cf479-195">Packed tensors</span></span>

<span data-ttu-id="cf479-196">В приведенных выше примерах проиллюстрированы *Упакованные* десятки.</span><span class="sxs-lookup"><span data-stu-id="cf479-196">The examples above illustrate *packed* tensors.</span></span> <span data-ttu-id="cf479-197">Тензорные называется *упаковкой* , если логический размер тензорные (в элементах) равен физическому размеру буфера (в элементах), а каждый элемент имеет уникальный адрес или смещение.</span><span class="sxs-lookup"><span data-stu-id="cf479-197">A tensor is said to be *packed* when the logical size of the tensor (in elements) is equal to the physical size of the buffer (in elements), and each element has a unique address/offset.</span></span> <span data-ttu-id="cf479-198">Например, 2x2x3 тензорные упаковывается, если буфер состоит из 12 элементов, а ни одна пара элементов не имеет одинакового смещения в буфере.</span><span class="sxs-lookup"><span data-stu-id="cf479-198">For example, a 2x2x3 tensor is packed if the buffer is 12 elements in length and no pair of elements share the same offset in the buffer.</span></span> <span data-ttu-id="cf479-199">Упакованные десятки являются наиболее распространенным вариантом. Однако шаг позволяет использовать более сложные макеты памяти.</span><span class="sxs-lookup"><span data-stu-id="cf479-199">Packed tensors are the most common case; but strides allow more complex memory layouts.</span></span>

## <a name="broadcasting-with-strides"></a><span data-ttu-id="cf479-200">Вещание с шагом</span><span class="sxs-lookup"><span data-stu-id="cf479-200">Broadcasting with strides</span></span>

<span data-ttu-id="cf479-201">Если размер буфера тензорные (в элементах) меньше, чем произведение его логических измерений, то следует перекрывать элементы.</span><span class="sxs-lookup"><span data-stu-id="cf479-201">If a tensor's buffer size (in elements) is smaller than the product of its logical dimensions, then it follows that there must be some overlapping of elements.</span></span> <span data-ttu-id="cf479-202">Обычно такая ситуация называется *вещание*; , где элементы измерения являются дубликатами другого измерения.</span><span class="sxs-lookup"><span data-stu-id="cf479-202">The usual case for this is known as *broadcasting*; where the elements of a dimension are a duplicate of another dimension.</span></span> <span data-ttu-id="cf479-203">Например, давайте вернемся к примеру 2D.</span><span class="sxs-lookup"><span data-stu-id="cf479-203">For example, let's revisit the 2D example.</span></span> <span data-ttu-id="cf479-204">Предположим, что нам нужен тензорные, который логически 2, но вторая строка идентична первой строке.</span><span class="sxs-lookup"><span data-stu-id="cf479-204">Let's say that we want a tensor that is logically 2x3, but the second row is identical to the first row.</span></span> <span data-ttu-id="cf479-205">Вот как это выглядит.</span><span class="sxs-lookup"><span data-stu-id="cf479-205">Here's how that looks.</span></span>

```console
A B C
A B C
```

<span data-ttu-id="cf479-206">Это можно сохранить в виде упакованного тензорные оборудования или строки.</span><span class="sxs-lookup"><span data-stu-id="cf479-206">This could be stored as a packed HW/row-major tensor.</span></span> <span data-ttu-id="cf479-207">Но более компактное хранилище будет содержать только 3 элемента (A, B и C) и использовать шаг высоты 0 вместо 3.</span><span class="sxs-lookup"><span data-stu-id="cf479-207">But a more compact storage would contain only 3 elements (A, B, and C) and use a height-stride of 0 instead of 3.</span></span> <span data-ttu-id="cf479-208">В этом случае физический размер тензорные — 3 элемента, а логический размер — 6 элементов.</span><span class="sxs-lookup"><span data-stu-id="cf479-208">In this case, the physical size of the tensor is 3 elements, but the logical size is 6 elements.</span></span>

<span data-ttu-id="cf479-209">Как правило, если шаг измерения равен 0, то все элементы в измерениях нижнего порядка повторяются в широковещательном измерении. Например, если тензорные имеет значение НЧВ и C-STRIDE имеет значение 0, то каждый канал имеет одинаковые значения в H и W.</span><span class="sxs-lookup"><span data-stu-id="cf479-209">In general, if the stride of a dimension is 0, then all elements in the lower-order dimensions are repeated along the broadcasted dimension; for example, if the tensor is NCHW and the C-stride is 0, then each channel has the same values along H and W.</span></span>

## <a name="padding-with-strides"></a><span data-ttu-id="cf479-210">Заполнение с шагом</span><span class="sxs-lookup"><span data-stu-id="cf479-210">Padding with strides</span></span>

<span data-ttu-id="cf479-211">Тензорные считается *заполненным* , если его физический размер превышает минимальный размер, необходимый для размещения его элементов.</span><span class="sxs-lookup"><span data-stu-id="cf479-211">A tensor is said to be *padded* if its physical size is larger than the minimum size needed to fit its elements.</span></span> <span data-ttu-id="cf479-212">Если нет широковещательных или перекрывающихся элементов, минимальный размер тензорные (в элементах) — это просто произведение его измерений.</span><span class="sxs-lookup"><span data-stu-id="cf479-212">When there is no broadcasting nor overlapping elements, the minimum size of the tensor (in elements) is simply the product of its dimensions.</span></span> <span data-ttu-id="cf479-213">Для `DMLCalcBufferTensorSize` вычисления *минимального* размера буфера для директмлных десятков можно использовать вспомогательную функцию (см. [вспомогательные функции директмл](dml-helper-functions.md) для получения списка этой функции).</span><span class="sxs-lookup"><span data-stu-id="cf479-213">You can use the helper function `DMLCalcBufferTensorSize` (see [DirectML helper functions](dml-helper-functions.md) for a listing of that function) to calculate the *minimum* buffer size for your DirectML tensors.</span></span>

<span data-ttu-id="cf479-214">Предположим, что буфер содержит следующие значения (элементы "x" обозначают значения заполнения).</span><span class="sxs-lookup"><span data-stu-id="cf479-214">Let's say that a buffer contains the following values (the 'x' elements indicate padding values).</span></span>

<span data-ttu-id="cf479-215">0</span><span class="sxs-lookup"><span data-stu-id="cf479-215">0</span></span>|<span data-ttu-id="cf479-216">1</span><span class="sxs-lookup"><span data-stu-id="cf479-216">1</span></span>|<span data-ttu-id="cf479-217">2</span><span class="sxs-lookup"><span data-stu-id="cf479-217">2</span></span>|<span data-ttu-id="cf479-218">3</span><span class="sxs-lookup"><span data-stu-id="cf479-218">3</span></span>|<span data-ttu-id="cf479-219">4</span><span class="sxs-lookup"><span data-stu-id="cf479-219">4</span></span>|<span data-ttu-id="cf479-220">5</span><span class="sxs-lookup"><span data-stu-id="cf479-220">5</span></span>|<span data-ttu-id="cf479-221">6</span><span class="sxs-lookup"><span data-stu-id="cf479-221">6</span></span>|<span data-ttu-id="cf479-222">7</span><span class="sxs-lookup"><span data-stu-id="cf479-222">7</span></span>|<span data-ttu-id="cf479-223">8</span><span class="sxs-lookup"><span data-stu-id="cf479-223">8</span></span>|<span data-ttu-id="cf479-224">9</span><span class="sxs-lookup"><span data-stu-id="cf479-224">9</span></span>|
-|-|-|-|-|-|-|-|-|-|
<span data-ttu-id="cf479-225">Объект</span><span class="sxs-lookup"><span data-stu-id="cf479-225">A</span></span>|<span data-ttu-id="cf479-226">B</span><span class="sxs-lookup"><span data-stu-id="cf479-226">B</span></span>|<span data-ttu-id="cf479-227">C</span><span class="sxs-lookup"><span data-stu-id="cf479-227">C</span></span>|<span data-ttu-id="cf479-228">x</span><span class="sxs-lookup"><span data-stu-id="cf479-228">x</span></span>|<span data-ttu-id="cf479-229">x</span><span class="sxs-lookup"><span data-stu-id="cf479-229">x</span></span>|<span data-ttu-id="cf479-230">D</span><span class="sxs-lookup"><span data-stu-id="cf479-230">D</span></span>|<span data-ttu-id="cf479-231">E</span><span class="sxs-lookup"><span data-stu-id="cf479-231">E</span></span>|<span data-ttu-id="cf479-232">F</span><span class="sxs-lookup"><span data-stu-id="cf479-232">F</span></span>|<span data-ttu-id="cf479-233">x</span><span class="sxs-lookup"><span data-stu-id="cf479-233">x</span></span>|<span data-ttu-id="cf479-234">x</span><span class="sxs-lookup"><span data-stu-id="cf479-234">x</span></span>

<span data-ttu-id="cf479-235">Заполненный тензорные можно описать с помощью параметра height-STRIDE 5 вместо 3.</span><span class="sxs-lookup"><span data-stu-id="cf479-235">The padded tensor can be described by using a height-stride of 5 instead of 3.</span></span> <span data-ttu-id="cf479-236">Вместо пошагового выполнения 3 элементов для перехода к следующей строке шаг состоит из 5 элементов (3 *реальных* элемента плюс 2 элемента заполнения).</span><span class="sxs-lookup"><span data-stu-id="cf479-236">Instead of stepping by 3 elements to get to the next row, the step is 5 elements (3 *real* elements plus 2 padding elements).</span></span> <span data-ttu-id="cf479-237">Заполнение является общим в компьютерных графиках, например, чтобы гарантировать, что изображение имеет два выравнивания.</span><span class="sxs-lookup"><span data-stu-id="cf479-237">Padding is common in computer graphics, for example, to ensure that an image has a power-of-two alignment.</span></span>

```console
A B C
D E F
```

## <a name="directml-buffer-tensor-descriptions"></a><span data-ttu-id="cf479-238">Описания тензорные буфера Директмл</span><span class="sxs-lookup"><span data-stu-id="cf479-238">DirectML buffer tensor descriptions</span></span>

<span data-ttu-id="cf479-239">Директмл может работать с различными физическими макетами тензорные, так как [структура **DML_BUFFER_TENSOR_DESC**](/windows/desktop/api/directml/ns-directml-dml_buffer_tensor_desc) имеет `Sizes` и элементы, и `Strides` .</span><span class="sxs-lookup"><span data-stu-id="cf479-239">DirectML can work with a variety of physical tensor layouts, since the [**DML_BUFFER_TENSOR_DESC** structure](/windows/desktop/api/directml/ns-directml-dml_buffer_tensor_desc) has both `Sizes` and `Strides` members.</span></span> <span data-ttu-id="cf479-240">Некоторые реализации операторов могут быть более эффективны с конкретным макетом, поэтому нередко меняется способ хранения тензорные данных для повышения производительности.</span><span class="sxs-lookup"><span data-stu-id="cf479-240">Some operator implementations might be more efficient with a specific layout, so it's not uncommon to change how tensor data is stored for better performance.</span></span>

<span data-ttu-id="cf479-241">Большинству операторов Директмл требуются десятки или 5D, а порядок значений размера и шага фиксирован.</span><span class="sxs-lookup"><span data-stu-id="cf479-241">Most DirectML operators require either 4D or 5D tensors, and the order of the sizes and strides values is fixed.</span></span> <span data-ttu-id="cf479-242">Исправив порядок размеров и значений STRIDE в описании тензорные, Директмл может вычислять различные физические макеты.</span><span class="sxs-lookup"><span data-stu-id="cf479-242">By fixing the order of the sizes and stride values in a tensor description, it's possible for DirectML to infer different physical layouts.</span></span>

<span data-ttu-id="cf479-243">**4D**</span><span class="sxs-lookup"><span data-stu-id="cf479-243">**4D**</span></span>
- <span data-ttu-id="cf479-244">[**DML_BUFFER_TENSOR_DESC:: sizes**](/windows/desktop/api/directml/ns-directml-dml_buffer_tensor_desc) = {N-size, C-size, H-size, W-size}</span><span class="sxs-lookup"><span data-stu-id="cf479-244">[**DML_BUFFER_TENSOR_DESC::Sizes**](/windows/desktop/api/directml/ns-directml-dml_buffer_tensor_desc) = { N-size, C-size, H-size, W-size }</span></span>
- <span data-ttu-id="cf479-245">[**DML_BUFFER_TENSOR_DESC:: STRIDE**](/windows/desktop/api/directml/ns-directml-dml_buffer_tensor_desc) = {N-STRIDE, C-STRIDE, H-STRIDE, W-STRIDE}</span><span class="sxs-lookup"><span data-stu-id="cf479-245">[**DML_BUFFER_TENSOR_DESC::Strides**](/windows/desktop/api/directml/ns-directml-dml_buffer_tensor_desc) = { N-stride, C-stride, H-stride, W-stride }</span></span>

<span data-ttu-id="cf479-246">**d**</span><span class="sxs-lookup"><span data-stu-id="cf479-246">**5D**</span></span>
- <span data-ttu-id="cf479-247">**DML_BUFFER_TENSOR_DESC:: sizes** = {N-size, C — размер, D-размер, H-размер, W-size}</span><span class="sxs-lookup"><span data-stu-id="cf479-247">**DML_BUFFER_TENSOR_DESC::Sizes** = { N-size, C-size, D-size, H-size, W-size }</span></span>
- <span data-ttu-id="cf479-248">**DML_BUFFER_TENSOR_DESC:: STRIDE** = {N-STRIDE, C-STRIDE, D-STRIDE, H-STRIDE, W-STRIDE}</span><span class="sxs-lookup"><span data-stu-id="cf479-248">**DML_BUFFER_TENSOR_DESC::Strides** = { N-stride, C-stride, D-stride, H-stride, W-stride }</span></span>

<span data-ttu-id="cf479-249">Если оператору Директмл требуется объект 4D или a 5D тензорные, но фактические данные имеют меньший ранг (например, 2D), то ведущие измерения должны быть заполнены единицами.</span><span class="sxs-lookup"><span data-stu-id="cf479-249">If a DirectML operator requires a 4D or a 5D tensor, but the actual data has a smaller rank (for example, 2D), then the leading dimensions should be filled with 1s.</span></span> <span data-ttu-id="cf479-250">Например, "HW" тензорные задается с помощью **DML_BUFFER_TENSOR_DESC:: sizes** = {1, 1, H, W}.</span><span class="sxs-lookup"><span data-stu-id="cf479-250">For example, an "HW" tensor is set using **DML_BUFFER_TENSOR_DESC::Sizes** = { 1, 1, H, W }.</span></span>

<span data-ttu-id="cf479-251">Если данные тензорные хранятся в НЧВ/НКДХВ, то нет необходимости задавать **DML_BUFFER_TENSOR_DESC:: STRIDE**, если только не требуется вещание или заполнение.</span><span class="sxs-lookup"><span data-stu-id="cf479-251">If tensor data is stored in NCHW/NCDHW, then it's not necessary to set **DML_BUFFER_TENSOR_DESC::Strides**, unless you want broadcasting or padding.</span></span> <span data-ttu-id="cf479-252">Можно задать для поля STRIDE значение `nullptr` .</span><span class="sxs-lookup"><span data-stu-id="cf479-252">You can set the strides field to `nullptr`.</span></span> <span data-ttu-id="cf479-253">Однако если данные тензорные хранятся в другом макете, например НХВК, то для выражения преобразования из НЧВ в этот макет необходимо выполнить шаг.</span><span class="sxs-lookup"><span data-stu-id="cf479-253">However, if the tensor data is stored in another layout, such as NHWC, then you need strides in order to express the transformation from NCHW to that layout.</span></span>

<span data-ttu-id="cf479-254">Для простого примера рассмотрим описание 2D-тензорные с высотой 3 и шириной 5.</span><span class="sxs-lookup"><span data-stu-id="cf479-254">For a simple example, consider the description of a 2D tensor with height 3 and width 5.</span></span>

<span data-ttu-id="cf479-255">**Упакованный НЧВ (неявный шаг)**</span><span class="sxs-lookup"><span data-stu-id="cf479-255">**Packed NCHW (implicit strides)**</span></span>
- <span data-ttu-id="cf479-256">**DML_BUFFER_TENSOR_DESC:: sizes** = {1, 1, 3, 5}</span><span class="sxs-lookup"><span data-stu-id="cf479-256">**DML_BUFFER_TENSOR_DESC::Sizes** = { 1, 1, 3, 5 }</span></span>
- <span data-ttu-id="cf479-257">**DML_BUFFER_TENSOR_DESC:: STRIDE** = `nullptr`</span><span class="sxs-lookup"><span data-stu-id="cf479-257">**DML_BUFFER_TENSOR_DESC::Strides** = `nullptr`</span></span>

<span data-ttu-id="cf479-258">**Упакованный НЧВ (явный шаг)**</span><span class="sxs-lookup"><span data-stu-id="cf479-258">**Packed NCHW (explicit strides)**</span></span>
- <span data-ttu-id="cf479-259">N-STRIDE = C-size \* H-Размер \* W-size = 1 \* 3 \* 5 = 15</span><span class="sxs-lookup"><span data-stu-id="cf479-259">N-stride = C-size \* H-size \* W-size = 1 \* 3 \* 5 = 15</span></span>
- <span data-ttu-id="cf479-260">C-STRIDE = H-size \* W-size = 3 \* 5 = 15</span><span class="sxs-lookup"><span data-stu-id="cf479-260">C-stride = H-size \* W-size = 3 \* 5 = 15</span></span>
- <span data-ttu-id="cf479-261">H-STRIDE = W-size = 5</span><span class="sxs-lookup"><span data-stu-id="cf479-261">H-stride = W-size = 5</span></span>
- <span data-ttu-id="cf479-262">W-STRIDE = 1</span><span class="sxs-lookup"><span data-stu-id="cf479-262">W-stride = 1</span></span>
- <span data-ttu-id="cf479-263">**DML_BUFFER_TENSOR_DESC:: sizes** = {1, 1, 3, 5}</span><span class="sxs-lookup"><span data-stu-id="cf479-263">**DML_BUFFER_TENSOR_DESC::Sizes** = { 1, 1, 3, 5 }</span></span>
- <span data-ttu-id="cf479-264">**DML_BUFFER_TENSOR_DESC:: STRIDE** = {15, 15, 5, 1}</span><span class="sxs-lookup"><span data-stu-id="cf479-264">**DML_BUFFER_TENSOR_DESC::Strides** = { 15, 15, 5, 1 }</span></span>

<span data-ttu-id="cf479-265">**Упакованная НХВК**</span><span class="sxs-lookup"><span data-stu-id="cf479-265">**Packed NHWC**</span></span>
- <span data-ttu-id="cf479-266">N-STRIDE = H-Размер \* W-size \* C-size = 3 \* 5 \* 1 = 15</span><span class="sxs-lookup"><span data-stu-id="cf479-266">N-stride = H-size \* W-size \* C-size = 3 \* 5 \* 1 = 15</span></span>
- <span data-ttu-id="cf479-267">H-STRIDE = W-size \* C-size = 5 \* 1 = 5</span><span class="sxs-lookup"><span data-stu-id="cf479-267">H-stride = W-size \* C-size = 5 \* 1 = 5</span></span>
- <span data-ttu-id="cf479-268">W-STRIDE = C-size = 1</span><span class="sxs-lookup"><span data-stu-id="cf479-268">W-stride = C-size = 1</span></span>
- <span data-ttu-id="cf479-269">C-STRIDE = 1</span><span class="sxs-lookup"><span data-stu-id="cf479-269">C-stride = 1</span></span>
- <span data-ttu-id="cf479-270">**DML_BUFFER_TENSOR_DESC:: sizes** = {1, 1, 3, 5}</span><span class="sxs-lookup"><span data-stu-id="cf479-270">**DML_BUFFER_TENSOR_DESC::Sizes** = { 1, 1, 3, 5 }</span></span>
- <span data-ttu-id="cf479-271">**DML_BUFFER_TENSOR_DESC:: STRIDE** = {15, 1, 5, 1}</span><span class="sxs-lookup"><span data-stu-id="cf479-271">**DML_BUFFER_TENSOR_DESC::Strides** = { 15, 1, 5, 1 }</span></span>

## <a name="see-also"></a><span data-ttu-id="cf479-272">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="cf479-272">See also</span></span>

* [<span data-ttu-id="cf479-273">Вспомогательные функции Директмл</span><span class="sxs-lookup"><span data-stu-id="cf479-273">DirectML helper functions</span></span>](dml-helper-functions.md)
* [<span data-ttu-id="cf479-274">Структура DML_BUFFER_TENSOR_DESC</span><span class="sxs-lookup"><span data-stu-id="cf479-274">DML_BUFFER_TENSOR_DESC structure</span></span>](/windows/desktop/api/directml/ns-directml-dml_buffer_tensor_desc)
