---
title: Цепочки переключения
description: Цепи переключения управляют поворотом заднего буфера, формируя основание графической анимации.
ms.assetid: AABF5FDE-DB49-4B29-BC0E-032E0C7DF9EB
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ebbc7ec1b62ba620b42bc85c1c1f491ff7ba952d
ms.sourcegitcommit: 5b98bf8c68922f8f03c14f793fbe17504900559c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/12/2021
ms.locfileid: "104548983"
---
# <a name="swap-chains"></a><span data-ttu-id="9278c-103">Цепочки переключения</span><span class="sxs-lookup"><span data-stu-id="9278c-103">Swap Chains</span></span>

<span data-ttu-id="9278c-104">Цепи переключения управляют поворотом заднего буфера, формируя основание графической анимации.</span><span class="sxs-lookup"><span data-stu-id="9278c-104">Swap chains control the back buffer rotation, forming the basis of graphics animation.</span></span>

## <a name="overview"></a><span data-ttu-id="9278c-105">Обзор</span><span class="sxs-lookup"><span data-stu-id="9278c-105">Overview</span></span>

<span data-ttu-id="9278c-106">Модель программирования для цепочек подкачки в Direct3D 12 не совпадает с моделью в более ранних версиях D3D.</span><span class="sxs-lookup"><span data-stu-id="9278c-106">The programming model for swap chains in Direct3D 12 is not identical to that in earlier versions of D3D.</span></span> <span data-ttu-id="9278c-107">Удобство программирования, например, для поддержки автоматического вращения ресурсов, которое присутствовало в D3D10 и D3D11, теперь не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="9278c-107">The programming convenience, for example, of supporting automatic resource rotation that was present in D3D10 and D3D11 is not now supported.</span></span> <span data-ttu-id="9278c-108">Автоматические приложения с включенным поворотом ресурсов отображают один и тот же объект API, в то время как фактически отображаемая поверхность изменяет каждый кадр.</span><span class="sxs-lookup"><span data-stu-id="9278c-108">Automatic resource rotation enabled apps to render the same API object while the actual surface being rendered changes each frame.</span></span> <span data-ttu-id="9278c-109">Поведение цепочек подкачки изменяется с помощью Direct3D 12, чтобы другие функции Direct3D 12 могли снизить нагрузку ЦП.</span><span class="sxs-lookup"><span data-stu-id="9278c-109">The behavior of swap chains is changed with Direct3D 12 to enable other features of Direct3D 12 to have low CPU overhead.</span></span> <span data-ttu-id="9278c-110">Автоматический цветовой ключ и множественная выборка не поддерживаются, хотя, по-прежнему, выполняется растяжение и вращение.</span><span class="sxs-lookup"><span data-stu-id="9278c-110">Automatic color key and multisampling are not supported, although notably stretching and rotation still are.</span></span>

### <a name="buffer-lifetime"></a><span data-ttu-id="9278c-111">Время существования буфера</span><span class="sxs-lookup"><span data-stu-id="9278c-111">Buffer lifetime</span></span>

<span data-ttu-id="9278c-112">Приложения могут хранить предварительно созданные дескрипторы, ссылающиеся на обратные буферы. это можно сделать, убедившись, что набор буферов, принадлежащих цепи подкачки, никогда не изменится в течение времени существования цепочки буфера обмена.</span><span class="sxs-lookup"><span data-stu-id="9278c-112">Apps are allowed to store pre-created descriptors which reference back buffers This is enabled by ensuring that the set of buffers owned by a swap chain never changes for the lifetime of the swap chain.</span></span> <span data-ttu-id="9278c-113">Набор буферов, возвращаемых функцией [**идксгисвапчаин::-buffer**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-getbuffer) , не изменяется, пока не вызваны определенные API:</span><span class="sxs-lookup"><span data-stu-id="9278c-113">The set of buffers returned by [**IDXGISwapChain::GetBuffer**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-getbuffer) doesn't change until certain APIs are called:</span></span>

-   [<span data-ttu-id="9278c-114">**Идксгисвапчаин:: Ресизетаржет**</span><span class="sxs-lookup"><span data-stu-id="9278c-114">**IDXGISwapChain::ResizeTarget**</span></span>](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget)
-   [<span data-ttu-id="9278c-115">**Идксгисвапчаин:: Ресизебуфферс**</span><span class="sxs-lookup"><span data-stu-id="9278c-115">**IDXGISwapChain::ResizeBuffers**</span></span>](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers)

<span data-ttu-id="9278c-116">Порядок буферов, возвращаемых методом [**buffer, никогда не**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-getbuffer) изменяется.</span><span class="sxs-lookup"><span data-stu-id="9278c-116">The order of buffers returned by [**GetBuffer**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-getbuffer) never changes.</span></span>

<span data-ttu-id="9278c-117">[**IDXGISwapChain3:: жеткуррентбаккбуффериндекс**](/windows/desktop/api/dxgi1_4/nf-dxgi1_4-idxgiswapchain3-getcurrentbackbufferindex) возвращает индекс текущего заднего буфера приложения.</span><span class="sxs-lookup"><span data-stu-id="9278c-117">[**IDXGISwapChain3::GetCurrentBackBufferIndex**](/windows/desktop/api/dxgi1_4/nf-dxgi1_4-idxgiswapchain3-getcurrentbackbufferindex) returns the index of the current back buffer to the app.</span></span>

### <a name="swap-effects"></a><span data-ttu-id="9278c-118">Переключить эффекты</span><span class="sxs-lookup"><span data-stu-id="9278c-118">Swap effects</span></span>

<span data-ttu-id="9278c-119">Единственными поддерживаемыми эффектами переключения являются [**DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL**](/windows/win32/api/dxgi/ne-dxgi-dxgi_swap_effect) и [**DXGI_SWAP_EFFECT_FLIP_DISCARD**](/windows/win32/api/dxgi/ne-dxgi-dxgi_swap_effect), для которых количество буферов должно быть больше единицы.</span><span class="sxs-lookup"><span data-stu-id="9278c-119">The only supported swap effects are [**DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL**](/windows/win32/api/dxgi/ne-dxgi-dxgi_swap_effect) and [**DXGI_SWAP_EFFECT_FLIP_DISCARD**](/windows/win32/api/dxgi/ne-dxgi-dxgi_swap_effect), which requires the buffer count to be greater than one.</span></span>

### <a name="transitioning-between-windowed-and-full-screen-modes"></a><span data-ttu-id="9278c-120">Переход между оконным и полноэкранным режимами</span><span class="sxs-lookup"><span data-stu-id="9278c-120">Transitioning between windowed and full-screen modes</span></span>

<span data-ttu-id="9278c-121">Direct3D 12 не поддерживает полноэкранный монопольный режим (FSE).</span><span class="sxs-lookup"><span data-stu-id="9278c-121">Direct3D 12 doesn't support full-screen exclusive mode (FSE).</span></span> <span data-ttu-id="9278c-122">Вместо этого, когда игра является единственным видимым приложением на экране, в операционной системе используется стратегия, называемая полноэкранными оптимизациями (FSO), для достижения аналогичного результата работы программы FSE без снижения производительности.</span><span class="sxs-lookup"><span data-stu-id="9278c-122">Instead, when a game is the only visible application on-screen, the OS uses a strategy called full-screen optimisations (FSO) to achieve a similar effect to FSE without the performance drawbacks.</span></span> <span data-ttu-id="9278c-123">Дополнительные сведения о FSO см. в разделе [пояснения к полноэкранным оптимизациям](https://devblogs.microsoft.com/directx/demystifying-full-screen-optimizations/).</span><span class="sxs-lookup"><span data-stu-id="9278c-123">For more info about FSO, see [Demystifying Fullscreen Optimisations](https://devblogs.microsoft.com/directx/demystifying-full-screen-optimizations/).</span></span>

<span data-ttu-id="9278c-124">Direct3D 12 поддерживает ограничение, которое приложения должны вызывать [**ресизебуфферс**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers) после перехода между оконным и полноэкранным режимами (ЦЕПОЧКи D3D11 перелистывания моделей имеют те же ограничения).</span><span class="sxs-lookup"><span data-stu-id="9278c-124">Direct3D 12 maintains the restriction that applications must call [**ResizeBuffers**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers) after transitioning between windowed and full-screen modes (D3D11 flip-model swap chains have the same restrictions).</span></span>

<span data-ttu-id="9278c-125">Переходы [**идксгисвапчаин:: сетфуллскринстате**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate) не изменяют набор видимых для приложения буферов в цепочке буфера обмена.</span><span class="sxs-lookup"><span data-stu-id="9278c-125">The [**IDXGISwapChain::SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate) transitions do not change the set of app-visible buffers in the swap chain.</span></span> <span data-ttu-id="9278c-126">Только [**ресизебуфферс**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers) и [**ресизетаржет**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget) вызывают создание или удаление видимых для приложения буферов.</span><span class="sxs-lookup"><span data-stu-id="9278c-126">Only the [**ResizeBuffers**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers) and [**ResizeTarget**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget) calls create or destroy app-visible buffers.</span></span> <span data-ttu-id="9278c-127">Однако в Direct3D 12 [**идксгисвапчаин:: сетфуллскринстате**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate) не переходит в полноэкранный режим монопольного доступа и просто изменяет разрешения и скорости обновления, чтобы разрешить полноэкранное ускорение.</span><span class="sxs-lookup"><span data-stu-id="9278c-127">However, in Direct3D 12 [**IDXGISwapChain::SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate) doesn't enter full-screen exclusive mode, and simply changes resolutions and refresh rates to allow full-screen optimisations.</span></span> <span data-ttu-id="9278c-128">Эти изменения могут выполняться приложением без использования этого метода.</span><span class="sxs-lookup"><span data-stu-id="9278c-128">These changes can be made by an app without the use of this method</span></span>

<span data-ttu-id="9278c-129">Когда или [**идксгисвапчаин::P**](/windows/win32/api/dxgi/nf-dxgi-idxgiswapchain-present) повторная отправка или [**IDXGISwapChain1:P:**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgiswapchain1-present1) вызывается повторная отправка, возвращенный буфер должен находиться в [**состоянии \_ ресурса \_ \_ D3D12**](/windows/desktop/api/d3d12/ne-d3d12-d3d12_resource_states) .</span><span class="sxs-lookup"><span data-stu-id="9278c-129">When or [**IDXGISwapChain::Present**](/windows/win32/api/dxgi/nf-dxgi-idxgiswapchain-present) or [**IDXGISwapChain1::Present**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgiswapchain1-present1) is called, the back buffer to be presented must be in the [**D3D12\_RESOURCE\_STATE\_PRESENT**](/windows/desktop/api/d3d12/ne-d3d12-d3d12_resource_states) state.</span></span> <span data-ttu-id="9278c-130">Present завершается с **ошибкой \_ \_ Недопустимый \_ вызов функции DXGI** , если это не так.</span><span class="sxs-lookup"><span data-stu-id="9278c-130">Present will fail with **DXGI\_ERROR\_INVALID\_CALL** if this is not the case.</span></span>

<span data-ttu-id="9278c-131">Цепочки полноэкранного переключения по-прежнему имеют ограничение, которое [**сетфуллскринстате**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate)(false, null) должно быть вызвано до окончательного выпуска цепочки буферов.</span><span class="sxs-lookup"><span data-stu-id="9278c-131">Full-screen swap chains continue to have the restriction that [**SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate)(FALSE, NULL) must be called before the final release of the swap chain.</span></span> <span data-ttu-id="9278c-132">**Сетфуллскринстате**(false) в цепочках подкачки, выполняющихся на устройствах Direct3D 12, проходит.</span><span class="sxs-lookup"><span data-stu-id="9278c-132">**SetFullscreenState**(FALSE) succeeds on swap chains running on Direct3D 12 devices.</span></span>

<span data-ttu-id="9278c-133">Операции, выполняемые в трехмерной очереди, задаются при создании имеющуюся цепочку буферов, а приложения могут параллельно представлять несколько цепочек переключения, а также записывать и выполнять списки команд.</span><span class="sxs-lookup"><span data-stu-id="9278c-133">Present operations occur on the 3D queue provided at swapchain creation, and apps are free to concurrently present multiple swap chains, and record and execute command lists.</span></span>

<span data-ttu-id="9278c-134">Когда окончательная часть графической работы (например, поэтапная обработка кадров) выполняется в очереди вычислений или не участвует в очереди графики устройства, создание второй объемной очереди для отображения в может оказаться полезным и предотвратить задержку показа в начале следующего кадра.</span><span class="sxs-lookup"><span data-stu-id="9278c-134">When the final part of the graphics work (for example, frame postprocessing) is done on a compute queue, or doesn't involve the device's graphics queue, creating a second 3D queue to present on can be beneficial and prevent the latency of presentation delaying the start of the next frame.</span></span> 

### <a name="example"></a><span data-ttu-id="9278c-135">Пример</span><span class="sxs-lookup"><span data-stu-id="9278c-135">Example</span></span>

<span data-ttu-id="9278c-136">Следующий пример кода будет представлен в основном цикле визуализации:</span><span class="sxs-lookup"><span data-stu-id="9278c-136">The following example code would be present in the main rendering loop:</span></span>

```cpp
void Present()
{
    m_swapChain->Present(0, m_presentFlags);
    m_backBufferIndex = (m_backBufferIndex + 1) % m_backBufferCount;
}
```

### <a name="creating-swap-chains"></a><span data-ttu-id="9278c-137">Создание цепочек подкачки</span><span class="sxs-lookup"><span data-stu-id="9278c-137">Creating swap chains</span></span>

<span data-ttu-id="9278c-138">При использовании вызовов [**креатесвапчаинфорхвнд**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforhwnd), [**креатесвапчаинфоркоревиндов**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforcorewindow)или [**креатесвапчаинфоркомпоситион**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforcomposition) Обратите внимание, что параметр *pDevice* на самом деле требует наличия указателя на прямую командную очередь в Direct3D 12, а не на устройстве.</span><span class="sxs-lookup"><span data-stu-id="9278c-138">When using the [**CreateSwapChainForHwnd**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforhwnd), [**CreateSwapChainForCoreWindow**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforcorewindow), or [**CreateSwapChainForComposition**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforcomposition) calls, note that the *pDevice* parameter actually requires a pointer to a direct command queue in Direct3D 12, and not a device.</span></span>

### <a name="presenting-on-windows-7"></a><span data-ttu-id="9278c-139">Представление в Windows 7</span><span class="sxs-lookup"><span data-stu-id="9278c-139">Presenting on Windows 7</span></span>

<span data-ttu-id="9278c-140">При использовании Direct3D 12 в Windows 7 необходимые типы DXGI для Direct3D 12 отсутствуют, поэтому необходимо использовать предоставленный D3D12On7 **ID3D12CommandQueueDownLevel** (запрашивается из прямой очереди команд) для представления.</span><span class="sxs-lookup"><span data-stu-id="9278c-140">When targeting Direct3D 12 on Windows 7, the necessary DXGI types for Direct3D 12 are not present, so you must use the D3D12On7-provided **ID3D12CommandQueueDownLevel** (queried off of the direct command queue) to present.</span></span>

<span data-ttu-id="9278c-141">Вы предоставляете список открытых команд для метода Windows 7 Present, который затем будет использоваться, закрыт и автоматически отправлен на устройство.</span><span class="sxs-lookup"><span data-stu-id="9278c-141">You provide an open command list to the Windows 7 present method, which will then be used, closed, and automatically submitted to the device for you.</span></span> <span data-ttu-id="9278c-142">Необходимо указать задний буфер, который должен быть создан приложением, должен быть зафиксированным ресурсом, должен быть единственным образцом и должен иметь один из следующих форматов.</span><span class="sxs-lookup"><span data-stu-id="9278c-142">You must provide a back buffer which must be app-created, must be a committed resource, must be single-sampled, and must be one of the following formats.</span></span>

* <span data-ttu-id="9278c-143">**DXGI_FORMAT_R16G16B16A16_FLOAT**</span><span class="sxs-lookup"><span data-stu-id="9278c-143">**DXGI_FORMAT_R16G16B16A16_FLOAT**</span></span>
* <span data-ttu-id="9278c-144">**DXGI_FORMAT_R10G10B10A2_UNORM**</span><span class="sxs-lookup"><span data-stu-id="9278c-144">**DXGI_FORMAT_R10G10B10A2_UNORM**</span></span>
* <span data-ttu-id="9278c-145">**DXGI_FORMAT_R8G8B8A8_UNORM**</span><span class="sxs-lookup"><span data-stu-id="9278c-145">**DXGI_FORMAT_R8G8B8A8_UNORM**</span></span>
* <span data-ttu-id="9278c-146">**DXGI_FORMAT_R8G8B8A8_UNORM_SRGB**</span><span class="sxs-lookup"><span data-stu-id="9278c-146">**DXGI_FORMAT_R8G8B8A8_UNORM_SRGB**</span></span>
* <span data-ttu-id="9278c-147">**DXGI_FORMAT_B8G8R8X8_UNORM**</span><span class="sxs-lookup"><span data-stu-id="9278c-147">**DXGI_FORMAT_B8G8R8X8_UNORM**</span></span>
* <span data-ttu-id="9278c-148">**DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM**</span><span class="sxs-lookup"><span data-stu-id="9278c-148">**DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM**</span></span>
* <span data-ttu-id="9278c-149">**DXGI_FORMAT_B8G8R8A8_UNORM**</span><span class="sxs-lookup"><span data-stu-id="9278c-149">**DXGI_FORMAT_B8G8R8A8_UNORM**</span></span>
* <span data-ttu-id="9278c-150">**DXGI_FORMAT_B8G8R8A8_UNORM_SRGB**</span><span class="sxs-lookup"><span data-stu-id="9278c-150">**DXGI_FORMAT_B8G8R8A8_UNORM_SRGB**</span></span>

## <a name="related-topics"></a><span data-ttu-id="9278c-151">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="9278c-151">Related topics</span></span>

* [<span data-ttu-id="9278c-152">D3D12_HEAP_FLAGS</span><span class="sxs-lookup"><span data-stu-id="9278c-152">D3D12_HEAP_FLAGS</span></span>](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags)
* [<span data-ttu-id="9278c-153">Видеоучебники по расширенному обучению DirectX: нерегулируемая частота кадров</span><span class="sxs-lookup"><span data-stu-id="9278c-153">DirectX advanced learning video tutorials : Unthrottled Framerate</span></span>](https://www.youtube.com/watch?v=wn02zCXa9IU)
* [<span data-ttu-id="9278c-154">Отрисовка</span><span class="sxs-lookup"><span data-stu-id="9278c-154">Rendering</span></span>](rendering.md)
