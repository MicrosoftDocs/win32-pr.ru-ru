---
title: Общие кучи
description: Общий доступ удобен для многопроцессных и многоадаптерных архитектур.
ms.assetid: 67C6B1D4-BF76-45A9-BADC-7C9520C900EB
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9f4271055f88e38484041c225b6b17c6d75f0d98
ms.sourcegitcommit: d6102d9e2b26368142fe5b006c65acb50c98be65
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/26/2019
ms.locfileid: "74104929"
---
# <a name="shared-heaps"></a><span data-ttu-id="14cda-103">Общие кучи</span><span class="sxs-lookup"><span data-stu-id="14cda-103">Shared Heaps</span></span>

<span data-ttu-id="14cda-104">Общий доступ удобен для многопроцессных и многоадаптерных архитектур.</span><span class="sxs-lookup"><span data-stu-id="14cda-104">Sharing is useful for multi-process and multi-adapter architectures.</span></span>

-   [<span data-ttu-id="14cda-105">Общие сведения о совместном использовании</span><span class="sxs-lookup"><span data-stu-id="14cda-105">Sharing overview</span></span>](#sharing-overview)
-   [<span data-ttu-id="14cda-106">Совместное использование куч в процессах</span><span class="sxs-lookup"><span data-stu-id="14cda-106">Sharing heaps across processes</span></span>](#sharing-heaps-across-processes)
-   [<span data-ttu-id="14cda-107">Совместное использование куч в адаптерах</span><span class="sxs-lookup"><span data-stu-id="14cda-107">Sharing heaps across adapters</span></span>](#sharing-heaps-across-adapters)
-   [<span data-ttu-id="14cda-108">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="14cda-108">Related topics</span></span>](#related-topics)

## <a name="sharing-overview"></a><span data-ttu-id="14cda-109">Общие сведения о совместном использовании</span><span class="sxs-lookup"><span data-stu-id="14cda-109">Sharing overview</span></span>

<span data-ttu-id="14cda-110">Общие кучи позволяют выполнять два действия: совместное использование данных в одной или нескольких процессах и исключает Недетерминированный вариант неопределенного макета текстуры для ресурсов, помещенных в кучу.</span><span class="sxs-lookup"><span data-stu-id="14cda-110">Shared heaps enable two things: sharing data in a heap across one or more processes, and precluding a non-deterministic choice of undefined texture layout for resources placed within the heap.</span></span> <span data-ttu-id="14cda-111">Совместное использование куч несколькими адаптерами также устраняет необходимость в передаче ЦП данных.</span><span class="sxs-lookup"><span data-stu-id="14cda-111">Sharing heaps across adapters also removes the need for CPU marshaling of the data.</span></span>

<span data-ttu-id="14cda-112">Можно совместно использовать обе кучи и зафиксированные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="14cda-112">Both heaps and committed resources can be shared.</span></span> <span data-ttu-id="14cda-113">Общий доступ к зафиксированному ресурсу фактически предоставляет неявную кучу вместе с описанием зафиксированного ресурса, так что совместимое описание ресурса может быть сопоставлено с кучей с другого устройства.</span><span class="sxs-lookup"><span data-stu-id="14cda-113">Sharing a committed resource actually shares the implicit heap along with the committed resource description, such that a compatible resource description can be mapped to the heap from another device.</span></span>

<span data-ttu-id="14cda-114">Все методы являются свободными потоками и наследуют существующую семантику D3D11 в проектировании совместного использования маркеров NT.</span><span class="sxs-lookup"><span data-stu-id="14cda-114">All methods are free-threaded and inherit the existing D3D11 semantics of the NT handle sharing design.</span></span>

-   [<span data-ttu-id="14cda-115">**ID3D12Device:: Креатешаредхандле**</span><span class="sxs-lookup"><span data-stu-id="14cda-115">**ID3D12Device::CreateSharedHandle**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createsharedhandle)
-   [<span data-ttu-id="14cda-116">**ID3D12Device:: Опеншаредхандле**</span><span class="sxs-lookup"><span data-stu-id="14cda-116">**ID3D12Device::OpenSharedHandle**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-opensharedhandle)
-   [<span data-ttu-id="14cda-117">**ID3D12Device:: Опеншаредхандлебинаме**</span><span class="sxs-lookup"><span data-stu-id="14cda-117">**ID3D12Device::OpenSharedHandleByName**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-opensharedhandlebyname)

## <a name="sharing-heaps-across-processes"></a><span data-ttu-id="14cda-118">Совместное использование куч в процессах</span><span class="sxs-lookup"><span data-stu-id="14cda-118">Sharing heaps across processes</span></span>

<span data-ttu-id="14cda-119">Общие кучи указываются с помощью \_ \_ флага кучи D3D12 \_ Shared Member в перечислении [**\_ \_ флагов кучи D3D12**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) .</span><span class="sxs-lookup"><span data-stu-id="14cda-119">Shared heaps are specified with the D3D12\_HEAP\_FLAG\_SHARED member of the [**D3D12\_HEAP\_FLAGS**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) enum.</span></span>

<span data-ttu-id="14cda-120">Общие кучи не поддерживаются в кучах, доступных для ЦП: \_ \_ Отправка типа кучи D3D12 \_ , \_ тип D3D12 \_ \_ реадбакк и \_ тип кучи D3D12 \_ \_ Custom без \_ Свойства страницы D3D12 ЦП \_ \_ \_ \_ недоступны.</span><span class="sxs-lookup"><span data-stu-id="14cda-120">Shared heaps are not supported on CPU-accessible heaps: D3D12\_HEAP\_TYPE\_UPLOAD, D3D12\_HEAP\_TYPE\_READBACK, and D3D12\_HEAP\_TYPE\_CUSTOM without D3D12\_CPU\_PAGE\_PROPERTY\_NOT\_AVAILABLE.</span></span>

<span data-ttu-id="14cda-121">Отсутствие детерминированного выбора неопределенного макета текстуры может значительно отрушить работу сценариев отложенной отрисовки на некоторых графических процессорах, поэтому он не является поведением по умолчанию для размещенных и зафиксированных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="14cda-121">Precluding a non-deterministic choice of undefined texture layout can significantly impair deferred rendering scenarios on some GPUs, so it is not the default behavior for placed and committed resources.</span></span> <span data-ttu-id="14cda-122">Отложенная отрисовка не связана с некоторыми архитектурами GPU, так как детерминированные макеты текстур уменьшают эффективную пропускную способность памяти при одновременной отрисовке на несколько текстур целевых изображений одного и того же формата и размера.</span><span class="sxs-lookup"><span data-stu-id="14cda-122">Deferred rendering is impaired on some GPU architectures because deterministic texture layouts decrease the effective memory bandwidth achieved when rendering simultaneously to multiple render target textures of the same format and size.</span></span> <span data-ttu-id="14cda-123">Архитектуры GPU развиваются от использования недетерминированных макетов текстур для поддержки стандартизованных шаблонов свиззле и оптимальных стандартизированных макетов для отложенной отрисовки.</span><span class="sxs-lookup"><span data-stu-id="14cda-123">GPU architectures are evolving away from leveraging non-deterministic texture layouts in order to support standardized swizzle patterns and standardized layouts efficiently for deferred rendering.</span></span>

<span data-ttu-id="14cda-124">Общие кучи также поставляются с другими небольшими затратами:</span><span class="sxs-lookup"><span data-stu-id="14cda-124">Shared heaps come with other minor costs as well:</span></span>

-   <span data-ttu-id="14cda-125">Данные общей кучи не могут быть повторно запущены в виде гибких куч из-за проблем раскрытия информации, поэтому физическая память чаще всего зеро'ед.</span><span class="sxs-lookup"><span data-stu-id="14cda-125">Shared heap data cannot be recycled as flexibly as in-process heaps due to information disclosure concerns, so physical memory is zero'ed more often.</span></span>
-   <span data-ttu-id="14cda-126">При создании и уничтожении общих куч возникает незначительная дополнительная нагрузка на ЦП и повышение использования системной памяти.</span><span class="sxs-lookup"><span data-stu-id="14cda-126">There is a minor additional CPU overhead and increased system memory usage during creation and destruction of shared heaps.</span></span>

## <a name="sharing-heaps-across-adapters"></a><span data-ttu-id="14cda-127">Совместное использование куч в адаптерах</span><span class="sxs-lookup"><span data-stu-id="14cda-127">Sharing heaps across adapters</span></span>

<span data-ttu-id="14cda-128">Общие кучи для адаптеров указываются с помощью \_ \_ \_ элемента Shared Cross Adapter флага кучи D3D12 \_ \_ в перечислении [**\_ \_ флагов кучи D3D12**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) .</span><span class="sxs-lookup"><span data-stu-id="14cda-128">Shared heaps across adapters is specified with the D3D12\_HEAP\_FLAG\_SHARED\_CROSS\_ADAPTER member of the [**D3D12\_HEAP\_FLAGS**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) enum.</span></span>

<span data-ttu-id="14cda-129">Общие кучи перекрестных адаптеров позволяют нескольким адаптерам совместно использовать данные без использования ЦП, который маршалирует данные между ними.</span><span class="sxs-lookup"><span data-stu-id="14cda-129">Cross adapter shared heaps enable multiple adapters to share data without the CPU marshaling the data between them.</span></span> <span data-ttu-id="14cda-130">В то время как различные возможности адаптера определяют, как эффективные адаптеры могут передавать данные между ними, просто включение копий GPU увеличивает эффективность пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="14cda-130">While varying adapter capabilities determine how efficient adapters can pass data between them, merely enabling GPU copies increases the effective bandwidth achieved.</span></span> <span data-ttu-id="14cda-131">Некоторые макеты текстур разрешены в кучах кросс адаптеров для поддержки обмена данными текстуры, даже если такие макеты текстур не поддерживаются иным образом.</span><span class="sxs-lookup"><span data-stu-id="14cda-131">Some texture layouts are allowed on cross adapter heaps to support an interchange of texture data, even if such texture layouts are not otherwise supported.</span></span> <span data-ttu-id="14cda-132">К таким текстурам могут применяться определенные ограничения, например, только поддерживающие копирование.</span><span class="sxs-lookup"><span data-stu-id="14cda-132">Certain restrictions may apply to such textures, such as only supporting copying.</span></span>

<span data-ttu-id="14cda-133">Совместное использование между адаптерами работает с кучами, созданными путем вызова [**ID3D12Device:: CreateHeap**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap).</span><span class="sxs-lookup"><span data-stu-id="14cda-133">Cross-adapter sharing works with heaps created by calling [**ID3D12Device::CreateHeap**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap).</span></span> <span data-ttu-id="14cda-134">Затем приложения могут создавать ресурсы через [**креатеплацедресаурце**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createplacedresource).</span><span class="sxs-lookup"><span data-stu-id="14cda-134">Applications can then create resources via [**CreatePlacedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createplacedresource).</span></span> <span data-ttu-id="14cda-135">Кроме того, она разрешена ресурсами и кучами, созданными [**креатекоммиттедресаурце**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource) , но только для \_ ресурсов D3D12 ресурсов \_ TEXTURE2D измерения ресурса \_ (см. [**D3D12 \_ ресурс \_ Dimension**](/windows/win32/api/d3d12/ne-d3d12-d3d12_resource_dimension)).</span><span class="sxs-lookup"><span data-stu-id="14cda-135">It is also allowed by resources/heaps created by [**CreateCommittedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource) but only for row-major D3D12\_RESOURCE\_DIMENSION\_TEXTURE2D resources (refer to [**D3D12\_RESOURCE\_DIMENSION**](/windows/win32/api/d3d12/ne-d3d12-d3d12_resource_dimension)).</span></span> <span data-ttu-id="14cda-136">Совместное использование между адаптерами не работает с [**креатересерведресаурце**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createreservedresource).</span><span class="sxs-lookup"><span data-stu-id="14cda-136">Cross-adapter sharing does not work with [**CreateReservedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createreservedresource).</span></span>

<span data-ttu-id="14cda-137">Для совместного использования между адаптерами по-прежнему применяются все стандартные правила совместного использования ресурсов в разных очередях.</span><span class="sxs-lookup"><span data-stu-id="14cda-137">For cross-adapter sharing, all of the usual cross-queue resource sharing rules still apply.</span></span> <span data-ttu-id="14cda-138">Приложения должны выдать соответствующие барьеры, чтобы обеспечить правильную синхронизацию и согласованность между двумя адаптерами.</span><span class="sxs-lookup"><span data-stu-id="14cda-138">Applications must issue the appropriate barriers to ensure proper synchronization and coherence between the two adapters.</span></span> <span data-ttu-id="14cda-139">Приложения должны использовать межадаптерные ограждения для координации планирования списков команд, отправленных на несколько адаптеров.</span><span class="sxs-lookup"><span data-stu-id="14cda-139">Applications should use cross-adapter fences to coordinate the scheduling of command lists submitted to multiple adapters.</span></span> <span data-ttu-id="14cda-140">Механизм совместного использования ресурсов между адаптерами в версиях D3D API отсутствует.</span><span class="sxs-lookup"><span data-stu-id="14cda-140">There is no mechanism to share cross-adapter resources across D3D API versions.</span></span> <span data-ttu-id="14cda-141">Общие ресурсы для разных адаптеров поддерживаются только в системной памяти.</span><span class="sxs-lookup"><span data-stu-id="14cda-141">Cross-adapter shared resources are only supported in system memory.</span></span> <span data-ttu-id="14cda-142">Общие кучи и ресурсы перекрестных адаптеров поддерживаются в куче D3D12 \_ \_ типа кучи \_ по умолчанию и в \_ \_ \_ пользовательских кучах D3D12 типа кучи (с пулом памяти на уровне 0 и со свойствами страницы ЦП для записи и объединения).</span><span class="sxs-lookup"><span data-stu-id="14cda-142">Cross-adapter shared heaps/resources are supported in D3D12\_HEAP\_TYPE\_DEFAULT heaps and D3D12\_HEAP\_TYPE\_CUSTOM heaps (with the L0 memory pool, and write-combine CPU page properties).</span></span> <span data-ttu-id="14cda-143">Драйверы должны быть уверены, что операции чтения и записи GPU для общих куч между адаптерами согласованы с другими графическими процессорами в системе.</span><span class="sxs-lookup"><span data-stu-id="14cda-143">Drivers must be sure that GPU read/write operations to cross-adapter shared heaps are coherent with other GPUs on the system.</span></span> <span data-ttu-id="14cda-144">Например, драйверу может потребоваться исключить данные кучи из кэша GPU, которые обычно не нужно сбрасывать, если ЦП не может напрямую получить доступ к данным кучи.</span><span class="sxs-lookup"><span data-stu-id="14cda-144">For example, the driver may need to exclude the heap data from residing in GPU caches that typically don’t need to be flushed when the CPU cannot directly access the heap data.</span></span>

<span data-ttu-id="14cda-145">Приложения должны ограничивать использование куч между адаптерами только теми сценариями, для которых требуются предоставляемые ими функции.</span><span class="sxs-lookup"><span data-stu-id="14cda-145">Applications should confine the usage of cross adapter heaps to only those scenarios which require the functionality they provide.</span></span> <span data-ttu-id="14cda-146">Кучи между адаптерами находятся в \_ пуле памяти D3D12 уровня \_ \_ 0, что не всегда предлагает [**жеткустомхеаппропертиес**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcustomheapproperties) .</span><span class="sxs-lookup"><span data-stu-id="14cda-146">Cross-adapter heaps are located in D3D12\_MEMORY\_POOL\_L0, which is not always what [**GetCustomHeapProperties**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcustomheapproperties) suggests.</span></span> <span data-ttu-id="14cda-147">Этот пул памяти неэффективен для отдельных архитектур адаптеров и NUMA.</span><span class="sxs-lookup"><span data-stu-id="14cda-147">That memory pool is not efficient for discrete/ NUMA adapter architectures.</span></span> <span data-ttu-id="14cda-148">И самые эффективные макеты текстур не всегда доступны.</span><span class="sxs-lookup"><span data-stu-id="14cda-148">And, the most efficient texture layouts are not always available.</span></span>

<span data-ttu-id="14cda-149">Также действуют следующие ограничения.</span><span class="sxs-lookup"><span data-stu-id="14cda-149">The following limitations also apply:</span></span>

-   <span data-ttu-id="14cda-150">Флаги кучи, связанные с уровнями кучи, должны \_ иметь \_ флаг D3D12 heap \_ , позволяющий использовать \_ все \_ буферы \_ и \_ текстуры.</span><span class="sxs-lookup"><span data-stu-id="14cda-150">The heap flags related to heap tiers must be D3D12\_HEAP\_FLAG\_ALLOW\_ALL\_BUFFERS\_AND\_TEXTURES.</span></span>
-   <span data-ttu-id="14cda-151">\_ \_ \_ Также должен быть задан флаг общей кучи D3D12.</span><span class="sxs-lookup"><span data-stu-id="14cda-151">D3D12\_HEAP\_FLAG\_SHARED must also be set.</span></span>
-   <span data-ttu-id="14cda-152">Необходимо задать \_ значение \_ \_ по умолчанию для типа кучи D3D12 или задать \_ тип D3D12 \_ для типа кучи \_ Custom с D3D12 \_ памяти \_ \_ 0, а \_ \_ свойство страницы ЦП D3D12 \_ \_ \_ — недоступно.</span><span class="sxs-lookup"><span data-stu-id="14cda-152">Either D3D12\_HEAP\_TYPE\_DEFAULT must be set or D3D12\_HEAP\_TYPE\_CUSTOM with D3D12\_MEMORY\_POOL\_L0 and D3D12\_CPU\_PAGE\_PROPERTY\_NOT\_AVAILABLE must be set.</span></span>
-   <span data-ttu-id="14cda-153">Только ресурсы с \_ \_ флагом ресурса D3D12 \_ Разрешить \_ перекрестный \_ адаптер можно разместить в кучах между адаптерами.</span><span class="sxs-lookup"><span data-stu-id="14cda-153">Only resources with D3D12\_RESOURCE\_FLAG\_ALLOW\_CROSS\_ADAPTER may be placed on cross-adapter heaps.</span></span>

<span data-ttu-id="14cda-154">Дополнительные сведения об использовании нескольких адаптеров см. в разделе о [системах с несколькими адаптерами](multi-engine.md) .</span><span class="sxs-lookup"><span data-stu-id="14cda-154">For more information on using multiple adapters, refer to the [Multi-adapter systems](multi-engine.md) section.</span></span>

## <a name="related-topics"></a><span data-ttu-id="14cda-155">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="14cda-155">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="14cda-156">Подраспределение в кучах</span><span class="sxs-lookup"><span data-stu-id="14cda-156">Suballocation Within Heaps</span></span>](suballocation-within-heaps.md)
</dt> </dl>

 

 




