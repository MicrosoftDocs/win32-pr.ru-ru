---
title: Возможности рисования оборудования
description: Возможности рисования оборудования
ms.assetid: 3a26de73-cb9e-41a0-8c33-a7cca7d6058e
keywords:
- Диспетчер сжатия видео (ВКМ), рисование
- ВКМ (диспетчер сжатия видео), рисование
- Функция Икжетинфо
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ba7d3af8beb7c4ac676e421fe10d427322470d14
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104068075"
---
# <a name="hardware-drawing-capabilities"></a><span data-ttu-id="75f6e-106">Возможности рисования оборудования</span><span class="sxs-lookup"><span data-stu-id="75f6e-106">Hardware Drawing Capabilities</span></span>

<span data-ttu-id="75f6e-107">Некоторые модули подготовки отчетов могут рисовать видео непосредственно на видеооборудовании при распаковке видеокадров.</span><span class="sxs-lookup"><span data-stu-id="75f6e-107">Some renderers can draw directly to video hardware as they decompress video frames.</span></span> <span data-ttu-id="75f6e-108">Эти модули подготовки отчетов возвращают ВИДКФный \_ флаг рисования в ответ на функцию [**икжетинфо**](/windows/desktop/api/Vfw/nf-vfw-icgetinfo) .</span><span class="sxs-lookup"><span data-stu-id="75f6e-108">These renderers return the VIDCF\_DRAW flag in response to the [**ICGetInfo**](/windows/desktop/api/Vfw/nf-vfw-icgetinfo) function.</span></span> <span data-ttu-id="75f6e-109">При использовании этого типа модуля подготовки отчетов приложение не будет обрабатывать распакованные данные.</span><span class="sxs-lookup"><span data-stu-id="75f6e-109">When using this type of renderer, your application does not have to handle the decompressed data.</span></span> <span data-ttu-id="75f6e-110">Он позволяет модулю подготовки отчетов хранить распакованные данные для рисования.</span><span class="sxs-lookup"><span data-stu-id="75f6e-110">It lets the renderer retain the decompressed data for drawing.</span></span>

<span data-ttu-id="75f6e-111">Если приложение использует модуль подготовки отчетов с возможностями рисования, он должен обрабатывать следующие задачи:</span><span class="sxs-lookup"><span data-stu-id="75f6e-111">If your application uses a renderer with drawing capabilities, it must handle the following tasks:</span></span>

-   <span data-ttu-id="75f6e-112">Выберите модуль подготовки отчетов.</span><span class="sxs-lookup"><span data-stu-id="75f6e-112">Select a renderer.</span></span>
-   <span data-ttu-id="75f6e-113">Укажите форматы изображений.</span><span class="sxs-lookup"><span data-stu-id="75f6e-113">Specify image formats.</span></span>
-   <span data-ttu-id="75f6e-114">Инициализируйте модуль подготовки отчетов.</span><span class="sxs-lookup"><span data-stu-id="75f6e-114">Initialize the renderer.</span></span>
-   <span data-ttu-id="75f6e-115">Нарисуйте данные.</span><span class="sxs-lookup"><span data-stu-id="75f6e-115">Draw the data.</span></span>
-   <span data-ttu-id="75f6e-116">Управление параметрами рисования.</span><span class="sxs-lookup"><span data-stu-id="75f6e-116">Control drawing parameters.</span></span>

## <a name="renderer-selection"></a><span data-ttu-id="75f6e-117">Выбор модуля подготовки отчетов</span><span class="sxs-lookup"><span data-stu-id="75f6e-117">Renderer Selection</span></span>

<span data-ttu-id="75f6e-118">Макрос [**икдравопен**](/windows/desktop/api/Vfw/nf-vfw-icdrawopen) открывает модуль подготовки отчетов, который может рисовать изображения с указанным форматом.</span><span class="sxs-lookup"><span data-stu-id="75f6e-118">The [**ICDrawOpen**](/windows/desktop/api/Vfw/nf-vfw-icdrawopen) macro opens a renderer that can draw images with the specified format.</span></span> <span data-ttu-id="75f6e-119">Он возвращает маркер модуля подготовки отчетов, если он успешно, или ноль в противном случае.</span><span class="sxs-lookup"><span data-stu-id="75f6e-119">It returns a handle of a renderer if it is successful, or zero otherwise.</span></span> <span data-ttu-id="75f6e-120">Этот макрос использует функцию [**иклокате**](/windows/desktop/api/Vfw/nf-vfw-iclocate) для открытия модуля подготовки отчетов.</span><span class="sxs-lookup"><span data-stu-id="75f6e-120">This macro uses the [**ICLocate**](/windows/desktop/api/Vfw/nf-vfw-iclocate) function to open the renderer.</span></span>

## <a name="specifying-image-formats"></a><span data-ttu-id="75f6e-121">Указание форматов изображений</span><span class="sxs-lookup"><span data-stu-id="75f6e-121">Specifying Image Formats</span></span>

<span data-ttu-id="75f6e-122">Так как приложению не нужно рисовать распакованные данные, для него не требуется конкретный выходной формат.</span><span class="sxs-lookup"><span data-stu-id="75f6e-122">Because your application does not need to draw the decompressed data, it does not require a specific output format.</span></span> <span data-ttu-id="75f6e-123">Однако необходимо убедиться, что модуль подготовки отчетов может рисовать с помощью входного формата, используя сообщение с [**\_ \_ запросом ICM Draw**](icm-draw-query.md) (или использовать макрос [**икдравкуери**](/windows/desktop/api/Vfw/nf-vfw-icdrawquery) ).</span><span class="sxs-lookup"><span data-stu-id="75f6e-123">It must, however, ensure that the renderer can draw using the input format by using the [**ICM\_DRAW\_QUERY**](icm-draw-query.md) message (or use the [**ICDrawQuery**](/windows/desktop/api/Vfw/nf-vfw-icdrawquery) macro).</span></span> <span data-ttu-id="75f6e-124">Это сообщение не может определить, может ли модуль подготовки изображения рисовать точечный рисунок.</span><span class="sxs-lookup"><span data-stu-id="75f6e-124">This message cannot determine if a renderer can draw a bitmap.</span></span> <span data-ttu-id="75f6e-125">Если приложение должно определить, может ли модуль подготовки к просмотру отображать точечный рисунок, используйте это сообщение с функцией [**икдравбегин**](/windows/desktop/api/Vfw/nf-vfw-icdrawbegin) .</span><span class="sxs-lookup"><span data-stu-id="75f6e-125">If your application must determine if the renderer can draw the bitmap, use this message with the [**ICDrawBegin**](/windows/desktop/api/Vfw/nf-vfw-icdrawbegin) function.</span></span>

<span data-ttu-id="75f6e-126">Приложение может иметь средство подготовки отчетов, предлагающее входной формат с помощью функции [**икдравсугжестформат**](/windows/desktop/api/Vfw/nf-vfw-icdrawsuggestformat) .</span><span class="sxs-lookup"><span data-stu-id="75f6e-126">Your application can have a renderer suggest an input format by using the [**ICDrawSuggestFormat**](/windows/desktop/api/Vfw/nf-vfw-icdrawsuggestformat) function.</span></span> <span data-ttu-id="75f6e-127">Эта функция используется, когда модуль подготовки отчетов разделяет возможности рисования от возможностей распаковки.</span><span class="sxs-lookup"><span data-stu-id="75f6e-127">This function is used when a renderer separates the drawing capabilities from the decompressing capabilities.</span></span> <span data-ttu-id="75f6e-128">Большинство приложений, использующих функции рисования, не должны определять выходной формат.</span><span class="sxs-lookup"><span data-stu-id="75f6e-128">Most applications using the drawing functions will not need to determine the output format.</span></span>

## <a name="renderer-initialization"></a><span data-ttu-id="75f6e-129">Инициализация модуля подготовки отчетов</span><span class="sxs-lookup"><span data-stu-id="75f6e-129">Renderer Initialization</span></span>

<span data-ttu-id="75f6e-130">Функция [**икдравбегин**](/windows/desktop/api/Vfw/nf-vfw-icdrawbegin) Инициализирует модуль подготовки отчетов и сообщает ему назначение рисования.</span><span class="sxs-lookup"><span data-stu-id="75f6e-130">The [**ICDrawBegin**](/windows/desktop/api/Vfw/nf-vfw-icdrawbegin) function initializes a renderer and tells it the drawing destination.</span></span> <span data-ttu-id="75f6e-131">Эта функция также может выполнять следующие задачи:</span><span class="sxs-lookup"><span data-stu-id="75f6e-131">This function can also perform the following tasks:</span></span>

-   <span data-ttu-id="75f6e-132">Определите, поддерживает ли модуль подготовки отчетов определенный входной формат.</span><span class="sxs-lookup"><span data-stu-id="75f6e-132">Determine whether the renderer supports a specific input format.</span></span>
-   <span data-ttu-id="75f6e-133">Укажите, занимает ли операция рисования окно или весь экран.</span><span class="sxs-lookup"><span data-stu-id="75f6e-133">Specify whether the drawing operation occupies a window or the entire screen.</span></span>
-   <span data-ttu-id="75f6e-134">Укажите часть изображения для вывода с помощью исходного прямоугольника.</span><span class="sxs-lookup"><span data-stu-id="75f6e-134">Specify the part of the image to display using the source rectangle.</span></span>
-   <span data-ttu-id="75f6e-135">Определите скорость воспроизведения последовательности изображений.</span><span class="sxs-lookup"><span data-stu-id="75f6e-135">Define the playback rate of the image sequence.</span></span>

<span data-ttu-id="75f6e-136">Некоторые модули подготовки буфера отполняют сжатые данные для повышения эффективности работы.</span><span class="sxs-lookup"><span data-stu-id="75f6e-136">Some renderers buffer the compressed data to operate more efficiently.</span></span> <span data-ttu-id="75f6e-137">Приложение может отправить сообщение [**ICM \_ жетбуфферсвантед**](icm-getbufferswanted.md) (или использовать макрос [**икжетбуфферсвантед**](/windows/desktop/api/Vfw/nf-vfw-icgetbufferswanted) ) для определения количества буферов, запрашиваемых модулем подготовки отчетов.</span><span class="sxs-lookup"><span data-stu-id="75f6e-137">Your application can send the [**ICM\_GETBUFFERSWANTED**](icm-getbufferswanted.md) message (or use the [**ICGetBuffersWanted**](/windows/desktop/api/Vfw/nf-vfw-icgetbufferswanted) macro) to determine the number of buffers the renderer requests.</span></span> <span data-ttu-id="75f6e-138">Приложение должно предварительно загрузить эти буферы и отправить их в модуль подготовки отчетов перед рисованием.</span><span class="sxs-lookup"><span data-stu-id="75f6e-138">Your application should preload these buffers and send them to the renderer before drawing.</span></span>

## <a name="drawing-the-data"></a><span data-ttu-id="75f6e-139">Рисование данных</span><span class="sxs-lookup"><span data-stu-id="75f6e-139">Drawing the Data</span></span>

<span data-ttu-id="75f6e-140">Для распаковки данных для рисования можно использовать функцию [**икдрав**](/windows/desktop/api/Vfw/nf-vfw-icdraw) .</span><span class="sxs-lookup"><span data-stu-id="75f6e-140">You can use the [**ICDraw**](/windows/desktop/api/Vfw/nf-vfw-icdraw) function to decompress the data for drawing.</span></span> <span data-ttu-id="75f6e-141">Однако модуль подготовки отчетов не начинает прорисовку данных до тех пор, пока приложение не отправит сообщение о [**\_ \_ запуске ICM Draw**](icm-draw-start.md) (или использует макрос [**икдравстарт**](/windows/desktop/api/Vfw/nf-vfw-icdrawstart) ).</span><span class="sxs-lookup"><span data-stu-id="75f6e-141">The renderer, however, does not start drawing data until your application sends the [**ICM\_DRAW\_START**](icm-draw-start.md) message (or uses the [**ICDrawStart**](/windows/desktop/api/Vfw/nf-vfw-icdrawstart) macro).</span></span> <span data-ttu-id="75f6e-142">Когда приложение вызывает эту функцию, модуль подготовки отчетов начинает рисовать кадры с частотой, указанной параметром *дврате* , деленную на параметр *двскале* . Эти параметры были предоставлены, когда приложение инициализирует модуль подготовки отчетов с помощью функции [**икдравбегин**](/windows/desktop/api/Vfw/nf-vfw-icdrawbegin) .</span><span class="sxs-lookup"><span data-stu-id="75f6e-142">When your application calls this function, the renderer begins to draw the frames at the rate specified by the *dwRate* parameter divided by the *dwScale* parameter; these parameters were supplied when the application initialized the renderer by using the [**ICDrawBegin**](/windows/desktop/api/Vfw/nf-vfw-icdrawbegin) function.</span></span> <span data-ttu-id="75f6e-143">Прорисовка будет продолжаться до тех пор, пока приложение не отправит сообщение об ошибке [**ICM \_ \_ Draw**](icm-draw-stop.md) (или использует макрос [**икдравстоп**](/windows/desktop/api/Vfw/nf-vfw-icdrawstop) ).</span><span class="sxs-lookup"><span data-stu-id="75f6e-143">Drawing continues until your application sends the [**ICM\_DRAW\_STOP**](icm-draw-stop.md) message (or uses the [**ICDrawStop**](/windows/desktop/api/Vfw/nf-vfw-icdrawstop) macro).</span></span>

> [!Note]  
> <span data-ttu-id="75f6e-144">Если модуль подготовки отчетов помещает данные в буфер перед прорисовкой, приложение не должно использовать макрос **икдравстарт** , пока не отправил число кадров, возвращаемых модулем подготовки отчетов для макроса **икжетбуфферсвантед** .</span><span class="sxs-lookup"><span data-stu-id="75f6e-144">If a renderer buffers the data before drawing, your application should not use the **ICDrawStart** macro until it has sent the number of frames the renderer returned for the **ICGetBuffersWanted** macro.</span></span>

 

<span data-ttu-id="75f6e-145">Параметр *лтиме* параметра [**икдрав**](/windows/desktop/api/Vfw/nf-vfw-icdraw) указывает время отрисовки кадра.</span><span class="sxs-lookup"><span data-stu-id="75f6e-145">The *lTime* parameter of [**ICDraw**](/windows/desktop/api/Vfw/nf-vfw-icdraw) specifies the time to draw a frame.</span></span> <span data-ttu-id="75f6e-146">Модуль подготовки отчетов делит это целое число на шкалу времени, указанную с помощью [**икдравбегин**](/windows/desktop/api/Vfw/nf-vfw-icdrawbegin) , чтобы получить фактическое время.</span><span class="sxs-lookup"><span data-stu-id="75f6e-146">The renderer divides this integer by the time scale specified with [**ICDrawBegin**](/windows/desktop/api/Vfw/nf-vfw-icdrawbegin) to obtain the actual time.</span></span> <span data-ttu-id="75f6e-147">Время для функций **икдрав** задается относительно **икдравстарт**.</span><span class="sxs-lookup"><span data-stu-id="75f6e-147">Times for **ICDraw** functions are relative to **ICDrawStart**.</span></span> <span data-ttu-id="75f6e-148">**Икдравстарт** устанавливает часы в ноль.</span><span class="sxs-lookup"><span data-stu-id="75f6e-148">**ICDrawStart** sets the clock to zero.</span></span> <span data-ttu-id="75f6e-149">Например, если в приложении указано 1000 для шкалы времени и 75 для *лтиме*, модуль подготовки отчетов выводит кадр 75 миллисекунд в последовательность.</span><span class="sxs-lookup"><span data-stu-id="75f6e-149">For example, if your application specifies 1000 for the time scale and 75 for *lTime*, the renderer draws the frame 75 milliseconds into the sequence.</span></span>

## <a name="controlling-drawing-parameters"></a><span data-ttu-id="75f6e-150">Управление параметрами рисования</span><span class="sxs-lookup"><span data-stu-id="75f6e-150">Controlling Drawing Parameters</span></span>

<span data-ttu-id="75f6e-151">Часы модуля подготовки отчетов можно отслеживать, отправляя сообщение [**ICM \_ \_ Draw**](icm-draw-gettime.md) (или используя макрос [**икдравжеттиме**](/windows/desktop/api/Vfw/nf-vfw-icdrawgettime) ), и можно задать часы модуля подготовки, который может рисовать данные, отправив сообщение [**ICM \_ Draw \_ SETTIME**](icm-draw-settime.md) (или используя макрос [**икдравсеттиме**](/windows/desktop/api/Vfw/nf-vfw-icdrawsettime) ).</span><span class="sxs-lookup"><span data-stu-id="75f6e-151">You can monitor the clock of a renderer by sending the [**ICM\_DRAW\_GETTIME**](icm-draw-gettime.md) message (or use the [**ICDrawGetTime**](/windows/desktop/api/Vfw/nf-vfw-icdrawgettime) macro), and you can set the clock of a renderer that can draw data by sending the [**ICM\_DRAW\_SETTIME**](icm-draw-settime.md) message (or use the [**ICDrawSetTime**](/windows/desktop/api/Vfw/nf-vfw-icdrawsettime) macro).</span></span>

<span data-ttu-id="75f6e-152">Чтобы изменить текущую точку во время прорисовки модуля подготовки отчетов, приложение может отправить [**\_ \_ окно ICM Draw**](icm-draw-window.md) (или использовать макрос [**икдраввиндов**](/windows/desktop/api/Vfw/nf-vfw-icdrawwindow) ) для изменения расположения окна.</span><span class="sxs-lookup"><span data-stu-id="75f6e-152">To change the current position while a renderer is drawing, your application can send the [**ICM\_DRAW\_WINDOW**](icm-draw-window.md) message (or use the [**ICDrawWindow**](/windows/desktop/api/Vfw/nf-vfw-icdrawwindow) macro) for repositioning the window.</span></span> <span data-ttu-id="75f6e-153">Приложения обычно используют это сообщение при каждом изменении окна.</span><span class="sxs-lookup"><span data-stu-id="75f6e-153">Applications typically use this message whenever the window changes.</span></span>

<span data-ttu-id="75f6e-154">Если окно воспроизведения получает сообщение с палитрой визуализации, приложение должно отправить сообщение [**ICM \_ \_ Draw**](icm-draw-realize.md) (или использовать макрос [**икдравреализе**](/windows/desktop/api/Vfw/nf-vfw-icdrawrealize) ), чтобы модуль подготовки отчетов снова выйдет палитру для воспроизведения.</span><span class="sxs-lookup"><span data-stu-id="75f6e-154">If the playback window gets a realize-palette message, your application must send the [**ICM\_DRAW\_REALIZE**](icm-draw-realize.md) message (or use the [**ICDrawRealize**](/windows/desktop/api/Vfw/nf-vfw-icdrawrealize) macro) to have the renderer realize the palette again for playback.</span></span> <span data-ttu-id="75f6e-155">Приложения могут изменить эту палитру, отправив сообщение [**ICM \_ Draw \_ чанжепалетте**](icm-draw-changepalette.md) (или использовать макрос [**икдравчанжепалетте**](/windows/desktop/api/Vfw/nf-vfw-icdrawchangepalette) ) и получить текущую палитру, отправив сообщение [**ICM \_ Draw \_ Получение \_ палитры**](icm-draw-get-palette.md) .</span><span class="sxs-lookup"><span data-stu-id="75f6e-155">Applications can change the palette by sending the [**ICM\_DRAW\_CHANGEPALETTE**](icm-draw-changepalette.md) message (or use the [**ICDrawChangePalette**](/windows/desktop/api/Vfw/nf-vfw-icdrawchangepalette) macro) and obtain the current palette by sending the [**ICM\_DRAW\_GET\_PALETTE**](icm-draw-get-palette.md) message.</span></span>

<span data-ttu-id="75f6e-156">Некоторые модули подготовки отчетов должны быть специально предназначены для отображения переданных им кадров.</span><span class="sxs-lookup"><span data-stu-id="75f6e-156">Some renderers must be specifically instructed to display frames passed to them.</span></span> <span data-ttu-id="75f6e-157">Отправка сообщения [**ICM \_ Draw \_ рендербуффер**](icm-draw-renderbuffer.md) (или использование макроса [**икдраврендербуффер**](/windows/desktop/api/Vfw/nf-vfw-icdrawrenderbuffer) ) приводит к тому, что эти модули отрисовки рисуют кадр.</span><span class="sxs-lookup"><span data-stu-id="75f6e-157">Sending the [**ICM\_DRAW\_RENDERBUFFER**](icm-draw-renderbuffer.md) message (or use the [**ICDrawRenderBuffer**](/windows/desktop/api/Vfw/nf-vfw-icdrawrenderbuffer) macro) causes these renderers to draw the frame.</span></span>

 

 




