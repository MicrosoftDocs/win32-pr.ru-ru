---
title: Возможности рисования оборудования
description: Возможности рисования оборудования
ms.assetid: 3a26de73-cb9e-41a0-8c33-a7cca7d6058e
keywords:
- Диспетчер сжатия видео (ВКМ), рисование
- ВКМ (диспетчер сжатия видео), рисование
- Функция Икжетинфо
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ba7d3af8beb7c4ac676e421fe10d427322470d14
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104068075"
---
# <a name="hardware-drawing-capabilities"></a>Возможности рисования оборудования

Некоторые модули подготовки отчетов могут рисовать видео непосредственно на видеооборудовании при распаковке видеокадров. Эти модули подготовки отчетов возвращают ВИДКФный \_ флаг рисования в ответ на функцию [**икжетинфо**](/windows/desktop/api/Vfw/nf-vfw-icgetinfo) . При использовании этого типа модуля подготовки отчетов приложение не будет обрабатывать распакованные данные. Он позволяет модулю подготовки отчетов хранить распакованные данные для рисования.

Если приложение использует модуль подготовки отчетов с возможностями рисования, он должен обрабатывать следующие задачи:

-   Выберите модуль подготовки отчетов.
-   Укажите форматы изображений.
-   Инициализируйте модуль подготовки отчетов.
-   Нарисуйте данные.
-   Управление параметрами рисования.

## <a name="renderer-selection"></a>Выбор модуля подготовки отчетов

Макрос [**икдравопен**](/windows/desktop/api/Vfw/nf-vfw-icdrawopen) открывает модуль подготовки отчетов, который может рисовать изображения с указанным форматом. Он возвращает маркер модуля подготовки отчетов, если он успешно, или ноль в противном случае. Этот макрос использует функцию [**иклокате**](/windows/desktop/api/Vfw/nf-vfw-iclocate) для открытия модуля подготовки отчетов.

## <a name="specifying-image-formats"></a>Указание форматов изображений

Так как приложению не нужно рисовать распакованные данные, для него не требуется конкретный выходной формат. Однако необходимо убедиться, что модуль подготовки отчетов может рисовать с помощью входного формата, используя сообщение с [**\_ \_ запросом ICM Draw**](icm-draw-query.md) (или использовать макрос [**икдравкуери**](/windows/desktop/api/Vfw/nf-vfw-icdrawquery) ). Это сообщение не может определить, может ли модуль подготовки изображения рисовать точечный рисунок. Если приложение должно определить, может ли модуль подготовки к просмотру отображать точечный рисунок, используйте это сообщение с функцией [**икдравбегин**](/windows/desktop/api/Vfw/nf-vfw-icdrawbegin) .

Приложение может иметь средство подготовки отчетов, предлагающее входной формат с помощью функции [**икдравсугжестформат**](/windows/desktop/api/Vfw/nf-vfw-icdrawsuggestformat) . Эта функция используется, когда модуль подготовки отчетов разделяет возможности рисования от возможностей распаковки. Большинство приложений, использующих функции рисования, не должны определять выходной формат.

## <a name="renderer-initialization"></a>Инициализация модуля подготовки отчетов

Функция [**икдравбегин**](/windows/desktop/api/Vfw/nf-vfw-icdrawbegin) Инициализирует модуль подготовки отчетов и сообщает ему назначение рисования. Эта функция также может выполнять следующие задачи:

-   Определите, поддерживает ли модуль подготовки отчетов определенный входной формат.
-   Укажите, занимает ли операция рисования окно или весь экран.
-   Укажите часть изображения для вывода с помощью исходного прямоугольника.
-   Определите скорость воспроизведения последовательности изображений.

Некоторые модули подготовки буфера отполняют сжатые данные для повышения эффективности работы. Приложение может отправить сообщение [**ICM \_ жетбуфферсвантед**](icm-getbufferswanted.md) (или использовать макрос [**икжетбуфферсвантед**](/windows/desktop/api/Vfw/nf-vfw-icgetbufferswanted) ) для определения количества буферов, запрашиваемых модулем подготовки отчетов. Приложение должно предварительно загрузить эти буферы и отправить их в модуль подготовки отчетов перед рисованием.

## <a name="drawing-the-data"></a>Рисование данных

Для распаковки данных для рисования можно использовать функцию [**икдрав**](/windows/desktop/api/Vfw/nf-vfw-icdraw) . Однако модуль подготовки отчетов не начинает прорисовку данных до тех пор, пока приложение не отправит сообщение о [**\_ \_ запуске ICM Draw**](icm-draw-start.md) (или использует макрос [**икдравстарт**](/windows/desktop/api/Vfw/nf-vfw-icdrawstart) ). Когда приложение вызывает эту функцию, модуль подготовки отчетов начинает рисовать кадры с частотой, указанной параметром *дврате* , деленную на параметр *двскале* . Эти параметры были предоставлены, когда приложение инициализирует модуль подготовки отчетов с помощью функции [**икдравбегин**](/windows/desktop/api/Vfw/nf-vfw-icdrawbegin) . Прорисовка будет продолжаться до тех пор, пока приложение не отправит сообщение об ошибке [**ICM \_ \_ Draw**](icm-draw-stop.md) (или использует макрос [**икдравстоп**](/windows/desktop/api/Vfw/nf-vfw-icdrawstop) ).

> [!Note]  
> Если модуль подготовки отчетов помещает данные в буфер перед прорисовкой, приложение не должно использовать макрос **икдравстарт** , пока не отправил число кадров, возвращаемых модулем подготовки отчетов для макроса **икжетбуфферсвантед** .

 

Параметр *лтиме* параметра [**икдрав**](/windows/desktop/api/Vfw/nf-vfw-icdraw) указывает время отрисовки кадра. Модуль подготовки отчетов делит это целое число на шкалу времени, указанную с помощью [**икдравбегин**](/windows/desktop/api/Vfw/nf-vfw-icdrawbegin) , чтобы получить фактическое время. Время для функций **икдрав** задается относительно **икдравстарт**. **Икдравстарт** устанавливает часы в ноль. Например, если в приложении указано 1000 для шкалы времени и 75 для *лтиме*, модуль подготовки отчетов выводит кадр 75 миллисекунд в последовательность.

## <a name="controlling-drawing-parameters"></a>Управление параметрами рисования

Часы модуля подготовки отчетов можно отслеживать, отправляя сообщение [**ICM \_ \_ Draw**](icm-draw-gettime.md) (или используя макрос [**икдравжеттиме**](/windows/desktop/api/Vfw/nf-vfw-icdrawgettime) ), и можно задать часы модуля подготовки, который может рисовать данные, отправив сообщение [**ICM \_ Draw \_ SETTIME**](icm-draw-settime.md) (или используя макрос [**икдравсеттиме**](/windows/desktop/api/Vfw/nf-vfw-icdrawsettime) ).

Чтобы изменить текущую точку во время прорисовки модуля подготовки отчетов, приложение может отправить [**\_ \_ окно ICM Draw**](icm-draw-window.md) (или использовать макрос [**икдраввиндов**](/windows/desktop/api/Vfw/nf-vfw-icdrawwindow) ) для изменения расположения окна. Приложения обычно используют это сообщение при каждом изменении окна.

Если окно воспроизведения получает сообщение с палитрой визуализации, приложение должно отправить сообщение [**ICM \_ \_ Draw**](icm-draw-realize.md) (или использовать макрос [**икдравреализе**](/windows/desktop/api/Vfw/nf-vfw-icdrawrealize) ), чтобы модуль подготовки отчетов снова выйдет палитру для воспроизведения. Приложения могут изменить эту палитру, отправив сообщение [**ICM \_ Draw \_ чанжепалетте**](icm-draw-changepalette.md) (или использовать макрос [**икдравчанжепалетте**](/windows/desktop/api/Vfw/nf-vfw-icdrawchangepalette) ) и получить текущую палитру, отправив сообщение [**ICM \_ Draw \_ Получение \_ палитры**](icm-draw-get-palette.md) .

Некоторые модули подготовки отчетов должны быть специально предназначены для отображения переданных им кадров. Отправка сообщения [**ICM \_ Draw \_ рендербуффер**](icm-draw-renderbuffer.md) (или использование макроса [**икдраврендербуффер**](/windows/desktop/api/Vfw/nf-vfw-icdrawrenderbuffer) ) приводит к тому, что эти модули отрисовки рисуют кадр.

 

 




