---
title: Установка обработчика файлов и потоков
description: Установка обработчика файлов и потоков
ms.assetid: 8d007ea4-b75a-4b3f-965f-8091fcd4cb2f
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: be94137df69ed35b57b1b8fbeb5c9640dd7636d6
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "103779133"
---
# <a name="file-and-stream-handler-installation"></a>Установка обработчика файлов и потоков

Библиотека Авифиле использует установленные обработчики потоков и файлов для чтения и записи файлов AVI и потоков. Обработчик устанавливается, если он находится в СИСТЕМном каталоге Windows, а реестр содержит следующие сведения, необходимые для описания и обнаружения обработчика:

-   16-байтовый идентификатор класса для обработчика
-   Краткое описание обработчика
-   Имя файла, содержащего обработчик
-   Расширение файла, которое может обработать обработчик файлов
-   Доступ к файлам и другие свойства, связанные с обработчиком файлов
-   4-символьные коды, идентифицирующие типы потоков, которые может обработать обработчик потока

Библиотека Авифиле запрашивает в реестре обработчики, которые являются внешними для приложения при открытии файлов и доступе к потокам. Результатом успешного запроса будет возврат имени файла обработчика, который может обработать тип файла или потока, указанный в запросе. Реестр перечисляет каждый обработчик, создавая три записи, которые имеют следующий вид:


```C++
[HKEY_CLASSES_ROOT\Clsid\{00010023-0000-0000-C000-000000000046}] 
@="Wave File reader/writer" 
[HKEY_CLASSES_ROOT\Clsid\{00010023-0000-0000-C000- 
000000000046}\InprocServer32] 
@="wavefile.dll" 
"ThreadingModel"="Apartment" 
[HKEY_CLASSES_ROOT\Clsid\{00010023-0000-0000-C000- 
000000000046}\AVIFile] 
@="3" 
 
```



Эти записи состоят из следующих частей.



| Отделение                                   | Описание                                                                                                                                                                              |
|----------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| \_корневой узел классов hKey \_                    | Определяет корневую запись реестра.                                                                                                                                               |
| Clsid                                  | Определяет эту запись как идентификатор класса.                                                                                                                                             |
| {00010023-0000-0000-C000-000000000046} | Указывает идентификатор интерфейса (IID) или идентификатор класса. Это значение является уникальным 16-байтовым идентификатором. (Идентификатор также может называться идентификатором GUID или UUID в других руководствах.) |
| Модуль чтения и записи WAV-файлов                | Задает строку для описания обработчика. Эта строка может отображаться в диалоговых окнах для выбора обработчиков потоков и файлов.                                                         |
| InProcServer32                         | Указывает файл (в данном примере это WAVEFILE.DLL), который можно загрузить для работы с этим классом.                                                                                              |
| авифиле                                | Задает свойства обработчика файлов. В этом примере обработчик может считывать файл AVI и записывать его в него.                                                                              |



 

Обработчик файлов может иметь одно или несколько свойств, хранящихся в реестре. Следующие константы обозначают свойства, которые в настоящее время связаны с файлом.



| Константа                        | Описание                                                          |
|---------------------------------|----------------------------------------------------------------------|
| АВИФИЛЕХАНДЛЕР \_ канакцептнонргб | Указывает, что обработчик файлов может обрабатывать данные изображения, отличные от RGB. |
| АВИФИЛЕХАНДЛЕР \_ CANREAD         | Указывает, что обработчик файлов может открыть файл с доступом для чтения.      |
| АВИФИЛЕХАНДЛЕР \_ CANWRITE        | Указывает, что обработчик файлов может открыть файл с доступом для записи.     |



 

При создании обработчика файлов или потоков можно получить новый идентификатор, выполнив UUIDGEN.EXE. Для создания нового идентификатора всегда используйте UUIDGEN.EXE. 16-байтовое шестнадцатеричное число, созданное этим исполняемым файлом, уникально идентифицирует обработчик.

Библиотека Авифиле использует дополнительные записи в реестре для идентификации идентификатора класса на основе расширения файла, обрабатываемого обработчиком файлов, или кода из четырех символов, которые могут обрабатываться обработчиком файла или потока. Например, следующие записи связывают идентификатор класса с расширением файла. WAV и 4-значный код "WAVE":


```C++
[HKEY_CLASSES_ROOT\AVIFile\Extensions\WAV] 
@="{00010023-0000-0000-C000-000000000046}" 
[HKEY_CLASSES_ROOT\AVIFile\RIFFHandlers\WAVE] 
@="{00010023-0000-0000-C000-000000000046}" 
 
```



Эти записи состоят из следующих частей.



| Отделение                                   | Описание                                                                                       |
|----------------------------------------|---------------------------------------------------------------------------------------------------|
| \_корневой узел классов hKey \_                    | Определяет корневую запись реестра.                                                        |
| авифиле                                | Определяет эту запись как запись, используемую Авифиле.                                                |
| Модули                             | Указывает расширение файла (в этом примере —. WAV), которую обработчик файлов может обработать.             |
| риффхандлерс                           | Задает код из четырех символов (в этом примере это «WAVE»), который может обрабатываться обработчиком файла или потока. |
| {00010023-0000-0000-C000-000000000046} | Указывает идентификатор интерфейса (IID) или идентификатор класса.                                      |



 

Если вы распространяете поток или обработчик файлов без приложения установки, чтобы установить его в системе пользователя, необходимо включить. REG File, чтобы пользователь мог установить обработчик. Пользователь будет использовать редактор реестра для создания записей реестра для обработчика потока или файла.

В следующем примере показано содержимое типичного объекта. Файл REG. Первая запись в следующем примере представляет собой описательную строку для обработчика. Вторая запись определяет файл, содержащий обработчик. Третья запись определяет свойства обработчика файлов (в данном случае доступ к файлам только для чтения). Четвертая запись связывает тип файла, обрабатываемого обработчиком (в данном случае файлы с. Расширение имени файла JPG) с идентификатором класса.


```C++
[HKEY_CLASSES_ROOT\Clsid\{5C2B8200-E2C8-1068-B1CA-6066188C6002}] 
@="JFIF (JPEG) Files" 
[HKEY_CLASSES_ROOT\Clsid\{5C2B8200-E2C8-1068-B1CA-6066188C6002}]\InprocServer32] 
@="jfiffile.dll" 
[HKEY_CLASSES_ROOT\AVIFile\Extensions\JPG] 
@="{5C2B8200-E2C8-1068-B1CA-6066188C6002}" 
 
```



При создании этого файла сохраните его с помощью. Расширение REG для его обнаружения в качестве файла обновления для реестра. Кроме того, замените уникальный IID для 16-байтового кода, используемого в примере.

 

 




