---
title: Управление блоками данных MIDI
description: Управление блоками данных MIDI
ms.assetid: f29fbc08-ef67-489c-aedf-5a2bc65233f7
keywords:
- Цифровой интерфейс MIDI, Управление блоками данных
- MIDI (цифровой интерфейс музыкального инструмента), Управление блоками данных
- Службы MIDI, Управление блоками данных
- Управление блоками данных MIDI
- Цифровой интерфейс музыкальных инструментов (MIDI), обработка сообщений драйвера
- MIDI (цифровой интерфейс музыкального инструмента), обработка сообщений драйвера
- Службы MIDI, обработка сообщений драйвера
- Обработка сообщений драйвера
- Цифровой интерфейс MIDI, блоки данных
- MIDI (цифровой интерфейс музыкального инструмента), блоки данных
- Службы MIDI, блоки данных
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: af348d6c53d2944bf22c026674704baa1fe74e07
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "103987403"
---
# <a name="managing-midi-data-blocks"></a>Управление блоками данных MIDI

Приложения, использующие блоки данных для передачи безсистемных сообщений (с помощью функций [**мидиаутлонгмсг**](/windows/win32/api/mmeapi/nf-mmeapi-midioutlongmsg) и [**мидиинаддбуффер**](/windows/win32/api/mmeapi/nf-mmeapi-midiinaddbuffer) ) и буферов потоков (с помощью функции [**мидистреамаут**](/windows/win32/api/mmeapi/nf-mmeapi-midistreamout) ), должны постоянно предоставлять драйвер устройства блоками данных до завершения воспроизведения или записи.

Даже если используется один блок данных, приложение должно иметь возможность определить, завершена ли работа драйвера устройства с блоком данных, чтобы освободить память, связанную с блоком данных и структурой заголовков. Для определения завершения работы драйвера устройства с блоком данных можно использовать три метода:

-   Укажите функцию обратного вызова для получения сообщения, отправленного драйвером после завершения работы с блоком данных. Чтобы получить входные данные MIDI с отметкой времени, необходимо использовать функцию обратного вызова.
-   Используйте обратный вызов события (только для выходных данных).
-   Используйте обратный вызов окна или потока для получения сообщения, отправленного драйвером после завершения работы с блоком данных.

Если приложение не получает блок данных к драйверу устройства при необходимости, может произойти пропускная запись при воспроизведении или утрата входящей записанной информации. Как минимум, приложение должно использовать схему двойной буферизации, чтобы оставаться по крайней мере один блок данных перед драйвером устройства.

## <a name="using-a-callback-function-to-process-driver-messages"></a>Использование функции обратного вызова для обработки сообщений драйвера

Вы можете написать собственную функцию обратного вызова для обработки сообщений, отправленных драйвером устройства. Чтобы использовать функцию обратного вызова, укажите флаг функции ОБРАТНОго вызова \_ в параметре *dwFlags* и адрес функции обратного вызова в параметре *Двкаллбакк* функции [**мидиинопен**](/windows/win32/api/mmeapi/nf-mmeapi-midiinopen) или [**мидиаутопен**](/windows/win32/api/mmeapi/nf-mmeapi-midioutopen) .

Сообщения, отправленные в функцию обратного вызова, похожи на сообщения, отправленные в окно, за исключением того, что они имеют два параметра даублеворд, а не целочисленный параметр без знака и параметр даублеворд. Дополнительные сведения об этих сообщениях см. в разделе [Отправка сообщений System-Exclusive](sending-system-exclusive-messages.md) и [Управление записью MIDI](managing-midi-recording.md).

Используйте один из следующих методов передачи данных экземпляра из приложения в функцию обратного вызова:

-   Используйте параметр *двкаллбаккинстанце* функции, которая открывает драйвер устройства.
-   Используйте элемент **двусер** структуры [**мидихдр**](/windows/win32/api/mmeapi/ns-mmeapi-midihdr) , определяющий блок данных, отправляемый драйверу устройства MIDI.

Если требуется более 32 бит данных экземпляра, передайте адрес структуры, содержащей дополнительные сведения.

## <a name="using-an-event-callback-to-process-driver-messages"></a>Использование обратного вызова события для обработки сообщений драйвера

Чтобы использовать обратный вызов события, используйте функцию [CreateEvent](/windows/win32/api/synchapi/nf-synchapi-createeventa) для получения маркера события и укажите событие обратного вызова \_ в вызове функции [**мидиаутопен**](/windows/win32/api/mmeapi/nf-mmeapi-midioutopen) .

Обратный вызов события задается любым значением, которое может вызвать обратный вызов функции. В отличие от функций обратного вызова и обратных вызовов окон или потоков, обратные вызовы событий не получают конкретных закрытых, готовых или открытых уведомлений. Таким образом, приложению может потребоваться проверить состояние процесса, ожидающего выполнения после наступления события.

Дополнительные сведения о обратных вызовах событий см. [в разделе Использование обратного вызова события для управления буферизованным воспроизведением](using-an-callback-to-manage-buffered-playback.md).

## <a name="using-a-window-or-thread-callback-to-process-driver-messages"></a>Использование обратного вызова окна или потока для обработки сообщений драйвера

Чтобы использовать обратный вызов окна, укажите флаг окна ОБРАТНОго вызова \_ в параметре *dwFlags* и маркер окна в младшем слове параметра *Двкаллбакк* функции [**мидиинопен**](/windows/win32/api/mmeapi/nf-mmeapi-midiinopen) или [**мидиаутопен**](/windows/win32/api/mmeapi/nf-mmeapi-midioutopen) . Сообщения драйвера будут отправляться в функцию окна процедуры для окна, идентифицируемого по маркеру в *двкаллбакк*.

Аналогично, чтобы использовать обратный вызов потока, укажите флаг потока ОБРАТНОго вызова \_ и идентификатор потока в вызове **Мидиинопен** или **мидиаутопен**. В этом случае сообщения будут публиковаться в указанном потоке, а не в окне.

Сообщения, отправленные в ответный вызов окна или потока, относятся к используемому устройству MIDI. Дополнительные сведения об этих сообщениях см. в разделе [Отправка сообщений System-Exclusive](sending-system-exclusive-messages.md) и [Управление записью MIDI](managing-midi-recording.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Службы MIDI](midi-services.md)
</dt> </dl>

 

 