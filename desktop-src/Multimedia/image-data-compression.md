---
title: Сжатие Image-Data
description: Сжатие Image-Data
ms.assetid: 689cf403-cbb5-4ccb-a05b-0caa617430ed
keywords:
- Диспетчер сжатия видео (ВКМ), изображение — сжатие данных
- ВКМ (диспетчер сжатия видео), изображение — сжатие данных
- Функция Иккомпресс
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8b8f59a163a9b5a74d2d2fe984417069985fa86a
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104412844"
---
# <a name="image-data-compression"></a><span data-ttu-id="84b70-106">Сжатие Image-Data</span><span class="sxs-lookup"><span data-stu-id="84b70-106">Image-Data Compression</span></span>

<span data-ttu-id="84b70-107">Приложение может использовать ряд функций и макросов [**иккомпресс**](/windows/desktop/api/Vfw/nf-vfw-iccompress) для сжатия данных.</span><span class="sxs-lookup"><span data-stu-id="84b70-107">Your application can use a series of [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) functions and macros to compress data.</span></span> <span data-ttu-id="84b70-108">Функции и макросы могут помочь в выполнении следующих задач:</span><span class="sxs-lookup"><span data-stu-id="84b70-108">The functions and macros can help you perform the following tasks:</span></span>

-   <span data-ttu-id="84b70-109">Определите формат сжатия, используемый для указанного формата входных данных.</span><span class="sxs-lookup"><span data-stu-id="84b70-109">Determine the compression format to use for a specified input format.</span></span>
-   <span data-ttu-id="84b70-110">Подготовьте программу сжатия.</span><span class="sxs-lookup"><span data-stu-id="84b70-110">Prepare the compressor.</span></span>
-   <span data-ttu-id="84b70-111">Сжатие данных.</span><span class="sxs-lookup"><span data-stu-id="84b70-111">Compress the data.</span></span>
-   <span data-ttu-id="84b70-112">Конечное сжатие.</span><span class="sxs-lookup"><span data-stu-id="84b70-112">End compression.</span></span>

<span data-ttu-id="84b70-113">Приложение может увеличить контроль над процессом сжатия с помощью функций и макросов [**иккомпресс**](/windows/desktop/api/Vfw/nf-vfw-iccompress) .</span><span class="sxs-lookup"><span data-stu-id="84b70-113">Your application can increase control over the compression process by using the [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) functions and macros.</span></span> <span data-ttu-id="84b70-114">Эта группа функций и макросов обрабатывает отдельные кадры, а не последовательность в целом.</span><span class="sxs-lookup"><span data-stu-id="84b70-114">This group of functions and macros handles individual frames, rather than the sequence as a whole.</span></span> <span data-ttu-id="84b70-115">Например, приложение может обозначать кадры для сжатия в виде ключевых кадров с помощью функции **иккомпресс** .</span><span class="sxs-lookup"><span data-stu-id="84b70-115">For example, your application can identify the frames to compress as key frames by using the **ICCompress** function.</span></span>

<span data-ttu-id="84b70-116">Программа сжатия получает данные в одном формате, сжимает их и возвращает сжатую версию данных в указанном формате.</span><span class="sxs-lookup"><span data-stu-id="84b70-116">A compressor receives data in one format, compresses the data, and returns a compressed version of the data using a specified format.</span></span> <span data-ttu-id="84b70-117">Стандартный формат ввода определяет DIB, используя структуру [**битмапинфо**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) .</span><span class="sxs-lookup"><span data-stu-id="84b70-117">The typical input format specifies DIBs using the [**BITMAPINFO**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) structure.</span></span> <span data-ttu-id="84b70-118">В стандартном формате вывода указываются сжатые DIB, также используется структура **битмапинфо** .</span><span class="sxs-lookup"><span data-stu-id="84b70-118">The typical output format specifies compressed DIBs, also using the **BITMAPINFO** structure.</span></span>

> [!Note]  
> <span data-ttu-id="84b70-119">Чтобы уменьшить качество изображения и звука во время воспроизведения, старайтесь не сжимать файл AVI более одного раза.</span><span class="sxs-lookup"><span data-stu-id="84b70-119">To minimize image and audio degradation during playback, avoid compressing an AVI file more than once.</span></span> <span data-ttu-id="84b70-120">Объедините несжатые фрагменты видео в систему редактирования, а затем выполните сжатие окончательного продукта.</span><span class="sxs-lookup"><span data-stu-id="84b70-120">Combine uncompressed pieces of video in your editing system and then compress the final product.</span></span>

 

## <a name="compressor-and-compression-format-selection"></a><span data-ttu-id="84b70-121">Выбор формата сжатия и сжатия</span><span class="sxs-lookup"><span data-stu-id="84b70-121">Compressor and Compression Format Selection</span></span>

<span data-ttu-id="84b70-122">Если вы хотите сжать данные, а приложение требует определенного формата вывода, отправьте сообщение с [**\_ \_ запросом ICM сжимать**](icm-compress-query.md) (или используйте макрос [**иккомпресскуери**](/windows/desktop/api/Vfw/nf-vfw-iccompressquery) ) для запроса сжатия, чтобы определить, поддерживает ли он форматы входных и выходных данных.</span><span class="sxs-lookup"><span data-stu-id="84b70-122">If you want to compress data and your application requires a specific output format, send the [**ICM\_COMPRESS\_QUERY**](icm-compress-query.md) message (or use the [**ICCompressQuery**](/windows/desktop/api/Vfw/nf-vfw-iccompressquery) macro) to query the compressor to determine if it supports the input and output formats.</span></span>

<span data-ttu-id="84b70-123">Если формат вывода не важен для вашего приложения, необходимо найти только компрессор, который может работать с входным форматом.</span><span class="sxs-lookup"><span data-stu-id="84b70-123">If the output format is not important to your application, you need only find a compressor that can handle the input format.</span></span> <span data-ttu-id="84b70-124">Чтобы определить, может ли программа сжатия работать с входным форматом, можно отправить **\_ \_ запрос на сжатие ICM**, указав **null** для параметра *lParam* .</span><span class="sxs-lookup"><span data-stu-id="84b70-124">To determine if a compressor can handle the input format, you can send **ICM\_COMPRESS\_QUERY**, specifying **NULL** for the *lParam* parameter.</span></span> <span data-ttu-id="84b70-125">Это сообщение не возвращает выходной формат в приложение.</span><span class="sxs-lookup"><span data-stu-id="84b70-125">This message does not return the output format to your application.</span></span> <span data-ttu-id="84b70-126">Приложение может определить размер буфера, необходимый для данных, указывающих на формат сжатия, отправив сообщение [**ICM \_ Get- \_ \_ Format**](icm-compress-get-format.md) (или используйте макрос [**иккомпрессжетформатсизе**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformatsize) ).</span><span class="sxs-lookup"><span data-stu-id="84b70-126">Your application can determine the buffer size needed for the data specifying the compression format by sending the [**ICM\_COMPRESS\_GET\_FORMAT**](icm-compress-get-format.md) message (or use the [**ICCompressGetFormatSize**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformatsize) macro).</span></span> <span data-ttu-id="84b70-127">Можно также получить данные формата, отправив Формат ICM \_ \_ ReGet \_ (или макрос [**иккомпрессжетформат**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformat) ).</span><span class="sxs-lookup"><span data-stu-id="84b70-127">You can also retrieve the format data by sending ICM\_COMPRESS\_GET\_FORMAT (or the [**ICCompressGetFormat**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformat) macro).</span></span>

<span data-ttu-id="84b70-128">Если необходимо определить самый крупный буфер, который может потребоваться для сжатия, отправьте сообщение [**ICM \_ \_ Get \_ size**](icm-compress-get-size.md) (или используйте макрос [**иккомпрессжетсизе**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetsize) ).</span><span class="sxs-lookup"><span data-stu-id="84b70-128">If you want to determine the largest buffer that the compressor could require for compression, send the [**ICM\_COMPRESS\_GET\_SIZE**](icm-compress-get-size.md) message (or use the [**ICCompressGetSize**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetsize) macro).</span></span> <span data-ttu-id="84b70-129">Можно использовать число байтов, возвращаемых функцией [**иксендмессаже**](/windows/desktop/api/Vfw/nf-vfw-icsendmessage) , чтобы выделить буфер для последующих сжатий изображений.</span><span class="sxs-lookup"><span data-stu-id="84b70-129">You can use the number of bytes returned by the [**ICSendMessage**](/windows/desktop/api/Vfw/nf-vfw-icsendmessage) function to allocate a buffer for subsequent image compressions.</span></span>

## <a name="compressor-initialization"></a><span data-ttu-id="84b70-130">Инициализация программы сжатия</span><span class="sxs-lookup"><span data-stu-id="84b70-130">Compressor Initialization</span></span>

<span data-ttu-id="84b70-131">После того как приложение выберет программу сжатия, способную работать с нужными форматами ввода и вывода, можно инициализировать программу сжатия с помощью сообщения о [**\_ \_ начале сжатия ICM**](icm-compress-begin.md) (или использовать макрос [**иккомпрессбегин**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) ).</span><span class="sxs-lookup"><span data-stu-id="84b70-131">After your application selects a compressor that can handle the input and output formats it needs, you can initialize the compressor by using the [**ICM\_COMPRESS\_BEGIN**](icm-compress-begin.md) message (or use the [**ICCompressBegin**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) macro).</span></span> <span data-ttu-id="84b70-132">Для этого сообщения требуется маркер сжатия, а также форматы входных и выходных данных.</span><span class="sxs-lookup"><span data-stu-id="84b70-132">This message requires the compressor handle and the input and output formats.</span></span>

## <a name="data-compression"></a><span data-ttu-id="84b70-133">Сжатие данных</span><span class="sxs-lookup"><span data-stu-id="84b70-133">Data Compression</span></span>

<span data-ttu-id="84b70-134">Для сжатия кадра можно использовать функцию [**иккомпресс**](/windows/desktop/api/Vfw/nf-vfw-iccompress) .</span><span class="sxs-lookup"><span data-stu-id="84b70-134">You can use the [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) function to compress a frame.</span></span> <span data-ttu-id="84b70-135">Приложение должно повторно использовать эту функцию до тех пор, пока не будут сжаты все кадры в последовательности.</span><span class="sxs-lookup"><span data-stu-id="84b70-135">Your application must use this function repeatedly until all the frames in a sequence are compressed.</span></span> <span data-ttu-id="84b70-136">Приложение должно также отзаписывать и увеличивать число каждого кадра, сжатого с помощью **иккомпресс**.</span><span class="sxs-lookup"><span data-stu-id="84b70-136">Your application must also track and increment the number of each frame compressed with **ICCompress**.</span></span> <span data-ttu-id="84b70-137">Программа сжатия использует это значение для проверки того, отправляются ли кадры в неопределенном порядке во время быстрого сжатия (при этом сохраняются различия между последовательными кадрами).</span><span class="sxs-lookup"><span data-stu-id="84b70-137">The compressor uses this value to check if frames are sent out of order during fast temporal compression (storing differences between successive frames).</span></span> <span data-ttu-id="84b70-138">Если приложение повторно сжимает кадр, оно должно использовать тот же номер кадра, что и при первом сжатии кадра.</span><span class="sxs-lookup"><span data-stu-id="84b70-138">If your application recompresses a frame, it should use the same frame number as when the frame was first compressed.</span></span> <span data-ttu-id="84b70-139">Если приложение сжимает изображение по прежнему кадру, оно может указать нулевой номер кадра.</span><span class="sxs-lookup"><span data-stu-id="84b70-139">If your application compresses a still-frame image, it can specify a frame number of zero.</span></span>

<span data-ttu-id="84b70-140">Приложение может использовать флаг **иккомпресс для \_ кадров** , чтобы кадр был сжат с помощью [**иккомпресс**](/windows/desktop/api/Vfw/nf-vfw-iccompress) ключевого кадра.</span><span class="sxs-lookup"><span data-stu-id="84b70-140">Your application can use the **ICCOMPRESS\_KEYFRAME** flag to make the frame compressed by [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) a key frame.</span></span>

<span data-ttu-id="84b70-141">Когда ВКМ возвращает управление приложению после сжатия кадра, ВКМ сохраняет сжатые данные в структурах, на которые ссылаются параметры *лпбиаутпут* и *лпдата* .</span><span class="sxs-lookup"><span data-stu-id="84b70-141">When VCM returns control to your application after compressing a frame, VCM stores the compressed data in the structures referenced by the *lpbiOutput* and *lpData* parameters.</span></span> <span data-ttu-id="84b70-142">Если приложению необходимо переместить сжатые данные, он может найти его размер в элементе *бисизеимаже* структуры [**битмапинфо**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) , указанной в *лпбиаутпут*.</span><span class="sxs-lookup"><span data-stu-id="84b70-142">If your application needs to move the compressed data, it can find its size in the *biSizeImage* member of the [**BITMAPINFO**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) structure specified in *lpbiOutput*.</span></span>

> [!Note]  
> <span data-ttu-id="84b70-143">Приложение должно выделить структуры и буферы, в которых хранятся несжатые и сжатые данные.</span><span class="sxs-lookup"><span data-stu-id="84b70-143">Your application must allocate the structures and buffers that store the uncompressed and compressed data.</span></span> <span data-ttu-id="84b70-144">Если программа сжатия поддерживает временное сжатие, приложение должно также выделить структуру и буфер для хранения формата и данных для предыдущего кадра данных.</span><span class="sxs-lookup"><span data-stu-id="84b70-144">If the compressor supports temporal compression, your application must also allocate a structure and buffer to hold the format and data for the previous frame of information.</span></span>

 

## <a name="ending-compression"></a><span data-ttu-id="84b70-145">Завершение сжатия</span><span class="sxs-lookup"><span data-stu-id="84b70-145">Ending Compression</span></span>

<span data-ttu-id="84b70-146">После сжатия данных приложение может использовать макрос [**иккомпрессенд**](/windows/desktop/api/Vfw/nf-vfw-iccompressend) для уведомления об окончании работы программы сжатия.</span><span class="sxs-lookup"><span data-stu-id="84b70-146">After your application has compressed the data, it can use the [**ICCompressEnd**](/windows/desktop/api/Vfw/nf-vfw-iccompressend) macro to notify the compressor that it has finished.</span></span> <span data-ttu-id="84b70-147">Если вы хотите перезапустить сжатие после использования этой функции, приложение должно повторно инициализировать программу сжатия, отправив сообщение [**о \_ \_ начале сжатия ICM**](icm-compress-begin.md) (или используя макрос [**иккомпрессбегин**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) ).</span><span class="sxs-lookup"><span data-stu-id="84b70-147">If you want to restart compression after using this function, your application must reinitialize the compressor by sending the [**ICM\_COMPRESS\_BEGIN**](icm-compress-begin.md) message (or use the [**ICCompressBegin**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) macro).</span></span>

 

 