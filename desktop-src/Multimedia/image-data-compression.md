---
title: Сжатие Image-Data
description: Сжатие Image-Data
ms.assetid: 689cf403-cbb5-4ccb-a05b-0caa617430ed
keywords:
- Диспетчер сжатия видео (ВКМ), изображение — сжатие данных
- ВКМ (диспетчер сжатия видео), изображение — сжатие данных
- Функция Иккомпресс
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bf638467e3685b24a65cd47492faed6660e77e5c49864a339a3874eb81e9b5af
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120038684"
---
# <a name="image-data-compression"></a>Сжатие Image-Data

Приложение может использовать ряд функций и макросов [**иккомпресс**](/windows/desktop/api/Vfw/nf-vfw-iccompress) для сжатия данных. Функции и макросы могут помочь в выполнении следующих задач:

-   Определите формат сжатия, используемый для указанного формата входных данных.
-   Подготовьте программу сжатия.
-   Сжатие данных.
-   Конечное сжатие.

Приложение может увеличить контроль над процессом сжатия с помощью функций и макросов [**иккомпресс**](/windows/desktop/api/Vfw/nf-vfw-iccompress) . Эта группа функций и макросов обрабатывает отдельные кадры, а не последовательность в целом. Например, приложение может обозначать кадры для сжатия в виде ключевых кадров с помощью функции **иккомпресс** .

Программа сжатия получает данные в одном формате, сжимает их и возвращает сжатую версию данных в указанном формате. Стандартный формат ввода определяет DIB, используя структуру [**битмапинфо**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) . В стандартном формате вывода указываются сжатые DIB, также используется структура **битмапинфо** .

> [!Note]  
> Чтобы уменьшить качество изображения и звука во время воспроизведения, старайтесь не сжимать файл AVI более одного раза. Объедините несжатые фрагменты видео в систему редактирования, а затем выполните сжатие окончательного продукта.

 

## <a name="compressor-and-compression-format-selection"></a>Выбор формата сжатия и сжатия

Если вы хотите сжать данные, а приложение требует определенного формата вывода, отправьте сообщение с [**\_ \_ запросом ICM сжимать**](icm-compress-query.md) (или используйте макрос [**иккомпресскуери**](/windows/desktop/api/Vfw/nf-vfw-iccompressquery) ) для запроса сжатия, чтобы определить, поддерживает ли он форматы входных и выходных данных.

Если формат вывода не важен для вашего приложения, необходимо найти только компрессор, который может работать с входным форматом. Чтобы определить, может ли программа сжатия работать с входным форматом, можно отправить **\_ \_ запрос на сжатие ICM**, указав **null** для параметра *lParam* . Это сообщение не возвращает выходной формат в приложение. Приложение может определить размер буфера, необходимый для данных, указывающих на формат сжатия, отправив сообщение [**ICM \_ Get- \_ \_ Format**](icm-compress-get-format.md) (или используйте макрос [**иккомпрессжетформатсизе**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformatsize) ). Можно также получить данные формата, отправив Формат ICM \_ \_ ReGet \_ (или макрос [**иккомпрессжетформат**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformat) ).

Если необходимо определить самый крупный буфер, который может потребоваться для сжатия, отправьте сообщение [**ICM \_ \_ Get \_ size**](icm-compress-get-size.md) (или используйте макрос [**иккомпрессжетсизе**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetsize) ). Можно использовать число байтов, возвращаемых функцией [**иксендмессаже**](/windows/desktop/api/Vfw/nf-vfw-icsendmessage) , чтобы выделить буфер для последующих сжатий изображений.

## <a name="compressor-initialization"></a>Инициализация программы сжатия

После того как приложение выберет программу сжатия, способную работать с нужными форматами ввода и вывода, можно инициализировать программу сжатия с помощью сообщения о [**\_ \_ начале сжатия ICM**](icm-compress-begin.md) (или использовать макрос [**иккомпрессбегин**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) ). Для этого сообщения требуется маркер сжатия, а также форматы входных и выходных данных.

## <a name="data-compression"></a>Сжатие данных

Для сжатия кадра можно использовать функцию [**иккомпресс**](/windows/desktop/api/Vfw/nf-vfw-iccompress) . Приложение должно повторно использовать эту функцию до тех пор, пока не будут сжаты все кадры в последовательности. Приложение должно также отзаписывать и увеличивать число каждого кадра, сжатого с помощью **иккомпресс**. Программа сжатия использует это значение для проверки того, отправляются ли кадры в неопределенном порядке во время быстрого сжатия (при этом сохраняются различия между последовательными кадрами). Если приложение повторно сжимает кадр, оно должно использовать тот же номер кадра, что и при первом сжатии кадра. Если приложение сжимает изображение по прежнему кадру, оно может указать нулевой номер кадра.

Приложение может использовать флаг **иккомпресс для \_ кадров** , чтобы кадр был сжат с помощью [**иккомпресс**](/windows/desktop/api/Vfw/nf-vfw-iccompress) ключевого кадра.

Когда ВКМ возвращает управление приложению после сжатия кадра, ВКМ сохраняет сжатые данные в структурах, на которые ссылаются параметры *лпбиаутпут* и *лпдата* . Если приложению необходимо переместить сжатые данные, он может найти его размер в элементе *бисизеимаже* структуры [**битмапинфо**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) , указанной в *лпбиаутпут*.

> [!Note]  
> Приложение должно выделить структуры и буферы, в которых хранятся несжатые и сжатые данные. Если программа сжатия поддерживает временное сжатие, приложение должно также выделить структуру и буфер для хранения формата и данных для предыдущего кадра данных.

 

## <a name="ending-compression"></a>Завершение сжатия

После сжатия данных приложение может использовать макрос [**иккомпрессенд**](/windows/desktop/api/Vfw/nf-vfw-iccompressend) для уведомления об окончании работы программы сжатия. Если вы хотите перезапустить сжатие после использования этой функции, приложение должно повторно инициализировать программу сжатия, отправив сообщение [**о \_ \_ начале сжатия ICM**](icm-compress-begin.md) (или используя макрос [**иккомпрессбегин**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) ).

 

 