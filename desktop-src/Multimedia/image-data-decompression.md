---
title: Распаковка Image-Data
description: Распаковка Image-Data
ms.assetid: 4bff02be-dac8-41f4-a3af-2da6a2693ffe
keywords:
- Диспетчер сжатия видео (ВКМ), изображение — распаковка данных
- ВКМ (диспетчер сжатия видео), изображение — распаковка данных
- Функции Икдекомпрессекс
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5006a019fd3fcf24a08f620186af8eb09d9516e103722395ed96722b48696cb8
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119495604"
---
# <a name="image-data-decompression"></a>Распаковка Image-Data

Приложение использует ряд функций [**икдекомпрессекс**](/windows/desktop/api/Vfw/nf-vfw-icdecompressex) для управления декомпрессором. Функции могут помочь в выполнении следующих задач:

-   Выберите декомпрессор.
-   Подготовьте декомпрессор.
-   Распакуйте данные.
-   Завершение распаковки.

Приложение обрабатывает распаковку таким же образом, как и способ обработки сжатия, за исключением того, что входной формат является сжатым форматом, а формат выходных данных — отображаемым форматом. Формат входных данных для распаковки обычно получается из заголовка потока. После определения формата входных данных приложение может использовать функции [**иклокате**](/windows/desktop/api/Vfw/nf-vfw-iclocate) или [**икопен**](/windows/desktop/api/Vfw/nf-vfw-icopen) для поиска декомпрессора, который может справиться с этой функцией.

Функции и макросы [**икдекомпрессекс**](/windows/desktop/api/Vfw/nf-vfw-icdecompressex) являются надмножеством группы функций [**икдекомпресс**](/windows/desktop/api/Vfw/nf-vfw-icdecompress) и предоставляют больше возможностей. Функциональные возможности **икдекомпрессекс**, [**икдекомпрессексбегин**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexbegin), [**икдекомпрессексенд**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexend)и [**икдекомпрессекскуери**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery) заменяют функции **икдекомпресс**, [**ICDecompressBegin**](/windows/desktop/api/Vfw/nf-vfw-icdecompressbegin), [**ICDecompressEnd**](/windows/desktop/api/Vfw/nf-vfw-icdecompressend)и [**ICDecompressQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressquery) . Используйте функции и макросы **икдекомпрессекс** вместо эквивалентов **икдекомпресс** .

## <a name="decompressor-and-decompression-format-selection"></a>Декомпрессор и распаковка выбор формата

Если требуется распаковать данные и приложение требует определенного формата вывода, можно использовать функцию [**икдекомпрессекскуери**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery) для запроса декомпрессора, чтобы определить, поддерживает ли он форматы входных и выходных данных.

Если формат выходных данных не важен в приложении, необходимо найти только декомпрессор, способный работать с входным форматом. Чтобы определить, может ли декомпрессор работать с входным форматом, используйте [**икдекомпрессекскуери**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery) и укажите **значение NULL** для параметра *лпбидст* . Приложение может определить размер буфера, необходимый для данных, указывающих формат распаковки, отправив сообщение [**о \_ \_ \_ форматировании ICM Get**](icm-decompress-get-format.md) (или используйте макрос [**икдекомпрессжетформатсизе**](/windows/desktop/api/Vfw/nf-vfw-icdecompressgetformatsize) ). Можно также отправить **ICM- \_ \_ \_ Формат Get** (или макрос [**икдекомпрессжетформат**](/windows/desktop/api/Vfw/nf-vfw-icdecompressgetformat) ) для получения данных формата. Декомпрессор возвращает предлагаемый формат в структуре [**битмапинфо**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) . Этот формат обычно сохраняет большую часть информации во время распаковки. Приложение должно убедиться, что декомпрессор успешно завершается до распаковки информации.

Так как приложение выделяет память, необходимую для распаковки, ей необходимо определить максимальный объем памяти, который может потребоваться декомпрессору для формата выходных данных. Сообщение **ICM \_ unуплотнение \_ получения \_ формата** получает число байтов, используемых декомпрессором для формата по умолчанию.

Если приложение определяет собственный формат с помощью [**икдекомпрессекскуери**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery), оно также должно получить палитру для точечного рисунка. **Икдекомпрессекскуери** не предоставляет определения палитры. (Большинство приложений используют стандартные форматы и не требуют получения палитры.) Приложение может получить палитру, отправив сообщение [**ICM \_ распаковка \_ Получение \_ палитры**](icm-decompress-get-palette.md) (или используя макрос [**икдекомпрессжетпалетте**](/windows/desktop/api/Vfw/nf-vfw-icdecompressgetpalette) ).

## <a name="decompressor-initialization"></a>Инициализация декомпрессора

После того как приложение выберет декомпрессор, способный работать с нужными форматами входных и выходных данных, можно инициализировать декомпрессор с помощью функции [**икдекомпрессексбегин**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexbegin) . Эта функция требует наличия обработчика декомпрессора и форматов входных и выходных данных.

## <a name="data-decompression"></a>Распаковка данных

Для распаковки кадра можно использовать функцию [**икдекомпрессекс**](/windows/desktop/api/Vfw/nf-vfw-icdecompressex) . Приложение должно использовать эту функцию несколько раз, пока не будут распакованы все кадры в последовательности.

Если поток видео отстает от других компонентов (например, аудио) во время воспроизведения, приложение может указать флаг **икдекомпресс \_ хуррюп** , чтобы ускорить распаковку. Для этого декомпрессор может извлекать только сведения, необходимые для распаковки следующего кадра и не полностью распаковывать текущий кадр. Поэтому приложение не должно пытаться рисовать распакованные данные при использовании этого флага.

После распаковки данных приложение может отправить сообщение [**ICM \_ \_ декомпрессекс**](icm-decompressex-end.md) (или использовать макрос [**икдекомпрессексенд**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexend) ), чтобы уведомить о завершении декомпрессора. Если вы хотите перезапустить распаковку после использования этой функции, приложение должно повторно инициализировать декомпрессор с помощью [**икдекомпрессексбегин**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexbegin).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[ВКМ Services](vcm-services.md)
</dt> </dl>

 

 