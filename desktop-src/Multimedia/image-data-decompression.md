---
title: Распаковка Image-Data
description: Распаковка Image-Data
ms.assetid: 4bff02be-dac8-41f4-a3af-2da6a2693ffe
keywords:
- Диспетчер сжатия видео (ВКМ), изображение — распаковка данных
- ВКМ (диспетчер сжатия видео), изображение — распаковка данных
- Функции Икдекомпрессекс
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 25614f157436056f7f24c340f6cc6f4dbc62d9ae
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104337121"
---
# <a name="image-data-decompression"></a><span data-ttu-id="66885-106">Распаковка Image-Data</span><span class="sxs-lookup"><span data-stu-id="66885-106">Image-Data Decompression</span></span>

<span data-ttu-id="66885-107">Приложение использует ряд функций [**икдекомпрессекс**](/windows/desktop/api/Vfw/nf-vfw-icdecompressex) для управления декомпрессором.</span><span class="sxs-lookup"><span data-stu-id="66885-107">Your application uses a series of [**ICDecompressEx**](/windows/desktop/api/Vfw/nf-vfw-icdecompressex) functions to control the decompressor.</span></span> <span data-ttu-id="66885-108">Функции могут помочь в выполнении следующих задач:</span><span class="sxs-lookup"><span data-stu-id="66885-108">The functions can help you perform the following tasks:</span></span>

-   <span data-ttu-id="66885-109">Выберите декомпрессор.</span><span class="sxs-lookup"><span data-stu-id="66885-109">Select a decompressor.</span></span>
-   <span data-ttu-id="66885-110">Подготовьте декомпрессор.</span><span class="sxs-lookup"><span data-stu-id="66885-110">Prepare the decompressor.</span></span>
-   <span data-ttu-id="66885-111">Распакуйте данные.</span><span class="sxs-lookup"><span data-stu-id="66885-111">Decompress the data.</span></span>
-   <span data-ttu-id="66885-112">Завершение распаковки.</span><span class="sxs-lookup"><span data-stu-id="66885-112">End decompression.</span></span>

<span data-ttu-id="66885-113">Приложение обрабатывает распаковку таким же образом, как и способ обработки сжатия, за исключением того, что входной формат является сжатым форматом, а формат выходных данных — отображаемым форматом.</span><span class="sxs-lookup"><span data-stu-id="66885-113">Your application handles decompression similarly to the way it handles compression, except that the input format is a compressed format and the output format is a displayable format.</span></span> <span data-ttu-id="66885-114">Формат входных данных для распаковки обычно получается из заголовка потока.</span><span class="sxs-lookup"><span data-stu-id="66885-114">The input format for decompression is usually obtained from the stream header.</span></span> <span data-ttu-id="66885-115">После определения формата входных данных приложение может использовать функции [**иклокате**](/windows/desktop/api/Vfw/nf-vfw-iclocate) или [**икопен**](/windows/desktop/api/Vfw/nf-vfw-icopen) для поиска декомпрессора, который может справиться с этой функцией.</span><span class="sxs-lookup"><span data-stu-id="66885-115">After determining the input format, your application can use the [**ICLocate**](/windows/desktop/api/Vfw/nf-vfw-iclocate) or [**ICOpen**](/windows/desktop/api/Vfw/nf-vfw-icopen) functions to find a decompressor that can handle it.</span></span>

<span data-ttu-id="66885-116">Функции и макросы [**икдекомпрессекс**](/windows/desktop/api/Vfw/nf-vfw-icdecompressex) являются надмножеством группы функций [**икдекомпресс**](/windows/desktop/api/Vfw/nf-vfw-icdecompress) и предоставляют больше возможностей.</span><span class="sxs-lookup"><span data-stu-id="66885-116">The [**ICDecompressEx**](/windows/desktop/api/Vfw/nf-vfw-icdecompressex) functions and macros are a superset of the [**ICDecompress**](/windows/desktop/api/Vfw/nf-vfw-icdecompress) function group and provide more capabilities.</span></span> <span data-ttu-id="66885-117">Функциональные возможности **икдекомпрессекс**, [**икдекомпрессексбегин**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexbegin), [**икдекомпрессексенд**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexend)и [**икдекомпрессекскуери**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery) заменяют функции **икдекомпресс**, [**ICDecompressBegin**](/windows/desktop/api/Vfw/nf-vfw-icdecompressbegin), [**ICDecompressEnd**](/windows/desktop/api/Vfw/nf-vfw-icdecompressend)и [**ICDecompressQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressquery) .</span><span class="sxs-lookup"><span data-stu-id="66885-117">The functionality of **ICDecompressEx**, [**ICDecompressExBegin**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexbegin), [**ICDecompressExEnd**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexend), and [**ICDecompressExQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery) replaces that of the **ICDecompress**, [**ICDecompressBegin**](/windows/desktop/api/Vfw/nf-vfw-icdecompressbegin), [**ICDecompressEnd**](/windows/desktop/api/Vfw/nf-vfw-icdecompressend), and [**ICDecompressQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressquery) functions.</span></span> <span data-ttu-id="66885-118">Используйте функции и макросы **икдекомпрессекс** вместо эквивалентов **икдекомпресс** .</span><span class="sxs-lookup"><span data-stu-id="66885-118">Use the **ICDecompressEx** functions and macros in place of the **ICDecompress** equivalents.</span></span>

## <a name="decompressor-and-decompression-format-selection"></a><span data-ttu-id="66885-119">Декомпрессор и распаковка выбор формата</span><span class="sxs-lookup"><span data-stu-id="66885-119">Decompressor and Decompression Format Selection</span></span>

<span data-ttu-id="66885-120">Если требуется распаковать данные и приложение требует определенного формата вывода, можно использовать функцию [**икдекомпрессекскуери**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery) для запроса декомпрессора, чтобы определить, поддерживает ли он форматы входных и выходных данных.</span><span class="sxs-lookup"><span data-stu-id="66885-120">If you want to decompress data and your application requires a specific output format, you can use the [**ICDecompressExQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery) function to query the decompressor to determine if it supports the input and output formats.</span></span>

<span data-ttu-id="66885-121">Если формат выходных данных не важен в приложении, необходимо найти только декомпрессор, способный работать с входным форматом.</span><span class="sxs-lookup"><span data-stu-id="66885-121">If the output format is not important in your application, you need only find a decompressor that can handle the input format.</span></span> <span data-ttu-id="66885-122">Чтобы определить, может ли декомпрессор работать с входным форматом, используйте [**икдекомпрессекскуери**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery) и укажите **значение NULL** для параметра *лпбидст* .</span><span class="sxs-lookup"><span data-stu-id="66885-122">To determine if a decompressor can handle the input format, use [**ICDecompressExQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery) and specify **NULL** for the *lpbiDst* parameter.</span></span> <span data-ttu-id="66885-123">Приложение может определить размер буфера, необходимый для данных, указывающих формат распаковки, отправив сообщение [**о \_ \_ \_ форматировании ICM Get**](icm-decompress-get-format.md) (или используйте макрос [**икдекомпрессжетформатсизе**](/windows/desktop/api/Vfw/nf-vfw-icdecompressgetformatsize) ).</span><span class="sxs-lookup"><span data-stu-id="66885-123">Your application can determine the buffer size needed for the data specifying the decompression format by sending the [**ICM\_DECOMPRESS\_GET\_FORMAT**](icm-decompress-get-format.md) message (or use the [**ICDecompressGetFormatSize**](/windows/desktop/api/Vfw/nf-vfw-icdecompressgetformatsize) macro).</span></span> <span data-ttu-id="66885-124">Можно также отправить **ICM- \_ \_ \_ Формат Get** (или макрос [**икдекомпрессжетформат**](/windows/desktop/api/Vfw/nf-vfw-icdecompressgetformat) ) для получения данных формата.</span><span class="sxs-lookup"><span data-stu-id="66885-124">You can also send **ICM\_DECOMPRESS\_GET\_FORMAT** (or the [**ICDecompressGetFormat**](/windows/desktop/api/Vfw/nf-vfw-icdecompressgetformat) macro) to retrieve the format data.</span></span> <span data-ttu-id="66885-125">Декомпрессор возвращает предлагаемый формат в структуре [**битмапинфо**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) .</span><span class="sxs-lookup"><span data-stu-id="66885-125">The decompressor returns its suggested format in a [**BITMAPINFO**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) structure.</span></span> <span data-ttu-id="66885-126">Этот формат обычно сохраняет большую часть информации во время распаковки.</span><span class="sxs-lookup"><span data-stu-id="66885-126">This format typically preserves the most information during decompression.</span></span> <span data-ttu-id="66885-127">Приложение должно убедиться, что декомпрессор успешно завершается до распаковки информации.</span><span class="sxs-lookup"><span data-stu-id="66885-127">Your application should ensure that the decompressor returns successfully before it decompresses the information.</span></span>

<span data-ttu-id="66885-128">Так как приложение выделяет память, необходимую для распаковки, ей необходимо определить максимальный объем памяти, который может потребоваться декомпрессору для формата выходных данных.</span><span class="sxs-lookup"><span data-stu-id="66885-128">Because your application allocates the memory required for decompression, it needs to determine the maximum memory the decompressor can require for the output format.</span></span> <span data-ttu-id="66885-129">Сообщение **ICM \_ unуплотнение \_ получения \_ формата** получает число байтов, используемых декомпрессором для формата по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="66885-129">The **ICM\_DECOMPRESS\_GET\_FORMAT** message obtains the number of bytes the decompressor uses for the default format.</span></span>

<span data-ttu-id="66885-130">Если приложение определяет собственный формат с помощью [**икдекомпрессекскуери**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery), оно также должно получить палитру для точечного рисунка. **Икдекомпрессекскуери** не предоставляет определения палитры.</span><span class="sxs-lookup"><span data-stu-id="66885-130">If your application defines its own format by using [**ICDecompressExQuery**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexquery), it must also obtain a palette for the bitmap; **ICDecompressExQuery** does not provide palette definitions.</span></span> <span data-ttu-id="66885-131">(Большинство приложений используют стандартные форматы и не требуют получения палитры.) Приложение может получить палитру, отправив сообщение [**ICM \_ распаковка \_ Получение \_ палитры**](icm-decompress-get-palette.md) (или используя макрос [**икдекомпрессжетпалетте**](/windows/desktop/api/Vfw/nf-vfw-icdecompressgetpalette) ).</span><span class="sxs-lookup"><span data-stu-id="66885-131">(Most applications use standard formats and do not need to obtain a palette.) Your application can obtain the palette by sending the [**ICM\_DECOMPRESS\_GET\_PALETTE**](icm-decompress-get-palette.md) message (or use the [**ICDecompressGetPalette**](/windows/desktop/api/Vfw/nf-vfw-icdecompressgetpalette) macro).</span></span>

## <a name="decompressor-initialization"></a><span data-ttu-id="66885-132">Инициализация декомпрессора</span><span class="sxs-lookup"><span data-stu-id="66885-132">Decompressor Initialization</span></span>

<span data-ttu-id="66885-133">После того как приложение выберет декомпрессор, способный работать с нужными форматами входных и выходных данных, можно инициализировать декомпрессор с помощью функции [**икдекомпрессексбегин**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexbegin) .</span><span class="sxs-lookup"><span data-stu-id="66885-133">After your application selects a decompressor that can handle the input and output formats it needs, you can initialize the decompressor by using the [**ICDecompressExBegin**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexbegin) function.</span></span> <span data-ttu-id="66885-134">Эта функция требует наличия обработчика декомпрессора и форматов входных и выходных данных.</span><span class="sxs-lookup"><span data-stu-id="66885-134">This function requires the decompressor handle and the input and output formats.</span></span>

## <a name="data-decompression"></a><span data-ttu-id="66885-135">Распаковка данных</span><span class="sxs-lookup"><span data-stu-id="66885-135">Data Decompression</span></span>

<span data-ttu-id="66885-136">Для распаковки кадра можно использовать функцию [**икдекомпрессекс**](/windows/desktop/api/Vfw/nf-vfw-icdecompressex) .</span><span class="sxs-lookup"><span data-stu-id="66885-136">You can use the [**ICDecompressEx**](/windows/desktop/api/Vfw/nf-vfw-icdecompressex) function to decompress a frame.</span></span> <span data-ttu-id="66885-137">Приложение должно использовать эту функцию несколько раз, пока не будут распакованы все кадры в последовательности.</span><span class="sxs-lookup"><span data-stu-id="66885-137">Your application must use this function repeatedly until all the frames in a sequence are decompressed.</span></span>

<span data-ttu-id="66885-138">Если поток видео отстает от других компонентов (например, аудио) во время воспроизведения, приложение может указать флаг **икдекомпресс \_ хуррюп** , чтобы ускорить распаковку.</span><span class="sxs-lookup"><span data-stu-id="66885-138">If your video stream lags behind other components (such as audio) during playback, your application can specify the **ICDECOMPRESS\_HURRYUP** flag to speed decompression.</span></span> <span data-ttu-id="66885-139">Для этого декомпрессор может извлекать только сведения, необходимые для распаковки следующего кадра и не полностью распаковывать текущий кадр.</span><span class="sxs-lookup"><span data-stu-id="66885-139">To do this, a decompressor might extract only the information it needs to decompress the next frame and not fully decompress the current frame.</span></span> <span data-ttu-id="66885-140">Поэтому приложение не должно пытаться рисовать распакованные данные при использовании этого флага.</span><span class="sxs-lookup"><span data-stu-id="66885-140">Therefore, your application should not try to draw the decompressed data when it uses this flag.</span></span>

<span data-ttu-id="66885-141">После распаковки данных приложение может отправить сообщение [**ICM \_ \_ декомпрессекс**](icm-decompressex-end.md) (или использовать макрос [**икдекомпрессексенд**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexend) ), чтобы уведомить о завершении декомпрессора.</span><span class="sxs-lookup"><span data-stu-id="66885-141">After your application has decompressed the data, it can send the [**ICM\_DECOMPRESSEX\_END**](icm-decompressex-end.md) message (or use the [**ICDecompressExEnd**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexend) macro) to notify the decompressor that it has finished.</span></span> <span data-ttu-id="66885-142">Если вы хотите перезапустить распаковку после использования этой функции, приложение должно повторно инициализировать декомпрессор с помощью [**икдекомпрессексбегин**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexbegin).</span><span class="sxs-lookup"><span data-stu-id="66885-142">If you want to restart decompression after using this function, your application must reinitialize the decompressor by using [**ICDecompressExBegin**](/windows/desktop/api/Vfw/nf-vfw-icdecompressexbegin).</span></span>

## <a name="related-topics"></a><span data-ttu-id="66885-143">См. также</span><span class="sxs-lookup"><span data-stu-id="66885-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="66885-144">ВКМ Services</span><span class="sxs-lookup"><span data-stu-id="66885-144">VCM Services</span></span>](vcm-services.md)
</dt> </dl>

 

 