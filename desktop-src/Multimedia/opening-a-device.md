---
title: Открытие устройства
description: Открытие устройства
ms.assetid: d4881d32-e8b7-45e6-b00b-b4cd69b738f1
keywords:
- Команда MCI_OPEN
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cd975b0dd5004fb4b1209003568b7fd5901cfc4e
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104069853"
---
# <a name="opening-a-device"></a>Открытие устройства

Перед использованием устройства его необходимо инициализировать с помощью команды [**Open**](open.md) ([**MCI \_ Open**](mci-open.md)). Эта команда загружает драйвер в память (если он еще не загружен) и получает идентификатор устройства, который будет использоваться для идентификации устройства в последующих командах MCI. Необходимо проверить возвращаемое значение функции [**mciSendString**](/previous-versions//dd757161(v=vs.85)) или [**мЦисендкомманд**](/previous-versions//dd757160(v=vs.85)) перед использованием нового идентификатора устройства, чтобы убедиться, что идентификатор является допустимым. (Идентификатор устройства можно также получить с помощью функции [**мЦижетдевицеид**](/previous-versions//dd757156(v=vs.85)) .)

Как и все сообщения команды MCI, у **MCI \_ открыта** связанная структура. Эти структуры иногда называются *блоками параметров*. Структура по умолчанию для **MCI \_ открыта** — [**MCI \_ Open \_ пармс**](mci-open-parms.md). Некоторые устройства ( *например,* звуковая волна и *наложение*) имеют расширенные структуры (такие как [**MCI \_ Wave \_ Open \_ пармс**](mci-wave-open-parms.md) и [**MCI \_ овли \_ Open \_ пармс**](mci-ovly-open-parms.md)) для размещения дополнительных необязательных параметров. Если вы не хотите использовать эти дополнительные параметры, можно использовать структуру **MCI \_ Open \_ пармс** с любым устройством MCI.

Число открытых устройств ограничено только объемом доступной памяти.

## <a name="using-an-alias"></a>Использование псевдонима

При открытии устройства можно использовать флаг "псевдоним", чтобы указать идентификатор устройства. Этот флаг позволяет назначить короткий идентификатор устройства для составных устройств с длинными именами файлов и позволяет открыть несколько экземпляров одного и того же файла или устройства.

Например, следующая команда присваивает идентификатору устройства "бирдкалл" длинное имя файла C: \\ набирдс \\ Sounds \\ моккмтнг. ОБЪЕМ


```C++
mciSendString(
    "open c:\nabirds\sounds\mockmtng.wav type waveaudio alias birdcall", 
    lpszReturnString, lstrlen(lpszReturnString), NULL);
```



В интерфейсе сообщения командной строки псевдоним указывается с помощью элемента **лпстралиас** структуры [**MCI \_ Open \_ пармс**](mci-open-parms.md) .

## <a name="specifying-a-device-type"></a>Указание типа устройства

При открытии устройства можно использовать флаг "тип" для ссылки на тип устройства, а не на конкретный драйвер устройства. В следующем примере открывается файл волнового аудио C: \\ Windows \\ чимес. WAV (с помощью флага "тип" укажите тип устройства **вавеаудио** ) и назначает псевдоним "чимес":


```C++
mciSendString(
    "open c:\windows\chimes.wav type waveaudio alias chimes", 
    lpszReturnString, lstrlen(lpszReturnString), NULL);
```



В интерфейсе командного сообщения функциональность флага "Type" предоставляется членом **лпстрдевицетипе** структуры [**\_ \_ пармс, открытой в MCI**](mci-open-parms.md) .

## <a name="simple-and-compound-devices"></a>Простые и составные устройства

MCI классифицирует драйверы устройств как *Составные* или *простые*. Драйверам для составных устройств требуется имя файла данных для воспроизведения. драйверы для простых устройств не имеют.

К простым устройствам относятся устройства **кдаудио** и **видеодиск** . Существует два способа открытия простых устройств:

-   Укажите указатель на строку, заканчивающуюся нулем, которая содержит имя устройства из реестра или файла SYSTEM.INI.

    Например, можно открыть устройство **видеодиск** с помощью следующей команды:


```C++
    mciSendString("open videodisc", lpszReturnString, 
        lstrlen(lpszReturnString), NULL);
```



В этом случае "видеодиск" — это имя устройства из реестра или \[ \] раздела MCI SYSTEM.INI.

-   Укажите фактическое имя драйвера устройства. Тем не менее, при открытии устройства с помощью имени файла драйвера устройства приложение будет зависят от устройства и может препятствовать его запуску при изменении конфигурации системы. Если используется имя файла, указывать полный путь или расширение имени файла не требуется. MCI предполагает, что драйверы расположены в системном каталоге и имеют. Расширение имени файла DRV.

Составные устройства включают устройства **вавеаудио** и **Sequencer** . Данные для составного устройства иногда называются *элементом устройства*. Этот документ, однако, обычно относится к этим данным как к файлу, хотя в некоторых случаях данные могут не храниться в виде файла.

Существует три способа открытия составного устройства:

-   Укажите только имя устройства. Это позволяет открыть составное устройство без сопоставления имени файла. Большинство составных устройств обрабатывают только команды [**( \_ MCI жетдевкапс**](mci-getdevcaps.md)) и [**Close**](close.md) ([**MCI \_ Close**](mci-close.md) [**), если**](capability.md) они открыты таким образом.
-   Укажите только имя файла. Имя устройства определяется из сопоставлений в реестре.
-   Укажите имя файла и название устройства. MCI игнорирует записи в реестре и открывает указанное имя устройства.

Чтобы связать файл данных с определенным устройством, можно указать имя файла и название устройства. Например, следующая команда открывает устройство **вавеаудио** с именем файла мивоице. SND


```C++
mciSendString("open myvoice.snd type waveaudio", lpszReturnString, 
    lstrlen(lpszReturnString), NULL);
```



В интерфейсе командной строки можно также сократить спецификацию имени устройства, используя альтернативный формат восклицательного знака, как описано в команде [**Open**](open.md) .

## <a name="opening-a-device-using-the-filename-extension"></a>Открытие устройства с помощью расширения имени файла

Если команда [**Open**](open.md) ([**MCI \_ Open**](mci-open.md)) указывает только имя файла, MCI использует расширение имени файла, чтобы выбрать соответствующее устройство из списка в реестре или в \[ разделе расширения MCI \] файла SYSTEM.INI. Записи в \[ разделе расширения MCI \] используют следующую форму:

имя *файла \_ расширение*  =  *\_ имени устройства*

MCI неявно использует *\_ имя устройства* , если расширение найдено, и если имя устройства не указано в команде **Open** .

В следующем примере показан типичный \[ раздел модулей MCI \] .


```C++
[mci extensions]
wav=waveaudio
mid=sequencer
rmi=sequencer
```



С помощью этих определений MCI открывает устройство **вавеаудио** , если выдана следующая команда:


```C++
mciSendString("open train.wav", lpszReturnString, 
    lstrlen(lpszReturnString), NULL);
```



## <a name="new-data-files"></a>Новые файлы данных

Чтобы создать новый файл данных, просто укажите пустое имя файла. MCI не сохраняет новый файл, пока вы не сохраните его с помощью команды [**сохранить**](save.md) ([**MCI \_ Save**](mci-save.md)). При создании нового файла необходимо включить псевдоним устройства с помощью команды [**Open**](open.md) ([**MCI \_ Open**](mci-open.md)).

В следующем примере открывается новый файл **вавеаудио** , запускается и останавливается запись, затем сохраняется и закрывается файл:


```C++
mciSendString("open new type waveaudio alias capture", lpszReturnString, 
    lstrlen(lpszReturnString), NULL);
mciSendString("record capture", lpszReturnString, 
    lstrlen(lpszReturnString), NULL);
mciSendString("stop capture", lpszReturnString, 
    lstrlen(lpszReturnString), NULL);
mciSendString("save capture orca.wav", lpszReturnString, 
    lstrlen(lpszReturnString), NULL);
mciSendString("close capture", lpszReturnString, 
    lstrlen(lpszReturnString), NULL);
```



## <a name="sharable-devices"></a>Устройства, которые совместное с общим

Флаг "общий доступ" (с возможностью совместной \_ \_ работы в виде MCI) команды [**Open**](open.md) ([**MCI \_ Open**](mci-open.md)) позволяет нескольким приложениям одновременно обращаться к одному устройству (или файлу) и экземпляру устройства. Если приложение открывает устройство или файл в качестве совместного доступа, другие приложения также могут получить к нему доступ, открыв его как совместное применение. Общее устройство или файл предоставляет каждому приложению возможность изменять параметры, управляющие его состоянием работы. При каждом открытии устройства или файла как доступного для совместного выполнения MCI Возвращает уникальный идентификатор устройства, даже если идентификаторы ссылаются на один и тот же экземпляр.

Если приложение открывает устройство или файл без указания возможности совместного использования, другие приложения не смогут получить к нему доступ, пока приложение не закроет его. Кроме того, если устройство поддерживает только один открытый экземпляр, команда **Open** завершится ошибкой, если указать флаг с общим состоянием.

Если приложение открывает устройство и указывает, что оно доступно для совместного использования, приложение не должно делать никаких предположений о состоянии этого устройства. Приложению может потребоваться компенсировать изменения, внесенные другими приложениями, обращающимися к устройству.

Большинство составных файлов не могут совместно быть объединены. Однако можно открыть несколько файлов или несколько раз открыть один файл. Если один файл открывается несколько раз, MCI создает независимый экземпляр для каждого экземпляра с уникальным состоянием операционной системы.

При открытии нескольких экземпляров файла необходимо назначить каждому из них уникальный идентификатор устройства. Можно использовать псевдоним, как описано в следующем разделе, чтобы назначить уникальное имя для каждого файла.

 

 