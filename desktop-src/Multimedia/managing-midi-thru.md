---
title: Управление MIDI
description: Управление MIDI
ms.assetid: ba03a2a1-d998-498d-ad53-027ba2b6e276
keywords:
- Цифровой интерфейс MIDI, драйвер
- MIDI (цифровой интерфейс музыкального инструмента), с драйвером
- запись аудио MIDI, драйвер
- Драйвер MIDI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 24214dd3f6cd13ca034b2555398f6055e4ce2da1
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "103987402"
---
# <a name="managing-midi-thru"></a><span data-ttu-id="d6bca-107">Управление MIDI</span><span class="sxs-lookup"><span data-stu-id="d6bca-107">Managing MIDI Thru</span></span>

<span data-ttu-id="d6bca-108">Устройство ввода MIDI можно подключить непосредственно к выходному устройству MIDI, чтобы при получении устройством ввода сообщения [**\_ данных MIM**](mim-data.md) система отправляла сообщение с теми же данными событий MIDI в драйвер выходного устройства.</span><span class="sxs-lookup"><span data-stu-id="d6bca-108">You can connect a MIDI input device directly to a MIDI output device so that when the input device receives an [**MIM\_DATA**](mim-data.md) message, the system sends a message with the same MIDI event data to the output device driver.</span></span> <span data-ttu-id="d6bca-109">Чтобы подключить устройство вывода MIDI к устройству ввода MIDI, используйте функцию [**мидиконнект**](/windows/win32/api/mmeapi/nf-mmeapi-midiconnect) .</span><span class="sxs-lookup"><span data-stu-id="d6bca-109">To connect a MIDI output device to a MIDI input device, use the [**midiConnect**](/windows/win32/api/mmeapi/nf-mmeapi-midiconnect) function.</span></span>

<span data-ttu-id="d6bca-110">Для достижения наилучшей производительности с несколькими выходами приложение может предоставить специальную форму драйвера вывода MIDI, который называется *драйвером*.</span><span class="sxs-lookup"><span data-stu-id="d6bca-110">To achieve the best possible performance with multiple outputs, an application can choose to supply a special form of MIDI output driver, called a *thru driver*.</span></span> <span data-ttu-id="d6bca-111">Несмотря на то, что система поддерживает подключение только одного выходного устройства MIDI к устройству ввода MIDI, несколько выходных устройств MIDI могут быть подключены к драйверу с.</span><span class="sxs-lookup"><span data-stu-id="d6bca-111">Although the system allows only one MIDI output device to be connected to a MIDI input device, multiple MIDI output devices can be connected to a thru driver.</span></span> <span data-ttu-id="d6bca-112">Приложение на такой системе может подключить устройство ввода MIDI к этому устройству через устройство и подключить устройство MIDI к максимальному количеству выходных устройств MIDI по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="d6bca-112">An application on such a system could connect the MIDI input device to this thru device and connect the MIDI thru device to as many MIDI output devices as needed.</span></span> <span data-ttu-id="d6bca-113">Дополнительные сведения о драйверах см. в документации устройства Windows.</span><span class="sxs-lookup"><span data-stu-id="d6bca-113">For more information about thru drivers, see the Windows device-driver documentation.</span></span>

## <a name="using-messages-to-manage-midi-recording"></a><span data-ttu-id="d6bca-114">Использование сообщений для управления записью MIDI</span><span class="sxs-lookup"><span data-stu-id="d6bca-114">Using Messages to Manage MIDI Recording</span></span>

<span data-ttu-id="d6bca-115">Следующие сообщения могут быть отправлены в процедуру обратного вызова окна или потока для управления записью MIDI.</span><span class="sxs-lookup"><span data-stu-id="d6bca-115">The following messages can be sent to a window or thread callback procedure for managing MIDI recording.</span></span>



| <span data-ttu-id="d6bca-116">Значение</span><span class="sxs-lookup"><span data-stu-id="d6bca-116">Value</span></span>                                          | <span data-ttu-id="d6bca-117">Значение</span><span class="sxs-lookup"><span data-stu-id="d6bca-117">Meaning</span></span>                                                                                                                                |
|------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="d6bca-118">**MM \_ MIM, \_ закрытие**</span><span class="sxs-lookup"><span data-stu-id="d6bca-118">**MM\_MIM\_CLOSE**</span></span>](mm-mim-close.md)         | <span data-ttu-id="d6bca-119">Отправляется, когда устройство ввода MIDI закрывается с помощью функции [**мидиинклосе**](/windows/win32/api/mmeapi/nf-mmeapi-midiinclose) .</span><span class="sxs-lookup"><span data-stu-id="d6bca-119">Sent when a MIDI input device is closed by using the [**midiInClose**](/windows/win32/api/mmeapi/nf-mmeapi-midiinclose) function.</span></span>                                      |
| [<span data-ttu-id="d6bca-120">**MM \_ MIM \_ Data**</span><span class="sxs-lookup"><span data-stu-id="d6bca-120">**MM\_MIM\_DATA**</span></span>](mm-mim-data.md)           | <span data-ttu-id="d6bca-121">Отправляется при получении полного сообщения MIDI.</span><span class="sxs-lookup"><span data-stu-id="d6bca-121">Sent when a complete MIDI message is received.</span></span> <span data-ttu-id="d6bca-122">(Это сообщение используется для всех сообщений MIDI, кроме сообщений, исключаемых из системы.)</span><span class="sxs-lookup"><span data-stu-id="d6bca-122">(This message is used for all MIDI messages except system-exclusive messages.)</span></span>          |
| [<span data-ttu-id="d6bca-123">**MM \_ , \_ Ошибка MIM**</span><span class="sxs-lookup"><span data-stu-id="d6bca-123">**MM\_MIM\_ERROR**</span></span>](mm-mim-error.md)         | <span data-ttu-id="d6bca-124">Отправляется при получении недопустимого сообщения MIDI.</span><span class="sxs-lookup"><span data-stu-id="d6bca-124">Sent when an invalid MIDI message is received.</span></span> <span data-ttu-id="d6bca-125">(Это сообщение используется для всех сообщений MIDI, кроме сообщений, исключаемых из системы.)</span><span class="sxs-lookup"><span data-stu-id="d6bca-125">(This message is used for all MIDI messages except system-exclusive messages.)</span></span>          |
| [<span data-ttu-id="d6bca-126">**MM \_ MIM \_ лонгдата**</span><span class="sxs-lookup"><span data-stu-id="d6bca-126">**MM\_MIM\_LONGDATA**</span></span>](mm-mim-longdata.md)   | <span data-ttu-id="d6bca-127">Посылается, когда получается сообщение об истечении времени, полученное системой MIDI, или когда буфер заполнен данными, исключающие данные из системы.</span><span class="sxs-lookup"><span data-stu-id="d6bca-127">Sent when either a complete MIDI system-exclusive message is received or when a buffer has been filled with system-exclusive data.</span></span>     |
| [<span data-ttu-id="d6bca-128">**MM \_ MIM \_ лонжеррор**</span><span class="sxs-lookup"><span data-stu-id="d6bca-128">**MM\_MIM\_LONGERROR**</span></span>](mm-mim-longerror.md) | <span data-ttu-id="d6bca-129">Посылается, когда получено недопустимое системное сообщение MIDI.</span><span class="sxs-lookup"><span data-stu-id="d6bca-129">Sent when an invalid MIDI system-exclusive message is received.</span></span>                                                                        |
| [<span data-ttu-id="d6bca-130">**MM \_ MIM \_ MOREDATA**</span><span class="sxs-lookup"><span data-stu-id="d6bca-130">**MM\_MIM\_MOREDATA**</span></span>](mm-mim-moredata.md)   | <span data-ttu-id="d6bca-131">Посылается, когда приложение не обрабатывает сообщения [**\_ данных MIM**](mim-data.md) достаточно быстро, чтобы не допустить входного драйвера устройства.</span><span class="sxs-lookup"><span data-stu-id="d6bca-131">Sent when an application is not processing [**MIM\_DATA**](mim-data.md) messages fast enough to keep up with the input device driver.</span></span> |
| [<span data-ttu-id="d6bca-132">**MM \_ MIM \_ Open**</span><span class="sxs-lookup"><span data-stu-id="d6bca-132">**MM\_MIM\_OPEN**</span></span>](mm-mim-open.md)           | <span data-ttu-id="d6bca-133">Отправляется при открытии входного устройства MIDI с помощью функции [**мидиинопен**](/windows/win32/api/mmeapi/nf-mmeapi-midiinopen) .</span><span class="sxs-lookup"><span data-stu-id="d6bca-133">Sent when a MIDI input device is opened by using the [**midiInOpen**](/windows/win32/api/mmeapi/nf-mmeapi-midiinopen) function.</span></span>                                        |



 

<span data-ttu-id="d6bca-134">Параметр *wParam* и параметр *lParam* связаны с каждым из этих сообщений.</span><span class="sxs-lookup"><span data-stu-id="d6bca-134">A *wParam* parameter and an *lParam* parameter are associated with each of these messages.</span></span> <span data-ttu-id="d6bca-135">Параметр *wParam* всегда задает маркер открытого устройства MIDI.</span><span class="sxs-lookup"><span data-stu-id="d6bca-135">The *wParam* parameter always specifies the handle of an open MIDI device.</span></span> <span data-ttu-id="d6bca-136">Параметр *lParam* не используется для открытых сообщений [**mm \_ MIM \_ Close**](mm-mim-close.md) и [**mm \_ MIM \_**](mm-mim-open.md) .</span><span class="sxs-lookup"><span data-stu-id="d6bca-136">The *lParam* parameter is unused for the [**MM\_MIM\_CLOSE**](mm-mim-close.md) and [**MM\_MIM\_OPEN**](mm-mim-open.md) messages.</span></span>

<span data-ttu-id="d6bca-137">Для сообщения [**\_ \_ Лонгдата mm MIM**](mm-mim-longdata.md) *лпмидихдр* указывает адрес структуры [**мидихдр**](/windows/win32/api/mmeapi/ns-mmeapi-midihdr) , определяющей буфер для сообщений, исключаемых из системы.</span><span class="sxs-lookup"><span data-stu-id="d6bca-137">For the [**MM\_MIM\_LONGDATA**](mm-mim-longdata.md) message, *lpMidiHdr* specifies an address of a [**MIDIHDR**](/windows/win32/api/mmeapi/ns-mmeapi-midihdr) structure that identifies the buffer for system-exclusive messages.</span></span> <span data-ttu-id="d6bca-138">Буфер может не быть полностью заполнен, поскольку размер безсистемных сообщений обычно неизвестен перед записью, а так как буферы, общий размер которых может содержать наибольшее ожидаемое сообщение, должны быть выделены.</span><span class="sxs-lookup"><span data-stu-id="d6bca-138">The buffer may not be completely filled, because the size of the system-exclusive messages is usually not known before being recorded and because buffers whose total size can contain the largest expected message must be allocated.</span></span> <span data-ttu-id="d6bca-139">Чтобы определить объем допустимых данных, имеющихся в буфере, используйте элемент **двбитесрекордед** структуры **мидихдр** .</span><span class="sxs-lookup"><span data-stu-id="d6bca-139">To determine the amount of valid data present in the buffer, use the **dwBytesRecorded** member of the **MIDIHDR** structure.</span></span>

## <a name="using-a-callback-function-to-manage-midi-recording"></a><span data-ttu-id="d6bca-140">Использование функции обратного вызова для управления записью MIDI</span><span class="sxs-lookup"><span data-stu-id="d6bca-140">Using a Callback Function to Manage MIDI Recording</span></span>

<span data-ttu-id="d6bca-141">Вы можете определить собственную функцию обратного вызова для управления записью устройств ввода MIDI.</span><span class="sxs-lookup"><span data-stu-id="d6bca-141">You can define your own callback function to manage recording for MIDI input devices.</span></span> <span data-ttu-id="d6bca-142">Функция обратного вызова описана как [**мидиинпрок**](/previous-versions//dd798460(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="d6bca-142">The callback function is documented as [**MidiInProc**](/previous-versions//dd798460(v=vs.85)).</span></span>

<span data-ttu-id="d6bca-143">В параметр *вмсг* функции обратного вызова **мидиинпрок** можно отправить следующие сообщения.</span><span class="sxs-lookup"><span data-stu-id="d6bca-143">The following messages can be sent to the *wMsg* parameter of the **MidiInProc** callback function.</span></span>



| <span data-ttu-id="d6bca-144">Значение</span><span class="sxs-lookup"><span data-stu-id="d6bca-144">Value</span></span>                                   | <span data-ttu-id="d6bca-145">Значение</span><span class="sxs-lookup"><span data-stu-id="d6bca-145">Meaning</span></span>                                                                                                                                |
|-----------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="d6bca-146">**\_закрытие MIM**</span><span class="sxs-lookup"><span data-stu-id="d6bca-146">**MIM\_CLOSE**</span></span>](mim-close.md)         | <span data-ttu-id="d6bca-147">Отправляется, когда устройство закрывается с помощью функции [**мидиинклосе**](/windows/win32/api/mmeapi/nf-mmeapi-midiinclose) .</span><span class="sxs-lookup"><span data-stu-id="d6bca-147">Sent when the device is closed by using the [**midiInClose**](/windows/win32/api/mmeapi/nf-mmeapi-midiinclose) function.</span></span>                                               |
| [<span data-ttu-id="d6bca-148">**\_данные MIM**</span><span class="sxs-lookup"><span data-stu-id="d6bca-148">**MIM\_DATA**</span></span>](mim-data.md)           | <span data-ttu-id="d6bca-149">Посылается при получении полного сообщения MIDI (это сообщение используется для всех сообщений MIDI, кроме сообщений, исключающих систему).</span><span class="sxs-lookup"><span data-stu-id="d6bca-149">Sent when a complete MIDI message is received (this message is used for all MIDI messages except system-exclusive messages).</span></span>           |
| [<span data-ttu-id="d6bca-150">**\_Ошибка MIM**</span><span class="sxs-lookup"><span data-stu-id="d6bca-150">**MIM\_ERROR**</span></span>](mim-error.md)         | <span data-ttu-id="d6bca-151">Посылается, когда получено недопустимое сообщение MIDI (это сообщение используется для всех сообщений MIDI, кроме сообщений, исключаемых из системы).</span><span class="sxs-lookup"><span data-stu-id="d6bca-151">Sent when an invalid MIDI message is received (this message is used for all MIDI messages except system-exclusive messages).</span></span>           |
| [<span data-ttu-id="d6bca-152">**\_ЛОНГДАТА MIM**</span><span class="sxs-lookup"><span data-stu-id="d6bca-152">**MIM\_LONGDATA**</span></span>](mim-longdata.md)   | <span data-ttu-id="d6bca-153">Посылается, когда получается сообщение об истечении времени, полученное системой MIDI, или когда буфер заполнен данными, исключающие данные из системы.</span><span class="sxs-lookup"><span data-stu-id="d6bca-153">Sent when either a complete MIDI system-exclusive message is received or when a buffer has been filled with system-exclusive data.</span></span>     |
| [<span data-ttu-id="d6bca-154">**\_ЛОНЖЕРРОР MIM**</span><span class="sxs-lookup"><span data-stu-id="d6bca-154">**MIM\_LONGERROR**</span></span>](mim-longerror.md) | <span data-ttu-id="d6bca-155">Посылается, когда получено недопустимое системное сообщение MIDI.</span><span class="sxs-lookup"><span data-stu-id="d6bca-155">Sent when an invalid MIDI system-exclusive message is received.</span></span>                                                                        |
| [<span data-ttu-id="d6bca-156">**\_MOREDATA MIM**</span><span class="sxs-lookup"><span data-stu-id="d6bca-156">**MIM\_MOREDATA**</span></span>](mim-moredata.md)   | <span data-ttu-id="d6bca-157">Посылается, когда приложение не обрабатывает сообщения [**\_ данных MIM**](mim-data.md) достаточно быстро, чтобы не допустить входного драйвера устройства.</span><span class="sxs-lookup"><span data-stu-id="d6bca-157">Sent when an application is not processing [**MIM\_DATA**](mim-data.md) messages fast enough to keep up with the input device driver.</span></span> |
| [<span data-ttu-id="d6bca-158">**\_Запуск MIM**</span><span class="sxs-lookup"><span data-stu-id="d6bca-158">**MIM\_OPEN**</span></span>](mim-open.md)           | <span data-ttu-id="d6bca-159">Посылается при открытии входного устройства MIDI с помощью функции [**мидиинопен**](/windows/win32/api/mmeapi/nf-mmeapi-midiinopen) .</span><span class="sxs-lookup"><span data-stu-id="d6bca-159">Sent when the MIDI input device is opened by using the [**midiInOpen**](/windows/win32/api/mmeapi/nf-mmeapi-midiinopen) function.</span></span>                                      |



 

<span data-ttu-id="d6bca-160">Эти сообщения похожи на те, которые были отправлены в функции процедур Windows, но параметры различны.</span><span class="sxs-lookup"><span data-stu-id="d6bca-160">These messages are similar to those sent to window procedure functions, but the parameters are different.</span></span> <span data-ttu-id="d6bca-161">Обработчик открытого MIDI-устройства передается в качестве параметра функции обратного вызова вместе с даублеворд данных экземпляра, переданного с помощью **мидиинопен**.</span><span class="sxs-lookup"><span data-stu-id="d6bca-161">A handle of the open MIDI device is passed as a parameter to the callback function, along with the doubleword of instance data that was passed by using **midiInOpen**.</span></span>

<span data-ttu-id="d6bca-162">Для сообщения [**\_ Лонгдата MIM**](mim-longdata.md) *Лпмидихдр* указывает адрес структуры [**мидихдр**](/windows/win32/api/mmeapi/ns-mmeapi-midihdr) , которая идентифицирует буфер для сообщений, исключаемых из системы.</span><span class="sxs-lookup"><span data-stu-id="d6bca-162">For the [**MIM\_LONGDATA**](mim-longdata.md) message, *lpMidiHdr* specifies an address of a [**MIDIHDR**](/windows/win32/api/mmeapi/ns-mmeapi-midihdr) structure that identifies the buffer for system-exclusive messages.</span></span> <span data-ttu-id="d6bca-163">Буфер может быть заполнен неполным.</span><span class="sxs-lookup"><span data-stu-id="d6bca-163">The buffer might not be completely filled.</span></span> <span data-ttu-id="d6bca-164">Чтобы определить объем допустимых данных, имеющихся в буфере, используйте элемент **двбитесрекордед** структуры **мидихдр** .</span><span class="sxs-lookup"><span data-stu-id="d6bca-164">To determine the amount of valid data present in the buffer, use the **dwBytesRecorded** member of the **MIDIHDR** structure.</span></span>

<span data-ttu-id="d6bca-165">После завершения работы драйвера устройства с блоком данных можно очистить и освободить блок данных.</span><span class="sxs-lookup"><span data-stu-id="d6bca-165">After the device driver is finished with a data block, you can clean up and free the data block.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d6bca-166">См. также</span><span class="sxs-lookup"><span data-stu-id="d6bca-166">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d6bca-167">Запись звука MIDI</span><span class="sxs-lookup"><span data-stu-id="d6bca-167">Recording MIDI Audio</span></span>](recording-midi-audio.md)
</dt> </dl>

 

 