---
description: Рабочий набор процесса — это набор страниц в виртуальном адресном пространстве процесса, которые в настоящий момент находятся в физической памяти.
ms.assetid: ff05276a-1d40-4844-b649-10e32e3f1937
title: Рабочий набор
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f54ed26e9809ebffd01edb30f48f36d398689e88
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105683672"
---
# <a name="working-set"></a><span data-ttu-id="459cf-103">Рабочий набор</span><span class="sxs-lookup"><span data-stu-id="459cf-103">Working Set</span></span>

<span data-ttu-id="459cf-104">Рабочий набор процесса — это набор страниц в виртуальном адресном пространстве процесса, которые в настоящий момент находятся в физической памяти.</span><span class="sxs-lookup"><span data-stu-id="459cf-104">The working set of a process is the set of pages in the virtual address space of the process that are currently resident in physical memory.</span></span> <span data-ttu-id="459cf-105">Рабочий набор содержит только страничные выделения памяти. нестраничные выделения памяти, такие как [расширения](address-windowing-extensions.md) AWE или большие объемы [страниц](large-page-support.md) , не включаются в рабочий набор.</span><span class="sxs-lookup"><span data-stu-id="459cf-105">The working set contains only pageable memory allocations; nonpageable memory allocations such as [Address Windowing Extensions](address-windowing-extensions.md) (AWE) or [large page allocations](large-page-support.md) are not included in the working set.</span></span>

<span data-ttu-id="459cf-106">Если процесс ссылается на страничную память, которая в данный момент не находится в рабочем наборе, возникает *Ошибка страницы* .</span><span class="sxs-lookup"><span data-stu-id="459cf-106">When a process references pageable memory that is not currently in its working set, a *page fault* occurs.</span></span> <span data-ttu-id="459cf-107">Обработчик ошибок системной страницы пытается разрешить ошибку страницы и, если она будет выполнена, эта страница добавляется в рабочий набор.</span><span class="sxs-lookup"><span data-stu-id="459cf-107">The system page fault handler attempts to resolve the page fault and, if it succeeds, the page is added to the working set.</span></span> <span data-ttu-id="459cf-108">(Доступ к расширениям AWE или большим страницам при выделении страниц никогда не вызывает ошибки страницы, так как эти выделения не являются страничными.)</span><span class="sxs-lookup"><span data-stu-id="459cf-108">(Accessing AWE or large page allocations never causes a page fault, because these allocations are not pageable .)</span></span>

<span data-ttu-id="459cf-109">*Сбой жесткой страницы* должен быть разрешен путем считывания содержимого страницы из *резервного хранилища* страницы, которое является либо системным файлом подкачки, либо размещенным в памяти файлом, созданным процессом.</span><span class="sxs-lookup"><span data-stu-id="459cf-109">A *hard page fault* must be resolved by reading page contents from the page's *backing store*, which is either the system paging file or a memory-mapped file created by the process.</span></span> <span data-ttu-id="459cf-110">*Сбой страницы с мягкими ошибками* может быть разрешен без доступа к резервному хранилищу.</span><span class="sxs-lookup"><span data-stu-id="459cf-110">A *soft page fault* can be resolved without accessing the backing store.</span></span> <span data-ttu-id="459cf-111">Сбой страницы с мягкими ошибками возникает в следующих случаях:</span><span class="sxs-lookup"><span data-stu-id="459cf-111">A soft page fault occurs when:</span></span>

-   <span data-ttu-id="459cf-112">Эта страница находится в рабочем множестве других процессов, поэтому она уже находится в памяти.</span><span class="sxs-lookup"><span data-stu-id="459cf-112">The page is in the working set of some other process, so it is already resident in memory.</span></span>
-   <span data-ttu-id="459cf-113">Страница находится в состоянии перехода, так как она была удалена из рабочих наборов всех процессов, которые использовали эту страницу и еще не были переназначены, либо уже является резидентным в результате операции предварительной выборки диспетчера памяти.</span><span class="sxs-lookup"><span data-stu-id="459cf-113">The page is in transition, because it either has been removed from the working sets of all processes that were using the page and has not yet been repurposed, or it is already resident as a result of a memory manager prefetch operation.</span></span>
-   <span data-ttu-id="459cf-114">Процесс ссылается на выделенную виртуальную страницу в первый раз (иногда это называется *сбоем с нулевым требованием*).</span><span class="sxs-lookup"><span data-stu-id="459cf-114">A process references an allocated virtual page for the first time (sometimes called a *demand-zero fault*).</span></span>

<span data-ttu-id="459cf-115">Страницы могут быть удалены из рабочего набора процесса в результате выполнения следующих действий.</span><span class="sxs-lookup"><span data-stu-id="459cf-115">Pages can be removed from a process working set as a result of the following actions:</span></span>

-   <span data-ttu-id="459cf-116">Процесс сокращает или очищает рабочий набор, вызывая функцию [**сетпроцессворкингсетсизе**](/windows/win32/api/winbase/nf-winbase-setprocessworkingsetsize), [**сетпроцессворкингсетсизикс**](/windows/win32/api/memoryapi/nf-memoryapi-setprocessworkingsetsizeex) или [**емптиворкингсет**](/windows/win32/api/psapi/nf-psapi-emptyworkingset) .</span><span class="sxs-lookup"><span data-stu-id="459cf-116">The process reduces or empties the working set by calling the [**SetProcessWorkingSetSize**](/windows/win32/api/winbase/nf-winbase-setprocessworkingsetsize), [**SetProcessWorkingSetSizeEx**](/windows/win32/api/memoryapi/nf-memoryapi-setprocessworkingsetsizeex) or [**EmptyWorkingSet**](/windows/win32/api/psapi/nf-psapi-emptyworkingset) function.</span></span>
-   <span data-ttu-id="459cf-117">Этот процесс вызывает функцию [**виртуалунлокк**](/windows/win32/api/memoryapi/nf-memoryapi-virtualunlock) для незаблокированного диапазона памяти.</span><span class="sxs-lookup"><span data-stu-id="459cf-117">The process calls the [**VirtualUnlock**](/windows/win32/api/memoryapi/nf-memoryapi-virtualunlock) function on a memory range that is not locked.</span></span>
-   <span data-ttu-id="459cf-118">Процесс отменяет сопоставление сопоставленного представления файла с помощью функции [**UnmapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-unmapviewoffile) .</span><span class="sxs-lookup"><span data-stu-id="459cf-118">The process unmaps a mapped view of a file using the [**UnmapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-unmapviewoffile) function.</span></span>
-   <span data-ttu-id="459cf-119">Диспетчер памяти усекает страницы рабочего набора для создания большего объема доступной памяти.</span><span class="sxs-lookup"><span data-stu-id="459cf-119">The memory manager trims pages from the working set to create more available memory.</span></span>
-   <span data-ttu-id="459cf-120">Диспетчер памяти должен удалить страницу из рабочего набора, чтобы освободить место для новой страницы (например, так как рабочий набор имеет максимальный размер).</span><span class="sxs-lookup"><span data-stu-id="459cf-120">The memory manager must remove a page from the working set to make room for a new page (for example, because the working set is at its maximum size).</span></span>

<span data-ttu-id="459cf-121">Если несколько процессов совместно используют одну страницу, удаление страницы из рабочего набора одного процесса не влияет на другие процессы.</span><span class="sxs-lookup"><span data-stu-id="459cf-121">If several processes share a page, removing the page from the working set of one process does not affect other processes.</span></span> <span data-ttu-id="459cf-122">После удаления страницы из рабочих наборов всех процессов, которые ее используют, страница становится *переходной страницей*.</span><span class="sxs-lookup"><span data-stu-id="459cf-122">After a page is removed from the working sets of all processes that were using it, the page becomes a *transition page*.</span></span> <span data-ttu-id="459cf-123">Страницы переходов остаются в кэше ОЗУ до тех пор, пока страница не будет снова указана каким-либо процессом или перенаправлена (например, заполнена нулями и передана другому процессу).</span><span class="sxs-lookup"><span data-stu-id="459cf-123">Transition pages remain cached in RAM until the page is either referenced again by some process or repurposed (for example, filled with zeros and given to another process).</span></span> <span data-ttu-id="459cf-124">Если страница перехода была изменена с момента последней запись на диск (т. е. Если страница является "грязной"), то эту страницу необходимо записать в резервное хранилище, прежде чем ее можно будет перепланировать.</span><span class="sxs-lookup"><span data-stu-id="459cf-124">If a transition page has been modified since it was last written to disk (that is, if the page is "dirty"), then the page must be written to its backing store before it can be repurposed.</span></span> <span data-ttu-id="459cf-125">Система может начать запись страниц «грязных» переходов в резервное хранилище, как только эти страницы станут доступны.</span><span class="sxs-lookup"><span data-stu-id="459cf-125">The system may start writing dirty transition pages to their backing store as soon as such pages become available.</span></span>

<span data-ttu-id="459cf-126">Каждый процесс имеет минимальный и максимальный размер рабочего множества, влияющие на режим разбиения на страницы виртуальной памяти процесса.</span><span class="sxs-lookup"><span data-stu-id="459cf-126">Each process has a minimum and maximum working set size that affect the virtual memory paging behavior of the process.</span></span> <span data-ttu-id="459cf-127">Чтобы получить текущий размер рабочего набора указанного процесса, используйте функцию [**жетпроцессмеморинфо**](/windows/win32/api/psapi/nf-psapi-getprocessmemoryinfo) .</span><span class="sxs-lookup"><span data-stu-id="459cf-127">To obtain the current size of the working set of a specified process, use the [**GetProcessMemoryInfo**](/windows/win32/api/psapi/nf-psapi-getprocessmemoryinfo) function.</span></span> <span data-ttu-id="459cf-128">Чтобы получить или изменить минимальный и максимальный размеры рабочего множества, используйте функции [**жетпроцессворкингсетсизикс**](/windows/win32/api/memoryapi/nf-memoryapi-getprocessworkingsetsizeex) и [**сетпроцессворкингсетсизикс**](/windows/win32/api/memoryapi/nf-memoryapi-setprocessworkingsetsizeex) .</span><span class="sxs-lookup"><span data-stu-id="459cf-128">To obtain or change the minimum and maximum working set sizes, use the [**GetProcessWorkingSetSizeEx**](/windows/win32/api/memoryapi/nf-memoryapi-getprocessworkingsetsizeex) and [**SetProcessWorkingSetSizeEx**](/windows/win32/api/memoryapi/nf-memoryapi-setprocessworkingsetsizeex) functions.</span></span>

<span data-ttu-id="459cf-129">Программный интерфейс "состояние процесса" (PSAPI) предоставляет ряд функций, возвращающих подробные сведения о рабочем наборе процесса.</span><span class="sxs-lookup"><span data-stu-id="459cf-129">The process status application programming interface (PSAPI) provides a number of functions that return detailed information about the working set of a process.</span></span> <span data-ttu-id="459cf-130">Дополнительные сведения см. в разделе [сведения о рабочем множестве](../psapi/working-set-information.md).</span><span class="sxs-lookup"><span data-stu-id="459cf-130">For details, see [Working Set Information](../psapi/working-set-information.md).</span></span>

 

 
