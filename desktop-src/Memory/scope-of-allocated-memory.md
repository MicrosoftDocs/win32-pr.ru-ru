---
description: Вся память, выделенная процессом с помощью функций выделения памяти (Хеапаллок, VirtualAlloc, GlobalAlloc или Локалаллок), доступна только процессу.
ms.assetid: b47200dc-6824-4fd8-8d9f-2aaa439a74ff
title: Область выделенной памяти
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b8d2db67a04c019683e737d0f9c581ce8d16b800
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104263239"
---
# <a name="scope-of-allocated-memory"></a><span data-ttu-id="f4871-103">Область выделенной памяти</span><span class="sxs-lookup"><span data-stu-id="f4871-103">Scope of Allocated Memory</span></span>

<span data-ttu-id="f4871-104">Вся память, выделенная процессом с помощью функций выделения памяти ( [**хеапаллок**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc), [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc), [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc)или [**локалаллок**](/windows/desktop/api/WinBase/nf-winbase-localalloc)), доступна только процессу.</span><span class="sxs-lookup"><span data-stu-id="f4871-104">All memory a process allocates by using the memory allocation functions ( [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc), [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc), [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc), or [**LocalAlloc**](/windows/desktop/api/WinBase/nf-winbase-localalloc)) is accessible only to the process.</span></span> <span data-ttu-id="f4871-105">Однако память, выделенная библиотекой DLL, выделяется в адресном пространстве процесса, вызвавшего библиотеку DLL, и недоступен для других процессов, использующих ту же самую библиотеку DLL.</span><span class="sxs-lookup"><span data-stu-id="f4871-105">However, memory allocated by a DLL is allocated in the address space of the process that called the DLL and is not accessible to other processes using the same DLL.</span></span> <span data-ttu-id="f4871-106">Для создания общей памяти необходимо использовать сопоставление файлов.</span><span class="sxs-lookup"><span data-stu-id="f4871-106">To create shared memory, you must use file mapping.</span></span>

<span data-ttu-id="f4871-107">Сопоставление именованных файлов предоставляет простой способ создания блока общей памяти.</span><span class="sxs-lookup"><span data-stu-id="f4871-107">Named file mapping provides an easy way to create a block of shared memory.</span></span> <span data-ttu-id="f4871-108">Процесс может указать имя, если в нем используется функция [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) для создания объекта сопоставления файлов.</span><span class="sxs-lookup"><span data-stu-id="f4871-108">A process can specify a name when it uses the [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function to create a file-mapping object.</span></span> <span data-ttu-id="f4871-109">Другие процессы могут указывать одно и то же имя для функции **CreateFileMapping** или [**OpenFileMapping**](/windows/desktop/api/WinBase/nf-winbase-openfilemappinga) , чтобы получить маркер объекта сопоставления.</span><span class="sxs-lookup"><span data-stu-id="f4871-109">Other processes can specify the same name to either the **CreateFileMapping** or [**OpenFileMapping**](/windows/desktop/api/WinBase/nf-winbase-openfilemappinga) function to obtain a handle to the mapping object.</span></span>

<span data-ttu-id="f4871-110">Каждый процесс задает свой обработчик для объекта сопоставления файлов в функции [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) , чтобы сопоставить представление файла с его собственным адресным пространством.</span><span class="sxs-lookup"><span data-stu-id="f4871-110">Each process specifies its handle to the file-mapping object in the [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) function to map a view of the file into its own address space.</span></span> <span data-ttu-id="f4871-111">Представления всех процессов для одного объекта сопоставления файлов сопоставлены с одними и теми же страницами физического хранилища.</span><span class="sxs-lookup"><span data-stu-id="f4871-111">The views of all processes for a single file-mapping object are mapped into the same sharable pages of physical storage.</span></span> <span data-ttu-id="f4871-112">Однако виртуальные адреса сопоставленных представлений могут отличаться от одного процесса к другому, если только функция [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) не используется для сопоставления представления по указанному адресу.</span><span class="sxs-lookup"><span data-stu-id="f4871-112">However, the virtual addresses of the mapped views can vary from one process to another, unless the [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) function is used to map the view at a specified address.</span></span> <span data-ttu-id="f4871-113">Несмотря на то, что страницы физического хранилища, используемые для сопоставленного представления файлов, можно использовать совместно, они не являются глобальными. они недоступны для процессов, которые не сопоставили представление файла.</span><span class="sxs-lookup"><span data-stu-id="f4871-113">Although sharable, the pages of physical storage used for a mapped file view are not global; they are not accessible to processes that have not mapped a view of the file.</span></span>

<span data-ttu-id="f4871-114">Все страницы, зафиксированные путем сопоставления представления файла, освобождаются, когда последний процесс с представлением объекта сопоставления либо завершается, либо отменяет сопоставление представления путем вызова функции [**UnmapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-unmapviewoffile) .</span><span class="sxs-lookup"><span data-stu-id="f4871-114">Any pages committed by mapping a view of a file are released when the last process with a view of the mapping object either terminates or unmaps its view by calling the [**UnmapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-unmapviewoffile) function.</span></span> <span data-ttu-id="f4871-115">В настоящее время заданный файл (при наличии), связанный с объектом сопоставления, обновляется.</span><span class="sxs-lookup"><span data-stu-id="f4871-115">At this time, the specified file (if any) associated with the mapping object is updated.</span></span> <span data-ttu-id="f4871-116">Указанный файл также можно принудительно обновить, вызвав функцию [**флушвиевоффиле**](/windows/win32/api/memoryapi/nf-memoryapi-flushviewoffile) .</span><span class="sxs-lookup"><span data-stu-id="f4871-116">A specified file can also be forced to update by calling the [**FlushViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-flushviewoffile) function.</span></span>

<span data-ttu-id="f4871-117">Дополнительные сведения см. в разделе [Сопоставление файлов](file-mapping.md).</span><span class="sxs-lookup"><span data-stu-id="f4871-117">For more information, see [File Mapping](file-mapping.md).</span></span> <span data-ttu-id="f4871-118">Пример общей памяти в библиотеке DLL см. [в разделе Использование общей памяти в библиотеке Dynamic-Link](../dlls/using-shared-memory-in-a-dynamic-link-library.md).</span><span class="sxs-lookup"><span data-stu-id="f4871-118">For an example of shared memory in a DLL, see [Using Shared Memory in a Dynamic-Link Library](../dlls/using-shared-memory-in-a-dynamic-link-library.md).</span></span>

<span data-ttu-id="f4871-119">Если несколько процессов имеют доступ на запись к общей памяти, необходимо синхронизировать доступ к памяти.</span><span class="sxs-lookup"><span data-stu-id="f4871-119">If multiple processes have write access to shared memory, you must synchronize access to the memory.</span></span> <span data-ttu-id="f4871-120">Дополнительные сведения см. в разделе [Синхронизация](../sync/synchronization.md).</span><span class="sxs-lookup"><span data-stu-id="f4871-120">For more information, see [Synchronization](../sync/synchronization.md).</span></span>

 

 
