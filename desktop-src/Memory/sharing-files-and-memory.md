---
description: Сопоставление файлов можно использовать для совместного использования файла или памяти между двумя или более процессами. Чтобы предоставить общий доступ к файлу или памяти, все процессы должны использовать имя или маркер того же объекта сопоставления файлов.
ms.assetid: 942cb50d-df07-444f-bba5-58194556ae66
title: Совместное использование файлов и памяти
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 98d402eba3f87f1f799593ae0d6b23fba06124a8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103809946"
---
# <a name="sharing-files-and-memory"></a><span data-ttu-id="cddba-104">Совместное использование файлов и памяти</span><span class="sxs-lookup"><span data-stu-id="cddba-104">Sharing Files and Memory</span></span>

<span data-ttu-id="cddba-105">Сопоставление файлов можно использовать для совместного использования файла или памяти между двумя или более процессами.</span><span class="sxs-lookup"><span data-stu-id="cddba-105">File mapping can be used to share a file or memory between two or more processes.</span></span> <span data-ttu-id="cddba-106">Чтобы предоставить общий доступ к файлу или памяти, все процессы должны использовать имя или маркер того же объекта сопоставления файлов.</span><span class="sxs-lookup"><span data-stu-id="cddba-106">To share a file or memory, all of the processes must use the name or the handle of the same file mapping object.</span></span>

<span data-ttu-id="cddba-107">Чтобы предоставить общий доступ к файлу, первый процесс создает или открывает файл с помощью функции [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) .</span><span class="sxs-lookup"><span data-stu-id="cddba-107">To share a file, the first process creates or opens a file by using the [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) function.</span></span> <span data-ttu-id="cddba-108">Затем он создает объект сопоставления файлов с помощью функции [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) , задавая маркер файла и имя объекта сопоставления файлов.</span><span class="sxs-lookup"><span data-stu-id="cddba-108">Next, it creates a file mapping object by using the [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function, specifying the file handle and a name for the file mapping object.</span></span> <span data-ttu-id="cddba-109">Имена объектов событий, семафоров, мьютексов, ожидающих таймеров, заданий и сопоставлений файлов совместно используют одно и то же пространство имен.</span><span class="sxs-lookup"><span data-stu-id="cddba-109">The names of event, semaphore, mutex, waitable timer, job, and file mapping objects share the same namespace.</span></span> <span data-ttu-id="cddba-110">Поэтому функции **CreateFileMapping** и [**OpenFileMapping**](/windows/desktop/api/WinBase/nf-winbase-openfilemappinga) завершаются ошибкой, если указывают имя, используемое объектом другого типа.</span><span class="sxs-lookup"><span data-stu-id="cddba-110">Therefore, the **CreateFileMapping** and [**OpenFileMapping**](/windows/desktop/api/WinBase/nf-winbase-openfilemappinga) functions fail if they specify a name that is in use by an object of another type.</span></span>

<span data-ttu-id="cddba-111">Для совместного использования памяти, которая не связана с файлом, процесс должен использовать функцию [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) и указать недопустимое \_ \_ значение Handle в качестве параметра *hFile* вместо существующего обработчика файла.</span><span class="sxs-lookup"><span data-stu-id="cddba-111">To share memory that is not associated with a file, a process must use the [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function and specify INVALID\_HANDLE\_VALUE as the *hFile* parameter instead of an existing file handle.</span></span> <span data-ttu-id="cddba-112">Соответствующий объект сопоставления файлов обращается к памяти, поддерживаемой файлом подкачки системы.</span><span class="sxs-lookup"><span data-stu-id="cddba-112">The corresponding file mapping object accesses memory backed by the system paging file.</span></span> <span data-ttu-id="cddba-113">При указании *HFILE* недопустимого \_ \_ значения Handle в вызове **CreateFileMapping** необходимо указать размер больше нуля.</span><span class="sxs-lookup"><span data-stu-id="cddba-113">You must specify a size greater than zero when you specify an *hFile* of INVALID\_HANDLE\_VALUE in a call to **CreateFileMapping**.</span></span>

<span data-ttu-id="cddba-114">Самый простой способ получить маркер объекта сопоставления файлов, созданного первым процессом, — использовать функцию [**OpenFileMapping**](/windows/desktop/api/WinBase/nf-winbase-openfilemappinga) и указать имя объекта.</span><span class="sxs-lookup"><span data-stu-id="cddba-114">The easiest way for other processes to obtain a handle of the file mapping object created by the first process is to use the [**OpenFileMapping**](/windows/desktop/api/WinBase/nf-winbase-openfilemappinga) function and specify the object's name.</span></span> <span data-ttu-id="cddba-115">Это называется *«общей памятью*».</span><span class="sxs-lookup"><span data-stu-id="cddba-115">This is referred to as *named shared memory*.</span></span> <span data-ttu-id="cddba-116">Если объект сопоставления файлов не имеет имени, процесс должен получить его обработчик путем наследования или дублирования.</span><span class="sxs-lookup"><span data-stu-id="cddba-116">If the file mapping object does not have a name, the process must obtain a handle to it through inheritance or duplication.</span></span> <span data-ttu-id="cddba-117">Дополнительные сведения о наследовании и дублировании см. в разделе [наследование](../procthread/inheritance.md).</span><span class="sxs-lookup"><span data-stu-id="cddba-117">For more information on inheritance and duplication, see [Inheritance](../procthread/inheritance.md).</span></span>

<span data-ttu-id="cddba-118">Процессы, которые совместно используют файлы или память, должны создавать представления файлов с помощью функции [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) или [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) .</span><span class="sxs-lookup"><span data-stu-id="cddba-118">Processes that share files or memory must create file views by using the [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) or [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) function.</span></span> <span data-ttu-id="cddba-119">Они должны координировать свой доступ, используя семафоры, мьютексы, события или другие методы взаимного исключения.</span><span class="sxs-lookup"><span data-stu-id="cddba-119">They must coordinate their access using semaphores, mutexes, events, or some other mutual exclusion technique.</span></span> <span data-ttu-id="cddba-120">Дополнительные сведения см. в разделе [Синхронизация](../sync/synchronization.md).</span><span class="sxs-lookup"><span data-stu-id="cddba-120">For more information, see [Synchronization](../sync/synchronization.md).</span></span>

<span data-ttu-id="cddba-121">Объект сопоставления общего файла не будет уничтожен, пока все процессы, использующие его, не будут закрывать свои дескрипторы с помощью функции [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle) .</span><span class="sxs-lookup"><span data-stu-id="cddba-121">A shared file mapping object will not be destroyed until all processes that use it close their handles to it by using the [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle) function.</span></span>

<span data-ttu-id="cddba-122">Сведения о безопасности объектов сопоставления файлов см. в разделе [Сопоставление файлов безопасности и права доступа](file-mapping-security-and-access-rights.md).</span><span class="sxs-lookup"><span data-stu-id="cddba-122">For information about file mapping object security, see [File Mapping Security and Access Rights](file-mapping-security-and-access-rights.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="cddba-123">См. также</span><span class="sxs-lookup"><span data-stu-id="cddba-123">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="cddba-124">Создание именованной общей памяти</span><span class="sxs-lookup"><span data-stu-id="cddba-124">Creating Named Shared Memory</span></span>](creating-named-shared-memory.md)
</dt> </dl>

 

 
