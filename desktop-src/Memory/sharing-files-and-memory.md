---
description: Сопоставление файлов можно использовать для совместного использования файла или памяти между двумя или более процессами. Чтобы предоставить общий доступ к файлу или памяти, все процессы должны использовать имя или маркер того же объекта сопоставления файлов.
ms.assetid: 942cb50d-df07-444f-bba5-58194556ae66
title: Совместное использование файлов и памяти
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 98d402eba3f87f1f799593ae0d6b23fba06124a8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103809946"
---
# <a name="sharing-files-and-memory"></a>Совместное использование файлов и памяти

Сопоставление файлов можно использовать для совместного использования файла или памяти между двумя или более процессами. Чтобы предоставить общий доступ к файлу или памяти, все процессы должны использовать имя или маркер того же объекта сопоставления файлов.

Чтобы предоставить общий доступ к файлу, первый процесс создает или открывает файл с помощью функции [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) . Затем он создает объект сопоставления файлов с помощью функции [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) , задавая маркер файла и имя объекта сопоставления файлов. Имена объектов событий, семафоров, мьютексов, ожидающих таймеров, заданий и сопоставлений файлов совместно используют одно и то же пространство имен. Поэтому функции **CreateFileMapping** и [**OpenFileMapping**](/windows/desktop/api/WinBase/nf-winbase-openfilemappinga) завершаются ошибкой, если указывают имя, используемое объектом другого типа.

Для совместного использования памяти, которая не связана с файлом, процесс должен использовать функцию [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) и указать недопустимое \_ \_ значение Handle в качестве параметра *hFile* вместо существующего обработчика файла. Соответствующий объект сопоставления файлов обращается к памяти, поддерживаемой файлом подкачки системы. При указании *HFILE* недопустимого \_ \_ значения Handle в вызове **CreateFileMapping** необходимо указать размер больше нуля.

Самый простой способ получить маркер объекта сопоставления файлов, созданного первым процессом, — использовать функцию [**OpenFileMapping**](/windows/desktop/api/WinBase/nf-winbase-openfilemappinga) и указать имя объекта. Это называется *«общей памятью*». Если объект сопоставления файлов не имеет имени, процесс должен получить его обработчик путем наследования или дублирования. Дополнительные сведения о наследовании и дублировании см. в разделе [наследование](../procthread/inheritance.md).

Процессы, которые совместно используют файлы или память, должны создавать представления файлов с помощью функции [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) или [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) . Они должны координировать свой доступ, используя семафоры, мьютексы, события или другие методы взаимного исключения. Дополнительные сведения см. в разделе [Синхронизация](../sync/synchronization.md).

Объект сопоставления общего файла не будет уничтожен, пока все процессы, использующие его, не будут закрывать свои дескрипторы с помощью функции [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle) .

Сведения о безопасности объектов сопоставления файлов см. в разделе [Сопоставление файлов безопасности и права доступа](file-mapping-security-and-access-rights.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Создание именованной общей памяти](creating-named-shared-memory.md)
</dt> </dl>

 

 
