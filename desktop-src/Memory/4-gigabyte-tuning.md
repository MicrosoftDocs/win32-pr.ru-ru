---
description: '4-Гигабайтная настройка: BCDEdit и Boot.ini'
ms.assetid: 991eb86f-9e6f-4084-8b6f-f979e42104b5
title: '4-Гигабайтная настройка: BCDEdit и Boot.ini'
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f997ae09748370d5ec8ec246da80b6440d7aaf45
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104264393"
---
# <a name="4-gigabyte-tuning-bcdedit-and-bootini"></a><span data-ttu-id="38270-103">4-Гигабайтная настройка: BCDEdit и Boot.ini</span><span class="sxs-lookup"><span data-stu-id="38270-103">4-Gigabyte Tuning: BCDEdit and Boot.ini</span></span>

<span data-ttu-id="38270-104">В 32-разрядных выпусках Windows приложение имеет 4 гигабайта (ГБ) доступного виртуального адресного пространства.</span><span class="sxs-lookup"><span data-stu-id="38270-104">On 32-bit editions of Windows, applications have 4 gigabyte (GB) of virtual address space available.</span></span> <span data-ttu-id="38270-105">Виртуальное адресное пространство делится так, что доступно 2 ГБ для приложения, а остальные 2 ГБ доступны только системе.</span><span class="sxs-lookup"><span data-stu-id="38270-105">The virtual address space is divided so that 2 GB is available to the application and the other 2 GB is available only to the system.</span></span> <span data-ttu-id="38270-106">Функция настройки 4 гигабайта (Настройка 4GT или 4GT RAM), включенная командой *BCDEdit/Set инкреасеусерва* , увеличивает объем виртуального адресного пространства, доступного приложению до 3 ГБ, и сокращает объем, доступный системе, от 1 до 2 ГБ.</span><span class="sxs-lookup"><span data-stu-id="38270-106">The 4-gigabyte tuning (4GT or 4GT RAM Tuning) feature, enabled with the *BCDEdit /set increaseuserva* command, increases the virtual address space that is available to the application up to 3 GB, and reduces the amount available to the system to between 1 and 2 GB.</span></span>

<span data-ttu-id="38270-107">Для приложений, интенсивно использующих память, таких как системы управления базами данных (СУБД), использование большего виртуального адресного пространства может обеспечить значительные преимущества производительности и масштабируемости.</span><span class="sxs-lookup"><span data-stu-id="38270-107">For applications that are memory-intensive, such as database management systems (DBMS), the use of a larger virtual address space can provide considerable performance and scalability benefits.</span></span> <span data-ttu-id="38270-108">Однако размер кэша файлов, выгружаемого пула и невыгружаемого пула меньше, что может негативно сказаться на работе приложений с большими сетевыми ресурсами или операциями ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="38270-108">However, the file cache, paged pool, and nonpaged pool are smaller, which can adversely affect applications with heavy networking or I/O.</span></span> <span data-ttu-id="38270-109">Поэтому может потребоваться протестировать приложение под нагрузкой и проверить счетчики производительности, чтобы определить, имеют ли ваши приложения преимущества из большего адресного пространства.</span><span class="sxs-lookup"><span data-stu-id="38270-109">Therefore, you might want to test your application under load, and examine the performance counters to determine whether your application benefits from the larger address space.</span></span>

<span data-ttu-id="38270-110">Чтобы включить 4GT, используйте команду [BCDEdit/Set](/windows-hardware/drivers/devtest/bcdedit--set) , чтобы установить параметр записи **инкреасеусерва** boot в значение от 2048 (2 ГБ) до 3072 (3 ГБ).</span><span class="sxs-lookup"><span data-stu-id="38270-110">To enable 4GT, use the [BCDEdit /set](/windows-hardware/drivers/devtest/bcdedit--set) command to set the **increaseuserva** boot entry option to a value between 2048 (2 GB) and 3072 (3 GB).</span></span>

<span data-ttu-id="38270-111">**Windows Server 2003 и более ранние версии:** Чтобы включить 4GT, добавьте параметр **/3gb** в файл Boot.ini.</span><span class="sxs-lookup"><span data-stu-id="38270-111">**Windows Server 2003 and earlier:** To enable 4GT, add the **/3GB** switch to the Boot.ini file.</span></span> <span data-ttu-id="38270-112">Параметр **/3gb** поддерживается в следующих системах:</span><span class="sxs-lookup"><span data-stu-id="38270-112">The **/3GB** switch is supported on the following systems:</span></span>

-   <span data-ttu-id="38270-113">Windows Server 2003</span><span class="sxs-lookup"><span data-stu-id="38270-113">Windows Server 2003</span></span>
-   <span data-ttu-id="38270-114">Windows XP Professional</span><span class="sxs-lookup"><span data-stu-id="38270-114">Windows XP Professional</span></span>

<span data-ttu-id="38270-115">Параметр **/3gb** позволяет приложениям полностью 3 ГБ виртуального адресного пространства, а также уменьшает объем, доступный системе, до 1 ГБ.</span><span class="sxs-lookup"><span data-stu-id="38270-115">The **/3GB** switch makes a full 3 GB of virtual address space available to applications and reduces the amount available to the system to 1 GB.</span></span> <span data-ttu-id="38270-116">В Windows Server 2003 объем адресного пространства, доступный для приложений, можно изменить, задав параметру **/USERVA** в Boot.ini значение от 2048 до 3072, что увеличит объем адресного пространства, доступного системе.</span><span class="sxs-lookup"><span data-stu-id="38270-116">On Windows Server 2003, the amount of address space available to applications can be adjusted by setting the **/USERVA** switch in Boot.ini to a value between 2048 and 3072, which increases the amount of address space available to the system.</span></span> <span data-ttu-id="38270-117">Это помогает поддерживать общую производительность системы, когда приложению требуется более 2 ГБ, но менее 3 ГБ адресного пространства.</span><span class="sxs-lookup"><span data-stu-id="38270-117">This can help maintain overall system performance when the application requires more than 2 GB but less than 3 GB of address space.</span></span>

<span data-ttu-id="38270-118">Чтобы приложение использовало больше места в адресном пространстве, в заголовке образа установите флаг с [**\_ \_ \_ \_ поддержкой большого адреса для файла изображения**](/windows/desktop/api/dbghelp/ns-dbghelp-loaded_image) .</span><span class="sxs-lookup"><span data-stu-id="38270-118">To enable an application to use the larger address space, set the [**IMAGE\_FILE\_LARGE\_ADDRESS\_AWARE**](/windows/desktop/api/dbghelp/ns-dbghelp-loaded_image) flag in the image header.</span></span> <span data-ttu-id="38270-119">Компоновщик, входящий в состав Microsoft Visual C++, поддерживает параметр **/LARGEADDRESSAWARE** для установки этого флага.</span><span class="sxs-lookup"><span data-stu-id="38270-119">The linker included with Microsoft Visual C++ supports the **/LARGEADDRESSAWARE** switch to set this flag.</span></span> <span data-ttu-id="38270-120">Установка этого флага и запуск приложения в системе без поддержки 4GT не должны повлиять на работу приложения.</span><span class="sxs-lookup"><span data-stu-id="38270-120">Setting this flag and then running the application on a system that does not have 4GT support should not affect the application.</span></span>

<span data-ttu-id="38270-121">В 64-разрядных выпусках Windows, 32-разрядных приложений, помеченных флагом "с [**\_ \_ \_ \_ учетом размера файла образа**](/windows/desktop/api/dbghelp/ns-dbghelp-loaded_image) ", доступно 4 ГБ адресного пространства.</span><span class="sxs-lookup"><span data-stu-id="38270-121">On 64-bit editions of Windows, 32-bit applications marked with the [**IMAGE\_FILE\_LARGE\_ADDRESS\_AWARE**](/windows/desktop/api/dbghelp/ns-dbghelp-loaded_image) flag have 4 GB of address space available.</span></span>

<span data-ttu-id="38270-122">**Выпуски Windows Server 2003 для Itanium:** До с пакетом обновления 1 (SP1) в 32-разрядных процессах доступно только 2 ГБ адресного пространства.</span><span class="sxs-lookup"><span data-stu-id="38270-122">**Itanium editions of Windows Server 2003:** Prior to SP1, 32-bit processes have only 2 GB of address space available.</span></span>

<span data-ttu-id="38270-123">Используйте следующие рекомендации для поддержки 4GT в приложениях:</span><span class="sxs-lookup"><span data-stu-id="38270-123">Use the following guidelines to support 4GT in applications:</span></span>

-   <span data-ttu-id="38270-124">Адреса рядом с границей 2 ГБ обычно используются различными системными библиотеками DLL.</span><span class="sxs-lookup"><span data-stu-id="38270-124">Addresses near the 2-GB boundary are typically used by various system DLLs.</span></span> <span data-ttu-id="38270-125">Поэтому 32-разрядный процесс не может выделить более 2 ГБ непрерывной памяти, даже если доступно всего 4 ГБ адресного пространства.</span><span class="sxs-lookup"><span data-stu-id="38270-125">Therefore, a 32-bit process cannot allocate more than 2 GB of contiguous memory, even if the entire 4-GB address space is available.</span></span>
-   <span data-ttu-id="38270-126">Чтобы получить общий объем виртуального пространства пользователя, используйте функцию [**глобалмемористатусекс**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-globalmemorystatusex) .</span><span class="sxs-lookup"><span data-stu-id="38270-126">To retrieve the amount of total user virtual space, use the [**GlobalMemoryStatusEx**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-globalmemorystatusex) function.</span></span> <span data-ttu-id="38270-127">Чтобы получить наибольший возможный адрес пользователя, используйте функцию [**жетсистеминфо**](/windows/desktop/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) .</span><span class="sxs-lookup"><span data-stu-id="38270-127">To retrieve the highest possible user address, use the [**GetSystemInfo**](/windows/desktop/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) function.</span></span> <span data-ttu-id="38270-128">Всегда выявлять реальное значение во время выполнения и не использовать определения жестко проводных констант, такие как: `#define HIGHEST_USER_ADDRESS 0xC0000000` .</span><span class="sxs-lookup"><span data-stu-id="38270-128">Always detect the real value at runtime, and avoid using hard-wired constant definitions such as: `#define HIGHEST_USER_ADDRESS 0xC0000000`.</span></span>
-   <span data-ttu-id="38270-129">Не используйте сравнения со знаком, так как они могут привести к сбою приложений в системе с поддержкой 4GT.</span><span class="sxs-lookup"><span data-stu-id="38270-129">Avoid signed comparisons with pointers, because they might cause applications to crash on a 4GT-enabled system.</span></span> <span data-ttu-id="38270-130">Следующее условие имеет значение false для указателя, превышающего 2 ГБ: `if (pointer > 40000000)` .</span><span class="sxs-lookup"><span data-stu-id="38270-130">A condition such as the following is false for a pointer that is above 2 GB: `if (pointer > 40000000)`.</span></span>
-   <span data-ttu-id="38270-131">Код, использующий максимальный бит указателя для определяемой приложением цели, завершится ошибкой, если 4GT включен.</span><span class="sxs-lookup"><span data-stu-id="38270-131">Code that uses the highest bit of a pointer for an application-defined purpose will fail when 4GT is enabled.</span></span> <span data-ttu-id="38270-132">Например, 32-разрядное слово может рассматриваться как адрес пользовательского режима, если он ниже 0x80000000, и код ошибки, если он указан выше.</span><span class="sxs-lookup"><span data-stu-id="38270-132">For example, a 32-bit word might be considered a user-mode address if it is below 0x80000000, and an error code if above.</span></span> <span data-ttu-id="38270-133">Это не относится к 4GT.</span><span class="sxs-lookup"><span data-stu-id="38270-133">This is not true with 4GT.</span></span>

<span data-ttu-id="38270-134">[**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc) обычно возвращает младшие адреса до высоких адресов.</span><span class="sxs-lookup"><span data-stu-id="38270-134">[**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc) usually returns low addresses before high addresses.</span></span> <span data-ttu-id="38270-135">Поэтому процесс может не использовать очень высокие адреса, если он не выделяет большой объем памяти или фрагментированное виртуальное адресное пространство.</span><span class="sxs-lookup"><span data-stu-id="38270-135">Therefore, your process may not use very high addresses unless it allocates a lot of memory or has a fragmented virtual address space.</span></span> <span data-ttu-id="38270-136">Чтобы принудительно распределять выделения с более высоких адресов перед более низкими адресами для целей тестирования, при вызове **VirtualAlloc** следует указать параметр **mem \_ сверху \_ вниз** или задать для следующего параметра реестра значение 0x100000:</span><span class="sxs-lookup"><span data-stu-id="38270-136">To force allocations to allocate from higher addresses before lower addresses for testing purposes, specify **MEM\_TOP\_DOWN** when calling **VirtualAlloc** or set the following registry value to 0x100000:</span></span>

<span data-ttu-id="38270-137">**HKey \_ Локальный \_ компьютер** \\ **система** \\ **CurrentControlSet** \\ **Управление** \\  \\ **памятью** диспетчера сеансов \\ **аллокатионпреференце**</span><span class="sxs-lookup"><span data-stu-id="38270-137">**HKEY\_LOCAL\_MACHINE**\\**System**\\**CurrentControlSet**\\**Control**\\**Session Manager**\\**Memory Management**\\**AllocationPreference**</span></span>

## <a name="related-topics"></a><span data-ttu-id="38270-138">См. также</span><span class="sxs-lookup"><span data-stu-id="38270-138">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="38270-139">Ограничения памяти для выпусков Windows</span><span class="sxs-lookup"><span data-stu-id="38270-139">Memory Limits for Windows Releases</span></span>](memory-limits-for-windows-releases.md)
</dt> <dt>

[<span data-ttu-id="38270-140">Расширение физических адресов</span><span class="sxs-lookup"><span data-stu-id="38270-140">Physical Address Extension</span></span>](physical-address-extension.md)
</dt> <dt>

<span data-ttu-id="38270-141">[Технический справочник по 4GT](/previous-versions/windows/it-pro/windows-server-2003/cc778496(v=ws.10))</span><span class="sxs-lookup"><span data-stu-id="38270-141">[4GT Technical Reference](/previous-versions/windows/it-pro/windows-server-2003/cc778496(v=ws.10))</span></span>
</dt> </dl>

 

 
