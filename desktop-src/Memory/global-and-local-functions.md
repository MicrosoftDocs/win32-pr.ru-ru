---
description: Глобальные и локальные функции поддерживают перенос из 16-разрядного кода или для обеспечения совместимости исходного кода с 16-разрядной системой Windows.
ms.assetid: 97707ce7-4c65-4d0e-ba69-47fdaee73a9b
title: Глобальные и локальные функции
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cf356647f92f0e7d82e914a91020c438363ff082
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103897193"
---
# <a name="global-and-local-functions"></a><span data-ttu-id="181ee-103">Глобальные и локальные функции</span><span class="sxs-lookup"><span data-stu-id="181ee-103">Global and Local Functions</span></span>

<span data-ttu-id="181ee-104">Глобальные и локальные функции поддерживают перенос из 16-разрядного кода или для обеспечения совместимости исходного кода с 16-разрядной системой Windows.</span><span class="sxs-lookup"><span data-stu-id="181ee-104">The global and local functions are supported for porting from 16-bit code, or for maintaining source code compatibility with 16-bit Windows.</span></span> <span data-ttu-id="181ee-105">Начиная с 32-разрядных Windows, глобальные и локальные функции реализуются как функции-оболочки, вызывающие соответствующие [функции кучи](heap-functions.md) с помощью обработчика для кучи процесса по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="181ee-105">Starting with 32-bit Windows, the global and local functions are implemented as wrapper functions that call the corresponding [heap functions](heap-functions.md) using a handle to the process's default heap.</span></span> <span data-ttu-id="181ee-106">Таким образом, глобальные и локальные функции имеют больше ресурсов, чем другие функции управления памятью.</span><span class="sxs-lookup"><span data-stu-id="181ee-106">Therefore, the global and local functions have greater overhead than other memory management functions.</span></span>

<span data-ttu-id="181ee-107">[Функции кучи](heap-functions.md) предоставляют больше функций и управляются, чем глобальные и локальные функции.</span><span class="sxs-lookup"><span data-stu-id="181ee-107">The [heap functions](heap-functions.md) provide more features and control than the global and local functions.</span></span> <span data-ttu-id="181ee-108">Новые приложения должны использовать функции кучи, кроме случаев, когда документация специально указывает, что следует использовать глобальную или локальную функцию.</span><span class="sxs-lookup"><span data-stu-id="181ee-108">New applications should use the heap functions unless documentation specifically states that a global or local function should be used.</span></span> <span data-ttu-id="181ee-109">Например, некоторые функции Windows выделяют память, которую необходимо освободить с помощью [**функции LocalFree**](/windows/desktop/api/WinBase/nf-winbase-localfree), а глобальные функции по-прежнему используются с платформа динамических данных Exchange (DDE), функциями буфера обмена и объектами данных OLE.</span><span class="sxs-lookup"><span data-stu-id="181ee-109">For example, some Windows functions allocate memory that must be freed with [**LocalFree**](/windows/desktop/api/WinBase/nf-winbase-localfree), and the global functions are still used with Dynamic Data Exchange (DDE), the clipboard functions, and OLE data objects.</span></span> <span data-ttu-id="181ee-110">Полный список глобальных и локальных функций см. в таблице [функции управления памятью](memory-management-functions.md).</span><span class="sxs-lookup"><span data-stu-id="181ee-110">For a complete list of global and local functions, see the table in [Memory Management Functions](memory-management-functions.md).</span></span>

<span data-ttu-id="181ee-111">Управление памятью Windows не предоставляет отдельную локальную кучу и глобальную кучу, как и в случае 16-разрядной версии Windows.</span><span class="sxs-lookup"><span data-stu-id="181ee-111">Windows memory management does not provide a separate local heap and global heap, as 16-bit Windows does.</span></span> <span data-ttu-id="181ee-112">В результате глобальные и локальные семейства функций эквивалентны, и выбор между ними зависит от персональных предпочтений.</span><span class="sxs-lookup"><span data-stu-id="181ee-112">As a result, the global and local families of functions are equivalent and choosing between them is a matter of personal preference.</span></span> <span data-ttu-id="181ee-113">Обратите внимание, что изменение из 16-битной модели сегментированной памяти на модель виртуальной памяти с 32 бит сделало некоторые связанные глобальные и локальные функции и их параметры ненужными или бессмысленными.</span><span class="sxs-lookup"><span data-stu-id="181ee-113">Note that the change from a 16-bit segmented memory model to a 32-bit virtual memory model has made some of the related global and local functions and their options unnecessary or meaningless.</span></span> <span data-ttu-id="181ee-114">Например, больше нет указателей NEAR и Far, так как локальные и глобальные выделения памяти возвращают 32-битные виртуальные адреса.</span><span class="sxs-lookup"><span data-stu-id="181ee-114">For example, there are no longer near and far pointers, because both local and global allocations return 32-bit virtual addresses.</span></span>

<span data-ttu-id="181ee-115">Объекты памяти, выделенные [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc) и [**локалаллок**](/windows/desktop/api/WinBase/nf-winbase-localalloc) , находятся в закрытых, зафиксированных страницах с доступом для чтения и записи, которые недоступны для других процессов.</span><span class="sxs-lookup"><span data-stu-id="181ee-115">Memory objects allocated by [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc) and [**LocalAlloc**](/windows/desktop/api/WinBase/nf-winbase-localalloc) are in private, committed pages with read/write access that cannot be accessed by other processes.</span></span> <span data-ttu-id="181ee-116">Память, выделенная с помощью **GlobalAlloc** с **ГМЕМ \_ ддешаре** , на самом деле не предоставляется глобально, так как она находится в 16-разрядной версии Windows.</span><span class="sxs-lookup"><span data-stu-id="181ee-116">Memory allocated by using **GlobalAlloc** with **GMEM\_DDESHARE** is not actually shared globally as it is in 16-bit Windows.</span></span> <span data-ttu-id="181ee-117">Это значение не действует и доступно только для обеспечения совместимости.</span><span class="sxs-lookup"><span data-stu-id="181ee-117">This value has no effect and is available only for compatibility.</span></span> <span data-ttu-id="181ee-118">Приложения, которым требуется общая память для других целей, должны использовать объекты сопоставления файлов.</span><span class="sxs-lookup"><span data-stu-id="181ee-118">Applications requiring shared memory for other purposes must use file-mapping objects.</span></span> <span data-ttu-id="181ee-119">Несколько процессов могут сопоставлять представление одного и того же объекта сопоставления файлов для предоставления именованной общей памяти.</span><span class="sxs-lookup"><span data-stu-id="181ee-119">Multiple processes can map a view of the same file-mapping object to provide named shared memory.</span></span> <span data-ttu-id="181ee-120">Дополнительные сведения см. в разделе [Сопоставление файлов](file-mapping.md).</span><span class="sxs-lookup"><span data-stu-id="181ee-120">For more information, see [File Mapping](file-mapping.md).</span></span>

<span data-ttu-id="181ee-121">Выделение памяти ограничено только доступной физической памятью, включая хранилище в файле подкачки на диске.</span><span class="sxs-lookup"><span data-stu-id="181ee-121">Memory allocations are limited only by the available physical memory, including storage in the paging file on disk.</span></span> <span data-ttu-id="181ee-122">При выделении фиксированной памяти [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc) и [**локалаллок**](/windows/desktop/api/WinBase/nf-winbase-localalloc) возвращают указатель, который вызывающий процесс может немедленно использовать для доступа к памяти.</span><span class="sxs-lookup"><span data-stu-id="181ee-122">When you allocate fixed memory, [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc) and [**LocalAlloc**](/windows/desktop/api/WinBase/nf-winbase-localalloc) return a pointer that the calling process can immediately use to access the memory.</span></span> <span data-ttu-id="181ee-123">При выделении памяти для перемещаемого объема возвращаемое значение является маркером.</span><span class="sxs-lookup"><span data-stu-id="181ee-123">When you allocate moveable memory, the return value is a handle.</span></span> <span data-ttu-id="181ee-124">Чтобы получить указатель на перемещаемый объект памяти, используйте функции [**глобаллокк**](/windows/desktop/api/WinBase/nf-winbase-globallock) и [**локаллокк**](/windows/desktop/api/WinBase/nf-winbase-locallock) .</span><span class="sxs-lookup"><span data-stu-id="181ee-124">To get a pointer to a movable memory object, use the [**GlobalLock**](/windows/desktop/api/WinBase/nf-winbase-globallock) and [**LocalLock**](/windows/desktop/api/WinBase/nf-winbase-locallock) functions.</span></span>

<span data-ttu-id="181ee-125">Фактический размер выделенной памяти может быть больше запрошенного размера.</span><span class="sxs-lookup"><span data-stu-id="181ee-125">The actual size of the memory allocated can be larger than the requested size.</span></span> <span data-ttu-id="181ee-126">Чтобы определить фактическое число выделенных байтов, используйте функцию [**глобалсизе**](/windows/desktop/api/WinBase/nf-winbase-globalsize) или [**локалсизе**](/windows/desktop/api/WinBase/nf-winbase-localsize) .</span><span class="sxs-lookup"><span data-stu-id="181ee-126">To determine the actual number of bytes allocated, use the [**GlobalSize**](/windows/desktop/api/WinBase/nf-winbase-globalsize) or [**LocalSize**](/windows/desktop/api/WinBase/nf-winbase-localsize) function.</span></span> <span data-ttu-id="181ee-127">Если объем выделенной суммы превышает запрошенную сумму, процесс может использовать весь объем.</span><span class="sxs-lookup"><span data-stu-id="181ee-127">If the amount allocated is greater than the amount requested, the process can use the entire amount.</span></span>

<span data-ttu-id="181ee-128">Функции [**LocalLock**](/windows/desktop/api/WinBase/nf-winbase-globalrealloc) и [**локалреаллок**](/windows/desktop/api/WinBase/nf-winbase-localrealloc) изменяют размер или атрибуты объекта памяти, выделенного [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc) и [**локалаллок**](/windows/desktop/api/WinBase/nf-winbase-localalloc).</span><span class="sxs-lookup"><span data-stu-id="181ee-128">The [**GlobalReAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalrealloc) and [**LocalReAlloc**](/windows/desktop/api/WinBase/nf-winbase-localrealloc) functions change the size or the attributes of a memory object allocated by [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc) and [**LocalAlloc**](/windows/desktop/api/WinBase/nf-winbase-localalloc).</span></span> <span data-ttu-id="181ee-129">Размер может увеличиваться или уменьшаться.</span><span class="sxs-lookup"><span data-stu-id="181ee-129">The size can increase or decrease.</span></span>

<span data-ttu-id="181ee-130">Функции [**GlobalFree**](/windows/desktop/api/WinBase/nf-winbase-globalfree) и [**функции LocalFree**](/windows/desktop/api/WinBase/nf-winbase-localfree) выпускают память, выделенную [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc), [**локалаллок**](/windows/desktop/api/WinBase/nf-winbase-localalloc), [**LocalLock**](/windows/desktop/api/WinBase/nf-winbase-globalrealloc)или [**локалреаллок**](/windows/desktop/api/WinBase/nf-winbase-localrealloc).</span><span class="sxs-lookup"><span data-stu-id="181ee-130">The [**GlobalFree**](/windows/desktop/api/WinBase/nf-winbase-globalfree) and [**LocalFree**](/windows/desktop/api/WinBase/nf-winbase-localfree) functions release memory allocated by [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc), [**LocalAlloc**](/windows/desktop/api/WinBase/nf-winbase-localalloc), [**GlobalReAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalrealloc), or [**LocalReAlloc**](/windows/desktop/api/WinBase/nf-winbase-localrealloc).</span></span> <span data-ttu-id="181ee-131">Чтобы удалить указанный объект памяти без проверки маркера, используйте функцию [**глобалдискард**](/windows/desktop/api/WinBase/nf-winbase-globaldiscard) или [**локалдискард**](/windows/win32/api/minwinbase/nf-minwinbase-localdiscard) .</span><span class="sxs-lookup"><span data-stu-id="181ee-131">To discard the specified memory object without invalidating the handle, use the [**GlobalDiscard**](/windows/desktop/api/WinBase/nf-winbase-globaldiscard) or [**LocalDiscard**](/windows/win32/api/minwinbase/nf-minwinbase-localdiscard) function.</span></span> <span data-ttu-id="181ee-132">Этот маркер может быть использован позже **LocalLock** или **локалреаллок** для выделения нового блока памяти, связанного с тем же маркером.</span><span class="sxs-lookup"><span data-stu-id="181ee-132">The handle can be used later by **GlobalReAlloc** or **LocalReAlloc** to allocate a new block of memory associated with the same handle.</span></span>

<span data-ttu-id="181ee-133">Чтобы получить сведения об указанном объекте памяти, используйте функцию [**глобалфлагс**](/windows/desktop/api/WinBase/nf-winbase-globalflags) или [**локалфлагс**](/windows/desktop/api/WinBase/nf-winbase-localflags) .</span><span class="sxs-lookup"><span data-stu-id="181ee-133">To return information about a specified memory object, use the [**GlobalFlags**](/windows/desktop/api/WinBase/nf-winbase-globalflags) or [**LocalFlags**](/windows/desktop/api/WinBase/nf-winbase-localflags) function.</span></span> <span data-ttu-id="181ee-134">Эти сведения включают в себя счетчик блокировок объекта и указывает, будет ли объект удален или уже удален.</span><span class="sxs-lookup"><span data-stu-id="181ee-134">The information includes the object's lock count and indicates whether the object is discardable or has already been discarded.</span></span> <span data-ttu-id="181ee-135">Чтобы получить маркер объекта памяти, связанного с указанным указателем, используйте функцию [**глобалхандле**](/windows/desktop/api/WinBase/nf-winbase-globalhandle) или [**локалхандле**](/windows/desktop/api/WinBase/nf-winbase-localhandle) .</span><span class="sxs-lookup"><span data-stu-id="181ee-135">To return a handle to the memory object associated with a specified pointer, use the [**GlobalHandle**](/windows/desktop/api/WinBase/nf-winbase-globalhandle) or [**LocalHandle**](/windows/desktop/api/WinBase/nf-winbase-localhandle) function.</span></span>

## <a name="related-topics"></a><span data-ttu-id="181ee-136">См. также</span><span class="sxs-lookup"><span data-stu-id="181ee-136">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="181ee-137">Сравнение методов выделения памяти</span><span class="sxs-lookup"><span data-stu-id="181ee-137">Comparing Memory Allocation Methods</span></span>](comparing-memory-allocation-methods.md)
</dt> </dl>

 

 
