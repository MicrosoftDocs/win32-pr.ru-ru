---
description: Сопоставление файлов — это привязка содержимого файла к части виртуального адресного пространства процесса.
ms.assetid: 86a8bc81-914d-46a2-99fd-65dfd03bbcdd
title: Сопоставление файлов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b7f49162a4545d0e087e6b291e429d89049dbf57
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104541850"
---
# <a name="file-mapping"></a><span data-ttu-id="886bf-103">Сопоставление файлов</span><span class="sxs-lookup"><span data-stu-id="886bf-103">File Mapping</span></span>

<span data-ttu-id="886bf-104">*Сопоставление файлов* — это привязка содержимого файла к части виртуального адресного пространства процесса.</span><span class="sxs-lookup"><span data-stu-id="886bf-104">*File mapping* is the association of a file's contents with a portion of the virtual address space of a process.</span></span> <span data-ttu-id="886bf-105">Система создает *объект сопоставления файлов* (также известный как *объект раздела*) для поддержки этой ассоциации.</span><span class="sxs-lookup"><span data-stu-id="886bf-105">The system creates a *file mapping object* (also known as a *section object*) to maintain this association.</span></span> <span data-ttu-id="886bf-106">*Представление файлов* — это часть виртуального адресного пространства, используемая процессом для доступа к содержимому файла.</span><span class="sxs-lookup"><span data-stu-id="886bf-106">A *file view* is the portion of virtual address space that a process uses to access the file's contents.</span></span> <span data-ttu-id="886bf-107">Сопоставление файлов позволяет процессу использовать случайные входные и выходные данные (I/O) и последовательный ввод-вывод.</span><span class="sxs-lookup"><span data-stu-id="886bf-107">File mapping allows the process to use both random input and output (I/O) and sequential I/O.</span></span> <span data-ttu-id="886bf-108">Это также позволяет процессу эффективно работать с большим размером файла данных, например с базой данных, без необходимости сопоставлять весь файл в памяти.</span><span class="sxs-lookup"><span data-stu-id="886bf-108">It also allows the process to work efficiently with a large data file, such as a database, without having to map the whole file into memory.</span></span> <span data-ttu-id="886bf-109">Для совместного использования данных в нескольких процессах также могут использоваться отображенные в памяти файлы.</span><span class="sxs-lookup"><span data-stu-id="886bf-109">Multiple processes can also use memory-mapped files to share data.</span></span>

<span data-ttu-id="886bf-110">Процессы считывают и записывают в представление файлов с помощью указателей так же, как и с динамически выделяемой памятью.</span><span class="sxs-lookup"><span data-stu-id="886bf-110">Processes read from and write to the file view using pointers, just as they would with dynamically allocated memory.</span></span> <span data-ttu-id="886bf-111">Использование сопоставления файлов повышает эффективность, поскольку файл находится на диске, но представление файлов находится в памяти.</span><span class="sxs-lookup"><span data-stu-id="886bf-111">The use of file mapping improves efficiency because the file resides on disk, but the file view resides in memory.</span></span> <span data-ttu-id="886bf-112">Процессы также могут управлять представлением файла с помощью функции [**VirtualProtect**](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect) .</span><span class="sxs-lookup"><span data-stu-id="886bf-112">Processes can also manipulate the file view with the [**VirtualProtect**](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect) function.</span></span>

<span data-ttu-id="886bf-113">На следующем рисунке показана связь между файлом на диске, объектом сопоставления файлов и представлением файла.</span><span class="sxs-lookup"><span data-stu-id="886bf-113">The following illustration shows the relationship between the file on disk, a file mapping object, and a file view.</span></span>

![отношение между файлом на диске, объектом сопоставления файлов и представлением файла.](images/fmap.png)

<span data-ttu-id="886bf-115">Файл на диске может представлять собой любой файл, который необходимо преобразовать в память, или системный файл подкачки.</span><span class="sxs-lookup"><span data-stu-id="886bf-115">The file on disk can be any file that you want to map into memory, or it can be the system page file.</span></span> <span data-ttu-id="886bf-116">Объект сопоставления файлов может состоять из всей или только части файла.</span><span class="sxs-lookup"><span data-stu-id="886bf-116">The file mapping object can consist of all or only part of the file.</span></span> <span data-ttu-id="886bf-117">Он поддерживается файлом на диске.</span><span class="sxs-lookup"><span data-stu-id="886bf-117">It is backed by the file on disk.</span></span> <span data-ttu-id="886bf-118">Это означает, что когда система меняет местами страницы объекта сопоставления файлов, любые изменения, внесенные в объект сопоставления файлов, записываются в файл.</span><span class="sxs-lookup"><span data-stu-id="886bf-118">This means that when the system swaps out pages of the file mapping object, any changes made to the file mapping object are written to the file.</span></span> <span data-ttu-id="886bf-119">Когда страницы объекта сопоставления файлов меняются местами, они восстанавливаются из файла.</span><span class="sxs-lookup"><span data-stu-id="886bf-119">When the pages of the file mapping object are swapped back in, they are restored from the file.</span></span>

<span data-ttu-id="886bf-120">Представление файла может состоять из всей или только части объекта сопоставления файлов.</span><span class="sxs-lookup"><span data-stu-id="886bf-120">A file view can consist of all or only part of the file mapping object.</span></span> <span data-ttu-id="886bf-121">Процесс управляет файлом через представления файлов.</span><span class="sxs-lookup"><span data-stu-id="886bf-121">A process manipulates the file through the file views.</span></span> <span data-ttu-id="886bf-122">Процесс может создать несколько представлений для объекта сопоставления файлов.</span><span class="sxs-lookup"><span data-stu-id="886bf-122">A process can create multiple views for a file mapping object.</span></span> <span data-ttu-id="886bf-123">Представления файлов, созданные каждым процессом, находятся в виртуальном адресном пространстве этого процесса.</span><span class="sxs-lookup"><span data-stu-id="886bf-123">The file views created by each process reside in the virtual address space of that process.</span></span> <span data-ttu-id="886bf-124">Если процессу требуются данные из части файла, отличной от того, что находится в текущем представлении файла, он может отменить сопоставление текущего представления файлов, а затем создать новое представление файла.</span><span class="sxs-lookup"><span data-stu-id="886bf-124">When the process needs data from a portion of the file other than what is in the current file view, it can unmap the current file view, then create a new file view.</span></span>

<span data-ttu-id="886bf-125">Если несколько процессов используют один и тот же объект сопоставления файлов для создания представлений для локального файла, данные согласованы.</span><span class="sxs-lookup"><span data-stu-id="886bf-125">When multiple processes use the same file mapping object to create views for a local file, the data is coherent.</span></span> <span data-ttu-id="886bf-126">Это значит, что представления содержат идентичные копии файла на диске.</span><span class="sxs-lookup"><span data-stu-id="886bf-126">That is, the views contain identical copies of the file on disk.</span></span> <span data-ttu-id="886bf-127">Файл не может находиться на удаленном компьютере, если требуется совместное использование памяти несколькими процессами.</span><span class="sxs-lookup"><span data-stu-id="886bf-127">The file cannot reside on a remote computer if you want to share memory between multiple processes.</span></span>

<span data-ttu-id="886bf-128">Дополнительные сведения см. в следующих разделах:</span><span class="sxs-lookup"><span data-stu-id="886bf-128">For more information, see the following topics:</span></span>

-   [<span data-ttu-id="886bf-129">Создание объекта сопоставления файлов</span><span class="sxs-lookup"><span data-stu-id="886bf-129">Creating a File Mapping Object</span></span>](creating-a-file-mapping-object.md)
-   [<span data-ttu-id="886bf-130">Создание представления файлов</span><span class="sxs-lookup"><span data-stu-id="886bf-130">Creating a File View</span></span>](creating-a-file-view.md)
-   [<span data-ttu-id="886bf-131">Совместное использование файлов и памяти</span><span class="sxs-lookup"><span data-stu-id="886bf-131">Sharing Files and Memory</span></span>](sharing-files-and-memory.md)
-   [<span data-ttu-id="886bf-132">Чтение и запись в представлении файлов</span><span class="sxs-lookup"><span data-stu-id="886bf-132">Reading and Writing From a File View</span></span>](reading-and-writing-from-a-file-view.md)
-   [<span data-ttu-id="886bf-133">Закрытие объекта сопоставления файлов</span><span class="sxs-lookup"><span data-stu-id="886bf-133">Closing a File Mapping Object</span></span>](closing-a-file-mapping-object.md)
-   [<span data-ttu-id="886bf-134">Безопасность и права доступа для сопоставления файлов</span><span class="sxs-lookup"><span data-stu-id="886bf-134">File Mapping Security and Access Rights</span></span>](file-mapping-security-and-access-rights.md)
-   [<span data-ttu-id="886bf-135">Использование сопоставления файлов</span><span class="sxs-lookup"><span data-stu-id="886bf-135">Using File Mapping</span></span>](using-file-mapping.md)

 

 
