---
description: Чтобы связать данные из файла с виртуальной памятью процесса, необходимо создать представление файла.
ms.assetid: b1ebd9a4-cde4-4c0c-80d2-5ccb655cd3a4
title: Создание представления файлов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 498f7ba132efd9ecf82f9ec087492c9622824b51
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103998429"
---
# <a name="creating-a-file-view"></a><span data-ttu-id="3f5d4-103">Создание представления файлов</span><span class="sxs-lookup"><span data-stu-id="3f5d4-103">Creating a File View</span></span>

<span data-ttu-id="3f5d4-104">Чтобы связать данные из файла с виртуальной памятью процесса, необходимо создать представление файла.</span><span class="sxs-lookup"><span data-stu-id="3f5d4-104">To map the data from a file to the virtual memory of a process, you must create a view of the file.</span></span> <span data-ttu-id="3f5d4-105">Функции [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) и [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) используют объект сопоставления файлов, возвращенный [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) для создания представления файла или части файла в виртуальном адресном пространстве процесса.</span><span class="sxs-lookup"><span data-stu-id="3f5d4-105">The [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) and [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) functions use the file mapping object handle returned by [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) to create a view of the file or a portion of the file in the process's virtual address space.</span></span> <span data-ttu-id="3f5d4-106">Эти функции завершаются ошибкой, если флаги доступа конфликтуют с указанными при создании объекта сопоставления файлов **CreateFileMapping** .</span><span class="sxs-lookup"><span data-stu-id="3f5d4-106">These functions fail if the access flags conflict with those specified when **CreateFileMapping** created the file mapping object.</span></span>

<span data-ttu-id="3f5d4-107">Функция [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) возвращает указатель на представление файла.</span><span class="sxs-lookup"><span data-stu-id="3f5d4-107">The [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) function returns a pointer to the file view.</span></span> <span data-ttu-id="3f5d4-108">При разыменовании указателя в диапазоне адресов, указанных в **MapViewOfFile**, приложение может считывать данные из файла и записывать данные в файл.</span><span class="sxs-lookup"><span data-stu-id="3f5d4-108">By dereferencing a pointer in the range of addresses specified in **MapViewOfFile**, an application can read data from the file and write data to the file.</span></span> <span data-ttu-id="3f5d4-109">Запись в представление файла приводит к внесению изменений в объект сопоставления файлов.</span><span class="sxs-lookup"><span data-stu-id="3f5d4-109">Writing to the file view results in changes to the file mapping object.</span></span> <span data-ttu-id="3f5d4-110">Фактическая запись в файл на диске обрабатывается системой.</span><span class="sxs-lookup"><span data-stu-id="3f5d4-110">The actual writing to the file on disk is handled by the system.</span></span> <span data-ttu-id="3f5d4-111">Данные на самом деле не передаются на момент, в который записывается объект сопоставления файлов.</span><span class="sxs-lookup"><span data-stu-id="3f5d4-111">Data is not actually transferred at the time the file mapping object is written to.</span></span> <span data-ttu-id="3f5d4-112">Вместо этого большая часть входных и выходных файлов (I/O) кэшируется для повышения общей производительности системы.</span><span class="sxs-lookup"><span data-stu-id="3f5d4-112">Instead, much of the file input and output (I/O) is cached to improve general system performance.</span></span> <span data-ttu-id="3f5d4-113">Приложения могут переопределить это поведение, вызвав функцию [**флушвиевоффиле**](/windows/win32/api/memoryapi/nf-memoryapi-flushviewoffile) , чтобы заставить систему немедленно выполнять транзакции диска.</span><span class="sxs-lookup"><span data-stu-id="3f5d4-113">Applications can override this behavior by calling the [**FlushViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-flushviewoffile) function to force the system to perform disk transactions immediately.</span></span>

<span data-ttu-id="3f5d4-114">Функция [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) работает точно так же, как функция [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) , за исключением того, что она позволяет процессу указать базовый адрес представления файла в виртуальном адресном пространстве процесса в параметре *лпвбасе* .</span><span class="sxs-lookup"><span data-stu-id="3f5d4-114">The [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) function works exactly like the [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) function except that it allows a process to specify the base address of the view of the file in the process's virtual address space in the *lpvBase* parameter.</span></span> <span data-ttu-id="3f5d4-115">Если на указанном адресе недостаточно места, вызов завершается с ошибкой.</span><span class="sxs-lookup"><span data-stu-id="3f5d4-115">If there is not enough space at the specified address, the call fails.</span></span> <span data-ttu-id="3f5d4-116">Таким образом, если необходимо сопоставлять файл с одним и тем же адресом в нескольких процессах, то процессы должны согласовать соответствующий адрес: параметр *лпвбасе* должен быть целым числом, кратным степени гранулярности выделения системной памяти, иначе вызов завершается ошибкой.</span><span class="sxs-lookup"><span data-stu-id="3f5d4-116">Therefore, if you must map a file to the same address in multiple processes, the processes should negotiate an appropriate address: The *lpvBase* parameter must be an integral multiple of the system memory allocation granularity or the call fails.</span></span> <span data-ttu-id="3f5d4-117">Чтобы получить гранулярность выделения памяти системы, используйте функцию [**жетсистеминфо**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) , которая заполняет элементы структуры [**системных \_ сведений**](/windows/win32/api/sysinfoapi/ns-sysinfoapi-system_info) .</span><span class="sxs-lookup"><span data-stu-id="3f5d4-117">To obtain the system's memory allocation granularity, use the [**GetSystemInfo**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) function, which fills in the members of a [**SYSTEM\_INFO**](/windows/win32/api/sysinfoapi/ns-sysinfoapi-system_info) structure.</span></span>

<span data-ttu-id="3f5d4-118">Приложение может создавать несколько представлений файлов из одного объекта сопоставления файлов.</span><span class="sxs-lookup"><span data-stu-id="3f5d4-118">An application can create multiple file views from the same file mapping object.</span></span> <span data-ttu-id="3f5d4-119">Представление файла может отличаться от размера объекта сопоставления файлов, из которого он является производным, но он должен быть меньше, чем объект сопоставления файлов.</span><span class="sxs-lookup"><span data-stu-id="3f5d4-119">A file view can be a different size than the file mapping object from which it is derived, but it must be smaller than the file mapping object.</span></span> <span data-ttu-id="3f5d4-120">Смещение, заданное параметрами *двоффсесигх* и *двоффсетлов* [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) , должно быть кратным степени гранулярности выделения системы.</span><span class="sxs-lookup"><span data-stu-id="3f5d4-120">The offset specified by the *dwOffsetHigh* and *dwOffsetLow* parameters of [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) must be a multiple of the allocation granularity of the system.</span></span>

## <a name="related-topics"></a><span data-ttu-id="3f5d4-121">См. также</span><span class="sxs-lookup"><span data-stu-id="3f5d4-121">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3f5d4-122">Создание представления в файле</span><span class="sxs-lookup"><span data-stu-id="3f5d4-122">Creating a View Within a File</span></span>](creating-a-view-within-a-file.md)
</dt> </dl>

 

 
