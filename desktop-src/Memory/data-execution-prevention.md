---
description: Предотвращение выполнения данных (DEP) — это функция защиты памяти на уровне системы, встроенная в операционную систему, начиная с Windows XP и Windows Server 2003.
ms.assetid: 75cd83a5-4b77-4ca9-b595-e32d0dd609d0
title: Предотвращение выполнения данных
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8bc53febb383ef2789c2798b091960c2d20856d0
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673683"
---
# <a name="data-execution-prevention"></a><span data-ttu-id="81e48-103">Предотвращение выполнения данных</span><span class="sxs-lookup"><span data-stu-id="81e48-103">Data Execution Prevention</span></span>

<span data-ttu-id="81e48-104">Предотвращение выполнения данных (DEP) — это функция защиты памяти на уровне системы, встроенная в операционную систему, начиная с Windows XP и Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="81e48-104">Data Execution Prevention (DEP) is a system-level memory protection feature that is built into the operating system starting with Windows XP and Windows Server 2003.</span></span> <span data-ttu-id="81e48-105">Функция DEP позволяет системе помечать одну или несколько страниц памяти как не являющиеся исполняемыми.</span><span class="sxs-lookup"><span data-stu-id="81e48-105">DEP enables the system to mark one or more pages of memory as non-executable.</span></span> <span data-ttu-id="81e48-106">Пометка областей памяти как неисполняемых файлов означает, что код не может быть выполнен из этого региона памяти, что усложняет использование переполнения буфера.</span><span class="sxs-lookup"><span data-stu-id="81e48-106">Marking memory regions as non-executable means that code cannot be run from that region of memory, which makes it harder for the exploitation of buffer overruns.</span></span>

<span data-ttu-id="81e48-107">DEP предотвращает запуск кода из страниц данных, таких как куча по умолчанию, стеки и пулы памяти.</span><span class="sxs-lookup"><span data-stu-id="81e48-107">DEP prevents code from being run from data pages such as the default heap, stacks, and memory pools.</span></span> <span data-ttu-id="81e48-108">Если приложение пытается выполнить код из защищенной страницы данных, возникает исключение нарушения прав доступа к памяти, а если исключение не обрабатывается, вызывающий процесс завершается.</span><span class="sxs-lookup"><span data-stu-id="81e48-108">If an application attempts to run code from a data page that is protected, a memory access violation exception occurs, and if the exception is not handled, the calling process is terminated.</span></span>

<span data-ttu-id="81e48-109">DEP не предназначен для обеспечения полной защиты от всех эксплойтов; Он предназначен для использования в качестве другого средства, которое можно использовать для защиты приложения.</span><span class="sxs-lookup"><span data-stu-id="81e48-109">DEP is not intended to be a comprehensive defense against all exploits; it is intended to be another tool that you can use to secure your application.</span></span>

## <a name="how-data-execution-prevention-works"></a><span data-ttu-id="81e48-110">Как работает предотвращение выполнения данных</span><span class="sxs-lookup"><span data-stu-id="81e48-110">How Data Execution Prevention Works</span></span>

<span data-ttu-id="81e48-111">Если приложение пытается выполнить код на защищенной странице, приложение получает исключение с **\_ \_ нарушением прав доступа** для кода состояния.</span><span class="sxs-lookup"><span data-stu-id="81e48-111">If an application attempts to run code from a protected page, the application receives an exception with the status code **STATUS\_ACCESS\_VIOLATION**.</span></span> <span data-ttu-id="81e48-112">Если приложение должно запускать код со страницы памяти, он должен выделить и установить соответствующие атрибуты [защиты виртуальной памяти](memory-protection.md) .</span><span class="sxs-lookup"><span data-stu-id="81e48-112">If your application must run code from a memory page, it must allocate and set the proper virtual [memory protection](memory-protection.md) attributes.</span></span> <span data-ttu-id="81e48-113">Выделенная память должна быть помечена как **\_ выполнение страницы**, **\_ \_ чтение при выполнении страницы**, **выполнение страницы в \_ \_ ReadWrite** или **Страница \_ Execute \_ вритекопи** при выделении памяти.</span><span class="sxs-lookup"><span data-stu-id="81e48-113">The allocated memory must be marked **PAGE\_EXECUTE**, **PAGE\_EXECUTE\_READ**, **PAGE\_EXECUTE\_READWRITE**, or **PAGE\_EXECUTE\_WRITECOPY** when allocating memory.</span></span> <span data-ttu-id="81e48-114">Выделение кучи, выполняемое вызовом функций **malloc** и [**хеапаллок**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) , не является исполняемым.</span><span class="sxs-lookup"><span data-stu-id="81e48-114">Heap allocations made by calling the **malloc** and [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) functions are non-executable.</span></span>

<span data-ttu-id="81e48-115">Приложения не могут выполнять код из кучи процесса по умолчанию или стека.</span><span class="sxs-lookup"><span data-stu-id="81e48-115">Applications cannot run code from the default process heap or the stack.</span></span>

<span data-ttu-id="81e48-116">DEP настраивается при загрузке системы в соответствии с параметром политики "без выполнения" в данных конфигурации загрузки.</span><span class="sxs-lookup"><span data-stu-id="81e48-116">DEP is configured at system boot according to the no-execute page protection policy setting in the boot configuration data.</span></span> <span data-ttu-id="81e48-117">Приложение может получить текущий параметр политики, вызвав функцию [**жетсистемдепполици**](/windows/desktop/api/WinBase/nf-winbase-getsystemdeppolicy) .</span><span class="sxs-lookup"><span data-stu-id="81e48-117">An application can get the current policy setting by calling the [**GetSystemDEPPolicy**](/windows/desktop/api/WinBase/nf-winbase-getsystemdeppolicy) function.</span></span> <span data-ttu-id="81e48-118">В зависимости от параметра политики приложение может изменить параметр DEP для текущего процесса, вызвав функцию [**сетпроцессдепполици**](/windows/desktop/api/WinBase/nf-winbase-setprocessdeppolicy) .</span><span class="sxs-lookup"><span data-stu-id="81e48-118">Depending on the policy setting, an application can change the DEP setting for the current process by calling the [**SetProcessDEPPolicy**](/windows/desktop/api/WinBase/nf-winbase-setprocessdeppolicy) function.</span></span>

## <a name="programming-considerations"></a><span data-ttu-id="81e48-119">Замечания по программированию</span><span class="sxs-lookup"><span data-stu-id="81e48-119">Programming Considerations</span></span>

<span data-ttu-id="81e48-120">Приложение может использовать функцию [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc) для выделения исполняемой памяти с соответствующими параметрами защиты памяти.</span><span class="sxs-lookup"><span data-stu-id="81e48-120">An application can use the [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc) function to allocate executable memory with the appropriate memory protection options.</span></span> <span data-ttu-id="81e48-121">Рекомендуется, чтобы приложение было задано как минимум с параметром " **\_ выполнить** защиту памяти" на странице.</span><span class="sxs-lookup"><span data-stu-id="81e48-121">It is suggested that an application set, at a minimum, the **PAGE\_EXECUTE** memory protection option.</span></span> <span data-ttu-id="81e48-122">После создания исполняемого кода рекомендуется настроить для приложения защиту памяти, чтобы запретить доступ на запись к выделенной памяти.</span><span class="sxs-lookup"><span data-stu-id="81e48-122">After the executable code is generated, it is recommended that the application set memory protections to disallow write access to the allocated memory.</span></span> <span data-ttu-id="81e48-123">Приложения могут запретить доступ на запись к выделенной памяти с помощью функции [**VirtualProtect**](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect) .</span><span class="sxs-lookup"><span data-stu-id="81e48-123">Applications can disallow write access to allocated memory by using the [**VirtualProtect**](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect) function.</span></span> <span data-ttu-id="81e48-124">Запрет доступа на запись обеспечивает максимальную защиту для исполняемых регионов адресного пространства процесса.</span><span class="sxs-lookup"><span data-stu-id="81e48-124">Disallowing write access ensures maximum protection for executable regions of process address space.</span></span> <span data-ttu-id="81e48-125">Следует попытаться создать приложения, использующие наименьшее возможное адресное пространство исполняемого файла, что снизит объем памяти, предоставляемой для использования памяти.</span><span class="sxs-lookup"><span data-stu-id="81e48-125">You should attempt to create applications that use the smallest executable address space possible, which minimizes the amount of memory that is exposed to memory exploitation.</span></span>

<span data-ttu-id="81e48-126">Также следует попытаться управлять макетом виртуальной памяти приложения и создавать регионы исполняемых файлов.</span><span class="sxs-lookup"><span data-stu-id="81e48-126">You should also attempt to control the layout of your application's virtual memory and create executable regions.</span></span> <span data-ttu-id="81e48-127">Эти регионы исполняемых файлов должны находиться в меньшем объеме памяти, чем в неисполняемых регионах.</span><span class="sxs-lookup"><span data-stu-id="81e48-127">These executable regions should be located in a lower memory space than non-executable regions.</span></span> <span data-ttu-id="81e48-128">Поиск регионов исполняемых файлов под неисполняемыми областями помогает предотвратить переполнение буфера в исполняемой области памяти.</span><span class="sxs-lookup"><span data-stu-id="81e48-128">By locating executable regions below non-executable regions, you can help prevent a buffer overflow from overflowing into the executable area of memory.</span></span>

## <a name="application-compatibility"></a><span data-ttu-id="81e48-129">Совместимость приложений</span><span class="sxs-lookup"><span data-stu-id="81e48-129">Application Compatibility</span></span>

<span data-ttu-id="81e48-130">Некоторые функциональные возможности приложения несовместимы с DEP.</span><span class="sxs-lookup"><span data-stu-id="81e48-130">Some application functionality is incompatible with DEP.</span></span> <span data-ttu-id="81e48-131">Приложения, выполняющие динамическое создание кода (например, JIT-создание кода) и не позволяющие явно отмечать сформированный код с разрешением EXECUTE, могут столкнуться с проблемами совместимости на компьютерах, использующих DEP.</span><span class="sxs-lookup"><span data-stu-id="81e48-131">Applications that perform dynamic code generation (such as Just-In-Time code generation) and do not explicitly mark generated code with execute permission may have compatibility issues on computers that are using DEP.</span></span> <span data-ttu-id="81e48-132">Приложения, написанные в библиотеке активных шаблонов (ATL) версии 7,1 и более ранних версий, могут попытаться выполнить код на страницах, помеченных как не являющиеся исполняемыми, что запускает NX-ошибку и завершает работу приложения. Дополнительные сведения см. в разделе [**сетпроцессдепполици**](/windows/desktop/api/WinBase/nf-winbase-setprocessdeppolicy).</span><span class="sxs-lookup"><span data-stu-id="81e48-132">Applications written to the Active Template Library (ATL) version 7.1 and earlier can attempt to execute code on pages marked as non-executable, which triggers an NX fault and terminates the application; for more information, see [**SetProcessDEPPolicy**](/windows/desktop/api/WinBase/nf-winbase-setprocessdeppolicy).</span></span> <span data-ttu-id="81e48-133">Большинство приложений, выполняющих действия, несовместимые с DEP, должны быть обновлены для правильной работы.</span><span class="sxs-lookup"><span data-stu-id="81e48-133">Most applications that perform actions incompatible with DEP must be updated to function properly.</span></span>

<span data-ttu-id="81e48-134">Небольшое количество исполняемых файлов и библиотек может содержать исполняемый код в разделе данных файла изображения.</span><span class="sxs-lookup"><span data-stu-id="81e48-134">A small number of executable files and libraries may contain executable code in the data section of an image file.</span></span> <span data-ttu-id="81e48-135">В некоторых случаях приложения могут размещать небольшие сегменты кода (которые обычно называются преобразователями) в разделах данных.</span><span class="sxs-lookup"><span data-stu-id="81e48-135">In some cases, applications may place small segments of code (commonly referred to as thunks) in the data sections.</span></span> <span data-ttu-id="81e48-136">Однако DEP помечает разделы файла изображения, которые загружаются в память как неисполняемые, если в разделе не применен атрибут Executable.</span><span class="sxs-lookup"><span data-stu-id="81e48-136">However, DEP marks sections of the image file that is loaded in memory as non-executable unless the section has the executable attribute applied.</span></span>

<span data-ttu-id="81e48-137">Поэтому исполняемый код в разделах данных должен быть перенесен в раздел кода, или раздел данных, содержащий исполняемый код, должен быть явно помечен как исполняемый.</span><span class="sxs-lookup"><span data-stu-id="81e48-137">Therefore, executable code in data sections should be migrated to a code section, or the data section that contains the executable code should be explicitly marked as executable.</span></span> <span data-ttu-id="81e48-138">Атрибут Executable, **image \_ SCN \_ mem \_**, должен быть добавлен в поле **характеристики** соответствующего заголовка раздела для разделов, содержащих исполняемый код.</span><span class="sxs-lookup"><span data-stu-id="81e48-138">The executable attribute, **IMAGE\_SCN\_MEM\_EXECUTE**, should be added to the **Characteristics** field of the corresponding section header for sections that contain executable code.</span></span> <span data-ttu-id="81e48-139">Дополнительные сведения о добавлении атрибутов в раздел см. в документации, входящей в состав вашего компоновщика.</span><span class="sxs-lookup"><span data-stu-id="81e48-139">For more information about adding attributes to a section, see the documentation included with your linker.</span></span>

## <a name="related-topics"></a><span data-ttu-id="81e48-140">См. также</span><span class="sxs-lookup"><span data-stu-id="81e48-140">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="81e48-141">[Предотвращение выполнения данных (TechNet)](/previous-versions/windows/it-pro/windows-xp/bb457155(v=technet.10))</span><span class="sxs-lookup"><span data-stu-id="81e48-141">[Data Execution Prevention (TechNet)](/previous-versions/windows/it-pro/windows-xp/bb457155(v=technet.10))</span></span>
</dt> <dt>

[<span data-ttu-id="81e48-142">Настройка защиты памяти</span><span class="sxs-lookup"><span data-stu-id="81e48-142">How to Configure Memory Protection</span></span>](https://www.microsoft.com/technet/security/prodtech/windowsxp/depcnfxp.mspx)
</dt> <dt>

[<span data-ttu-id="81e48-143">Статья базы знаний 875352</span><span class="sxs-lookup"><span data-stu-id="81e48-143">KB Article 875352</span></span>](https://support.microsoft.com/kb/875352)
</dt> </dl>

 

 
