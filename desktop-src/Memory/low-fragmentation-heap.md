---
description: Фрагментация кучи — это состояние, в котором доступная память разбивается на небольшие несмежные блоки.
ms.assetid: d10abf82-423c-4942-b05e-55de3a5c4219
title: Куча с низкой фрагментацией
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8ad14a97fa6d95b663f63b21f0982332ba0de01e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105683351"
---
# <a name="low-fragmentation-heap"></a><span data-ttu-id="de14c-103">Куча с низкой фрагментацией</span><span class="sxs-lookup"><span data-stu-id="de14c-103">Low-fragmentation Heap</span></span>

<span data-ttu-id="de14c-104">\[Сведения в этом разделе относятся к Windows Server 2003 и Windows XP.</span><span class="sxs-lookup"><span data-stu-id="de14c-104">\[The information in this topic applies to Windows Server 2003 and Windows XP.</span></span> <span data-ttu-id="de14c-105">Начиная с Windows Vista, система использует кучу с низкой фрагментацией (LFH), необходимую для обслуживания запросов на выделение памяти.</span><span class="sxs-lookup"><span data-stu-id="de14c-105">Starting with Windows Vista, the system uses the low-fragmentation heap (LFH) as needed to service memory allocation requests.</span></span> <span data-ttu-id="de14c-106">Приложениям не нужно включать LFH для своих куч.\]</span><span class="sxs-lookup"><span data-stu-id="de14c-106">Applications do not need to enable the LFH for their heaps.\]</span></span>

<span data-ttu-id="de14c-107">Фрагментация кучи — это состояние, в котором доступная память разбивается на небольшие несмежные блоки.</span><span class="sxs-lookup"><span data-stu-id="de14c-107">Heap fragmentation is a state in which available memory is broken into small, noncontiguous blocks.</span></span> <span data-ttu-id="de14c-108">При фрагментации кучи выделение памяти может завершиться ошибкой, даже если общий объем доступной памяти в куче достаточно для удовлетворения запроса, так как ни один блок памяти недостаточно велик.</span><span class="sxs-lookup"><span data-stu-id="de14c-108">When a heap is fragmented, memory allocation can fail even when the total available memory in the heap is enough to satisfy a request, because no single block of memory is large enough.</span></span> <span data-ttu-id="de14c-109">Куча с низкой фрагментацией (LFH) позволяет уменьшить фрагментацию кучи.</span><span class="sxs-lookup"><span data-stu-id="de14c-109">The low-fragmentation heap (LFH) helps to reduce heap fragmentation.</span></span>

<span data-ttu-id="de14c-110">LFH не является отдельной кучей.</span><span class="sxs-lookup"><span data-stu-id="de14c-110">The LFH is not a separate heap.</span></span> <span data-ttu-id="de14c-111">Вместо этого это политика, которую приложения могут включить для своих куч.</span><span class="sxs-lookup"><span data-stu-id="de14c-111">Instead, it is a policy that applications can enable for their heaps.</span></span> <span data-ttu-id="de14c-112">Если LFH включен, система выделяет память в определенных заранее заданной размерах.</span><span class="sxs-lookup"><span data-stu-id="de14c-112">When the LFH is enabled, the system allocates memory in certain predetermined sizes.</span></span> <span data-ttu-id="de14c-113">Когда приложение запрашивает выделение памяти из кучи с включенным LFH, система выделяет минимальный блок памяти, достаточно большой для того, чтобы вместить запрошенный размер.</span><span class="sxs-lookup"><span data-stu-id="de14c-113">When an application requests a memory allocation from a heap that has the LFH enabled, the system allocates the smallest block of memory that is large enough to contain the requested size.</span></span> <span data-ttu-id="de14c-114">Система не использует LFH для выделений, превышающих 16 КБ, независимо от того, включена ли LFH.</span><span class="sxs-lookup"><span data-stu-id="de14c-114">The system does not use the LFH for allocations larger than 16 KB, whether or not the LFH is enabled.</span></span>

<span data-ttu-id="de14c-115">Приложение должно включать LFH только для кучи по умолчанию вызывающего процесса или для [частных куч](heap-functions.md) , созданных приложением.</span><span class="sxs-lookup"><span data-stu-id="de14c-115">An application should enable the LFH only for the default heap of the calling process or for [private heaps](heap-functions.md) that the application has created.</span></span> <span data-ttu-id="de14c-116">Чтобы включить LFH для кучи, используйте функцию [**жетпроцесшеап**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) для получения маркера в куче по умолчанию вызывающего процесса или используйте этот маркер для закрытой кучи, созданной функцией [**хеапкреате**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) .</span><span class="sxs-lookup"><span data-stu-id="de14c-116">To enable the LFH for a heap, use the [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) function to obtain a handle to the default heap of the calling process, or use the handle to a private heap created by the [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function.</span></span> <span data-ttu-id="de14c-117">Затем вызовите функцию [**HeapSetInformation**](/windows/desktop/api/HeapApi/nf-heapapi-heapsetinformation) с помощью маркера.</span><span class="sxs-lookup"><span data-stu-id="de14c-117">Then call the [**HeapSetInformation**](/windows/desktop/api/HeapApi/nf-heapapi-heapsetinformation) function with the handle.</span></span>

<span data-ttu-id="de14c-118">LFH нельзя включить для куч, созданных с кучей, **\_ не выполнять \_ сериализацию** или для куч, созданных с фиксированным размером.</span><span class="sxs-lookup"><span data-stu-id="de14c-118">The LFH cannot be enabled for heaps created with **HEAP\_NO\_SERIALIZE** or for heaps created with a fixed size.</span></span> <span data-ttu-id="de14c-119">LFH также нельзя включить, если вы используете средства отладки кучи в [средствах отладки для Windows](/windows-hardware/drivers/debugger/) или [Microsoft средство проверки приложений](https://www.microsoft.com/downloads/details.aspx?FamilyID=c4a25ab9-649d-4a1b-b4a7-c9d8b095df18&displaylang=en).</span><span class="sxs-lookup"><span data-stu-id="de14c-119">The LFH also cannot be enabled if you are using the heap debugging tools in [Debugging Tools for Windows](/windows-hardware/drivers/debugger/) or [Microsoft Application Verifier](https://www.microsoft.com/downloads/details.aspx?FamilyID=c4a25ab9-649d-4a1b-b4a7-c9d8b095df18&displaylang=en).</span></span>

<span data-ttu-id="de14c-120">После включения LFH для кучи ее нельзя отключить.</span><span class="sxs-lookup"><span data-stu-id="de14c-120">After the LFH has been enabled for a heap, it cannot be disabled.</span></span>

<span data-ttu-id="de14c-121">Приложения, которые наиболее эффективно используют LFH, являются многопоточными приложениями, которые часто выделяют память и используют различные размеры выделения в 16 КБ.</span><span class="sxs-lookup"><span data-stu-id="de14c-121">Applications that benefit most from the LFH are multithreaded applications that allocate memory frequently and use a variety of allocation sizes under 16 KB.</span></span> <span data-ttu-id="de14c-122">Однако не все приложения имеют преимущество от LFH.</span><span class="sxs-lookup"><span data-stu-id="de14c-122">However, not all applications benefit from the LFH.</span></span> <span data-ttu-id="de14c-123">Чтобы оценить последствия включения LFH в приложении, используйте данные профилирования производительности.</span><span class="sxs-lookup"><span data-stu-id="de14c-123">To assess the effects of enabling the LFH in your application, use performance profiling data.</span></span>

 

 
