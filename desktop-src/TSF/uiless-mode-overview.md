---
title: Обзор режима Уилесс
description: Обзор режима Уилесс
ms.assetid: cc0e4936-eab1-452d-9ba1-188401918e99
keywords:
- Платформа текстовых служб (TSF), Уилессмоде
- TSF (платформа текстовых служб), Уилессмоде
- Приложения с поддержкой TSF, Уилессмоде
- уилессмоде
- Платформа текстовых служб (TSF), список кандидатов UIElement
- TSF (платформа текстовых служб), UIElement список кандидатов
- Приложения с поддержкой TSF, UIElement список кандидатов
- UIElement список кандидатов
- Платформа текстовых служб (TSF), подсказка UIElement
- TSF (платформа текстовых служб), Совет UIElement
- Приложения с поддержкой TSF, Совет UIElement
- Совет по UIElement
- Платформа текстовых служб (TSF), предопределенные элементы пользовательского интерфейса
- TSF (платформа текстовых служб), предопределенные элементы пользовательского интерфейса
- Приложения с поддержкой TSF, предопределенные элементы пользовательского интерфейса
- предопределенные элементы пользовательского интерфейса
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b7354a88fb28fd0d6bf5f4180ac23359a2117fe7
ms.sourcegitcommit: ee06501cc29132927ade9813e0888aaa4decc487
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/28/2021
ms.locfileid: "104550363"
---
# <a name="uiless-mode-overview"></a><span data-ttu-id="7ff46-119">Обзор режима Уилесс</span><span class="sxs-lookup"><span data-stu-id="7ff46-119">UILess Mode Overview</span></span>

## <a name="how-to-create-uilessmode"></a><span data-ttu-id="7ff46-120">Создание Уилессмоде</span><span class="sxs-lookup"><span data-stu-id="7ff46-120">How to create UILessMode</span></span>

<span data-ttu-id="7ff46-121">**Создание потока без интерфейса пользователя:** Приложение может сделать пользовательский интерфейс меньшим потоком с помощью [**итфсреадмгрекс:: активатикс**](/windows/desktop/api/Msctf/nf-msctf-itfthreadmgrex-activateex) с ИТФ \_ AE \_ уиелементенабледонли.</span><span class="sxs-lookup"><span data-stu-id="7ff46-121">**Making UI-less Thread:** The application can make a UI Less Thread by [**ITfThreadMgrEx::ActivateEx**](/windows/desktop/api/Msctf/nf-msctf-itfthreadmgrex-activateex) with ITF\_AE\_UIELEMENTENABLEDONLY.</span></span> <span data-ttu-id="7ff46-122">Когда Среадмгр активируется с этим флагом, в потоке активируются только советы, которые могут управлять его элементом пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="7ff46-122">When ThreadMgr is activated with this flag, only TIPs that can control its UI element are activated on the thread.</span></span> <span data-ttu-id="7ff46-123">Приложению необходимо реализовать интерфейс [**итфуиелементсинк**](/windows/desktop/api/Msctf/nn-msctf-itfuielementsink) и порекомендовать интерфейс в Диспетчер потоков.</span><span class="sxs-lookup"><span data-stu-id="7ff46-123">The application needs to implement [**ITfUIElementSink**](/windows/desktop/api/Msctf/nn-msctf-itfuielementsink) interface and advise the interface into thread manager.</span></span> <span data-ttu-id="7ff46-124">[**Итфуиелементсинк:: бегинуиелемент**](/windows/desktop/api/Msctf/nf-msctf-itfuielementsink-beginuielement) вызывается, когда TIP показывает свой пользовательский интерфейс.</span><span class="sxs-lookup"><span data-stu-id="7ff46-124">[**ITfUIElementSink::BeginUIElement**](/windows/desktop/api/Msctf/nf-msctf-itfuielementsink-beginuielement) is called when TIP shows its UI.</span></span> <span data-ttu-id="7ff46-125">Приложение может вернуть **значение true** в параметре пбшов, чтобы разрешить TIP отображать исходный пользовательский интерфейс TIP, если приложение не хочет рисовать.</span><span class="sxs-lookup"><span data-stu-id="7ff46-125">The application can return **TRUE** in pbShow param to allow TIP to show TIP's original UI when the application does not want to draw.</span></span> <span data-ttu-id="7ff46-126">Если приложение не разрешает пользовательский интерфейс TIP, оно может вернуть **значение false** в пбшов (см. схемы ниже).</span><span class="sxs-lookup"><span data-stu-id="7ff46-126">If the application does not allow TIP's UI, it can return **FALSE** in pbShow (see diagrams below).</span></span> <span data-ttu-id="7ff46-127">Приложение может рисовать пользовательский интерфейс, получая некоторые сведения из параметра *пелемент* .</span><span class="sxs-lookup"><span data-stu-id="7ff46-127">The application can draw the UI by itself by getting some information from the *pElement* param.</span></span> <span data-ttu-id="7ff46-128">Это может быть список кандидатов, элемент языковой панели или пользовательский интерфейс TIP.</span><span class="sxs-lookup"><span data-stu-id="7ff46-128">It could be the candidate list, the language bar item, or the custom UI of TIP.</span></span> <span data-ttu-id="7ff46-129">Приложение может понять тип пользовательского интерфейса с помощью интерфейса Киинг [**итфуиелемент**](/windows/desktop/api/Msctf/nn-msctf-itfuielement) .</span><span class="sxs-lookup"><span data-stu-id="7ff46-129">The application can know the kind of UI by QIing [**ITfUIElement**](/windows/desktop/api/Msctf/nn-msctf-itfuielement) interface.</span></span> <span data-ttu-id="7ff46-130">При изменении пользовательского интерфейса вызывается [**итфуиелементсинк:: упдатеуиелемент**](/windows/desktop/api/Msctf/nf-msctf-itfuielementsink-updateuielement) .</span><span class="sxs-lookup"><span data-stu-id="7ff46-130">When the UI is changed, [**ITfUIElementSink::UpdateUIElement**](/windows/desktop/api/Msctf/nf-msctf-itfuielementsink-updateuielement) is called.</span></span> <span data-ttu-id="7ff46-131">Приложение может сравнить идентификатор GUID из Пелемент->. GUID (), чтобы выяснить, отображается ли элемент приложением в данный момент.</span><span class="sxs-lookup"><span data-stu-id="7ff46-131">The application can compare the GUID from pElement->GetGUID() to know if the element is currently drawn by the application.</span></span>

<span data-ttu-id="7ff46-132">**Создание подсказок с поддержкой пользовательского интерфейса:** Совет должен поддерживать меньший режим пользовательского интерфейса, если он хочет работать с приложением, которое не должно разрешать пользовательский интерфейс TIP, например игровое приложение или полноэкранные приложения.</span><span class="sxs-lookup"><span data-stu-id="7ff46-132">**Making UI-less Aware TIP:** TIP should support UI less mode if it wants to run under the application that does not want to allow TIP's UI such as game application or full screen applications.</span></span> <span data-ttu-id="7ff46-133">Для того, чтобы использовать интерфейс [**итфтекстинпутпроцессорекс**](/windows/desktop/api/Msctf/nn-msctf-itftextinputprocessorex) , подсказка требует реализации интерфейса API.</span><span class="sxs-lookup"><span data-stu-id="7ff46-133">To be UI less aware, TIP needs to implement [**ITfTextInputProcessorEx**](/windows/desktop/api/Msctf/nn-msctf-itftextinputprocessorex) interface.</span></span> <span data-ttu-id="7ff46-134">Если этот интерфейс не реализован, подсказка не будет активирована в потоке в режиме без интерфейса.</span><span class="sxs-lookup"><span data-stu-id="7ff46-134">If this interface is not implemented, TIP will not be activated under the UI less mode thread.</span></span> <span data-ttu-id="7ff46-135">Кроме того, Совет должен вызвать метод [**итфуиелементмгр:: бегинуиелемент**](/windows/desktop/api/Msctf/nf-msctf-itfuielementmgr-beginuielement) , прежде чем он отобразит видимый пользовательский интерфейс для экрана.</span><span class="sxs-lookup"><span data-stu-id="7ff46-135">In addition, TIP must call [**ITFUIElementMgr::BeginUIElement**](/windows/desktop/api/Msctf/nf-msctf-itfuielementmgr-beginuielement) before it shows a visible UI to the screen.</span></span> <span data-ttu-id="7ff46-136">Этот метод вызывает [**итфуиелементсинк**](/windows/desktop/api/Msctf/nn-msctf-itfuielementsink) для уведомления приложения.</span><span class="sxs-lookup"><span data-stu-id="7ff46-136">This method makes a call to [**ITfUIElementSink**](/windows/desktop/api/Msctf/nn-msctf-itfuielementsink) to notify the application.</span></span> <span data-ttu-id="7ff46-137">И приложение будет решать, можно ли его отображать или нет.</span><span class="sxs-lookup"><span data-stu-id="7ff46-137">And the application will decide if it can be shown or not.</span></span> <span data-ttu-id="7ff46-138">Когда TIP вызывает Бегинуиелемент (), Совет должен иметь интерфейс [**итфуиелемент**](/windows/desktop/api/Msctf/nn-msctf-itfuielement) для соответствующего пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="7ff46-138">When TIP calls BeginUIElement(), TIP needs to have the [**ITfUIElement**](/windows/desktop/api/Msctf/nn-msctf-itfuielement) interface for the corresponding UI.</span></span> <span data-ttu-id="7ff46-139">Приложение будет превышено интерфейс для получения другого интерфейса для получения дополнительных сведений для отрисовки ПОЛЬЗОВАТЕЛЬСКОГО интерфейса.</span><span class="sxs-lookup"><span data-stu-id="7ff46-139">The application will QI the interface to get another UI specific interface to retrieve more information to draw the UI.</span></span> <span data-ttu-id="7ff46-140">Система предопределяет [**итфкандидателистуиелемент**](/windows/desktop/api/Msctf/nn-msctf-itfcandidatelistuielement) и [**итфреадингинформатионуиелемент**](/windows/desktop/api/Msctf/nn-msctf-itfreadinginformationuielement) для TIP.</span><span class="sxs-lookup"><span data-stu-id="7ff46-140">System predefines [**ITfCandidateListUIElement**](/windows/desktop/api/Msctf/nn-msctf-itfcandidatelistuielement) and [**ITfReadingInformationUIElement**](/windows/desktop/api/Msctf/nn-msctf-itfreadinginformationuielement) for TIP.</span></span> <span data-ttu-id="7ff46-141">Когда Совет хочет отобразить список кандидатов в потоке, проходящем в режиме без интерфейса, Совет должен создать экземпляр интерфейса **итфкандидателистуиелемент** и вызвать **Итфуиелементмгр:: бегинуиелемент**.</span><span class="sxs-lookup"><span data-stu-id="7ff46-141">When TIP wants to show the candidate list under UI less mode thread, TIP must create an instance of the **ITfCandidateListUIElement** interface and call **ITFUIElementMgr::BeginUIElement**.</span></span> <span data-ttu-id="7ff46-142">Когда вызывается [**итфтекстинпутпроцессорекс:: активатикс**](/windows/desktop/api/Msctf/nf-msctf-itftextinputprocessorex-activateex) , Совет уже знает, что поток является интерфейсом пользователя, поэтому он может исключить дополнительный пользовательский интерфейс.</span><span class="sxs-lookup"><span data-stu-id="7ff46-142">When [**ITfTextInputProcessorEx::ActivateEx**](/windows/desktop/api/Msctf/nf-msctf-itftextinputprocessorex-activateex) is called, TIP already know the thread is UI less more so it can eliminate the extra custom UI.</span></span> <span data-ttu-id="7ff46-143">Однако разумеется, он может реализовать собственный интерфейс, который можно Киед из и попытаться создать уведомление.</span><span class="sxs-lookup"><span data-stu-id="7ff46-143">However, of course, it can implement its own interface that can be QIed from and try to make a notification.</span></span> <span data-ttu-id="7ff46-144">Поэтому TIP и приложения **итфуиелемент** сположение могут иметь согласование для НАСТРАИВАЕМОГО ПОЛЬЗОВАТЕЛЬСКОГО интерфейса TIP.</span><span class="sxs-lookup"><span data-stu-id="7ff46-144">Thus TIP and the appli **ITfUIElement** cation can have a negotiation for the TIP custom UI.</span></span>

## <a name="uielement-supporting-tip"></a><span data-ttu-id="7ff46-145">Вспомогательная подсказка UIElement</span><span class="sxs-lookup"><span data-stu-id="7ff46-145">UIElement Supporting TIP</span></span>

<span data-ttu-id="7ff46-146">Совет, который поддерживает UIElement, должен классифицироваться по GUID \_ тфкат \_ типкап \_ уиелементенаблед.</span><span class="sxs-lookup"><span data-stu-id="7ff46-146">The TIP that supports the UIElement must be categorized by GUID\_TFCAT\_TIPCAP\_UIELEMENTENABLED.</span></span> <span data-ttu-id="7ff46-147">Совет в GUID \_ тфкат \_ типкап \_ Уиелементенаблед должен использовать [**итфуиелементмгр**](/windows/desktop/api/Msctf/nn-msctf-itfuielementmgr) для отображения любого пользовательского интерфейса, чтобы приложение может управлять видимостью пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="7ff46-147">The TIP in GUID\_TFCAT\_TIPCAP\_UIELEMENTENABLED must use [**ITfUIElementMgr**](/windows/desktop/api/Msctf/nn-msctf-itfuielementmgr) to show any UI so the application can control the visibility of the UI.</span></span>

<span data-ttu-id="7ff46-148">**Показать/скрыть состояние UIElement:** Показать/скрыть состояние, отмеченное методом [**итфуиелемент:: Показать**](/windows/desktop/api/Msctf/nf-msctf-itfuielement-show) или [**итфуиелемент::**](/windows/desktop/api/Msctf/nf-msctf-itfuielement-isshown) OnVisible, является фактическим видимым состоянием.</span><span class="sxs-lookup"><span data-stu-id="7ff46-148">**Show/Hide status of UIElement:** Show/Hide status that is indicated by [**ITfUIElement::Show**](/windows/desktop/api/Msctf/nf-msctf-itfuielement-show) or [**ITfUIElement::IsShown**](/windows/desktop/api/Msctf/nf-msctf-itfuielement-isshown) method is the actual visible status.</span></span> <span data-ttu-id="7ff46-149">Он не связан с доступностью UIElement.</span><span class="sxs-lookup"><span data-stu-id="7ff46-149">It is not related to the availability of UIElement.</span></span> <span data-ttu-id="7ff46-150">Элемент UIElement должен быть всегда доступен, если существует состояние отображения.</span><span class="sxs-lookup"><span data-stu-id="7ff46-150">UIElement should be always available when the show status exists.</span></span> <span data-ttu-id="7ff46-151">Состояние отображения может быть управляемым из приложения.</span><span class="sxs-lookup"><span data-stu-id="7ff46-151">The show status is controllable from the application.</span></span> <span data-ttu-id="7ff46-152">Приложение может внезапно перейти в режим Уилесс и начать рисовать некоторый пользовательский интерфейс, вызвав **итфуиелемент:: Показать** со значением **false** , чтобы скрыть весь пользовательский интерфейс TIP.</span><span class="sxs-lookup"><span data-stu-id="7ff46-152">The application may suddenly move into UILess mode and start drawing some UI by itself, by calling **ITfUIElement::Show** with **FALSE** to hide all the UI of TIP.</span></span> <span data-ttu-id="7ff46-153">Затем Совет может использовать один из вариантов.</span><span class="sxs-lookup"><span data-stu-id="7ff46-153">Then TIP can take one of some options.</span></span> <span data-ttu-id="7ff46-154">1) TIP может переместить UIElement в состояние скрыть и начать создание Упдатеуиелемент.</span><span class="sxs-lookup"><span data-stu-id="7ff46-154">1) TIP can move the UIElement to the Hide status and start generating UpdateUIElement.</span></span> <span data-ttu-id="7ff46-155">2) TIP может завершить UIElement, так как элемент пользовательского интерфейса не поддерживает функцию скрыть состояние, а TIP вызывает Ендуиелемент (), чтобы завершить его.</span><span class="sxs-lookup"><span data-stu-id="7ff46-155">2) TIP can finish UIElement since the UI element does not support Hide status and Tip calls EndUIElement() to finish it.</span></span>

## <a name="predefined-ui-elements"></a><span data-ttu-id="7ff46-156">Предопределенные элементы пользовательского интерфейса</span><span class="sxs-lookup"><span data-stu-id="7ff46-156">Predefined UI Elements</span></span>

<span data-ttu-id="7ff46-157">**Список кандидатов:** Список кандидатов — это один из основных элементов пользовательского интерфейса для входных данных EA.</span><span class="sxs-lookup"><span data-stu-id="7ff46-157">**The candidate list:** The candidate list is one of the major UI elements for EA input.</span></span> <span data-ttu-id="7ff46-158">Этот элемент пользовательского интерфейса предоставляет список кандидатов и соответствующее число строк кандидатов для рисования.</span><span class="sxs-lookup"><span data-stu-id="7ff46-158">This UI Element provides the candidate list and corresponding number of the candidate strings for drawing.</span></span>

<span data-ttu-id="7ff46-159">**Окно сведений о чтении** Окно сведения о чтении обычно используется для ввода с клавиатуры на китайском языке.</span><span class="sxs-lookup"><span data-stu-id="7ff46-159">**The reading information window** The reading information window is common for Chinese Keyboard Input.</span></span> <span data-ttu-id="7ff46-160">Он содержит этап, который не может быть вставлен в документ в качестве строки композиции.</span><span class="sxs-lookup"><span data-stu-id="7ff46-160">It has the stage that cannot be inserted into the document as the composition string.</span></span> <span data-ttu-id="7ff46-161">В некоторых процессорах ввода для китайского языка открывается небольшое окно сведений для чтения, в котором показана информация для чтения, фонетического или вводимого текста.</span><span class="sxs-lookup"><span data-stu-id="7ff46-161">Some Chinese Input Processor opens a small reading information window that shows the reading, phonetic or typing information.</span></span>

## <a name="the-flow-chart-of-uilessmode"></a><span data-ttu-id="7ff46-162">Блоковая схема Уилессмоде</span><span class="sxs-lookup"><span data-stu-id="7ff46-162">The flow chart of UILessMode</span></span>

![Схема, на которой показана Лессмоденая диаграмма U I.](images/tsf-uilessmode-ovw1.gif)

<span data-ttu-id="7ff46-164">После того как TIP получит **значение true** в \* пбшовн by [**итфуиелементмгр:: бегинуиелемент**](/windows/desktop/api/Msctf/nf-msctf-itfuielementmgr-beginuielement), tip не нужно вызывать упдатеуиелемент для UIElement.</span><span class="sxs-lookup"><span data-stu-id="7ff46-164">After the TIP receives **TRUE** in \*pbShown by [**ITfUIElementMgr::BeginUIElement**](/windows/desktop/api/Msctf/nf-msctf-itfuielementmgr-beginuielement), the TIP does not have to call UpdateUIElement for the UIElement.</span></span> <span data-ttu-id="7ff46-165">Но TIP необходимо вызвать Ендуиелемент (), чтобы [**итфуиелементмгр**](/windows/desktop/api/Msctf/nn-msctf-itfuielementmgr) и приложение могли отвестить состояние UIElement.</span><span class="sxs-lookup"><span data-stu-id="7ff46-165">But TIP needs to call EndUIElement() so the [**ITfUIElementMgr**](/windows/desktop/api/Msctf/nn-msctf-itfuielementmgr) and the application can track the status of UIElement.</span></span> <span data-ttu-id="7ff46-166">TIP должен вызвать Упдатеуиелемент () после того, как Бегинуиелемент () возвращает **значение false** в \* пбшов.</span><span class="sxs-lookup"><span data-stu-id="7ff46-166">TIP must calls UpdateUIElement() after BeginUIElement() returns **FALSE** in \*pbShow.</span></span> <span data-ttu-id="7ff46-167">Приложение, которое хочет нарисовать пользовательский интерфейс, не проверяет содержимое в Бегинуиелемент (), оно просто возвращает отображение состояния в Бегинуиелемент () и начинает проверку содержимого в Упдатеуиелемент ().</span><span class="sxs-lookup"><span data-stu-id="7ff46-167">The application that wants to draw the UI does not check the contents in BeginUIElement(), it just returns the show status at BeginUIElement() and starts checking the contents at UpdateUIElement().</span></span> <span data-ttu-id="7ff46-168">Например, флаг обновления элемента UIElement списка кандидатов имеет все биты в первом Упдатеуиелемент ().</span><span class="sxs-lookup"><span data-stu-id="7ff46-168">For example, the update flag of the candidate list UIElement has all bits at the first UpdateUIElement().</span></span> <span data-ttu-id="7ff46-169">Это означает, что содержимое UIElement не обязательно должно быть готово в Бегинуиелемент ().</span><span class="sxs-lookup"><span data-stu-id="7ff46-169">This means that the contents of UIElement does not have to be ready at BeginUIElement().</span></span>

![Схема, показывающая, когда вызывается T I P, вызывается "Итуиелементмгр:: Бегинуиелемент ()" и "Бегинуиелемент приложения Уиелементсинк".](images/tsf-uilessmode-ovw2.gif)![Схема, показывающая, что приложение возвращает значение FALSE в \* Пбшов.](images/tsf-uilessmode-ovw3.gif)![уилессмоде Потоковая диаграмма](images/tsf-uilessmode-ovw4.gif)

## <a name="the-candidate-list-uielement"></a><span data-ttu-id="7ff46-173">Элемент UIElement списка кандидатов</span><span class="sxs-lookup"><span data-stu-id="7ff46-173">The candidate list UIElement</span></span>

<span data-ttu-id="7ff46-174">**О параметре pageIndex:** Приложение, которое рисует список кандидатов, вычислит количество строк на странице при изменении содержимого списка ( \_ параметр TF клуие \_ String установлен).</span><span class="sxs-lookup"><span data-stu-id="7ff46-174">**About PageIndex:** The application that draws the candidate list will calculate the number of strings per page when the contents of the list is changed (TF\_CLUIE\_STRING is set).</span></span> <span data-ttu-id="7ff46-175">Не рекомендуется изменять индекс страницы, пока список кандидатов доступен для режима Уилесс.</span><span class="sxs-lookup"><span data-stu-id="7ff46-175">It is not good to change the page index while the candidate list is available for UILess mode.</span></span> <span data-ttu-id="7ff46-176">Это означает, что список кандидатов TIP должен вести себя на разбиение на страницы, а не на прокрутку при перемещении выделения на следующую страницу.</span><span class="sxs-lookup"><span data-stu-id="7ff46-176">This means that TIP's candidate list should behave the paging rather than scrolling when the selection is moved to the next page.</span></span> <span data-ttu-id="7ff46-177">Если прокрутка происходит при выделении, то индекс страницы изменяется, и приложению необходимо повторно вычислить индекс страницы.</span><span class="sxs-lookup"><span data-stu-id="7ff46-177">If the scroll happens at the selection moves, the page index is changed and the application needs to recalculate the page index.</span></span> <span data-ttu-id="7ff46-178">Результат может не быть ожидаемым для TIP.</span><span class="sxs-lookup"><span data-stu-id="7ff46-178">The result may not be expected by TIP.</span></span>

<span data-ttu-id="7ff46-179">**Без выбора:** [**итфкандидателистуиелемент::-SELECT**](/windows/desktop/api/Msctf/nf-msctf-itfcandidatelistuielement-getselection) возвращает \_ значение false, если список кандидатов не имеет выбора.</span><span class="sxs-lookup"><span data-stu-id="7ff46-179">**No Selection:** [**ITfCandidateListUIElement::GetSelection**](/windows/desktop/api/Msctf/nf-msctf-itfcandidatelistuielement-getselection) returns S\_FALSE, if the candidate list does not have a selection.</span></span> <span data-ttu-id="7ff46-180">Недопустимое возвращаемое значение первого параметра.</span><span class="sxs-lookup"><span data-stu-id="7ff46-180">The return value of the first param is invalid.</span></span>

 

 




