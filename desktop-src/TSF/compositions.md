---
title: Композиции
description: Композиция — это временное состояние ввода, которое позволяет текстовой службе указать как для приложения, так и для пользователя, что входной текст все еще находится в состоянии изменения.
ms.assetid: 3d9da4f2-ceb9-4abc-8979-d3756d948a57
keywords:
- Платформа текстовых служб (TSF), композиции
- TSF (платформа текстовых служб), композиции
- текстовые службы, композиции
- Приложения с поддержкой TSF, композиции
- compositions
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0b03f3e991f76ee7c6dca3830267796576c7b842
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104413436"
---
# <a name="compositions"></a><span data-ttu-id="adc54-108">Композиции</span><span class="sxs-lookup"><span data-stu-id="adc54-108">Compositions</span></span>

<span data-ttu-id="adc54-109">Композиция — это временное состояние ввода, которое позволяет текстовой службе указать как для приложения, так и для пользователя, что входной текст все еще находится в состоянии изменения.</span><span class="sxs-lookup"><span data-stu-id="adc54-109">A composition is a temporary input state that enables a text service to specify both to the application and the user that the input text is still in a state of change.</span></span> <span data-ttu-id="adc54-110">Приложение может и должно получать сведения об атрибутах композиции и использовать эти сведения для отображения состояния композиции пользователю.</span><span class="sxs-lookup"><span data-stu-id="adc54-110">An application can and should obtain display attribute information about the composition and use this information to display the composition state to the user.</span></span>

<span data-ttu-id="adc54-111">Один из примеров использования композиции — во время речевого ввода.</span><span class="sxs-lookup"><span data-stu-id="adc54-111">One example of the use of a composition is during speech input.</span></span> <span data-ttu-id="adc54-112">В то время как пользователь говорит, служба речевого текста создает композицию.</span><span class="sxs-lookup"><span data-stu-id="adc54-112">While the user is speaking, the speech text service creates a composition.</span></span> <span data-ttu-id="adc54-113">Эта композиция будет оставаться неизменной до тех пор, пока не завершится весь речевой ввод.</span><span class="sxs-lookup"><span data-stu-id="adc54-113">This composition will remain intact until the entire speech input is complete.</span></span> <span data-ttu-id="adc54-114">По завершении сеанса служба речевого текста прерывает композицию.</span><span class="sxs-lookup"><span data-stu-id="adc54-114">When the session ends, the speech text service terminates the composition.</span></span>

<span data-ttu-id="adc54-115">Приложение использует присутствие и отсутствие композиции, чтобы определить способ отображения текста и то, что, если таковая имеется, должна выполняться обработка текста.</span><span class="sxs-lookup"><span data-stu-id="adc54-115">An application uses the presence and absence of a composition to determine how to display text and what, if any, processing should be performed on the text.</span></span> <span data-ttu-id="adc54-116">Например, если пользователь использует обработчик речи для ввода текста, приложение не должно выполнять проверку орфографии или грамматики для текста композиции.</span><span class="sxs-lookup"><span data-stu-id="adc54-116">For example, if the user is using the speech engine to input text, the application should not perform any spelling or grammar checking on any composition text.</span></span> <span data-ttu-id="adc54-117">Текст считается неполным до завершения композиции.</span><span class="sxs-lookup"><span data-stu-id="adc54-117">The text is considered incomplete until the composition is terminated.</span></span>

## <a name="text-services"></a><span data-ttu-id="adc54-118">Текстовые службы</span><span class="sxs-lookup"><span data-stu-id="adc54-118">Text Services</span></span>

<span data-ttu-id="adc54-119">Служба текстового ввода создает композицию путем вызова [итфконтексткомпоситион:: старткомпоситион](/windows/desktop/api/msctf/nf-msctf-itfcontextcomposition-startcomposition).</span><span class="sxs-lookup"><span data-stu-id="adc54-119">A text service creates a composition by calling [ITfContextComposition::StartComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextcomposition-startcomposition).</span></span> <span data-ttu-id="adc54-120">При необходимости в текстовой службе можно реализовать объект [итфкомпоситионсинк](/windows/desktop/api/msctf/nn-msctf-itfcompositionsink) , который получает уведомления о событиях композиции.</span><span class="sxs-lookup"><span data-stu-id="adc54-120">The text service can optionally implement an [ITfCompositionSink](/windows/desktop/api/msctf/nn-msctf-itfcompositionsink) object that receives composition event notifications.</span></span> <span data-ttu-id="adc54-121">Старткомпоситион возвращает объект [итфкомпоситион](/windows/desktop/api/msctf/nn-msctf-itfcomposition) , который служба текстового ввода хранит ссылку и использует для изменения и завершения композиции.</span><span class="sxs-lookup"><span data-stu-id="adc54-121">StartComposition returns an [ITfComposition](/windows/desktop/api/msctf/nn-msctf-itfcomposition) object that the text service keeps a reference to and uses to modify and terminate the composition.</span></span> <span data-ttu-id="adc54-122">Служба текстового ввода завершает композицию путем вызова [итфкомпоситион:: ендкомпоситион](/windows/desktop/api/msctf/nf-msctf-itfcomposition-endcomposition).</span><span class="sxs-lookup"><span data-stu-id="adc54-122">The text service terminates the composition by calling [ITfComposition::EndComposition](/windows/desktop/api/msctf/nf-msctf-itfcomposition-endcomposition).</span></span>

<span data-ttu-id="adc54-123">Если служба текстового ввода будет создавать композиции, она также должна поддерживать атрибуты дисплея, чтобы позволить приложению отображать текст, который является частью композиции, иначе, чем стандартный текст.</span><span class="sxs-lookup"><span data-stu-id="adc54-123">If a text service is going to create compositions, it should also support display attributes to enable an application to display text that is part of a composition differently than standard text.</span></span> <span data-ttu-id="adc54-124">Дополнительные сведения см. в разделе [предоставление атрибутов вывода](providing-display-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="adc54-124">For more information, see [Providing Display Attributes](providing-display-attributes.md).</span></span>

## <a name="applications"></a><span data-ttu-id="adc54-125">Приложения</span><span class="sxs-lookup"><span data-stu-id="adc54-125">Applications</span></span>

<span data-ttu-id="adc54-126">Приложение может отслеживать создание, изменение и завершение композиций путем установки приемника [итфконтекстовнеркомпоситионсинк](/windows/desktop/api/msctf/nn-msctf-itfcontextownercompositionsink) .</span><span class="sxs-lookup"><span data-stu-id="adc54-126">An application can monitor the creation, change and termination of compositions by installing an [ITfContextOwnerCompositionSink](/windows/desktop/api/msctf/nn-msctf-itfcontextownercompositionsink) sink.</span></span> <span data-ttu-id="adc54-127">При запуске композиции вызывается [итфконтекстовнеркомпоситионсинк:: онстарткомпоситион](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onstartcomposition) .</span><span class="sxs-lookup"><span data-stu-id="adc54-127">When a composition is started, [ITfContextOwnerCompositionSink::OnStartComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onstartcomposition) is called.</span></span> <span data-ttu-id="adc54-128">Аналогично, при изменении или завершении композиции будут вызываться [итфконтекстовнеркомпоситионсинк:: онупдатекомпоситион](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onupdatecomposition) и [Итфконтекстовнеркомпоситионсинк:: OnEndComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onendcomposition) , соответственно.</span><span class="sxs-lookup"><span data-stu-id="adc54-128">Likewise, when a composition is changed or terminated, [ITfContextOwnerCompositionSink::OnUpdateComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onupdatecomposition) and [ITfContextOwnerCompositionSink::OnEndComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onendcomposition) will be called, respectively.</span></span>

<span data-ttu-id="adc54-129">Ниже приведена типичная процедура обновления документа с помощью композиции.</span><span class="sxs-lookup"><span data-stu-id="adc54-129">The following is a typical procedure to update a document using a composition.</span></span>

1.  <span data-ttu-id="adc54-130">[ITextStoreACP:: инсерттекстатселектион](/windows/desktop/api/Textstor/nf-textstor-itextstoreacp-inserttextatselection) или [Итекстстореанчор:: инсерттекстатселектион](/windows/desktop/api/Textstor/nf-textstor-itextstoreanchor-inserttextatselection) обычно используются для вставки исходного текста в композицию.</span><span class="sxs-lookup"><span data-stu-id="adc54-130">[ITextStoreACP::InsertTextAtSelection](/windows/desktop/api/Textstor/nf-textstor-itextstoreacp-inserttextatselection) or [ITextStoreAnchor::InsertTextAtSelection](/windows/desktop/api/Textstor/nf-textstor-itextstoreanchor-inserttextatselection) are typically used to insert the initial text into the composition.</span></span>
2.  <span data-ttu-id="adc54-131">Композиция начинается с вызова [итфконтексткомпоситион:: старткомпоситион](/windows/desktop/api/Msctf/nf-msctf-itfcontextcomposition-startcomposition)с использованием диапазона текста, возвращаемого **инсерттекстатселектион**.</span><span class="sxs-lookup"><span data-stu-id="adc54-131">The composition is started with a call to [ITfContextComposition::StartComposition](/windows/desktop/api/Msctf/nf-msctf-itfcontextcomposition-startcomposition), using the range of text returned by **InsertTextAtSelection**.</span></span>
3.  <span data-ttu-id="adc54-132">Когда он получает новые входные данные, такие как речь или ввод с клавиатуры, приложение обновляет композицию с помощью [ITextStoreACP:: SetText](/windows/desktop/api/Textstor/nf-textstor-itextstoreacp-settext) или [Итекстстореанчор:: SetText](/windows/desktop/api/Textstor/nf-textstor-itextstoreanchor-settext).</span><span class="sxs-lookup"><span data-stu-id="adc54-132">When it receives new input such as speech or keyboard entry, the application updates the composition with [ITextStoreACP::SetText](/windows/desktop/api/Textstor/nf-textstor-itextstoreacp-settext) or [ITextStoreAnchor::SetText](/windows/desktop/api/Textstor/nf-textstor-itextstoreanchor-settext).</span></span>
4.  <span data-ttu-id="adc54-133">Когда приложение определяет, что время окончания компоновки завершено, вызывается метод [итфкомпоситион:: ендкомпоситион](/windows/desktop/api/Msctf/nf-msctf-itfcomposition-endcomposition).</span><span class="sxs-lookup"><span data-stu-id="adc54-133">When the application determines that it is time to end the composition, it calls [ITfComposition::EndComposition](/windows/desktop/api/Msctf/nf-msctf-itfcomposition-endcomposition).</span></span>

<span data-ttu-id="adc54-134">Приложение должно использовать атрибуты экрана, предоставляемые службой текстового ввода, для изменения отображаемого текста в любое время, а не только в том случае, если композиция активна.</span><span class="sxs-lookup"><span data-stu-id="adc54-134">The application should use the display attributes provided by the text service to modify the display of text at all times and not just when a composition is active.</span></span> <span data-ttu-id="adc54-135">Дополнительные сведения см. [в разделе Использование атрибутов вывода](using-display-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="adc54-135">For more information, see [Using Display Attributes](using-display-attributes.md).</span></span>

<span data-ttu-id="adc54-136">При необходимости приложение может завершить композицию путем вызова [итфконтекстовнеркомпоситионсервицес:: терминатекомпоситион](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionservices-terminatecomposition).</span><span class="sxs-lookup"><span data-stu-id="adc54-136">If necessary, an application can terminate a composition by calling [ITfContextOwnerCompositionServices::TerminateComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionservices-terminatecomposition).</span></span>

 

 