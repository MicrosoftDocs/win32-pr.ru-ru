---
title: Сортировка результатов поиска с помощью IDirectorySearch
description: По умолчанию результаты поиска возвращаются в ненадежном порядке. Сеарчпреф, \_ \_ отсортированный \_ по параметру ADS, сообщает серверу о необходимости сортировки результирующего набора по указанному значению атрибута, прежде чем он будет возвращен клиенту.
ms.assetid: 1e44a572-7927-4fd5-a3eb-6dad0760d6e5
ms.tgt_platform: multiple
keywords:
- Сортировка результатов поиска с помощью IDirectorySearch
- ADSI, поиск, IDirectorySearch, другие параметры поиска, сортировка результатов поиска
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8433d24b06ac4d361d6520d8af3376ea12acac1f
ms.sourcegitcommit: b0ebdefc3dcd5c04bede94091833aa1015a2f95c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "103793830"
---
# <a name="sorting-the-search-results-with-idirectorysearch"></a>Сортировка результатов поиска с помощью IDirectorySearch

По умолчанию результаты поиска возвращаются в ненадежном порядке. **Сеарчпреф, \_ \_ отсортированный \_ по** параметру ADS, сообщает серверу о необходимости сортировки результирующего набора по указанному значению атрибута, прежде чем он будет возвращен клиенту.

Для сортировки рекомендуется использовать индексированные атрибуты. В противном случае сервер должен получить полный результирующий набор и отсортировать его перед отправкой результатов клиенту. Это также относится к страничным поисковым операциям. Имейте в виду, что производительность отсортированного поиска будет увеличена, если фильтр включает индексированный атрибут, и этот атрибут указан в качестве ключа сортировки. в этом случае Active Directory может удовлетворить сортировку при обработке фильтра. Например, эффективный запрос на сортировку для набора пользователей может иметь фильтр, который включается (SN>Смит) и ключ сортировки Sn.

Сортировка на стороне сервера с помощью параметра **ADS \_ сеарчпреф \_ Сортировать \_ по** поиску снизит производительность сервера. Если вы будете выполнять много операций поиска, рассмотрите возможность сортировки результатов вручную на стороне клиента, чтобы уменьшить рабочую нагрузку на сервер.

По умолчанию сортировка результатов отключена. Чтобы включить сортировку результатов, установите **параметр \_ сеарчпреф \_ Sort \_** by Search с **адстипе \_ Prov \_** , указывающий на структуру [**ADS \_**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) в массиве ADS, который передается в метод [**IDirectorySearch:: сетсеарчпреференце**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) . [**\_ \_**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) Структура **ADS \_ SORTKEY** используется для указания атрибута, по которому выполняется сортировка, и порядка сортировки.

В следующем примере кода показано, как включить сортировку результатов.


```C++
ADS_SORTKEY SortKey;
SortKey.pszAttrType = L"cn";
SortKey.pszReserved = NULL;
SortKey.fReverseorder = FALSE;

ADS_SEARCHPREF_INFO SearchPref;
SearchPref.dwSearchPref = ADS_SEARCHPREF_SORT_ON;
SearchPref.vValue.dwType = ADSTYPE_PROV_SPECIFIC;
SearchPref.vValue.ProviderSpecific.dwLength = sizeof(SortKey);
SearchPref.vValue.ProviderSpecific.lpValue = (LPBYTE)&SortKey;
```



Active Directory не поддерживает сортировку сконструированных атрибутов, поэтому невозможно указать сконструированный атрибут для сортировки. Атрибут [**distinguishedName**](/windows/desktop/ADSchema/a-distinguishedname) также нельзя использовать для сортировки. Active Directory также не допускает сортировку более чем по одному атрибуту, поэтому параметр **AD \_ сеарчпреф \_ Sort \_ On** Search может содержать только [**\_ одну структуру ADS**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) .

 

 