---
title: поиск с помощью объекты данных ActiveX (ADO)
description: модель объектов данных ActiveX (ADO) состоит из объектов, перечисленных в следующей таблице.
ms.assetid: 27298f53-a652-49f2-a6e6-d92c7c6022af
ms.tgt_platform: multiple
keywords:
- ActiveX Объекты данных ADSI, поиск с помощью ADO
- поиск с помощью объекты данных ActiveX ADSI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 52eba3dd5bc9013500aa4def7a31104d1408d4818b78a35ff75f09f2454f4d21
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119770454"
---
# <a name="searching-with-activex-data-objects-ado"></a>поиск с помощью объекты данных ActiveX (ADO)

модель объектов данных ActiveX (ADO) состоит из объектов, перечисленных в следующей таблице.



| Объект         | Описание                                                                                                                        |
|----------------|------------------------------------------------------------------------------------------------------------------------------------|
| **Соединение** | Открытое соединение с OLE DBным источником данных, например ADSI.                                                                          |
| **Команда**    | Определяет определенную команду для запуска в источнике данных.                                                                         |
| **Параметр**  | Необязательная коллекция для любых параметров, предоставляемых объекту Command.                                                        |
| **Записей**  | набор записей из таблицы, объекта команды или синтаксиса SQL. Набор записей может быть создан без базового объекта соединения. |
| **Поле**      | Один столбец данных в наборе записей.                                                                                            |
| **Свойство**   | Коллекция значений, предоставляемых поставщиком для ADO.                                                                           |
| **Ошибка**      | Содержит данные об ошибках доступа к данным. Обновляется при возникновении ошибки в одной операции.                                      |



 

Для взаимодействия ADO с ADSI необходимо, по крайней мере, два объекта ADO: **Connection** и **Recordset**. Эти объекты ADO служат для проверки подлинности пользователей и перечисления результатов соответственно. Как правило, для поддержания активного соединения также используется объект **Command** , укажите параметры запроса, такие как размер страницы и область поиска, и выполните запрос. Дополнительные сведения о синтаксисе фильтра поиска см. в разделе [синтаксис фильтра поиска](search-filter-syntax.md).

Объект **Connection** загружает поставщик OLE DB и проверяет учетные данные пользователя. в Visual Basic вызовите функцию **CreateObject** с помощью ADODB. Connection "для создания экземпляра объекта **Connection** , а затем для свойства **provider** объекта **Connection** устанавливается значение" адсдсубжект ". ADODB. Connection — идентификатор ProgID объекта **Connection** , а «адсдсубжект» — имя поставщика OLE DB в ADSI. Если учетные данные не указаны, используются учетные данные пользователя, выполнившего вход в систему.

В следующем примере кода показано, как создать экземпляр объекта **Connection** .


```VB
Set con = CreateObject("ADODB.Connection")
con.Provider = "ADsDSOObject"
```



В следующем примере кода показано, как создать экземпляр объекта **Connection** .


```VB
<%
Set con = Server.CreateObject("ADODB.Connection")
con.Provider = "ADsDSOObject"
%>
```



В следующем примере кода показано, как создать экземпляр объекта **Connection** . имейте в виду, что необходимо включить библиотеку типов ADO (msadoXX.dll) в качестве одной из ссылок в проекте Visual Basic.


```VB
Dim Con As New Connection
con.Provider = "ADsDSOObject"
```



Укажите данные проверки подлинности пользователя, задав свойства объекта **соединения** . В следующей таблице перечислены поддерживаемые в ADSI свойства проверки подлинности пользователя.



| Свойство           | Описание                                                                                                                                                                                                                                                                                                                                    |
|--------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| "Идентификатор пользователя"          | Строка, идентифицирующая пользователя, контекст безопасности которого используется при выполнении поиска. Дополнительные сведения о формате строки имени пользователя см. в разделе [**иадсопендсобжект:: опендсобжект**](/windows/desktop/api/Iads/nf-iads-iadsopendsobject-opendsobject). Если значение не указано, по умолчанию используется пользователь, выполнивший вход в систему, или пользователь, олицетворяющий вызывающий процесс. |
| "Пароль".         | Строка, указывающая пароль пользователя, определяемый "ИДЕНТИФИКАТОРом пользователя".                                                                                                                                                                                                                                                                      |
| "Зашифровать пароль" | Логическое значение, указывающее, зашифрован ли пароль. Значение по умолчанию — **false**.                                                                                                                                                                                                                                                    |
| "Флаг ADSI"        | Набор флагов из перечисления с [**\_ проверкой \_ подлинности ADS**](/windows/win32/api/iads/ne-iads-ads_authentication_enum) , задающих параметры проверки подлинности привязки. По умолчанию используется значение ноль.                                                                                                                                                                         |



 

В следующем примере кода показано, как свойства задаются перед созданием объекта **команды** .


```VB
Set oConnect = CreateObject("ADODB.Connection")
oConnect.Provider = "ADsDSOObject"
oConnect.Properties("User ID") = stUser
oConnect.Properties("Password") = stPass
oConnect.Properties("Encrypt Password") = True
oConnect.Open "DS Query", stUser, stPass
```



Второй объект ADO — это объект **Command** . ProgID объекта **команды** — ADODB. Command. Этот объект позволяет выдавать инструкции запросов и другие команды ADSI с помощью активного соединения. Объект **Command** использует свойство **ActiveConnection** для поддержания активного соединения. Он также поддерживает свойство **CommandText** для хранения инструкций запроса, выданных пользователем. инструкции запроса выражаются либо в [диалекте SQL](sql-dialect.md) , либо на [диалекте LDAP](ldap-dialect.md).

В следующих примерах кода показано, как создать объект **Command** .


```VB
Set command = CreateObject("ADODB.Command")
Set command.ActiveConnection = oConnect
command.CommandText = 
"SELECT AdsPath, cn FROM 'LDAP://DC=Fabrikam,DC=com' WHERE objectClass = '*'"
```



В следующем примере кода включите в качестве одной из ссылок библиотеку типов ADO (msadoXX.dll).


```VB
Dim command As New Command
Set command.ActiveConnection = oConnect
command.CommandText = "<LDAP://DC=Fabrikam,DC=com>;(objectClass=*);AdsPath, cn; subTree"
```



Параметры поиска для объекта **Command** задаются путем установки свойства **Properties** . В следующей таблице перечислены допустимые именованные свойства для **свойств**.



| Именованное свойство      | Описание                                                                                                                                                                                                                                                                                                                                                                                                    |
|---------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Асинхронной      | Логическое значение, указывающее, является ли поиск синхронным или асинхронным. Значение по умолчанию — false (синхронное). Синхронный поиск блокируется до тех пор, пока сервер не возвратит весь результат или для страничного поиска — всей страницы. Асинхронный поиск блокируется до тех пор, пока не будет доступна одна строка результатов поиска или пока не истечет время, заданное свойством Timeout.                           |
| "Результаты кэша"     | Логическое значение, указывающее, должен ли результат кэшироваться на стороне клиента. Значение по умолчанию — **true**; ADSI кэширует результирующий набор. Отключение этого параметра может оказаться желательным для больших результирующих наборов.                                                                                                                                                                                                    |
| "Следовать по ссылкам"   | Значение из [**объявления ADS \_ отслеживают \_ \_ перечисление ссылок**](/windows/win32/api/iads/ne-iads-ads_chase_referrals_enum) , которое указывает, как поиск осуществляется по ссылкам. По умолчанию **баннеры не имеют \_ \_ ссылок \_**. Дополнительные сведения об этом свойстве см. в разделе [ссылки](/windows/desktop/AD/referrals).<br/>                                                                                                                                           |
| "Только имена столбцов" | Логическое значение, указывающее, что при поиске должны извлекаться только имена атрибутов, которым были присвоены значения. Значение по умолчанию — **false**.                                                                                                                                                                                                                                                       |
| «Псевдонимы Deref»     | Логическое значение, указывающее, разрешены ли псевдонимы найденных объектов. Значение по умолчанию — **false**.                                                                                                                                                                                                                                                                                                        |
| "Размер страницы"         | Целочисленное значение, которое включает подкачку и указывает максимальное количество объектов, возвращаемых в результирующем наборе. По умолчанию размер страницы отсутствует. Дополнительные сведения см. в разделе [получение больших наборов результатов](retrieving-large-results-sets.md).                                                                                                                                                                       |
| SearchScope       | Значение из перечисления [**ADS \_ скопинум**](/windows/win32/api/iads/ne-iads-ads_scopeenum) , которое указывает область поиска. По умолчанию **используется \_ \_ поддерево области объявлений**.                                                                                                                                                                                                                                                                  |
| "Предельный размер"        | Целочисленное значение, указывающее предельный размер поиска. Для Active Directory ограничение размера определяет максимальное число возвращаемых объектов. Сервер прекращает поиск по достижении предельного размера и возвращает накопленные результаты. Значение по умолчанию не ограничено.                                                                                                                                  |
| "Сортировать по"           | Строка, указывающая список атрибутов с разделителями-запятыми для использования в качестве ключей сортировки. Это свойство работает только для серверов каталогов, поддерживающих элемент управления LDAP для сортировки на стороне сервера. Active Directory поддерживает элемент управления Sort, но он может повлиять на производительность сервера, особенно если результирующий набор имеет большой размер. Имейте в виду, что Active Directory поддерживает только один ключ сортировки. По умолчанию сортировка отсутствует. |
| "Предельное время"        | Целочисленное значение, указывающее предельное время в секундах для поиска. По достижении предельного времени сервер прекращает поиск и возвращает накопленные результаты. Значение по умолчанию — без ограничения по времени.                                                                                                                                                                                                      |
| Счетчик           | Целочисленное значение, указывающее значение времени ожидания на стороне клиента в секундах. Это значение указывает время ожидания клиентом результатов с сервера перед остановкой поиска. Значение по умолчанию — без времени ожидания.                                                                                                                                                                                                  |



 

В следующем примере кода показано, как задать параметры поиска.


```VB
Const ADS_SCOPE_ONELEVEL = 1
Const ADS_CHASE_REFERRALS_EXTERNAL = &H40

Dim Com As New Command
 
Com.Properties("Page Size") = 999
Com.Properties("Timeout") = 30     ' Seconds
Com.Properties("searchscope") = ADS_SCOPE_ONELEVEL
Com.Properties("Chase referrals") = ADS_CHASE_REFERRALS_EXTERNAL
Com.Properties("Cache Results") = False     ' Do not cache the result set.
```



Третьим объектом ADO является **набор записей**. Этот объект получается при вызове метода **EXECUTE** для объекта **Command** . Основной функцией объекта **Recordset** является перечисление результирующего набора и получение данных. Результирующий набор может содержать значения для атрибутов, имеющих как одно, так и несколько значений. Получение атрибута с одним значением является простым, аналогично получению значения столбца в реляционной базе данных, например:


```VB
Fields('name').Value
```



Однако получение атрибута с несколькими значениями является более сложной задачей. В этом случае **поле. Value** является массивом, и необходимо проверить нижнюю и верхнюю границы массива, как показано в следующем примере кода.


```VB
Set rs = Com.Execute
 
For i = 0 To rs.Fields.Count - 1
    Debug.Print rs.Fields(i).Name, rs.Fields(i).Type
Next i
 
'--------------------------
' Navigate the record set.
'--------------------------
rs.MoveFirst
lstResult.Clear      ' Clear the user interface.
While Not rs.EOF
For i = 0 To rs.Fields.Count - 1
    ' For Multi Value attribute
    If rs.Fields(i).Type = adVariant And Not (IsNull(rs.Fields(i).Value)) Then
        Debug.Print rs.Fields(i).Name, " = "
        For j = LBound(rs.Fields(i).Value) To UBound(rs.Fields(i).Value)
            Debug.Print rs.Fields(i).Value(j), " # "
            lstResult.AddItem rs.Fields(i).Value(j)
        Next j
    Else
        ' For Single Value attribute.
         Debug.Print rs.Fields(i).Name, " = ", rs.Fields(i).Value
         lstResult.AddItem rs.Fields(i).Value
    End If
Next i
rs.MoveNext
Wend
```



В следующем примере кода отключаются учетные записи пользователей на сервере LDAP.


```VB
Dim X as IADs
Dim con As New Connection, rs As New Recordset
Dim MyUser As IADsUser
 
con.Provider = "ADsDSOObject"
con.Open "Active Directory Provider", "CN=Test,CN=Users,DC=Fabrikam,DC=COM,O=INTERNET", "Password"
Set rs = con.Execute("<LDAP://MyMachine/DC=MyDomain,DC=Fabrikam,DC=com>;(objectClass=User);ADsPath;onelevel")
 
While Not rs.EOF
    ' Bind to the object to make changes 
    ' to it because ADO is currently read-only.
    MyUser = GetObject(rs.Fields(0).Value)
    MyUser.AccountDisabled = True
    MyUser.SetInfo
    rs.MoveNext
Wend
```



дополнительные сведения об объектной модели ADO см. в разделе [Microsoft объекты данных ActiveX](/sql/ado/microsoft-activex-data-objects-ado?view=sql-server-ver15).

 

