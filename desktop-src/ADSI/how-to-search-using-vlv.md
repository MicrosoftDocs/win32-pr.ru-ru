---
title: Поиск с помощью VLV
description: Active Directory поддерживает поиск в представлении виртуального списка (VLV). Этот стиль поиска специально предназначен для больших результирующих наборов и позволяет приложению отображать набор тысяч записей без необходимости получения каждой записи.
ms.assetid: fea04190-0846-4b62-99f4-7d8fb35fd510
ms.tgt_platform: multiple
keywords:
- Поиск с помощью VLV
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8f4a24250c8e54ccb7917f86b193152c62810b93
ms.sourcegitcommit: b0ebdefc3dcd5c04bede94091833aa1015a2f95c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "103987888"
---
# <a name="how-to-search-using-vlv"></a><span data-ttu-id="0e194-105">Поиск с помощью VLV</span><span class="sxs-lookup"><span data-stu-id="0e194-105">How to Search Using VLV</span></span>

<span data-ttu-id="0e194-106">Active Directory поддерживает поиск в представлении виртуального списка (VLV).</span><span class="sxs-lookup"><span data-stu-id="0e194-106">Active Directory supports virtual list view (VLV) searches.</span></span> <span data-ttu-id="0e194-107">Этот стиль поиска специально предназначен для больших результирующих наборов и позволяет приложению отображать набор тысяч записей без необходимости получения каждой записи.</span><span class="sxs-lookup"><span data-stu-id="0e194-107">This style of search is specifically designed for large result sets and enables an application to display a subset of thousands of entries without actually having to retrieve every entry.</span></span>

<span data-ttu-id="0e194-108">Существует два различных способа использования поиска VLV.</span><span class="sxs-lookup"><span data-stu-id="0e194-108">There are two distinct ways that a VLV search can be used.</span></span> <span data-ttu-id="0e194-109">Первый — получить атрибуты для определенных записей на основе числового смещения.</span><span class="sxs-lookup"><span data-stu-id="0e194-109">The first is to retrieve the attributes for particular entries based on a numeric offset.</span></span> <span data-ttu-id="0e194-110">Этот метод полезен при получении результатов поиска в ответ на операцию прокрутки.</span><span class="sxs-lookup"><span data-stu-id="0e194-110">This method is useful when retrieving search results in response to a scrolling operation.</span></span>

<span data-ttu-id="0e194-111">Второй способ использования поиска VLV — Поиск части или всего текстового атрибута и отображение результатов поиска.</span><span class="sxs-lookup"><span data-stu-id="0e194-111">The second way to use VLV searches is to search for part or all of a textual attribute and only display the results of the search.</span></span> <span data-ttu-id="0e194-112">Примером использования этой адресной книги является адресная книга.</span><span class="sxs-lookup"><span data-stu-id="0e194-112">An example usage of this is an address book.</span></span> <span data-ttu-id="0e194-113">Если пользователь вводит "s", то приложение может использовать поиск VLV для поиска записей с обычным именем, начинающимся с "s".</span><span class="sxs-lookup"><span data-stu-id="0e194-113">If the user types an "s", then the application can use a VLV search to search for entries that have a common-name that begins with "s".</span></span> <span data-ttu-id="0e194-114">Если затем пользователь добавляет "m" к "s", приложение может использовать другой поиск VLV для поиска записей с общим именем, начинающимся с "SM".</span><span class="sxs-lookup"><span data-stu-id="0e194-114">If the user then adds an "m" to the "s", the application can use another VLV search to search for entries that have a common-name that begins with "sm".</span></span>

<span data-ttu-id="0e194-115">Чтобы выполнить поиск VLV, попросите ADSI использовать элемент управления VLV.</span><span class="sxs-lookup"><span data-stu-id="0e194-115">To perform a VLV search, instruct ADSI to use the VLV control.</span></span> <span data-ttu-id="0e194-116">Для этого вызовите метод [**IDirectorySearch:: сетсеарчпреференце**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) с **рекламным \_ сеарчпреф \_ VLV** с параметром поиска **адстипе \_ Prov \_** .</span><span class="sxs-lookup"><span data-stu-id="0e194-116">To do this, call the [**IDirectorySearch::SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) method with an **ADS\_SEARCHPREF\_VLV** search option with an **ADSTYPE\_PROV\_SPECIFIC** value.</span></span> <span data-ttu-id="0e194-117">**\_ \_ Конкретное значение адстипе Prov** — это указатель на структуру [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) , которая содержит данные о поиске.</span><span class="sxs-lookup"><span data-stu-id="0e194-117">The **ADSTYPE\_PROV\_SPECIFIC** value is a pointer to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure that contains data about the search.</span></span> <span data-ttu-id="0e194-118">В примере функции [**жетвлвитемкаунт**](example-code-for-using-a-vlv-search.md) показано, как задать оба этих параметра поиска.</span><span class="sxs-lookup"><span data-stu-id="0e194-118">The [**GetVLVItemCount**](example-code-for-using-a-vlv-search.md) example function shows how to set both of these search preferences.</span></span>

<span data-ttu-id="0e194-119">Все поисковые запросы VLV должны использовать сортировку результатов на стороне сервера, которая выполняется путем установки параметра **AD \_ сеарчпреф \_ Sort \_ по** поиску.</span><span class="sxs-lookup"><span data-stu-id="0e194-119">All VLV searches must use server-side result sorting, which is performed by setting the **ADS\_SEARCHPREF\_SORT\_ON** search preference.</span></span> <span data-ttu-id="0e194-120">Дополнительные сведения о параметрах поиска **ADS \_ сеарчпреф \_ \_** см. в разделе [Сортировка результатов поиска с помощью IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span><span class="sxs-lookup"><span data-stu-id="0e194-120">For more information about the **ADS\_SEARCHPREF\_SORT\_ON** search preference, see [Sorting the Search Results with IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span></span>

<span data-ttu-id="0e194-121">При выполнении поиска VLV в столбце возвращается определенный объем метаданных, который извлекается путем вызова [**IDirectorySearch::**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) GetResponse с идентификатором **\_ \_ ответа VLV ADS** .</span><span class="sxs-lookup"><span data-stu-id="0e194-121">When a VLV search is performed, a certain amount of metadata about the search is returned in a column that is retrieved by calling [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with the **ADS\_VLV\_RESPONSE** identifier.</span></span> <span data-ttu-id="0e194-122">Эти данные содержатся в структуре [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="0e194-122">This data is contained in an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure.</span></span> <span data-ttu-id="0e194-123">Определенным уровнем важности являются члены **двконтенткаунт** и **лпконтекстид** .</span><span class="sxs-lookup"><span data-stu-id="0e194-123">Of particular importance are the **dwContentCount** and **lpContextID** members.</span></span> <span data-ttu-id="0e194-124">Элемент **двконтенткаунт** будет содержать количество результатов, удовлетворяющих критериям поиска VLV.</span><span class="sxs-lookup"><span data-stu-id="0e194-124">The **dwContentCount** member will contain the number of results that meet the VLV search criteria.</span></span> <span data-ttu-id="0e194-125">Это значение можно использовать в качестве оценки общего числа элементов, которые будут возвращены для поиска этого типа.</span><span class="sxs-lookup"><span data-stu-id="0e194-125">This value can be used as an estimate of the total number of items that would be returned for a search of that type.</span></span> <span data-ttu-id="0e194-126">Элемент **лпконтекстид** содержит определяемое сервером значение, которое может быть передано следующему поиску для определения поиска.</span><span class="sxs-lookup"><span data-stu-id="0e194-126">The **lpContextID** member contains a server-defined value that can be passed to the next search to identify the search.</span></span> <span data-ttu-id="0e194-127">Использование **лпконтекстид** может повысить производительность поиска.</span><span class="sxs-lookup"><span data-stu-id="0e194-127">Using the **lpContextID** can enhance the search performance.</span></span> <span data-ttu-id="0e194-128">Имейте в виду, что **лпконтекстид** является определяемым сервером значением и его длина содержится в элементе **двконтекстидленгс** .</span><span class="sxs-lookup"><span data-stu-id="0e194-128">Be aware that the **lpContextID** is a server-defined value and its length is contained in the **dwContextIDLength** member.</span></span> <span data-ttu-id="0e194-129">Этот буфер освобождается при вызове метода [**IDirectorySearch:: фриколумн**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-freecolumn) , поэтому вызывающий объект должен выделить буфер соответствующего размера, скопировать и сохранить содержимое буфера между операциями поиска.</span><span class="sxs-lookup"><span data-stu-id="0e194-129">This buffer is freed when the [**IDirectorySearch::FreeColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-freecolumn) method is called, so the caller must allocate a buffer of the appropriate size and copy and save the contents of the buffer between searches.</span></span>

<span data-ttu-id="0e194-130">Дополнительные сведения об элементе управления VLV LDAP см. [в разделе Поиск с помощью элемента управления LDAP VLV](/previous-versions/windows/desktop/ldap/searching-with-the-ldap-vlv-control).</span><span class="sxs-lookup"><span data-stu-id="0e194-130">For more information about the LDAP VLV control, see [Searching with the LDAP VLV Control](/previous-versions/windows/desktop/ldap/searching-with-the-ldap-vlv-control).</span></span>

<span data-ttu-id="0e194-131">Дополнительные сведения можно найти в разделе</span><span class="sxs-lookup"><span data-stu-id="0e194-131">For more information, see:</span></span>

-   <span data-ttu-id="0e194-132">Получение количества элементов</span><span class="sxs-lookup"><span data-stu-id="0e194-132">Obtaining the Number of Items</span></span>
-   <span data-ttu-id="0e194-133">Поиск по смещению</span><span class="sxs-lookup"><span data-stu-id="0e194-133">Searching by Offset</span></span>
-   <span data-ttu-id="0e194-134">Поиск по строке</span><span class="sxs-lookup"><span data-stu-id="0e194-134">Searching by String</span></span>
-   [<span data-ttu-id="0e194-135">Пример кода для использования поиска VLV</span><span class="sxs-lookup"><span data-stu-id="0e194-135">Example Code for Using a VLV Search</span></span>](example-code-for-using-a-vlv-search.md)

## <a name="obtaining-the-number-of-items"></a><span data-ttu-id="0e194-136">Получение количества элементов</span><span class="sxs-lookup"><span data-stu-id="0e194-136">Obtaining the Number of Items</span></span>

<span data-ttu-id="0e194-137">**Чтобы получить оценку количества элементов, которые будут возвращены для конкретного поиска, выполните следующие действия.**</span><span class="sxs-lookup"><span data-stu-id="0e194-137">**To obtain an estimate of the number of items that will be returned for a particular search, perform the following steps.**</span></span>

1.  <span data-ttu-id="0e194-138">Заполните структуру [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) значениями, имеющими нулевое значение или значения **null** .</span><span class="sxs-lookup"><span data-stu-id="0e194-138">Fill an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure with all zero or **NULL** values.</span></span>
2.  <span data-ttu-id="0e194-139">Заполните [**баннерную \_ \_ информацию сеарчпреф**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) со следующими значениями.</span><span class="sxs-lookup"><span data-stu-id="0e194-139">Fill an [**ADS\_SEARCHPREF\_INFO**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) with the following values.</span></span>

    -   <span data-ttu-id="0e194-140">Установите элемент **двсеарчпреф** в **ADS \_ сеарчпреф \_ VLV**.</span><span class="sxs-lookup"><span data-stu-id="0e194-140">Set the **dwSearchPref** member to **ADS\_SEARCHPREF\_VLV**.</span></span>
    -   <span data-ttu-id="0e194-141">Задайте для элемента **управляемое vValue. двтипе** значение **адстипе \_ Prov \_**.</span><span class="sxs-lookup"><span data-stu-id="0e194-141">Set the **vValue.dwType** member to **ADSTYPE\_PROV\_SPECIFIC**.</span></span>
    -   <span data-ttu-id="0e194-142">Задайте для элемента **управляемое vValue. провидерспеЦифик. двленгс** размер структуры [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="0e194-142">Set the **vValue.ProviderSpecific.dwLength** member to the size of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure.</span></span>
    -   <span data-ttu-id="0e194-143">Присвойте элементу **управляемое vValue. провидерспеЦифик. лпвалуе** адрес структуры [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) из шага 1.</span><span class="sxs-lookup"><span data-stu-id="0e194-143">Set the **vValue.ProviderSpecific.lpValue** member to the address of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure from Step 1.</span></span>

3.  <span data-ttu-id="0e194-144">Заполните структуру [**ADS \_**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) , как показано в [поле Сортировка результатов поиска по IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md) для сортировки по нужному атрибуту.</span><span class="sxs-lookup"><span data-stu-id="0e194-144">Fill an [**ADS\_SORTKEY**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) structure as shown in [Sorting the Search Results with IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md) to sort on the desired attribute.</span></span>
4.  <span data-ttu-id="0e194-145">Заполните еще одну [**рекламу \_ сеарчпреф \_ сведения**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) , чтобы добавить структуру [**ADS \_**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) в параметры поиска, как показано в разделе [Сортировка результатов поиска с помощью IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span><span class="sxs-lookup"><span data-stu-id="0e194-145">Fill another [**ADS\_SEARCHPREF\_INFO**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) to add the [**ADS\_SORTKEY**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) structure to the search preferences as shown in [Sorting the Search Results with IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span></span>
5.  <span data-ttu-id="0e194-146">Добавьте другие необходимые параметры поиска и вызовите [**IDirectorySearch:: сетсеарчпреференце**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) , чтобы задать параметры поиска.</span><span class="sxs-lookup"><span data-stu-id="0e194-146">Add any other desired search preferences and call [**IDirectorySearch::SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) to set the search preferences.</span></span>
6.  <span data-ttu-id="0e194-147">Выполните поиск с помощью [**IDirectorySearch:: ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span><span class="sxs-lookup"><span data-stu-id="0e194-147">Perform the search with [**IDirectorySearch::ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span></span>
7.  <span data-ttu-id="0e194-148">Получите первую строку результатов, вызвав [**IDirectorySearch:: жетфирстров**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span><span class="sxs-lookup"><span data-stu-id="0e194-148">Get the first row of results by calling [**IDirectorySearch::GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span></span>
8.  <span data-ttu-id="0e194-149">Чтобы получить метаданные для поиска VLV, вызовите [**IDirectorySearch::**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) GetResponse с **ADS \_ VLV \_ Response** .</span><span class="sxs-lookup"><span data-stu-id="0e194-149">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with **ADS\_VLV\_RESPONSE** to obtain the VLV search metadata.</span></span>
9.  <span data-ttu-id="0e194-150">Приведите **падсвалуес->провидерспеЦифик. лпвалуе** структуры [**\_ \_ столбцов поиска ADS**](/windows/desktop/api/Iads/ns-iads-ads_search_column) к указателю [**\_ VLV структуры ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="0e194-150">Cast the **pADsValues->ProviderSpecific.lpValue** of the [**ADS\_SEARCH\_COLUMN**](/windows/desktop/api/Iads/ns-iads-ads_search_column) structure to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure pointer.</span></span> <span data-ttu-id="0e194-151">Элемент **двконтенткаунт** этой структуры **ADS \_ VLV** содержит приблизительное количество элементов, возвращаемых при поиске этого типа.</span><span class="sxs-lookup"><span data-stu-id="0e194-151">The **dwContentCount** member of this **ADS\_VLV** structure contains the approximate number of items that would be returned by a search of that type.</span></span>
10. <span data-ttu-id="0e194-152">Если будут выполнены другие VLV Поиск одного и того же типа, создайте копию данных **лпконтекстид** и сохраните их для следующего поиска VLV.</span><span class="sxs-lookup"><span data-stu-id="0e194-152">If other VLV searches of the same type will be performed, make a copy of the **lpContextID** data and preserve it for the next VLV search.</span></span>

<span data-ttu-id="0e194-153">В примере функции [**жетвлвитемкаунт**](example-code-for-using-a-vlv-search.md) показано, как это сделать.</span><span class="sxs-lookup"><span data-stu-id="0e194-153">The [**GetVLVItemCount**](example-code-for-using-a-vlv-search.md) example function shows how to do this.</span></span>

## <a name="searching-by-offset"></a><span data-ttu-id="0e194-154">Поиск по смещению</span><span class="sxs-lookup"><span data-stu-id="0e194-154">Searching by Offset</span></span>

<span data-ttu-id="0e194-155">Одна из целей, которая делает поиск VLV настолько быстро, что можно искать конкретный результат по числовому смещению.</span><span class="sxs-lookup"><span data-stu-id="0e194-155">One thing that makes VLV searches so quick is that it is possible to search for a specific result by a numerical offset.</span></span> <span data-ttu-id="0e194-156">Например, если поиск приведет к возвращению 10 000 элементов, VLV Поиск позволяет получить информацию приблизительно для элемента 4072nd, не извлекая все элементы до того, как элемент найден.</span><span class="sxs-lookup"><span data-stu-id="0e194-156">For example, if a search would result in 10,000 items being returned, a VLV search makes it possible to obtain the information for approximately the 4072nd item without having to retrieve all of the items before the item in question.</span></span>

<span data-ttu-id="0e194-157">Смещения задаются как отношение между смещением и числом содержимого.</span><span class="sxs-lookup"><span data-stu-id="0e194-157">Offsets are specified as a ratio between the offset and the content count.</span></span> <span data-ttu-id="0e194-158">Соотношение полезно, поскольку сервер может не иметь точной оценки количества записей, существующих в списке, или размер списка может измениться во время его обзора пользователем.</span><span class="sxs-lookup"><span data-stu-id="0e194-158">Ratios are useful because the server may not have an accurate estimate of the number of entries that exist in the list or the list size may be changing during the time the user is browsing it.</span></span> <span data-ttu-id="0e194-159">Поскольку необходимо указать начало и конец списка, можно использовать оценочное значение количества содержимого в первом поисковом запросе, а также значение смещения.</span><span class="sxs-lookup"><span data-stu-id="0e194-159">Because you must indicate the beginning and end of the list, you can use an estimated value for the content count in the first search request, along with an offset value.</span></span> <span data-ttu-id="0e194-160">Сервер использует эти данные для вычисления соответствующих смещений в списке, исходя из его представления о количестве содержимого, которое отправляется в ответ на клиент через элемент **двконтенткаунт** структуры [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="0e194-160">The server uses this data to compute the corresponding offsets within the list, based on its idea of content count, which is sent in its response to the client through the **dwContentCount** member of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure.</span></span> <span data-ttu-id="0e194-161">Например, если вы оцениваете размер списка как 3000 и хотите, чтобы смещение было введено в список 1500, задайте для **двконтенткаунт** значение 3000, а для **двоффсет** — значение 1500.</span><span class="sxs-lookup"><span data-stu-id="0e194-161">For example, if you estimate the list size to be 3000, and you want the offset to be list entry 1500, you would set **dwContentCount** to 3000 and **dwOffset** to 1500.</span></span> <span data-ttu-id="0e194-162">Если сервер считает реальный размер списка равным 4500, он повторно вычислит смещение до 2250 и возвратит новые оценки в **двконтенткаунт** и **двоффсет**.</span><span class="sxs-lookup"><span data-stu-id="0e194-162">If the server estimates the actual list size to be 4500, it will recalculate the offset to 2250, and return the new estimates in **dwContentCount** and **dwOffset**.</span></span>

> [!Note]
>
> <span data-ttu-id="0e194-163">Все числовые значения в VLV поиска являются приближениями и не должны использоваться для абсолютных значений.</span><span class="sxs-lookup"><span data-stu-id="0e194-163">All of the numeric values in a VLV search are approximations and should not be used for absolute values.</span></span> <span data-ttu-id="0e194-164">Например, если вы выдаете VLV Поиск 50-й позиции в ъявлению из 100, вы не гарантируете получение точного среднего элемента.</span><span class="sxs-lookup"><span data-stu-id="0e194-164">For example, if you issue a VLV search for the 50th item in a ration of 100, you are not guaranteed to get the exact middle item.</span></span>
>
> <span data-ttu-id="0e194-165">**Чтобы найти конкретный элемент по смещению, выполните следующие действия.**</span><span class="sxs-lookup"><span data-stu-id="0e194-165">**To search for a particular item by offset, perform the following steps.**</span></span>
>
> 1.  <span data-ttu-id="0e194-166">Заполните структуру [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) следующими значениями.</span><span class="sxs-lookup"><span data-stu-id="0e194-166">Fill an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure with the following values.</span></span> <span data-ttu-id="0e194-167">Дополнительные члены структуры должны иметь нулевое значение или **значение NULL**.</span><span class="sxs-lookup"><span data-stu-id="0e194-167">Additional members of the structure should be set to zero or **NULL**.</span></span>
>
>     -   <span data-ttu-id="0e194-168">Задайте для элемента **двконтенткаунт** максимальное значение соотношения извлекаемых элементов.</span><span class="sxs-lookup"><span data-stu-id="0e194-168">Set the **dwContentCount** member to the maximum value of the ratio of items to retrieve.</span></span>
>     -   <span data-ttu-id="0e194-169">Присвойте элементу **двоффсет** отношение к соотношениям (относительно **двконтенткаунт**) элемента или элементов для извлечения.</span><span class="sxs-lookup"><span data-stu-id="0e194-169">Set the **dwOffset** member to the ratio, relative to **dwContentCount**, of the item or items to retrieve.</span></span>
>     -   <span data-ttu-id="0e194-170">Задайте для элемента **лпконтекстид** адрес копии буфера идентификаторов контекста и **двконтекстидленгс** , чтобы длина буфера идентификатора контекста в байтах была равна.</span><span class="sxs-lookup"><span data-stu-id="0e194-170">Set the **lpContextID** member to the address of the copy of the context ID buffer and the **dwContextIDLength** to the length, in bytes, of the context ID buffer.</span></span> <span data-ttu-id="0e194-171">Если идентификатор контекста не был сохранен, оба эти элемента должны быть равны нулю или **null**.</span><span class="sxs-lookup"><span data-stu-id="0e194-171">If no context ID has been saved, both of the these members should be zero or **NULL**.</span></span>
>
> 2.  <span data-ttu-id="0e194-172">Задайте параметры поиска, как показано в шагах 2 – 5 раздела Получение числа элементов.</span><span class="sxs-lookup"><span data-stu-id="0e194-172">Set the search preferences as shown in Steps 2 through 5 of the Obtaining the Number of Items procedure.</span></span>
> 3.  <span data-ttu-id="0e194-173">Выполните поиск с помощью [**IDirectorySearch:: ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span><span class="sxs-lookup"><span data-stu-id="0e194-173">Perform the search with [**IDirectorySearch::ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span></span>
> 4.  <span data-ttu-id="0e194-174">Получите первую строку результатов, вызвав [**IDirectorySearch:: жетфирстров**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span><span class="sxs-lookup"><span data-stu-id="0e194-174">Get the first row of results by calling [**IDirectorySearch::GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span></span>
> 5.  <span data-ttu-id="0e194-175">Вызовите [**IDirectorySearch:: DataColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) с именем атрибута, который необходимо получить, чтобы получить фактические данные для запрошенного элемента.</span><span class="sxs-lookup"><span data-stu-id="0e194-175">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with the name of the attribute to retrieve to get the actual data for the requested item.</span></span>
> 6.  <span data-ttu-id="0e194-176">Чтобы получить метаданные для поиска VLV, вызовите [**IDirectorySearch::**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) GetResponse с **ADS \_ VLV \_ Response** .</span><span class="sxs-lookup"><span data-stu-id="0e194-176">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with **ADS\_VLV\_RESPONSE** to obtain the VLV search metadata.</span></span>
> 7.  <span data-ttu-id="0e194-177">Приведите **падсвалуес->провидерспеЦифик. лпвалуе** структуры [**\_ \_ столбцов поиска ADS**](/windows/desktop/api/Iads/ns-iads-ads_search_column) к указателю [**\_ VLV структуры ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="0e194-177">Cast the **pADsValues->ProviderSpecific.lpValue** of the [**ADS\_SEARCH\_COLUMN**](/windows/desktop/api/Iads/ns-iads-ads_search_column) structure to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure pointer.</span></span>
> 8.  <span data-ttu-id="0e194-178">Создайте копию данных **лпконтекстид** и сохраните ее для следующего поиска VLV.</span><span class="sxs-lookup"><span data-stu-id="0e194-178">Make a copy of the **lpContextID** data and preserve it for the next VLV search.</span></span>

 

<span data-ttu-id="0e194-179">В примере функции [**жетвлвитемтекст**](example-code-for-using-a-vlv-search.md) показано, как это сделать.</span><span class="sxs-lookup"><span data-stu-id="0e194-179">The [**GetVLVItemText**](example-code-for-using-a-vlv-search.md) example function shows how to do this.</span></span>

<span data-ttu-id="0e194-180">Кроме того, можно получить несколько строк данных с помощью одного вызова поиска.</span><span class="sxs-lookup"><span data-stu-id="0e194-180">It is also possible to retrieve more than one row of data with a single search call.</span></span> <span data-ttu-id="0e194-181">Это делается на шаге 1, настроив элементы **двбефорекаунт** и **двафтеркаунт** структуры [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="0e194-181">This is done in Step 1 by setting the **dwBeforeCount** and **dwAfterCount** members of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure appropriately.</span></span> <span data-ttu-id="0e194-182">Элемент **двбефорекаунт** содержит количество элементов, отображаемых в списке до элемента, а элемент **двафтеркаунт** содержит число элементов, которые отображаются в списке после того, как заданный элемент.</span><span class="sxs-lookup"><span data-stu-id="0e194-182">The **dwBeforeCount** member contains the number of items that appear in the list prior to the item in question and the **dwAfterCount** member contains the number of items that appear in the list after to the item in question.</span></span> <span data-ttu-id="0e194-183">Оба эти счетчика исключают сам элемент, поэтому при установке **двбефорекаунт** в значение 10, а **двафтеркаунт** — в 10, возвращается всего 21 элемент.</span><span class="sxs-lookup"><span data-stu-id="0e194-183">Both of these counts exclude the item itself, so setting **dwBeforeCount** to 10 and **dwAfterCount** to 10 will result in a total of 21 items returned.</span></span> <span data-ttu-id="0e194-184">Этот параметр позволяет кэшировать результаты поиска на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="0e194-184">This option enables caching the search results on the client side.</span></span>

## <a name="searching-by-string"></a><span data-ttu-id="0e194-185">Поиск по строке</span><span class="sxs-lookup"><span data-stu-id="0e194-185">Searching by String</span></span>

<span data-ttu-id="0e194-186">Можно также использовать поиск VLV, чтобы найти элементы, имеющие строковый атрибут, значение которого совпадает со всем или частью строки без извлечения всех элементов.</span><span class="sxs-lookup"><span data-stu-id="0e194-186">It is also possible to use a VLV search to find items that have a string attribute whose value matches all or part of a string without having to retrieve all items.</span></span> <span data-ttu-id="0e194-187">Сопоставление строк выполняется по атрибуту, указанному в структуре [**ADS \_**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) в области **объявлений \_ сеарчпреф \_ Sort \_ по** параметрам поиска.</span><span class="sxs-lookup"><span data-stu-id="0e194-187">The string matching is performed against the attribute specified in the [**ADS\_SORTKEY**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) structure of the **ADS\_SEARCHPREF\_SORT\_ON** search preference.</span></span>

<span data-ttu-id="0e194-188">**Чтобы найти конкретный элемент по строке, выполните следующие действия.**</span><span class="sxs-lookup"><span data-stu-id="0e194-188">**To search for a particular item by string, perform the following steps.**</span></span>

1.  <span data-ttu-id="0e194-189">Заполните структуру [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) следующими значениями.</span><span class="sxs-lookup"><span data-stu-id="0e194-189">Fill an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure with the following values.</span></span> <span data-ttu-id="0e194-190">Дополнительные члены структуры должны иметь нулевое значение или **значение NULL**.</span><span class="sxs-lookup"><span data-stu-id="0e194-190">Additional members of the structure should be set to zero or **NULL**.</span></span>

    -   <span data-ttu-id="0e194-191">Присвойте элементу **псзтаржет** указатель на строку, завершающуюся нулем, которая содержит строку для поиска.</span><span class="sxs-lookup"><span data-stu-id="0e194-191">Set the **pszTarget** member to a pointer to a NULL-terminated string that contains the string to search for.</span></span>
    -   <span data-ttu-id="0e194-192">Задайте для элемента **лпконтекстид** адрес копии буфера идентификаторов контекста и **двконтекстидленгс** , чтобы длина буфера идентификатора контекста в байтах была равна.</span><span class="sxs-lookup"><span data-stu-id="0e194-192">Set the **lpContextID** member to the address of the copy of the context ID buffer and the **dwContextIDLength** to the length, in bytes, of the context ID buffer.</span></span> <span data-ttu-id="0e194-193">Если идентификатор контекста не был сохранен, оба эти элемента должны быть равны нулю или **null**.</span><span class="sxs-lookup"><span data-stu-id="0e194-193">If no context ID has been saved, both of the these members should be zero or **NULL**.</span></span>

2.  <span data-ttu-id="0e194-194">Задайте параметры поиска, как показано в шагах 2 – 5 раздела Получение числа элементов.</span><span class="sxs-lookup"><span data-stu-id="0e194-194">Set the search preferences as shown in Steps 2 through 5 of the Obtaining the Number of Items procedure.</span></span>
3.  <span data-ttu-id="0e194-195">Выполните поиск с помощью [**IDirectorySearch:: ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span><span class="sxs-lookup"><span data-stu-id="0e194-195">Perform the search with [**IDirectorySearch::ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span></span>
4.  <span data-ttu-id="0e194-196">Получите первую строку результатов, вызвав [**IDirectorySearch:: жетфирстров**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span><span class="sxs-lookup"><span data-stu-id="0e194-196">Get the first row of results by calling [**IDirectorySearch::GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span></span>
5.  <span data-ttu-id="0e194-197">Вызовите [**IDirectorySearch:: DataColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) с именем атрибута, который необходимо получить, чтобы получить фактические данные для запрошенного элемента.</span><span class="sxs-lookup"><span data-stu-id="0e194-197">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with the name of the attribute to retrieve to get the actual data for the requested item.</span></span>
6.  <span data-ttu-id="0e194-198">Чтобы получить метаданные для поиска VLV, вызовите [**IDirectorySearch::**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) GetResponse с **ADS \_ VLV \_ Response** .</span><span class="sxs-lookup"><span data-stu-id="0e194-198">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with **ADS\_VLV\_RESPONSE** to obtain the VLV search metadata.</span></span>
7.  <span data-ttu-id="0e194-199">Приведите **падсвалуес->провидерспеЦифик. лпвалуе** структуры [**\_ \_ столбцов поиска ADS**](/windows/desktop/api/Iads/ns-iads-ads_search_column) к указателю [**\_ VLV структуры ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="0e194-199">Cast the **pADsValues->ProviderSpecific.lpValue** of the [**ADS\_SEARCH\_COLUMN**](/windows/desktop/api/Iads/ns-iads-ads_search_column) structure to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure pointer.</span></span>
8.  <span data-ttu-id="0e194-200">Создайте копию данных **лпконтекстид** и сохраните ее для следующего поиска VLV.</span><span class="sxs-lookup"><span data-stu-id="0e194-200">Make a copy of the **lpContextID** data and preserve it for the next VLV search.</span></span> <span data-ttu-id="0e194-201">При необходимости элемент **двоффсет** содержит Отсчитываемый от единицы индекс первого элемента, атрибут String которого начинается со значения, указанного в **псзтаржет**.</span><span class="sxs-lookup"><span data-stu-id="0e194-201">If required, the **dwOffset** member contains the one-based index of the first item whose string attribute begins with the value specified in **pszTarget**.</span></span>

<span data-ttu-id="0e194-202">В примере функции [**жетвлвитемсбистринг**](example-code-for-using-a-vlv-search.md) показано, как это сделать.</span><span class="sxs-lookup"><span data-stu-id="0e194-202">The [**GetVLVItemsByString**](example-code-for-using-a-vlv-search.md) example function shows how to do this.</span></span>

<span data-ttu-id="0e194-203">Аналогично поиску по индексу можно также получить более одной строки данных с помощью одного вызова поиска.</span><span class="sxs-lookup"><span data-stu-id="0e194-203">Similarly to searching by index, it is also possible to retrieve more than one row of data with a single search call.</span></span> <span data-ttu-id="0e194-204">Это выполняется таким же образом путем установки элементов **двбефорекаунт** и **двафтеркаунт** структуры [**ADS \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="0e194-204">This is accomplished in the same manner by setting the **dwBeforeCount** and **dwAfterCount** members of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure appropriately.</span></span>

 

 