---
title: Общие сведения о коде
description: На следующем рисунке представлено концептуальное представление блоков кода, необходимых для реализации компонента поставщика в примере ADSI.
ms.assetid: b353c2d9-ef86-4e4c-ac00-4756fc9ec57d
ms.tgt_platform: multiple
keywords:
- Обзор кода Active Directory
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e99a4974ac97488fc051ea80dbde7a8a83fa329e
ms.sourcegitcommit: b0ebdefc3dcd5c04bede94091833aa1015a2f95c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "104070624"
---
# <a name="code-overview"></a><span data-ttu-id="c0914-104">Общие сведения о коде</span><span class="sxs-lookup"><span data-stu-id="c0914-104">Code Overview</span></span>

<span data-ttu-id="c0914-105">На следующем рисунке представлено концептуальное представление блоков кода, необходимых для реализации компонента поставщика в примере ADSI.</span><span class="sxs-lookup"><span data-stu-id="c0914-105">The following figure is a conceptual representation of the blocks of code necessary to implement the ADSI example provider component.</span></span> <span data-ttu-id="c0914-106">Каждый раздел описан на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="c0914-106">Each section is described in the following figure.</span></span> <span data-ttu-id="c0914-107">Опытные программисты COM могут обнаружить, что это будет подходящим обзором примера компонента поставщика.</span><span class="sxs-lookup"><span data-stu-id="c0914-107">Experienced COM programmers may find this is to be a suitable overview of the example provider component.</span></span> <span data-ttu-id="c0914-108">Дополнительные сведения см. в разделе [сведения о коде](code-details.md).</span><span class="sxs-lookup"><span data-stu-id="c0914-108">For more information, see [Code Details](code-details.md).</span></span>

![Пример реализации поставщика](images/dssmco.png)

<span data-ttu-id="c0914-110">Следующие нумерованные элементы соответствуют блочным элементам на рисунке.</span><span class="sxs-lookup"><span data-stu-id="c0914-110">The following numbered items correspond to block elements in the figure.</span></span>

1.  <span data-ttu-id="c0914-111">Загрузка библиотеки DLL (Либмаин. cpp, GUID. cpp).</span><span class="sxs-lookup"><span data-stu-id="c0914-111">Loading the DLL (Libmain.cpp, Guid.cpp).</span></span> <span data-ttu-id="c0914-112">Точка входа для библиотеки DLL.</span><span class="sxs-lookup"><span data-stu-id="c0914-112">The entry point for the DLL.</span></span> <span data-ttu-id="c0914-113">Определения статических объектов фабрики класса для двух объектов поставщика: GUID. cpp содержит определения CLSID для реализаций различных объектов компонента поставщика.</span><span class="sxs-lookup"><span data-stu-id="c0914-113">Class factory static object definitions for the two provider objects: Guid.cpp contains the CLSID definitions for the implementations of the various Example provider component objects.</span></span>
2.  <span data-ttu-id="c0914-114">Фабрика классов объектов поставщика и код создания (Кпровкф. cpp, Кпров. cpp, Стдфакт. cpp).</span><span class="sxs-lookup"><span data-stu-id="c0914-114">Provider object class factory and creation code (Cprovcf.cpp, Cprov.cpp, Stdfact.cpp).</span></span> <span data-ttu-id="c0914-115">Объект поставщика — это объект, который поддерживает [**ипарседисплайнаме**](/windows/win32/api/oleidl/nn-oleidl-iparsedisplayname) во время операций привязки моникера, как описано в разделе Поиск и привязка в примере компонента поставщика.</span><span class="sxs-lookup"><span data-stu-id="c0914-115">The provider object is the object that supports [**IParseDisplayName**](/windows/win32/api/oleidl/nn-oleidl-iparsedisplayname) during the moniker binding operations as discussed in Finding and Binding in the Example Provider Component.</span></span>
3.  <span data-ttu-id="c0914-116">Привязка к объекту (Жетобж. cpp).</span><span class="sxs-lookup"><span data-stu-id="c0914-116">Binding to an object (Getobj.cpp).</span></span> <span data-ttu-id="c0914-117">Этот код вызывает средство синтаксического анализа, чтобы проверить синтаксическую правильность заданного ADsPath, а затем выполняет все необходимое сопоставление из пути ADsPath с собственным путем к службе каталогов для создаваемого элемента как объекта Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c0914-117">This code calls the parser to check that the given ADsPath is syntactically correct, and then performs any necessary mapping from the ADsPath to the native directory service path for the item being created as an Active Directory object.</span></span> <span data-ttu-id="c0914-118">Он ищет определение схемы для этого типа объекта и заполняет обязательные свойства.</span><span class="sxs-lookup"><span data-stu-id="c0914-118">It looks up the schema definition for this type of object and fills in the mandatory properties.</span></span> <span data-ttu-id="c0914-119">После создания объекта Active Directory для вызывающей стороны извлекается указатель на интерфейс [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) .</span><span class="sxs-lookup"><span data-stu-id="c0914-119">After creating the Active Directory object, an interface pointer to [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) is retrieved for the caller.</span></span>
4.  <span data-ttu-id="c0914-120">Средство синтаксического анализа для пространства имен поставщика (Parse. cpp).</span><span class="sxs-lookup"><span data-stu-id="c0914-120">Parser for the provider namespace (Parse.cpp).</span></span> <span data-ttu-id="c0914-121">Это код, вызываемый элементом 3.</span><span class="sxs-lookup"><span data-stu-id="c0914-121">This is the code invoked by item 3.</span></span> <span data-ttu-id="c0914-122">Средство синтаксического анализа проверяет, что переданная строка ADsPath синтаксически правильна для своего собственного пространства имен.</span><span class="sxs-lookup"><span data-stu-id="c0914-122">The parser verifies that the ADsPath string passed in is syntactically correct for its own namespace.</span></span>
5.  <span data-ttu-id="c0914-123">Фабрика класса, создание и перечисление для объекта пространства имен (Кнамкф. cpp, Кнамесп. cpp, Ценумнс. cpp).</span><span class="sxs-lookup"><span data-stu-id="c0914-123">Class factory, creation, and enumeration for the namespace object (Cnamcf.cpp, Cnamesp.cpp, Cenumns.cpp).</span></span> <span data-ttu-id="c0914-124">Объект пространства имен — это объект контейнера, который можно перечислить, чтобы найти все объекты корневого узла для этого пространства имен.</span><span class="sxs-lookup"><span data-stu-id="c0914-124">The namespace object is a container object that can be enumerated to find all the root node objects for this namespace.</span></span>
6.  <span data-ttu-id="c0914-125">Фабрика классов и код создания для универсального Active Directoryного объекта, а фабрика класса, создание и перечисление кода для универсального объекта контейнера баннеров (Кженобж. cpp, Ценумобж. cpp, Common. cpp, Core. cpp).</span><span class="sxs-lookup"><span data-stu-id="c0914-125">Class factory and creation code for a generic Active Directory object, and class factory, creation and enumeration code for a generic ADs container object (Cgenobj.cpp, Cenumobj.cpp, Common.cpp, Core.cpp).</span></span> <span data-ttu-id="c0914-126">Этот код выполняется при создании объекта Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c0914-126">This code is executed when an Active Directory object is created.</span></span>
7.  <span data-ttu-id="c0914-127">Фильтрация и перечисление вариантов (Ценумвар. cpp, Object. cpp).</span><span class="sxs-lookup"><span data-stu-id="c0914-127">Filtering and enumerating VARIANTs (Cenumvar.cpp, Object.cpp).</span></span> <span data-ttu-id="c0914-128">Если коллекция ВАРИАТИВНЫХ элементов одного типа управляется в интерфейсе ADSI, используется этот код.</span><span class="sxs-lookup"><span data-stu-id="c0914-128">When a collection of VARIANT elements of a single type are managed in within ADSI, this code is used.</span></span>
8.  <span data-ttu-id="c0914-129">Глобальные (Globals. cpp).</span><span class="sxs-lookup"><span data-stu-id="c0914-129">Globals (Globals.cpp).</span></span> <span data-ttu-id="c0914-130">Ключевые слова пространства имен, структуры сопоставления синтаксиса из собственных форматов данных в тип VARIANT автоматизации ADs определяются здесь.</span><span class="sxs-lookup"><span data-stu-id="c0914-130">Namespace keywords, syntax mapping structures from native data formats to the ADs Automation VARIANT type are all defined here.</span></span>
9.  <span data-ttu-id="c0914-131">Маршалирование и распаковка данных (Pack. cpp, Property. cpp, Смпопер. cpp).</span><span class="sxs-lookup"><span data-stu-id="c0914-131">Marshaling/unmarshaling data (Pack.cpp, Property.cpp, Smpoper.cpp).</span></span> <span data-ttu-id="c0914-132">Преобразование из собственных форматов данных в поддерживаемый набор типов вариантов автоматизации происходит, когда свойства объекта загружаются в кэш свойств.</span><span class="sxs-lookup"><span data-stu-id="c0914-132">Conversion from native data formats to the supported set of Automation VARIANT types occurs when properties of an object are loaded into the property cache.</span></span> <span data-ttu-id="c0914-133">Другая специальная обработка данных должна выполняться при копировании, удалении или перемещении структур с указателями в памяти.</span><span class="sxs-lookup"><span data-stu-id="c0914-133">Other special handling for data must be performed when structures with pointers are copied, deleted, or moved in memory.</span></span>
10. <span data-ttu-id="c0914-134">Кэш свойств (Кпропс. cpp).</span><span class="sxs-lookup"><span data-stu-id="c0914-134">Property cache (Cprops.cpp).</span></span> <span data-ttu-id="c0914-135">Свойства кэширования — это функция среды ADSI.</span><span class="sxs-lookup"><span data-stu-id="c0914-135">Caching properties is a feature of the ADSI environment.</span></span> <span data-ttu-id="c0914-136">Методы [**iAds::**](/windows/desktop/api/Iads/nf-iads-iads-getinfo)жетинфоекс, [**iAds::**](/windows/desktop/api/Iads/nf-iads-iads-getinfoex)и [**iAds:: сетинфо**](/windows/desktop/api/Iads/nf-iads-iads-setinfo) действуют в кэше свойств.</span><span class="sxs-lookup"><span data-stu-id="c0914-136">The [**IADs::GetInfo**](/windows/desktop/api/Iads/nf-iads-iads-getinfo), [**IADs::GetInfoEx**](/windows/desktop/api/Iads/nf-iads-iads-getinfoex), and [**IADs::SetInfo**](/windows/desktop/api/Iads/nf-iads-iads-setinfo) methods act on the property cache.</span></span>
11. <span data-ttu-id="c0914-137">Управление памятью (память. cpp).</span><span class="sxs-lookup"><span data-stu-id="c0914-137">Memory management (Memory.cpp).</span></span> <span data-ttu-id="c0914-138">Использование одного набора функций памяти для выделения и освобождения памяти позволяет компоненту "пример поставщика" контролировать использование памяти и прекращать утечку памяти.</span><span class="sxs-lookup"><span data-stu-id="c0914-138">Using one set of memory functions to allocate and free memory allows the example provider component to track memory use and stop memory leaks.</span></span>
12. <span data-ttu-id="c0914-139">Объекты схемы и управление (Ксчобж. cpp, Кпрпобж. cpp, Кклсобж. cpp, Ценумсч. cpp).</span><span class="sxs-lookup"><span data-stu-id="c0914-139">Schema objects and management (Cschobj.cpp, Cprpobj.cpp, Cclsobj.cpp, Cenumsch.cpp).</span></span> <span data-ttu-id="c0914-140">Сюда входят подпрограммы для создания, управления и перечисления объектов схемы.</span><span class="sxs-lookup"><span data-stu-id="c0914-140">This includes routines to create, manage, and enumerate the schema objects.</span></span> <span data-ttu-id="c0914-141">В их число входят объекты классов схемы, объекты свойств и объекты синтаксиса, а также возможность перечисления объекта контейнера класса схемы.</span><span class="sxs-lookup"><span data-stu-id="c0914-141">This includes schema class objects, property objects, and syntax objects, in addition to being able to enumerate the schema class container object.</span></span>
13. <span data-ttu-id="c0914-142">Вызовы, относящиеся к операционной системе (Регдсапи. cpp).</span><span class="sxs-lookup"><span data-stu-id="c0914-142">Operating-system specific calls (RegDSAPI.cpp).</span></span> <span data-ttu-id="c0914-143">Сюда входят все вызовы, ссылающиеся на собственную операционную систему.</span><span class="sxs-lookup"><span data-stu-id="c0914-143">This includes all calls that reference the native operating system.</span></span> <span data-ttu-id="c0914-144">Среди прочих функций они включают в себя функции открытия, закрытия, чтения и изменения объектов, а также доступ к схеме и данным свойств.</span><span class="sxs-lookup"><span data-stu-id="c0914-144">Among other functions, they include functions opening, closing, reading, and modifying objects as well as those accessing the schema and property data.</span></span> <span data-ttu-id="c0914-145">В примере компонента поставщика произошло моделирование иерархии каталогов с помощью реестра.</span><span class="sxs-lookup"><span data-stu-id="c0914-145">The example provider component happened to simulate a directory hierarchy by using the registry.</span></span> <span data-ttu-id="c0914-146">Только имена функций должны быть значительными интересами для модуля записи поставщика.</span><span class="sxs-lookup"><span data-stu-id="c0914-146">Only function names should be of much interest to a provider writer.</span></span>
14. <span data-ttu-id="c0914-147">Реализация [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) (кдиспмгр. cpp).</span><span class="sxs-lookup"><span data-stu-id="c0914-147">[**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) implementation (Cdispmgr.cpp).</span></span> <span data-ttu-id="c0914-148">Этот код обращается к данным библиотеки типов, чтобы обеспечить возможность вызова методов интерфейса при автоматизации, совместимых с автоматизацией.</span><span class="sxs-lookup"><span data-stu-id="c0914-148">This code accesses the type library data to allow interface methods to be invoked in an Automation-compatible way.</span></span>

 

 