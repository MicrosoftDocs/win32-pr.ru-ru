---
title: Кэш фрагментов
description: API сервера HTTP предоставляет пользователям возможность хранить фрагменты данных в кэше для быстрого формирования HTTP-ответов.
ms.assetid: 0f9a768e-723c-4c7b-a746-6b817441409c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a3979fb03c4f8898644329fd27eafb7007adbcc9
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "103986264"
---
# <a name="fragment-cache"></a><span data-ttu-id="3daa7-103">Кэш фрагментов</span><span class="sxs-lookup"><span data-stu-id="3daa7-103">Fragment Cache</span></span>

<span data-ttu-id="3daa7-104">API сервера HTTP предоставляет пользователям возможность хранить фрагменты данных в кэше для быстрого формирования HTTP-ответов.</span><span class="sxs-lookup"><span data-stu-id="3daa7-104">The HTTP Server API provides functionality for users to store data fragments in a cache for use in rapidly forming HTTP responses.</span></span>

<span data-ttu-id="3daa7-105">Фрагменты можно добавить в кэш, вызвав функцию [**хттпаддфрагменттокаче**](/windows/desktop/api/Http/nf-http-httpaddfragmenttocache) .</span><span class="sxs-lookup"><span data-stu-id="3daa7-105">Fragments can be added to the cache by calling the [**HttpAddFragmentToCache**](/windows/desktop/api/Http/nf-http-httpaddfragmenttocache) function.</span></span> <span data-ttu-id="3daa7-106">Фрагмент определяется по URL-адресу, содержащемуся в параметре *пурлпрефикс* .</span><span class="sxs-lookup"><span data-stu-id="3daa7-106">A Fragment is identified by a URL contained in the *pUrlPrefix* parameter.</span></span> <span data-ttu-id="3daa7-107">Вызов этой функции с URL-адресом существующего фрагмента перезаписывает существующий фрагмент.</span><span class="sxs-lookup"><span data-stu-id="3daa7-107">A call to this function with the URL of an existing fragment overwrites the existing fragment.</span></span>

<span data-ttu-id="3daa7-108">Фрагмент может быть удален или перезаписан владельцем очереди запросов, которая изначально добавила фрагмент.</span><span class="sxs-lookup"><span data-stu-id="3daa7-108">A fragment can be deleted or overwritten by the owner of the request queue that initially added the fragment.</span></span> <span data-ttu-id="3daa7-109">Функция [**хттпфлушреспонсекаче**](/windows/desktop/api/Http/nf-http-httpflushresponsecache) , вызываемая с помощью UrlPrefix, удаляет все фрагменты внутри этого префикса, а также иерархические потомки этого UrlPrefix.</span><span class="sxs-lookup"><span data-stu-id="3daa7-109">The [**HttpFlushResponseCache**](/windows/desktop/api/Http/nf-http-httpflushresponsecache) function called with a UrlPrefix deletes all fragments within that prefix as well as the hierarchical descendants of that UrlPrefix.</span></span> <span data-ttu-id="3daa7-110">Функция [**хттпреадфрагментфромкаче**](/windows/desktop/api/Http/nf-http-httpreadfragmentfromcache) считывает весь фрагмент или указанный диапазон байтов внутри фрагмента.</span><span class="sxs-lookup"><span data-stu-id="3daa7-110">The [**HttpReadFragmentFromCache**](/windows/desktop/api/Http/nf-http-httpreadfragmentfromcache) function reads in the entire fragment or a specified byte range within the fragment.</span></span>

> [!Note]  
> <span data-ttu-id="3daa7-111">Добавление фрагмента в кэш не гарантирует, что он будет доступен для будущих вызовов для отправки ответа.</span><span class="sxs-lookup"><span data-stu-id="3daa7-111">Adding a fragment to the cache does not guarantee that it is available for future calls to send a response.</span></span> <span data-ttu-id="3daa7-112">Записи кэша фрагмента могут стать недоступными в любое время.</span><span class="sxs-lookup"><span data-stu-id="3daa7-112">Fragment cache entries can become unavailable at any time.</span></span> <span data-ttu-id="3daa7-113">Вызов, использующий недоступный фрагмент, завершается ошибкой.</span><span class="sxs-lookup"><span data-stu-id="3daa7-113">A call that uses a fragment that is not available fails.</span></span> <span data-ttu-id="3daa7-114">Приложения, использующие кэш фрагментов, должны быть готовы к обработке этого сбоя.</span><span class="sxs-lookup"><span data-stu-id="3daa7-114">Applications that use the fragment cache must be prepared to handle this failure.</span></span>

 

## <a name="sending-a-response-with-a-fragment"></a><span data-ttu-id="3daa7-115">Отправка ответа с помощью фрагмента</span><span class="sxs-lookup"><span data-stu-id="3daa7-115">Sending a Response With a Fragment</span></span>

<span data-ttu-id="3daa7-116">Фрагменты можно использовать для формирования всех или частей тела объекта ответов HTTP.</span><span class="sxs-lookup"><span data-stu-id="3daa7-116">Fragments can be used to form all or portions of an HTTP responses entity body.</span></span> <span data-ttu-id="3daa7-117">Вы можете отправить ответ и тело сущности в одном вызове функции [**хттпсендхттпреспонсе**](/windows/desktop/api/Http/nf-http-httpsendhttpresponse) , указав массив структур [**\_ \_ фрагментов данных HTTP**](/windows/desktop/api/Http/ns-http-http_data_chunk) в структуре [**HTTP- \_ ответа**](http-response.md) .</span><span class="sxs-lookup"><span data-stu-id="3daa7-117">You can send a response and entity body in one call to the [**HttpSendHttpResponse**](/windows/desktop/api/Http/nf-http-httpsendhttpresponse) function by specifying an array of [**HTTP\_DATA\_CHUNK**](/windows/desktop/api/Http/ns-http-http_data_chunk) structures in the [**HTTP\_RESPONSE**](http-response.md) structure.</span></span>

<span data-ttu-id="3daa7-118">[**\_ \_ Фрагмент данных HTTP**](/windows/desktop/api/Http/ns-http-http_data_chunk) может указывать блок памяти, обработчик для уже открытого файла или записи кэша фрагмента.</span><span class="sxs-lookup"><span data-stu-id="3daa7-118">An [**HTTP\_DATA\_CHUNK**](/windows/desktop/api/Http/ns-http-http_data_chunk) can specify a block of memory, a handle to an already opened file or a fragment cache entry.</span></span> <span data-ttu-id="3daa7-119">Они соответствуют типам **\_ \_ фрагментов данных HTTP** : **хттпдатачункфроммемори**, **хттпдатачункфромфилехандле** и **хттпдатачункфромфрагменткаче** соответственно.</span><span class="sxs-lookup"><span data-stu-id="3daa7-119">These correspond to the **HTTP\_DATA\_CHUNK** types: **HttpDataChunkFromMemory**, **HttpDataChunkFromFileHandle**, and **HttpDataChunkFromFragmentCache**, respectively.</span></span> <span data-ttu-id="3daa7-120">Полные ответы в кэше HTTP также могут использоваться в качестве фрагментов в структуре [**HTTP- \_ ответа**](http-response.md) , хотя это не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="3daa7-120">Full responses in the HTTP cache can also be used as fragments in the [**HTTP\_RESPONSE**](http-response.md) structure, although this practice is not recommended.</span></span>

<span data-ttu-id="3daa7-121">Структура [**\_ ответа HTTP**](http-response.md) содержит указатель на массив структур [**\_ \_ фрагментов данных HTTP**](/windows/desktop/api/Http/ns-http-http_data_chunk) , который состоит из текста сущности ответа.</span><span class="sxs-lookup"><span data-stu-id="3daa7-121">The [**HTTP\_RESPONSE**](http-response.md) structure contains a pointer to an array of [**HTTP\_DATA\_CHUNK**](/windows/desktop/api/Http/ns-http-http_data_chunk) structures that comprise the entity body of the response.</span></span> <span data-ttu-id="3daa7-122">Структура **\_ ответа HTTP** также содержит счетчик сопоставления, который указывает измерение массива структур **\_ \_ фрагментов данных HTTP** .</span><span class="sxs-lookup"><span data-stu-id="3daa7-122">The **HTTP\_RESPONSE** structure also contains a matching count which specifies the dimension of the array of **HTTP\_DATA\_CHUNK** structures.</span></span> <span data-ttu-id="3daa7-123">Значение Хттпдатачункфромфрагменткаче в структуре **\_ \_ фрагментов данных HTTP** указывает тип кэша фрагмента для фрагмента данных.</span><span class="sxs-lookup"><span data-stu-id="3daa7-123">The HttpDataChunkFromFragmentCache value in the **HTTP\_DATA\_CHUNK** structure specifies the fragment cache type of the data chunk.</span></span> <span data-ttu-id="3daa7-124">Структура **\_ \_ фрагмента данных HTTP** также указывает имя фрагмента.</span><span class="sxs-lookup"><span data-stu-id="3daa7-124">The **HTTP\_DATA\_CHUNK** structure also specifies the fragment name.</span></span>

<span data-ttu-id="3daa7-125">Ответ, содержащий кэшированный фрагмент, завершается с ошибкой \_ , \_ не \_ найденной, если какие-либо из записей кэша фрагментов недоступны.</span><span class="sxs-lookup"><span data-stu-id="3daa7-125">A response that contains a cached fragment fails with an ERROR\_PATH\_NOT\_FOUND if any of the fragment cache entries are not available.</span></span> <span data-ttu-id="3daa7-126">Так как записи кэша фрагментов не гарантированно доступны, приложения должны быть готовы к обработке этого случая.</span><span class="sxs-lookup"><span data-stu-id="3daa7-126">Since the fragment cache entries are not guaranteed to be available, applications must be prepared to handle this case.</span></span> <span data-ttu-id="3daa7-127">Одним из способов решения этой ситуации является попытка повторного добавления записи кэша фрагмента и повторная отправка ответа.</span><span class="sxs-lookup"><span data-stu-id="3daa7-127">One way to handle this case is to attempt to re-add the fragment cache entry and resend the response.</span></span> <span data-ttu-id="3daa7-128">При возникновении повторяющихся сбоев приложение может использовать блоки данных, хранящиеся в буферах памяти, а не записи кэша фрагментов.</span><span class="sxs-lookup"><span data-stu-id="3daa7-128">If repeated failures occur, the application can use data chunks stored in memory buffers instead of fragment cache entries.</span></span>

<span data-ttu-id="3daa7-129">Записи кэша фрагмента также можно указать в функции [**хттпсендреспонсинтитибоди**](/windows/desktop/api/Http/nf-http-httpsendresponseentitybody) .</span><span class="sxs-lookup"><span data-stu-id="3daa7-129">Fragment cache entries can also be specified in the [**HttpSendResponseEntityBody**](/windows/desktop/api/Http/nf-http-httpsendresponseentitybody) function.</span></span> <span data-ttu-id="3daa7-130">Фрагмент добавляется в тело сущности в структуре [**\_ \_ фрагмента данных HTTP**](/windows/desktop/api/Http/ns-http-http_data_chunk) , как описано выше.</span><span class="sxs-lookup"><span data-stu-id="3daa7-130">The fragment is added to the entity body in the [**HTTP\_DATA\_CHUNK**](/windows/desktop/api/Http/ns-http-http_data_chunk) structure as described above.</span></span> <span data-ttu-id="3daa7-131">Опять же, отправка может завершиться неудачей, если любая из указанных записей кэша фрагментов недоступна.</span><span class="sxs-lookup"><span data-stu-id="3daa7-131">Again, the send can fail if any of the specified fragment cache entries are not available.</span></span>

 

 




