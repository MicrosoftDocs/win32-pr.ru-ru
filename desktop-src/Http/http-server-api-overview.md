---
title: Общие сведения об API сервера HTTP
description: В этом разделе описывается типичная последовательность операций, использующих API-сервер HTTP.
ms.assetid: 1245fd98-8370-4f1b-8c86-de9be5e678bd
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5c99af3e4914c5496c2adea10b3ac658f75f3018
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "105681602"
---
# <a name="http-server-api-overview"></a><span data-ttu-id="4c5c8-103">Общие сведения об API сервера HTTP</span><span class="sxs-lookup"><span data-stu-id="4c5c8-103">HTTP Server API Overview</span></span>

<span data-ttu-id="4c5c8-104">В следующем списке приведена типичная последовательность операций, использующих API-сервер HTTP.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-104">The following list identifies a typical sequence of operations that use the HTTP Server API:</span></span>

-   <span data-ttu-id="4c5c8-105">Инициализируйте API HTTP-сервера с помощью функции [**хттпинитиализе**](/windows/desktop/api/Http/nf-http-httpinitialize) .</span><span class="sxs-lookup"><span data-stu-id="4c5c8-105">Initialize the HTTP Server API by using the [**HttpInitialize**](/windows/desktop/api/Http/nf-http-httpinitialize) function.</span></span>
-   <span data-ttu-id="4c5c8-106">Создайте очередь запросов с помощью функции [**хттпкреатехттфандле**](/windows/desktop/api/Http/nf-http-httpcreatehttphandle) .</span><span class="sxs-lookup"><span data-stu-id="4c5c8-106">Create a request queue by using the [**HttpCreateHttpHandle**](/windows/desktop/api/Http/nf-http-httpcreatehttphandle) function.</span></span>
-   <span data-ttu-id="4c5c8-107">Зарегистрируйте один или несколько URL-адресов с помощью функции [**хттпаддурл**](/windows/desktop/api/Http/nf-http-httpaddurl) .</span><span class="sxs-lookup"><span data-stu-id="4c5c8-107">Register one or more URLs by using the [**HttpAddUrl**](/windows/desktop/api/Http/nf-http-httpaddurl) function.</span></span>
-   <span data-ttu-id="4c5c8-108">Получение входящих запросов, направленных на зарегистрированные URL-адреса, с помощью функции [**хттпрецеивехттпрекуест**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) и отправка HTTP-ответов для этих запросов с помощью функции [**хттпсендхттпреспонсе**](/windows/desktop/api/Http/nf-http-httpsendhttpresponse) .</span><span class="sxs-lookup"><span data-stu-id="4c5c8-108">Receive incoming requests directed to registered URLs by using the [**HttpReceiveHttpRequest**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) function, and send HTTP responses for these requests by using the [**HttpSendHttpResponse**](/windows/desktop/api/Http/nf-http-httpsendhttpresponse) function.</span></span>
-   <span data-ttu-id="4c5c8-109">Используемых При отправке ответа отправьте дополнительный текст сущности с помощью функции [**хттпсендреспонсинтитибоди**](/windows/desktop/api/Http/nf-http-httpsendresponseentitybody) .</span><span class="sxs-lookup"><span data-stu-id="4c5c8-109">(Optional) When sending a response, send an additional entity body by using the [**HttpSendResponseEntityBody**](/windows/desktop/api/Http/nf-http-httpsendresponseentitybody) function.</span></span>
-   <span data-ttu-id="4c5c8-110">Выполните операции очистки с помощью функций [**хттпремовеурл**](/windows/desktop/api/Http/nf-http-httpremoveurl), [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) и [**хттптерминате**](/windows/desktop/api/Http/nf-http-httpterminate) .</span><span class="sxs-lookup"><span data-stu-id="4c5c8-110">Perform clean-up operations by using the [**HttpRemoveUrl**](/windows/desktop/api/Http/nf-http-httpremoveurl), [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) and [**HttpTerminate**](/windows/desktop/api/Http/nf-http-httpterminate) functions.</span></span>

<span data-ttu-id="4c5c8-111">В операциях, использующих URL-адреса, обратите внимание, что это обработанный URL-адрес, содержащийся в члене **кукедурл** структуры [**HTTP- \_ запроса \_ v1**](/windows/desktop/api/Http/ns-http-http_request_v1) , который следует использовать.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-111">In operations that use URLs, note that it is the processed URL contained in the **CookedUrl** member of the [**HTTP\_REQUEST\_V1**](/windows/desktop/api/Http/ns-http-http_request_v1) structure that should be used.</span></span> <span data-ttu-id="4c5c8-112">Не обработайте необработанный URL-адрес в члене **правурл** , который предназначен исключительно для отслеживания и статистических целей.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-112">Do not the unprocessed URL in the **pRawUrl** member, which is solely for tracking and statistical purposes.</span></span>

<span data-ttu-id="4c5c8-113">Каждое приложение создает собственную очередь запросов.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-113">Each application creates its own request queue.</span></span> <span data-ttu-id="4c5c8-114">Приложение получает маркер очереди запросов из [**хттпкреатехттфандле**](/windows/desktop/api/Http/nf-http-httpcreatehttphandle).</span><span class="sxs-lookup"><span data-stu-id="4c5c8-114">An application obtains its request queue handle from [**HttpCreateHttpHandle**](/windows/desktop/api/Http/nf-http-httpcreatehttphandle).</span></span> <span data-ttu-id="4c5c8-115">Он передает этот обработчик функции [**хттпаддурл**](/windows/desktop/api/Http/nf-http-httpaddurl) , чтобы добавить URL-адрес в очередь запросов.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-115">It passes this handle to the [**HttpAddUrl**](/windows/desktop/api/Http/nf-http-httpaddurl) function to add a URL to the request queue.</span></span> <span data-ttu-id="4c5c8-116">Приложение получает уведомление о входящем запросе и получает его из очереди запросов, вызывая функцию [**хттпрецеивехттпрекуест**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) с маркером очереди запросов.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-116">The application receives notification of an incoming request, and retrieves it from the request queue by calling the [**HttpReceiveHttpRequest**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) function with the request queue handle.</span></span> <span data-ttu-id="4c5c8-117">Эту функцию можно использовать для получения заголовков запроса либо как заголовков, так и тела сущности.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-117">You can use this function to receive either the request headers or both the headers and entity body.</span></span> <span data-ttu-id="4c5c8-118">[**Хттпрецеивехттпрекуест**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) также возвращает идентификатор запроса (RequestId) для полученного запроса, уникального для данного обработчика запроса.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-118">[**HttpReceiveHttpRequest**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) also returns a request identifier (RequestId) for the received request that is unique to the request handle.</span></span>

> [!Note]  
> <span data-ttu-id="4c5c8-119">Ответственность за проверку всех соответствующих заголовков запросов, в том числе заголовков согласования содержимого, если они используются, и неудачных запросов, соответствующих содержимому заголовка, зависит от приложения.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-119">It is the application's responsibility to examine all relevant request headers, including content-negotiation headers if they are being used, and fail requests as appropriate based on header content.</span></span> <span data-ttu-id="4c5c8-120">API сервера HTTP гарантирует, что каждая строка заголовка правильно завершается и не содержит недопустимых символов.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-120">The HTTP Server API ensures only that each header line is properly terminated, and does not contain illegal characters.</span></span>

 

<span data-ttu-id="4c5c8-121">Используйте функцию [**хттпрецеиверекуестентитибоди**](/windows/desktop/api/Http/nf-http-httpreceiverequestentitybody) с маркером очереди запросов для получения последующих частей тела объекта запроса, если таковые имеются.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-121">Use the [**HttpReceiveRequestEntityBody**](/windows/desktop/api/Http/nf-http-httpreceiverequestentitybody) function with the request queue handle to retrieve subsequent portions of a request's entity body, if any.</span></span>

> [!Note]  
> <span data-ttu-id="4c5c8-122">API сервера HTTP декодирует фрагментированные сообщения на стороне получения, но не выполняет фрагментированную кодировку на стороне отправителя.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-122">The HTTP Server API decodes chunked messages on the receive side, but does not perform chunked encoding on the send side.</span></span> <span data-ttu-id="4c5c8-123">Если для отправляющей стороны требуется Фрагментирование, приложение должно его реализовать.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-123">If chunking is required on the send side, the application must implement it.</span></span> <span data-ttu-id="4c5c8-124">Дополнительные сведения о фрагментированном кодировании см. в [документе RFC 2616](https://www.ietf.org/rfc/rfc2616.txt).</span><span class="sxs-lookup"><span data-stu-id="4c5c8-124">For more information about chunked encoding, see [RFC 2616](https://www.ietf.org/rfc/rfc2616.txt).</span></span>

 

<span data-ttu-id="4c5c8-125">Используйте функцию [**хттпрецеивеклиентцертификате**](/windows/desktop/api/Http/nf-http-httpreceiveclientcertificate) с приложениями, которые обслуживают URL-адреса с помощью схемы безопасности ("**HTTPS**"), чтобы дополнительно получить сведения о сертификате клиента.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-125">Use the [**HttpReceiveClientCertificate**](/windows/desktop/api/Http/nf-http-httpreceiveclientcertificate) function with applications that serve URLs by using a secure scheme ("**https**") to optionally retrieve the client's certificate information.</span></span>

<span data-ttu-id="4c5c8-126">Ответы отправляются с помощью функции [**хттпсендхттпреспонсе**](/windows/desktop/api/Http/nf-http-httpsendhttpresponse) .</span><span class="sxs-lookup"><span data-stu-id="4c5c8-126">Responses are sent with the [**HttpSendHttpResponse**](/windows/desktop/api/Http/nf-http-httpsendhttpresponse) function.</span></span> <span data-ttu-id="4c5c8-127">Эта функция использует идентификатор запроса из соответствующего запроса для отправки ответа.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-127">This function uses the RequestId from the corresponding request to send the response.</span></span> <span data-ttu-id="4c5c8-128">Ответ можно отправить в нескольких вызовах API с течением времени, вызвав функцию [**хттпсендреспонсинтитибоди**](/windows/desktop/api/Http/nf-http-httpsendresponseentitybody) с идентификатором запроса из первоначально полученного запроса.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-128">A response can be sent in several API calls over time by calling the [**HttpSendResponseEntityBody**](/windows/desktop/api/Http/nf-http-httpsendresponseentitybody) function with the RequestId from the originally received request.</span></span>

> [!Note]  
> <span data-ttu-id="4c5c8-129">По умолчанию [**хттпсендхттпреспонсе**](/windows/desktop/api/Http/nf-http-httpsendhttpresponse) использует "Microsoft-HTTPAPI/1.0" в качестве заголовка "Server:".</span><span class="sxs-lookup"><span data-stu-id="4c5c8-129">By default, [**HttpSendHttpResponse**](/windows/desktop/api/Http/nf-http-httpsendhttpresponse) uses "Microsoft-HTTPAPI/1.0" as the "Server:" header.</span></span> <span data-ttu-id="4c5c8-130">Если приложение указывает заголовок сервера в ответе, это значение помещается в первой части заголовка сервера, за которым следует пробел, а затем — Microsoft-HTTPAPI/1.0.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-130">If an application specifies a server header in a response, that value is placed as the first part of the server header, followed by a space and then "Microsoft-HTTPAPI/1.0".</span></span>

 

<span data-ttu-id="4c5c8-131">В общем случае API сервера HTTP скрывает сведения об управлении подключениями, их установке и уничтожении из приложений.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-131">In general, the HTTP Server API hides details of connection management and their establishment and teardown from applications.</span></span> <span data-ttu-id="4c5c8-132">Однако приложение может дополнительно обнаружить завершение соединения, вызвав [**хттпваитфордисконнект**](/windows/desktop/api/Http/nf-http-httpwaitfordisconnect).</span><span class="sxs-lookup"><span data-stu-id="4c5c8-132">However, an application can optionally detect termination of a connection by calling [**HttpWaitForDisconnect**](/windows/desktop/api/Http/nf-http-httpwaitfordisconnect).</span></span>

<span data-ttu-id="4c5c8-133">Приложения должны выполнить очистку, выполнив следующие действия.</span><span class="sxs-lookup"><span data-stu-id="4c5c8-133">Applications must clean-up by using the following steps:</span></span>

-   <span data-ttu-id="4c5c8-134">Если приложение не прослушивает URL-адрес или не отвечает на него, URL-адрес удаляется с помощью функции [**хттпремовеурл**](/windows/desktop/api/Http/nf-http-httpremoveurl) .</span><span class="sxs-lookup"><span data-stu-id="4c5c8-134">When the application is not listening or responding to a URL, the URL is removed by using the [**HttpRemoveURL**](/windows/desktop/api/Http/nf-http-httpremoveurl) function.</span></span>
-   <span data-ttu-id="4c5c8-135">Когда приложение завершит использование очереди запросов, закройте обработчик запросов с помощью функции [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) .</span><span class="sxs-lookup"><span data-stu-id="4c5c8-135">When the application is finished using the request queue, close the request queue handle by using the [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) function.</span></span>
-   <span data-ttu-id="4c5c8-136">После завершения работы приложения с помощью API сервера HTTP вызовите функцию [**хттптерминате**](/windows/desktop/api/Http/nf-http-httpterminate) .</span><span class="sxs-lookup"><span data-stu-id="4c5c8-136">When the application is finished using the HTTP Server API, call the [**HttpTerminate**](/windows/desktop/api/Http/nf-http-httpterminate) function.</span></span>

 

 