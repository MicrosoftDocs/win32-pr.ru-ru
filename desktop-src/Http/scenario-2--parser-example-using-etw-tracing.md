---
title: Пример синтаксического анализатора сценария 2 с использованием трассировки ETW
description: Чтобы создать отчет трассировки событий Windows для компонента API сервера HTTP, выполните шаги, показанные в \ 0034; Создание отчета трассировки событий Windows \ 0034; раздел сценария 1. пример времени ожидания HTTP с использованием трассировки ETW и команд Netsh, но воспроизвести ошибку, относящуюся к этому сценарию.
ms.assetid: 2ccd2927-8a64-40a8-a29b-4b680a942f7f
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 866c566973b660e4e665226fbf9b4a266b086b6b
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104070016"
---
# <a name="scenario-2-parser-example-using-etw-tracing"></a><span data-ttu-id="20d10-103">Сценарий 2. Пример средства синтаксического анализа с использованием трассировки ETW</span><span class="sxs-lookup"><span data-stu-id="20d10-103">Scenario 2: Parser Example Using ETW Tracing</span></span>

<span data-ttu-id="20d10-104">Чтобы создать отчет трассировки событий Windows для компонента API сервера HTTP, выполните действия, как показано в подразделе "Создание отчета трассировки событий Windows" [сценария 1: время ожидания HTTP с помощью команд трассировки событий Windows и команды netsh](scenario-1--http-timeout-example-using-etw-tracing-and-netsh-commands.md), но Воспроизведите ошибку, относящуюся к этому сценарию.</span><span class="sxs-lookup"><span data-stu-id="20d10-104">To generate an ETW trace report for the HTTP Server API component, run the steps as shown in the "Generating an ETW Trace Report" section of [Scenario 1: HTTP Timeout Example Using ETW Tracing and Netsh Commands](scenario-1--http-timeout-example-using-etw-tracing-and-netsh-commands.md), but reproduce the error specific to this scenario.</span></span> <span data-ttu-id="20d10-105">В этом примере доступ к веб-приложению осуществляется с клиентского компьютера, что приводит к отображению сообщения "400 недопустимый запрос" на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="20d10-105">In this example, access the web application from a client machine, resulting in the "400 bad request" message being shown on the client.</span></span> <span data-ttu-id="20d10-106">Эти действия выполняются на сервере, так как на нем размещается веб-приложение.</span><span class="sxs-lookup"><span data-stu-id="20d10-106">These steps are run on the server since it is hosting the web application.</span></span>

## <a name="viewing-the-trace-and-diagnosing"></a><span data-ttu-id="20d10-107">Просмотр трассировки и диагностика</span><span class="sxs-lookup"><span data-stu-id="20d10-107">Viewing the Trace and Diagnosing</span></span>

<span data-ttu-id="20d10-108">Полученный CSV-файл для трассировок можно просмотреть в Excel или в любом средстве, поддерживающем формат CSV.</span><span class="sxs-lookup"><span data-stu-id="20d10-108">The resulting CSV file for traces can be viewed in Excel or any tool that supports the CSV format.</span></span> <span data-ttu-id="20d10-109">В таблице 2 ниже показаны фрагменты из образца файла трассировки (httptrace.csv).</span><span class="sxs-lookup"><span data-stu-id="20d10-109">Table 2 below shows excerpts from a sample trace file (httptrace.csv).</span></span> <span data-ttu-id="20d10-110">В отчете трассировки в столбце "уровень" отображается запись со значением "2", которое представляет ошибку.</span><span class="sxs-lookup"><span data-stu-id="20d10-110">In the trace report, the "Level" column shows an entry with a value of "2", which represents an error.</span></span> <span data-ttu-id="20d10-111">Как отмечалось выше, компонент API сервера HTTP соответствует уровням ETW, определенным в статье [сложный тип Complex левелтипе](../wes/eventmanifestschema-leveltype-complextype.md).</span><span class="sxs-lookup"><span data-stu-id="20d10-111">As noted above, the HTTP Server API component follows the ETW Levels defined in the article [LevelType Complex Type Complex Type](../wes/eventmanifestschema-leveltype-complextype.md).</span></span>

<span data-ttu-id="20d10-112">К уровням ETW относятся: 1 критическая; 2 ошибка; 3 предупреждение; 4. Информация; 5 подробный.</span><span class="sxs-lookup"><span data-stu-id="20d10-112">The ETW levels include: 1 Critical; 2 Error; 3 Warning; 4 Informational; 5 Verbose.</span></span>

<span data-ttu-id="20d10-113">С этой ошибкой тип события (столбец типа) сообщает "Парсерекуестфаилед".</span><span class="sxs-lookup"><span data-stu-id="20d10-113">With this error, the event type (Type column) reports "ParseRequestFailed".</span></span> <span data-ttu-id="20d10-114">В последующих столбцах для события Парсерекуестфаилед отображается запись "Инвалидхост".</span><span class="sxs-lookup"><span data-stu-id="20d10-114">In the subsequent columns for the ParseRequestFailed event, we see an "InvalidHost" entry.</span></span> <span data-ttu-id="20d10-115">Эта запись означает, что идентифицированный узел в HTTP-запросе неверен в соответствии с протоколом HTTP.</span><span class="sxs-lookup"><span data-stu-id="20d10-115">This entry means that the identified host in the HTTP Request is incorrect, according the HTTP protocol.</span></span> <span data-ttu-id="20d10-116">Обратите внимание, что столбец с записью "Инвалидхост" не включается в таблицу для краткости и не выдает отрывок несмежных столбцов.</span><span class="sxs-lookup"><span data-stu-id="20d10-116">Note the column with the "InvalidHost" entry is not included in the table for the sake of brevity and to avoid excerpting noncontiguous columns.</span></span>

<span data-ttu-id="20d10-117">Чтобы устранить эту проблему синтаксического анализа, необходимо исправить веб-клиент, чтобы он соответствовал стандарту HTTP RFC.</span><span class="sxs-lookup"><span data-stu-id="20d10-117">To fix this parsing issue, the web client should be corrected to be compliant with the HTTP RFC.</span></span> 

| <span data-ttu-id="20d10-118">Имя события</span><span class="sxs-lookup"><span data-stu-id="20d10-118">Event name</span></span>                    | <span data-ttu-id="20d10-119">Тип</span><span class="sxs-lookup"><span data-stu-id="20d10-119">Type</span></span>               | <span data-ttu-id="20d10-120">Идентификатор события</span><span class="sxs-lookup"><span data-stu-id="20d10-120">Event ID</span></span> | <span data-ttu-id="20d10-121">Версия</span><span class="sxs-lookup"><span data-stu-id="20d10-121">Version</span></span> | <span data-ttu-id="20d10-122">Канал</span><span class="sxs-lookup"><span data-stu-id="20d10-122">Channel</span></span> | <span data-ttu-id="20d10-123">Level</span><span class="sxs-lookup"><span data-stu-id="20d10-123">Level</span></span> |
|-------------------------------|--------------------|----------|---------|---------|-------|
| <span data-ttu-id="20d10-124">евенттраце</span><span class="sxs-lookup"><span data-stu-id="20d10-124">EventTrace</span></span>                    | <span data-ttu-id="20d10-125">Header</span><span class="sxs-lookup"><span data-stu-id="20d10-125">Header</span></span>             | <span data-ttu-id="20d10-126">0</span><span class="sxs-lookup"><span data-stu-id="20d10-126">0</span></span>        | <span data-ttu-id="20d10-127">2</span><span class="sxs-lookup"><span data-stu-id="20d10-127">2</span></span>       | <span data-ttu-id="20d10-128">0</span><span class="sxs-lookup"><span data-stu-id="20d10-128">0</span></span>       | <span data-ttu-id="20d10-129">0</span><span class="sxs-lookup"><span data-stu-id="20d10-129">0</span></span>     |
| <span data-ttu-id="20d10-130">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="20d10-130">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="20d10-131">аддурл</span><span class="sxs-lookup"><span data-stu-id="20d10-131">AddUrl</span></span>             | <span data-ttu-id="20d10-132">31</span><span class="sxs-lookup"><span data-stu-id="20d10-132">31</span></span>       | <span data-ttu-id="20d10-133">0</span><span class="sxs-lookup"><span data-stu-id="20d10-133">0</span></span>       | <span data-ttu-id="20d10-134">16</span><span class="sxs-lookup"><span data-stu-id="20d10-134">16</span></span>      | <span data-ttu-id="20d10-135">4</span><span class="sxs-lookup"><span data-stu-id="20d10-135">4</span></span>     |
| <span data-ttu-id="20d10-136">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="20d10-136">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="20d10-137">коннконнект</span><span class="sxs-lookup"><span data-stu-id="20d10-137">ConnConnect</span></span>        | <span data-ttu-id="20d10-138">21</span><span class="sxs-lookup"><span data-stu-id="20d10-138">21</span></span>       | <span data-ttu-id="20d10-139">0</span><span class="sxs-lookup"><span data-stu-id="20d10-139">0</span></span>       | <span data-ttu-id="20d10-140">16</span><span class="sxs-lookup"><span data-stu-id="20d10-140">16</span></span>      | <span data-ttu-id="20d10-141">4</span><span class="sxs-lookup"><span data-stu-id="20d10-141">4</span></span>     |
| <span data-ttu-id="20d10-142">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="20d10-142">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="20d10-143">коннидассгн</span><span class="sxs-lookup"><span data-stu-id="20d10-143">ConnIdAssgn</span></span>        | <span data-ttu-id="20d10-144">22</span><span class="sxs-lookup"><span data-stu-id="20d10-144">22</span></span>       | <span data-ttu-id="20d10-145">0</span><span class="sxs-lookup"><span data-stu-id="20d10-145">0</span></span>       | <span data-ttu-id="20d10-146">16</span><span class="sxs-lookup"><span data-stu-id="20d10-146">16</span></span>      | <span data-ttu-id="20d10-147">4</span><span class="sxs-lookup"><span data-stu-id="20d10-147">4</span></span>     |
| <span data-ttu-id="20d10-148">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="20d10-148">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="20d10-149">рекврек</span><span class="sxs-lookup"><span data-stu-id="20d10-149">RecvReq</span></span>            | <span data-ttu-id="20d10-150">1</span><span class="sxs-lookup"><span data-stu-id="20d10-150">1</span></span>        | <span data-ttu-id="20d10-151">0</span><span class="sxs-lookup"><span data-stu-id="20d10-151">0</span></span>       | <span data-ttu-id="20d10-152">16</span><span class="sxs-lookup"><span data-stu-id="20d10-152">16</span></span>      | <span data-ttu-id="20d10-153">4</span><span class="sxs-lookup"><span data-stu-id="20d10-153">4</span></span>     |
| <span data-ttu-id="20d10-154">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="20d10-154">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="20d10-155">парсерекуестфаилед</span><span class="sxs-lookup"><span data-stu-id="20d10-155">ParseRequestFailed</span></span> | <span data-ttu-id="20d10-156">52</span><span class="sxs-lookup"><span data-stu-id="20d10-156">52</span></span>       | <span data-ttu-id="20d10-157">0</span><span class="sxs-lookup"><span data-stu-id="20d10-157">0</span></span>       | <span data-ttu-id="20d10-158">16</span><span class="sxs-lookup"><span data-stu-id="20d10-158">16</span></span>      | <span data-ttu-id="20d10-159">2</span><span class="sxs-lookup"><span data-stu-id="20d10-159">2</span></span>     |
| <span data-ttu-id="20d10-160">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="20d10-160">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="20d10-161">логфилеврите</span><span class="sxs-lookup"><span data-stu-id="20d10-161">LogFileWrite</span></span>       | <span data-ttu-id="20d10-162">51</span><span class="sxs-lookup"><span data-stu-id="20d10-162">51</span></span>       | <span data-ttu-id="20d10-163">0</span><span class="sxs-lookup"><span data-stu-id="20d10-163">0</span></span>       | <span data-ttu-id="20d10-164">16</span><span class="sxs-lookup"><span data-stu-id="20d10-164">16</span></span>      | <span data-ttu-id="20d10-165">4</span><span class="sxs-lookup"><span data-stu-id="20d10-165">4</span></span>     |



 

<span data-ttu-id="20d10-166">Таблица 2. Выдержка из образца отчета трассировки для проблемы синтаксического анализа</span><span class="sxs-lookup"><span data-stu-id="20d10-166">Table 2: Excerpts from a Sample Trace Report for a Parsing Issue</span></span>

 

 