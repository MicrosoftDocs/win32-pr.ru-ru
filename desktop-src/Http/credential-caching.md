---
title: Кэширование учетных данных
description: Кэширование учетных данных
ms.assetid: 6e411333-56fa-455b-a90a-f2b54f3c9545
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 34a139d0cd90495de87f42de08687fd3157acaf6
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "103986665"
---
# <a name="credential-caching"></a><span data-ttu-id="b2878-103">Кэширование учетных данных</span><span class="sxs-lookup"><span data-stu-id="b2878-103">Credential Caching</span></span>

## <a name="credential-caching-on-ntlm-ka-connections"></a><span data-ttu-id="b2878-104">Кэширование учетных данных для подключений NTLM ка</span><span class="sxs-lookup"><span data-stu-id="b2878-104">Credential Caching on NTLM KA Connections</span></span>

<span data-ttu-id="b2878-105">API сервера HTTP кэширует учетные данные только для подключений Keep-Alive (ка) для проверки подлинности NTLM.</span><span class="sxs-lookup"><span data-stu-id="b2878-105">The HTTP Server API caches credentials only on Keep-Alive (KA) connections for NTLM authentication.</span></span> <span data-ttu-id="b2878-106">По умолчанию API сервера HTTP кэширует учетные данные, полученные в первом запросе, отправленном по соединению ка.</span><span class="sxs-lookup"><span data-stu-id="b2878-106">By default, the HTTP Server API caches the credentials obtained on the first request sent on a KA connection.</span></span> <span data-ttu-id="b2878-107">Клиент может отправить последующие запросы на подключения типа "Ка" без заголовка авторизации и получить проверку подлинности на основе ранее установленного контекста.</span><span class="sxs-lookup"><span data-stu-id="b2878-107">The client can send subsequent requests on KA connections without an authorization header and obtain authentication based on the previously established context.</span></span> <span data-ttu-id="b2878-108">В этом случае API сервера HTTP отправляет маркер на основе кэшированных учетных данных в приложение.</span><span class="sxs-lookup"><span data-stu-id="b2878-108">In this case, the HTTP Server API sends the token based on the cached credential to the application.</span></span> <span data-ttu-id="b2878-109">Учетные данные для запроса, отправленного прокси-сервером, не кэшируются.</span><span class="sxs-lookup"><span data-stu-id="b2878-109">Credentials for a request sent by a proxy are not cached.</span></span> <span data-ttu-id="b2878-110">Приложение отключает кэширование учетных данных NTLM, устанавливая флаг **дисаблентлмкредентиалкачинг** в структуре [**\_ \_ \_ сведений о проверке подлинности HTTP-сервера**](/windows/desktop/api/Http/ns-http-http_server_authentication_info) , которая предоставляется в вызовах хттпсетсерверсессионпроперти или хттпсетурлграуппроперти.</span><span class="sxs-lookup"><span data-stu-id="b2878-110">The application disables NTLM credential caching by setting the **DisableNTLMCredentialCaching** flag in the [**HTTP\_SERVER\_AUTHENTICATION\_INFO**](/windows/desktop/api/Http/ns-http-http_server_authentication_info) structure that is supplied in calls to HttpSetServerSessionProperty or HttpSetUrlGroupProperty.</span></span> <span data-ttu-id="b2878-111">Если кэширование учетных данных отключено, API сервера HTTP отклоняет кэшированные учетные данные и выполняет проверку подлинности для каждого запроса.</span><span class="sxs-lookup"><span data-stu-id="b2878-111">When credential caching is disabled, the HTTP Server API discards the cached credentials and performs authentication for each request</span></span>

## <a name="ntlm-credential-caching-for-specific-urls"></a><span data-ttu-id="b2878-112">Кэширование учетных данных NTLM для конкретных URL-адресов</span><span class="sxs-lookup"><span data-stu-id="b2878-112">NTLM Credential Caching for Specific URLs</span></span>

<span data-ttu-id="b2878-113">Приложение определяет, кэшируются ли учетные данные запроса, возвращаемые API-сервером HTTP, путем проверки параметра flags в \_ \_ структуре сведений о проверке подлинности HTTP-запроса \_ .</span><span class="sxs-lookup"><span data-stu-id="b2878-113">The application determines if the request credentials returned by the HTTP Server API are cached by inspecting the Flags parameter of the HTTP\_REQUEST\_AUTH\_INFO structure.</span></span> <span data-ttu-id="b2878-114">Этот параметр указывает \_ \_ токен флага проверки подлинности HTTP-запроса \_ \_ \_ для \_ кэшированного \_ cred, когда возвращенный токен NTLM был получен из кэша.</span><span class="sxs-lookup"><span data-stu-id="b2878-114">This parameter indicates HTTP\_REQUEST\_AUTH\_FLAG\_TOKEN\_FOR\_CACHED\_CRED when the returned NTLM token was retrieved from the cache.</span></span> <span data-ttu-id="b2878-115">Кэширование учетных данных указывается в группе URL-адресов для всех URL-адресов в группе.</span><span class="sxs-lookup"><span data-stu-id="b2878-115">Credential caching is specified on a URL group for all the URLs in the group.</span></span> <span data-ttu-id="b2878-116">Кэширование учетных данных для каждого URL-адреса не поддерживается, однако приложения могут определить, следует ли принимать или отклонять кэшированные учетные данные по URL-адресу, проверяя \_ \_ маркер флага http-запроса проверки подлинности \_ \_ \_ для \_ кэшированного \_ флага в \_ \_ структуре сведений о проверке подлинности HTTP-запроса \_ .</span><span class="sxs-lookup"><span data-stu-id="b2878-116">Credential caching on a per URL basis is not supported, however, applications can determine whether to accept or reject cached credentials on a per URL basis by checking the HTTP\_REQUEST\_AUTH\_FLAG\_TOKEN\_FOR\_CACHED\_CRED flag in the HTTP\_REQUEST\_AUTH\_INFO structure.</span></span> <span data-ttu-id="b2878-117">Приложение отклоняет кэшированные учетные данные, отправляя клиенту запрос проверки подлинности 401.</span><span class="sxs-lookup"><span data-stu-id="b2878-117">The application rejects the cached credentials by sending a 401 authentication challenge to the client.</span></span> <span data-ttu-id="b2878-118">Затем клиент повторно отправляет запрос с заголовками авторизации, активируя новое подтверждение проверки подлинности с помощью API сервера HTTP.</span><span class="sxs-lookup"><span data-stu-id="b2878-118">The client then resends the request with the authorization headers, triggering a new authentication handshake with the HTTP Server API.</span></span>

## <a name="basic-authentication"></a><span data-ttu-id="b2878-119">Обычная проверка подлинности</span><span class="sxs-lookup"><span data-stu-id="b2878-119">Basic Authentication</span></span>

<span data-ttu-id="b2878-120">Если в запрос включен заголовок обычной проверки подлинности, API сервера HTTP анализирует заголовок, чтобы получить имя пользователя и пароль.</span><span class="sxs-lookup"><span data-stu-id="b2878-120">When a Basic authentication header is included in the request, the HTTP Server API parses the header to obtain the user name and password.</span></span> <span data-ttu-id="b2878-121">Затем имя пользователя проанализируется в частях пользователя и домена.</span><span class="sxs-lookup"><span data-stu-id="b2878-121">The user name is then parsed into the user and domain portions.</span></span> <span data-ttu-id="b2878-122">API сервера HTTP кэширует маркер доступа, полученный для обычной проверки подлинности, на основе имени пользователя и ключа домена.</span><span class="sxs-lookup"><span data-stu-id="b2878-122">The HTTP Server API caches the access token, obtained for Basic authentication, based on the user name and domain key.</span></span> <span data-ttu-id="b2878-123">При получении нового запроса API сервера HTTP Извлекает маркер доступа на основе имени пользователя и домена.</span><span class="sxs-lookup"><span data-stu-id="b2878-123">When a new request is received, the HTTP Server API retrieves the access token based on the user name and domain.</span></span> <span data-ttu-id="b2878-124">Затем пароль в запросе проверяется по кэшированному паролю.</span><span class="sxs-lookup"><span data-stu-id="b2878-124">The password in the request is then checked against the cached password.</span></span> <span data-ttu-id="b2878-125">Кэшированный маркер доступа удаляется по достижении ограничения срока жизни (TTL).</span><span class="sxs-lookup"><span data-stu-id="b2878-125">The cached access token is deleted when the time-to-live (TTL) limit is reached.</span></span>

 

 




