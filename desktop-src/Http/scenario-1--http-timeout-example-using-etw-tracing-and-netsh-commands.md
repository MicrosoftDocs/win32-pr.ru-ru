---
title: Сценарий 1. пример времени ожидания HTTP с использованием трассировки ETW и команд Netsh
description: С помощью трассировки ETW поток данных через компонент API сервера HTTP можно проверить для диагностики проблем.
ms.assetid: b6b24161-c3da-4972-b49f-c545da2fc81e
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: aa50f438aca664651b24db822f2b9e3a30da4682
ms.sourcegitcommit: 37f276b5d887a3aad04b1ba86e390dea9d87e591
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2021
ms.locfileid: "104558346"
---
# <a name="scenario-1-http-timeout-example-using-etw-tracing-and-netsh-commands"></a><span data-ttu-id="4c6d6-103">Сценарий 1. пример времени ожидания HTTP с использованием трассировки ETW и команд Netsh</span><span class="sxs-lookup"><span data-stu-id="4c6d6-103">Scenario 1: HTTP Timeout Example Using ETW Tracing and Netsh Commands</span></span>

<span data-ttu-id="4c6d6-104">С помощью трассировки ETW поток данных через компонент API сервера HTTP можно проверить для диагностики проблем.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-104">Through ETW tracing, the flow of data through the HTTP Server API component can be inspected to diagnose problems.</span></span> <span data-ttu-id="4c6d6-105">Например, пользователи веб-приложения могут видеть сообщения об ошибках в браузере, которые веб-страница не может отобразить.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-105">For example, users of a web application may see error messages in their browser that a web page cannot display.</span></span> <span data-ttu-id="4c6d6-106">На сервере, на котором размещено веб-приложение, специалист по ИТ также видит запись времени ожидания подключения в журнале ошибок HTTP, как показано на рис. 1 ниже.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-106">On the server hosting the web application, the IT professional also sees a connection timeout entry within the HTTP Error Log, as shown in Figure 1 below.</span></span> <span data-ttu-id="4c6d6-107">Журнал ошибок HTTP можно найти в следующем каталоге:% WINDIR% \\ system32 \\ файл_журнала \\ хттперр \\ .</span><span class="sxs-lookup"><span data-stu-id="4c6d6-107">The HTTP Error Log can be found in the following directory: %windir%\\System32\\LogFiles\\HTTPERR\\.</span></span>

![Снимок экрана: командное окно Netsh H T P, в котором отображается журнал ошибок H t t P для времени ожидания.](images/httperrorlog.png)

<span data-ttu-id="4c6d6-109">Рис. 1. журнал ошибок HTTP для времени ожидания</span><span class="sxs-lookup"><span data-stu-id="4c6d6-109">Figure 1: HTTP Error Log for Timeout</span></span>

## <a name="generating-an-etw-trace-report"></a><span data-ttu-id="4c6d6-110">Создание отчета трассировки событий Windows</span><span class="sxs-lookup"><span data-stu-id="4c6d6-110">Generating an ETW Trace Report</span></span>

<span data-ttu-id="4c6d6-111">Чтобы создать отчет трассировки событий Windows для компонента API сервера HTTP, выполните приведенные ниже действия из командной строки.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-111">To generate an ETW trace report for the HTTP Server API component, run the steps below from the command prompt.</span></span> <span data-ttu-id="4c6d6-112">В этом примере трассировка выполняется на сервере, так как на нем размещается веб-приложение.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-112">In this example, the trace is run on the server since it is hosting the web application.</span></span>

<span data-ttu-id="4c6d6-113">В приведенных ниже шагах создается трассировка с именем Httptrace. ETL, а затем производится преобразование трассировки в CSV-файл с именем httptrace.csv.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-113">The steps below generate a trace called httptrace.etl and then convert the trace into a CSV file called httptrace.csv.</span></span> <span data-ttu-id="4c6d6-114">Как показано ниже, поставщик ETW для API-сервера HTTP называется Microsoft-Windows-Хттпсервице.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-114">As shown below, the ETW provider for the HTTP Server API is called Microsoft-Windows-HttpService.</span></span> <span data-ttu-id="4c6d6-115">Параметр командной строки 0xFFF указывает, что должны быть захвачены все события ETW для этого поставщика.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-115">The 0xFFF command-line option indicates that all ETW events for this provider should be captured.</span></span>

<span data-ttu-id="4c6d6-116">**Создание отчета трассировки событий Windows**</span><span class="sxs-lookup"><span data-stu-id="4c6d6-116">**Generate an ETW Trace Report**</span></span>

1.  <span data-ttu-id="4c6d6-117">Запустите трассировку ETW для компонента API HTTP-сервера: l **ogman.exe Start Httptrace-p Microsoft-Windows-Хттпсервице 0xFFFF-o Httptrace. ETL-ETS**</span><span class="sxs-lookup"><span data-stu-id="4c6d6-117">Start ETW trace for HTTP Server API component: l **ogman.exe start httptrace -p Microsoft-Windows-HttpService 0xFFFF -o httptrace.etl –ets**</span></span>
2.  <span data-ttu-id="4c6d6-118">Воспроизведите ошибку, чтобы ее можно было записать в трассировку.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-118">Reproduce the issue so that it can be captured in the trace.</span></span> <span data-ttu-id="4c6d6-119">В этом примере доступ к веб-приложению осуществляется с клиентского компьютера, что приводит к отображению на клиенте сообщения "**не удается отобразить страницу**".</span><span class="sxs-lookup"><span data-stu-id="4c6d6-119">In this example, access the web application from a client machine, resulting in the "**page cannot be displayed**" message being shown on the client.</span></span>
3.  <span data-ttu-id="4c6d6-120">Теперь, когда эта ошибка воспроизведена, завершите трассировку: **logman.exe Httptrace-ETS**</span><span class="sxs-lookup"><span data-stu-id="4c6d6-120">Now that the issue has been reproduced, stop the trace: **logman.exe stop httptrace –ets**</span></span>
4.  <span data-ttu-id="4c6d6-121">Преобразование отчета в формат CSV: **tracerpt.exe Httptrace. ETL-of CSV-o httptrace.csv**</span><span class="sxs-lookup"><span data-stu-id="4c6d6-121">Convert the report into CSV format: **tracerpt.exe httptrace.etl -of CSV -o httptrace.csv**</span></span>
5.  <span data-ttu-id="4c6d6-122">Просмотр отчета о трассировке.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-122">View the trace report.</span></span> <span data-ttu-id="4c6d6-123">Выдержка из трассировки CSV показана ниже в таблице 1.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-123">An excerpt from a CSV trace is shown below in Table 1.</span></span>

## <a name="viewing-the-trace-and-diagnosing"></a><span data-ttu-id="4c6d6-124">Просмотр трассировки и диагностика</span><span class="sxs-lookup"><span data-stu-id="4c6d6-124">Viewing the Trace and Diagnosing</span></span>

<span data-ttu-id="4c6d6-125">Полученный CSV-файл для трассировок можно просмотреть в Excel или в любом средстве, поддерживающем формат CSV.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-125">The resulting CSV file for traces can be viewed in Excel or any tool that supports the CSV format.</span></span> <span data-ttu-id="4c6d6-126">В таблице 1 ниже показаны фрагменты из образца файла трассировки (httptrace.csv).</span><span class="sxs-lookup"><span data-stu-id="4c6d6-126">Table 1 below shows excerpts from a sample trace file (httptrace.csv).</span></span> <span data-ttu-id="4c6d6-127">В отчете трассировки в столбце "уровень" отображается запись со значением "3", которое соответствует предупреждению в ETW.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-127">In the trace report, the "Level" column shows an entry with a value of "3", which corresponds to a warning in ETW.</span></span> <span data-ttu-id="4c6d6-128">Компонент API сервера HTTP соответствует уровням ETW, определенным в следующей статье: ( https://msdn2.microsoft.com/library/aa382793.aspx) .</span><span class="sxs-lookup"><span data-stu-id="4c6d6-128">The HTTP Server API component follows the ETW Levels defined in the following article: (https://msdn2.microsoft.com/library/aa382793.aspx).</span></span> <span data-ttu-id="4c6d6-129">Ниже перечислены уровни ETW.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-129">The ETW levels include:</span></span>



| <span data-ttu-id="4c6d6-130">Level</span><span class="sxs-lookup"><span data-stu-id="4c6d6-130">Level</span></span> | <span data-ttu-id="4c6d6-131">Значение</span><span class="sxs-lookup"><span data-stu-id="4c6d6-131">Meaning</span></span>      |
|-------|--------------|
| <span data-ttu-id="4c6d6-132">1</span><span class="sxs-lookup"><span data-stu-id="4c6d6-132">1</span></span>     | <span data-ttu-id="4c6d6-133">Критически важно</span><span class="sxs-lookup"><span data-stu-id="4c6d6-133">Critical</span></span>     |
| <span data-ttu-id="4c6d6-134">2</span><span class="sxs-lookup"><span data-stu-id="4c6d6-134">2</span></span>     | <span data-ttu-id="4c6d6-135">Ошибка</span><span class="sxs-lookup"><span data-stu-id="4c6d6-135">Error</span></span>        |
| <span data-ttu-id="4c6d6-136">3</span><span class="sxs-lookup"><span data-stu-id="4c6d6-136">3</span></span>     | <span data-ttu-id="4c6d6-137">Предупреждение</span><span class="sxs-lookup"><span data-stu-id="4c6d6-137">Warning</span></span>      |
| <span data-ttu-id="4c6d6-138">4</span><span class="sxs-lookup"><span data-stu-id="4c6d6-138">4</span></span>     | <span data-ttu-id="4c6d6-139">инфоматионал</span><span class="sxs-lookup"><span data-stu-id="4c6d6-139">Infomational</span></span> |
| <span data-ttu-id="4c6d6-140">5</span><span class="sxs-lookup"><span data-stu-id="4c6d6-140">5</span></span>     | <span data-ttu-id="4c6d6-141">Подробный</span><span class="sxs-lookup"><span data-stu-id="4c6d6-141">Verbose</span></span>      |



 

<span data-ttu-id="4c6d6-142">С этим предупреждением тип события (столбец типа) сообщает "Коннтимедаут".</span><span class="sxs-lookup"><span data-stu-id="4c6d6-142">With this warning, the event type (Type column) reports "ConnTimedOut".</span></span> <span data-ttu-id="4c6d6-143">В последующих столбцах для события Коннтимеаут для конкретного таймера, срок действия которого истек, указывается значение Timer \_ коннектионидле.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-143">In the subsequent columns for the ConnTimeOut event, the specific timer that expired is reported as "Timer\_ConnectionIdle".</span></span> <span data-ttu-id="4c6d6-144">Обратите внимание, что столбец с \_ записью "Timer коннектионидле" не включен в таблицу для краткости, и во избежание выдержки несмежных столбцов.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-144">Note the column with the "Timer\_ConnectionIdle" entry is not included in the table for the sake brevity and to avoid excerpting noncontiguous columns.</span></span>



| <span data-ttu-id="4c6d6-145">Имя события</span><span class="sxs-lookup"><span data-stu-id="4c6d6-145">Event name</span></span>                    | <span data-ttu-id="4c6d6-146">Тип</span><span class="sxs-lookup"><span data-stu-id="4c6d6-146">Type</span></span>            | <span data-ttu-id="4c6d6-147">Идентификатор события</span><span class="sxs-lookup"><span data-stu-id="4c6d6-147">Event ID</span></span> | <span data-ttu-id="4c6d6-148">Версия</span><span class="sxs-lookup"><span data-stu-id="4c6d6-148">Version</span></span> | <span data-ttu-id="4c6d6-149">Канал</span><span class="sxs-lookup"><span data-stu-id="4c6d6-149">Channel</span></span> | <span data-ttu-id="4c6d6-150">Level</span><span class="sxs-lookup"><span data-stu-id="4c6d6-150">Level</span></span> |
|-------------------------------|-----------------|----------|---------|---------|-------|
| <span data-ttu-id="4c6d6-151">евенттраце</span><span class="sxs-lookup"><span data-stu-id="4c6d6-151">EventTrace</span></span>                    | <span data-ttu-id="4c6d6-152">Header</span><span class="sxs-lookup"><span data-stu-id="4c6d6-152">Header</span></span>          | <span data-ttu-id="4c6d6-153">0</span><span class="sxs-lookup"><span data-stu-id="4c6d6-153">0</span></span>        | <span data-ttu-id="4c6d6-154">2</span><span class="sxs-lookup"><span data-stu-id="4c6d6-154">2</span></span>       | <span data-ttu-id="4c6d6-155">0</span><span class="sxs-lookup"><span data-stu-id="4c6d6-155">0</span></span>       | <span data-ttu-id="4c6d6-156">0</span><span class="sxs-lookup"><span data-stu-id="4c6d6-156">0</span></span>     |
| <span data-ttu-id="4c6d6-157">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="4c6d6-157">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="4c6d6-158">чгурлгрппроп</span><span class="sxs-lookup"><span data-stu-id="4c6d6-158">ChgUrlGrpProp</span></span>   | <span data-ttu-id="4c6d6-159">28</span><span class="sxs-lookup"><span data-stu-id="4c6d6-159">28</span></span>       | <span data-ttu-id="4c6d6-160">0</span><span class="sxs-lookup"><span data-stu-id="4c6d6-160">0</span></span>       | <span data-ttu-id="4c6d6-161">16</span><span class="sxs-lookup"><span data-stu-id="4c6d6-161">16</span></span>      | <span data-ttu-id="4c6d6-162">4</span><span class="sxs-lookup"><span data-stu-id="4c6d6-162">4</span></span>     |
| <span data-ttu-id="4c6d6-163">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="4c6d6-163">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="4c6d6-164">аддурл</span><span class="sxs-lookup"><span data-stu-id="4c6d6-164">AddUrl</span></span>          | <span data-ttu-id="4c6d6-165">31</span><span class="sxs-lookup"><span data-stu-id="4c6d6-165">31</span></span>       | <span data-ttu-id="4c6d6-166">0</span><span class="sxs-lookup"><span data-stu-id="4c6d6-166">0</span></span>       | <span data-ttu-id="4c6d6-167">16</span><span class="sxs-lookup"><span data-stu-id="4c6d6-167">16</span></span>      | <span data-ttu-id="4c6d6-168">4</span><span class="sxs-lookup"><span data-stu-id="4c6d6-168">4</span></span>     |
| <span data-ttu-id="4c6d6-169">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="4c6d6-169">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="4c6d6-170">чгреккуеуепроп</span><span class="sxs-lookup"><span data-stu-id="4c6d6-170">ChgReqQueueProp</span></span> | <span data-ttu-id="4c6d6-171">30</span><span class="sxs-lookup"><span data-stu-id="4c6d6-171">30</span></span>       | <span data-ttu-id="4c6d6-172">0</span><span class="sxs-lookup"><span data-stu-id="4c6d6-172">0</span></span>       | <span data-ttu-id="4c6d6-173">16</span><span class="sxs-lookup"><span data-stu-id="4c6d6-173">16</span></span>      | <span data-ttu-id="4c6d6-174">4</span><span class="sxs-lookup"><span data-stu-id="4c6d6-174">4</span></span>     |
| <span data-ttu-id="4c6d6-175">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="4c6d6-175">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="4c6d6-176">чгурлгрппроп</span><span class="sxs-lookup"><span data-stu-id="4c6d6-176">ChgUrlGrpProp</span></span>   | <span data-ttu-id="4c6d6-177">28</span><span class="sxs-lookup"><span data-stu-id="4c6d6-177">28</span></span>       | <span data-ttu-id="4c6d6-178">0</span><span class="sxs-lookup"><span data-stu-id="4c6d6-178">0</span></span>       | <span data-ttu-id="4c6d6-179">16</span><span class="sxs-lookup"><span data-stu-id="4c6d6-179">16</span></span>      | <span data-ttu-id="4c6d6-180">4</span><span class="sxs-lookup"><span data-stu-id="4c6d6-180">4</span></span>     |
| <span data-ttu-id="4c6d6-181">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="4c6d6-181">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="4c6d6-182">чгсрвсеспроп</span><span class="sxs-lookup"><span data-stu-id="4c6d6-182">ChgSrvSesProp</span></span>   | <span data-ttu-id="4c6d6-183">29</span><span class="sxs-lookup"><span data-stu-id="4c6d6-183">29</span></span>       | <span data-ttu-id="4c6d6-184">0</span><span class="sxs-lookup"><span data-stu-id="4c6d6-184">0</span></span>       | <span data-ttu-id="4c6d6-185">16</span><span class="sxs-lookup"><span data-stu-id="4c6d6-185">16</span></span>      | <span data-ttu-id="4c6d6-186">4</span><span class="sxs-lookup"><span data-stu-id="4c6d6-186">4</span></span>     |
| <span data-ttu-id="4c6d6-187">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="4c6d6-187">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="4c6d6-188">чгсрвсеспроп</span><span class="sxs-lookup"><span data-stu-id="4c6d6-188">ChgSrvSesProp</span></span>   | <span data-ttu-id="4c6d6-189">29</span><span class="sxs-lookup"><span data-stu-id="4c6d6-189">29</span></span>       | <span data-ttu-id="4c6d6-190">0</span><span class="sxs-lookup"><span data-stu-id="4c6d6-190">0</span></span>       | <span data-ttu-id="4c6d6-191">16</span><span class="sxs-lookup"><span data-stu-id="4c6d6-191">16</span></span>      | <span data-ttu-id="4c6d6-192">4</span><span class="sxs-lookup"><span data-stu-id="4c6d6-192">4</span></span>     |
| <span data-ttu-id="4c6d6-193">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="4c6d6-193">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="4c6d6-194">коннконнект</span><span class="sxs-lookup"><span data-stu-id="4c6d6-194">ConnConnect</span></span>     | <span data-ttu-id="4c6d6-195">21</span><span class="sxs-lookup"><span data-stu-id="4c6d6-195">21</span></span>       | <span data-ttu-id="4c6d6-196">0</span><span class="sxs-lookup"><span data-stu-id="4c6d6-196">0</span></span>       | <span data-ttu-id="4c6d6-197">16</span><span class="sxs-lookup"><span data-stu-id="4c6d6-197">16</span></span>      | <span data-ttu-id="4c6d6-198">4</span><span class="sxs-lookup"><span data-stu-id="4c6d6-198">4</span></span>     |
| <span data-ttu-id="4c6d6-199">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="4c6d6-199">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="4c6d6-200">коннидассгн</span><span class="sxs-lookup"><span data-stu-id="4c6d6-200">ConnIdAssgn</span></span>     | <span data-ttu-id="4c6d6-201">22</span><span class="sxs-lookup"><span data-stu-id="4c6d6-201">22</span></span>       | <span data-ttu-id="4c6d6-202">0</span><span class="sxs-lookup"><span data-stu-id="4c6d6-202">0</span></span>       | <span data-ttu-id="4c6d6-203">16</span><span class="sxs-lookup"><span data-stu-id="4c6d6-203">16</span></span>      | <span data-ttu-id="4c6d6-204">4</span><span class="sxs-lookup"><span data-stu-id="4c6d6-204">4</span></span>     |
| <span data-ttu-id="4c6d6-205">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="4c6d6-205">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="4c6d6-206">рекврек</span><span class="sxs-lookup"><span data-stu-id="4c6d6-206">RecvReq</span></span>         | <span data-ttu-id="4c6d6-207">1</span><span class="sxs-lookup"><span data-stu-id="4c6d6-207">1</span></span>        | <span data-ttu-id="4c6d6-208">0</span><span class="sxs-lookup"><span data-stu-id="4c6d6-208">0</span></span>       | <span data-ttu-id="4c6d6-209">16</span><span class="sxs-lookup"><span data-stu-id="4c6d6-209">16</span></span>      | <span data-ttu-id="4c6d6-210">4</span><span class="sxs-lookup"><span data-stu-id="4c6d6-210">4</span></span>     |
| <span data-ttu-id="4c6d6-211">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="4c6d6-211">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="4c6d6-212">Синтаксический анализ</span><span class="sxs-lookup"><span data-stu-id="4c6d6-212">Parse</span></span>           | <span data-ttu-id="4c6d6-213">2</span><span class="sxs-lookup"><span data-stu-id="4c6d6-213">2</span></span>        | <span data-ttu-id="4c6d6-214">0</span><span class="sxs-lookup"><span data-stu-id="4c6d6-214">0</span></span>       | <span data-ttu-id="4c6d6-215">16</span><span class="sxs-lookup"><span data-stu-id="4c6d6-215">16</span></span>      | <span data-ttu-id="4c6d6-216">4</span><span class="sxs-lookup"><span data-stu-id="4c6d6-216">4</span></span>     |
| <span data-ttu-id="4c6d6-217">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="4c6d6-217">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="4c6d6-218">логфилеврите</span><span class="sxs-lookup"><span data-stu-id="4c6d6-218">LogFileWrite</span></span>    | <span data-ttu-id="4c6d6-219">51</span><span class="sxs-lookup"><span data-stu-id="4c6d6-219">51</span></span>       | <span data-ttu-id="4c6d6-220">0</span><span class="sxs-lookup"><span data-stu-id="4c6d6-220">0</span></span>       | <span data-ttu-id="4c6d6-221">16</span><span class="sxs-lookup"><span data-stu-id="4c6d6-221">16</span></span>      | <span data-ttu-id="4c6d6-222">4</span><span class="sxs-lookup"><span data-stu-id="4c6d6-222">4</span></span>     |
| <span data-ttu-id="4c6d6-223">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="4c6d6-223">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="4c6d6-224">коннклеануп</span><span class="sxs-lookup"><span data-stu-id="4c6d6-224">ConnCleanup</span></span>     | <span data-ttu-id="4c6d6-225">24</span><span class="sxs-lookup"><span data-stu-id="4c6d6-225">24</span></span>       | <span data-ttu-id="4c6d6-226">0</span><span class="sxs-lookup"><span data-stu-id="4c6d6-226">0</span></span>       | <span data-ttu-id="4c6d6-227">16</span><span class="sxs-lookup"><span data-stu-id="4c6d6-227">16</span></span>      | <span data-ttu-id="4c6d6-228">4</span><span class="sxs-lookup"><span data-stu-id="4c6d6-228">4</span></span>     |
| <span data-ttu-id="4c6d6-229">Microsoft-Windows-Хттпсервице</span><span class="sxs-lookup"><span data-stu-id="4c6d6-229">Microsoft-Windows-HttpService</span></span> | <span data-ttu-id="4c6d6-230">коннтимедаут</span><span class="sxs-lookup"><span data-stu-id="4c6d6-230">ConnTimedOut</span></span>    | <span data-ttu-id="4c6d6-231">53</span><span class="sxs-lookup"><span data-stu-id="4c6d6-231">53</span></span>       | <span data-ttu-id="4c6d6-232">0</span><span class="sxs-lookup"><span data-stu-id="4c6d6-232">0</span></span>       | <span data-ttu-id="4c6d6-233">16</span><span class="sxs-lookup"><span data-stu-id="4c6d6-233">16</span></span>      | <span data-ttu-id="4c6d6-234">3</span><span class="sxs-lookup"><span data-stu-id="4c6d6-234">3</span></span>     |



 

<span data-ttu-id="4c6d6-235">Таблица 1. Выдержка из образца отчета трассировки для проблемы с таймером</span><span class="sxs-lookup"><span data-stu-id="4c6d6-235">Table 1: Excerpts from a Sample Trace Report for a Timer Issue</span></span>

<span data-ttu-id="4c6d6-236">В этом примере срок действия (Коннтимеаут) таймера заголовка (Timer \_ коннектионидле) является причиной того, что конечные пользователи видят сообщение "страница не может быть отображена" в своих веб-клиентах.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-236">In this example, the expiration (ConnTimeOut event) of the header timer (Timer\_ConnectionIdle) is the reason end-users see the "page cannot be displayed" message in their web clients.</span></span> <span data-ttu-id="4c6d6-237">Возможные причины истечения времени ожидания могут быть вызваны медленной отправкой веб-клиентов из-за медленных подключений.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-237">A potential reason for the timeout may be that Web clients are sending slowly due to slow connections.</span></span> <span data-ttu-id="4c6d6-238">Для решения этой проблемы значение времени ожидания можно изменить с помощью команд Netsh.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-238">To address this issue, the timeout value can be adjusted through Netsh commands.</span></span>

## <a name="adjusting-timeout-through-netsh-and-verifying-the-solution"></a><span data-ttu-id="4c6d6-239">Настройка времени ожидания с помощью команды netsh и проверка решения</span><span class="sxs-lookup"><span data-stu-id="4c6d6-239">Adjusting Timeout through Netsh and Verifying the Solution</span></span>

<span data-ttu-id="4c6d6-240">Команды Netsh для HTTP, перечисленные ниже, позволяют ИТ-специалистам просматривать и настраивать значения параметров в компоненте API сервера HTTP.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-240">The Netsh commands for HTTP listed below allow an IT professional to view and configure setting values on the HTTP Server API component.</span></span> <span data-ttu-id="4c6d6-241">Изменения с помощью команд Netsh HTTP влияют на все серверные приложения, размещенные компонентом API сервера HTTP для этого компьютера.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-241">Changes through Netsh HTTP commands affect all server applications hosted by the HTTP Server API component for that machine.</span></span> <span data-ttu-id="4c6d6-242">Эти изменения сохраняются во всех перезапусках компонента и перезагрузке компьютера.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-242">These changes persist across restarts of the component and reboots of the machine.</span></span> <span data-ttu-id="4c6d6-243">Команды netsh HTTP доступны в Windows Vista и Windows Server 2008 и заменяют средство HttpCfg.exe пакета ресурсов Windows Server 2003 при работе в Windows Vista и Windows Server 2008.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-243">The Netsh HTTP commands are available in Windows Vista and Windows Server 2008 and replace the Windows Server 2003 Resource Kit's HttpCfg.exe tool when running on Windows Vista and Windows Server 2008.</span></span> <span data-ttu-id="4c6d6-244">В этом сценарии мы будем изменять значение времени ожидания, а затем подтверждаю решение.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-244">In this scenario, we will adjust a timeout value and then verify the solution.</span></span> <span data-ttu-id="4c6d6-245">Таймеры существуют в компоненте API сервера HTTP для обеспечения доступности и защиты от чрезмерного использования неправильно настроенным или злонамеренным пользователем.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-245">Timers exist in the HTTP Server API component to ensure availability and protect against overconsumption by a misconfigured or malicious user.</span></span> <span data-ttu-id="4c6d6-246">Настройка таймеров из значений по умолчанию должна быть тщательно оценена с возможной атакой DoS.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-246">Adjusting timers from default values should be carefully evaluated against a potential DoS attack.</span></span>

<span data-ttu-id="4c6d6-247">В этом примере веб-клиенты находятся за сетевым подключением, что приводит к \_ событию таймера ETW коннектионидле.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-247">In this example, the web clients are behind a slow network connection, resulting in the Timer\_ConnectionIdle ETW event.</span></span> <span data-ttu-id="4c6d6-248">После рассмотрения причины истечения времени ожидания и балансировки с влиянием на нагрузку сервера принимается решение увеличить значения времени ожидания до 240 секунд.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-248">After consideration of the cause of the timeouts and balancing with the impact on the server's load, the decision is made to increase the timeout values to a value of 240 seconds.</span></span> <span data-ttu-id="4c6d6-249">Вы можете просмотреть и настроить таймер с помощью следующей процедуры.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-249">You can view and then configure the timer with the following procedure.</span></span>

<span data-ttu-id="4c6d6-250">**Настройка таймера простаивающих подключений (Timer \_ коннектионидле) с помощью команды netsh**</span><span class="sxs-lookup"><span data-stu-id="4c6d6-250">**Configure the idle connection timer (Timer\_ConnectionIdle) with Netsh**</span></span>

1.  <span data-ttu-id="4c6d6-251">На сервере откройте окно командной строки с повышенными привилегиями и выполните следующие действия, чтобы просмотреть и настроить значение времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-251">On the server, open an elevated command window and run the steps below to view and configure the timeout value.</span></span> <span data-ttu-id="4c6d6-252">Снимок экрана команды netsh HTTP показан на рис. 2 ниже.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-252">A screenshot of the Netsh HTTP command is shown in Figure 2 below.</span></span>
2.  <span data-ttu-id="4c6d6-253">Показывать текущие значения времени ожидания: **netsh http показывать время ожидания**</span><span class="sxs-lookup"><span data-stu-id="4c6d6-253">Show the current timeout values: **Netsh http show timeout**</span></span>
3.  <span data-ttu-id="4c6d6-254">Настройте \_ значение времени ожидания Коннектионидле таймера.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-254">Configure the Timer\_ConnectionIdle timeout value.</span></span> <span data-ttu-id="4c6d6-255">В этом примере значение изменяется на 240 секунд: **netsh http Add timeout тимеауттипе = idleconnectiontimeout значение = 240**</span><span class="sxs-lookup"><span data-stu-id="4c6d6-255">In this example, the value is changed to 240 seconds: **Netsh http add timeout timeouttype=idleconnectiontimeout value=240**</span></span>

![командное окно netsh http](images/netshhttpcommand.png)

<span data-ttu-id="4c6d6-257">Рис. 2. командное окно Netsh HTTP</span><span class="sxs-lookup"><span data-stu-id="4c6d6-257">Figure 2: Netsh HTTP command window</span></span>

<span data-ttu-id="4c6d6-258">После настройки значения времени ожидания перезапустите процедуры диагностики ETW.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-258">After configuring the timeout value, rerun the ETW diagnosis steps.</span></span> <span data-ttu-id="4c6d6-259">Если условие ошибки исправлено, трассировка ETW больше не должна показывать время ожидания с уровнем трассировки событий Windows "3" для таймера простоя подключения.</span><span class="sxs-lookup"><span data-stu-id="4c6d6-259">If the error condition is corrected, the ETW trace should no longer show a timeout with an ETW level of "3" for the connection idle timer.</span></span>

 

 




