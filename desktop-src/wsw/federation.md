---
title: Федерация
description: Федерация позволяет делегирование полномочий авторизации другим участникам компании Interprise.
ms.assetid: 574496df-95dc-45f7-8c42-e646aec12e69
keywords:
- Веб-службы федерации для Windows
- ввсапи
- WWS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 45a02744c9c0a5358da35f4c31c20633c420fee9
ms.sourcegitcommit: 5b98bf8c68922f8f03c14f793fbe17504900559c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/12/2021
ms.locfileid: "104565283"
---
# <a name="federation"></a><span data-ttu-id="982ae-106">Федерация</span><span class="sxs-lookup"><span data-stu-id="982ae-106">Federation</span></span>

<span data-ttu-id="982ae-107">Федерация позволяет делегирование полномочий авторизации другим участникам компании Interprise.</span><span class="sxs-lookup"><span data-stu-id="982ae-107">Federation allows the delegation of authorization authority to other members of an interprise.</span></span> <span data-ttu-id="982ae-108">Например, рассмотрим следующую бизнес-проблему: Компания "автоматическое производство" компании Contoso Ltd хочет предоставить полномочным сотрудникам клиента Fabrikam Inc безопасный доступ к веб-службе заказа частей contoso.</span><span class="sxs-lookup"><span data-stu-id="982ae-108">For example, consider the following business problem: The auto parts manufacturing company Contoso Ltd would like to allow authorized employees of its customer Fabrikam Inc to securely access Contoso's parts order Web Service.</span></span> <span data-ttu-id="982ae-109">Одно решение для обеспечения безопасности в этом сценарии заключается в том, чтобы компания Contoso настроила механизм доверия с компанией Fabrikam для делегирования решения об авторизации доступа в Fabrikam.</span><span class="sxs-lookup"><span data-stu-id="982ae-109">One security solution for this scenario is for Contoso to set up a trust mechanism with Fabrikam to delegate the access authorization decision to Fabrikam.</span></span> <span data-ttu-id="982ae-110">Этот процесс может работать следующим образом.</span><span class="sxs-lookup"><span data-stu-id="982ae-110">This process could work as follows:</span></span>

-   <span data-ttu-id="982ae-111">Fabrikam, когда она станет партнером Contoso, настраивает соглашение о доверии с contoso.</span><span class="sxs-lookup"><span data-stu-id="982ae-111">Fabrikam, when it becomes a partner of Contoso, sets up a trust agreement with Contoso.</span></span> <span data-ttu-id="982ae-112">Цель этого шага — согласиться с типом маркера безопасности и содержимым, которое будет представлять авторизацию Fabrikam и будет приемлемым для contoso.</span><span class="sxs-lookup"><span data-stu-id="982ae-112">The goal of this step is to agree on the security token type and content that will represent Fabrikam's authorization and will be acceptable to Contoso.</span></span> <span data-ttu-id="982ae-113">Например, может быть принято решение о том, что доверенный сертификат X. 509 с именем субъекта "CN = Fabrikam Inc поставщика STS" должен подписать маркер SAML для этого SAML, чтобы он принимался веб-службой contoso.</span><span class="sxs-lookup"><span data-stu-id="982ae-113">For example, it may be decided that a trusted X.509 certificate with subject name "CN=Fabrikam Inc Supplier STS" should sign a SAML token for that SAML to be accepted by the Contoso Web Service.</span></span> <span data-ttu-id="982ae-114">Кроме того, может быть принято решение о том, что утверждение безопасности в выданном токене SAML должно быть либо " https://schemas.contoso.com/claims/lookup " (для авторизации поиска части), либо " https://schemas.contoso.com/claims/order " (для авторизации с сортировкой деталей части).</span><span class="sxs-lookup"><span data-stu-id="982ae-114">Further, it may be decided that the security claim in the issued SAML token should be either 'https://schemas.contoso.com/claims/lookup' (for part lookup authorization) or 'https://schemas.contoso.com/claims/order' (for part ordering authorization).</span></span>
-   <span data-ttu-id="982ae-115">Когда сотрудник Fabrikam использует приложение для упорядочения внутренних частей, он сначала связывается со службой маркеров безопасности (STS) в Fabrikam.</span><span class="sxs-lookup"><span data-stu-id="982ae-115">When a Fabrikam employee uses the internal parts ordering application, it first contacts a security token service (STS) inside Fabrikam.</span></span> <span data-ttu-id="982ae-116">Этот сотрудник проходит проверку подлинности с помощью внутреннего механизма безопасности Fabrikam (скажем, имени пользователя домена Windows и пароля), проверяется его авторизация для частей заказа, а также выдается короткий токен SAML, содержащий соответствующие утверждения и подписанный сертификатом X. 509, который был выбран выше.</span><span class="sxs-lookup"><span data-stu-id="982ae-116">That employee is authenticated using the internal Fabrikam security mechanism (say, Windows domain username/password), his authorization to order parts is verified, and he is issued a short lived SAML token containing the appropriate claims and signed by the X.509 certificate decided above.</span></span> <span data-ttu-id="982ae-117">Затем приложение упорядочивает компоненты и обращается к службе Contoso, которая предоставляет выданный токен SAML для проверки подлинности и выполнения задачи упорядочения.</span><span class="sxs-lookup"><span data-stu-id="982ae-117">The parts ordering application then contacts the Contoso service presenting the issued SAML token to authenticate and perform the ordering task.</span></span>

<span data-ttu-id="982ae-118">Здесь компания Fabrikam STS выступает в качестве выдающего субъекта, а служба частей Contoso выступает в качестве проверяющей стороны.</span><span class="sxs-lookup"><span data-stu-id="982ae-118">Here, the Fabrikam STS acts as the 'issuing party' and the Contoso parts service acts as the 'relying party'.</span></span> ![Схема, показывающая выдающий субъект и проверяющую сторону в Федерации.](images/stsmodel.png)

## <a name="federation-features"></a><span data-ttu-id="982ae-120">Функции Федерации</span><span class="sxs-lookup"><span data-stu-id="982ae-120">Federation Features</span></span>

<span data-ttu-id="982ae-121">Ниже перечислены поддерживаемые функции безопасности для сторон или ролей, участвующих в сценарии Федерации.</span><span class="sxs-lookup"><span data-stu-id="982ae-121">The following are the supported security features for the parties or roles involved in a federation scenario:</span></span>

-   <span data-ttu-id="982ae-122">На стороне клиента: чтобы получить маркер безопасности от STS, можно использовать функцию [**всрекуестсекурититокен**](/windows/desktop/api/WebServices/nf-webservices-wsrequestsecuritytoken) .</span><span class="sxs-lookup"><span data-stu-id="982ae-122">Client-side: For obtaining the security token from the STS, one may use [**WsRequestSecurityToken**](/windows/desktop/api/WebServices/nf-webservices-wsrequestsecuritytoken) function.</span></span> <span data-ttu-id="982ae-123">Кроме того, можно использовать библиотеку поставщика маркеров безопасности на стороне клиента, например CardSpace или LiveID, а затем использовать их выходные данные для локального создания маркера безопасности с помощью [**вскреатексмлсекурититокен**](/windows/desktop/api/WebServices/nf-webservices-wscreatexmlsecuritytoken).</span><span class="sxs-lookup"><span data-stu-id="982ae-123">Alternatively, one may use a client side security token provider library such as CardSpace or LiveID, and then use their output to locally create a security token using [**WsCreateXmlSecurityToken**](/windows/desktop/api/WebServices/nf-webservices-wscreatexmlsecuritytoken).</span></span> <span data-ttu-id="982ae-124">В любом случае, когда у клиента есть маркер безопасности, он может создать канал для службы, указав [**\_ \_ \_ \_ \_ привязку безопасности сообщения токена WS XML**](/windows/desktop/api/WebServices/ns-webservices-ws_xml_token_message_security_binding) для представления маркера, а также привязку безопасности транспорта, например [**, \_ \_ \_ \_ привязку безопасности транспорта WS SSL**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding) для защиты канала.</span><span class="sxs-lookup"><span data-stu-id="982ae-124">Either way, once the client has the security token, it may then create a channel to the service specifying [**WS\_XML\_TOKEN\_MESSAGE\_SECURITY\_BINDING**](/windows/desktop/api/WebServices/ns-webservices-ws_xml_token_message_security_binding) to present the token, together with a transport security binding such as [**WS\_SSL\_TRANSPORT\_SECURITY\_BINDING**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding) to protect the channel.</span></span>
-   <span data-ttu-id="982ae-125">На стороне сервера. в сценарии Федерации со службой маркеров безопасности, которая выдает токены SAML, сервер может использовать [**\_ \_ \_ \_ привязку безопасности сообщений SAML**](/windows/desktop/api/WebServices/ns-webservices-ws_saml_message_security_binding), а также привязку безопасности транспорта, например, [**\_ \_ \_ \_ привязку безопасности транспорта WS SSL**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding) для защиты канала.</span><span class="sxs-lookup"><span data-stu-id="982ae-125">Server-side: In a federation scenario with a security token service that issues SAML tokens, the server may use the [**WS\_SAML\_MESSAGE\_SECURITY\_BINDING**](/windows/desktop/api/WebServices/ns-webservices-ws_saml_message_security_binding), together with a transport security binding such as [**WS\_SSL\_TRANSPORT\_SECURITY\_BINDING**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding) to protect the channel.</span></span>
-   <span data-ttu-id="982ae-126">STS-Side: Обратите внимание, что STS является приложением веб-службы и может указывать требования безопасности для тех, которые запрашивают маркер безопасности из него, используя структуру [**описания безопасности**](/windows/desktop/api/WebServices/ns-webservices-ws_security_description) во время создания прослушивателя точно так же, как любая другая безопасная веб-служба.</span><span class="sxs-lookup"><span data-stu-id="982ae-126">STS-side: Note that the STS is a Web Service application, and it can specify the security requirements for those requesting a security token from it using a [**security description**](/windows/desktop/api/WebServices/ns-webservices-ws_security_description) structure at listener creation time just as any other secure Web Service would.</span></span> <span data-ttu-id="982ae-127">Затем он может анализировать полезные данные сообщений о входящих запросах для проверки запросов маркера и отправки выданных маркеров в виде полезных данных ответного сообщения.</span><span class="sxs-lookup"><span data-stu-id="982ae-127">It may then parse incoming request message payloads to validate the token requests and send back issued tokens as reply message payloads.</span></span> <span data-ttu-id="982ae-128">В настоящее время не предоставляются никакие функции, помогающие выполнить синтаксический анализ и выполнение шагов.</span><span class="sxs-lookup"><span data-stu-id="982ae-128">Currently, no features are provided to help these parsing and issuing steps.</span></span>

<span data-ttu-id="982ae-129">Обратите внимание, что клиент может обрабатывать выданный маркер безопасности в универсальном виде в виде маркера безопасности XML без знания типа токена или обработки конкретного типа токена.</span><span class="sxs-lookup"><span data-stu-id="982ae-129">Note that the client side can handle the issued security token generically as an XML security token without knowing the token type, or doing token type specific processing.</span></span> <span data-ttu-id="982ae-130">Однако для понимания и обработки сервер должен понимать конкретный тип маркера безопасности.</span><span class="sxs-lookup"><span data-stu-id="982ae-130">However, the server has to understand the specific security token type in order to understand and process it.</span></span> <span data-ttu-id="982ae-131">В шагах запроса и ответа маркера безопасности используются конструкции, определенные в спецификации WS-Trust.</span><span class="sxs-lookup"><span data-stu-id="982ae-131">The security token request and response steps use the constructs defined in the WS-Trust specification.</span></span>

## <a name="more-complex-federation-scenarios"></a><span data-ttu-id="982ae-132">Более сложные сценарии Федерации</span><span class="sxs-lookup"><span data-stu-id="982ae-132">More Complex Federation Scenarios</span></span>

<span data-ttu-id="982ae-133">Сценарий федерации может содержать несколько службы маркеров безопасности, образующих цепочку Федерации.</span><span class="sxs-lookup"><span data-stu-id="982ae-133">A federation scenario may involve multiple STSs that form a federation chain.</span></span> <span data-ttu-id="982ae-134">Рассмотрим следующий пример.</span><span class="sxs-lookup"><span data-stu-id="982ae-134">Consider the following example:</span></span>

-   <span data-ttu-id="982ae-135">Клиент выполняет проверку подлинности в STS LiveID с помощью имени пользователя и пароля LiveID и получает маркер безопасности T1.</span><span class="sxs-lookup"><span data-stu-id="982ae-135">Client authenticates to the LiveID STS using a LiveID username/password, and obtains a security token T1.</span></span>
-   <span data-ttu-id="982ae-136">Клиент проходит проверку подлинности в STS1 с помощью T1 и получает маркер безопасности T2.</span><span class="sxs-lookup"><span data-stu-id="982ae-136">Client authenticates to STS1 using T1 and obtains a security token T2.</span></span>
-   <span data-ttu-id="982ae-137">Клиент проходит проверку подлинности в STS2 с помощью T2 и получает маркер безопасности T3.</span><span class="sxs-lookup"><span data-stu-id="982ae-137">Client authenticates to STS2 using T2 and obtains a security token T3.</span></span>
-   <span data-ttu-id="982ae-138">Клиент выполняет проверку подлинности целевой службы с помощью T3.</span><span class="sxs-lookup"><span data-stu-id="982ae-138">Client authenticates to the target service S using T3.</span></span>

<span data-ttu-id="982ae-139">В этом случае LiveID STS, STS1, STS2 и S формируют цепочку Федерации.</span><span class="sxs-lookup"><span data-stu-id="982ae-139">Here, the LiveID STS, STS1, STS2 and S form the federation chain.</span></span> <span data-ttu-id="982ae-140">Службы маркеров безопасности в цепочке Федерации может выполнять различные роли в общем сценарии приложения.</span><span class="sxs-lookup"><span data-stu-id="982ae-140">The STSs in a federation chain may perform various roles for the overall application scenario.</span></span> <span data-ttu-id="982ae-141">Примерами таких функциональных ролей STS являются поставщик удостоверений, принимающий решения авторизации, анонимизер и Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="982ae-141">Examples of such STS functional roles include identity provider, authorization decision maker, anonymizer, and resource manager.</span></span>

## <a name="sts-request-parameters-and-metadata-exchange"></a><span data-ttu-id="982ae-142">Параметры запроса STS и обмен метаданными</span><span class="sxs-lookup"><span data-stu-id="982ae-142">STS Request Parameters and Metadata Exchange</span></span>

<span data-ttu-id="982ae-143">Чтобы клиент смог выполнить успешный вызов [**всрекуестсекурититокен**](/windows/desktop/api/WebServices/nf-webservices-wsrequestsecuritytoken) , ему необходимо получить сведения о параметрах этого вызова (например, требуемый тип токена и типы утверждений), требования к [**описанию безопасности**](/windows/desktop/api/WebServices/ns-webservices-ws_security_description) канала запроса к службе STS и [адресу конечной точки](endpoint-address.md) STS.</span><span class="sxs-lookup"><span data-stu-id="982ae-143">For the client to make a successful [**WsRequestSecurityToken**](/windows/desktop/api/WebServices/nf-webservices-wsrequestsecuritytoken) call, it needs to know the parameters of that call (such as the required token type and claim types), the [**security description**](/windows/desktop/api/WebServices/ns-webservices-ws_security_description) requirements of the request channel to the STS, and the [endpoint address](endpoint-address.md) of the STS.</span></span> <span data-ttu-id="982ae-144">Клиентское приложение может использовать любой из следующих методов для определения этой информации:</span><span class="sxs-lookup"><span data-stu-id="982ae-144">The client application may use any of the following techniques for determining this information:</span></span>

-   <span data-ttu-id="982ae-145">Жестко закодировать сведения в приложении как часть решений во время разработки.</span><span class="sxs-lookup"><span data-stu-id="982ae-145">Hard code the information in the application as part of the design time decisions.</span></span>
-   <span data-ttu-id="982ae-146">Прочтите эти сведения из файла конфигурации уровня приложения, настроенного с помощью программы развертывания локального приложения.</span><span class="sxs-lookup"><span data-stu-id="982ae-146">Read this information from an application level configuration file set up by the local application deployer.</span></span>
-   <span data-ttu-id="982ae-147">Динамически обнаруживать эти сведения во время выполнения с помощью функции [импорта метаданных](metadata-import.md) с использованием структуры [**\_ \_ \_ \_ \_ \_ ограничения привязки безопасности сообщений токена WS**](/windows/desktop/api/WebServices/ns-webservices-ws_issued_token_message_security_binding_constraint) .</span><span class="sxs-lookup"><span data-stu-id="982ae-147">Dynamically discover this information at runtime using the [metadata import](metadata-import.md) feature with the [**WS\_ISSUED\_TOKEN\_MESSAGE\_SECURITY\_BINDING\_CONSTRAINT**](/windows/desktop/api/WebServices/ns-webservices-ws_issued_token_message_security_binding_constraint) structure.</span></span>

<span data-ttu-id="982ae-148">Чтобы проиллюстрировать использование динамического обмена метаданными с Федерацию, рассмотрим приведенный выше пример 3 STS.</span><span class="sxs-lookup"><span data-stu-id="982ae-148">To illustrate the use of dynamic MEX with federation, consider the 3 STS example above.</span></span> <span data-ttu-id="982ae-149">Клиент сначала выполняет динамическое обмен метаданными с S для получения сведений о T3 (т. е. о том, что нужно запросить из STS2), а также об динамическом адресе обмена STS2 (т. е. где найти STS2).</span><span class="sxs-lookup"><span data-stu-id="982ae-149">The client will first do a dynamic MEX with S to obtain information about T3 (i.e., what to ask from STS2) as well as the STS2 dynamic MEX address (i.e., where to find STS2).</span></span> <span data-ttu-id="982ae-150">Затем эти сведения будут использоваться для динамического обмена метаданными с STS2, чтобы получить сведения о T2 и STS1 и т. д.</span><span class="sxs-lookup"><span data-stu-id="982ae-150">It will then use that information to do a dynamic MEX with STS2 to discover information about T2 and STS1, and so on.</span></span>

<span data-ttu-id="982ae-151">Таким образом, операции динамического обмена метаданными выполняются в порядке 4, 3, 2, 1 для создания цепочки Федерации, а шаги запроса и представления маркера выполняются в порядке 1, 2, 3, 4 для очистки цепочки Федерации.</span><span class="sxs-lookup"><span data-stu-id="982ae-151">Thus, the dynamic MEX steps take place in the order 4, 3, 2, 1 to build up the federation chain and the token request and presentation steps take place in the order 1, 2, 3, 4 to unwind the federation chain.</span></span>

> [!Note]  
> <span data-ttu-id="982ae-152">Windows 7 и Windows Server 2008 R2: ВВСАПИ поддерживает только [WS-Trust](https://specs.xmlsoap.org/ws/2005/02/trust/WS-Trust.pdf) и [WS-SecureConversation](https://specs.xmlsoap.org/ws/2005/02/sc/WS-SecureConversation.pdf) в соответствии с определением [упрощенного WS-Security профиля (лвссп)](/openspecs/windows_protocols/ms-lwssp/376af2f8-f4fe-4577-bfd5-370ac12cac2e).</span><span class="sxs-lookup"><span data-stu-id="982ae-152">Windows 7 and Windows Server 2008 R2: WWSAPI only supports [Ws-Trust](https://specs.xmlsoap.org/ws/2005/02/trust/WS-Trust.pdf) and [Ws-SecureConversation](https://specs.xmlsoap.org/ws/2005/02/sc/WS-SecureConversation.pdf) as defined by [Lightweight Web Services Security Profile (LWSSP)](/openspecs/windows_protocols/ms-lwssp/376af2f8-f4fe-4577-bfd5-370ac12cac2e).</span></span> <span data-ttu-id="982ae-153">Дополнительные сведения о реализации Майкрософт см. в разделе [синтаксис сообщения](/openspecs/windows_protocols/ms-lwssp/d4f0f509-e14a-47b5-81e8-ade06a51d1ed) в лвссп.</span><span class="sxs-lookup"><span data-stu-id="982ae-153">For details regarding Microsoft's implementation please see the [MESSAGE Syntax](/openspecs/windows_protocols/ms-lwssp/d4f0f509-e14a-47b5-81e8-ade06a51d1ed) section of LWSSP.</span></span>

 

 

 