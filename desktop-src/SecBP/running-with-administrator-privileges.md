---
description: Чтобы предотвратить вредоносную атаку, определите, требуются ли для приложения права администратора. Для функций, требующих разрешений администратора, создайте отдельное приложение и используйте команду Windows RunAs Command Line.
ms.assetid: afa520fc-c206-49de-8d73-8f6566ec4fb6
title: Запуск с правами администратора
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dc28843195e9b5cabadc13aa2317b0bdd8058ef8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105664481"
---
# <a name="running-with-administrator-privileges"></a><span data-ttu-id="7b877-104">Запуск с правами администратора</span><span class="sxs-lookup"><span data-stu-id="7b877-104">Running with Administrator Privileges</span></span>

<span data-ttu-id="7b877-105">Первым шагом в определении типа учетной записи, которую необходимо выполнить для приложения, является проверка того, какие ресурсы будут использоваться приложением и какие привилегированные интерфейсы API будут вызываться.</span><span class="sxs-lookup"><span data-stu-id="7b877-105">The first step in establishing which type of account your application needs to run under is to examine what resources the application will use and what privileged APIs it will call.</span></span> <span data-ttu-id="7b877-106">Может оказаться, что приложение или его крупные части не требуют прав администратора.</span><span class="sxs-lookup"><span data-stu-id="7b877-106">You may find that the application, or large parts of it, do not require administrator privileges.</span></span> <span data-ttu-id="7b877-107">При *написании безопасного кода* Майкл Говард и Дэвид Леблана предлагают отличное описание того, как выполнять эту оценку и настоятельно рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="7b877-107">*Writing Secure Code*, by Michael Howard and David LeBlanc offers an excellent description of how to carry out this assessment and is highly recommended.</span></span> <span data-ttu-id="7b877-108">(Этот ресурс может быть недоступен в некоторых языках и странах.)</span><span class="sxs-lookup"><span data-stu-id="7b877-108">(This resource may not be available in some languages and countries.)</span></span>

<span data-ttu-id="7b877-109">Вы можете предоставить привилегии, необходимые приложению, с меньшим риском для вредоносных атак, используя один из следующих подходов:</span><span class="sxs-lookup"><span data-stu-id="7b877-109">You can provide the privileges your application needs with less exposure to malicious attack by using one of the following approaches:</span></span>

-   <span data-ttu-id="7b877-110">Запуск с учетной записью с меньшими привилегиями.</span><span class="sxs-lookup"><span data-stu-id="7b877-110">Run under an account with less privilege.</span></span> <span data-ttu-id="7b877-111">Один из способов сделать это — использовать [**привилежечекк**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-privilegecheck) , чтобы определить, какие привилегии включены в маркере.</span><span class="sxs-lookup"><span data-stu-id="7b877-111">One way to do this is to use [**PrivilegeCheck**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-privilegecheck) to determine what privileges are enabled in a token.</span></span> <span data-ttu-id="7b877-112">Если доступные привилегии не подходят для текущей операции, можно отключить этот код и попросить пользователя войти в учетную запись с правами администратора.</span><span class="sxs-lookup"><span data-stu-id="7b877-112">If the available privileges are not adequate for the current operation, you can disable that code and ask the user to logon to an account with administrator privileges.</span></span>
-   <span data-ttu-id="7b877-113">Разбейтесь на отдельные функции приложения, требующие разрешений администратора.</span><span class="sxs-lookup"><span data-stu-id="7b877-113">Break into a separate application functions that require administrator permissions.</span></span> <span data-ttu-id="7b877-114">Для пользователя можно указать ярлык, который выполняет команду RunAs.</span><span class="sxs-lookup"><span data-stu-id="7b877-114">You can provide for the user a shortcut that executes the RunAs command.</span></span> <span data-ttu-id="7b877-115">Чтобы получить подробные инструкции по настройке ярлыка, выполните поиск по фразе "runas" в справке.</span><span class="sxs-lookup"><span data-stu-id="7b877-115">For detailed instructions on how to set up the shortcut, search for "runas" in Help.</span></span> <span data-ttu-id="7b877-116">Программным путем можно настроить команду [runas](/windows/desktop/com/runas) в разделе реестра [ключей AppID](/windows/desktop/com/appid-key) для вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="7b877-116">Programmatically, you can configure the [RunAs](/windows/desktop/com/runas) command under the [AppId Key](/windows/desktop/com/appid-key) registry key for your application.</span></span>
-   <span data-ttu-id="7b877-117">Чтобы получить имя пользователя и пароль, необходимо выполнить аутентификацию пользователя, вызвав [**CredUIPromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduipromptforcredentialsa) (GUI) или [**кредуикмдлинепромптфоркредентиалс**](/windows/desktop/api/wincred/nf-wincred-creduicmdlinepromptforcredentialsa) (Командная строка).</span><span class="sxs-lookup"><span data-stu-id="7b877-117">Authenticate the user by calling [**CredUIPromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduipromptforcredentialsa) (GUI) or [**CredUICmdLinePromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduicmdlinepromptforcredentialsa) (command line) to obtain user name and password.</span></span> <span data-ttu-id="7b877-118">Пример см. в разделе [запрос учетных данных у пользователя](asking-the-user-for-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="7b877-118">For an example, see [Asking the User for Credentials](asking-the-user-for-credentials.md).</span></span>
-   <span data-ttu-id="7b877-119">Олицетворять пользователя.</span><span class="sxs-lookup"><span data-stu-id="7b877-119">Impersonate the user.</span></span> <span data-ttu-id="7b877-120">Процесс, который запускается под учетной записью с высоким уровнем привилегий, например System, может олицетворять учетную запись пользователя путем вызова [**имперсонателогжедонусер**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) или аналогичных функций олицетворения, таким образом уменьшая уровень привилегий.</span><span class="sxs-lookup"><span data-stu-id="7b877-120">A process that starts under a highly privileged account like System can impersonate a user account by calling [**ImpersonateLoggedOnUser**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) or similar Impersonate functions, thus reducing privilege level.</span></span> <span data-ttu-id="7b877-121">Однако если в поток внедряется вызов [**RevertToSelf**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-reverttoself) , процесс возвращается к исходным системным привилегиям.</span><span class="sxs-lookup"><span data-stu-id="7b877-121">However, if a call to [**RevertToSelf**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-reverttoself) is injected into the thread, the process returns to the original System privileges.</span></span>

<span data-ttu-id="7b877-122">Если вы определили, что приложение должно быть запущено от имени учетной записи с правами администратора и что пароль администратора должен храниться в программной системе, см. раздел [обработка паролей](handling-passwords.md) для безопасного использования методов.</span><span class="sxs-lookup"><span data-stu-id="7b877-122">If you have determined that your application must run under an account with administrator privileges and that an administrator password must be stored in the software system, see [Handling Passwords](handling-passwords.md) for methods of doing this safely.</span></span>

 

 
