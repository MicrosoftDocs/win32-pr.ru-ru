---
description: Чтобы избежать состояний гонки и взаимоблокировок, необходимо синхронизировать доступ нескольких потоков к общим ресурсам. Синхронизация также необходима, чтобы обеспечить выполнение взаимозависимого кода в соответствующей последовательности.
ms.assetid: 74af0502-dae1-438c-8e4b-7663093b3fe3
title: Синхронизация выполнения нескольких потоков
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c04a7e80f3c1d4ffdd874d9627a8212e26ee4923a5f2349bdebc4ff09299936c
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117793097"
---
# <a name="synchronizing-execution-of-multiple-threads"></a>Синхронизация выполнения нескольких потоков

Чтобы избежать состояний гонки и взаимоблокировок, необходимо синхронизировать доступ нескольких потоков к общим ресурсам. Синхронизация также необходима, чтобы обеспечить выполнение взаимозависимого кода в соответствующей последовательности.

Существует несколько объектов, дескрипторы которых можно использовать для синхронизации нескольких потоков. К этим объектам относятся:

-   Входные буферы консоли
-   События
-   Mutexes
-   Процессы
-   Семафоры
-   Потоки
-   Таймеры

Состояние каждого из этих объектов — «сигнальный» или «не сигнальный». При указании дескриптора любого из этих объектов в вызове одной из [функций ожидания](../sync/wait-functions.md)выполнение вызывающего потока блокируется до тех пор, пока состояние указанного объекта не станет сигнальным.

Некоторые из этих объектов полезны при блокировании потока, пока не произойдет некоторое событие. Например, дескриптор входного буфера консоли получает сигнал при наличии непрочтенных входных данных, таких как нажатие клавиши или нажатия кнопки мыши. Дескрипторы процессов и потоков получают сигнал при завершении процесса или потока. Это позволяет процессу, например, создать дочерний процесс, а затем блокировать его выполнение до завершения нового процесса.

Другие объекты полезны при защите общих ресурсов от одновременного доступа. Например, каждый поток может иметь обработчик для объекта мьютекса. Перед доступом к общему ресурсу потоки должны вызвать одну из [функций ожидания](../sync/wait-functions.md) , чтобы дождаться сигнала состояния мьютекса. Когда мьютекс становится сигнальным, освобождается только один ожидающий поток для доступа к ресурсу. Состояние мьютекса немедленно сбрасывается, чтобы не сигнализировать, чтобы все ожидающие потоки оставались заблокированными. Когда поток завершит работу с ресурсом, он должен установить состояние мьютекса в сигнальном состоянии, чтобы разрешить другим потокам доступ к ресурсу.

Для потоков одного процесса объекты критической секции предоставляют более эффективные средства синхронизации, чем мьютексы. Критическая секция используется как мьютекс, чтобы разрешить одному потоку за раз использовать защищенный ресурс. Поток может использовать функцию [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection) для запроса владения критическим разделом. Если он уже принадлежит другому потоку, то запрашивающий поток блокируется. Поток может использовать функцию [**трентеркритикалсектион**](/windows/win32/api/synchapi/nf-synchapi-tryentercriticalsection) для запроса владения критическим разделом, не блокируя при сбое получения критического раздела. После получения владения поток может свободно использовать защищенный ресурс. Выполнение других потоков процесса не затрагивается, пока не попытается войти в тот же самый критический раздел.

Функция [**ваитфоринпутидле**](/windows/desktop/api/Winuser/nf-winuser-waitforinputidle) делает поток ожидающим, пока заинициализируется указанный процесс, и ожидает ввода данных пользователем, не ожидая ввода. Вызов **ваитфоринпутидле** может быть полезен для синхронизации родительских и дочерних процессов, так как функция [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) возвращает, не дожидаясь завершения инициализации дочернего процесса.

Дополнительные сведения см. в разделе [Синхронизация](../sync/synchronization.md).

 

 
