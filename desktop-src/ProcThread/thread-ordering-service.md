---
description: Служба упорядочивания потоков управляет выполнением одного или нескольких клиентских потоков. Это гарантирует, что каждый клиентский поток выполняется один раз в течение указанного периода и относительный порядок.
ms.assetid: 5c37873a-ced4-447e-a6e1-55cfa8ab24b4
title: Служба упорядочивания потоков
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 72b3cd12b26124b47d506585425388a4542a70df
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673731"
---
# <a name="thread-ordering-service"></a><span data-ttu-id="7c991-104">Служба упорядочивания потоков</span><span class="sxs-lookup"><span data-stu-id="7c991-104">Thread Ordering Service</span></span>

<span data-ttu-id="7c991-105">*Служба упорядочивания потоков* управляет выполнением одного или нескольких клиентских потоков.</span><span class="sxs-lookup"><span data-stu-id="7c991-105">The *thread ordering service* controls the execution of one or more client threads.</span></span> <span data-ttu-id="7c991-106">Это гарантирует, что каждый клиентский поток выполняется один раз в течение указанного периода и относительный порядок.</span><span class="sxs-lookup"><span data-stu-id="7c991-106">It ensures that each client thread runs once during the specified period and in relative order.</span></span>

<span data-ttu-id="7c991-107">**Windows Server 2003 и Windows XP:** Служба упорядочивания потоков доступна начиная с Windows Vista и Windows Server 2008.</span><span class="sxs-lookup"><span data-stu-id="7c991-107">**Windows Server 2003 and Windows XP:** The thread ordering service is available starting with Windows Vista and Windows Server 2008.</span></span>

<span data-ttu-id="7c991-108">Служба упорядочивания потоков по умолчанию отключена и должна запускаться пользователем.</span><span class="sxs-lookup"><span data-stu-id="7c991-108">The thread ordering service is off by default and must be started by the user.</span></span> <span data-ttu-id="7c991-109">Пока служба упорядочения потоков запущена, она активируется каждые 5 секунд, чтобы проверить, существует ли новый запрос, даже если система бездействует.</span><span class="sxs-lookup"><span data-stu-id="7c991-109">While the thread ordering service is running, it is activated every 5 seconds to check whether there is a new request, even if the system is idle.</span></span> <span data-ttu-id="7c991-110">Это предотвращает выполнение системы в спящем режиме дольше 5 секунд, в результате чего система потребляет больше энергии.</span><span class="sxs-lookup"><span data-stu-id="7c991-110">This prevents the system from sleeping for longer than 5 seconds, causing the system to consume more power.</span></span> <span data-ttu-id="7c991-111">Если эффективность работы с энергопотреблением важна для приложения, лучше не использовать службу упорядочения потоков и вместо этого позволить системному планировщику управлять выполнением потоков.</span><span class="sxs-lookup"><span data-stu-id="7c991-111">If energy efficiency is critical to the application, it is better not to use the thread ordering service and instead allow the system scheduler to manage execution of threads.</span></span>

<span data-ttu-id="7c991-112">Каждый клиентский поток принадлежит *группе упорядочения потоков*.</span><span class="sxs-lookup"><span data-stu-id="7c991-112">Each client thread belongs to a *thread ordering group*.</span></span> <span data-ttu-id="7c991-113">*Родительский поток* создает одну или несколько групп упорядочивания потоков, вызывая функцию [**аврткреатесреадордерингграуп**](/windows/desktop/api/Avrt/nf-avrt-avrtcreatethreadorderinggroup) .</span><span class="sxs-lookup"><span data-stu-id="7c991-113">The *parent thread* creates one or more thread ordering groups by calling the [**AvRtCreateThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtcreatethreadorderinggroup) function.</span></span> <span data-ttu-id="7c991-114">Родительский поток использует эту функцию, чтобы указать период для группы упорядочения потоков и интервал времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="7c991-114">The parent thread uses this function to specify the period for the thread ordering group and a time-out interval.</span></span>

<span data-ttu-id="7c991-115">Дополнительные клиентские потоки вызывают функцию [**авртжоинсреадордерингграуп**](/windows/desktop/api/Avrt/nf-avrt-avrtjointhreadorderinggroup) , чтобы присоединиться к существующей группе упорядочения потоков.</span><span class="sxs-lookup"><span data-stu-id="7c991-115">Additional client threads call the [**AvRtJoinThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtjointhreadorderinggroup) function to join an existing thread ordering group.</span></span> <span data-ttu-id="7c991-116">Эти потоки указывают, должны ли они быть предшественником или последовательным для родительского потока в порядке выполнения.</span><span class="sxs-lookup"><span data-stu-id="7c991-116">These threads indicate whether they are to be a predecessor or successor to the parent thread in the execution order.</span></span> <span data-ttu-id="7c991-117">Предполагается, что каждый клиентский поток завершает определенный объем обработки в каждый период.</span><span class="sxs-lookup"><span data-stu-id="7c991-117">Each client thread is expected to complete a certain amount of processing each period.</span></span> <span data-ttu-id="7c991-118">Все потоки в группе должны завершить свое выполнение в течение периода плюс интервал времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="7c991-118">All threads within the group should complete their execution within the period plus the time-out interval.</span></span>

<span data-ttu-id="7c991-119">Потоки группы упорядочения потоков заключают свой код обработки в цикл, который управляется функцией [**авртваитонсреадордерингграуп**](/windows/desktop/api/Avrt/nf-avrt-avrtwaitonthreadorderinggroup) .</span><span class="sxs-lookup"><span data-stu-id="7c991-119">The threads of a thread ordering group enclose their processing code within a loop that is controlled by the [**AvRtWaitOnThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtwaitonthreadorderinggroup) function.</span></span> <span data-ttu-id="7c991-120">Во-первых, предшественники выполняются по одному в том порядке, в котором они присоединились к группе, тогда как родительские и последовательные потоки блокируются при вызове **авртваитонсреадордерингграуп**.</span><span class="sxs-lookup"><span data-stu-id="7c991-120">First, the predecessor threads are executed one at a time in the order that they joined the group, while the parent and successor threads are blocked on their calls to **AvRtWaitOnThreadOrderingGroup**.</span></span> <span data-ttu-id="7c991-121">При завершении обработки каждого предшественника потока управление выполнением возвращается к началу цикла обработки, а поток вызывает **авртваитонсреадордерингграуп** еще раз, чтобы заблокировать до следующей попытки.</span><span class="sxs-lookup"><span data-stu-id="7c991-121">When each predecessor thread is finished with its processing, control of execution returns to the top of its processing loop and the thread calls **AvRtWaitOnThreadOrderingGroup** again to block until its next turn.</span></span> <span data-ttu-id="7c991-122">После того как все предшественники вызвали эту функцию, служба упорядочения потоков может запланировать родительский поток.</span><span class="sxs-lookup"><span data-stu-id="7c991-122">After all predecessor threads have called this function, the thread ordering service can schedule the parent thread.</span></span> <span data-ttu-id="7c991-123">Наконец, когда родительский поток завершает свою обработку и вызывает **авртваитонсреадордерингграуп** еще раз, служба упорядочения потоков может запланировать потоки последователей по одному в том порядке, в котором они присоединились к группе.</span><span class="sxs-lookup"><span data-stu-id="7c991-123">Finally, when the parent thread finishes its processing and calls **AvRtWaitOnThreadOrderingGroup** again, the thread ordering service can schedule the successor threads one at a time in the order that they joined the group.</span></span> <span data-ttu-id="7c991-124">Если все потоки завершили свое выполнение до окончания периода, все потоки ожидают, пока не истечет оставшаяся часть периода.</span><span class="sxs-lookup"><span data-stu-id="7c991-124">If all threads complete their execution before a period ends, all threads wait until the remainder of the period elapses before any are executed again.</span></span>

<span data-ttu-id="7c991-125">Если клиент больше не должен выполняться как часть группы упорядочения потоков, он вызывает функцию [**авртлеавесреадордерингграуп**](/windows/desktop/api/Avrt/nf-avrt-avrtleavethreadorderinggroup) , чтобы удалить саму себя из группы.</span><span class="sxs-lookup"><span data-stu-id="7c991-125">When the client need no longer run as part of the thread ordering group, it calls the [**AvRtLeaveThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtleavethreadorderinggroup) function to remove itself from the group.</span></span> <span data-ttu-id="7c991-126">Обратите внимание, что родительский поток не должен удалять себя из группы упорядочения потоков.</span><span class="sxs-lookup"><span data-stu-id="7c991-126">Note that the parent thread should not remove itself from a thread ordering group.</span></span> <span data-ttu-id="7c991-127">Если поток не завершает свое выполнение до истечения периода, а также интервала времени ожидания, он удаляется из группы.</span><span class="sxs-lookup"><span data-stu-id="7c991-127">If a thread does not complete its execution before the period plus the time-out interval elapses, then it is deleted from the group.</span></span>

<span data-ttu-id="7c991-128">Родительский поток вызывает функцию [**авртделетесреадордерингграуп**](/windows/desktop/api/Avrt/nf-avrt-avrtdeletethreadorderinggroup) для удаления группы упорядочения потоков.</span><span class="sxs-lookup"><span data-stu-id="7c991-128">The parent thread calls the [**AvRtDeleteThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtdeletethreadorderinggroup) function to delete the thread ordering group.</span></span> <span data-ttu-id="7c991-129">Группа упорядочивания потоков также уничтожается, если родительский поток не завершает свое выполнение до истечения периода, а также интервала времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="7c991-129">The thread ordering group is also destroyed if the parent thread does not complete its execution before the period plus the time-out interval elapses.</span></span> <span data-ttu-id="7c991-130">При удалении группы упорядочения потоков все вызовы [**авртваитонсреадордерингграуп**](/windows/desktop/api/Avrt/nf-avrt-avrtwaitonthreadorderinggroup) из потоков этой группы завершаются сбоем или истечением времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="7c991-130">When the thread ordering group is destroyed, any calls to [**AvRtWaitOnThreadOrderingGroup**](/windows/desktop/api/Avrt/nf-avrt-avrtwaitonthreadorderinggroup) from threads of that group fail or time out.</span></span>

 

 



