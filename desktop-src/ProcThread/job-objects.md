---
description: Объект задания позволяет управлять группой процессов как единым целым. Объекты заданий являются намаблеными, защищаемыми объектами, совместно используемые объекты, которые управляют атрибутами связанных с ними процессов.
ms.assetid: 59296384-5e78-44dd-8019-f1df6668928b
title: Объекты заданий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 07e6d9758faf2b66f047ca60dbba91601b202b4c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104345472"
---
# <a name="job-objects"></a><span data-ttu-id="35fdd-104">Объекты заданий</span><span class="sxs-lookup"><span data-stu-id="35fdd-104">Job Objects</span></span>

<span data-ttu-id="35fdd-105">*Объект задания* позволяет управлять группами процессов как единым целым.</span><span class="sxs-lookup"><span data-stu-id="35fdd-105">A *job object* allows groups of processes to be managed as a unit.</span></span> <span data-ttu-id="35fdd-106">Объекты заданий являются намаблеными, защищаемыми объектами, совместно используемые объекты, которые управляют атрибутами связанных с ними процессов.</span><span class="sxs-lookup"><span data-stu-id="35fdd-106">Job objects are namable, securable, sharable objects that control attributes of the processes associated with them.</span></span> <span data-ttu-id="35fdd-107">Операции, выполняемые объектом задания, влияют на все связанные с ним процессы.</span><span class="sxs-lookup"><span data-stu-id="35fdd-107">Operations performed on a job object affect all processes associated with the job object.</span></span> <span data-ttu-id="35fdd-108">Примеры включают в себя применение ограничений, таких как размер рабочего набора и приоритет процесса или завершение всех процессов, связанных с заданием.</span><span class="sxs-lookup"><span data-stu-id="35fdd-108">Examples include enforcing limits such as working set size and process priority or terminating all processes associated with a job.</span></span>

-   [<span data-ttu-id="35fdd-109">Создание заданий</span><span class="sxs-lookup"><span data-stu-id="35fdd-109">Creating Jobs</span></span>](#creating-jobs)
-   [<span data-ttu-id="35fdd-110">Управление процессами в заданиях</span><span class="sxs-lookup"><span data-stu-id="35fdd-110">Managing Processes in Jobs</span></span>](#managing-processes-in-jobs)
-   [<span data-ttu-id="35fdd-111">Ограничения заданий и уведомления</span><span class="sxs-lookup"><span data-stu-id="35fdd-111">Job Limits and Notifications</span></span>](#job-limits-and-notifications)
-   [<span data-ttu-id="35fdd-112">Учет ресурсов для заданий</span><span class="sxs-lookup"><span data-stu-id="35fdd-112">Resource Accounting for Jobs</span></span>](#resource-accounting-for-jobs)
-   [<span data-ttu-id="35fdd-113">Управление объектами заданий</span><span class="sxs-lookup"><span data-stu-id="35fdd-113">Managing Job Objects</span></span>](#managing-job-objects)
-   [<span data-ttu-id="35fdd-114">Управление деревом процессов, использующим объекты заданий</span><span class="sxs-lookup"><span data-stu-id="35fdd-114">Managing a Process Tree that Uses Job Objects</span></span>](#managing-a-process-tree-that-uses-job-objects)

## <a name="creating-jobs"></a><span data-ttu-id="35fdd-115">Создание заданий</span><span class="sxs-lookup"><span data-stu-id="35fdd-115">Creating Jobs</span></span>

<span data-ttu-id="35fdd-116">Чтобы создать объект задания, используйте функцию [**креатежобобжект**](/windows/desktop/api/WinBase/nf-winbase-createjobobjecta) .</span><span class="sxs-lookup"><span data-stu-id="35fdd-116">To create a job object, use the [**CreateJobObject**](/windows/desktop/api/WinBase/nf-winbase-createjobobjecta) function.</span></span> <span data-ttu-id="35fdd-117">При создании задания ни один из процессов не связан с этим заданием.</span><span class="sxs-lookup"><span data-stu-id="35fdd-117">When the job is created, no processes are associated with the job.</span></span>

<span data-ttu-id="35fdd-118">Чтобы связать процесс с заданием, используйте функцию [**ассигнпроцесстожобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) .</span><span class="sxs-lookup"><span data-stu-id="35fdd-118">To associate a process with a job, use the [**AssignProcessToJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) function.</span></span> <span data-ttu-id="35fdd-119">После того как процесс связан с заданием, связь не может быть нарушена.</span><span class="sxs-lookup"><span data-stu-id="35fdd-119">After a process is associated with a job, the association cannot be broken.</span></span> <span data-ttu-id="35fdd-120">Процесс может быть связан с более чем одним заданием в иерархии вложенных заданий.</span><span class="sxs-lookup"><span data-stu-id="35fdd-120">A process can be associated with more than one job in a hierarchy of nested jobs.</span></span> <span data-ttu-id="35fdd-121">Дополнительные сведения см. в разделе [вложенные задания](nested-jobs.md).</span><span class="sxs-lookup"><span data-stu-id="35fdd-121">For more information, see [Nested Jobs](nested-jobs.md).</span></span>

<span data-ttu-id="35fdd-122">**Windows 7, Windows server 2008 R2, Windows XP с пакетом обновления 3 (SP3), Windows server 2008, Windows Vista и Windows server 2003:** Процесс может быть связан только с одним заданием.</span><span class="sxs-lookup"><span data-stu-id="35fdd-122">**Windows 7, Windows Server 2008 R2, Windows XP with SP3, Windows Server 2008, Windows Vista and Windows Server 2003:** A process can be associated with only one job.</span></span> <span data-ttu-id="35fdd-123">Задания не могут быть вложенными.</span><span class="sxs-lookup"><span data-stu-id="35fdd-123">Jobs cannot be nested.</span></span> <span data-ttu-id="35fdd-124">Возможность вложения заданий была добавлена в Windows 8 и Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="35fdd-124">The ability to nest jobs was added in Windows 8 and Windows Server 2012.</span></span>

<span data-ttu-id="35fdd-125">При вызове функции [**креатежобобжект**](/windows/desktop/api/WinBase/nf-winbase-createjobobjecta) можно указать дескриптор безопасности для объекта задания.</span><span class="sxs-lookup"><span data-stu-id="35fdd-125">You can specify a security descriptor for a job object when you call the [**CreateJobObject**](/windows/desktop/api/WinBase/nf-winbase-createjobobjecta) function.</span></span> <span data-ttu-id="35fdd-126">Дополнительные сведения см. в разделе [Задание безопасности и прав доступа объекта задания](job-object-security-and-access-rights.md).</span><span class="sxs-lookup"><span data-stu-id="35fdd-126">For more information, see [Job Object Security and Access Rights](job-object-security-and-access-rights.md).</span></span>

## <a name="managing-processes-in-jobs"></a><span data-ttu-id="35fdd-127">Управление процессами в заданиях</span><span class="sxs-lookup"><span data-stu-id="35fdd-127">Managing Processes in Jobs</span></span>

<span data-ttu-id="35fdd-128">После того как процесс связан с заданием, по умолчанию все дочерние процессы, создаваемые с помощью [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) , также связываются с заданием.</span><span class="sxs-lookup"><span data-stu-id="35fdd-128">After a process is associated with a job, by default any child processes it creates using [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) are also associated with the job.</span></span> <span data-ttu-id="35fdd-129">(Дочерние процессы, созданные с помощью [**Win32 \_ Process. Create**](../cimwin32prov/create-method-in-class-win32-process.md) , не связаны с заданием.) Это поведение по умолчанию можно изменить, установив для задания ограничение на объекты задания для расширенного ограничения \_ \_ \_ бреакавай \_ ОК или \_ объект задания \_ ограничение \_ автоматической \_ бреакавай \_ ОК.</span><span class="sxs-lookup"><span data-stu-id="35fdd-129">(Child processes created using [**Win32\_Process.Create**](../cimwin32prov/create-method-in-class-win32-process.md) are not associated with the job.) This default behavior can be changed by setting the extended limit JOB\_OBJECT\_LIMIT\_BREAKAWAY\_OK or JOB\_OBJECT\_LIMIT\_SILENT\_BREAKAWAY\_OK for the job.</span></span>

-   <span data-ttu-id="35fdd-130">Если в задании превышено ограничение на количество объектов задания с расширенным ограничением \_ \_ \_ бреакавай \_ ОК, а родительский процесс был создан с помощью \_ \_ флага создания бреакавай из \_ задания, то дочерние процессы родительского процесса не будут связаны с заданием.</span><span class="sxs-lookup"><span data-stu-id="35fdd-130">If the job has the extended limit JOB\_OBJECT\_LIMIT\_BREAKAWAY\_OK and the parent process was created with the CREATE\_BREAKAWAY\_FROM\_JOB flag, then child processes of the parent process are not associated with the job.</span></span>
-   <span data-ttu-id="35fdd-131">Если в задании превышено ограничение \_ на \_ число \_ \_ бреакавай ОК для задания \_ , то дочерние процессы любого родительского процесса, связанного с заданием, не будут связаны с этим заданием.</span><span class="sxs-lookup"><span data-stu-id="35fdd-131">If the job has the extended limit JOB\_OBJECT\_LIMIT\_SILENT\_BREAKAWAY\_OK, then child processes of any parent process associated with the job are not associated with the job.</span></span> <span data-ttu-id="35fdd-132">Не требуется создавать родительские процессы с \_ флагом Create бреакавай On \_ \_ Job.</span><span class="sxs-lookup"><span data-stu-id="35fdd-132">It is not necessary for parent processes to be created with the CREATE\_BREAKAWAY\_FROM\_JOB flag.</span></span>

<span data-ttu-id="35fdd-133">Если задание является вложенным, параметры бреакавай родительских заданий в иерархии влияют на то, связаны ли дочерние процессы с другим заданием в иерархии.</span><span class="sxs-lookup"><span data-stu-id="35fdd-133">If the job is nested, the breakaway settings of parent jobs in the hierarchy affect whether child processes are associated with another job in the hierarchy.</span></span> <span data-ttu-id="35fdd-134">Дополнительные сведения см. в разделе [вложенные задания](nested-jobs.md).</span><span class="sxs-lookup"><span data-stu-id="35fdd-134">For more information, see [Nested Jobs](nested-jobs.md).</span></span>

<span data-ttu-id="35fdd-135">Чтобы определить, выполняется ли процесс в задании, используйте функцию [**испроцессинжоб**](/windows/win32/api/jobapi/nf-jobapi-isprocessinjob) .</span><span class="sxs-lookup"><span data-stu-id="35fdd-135">To determine if a process is running in a job, use the [**IsProcessInJob**](/windows/win32/api/jobapi/nf-jobapi-isprocessinjob) function.</span></span>

<span data-ttu-id="35fdd-136">Чтобы завершить все процессы, связанные в данный момент с объектом задания, используйте функцию [**терминатежобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-terminatejobobject) .</span><span class="sxs-lookup"><span data-stu-id="35fdd-136">To terminate all processes currently associated with a job object, use the [**TerminateJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-terminatejobobject) function.</span></span>

## <a name="job-limits-and-notifications"></a><span data-ttu-id="35fdd-137">Ограничения заданий и уведомления</span><span class="sxs-lookup"><span data-stu-id="35fdd-137">Job Limits and Notifications</span></span>

<span data-ttu-id="35fdd-138">Задание может применять такие ограничения, как размер рабочего набора, приоритет процесса и ограничение времени окончания задания для каждого процесса, связанного с заданием.</span><span class="sxs-lookup"><span data-stu-id="35fdd-138">A job can enforce limits such as working set size, process priority, and end-of-job time limit on each process that is associated with the job.</span></span> <span data-ttu-id="35fdd-139">Если процесс, связанный с заданием, попытается увеличить размер рабочего набора или приоритет процесса по сравнению с ограничением, установленным заданием, функция вызывается удачно, но не обрабатывается автоматически.</span><span class="sxs-lookup"><span data-stu-id="35fdd-139">If a process associated with a job attempts to increase its working set size or process priority from the limit established by the job, the function calls succeed but are silently ignored.</span></span> <span data-ttu-id="35fdd-140">Задание также может задавать ограничения, которые активируют уведомление, если они превышены, но позволяют продолжить выполнение задания.</span><span class="sxs-lookup"><span data-stu-id="35fdd-140">A job can also set limits that trigger a notification when they are exceeded but allow the job to continue to run.</span></span>

<span data-ttu-id="35fdd-141">Чтобы задать ограничения для задания, используйте функцию [**сетинформатионжобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) .</span><span class="sxs-lookup"><span data-stu-id="35fdd-141">To set limits for a job, use the [**SetInformationJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) function.</span></span> <span data-ttu-id="35fdd-142">Список возможных ограничений, которые можно задать для задания, см. в следующих разделах:</span><span class="sxs-lookup"><span data-stu-id="35fdd-142">For a list of possible limits that can be set for a job, see the following topics:</span></span>

-   [<span data-ttu-id="35fdd-143">**\_ \_ сведения о базовом ОГРАНИЧЕНии жобобжект \_**</span><span class="sxs-lookup"><span data-stu-id="35fdd-143">**JOBOBJECT\_BASIC\_LIMIT\_INFORMATION**</span></span>](/windows/desktop/api/WinNT/ns-winnt-jobobject_basic_limit_information)
-   [<span data-ttu-id="35fdd-144">**\_базовые \_ ограничения ПОЛЬЗОВАТЕЛЬСКОГО интерфейса \_ жобобжект**</span><span class="sxs-lookup"><span data-stu-id="35fdd-144">**JOBOBJECT\_BASIC\_UI\_RESTRICTIONS**</span></span>](/windows/desktop/api/WinNT/ns-winnt-jobobject_basic_ui_restrictions)
-   [<span data-ttu-id="35fdd-145">**\_ \_ \_ сведения о контроле скорости ЦП жобобжект \_**</span><span class="sxs-lookup"><span data-stu-id="35fdd-145">**JOBOBJECT\_CPU\_RATE\_CONTROL\_INFORMATION**</span></span>](/windows/desktop/api/Winnt/ns-winnt-jobobject_cpu_rate_control_information)
-   [<span data-ttu-id="35fdd-146">**\_ \_ сведения о расширенном ОГРАНИЧЕНии жобобжект \_**</span><span class="sxs-lookup"><span data-stu-id="35fdd-146">**JOBOBJECT\_EXTENDED\_LIMIT\_INFORMATION**</span></span>](/windows/desktop/api/WinNT/ns-winnt-jobobject_extended_limit_information)
-   [<span data-ttu-id="35fdd-147">**\_ \_ сведения о лимите уведомлений жобобжект \_**</span><span class="sxs-lookup"><span data-stu-id="35fdd-147">**JOBOBJECT\_NOTIFICATION\_LIMIT\_INFORMATION**</span></span>](/windows/desktop/api/WinNT/ns-winnt-jobobject_notification_limit_information)

<span data-ttu-id="35fdd-148">Ограничения безопасности должны устанавливаться отдельно для каждого процесса, связанного с объектом задания.</span><span class="sxs-lookup"><span data-stu-id="35fdd-148">Security limits must be set individually for each process associated with a job object.</span></span> <span data-ttu-id="35fdd-149">Дополнительные сведения см. в разделе [Обработка безопасности и права доступа](process-security-and-access-rights.md).</span><span class="sxs-lookup"><span data-stu-id="35fdd-149">For more information, see [Process Security and Access Rights](process-security-and-access-rights.md).</span></span>

<span data-ttu-id="35fdd-150">**Windows XP с пакетом обновления 3 (SP3) и Windows Server 2003:** Функцию [**сетинформатионжобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) можно использовать для установки ограничений безопасности для всех процессов, связанных с объектом Job.</span><span class="sxs-lookup"><span data-stu-id="35fdd-150">**Windows XP with SP3 and Windows Server 2003:** The [**SetInformationJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) function can be used to set security limitations for all processes associated with a job object.</span></span> <span data-ttu-id="35fdd-151">Начиная с Windows Vista ограничения безопасности должны устанавливаться отдельно для каждого процесса, связанного с объектом задания.</span><span class="sxs-lookup"><span data-stu-id="35fdd-151">Starting with Windows Vista, security limits must be set individually for each process associated with a job object.</span></span>

<span data-ttu-id="35fdd-152">Если задание является вложенным, родительские задания в иерархии влияют на ограничение, применяемое для задания.</span><span class="sxs-lookup"><span data-stu-id="35fdd-152">If the job is nested, parent jobs in the hierarchy influence the limit that is enforced for the job.</span></span> <span data-ttu-id="35fdd-153">Дополнительные сведения см. в разделе [вложенные задания](nested-jobs.md).</span><span class="sxs-lookup"><span data-stu-id="35fdd-153">For more information, see [Nested Jobs](nested-jobs.md).</span></span>

<span data-ttu-id="35fdd-154">Если у задания есть связанный с ним порт завершения ввода-вывода, он может получать уведомления при превышении определенных пределов заданий.</span><span class="sxs-lookup"><span data-stu-id="35fdd-154">If the job has an associated I/O completion port, it can receive notifications when certain job limits are exceeded.</span></span> <span data-ttu-id="35fdd-155">Система отправляет сообщения на порт завершения при превышении предела или возникновении некоторых других событий.</span><span class="sxs-lookup"><span data-stu-id="35fdd-155">The system sends messages to the completion port when a limit is exceeded or certain other events occur.</span></span> <span data-ttu-id="35fdd-156">Чтобы связать порт завершения с заданием, используйте функцию [**сетинформатионжобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) с классом сведений об объекте задания **жобобжектассоЦиатекомплетионпортинформатион** и указателем на структуру [**\_ \_ \_ порта завершения связи жобобжект**](/windows/desktop/api/WinNT/ns-winnt-jobobject_associate_completion_port) .</span><span class="sxs-lookup"><span data-stu-id="35fdd-156">To associate a completion port with a job, use the [**SetInformationJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) function with the job object information class **JobObjectAssociateCompletionPortInformation** and a pointer to a [**JOBOBJECT\_ASSOCIATE\_COMPLETION\_PORT**](/windows/desktop/api/WinNT/ns-winnt-jobobject_associate_completion_port) structure.</span></span> <span data-ttu-id="35fdd-157">Это лучше сделать, если задание неактивно, чтобы уменьшить вероятность отсутствия уведомлений для процессов, состояние которых изменяется во время сопоставления порта завершения.</span><span class="sxs-lookup"><span data-stu-id="35fdd-157">It is best to do this when the job is inactive, to reduce the chance of missing notifications for processes whose states change during the association of the completion port.</span></span>

<span data-ttu-id="35fdd-158">Все сообщения отправляются непосредственно из задания, как если бы задание вызывало функцию [**PostQueuedCompletionStatus**](/windows/win32/api/ioapiset/nf-ioapiset-postqueuedcompletionstatus) .</span><span class="sxs-lookup"><span data-stu-id="35fdd-158">All messages are sent directly from the job as if the job had called the [**PostQueuedCompletionStatus**](/windows/win32/api/ioapiset/nf-ioapiset-postqueuedcompletionstatus) function.</span></span> <span data-ttu-id="35fdd-159">Чтобы получить сообщения, поток должен отслеживать порт завершения с помощью функции [**жеткуеуедкомплетионстатус**](/windows/win32/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) .</span><span class="sxs-lookup"><span data-stu-id="35fdd-159">A thread must monitor the completion port using the [**GetQueuedCompletionStatus**](/windows/win32/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) function to pick up the messages.</span></span> <span data-ttu-id="35fdd-160">Обратите внимание, что, за исключением ограничений, заданных в классе сведений **жобобжектнотификатионлимитинформатион** , Доставка сообщений на порт завершения не гарантируется. невозможность прибытия сообщения не обязательно означает, что событие не произошло.</span><span class="sxs-lookup"><span data-stu-id="35fdd-160">Note that, with the exception of limits set with the **JobObjectNotificationLimitInformation** information class, delivery of messages to the completion port is not guaranteed; failure of a message to arrive does not necessarily mean that the event did not occur.</span></span> <span data-ttu-id="35fdd-161">Уведомления об ограничениях, установленных с помощью **жобобжектнотификатионлимитинформатион** , гарантированно поступают на порт завершения.</span><span class="sxs-lookup"><span data-stu-id="35fdd-161">Notifications for limits set with **JobObjectNotificationLimitInformation** are guaranteed to arrive at the completion port.</span></span> <span data-ttu-id="35fdd-162">Список возможных сообщений см. в разделе [**жобобжект- \_ \_ \_ порт завершения связи**](/windows/desktop/api/WinNT/ns-winnt-jobobject_associate_completion_port).</span><span class="sxs-lookup"><span data-stu-id="35fdd-162">For a list of possible messages, see [**JOBOBJECT\_ASSOCIATE\_COMPLETION\_PORT**](/windows/desktop/api/WinNT/ns-winnt-jobobject_associate_completion_port).</span></span>

## <a name="resource-accounting-for-jobs"></a><span data-ttu-id="35fdd-163">Учет ресурсов для заданий</span><span class="sxs-lookup"><span data-stu-id="35fdd-163">Resource Accounting for Jobs</span></span>

<span data-ttu-id="35fdd-164">Объект задания записывает основные данные учета для всех связанных с ней процессов, включая завершенные.</span><span class="sxs-lookup"><span data-stu-id="35fdd-164">The job object records basic accounting information for all its associated processes, including those that have terminated.</span></span> <span data-ttu-id="35fdd-165">Чтобы получить эти сведения об учетных данных, используйте функцию [**куеринформатионжобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-queryinformationjobobject) .</span><span class="sxs-lookup"><span data-stu-id="35fdd-165">To retrieve this accounting information, use the [**QueryInformationJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-queryinformationjobobject) function.</span></span> <span data-ttu-id="35fdd-166">Список данных учета, сохраняемых для задания, см. в следующих разделах:</span><span class="sxs-lookup"><span data-stu-id="35fdd-166">For a list of the accounting information that is maintained for a job, see the following topics:</span></span>

-   [<span data-ttu-id="35fdd-167">**ЖОБОБЖЕКТ \_ основные \_ \_ сведения о учете**</span><span class="sxs-lookup"><span data-stu-id="35fdd-167">**JOBOBJECT\_BASIC\_ACCOUNTING\_INFORMATION**</span></span>](/windows/desktop/api/WinNT/ns-winnt-jobobject_basic_accounting_information)
-   [<span data-ttu-id="35fdd-168">**\_ \_ \_ \_ учетные данные жобобжект Basic и IO \_**</span><span class="sxs-lookup"><span data-stu-id="35fdd-168">**JOBOBJECT\_BASIC\_AND\_IO\_ACCOUNTING\_INFORMATION**</span></span>](/windows/desktop/api/WinNT/ns-winnt-jobobject_basic_and_io_accounting_information)

<span data-ttu-id="35fdd-169">Если объект задания является вложенным, данные учета для каждого дочернего задания суммируются в родительском задании.</span><span class="sxs-lookup"><span data-stu-id="35fdd-169">If the job object is nested, accounting information for each child job is aggregated in its parent job.</span></span> <span data-ttu-id="35fdd-170">Дополнительные сведения см. в разделе [вложенные задания](nested-jobs.md).</span><span class="sxs-lookup"><span data-stu-id="35fdd-170">For more information, see [Nested Jobs](nested-jobs.md).</span></span>

## <a name="managing-job-objects"></a><span data-ttu-id="35fdd-171">Управление объектами заданий</span><span class="sxs-lookup"><span data-stu-id="35fdd-171">Managing Job Objects</span></span>

<span data-ttu-id="35fdd-172">Состояние объекта задания задается сигнальным, когда все его процессы завершаются из-за превышения указанного предела времени завершения задания.</span><span class="sxs-lookup"><span data-stu-id="35fdd-172">The state of a job object is set to signaled when all of its processes are terminated because the specified end-of-job time limit has been exceeded.</span></span> <span data-ttu-id="35fdd-173">Используйте [**WaitForSingleObject**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject) или [**WaitForSingleObjectEx**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobjectex) для отслеживания объекта задания для этого события.</span><span class="sxs-lookup"><span data-stu-id="35fdd-173">Use [**WaitForSingleObject**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject) or [**WaitForSingleObjectEx**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobjectex) to monitor the job object for this event.</span></span>

<span data-ttu-id="35fdd-174">Чтобы получить маркер для существующего объекта задания, используйте функцию [**опенжобобжект**](/windows/desktop/api/WinBase/nf-winbase-openjobobjecta) и укажите имя, присвоенное объекту при его создании.</span><span class="sxs-lookup"><span data-stu-id="35fdd-174">To obtain a handle for an existing job object, use the [**OpenJobObject**](/windows/desktop/api/WinBase/nf-winbase-openjobobjecta) function and specify the name given to the object when it was created.</span></span> <span data-ttu-id="35fdd-175">Можно открыть только именованные объекты задания.</span><span class="sxs-lookup"><span data-stu-id="35fdd-175">Only named job objects can be opened.</span></span>

<span data-ttu-id="35fdd-176">Чтобы закрыть обработчик объекта задания, используйте функцию [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle) .</span><span class="sxs-lookup"><span data-stu-id="35fdd-176">To close a job object handle, use the [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle) function.</span></span> <span data-ttu-id="35fdd-177">Задание уничтожается, когда последний его обработчик был закрыт и все связанные с ним процессы были завершены.</span><span class="sxs-lookup"><span data-stu-id="35fdd-177">The job is destroyed when its last handle has been closed and all associated processes have been terminated.</span></span> <span data-ttu-id="35fdd-178">Однако если в задании задано \_ \_ ограничение на значение \_ Kill \_ для \_ задания \_ , закрытие последнего дескриптора объекта задания завершает все связанные процессы, а затем удаляет сам объект задания.</span><span class="sxs-lookup"><span data-stu-id="35fdd-178">However, if the job has the JOB\_OBJECT\_LIMIT\_KILL\_ON\_JOB\_CLOSE flag specified, closing the last job object handle terminates all associated processes and then destroys the job object itself.</span></span> <span data-ttu-id="35fdd-179">Если в вложенном задании задано \_ \_ ограничение \_ Kill \_ для объекта задания \_ \_ , заданное флагом закрытия задания, закрытие последнего дескриптора объекта задания завершает все процессы, связанные с заданием, и его дочерними заданиями в иерархии.</span><span class="sxs-lookup"><span data-stu-id="35fdd-179">If a nested job has the JOB\_OBJECT\_LIMIT\_KILL\_ON\_JOB\_CLOSE flag specified, closing the last job object handle terminates all processes associated with the job and its child jobs in the hierarchy.</span></span>

## <a name="managing-a-process-tree-that-uses-job-objects"></a><span data-ttu-id="35fdd-180">Управление деревом процессов, использующим объекты заданий</span><span class="sxs-lookup"><span data-stu-id="35fdd-180">Managing a Process Tree that Uses Job Objects</span></span>

<span data-ttu-id="35fdd-181">Начиная с Windows 8 и Windows Server 2012, приложение может использовать [вложенные задания](nested-jobs.md) для управления деревом процессов, использующим более одного объекта задания.</span><span class="sxs-lookup"><span data-stu-id="35fdd-181">Starting with Windows 8 and Windows Server 2012, an application can use [nested jobs](nested-jobs.md) to manage a process tree that uses more than one job object.</span></span> <span data-ttu-id="35fdd-182">Однако приложение, которое должно работать в Windows 7, Windows Server 2008 R2 или более ранних версиях Windows, не поддерживающих вложенные задания, должно управлять деревом процессов другими способами.</span><span class="sxs-lookup"><span data-stu-id="35fdd-182">However, an application that must run on Windows 7, Windows Server 2008 R2, or earlier versions of Windows that do not support nested jobs must manage the process tree in other ways.</span></span>

<span data-ttu-id="35fdd-183">Если средство должно управлять деревом процессов, использующим объекты заданий, и нельзя использовать вложенные задания, то как средство, так и члены дерева процессов должны взаимодействовать.</span><span class="sxs-lookup"><span data-stu-id="35fdd-183">If a tool must manage a process tree that uses job objects and it is not possible to use nested jobs, both the tool and the members of the process tree must cooperate.</span></span> <span data-ttu-id="35fdd-184">Используйте один из следующих методов.</span><span class="sxs-lookup"><span data-stu-id="35fdd-184">Use one of the following options:</span></span>

-   <span data-ttu-id="35fdd-185">Используйте объект задания ограничение предельного \_ \_ \_ \_ числа автоматически бреакавай \_ ОК.</span><span class="sxs-lookup"><span data-stu-id="35fdd-185">Use the JOB\_OBJECT\_LIMIT\_SILENT\_BREAKAWAY\_OK limit.</span></span> <span data-ttu-id="35fdd-186">Если средство использует это ограничение, оно не может отслеживать все дерево процессов.</span><span class="sxs-lookup"><span data-stu-id="35fdd-186">If the tool uses this limit, it cannot monitor an entire process tree.</span></span> <span data-ttu-id="35fdd-187">Средство может отслеживать только те процессы, которые он добавляет в задание.</span><span class="sxs-lookup"><span data-stu-id="35fdd-187">The tool can monitor only the processes it adds to the job.</span></span> <span data-ttu-id="35fdd-188">Если эти процессы создают дочерние процессы, они не связаны с заданием.</span><span class="sxs-lookup"><span data-stu-id="35fdd-188">If these processes create child processes, they are not associated with the job.</span></span> <span data-ttu-id="35fdd-189">В этом случае дочерние процессы могут быть связаны с другими объектами заданий.</span><span class="sxs-lookup"><span data-stu-id="35fdd-189">In this option, child processes can be associated with other job objects.</span></span>
-   <span data-ttu-id="35fdd-190">Используйте ограничение \_ объекта задания \_ ограничение \_ бреакавай \_ ОК.</span><span class="sxs-lookup"><span data-stu-id="35fdd-190">Use the JOB\_OBJECT\_LIMIT\_BREAKAWAY\_OK limit.</span></span> <span data-ttu-id="35fdd-191">Если средство использует это ограничение, оно может отслеживать все дерево процесса, за исключением тех процессов, которые в дереве явным образом прерываются из дерева.</span><span class="sxs-lookup"><span data-stu-id="35fdd-191">If the tool uses this limit, it can monitor the entire process tree, except for those processes that any member of the tree explicitly breaks away from the tree.</span></span> <span data-ttu-id="35fdd-192">Член дерева может создать дочерний процесс в новом объекте задания, вызвав функцию [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) с \_ \_ флагом Create бреакавай FROM \_ задания, а затем вызвав функцию [**ассигнпроцесстожобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) .</span><span class="sxs-lookup"><span data-stu-id="35fdd-192">A member of the tree can create a child process in a new job object by calling the [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) function with the CREATE\_BREAKAWAY\_FROM\_JOB flag, then calling the [**AssignProcessToJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) function.</span></span> <span data-ttu-id="35fdd-193">В противном случае член должен отреагировать на случаи, в которых **ассигнпроцесстожобобжект** завершается ошибкой.</span><span class="sxs-lookup"><span data-stu-id="35fdd-193">Otherwise, the member must handle cases in which **AssignProcessToJobObject** fails.</span></span>

    <span data-ttu-id="35fdd-194">Флаг создания \_ бреакавай \_ из \_ задания не оказывает никакого влияния, если средство не отслеживает дерево.</span><span class="sxs-lookup"><span data-stu-id="35fdd-194">The CREATE\_BREAKAWAY\_FROM\_JOB flag has no effect if the tree is not being monitored by the tool.</span></span> <span data-ttu-id="35fdd-195">Таким образом, это предпочтительный вариант, но он требует предварительного знания отслеживаемых процессов.</span><span class="sxs-lookup"><span data-stu-id="35fdd-195">Therefore, this is the preferred option, but it requires advance knowledge of the processes being monitored.</span></span>

-   <span data-ttu-id="35fdd-196">Запретите бреакавайс любого типа, установив для параметра задания \_ \_ ограничение \_ бреакавай ОК, \_ а объект задания не \_ \_ ограничивает \_ число автоматически \_ бреакавай \_ ОК.</span><span class="sxs-lookup"><span data-stu-id="35fdd-196">Prevent breakaways of any kind by setting neither the JOB\_OBJECT\_LIMIT\_BREAKAWAY\_OK nor the JOB\_OBJECT\_LIMIT\_SILENT\_BREAKAWAY\_OK limit.</span></span> <span data-ttu-id="35fdd-197">В этом случае средство может отслеживать все дерево процессов.</span><span class="sxs-lookup"><span data-stu-id="35fdd-197">In this option, the tool can monitor the entire process tree.</span></span> <span data-ttu-id="35fdd-198">Однако если дочерний процесс пытается связать себя или другой дочерний процесс с заданием путем вызова [**ассигнпроцесстожобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject), вызов завершится ошибкой.</span><span class="sxs-lookup"><span data-stu-id="35fdd-198">However, if a child process attempts to associate itself or another child process with a job by calling [**AssignProcessToJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject), the call will fail.</span></span> <span data-ttu-id="35fdd-199">Если процесс был разработан для того, чтобы быть связанным с конкретным заданием, этот сбой может препятствовать правильной работе процесса.</span><span class="sxs-lookup"><span data-stu-id="35fdd-199">If the process was designed to be associated with a specific job, this failure may prevent the process from working properly.</span></span>

 

 
