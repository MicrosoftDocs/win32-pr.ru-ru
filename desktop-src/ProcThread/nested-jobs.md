---
description: Приложение может использовать вложенные задания для управления подмножествами процессов. Вложенные задания также позволяют приложению, использующему задания, размещать другие приложения, которые также используют задания.
ms.assetid: FA22493B-CD29-49A7-BDAC-349FA96B8C9E
title: Вложенные задания
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: abf105c70ec8e83b395fcce56c6274d4838358bc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104567627"
---
# <a name="nested-jobs"></a>Вложенные задания

Приложение может использовать вложенные задания для управления подмножествами процессов. Вложенные задания также позволяют приложению, использующему задания, размещать другие приложения, которые также используют задания.

**Windows 7, Windows server 2008 R2, Windows XP с пакетом обновления 3 (SP3), Windows server 2008, Windows Vista и Windows server 2003:** Процесс может быть связан только с одним заданием. Вложенные задания были введены в Windows 8 и Windows Server 2012.

В этом разделе приводятся общие сведения о вложенности заданий и поведении вложенных заданий.

-   [Вложенные иерархии заданий](#nested-job-hierarchies)
-   [Создание вложенной иерархии заданий](#creating-a-nested-job-hierarchy)
-   [Ограничения заданий и уведомления для вложенных заданий](#job-limits-and-notifications-for-nested-jobs)
-   [Учет ресурсов для вложенных заданий](#resource-accounting-for-nested-jobs)
-   [Завершение вложенных заданий](#termination-of-nested-jobs)

Общие сведения о заданиях и объектах заданий см. в разделе [объекты задания](job-objects.md).

## <a name="nested-job-hierarchies"></a>Вложенные иерархии заданий

Вложенные задания имеют связь типа «родители-потомки», в которой каждое дочернее задание содержит подмножество процессов в родительском задании. Если процесс, уже находящийся в задании, добавляется в другое задание, задания вкладываются по умолчанию, если система может сформировать допустимую иерархию заданий и не имеет ограничений пользовательского интерфейса для наборов заданий ([**сетинформатионжобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) с **жобобжектбасикуирестриктионс**).

На рис. 1 показана иерархия заданий, содержащая дерево процессов с приоритетом от P0 до P7. Задание 1 — это *родительское задание* задания 2 и задания 4, которое является *предком* задания 3. Задание 2 является *прямым родителем* задания 3; Задание 3 является *непосредственным дочерним* элементом задания 2. Задания 1, 2 и 3 формируют *цепочку заданий* , в которой задания 1 и 2 являются *родительской цепочкой заданий* в задании 3. Конечное задание в цепочке заданий — это *Немедленное задание* процессов в этом задании. На рис. 1 Задание 3 — это немедленное задание процессов P2, P3 и P4.

![рис. 1. вложенная иерархия заданий, содержащая дерево процессов](images/nested-jobs-a.png)

Вложенные задания можно также использовать для управления группами одноранговых процессов. В иерархии заданий, показанной на рис. 2, задание 1 является родительским заданием задания 2. Обратите внимание, что иерархия заданий может содержать только часть дерева процессов. На рис. 2 P0 не находится в иерархии, но ее дочерние процессы P1 – P5.

![рис. 2. вложенная иерархия заданий, содержащая одноранговые процессы](images/nested-jobs-b.png)

## <a name="creating-a-nested-job-hierarchy"></a>Создание вложенной иерархии заданий

Процессы в иерархии заданий явно связаны с объектом задания с помощью функции [**ассигнпроцесстожобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) или неявно связаны во время создания процесса, то же, что и для автономных заданий. Порядок, в котором создаются задания и назначаются процессы, определяет, можно ли создать иерархию.

Чтобы создать иерархию заданий с помощью явной ассоциации, все объекты заданий должны быть созданы с помощью [**креатежобобжект**](/windows/desktop/api/WinBase/nf-winbase-createjobobjecta), затем [**ассигнпроцесстожобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) должен вызываться несколько раз, чтобы каждый процесс свяжет процесс с каждым заданием, которому он должен принадлежать. Чтобы убедиться в допустимости иерархии заданий, сначала назначьте всем процессам задание в корне иерархии, а затем назначьте подмножество процессов для непосредственного дочернего объекта задания и т. д. Если процессы назначены заданиям в этом порядке, дочернее задание всегда будет иметь подмножество процессов в родительском задании во время создания иерархии, которая необходима для вложенности. Если процессы назначены заданиям в случайном порядке, в некоторый момент дочернее задание будет содержать процессы, которые не находятся в родительском задании. Это запрещено вложением, и это приведет к сбою **ассигнпроцесстожобобжект** .

Когда процессы неявно связаны с заданием во время создания процесса, дочерний процесс связывается с каждым заданием в цепочке заданий родительского процесса. Если объект немедленного задания разрешает бреакавай, дочерний процесс выходит из объекта немедленного задания и из каждого задания в родительской цепочке заданий, перемещая иерархию до тех пор, пока не будет достигнуто задание, которое не допускает бреакавай. Если объект немедленного задания не допускает бреакавай, дочерний процесс не нарушается, даже если задания в его родительской цепочке заданий разрешены.

## <a name="job-limits-and-notifications-for-nested-jobs"></a>Ограничения заданий и уведомления для вложенных заданий

Для определенных ограничений ресурсов ограничение, заданное для заданий в родительской цепочке заданий, определяет *действующие ограничения* , которые применяются для дочернего задания. Эффективный предел для дочернего задания может быть более ограничивающим, чем ограничение его родителя, но не может быть менее ограничивающим. Например, если класс приоритета дочернего задания находится выше \_ \_ класса с нормальным приоритетом, \_ а его родительский класс приоритетного задания является нормальным \_ \_ , то эффективный предел для процессов в дочернем задании — это класс с нормальным \_ приоритетом \_ . Тем не менее, если класс приоритета дочернего задания находится ниже класса приоритетов \_ \_ \_ , эффективный предел для процессов в дочернем задании находится ниже \_ \_ класса приоритета "нормальный" \_ . Действующие ограничения применяются для класса приоритета, сходства, оплаты за фиксацию, предельного времени выполнения процесса, ограничения класса планирования и минимального и максимального рабочего набора. Дополнительные сведения об ограничениях конкретных ресурсов см. в разделе [ **сетинформатионжобобжект.**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject)

При возникновении определенных событий, таких как создание нового процесса или нарушение ограничения ресурсов, в порт завершения ввода-вывода, связанный с заданием, отправляется сообщение. Задание также может регистрироваться для получения уведомлений при превышении определенных ограничений. Для невложенного задания сообщение отправляется на порт завершения ввода-вывода, связанный с заданием. Для вложенного задания сообщение отправляется каждому порту завершения ввода-вывода, связанному с любым заданием в родительской цепочке заданий, вызвавшей сообщение. Дочернему заданию не требуется связанный порт завершения ввода-вывода для сообщений, которые он инициирует для отправки на порты завершения ввода-вывода родительских заданий, находящиеся выше в цепочке заданий. Дополнительные сведения о конкретных сообщениях см. в разделе [**жобобжект, \_ связанный с \_ \_ портом завершения**](/windows/desktop/api/WinNT/ns-winnt-jobobject_associate_completion_port).

## <a name="resource-accounting-for-nested-jobs"></a>Учет ресурсов для вложенных заданий

Сведения о учете ресурсов для вложенного задания описывают использование каждого процесса, связанного с этим заданием, включая процессы в дочерних заданиях. Поэтому каждое задание в цепочке заданий представляет сводные ресурсы, используемые собственными процессами, а также процессы каждого дочернего задания, расположенные ниже в цепочке заданий.

## <a name="termination-of-nested-jobs"></a>Завершение вложенных заданий

При завершении задания в иерархии заданий система завершает процессы в этом задании и все его дочерние задания, начиная с дочернего задания в нижней части иерархии. Необработанные ресурсы, используемые каждым прерванным процессом, направляются в родительское задание.

Для обработчика заданий должен быть \_ \_ завершен доступ к объекту задания, как и для автономных заданий.

 

 
