---
description: С помощью локального хранилища потоков (TLS) можно предоставить уникальные данные для каждого потока, к которому процесс может получить доступ с помощью глобального индекса. Один поток выделяет индекс, который может использоваться другими потоками для получения уникальных данных, связанных с индексом.
ms.assetid: 40df7410-64d6-4edd-8009-d9c3d2aca920
title: локальное хранилище потока
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e17d2ff7a1ff253ce5a20b3921cc9605bf2989f6
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/03/2021
ms.locfileid: "104557665"
---
# <a name="thread-local-storage"></a>локальное хранилище потока

Все потоки процесса используют общий диапазон виртуальных адресов. Локальные переменные функции уникальны для каждого потока, который выполняет функцию. Однако статические и глобальные переменные совместно используются всеми потоками в процессе. С помощью *локального хранилища потоков* (TLS) можно предоставить уникальные данные для каждого потока, к которому процесс может получить доступ с помощью глобального индекса. Один поток выделяет индекс, который может использоваться другими потоками для получения уникальных данных, связанных с индексом.

\_Минимальная \_ величина постоянного TLS определяет минимальное количество ИНДЕКСов TLS, доступных в каждом процессе. Этот минимум гарантированно должен быть не менее 64 для всех систем. Максимальное количество индексов на процесс — 1 088.

При создании потоков система выделяет массив значений **лпвоид** для TLS, которые ИНИЦИАЛИЗИРУЮТСЯ значением NULL. Прежде чем индекс можно будет использовать, он должен быть выделен одним из потоков. Каждый поток хранит свои данные для индекса TLS в *слоте TLS* в массиве. Если данные, связанные с индексом, будут помещаться в значение **лпвоид** , данные можно хранить непосредственно в слоте TLS. Однако, если используется большое количество индексов таким образом, лучше выделить отдельное хранилище, консолидировать данные и свести к минимальному количеству используемых слотов TLS.

На следующей схеме показано, как работает TLS. Пример кода, иллюстрирующий использование локального хранилища потока, см. в разделе [использование локального хранилища потока](using-thread-local-storage.md).

![Схема, на которой показано, как работает процесс T L S.](images/tls.png)

Процесс имеет два потока: поток 1 и поток 2. Он выделяет два индекса для использования с TLS, gdwTlsIndex1 и gdwTlsIndex2. Каждый поток выделяет два блока памяти (по одному для каждого индекса), в которых хранятся данные, и сохраняет указатели на эти блоки памяти в соответствующих слотах TLS. Для доступа к данным, связанным с индексом, поток получает указатель на блок памяти из слота TLS и сохраняет его в локальной переменной Лпвдата.

Лучше использовать TLS в библиотеке динамической компоновки (DLL). Пример см. в разделе [использование локального хранилища потоков в библиотеке динамической компоновки](../dlls/using-thread-local-storage-in-a-dynamic-link-library.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Локальное хранилище потока (Visual C++)](/cpp/parallel/thread-local-storage-tls?view=vs-2019)
</dt> <dt>

[Использование локального хранилища потоков](using-thread-local-storage.md)
</dt> <dt>

[Использование локального хранилища потока в библиотеке динамической компоновки](../dlls/using-thread-local-storage-in-a-dynamic-link-library.md)
</dt> </dl>

 

 
