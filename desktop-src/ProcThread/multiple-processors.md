---
description: 'Компьютеры с несколькими процессорами обычно разрабатываются для одной из двух архитектур: неоднородный доступ к памяти (NUMA) или симметричная многопроцессорная обработка (SMP).'
ms.assetid: 3c9186c8-a54d-4536-8237-bfff78cc7d11
title: Несколько процессоров
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0093404a0df653a153823915f1ac72b5e41d50c0
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673763"
---
# <a name="multiple-processors"></a><span data-ttu-id="3b0ab-103">Несколько процессоров</span><span class="sxs-lookup"><span data-stu-id="3b0ab-103">Multiple Processors</span></span>

<span data-ttu-id="3b0ab-104">Компьютеры с несколькими процессорами обычно разрабатываются для одной из двух архитектур: неоднородный доступ к памяти (NUMA) или симметричная многопроцессорная обработка (SMP).</span><span class="sxs-lookup"><span data-stu-id="3b0ab-104">Computers with multiple processors are typically designed for one of two architectures: non-uniform memory access (NUMA) or symmetric multiprocessing (SMP).</span></span>

<span data-ttu-id="3b0ab-105">На компьютере NUMA каждый процессор находится ближе к некоторым частям памяти, чем другие, что позволяет ускорить доступ к памяти для некоторых частей памяти, чем другие части.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-105">In a NUMA computer, each processor is closer to some parts of memory than others, making memory access faster for some parts of memory than other parts.</span></span> <span data-ttu-id="3b0ab-106">В модели NUMA система пытается запланировать потоки на процессоры, близкие к используемой памяти.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-106">Under the NUMA model, the system attempts to schedule threads on processors that are close to the memory being used.</span></span> <span data-ttu-id="3b0ab-107">Дополнительные сведения о NUMA см. в разделе [Поддержка NUMA](numa-support.md).</span><span class="sxs-lookup"><span data-stu-id="3b0ab-107">For more information about NUMA, see [NUMA Support](numa-support.md).</span></span>

<span data-ttu-id="3b0ab-108">На компьютере SMP два или более идентичных процессоров или ядер подключаются к одной общей основной памяти.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-108">In an SMP computer, two or more identical processors or cores connect to a single shared main memory.</span></span> <span data-ttu-id="3b0ab-109">В модели SMP любой поток может быть назначен любому процессору.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-109">Under the SMP model, any thread can be assigned to any processor.</span></span> <span data-ttu-id="3b0ab-110">Поэтому планирование потоков на компьютере SMP аналогично планированию потоков на компьютере с одним процессором.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-110">Therefore, scheduling threads on an SMP computer is similar to scheduling threads on a computer with a single processor.</span></span> <span data-ttu-id="3b0ab-111">Однако планировщик имеет пул процессоров, что позволяет планировать параллельное выполнение потоков.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-111">However, the scheduler has a pool of processors, so that it can schedule threads to run concurrently.</span></span> <span data-ttu-id="3b0ab-112">Планирование по-прежнему определяется приоритетом потоков, но на него можно повлиять, установив сходство потоков и идеальный процессор для потоков, как описано в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-112">Scheduling is still determined by thread priority, but it can be influenced by setting thread affinity and thread ideal processor, as discussed in this topic.</span></span>

## <a name="thread-affinity"></a><span data-ttu-id="3b0ab-113">Сходство потоков</span><span class="sxs-lookup"><span data-stu-id="3b0ab-113">Thread Affinity</span></span>

<span data-ttu-id="3b0ab-114">*Сходство потоков* заставляет поток выполняться на определенном подмножестве процессоров.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-114">*Thread affinity* forces a thread to run on a specific subset of processors.</span></span> <span data-ttu-id="3b0ab-115">Обычно следует избегать установки сходства потоков, так как это может помешать планировщику эффективно планировать потоки между процессорами.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-115">Setting thread affinity should generally be avoided, because it can interfere with the scheduler's ability to schedule threads effectively across processors.</span></span> <span data-ttu-id="3b0ab-116">Это может снизить производительность, вызванную параллельной обработкой.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-116">This can decrease the performance gains produced by parallel processing.</span></span> <span data-ttu-id="3b0ab-117">Правильное использование сходства потоков — тестирование каждого процессора.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-117">An appropriate use of thread affinity is testing each processor.</span></span>

<span data-ttu-id="3b0ab-118">Система представляет сходство с битовой маской, называемой маской сходства процессоров.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-118">The system represents affinity with a bitmask called a processor affinity mask.</span></span> <span data-ttu-id="3b0ab-119">Маска сходства — это размер максимального числа процессоров в системе, для которых задано значение BITS для распознавания подмножества процессоров.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-119">The affinity mask is the size of the maximum number of processors in the system, with bits set to identify a subset of processors.</span></span> <span data-ttu-id="3b0ab-120">Изначально система определяет подмножество процессоров в маске.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-120">Initially, the system determines the subset of processors in the mask.</span></span>

<span data-ttu-id="3b0ab-121">Можно получить текущее сходство потоков для всех потоков процесса, вызвав функцию [**жетпроцессаффинитимаск**](/windows/desktop/api/WinBase/nf-winbase-getprocessaffinitymask) .</span><span class="sxs-lookup"><span data-stu-id="3b0ab-121">You can obtain the current thread affinity for all threads of the process by calling the [**GetProcessAffinityMask**](/windows/desktop/api/WinBase/nf-winbase-getprocessaffinitymask) function.</span></span> <span data-ttu-id="3b0ab-122">Используйте функцию [**сетпроцессаффинитимаск**](/windows/desktop/api/WinBase/nf-winbase-setprocessaffinitymask) , чтобы указать сходство потоков для всех потоков процесса.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-122">Use the [**SetProcessAffinityMask**](/windows/desktop/api/WinBase/nf-winbase-setprocessaffinitymask) function to specify thread affinity for all threads of the process.</span></span> <span data-ttu-id="3b0ab-123">Чтобы задать сходство потоков для одного потока, используйте функцию [**сетсреадаффинитимаск**](/windows/desktop/api/WinBase/nf-winbase-setthreadaffinitymask) .</span><span class="sxs-lookup"><span data-stu-id="3b0ab-123">To set the thread affinity for a single thread, use the [**SetThreadAffinityMask**](/windows/desktop/api/WinBase/nf-winbase-setthreadaffinitymask) function.</span></span> <span data-ttu-id="3b0ab-124">Сходство потоков должно быть подмножеством сходства процесса.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-124">The thread affinity must be a subset of the process affinity.</span></span>

<span data-ttu-id="3b0ab-125">В системах с более чем 64 процессорами маска сходства изначально представляет процессоры в одной группе процессоров.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-125">On systems with more than 64 processors, the affinity mask initially represents processors in a single processor group.</span></span> <span data-ttu-id="3b0ab-126">Однако сходство потоков можно задать для процессора в другой группе, которая изменяет маску сходства для процесса.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-126">However, thread affinity can be set to a processor in a different group, which alters the affinity mask for the process.</span></span> <span data-ttu-id="3b0ab-127">Дополнительные сведения см. в разделе [группы процессоров](processor-groups.md).</span><span class="sxs-lookup"><span data-stu-id="3b0ab-127">For more information, see [Processor Groups](processor-groups.md).</span></span>

## <a name="thread-ideal-processor"></a><span data-ttu-id="3b0ab-128">Идеальный для потоков процессор</span><span class="sxs-lookup"><span data-stu-id="3b0ab-128">Thread Ideal Processor</span></span>

<span data-ttu-id="3b0ab-129">При указании *идеального обработчика потока* планировщик по возможности запускает поток на указанном процессоре.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-129">When you specify a *thread ideal processor*, the scheduler runs the thread on the specified processor when possible.</span></span> <span data-ttu-id="3b0ab-130">Используйте функцию [**сетсреадидеалпроцессор**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadidealprocessor) , чтобы указать предпочтительный процессор для потока.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-130">Use the [**SetThreadIdealProcessor**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadidealprocessor) function to specify a preferred processor for a thread.</span></span> <span data-ttu-id="3b0ab-131">Это не гарантирует, что идеальный процессор будет выбран, но вы получите полезное указание планировщику.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-131">This does not guarantee that the ideal processor will be chosen but provides a useful hint to the scheduler.</span></span> <span data-ttu-id="3b0ab-132">В системах с более чем 64 процессорами можно использовать функцию [**сетсреадидеалпроцессорекс**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadidealprocessorex) для указания предпочтительного процессора в определенной группе процессоров.</span><span class="sxs-lookup"><span data-stu-id="3b0ab-132">On systems with more than 64 processors, you can use the [**SetThreadIdealProcessorEx**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadidealprocessorex) function to specify a preferred processor in a specific processor group.</span></span>

## <a name="related-topics"></a><span data-ttu-id="3b0ab-133">См. также</span><span class="sxs-lookup"><span data-stu-id="3b0ab-133">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3b0ab-134">Поддержка NUMA</span><span class="sxs-lookup"><span data-stu-id="3b0ab-134">NUMA Support</span></span>](numa-support.md)
</dt> <dt>

[<span data-ttu-id="3b0ab-135">Группы процессоров</span><span class="sxs-lookup"><span data-stu-id="3b0ab-135">Processor Groups</span></span>](processor-groups.md)
</dt> </dl>

 

 
