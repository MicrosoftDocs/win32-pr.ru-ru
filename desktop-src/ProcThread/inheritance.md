---
description: Дочерний процесс может наследовать несколько свойств и ресурсов от своего родительского процесса.
ms.assetid: c530e723-2d40-4022-a259-dfc650604e44
title: Наследование (процессы и потоки)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4713fe398360b510fab3c66f5cf74dc07b642dac
ms.sourcegitcommit: 3d718d8f69d3f86eaecf94c5705d761c5a9ef4a1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/20/2020
ms.locfileid: "105672427"
---
# <a name="inheritance"></a><span data-ttu-id="ded60-103">Наследование</span><span class="sxs-lookup"><span data-stu-id="ded60-103">Inheritance</span></span>

<span data-ttu-id="ded60-104">Дочерний процесс может наследовать несколько свойств и ресурсов от своего родительского процесса.</span><span class="sxs-lookup"><span data-stu-id="ded60-104">A child process can inherit several properties and resources from its parent process.</span></span> <span data-ttu-id="ded60-105">Кроме того, дочерний процесс может не допустить наследования свойств родительского процесса.</span><span class="sxs-lookup"><span data-stu-id="ded60-105">You can also prevent a child process from inheriting properties from its parent process.</span></span> <span data-ttu-id="ded60-106">Может быть унаследовано следующее:</span><span class="sxs-lookup"><span data-stu-id="ded60-106">The following can be inherited:</span></span>

-   <span data-ttu-id="ded60-107">Открытые дескрипторы, возвращаемые функцией [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) .</span><span class="sxs-lookup"><span data-stu-id="ded60-107">Open handles returned by the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function.</span></span> <span data-ttu-id="ded60-108">К ним относятся дескрипторы файлов, Входные буферы консоли, буферы экранов консоли, именованные каналы, устройства с последовательным обменом данными и маилслотс.</span><span class="sxs-lookup"><span data-stu-id="ded60-108">This includes handles to files, console input buffers, console screen buffers, named pipes, serial communication devices, and mailslots.</span></span>
-   <span data-ttu-id="ded60-109">Открытые дескрипторы для обработки, потока, мьютекса, события, семафора, именованного канала, анонимного канала и сопоставления файлов.</span><span class="sxs-lookup"><span data-stu-id="ded60-109">Open handles to process, thread, mutex, event, semaphore, named-pipe, anonymous-pipe, and file-mapping objects.</span></span> <span data-ttu-id="ded60-110">Эти функции возвращаются с помощью функций [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa), [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateMutex**](/windows/desktop/api/synchapi/nf-synchapi-createmutexa), [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa), [**createsemaphore-**](/windows/desktop/api/winbase/nf-winbase-createsemaphorea), [**креатенамедпипе**](/windows/desktop/api/winbase/nf-winbase-createnamedpipea), [**креатепипе**](/windows/desktop/api/namedpipeapi/nf-namedpipeapi-createpipe)и [**CreateFileMapping**](/windows/desktop/api/winbase/nf-winbase-createfilemappinga) соответственно.</span><span class="sxs-lookup"><span data-stu-id="ded60-110">These are returned by the [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa), [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateMutex**](/windows/desktop/api/synchapi/nf-synchapi-createmutexa), [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa), [**CreateSemaphore**](/windows/desktop/api/winbase/nf-winbase-createsemaphorea), [**CreateNamedPipe**](/windows/desktop/api/winbase/nf-winbase-createnamedpipea), [**CreatePipe**](/windows/desktop/api/namedpipeapi/nf-namedpipeapi-createpipe), and [**CreateFileMapping**](/windows/desktop/api/winbase/nf-winbase-createfilemappinga) functions, respectively.</span></span>
-   <span data-ttu-id="ded60-111">Переменные среды.</span><span class="sxs-lookup"><span data-stu-id="ded60-111">Environment variables.</span></span>
-   <span data-ttu-id="ded60-112">Текущий каталог.</span><span class="sxs-lookup"><span data-stu-id="ded60-112">The current directory.</span></span>
-   <span data-ttu-id="ded60-113">Консоль, если процесс не отсоединяется или не создается новая консоль.</span><span class="sxs-lookup"><span data-stu-id="ded60-113">The console, unless the process is detached or a new console is created.</span></span> <span data-ttu-id="ded60-114">Процесс дочерней консоли также может наследовать стандартные дескрипторы родительского элемента, а также доступ к входному буферу и активному буферу экрана.</span><span class="sxs-lookup"><span data-stu-id="ded60-114">A child console process can also inherit the parent's standard handles, as well as access to the input buffer and the active screen buffer.</span></span>
-   <span data-ttu-id="ded60-115">Режим ошибки, заданный функцией [**функцию SetErrorMode**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-seterrormode) .</span><span class="sxs-lookup"><span data-stu-id="ded60-115">The error mode, as set by the [**SetErrorMode**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-seterrormode) function.</span></span>
-   <span data-ttu-id="ded60-116">Маска сходства процессоров.</span><span class="sxs-lookup"><span data-stu-id="ded60-116">The processor affinity mask.</span></span>
-   <span data-ttu-id="ded60-117">Ассоциация с заданием.</span><span class="sxs-lookup"><span data-stu-id="ded60-117">The association with a job.</span></span>

<span data-ttu-id="ded60-118">Дочерний процесс не наследует следующие:</span><span class="sxs-lookup"><span data-stu-id="ded60-118">The child process does not inherit the following:</span></span>

-   <span data-ttu-id="ded60-119">Класс Priority.</span><span class="sxs-lookup"><span data-stu-id="ded60-119">Priority class.</span></span>
-   <span data-ttu-id="ded60-120">Дескрипторы, возвращаемые [**локалаллок**](/windows/desktop/api/winbase/nf-winbase-localalloc), [**GlobalAlloc**](/windows/desktop/api/winbase/nf-winbase-globalalloc), [**хеапкреате**](/windows/desktop/api/heapapi/nf-heapapi-heapcreate)и [**хеапаллок**](/windows/desktop/api/heapapi/nf-heapapi-heapalloc).</span><span class="sxs-lookup"><span data-stu-id="ded60-120">Handles returned by [**LocalAlloc**](/windows/desktop/api/winbase/nf-winbase-localalloc), [**GlobalAlloc**](/windows/desktop/api/winbase/nf-winbase-globalalloc), [**HeapCreate**](/windows/desktop/api/heapapi/nf-heapapi-heapcreate), and [**HeapAlloc**](/windows/desktop/api/heapapi/nf-heapapi-heapalloc).</span></span>
-   <span data-ttu-id="ded60-121">Псевдо, как в дескрипторах, возвращаемых функцией [**жеткуррентпроцесс**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentprocess) или [**жеткуррентсреад**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentthread) .</span><span class="sxs-lookup"><span data-stu-id="ded60-121">Pseudo handles, as in the handles returned by the [**GetCurrentProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentprocess) or [**GetCurrentThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentthread) function.</span></span> <span data-ttu-id="ded60-122">Эти дескрипторы допустимы только для вызывающего процесса.</span><span class="sxs-lookup"><span data-stu-id="ded60-122">These handles are valid only for the calling process.</span></span>
-   <span data-ttu-id="ded60-123">Дескрипторы модуля DLL, возвращаемые функцией [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) .</span><span class="sxs-lookup"><span data-stu-id="ded60-123">DLL module handles returned by the [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) function.</span></span>
-   <span data-ttu-id="ded60-124">GDI или пользовательские дескрипторы, такие как **хбитмап** или **HMENU**.</span><span class="sxs-lookup"><span data-stu-id="ded60-124">GDI or USER handles, such as **HBITMAP** or **HMENU**.</span></span>

## <a name="inheriting-handles"></a><span data-ttu-id="ded60-125">Наследование дескрипторов</span><span class="sxs-lookup"><span data-stu-id="ded60-125">Inheriting Handles</span></span>

<span data-ttu-id="ded60-126">Дочерний процесс может наследовать некоторые его дескрипторы родителя, но не наследовать другие.</span><span class="sxs-lookup"><span data-stu-id="ded60-126">A child process can inherit some of its parent's handles, but not inherit others.</span></span> <span data-ttu-id="ded60-127">Чтобы вызвать наследование маркера, необходимо выполнить два действия:</span><span class="sxs-lookup"><span data-stu-id="ded60-127">To cause a handle to be inherited, you must do two things:</span></span>

-   <span data-ttu-id="ded60-128">Укажите, что маркер должен наследоваться при создании, открытии или дублировании маркера.</span><span class="sxs-lookup"><span data-stu-id="ded60-128">Specify that the handle is to be inherited when you create, open, or duplicate the handle.</span></span> <span data-ttu-id="ded60-129">Для этой цели в функциях создания обычно используется элемент **бинхерисандле** структуры [**\_ атрибутов безопасности**](/previous-versions/windows/desktop/legacy/aa379560(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="ded60-129">Creation functions typically use the **bInheritHandle** member of a [**SECURITY\_ATTRIBUTES**](/previous-versions/windows/desktop/legacy/aa379560(v=vs.85)) structure for this purpose.</span></span> <span data-ttu-id="ded60-130">[**Дупликатехандле**](/windows/desktop/api/handleapi/nf-handleapi-duplicatehandle) использует параметр *бинхерисандлес* .</span><span class="sxs-lookup"><span data-stu-id="ded60-130">[**DuplicateHandle**](/windows/desktop/api/handleapi/nf-handleapi-duplicatehandle) uses the *bInheritHandles* parameter.</span></span>
-   <span data-ttu-id="ded60-131">Укажите, что наследуемые дескрипторы наследуются путем установки для параметра *бинхерисандлес* значения true при вызове функции [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) .</span><span class="sxs-lookup"><span data-stu-id="ded60-131">Specify that inheritable handles are to be inherited by setting the *bInheritHandles* parameter to TRUE when calling the [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) function.</span></span> <span data-ttu-id="ded60-132">Кроме того, для наследования стандартных обработчиков ввода, стандартных выходных данных и стандартных дескрипторов ошибок элемент **dwFlags** структуры [**СТАРТУПИНФО**](/windows/win32/api/processthreadsapi/ns-processthreadsapi-startupinfoa) должен включать стартф \_ усестдхандлес.</span><span class="sxs-lookup"><span data-stu-id="ded60-132">Additionally, to inherit the standard input, standard output, and standard error handles, the **dwFlags** member of the [**STARTUPINFO**](/windows/win32/api/processthreadsapi/ns-processthreadsapi-startupinfoa) structure must include STARTF\_USESTDHANDLES.</span></span>

<span data-ttu-id="ded60-133">Чтобы указать список дескрипторов, которые должны наследоваться конкретным дочерним процессом, вызовите функцию [**упдатепроксреадаттрибуте**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-updateprocthreadattribute) с флагом *PROC_THREAD_ATTRIBUTE_HANDLE_LIST* .</span><span class="sxs-lookup"><span data-stu-id="ded60-133">To specify a list of the handles that should be inherited by a specific child process, call the [**UpdateProcThreadAttribute**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-updateprocthreadattribute) function with the *PROC_THREAD_ATTRIBUTE_HANDLE_LIST* flag.</span></span>

<span data-ttu-id="ded60-134">Унаследованный обработчик ссылается на тот же объект в дочернем процессе, что и в родительском процессе.</span><span class="sxs-lookup"><span data-stu-id="ded60-134">An inherited handle refers to the same object in the child process as it does in the parent process.</span></span> <span data-ttu-id="ded60-135">Он также имеет то же значение и привилегии доступа.</span><span class="sxs-lookup"><span data-stu-id="ded60-135">It also has the same value and access privileges.</span></span> <span data-ttu-id="ded60-136">Таким образом, когда один процесс изменяет состояние объекта, изменение влияет на оба процесса.</span><span class="sxs-lookup"><span data-stu-id="ded60-136">Therefore, when one process changes the state of the object, the change affects both processes.</span></span> <span data-ttu-id="ded60-137">Чтобы использовать маркер, дочерний процесс должен получить значение Handle и «знает» объект, к которому он относится.</span><span class="sxs-lookup"><span data-stu-id="ded60-137">To use a handle, the child process must retrieve the handle value and "know" the object to which it refers.</span></span> <span data-ttu-id="ded60-138">Как правило, родительский процесс передает эти сведения дочернему процессу через ее командную строку, блок среды или некоторую форму [межпроцессного взаимодействия](/windows/desktop/ipc/interprocess-communications).</span><span class="sxs-lookup"><span data-stu-id="ded60-138">Usually, the parent process communicates this information to the child process through its command line, environment block, or some form of [interprocess communication](/windows/desktop/ipc/interprocess-communications).</span></span>

<span data-ttu-id="ded60-139">Используйте функцию [**сесандлеинформатион**](/windows/win32/api/handleapi/nf-handleapi-sethandleinformation) для управления наследованием существующего маркера.</span><span class="sxs-lookup"><span data-stu-id="ded60-139">Use the [**SetHandleInformation**](/windows/win32/api/handleapi/nf-handleapi-sethandleinformation) function to control if an existing handle is inheritable or not.</span></span>

## <a name="inheriting-environment-variables"></a><span data-ttu-id="ded60-140">Наследование переменных среды</span><span class="sxs-lookup"><span data-stu-id="ded60-140">Inheriting Environment Variables</span></span>

<span data-ttu-id="ded60-141">По умолчанию дочерний процесс наследует переменные среды родительского процесса.</span><span class="sxs-lookup"><span data-stu-id="ded60-141">A child process inherits the environment variables of its parent process by default.</span></span> <span data-ttu-id="ded60-142">Однако [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) позволяет родительскому процессу указывать другой блок переменных среды.</span><span class="sxs-lookup"><span data-stu-id="ded60-142">However, [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) enables the parent process to specify a different block of environment variables.</span></span> <span data-ttu-id="ded60-143">Дополнительные сведения см. в разделе [переменные среды](environment-variables.md).</span><span class="sxs-lookup"><span data-stu-id="ded60-143">For more information, see [Environment Variables](environment-variables.md).</span></span>

## <a name="inheriting-the-current-directory"></a><span data-ttu-id="ded60-144">Наследование текущего каталога</span><span class="sxs-lookup"><span data-stu-id="ded60-144">Inheriting the Current Directory</span></span>

<span data-ttu-id="ded60-145">Функция [**GetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-getcurrentdirectory) извлекает текущий каталог вызывающего процесса.</span><span class="sxs-lookup"><span data-stu-id="ded60-145">The [**GetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-getcurrentdirectory) function retrieves the current directory of the calling process.</span></span> <span data-ttu-id="ded60-146">По умолчанию дочерний процесс наследует текущий каталог родительского процесса.</span><span class="sxs-lookup"><span data-stu-id="ded60-146">A child process inherits the current directory of its parent process by default.</span></span> <span data-ttu-id="ded60-147">Однако [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) позволяет родительскому процессу указывать другой текущий каталог для дочернего процесса.</span><span class="sxs-lookup"><span data-stu-id="ded60-147">However, [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) enables the parent process to specify a different current directory for the child process.</span></span> <span data-ttu-id="ded60-148">Чтобы изменить текущий каталог вызывающего процесса, используйте функцию [**сеткуррентдиректори**](/windows/desktop/api/winbase/nf-winbase-setcurrentdirectory) .</span><span class="sxs-lookup"><span data-stu-id="ded60-148">To change the current directory of the calling process, use the [**SetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-setcurrentdirectory) function.</span></span>
