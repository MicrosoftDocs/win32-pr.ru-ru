---
title: Вызов Срсетресторепоинт
description: Приложение может создать точку восстановления, прежде чем она приведет к существенному изменению системы, например к установке, удалению или обновлению компонентов.
ms.assetid: 77981e75-8c3f-4ecc-82f4-e88d68df661a
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b877c4fe73bcedad363bb4c9cc770a9638550dbd
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "103778518"
---
# <a name="calling-srsetrestorepoint"></a><span data-ttu-id="7a95b-103">Вызов Срсетресторепоинт</span><span class="sxs-lookup"><span data-stu-id="7a95b-103">Calling SRSetRestorePoint</span></span>

<span data-ttu-id="7a95b-104">Приложение может создать точку восстановления, прежде чем она приведет к существенному изменению системы, например к установке, удалению или обновлению компонентов.</span><span class="sxs-lookup"><span data-stu-id="7a95b-104">An application can create a restore point before it causes a significant system change, such as an install, uninstall, or feature update.</span></span>

<span data-ttu-id="7a95b-105">Установщики должны создать точку восстановления непосредственно перед установкой, вызвав функцию [**срсетресторепоинт**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srsetrestorepointa) с элементом **двевенттипе** в наборе структуры [**ресторепоинтинфо**](/windows/win32/api/srrestoreptapi/ns-srrestoreptapi-restorepointinfoa) , чтобы начать \_ \_ изменение системы.</span><span class="sxs-lookup"><span data-stu-id="7a95b-105">Installers should create a restore point just prior to installation by calling the [**SRSetRestorePoint**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srsetrestorepointa) function with the **dwEventType** member of the [**RESTOREPOINTINFO**](/windows/win32/api/srrestoreptapi/ns-srrestoreptapi-restorepointinfoa) structure set to BEGIN\_SYSTEM\_CHANGE.</span></span> <span data-ttu-id="7a95b-106">Чтобы уведомить восстановление системы о завершении установки, вызовите **срсетресторепоинт** с параметром **ДВЕВЕНТТИПЕ** , чтобы завершить \_ \_ изменение системы.</span><span class="sxs-lookup"><span data-stu-id="7a95b-106">To notify System Restore that the installation has been completed, call **SRSetRestorePoint** with **dwEventType** set to END\_SYSTEM\_CHANGE.</span></span>

<span data-ttu-id="7a95b-107">Если пользователь отменяет установку приложения, установщик может удалить точку восстановления, созданную после начала установки.</span><span class="sxs-lookup"><span data-stu-id="7a95b-107">If the user cancels the application installation, the installer may remove the restore point it created when the installation began.</span></span> <span data-ttu-id="7a95b-108">Удаление точки восстановления является необязательным и может препятствовать восстановлению после непреднамеренного изменения, внесенного установщиком во время отмены.</span><span class="sxs-lookup"><span data-stu-id="7a95b-108">Removing the restore point is optional and can prevent the user from recovering from unintentional changes made by the installer during the cancellation.</span></span> <span data-ttu-id="7a95b-109">Если установщик предназначен для удаления точки восстановления, он может вызвать функцию [**срремовересторепоинт**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srremoverestorepoint) или вызвать [**срсетресторепоинт**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srsetrestorepointa) с параметром **двресторепоинттипе** Set в отмененную \_ операцию, **Двевенттипе** установить в конец \_ системного \_ изменения, а **ллсекуенценумбер** задать значение, возвращенное начальным вызовом **SRSetRestorePoint**.</span><span class="sxs-lookup"><span data-stu-id="7a95b-109">If the installer is to remove a restore point, it can call the [**SRRemoveRestorePoint**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srremoverestorepoint) function, or call [**SRSetRestorePoint**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srsetrestorepointa) with **dwRestorePointType** set to CANCELLED\_OPERATION, **dwEventType** set to END\_SYSTEM\_CHANGE, and **llSequenceNumber** set to the value returned by the initial call to **SRSetRestorePoint**.</span></span>

<span data-ttu-id="7a95b-110">**Windows 8:  **</span><span class="sxs-lookup"><span data-stu-id="7a95b-110">**Windows 8:  **</span></span>

<span data-ttu-id="7a95b-111">Новый раздел реестра позволяет разработчикам приложений изменять частоту создания точек восстановления.</span><span class="sxs-lookup"><span data-stu-id="7a95b-111">A new registry key enables application developers to change the frequency of restore-point creation.</span></span>

<span data-ttu-id="7a95b-112">Приложения должны создать этот ключ, чтобы использовать его, так как он не будет существовать в системе.</span><span class="sxs-lookup"><span data-stu-id="7a95b-112">Applications should create this key to use it because it will not preexist in the system.</span></span> <span data-ttu-id="7a95b-113">Если ключ не существует, по умолчанию будет применено следующее.</span><span class="sxs-lookup"><span data-stu-id="7a95b-113">The following will apply by default if the key does not exist.</span></span> <span data-ttu-id="7a95b-114">Если приложение вызывает функцию **срсетресторепоинт** для создания точки восстановления, Windows пропускает создание этой новой точки восстановления, если в течение последних 24 часов были созданы какие-либо точки восстановления.</span><span class="sxs-lookup"><span data-stu-id="7a95b-114">If an application calls the **SRSetRestorePoint** function to create a restore point, Windows skips creating this new restore point if any restore points have been created in the last 24 hours.</span></span> <span data-ttu-id="7a95b-115">Восстановление системы задает для элемента **иисекуенценумбер** структуры [**статемгрстатус**](/windows/win32/api/srrestoreptapi/ns-srrestoreptapi-statemgrstatus) порядковый номер точки восстановления, созданной ранее в день, и задает для элемента **нстатус** значение **\_ Success Error**.</span><span class="sxs-lookup"><span data-stu-id="7a95b-115">System Restore sets the **IISequenceNumber** member of the [**STATEMGRSTATUS**](/windows/win32/api/srrestoreptapi/ns-srrestoreptapi-statemgrstatus) structure to the sequence number for the restore point created previously in the day and sets the value of the **nStatus** member to **ERROR\_SUCCESS**.</span></span> <span data-ttu-id="7a95b-116">Функция **срсетресторепоинт** возвращает **значение true**.</span><span class="sxs-lookup"><span data-stu-id="7a95b-116">The **SRSetRestorePoint** function returns **TRUE**.</span></span>

<span data-ttu-id="7a95b-117">Разработчики могут создавать приложения, которые создают  значение DWORD **системресторепоинткреатионфрекуенци** в разделе реестра **HKLM \\ Software \\ Microsoft \\ Windows NT \\ CurrentVersion \\ SystemRestore**.</span><span class="sxs-lookup"><span data-stu-id="7a95b-117">Developers can write applications that create the **DWORD** value **SystemRestorePointCreationFrequency** under the registry key **HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\SystemRestore**.</span></span> <span data-ttu-id="7a95b-118">Значение этого раздела реестра может изменить частоту создания точки восстановления.</span><span class="sxs-lookup"><span data-stu-id="7a95b-118">The value of this registry key can change the frequency of restore point creation.</span></span> <span data-ttu-id="7a95b-119">Значение этого раздела реестра может изменить частоту создания точки восстановления.</span><span class="sxs-lookup"><span data-stu-id="7a95b-119">The value of this registry key can change the frequency of restore point creation.</span></span>

<span data-ttu-id="7a95b-120">Если приложение вызывает **срсетресторепоинт** для создания точки восстановления, а значение раздела реестра равно 0, восстановление системы не пропускает создание новой точки восстановления.</span><span class="sxs-lookup"><span data-stu-id="7a95b-120">If the application calls **SRSetRestorePoint** to create a restore point, and the registry key value is 0, system restore does not skip creating the new restore point.</span></span>

<span data-ttu-id="7a95b-121">Если приложение вызывает **срсетресторепоинт** для создания точки восстановления, а значение раздела реестра — целое число N, восстановление системы пропускает создание новой точки восстановления, если какие-либо точки восстановления были созданы в течение предыдущих N минут.</span><span class="sxs-lookup"><span data-stu-id="7a95b-121">If the application calls **SRSetRestorePoint** to create a restore point, and the registry key value is the integer N, system restore skips creating a new restore point if any restore points were created in the previous N minutes.</span></span>

<span data-ttu-id="7a95b-122">**Windows 8:  **</span><span class="sxs-lookup"><span data-stu-id="7a95b-122">**Windows 8:  **</span></span>

<span data-ttu-id="7a95b-123">Восстановление системы, работающее в Windows 8, наблюдает за файлами на загрузочном томе, которые относятся только к восстановлению системы.</span><span class="sxs-lookup"><span data-stu-id="7a95b-123">System Restore running on Windows 8 monitors files in the boot volume that are relevant for system restore only.</span></span> <span data-ttu-id="7a95b-124">Моментальные снимки загрузочного тома, созданного с помощью восстановления системы, работающего в Windows 8, могут быть удалены, если моментальный снимок впоследствии предоставляется более ранней версией Windows.</span><span class="sxs-lookup"><span data-stu-id="7a95b-124">Snapshots of the boot volume created by System Restore running on Windows 8 may be deleted if the snapshot is subsequently exposed by an earlier version of Windows.</span></span> <span data-ttu-id="7a95b-125">Обратите внимание, что хотя существует только один системный том, для каждой операционной системы в системе с несколькими операционными системами имеется один загрузочный том.</span><span class="sxs-lookup"><span data-stu-id="7a95b-125">Note that although there is only one system volume, there is one boot volume for each operating system in a multi-boot system.</span></span>

<span data-ttu-id="7a95b-126">Разработчики могут создавать приложения, которые создают  значение DWORD **скопеснапшотс** в разделе реестра **HKLM \\ Software \\ Microsoft \\ Windows NT \\ CurrentVersion \\ SystemRestore**.</span><span class="sxs-lookup"><span data-stu-id="7a95b-126">Developers can write applications that create the **DWORD** value **ScopeSnapshots** under the registry key **HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\SystemRestore**.</span></span> <span data-ttu-id="7a95b-127">Если этот раздел реестра имеет значение 0, то средство восстановления системы создает моментальные снимки загрузочного тома так же, как в предыдущих версиях Windows.</span><span class="sxs-lookup"><span data-stu-id="7a95b-127">If this registry key value is 0, System Restore creates snapshots of the boot volume in the same way as in earlier versions of Windows.</span></span> <span data-ttu-id="7a95b-128">Если это значение будет удалено, восстановление системы, запущенное в Windows 8, возобновляет создание моментальных снимков, которые отслеживают файлы в загрузочном томе, относящиеся только к восстановлению системы.</span><span class="sxs-lookup"><span data-stu-id="7a95b-128">If this value is deleted, System Restore running on Windows 8 resumes creating snapshots that monitor files in the boot volume that are relevant for system restore only.</span></span>

<span data-ttu-id="7a95b-129">Пример см. в разделе [Использование восстановления системы](using-system-restore.md).</span><span class="sxs-lookup"><span data-stu-id="7a95b-129">For an example, see [Using System Restore](using-system-restore.md).</span></span>

 

 




