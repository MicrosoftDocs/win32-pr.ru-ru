---
title: Многопоточные приложения Direct2D
description: Описывает рекомендации по созданию многопоточных приложений Direct2D.
ms.assetid: FDD770D4-817F-44D9-86C4-15DD04D214AE
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6be979b867edd6d36583959c4a595dbd507ca94f
ms.sourcegitcommit: c3243ec4ada05b7faf9d563853cb667ecef825e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/03/2020
ms.locfileid: "103797244"
---
# <a name="multithreaded-direct2d-apps"></a><span data-ttu-id="e37e6-103">Многопоточные приложения Direct2D</span><span class="sxs-lookup"><span data-stu-id="e37e6-103">Multithreaded Direct2D Apps</span></span>

<span data-ttu-id="e37e6-104">При разработке приложений [Direct2D](./direct2d-portal.md) может потребоваться доступ к ресурсам Direct2D из нескольких потоков.</span><span class="sxs-lookup"><span data-stu-id="e37e6-104">If you develop [Direct2D](./direct2d-portal.md) apps, you may need to access Direct2D resources from more than one thread.</span></span> <span data-ttu-id="e37e6-105">В других случаях может потребоваться использовать многопоточность для повышения производительности или более эффективного реагирования (например, использование одного потока для отображения экрана и отдельного потока для автономной подготовки).</span><span class="sxs-lookup"><span data-stu-id="e37e6-105">In other cases, you may want to use multi-threading to get better performance or better responsiveness (like using one thread for screen display and a separate thread for offline rendering).</span></span>

<span data-ttu-id="e37e6-106">В этом разделе описаны рекомендации по разработке многопоточных приложений [Direct2D](./direct2d-portal.md) с небольшим числом визуализаций [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) .</span><span class="sxs-lookup"><span data-stu-id="e37e6-106">This topic describes the best practices for developing multithreaded [Direct2D](./direct2d-portal.md) apps with little to no [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) rendering.</span></span> <span data-ttu-id="e37e6-107">Проблемы с программным обеспечением, вызванные проблемами параллелизма, могут быть трудно отслеживать, и полезно спланировать политику многопоточности и следовать рекомендациям, описанным здесь.</span><span class="sxs-lookup"><span data-stu-id="e37e6-107">Software defects caused by concurrency issues can be difficult to track down, and it is helpful to plan your multithreading policy and to follow the best practices described here.</span></span>

> [!Note]  
> <span data-ttu-id="e37e6-108">При доступе к двум [Direct2D](./direct2d-portal.md) ресурсам, созданным из двух различных однопотоковых Direct2D фабрик, они не вызывают конфликтов доступа, если базовые устройства и контексты устройств [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) также отличаются.</span><span class="sxs-lookup"><span data-stu-id="e37e6-108">If you access two [Direct2D](./direct2d-portal.md) resources created from two different single threaded Direct2D factories it doesn't cause access conflicts as long as the underlying [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) devices and device contexts are also distinct.</span></span> <span data-ttu-id="e37e6-109">Обсуждение «доступ к ресурсам Direct2D» в этой статье означает «доступ к ресурсам Direct2D, созданным с того же Direct2D устройства», если не указано иное.</span><span class="sxs-lookup"><span data-stu-id="e37e6-109">When talking about "accessing Direct2D resources" in this article, it really means "accessing Direct2D resources created from the same Direct2D Device" unless stated otherwise.</span></span>

## <a name="developing-thread-safe-apps-that-call-only-direct2d-apis"></a><span data-ttu-id="e37e6-110">Разработка Thread-Safe приложений, вызывающих только API Direct2D</span><span class="sxs-lookup"><span data-stu-id="e37e6-110">Developing Thread-Safe Apps that Call Only Direct2D APIs</span></span>

<span data-ttu-id="e37e6-111">Можно создать многопотоковый экземпляр фабрики [Direct2D](./direct2d-portal.md) .</span><span class="sxs-lookup"><span data-stu-id="e37e6-111">You can create a multithreaded [Direct2D](./direct2d-portal.md) factory instance.</span></span> <span data-ttu-id="e37e6-112">Можно использовать и совместно использовать многопотоковую фабрику и все ее ресурсы из нескольких потоков, но доступ к этим ресурсам (через вызовы Direct2D) сериализуется Direct2D, поэтому конфликты доступа не возникают.</span><span class="sxs-lookup"><span data-stu-id="e37e6-112">You can use and share a multithreaded factory and all its resources from more than one thread, but accesses to those resources (via Direct2D calls) are serialized by Direct2D, so no access conflicts occur.</span></span> <span data-ttu-id="e37e6-113">Если приложение вызывает только API Direct2D, такая защита автоматически выполняется Direct2D на детализированном уровне с минимальными издержками.</span><span class="sxs-lookup"><span data-stu-id="e37e6-113">If your app calls only Direct2D APIs, such protection is automatically done by Direct2D in a granular level with minimum overhead.</span></span> <span data-ttu-id="e37e6-114">Код для создания многопоточной фабрики здесь.</span><span class="sxs-lookup"><span data-stu-id="e37e6-114">The code to create a multithreaded factory here.</span></span>

```cpp
ID2D1Factory* m_D2DFactory;

// Create a Direct2D factory.
HRESULT hr = D2D1CreateFactory(
    D2D1_FACTORY_TYPE_MULTI_THREADED,
    &m_D2DFactory
);
```

<span data-ttu-id="e37e6-115">На рисунке показано, как [Direct2D](./direct2d-portal.md) сериализует два потока, которые выполняют вызовы, используя только API Direct2D.</span><span class="sxs-lookup"><span data-stu-id="e37e6-115">The image here shows how [Direct2D](./direct2d-portal.md) serializes two threads that make calls using only the Direct2D API.</span></span>

![схема двух сериализованных потоков.](images/multi-thread.png)

## <a name="developing-thread-safe-direct2d-apps-with-minimal-direct3d-or-dxgi-calls"></a><span data-ttu-id="e37e6-117">Разработка приложений Thread-Safe Direct2D с минимальными вызовами Direct3D или DXGI</span><span class="sxs-lookup"><span data-stu-id="e37e6-117">Developing Thread-Safe Direct2D Apps with minimal Direct3D or DXGI Calls</span></span>

<span data-ttu-id="e37e6-118">Это более частое, что [Direct2D](./direct2d-portal.md) приложение также делает вызовы [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) или DXGI.</span><span class="sxs-lookup"><span data-stu-id="e37e6-118">It is more than often that a [Direct2D](./direct2d-portal.md) app also makes some [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls.</span></span> <span data-ttu-id="e37e6-119">Например, поток отображения будет нарисован в Direct2D с помощью [**цепочки подкачки DXGI**](/windows/desktop/api/dxgi/nn-dxgi-idxgiswapchain).</span><span class="sxs-lookup"><span data-stu-id="e37e6-119">For example, a display thread will draw in Direct2D then present using a [**DXGI swap chain**](/windows/desktop/api/dxgi/nn-dxgi-idxgiswapchain).</span></span>

<span data-ttu-id="e37e6-120">В этом случае обеспечивается более сложная безопасность потоков: некоторые [Direct2D](./direct2d-portal.md) вызовы косвенно обращаются к базовым ресурсам [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) , которые могут быть одновременно доступны другому потоку, который вызывает Direct3D или DXGI.</span><span class="sxs-lookup"><span data-stu-id="e37e6-120">In this case, assuring thread-safety is more complicated: some [Direct2D](./direct2d-portal.md) calls indirectly access the underlying [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) resources, which might be simultaneously accessed by another thread which calls Direct3D or DXGI.</span></span> <span data-ttu-id="e37e6-121">Так как вызовы Direct3D или DXGI не Direct2D's осведомленности и управления, необходимо создать многопоточность Direct2D, но необходимо выполнить Mor, чтобы избежать конфликтов доступа.</span><span class="sxs-lookup"><span data-stu-id="e37e6-121">Since those Direct3D or DXGI calls are out of Direct2D’s awareness and control, you need to create a multithreaded Direct2D factory, but you must do mor to avoid access conflicts.</span></span>

<span data-ttu-id="e37e6-122">На схеме здесь показан конфликт доступа к ресурсам [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) из-за того, что поток T0 доступ к ресурсу опосредованно через вызов [Direct2D](./direct2d-portal.md) и T2 обращается к тому же ресурсу напрямую через вызов Direct3D или DXGI.</span><span class="sxs-lookup"><span data-stu-id="e37e6-122">The diagram here shows a [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) resource access conflict due to thread T0 accessing a resource indirectly via a [Direct2D](./direct2d-portal.md) call and T2 accessing the same resource directly via a Direct3D or DXGI call.</span></span>

> [!Note]  
> <span data-ttu-id="e37e6-123">Защита потоков, предоставляемая [Direct2D](./direct2d-portal.md) (синяя блокировка в этом изображении), не помогает в этом случае.</span><span class="sxs-lookup"><span data-stu-id="e37e6-123">The thread protection that [Direct2D](./direct2d-portal.md) provides (the blue lock in this image) doesn't help in this case.</span></span>

 

![Схема защиты потоков.](images/multi-thread2.png)

<span data-ttu-id="e37e6-125">Чтобы избежать конфликта доступа к ресурсам, мы рекомендуем явно получить блокировку, которую [Direct2D](./direct2d-portal.md) использует для внутренней синхронизации доступа, и применить эту блокировку, когда потоку необходимо сделать вызовы [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) или DXGI, которые могут вызвать конфликт доступа, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="e37e6-125">To avoid resource access conflict here, we recommend you explicitly acquire the lock that [Direct2D](./direct2d-portal.md) uses for internal access synchronization, and apply that lock when a thread needs to make [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls that might cause access conflict as shown here.</span></span> <span data-ttu-id="e37e6-126">В частности, следует уделять особое внимание коду, который использует исключения или систему на ранних этапах, основанную на кодах возврата HRESULT.</span><span class="sxs-lookup"><span data-stu-id="e37e6-126">In particular, you should take special care with code that uses exceptions or an early out system based on HRESULT return codes.</span></span> <span data-ttu-id="e37e6-127">По этой причине мы рекомендуем использовать шаблон RAII (получение ресурсов — инициализация) для вызова методов [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) и [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) .</span><span class="sxs-lookup"><span data-stu-id="e37e6-127">For this reason, we recommend you use an RAII (Resource Acquisition Is Initialization) pattern to call the [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) and [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) methods.</span></span>

> [!Note]  
> <span data-ttu-id="e37e6-128">Важно связать вызовы методов [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) и Leave, в противном случае ваше приложение может [**привести**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) к взаимоблокировке.</span><span class="sxs-lookup"><span data-stu-id="e37e6-128">It is important that you pair up calls to the [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) and [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) methods, otherwise your app can deadlock.</span></span>

 

<span data-ttu-id="e37e6-129">В этом примере кода показан пример блокировки и последующего разблокирования вызовов [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) или DXGI.</span><span class="sxs-lookup"><span data-stu-id="e37e6-129">The code here shows an example of when to lock and then and unlock around [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls.</span></span>


```C++
void MyApp::DrawFromThread2()
{
    // We are accessing Direct3D resources directly without Direct2D's knowledge, so we
    // must manually acquire and apply the Direct2D factory lock.
    ID2D1Multithread* m_D2DMultithread;
    m_D2DFactory->QueryInterface(IID_PPV_ARGS(&m_D2DMultithread));
    m_D2DMultithread->Enter();
    
    // Now it is safe to make Direct3D/DXGI calls, such as IDXGISwapChain::Present
    MakeDirect3DCalls();

    // It is absolutely critical that the factory lock be released upon
    // exiting this function, or else any consequent Direct2D calls will be blocked.
    m_D2DMultithread->Leave();
}
```



> [!Note]  
> <span data-ttu-id="e37e6-130">Некоторые вызовы [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) или DXGI (особенно [**идксгисвапчаин::P**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-present)повторной отправки) могут получать блокировки и (или) вызывать обратные вызовы в код вызывающей функции или метода.</span><span class="sxs-lookup"><span data-stu-id="e37e6-130">Some [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls (notably [**IDXGISwapChain::Present**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-present)) may acquire locks and/or trigger callbacks into the code of the calling function or method.</span></span> <span data-ttu-id="e37e6-131">Следует помнить об этом и убедиться, что такое поведение не вызывает взаимоблокировок.</span><span class="sxs-lookup"><span data-stu-id="e37e6-131">You should be aware of this and make sure that such behavior doesn't cause deadlocks.</span></span> <span data-ttu-id="e37e6-132">Дополнительные сведения см. в статье [Обзор DXGI](/windows/desktop/direct3ddxgi/d3d10-graphics-programming-guide-dxgi) .</span><span class="sxs-lookup"><span data-stu-id="e37e6-132">For more info, see the [DXGI Overview](/windows/desktop/direct3ddxgi/d3d10-graphics-programming-guide-dxgi) topic.</span></span>

 

![Схема блокировки потоков Direct2D и Direct3D.](images/multi-thread3.png)

<span data-ttu-id="e37e6-134">При использовании методов [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) и [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) вызовы защищаются автоматическим [Direct2D](./direct2d-portal.md) и явной блокировкой, поэтому приложение не получает конфликт доступа.</span><span class="sxs-lookup"><span data-stu-id="e37e6-134">When you use the [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) and [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) methods, the calls are protected by the automatic [Direct2D](./direct2d-portal.md) and the explicit lock, so the app doesn't hit access conflict.</span></span>

<span data-ttu-id="e37e6-135">Существуют и другие подходы для решения этой проблемы.</span><span class="sxs-lookup"><span data-stu-id="e37e6-135">There are other approaches to work around this issue.</span></span> <span data-ttu-id="e37e6-136">Тем не менее рекомендуется явно защищать вызовы [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) или DXGI с блокировкой [Direct2D](./direct2d-portal.md) , так как обычно обеспечивает лучшую производительность, так как она защищает параллелизм на гораздо более низком уровне и с меньшими затратами в рамках Direct2D'sного покрытия.</span><span class="sxs-lookup"><span data-stu-id="e37e6-136">However, we recommend you explicitly guard [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls with the [Direct2D](./direct2d-portal.md) lock because it usually provides better performance as it protects concurrency at a much finer level and with lower overhead under Direct2D’s cover.</span></span>

## <a name="ensuring-atomicity-of-stateful-operations"></a><span data-ttu-id="e37e6-137">Обеспечение атомарности операций с отслеживанием состояния</span><span class="sxs-lookup"><span data-stu-id="e37e6-137">Ensuring Atomicity of Stateful Operations</span></span>

<span data-ttu-id="e37e6-138">Хотя функции обеспечения безопасности потоков [DirectX](/previous-versions//ee663301(v=vs.85)) позволяют гарантировать, что никакие два отдельных вызова API не будут выполняться параллельно, необходимо также убедиться, что потоки, выполняющие вызовы API с отслеживанием состояния, не мешают друг другу.</span><span class="sxs-lookup"><span data-stu-id="e37e6-138">While thread-safety features of [DirectX](/previous-versions//ee663301(v=vs.85)) can help ensure that no two individual API calls are made concurrently, you must also ensure that threads that make stateful API calls don't interfere with each other.</span></span> <span data-ttu-id="e37e6-139">Ниже приведен пример.</span><span class="sxs-lookup"><span data-stu-id="e37e6-139">Here is an example.</span></span>

1.  <span data-ttu-id="e37e6-140">Есть две строки текста, которые необходимо визуализировать как на экране (потоком 0), так и в режиме «вне экрана» (потоком 1): строка \# 1 имеет значение «а больше», а строка \# 2 — «, чем», то оба они будут выведены с помощью сплошной черной кисти.</span><span class="sxs-lookup"><span data-stu-id="e37e6-140">There are two lines of text that you want to render to both on-screen (by Thread 0) and off-screen (by Thread 1): Line \#1 is "A is greater" and Line \#2 is "than B", both of which will be drawn using a solid black brush.</span></span>
2.  <span data-ttu-id="e37e6-141">Поток 1 рисует первую строку текста.</span><span class="sxs-lookup"><span data-stu-id="e37e6-141">Thread 1 draws the first line of text.</span></span>
3.  <span data-ttu-id="e37e6-142">Поток 0 реагирует на введенные пользователем данные, обновляет обе строки как «B меньше» и «чем» соответственно, и изменяет цвет кисти на сплошной красный для собственного рисования.</span><span class="sxs-lookup"><span data-stu-id="e37e6-142">Thread 0 reacts to a user input, updates both text lines to "B is smaller" and "than A" respectively, and changed the brush color to solid red for its own drawing;</span></span>
4.  <span data-ttu-id="e37e6-143">Поток 1 продолжит рисование второй строки текста, которая теперь "отличается от", с помощью кисти красного цвета.</span><span class="sxs-lookup"><span data-stu-id="e37e6-143">Thread 1 continues drawing the second line of text, which is now "than A", with the red color brush;</span></span>
5.  <span data-ttu-id="e37e6-144">Наконец, мы получаем две строки текста на экранной цели: «а больше» — черный, «а» — «красный».</span><span class="sxs-lookup"><span data-stu-id="e37e6-144">Finally, we get two lines of text on the off-screen drawing target: "A is greater" in black and "than A" in red.</span></span>

![Схема потоковых потоков на экране.](images/multi-thread4.png)

<span data-ttu-id="e37e6-146">В верхней строке поток 0 рисуется с текущими текстовыми строками и текущей черной кистью.</span><span class="sxs-lookup"><span data-stu-id="e37e6-146">In the top row, Thread 0 draws with current text strings and the current black brush.</span></span> <span data-ttu-id="e37e6-147">Поток 1 завершает только прорисовку на экране в верхней половине.</span><span class="sxs-lookup"><span data-stu-id="e37e6-147">Thread 1 only finishes off-screen drawing on the top half.</span></span>

<span data-ttu-id="e37e6-148">В средней строке поток 0 реагирует на взаимодействие с пользователем, обновляет текстовые строки и кисть, а затем обновляет экран.</span><span class="sxs-lookup"><span data-stu-id="e37e6-148">In the middle row, Thread 0 responds to user interaction, updates the text strings and the brush, then refreshes the screen.</span></span> <span data-ttu-id="e37e6-149">На этом этапе поток 1 заблокирован.</span><span class="sxs-lookup"><span data-stu-id="e37e6-149">At this point, Thread 1 is blocked.</span></span> <span data-ttu-id="e37e6-150">В нижней строке окончательной отрисовкой после завершения потока 1 начинается рисование нижней половины с измененной кистью и измененной текстовой строкой.</span><span class="sxs-lookup"><span data-stu-id="e37e6-150">In the bottom row, the final off-screen rendering after Thread 1 resumes drawing the bottom half with an altered brush and an altered text string.</span></span>

<span data-ttu-id="e37e6-151">Для решения этой проблемы рекомендуется иметь отдельный контекст для каждого потока, чтобы:</span><span class="sxs-lookup"><span data-stu-id="e37e6-151">To address this issue, we recommend you have a separate context for each thread, so that:</span></span>

-   <span data-ttu-id="e37e6-152">Следует создать копию контекста устройства, чтобы изменяющиеся ресурсы (т. е. ресурсы, которые могут изменяться при отображении или печати, такие как текстовое содержимое или Кисть сплошного цвета в примере) не изменялись при подготовке к просмотру.</span><span class="sxs-lookup"><span data-stu-id="e37e6-152">You should create a copy of the device context so that mutable resources (i.e. resources that may vary during display or printing, such as text contents or the solid color brush in the example) don't change when you render.</span></span> <span data-ttu-id="e37e6-153">В этом примере необходимо сохранить копию этих двух строк текста и цветовую кисть перед началом рисования.</span><span class="sxs-lookup"><span data-stu-id="e37e6-153">In this sample, you should maintain a copy of those two lines of texts and the color brush before you draw.</span></span> <span data-ttu-id="e37e6-154">Это гарантирует, что каждый поток будет иметь полное и согласованное содержимое для прорисовки и представления.</span><span class="sxs-lookup"><span data-stu-id="e37e6-154">By doing so, you guarantee each thread has complete and consistent content to draw and present.</span></span>
-   <span data-ttu-id="e37e6-155">Вы должны предоставлять общий доступ к большим ресурсам (например, точечным рисункам и диаграммам сложных эффектов), которые инициализируются один раз, а затем никогда не изменяются в потоках для повышения производительности.</span><span class="sxs-lookup"><span data-stu-id="e37e6-155">You should share heavy-weight resources (like bitmaps and complex effect graphs) that are initialized once and then never modified across threads to increase performance.</span></span>
-   <span data-ttu-id="e37e6-156">Можно совместно использовать ресурсы с низкой плотностью (например, сплошные цветные кисти и текстовые форматы), которые инициализируются один раз, а затем никогда не изменяются в потоках.</span><span class="sxs-lookup"><span data-stu-id="e37e6-156">You can either share light-weight resources (like solid color brushes and text formats) that are initialized once and then never modified across threads or not</span></span>

## <a name="summary"></a><span data-ttu-id="e37e6-157">Сводка</span><span class="sxs-lookup"><span data-stu-id="e37e6-157">Summary</span></span>

<span data-ttu-id="e37e6-158">При разработке многопоточных приложений [Direct2D](./direct2d-portal.md) необходимо создать многопоточную фабрику Direct2D, а затем наследовать все ресурсы Direct2D от этой фабрики.</span><span class="sxs-lookup"><span data-stu-id="e37e6-158">When you develop multithreaded [Direct2D](./direct2d-portal.md) apps, you must create a multithreaded Direct2D factory then derive all Direct2D resources from that factory.</span></span> <span data-ttu-id="e37e6-159">Если поток будет выполнять вызовы [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) или DXGI, необходимо также явно получить и применить блокировку Direct2D, чтобы защитить вызовы Direct3D или DXGI.</span><span class="sxs-lookup"><span data-stu-id="e37e6-159">If a thread will make [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls, you also must explicitly acquire then apply the Direct2D lock to guard those Direct3D or DXGI calls.</span></span> <span data-ttu-id="e37e6-160">Кроме того, необходимо обеспечить целостность контекста, используя копию изменяемых ресурсов для каждого потока.</span><span class="sxs-lookup"><span data-stu-id="e37e6-160">Moreover, you must ensure context integrity by having a copy of mutable resources for each thread.</span></span>
