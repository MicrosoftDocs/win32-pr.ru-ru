---
title: Точность и числовое обрезание на диаграммах эффектов
description: Приложения, которые визуализируют эффекты с помощью Direct2D, должны обеспечивать требуемый уровень качества и предсказуемости относительно числовой точности.
ms.assetid: 6fd1d77f-e613-534f-3205-bad11fa24c30
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 90628661ec8cd3f16ff6a6149aecbb7e8be3e5a9
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104070460"
---
# <a name="precision-and-numerical-clipping-in-effect-graphs"></a><span data-ttu-id="eb95c-103">Точность и числовое обрезание на диаграммах эффектов</span><span class="sxs-lookup"><span data-stu-id="eb95c-103">Precision and numerical clipping in effect graphs</span></span>

<span data-ttu-id="eb95c-104">Приложения, которые визуализируют эффекты с помощью Direct2D, должны обеспечивать требуемый уровень качества и предсказуемости относительно числовой точности.</span><span class="sxs-lookup"><span data-stu-id="eb95c-104">Applications that render effects using Direct2D must take care to achieve the desired level of quality and predictability with respect to numerical precision.</span></span> <span data-ttu-id="eb95c-105">В этом разделе описываются рекомендации и соответствующие параметры в Direct2D, которые полезны в следующих случаях.</span><span class="sxs-lookup"><span data-stu-id="eb95c-105">This topic describes best practices and relevant settings in Direct2D which are useful if:</span></span>

-   <span data-ttu-id="eb95c-106">Диаграмма эффектов зависит от высокой числовой точности или цветов за пределами \[ диапазона 0, 1 \] , и вы хотите убедиться, что они всегда будут доступны.</span><span class="sxs-lookup"><span data-stu-id="eb95c-106">Your effect graph relies on high numerical precision or colors outside of the \[0, 1\] range, and you want to make sure these will always be available</span></span>
-   <span data-ttu-id="eb95c-107">Или диаграмма эффектов полагается на реализацию отрисовки для фиксации промежуточных цветов в \[ диапазоне 0, 1 \] , и вы хотите обеспечить постоянное выполнение этого события.</span><span class="sxs-lookup"><span data-stu-id="eb95c-107">Or, your effect graph relies on the rendering implementation to clamp intermediate colors to the \[0, 1\] range, and you want to ensure this clamping always occurs</span></span>

<span data-ttu-id="eb95c-108">Direct2D часто делит диаграмму эффектов на разделы и визуализирует каждый раздел на отдельном шаге.</span><span class="sxs-lookup"><span data-stu-id="eb95c-108">Direct2D often divides an effect graph into sections, and renders each section in a separate step.</span></span> <span data-ttu-id="eb95c-109">Выходные данные некоторых шагов могут храниться в промежуточных текстурах Direct3D, которые по умолчанию имеют ограниченный числовой диапазон и точность.</span><span class="sxs-lookup"><span data-stu-id="eb95c-109">The output of some steps may be stored in intermediate Direct3D textures which by default have limited numerical range and precision.</span></span> <span data-ttu-id="eb95c-110">Direct2D не дает никаких гарантий относительно того, где используются эти промежуточные текстуры.</span><span class="sxs-lookup"><span data-stu-id="eb95c-110">Direct2D makes no guarantees about if or where these intermediate textures are used.</span></span> <span data-ttu-id="eb95c-111">Это поведение может отличаться в зависимости от возможностей GPU, а также между версиями Windows.</span><span class="sxs-lookup"><span data-stu-id="eb95c-111">This behavior may vary according to GPU capabilities as well as between Windows versions.</span></span>

<span data-ttu-id="eb95c-112">В Windows 10 Direct2D использует меньшее количество промежуточных текстур из-за использования связывания шейдеров.</span><span class="sxs-lookup"><span data-stu-id="eb95c-112">In Windows 10, Direct2D uses fewer intermediate textures due to its use of shader linking.</span></span> <span data-ttu-id="eb95c-113">Таким образом, Direct2D может давать разные результаты с параметрами по умолчанию, чем в предыдущих выпусках Windows.</span><span class="sxs-lookup"><span data-stu-id="eb95c-113">Direct2D may therefore produce different results with default settings than in prior Windows releases.</span></span> <span data-ttu-id="eb95c-114">Это, в первую очередь, влияет на сценарии, в которых связывание шейдеров возможно в графе эффектов, и эта диаграмма также содержит эффекты, создающие выходные цвета расширенного диапазона.</span><span class="sxs-lookup"><span data-stu-id="eb95c-114">This primarily affects scenarios where shader linking is possible in an effect graph, and that graph also contains effects that produce extended-range output colors.</span></span>

## <a name="overview-of-effect-rendering-and-intermediates"></a><span data-ttu-id="eb95c-115">Общие сведения о визуализации эффектов и промежуточных уровнях</span><span class="sxs-lookup"><span data-stu-id="eb95c-115">Overview of effect rendering and intermediates</span></span>

<span data-ttu-id="eb95c-116">Чтобы отобразить диаграмму эффектов, Direct2D сначала находит базовый граф "преобразований", где преобразование — это узел графа, используемый в результате.</span><span class="sxs-lookup"><span data-stu-id="eb95c-116">To render an effect graph, Direct2D first finds the underlying graph of “transforms,” where a transform is a graph node used within an effect.</span></span> <span data-ttu-id="eb95c-117">Существуют различные типы преобразований, включая те, которые предоставляют Direct2Dные шейдеры Direct3D для использования.</span><span class="sxs-lookup"><span data-stu-id="eb95c-117">There are different types of transforms, including those which provide Direct3D shaders for Direct2D to use.</span></span>

<span data-ttu-id="eb95c-118">Например, Direct2D может визуализировать диаграмму эффектов следующим образом:</span><span class="sxs-lookup"><span data-stu-id="eb95c-118">For example, Direct2D may render an effect graph as follows:</span></span>

![Диаграмма эффектов с промежуточными текстурами](images/precision-and-clipping-1.png)

<span data-ttu-id="eb95c-120">Direct2D ищет возможности для сокращения числа промежуточных текстур, используемых для отрисовки диаграммы эффектов. Эта логика непрозрачна для приложений.</span><span class="sxs-lookup"><span data-stu-id="eb95c-120">Direct2D looks for opportunities to reduce the number intermediate textures used to render the effect graph; this logic is opaque to applications.</span></span> <span data-ttu-id="eb95c-121">Например, на следующем графе можно визуализировать Direct2D, используя один вызов прорисовки Direct3D и без промежуточных текстур:</span><span class="sxs-lookup"><span data-stu-id="eb95c-121">For example, the following graph can be rendered by Direct2D using one Direct3D draw call and no intermediate textures:</span></span>

![Диаграмма эффектов без промежуточных текстур](images/precision-and-clipping-2.png)

<span data-ttu-id="eb95c-123">До Windows 10 Direct2D всегда использовал промежуточные текстуры, если в одной и той же диаграмме эффектов используется несколько пиксельных шейдеров.</span><span class="sxs-lookup"><span data-stu-id="eb95c-123">Prior to Windows 10, Direct2D would always use intermediate textures if multiple pixels shaders were used within the same effect graph.</span></span> <span data-ttu-id="eb95c-124">Большинство встроенных эффектов, которые просто настраивают цветовые значения (например, яркость или насыщенность), делают это с помощью шейдеров пикселей.</span><span class="sxs-lookup"><span data-stu-id="eb95c-124">Most built-in effects that simply adjust color values (for example, Brightness or Saturation) do so using pixel shaders.</span></span>

<span data-ttu-id="eb95c-125">В Windows 10 Direct2D теперь может не использовать в таких случаях промежуточные текстуры.</span><span class="sxs-lookup"><span data-stu-id="eb95c-125">In Windows 10, Direct2D may now avoid using intermediate textures in such cases.</span></span> <span data-ttu-id="eb95c-126">Это достигается путем внутренней связи смежных шейдеров пикселей.</span><span class="sxs-lookup"><span data-stu-id="eb95c-126">It does this by internally linking adjacent pixel shaders.</span></span> <span data-ttu-id="eb95c-127">Пример:</span><span class="sxs-lookup"><span data-stu-id="eb95c-127">For example:</span></span>

![Диаграмма эффектов Windows 10 с несколькими шейдерами пикселей и без промежуточных текстур](images/precision-and-clipping-3.png)

<span data-ttu-id="eb95c-129">Обратите внимание, что не все смежные шейдеры пикселей в графе могут быть связаны друг с другом, и поэтому только некоторые графы будут формировать разные выходные данные в Windows 10.</span><span class="sxs-lookup"><span data-stu-id="eb95c-129">Note that not all adjacent pixel shaders in a graph may be linked together, and therefore only certain graphs will produce different output on Windows 10.</span></span> <span data-ttu-id="eb95c-130">Полные сведения см. в разделе [связывание шейдера эффектов](effect-shader-linking.md).</span><span class="sxs-lookup"><span data-stu-id="eb95c-130">For full details see [Effect Shader Linking](effect-shader-linking.md).</span></span> <span data-ttu-id="eb95c-131">Основные ограничения:</span><span class="sxs-lookup"><span data-stu-id="eb95c-131">The primary restrictions are:</span></span>

-   <span data-ttu-id="eb95c-132">Эффект не будет связан с эффектами, использующими его выходные данные, если первый эффект соединен как входные данные для нескольких эффектов.</span><span class="sxs-lookup"><span data-stu-id="eb95c-132">An effect will not be linked with effects consuming its output, if the first effect is connected as an input to multiple effects.</span></span>
-   <span data-ttu-id="eb95c-133">Результат не будет связан с набором эффектов в качестве входных данных, если первый из них выберет входные данные в другую логическую точку, чем результат.</span><span class="sxs-lookup"><span data-stu-id="eb95c-133">An effect will not be linked with an effect set as its input, if the first effect samples its input at a different logical position than its output.</span></span> <span data-ttu-id="eb95c-134">Например, Цветовая матрица может быть связана с входными данными, но результат свертки не будет.</span><span class="sxs-lookup"><span data-stu-id="eb95c-134">For example, a Color Matrix effect might be linked with its input, but a Convolution effect will not be.</span></span>

## <a name="built-in-effect-behavior"></a><span data-ttu-id="eb95c-135">Поведение встроенных эффектов</span><span class="sxs-lookup"><span data-stu-id="eb95c-135">Built-in effect behavior</span></span>

<span data-ttu-id="eb95c-136">Многие встроенные эффекты могут создавать цвета за пределами \[ диапазона 0, 1 \] в унпремултиплиед цветовом пространстве, даже если их входные цвета находятся в пределах этого диапазона.</span><span class="sxs-lookup"><span data-stu-id="eb95c-136">Many built-in effects may produce colors outside of the \[0, 1\] range in the unpremultiplied color space, even when their input colors are within that range.</span></span> <span data-ttu-id="eb95c-137">В этом случае такие цвета могут подвергаться числовому обрезку.</span><span class="sxs-lookup"><span data-stu-id="eb95c-137">When this happens, such colors may be subject to numerical clipping.</span></span> <span data-ttu-id="eb95c-138">Обратите внимание, что важно учитывать диапазон цветов в унпремултиплиед пространстве, несмотря на то, что встроенные эффекты обычно создают цвета в предварительно умноженном пространстве.</span><span class="sxs-lookup"><span data-stu-id="eb95c-138">Note that it’s important to consider the color range in unpremultiplied space, even though built-in effects typically produce colors in premultiplied space.</span></span> <span data-ttu-id="eb95c-139">Это гарантирует, что цвета останутся в пределах диапазона, даже если другие эффекты впоследствии унпремултипли их.</span><span class="sxs-lookup"><span data-stu-id="eb95c-139">This ensures that colors stay within range, even if other effects subsequently unpremultiply them.</span></span>

<span data-ttu-id="eb95c-140">Некоторые эффекты, которые могут выдавать эти цвета вне диапазона, предлагают свойство "Клампаутпут".</span><span class="sxs-lookup"><span data-stu-id="eb95c-140">Some of the effects which may emit these out-of-range colors offer a “ClampOutput” property.</span></span> <span data-ttu-id="eb95c-141">Сюда входит следующее.</span><span class="sxs-lookup"><span data-stu-id="eb95c-141">These include:</span></span>

-   [<span data-ttu-id="eb95c-142">Матрица цветов</span><span class="sxs-lookup"><span data-stu-id="eb95c-142">Color Matrix</span></span>](color-matrix.md)
-   [<span data-ttu-id="eb95c-143">Арифметическое составное</span><span class="sxs-lookup"><span data-stu-id="eb95c-143">Arithmetic Composite</span></span>](arithmetic-composite.md)
-   [<span data-ttu-id="eb95c-144">Convolve</span><span class="sxs-lookup"><span data-stu-id="eb95c-144">Convolve</span></span>](convolve-matrix.md)
-   [<span data-ttu-id="eb95c-145">Эффекты перемещения</span><span class="sxs-lookup"><span data-stu-id="eb95c-145">Transfer effects</span></span>](built-in-effects.md)

<span data-ttu-id="eb95c-146">Установка для свойства Клампаутпут значения TRUE для этих эффектов гарантирует единообразный результат, независимо от таких факторов, как связывание шейдера.</span><span class="sxs-lookup"><span data-stu-id="eb95c-146">Setting the ClampOutput property to TRUE on these effects ensures a consistent result will be achieved regardless of factors such as shader linking.</span></span> <span data-ttu-id="eb95c-147">Обратите внимание, что фиксация происходит в унпремултиплиед пространстве.</span><span class="sxs-lookup"><span data-stu-id="eb95c-147">Note that clamping occurs in unpremultiplied space.</span></span>

<span data-ttu-id="eb95c-148">Другие встроенные эффекты также могут выдавать выходные цвета, превышающие \[ 0, 1 \] диапазон в унпремултиплиед пространстве, даже если их цвета пикселов (и свойства Color, если таковые имеются) находятся в пределах этого диапазона.</span><span class="sxs-lookup"><span data-stu-id="eb95c-148">Other built-in effects may also produce output colors beyond the \[0, 1\] range in unpremultiplied space, even when their colors pixels (and “Color” properties if any) are within that range.</span></span> <span data-ttu-id="eb95c-149">Сюда входит следующее.</span><span class="sxs-lookup"><span data-stu-id="eb95c-149">These include:</span></span>

-   <span data-ttu-id="eb95c-150">[Преобразование и масштабирование эффектов](built-in-effects.md) (если свойство режима интерполяции имеет кубический или высококачественный кубический уровень)</span><span class="sxs-lookup"><span data-stu-id="eb95c-150">[Transforming and Scaling effects](built-in-effects.md) (When the Interpolation Mode property is Cubic or High Quality Cubic)</span></span>
-   [<span data-ttu-id="eb95c-151">Эффекты освещения</span><span class="sxs-lookup"><span data-stu-id="eb95c-151">Lighting effects</span></span>](built-in-effects.md)
-   <span data-ttu-id="eb95c-152">[Обнаружение границ](edge-detection-effect.md) (если свойство оверлея Edges имеет значение true)</span><span class="sxs-lookup"><span data-stu-id="eb95c-152">[Edge detection](edge-detection-effect.md) (When the Overlay Edges property is TRUE)</span></span>
-   [<span data-ttu-id="eb95c-153">Экспозиция</span><span class="sxs-lookup"><span data-stu-id="eb95c-153">Exposure</span></span>](exposure-effect.md)
-   <span data-ttu-id="eb95c-154">[Составной](composite.md) (если свойство Mode имеет значение Plus)</span><span class="sxs-lookup"><span data-stu-id="eb95c-154">[Composite](composite.md) (When the Mode property is Plus)</span></span>
-   [<span data-ttu-id="eb95c-155">Температура и оттенок</span><span class="sxs-lookup"><span data-stu-id="eb95c-155">Temperature and Tint</span></span>](temperature-and-tint-effect.md)
-   [<span data-ttu-id="eb95c-156">Сепия</span><span class="sxs-lookup"><span data-stu-id="eb95c-156">Sepia</span></span>](sepia-effect.md)
-   [<span data-ttu-id="eb95c-157">Насыщенность</span><span class="sxs-lookup"><span data-stu-id="eb95c-157">Saturation</span></span>](saturation.md)

## <a name="forcing-numerical-clipping-within-an-effect-graph"></a><span data-ttu-id="eb95c-158">Принудительное выполнение числовой обрезки в графе эффектов</span><span class="sxs-lookup"><span data-stu-id="eb95c-158">Forcing numerical clipping within an effect graph</span></span>

<span data-ttu-id="eb95c-159">При использовании описанных выше эффектов, не имеющих свойства Клампаутпут, приложения должны рассмотреть возможность принудительного выполнения числовых фиксаций.</span><span class="sxs-lookup"><span data-stu-id="eb95c-159">While using effects listed above which do not have a ClampOutput property, applications should consider forcing numerical clamping.</span></span> <span data-ttu-id="eb95c-160">Это можно сделать, вставив дополнительный результат на диаграмму, которая замещает пикселы.</span><span class="sxs-lookup"><span data-stu-id="eb95c-160">This can be done by inserting an additional effect into the graph that clamps its pixels.</span></span> <span data-ttu-id="eb95c-161">Можно использовать цветовую матрицу, для которой свойство "Клампаутпут" имеет значение TRUE, а свойство "КолорМатрикс" в качестве значения по умолчанию (сквозной).</span><span class="sxs-lookup"><span data-stu-id="eb95c-161">A Color Matrix effect may be used, with its ‘ClampOutput’ property set to TRUE and leaving the ‘ColorMatrix’ property as the default (pass-through) value.</span></span>

<span data-ttu-id="eb95c-162">Вторым вариантом для достижения согласованных результатов является запрос на Direct2D использования промежуточных текстур, имеющих большую точность.</span><span class="sxs-lookup"><span data-stu-id="eb95c-162">A second option to achieve consistent results is to request that Direct2D use intermediate textures which have greater precision.</span></span> <span data-ttu-id="eb95c-163">Это описано ниже.</span><span class="sxs-lookup"><span data-stu-id="eb95c-163">This is described below.</span></span>

## <a name="controlling-precision-of-intermediate-textures"></a><span data-ttu-id="eb95c-164">Управление точностью промежуточных текстур</span><span class="sxs-lookup"><span data-stu-id="eb95c-164">Controlling precision of intermediate textures</span></span>

<span data-ttu-id="eb95c-165">Direct2D предоставляет несколько способов управления точностью графа.</span><span class="sxs-lookup"><span data-stu-id="eb95c-165">Direct2D provides a few ways to control the precision of a graph.</span></span> <span data-ttu-id="eb95c-166">Прежде чем использовать форматы высокой точности в Direct2D, приложения должны убедиться, что они поддерживаются GPU.</span><span class="sxs-lookup"><span data-stu-id="eb95c-166">Before using high precision formats in Direct2D, applications must ensure they are supported sufficiently by the GPU.</span></span> <span data-ttu-id="eb95c-167">Чтобы проверить это, используйте [**ID2D1DeviceContext:: исбуфферпреЦисионсуппортед**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-isbufferprecisionsupported).</span><span class="sxs-lookup"><span data-stu-id="eb95c-167">To check this, use [**ID2D1DeviceContext::IsBufferPrecisionSupported**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-isbufferprecisionsupported).</span></span>

<span data-ttu-id="eb95c-168">Приложения могут создать устройство Direct3D с помощью деформации (Эмуляция программного обеспечения), чтобы гарантировать, что все значения точности буфера поддерживаются независимо от фактического оборудования GPU на устройстве.</span><span class="sxs-lookup"><span data-stu-id="eb95c-168">Applications may create a Direct3D device using WARP (software emulation) to guarantee that all buffer precisions are supported independent of the actual GPU hardware on the device.</span></span> <span data-ttu-id="eb95c-169">Это рекомендуется в таких сценариях, как применение эффектов к фотографии при сохранении на диск.</span><span class="sxs-lookup"><span data-stu-id="eb95c-169">This is recommended in scenarios such as applying effects to a photo while saving to disk.</span></span> <span data-ttu-id="eb95c-170">Даже если Direct2D поддерживает форматы буферов высокой точности на GPU, в этом сценарии рекомендуется использовать деформацию для графических процессоров уровня Feature 9. X, из-за ограниченной точности арифметических операций шейдера и выборки на некоторых графических процессорах с низким энергопотреблением.</span><span class="sxs-lookup"><span data-stu-id="eb95c-170">Even if Direct2D supports high precision buffer formats on the GPU, using WARP is recommended in this scenario on feature level 9.X GPUs, due to the limited precision of shader arithmetic and sampling on some low-power mobile GPUs.</span></span>

<span data-ttu-id="eb95c-171">В каждом из следующих случаев запрошенная точность фактически является минимальной точностью, используемой Direct2D.</span><span class="sxs-lookup"><span data-stu-id="eb95c-171">In each case below, the requested precision is actually the minimum precision Direct2D will use.</span></span> <span data-ttu-id="eb95c-172">Если промежуточные версии не требуются, можно использовать более высокую точность.</span><span class="sxs-lookup"><span data-stu-id="eb95c-172">Higher precision may be used if intermediates are not required.</span></span> <span data-ttu-id="eb95c-173">Direct2D также может совместно использовать промежуточные текстуры для различных частей одного графика или разных диаграмм.</span><span class="sxs-lookup"><span data-stu-id="eb95c-173">Direct2D may also share intermediate textures for different parts of the same graph or different graphs entirely.</span></span> <span data-ttu-id="eb95c-174">В этом случае Direct2D использует максимальную точность, запрошенную для всех вовлеченных операций.</span><span class="sxs-lookup"><span data-stu-id="eb95c-174">In this case Direct2D uses the maximum precision requested for all involved operations.</span></span>

### <a name="precision-selection-from-id2d1devicecontextsetrenderingcontrols"></a><span data-ttu-id="eb95c-175">Выбор точности из ID2D1DeviceContext:: Сетрендерингконтролс</span><span class="sxs-lookup"><span data-stu-id="eb95c-175">Precision selection from ID2D1DeviceContext::SetRenderingControls</span></span>

<span data-ttu-id="eb95c-176">Самым простым способом управления точностью Direct2D's промежуточных текстур является использование [**ID2D1DeviceContext:: сетрендерингконтролс**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-setrenderingcontrols(constd2d1_rendering_controls)).</span><span class="sxs-lookup"><span data-stu-id="eb95c-176">The simplest way to control the precision of Direct2D’s intermediate textures is to use [**ID2D1DeviceContext::SetRenderingControls**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-setrenderingcontrols(constd2d1_rendering_controls)).</span></span> <span data-ttu-id="eb95c-177">Это позволяет управлять точностью всех промежуточных текстур, если точность не задается вручную для эффектов или преобразований напрямую.</span><span class="sxs-lookup"><span data-stu-id="eb95c-177">This controls the precision of all intermediate textures, as long as a precision is not also set manually on effects or transforms directly.</span></span>


```cpp
if (Device->IsBufferPrecisionSupported(D2D1_BUFFER_PRECISION_32BPC_FLOAT))
{
  // Get the current rendering controls
  D2D1_RENDERING_CONTROLS renderingControls = {};
  Context->GetRenderingControls(&renderingControls);

  // Switch the precision within the rendering controls and set it
  renderingControls.bufferPrecision = D2D1_BUFFER_PRECISION_32BPC_FLOAT;
  Context->SetRenderingControls(&renderingControls);
}
              
```



### <a name="precision-selection-from-inputs-and-render-targets"></a><span data-ttu-id="eb95c-178">Выбор точности из входных и выходных объектов</span><span class="sxs-lookup"><span data-stu-id="eb95c-178">Precision selection from inputs and render targets</span></span>

<span data-ttu-id="eb95c-179">Приложения также могут полагаться на точность входных данных на графе эффектов, чтобы управлять точностью промежуточных текстур.</span><span class="sxs-lookup"><span data-stu-id="eb95c-179">Applications may also rely on the precision of the inputs to an effect graph to control the precision of intermediate textures.</span></span> <span data-ttu-id="eb95c-180">Это справедливо, если точность буфера не указана с помощью [**ID2D1DeviceContext:: сетрендерингконтролс**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-setrenderingcontrols(constd2d1_rendering_controls))и не задана вручную для эффектов и непосредственного преобразования.</span><span class="sxs-lookup"><span data-stu-id="eb95c-180">This is true as long as a buffer precision is not specified using [**ID2D1DeviceContext::SetRenderingControls**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-setrenderingcontrols(constd2d1_rendering_controls)), and is not set manually on effects and transform directly.</span></span>

<span data-ttu-id="eb95c-181">Точность входных данных для эффектов распространяется через граф, чтобы выбрать точность нисходящих промежуточных уровней.</span><span class="sxs-lookup"><span data-stu-id="eb95c-181">The precisions of inputs to effects are propagated through the graph to select the precision of downstream intermediates.</span></span> <span data-ttu-id="eb95c-182">При условии, что разные ветви на графе эффектов соответствуют, используется самая большая точность любого входного параметра.</span><span class="sxs-lookup"><span data-stu-id="eb95c-182">Where different branches in the effect graph meet, the greatest precision of any input is used.</span></span>

<span data-ttu-id="eb95c-183">Точность, выбранная на основе точечного рисунка Direct2D, определяется из его формата пикселей.</span><span class="sxs-lookup"><span data-stu-id="eb95c-183">The precision selected based on a Direct2D bitmap is determined from its pixel format.</span></span> <span data-ttu-id="eb95c-184">Точность, выбранная для [**ID2D1ImageSource**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesource) , определяется из формата пикселей WIC базового IWICBitmapSource, используемого для создания **ID2D1ImageSource**.</span><span class="sxs-lookup"><span data-stu-id="eb95c-184">The precision selected for an [**ID2D1ImageSource**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesource) is determined from the WIC pixel format of the underlying IWICBitmapSource used to create the **ID2D1ImageSource**.</span></span> <span data-ttu-id="eb95c-185">Обратите внимание, что Direct2D не позволяет создавать источники изображений с помощью источников WIC, используя точность, не поддерживаемую Direct2D и графическим процессором.</span><span class="sxs-lookup"><span data-stu-id="eb95c-185">Note that Direct2D doesn’t allow image sources to be created with WIC sources using precisions unsupported by Direct2D and the GPU.</span></span>

<span data-ttu-id="eb95c-186">Возможно, Direct2D не может присвоить результат точности на основе его входных данных.</span><span class="sxs-lookup"><span data-stu-id="eb95c-186">It is possible that Direct2D cannot assign an effect a precision based on its inputs.</span></span> <span data-ttu-id="eb95c-187">Это происходит, когда у действия нет входных данных или если используется [**ID2D1CommandList**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1commandlist) , для которого не определена точность.</span><span class="sxs-lookup"><span data-stu-id="eb95c-187">This happens when an effect has no inputs, or when an [**ID2D1CommandList**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1commandlist) is used, which has no specific precision.</span></span> <span data-ttu-id="eb95c-188">В этом случае точность промежуточных текстур определяется на основе набора битовых карт как текущего целевого объекта отрисовки контекста.</span><span class="sxs-lookup"><span data-stu-id="eb95c-188">In this case, the precision of intermediate textures is determined from the bitmap set as the context’s current render target.</span></span>

### <a name="precision-selection-directly-on-the-effect-and-transforms"></a><span data-ttu-id="eb95c-189">Точность выбора точности непосредственно в результате и преобразований</span><span class="sxs-lookup"><span data-stu-id="eb95c-189">Precision selection directly on the effect and transforms</span></span>

<span data-ttu-id="eb95c-190">Минимальная точность для промежуточных текстур также может быть задана в явных расположениях на графе эффектов.</span><span class="sxs-lookup"><span data-stu-id="eb95c-190">The minimum precision for intermediate textures may also be set at explicit locations within an effect graph.</span></span> <span data-ttu-id="eb95c-191">Это рекомендуется только для сложных сценариев.</span><span class="sxs-lookup"><span data-stu-id="eb95c-191">This is only recommended for advanced scenarios.</span></span>

<span data-ttu-id="eb95c-192">Минимальная точность может быть задана с помощью свойства в силе следующим образом:</span><span class="sxs-lookup"><span data-stu-id="eb95c-192">The minimum precision may be set using a property on an effect as follows:</span></span>


```cpp
if (Device->IsBufferPrecisionSupported(D2D1_BUFFER_PRECISION_32BPC_FLOAT))
{
  hr = Effect->SetValue(D2D1_PROPERTY_PRECISION, D2D1_BUFFER_PRECISION_32BPC_FLOAT);
}
              
```



<span data-ttu-id="eb95c-193">В реализации эффектов минимальная точность может быть задана с помощью ID2D1RenderInfo:: СетаутпутпреЦисион следующим образом:</span><span class="sxs-lookup"><span data-stu-id="eb95c-193">Within an effect implementation, the minimum precision may be set using ID2D1RenderInfo::SetOutputPrecision as follows:</span></span>


```cpp
if (EffectContext->IsBufferPrecisionSupported(D2D1_BUFFER_PRECISION_32BPC_FLOAT))
{
  hr = RenderInfo->SetOutputBuffer(
  D2D1_BUFFER_PRECISION_32BPC_FLOAT,
  D2D1_CHANNEL_DEPTH_4);
}
              
```



<span data-ttu-id="eb95c-194">Обратите внимание, что точность, заданная для эффекта, распространяется на нисходящие эффекты в той же диаграмме эффектов, если для этих побочных эффектов не задана другая точность.</span><span class="sxs-lookup"><span data-stu-id="eb95c-194">Note that the precision set on an effect will propagate to downstream effects in the same effect graph, unless a different precision is set on those downstream effects.</span></span> <span data-ttu-id="eb95c-195">Точность, заданная для преобразования в пределах влияния, не влияет на точность для подчиненных узлов преобразования.</span><span class="sxs-lookup"><span data-stu-id="eb95c-195">The precision set on a transform within an effect does not affect the precision for downstream transform nodes.</span></span>

<span data-ttu-id="eb95c-196">Ниже приведена полная рекурсивная логика, используемая для определения минимальной точности для промежуточного буфера, в котором хранятся выходные данные заданного узла преобразования.</span><span class="sxs-lookup"><span data-stu-id="eb95c-196">Below is the full recursive logic used to determine the minimum precision for an intermediate buffer storing the output of a given transform node:</span></span>

![Логика минимальной точности промежуточного буфера](images/precision-and-clipping-4.png)

 

 