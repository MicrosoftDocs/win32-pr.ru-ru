---
title: Обзор реализаций геометрии
description: В этом разделе описывается использование реализаций Direct2D Geometry для повышения производительности отрисовки геометрии приложения в определенных сценариях.
ms.assetid: E8C4C4E5-3102-4F53-847E-A4C2D12A6921
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5b903e047ee58a803a7584aaca407281fc803e30
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105654315"
---
# <a name="geometry-realizations-overview"></a><span data-ttu-id="15383-103">Обзор реализаций геометрии</span><span class="sxs-lookup"><span data-stu-id="15383-103">Geometry Realizations Overview</span></span>

<span data-ttu-id="15383-104">В этом разделе описывается использование реализаций [Direct2D](direct2d-portal.md) Geometry для повышения производительности отрисовки геометрии приложения в определенных сценариях.</span><span class="sxs-lookup"><span data-stu-id="15383-104">This topic describes how to use [Direct2D](direct2d-portal.md) geometry realizations to improve your app’s geometry rendering performance in certain scenarios.</span></span>

<span data-ttu-id="15383-105">Он содержит следующие подразделы:</span><span class="sxs-lookup"><span data-stu-id="15383-105">It contains the following sections:</span></span>

-   [<span data-ttu-id="15383-106">Что такое реализация геометрических объектов?</span><span class="sxs-lookup"><span data-stu-id="15383-106">What are geometry realizations?</span></span>](#what-are-geometry-realizations)
-   [<span data-ttu-id="15383-107">Зачем использовать реализации геометрии?</span><span class="sxs-lookup"><span data-stu-id="15383-107">Why use geometry realizations?</span></span>](#why-use-geometry-realizations)
-   [<span data-ttu-id="15383-108">Когда следует использовать реализации геометрии</span><span class="sxs-lookup"><span data-stu-id="15383-108">When to use geometry realizations</span></span>](#when-to-use-geometry-realizations)
-   [<span data-ttu-id="15383-109">Создание реализаций геометрии</span><span class="sxs-lookup"><span data-stu-id="15383-109">Creating geometry realizations</span></span>](#creating-geometry-realizations)
-   [<span data-ttu-id="15383-110">Рисование реализаций геометрических объектов</span><span class="sxs-lookup"><span data-stu-id="15383-110">Drawing geometry realizations</span></span>](#drawing-geometry-realizations)
-   [<span data-ttu-id="15383-111">Масштабирование реализаций геометрических объектов</span><span class="sxs-lookup"><span data-stu-id="15383-111">Scaling geometry realizations</span></span>](#scaling-geometry-realizations)
    -   [<span data-ttu-id="15383-112">Использование реализаций Geometry в приложениях, которые не масштабируются</span><span class="sxs-lookup"><span data-stu-id="15383-112">Using geometry realizations in apps that do not scale</span></span>](#using-geometry-realizations-in-apps-that-do-not-scale)
    -   [<span data-ttu-id="15383-113">Использование реализаций геометрии в приложениях, которые масштабируются на небольшое количество</span><span class="sxs-lookup"><span data-stu-id="15383-113">Using geometry realizations in apps that scale by a small amount</span></span>](#using-geometry-realizations-in-apps-that-scale-by-a-small-amount)
    -   [<span data-ttu-id="15383-114">Использование реализаций геометрических объектов в приложениях, масштабируемых по большому объему</span><span class="sxs-lookup"><span data-stu-id="15383-114">Using geometry realizations in apps that scale by a large amount</span></span>](#using-geometry-realizations-in-apps-that-scale-by-a-large-amount)
-   [<span data-ttu-id="15383-115">См. также</span><span class="sxs-lookup"><span data-stu-id="15383-115">Related topics</span></span>](#related-topics)

## <a name="what-are-geometry-realizations"></a><span data-ttu-id="15383-116">Что такое реализация геометрических объектов?</span><span class="sxs-lookup"><span data-stu-id="15383-116">What are geometry realizations?</span></span>

<span data-ttu-id="15383-117">Реализации геометрических объектов, появившиеся в Windows 8.1, — это новый тип примитива рисования, который упрощает [Direct2D](direct2d-portal.md) приложений для повышения производительности отрисовки геометрии в определенных случаях.</span><span class="sxs-lookup"><span data-stu-id="15383-117">Geometry realizations, introduced in Windows 8.1, are a new type of drawing primitive that make it easy for [Direct2D](direct2d-portal.md) apps to improve geometry rendering performance in certain cases.</span></span> <span data-ttu-id="15383-118">Реализации геометрических объектов представлены интерфейсом [**ID2D1GeometryRealization**](/windows/win32/api/d2d1_2/nn-d2d1_2-id2d1geometryrealization) .</span><span class="sxs-lookup"><span data-stu-id="15383-118">Geometry realizations are represented by the [**ID2D1GeometryRealization**](/windows/win32/api/d2d1_2/nn-d2d1_2-id2d1geometryrealization) interface.</span></span>

## <a name="why-use-geometry-realizations"></a><span data-ttu-id="15383-119">Зачем использовать реализации геометрии?</span><span class="sxs-lookup"><span data-stu-id="15383-119">Why use geometry realizations?</span></span>

<span data-ttu-id="15383-120">Когда [Direct2D](direct2d-portal.md) визуализирует объект [**ID2D1Geometry**](/windows/win32/api/d2d1/nn-d2d1-id2d1geometry) , он должен преобразовать эту геометрию в форму, которую графическое оборудование понимает в процессе, именуемом тесселяцией.</span><span class="sxs-lookup"><span data-stu-id="15383-120">When [Direct2D](direct2d-portal.md) renders an [**ID2D1Geometry**](/windows/win32/api/d2d1/nn-d2d1-id2d1geometry) object, it must convert that geometry to a form the graphics hardware understands through a process called tessellation.</span></span> <span data-ttu-id="15383-121">Как правило, Direct2D должен строить геометрию для каждого рисуемого кадра, даже если геометрия не изменяется.</span><span class="sxs-lookup"><span data-stu-id="15383-121">Typically, Direct2D must tessellate geometry every frame it is drawn, even if the geometry does not change.</span></span> <span data-ttu-id="15383-122">Если приложение отображает одинаковую геометрию каждого кадра, повторная тесселяция представляет ненужные вычислительные усилия.</span><span class="sxs-lookup"><span data-stu-id="15383-122">If your app renders the same geometry every frame, then the repeated re-tessellation represents wasted computational effort.</span></span> <span data-ttu-id="15383-123">Более эффективным является вычисление для кэширования тесселяции или даже полной растрирования геометрии, а также отрисовку этого кэшированного представления каждого кадра вместо повторной тесселяции.</span><span class="sxs-lookup"><span data-stu-id="15383-123">It is more computationally efficient to cache the tessellation, or even the full rasterization, of the geometry, and to draw that cached representation each frame instead of repeatedly re-tessellating.</span></span>

<span data-ttu-id="15383-124">Обычным способом, который разработчики решает эту проблему, является кэширование полной растрирования геометрии.</span><span class="sxs-lookup"><span data-stu-id="15383-124">A common way that developers solve this problem is to cache the full rasterization of the geometry.</span></span> <span data-ttu-id="15383-125">В частности, обычно создается новый точечный рисунок, растрирование геометрии к этому точечному рисунку, а затем при необходимости рисуется изображение в сцене.</span><span class="sxs-lookup"><span data-stu-id="15383-125">In particular, it is common to create a new bitmap, rasterize the geometry to that bitmap, and then draw that bitmap to the scene as needed.</span></span> <span data-ttu-id="15383-126">(Этот подход описан в разделе « [визуализация геометрии](improving-direct2d-performance.md) » статьи повышение производительности приложений Direct2D.) Хотя этот подход очень эффективен, он имеет ряд недостатков:</span><span class="sxs-lookup"><span data-stu-id="15383-126">(This approach is described in the [Geometry rendering](improving-direct2d-performance.md) section of Improving the performance of Direct2D apps.) While this approach is very computationally efficient, it has some drawbacks:</span></span>

-   <span data-ttu-id="15383-127">Кэшированный точечный рисунок чувствителен к изменениям в преобразовании, примененном к сцене.</span><span class="sxs-lookup"><span data-stu-id="15383-127">The cached bitmap is sensitive to changes in the transform applied to the scene.</span></span> <span data-ttu-id="15383-128">Например, масштабирование растрового изображения может привести к заметным артефактам масштабирования.</span><span class="sxs-lookup"><span data-stu-id="15383-128">For example, scaling the rasterization can result in a noticeable scaling artifacts.</span></span> <span data-ttu-id="15383-129">Устранение этих артефактов с высококачественными алгоритмами масштабирования может быть дорогостоящим.</span><span class="sxs-lookup"><span data-stu-id="15383-129">Mitigating these artifacts with high-quality scaling algorithms can be computationally expensive.</span></span>
-   <span data-ttu-id="15383-130">Кэшированный точечный рисунок потребляет значительный объем памяти, особенно если он является растровым при высоком разрешении.</span><span class="sxs-lookup"><span data-stu-id="15383-130">The cached bitmap consumes a significant amount of memory, especially if it is rasterized at a high resolution.</span></span>

<span data-ttu-id="15383-131">Реализации геометрии предоставляют альтернативный способ кэширования геометрии, что позволяет избежать приведенных выше недостатков.</span><span class="sxs-lookup"><span data-stu-id="15383-131">Geometry realizations provide an alternative way to cache geometry that avoids the above drawbacks.</span></span> <span data-ttu-id="15383-132">Реализации геометрии представлены не в пикселях (как в случае с полной растрирования), а в виде точек на математической плоскости.</span><span class="sxs-lookup"><span data-stu-id="15383-132">Geometry realizations are represented not by pixels (as is the case with a full rasterization) but instead by points on a mathematical plane.</span></span> <span data-ttu-id="15383-133">По этой причине они менее чувствительны, чем полные средства растрирования для масштабирования и других манипуляций, и потребляют значительно меньше памяти.</span><span class="sxs-lookup"><span data-stu-id="15383-133">For this reason they are less sensitive than full rasterizations to scaling and other manipulation, and they consume significantly less memory.</span></span>

## <a name="when-to-use-geometry-realizations"></a><span data-ttu-id="15383-134">Когда следует использовать реализации геометрии</span><span class="sxs-lookup"><span data-stu-id="15383-134">When to use geometry realizations</span></span>

<span data-ttu-id="15383-135">Используйте реализации геометрии, когда приложение визуализирует сложные геометрические объекты, фигуры которых изменяются редко, но могут подвергаться изменениям преобразований.</span><span class="sxs-lookup"><span data-stu-id="15383-135">Consider using geometry realizations when your app renders complex geometries whose shapes change infrequently but which may be subject to changing transforms.</span></span>

<span data-ttu-id="15383-136">Например, рассмотрим приложение сопоставления, которое показывает статическую карту, но позволяет пользователю увеличить или уменьшить масштаб. Это приложение может использовать преимущества применения геометрических объектов.</span><span class="sxs-lookup"><span data-stu-id="15383-136">For example, consider a mapping application that shows a static map but which allows the user to zoom in and out. This app can benefit from using geometry realizations.</span></span> <span data-ttu-id="15383-137">Так как создаваемые геометрические объекты остаются статичными, полезно кэшировать их, чтобы сохранить работу тесселяции.</span><span class="sxs-lookup"><span data-stu-id="15383-137">Since the geometries being rendered remain static, it is useful to cache them in order to save tessellation work.</span></span> <span data-ttu-id="15383-138">Но поскольку карты масштабируются при увеличении масштаба пользователя, кэширование полной растрирования не идеально подходит из-за артефактов масштабирования.</span><span class="sxs-lookup"><span data-stu-id="15383-138">But because the maps are scaled when the user zooms, caching a full rasterization is not ideal, due to scaling artifacts.</span></span> <span data-ttu-id="15383-139">Кэширование геометрических объектов позволяет приложению избежать повторной тесселяции, сохраняя высокое качество визуального элемента во время масштабирования.</span><span class="sxs-lookup"><span data-stu-id="15383-139">Caching geometry realizations would allow the app to avoid re-tessellation work while maintaining high visual quality during scaling.</span></span>

<span data-ttu-id="15383-140">С другой стороны, рассмотрим приложение калеидоскопе с анимированной геометрией, которая постоянно изменяется.</span><span class="sxs-lookup"><span data-stu-id="15383-140">On the other hand, consider a kaleidoscope app with animated geometry that continually changes.</span></span> <span data-ttu-id="15383-141">Это приложение, вероятно, не будет выгодно использовать реализации геометрических объектов.</span><span class="sxs-lookup"><span data-stu-id="15383-141">This app would probably not benefit from using geometry realizations.</span></span> <span data-ttu-id="15383-142">Так как фигуры меняются от Frame к кадру, не рекомендуется кэшировать их тесселяции.</span><span class="sxs-lookup"><span data-stu-id="15383-142">Since the shapes themselves change from frame to frame, it is not useful to cache their tessellations.</span></span> <span data-ttu-id="15383-143">Лучший подход для этого приложения — нарисовать объекты [**ID2D1Geometry**](/windows/win32/api/d2d1/nn-d2d1-id2d1geometry) напрямую.</span><span class="sxs-lookup"><span data-stu-id="15383-143">The best approach for this app is to draw [**ID2D1Geometry**](/windows/win32/api/d2d1/nn-d2d1-id2d1geometry) objects directly.</span></span>

## <a name="creating-geometry-realizations"></a><span data-ttu-id="15383-144">Создание реализаций геометрии</span><span class="sxs-lookup"><span data-stu-id="15383-144">Creating geometry realizations</span></span>

<span data-ttu-id="15383-145">Объект [**ID2D1GeometryRealization**](/windows/win32/api/d2d1_2/nn-d2d1_2-id2d1geometryrealization) должен быть создан из существующего объекта [**ID2D1Geometry**](/windows/win32/api/d2d1/nn-d2d1-id2d1geometry) .</span><span class="sxs-lookup"><span data-stu-id="15383-145">An [**ID2D1GeometryRealization**](/windows/win32/api/d2d1_2/nn-d2d1_2-id2d1geometryrealization) object must be created from an existing [**ID2D1Geometry**](/windows/win32/api/d2d1/nn-d2d1-id2d1geometry) object.</span></span> <span data-ttu-id="15383-146">Чтобы создать реализацию геометрии, вызовите метод [**креатефилледжеометриреализатион**](/windows/win32/api/d2d1_2/nf-d2d1_2-id2d1devicecontext1-createfilledgeometryrealization) или [**креатестрокеджеометриреализатион**](/windows/win32/api/d2d1_2/nf-d2d1_2-id2d1devicecontext1-createstrokedgeometryrealization) и передайте **ID2D1Geometry** для реализации.</span><span class="sxs-lookup"><span data-stu-id="15383-146">To create a geometry realization, call the [**CreateFilledGeometryRealization**](/windows/win32/api/d2d1_2/nf-d2d1_2-id2d1devicecontext1-createfilledgeometryrealization) method or the [**CreateStrokedGeometryRealization**](/windows/win32/api/d2d1_2/nf-d2d1_2-id2d1devicecontext1-createstrokedgeometryrealization) method and pass in the **ID2D1Geometry** to be realized.</span></span>

-   <span data-ttu-id="15383-147">[**Креатефилледжеометриреализатион**](/windows/win32/api/d2d1_2/nf-d2d1_2-id2d1devicecontext1-createfilledgeometryrealization) создает реализацию внутренней части фигуры: регион, который будет нарисован вызовом [**филлжеометри**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillgeometry).</span><span class="sxs-lookup"><span data-stu-id="15383-147">[**CreateFilledGeometryRealization**](/windows/win32/api/d2d1_2/nf-d2d1_2-id2d1devicecontext1-createfilledgeometryrealization) creates a realization of the interior of the shape: the region that would be drawn by calling [**FillGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillgeometry).</span></span>
-   <span data-ttu-id="15383-148">[**Креатестрокеджеометриреализатион**](/windows/win32/api/d2d1_2/nf-d2d1_2-id2d1devicecontext1-createstrokedgeometryrealization) создает реализацию штриха фигуры: регион, который будет нарисован вызовом [**DrawGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawgeometry).</span><span class="sxs-lookup"><span data-stu-id="15383-148">[**CreateStrokedGeometryRealization**](/windows/win32/api/d2d1_2/nf-d2d1_2-id2d1devicecontext1-createstrokedgeometryrealization) creates a realization of the stroke of the shape: the region that would be drawn by calling [**DrawGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawgeometry).</span></span>

<span data-ttu-id="15383-149">Оба вида реализации геометрии представлены интерфейсом [**ID2D1GeometryRealization**](/windows/win32/api/d2d1_2/nn-d2d1_2-id2d1geometryrealization) .</span><span class="sxs-lookup"><span data-stu-id="15383-149">Both kinds of geometry realization are represented by the [**ID2D1GeometryRealization**](/windows/win32/api/d2d1_2/nn-d2d1_2-id2d1geometryrealization) interface.</span></span>

<span data-ttu-id="15383-150">При создании реализации геометрии [Direct2D](direct2d-portal.md) должен свести все кривые в предоставленной геометрии к приближениям к многоугольникам.</span><span class="sxs-lookup"><span data-stu-id="15383-150">When creating a geometry realization, [Direct2D](direct2d-portal.md) must flatten any curves in the provided geometry to polygonal approximations.</span></span> <span data-ttu-id="15383-151">Необходимо указать параметр отказоустойчивости для метода создания — это указывает максимальное расстояние в аппаратно-независимых пикселях между истинной кривой геометрии и ее аппроксимацией.</span><span class="sxs-lookup"><span data-stu-id="15383-151">You must provide a flattening tolerance parameter to the creation method—this specifies the maximum distance, in device-independent pixels (DIPs), between the geometry’s true curve and its polygonal approximation.</span></span> <span data-ttu-id="15383-152">Чем ниже предоставленная погрешность выравнивания, тем выше степень точности результирующего объекта реализации геометрии.</span><span class="sxs-lookup"><span data-stu-id="15383-152">The lower the flattening tolerance you provide, the higher the fidelity of the resulting geometry realization object.</span></span> <span data-ttu-id="15383-153">Аналогично, если обеспечить более высокое допустимое отклонение, обеспечивается реализация геометрической геометрии.</span><span class="sxs-lookup"><span data-stu-id="15383-153">Similarly, providing a higher flattening tolerance yields a lower-fidelity geometry realization.</span></span> <span data-ttu-id="15383-154">Обратите внимание, что реализация геометрической геометрии больше затрат на рисование, чем с низким уровнем точности, но их можно масштабировать еще до введения видимых артефактов.</span><span class="sxs-lookup"><span data-stu-id="15383-154">Note that higher-fidelity geometry realizations are more expensive to draw than lower-fidelity ones, but they can be scaled further before introducing visible artifacts.</span></span> <span data-ttu-id="15383-155">Рекомендации по использованию отклонения прозрачности см. в разделе [масштабирование реализаций геометрических объектов](#scaling-geometry-realizations) ниже.</span><span class="sxs-lookup"><span data-stu-id="15383-155">For guidance on using flattening tolerances, see [Scaling geometry realizations](#scaling-geometry-realizations) below.</span></span>

> [!Note]  
> <span data-ttu-id="15383-156">Объекты реализации геометрии связаны с определенным графическим устройством: это ресурсы, зависящие от устройства.</span><span class="sxs-lookup"><span data-stu-id="15383-156">Geometry realization objects are associated with a particular graphics device: they are device-dependent resources.</span></span>

 

## <a name="drawing-geometry-realizations"></a><span data-ttu-id="15383-157">Рисование реализаций геометрических объектов</span><span class="sxs-lookup"><span data-stu-id="15383-157">Drawing geometry realizations</span></span>

<span data-ttu-id="15383-158">Реализация геометрических объектов аналогична рисованию других [Direct2D](direct2d-portal.md) примитивов, таких как точечные рисунки.</span><span class="sxs-lookup"><span data-stu-id="15383-158">Drawing geometry realizations is similar to drawing other [Direct2D](direct2d-portal.md) primitives, like bitmaps.</span></span> <span data-ttu-id="15383-159">Для этого вызовите метод [**дравжеометриреализатион**](/windows/win32/api/d2d1_2/nf-d2d1_2-id2d1devicecontext1-drawgeometryrealization) и передайте ему объект реализации Geometry для прорисовки и используемую кисть.</span><span class="sxs-lookup"><span data-stu-id="15383-159">To do so, call the [**DrawGeometryRealization**](/windows/win32/api/d2d1_2/nf-d2d1_2-id2d1devicecontext1-drawgeometryrealization) method and pass it the geometry realization object to be drawn and the brush to use.</span></span> <span data-ttu-id="15383-160">Как и в случае с другими методами рисования Direct2D, необходимо вызывать **дравжеометриреализатион** между вызовами [**бегиндрав**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-begindraw) и [**EndDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-enddraw).</span><span class="sxs-lookup"><span data-stu-id="15383-160">As with other Direct2D drawing methods, you must call **DrawGeometryRealization** between calls to [**BeginDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-begindraw) and [**EndDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-enddraw).</span></span>

## <a name="scaling-geometry-realizations"></a><span data-ttu-id="15383-161">Масштабирование реализаций геометрических объектов</span><span class="sxs-lookup"><span data-stu-id="15383-161">Scaling geometry realizations</span></span>

<span data-ttu-id="15383-162">Реализации геометрии, как и другие примитивы [Direct2D](direct2d-portal.md) , учитывают набор преобразований в контексте устройства.</span><span class="sxs-lookup"><span data-stu-id="15383-162">Geometry realizations, like other [Direct2D](direct2d-portal.md) primitives, respect the transform set on the device context.</span></span> <span data-ttu-id="15383-163">Несмотря на то, что преобразования перевода и вращения не влияют на визуальное качество реализаций геометрии, преобразования масштабирования могут создавать визуальные артефакты.</span><span class="sxs-lookup"><span data-stu-id="15383-163">Although translation and rotation transforms have no effect on the visual quality of geometry realizations, scale transforms can produce visual artifacts.</span></span>

<span data-ttu-id="15383-164">В частности, применение крупного масштаба к любой реализации геометрии может привести к отображению многоугольной аппроксимации истинных кривых.</span><span class="sxs-lookup"><span data-stu-id="15383-164">In particular, applying a large enough scale to any geometry realization can reveal the polygonal approximation of the true curves.</span></span> <span data-ttu-id="15383-165">На рисунке ниже показана пара реализаций эллиптических геометрических объектов (заливка и штрих), которые были увеличены слишком далеко.</span><span class="sxs-lookup"><span data-stu-id="15383-165">The image here shows a pair of elliptical geometry realizations (fill and stroke) that have been scaled up too far.</span></span> <span data-ttu-id="15383-166">Кривые — прозрачные артефакты видимы.</span><span class="sxs-lookup"><span data-stu-id="15383-166">Curve-flattening artifacts are visible.</span></span>

![пара реализаций эллиптических геометрических объектов (заливка и штрих), которые были увеличены слишком далеко.](images/zoomed-in.png)

<span data-ttu-id="15383-169">Приложения, имеющие конфиденциальные данные для визуального качества, должны принимать меры, чтобы убедиться, что это не происходит.</span><span class="sxs-lookup"><span data-stu-id="15383-169">Apps that are sensitive to visual quality should take measures to ensure this does not happen.</span></span> <span data-ttu-id="15383-170">Способ масштабирования зависит от потребностей приложения.</span><span class="sxs-lookup"><span data-stu-id="15383-170">How you handle scaling depends on the needs of your app.</span></span> <span data-ttu-id="15383-171">Ниже приведены несколько рекомендуемых подходов для различных типов приложений.</span><span class="sxs-lookup"><span data-stu-id="15383-171">Following are several recommended approaches for several different types of app.</span></span>

### <a name="using-geometry-realizations-in-apps-that-do-not-scale"></a><span data-ttu-id="15383-172">Использование реализаций Geometry в приложениях, которые не масштабируются</span><span class="sxs-lookup"><span data-stu-id="15383-172">Using geometry realizations in apps that do not scale</span></span>

<span data-ttu-id="15383-173">Если приложение не выполняет масштабирование для реализаций геометрии, то можно быть уверенным в том, что только один раз создает реализации, используя один допуск для спрямления.</span><span class="sxs-lookup"><span data-stu-id="15383-173">If your app does not perform any scaling on the geometry realizations, then it is safe to create the realizations only once, using a single flattening tolerance.</span></span> <span data-ttu-id="15383-174">(Преобразования без масштабирования не влияют на визуальное качество визуализированных реализаций геометрии.) Используйте функцию [**компутефлаттенингтолеранце**](/previous-versions/windows/desktop/legacy/dn280327(v=vs.85)) , чтобы вычислить соответствующую погрешность СПРЯМЛЕНИЯ для dpi:</span><span class="sxs-lookup"><span data-stu-id="15383-174">(Non-scaling transforms do not affect the visual quality of rendered geometry realizations.) Use the [**ComputeFlatteningTolerance**](/previous-versions/windows/desktop/legacy/dn280327(v=vs.85)) function to calculate the appropriate flattening tolerance for the DPI:</span></span>


```C++
    float dpiX, dpiY;
    deviceContext->GetDpi(&dpiX, &dpiY);

    float flatteningTolerance = D2D1::ComputeFlatteningTolerance(
        D2D1::Matrix3x2F::Identity(),   // apply no additional scaling transform
        dpiX,                           // horizontal DPI
        dpiY                            // vertical DPI
        );
```



### <a name="using-geometry-realizations-in-apps-that-scale-by-a-small-amount"></a><span data-ttu-id="15383-175">Использование реализаций геометрии в приложениях, которые масштабируются на небольшое количество</span><span class="sxs-lookup"><span data-stu-id="15383-175">Using geometry realizations in apps that scale by a small amount</span></span>

<span data-ttu-id="15383-176">Если приложение может масштабировать геометрическую реализацию только по небольшому объему (например, до 2x или 3 раза), то может быть целесообразно создать реализацию геометрии только один раз, пропорционально отклонить погрешность выравнивания по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="15383-176">If your app can scale a geometry realization up by only a small amount (for example, up to 2x or 3x), then it may be appropriate simply to create the geometry realization once, at a proportionally lower flattening tolerance than the default.</span></span> <span data-ttu-id="15383-177">Это создает реализацию более высокого качества, которая может быть значительно увеличена до создания артефактов масштабирования. компромисс заключается в том, что отрисовка реализации более высокого качества требует больше работы.</span><span class="sxs-lookup"><span data-stu-id="15383-177">This creates a higher-fidelity realization that can be scaled up significantly before incurring scaling artifacts; the trade-off is that drawing the higher-fidelity realization requires more work.</span></span>

<span data-ttu-id="15383-178">Например, предположим, что ваше приложение никогда не будет масштабировать реализацию геометрии более чем на 2 раза.</span><span class="sxs-lookup"><span data-stu-id="15383-178">For example, suppose you know that your app will never scale a geometry realization by more than 2x.</span></span> <span data-ttu-id="15383-179">Приложение может создать геометрическую форму, используя допуск для спрямления, который равен половине значения по умолчанию и просто масштабировать реализацию по мере необходимости, до 2x.</span><span class="sxs-lookup"><span data-stu-id="15383-179">Your app can create the geometry realization using a flattening tolerance that’s half the default value and simply scale the realization as needed, up to 2x.</span></span> <span data-ttu-id="15383-180">Используйте функцию [**компутефлаттенингтолеранце**](/previous-versions/windows/desktop/legacy/dn280327(v=vs.85)) , чтобы вычислить соответствующую погрешность преобразования, передав 2,0 в качестве параметра *максзумфактор* :</span><span class="sxs-lookup"><span data-stu-id="15383-180">Use the [**ComputeFlatteningTolerance**](/previous-versions/windows/desktop/legacy/dn280327(v=vs.85)) function to calculate the appropriate flattening tolerance by passing 2.0 as the *maxZoomFactor* parameter:</span></span>


```C++
    float dpiX, dpiY;
    deviceContext->GetDpi(&dpiX, &dpiY);
    
    float flatteningTolerance = D2D1::ComputeFlatteningTolerance(
        D2D1::Matrix3x2F::Identity(),   // apply no additional scaling transform
        dpiX,                           // horizontal DPI
        dpiY,                           // vertical DPI
        2.0f                            // realization can be scaled by an additional 2x
        );
```



### <a name="using-geometry-realizations-in-apps-that-scale-by-a-large-amount"></a><span data-ttu-id="15383-181">Использование реализаций геометрических объектов в приложениях, масштабируемых по большому объему</span><span class="sxs-lookup"><span data-stu-id="15383-181">Using geometry realizations in apps that scale by a large amount</span></span>

<span data-ttu-id="15383-182">Если приложение может масштабировать геометрические объекты с помощью больших объемов (например, 10 раз или более), то обработка масштабирования будет более сложной.</span><span class="sxs-lookup"><span data-stu-id="15383-182">If your app can scale a geometry realization up or down by large amounts (for example, by 10x or more), then handling scaling appropriately is more complicated.</span></span>

<span data-ttu-id="15383-183">Для большинства из этих приложений рекомендуется воссоздать реализацию геометрии при постепенном понижении отказоустойчивости при масштабировании сцены, чтобы обеспечить точность визуальных элементов и избежать артефактов масштабирования.</span><span class="sxs-lookup"><span data-stu-id="15383-183">For most of these apps, the recommended approach is to recreate the geometry realization at progressively lower flattening tolerances as the scene is scaled up, in order to maintain visual fidelity and avoid scaling artifacts.</span></span> <span data-ttu-id="15383-184">Аналогично, по мере масштабирования сцены приложение должно повторно создавать реализации геометрических объектов при последовательном увеличении допустимых оттенков, чтобы избежать вастефуллиных сведений о отрисовке.</span><span class="sxs-lookup"><span data-stu-id="15383-184">Similarly, as the scene is scaled down, the app should recreate the geometry realizations at progressively higher flattening tolerances, in order to avoid wastefully rendering details that aren’t visible.</span></span> <span data-ttu-id="15383-185">Приложение не должно повторно создавать реализации геометрических объектов при каждом изменении масштаба, так как это не нарушает цель кэширования работы тесселяции.</span><span class="sxs-lookup"><span data-stu-id="15383-185">The app shouldn’t recreate the geometry realizations every time the scale changes, because doing so defeats the purpose of caching the tessellation work.</span></span> <span data-ttu-id="15383-186">Вместо этого приложение должно повторно создавать реализации геометрии менее часто: например, после каждого увеличения или уменьшения масштаба.</span><span class="sxs-lookup"><span data-stu-id="15383-186">Instead, the app should recreate the geometry realizations less frequently: for example, after every 2x increase or decrease in scale.</span></span>

<span data-ttu-id="15383-187">Каждый раз, когда масштабирование изменяется в приложении в ответ на взаимодействие с пользователем, приложение может сравнить новый масштаб с масштабом, в котором они были созданы последними (например, в элементе **m \_ ластскале** ).</span><span class="sxs-lookup"><span data-stu-id="15383-187">Each time the scale changes in an app in response to user interaction, the app could compare the new scale against the scale at which the geometry realizations were last created (stored, for example, in an **m\_lastScale** member).</span></span> <span data-ttu-id="15383-188">Если два значения являются близкими (в данном случае — в пределах коэффициента 2), дальнейшие действия не предпринимаются.</span><span class="sxs-lookup"><span data-stu-id="15383-188">If the two values are close (in this case, within a factor of 2), then no further action is taken.</span></span> <span data-ttu-id="15383-189">Но если эти два значения не закрыты, то реализации геометрии будут созданы повторно.</span><span class="sxs-lookup"><span data-stu-id="15383-189">But if the two values are not close, then the geometry realizations are re-created.</span></span> <span data-ttu-id="15383-190">Функция [**компутефлаттенингтолеранце**](/previous-versions/windows/desktop/legacy/dn280327(v=vs.85)) используется для расчета допуска прозрачности, соответствующего новому масштабу, а **m \_ ластскале** обновляется до новой шкалы.</span><span class="sxs-lookup"><span data-stu-id="15383-190">The [**ComputeFlatteningTolerance**](/previous-versions/windows/desktop/legacy/dn280327(v=vs.85)) function is used to compute a flattening tolerance appropriate for the new scale, and **m\_lastScale** is updated to the new scale.</span></span>

<span data-ttu-id="15383-191">Кроме того, приложение всегда создает реализации с меньшим отклонением, чем обычно используется для нового масштаба, передавая значение 2 в качестве параметра *максзумфактор* в [**компутефлаттенингтолеранце**](/previous-versions/windows/desktop/legacy/dn280327(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="15383-191">In addition, the app always creates realizations using a smaller tolerance than what would normally be used for the new scale, by passing a value of 2 as the *maxZoomFactor* parameter to [**ComputeFlatteningTolerance**](/previous-versions/windows/desktop/legacy/dn280327(v=vs.85)).</span></span> <span data-ttu-id="15383-192">Это позволяет масштабировать новые реализации геометрии по дополнительному коэффициенту 2 без дополнительных артефактов масштабирования.</span><span class="sxs-lookup"><span data-stu-id="15383-192">This allows the new geometry realizations to be scaled up by an additional factor of 2 without incurring scaling artifacts.</span></span>

> [!Note]  
> <span data-ttu-id="15383-193">Описанный здесь подход может оказаться непригодным для всех приложений.</span><span class="sxs-lookup"><span data-stu-id="15383-193">The approach described here may not be appropriate for all apps.</span></span> <span data-ttu-id="15383-194">Например, если приложение позволяет очень быстро масштабировать сцену с помощью очень больших факторов (например, если она содержит ползунок "Масштаб", который можно переместить с 100% на 1 000 000% в диапазоне нескольких кадров), то этот подход может привести к чрезмерной работе путем повторного создания геометрического объекта.</span><span class="sxs-lookup"><span data-stu-id="15383-194">For example, if your app allows the scene to be scaled by very large factors very quickly (for example, if it contains a “zoom” slider that can be moved from 100% to 1,000,000% in the span of a few frames) then this approach may result in excess work by recreating the geometry realizations every frame.</span></span> <span data-ttu-id="15383-195">В качестве альтернативного подхода можно создать повторное создание геометрии только после завершения каждой манипуляции шкалы сцены (например, после завершения пользователем жеста сжатия).</span><span class="sxs-lookup"><span data-stu-id="15383-195">An alternative approach is to recreate the geometry realizations only after each manipulation of the scene’s scale has been completed (for example, after the user has completed a pinch gesture).</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="15383-196">См. также</span><span class="sxs-lookup"><span data-stu-id="15383-196">Related topics</span></span>

[<span data-ttu-id="15383-197">Обзор геометрий</span><span class="sxs-lookup"><span data-stu-id="15383-197">Geometries Overview</span></span>](direct2d-geometries-overview.md)

[<span data-ttu-id="15383-198">Повышение производительности приложений Direct2D</span><span class="sxs-lookup"><span data-stu-id="15383-198">Improving the performance of Direct2D apps</span></span>](improving-direct2d-performance.md)

[<span data-ttu-id="15383-199">Общие рекомендации по визуализации сложного статического содержимого</span><span class="sxs-lookup"><span data-stu-id="15383-199">General guidelines for rendering complex static content</span></span>](improving-direct2d-performance.md)

[<span data-ttu-id="15383-200">**ID2D1DeviceContext1**</span><span class="sxs-lookup"><span data-stu-id="15383-200">**ID2D1DeviceContext1**</span></span>](/windows/win32/api/d2d1_2/nn-d2d1_2-id2d1devicecontext1)

[<span data-ttu-id="15383-201">**ID2D1GeometryRealization**</span><span class="sxs-lookup"><span data-stu-id="15383-201">**ID2D1GeometryRealization**</span></span>](/windows/win32/api/d2d1_2/nn-d2d1_2-id2d1geometryrealization)

<span data-ttu-id="15383-202">[**Функция Компутефлаттенингтолеранце**](/previous-versions/windows/desktop/legacy/dn280327(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="15383-202">[**ComputeFlatteningTolerance function**](/previous-versions/windows/desktop/legacy/dn280327(v=vs.85))</span></span>