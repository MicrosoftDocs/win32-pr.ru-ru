---
title: Отрисовка текста с помощью Direct2D и DirectWrite
description: В отличие от других API-интерфейсов, таких как GDI, GDI+ или WPF, Direct2D взаимодействует с другим API, DirectWrite, для управления и отрисовки текста. В этом разделе описываются преимущества и взаимодействие этих отдельных компонентов.
ms.assetid: 1d5b8deb-34e2-433c-8de3-4ef66fb4e49d
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e2c49a8f341377bcf78a9a99699a3bd4852411dd
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104550798"
---
# <a name="text-rendering-with-direct2d-and-directwrite"></a><span data-ttu-id="83f63-104">Отрисовка текста с помощью Direct2D и DirectWrite</span><span class="sxs-lookup"><span data-stu-id="83f63-104">Text Rendering with Direct2D and DirectWrite</span></span>

<span data-ttu-id="83f63-105">В отличие от других API-интерфейсов, таких как [GDI](/windows/desktop/gdi/windows-gdi), GDI+ или WPF, [Direct2D](./direct2d-portal.md) взаимодействует с другим API, [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal), для управления и отрисовки текста.</span><span class="sxs-lookup"><span data-stu-id="83f63-105">Unlike other APIs, such as [GDI](/windows/desktop/gdi/windows-gdi), GDI+ or WPF, [Direct2D](./direct2d-portal.md) interoperates with another API, [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal), to manipulate and render text.</span></span> <span data-ttu-id="83f63-106">В этом разделе описываются преимущества и взаимодействие этих отдельных компонентов.</span><span class="sxs-lookup"><span data-stu-id="83f63-106">This topic describes the benefits and interoperation of these separate components.</span></span>

<span data-ttu-id="83f63-107">В этом разделе содержатся следующие подразделы.</span><span class="sxs-lookup"><span data-stu-id="83f63-107">This topic contains the following sections.</span></span>

-   [<span data-ttu-id="83f63-108">Direct2D включает добавочное внедрение</span><span class="sxs-lookup"><span data-stu-id="83f63-108">Direct2D Enables Incremental Adoption</span></span>](#direct2d-enables-incremental-adoption)
-   [<span data-ttu-id="83f63-109">Текстовые службы и отрисовка текста</span><span class="sxs-lookup"><span data-stu-id="83f63-109">Text Services versus Text Rendering</span></span>](#text-services-versus-text-rendering)
-   [<span data-ttu-id="83f63-110">Глифы и текст</span><span class="sxs-lookup"><span data-stu-id="83f63-110">Glyphs versus Text</span></span>](#glyphs-versus-text)
-   [<span data-ttu-id="83f63-111">DirectWrite и Direct2D</span><span class="sxs-lookup"><span data-stu-id="83f63-111">DirectWrite and Direct2D</span></span>](#directwrite-and-direct2d)
    -   [<span data-ttu-id="83f63-112">DrawText</span><span class="sxs-lookup"><span data-stu-id="83f63-112">DrawText</span></span>](#drawtextlayout)
    -   [<span data-ttu-id="83f63-113">дравтекстлайаут</span><span class="sxs-lookup"><span data-stu-id="83f63-113">DrawTextLayout</span></span>](#drawtextlayout)
    -   [<span data-ttu-id="83f63-114">DrawGlyphRun</span><span class="sxs-lookup"><span data-stu-id="83f63-114">DrawGlyphRun</span></span>](#drawglyphrun)
-   [<span data-ttu-id="83f63-115">Рендеринг глифов</span><span class="sxs-lookup"><span data-stu-id="83f63-115">Glyph Rendering</span></span>](#glyph-rendering)
-   [<span data-ttu-id="83f63-116">Заключение</span><span class="sxs-lookup"><span data-stu-id="83f63-116">Conclusion</span></span>](#conclusion)

## <a name="direct2d-enables-incremental-adoption"></a><span data-ttu-id="83f63-117">Direct2D включает добавочное внедрение</span><span class="sxs-lookup"><span data-stu-id="83f63-117">Direct2D Enables Incremental Adoption</span></span>

<span data-ttu-id="83f63-118">Перемещение приложения из одного графического API в другой может быть сложным или ненужным по различным причинам.</span><span class="sxs-lookup"><span data-stu-id="83f63-118">Moving an application from one graphics API to another can be difficult or not what you want for various reasons.</span></span> <span data-ttu-id="83f63-119">Это может быть вызвано тем, что необходимо поддерживать подключаемые модули, которые по-прежнему используют старые интерфейсы, так как само приложение слишком велико для переноса на новый API в одном выпуске или потому, что более старый API достаточно хорошо работает для других частей приложения.</span><span class="sxs-lookup"><span data-stu-id="83f63-119">This might be because you have to support plug-ins that still take the older interfaces, because the application itself is too large to port over to a new API in one release or because some part of the newer API is desirable but the older API is working well enough for other parts of the application.</span></span>

<span data-ttu-id="83f63-120">Поскольку [Direct2D](./direct2d-portal.md) и [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) реализуются как отдельные компоненты, можно обновить всю систему двухмерной графики или просто текстовую часть.</span><span class="sxs-lookup"><span data-stu-id="83f63-120">Because [Direct2D](./direct2d-portal.md) and [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) are implemented as separate components, you can upgrade your whole 2D graphics system or just the text part of it.</span></span> <span data-ttu-id="83f63-121">Например, можно обновить приложение, чтобы использовать DirectWrite для текста, но по-прежнему использовать [GDI](/windows/desktop/gdi/windows-gdi) или GDI+ для отрисовки.</span><span class="sxs-lookup"><span data-stu-id="83f63-121">For example, you could update an application to use DirectWrite for text but still use [GDI](/windows/desktop/gdi/windows-gdi) or GDI+ for rendering.</span></span>

## <a name="text-services-versus-text-rendering"></a><span data-ttu-id="83f63-122">Текстовые службы и отрисовка текста</span><span class="sxs-lookup"><span data-stu-id="83f63-122">Text Services versus Text Rendering</span></span>

<span data-ttu-id="83f63-123">По мере развития приложений требования к обработке текста были все еще сложны.</span><span class="sxs-lookup"><span data-stu-id="83f63-123">As applications have evolved, their text processing requirements have grown increasingly complex.</span></span> <span data-ttu-id="83f63-124">В первую очередь, текст обычно ограничен статическим выходным ИНТЕРФЕЙСом, а текст был отображен в хорошо определенном поле, например на кнопке.</span><span class="sxs-lookup"><span data-stu-id="83f63-124">At first, text was generally confined to statically laid-out UI, and the text was rendered in a well-defined box, such as a button.</span></span> <span data-ttu-id="83f63-125">По мере того, как приложения начали быть доступны на растущем количестве языков, этот подход стал труднее, так как ширина и высота переведенного текста могут значительно различаться в разных языках.</span><span class="sxs-lookup"><span data-stu-id="83f63-125">As applications began to be available in a growing number of languages, this approach became more difficult to sustain because both the width and height of the translated text can vary significantly between languages.</span></span> <span data-ttu-id="83f63-126">Для адаптации приложения начали динамически размещать свой пользовательский интерфейс в зависимости от фактического размера отображаемого текста, а не наоборот.</span><span class="sxs-lookup"><span data-stu-id="83f63-126">To adapt, applications started to dynamically lay out their UI to depend on the actual rendered size of the text, instead of the other way around.</span></span>

<span data-ttu-id="83f63-127">Чтобы помочь приложениям выполнить эту задачу, [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) предоставляет интерфейс [**идвритетекстлайаут**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextlayout) .</span><span class="sxs-lookup"><span data-stu-id="83f63-127">To help applications complete this task, [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) provides the [**IDWriteTextLayout**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextlayout) interface.</span></span> <span data-ttu-id="83f63-128">Этот API позволяет приложению указать часть текста со сложными характеристиками, такими как различные шрифты и размеры шрифтов, подчеркивания, зачеркивание, двунаправленный текст, эффекты, многоточие и даже встроенные символы, отличные от глифов (например, точечный значок или значок).</span><span class="sxs-lookup"><span data-stu-id="83f63-128">This API enables an application to specify a piece of text with complex characteristics such as different fonts and font sizes, underlines, strikethroughs, bi-directional text, effects, ellipsis and even embedded non-glyph characters (such as a bitmap emoticon or an icon).</span></span> <span data-ttu-id="83f63-129">Приложение может изменить различные характеристики текста по мере того, как оно последовательно определяет макет пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="83f63-129">The application can then change various characteristics of the text as it iteratively determines its UI layout.</span></span> <span data-ttu-id="83f63-130">[Пример Hello World DirectWrite](/samples/browse/?redirectedfrom=MSDN-samples), который показан на следующем рисунке и в разделе [Учебник: Начало работы with DirectWrite](/windows/desktop/DirectWrite/getting-started-with-directwrite) , демонстрирует многие из этих эффектов.</span><span class="sxs-lookup"><span data-stu-id="83f63-130">The [DirectWrite Hello World Sample](/samples/browse/?redirectedfrom=MSDN-samples), which is shown in the following illustration and in the [Tutorial: Getting Started with DirectWrite](/windows/desktop/DirectWrite/getting-started-with-directwrite) topic, shows many of these effects.</span></span>

![снимок экрана примера "Hello World".](images/dwrite-hello-world.png)

<span data-ttu-id="83f63-132">Макет может расположить глифы в идеале на основе их ширины (как в WPF), или же можно привязать глифы к ближайшим позициям в пикселях (как в [GDI](/windows/desktop/gdi/windows-gdi) ).</span><span class="sxs-lookup"><span data-stu-id="83f63-132">The layout can either position the glyphs ideally based on their widths (as WPF does), or it can snap the glyphs to the nearest pixel positions (as [GDI](/windows/desktop/gdi/windows-gdi) does).</span></span>

<span data-ttu-id="83f63-133">Помимо получения текстовых измерений, приложение может выполнять проверку различных частей текста.</span><span class="sxs-lookup"><span data-stu-id="83f63-133">In addition to obtaining text measurements, the application can hit test various parts of the text.</span></span> <span data-ttu-id="83f63-134">Например, может потребоваться убедиться в том, что нажата гиперссылка в тексте.</span><span class="sxs-lookup"><span data-stu-id="83f63-134">For example, it might want to know that a hyperlink in the text is clicked.</span></span> <span data-ttu-id="83f63-135">(Дополнительные сведения о проверке попадания см. в разделе [Проверка нажатия для разметки текста](/windows/desktop/DirectWrite/how-to-perform-hit-testing-on-a-text-layout) .)</span><span class="sxs-lookup"><span data-stu-id="83f63-135">(For more information about hit testing, see the [How to Perform Hit Testing on a Text Layout](/windows/desktop/DirectWrite/how-to-perform-hit-testing-on-a-text-layout) topic.)</span></span>

<span data-ttu-id="83f63-136">Интерфейс макета текста отделен от API отрисовки, используемого приложением, как показано на следующей схеме:</span><span class="sxs-lookup"><span data-stu-id="83f63-136">The text layout interface is decoupled from the rendering API that the application uses, as the following diagram shows:</span></span>

![Макет текста и диаграмма API графики.](images/direct2d-directwrite1.png)

<span data-ttu-id="83f63-138">Это разделение возможно, так как DirectWrite предоставляет интерфейс отрисовки ([**идвритетекстрендерер**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer)), который приложения могут реализовать для отображения текста с помощью любого нужного API.</span><span class="sxs-lookup"><span data-stu-id="83f63-138">This separation is possible because DirectWrite provides a rendering interface ([**IDWriteTextRenderer**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer)) that applications can implement to render text by using whatever graphics API you want.</span></span> <span data-ttu-id="83f63-139">Приложение, реализующее метод обратного вызова [**идвритетекстрендерер::D равглифрун**](/windows/desktop/api/dwrite/nf-dwrite-idwritetextrenderer-drawglyphrun) , вызывается DirectWrite при отрисовке макета текста.</span><span class="sxs-lookup"><span data-stu-id="83f63-139">The application implemented [**IDWriteTextRenderer::DrawGlyphRun**](/windows/desktop/api/dwrite/nf-dwrite-idwritetextrenderer-drawglyphrun) callback method is called by DirectWrite when rendering a text layout.</span></span> <span data-ttu-id="83f63-140">Этот метод отвечает за выполнение операций рисования или их передачу.</span><span class="sxs-lookup"><span data-stu-id="83f63-140">It is the responsibility of this method to perform the drawing operations or pass them along.</span></span>

<span data-ttu-id="83f63-141">Для рисования глифов [Direct2D](./direct2d-portal.md) предоставляет [**ID2D1RenderTarget::D равглифрун**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) для рисования на поверхности Direct2D, а [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) предоставляет [**идвритебитмапрендертаржет::D равглифрун**](/windows/desktop/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun) для рисования на поверхность GDI, которую затем можно передать в окно с помощью GDI.</span><span class="sxs-lookup"><span data-stu-id="83f63-141">For drawing glyphs, [Direct2D](./direct2d-portal.md) provides [**ID2D1RenderTarget::DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) for drawing to a Direct2D surface and [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) provides [**IDWriteBitmapRenderTarget::DrawGlyphRun**](/windows/desktop/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun) for drawing to a GDI surface that can then be transferred to a window by using GDI.</span></span> <span data-ttu-id="83f63-142">**DrawGlyphRun** в Direct2D и DirectWrite имеют строго совместимые параметры метода [**DrawGlyphRun**](/windows/desktop/api/dwrite/nf-dwrite-idwritetextrenderer-drawglyphrun) , реализуемого приложением в [**идвритетекстрендерер**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer).</span><span class="sxs-lookup"><span data-stu-id="83f63-142">Conveniently, **DrawGlyphRun** in both Direct2D and DirectWrite have exactly compatible parameters to the [**DrawGlyphRun**](/windows/desktop/api/dwrite/nf-dwrite-idwritetextrenderer-drawglyphrun) method that the application implements on [**IDWriteTextRenderer**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer).</span></span>

<span data-ttu-id="83f63-143">Следуя подобным разделениям, функции для работы с текстом (например, перечисление и управление шрифтами, анализ глифов и т. д.) обрабатываются [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) вместо [Direct2D](./direct2d-portal.md).</span><span class="sxs-lookup"><span data-stu-id="83f63-143">Following a similar separation, text-specific features (such as font enumeration and management, glyph analysis, and so on) are handled by [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) instead of [Direct2D](./direct2d-portal.md).</span></span> <span data-ttu-id="83f63-144">Объекты DirectWrite принимаются непосредственно Direct2D.</span><span class="sxs-lookup"><span data-stu-id="83f63-144">The DirectWrite objects are accepted directly by Direct2D.</span></span> <span data-ttu-id="83f63-145">Чтобы помочь существующим приложениям GDI воспользоваться преимуществами DirectWrite, он предоставляет интерфейс метода [**идвритегдиинтероп**](/windows/desktop/api/dwrite/nn-dwrite-idwritegdiinterop) с методами для выполнения следующих задач:</span><span class="sxs-lookup"><span data-stu-id="83f63-145">To help existing GDI applications to take advantage of DirectWrite, it provides the [**IDWriteGdiInterop**](/windows/desktop/api/dwrite/nn-dwrite-idwritegdiinterop) method interface with methods to do the following:</span></span>

-   <span data-ttu-id="83f63-146">Создание шрифта [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) из логического шрифта [GDI](/windows/desktop/gdi/windows-gdi) ([**креатефонтфромлогфонт**](/windows/desktop/api/dwrite/nf-dwrite-idwritegdiinterop-createfontfromlogfont)).</span><span class="sxs-lookup"><span data-stu-id="83f63-146">Create a [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) Font from a [GDI](/windows/desktop/gdi/windows-gdi) Logical Font ([**CreateFontFromLOGFONT**](/windows/desktop/api/dwrite/nf-dwrite-idwritegdiinterop-createfontfromlogfont)).</span></span>
-   <span data-ttu-id="83f63-147">Преобразование из шрифта [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) в логический шрифт [GDI](/windows/desktop/gdi/windows-gdi) ([**конвертфонтфацетологфонт**](/windows/desktop/api/dwrite/nf-dwrite-idwritegdiinterop-convertfontfacetologfont)).</span><span class="sxs-lookup"><span data-stu-id="83f63-147">Convert from a [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) Font Face to a [GDI](/windows/desktop/gdi/windows-gdi) Logical Font ([**ConvertFontFaceToLOGFONT**](/windows/desktop/api/dwrite/nf-dwrite-idwritegdiinterop-convertfontfacetologfont)).</span></span>
-   <span data-ttu-id="83f63-148">Извлеките шрифт [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) из выбранного в HDC.</span><span class="sxs-lookup"><span data-stu-id="83f63-148">Retrieve the [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) Font Face from the one that is selected into an HDC.</span></span> <span data-ttu-id="83f63-149">([**Креатефонтфацефромхдк**](/windows/desktop/api/dwrite/nf-dwrite-idwritegdiinterop-createfontfacefromhdc))</span><span class="sxs-lookup"><span data-stu-id="83f63-149">([**CreateFontFaceFromHdc**](/windows/desktop/api/dwrite/nf-dwrite-idwritegdiinterop-createfontfacefromhdc))</span></span>
-   <span data-ttu-id="83f63-150">Создание [**целевого объекта отрисовки точечного рисунка**](/windows/desktop/api/dwrite/nn-dwrite-idwritebitmaprendertarget) [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) в системной памяти ([**креатебитмапрендертаржет**](/windows/desktop/api/dwrite/nf-dwrite-idwritegdiinterop-createbitmaprendertarget)).</span><span class="sxs-lookup"><span data-stu-id="83f63-150">Create a [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) [**bitmap render target**](/windows/desktop/api/dwrite/nn-dwrite-idwritebitmaprendertarget) in system memory ([**CreateBitmapRenderTarget**](/windows/desktop/api/dwrite/nf-dwrite-idwritegdiinterop-createbitmaprendertarget)).</span></span>

## <a name="glyphs-versus-text"></a><span data-ttu-id="83f63-151">Глифы и текст</span><span class="sxs-lookup"><span data-stu-id="83f63-151">Glyphs versus Text</span></span>

<span data-ttu-id="83f63-152">Текст — это набор кодовых позиций Юникода (символов) с различными модификаторами стилистического начертания (шрифты, веса, подчеркивания, зачеркивание и т. д.), которые располагаются в прямоугольнике.</span><span class="sxs-lookup"><span data-stu-id="83f63-152">Text is a set of Unicode code points (characters), with various stylistic modifiers (fonts, weights, underlines, strikethroughs, and so on) that is laid out in a rectangle.</span></span> <span data-ttu-id="83f63-153">Глиф, напротив, является определенным индексом в определенном файле шрифта.</span><span class="sxs-lookup"><span data-stu-id="83f63-153">A glyph, in contrast, is a particular index into a particular font file.</span></span> <span data-ttu-id="83f63-154">Глиф определяет набор кривых, которые могут быть визуализированы, но не имеют текстового значения.</span><span class="sxs-lookup"><span data-stu-id="83f63-154">A glyph defines a set of curves which can be rendered, but, it doesn't have any textual meaning.</span></span> <span data-ttu-id="83f63-155">Между глифами и символами существует потенциальное сопоставление типа «многие ко многим».</span><span class="sxs-lookup"><span data-stu-id="83f63-155">There is potentially a many-to-many mapping between glyphs and characters.</span></span> <span data-ttu-id="83f63-156">Последовательность глифов, которая поступает из одной и той же гарнитуры шрифта и располагается последовательно в базовом плане, называется [GlyphRun](/windows/desktop/DirectWrite/glyphs-and-glyph-runs).</span><span class="sxs-lookup"><span data-stu-id="83f63-156">A sequence of glyphs that come from the same Font Face and that are laid-out sequentially on a baseline is called a [GlyphRun](/windows/desktop/DirectWrite/glyphs-and-glyph-runs).</span></span> <span data-ttu-id="83f63-157">Как [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) , так и [Direct2D](./direct2d-portal.md) вызывают наиболее точную [**DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) API рендеринга глифов и имеют очень похожие подписи.</span><span class="sxs-lookup"><span data-stu-id="83f63-157">Both [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) and [Direct2D](./direct2d-portal.md) call their most precise glyph rendering API [**DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) and they have very similar signatures.</span></span> <span data-ttu-id="83f63-158">В следующем примере из [**ID2D1RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget) в Direct2D:</span><span class="sxs-lookup"><span data-stu-id="83f63-158">The following is from [**ID2D1RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget) in Direct2D:</span></span>


```
STDMETHOD_(void, DrawGlyphRun)(
        D2D1_POINT_2F baselineOrigin,
        __in CONST DWRITE_GLYPH_RUN *glyphRun,
        __in ID2D1Brush *foregroundBrush,
        DWRITE_MEASURING_MODE measuringMode = DWRITE_MEASURING_MODE_NATURAL 
        ) PURE;
```



<span data-ttu-id="83f63-159">И этот метод из [**идвритебитмапрендертаржет**](/windows/desktop/api/dwrite/nn-dwrite-idwritebitmaprendertarget) в [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal):</span><span class="sxs-lookup"><span data-stu-id="83f63-159">And this method is from [**IDWriteBitmapRenderTarget**](/windows/desktop/api/dwrite/nn-dwrite-idwritebitmaprendertarget) in [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal):</span></span>


```
STDMETHOD(DrawGlyphRun)(
        FLOAT baselineOriginX,
        FLOAT baselineOriginY,
        DWRITE_MEASURING_MODE measuringMode,
        __in DWRITE_GLYPH_RUN const* glyphRun,
        IDWriteRenderingParams* renderingParams,
        COLORREF textColor,
        __out_opt RECT* blackBoxRect = NULL
        ) PURE;
```



<span data-ttu-id="83f63-160">Версия [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) сохраняет исходный план, режим измерения и параметры запуска глифа и включает дополнительные параметры.</span><span class="sxs-lookup"><span data-stu-id="83f63-160">The [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) version keeps the baseline origin, measuring mode and the glyph run parameters and includes additional parameters.</span></span>

<span data-ttu-id="83f63-161">[DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) также позволяет использовать пользовательский модуль визуализации для глифов путем реализации интерфейса [**идвритетекстрендерер**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer) .</span><span class="sxs-lookup"><span data-stu-id="83f63-161">[DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) also enables you to use a custom renderer for glyphs by implementing the [**IDWriteTextRenderer**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer) interface.</span></span> <span data-ttu-id="83f63-162">Этот интерфейс также имеет метод **DrawGlyphRun** , как показано в следующем примере кода.</span><span class="sxs-lookup"><span data-stu-id="83f63-162">This interface also has a **DrawGlyphRun** method, as the following code example shows.</span></span>


```
STDMETHOD(DrawGlyphRun)(
        __maybenull void* clientDrawingContext,
        FLOAT baselineOriginX,
        FLOAT baselineOriginY,
        DWRITE_MEASURING_MODE measuringMode,
        __in DWRITE_GLYPH_RUN const* glyphRun,
        __in DWRITE_GLYPH_RUN_DESCRIPTION const* glyphRunDescription,
        __maybenull IUnknown* clientDrawingEffect
        ) PURE;
```



<span data-ttu-id="83f63-163">Эта версия содержит больше параметров, которые полезны при реализации пользовательского модуля [подготовки текста](/windows/desktop/DirectWrite/how-to-implement-a-custom-text-renderer).</span><span class="sxs-lookup"><span data-stu-id="83f63-163">This version includes more parameters that are useful when you implement a [custom text renderer](/windows/desktop/DirectWrite/how-to-implement-a-custom-text-renderer).</span></span> <span data-ttu-id="83f63-164">Последний параметр используется для реализованных приложением пользовательских эффектов рисования.</span><span class="sxs-lookup"><span data-stu-id="83f63-164">The final parameter is used for application-implemented custom drawing effects.</span></span> <span data-ttu-id="83f63-165">(Дополнительные сведения о влиянии на рисование клиента см. в разделе [Добавление клиентских эффектов рисования в макет текста](/windows/desktop/DirectWrite/how-to-add-custom-drawing-efffects-to-a-text-layout).</span><span class="sxs-lookup"><span data-stu-id="83f63-165">(For more information about client drawing effects see [How to Add Client Drawing Effects to a Text Layout](/windows/desktop/DirectWrite/how-to-add-custom-drawing-efffects-to-a-text-layout).</span></span>

<span data-ttu-id="83f63-166">Каждый запуск глифа начинается в источнике и помещается в строку, начиная с этого источника.</span><span class="sxs-lookup"><span data-stu-id="83f63-166">Each glyph run starts at an origin and is put on a line starting from this origin.</span></span> <span data-ttu-id="83f63-167">Глифы изменяются текущим преобразованием мира и выбранными параметрами отрисовки текста для связанного целевого объекта прорисовки.</span><span class="sxs-lookup"><span data-stu-id="83f63-167">The glyphs are changed by the current world transform and the selected text rendering settings on the associated render target.</span></span> <span data-ttu-id="83f63-168">Этот API обычно вызывается напрямую только приложениями, которые выполняют собственный макет (например, текстовый процессор) или приложением, реализующим интерфейс [**идвритетекстрендерер**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer) .</span><span class="sxs-lookup"><span data-stu-id="83f63-168">This API is generally called directly only by applications that do their own layout (For example a Word Processor) or by an application that has implemented the [**IDWriteTextRenderer**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer) interface.</span></span>

## <a name="directwrite-and-direct2d"></a><span data-ttu-id="83f63-169">DirectWrite и Direct2D</span><span class="sxs-lookup"><span data-stu-id="83f63-169">DirectWrite and Direct2D</span></span>

<span data-ttu-id="83f63-170">[Direct2D](./direct2d-portal.md) предоставляет службы визуализации на уровне глифов через [**DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun).</span><span class="sxs-lookup"><span data-stu-id="83f63-170">[Direct2D](./direct2d-portal.md) provides glyph level rendering services through [**DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun).</span></span> <span data-ttu-id="83f63-171">Однако для этого требуется, чтобы приложение реализовало сведения о отрисовке, что, по сути, повторно создает функциональные возможности API [**DrawText**](/windows/desktop/api/winuser/nf-winuser-drawtext) из GDI.</span><span class="sxs-lookup"><span data-stu-id="83f63-171">However, this requires the application to implement the details of rendering, which basically reproduces the functionality of the [**DrawText**](/windows/desktop/api/winuser/nf-winuser-drawtext) API from GDI on its own.</span></span>

<span data-ttu-id="83f63-172">Таким образом, [Direct2D](./direct2d-portal.md) предоставляет API-интерфейсы, которые принимают текст вместо Glyphs: [**ID2D1RenderTarget::D равтекстлайаут**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) and [**ID2D1RenderTarget::D равтекст**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)).</span><span class="sxs-lookup"><span data-stu-id="83f63-172">Therefore, [Direct2D](./direct2d-portal.md) provides APIs that accept text instead of glyphs: [**ID2D1RenderTarget::DrawTextLayout**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) and [**ID2D1RenderTarget::DrawText**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)).</span></span> <span data-ttu-id="83f63-173">Оба метода подготавливаются к поверхности Direct2D.</span><span class="sxs-lookup"><span data-stu-id="83f63-173">Both methods render to a Direct2D surface.</span></span> <span data-ttu-id="83f63-174">Для подготовки к просмотру на поверхности GDI предоставляется [**идвритебитмапрендертаржет::D равглифрун**](/windows/desktop/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun) .</span><span class="sxs-lookup"><span data-stu-id="83f63-174">To render to a GDI surface, [**IDWriteBitmapRenderTarget::DrawGlyphRun**](/windows/desktop/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun) is provided.</span></span> <span data-ttu-id="83f63-175">Однако для этого метода требуется, чтобы пользовательский модуль подготовки текста был реализован приложением.</span><span class="sxs-lookup"><span data-stu-id="83f63-175">But this method requires a custom text renderer to be implemented by the application.</span></span> <span data-ttu-id="83f63-176">(Дополнительные сведения см. в разделе [Подготовка к поверхности GDI](/windows/desktop/DirectWrite/render-to-a-gdi-surface) .)</span><span class="sxs-lookup"><span data-stu-id="83f63-176">(For more information, see the [Render to a GDI Surface](/windows/desktop/DirectWrite/render-to-a-gdi-surface) topic.)</span></span>

<span data-ttu-id="83f63-177">Использование текста приложением обычно начинается с простого: пошаговое нажатие кнопки " **ОК** " или **"Отмена"** на кнопке с фиксированным макетом.</span><span class="sxs-lookup"><span data-stu-id="83f63-177">An application's usage of text typically starts simple: put **OK** or **Cancel** on a fixed-layout button, for example.</span></span> <span data-ttu-id="83f63-178">Однако со временем оно станет более сложным, так как используется Международная связь и добавляются другие компоненты.</span><span class="sxs-lookup"><span data-stu-id="83f63-178">However, over time, it becomes more complex as internationalization and other features are added.</span></span> <span data-ttu-id="83f63-179">В конечном итоге многие приложения должны использовать объекты макета текста [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) и реализовать модуль подготовки текста.</span><span class="sxs-lookup"><span data-stu-id="83f63-179">Eventually many applications will have to use [DirectWrite's](/windows/desktop/DirectWrite/direct-write-portal) text layout objects and implement the text renderer.</span></span>

<span data-ttu-id="83f63-180">Таким образом, [Direct2D](./direct2d-portal.md) предоставляет многоуровневые API, которые позволяют приложению запускаться просто и более сложным, не отвлекая и не отменяя рабочий код.</span><span class="sxs-lookup"><span data-stu-id="83f63-180">Therefore, [Direct2D](./direct2d-portal.md) provides layered APIs that enable an application to start simply and grow more sophisticated without having to back-track or abandon their working code.</span></span> <span data-ttu-id="83f63-181">Упрощенное представление показано на следующей схеме:</span><span class="sxs-lookup"><span data-stu-id="83f63-181">A simplified view is shown in the following diagram:</span></span>

![Схема приложения DirectWrite и Direct2D.](images/direct2d-directwrite2.png)

### <a name="drawtext"></a><span data-ttu-id="83f63-183">DrawText</span><span class="sxs-lookup"><span data-stu-id="83f63-183">DrawText</span></span>

<span data-ttu-id="83f63-184">[**DrawText**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)) — это самый простой из интерфейсов API для использования.</span><span class="sxs-lookup"><span data-stu-id="83f63-184">[**DrawText**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)) is the simplest of the APIs to use.</span></span> <span data-ttu-id="83f63-185">Он принимает строку в Юникоде, кисть переднего плана, один объект форматирования и прямоугольник назначения.</span><span class="sxs-lookup"><span data-stu-id="83f63-185">It takes a Unicode string, a foreground brush, a single format object and a destination rectangle.</span></span> <span data-ttu-id="83f63-186">Она будет размещать и визуализировать всю строку в пределах прямоугольника макета и при необходимости обрезать ее.</span><span class="sxs-lookup"><span data-stu-id="83f63-186">It will lay out and render the whole string within the layout rectangle, and optionally clip it.</span></span> <span data-ttu-id="83f63-187">Это полезно при помещении простого фрагмента текста в элемент пользовательского интерфейса с фиксированной разметкой.</span><span class="sxs-lookup"><span data-stu-id="83f63-187">This is useful when you put a simple piece of text in a piece of fixed-layout UI.</span></span>

### <a name="drawtextlayout"></a><span data-ttu-id="83f63-188">дравтекстлайаут</span><span class="sxs-lookup"><span data-stu-id="83f63-188">DrawTextLayout</span></span>

<span data-ttu-id="83f63-189">Создавая объект [**идвритетекстлайаут**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextlayout) , приложение может начать измерять и расположить текст и другие элементы пользовательского интерфейса, а также поддерживает несколько шрифтов, стилей, подчеркивания и зачеркивание.</span><span class="sxs-lookup"><span data-stu-id="83f63-189">By creating an [**IDWriteTextLayout**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextlayout) object, an application can start measuring and arranging the text and other UI elements, and support multiple fonts, styles, underlines and strikethroughs.</span></span> <span data-ttu-id="83f63-190">[Direct2D](./direct2d-portal.md) предоставляет API [**дравтекстлайаут**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) , который непосредственно принимает этот объект и визуализирует текст в заданной точке.</span><span class="sxs-lookup"><span data-stu-id="83f63-190">[Direct2D](./direct2d-portal.md) provides the [**DrawTextLayout**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) API that directly accepts this object and renders the text at a given point.</span></span> <span data-ttu-id="83f63-191">(Ширина и высота предоставляются объектом макета).</span><span class="sxs-lookup"><span data-stu-id="83f63-191">(The width and height are provided by the layout object).</span></span> <span data-ttu-id="83f63-192">Помимо реализации всех ожидаемых функций макета текста, Direct2D будет интерпретировать любой объект Effect как кисть и применить эту кисть к выбранному диапазону глифов.</span><span class="sxs-lookup"><span data-stu-id="83f63-192">In addition to implementing all the expected text layout features, Direct2D will interpret any effect object as a brush and apply that brush to the selected range of glyphs.</span></span> <span data-ttu-id="83f63-193">Он также будет вызывать любые встроенные объекты.</span><span class="sxs-lookup"><span data-stu-id="83f63-193">It will also call any inline objects.</span></span> <span data-ttu-id="83f63-194">Приложение может затем вставлять в текст символы, не являющиеся глифами (значками).</span><span class="sxs-lookup"><span data-stu-id="83f63-194">An application can then insert non-glyph characters (icons) into the text if it wishes.</span></span> <span data-ttu-id="83f63-195">Еще одним преимуществом использования объекта макета текста является то, что позиции глифа кэшируются в нем.</span><span class="sxs-lookup"><span data-stu-id="83f63-195">Another advantage of using a text layout object is that the glyph positions are cached in it.</span></span> <span data-ttu-id="83f63-196">Таким образом, большой выигрыш в производительности можно сделать, повторно используя один и тот же объект макета для нескольких вызовов Draw и избегая повторного вычисления позиций глифа для каждого вызова.</span><span class="sxs-lookup"><span data-stu-id="83f63-196">Therefore, a large performance gain is possible by reusing the same layout object for multiple draw calls and avoiding recalculating the glyph positions for each call.</span></span> <span data-ttu-id="83f63-197">Эта возможность отсутствует для [**DRAWTEXT**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode))GDI.</span><span class="sxs-lookup"><span data-stu-id="83f63-197">This capability is not present for GDI's [**DrawText**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)).</span></span>

### <a name="drawglyphrun"></a><span data-ttu-id="83f63-198">DrawGlyphRun</span><span class="sxs-lookup"><span data-stu-id="83f63-198">DrawGlyphRun</span></span>

<span data-ttu-id="83f63-199">Наконец, приложение может реализовать интерфейс [**идвритетекстрендерер**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer) и вызвать [**DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) и [**ФИЛЛРЕКТАНГЛЕ**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillrectangle(constd2d1_rect_f_id2d1brush)) , или любой другой API отрисовки.</span><span class="sxs-lookup"><span data-stu-id="83f63-199">Finally, the application can implement the [**IDWriteTextRenderer**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextrenderer) interface itself and call [**DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) and [**FillRectangle**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillrectangle(constd2d1_rect_f_id2d1brush)) itself, or any other rendering API.</span></span> <span data-ttu-id="83f63-200">Все существующее взаимодействие с объектом макета текста останется неизменным.</span><span class="sxs-lookup"><span data-stu-id="83f63-200">All the existing interaction with the Text Layout object will remain unchanged.</span></span>

<span data-ttu-id="83f63-201">Пример реализации пользовательского модуля подготовки отчетов см. в разделе Подготовка к просмотру [с помощью пользовательского текстового модуля подготовки](/windows/desktop/DirectWrite/how-to-implement-a-custom-text-renderer) отчетов.</span><span class="sxs-lookup"><span data-stu-id="83f63-201">For an example of how to implement a custom text renderer see the [Render Using a Custom Text Renderer](/windows/desktop/DirectWrite/how-to-implement-a-custom-text-renderer) topic.</span></span>

## <a name="glyph-rendering"></a><span data-ttu-id="83f63-202">Рендеринг глифов</span><span class="sxs-lookup"><span data-stu-id="83f63-202">Glyph Rendering</span></span>

<span data-ttu-id="83f63-203">Добавление [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) в СУЩЕСТВУЮЩЕЕ приложение GDI позволяет приложению использовать API [**идвритебитмапрендертаржет**](/windows/desktop/api/dwrite/nn-dwrite-idwritebitmaprendertarget) для отрисовки глифов.</span><span class="sxs-lookup"><span data-stu-id="83f63-203">Adding [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) to an existing GDI application enables the application to use the [**IDWriteBitmapRenderTarget**](/windows/desktop/api/dwrite/nn-dwrite-idwritebitmaprendertarget) API to render glyphs.</span></span> <span data-ttu-id="83f63-204">Метод [**идвритебитмапрендертаржет::D равглифрун**](/windows/desktop/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun) , предоставляемый DirectWrite, будет отображаться в виде сплошного цвета на контроллере памяти, не требуя дополнительных API, таких как [Direct2D](./direct2d-portal.md).</span><span class="sxs-lookup"><span data-stu-id="83f63-204">The [**IDWriteBitmapRenderTarget::DrawGlyphRun**](/windows/desktop/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun) method that DirectWrite provides will render in solid color to a memory DC without requiring any additional APIs, such as [Direct2D](./direct2d-portal.md).</span></span>

<span data-ttu-id="83f63-205">Это позволяет приложению получать расширенные функции отрисовки текста, например следующие:</span><span class="sxs-lookup"><span data-stu-id="83f63-205">This enables the application to obtain advanced text rendering features such as the following:</span></span>

-   <span data-ttu-id="83f63-206">Технология ClearType в подпикселах позволяет приложению размещать глифы на позициях в пикселах, чтобы обеспечить визуализацию и макет глифов.</span><span class="sxs-lookup"><span data-stu-id="83f63-206">Sub-pixel ClearType enables an application to put glyphs on sub-pixel positions to allow for both sharp glyph rendering and glyph layout.</span></span>
-   <span data-ttu-id="83f63-207">Сглаживание по оси Y обеспечивает более гладкую визуализацию кривых на более крупных глифах.</span><span class="sxs-lookup"><span data-stu-id="83f63-207">Y-direction antialiasing enables smoother rendering of curves on larger glyphs.</span></span>

<span data-ttu-id="83f63-208">Приложение, перемещающееся в [Direct2D](./direct2d-portal.md) , также будет получать следующие возможности:</span><span class="sxs-lookup"><span data-stu-id="83f63-208">An application moving to [Direct2D](./direct2d-portal.md) will also obtain the following features:</span></span>

-   <span data-ttu-id="83f63-209">Аппаратное ускорение.</span><span class="sxs-lookup"><span data-stu-id="83f63-209">Hardware acceleration.</span></span>
-   <span data-ttu-id="83f63-210">Возможность заполнения текста произвольной кистью [Direct2D](./direct2d-portal.md) , например радиальными градиентами, линейными градиентами и точечными рисунками.</span><span class="sxs-lookup"><span data-stu-id="83f63-210">The ability to fill text with an arbitrary [Direct2D](./direct2d-portal.md) brush, such as radial gradients, linear gradients, and bitmaps.</span></span>
-   <span data-ttu-id="83f63-211">Поддержка уровней и обрезки с помощью API-интерфейсов [**пушаксисалигнедклип**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-pushaxisalignedclip(constd2d1_rect_f__d2d1_antialias_mode)), [**пушлайер**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-pushlayer(constd2d1_layer_parameters__id2d1layer)) и [**креатекомпатиблерендертаржет**](/windows/desktop/api/d2d1/nf-d2d1-id2d1rendertarget-createcompatiblerendertarget(id2d1bitmaprendertarget)) .</span><span class="sxs-lookup"><span data-stu-id="83f63-211">More support for layering and clipping through the [**PushAxisAlignedClip**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-pushaxisalignedclip(constd2d1_rect_f__d2d1_antialias_mode)), [**PushLayer**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-pushlayer(constd2d1_layer_parameters__id2d1layer)) and [**CreateCompatibleRenderTarget**](/windows/desktop/api/d2d1/nf-d2d1-id2d1rendertarget-createcompatiblerendertarget(id2d1bitmaprendertarget)) APIs.</span></span>
-   <span data-ttu-id="83f63-212">Возможность поддержки отрисовки текста в градациях серого.</span><span class="sxs-lookup"><span data-stu-id="83f63-212">The ability to support Grayscale text rendering.</span></span> <span data-ttu-id="83f63-213">Он правильно заполняет альфа-канал назначения в соответствии с непрозрачностью кисти текста и сглаживанием текста.</span><span class="sxs-lookup"><span data-stu-id="83f63-213">This correctly populates the destination alpha channel according to both the text brush opacity and the antialiasing of the text.</span></span>

<span data-ttu-id="83f63-214">Для эффективной поддержки аппаратного ускорения [Direct2D](./direct2d-portal.md) использует слегка отличающееся приближение к гамме-коррекции, именуемое *корректировкой альфа-канала*.</span><span class="sxs-lookup"><span data-stu-id="83f63-214">To efficiently support hardware acceleration, [Direct2D](./direct2d-portal.md) uses a slightly different approximation to Gamma correction called *alpha correction*.</span></span> <span data-ttu-id="83f63-215">Это не требует от Direct2D проверки цветового пикселя целевого объекта прорисовки при отрисовке текста.</span><span class="sxs-lookup"><span data-stu-id="83f63-215">This does not require Direct2D to inspect the render target color pixel when rendering text.</span></span>

## <a name="conclusion"></a><span data-ttu-id="83f63-216">Заключение</span><span class="sxs-lookup"><span data-stu-id="83f63-216">Conclusion</span></span>

<span data-ttu-id="83f63-217">В этом разделе объясняются различия и сходства между [Direct2D](./direct2d-portal.md) и [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) и архитектурным мотивацией для предоставления их в виде отдельных интерфейсов API для совместной разработки.</span><span class="sxs-lookup"><span data-stu-id="83f63-217">This topic explains the differences and similarities between [Direct2D](./direct2d-portal.md) and [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) and the architectural motivations for providing them as separate, cooperative APIs.</span></span>

 

 