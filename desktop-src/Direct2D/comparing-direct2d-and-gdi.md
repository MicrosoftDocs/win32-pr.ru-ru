---
title: Сравнение аппаратного ускорения Direct2D и GDI
description: Direct2D и GDI являются API-интерфейсами двухмерной отрисовки в режиме интерпретации и имеют некоторую степень аппаратного ускорения.
ms.assetid: 0028a0c3-445d-46b7-b55b-46dff3bce9ae
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: daa5fcb0f186915570d220a2807f816eae7a20fb393fbcd3113f6abf686fcd44
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117826556"
---
# <a name="comparing-direct2d-and-gdi-hardware-acceleration"></a>Сравнение аппаратного ускорения Direct2D и GDI

[Direct2D](./direct2d-portal.md) и [GDI](/windows/desktop/gdi/windows-gdi) являются API-интерфейсами двухмерной отрисовки в режиме интерпретации и имеют некоторую степень аппаратного ускорения. В этом разделе рассматриваются различия между Direct2D и GDI, включая предыдущие и представляющие различия в функциях аппаратного ускорения обоих API.

Этот раздел содержит следующие компоненты.

-   [Различия между Direct2D и GDI](#differences-between-direct2d-and-gdi)
-   [Аппаратное ускорение GDI и Direct2D](#gdi-and-direct2d-hardware-acceleration)
    -   [Повышение сложности и размера драйверов экрана](#increasing-complexity-and-size-of-display-drivers)
    -   [Трудности при синхронизации сеанса и глобальных адресных пространств ядра](#difficulty-in-synchronizing-session-and-global-kernel-address-spaces)
    -   [Управление составным окном](#composited-window-management)
-   [визуализация GDI в Windows 7](#gdi-rendering-in-windows-7)
-   [сравните Direct2D и ускорение GDI в Windows 7](#contrasting-direct2d-and-gdi-acceleration-in-windows-7)
    -   [Расположение ресурсов](#location-of-resources)
    -   [Метод подготовки к просмотру](#rendering-method)
    -   [Масштабируемость](#scalability)
    -   [Расположение](#location-of-resources)
    -   [Доступность аппаратного ускорения](#availability-of-hardware-acceleration)
    -   [Модель представления](#presentation-model)
-   [Заключение](#conclusion)

## <a name="differences-between-direct2d-and-gdi"></a>Различия между Direct2D и GDI

[GDI](/windows/desktop/gdi/windows-gdi) отображает непрозрачные геометрические объекты, такие как многоугольники, эллипсы и линии. Он отображает текст с псевдонимами и ClearType, а также поддерживает прозрачное смешение через API Алфабленд. Однако его обработка прозрачности не согласуется, и большинство интерфейсов API GDI просто игнорируют альфа-канал. Несколько интерфейсов API GDI гарантируют, что альфа-канал будет содержать после операции. Что более важно, отрисовка GDI не позволяет легко сопоставляться с трехмерными операциями, а современный GPU эффективно визуализируется в трехмерной части его подсистемы визуализации. Например, строки с псевдонимами [Direct2D](./direct2d-portal.md)предназначены для реализации просто как два треугольника, отображаемых на GPU, в то время как GDI использует алгоритм рисования линий бресенхам.

[Direct2D](./direct2d-portal.md) отображает непрозрачные, прозрачные, псевдонимы и сглаженные примитивы. Современные интерфейсы пользователя часто используют прозрачность и анимацию. Direct2D упрощает создание современного пользовательского интерфейса, поскольку он имеет ограниченную гарантию того, как он принимает и визуализирует прозрачное содержимое, а все его примитивы подготавливаются к просмотру с помощью аппаратного ускорения. Direct2D не является чистым надмножеством [GDI](/windows/desktop/gdi/windows-gdi): примитивы, которые были бы неоправданными при реализации в GPU, отсутствуют в Direct2D. Так как Direct2D построен с помощью этого акцента на трехмерном ускорении, его также легко использовать с Direct3D.

начиная с Windows NT 4, [GDI](/windows/desktop/gdi/windows-gdi) работает в режиме ядра. Приложение вызывает GDI, который затем вызывает аналог режима ядра, который передает примитивы в собственную модель драйвера. Затем этот драйвер отправляет результаты в глобальный драйвер монитора режима ядра.

начиная с Windows 2000, [gdi](/windows/desktop/gdi/windows-gdi) и драйверы gdi были запущены в независимом пространстве ядра, именуемом "пространство сеанса". Адресное пространство сеанса создается для каждого сеанса входа в систему, и каждый экземпляр GDI выполняется независимо в этом отдельном адресном пространстве режима ядра. Однако Direct2D работает в пользовательском режиме и передает команды рисования с помощью драйвера Direct3D пользовательского режима в драйвер режима ядра.

![рис. 1. Direct2D по сравнению с GDI](images/direct2d-vs-gdi1.png)

## <a name="gdi-and-direct2d-hardware-acceleration"></a>Аппаратное ускорение GDI и Direct2D

Самое важное различие между [Direct2D](./direct2d-portal.md) и аппаратным ускорением [GDI](/windows/desktop/gdi/windows-gdi) — это базовая технология, которая их выполняет. Direct2D находится на вершине Direct3D, а GDI имеет собственную модель драйвера, интерфейс драйвера устройства GDI (DDI), соответствующий примитивам GDI. Модель драйвера Direct3D соответствует тому, что отображает оборудование для отрисовки трехмерной графики в GPU. Когда DDI GDI был впервые определен, большинство устройств ускорения экрана нацелены на примитивы GDI. Со временем в ускорении трехмерной игры было включено больше и больше, чем при ускорении приложения. Как следствие, API BitBlt был аппаратным ускорением, а большинство других операций GDI — нет.

Это позволяет настроить этап для последовательности изменений в способе отображения [GDI](/windows/desktop/gdi/windows-gdi) на экране. на следующем рисунке показано, как визуализация отображения GDI изменилась с Windows XP на Windows 7.

![рис. 2. развитие отрисовки отображения GDI](images/direct2d-vs-gdi2.png)

Существует также ряд дополнительных факторов, которые привели к изменению модели драйвера [GDI](/windows/desktop/gdi/windows-gdi) , как описано ниже.

### <a name="increasing-complexity-and-size-of-display-drivers"></a>Повышение сложности и размера драйверов экрана

с течением времени трехмерные драйверы стали более сложными. Более сложный код имеет больше дефектов, что дает возможность использовать драйвер в пользовательском режиме, где ошибка драйвера не может привести к перезагрузке системы. Как видно на рисунке выше, драйвер экрана делится на компонент сложного пользовательского режима и на более простой компонент режима ядра.

### <a name="difficulty-in-synchronizing-session-and-global-kernel-address-spaces"></a>Трудности при синхронизации сеанса и глобальных адресных пространств ядра

в Windows XP драйвер экрана существует в двух разных адресных пространствах: пространстве сеанса и пространстве ядра. Компоненты драйвера должны реагировать на события, такие как события управления питанием. Это необходимо синхронизировать с состоянием драйвера в адресном пространстве сеанса. Это сложная задача, которая может привести к дефектам, когда драйверы экрана пытаются работать с этими отдельными адресными пространствами.

### <a name="composited-window-management"></a>Управление составным окном

диспетчер окон рабочего стола (DWM), диспетчер окон компоновки, появившийся в Windows 7, отображает все окна в виде экранов, а затем объединяет их вместе, чтобы они отображались на экране. Для этого необходимо, чтобы [GDI](/windows/desktop/gdi/windows-gdi) мог подготовиться к просмотру на поверхности, которая затем будет отображена Direct3D для отображения. Это потребовало проблемы в модели драйвера XP, поскольку GDI и Direct3D были стеками драйверов параллельного выполнения.

в результате в Windows Vista драйвер отображения DDI для [gdi](/windows/desktop/gdi/windows-gdi) был реализован в качестве стандартного видеодрайвера (cdc), который выводит содержимое GDI в битовую карту системной памяти, которая состоялась на экране.

## <a name="gdi-rendering-in-windows-7"></a>визуализация GDI в Windows 7

модель драйвера, используемая в Windows Vista, требует, чтобы каждое окно [GDI](/windows/desktop/gdi/windows-gdi) было использовано как поверхность видеопамяти, так и область системной памяти. Это привело к тому, что системная память использовалась для каждого окна GDI.

по этой причине [GDI](/windows/desktop/gdi/windows-gdi) снова был изменен в Windows 7. . Вместо подготовки к просмотру на поверхности системной памяти GDI был изменен для отрисовки в сегмент памяти апертуры. Память апертуры можно обновить с поверхности видеопамяти, содержащей содержимое окна. GDI может вернуться в память апертуры, и результат можно будет отправить обратно в область окна. Поскольку сегмент памяти апертуры можно устранить с помощью GPU, GPU может ускорить эти обновления на поверхности видеопамяти. Например, в таких случаях ускорение отрисовки текста, Битблтс, Алфабленд, Транспарентблт и Стретчблт.

## <a name="contrasting-direct2d-and-gdi-acceleration-in-windows-7"></a>сравните Direct2D и ускорение GDI в Windows 7

[Direct2D](./direct2d-portal.md) и [GDI](/windows/desktop/gdi/windows-gdi) являются как плоскими API-интерфейсами рендеринга в режиме ожидания, так и аппаратным ускорением. Однако существует ряд различий, которые остаются в обоих API.

### <a name="location-of-resources"></a>Расположение ресурсов

По умолчанию [GDI](/windows/desktop/gdi/windows-gdi) сохраняет свои ресурсы в определенных точечных рисунках в системной памяти. [Direct2D](./direct2d-portal.md) сохраняет свои ресурсы в видеопамяти видеоадаптера. Когда GDI требуется обновить видеопамять, это необходимо сделать на шине, если ресурс уже не находится в сегменте памяти апертуры или если операция может быть выражена напрямую. В отличие от этого, Direct2D может просто перевести свои примитивы в примитивы Direct3D, так как ресурсы уже находятся в видеопамяти.

### <a name="rendering-method"></a>Метод подготовки к просмотру

Для обеспечения совместимости [GDI](/windows/desktop/gdi/windows-gdi) выполняет большую часть его отрисовки для апертуры памяти с помощью ЦП. В отличие от этого, [Direct2D](./direct2d-portal.md) преобразует вызовы API в примитивы Direct3D и операции рисования. Затем результат отображается на GPU. Некоторые из модулей отрисовки GDI. s выполняются на GPU при копировании памяти апертуры на поверхность видеопамяти, представляющая окно GDI.

### <a name="scalability"></a>Масштабируемость

Вызовы отрисовки [Direct2D](./direct2d-portal.md)— это все независимые потоки команд для GPU. Каждая фабрика Direct2D представляет собой другое устройство Direct3D. [GDI](/windows/desktop/gdi/windows-gdi) использует один командный поток для всех приложений в системе. Метод GDI может привести к накруткиию ресурсов GPU и контекста рендеринга ЦП.

### <a name="location"></a>Расположение

[Direct2D](./direct2d-portal.md) работает полностью в пользовательском режиме, включая время выполнения Direct3D и драйвер пользовательского режима Direct3D. Это помогает предотвратить системные сбои, вызванные дефектами кода в ядре. Однако [GDI](/windows/desktop/gdi/windows-gdi)имеет большую часть функциональных возможностей в пространстве сеанса в режиме ядра и его поверхность API в пользовательском режиме.

### <a name="availability-of-hardware-acceleration"></a>Доступность аппаратного ускорения

[GDI](/windows/desktop/gdi/windows-gdi) — это аппаратное ускорение в Windows XP и ускоренное на Windows 7 при запуске диспетчер окон рабочего стола и использовании драйвера WDDM 1,1. [Direct2D](./direct2d-portal.md) является аппаратным ускорением практически любого драйвера WDDM и независимо от того, используется ли DWM. В Vista GDI всегда отображается в ЦП.

### <a name="presentation-model"></a>Модель представления

при первоначальном построении Windows недостаточно памяти, чтобы все окна сохранялись в своем собственном растровом изображении. В результате [GDI](/windows/desktop/gdi/windows-gdi) всегда отображается логически непосредственно на экране, при этом применяются различные области отсечения, чтобы убедиться, что приложение не было отображено за пределами окна. В модели [Direct2D](./direct2d-portal.md) приложение подготавливается к просмотру в буфере, а результат отображается при прорисовке приложения. Это позволяет Direct2D выполнять сценарии анимации гораздо более плавно, чем GDI.

## <a name="conclusion"></a>Заключение

существующий код [GDI](/windows/desktop/gdi/windows-gdi) продолжит работать в Windows 7. Однако при написании нового кода отрисовки графики следует учитывать [Direct2D](./direct2d-portal.md) , поскольку он использует преимущества современных графических процессоров.

 

 