---
title: Повышение производительности приложений Direct2D
description: Описывает методы повышения производительности Direct2D.
ms.assetid: e6b02925-4e75-42b0-b0c4-00f1ddb85e46
keywords:
- Direct2D, производительность
- Direct2D, точечные рисунки
- Direct2D, использование ресурсов
- Direct2D, метод Flush
- Direct2D, статическое содержимое
- производительность Direct2D
- точечные рисунки для Direct2D
- Direct2D, взаимодействие GDI
- Direct2D, взаимодействие
- взаимодействие, Direct2D
- Интерфейс графических устройств (GDI)
- GDI (интерфейс графических устройств)
- взаимодействие, интерфейс графических устройств (GDI)
ms.topic: article
ms.date: 05/31/2018
ms.custom: seodec18
ms.openlocfilehash: 5a413b96e00514b64b3cf1b1ee451a84a9e9ff09
ms.sourcegitcommit: 6eb53540b8d882fd035d428567d7d1c5ec17042c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/12/2020
ms.locfileid: "104488478"
---
# <a name="improving-the-performance-of-direct2d-apps"></a><span data-ttu-id="5b977-116">Повышение производительности приложений Direct2D</span><span class="sxs-lookup"><span data-stu-id="5b977-116">Improving the performance of Direct2D apps</span></span>

<span data-ttu-id="5b977-117">Хотя [Direct2D](./direct2d-portal.md) является аппаратным ускорением и предназначен для обеспечения высокой производительности, для повышения пропускной способности необходимо правильно использовать функции.</span><span class="sxs-lookup"><span data-stu-id="5b977-117">Although [Direct2D](./direct2d-portal.md) is hardware accelerated and is meant for high performance, you must use the features correctly to maximize throughput.</span></span> <span data-ttu-id="5b977-118">Методы, которые мы здесь демонстрируем, являются производными от описанных выше способов изучения распространенных сценариев и могут не применяться ко всем сценариям приложений.</span><span class="sxs-lookup"><span data-stu-id="5b977-118">The techniques we show here are derived from studying common scenarios and might not apply to all app scenarios.</span></span> <span data-ttu-id="5b977-119">Поэтому внимательное понимание поведения приложения и целей производительности может помочь добиться желаемых результатов.</span><span class="sxs-lookup"><span data-stu-id="5b977-119">Therefore, careful understanding of app behavior and performance goals can help achieve the results that you want.</span></span>

-   [<span data-ttu-id="5b977-120">Использование ресурсов</span><span class="sxs-lookup"><span data-stu-id="5b977-120">Resource usage</span></span>](#resource-usage)
    -   [<span data-ttu-id="5b977-121">Повторное использование ресурсов</span><span class="sxs-lookup"><span data-stu-id="5b977-121">Reuse resources</span></span>](#reuse-resources)
-   [<span data-ttu-id="5b977-122">Ограничение использования записи на диск</span><span class="sxs-lookup"><span data-stu-id="5b977-122">Restrict the use of flush</span></span>](#restrict-the-use-of-flush)
-   [<span data-ttu-id="5b977-123">Растровые изображения</span><span class="sxs-lookup"><span data-stu-id="5b977-123">Bitmaps</span></span>](#create-large-bitmaps)
    -   [<span data-ttu-id="5b977-124">Создание крупных точечных рисунков</span><span class="sxs-lookup"><span data-stu-id="5b977-124">Create large bitmaps</span></span>](#create-large-bitmaps)
    -   [<span data-ttu-id="5b977-125">Создание Atlas с точечными рисунками</span><span class="sxs-lookup"><span data-stu-id="5b977-125">Create an atlas of bitmaps</span></span>](#create-an-atlas-of-bitmaps)
    -   [<span data-ttu-id="5b977-126">Создание общих точечных рисунков</span><span class="sxs-lookup"><span data-stu-id="5b977-126">Create shared bitmaps</span></span>](#create-shared-bitmaps)
    -   [<span data-ttu-id="5b977-127">Копирование растровых изображений</span><span class="sxs-lookup"><span data-stu-id="5b977-127">Copying bitmaps</span></span>](#copying-bitmaps)
-   [<span data-ttu-id="5b977-128">Использовать мозаичное растровое изображение над тире</span><span class="sxs-lookup"><span data-stu-id="5b977-128">Use tiled bitmap over dashing</span></span>](#use-tiled-bitmap-over-dashing)
-   [<span data-ttu-id="5b977-129">Общие рекомендации по визуализации сложного статического содержимого</span><span class="sxs-lookup"><span data-stu-id="5b977-129">General guidelines for rendering complex static content</span></span>](#general-guidelines-for-rendering-complex-static-content)
    -   [<span data-ttu-id="5b977-130">Полное кэширование сцены с использованием цветового растрового изображения</span><span class="sxs-lookup"><span data-stu-id="5b977-130">Full scene caching using a color bitmap</span></span>](#full-scene-caching-using-a-color-bitmap)
    -   [<span data-ttu-id="5b977-131">На примитивное кэширование с использованием точечного рисунка A8 и метода ФиллопаЦитимаск</span><span class="sxs-lookup"><span data-stu-id="5b977-131">Per primitive caching using an A8 bitmap and the FillOpacityMask method</span></span>](#per-primitive-caching-using-an-a8-bitmap-and-the-fillopacitymask-method)
-   [<span data-ttu-id="5b977-132">Кэширование на примитивы с использованием реализаций геометрии</span><span class="sxs-lookup"><span data-stu-id="5b977-132">Per-primitive caching using geometry realizations</span></span>](#per-primitive-caching-using-geometry-realizations)
-   [<span data-ttu-id="5b977-133">Отрисовка геометрии</span><span class="sxs-lookup"><span data-stu-id="5b977-133">Geometry rendering</span></span>](#geometry-rendering)
    -   [<span data-ttu-id="5b977-134">Использовать конкретный примитив рисования для рисования геометрии</span><span class="sxs-lookup"><span data-stu-id="5b977-134">Use specific draw primitive over draw geometry</span></span>](#use-specific-draw-primitive-over-draw-geometry)
    -   [<span data-ttu-id="5b977-135">Отображение статической геометрии</span><span class="sxs-lookup"><span data-stu-id="5b977-135">Rendering static geometry</span></span>](#rendering-static-geometry)
    -   [<span data-ttu-id="5b977-136">Использовать многопоточный контекст устройства</span><span class="sxs-lookup"><span data-stu-id="5b977-136">Use a multithreaded device context</span></span>](#use-a-multithreaded-device-context)
-   [<span data-ttu-id="5b977-137">Рисование текста с помощью Direct2D</span><span class="sxs-lookup"><span data-stu-id="5b977-137">Drawing text with Direct2D</span></span>](#use-a-multithreaded-device-context)
    -   [<span data-ttu-id="5b977-138">Дравтекстлайаут и DrawText</span><span class="sxs-lookup"><span data-stu-id="5b977-138">DrawTextLayout Vs. DrawText</span></span>](#drawtextlayout-vs-drawtext)
    -   [<span data-ttu-id="5b977-139">Выбор режима отображения текста справа</span><span class="sxs-lookup"><span data-stu-id="5b977-139">Choosing the right text rendering mode</span></span>](#choosing-the-right-text-rendering-mode)
    -   [<span data-ttu-id="5b977-140">Кэширование</span><span class="sxs-lookup"><span data-stu-id="5b977-140">Caching</span></span>](#full-scene-caching-using-a-color-bitmap)
-   [<span data-ttu-id="5b977-141">Обрезка произвольной фигуры</span><span class="sxs-lookup"><span data-stu-id="5b977-141">Clipping an arbitrary shape</span></span>](#clipping-an-arbitrary-shape)
    -   [<span data-ttu-id="5b977-142">Пушлайер в Windows 8</span><span class="sxs-lookup"><span data-stu-id="5b977-142">PushLayer in Windows 8</span></span>](#pushlayer-in-windows-8)
    -   [<span data-ttu-id="5b977-143">Обрезанные по осям клипы</span><span class="sxs-lookup"><span data-stu-id="5b977-143">Axis-aligned clips</span></span>](#axis-aligned-clips)
-   [<span data-ttu-id="5b977-144">Взаимодействие с DXGI: предотвращение частого переключения</span><span class="sxs-lookup"><span data-stu-id="5b977-144">DXGI interoperability: avoid frequent switches</span></span>](#dxgi-interoperability-avoid-frequent-switches)
-   [<span data-ttu-id="5b977-145">Знакомство с форматом пикселей</span><span class="sxs-lookup"><span data-stu-id="5b977-145">Know Your Pixel Format</span></span>](#know-your-pixel-format)
-   [<span data-ttu-id="5b977-146">Сложность сцены</span><span class="sxs-lookup"><span data-stu-id="5b977-146">Scene Complexity</span></span>](#scene-complexity)
    -   [<span data-ttu-id="5b977-147">Общие сведения о сложности сцены</span><span class="sxs-lookup"><span data-stu-id="5b977-147">Understand Scene Complexity</span></span>](#understand-scene-complexity)
-   [<span data-ttu-id="5b977-148">Повышение производительности для приложений печати Direct2D</span><span class="sxs-lookup"><span data-stu-id="5b977-148">Improving performance for Direct2D printing apps</span></span>](#improving-performance-for-direct2d-printing-apps)
    -   [<span data-ttu-id="5b977-149">Задание значений свойств справа при создании элемента управления печатью D2D</span><span class="sxs-lookup"><span data-stu-id="5b977-149">Set the right property values when you create the D2D print control</span></span>](#set-the-right-property-values-when-you-create-the-d2d-print-control)
    -   [<span data-ttu-id="5b977-150">Избегайте использования определенных шаблонов рисования Direct2D</span><span class="sxs-lookup"><span data-stu-id="5b977-150">Avoid using certain Direct2D drawing patterns</span></span>](#avoid-using-certain-direct2d-drawing-patterns)
    -   [<span data-ttu-id="5b977-151">Рисование текста прямым и обычным способом</span><span class="sxs-lookup"><span data-stu-id="5b977-151">Draw text in a direct and plain way</span></span>](#draw-text-in-a-direct-and-plain-way)
    -   [<span data-ttu-id="5b977-152">По возможности нарисовать исходные точечные рисунки</span><span class="sxs-lookup"><span data-stu-id="5b977-152">Draw the original bitmaps when possible</span></span>](#draw-the-original-bitmaps-when-possible)
-   [<span data-ttu-id="5b977-153">Заключение</span><span class="sxs-lookup"><span data-stu-id="5b977-153">Conclusion</span></span>](#conclusion)

## <a name="resource-usage"></a><span data-ttu-id="5b977-154">Использование ресурсов</span><span class="sxs-lookup"><span data-stu-id="5b977-154">Resource usage</span></span>

<span data-ttu-id="5b977-155">Ресурс — это выделение какого-либо типа в памяти видеоадаптера или системы.</span><span class="sxs-lookup"><span data-stu-id="5b977-155">A resource is an allocation of some kind, either in video or system memory.</span></span> <span data-ttu-id="5b977-156">Примерами ресурсов являются точечные рисунки и кисти.</span><span class="sxs-lookup"><span data-stu-id="5b977-156">Bitmaps and brushes are examples of resources.</span></span>

<span data-ttu-id="5b977-157">В Direct2D ресурсы можно создавать в программном и аппаратном обеспечении.</span><span class="sxs-lookup"><span data-stu-id="5b977-157">In Direct2D, resources can be created both in software and hardware.</span></span> <span data-ttu-id="5b977-158">Создание и удаление ресурсов на оборудовании являются дорогостоящими операциями, так как они требуют большого объема издержек при взаимодействии с видеоадаптером.</span><span class="sxs-lookup"><span data-stu-id="5b977-158">Resource creation and deletion on hardware are expensive operations because they require lots of overhead for communicating with the video card.</span></span> <span data-ttu-id="5b977-159">Давайте посмотрим, как Direct2D визуализирует содержимое в целевом объекте.</span><span class="sxs-lookup"><span data-stu-id="5b977-159">Let's see how Direct2D renders content to a target.</span></span>

<span data-ttu-id="5b977-160">В Direct2D все команды отрисовки заключаются между вызовом [**бегиндрав**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-begindraw) и вызовом [**EndDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-enddraw).</span><span class="sxs-lookup"><span data-stu-id="5b977-160">In Direct2D, all the rendering commands are enclosed between a call to [**BeginDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-begindraw) and a call to [**EndDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-enddraw).</span></span> <span data-ttu-id="5b977-161">Эти вызовы выполняются для целевого объекта отрисовки.</span><span class="sxs-lookup"><span data-stu-id="5b977-161">These calls are made to a render target.</span></span> <span data-ttu-id="5b977-162">Перед вызовом операций отрисовки необходимо вызвать метод **бегиндрав** .</span><span class="sxs-lookup"><span data-stu-id="5b977-162">You must call the **BeginDraw** method before you call rendering operations .</span></span> <span data-ttu-id="5b977-163">После вызова **бегиндрав** контекст обычно создает пакет команд отрисовки, но откладывает обработку этих команд до тех пор, пока не будет выполнено одно из следующих условий:</span><span class="sxs-lookup"><span data-stu-id="5b977-163">After you call **BeginDraw** , a context typically builds up a batch of rendering commands, but delays processing of these commands until one of these statements is true:</span></span>

-   <span data-ttu-id="5b977-164">Произошла [**EndDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-enddraw) .</span><span class="sxs-lookup"><span data-stu-id="5b977-164">[**EndDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-enddraw) occurred.</span></span> <span data-ttu-id="5b977-165">При вызове **EndDraw** вызывает завершение всех пакетных операций рисования и возвращает состояние операции.</span><span class="sxs-lookup"><span data-stu-id="5b977-165">When **EndDraw** is called, it causes any batched drawing operations to complete and returns the status of the operation.</span></span>
-   <span data-ttu-id="5b977-166">Вы выполняете явный вызов функции [**flush**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-flush): метод **flush** вызывает обработку пакета и выполнение всех ожидающих команд.</span><span class="sxs-lookup"><span data-stu-id="5b977-166">You make an explicit call to [**Flush**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-flush): The **Flush** method causes the batch to be processed and all pending commands to be issued.</span></span>
-   <span data-ttu-id="5b977-167">Буфер, содержащий команды подготовки к просмотру, заполнен.</span><span class="sxs-lookup"><span data-stu-id="5b977-167">The buffer holding the rendering commands is full.</span></span> <span data-ttu-id="5b977-168">Если этот буфер заполняется до выполнения предыдущих двух условий, команды подготовки к просмотру очищаются.</span><span class="sxs-lookup"><span data-stu-id="5b977-168">If this buffer becomes full before the previous two conditions are fulfilled, the rendering commands are flushed out.</span></span>

<span data-ttu-id="5b977-169">До тех пор пока примитивы не будут сброшены, Direct2D сохраняет внутренние ссылки на соответствующие ресурсы, такие как точечные рисунки и кисти.</span><span class="sxs-lookup"><span data-stu-id="5b977-169">Until the primitives are flushed, Direct2D keeps internal references to corresponding resources like bitmaps and brushes.</span></span>

### <a name="reuse-resources"></a><span data-ttu-id="5b977-170">Повторное использование ресурсов</span><span class="sxs-lookup"><span data-stu-id="5b977-170">Reuse resources</span></span>

<span data-ttu-id="5b977-171">Как уже упоминалось, создание и удаление ресурсов требуют больших затрат на оборудование.</span><span class="sxs-lookup"><span data-stu-id="5b977-171">As already mentioned, resource creation and deletion is expensive on hardware.</span></span> <span data-ttu-id="5b977-172">Поэтому используйте ресурсы по возможности.</span><span class="sxs-lookup"><span data-stu-id="5b977-172">So reuse resources when possible.</span></span> <span data-ttu-id="5b977-173">Возьмем пример создания растрового изображения при разработке игр.</span><span class="sxs-lookup"><span data-stu-id="5b977-173">Take the example of bitmap creation in game development.</span></span> <span data-ttu-id="5b977-174">Как правило, точечные рисунки, составляющие сцену в игре, создаются одновременно с различными вариациями, необходимыми для последующей отрисовки кадров в кадрах.</span><span class="sxs-lookup"><span data-stu-id="5b977-174">Usually, bitmaps that make up a scene in a game are all created at the same time with all the different variations that are required for later frame-to-frame rendering.</span></span> <span data-ttu-id="5b977-175">Во время отрисовки и повторной отрисовки этих растровых изображений повторно используются вместо повторного создания.</span><span class="sxs-lookup"><span data-stu-id="5b977-175">At the time of actual scene rendering and re-rendering, these bitmaps are reused instead of re-created.</span></span>

> [!Note]  
> <span data-ttu-id="5b977-176">Нельзя повторно использовать ресурсы для операции изменения размера окна.</span><span class="sxs-lookup"><span data-stu-id="5b977-176">You can't reuse resources for the window resize operation.</span></span> <span data-ttu-id="5b977-177">При изменении размера окна некоторые ресурсы, зависящие от масштабирования, такие как совместимые целевые объекты рендеринга и, возможно, некоторые ресурсы слоя должны быть созданы повторно, так как содержимое окна должно перерисовываться.</span><span class="sxs-lookup"><span data-stu-id="5b977-177">When a window is resized, some scale-dependent resources such as compatible render targets and possibly some layer resources must be re-created because the window content has to be redrawn.</span></span> <span data-ttu-id="5b977-178">Это может быть важно для поддержания общего качества отображаемой сцены.</span><span class="sxs-lookup"><span data-stu-id="5b977-178">This can be important for maintaining the overall quality of the rendered scene.</span></span>

 

## <a name="restrict-the-use-of-flush"></a><span data-ttu-id="5b977-179">Ограничение использования записи на диск</span><span class="sxs-lookup"><span data-stu-id="5b977-179">Restrict the use of flush</span></span>

<span data-ttu-id="5b977-180">Поскольку метод [**flush**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-flush) вызывает обработку пакетных команд рендеринга, рекомендуется не использовать его.</span><span class="sxs-lookup"><span data-stu-id="5b977-180">Because the [**Flush**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-flush) method causes the batched rendering commands to be processed, we recommend that you don't use it.</span></span> <span data-ttu-id="5b977-181">В большинстве распространенных сценариев оставьте управление ресурсами Direct2D.</span><span class="sxs-lookup"><span data-stu-id="5b977-181">For most common scenarios, leave resource management to Direct2D.</span></span>

## <a name="bitmaps"></a><span data-ttu-id="5b977-182">Растровые изображения</span><span class="sxs-lookup"><span data-stu-id="5b977-182">Bitmaps</span></span>

<span data-ttu-id="5b977-183">Как упоминалось ранее, создание и удаление ресурсов являются очень ресурсоемкими операциями оборудования.</span><span class="sxs-lookup"><span data-stu-id="5b977-183">As mentioned earlier, resource creation and deletion are very expensive operations in hardware.</span></span> <span data-ttu-id="5b977-184">Точечный рисунок — это тип ресурса, который часто используется.</span><span class="sxs-lookup"><span data-stu-id="5b977-184">A bitmap is a kind of resource that is used often.</span></span> <span data-ttu-id="5b977-185">Создание точечных рисунков на видеоадаптере занимает много ресурсов.</span><span class="sxs-lookup"><span data-stu-id="5b977-185">Creating bitmaps on the video card is expensive.</span></span> <span data-ttu-id="5b977-186">Их повторное использование поможет ускорить работу приложения.</span><span class="sxs-lookup"><span data-stu-id="5b977-186">Reusing them can help make the application faster.</span></span>

### <a name="create-large-bitmaps"></a><span data-ttu-id="5b977-187">Создание крупных точечных рисунков</span><span class="sxs-lookup"><span data-stu-id="5b977-187">Create large bitmaps</span></span>

<span data-ttu-id="5b977-188">Видеоадаптеры обычно имеют минимальный размер выделения памяти.</span><span class="sxs-lookup"><span data-stu-id="5b977-188">Video cards typically have a minimum memory allocation size.</span></span> <span data-ttu-id="5b977-189">Если запрошенное выделение меньше этого значения, выделяется ресурс этого минимального размера, а избыточная память теряется и недоступна для других целей.</span><span class="sxs-lookup"><span data-stu-id="5b977-189">If an allocation is requested that is smaller than this, a resource of this minimum size is allocated and the surplus memory is wasted and unavailable for other things.</span></span> <span data-ttu-id="5b977-190">Если требуется много небольших точечных рисунков, лучше всего выделить один большой точечный рисунок и сохранить все небольшое содержимое растрового изображения в этом большом точечном рисунке.</span><span class="sxs-lookup"><span data-stu-id="5b977-190">If you need many small bitmaps, a better technique is to allocate one large bitmap and store all the small bitmap contents in this large bitmap.</span></span> <span data-ttu-id="5b977-191">Затем дочерние области более крупного растрового изображения можно считать, где требуются небольшие точечные рисунки.</span><span class="sxs-lookup"><span data-stu-id="5b977-191">Then subareas of the larger bitmap can be read where the smaller bitmaps are needed.</span></span> <span data-ttu-id="5b977-192">Часто следует включать заполнение (прозрачные черные пиксели) между мелкими точечными рисунками во избежание взаимодействия между мелкими изображениями во время операций.</span><span class="sxs-lookup"><span data-stu-id="5b977-192">Often, you should include padding (transparent black pixels) in between the small bitmaps to avoid any interaction between the smaller images during operations.</span></span> <span data-ttu-id="5b977-193">Это также называется *Atlas* и имеет преимущество снижения затрат на создание растровых изображений и нерасходование памяти при небольших выделениях битовых рисунков.</span><span class="sxs-lookup"><span data-stu-id="5b977-193">This is also known as an *atlas*, and it has the benefit of reducing bitmap creation overhead and the memory waste of small bitmap allocations.</span></span> <span data-ttu-id="5b977-194">Рекомендуется размещать большинство битовых карт размером не менее 64 КБ и ограничивать число битов, размер которых меньше 4 КБ.</span><span class="sxs-lookup"><span data-stu-id="5b977-194">We recommend that you keep most bitmaps to at least 64 KB and limit the number of bitmaps that are smaller than 4 KB.</span></span>

### <a name="create-an-atlas-of-bitmaps"></a><span data-ttu-id="5b977-195">Создание Atlas с точечными рисунками</span><span class="sxs-lookup"><span data-stu-id="5b977-195">Create an atlas of bitmaps</span></span>

<span data-ttu-id="5b977-196">Существуют некоторые распространенные ситуации, в которых точечные рисунки Atlas могут работать очень хорошо.</span><span class="sxs-lookup"><span data-stu-id="5b977-196">There are some common scenarios for which a bitmap atlas can serve very well.</span></span> <span data-ttu-id="5b977-197">Небольшие растровые изображения можно хранить внутри большого точечного рисунка.</span><span class="sxs-lookup"><span data-stu-id="5b977-197">Small bitmaps can be stored inside a large bitmap.</span></span> <span data-ttu-id="5b977-198">Эти небольшие точечные рисунки можно извлечь из большего размера, если они нужны, указав прямоугольник назначения.</span><span class="sxs-lookup"><span data-stu-id="5b977-198">These small bitmaps can be pulled out of the larger bitmap when you need them by specifying the destination rectangle.</span></span> <span data-ttu-id="5b977-199">Например, приложение должно нарисовать несколько значков.</span><span class="sxs-lookup"><span data-stu-id="5b977-199">For example, an application has to draw multiple icons.</span></span> <span data-ttu-id="5b977-200">Все точечные рисунки, связанные со значками, можно загрузить в большой точечный рисунок.</span><span class="sxs-lookup"><span data-stu-id="5b977-200">All the bitmaps associated with the icons can be loaded into a large bitmap up front.</span></span> <span data-ttu-id="5b977-201">И во время отрисовки их можно получить из большого точечного рисунка.</span><span class="sxs-lookup"><span data-stu-id="5b977-201">And at rendering time, they can be retrieved from the large bitmap.</span></span>

> [!Note]  
> <span data-ttu-id="5b977-202">Точечный рисунок Direct2D, созданный в видеопамяти, ограничен максимальным размером точечного рисунка, поддерживаемым адаптером, на котором он хранится.</span><span class="sxs-lookup"><span data-stu-id="5b977-202">A Direct2D bitmap created in video memory is limited to the maximum bitmap size supported by the adapter on which it is stored.</span></span> <span data-ttu-id="5b977-203">Создание точечного рисунка, размер которого превышает это, может привести к ошибке.</span><span class="sxs-lookup"><span data-stu-id="5b977-203">Creating a bitmap larger than that might result in an error.</span></span>

 

> [!Note]  
> <span data-ttu-id="5b977-204">Начиная с Windows 8, Direct2D включает в себя [эффекты Atlas](atlas.md) , которые могут упростить этот процесс.</span><span class="sxs-lookup"><span data-stu-id="5b977-204">Starting in Windows 8, Direct2D includes an [Atlas effect](atlas.md) that can make this process easier.</span></span>

 

### <a name="create-shared-bitmaps"></a><span data-ttu-id="5b977-205">Создание общих точечных рисунков</span><span class="sxs-lookup"><span data-stu-id="5b977-205">Create shared bitmaps</span></span>

<span data-ttu-id="5b977-206">Создание общих точечных рисунков позволяет расширенным вызывающим объектам создавать объекты Bitmap Direct2D, которые поддерживаются непосредственно существующим объектом, уже совместимым с целью рендеринга.</span><span class="sxs-lookup"><span data-stu-id="5b977-206">Creating shared bitmaps enables advanced callers to create Direct2D bitmap objects that are backed directly by an existing object, already compatible with the render target.</span></span> <span data-ttu-id="5b977-207">Это позволяет избежать создания нескольких поверхностей и помогает снизить нагрузку на производительность.</span><span class="sxs-lookup"><span data-stu-id="5b977-207">This avoids creating multiple surfaces and helps in reducing performance overhead.</span></span>

> [!Note]  
> <span data-ttu-id="5b977-208">Общие точечные рисунки обычно ограничены программными целями или целевыми объектами, взаимодействующими с DXGI.</span><span class="sxs-lookup"><span data-stu-id="5b977-208">Shared bitmaps are usually limited to software targets or to targets interoperable with DXGI.</span></span> <span data-ttu-id="5b977-209">Используйте методы [**креатебитмапфромдксгисурфаце**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-createbitmapfromdxgisurface(idxgisurface_constd2d1_bitmap_properties1_id2d1bitmap1)), [**креатебитмапфромвикбитмап**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-createbitmapfromwicbitmap(iwicbitmapsource_constd2d1_bitmap_properties1_id2d1bitmap1))и [**креатешаредбитмап**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-createsharedbitmap) для создания общих точечных рисунков.</span><span class="sxs-lookup"><span data-stu-id="5b977-209">Use the [**CreateBitmapFromDxgiSurface**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-createbitmapfromdxgisurface(idxgisurface_constd2d1_bitmap_properties1_id2d1bitmap1)), [**CreateBitmapFromWicBitmap**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-createbitmapfromwicbitmap(iwicbitmapsource_constd2d1_bitmap_properties1_id2d1bitmap1)), and [**CreateSharedBitmap**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-createsharedbitmap) methods to create shared bitmaps.</span></span>

 

### <a name="copying-bitmaps"></a><span data-ttu-id="5b977-210">Копирование растровых изображений</span><span class="sxs-lookup"><span data-stu-id="5b977-210">Copying bitmaps</span></span>

<span data-ttu-id="5b977-211">Создание поверхности DXGI является дорогостоящей операцией, поэтому вы можете повторно использовать существующие поверхности.</span><span class="sxs-lookup"><span data-stu-id="5b977-211">Creating a DXGI surface is an expensive operation so reuse existing surfaces when you can.</span></span> <span data-ttu-id="5b977-212">Даже в программном обеспечении, если точечный рисунок преимущественно используется в форме, за исключением небольшой части, лучше обновить эту часть, чем создавать весь точечный рисунок и заново создать все.</span><span class="sxs-lookup"><span data-stu-id="5b977-212">Even in software, if a bitmap is mostly in the form you want except for a small portion, it is better to update that portion than to throw the whole bitmap away and re-create everything.</span></span> <span data-ttu-id="5b977-213">Несмотря на то, что можно использовать [**креатекомпатиблерендертаржет**](/windows/desktop/api/d2d1/nf-d2d1-id2d1rendertarget-createcompatiblerendertarget(id2d1bitmaprendertarget)) для достижения одинаковых результатов, отрисовка обычно является гораздо более дорогостоящей операцией, чем копирование.</span><span class="sxs-lookup"><span data-stu-id="5b977-213">Although you can use [**CreateCompatibleRenderTarget**](/windows/desktop/api/d2d1/nf-d2d1-id2d1rendertarget-createcompatiblerendertarget(id2d1bitmaprendertarget)) to achieve the same results, rendering is generally a much more expensive operation than copying.</span></span> <span data-ttu-id="5b977-214">Это связано с тем, что для улучшения локализации кэша оборудование фактически не сохраняет точечный рисунок в том же порядке памяти, что и точечный рисунок.</span><span class="sxs-lookup"><span data-stu-id="5b977-214">This is because, to improve cache locality, the hardware doesn't actually store a bitmap in the same memory order that the bitmap is addressed.</span></span> <span data-ttu-id="5b977-215">Вместо этого точечный рисунок может быть свиззлед.</span><span class="sxs-lookup"><span data-stu-id="5b977-215">Instead, the bitmap might be swizzled.</span></span> <span data-ttu-id="5b977-216">Группирующие скрывается от ЦП либо драйвером (который работает достаточно долго и используется только в более низких частях), либо диспетчером памяти на GPU.</span><span class="sxs-lookup"><span data-stu-id="5b977-216">The swizzling is hidden from the CPU either by the driver (which is slow and used only on lower-end parts), or by the memory manager on the GPU.</span></span> <span data-ttu-id="5b977-217">Из-за ограничений на то, как данные записываются в целевой объект отрисовки при подготовке к просмотру, целевые объекты рендеринга обычно либо не свиззлед, либо свиззлед способом, который менее оптимальен, чем может быть достигнут, если известно, что вам никогда не нужно отрисовываться на поверхности.</span><span class="sxs-lookup"><span data-stu-id="5b977-217">Because of constraints on how data is written into a render target when rendering, render targets are typically either not swizzled, or swizzled in a way that is less optimal than can be achieved if you know that you never have to render to the surface.</span></span> <span data-ttu-id="5b977-218">Поэтому [](/windows/desktop/api/d2d1/nn-d2d1-id2d1bitmap) \* для копирования прямоугольников из источника в точечный рисунок Direct2D предоставляются методы CopyFrom.</span><span class="sxs-lookup"><span data-stu-id="5b977-218">Therefore, the [CopyFrom](/windows/desktop/api/d2d1/nn-d2d1-id2d1bitmap)\* methods are provided for copying rectangles from a source to the Direct2D bitmap.</span></span>

<span data-ttu-id="5b977-219">CopyFrom можно использовать в любой из трех форм:</span><span class="sxs-lookup"><span data-stu-id="5b977-219">CopyFrom can be used in any of its three forms:</span></span>

-   [<span data-ttu-id="5b977-220">**копифромбитмап**</span><span class="sxs-lookup"><span data-stu-id="5b977-220">**CopyFromBitmap**</span></span>](/windows/win32/api/d2d1/nf-d2d1-id2d1bitmap-copyfrombitmap)
-   [<span data-ttu-id="5b977-221">**копифромрендертаржет**</span><span class="sxs-lookup"><span data-stu-id="5b977-221">**CopyFromRenderTarget**</span></span>](/windows/win32/api/d2d1/nf-d2d1-id2d1bitmap-copyfromrendertarget)
-   [<span data-ttu-id="5b977-222">**копифроммемори**</span><span class="sxs-lookup"><span data-stu-id="5b977-222">**CopyFromMemory**</span></span>](/windows/win32/api/d2d1/nf-d2d1-id2d1bitmap-copyfrommemory)

## <a name="use-tiled-bitmap-over-dashing"></a><span data-ttu-id="5b977-223">Использовать мозаичное растровое изображение над тире</span><span class="sxs-lookup"><span data-stu-id="5b977-223">Use tiled bitmap over dashing</span></span>

<span data-ttu-id="5b977-224">Отрисовка штриховой линии является очень дорогостоящей операцией из-за высокого качества и точности базового алгоритма.</span><span class="sxs-lookup"><span data-stu-id="5b977-224">Rendering a dashed line is a very expensive operation because of the high quality and accuracy of the underlying algorithm.</span></span> <span data-ttu-id="5b977-225">Для большинства вариантов, не включающих геометрические объекты rectilinear, один и тот же результат может быть создан быстрее с помощью мозаичных растровых изображений.</span><span class="sxs-lookup"><span data-stu-id="5b977-225">For most of the cases not involving rectilinear geometries, the same effect can be generated faster by using tiled bitmaps.</span></span>

## <a name="general-guidelines-for-rendering-complex-static-content"></a><span data-ttu-id="5b977-226">Общие рекомендации по визуализации сложного статического содержимого</span><span class="sxs-lookup"><span data-stu-id="5b977-226">General guidelines for rendering complex static content</span></span>

<span data-ttu-id="5b977-227">Кэширование содержимого при отрисовке одного фрейма содержимого поверх рамки, особенно в случае сложной сцены.</span><span class="sxs-lookup"><span data-stu-id="5b977-227">Cache content if you render the same content frame over frame, especially when the scene is complex.</span></span>

<span data-ttu-id="5b977-228">Существует три метода кэширования, которые можно использовать.</span><span class="sxs-lookup"><span data-stu-id="5b977-228">There are three caching techniques that you can use:</span></span>

-   <span data-ttu-id="5b977-229">Полное кэширование сцены с использованием цветового растрового изображения.</span><span class="sxs-lookup"><span data-stu-id="5b977-229">Full scene caching using a color bitmap.</span></span>
-   <span data-ttu-id="5b977-230">На примитивное кэширование с использованием точечного рисунка A8 и метода [**филлопаЦитимаск**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-fillopacitymask(id2d1bitmap_id2d1brush_constd2d1_rect_f_constd2d1_rect_f)) .</span><span class="sxs-lookup"><span data-stu-id="5b977-230">Per primitive caching using an A8 bitmap and the [**FillOpacityMask**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-fillopacitymask(id2d1bitmap_id2d1brush_constd2d1_rect_f_constd2d1_rect_f)) method.</span></span>
-   <span data-ttu-id="5b977-231">Кэширование на примитивы с использованием реализаций геометрии.</span><span class="sxs-lookup"><span data-stu-id="5b977-231">Per-primitive caching using geometry realizations.</span></span>

<span data-ttu-id="5b977-232">Давайте рассмотрим каждый из них более подробно.</span><span class="sxs-lookup"><span data-stu-id="5b977-232">Let's look at each of these in more detail.</span></span>

### <a name="full-scene-caching-using-a-color-bitmap"></a><span data-ttu-id="5b977-233">Полное кэширование сцены с использованием цветового растрового изображения</span><span class="sxs-lookup"><span data-stu-id="5b977-233">Full scene caching using a color bitmap</span></span>

<span data-ttu-id="5b977-234">При отрисовке статического содержимого в таких сценариях, как анимация, создайте еще одно цветное битовое изображение вместо записи непосредственно на экран.</span><span class="sxs-lookup"><span data-stu-id="5b977-234">When you render static content, in scenarios like animation, create another full color bitmap instead of writing directly to the screen bitmap.</span></span> <span data-ttu-id="5b977-235">Сохраните текущий целевой объект, задайте для параметра target значение промежуточное растровое изображение и выводите статическое содержимое.</span><span class="sxs-lookup"><span data-stu-id="5b977-235">Save the current target, set target to the intermediate bitmap, and render the static content.</span></span> <span data-ttu-id="5b977-236">Затем переключитесь обратно на исходное растровое изображение и нарисуйте на нем промежуточное изображение.</span><span class="sxs-lookup"><span data-stu-id="5b977-236">Then, switch back to the original screen bitmap and draw the intermediate bitmap on it.</span></span>

<span data-ttu-id="5b977-237">Приведем пример:</span><span class="sxs-lookup"><span data-stu-id="5b977-237">Here's an example:</span></span>


```C++
// Create a bitmap.
m_d2dContext->CreateBitmap(size, nullptr, 0,
    D2D1::BitmapProperties(
        D2D1_BITMAP_OPTIONS_TARGET,
        D2D1::PixelFormat(
            DXGI_FORMAT_B8G8R8A8_UNORM,
            D2D1_ALPHA_MODE_PREMULTIPLIED),
        dpiX, dpiY),
    &sceneBitmap);

// Preserve the pre-existing target.
ComPtr<ID2D1Image> oldTarget;
m_d2dContext->GetTarget(&oldTarget);

// Render static content to the sceneBitmap.
m_d2dContext->SetTarget(sceneBitmap.Get());
m_d2dContext->BeginDraw();
…
m_d2dContext->EndDraw();

// Render sceneBitmap to oldTarget.
m_d2dContext->SetTarget(oldTarget.Get());
m_d2dContext->DrawBitmap(sceneBitmap.Get());
```



<span data-ttu-id="5b977-238">В этом примере используются промежуточные точечные рисунки для кэширования и переключения точечного рисунка, на который указывает контекст устройства при его подготовке.</span><span class="sxs-lookup"><span data-stu-id="5b977-238">This example uses intermediate bitmaps for caching and switches the bitmap that the device context points to when it renders.</span></span> <span data-ttu-id="5b977-239">Это позволяет избежать необходимости создавать совместимый целевой объект рендеринга для той же цели.</span><span class="sxs-lookup"><span data-stu-id="5b977-239">This avoids the need to create a compatible render target for the same purpose.</span></span>

### <a name="per-primitive-caching-using-an-a8-bitmap-and-the-fillopacitymask-method"></a><span data-ttu-id="5b977-240">На примитивное кэширование с использованием точечного рисунка A8 и метода ФиллопаЦитимаск</span><span class="sxs-lookup"><span data-stu-id="5b977-240">Per primitive caching using an A8 bitmap and the FillOpacityMask method</span></span>

<span data-ttu-id="5b977-241">Если полная сцена не является статической, но состоит из элементов, таких как геометрия или текст, которые являются статическими, можно использовать метод для каждого примитивного кэширования.</span><span class="sxs-lookup"><span data-stu-id="5b977-241">When the full scene is not static, but consists of elements like geometry or text that are static, you can use a per primitive caching technique.</span></span> <span data-ttu-id="5b977-242">Этот метод сохраняет характеристики сглаживания для примитива, который кэшируется, и работает с изменением типов кистей.</span><span class="sxs-lookup"><span data-stu-id="5b977-242">This technique preserves the antialiasing characteristics of the primitive being cached and works with changing brush types.</span></span> <span data-ttu-id="5b977-243">Он использует точечный рисунок A8, где A8 — это разновидность формата пикселей, представляющая альфа-канал с 8 битами.</span><span class="sxs-lookup"><span data-stu-id="5b977-243">It uses an A8 bitmap where A8 is a kind of pixel format which represents an alpha channel with 8 bits.</span></span> <span data-ttu-id="5b977-244">Точечные рисунки A8 полезны для рисования геометрии или текста в виде маски.</span><span class="sxs-lookup"><span data-stu-id="5b977-244">A8 bitmaps are useful for drawing geometry/text as a mask.</span></span> <span data-ttu-id="5b977-245">Если необходимо управлять прозрачностью статического содержимого, вместо управления самим содержимым можно преобразовать, повернуть, наклон или масштабировать прозрачность маски.</span><span class="sxs-lookup"><span data-stu-id="5b977-245">When you must manipulate the opacity of static content , instead of manipulating the content itself, you can translate, rotate, skew, or scale the opacity of the mask.</span></span>

<span data-ttu-id="5b977-246">Приведем пример:</span><span class="sxs-lookup"><span data-stu-id="5b977-246">Here's an example:</span></span>


```C++
// Create an opacity bitmap.
m_d2dContext->CreateBitmap(size, nullptr, 0,
    D2D1::BitmapProperties(
        D2D1_BITMAP_OPTIONS_TARGET,
        D2D1::PixelFormat(
            DXGI_FORMAT_A8_UNORM,
            D2D1_ALPHA_MODE_PREMULTIPLIED),
        dpiX, dpiY),
    &opacityBitmap);

// Preserve the pre-existing target.
ComPtr<ID2D1Image> oldTarget;
m_d2dContext->GetTarget(&oldTarget);

// Render to the opacityBitmap.
m_d2dContext->SetTarget(opacityBitmap.Get());
m_d2dContext->BeginDraw();
…
m_d2dContext->EndDraw();

// Call the FillOpacityMask method
// Note: for this call to work correctly the anti alias mode must be D2D1_ANTIALIAS_MODE_ALIASED. 
m_d2dContext->SetTarget(oldTarget.Get());
m_d2dContext->FillOpacityMask(
    opacityBitmap.Get(),
    m_contentBrush().Get(),
    D2D1_OPACITY_MASK_CONTENT_GRAPHICS);
```



## <a name="per-primitive-caching-using-geometry-realizations"></a><span data-ttu-id="5b977-247">Кэширование на примитивы с использованием реализаций геометрии</span><span class="sxs-lookup"><span data-stu-id="5b977-247">Per-primitive caching using geometry realizations</span></span>

<span data-ttu-id="5b977-248">Другой метод кэширования на основе примитивов, называемый реализациями геометрии, обеспечивает большую гибкость при работе с геометрическим объектом.</span><span class="sxs-lookup"><span data-stu-id="5b977-248">Another per-primitive caching technique, called geometry realizations, provides greater flexibility when dealing with geometry.</span></span> <span data-ttu-id="5b977-249">Если необходимо многократно вырисовывать геометрические фигуры с псевдонимами, можно быстрее преобразовать их в реализации геометрии и многократно нарисовать реализации, чем повторять Рисование самих геометрических объектов.</span><span class="sxs-lookup"><span data-stu-id="5b977-249">When you want to repeatedly draw aliased or anti-aliased geometries, it is faster to convert them to geometry realizations and repeatedly draw the realizations than it is to repeatedly draw the geometries themselves.</span></span> <span data-ttu-id="5b977-250">Реализации геометрии также обычно потребляют меньше памяти, чем маски непрозрачности (особенно для больших геометрических объектов), и они менее чувствительны к изменениям масштаба.</span><span class="sxs-lookup"><span data-stu-id="5b977-250">Geometry realizations also generally consume less memory than opacity masks (especially for large geometries), and they are less sensitive to changes in scale.</span></span> <span data-ttu-id="5b977-251">Дополнительные сведения см. в разделе [Общие сведения о реализации геометрических объектов](geometry-realizations-overview.md).</span><span class="sxs-lookup"><span data-stu-id="5b977-251">For more information, see [Geometry Realizations Overview](geometry-realizations-overview.md).</span></span>

<span data-ttu-id="5b977-252">Приведем пример:</span><span class="sxs-lookup"><span data-stu-id="5b977-252">Here's an example:</span></span>


```C++
    // Compute a flattening tolerance based on the scales at which the realization will be used.
    float flatteningTolerance = D2D1::ComputeFlatteningTolerance(...);

    ComPtr<ID2D1GeometryRealization> geometryRealization;

    // Create realization of the filled interior of the geometry.
    m_d2dDeviceContext1->CreateFilledGeometryRealization(
        geometry.Get(),
        flatteningTolerance,
        &geometryRealization
        );

    // In your app's rendering code, draw the geometry realization with a brush.
    m_d2dDeviceContext1->BeginDraw();
    m_d2dDeviceContext1->DrawGeometryRealization(
        geometryRealization.Get(),
        m_brush.Get()
        );
    m_d2dDeviceContext1->EndDraw();
```



## <a name="geometry-rendering"></a><span data-ttu-id="5b977-253">Отрисовка геометрии</span><span class="sxs-lookup"><span data-stu-id="5b977-253">Geometry rendering</span></span>

### <a name="use-specific-draw-primitive-over-draw-geometry"></a><span data-ttu-id="5b977-254">Использовать конкретный примитив рисования для рисования геометрии</span><span class="sxs-lookup"><span data-stu-id="5b977-254">Use specific draw primitive over draw geometry</span></span>

<span data-ttu-id="5b977-255">Используйте более конкретные *простые* вызовы рисования, такие как [**DrawRectangle**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawrectangle(constd2d1_rect_f__id2d1brush_float_id2d1strokestyle)) , через универсальные вызовы [**DrawGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawgeometry) .</span><span class="sxs-lookup"><span data-stu-id="5b977-255">Use more specific draw *primitive* calls like [**DrawRectangle**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawrectangle(constd2d1_rect_f__id2d1brush_float_id2d1strokestyle)) over generic [**DrawGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawgeometry) calls.</span></span> <span data-ttu-id="5b977-256">Это обусловлено тем, что в **DrawRectangle** геометрическая геометрия уже известна, поэтому отрисовка выполняется быстрее.</span><span class="sxs-lookup"><span data-stu-id="5b977-256">This is because with **DrawRectangle**, the geometry is already known so rendering is faster.</span></span>

### <a name="rendering-static-geometry"></a><span data-ttu-id="5b977-257">Отображение статической геометрии</span><span class="sxs-lookup"><span data-stu-id="5b977-257">Rendering static geometry</span></span>

<span data-ttu-id="5b977-258">В сценариях, где геометрия является статичной, используйте методы кэширования на основе примитивов, описанные выше.</span><span class="sxs-lookup"><span data-stu-id="5b977-258">In scenarios where the geometry is static, use the per-primitive caching techniques explained above.</span></span> <span data-ttu-id="5b977-259">Маски непрозрачности и реализации геометрических объектов могут значительно повысить скорость отрисовки сцен, содержащих статическую геометрию.</span><span class="sxs-lookup"><span data-stu-id="5b977-259">Opacity masks and geometry realizations can greatly improve the rendering speed of scenes that contain static geometry..</span></span>

### <a name="use-a-multithreaded-device-context"></a><span data-ttu-id="5b977-260">Использовать многопоточный контекст устройства</span><span class="sxs-lookup"><span data-stu-id="5b977-260">Use a multithreaded device context</span></span>

<span data-ttu-id="5b977-261">Приложения, для которых требуется отрисовка значительных объемов сложного геометрического содержимого, следует рассмотреть указание параметра [**\_ контекста устройства D2D1 \_ \_ \_ включить \_ \_ многопотоковую \_ оптимизацию**](/windows/desktop/api/D2d1_1/ne-d2d1_1-d2d1_device_context_options) при создании контекста устройства [Direct2D](./direct2d-portal.md) .</span><span class="sxs-lookup"><span data-stu-id="5b977-261">Applications that expect to render significant amounts of complex geometric content should consider specifying the [**D2D1\_DEVICE\_CONTEXT\_OPTIONS\_ENABLE\_MULTI\_THREADED\_OPTIMIZATIONS**](/windows/desktop/api/D2d1_1/ne-d2d1_1-d2d1_device_context_options) flag when creating a [Direct2D](./direct2d-portal.md) device context.</span></span> <span data-ttu-id="5b977-262">Если этот флаг указан, Direct2D будет распределять отрисовку по всем логическим ядрам, присутствующим в системе, что может значительно снизить общее время отрисовки.</span><span class="sxs-lookup"><span data-stu-id="5b977-262">When this flag is specified, Direct2D will distribute rendering across all of the logical cores present on the system, which can significantly decrease overall rendering time.</span></span>

<span data-ttu-id="5b977-263">Примечания.</span><span class="sxs-lookup"><span data-stu-id="5b977-263">Notes:</span></span>

-   <span data-ttu-id="5b977-264">Начиная с Windows 8.1 этот флаг влияет только на отрисовку геометрических контуров.</span><span class="sxs-lookup"><span data-stu-id="5b977-264">As of Windows 8.1, this flag only affects path geometry rendering.</span></span> <span data-ttu-id="5b977-265">Он не влияет на сцены, содержащие только другие типы-примитивы (например, текст, точечные рисунки или реализации геометрических объектов).</span><span class="sxs-lookup"><span data-stu-id="5b977-265">It has no impact on scenes containing only other primitive types (such as text, bitmaps, or geometry realizations).</span></span>
-   <span data-ttu-id="5b977-266">Этот флаг также не влияет на отрисовку в программном обеспечении (т. е. при отрисовке с помощью ИСКРИВЛЕНного устройства Direct3D).</span><span class="sxs-lookup"><span data-stu-id="5b977-266">This flag also has no impact when rendering in software (i.e. when rendering with a WARP Direct3D device).</span></span> <span data-ttu-id="5b977-267">Чтобы управлять многопоточностью программного обеспечения, вызывающим объектам следует использовать флаг D3D11 Create Device reon \_ \_ \_ \_ internal \_ \_ reoptimization оптимизации при создании устройства, использующего технологию деформации Direct3D.</span><span class="sxs-lookup"><span data-stu-id="5b977-267">To control software multithreading, callers should use the D3D11\_CREATE\_DEVICE\_PREVENT\_INTERNAL\_THREADING\_OPTIMIZATIONS flag when creating the WARP Direct3D device.</span></span>
-   <span data-ttu-id="5b977-268">Задание этого флага может увеличить Пиковый рабочий набор во время подготовки к просмотру и также может увеличить состязание за потоки в приложениях, которые уже используют преимущества многопоточной обработки.</span><span class="sxs-lookup"><span data-stu-id="5b977-268">Specifying this flag can increase peak working set during rendering and can also increase thread contention in applications that already take advantage of multithreaded processing.</span></span>

## <a name="drawing-text-with-direct2d"></a><span data-ttu-id="5b977-269">Рисование текста с помощью Direct2D</span><span class="sxs-lookup"><span data-stu-id="5b977-269">Drawing text with Direct2D</span></span>

<span data-ttu-id="5b977-270">Функция отрисовки текста Direct2D предлагается в двух частях.</span><span class="sxs-lookup"><span data-stu-id="5b977-270">Direct2D text rendering functionality is offered in two parts.</span></span> <span data-ttu-id="5b977-271">Первая часть, представленная в виде метода [**ID2D1RenderTarget::D равтекст**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)) и [**ID2D1RenderTarget::D равтекстлайаут**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) , позволяет вызывающему объекту передать либо строковую, либо параметры форматирования, либо объект дврите Text Layout для нескольких форматов.</span><span class="sxs-lookup"><span data-stu-id="5b977-271">The first part, exposed as the [**ID2D1RenderTarget::DrawText**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)) and [**ID2D1RenderTarget::DrawTextLayout**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) method, enables a caller to pass either a string and formatting parameters or a DWrite text layout object for multiple formats.</span></span> <span data-ttu-id="5b977-272">Это должно быть уместно для большинства вызывающих объектов.</span><span class="sxs-lookup"><span data-stu-id="5b977-272">This should be suitable for most callers.</span></span> <span data-ttu-id="5b977-273">Второй способ визуализации текста, представленный в виде метода [**ID2D1RenderTarget::D равглифрун**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) , обеспечивает растрирование для клиентов, уже знающих расположение глифов, которые они хотят визуализировать.</span><span class="sxs-lookup"><span data-stu-id="5b977-273">The second way to render text, exposed as the [**ID2D1RenderTarget::DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) method, provides rasterization for customers who already know the position of the glyphs they want to render.</span></span> <span data-ttu-id="5b977-274">Следующие два общих правила могут помочь улучшить производительность текста при рисовании в Direct2D.</span><span class="sxs-lookup"><span data-stu-id="5b977-274">The following two general rules can help improve text performance when drawing in Direct2D.</span></span>

### <a name="drawtextlayout-vs-drawtext"></a><span data-ttu-id="5b977-275">Дравтекстлайаут и DrawText</span><span class="sxs-lookup"><span data-stu-id="5b977-275">DrawTextLayout Vs. DrawText</span></span>

<span data-ttu-id="5b977-276">Как [**DrawText**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)) , так и [**дравтекстлайаут**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) позволяют приложению легко отображать текст, отформатированный с помощью API [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) .</span><span class="sxs-lookup"><span data-stu-id="5b977-276">Both [**DrawText**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)) and [**DrawTextLayout**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) enable an application to easily render text that is formatted by the [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) API.</span></span> <span data-ttu-id="5b977-277">**Дравтекстлайаут** рисует существующий объект [**двритетекстлайаут**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextlayout) в [**рендертаржет**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget), а **DrawText** создает макет DirectWrite для вызывающего объекта на основе переданных параметров.</span><span class="sxs-lookup"><span data-stu-id="5b977-277">**DrawTextLayout** draws an existing [**DWriteTextLayout**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextlayout) object to the [**RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget), and **DrawText** constructs a DirectWrite layout for the caller, based on the parameters that are passed in.</span></span> <span data-ttu-id="5b977-278">Если один и тот же текст должен отображаться несколько раз, используйте **дравтекстлайаут** вместо **DrawText**, так как **DrawText** создает макет при каждом вызове.</span><span class="sxs-lookup"><span data-stu-id="5b977-278">If the same text has to be rendered multiple times, use **DrawTextLayout** instead of **DrawText**, because **DrawText** creates a layout every time that it is called.</span></span>

### <a name="choosing-the-right-text-rendering-mode"></a><span data-ttu-id="5b977-279">Выбор режима отображения текста справа</span><span class="sxs-lookup"><span data-stu-id="5b977-279">Choosing the right text rendering mode</span></span>

<span data-ttu-id="5b977-280">Установите в качестве режима сглаживания текста [**D2D1 в \_ \_ режиме сглаживания текста \_ \_ оттенки серого**](/windows/desktop/api/d2d1/ne-d2d1-d2d1_text_antialias_mode) .</span><span class="sxs-lookup"><span data-stu-id="5b977-280">Set the text antialias mode to [**D2D1\_TEXT\_ANTIALIAS\_MODE\_GRAYSCALE**](/windows/desktop/api/d2d1/ne-d2d1-d2d1_text_antialias_mode) explicitly.</span></span> <span data-ttu-id="5b977-281">Качество визуализации текста в градациях серого сравнимо с ClearType, но выполняется гораздо быстрее.</span><span class="sxs-lookup"><span data-stu-id="5b977-281">The quality of rendering grayscale text is comparable to ClearType but is much faster.</span></span>

### <a name="caching"></a><span data-ttu-id="5b977-282">Caching</span><span class="sxs-lookup"><span data-stu-id="5b977-282">Caching</span></span>

<span data-ttu-id="5b977-283">Используйте полную сцену или для каждого примитивного кэширования растрового изображения, как при рисовании других примитивов.</span><span class="sxs-lookup"><span data-stu-id="5b977-283">Use full scene or per primitive bitmap caching like with drawing other primitives.</span></span>

## <a name="clipping-an-arbitrary-shape"></a><span data-ttu-id="5b977-284">Обрезка произвольной фигуры</span><span class="sxs-lookup"><span data-stu-id="5b977-284">Clipping an arbitrary shape</span></span>

<span data-ttu-id="5b977-285">На рисунке ниже показан результат применения клипа к изображению.</span><span class="sxs-lookup"><span data-stu-id="5b977-285">The figure here shows the result of applying a clip to an image.</span></span>

![изображение, в котором показан пример изображения до и после клипа.](images/clip.png)

<span data-ttu-id="5b977-287">Этот результат можно получить с помощью слоев с геометрической маской или методом [**филлжеометри**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillgeometry) с кистью непрозрачности.</span><span class="sxs-lookup"><span data-stu-id="5b977-287">You can get this result by using layers with a geometry mask or the [**FillGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillgeometry) method with an opacity brush.</span></span>

<span data-ttu-id="5b977-288">Ниже приведен пример использования слоя.</span><span class="sxs-lookup"><span data-stu-id="5b977-288">Here's an example that uses a layer:</span></span>


```C++
// Call PushLayer() and pass in the clipping geometry.
m_d2dContext->PushLayer(
    D2D1::LayerParameters(
        boundsRect,
        geometricMask));
```



<span data-ttu-id="5b977-289">Ниже приведен пример использования метода [**филлжеометри**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillgeometry) :</span><span class="sxs-lookup"><span data-stu-id="5b977-289">Here's an example that uses the [**FillGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillgeometry) method:</span></span>


```C++
// Create an opacity bitmap and render content.
m_d2dContext->CreateBitmap(size, nullptr, 0,
    D2D1::BitmapProperties(
        D2D1_BITMAP_OPTIONS_TARGET,
        D2D1::PixelFormat(
            DXGI_FORMAT_A8_UNORM,
            D2D1_ALPHA_MODE_PREMULTIPLIED),
        dpiX, dpiY),
    &opacityBitmap);

m_d2dContext->SetTarget(opacityBitmap.Get());
m_d2dContext->BeginDraw();
…
m_d2dContext->EndDraw();

// Create an opacity brush from the opacity bitmap.
m_d2dContext->CreateBitmapBrush(opacityBitmap.Get(),
    D2D1::BitmapBrushProperties(),
    D2D1::BrushProperties(),
    &bitmapBrush);

// Call the FillGeometry method and pass in the clip geometry and the opacity brush
m_d2dContext->FillGeometry( 
    clipGeometry.Get(),
    brush.Get(),
    opacityBrush.Get()); 
```



<span data-ttu-id="5b977-290">В этом примере кода при вызове метода Пушлайер вы не передаетесь на слой, созданный приложением.</span><span class="sxs-lookup"><span data-stu-id="5b977-290">In this code example, when you call the PushLayer method, you don't pass in an app created layer.</span></span> <span data-ttu-id="5b977-291">Direct2D создает слой для вас.</span><span class="sxs-lookup"><span data-stu-id="5b977-291">Direct2D creates a layer for you.</span></span> <span data-ttu-id="5b977-292">Direct2D может управлять выделением и уничтожением этого ресурса без участия в приложении.</span><span class="sxs-lookup"><span data-stu-id="5b977-292">Direct2D is able to manage the allocation and destruction of this resource without any involvement from the app.</span></span> <span data-ttu-id="5b977-293">Это позволяет Direct2D использовать слои внутренним образом и применять оптимизации управления ресурсами.</span><span class="sxs-lookup"><span data-stu-id="5b977-293">This allows Direct2D to reuse layers internally and apply resource management optimizations.</span></span>

<span data-ttu-id="5b977-294">В Windows 8 многие оптимизации были применены к использованию уровней, и мы рекомендуем использовать API слоя вместо [**филлжеометри**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillgeometry) , когда это возможно.</span><span class="sxs-lookup"><span data-stu-id="5b977-294">In Windows 8 many optimizations have been made to the usage of layers and we recommend you try using layer APIs instead of [**FillGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillgeometry) whenever possible.</span></span>

### <a name="pushlayer-in-windows-8"></a><span data-ttu-id="5b977-295">Пушлайер в Windows 8</span><span class="sxs-lookup"><span data-stu-id="5b977-295">PushLayer in Windows 8</span></span>

<span data-ttu-id="5b977-296">Интерфейс [**ID2D1DeviceContext**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1devicecontext) является производным от интерфейса [**ID2D1RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget) и является ключом к отображению содержимого Direct2D в Windows 8. Дополнительные сведения об этом интерфейсе см. в разделе [устройства и контексты устройств](devices-and-device-contexts.md).</span><span class="sxs-lookup"><span data-stu-id="5b977-296">The [**ID2D1DeviceContext**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1devicecontext) interface is derived from the [**ID2D1RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget) interface and is key to displaying Direct2D content in Windows 8, for more information about this interface see [Devices and Device Contexts](devices-and-device-contexts.md).</span></span> <span data-ttu-id="5b977-297">С помощью интерфейса контекста устройства можно пропустить вызов метода [**креателайер**](/windows/desktop/api/d2d1/nf-d2d1-id2d1rendertarget-createlayer(id2d1layer)) , а затем передать NULL методу [**ID2D1DeviceContext::P ушлайер**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-pushlayer(constd2d1_layer_parameters1_id2d1layer)) .</span><span class="sxs-lookup"><span data-stu-id="5b977-297">With the device context interface, you can skip calling the [**CreateLayer**](/windows/desktop/api/d2d1/nf-d2d1-id2d1rendertarget-createlayer(id2d1layer)) method and then pass NULL to the [**ID2D1DeviceContext::PushLayer**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-pushlayer(constd2d1_layer_parameters1_id2d1layer)) method.</span></span> <span data-ttu-id="5b977-298">Direct2D автоматически управляет ресурсом слоя и может совместно использовать ресурсы между слоями и графами эффектов.</span><span class="sxs-lookup"><span data-stu-id="5b977-298">Direct2D automatically manages the layer resource and can share resources between layers and effect graphs.</span></span>

### <a name="axis-aligned-clips"></a><span data-ttu-id="5b977-299">Обрезанные по осям клипы</span><span class="sxs-lookup"><span data-stu-id="5b977-299">Axis-aligned clips</span></span>

<span data-ttu-id="5b977-300">Если регион, который будет обрезан, вырезается по оси поверхности рисования, а не произвольно.</span><span class="sxs-lookup"><span data-stu-id="5b977-300">If the region to be clipped is aligned to the axis of the drawing surface, instead of arbitrary.</span></span> <span data-ttu-id="5b977-301">Этот вариант подходит для использования прямоугольника обрезки вместо слоя.</span><span class="sxs-lookup"><span data-stu-id="5b977-301">This case is suited for using a clip rectangle instead of a layer.</span></span> <span data-ttu-id="5b977-302">Повышение производительности — это больше для геометрических объектов, чем у сглаженных геометрических объектов.</span><span class="sxs-lookup"><span data-stu-id="5b977-302">The performance gain is more for aliased geometry than antialiased geometry.</span></span> <span data-ttu-id="5b977-303">Дополнительные сведения о выровняйте по оси клипов см. в разделе [**пушаксисалигнедклип**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-pushaxisalignedclip(constd2d1_rect_f__d2d1_antialias_mode)) .</span><span class="sxs-lookup"><span data-stu-id="5b977-303">For more info on axis aligned clips, see the [**PushAxisAlignedClip**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-pushaxisalignedclip(constd2d1_rect_f__d2d1_antialias_mode)) topic.</span></span>

## <a name="dxgi-interoperability-avoid-frequent-switches"></a><span data-ttu-id="5b977-304">Взаимодействие с DXGI: предотвращение частого переключения</span><span class="sxs-lookup"><span data-stu-id="5b977-304">DXGI interoperability: avoid frequent switches</span></span>

<span data-ttu-id="5b977-305">Direct2D может беспрепятственно взаимодействовать с областями Direct3D.</span><span class="sxs-lookup"><span data-stu-id="5b977-305">Direct2D can interoperate seamlessly with Direct3D surfaces.</span></span> <span data-ttu-id="5b977-306">Это очень полезно для создания приложений, которые отображают смесь 2D-и трехмерного содержимого.</span><span class="sxs-lookup"><span data-stu-id="5b977-306">This is very useful for creating applications that render a mixture of 2D and 3D content.</span></span> <span data-ttu-id="5b977-307">Но каждый переход между Drawing Direct2D и содержимым Direct3D влияет на производительность.</span><span class="sxs-lookup"><span data-stu-id="5b977-307">But each switch between drawing Direct2D and Direct3D content affects performance.</span></span>

<span data-ttu-id="5b977-308">При подготовке к просмотру на поверхности DXGI Direct2D сохраняет состояние устройств Direct3D при их визуализации и восстановлении после завершения подготовки к просмотру.</span><span class="sxs-lookup"><span data-stu-id="5b977-308">When rendering to a DXGI surface, Direct2D saves the state of the Direct3D devices while rendering and restores it when rendering is completed.</span></span> <span data-ttu-id="5b977-309">Каждый раз при завершении подготовки к просмотру пакета Direct2D затраты на сохранение и восстановление, а также стоимость очистки всех 2D-операций оплачиваются, а устройство Direct3D не очищается.</span><span class="sxs-lookup"><span data-stu-id="5b977-309">Every time that a batch of Direct2D rendering is completed, the cost of this save and restore and the cost of flushing all the 2D operations are paid, and yet, the Direct3D device is not flushed.</span></span> <span data-ttu-id="5b977-310">Таким образом, чтобы повысить производительность, ограничьте число переключений отрисовки между Direct2D и Direct3D.</span><span class="sxs-lookup"><span data-stu-id="5b977-310">Therefore, to increase performance, limit the number of rendering switches between Direct2D and Direct3D.</span></span>

## <a name="know-your-pixel-format"></a><span data-ttu-id="5b977-311">Знакомство с форматом пикселей</span><span class="sxs-lookup"><span data-stu-id="5b977-311">Know Your Pixel Format</span></span>

<span data-ttu-id="5b977-312">При создании целевого объекта рендеринга можно использовать структуру [**\_ \_ формата пикселей D2D1**](/windows/desktop/api/dcommon/ns-dcommon-d2d1_pixel_format) для указания формата пикселей и альфа-режима, используемого целью рендеринга.</span><span class="sxs-lookup"><span data-stu-id="5b977-312">When you create a render target, you can use the [**D2D1\_PIXEL\_FORMAT**](/windows/desktop/api/dcommon/ns-dcommon-d2d1_pixel_format) structure specify the pixel format and alpha mode used by the render target.</span></span> <span data-ttu-id="5b977-313">Альфа-канал является частью формата пикселей, который указывает значение покрытия или сведения о непрозрачности.</span><span class="sxs-lookup"><span data-stu-id="5b977-313">An alpha channel is part of the pixel format that specifies the coverage value or opacity information.</span></span> <span data-ttu-id="5b977-314">Если целевой объект прорисовки не использует альфа-канал, он должен быть создан с помощью [**\_ \_ режима \_ альфа**](/windows/desktop/api/dcommon/ne-dcommon-d2d1_alpha_mode) -канала D2D1.</span><span class="sxs-lookup"><span data-stu-id="5b977-314">If a render target does not use the alpha channel, it should be created by using the [**D2D1\_ALPHA\_MODE\_IGNORE**](/windows/desktop/api/dcommon/ne-dcommon-d2d1_alpha_mode) alpha mode.</span></span> <span data-ttu-id="5b977-315">Это изменяет время, затраченное на визуализацию альфа-канала, который не требуется.</span><span class="sxs-lookup"><span data-stu-id="5b977-315">This spares the time that is spent on rendering an alpha channel that is not needed.</span></span>

<span data-ttu-id="5b977-316">Дополнительные сведения о форматах пикселей и альфа-режимах см. в разделе [Поддерживаемые форматы пикселей и альфа-режимы](supported-pixel-formats-and-alpha-modes.md).</span><span class="sxs-lookup"><span data-stu-id="5b977-316">For more information about pixel formats and alpha modes, see [Supported Pixel Formats and Alpha Modes](supported-pixel-formats-and-alpha-modes.md).</span></span>

## <a name="scene-complexity"></a><span data-ttu-id="5b977-317">Сложность сцены</span><span class="sxs-lookup"><span data-stu-id="5b977-317">Scene Complexity</span></span>

<span data-ttu-id="5b977-318">При анализе горячих точек производительности в сцене, которая будет подготовлена к просмотру, убедитесь, что сцена является границей заливки или границей вершин может предоставить полезную информацию.</span><span class="sxs-lookup"><span data-stu-id="5b977-318">When you analyze performance hot spots in a scene that will be rendered, knowing whether the scene is fill-rate bound or vertex bound can provide useful information.</span></span>

-   <span data-ttu-id="5b977-319">Коэффициент заполнения: скорость заливки — это число пикселей, которое может быть отображено графической картой и записано в видеопамять в секунду.</span><span class="sxs-lookup"><span data-stu-id="5b977-319">Fill Rate: Fill rate refers to the number of pixels that a graphics card can render and write to video memory per second.</span></span>
-   <span data-ttu-id="5b977-320">Привязка к вершине: сцена привязана к вершине, если она содержит множество сложных геометрических объектов.</span><span class="sxs-lookup"><span data-stu-id="5b977-320">Vertex Bound: A scene is vertex bound when it contains lots of complex geometry.</span></span>

### <a name="understand-scene-complexity"></a><span data-ttu-id="5b977-321">Общие сведения о сложности сцены</span><span class="sxs-lookup"><span data-stu-id="5b977-321">Understand Scene Complexity</span></span>

<span data-ttu-id="5b977-322">Можно проанализировать сложность сцены, изменив размер целевого объекта рендеринга.</span><span class="sxs-lookup"><span data-stu-id="5b977-322">You can analyze your scene complexity by altering the size of the render target.</span></span> <span data-ttu-id="5b977-323">Если выигрыш в производительности видим для пропорционального уменьшения размера целевого объекта отрисовки, то приложение будет привязано к заливке.</span><span class="sxs-lookup"><span data-stu-id="5b977-323">If performance gains are visible for a proportional reduction in size of the render target, then the application is fill-rate bound.</span></span> <span data-ttu-id="5b977-324">В противном случае сложность сцены связана с узким местом производительности.</span><span class="sxs-lookup"><span data-stu-id="5b977-324">Otherwise, the scene complexity is the performance bottleneck.</span></span>

<span data-ttu-id="5b977-325">Если сцена имеет привязку к скорости заполнения, уменьшение размера целевого объекта рендеринга может повысить производительность.</span><span class="sxs-lookup"><span data-stu-id="5b977-325">When a scene is fill-rate bound, reducing the size of the render target can improve the performance.</span></span> <span data-ttu-id="5b977-326">Это связано с тем, что количество отображаемых пикселей будет уменьшено пропорционально размеру целевого объекта рендеринга.</span><span class="sxs-lookup"><span data-stu-id="5b977-326">This is because the number of pixels to be rendered will be reduced proportionally with the size of the render target.</span></span>

<span data-ttu-id="5b977-327">Если сцена привязана к вершине, уменьшите сложность геометрии.</span><span class="sxs-lookup"><span data-stu-id="5b977-327">When a scene is vertex bound, reduce the complexity of the geometry.</span></span> <span data-ttu-id="5b977-328">Но помните, что это делается за счет качества изображения.</span><span class="sxs-lookup"><span data-stu-id="5b977-328">But remember that this is done at the expense of image quality.</span></span> <span data-ttu-id="5b977-329">Поэтому необходимо принять решение о тщательном компромиссе между желаемым качеством и требуемой производительностью.</span><span class="sxs-lookup"><span data-stu-id="5b977-329">Therefore, a careful tradeoff decision should be made between the desired quality and the performance that is required.</span></span>

## <a name="improving-performance-for-direct2d-printing-apps"></a><span data-ttu-id="5b977-330">Повышение производительности для приложений печати Direct2D</span><span class="sxs-lookup"><span data-stu-id="5b977-330">Improving performance for Direct2D printing apps</span></span>

<span data-ttu-id="5b977-331">[Direct2D](./direct2d-portal.md) обеспечивает совместимость с печатью.</span><span class="sxs-lookup"><span data-stu-id="5b977-331">[Direct2D](./direct2d-portal.md) offers compatibility with printing.</span></span> <span data-ttu-id="5b977-332">Вы можете отправить те же команды рисования Direct2D (в виде списков команд Direct2D) в элемент управления печатью Direct2D для печати, если вы не знакомы, на каких устройствах выполняется рисование, или как документ будет преобразован для печати.</span><span class="sxs-lookup"><span data-stu-id="5b977-332">You can send the same Direct2D drawing commands (in the form of Direct2D command lists) to the Direct2D print control for printing, if you don't know what devices you are drawing to, or how the drawing is translated to printing.</span></span>

<span data-ttu-id="5b977-333">Вы можете более точно настроить использование элемента управления печатью [Direct2D](./direct2d-portal.md) и команд рисования Direct2D для предоставления результатов печати с лучшей производительностью.</span><span class="sxs-lookup"><span data-stu-id="5b977-333">You can further fine-tune their usage of the [Direct2D](./direct2d-portal.md) print control and your Direct2D drawing commands to deliver printing results with better performance.</span></span>

<span data-ttu-id="5b977-334">Элемент управления печатью [Direct2D](./direct2d-portal.md) выводит сообщения об отладке, когда он видит шаблон кода Direct2D, который ведет к снижению качества печати или производительности (например, шаблоны кода, приведенные ниже в этом разделе), чтобы напомнить, где можно избежать проблем с производительностью.</span><span class="sxs-lookup"><span data-stu-id="5b977-334">The [Direct2D](./direct2d-portal.md) print control outputs debug messages when it sees a Direct2D code pattern that leads to lower printing quality or performance (like, code patterns listed later in this topic) to remind you where you can avoid performance problems.</span></span> <span data-ttu-id="5b977-335">Чтобы просмотреть эти отладочные сообщения, необходимо включить [уровень отладки Direct2D](direct2ddebuglayer-portal.md) в коде.</span><span class="sxs-lookup"><span data-stu-id="5b977-335">To see those debug messages, you need to enable [Direct2D Debug Layer](direct2ddebuglayer-portal.md) in your code.</span></span> <span data-ttu-id="5b977-336">Инструкции по включению вывода отладочных сообщений см. в разделе [Отладка сообщений](direct2ddebuglayer-debugmessages.md) .</span><span class="sxs-lookup"><span data-stu-id="5b977-336">See [Debug Messages](direct2ddebuglayer-debugmessages.md) for instructions to enable debug message output.</span></span>

### <a name="set-the-right-property-values-when-you-create-the-d2d-print-control"></a><span data-ttu-id="5b977-337">Задание значений свойств справа при создании элемента управления печатью D2D</span><span class="sxs-lookup"><span data-stu-id="5b977-337">Set the right property values when you create the D2D print control</span></span>

<span data-ttu-id="5b977-338">При создании элемента управления печатью [Direct2D](./direct2d-portal.md) можно задать три свойства.</span><span class="sxs-lookup"><span data-stu-id="5b977-338">There are three properties that you can set when you create the [Direct2D](./direct2d-portal.md) print control.</span></span> <span data-ttu-id="5b977-339">Два из этих свойств влияют на то, как элемент управления печатью Direct2D обрабатывает определенные команды Direct2D и, в свою очередь, влияет на общую производительность.</span><span class="sxs-lookup"><span data-stu-id="5b977-339">Two of these properties impact how the Direct2D print control handles certain Direct2D commands and in turn impact the overall performance.</span></span>

-   <span data-ttu-id="5b977-340">Режим подмножества шрифтов. элемент управления печатью [Direct2D](./direct2d-portal.md) подмножества шрифтов, используемых на каждой странице перед отправкой страницы для печати.</span><span class="sxs-lookup"><span data-stu-id="5b977-340">Font Subset Mode: The [Direct2D](./direct2d-portal.md) print control subsets font resources used in each page before it sends the page to be printed.</span></span> <span data-ttu-id="5b977-341">Этот режим уменьшает размер страничных ресурсов, необходимых для печати.</span><span class="sxs-lookup"><span data-stu-id="5b977-341">This mode reduces the size of page resources needed to print.</span></span> <span data-ttu-id="5b977-342">В зависимости от использования шрифта на странице можно выбрать различные режимы подмножества шрифтов для лучшей производительности.</span><span class="sxs-lookup"><span data-stu-id="5b977-342">Depending on font usage on the page, you can choose different font subset modes for the best performance.</span></span>
    -   <span data-ttu-id="5b977-343">[**D2D1 \_ \_ \_ Режим подмножества \_ шрифтов \_ по умолчанию**](/windows/desktop/api/d2d1_1/ne-d2d1_1-d2d1_print_font_subset_mode) обеспечивает оптимальную производительность печати в большинстве случаев.</span><span class="sxs-lookup"><span data-stu-id="5b977-343">[**D2D1\_PRINT\_FONT\_SUBSET\_MODE\_DEFAULT**](/windows/desktop/api/d2d1_1/ne-d2d1_1-d2d1_print_font_subset_mode) provides the best printing performance in most cases.</span></span> <span data-ttu-id="5b977-344">При задании этого режима элемент управления печатью [Direct2D](./direct2d-portal.md) использует эвристическую стратегию для принятия решения о подмножестве шрифтов.</span><span class="sxs-lookup"><span data-stu-id="5b977-344">When set to this mode, the [Direct2D](./direct2d-portal.md) print control uses a heuristic strategy to decide when to subset fonts.</span></span>
    -   <span data-ttu-id="5b977-345">Для коротких заданий печати с 1 или 2 страницами рекомендуется [**D2D1 \_ Печать в \_ \_ режиме подмножества шрифтов \_ \_ еачпаже**](/windows/desktop/api/d2d1_1/ne-d2d1_1-d2d1_print_font_subset_mode) , где поднаборы элемента управления печатью [Direct2D](./direct2d-portal.md) и внедряет ресурсы шрифтов на каждой странице, а затем отменяет это подмножество шрифтов после печати страницы.</span><span class="sxs-lookup"><span data-stu-id="5b977-345">For short print jobs with 1 or 2 pages, we recommend [**D2D1\_PRINT\_FONT\_SUBSET\_MODE\_EACHPAGE**](/windows/desktop/api/d2d1_1/ne-d2d1_1-d2d1_print_font_subset_mode) , where the [Direct2D](./direct2d-portal.md) print control subsets and embeds font resources in each page, then discards that font subset after the page prints.</span></span> <span data-ttu-id="5b977-346">Этот параметр обеспечивает печать каждой страницы сразу после ее создания, но немного увеличивает размер страничных ресурсов, необходимых для печати (с обычно большими подмножествами шрифтов).</span><span class="sxs-lookup"><span data-stu-id="5b977-346">This option makes sure each page can be printed immediately after it is generated but slightly increases size of page resources needed for printing (with usually large font subsets).</span></span>
    -   <span data-ttu-id="5b977-347">Для заданий печати со многими страницами текста и мелкими размерами шрифтов (например, 100 страниц текста, использующих один шрифт), мы рекомендуем [**D2D1 \_ \_ \_ режим печати подмножеств шрифтов \_ \_ None**](/windows/desktop/api/d2d1_1/ne-d2d1_1-d2d1_print_font_subset_mode), где элемент управления печатью [Direct2D](./direct2d-portal.md) не является ни ресурсами подмножества; вместо этого он отправляет исходные ресурсы шрифта вместе со страницей, которая использует шрифт, и повторно использует ресурсы шрифтов для последующих страниц, не передавая их.</span><span class="sxs-lookup"><span data-stu-id="5b977-347">For print jobs with many pages of texts and small font sizes (like 100 pages of text that uses a single font), we recommend [**D2D1\_PRINT\_FONT\_SUBSET\_MODE\_NONE**](/windows/desktop/api/d2d1_1/ne-d2d1_1-d2d1_print_font_subset_mode), where the [Direct2D](./direct2d-portal.md) print control doesn't subset font resources at all; instead, it sends out the original font resources along with the page that first uses the font, and re-uses the font resources for later pages without resending them.</span></span>
-   <span data-ttu-id="5b977-348">Масштабирование DPI. Если элементу управления печатью [Direct2D](./direct2d-portal.md) нужно растрировать команды Direct2D во время преобразования DIRECT2D-XPS, он использует это разрешение для растрирования.</span><span class="sxs-lookup"><span data-stu-id="5b977-348">Rasterization DPI: When the [Direct2D](./direct2d-portal.md) print control needs to rasterize Direct2D commands during Direct2D-XPS conversion, it uses this DPI for rasterization.</span></span> <span data-ttu-id="5b977-349">Иными словами, если на странице нет растрового содержимого, установка любых точек на дюйм не изменит производительность и качество.</span><span class="sxs-lookup"><span data-stu-id="5b977-349">In other words, if the page doesn't have any rasterized contents, setting any DPI won't change performance and quality.</span></span> <span data-ttu-id="5b977-350">В зависимости от использования растрирования на странице можно выбрать различные dpi растрирования для наилучшего баланса между точностью и производительностью.</span><span class="sxs-lookup"><span data-stu-id="5b977-350">Depending on rasterization usage on the page, you can choose different rasterization DPIs for the best balance between fidelity and performance.</span></span>
    -   <span data-ttu-id="5b977-351">150 — это значение по умолчанию, если не указать значение при создании элемента управления печатью [Direct2D](./direct2d-portal.md) , что является лучшим балансом качества печати и производительности печати в большинстве случаев.</span><span class="sxs-lookup"><span data-stu-id="5b977-351">150 is the default value if you don't specify a value when you create the [Direct2D](./direct2d-portal.md) print control, which is the best balance of printing quality and printing performance in most cases.</span></span>
    -   <span data-ttu-id="5b977-352">Более высокие значения DPI обычно приводят к увеличению качества печати (как в случае сохранения сведений), но более низкая производительность из-за большего размера создаваемых им растровых изображений.</span><span class="sxs-lookup"><span data-stu-id="5b977-352">Higher DPI values usually result in better printing quality (as in more details preserved) but lower performance due to the larger bitmaps it generates.</span></span> <span data-ttu-id="5b977-353">Не рекомендуется использовать значение DPI, превышающее 300, так как это не дает дополнительной информации, визуально воспринимаемого человеческими глазами.</span><span class="sxs-lookup"><span data-stu-id="5b977-353">We don't recommend any DPI value greater than 300 since that won't introduce extra information visually perceivable by human eyes.</span></span>
    -   <span data-ttu-id="5b977-354">Более низкое значение DPI может означать лучшую производительность, но также может привести к более низкому качеству.</span><span class="sxs-lookup"><span data-stu-id="5b977-354">Lower DPI may mean better performance but may also produce lower quality.</span></span>

### <a name="avoid-using-certain-direct2d-drawing-patterns"></a><span data-ttu-id="5b977-355">Избегайте использования определенных шаблонов рисования Direct2D</span><span class="sxs-lookup"><span data-stu-id="5b977-355">Avoid using certain Direct2D drawing patterns</span></span>

<span data-ttu-id="5b977-356">Существуют различия между тем, что [Direct2D](./direct2d-portal.md) может представлять визуальный элемент, а также то, что подсистема печати может поддерживать и передавать в весь конвейер печати.</span><span class="sxs-lookup"><span data-stu-id="5b977-356">There are differences between what [Direct2D](./direct2d-portal.md) can represent visually and what the print subsystem can maintain and transport along the whole print pipeline.</span></span> <span data-ttu-id="5b977-357">Элемент управления печатью Direct2D связывает эти промежутки с помощью аппроксимации или растрирования Direct2D примитивов, которые не поддерживаются встроенной подсистемой печати.</span><span class="sxs-lookup"><span data-stu-id="5b977-357">The Direct2D print control bridges those gaps by either approximating or rasterizing Direct2D primitives that the print subsystem doesn't natively support.</span></span> <span data-ttu-id="5b977-358">Подобная аппроксимация обычно приводит к более низкой точности печати, более низкой производительности печати или к обоим.</span><span class="sxs-lookup"><span data-stu-id="5b977-358">Such approximation usually results in lower printing fidelity, lower printing performance, or both.</span></span> <span data-ttu-id="5b977-359">Таким образом, несмотря на то, что клиент может использовать одни и те же закономерности для отрисовки экрана и печати, он не идеально подходит во всех случаях.</span><span class="sxs-lookup"><span data-stu-id="5b977-359">Therefore, even though a customer can use the same drawing patterns for both screen and print rendering, it is not ideal in all cases.</span></span> <span data-ttu-id="5b977-360">Не рекомендуется использовать такие Direct2D примитивы и закономерности для пути печати, а также выполнять растрирование, когда вы обладаете полным контролем качества и размера растровых изображений.</span><span class="sxs-lookup"><span data-stu-id="5b977-360">It's best not to use such Direct2D primitives and patterns as much as possible for the print path, or to do you own rasterization where you have full control of the quality and the size of the rasterized images.</span></span>

<span data-ttu-id="5b977-361">Ниже приведен список случаев, когда производительность и качество печати не будут идеальными, и вы можете рассмотреть возможность изменения пути кода для оптимальной производительности печати.</span><span class="sxs-lookup"><span data-stu-id="5b977-361">The here is a list of cases where the print performance and quality won't be ideal and the you might want to consider varying the code path for optimal print performance.</span></span>

-   <span data-ttu-id="5b977-362">Избегайте использования простого режима Blend, отличного от [**D2D1- \_ примитивного \_ смешения \_ саурцеовер**](/windows/desktop/api/D2d1_1/ne-d2d1_1-d2d1_primitive_blend).</span><span class="sxs-lookup"><span data-stu-id="5b977-362">Avoid using primitive blend mode other than [**D2D1\_PRIMITIVE\_BLEND\_SOURCEOVER**](/windows/desktop/api/D2d1_1/ne-d2d1_1-d2d1_primitive_blend).</span></span>
-   <span data-ttu-id="5b977-363">Избегайте использования режимов композиции при рисовании изображения, отличного от [**\_ источника D2D1 составного \_ режима \_ \_**](/windows/desktop/api/D2d1_1/ne-d2d1_1-d2d1_composite_mode) , и **D2D1ного \_ назначения в составном \_ режиме \_ \_**.</span><span class="sxs-lookup"><span data-stu-id="5b977-363">Avoid using Composition Modes when drawing an image other than [**D2D1\_COMPOSITE\_MODE\_SOURCE\_OVER**](/windows/desktop/api/D2d1_1/ne-d2d1_1-d2d1_composite_mode) and **D2D1\_COMPOSITE\_MODE\_DESTINATION\_OVER**.</span></span>
-   <span data-ttu-id="5b977-364">Избегайте прорисовки мета-файла GDI.</span><span class="sxs-lookup"><span data-stu-id="5b977-364">Avoid drawing a GDI Meta File.</span></span>
-   <span data-ttu-id="5b977-365">Избегайте принудительной отправки ресурса слоя, который копирует исходный фон (вызов [**пушлайер**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1commandsink-pushlayer) с передачей [**D2D1 \_ слоя \_ OPTIONS1 \_ инициализировать \_ из \_ фона**](/windows/desktop/api/d2d1_1/ns-d2d1_1-d2d1_layer_parameters1) в структуру **\_ \_ PARAMETERS1 уровня D2D1** ).</span><span class="sxs-lookup"><span data-stu-id="5b977-365">Avoid pushing a layer resource that copies the source background (calling [**PushLayer**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1commandsink-pushlayer) with passing [**D2D1\_LAYER\_OPTIONS1\_INITIALIZE\_FROM\_BACKGROUND**](/windows/desktop/api/d2d1_1/ns-d2d1_1-d2d1_layer_parameters1) to the **D2D1\_LAYER\_PARAMETERS1** struct).</span></span>
-   <span data-ttu-id="5b977-366">Избегайте создания растровой кисти или кисти изображения с D2D1ом в \_ \_ режиме расширения \_ .</span><span class="sxs-lookup"><span data-stu-id="5b977-366">Avoid creating Bitmap Brush or Image Brush with D2D1\_EXTEND\_MODE\_CLAMP.</span></span> <span data-ttu-id="5b977-367">Рекомендуется использовать \_ \_ зеркальное отображение в режиме расширения D2D1, \_ если не важно, чтобы Пиксели за пределами изображения (например, изображение, присоединенное к кисти, было больше, чем закрашенный целевой регион).</span><span class="sxs-lookup"><span data-stu-id="5b977-367">We recommend you use D2D1\_EXTEND\_MODE\_MIRROR if don't care about pixels outside of the image bound at all (like, the image attached to the brush is known to be larger than the filled target region).</span></span>
-   <span data-ttu-id="5b977-368">Избегайте рисования растровых изображений с помощью [преобразований перспективы](3d-perspective-transform.md).</span><span class="sxs-lookup"><span data-stu-id="5b977-368">Avoid drawing Bitmaps with [Perspective Transforms](3d-perspective-transform.md).</span></span>

### <a name="draw-text-in-a-direct-and-plain-way"></a><span data-ttu-id="5b977-369">Рисование текста прямым и обычным способом</span><span class="sxs-lookup"><span data-stu-id="5b977-369">Draw text in a direct and plain way</span></span>

<span data-ttu-id="5b977-370">Direct2D имеет несколько оптимизаций при отрисовке текста для отображения для повышения производительности и/или более качественного визуального элемента.</span><span class="sxs-lookup"><span data-stu-id="5b977-370">Direct2D has several optimizations when rendering texts to display for better performance and/or better visual quality.</span></span> <span data-ttu-id="5b977-371">Но не все оптимизации улучшают производительность и качество печати, так как печать на бумаге обычно выполняется значительно быстрее, а печать не требует таких сценариев, как анимация.</span><span class="sxs-lookup"><span data-stu-id="5b977-371">But not all optimizations improve the printing performance and quality since the printing on paper is usually in a much higher DPI, and printing does not need to accommodate scenarios like animation.</span></span> <span data-ttu-id="5b977-372">Поэтому мы рекомендуем рисовать исходный текст или глифы напрямую и избежать любой из следующих оптимизаций при создании списка команд для печати.</span><span class="sxs-lookup"><span data-stu-id="5b977-372">So, we recommend you draw the original text or glyphs directly and avoid any of the following optimizations when creating the command list for printing.</span></span>

-   <span data-ttu-id="5b977-373">Избегайте рисования текста с помощью метода [**филлопаЦитимаск**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1commandsink-fillopacitymask) .</span><span class="sxs-lookup"><span data-stu-id="5b977-373">Avoid drawing text with the [**FillOpacityMask**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1commandsink-fillopacitymask) method.</span></span>
-   <span data-ttu-id="5b977-374">Старайтесь не рисовать текст в режиме с псевдонимами.</span><span class="sxs-lookup"><span data-stu-id="5b977-374">Avoid drawing text in Aliased Mode.</span></span>

### <a name="draw-the-original-bitmaps-when-possible"></a><span data-ttu-id="5b977-375">По возможности нарисовать исходные точечные рисунки</span><span class="sxs-lookup"><span data-stu-id="5b977-375">Draw the original bitmaps when possible</span></span>

<span data-ttu-id="5b977-376">Если целевым точечным рисунком является JPEG, PNG, TIFF или JPEG-XR, можно создать точечный рисунок WIC либо из файла на диске, либо из потока в памяти, а затем создать точечный рисунок [Direct2D](./direct2d-portal.md) из этого растрового изображения WIC с помощью [**ID2D1DeviceContext:: креатебитмапфромвикбитмап**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-createbitmapfromwicbitmap(iwicbitmapsource_constd2d1_bitmap_properties1_id2d1bitmap1))и, наконец, передать его непосредственно в элемент управления печатью Direct2D, не изменяя дальнейшую манипуляцию.</span><span class="sxs-lookup"><span data-stu-id="5b977-376">If the target bitmap is a JPEG, PNG, TIFF, or JPEG-XR, you can create a WIC bitmap either from a disk file or from an in-memory stream, then create a [Direct2D](./direct2d-portal.md) bitmap from that WIC bitmap using [**ID2D1DeviceContext::CreateBitmapFromWicBitmap**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-createbitmapfromwicbitmap(iwicbitmapsource_constd2d1_bitmap_properties1_id2d1bitmap1)), and finally directly pass that Direct2D bitmap to the Direct2D print control without further manipulation.</span></span> <span data-ttu-id="5b977-377">Таким образом, элемент управления печатью Direct2D может повторно использовать поток растрового изображения, что обычно приводит к повышению производительности печати (пропуская избыточное кодирование и декодирование битовой карты) и улучшает качество печати (при сохранении метаданных, например цветовых профилей, в растровом изображении).</span><span class="sxs-lookup"><span data-stu-id="5b977-377">By doing so, the Direct2D print control is able to reuse the bitmap stream, which usually leads to better printing performance (by skipping redundant bitmap encoding and decoding), and better printing quality (when metadata, such as color profiles, in the bitmap will be preserved).</span></span>

<span data-ttu-id="5b977-378">Рисование исходного растрового изображения обеспечивает следующие преимущества для приложений.</span><span class="sxs-lookup"><span data-stu-id="5b977-378">Drawing the original bitmap provides the following benefit for applications.</span></span>

-   <span data-ttu-id="5b977-379">В целом, [Direct2Dная](./direct2d-portal.md) печать сохраняет исходную информацию (без потерь или шума) до момента опоздания в конвейере, особенно если приложения не известны (или не хотят быть осведомленными) сведения о конвейере печати (например, на принтере, на котором выполняется печать, а также на целевом принтере и т. д.).</span><span class="sxs-lookup"><span data-stu-id="5b977-379">In general, [Direct2D](./direct2d-portal.md) print preserves the original information (without loss or noise) until late in the pipeline, especially when apps don't know (or do not want to know) the details of the print pipeline (like which printer it is printing to, what DPI is the target printer, and so on).</span></span>
-   <span data-ttu-id="5b977-380">Во многих случаях задержка растрирования растрового изображения означает лучшую производительность (например, при печати фотографии 96dpi на принтере 600dpi).</span><span class="sxs-lookup"><span data-stu-id="5b977-380">In many cases, delaying bitmap rasterization means better performance (like when printing an 96dpi photo to a 600dpi printer).</span></span>
-   <span data-ttu-id="5b977-381">В некоторых случаях передача исходных изображений является единственным способом обеспечения высокой точности (например, встроенных цветовых профилей).</span><span class="sxs-lookup"><span data-stu-id="5b977-381">In certain cases, passing the original images is the only way to honor high fidelity (like embedded color profiles).</span></span>

<span data-ttu-id="5b977-382">Однако вы не можете принять такую оптимизацию, поскольку:</span><span class="sxs-lookup"><span data-stu-id="5b977-382">However, an you can't opt in such optimization because:</span></span>

-   <span data-ttu-id="5b977-383">Запрашивая сведения о принтерах и ранних растрированиях, вы можете разпрограммировать содержимое самостоятельно, используя полный контроль над окончательным внешним видом бумаги.</span><span class="sxs-lookup"><span data-stu-id="5b977-383">By querying printer info and early rasterization, you can rasterize contents themselves with full control of the final appearance on paper.</span></span>
-   <span data-ttu-id="5b977-384">В некоторых случаях раннее растрирование может улучшить производительность комплексного приложения (например, печать фотографий валлетс).</span><span class="sxs-lookup"><span data-stu-id="5b977-384">In certain cases, early rasterization might actually improves an app’s end-to-end performance (like printing wallets-size photos).</span></span>
-   <span data-ttu-id="5b977-385">В некоторых случаях для передачи исходных битовых рисунков требуется значительное изменение существующей архитектуры кода (например, задержка изображения и пути обновления ресурсов, обнаруженные в некоторых приложениях).</span><span class="sxs-lookup"><span data-stu-id="5b977-385">In certain cases, passing the original bitmaps require significant change of existing code architecture (like image delay loading and resource update paths found in certain applications).</span></span>

## <a name="conclusion"></a><span data-ttu-id="5b977-386">Заключение</span><span class="sxs-lookup"><span data-stu-id="5b977-386">Conclusion</span></span>

<span data-ttu-id="5b977-387">Хотя Direct2D является аппаратным ускорением и предназначен для обеспечения высокой производительности, для повышения пропускной способности необходимо правильно использовать функции.</span><span class="sxs-lookup"><span data-stu-id="5b977-387">Although Direct2D is hardware accelerated and is meant for high performance, you must use the features correctly to maximize throughput.</span></span> <span data-ttu-id="5b977-388">Методы, которые мы рассматривали здесь, являются производными от изучения распространенных сценариев и могут не применяться ко всем сценариям приложений.</span><span class="sxs-lookup"><span data-stu-id="5b977-388">The techniques we looked at here are derived from studying common scenarios and might not apply to all application scenarios.</span></span>

 

 
