---
title: Сжатие блоков
description: Описывает, как работает блочное сжатие и как его использовать в WIC и Direct2D.
ms.assetid: 52AF86A5-16E8-4AC8-BB67-CC2F1A3635B5
ms.topic: article
ms.date: 05/31/2018
ms.custom: seodec18
ms.openlocfilehash: aeb6ba9427a04f7a251a1d59062be508e4249b41
ms.sourcegitcommit: ee06501cc29132927ade9813e0888aaa4decc487
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/28/2021
ms.locfileid: "104547239"
---
# <a name="block-compression"></a><span data-ttu-id="f72ed-103">Сжатие блоков</span><span class="sxs-lookup"><span data-stu-id="f72ed-103">Block compression</span></span>

<span data-ttu-id="f72ed-104">Начиная с Windows 8.1, Direct2D поддерживает несколько блочных сжатых форматов пикселей.</span><span class="sxs-lookup"><span data-stu-id="f72ed-104">Starting with Windows 8.1, Direct2D supports several block compressed pixel formats.</span></span> <span data-ttu-id="f72ed-105">Кроме того, Windows 8.1 содержит новый кодек Windows Imaging Component (WIC) DDS, позволяющий загружать и хранить блочные сжатые изображения в формате файлов DDS.</span><span class="sxs-lookup"><span data-stu-id="f72ed-105">In addition, Windows 8.1 contains a new Windows Imaging Component (WIC) DDS codec to enable loading and storing block compressed images in the DDS file format.</span></span> <span data-ttu-id="f72ed-106">Блочное сжатие — это способ уменьшения объема графической памяти, используемой содержимым растрового изображения.</span><span class="sxs-lookup"><span data-stu-id="f72ed-106">Block compression is a technique for reducing the amount of graphics memory that is consumed by bitmap content.</span></span> <span data-ttu-id="f72ed-107">С помощью блочного сжатия приложение может сократить потребление памяти и время загрузки для тех же образов разрешения.</span><span class="sxs-lookup"><span data-stu-id="f72ed-107">By using block compression, your app can reduce memory consumption and load times for the same resolution images.</span></span> <span data-ttu-id="f72ed-108">Или же приложение может использовать более или более высокое изображение разрешения, одновременно используя один и тот же объем памяти GPU.</span><span class="sxs-lookup"><span data-stu-id="f72ed-108">Or, your app can use more or higher resolution images while still consuming the same GPU memory footprint.</span></span>

<span data-ttu-id="f72ed-109">Сжатие блочных приложений было использовано приложениями Direct3D в течение длительного времени, а также с Windows 8.1 доступен для широкого и Direct2D разработчиков приложений.</span><span class="sxs-lookup"><span data-stu-id="f72ed-109">Block compression has been used by Direct3D applications for a long time, and with Windows 8.1 is available to mainstream and Direct2D application developers as well.</span></span>

<span data-ttu-id="f72ed-110">В этом разделе описывается, как работает блочное сжатие и как его использовать в WIC и Direct2D.</span><span class="sxs-lookup"><span data-stu-id="f72ed-110">This topic describes how block compression works and how to use it in WIC and Direct2D.</span></span>

## <a name="about-block-compression"></a><span data-ttu-id="f72ed-111">О блочном сжатии</span><span class="sxs-lookup"><span data-stu-id="f72ed-111">About Block Compression</span></span>

<span data-ttu-id="f72ed-112">[Блочное сжатие](/windows/desktop/direct3d10/d3d10-graphics-programming-guide-resources-block-compression) (BC) относится к классу методов сжатия для сокращения размеров текстур.</span><span class="sxs-lookup"><span data-stu-id="f72ed-112">[Block Compression](/windows/desktop/direct3d10/d3d10-graphics-programming-guide-resources-block-compression) (BC) refers to a class of compression techniques for reducing texture sizes.</span></span> <span data-ttu-id="f72ed-113">Direct3D 11 поддерживает до 7 различных форматов BC в зависимости от уровня компонентов.</span><span class="sxs-lookup"><span data-stu-id="f72ed-113">Direct3D 11 supports up to 7 different BC formats depending on feature level.</span></span> <span data-ttu-id="f72ed-114">В Windows 8.1 Direct2D предоставляет поддержку форматов BC1, BC2 и BC3, доступных на всех уровнях компонентов.</span><span class="sxs-lookup"><span data-stu-id="f72ed-114">In Windows 8.1 Direct2D introduces support for the BC1, BC2 and BC3 formats which are available across all feature levels.</span></span>

### <a name="how-block-compression-works"></a><span data-ttu-id="f72ed-115">Как работает блочное сжатие</span><span class="sxs-lookup"><span data-stu-id="f72ed-115">How Block Compression works</span></span>

<span data-ttu-id="f72ed-116">При использовании блочных сжатых форматов используется одна и та же базовая методика для уменьшения пространства, занятого данными цвета.</span><span class="sxs-lookup"><span data-stu-id="f72ed-116">The block compressed formats all use the same basic technique to reduce the space consumed by color data.</span></span> <span data-ttu-id="f72ed-117">В этом разделе приведена сводка простейшего алгоритма BC1.</span><span class="sxs-lookup"><span data-stu-id="f72ed-117">This section summarizes the simplest algorithm, BC1.</span></span> <span data-ttu-id="f72ed-118">Более подробное описание см. в разделе [блочное сжатие](/windows/desktop/direct3d11/texture-block-compression-in-direct3d-11).</span><span class="sxs-lookup"><span data-stu-id="f72ed-118">For a more detailed explanation, see [Block Compression](/windows/desktop/direct3d11/texture-block-compression-in-direct3d-11).</span></span>

<span data-ttu-id="f72ed-119">Во-первых, изображение делится на блоки с 4 на 4 пикселя.</span><span class="sxs-lookup"><span data-stu-id="f72ed-119">First, the image is divided into blocks of 4 by 4 pixels.</span></span> <span data-ttu-id="f72ed-120">Каждый блок сжимается отдельно.</span><span class="sxs-lookup"><span data-stu-id="f72ed-120">Each block is compressed separately.</span></span>

> [!Note]  
> <span data-ttu-id="f72ed-121">Это означает, что ширина и высота изображения должны быть кратными 4 пикселям, чтобы блокировать сжатие.</span><span class="sxs-lookup"><span data-stu-id="f72ed-121">This means an image’s width and height must each be a multiple of 4 pixel for it to be block compressed.</span></span>

 

<span data-ttu-id="f72ed-122">В этом примере изображения показан блок 4x4 пикселей в изображении.</span><span class="sxs-lookup"><span data-stu-id="f72ed-122">This example image shows a 4x4 pixel block within an image.</span></span>

![Пример изображения показывает блок пикселей 4x4 в изображении.](images/dds1.png)

<span data-ttu-id="f72ed-124">Затем в блоке 4 на 4 выбираются два типа "ссылки", которые кодируются как 2 16 разрядных значений (5 бит красного, 6 бит зеленого, 5 бит синего цвета).</span><span class="sxs-lookup"><span data-stu-id="f72ed-124">Next, within a 4 by 4 block, two “reference” colors are selected and are encoded as two 16 bit values (5 bits red, 6 bits green, 5 bits blue).</span></span> <span data-ttu-id="f72ed-125">Возможность выбора этих цветов существенно влияет на качество изображения и является нетривиальной.</span><span class="sxs-lookup"><span data-stu-id="f72ed-125">The choice of these colors significantly affects image quality and is nontrivial.</span></span> <span data-ttu-id="f72ed-126">Два промежуточных цвета рассчитываются с помощью линейной интерполяции между двумя эталонными цветами в цветовом пространстве RGB.</span><span class="sxs-lookup"><span data-stu-id="f72ed-126">Two intermediate colors are calculated by linearly interpolating between the two reference colors in the RGB color space.</span></span> <span data-ttu-id="f72ed-127">В результате получается 4 разных возможных цветов. каждому цвету присваивается значение двух битов индекса.</span><span class="sxs-lookup"><span data-stu-id="f72ed-127">This produces a total of 4 different possible colors; each color is assigned a two bit index value.</span></span> <span data-ttu-id="f72ed-128">Однако обратите внимание, что при фиксированной интерполяции необходимо сохранить только два цвета конечной точки.</span><span class="sxs-lookup"><span data-stu-id="f72ed-128">However, note that only the two endpoint colors need to be stored as the interpolation is fixed.</span></span>

<span data-ttu-id="f72ed-129">На этом рисунке цвета 0 и 3 выделены как "справочные" цвета блока, а цвета 1 и 2 — с помощью линейной интерполяции.</span><span class="sxs-lookup"><span data-stu-id="f72ed-129">In this figure, colors 0 and 3 are selected as “reference” colors for the block, while colors 1 and 2 are calculated using linear interpolation.</span></span>

![Схема, на которой показано вычисление 4 цветовых значений для представления блока.](images/dds2.png)

<span data-ttu-id="f72ed-131">Наконец, каждый пиксель в блоке сопоставляется с одним из четырех ранее вычисленных цветов, и каждый пиксель кодируется с использованием двух битовых значений индекса.</span><span class="sxs-lookup"><span data-stu-id="f72ed-131">Finally, every pixel in the block is mapped to one of the four previously calculated colors, and each pixel is encoded using the two bit index value.</span></span>

<span data-ttu-id="f72ed-132">Общий объем данных, используемых для представления этих 16 пикселей, составляет:</span><span class="sxs-lookup"><span data-stu-id="f72ed-132">The total amount of data used to represent these 16 pixels is:</span></span>

`16 bits [to define a reference color] * 2 + 2 bits * 16 [number of pixels]  = 64 bits`

<span data-ttu-id="f72ed-133">Это приводит к среднему плотности в 4 бита на пиксель.</span><span class="sxs-lookup"><span data-stu-id="f72ed-133">This results in an average density of 4 bits per pixel.</span></span> <span data-ttu-id="f72ed-134">Для сравнения, общий \_ \_ Формат B8G8R8A8 UNORM пикселей в формате DXGI \_ потребляет 32 бит на пиксель.</span><span class="sxs-lookup"><span data-stu-id="f72ed-134">For comparison, the common DXGI\_FORMAT\_B8G8R8A8\_UNORM pixel format consumes 32 bits per pixel.</span></span>

<span data-ttu-id="f72ed-135">На этой схеме показано, что каждый пиксель кодируется как 2-разрядный индекс.</span><span class="sxs-lookup"><span data-stu-id="f72ed-135">This diagram shows that each pixel is encoded as a 2 bit index.</span></span> <span data-ttu-id="f72ed-136">Весь блок кодируется в 64 битах.</span><span class="sxs-lookup"><span data-stu-id="f72ed-136">The entire block is encoded in 64 bits.</span></span>

![Вычисление 4 значений цвета для представления блока.](images/dds3.png)

<span data-ttu-id="f72ed-138">Существуют разновидности для поддержки альфа-данных и различных чисел цветовых каналов.</span><span class="sxs-lookup"><span data-stu-id="f72ed-138">There are variations to support alpha data and varying numbers of color channels.</span></span> <span data-ttu-id="f72ed-139">BC6H и BC7 используют значительно разные алгоритмы для поддержки содержимого в динамическом диапазоне (HDR) и повышения качества изображения соответственно.</span><span class="sxs-lookup"><span data-stu-id="f72ed-139">BC6H and BC7 use significantly different algorithms in order to support high dynamic range (HDR) content and increase image quality, respectively.</span></span>

### <a name="directdraw-surface-dds-file-format"></a><span data-ttu-id="f72ed-140">Формат файла поверхности DirectDraw (DDS)</span><span class="sxs-lookup"><span data-stu-id="f72ed-140">DirectDraw Surface (DDS) file format</span></span>

<span data-ttu-id="f72ed-141">Блочные сжатые данные обычно хранятся в файлах [поверхности DirectDraw (DDS)](/windows/desktop/direct3ddds/dx-graphics-dds-reference) .</span><span class="sxs-lookup"><span data-stu-id="f72ed-141">Block compressed data is typically stored in [DirectDraw Surface (DDS)](/windows/desktop/direct3ddds/dx-graphics-dds-reference) files.</span></span> <span data-ttu-id="f72ed-142">Возможно, вы знакомы с файлами DDS, если вы являетесь разработчиком Direct3D.</span><span class="sxs-lookup"><span data-stu-id="f72ed-142">You may be familiar with DDS files if you are a Direct3D developer.</span></span> <span data-ttu-id="f72ed-143">Обратите внимание, что Direct2D поддерживает только определенные функции DDS. Дополнительные сведения см. в разделе [требования к DDS](#dds-requirements).</span><span class="sxs-lookup"><span data-stu-id="f72ed-143">Note that Direct2D only supports certain DDS features; for more information see [DDS Requirements](#dds-requirements).</span></span>

### <a name="advantages-of-block-compression"></a><span data-ttu-id="f72ed-144">Преимущества блочного сжатия</span><span class="sxs-lookup"><span data-stu-id="f72ed-144">Advantages of block compression</span></span>

<span data-ttu-id="f72ed-145">Блокировать сжатые форматы отличаются от распространенных форматов сжатия отраслевых изображений, таких как JPEG в форматах BC, изначально поддерживается современными графическими процессорами.</span><span class="sxs-lookup"><span data-stu-id="f72ed-145">Block compressed formats differ from common industry image compression formats such as JPEG in that BC formats are natively supported by modern GPUs.</span></span> <span data-ttu-id="f72ed-146">Это означает, что вы можете напрямую загрузить блочный сжатый образ на GPU без декодирования или распаковки.</span><span class="sxs-lookup"><span data-stu-id="f72ed-146">This means that you can directly load a block compressed image onto the GPU without any decoding or decompression.</span></span> <span data-ttu-id="f72ed-147">Форматы BC используют от 4 до 8 бит на пиксель в среднем; по сравнению с типичным несжатым точечным рисунком размером 32 бит на пиксель BGRA это приводит к экономии памяти с 75% до 87,5%.</span><span class="sxs-lookup"><span data-stu-id="f72ed-147">BC formats consume from 4 to 8 bits per pixel on average; when compared to a typical uncompressed 32 bit per pixel BGRA bitmap, this results in memory savings of 75% to 87.5%.</span></span> <span data-ttu-id="f72ed-148">Кроме того, поскольку отсутствует шаг декодирования, время загрузки изображения BC значительно сокращается по сравнению с форматами, такими как JPEG.</span><span class="sxs-lookup"><span data-stu-id="f72ed-148">Also, because there is no decode step, the time to load a BC image is significantly reduced compared to formats like JPEG.</span></span>

### <a name="when-to-use-block-compression"></a><span data-ttu-id="f72ed-149">Когда следует использовать блочное сжатие</span><span class="sxs-lookup"><span data-stu-id="f72ed-149">When to use Block Compression</span></span>

<span data-ttu-id="f72ed-150">Следует рассмотреть возможность использования блочных сжатых изображений в приложении, а не других форматов, таких как JPEG, если требуется уменьшить использование памяти точечных рисунков или уменьшить время декодирования и загрузки.</span><span class="sxs-lookup"><span data-stu-id="f72ed-150">You should consider using block compressed images in your app instead of other formats such as JPEG if you want to reduce the memory consumption of bitmaps or want to reduce decode and load times.</span></span>

<span data-ttu-id="f72ed-151">Однако блочное сжатие не подходит для всех случаев и требует некоторых компромиссов.</span><span class="sxs-lookup"><span data-stu-id="f72ed-151">However, block compression is not appropriate for all cases and requires some tradeoffs.</span></span> <span data-ttu-id="f72ed-152">Во первых, алгоритмы сжатия блока теряются.</span><span class="sxs-lookup"><span data-stu-id="f72ed-152">First, the block compression algorithms are lossy.</span></span> <span data-ttu-id="f72ed-153">Блочное сжатие хорошо работает с естественным фотоизображением, но может добавлять нежелательные визуальные артефакты в изображения с четкими, высококонтрастными границами, такими как снимки экрана, созданные на компьютере.</span><span class="sxs-lookup"><span data-stu-id="f72ed-153">Block compression works well with natural photographic content but can introduce unwanted visual artifacts into images with sharp, high contrast boundaries, such as computer-generated screenshots.</span></span> <span data-ttu-id="f72ed-154">Прежде чем использовать ресурсы блочного образа, убедитесь, что они имеют приемлемое качество изображения.</span><span class="sxs-lookup"><span data-stu-id="f72ed-154">You should ensure that your block compressed image assets have acceptable image quality before using them.</span></span>

<span data-ttu-id="f72ed-155">Во-вторых, блочные сжатые файлы DDS обычно потребляют больше места на диске, чем сравниваемые изображения JPEG.</span><span class="sxs-lookup"><span data-stu-id="f72ed-155">Second, block compressed DDS files generally consume more space on disk than comparable JPEG images.</span></span> <span data-ttu-id="f72ed-156">Это, в свою очередь, увеличит размер пакета приложения и требования к пропускной способности сети.</span><span class="sxs-lookup"><span data-stu-id="f72ed-156">This in turn will increase your app’s package size and network bandwidth requirements.</span></span>

## <a name="using-block-compression"></a><span data-ttu-id="f72ed-157">Использование блочного сжатия</span><span class="sxs-lookup"><span data-stu-id="f72ed-157">Using Block Compression</span></span>

<span data-ttu-id="f72ed-158">В этом разделе объясняется, как создавать и использовать блочные сжатые ресурсы в приложении Direct2D.</span><span class="sxs-lookup"><span data-stu-id="f72ed-158">This section explains how to generate and use block compressed assets in a Direct2D app.</span></span>

### <a name="overview"></a><span data-ttu-id="f72ed-159">Обзор</span><span class="sxs-lookup"><span data-stu-id="f72ed-159">Overview</span></span>

<span data-ttu-id="f72ed-160">Блокировать сжатые файлы DDS — это оптимизированный для среды выполнения формат, что означает, что они оптимизированы для обеспечения хорошей производительности во время выполнения приложения.</span><span class="sxs-lookup"><span data-stu-id="f72ed-160">Block compressed DDS files are a runtime-optimized format, meaning that they are specifically optimized for good performance at app runtime.</span></span> <span data-ttu-id="f72ed-161">Рекомендуется продолжать использовать существующий конвейер создания и изменения ресурсов и преобразовывать его в сжатый формат без блокировки при импорте в проект приложения или во время сборки.</span><span class="sxs-lookup"><span data-stu-id="f72ed-161">We recommend that you continue to use your existing asset creation and editing pipeline, and only convert to a block compressed format when you import them into your application project, or at build time.</span></span>

### <a name="dds-requirements"></a><span data-ttu-id="f72ed-162">Требования к DDS</span><span class="sxs-lookup"><span data-stu-id="f72ed-162">DDS requirements</span></span>

<span data-ttu-id="f72ed-163">Формат файлов DDS был разработан для поддержки широкого спектра функций, используемых в Direct3D.</span><span class="sxs-lookup"><span data-stu-id="f72ed-163">The DDS file format was designed to support a wide range of features used in Direct3D.</span></span> <span data-ttu-id="f72ed-164">Direct2D использует только подмножество этих функций.</span><span class="sxs-lookup"><span data-stu-id="f72ed-164">Direct2D only uses a subset of these features.</span></span> <span data-ttu-id="f72ed-165">Поэтому при создании образов DDS для использования с Direct2D необходимо иметь в виду следующие ограничения.</span><span class="sxs-lookup"><span data-stu-id="f72ed-165">Therefore when you are creating DDS images for use with Direct2D, you must keep in mind the following restrictions:</span></span>

-   <span data-ttu-id="f72ed-166">Допускаются только следующие значения [**\_ формата DXGI**](/windows/desktop/api/dxgiformat/ne-dxgiformat-dxgi_format) :</span><span class="sxs-lookup"><span data-stu-id="f72ed-166">Only the following [**DXGI\_FORMAT**](/windows/desktop/api/dxgiformat/ne-dxgiformat-dxgi_format) values are allowed:</span></span>
    -   <span data-ttu-id="f72ed-167">\_Формат DXGI \_ BC1 \_ UNORM</span><span class="sxs-lookup"><span data-stu-id="f72ed-167">DXGI\_FORMAT\_BC1\_UNORM</span></span>
    -   <span data-ttu-id="f72ed-168">\_Формат DXGI \_ BC2 \_ UNORM</span><span class="sxs-lookup"><span data-stu-id="f72ed-168">DXGI\_FORMAT\_BC2\_UNORM</span></span>
    -   <span data-ttu-id="f72ed-169">\_Формат DXGI \_ BC3 \_ UNORM</span><span class="sxs-lookup"><span data-stu-id="f72ed-169">DXGI\_FORMAT\_BC3\_UNORM</span></span>
-   <span data-ttu-id="f72ed-170">Необходимо использовать предварительно умноженные альфа-данные.</span><span class="sxs-lookup"><span data-stu-id="f72ed-170">Premultiplied alpha data must be used.</span></span> <span data-ttu-id="f72ed-171">К ним относятся устаревшие файлы DDS с использованием форматов, явно определяющих предварительно умноженные альфа-каналы (DXT1, DXT2, DXT4), а также файлы DDS, которые используют \_ структуру заголовков содержимым DX10 в режиме альфа Alpha, \_ \_ \_ \_ непрозрачные и DDS в \_ режиме альфа Alpha \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="f72ed-171">This includes legacy DDS files using formats that explicitly define premultiplied alpha (DXT1, DXT2, DXT4), as well as DDS files that use the DDS\_HEADER\_DX10 structure with the DDS\_ALPHA\_MODE\_OPAQUE and DDS\_ALPHA\_MODE\_PREMULTIPLIED values.</span></span>
-   <span data-ttu-id="f72ed-172">Размеры X и Y должны быть кратны 4 пикселям.</span><span class="sxs-lookup"><span data-stu-id="f72ed-172">The X and Y dimensions must be multiples of 4 pixels.</span></span>
-   <span data-ttu-id="f72ed-173">Текстуры тома, кубемапс, MIP-карты или текстурные массивы не допускаются.</span><span class="sxs-lookup"><span data-stu-id="f72ed-173">Volume textures, cubemaps, mipmaps, or texture arrays are not allowed.</span></span> <span data-ttu-id="f72ed-174">Следует использовать только исходные изображения с одним кадром.</span><span class="sxs-lookup"><span data-stu-id="f72ed-174">You should only use single frame source images.</span></span>

### <a name="generating-block-compressed-assets"></a><span data-ttu-id="f72ed-175">Создание блочных сжатых ресурсов</span><span class="sxs-lookup"><span data-stu-id="f72ed-175">Generating Block Compressed assets</span></span>

<span data-ttu-id="f72ed-176">Существует множество средств разработки DDS, доступных для создания или преобразования блочных сжатых файлов DDS.</span><span class="sxs-lookup"><span data-stu-id="f72ed-176">There are a variety of DDS authoring tools available to create or convert block compressed DDS files.</span></span> <span data-ttu-id="f72ed-177">Примечание. не все средства поддерживают требования к использованию файлов DDS с Direct2D, как описано в предыдущем разделе.</span><span class="sxs-lookup"><span data-stu-id="f72ed-177">Note not all tools support the requirements for using DDS files with Direct2D, as detailed in the previous section.</span></span>

<span data-ttu-id="f72ed-178">Начиная с Visual Studio 2013 можно использовать Visual Studio для преобразования существующих визуальных ресурсов, таких как JPEG и PNG, в правильный сжатый формат блока DDS в качестве автоматической части процесса сборки.</span><span class="sxs-lookup"><span data-stu-id="f72ed-178">Beginning with Visual Studio 2013, you can have Visual Studio convert existing visual assets such as JPEG and PNG to the correct DDS block compressed format as an automatic part of your build process.</span></span> <span data-ttu-id="f72ed-179">Это достигается с помощью этапа настраиваемой сборки задачи содержимого изображения.</span><span class="sxs-lookup"><span data-stu-id="f72ed-179">This is accomplished using the Image Content Task custom build step.</span></span>

<span data-ttu-id="f72ed-180">Сведения о том, как настроить это для проекта, см. в разделе [как экспортировать текстуру для использования с приложениями Direct2D или JavaScipt](/previous-versions/visualstudio/visual-studio-2013/dn392693(v=vs.120)).</span><span class="sxs-lookup"><span data-stu-id="f72ed-180">For information on how to set this up for your project, see: [How to: Export a Texture for Use with Direct2D or Javascipt Apps](/previous-versions/visualstudio/visual-studio-2013/dn392693(v=vs.120)).</span></span>

### <a name="direct2d-apis"></a><span data-ttu-id="f72ed-181">API-интерфейсы Direct2D</span><span class="sxs-lookup"><span data-stu-id="f72ed-181">Direct2D APIs</span></span>

<span data-ttu-id="f72ed-182">Direct2D обновляется в Windows 8.1 для поддержки следующих форматов пикселей:</span><span class="sxs-lookup"><span data-stu-id="f72ed-182">Direct2D is updated in Windows 8.1 to support the following pixel formats:</span></span>

-   <span data-ttu-id="f72ed-183">\_Формат DXGI \_ BC1 \_ UNORM</span><span class="sxs-lookup"><span data-stu-id="f72ed-183">DXGI\_FORMAT\_BC1\_UNORM</span></span>
-   <span data-ttu-id="f72ed-184">\_Формат DXGI \_ BC2 \_ UNORM</span><span class="sxs-lookup"><span data-stu-id="f72ed-184">DXGI\_FORMAT\_BC2\_UNORM</span></span>
-   <span data-ttu-id="f72ed-185">\_Формат DXGI \_ BC3 \_ UNORM</span><span class="sxs-lookup"><span data-stu-id="f72ed-185">DXGI\_FORMAT\_BC3\_UNORM</span></span>

<span data-ttu-id="f72ed-186">Для предыдущих форматов необходимо использовать предварительно умноженный альфа-канал.</span><span class="sxs-lookup"><span data-stu-id="f72ed-186">For the preceding formats, you must use premultiplied alpha.</span></span> <span data-ttu-id="f72ed-187">Кроме того, эти форматы допустимы только для использования в качестве источника, а не для целевого объекта.</span><span class="sxs-lookup"><span data-stu-id="f72ed-187">In addition, these formats are only valid for use as a source, not a target.</span></span> <span data-ttu-id="f72ed-188">Например, это означает, что можно создать точечный рисунок Direct2D с помощью BC1, но не контекста устройства.</span><span class="sxs-lookup"><span data-stu-id="f72ed-188">For example, this means that you can create a Direct2D bitmap using BC1, but not a device context.</span></span>

<span data-ttu-id="f72ed-189">Следующие методы обновляются в Windows 8.1 для поддержки форматов BC:</span><span class="sxs-lookup"><span data-stu-id="f72ed-189">The following methods are updated in Windows 8.1 to support BC formats:</span></span>

-   [<span data-ttu-id="f72ed-190">**ID2D1DeviceContext:: Исдксгиформатсуппортед**</span><span class="sxs-lookup"><span data-stu-id="f72ed-190">**ID2D1DeviceContext::IsDxgiFormatSupported**</span></span>](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-isdxgiformatsupported)
-   <span data-ttu-id="f72ed-191">[**ID2D1DeviceContext:: Креатебитмап**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-createbitmap(d2d1_size_u_constvoid_uint32_constd2d1_bitmap_properties1__id2d1bitmap1))</span><span class="sxs-lookup"><span data-stu-id="f72ed-191">[**ID2D1DeviceContext::CreateBitmap**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-createbitmap(d2d1_size_u_constvoid_uint32_constd2d1_bitmap_properties1__id2d1bitmap1))</span></span>
-   <span data-ttu-id="f72ed-192">[**ID2D1DeviceContext:: Креатебитмапфромдксгисурфаце**](/windows/desktop/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-createbitmapfromdxgisurface(idxgisurface_constd2d1_bitmap_properties1__id2d1bitmap1))</span><span class="sxs-lookup"><span data-stu-id="f72ed-192">[**ID2D1DeviceContext::CreateBitmapFromDxgiSurface**](/windows/desktop/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-createbitmapfromdxgisurface(idxgisurface_constd2d1_bitmap_properties1__id2d1bitmap1))</span></span>
-   [<span data-ttu-id="f72ed-193">**ID2D1RenderTarget:: Креатешаредбитмап**</span><span class="sxs-lookup"><span data-stu-id="f72ed-193">**ID2D1RenderTarget::CreateSharedBitmap**</span></span>](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-createsharedbitmap)
-   [<span data-ttu-id="f72ed-194">**ID2D1RenderTarget:: Креатебитмапфромвикбитмап**</span><span class="sxs-lookup"><span data-stu-id="f72ed-194">**ID2D1RenderTarget::CreateBitmapFromWicBitmap**</span></span>](id2d1rendertarget-createbitmapfromwicbitmap.md)
-   [<span data-ttu-id="f72ed-195">**ID2D1Bitmap:: Копифроммемори**</span><span class="sxs-lookup"><span data-stu-id="f72ed-195">**ID2D1Bitmap::CopyFromMemory**</span></span>](/windows/win32/api/d2d1/nf-d2d1-id2d1bitmap-copyfrommemory)
-   [<span data-ttu-id="f72ed-196">**ID2D1Bitmap:: Копифромбитмап**</span><span class="sxs-lookup"><span data-stu-id="f72ed-196">**ID2D1Bitmap::CopyFromBitmap**</span></span>](/windows/win32/api/d2d1/nf-d2d1-id2d1bitmap-copyfrombitmap)
-   [<span data-ttu-id="f72ed-197">**ID2D1Bitmap1::**</span><span class="sxs-lookup"><span data-stu-id="f72ed-197">**ID2D1Bitmap1::GetSurface**</span></span>](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1bitmap1-getsurface)

<span data-ttu-id="f72ed-198">Обратите внимание, что [**креатебитмапфромвикбитмап**](id2d1devicecontext-createbitmapfromwicbitmap-overload.md) принимает [**IWICBitmapSource**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapsource) в качестве интерфейса. Однако в Windows 8.1 WIC не поддерживает получение блочных сжатых данных от **IWICBitmapSource**, и отсутствует формат пикселей WIC, соответствующий \_ формату DXGI \_ BC1 \_ UNORM и т. д. Вместо этого **креатебитмапфромвикбитмап** определяет, является ли **IWICBitmapSource** допустимым [**IWICBitmapFrameDecode**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapframedecode) DDS, и напрямую загружает сжатые данные блока.</span><span class="sxs-lookup"><span data-stu-id="f72ed-198">Note that [**CreateBitmapFromWicBitmap**](id2d1devicecontext-createbitmapfromwicbitmap-overload.md) takes [**IWICBitmapSource**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapsource) as an interface; however in Windows 8.1 WIC does not support obtaining block compressed data from **IWICBitmapSource**, and there is no WIC pixel format corresponding to DXGI\_FORMAT\_BC1\_UNORM, etc. Instead, **CreateBitmapFromWicBitmap** determines if the **IWICBitmapSource** is a valid DDS [**IWICBitmapFrameDecode**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapframedecode) and directly loads the block compressed data.</span></span> <span data-ttu-id="f72ed-199">Можно либо явно указать формат пикселей в структуре [**D2D1 \_ Bitmap \_ PROPERTIES1**](/windows/desktop/api/D2D1_1/ns-d2d1_1-d2d1_bitmap_properties1) , либо разрешить Direct2D автоматически определить правильный формат.</span><span class="sxs-lookup"><span data-stu-id="f72ed-199">You can either explicitly specify the pixel format in the [**D2D1\_BITMAP\_PROPERTIES1**](/windows/desktop/api/D2D1_1/ns-d2d1_1-d2d1_bitmap_properties1) struct, or allow Direct2D to automatically determine the correct format.</span></span>

### <a name="windows-imaging-component-apis"></a><span data-ttu-id="f72ed-200">API компонентов работы с образами Windows</span><span class="sxs-lookup"><span data-stu-id="f72ed-200">Windows Imaging Component APIs</span></span>

<span data-ttu-id="f72ed-201">Компонент Windows Imaging Component (WIC) добавляет новый кодек DDS в Windows 8.1.</span><span class="sxs-lookup"><span data-stu-id="f72ed-201">The Windows Imaging Component (WIC) adds a new DDS codec in Windows 8.1.</span></span> <span data-ttu-id="f72ed-202">Кроме того, он добавляет новые интерфейсы, поддерживающие доступ к данным DDS, включая блокирование сжатых данных пикселей.</span><span class="sxs-lookup"><span data-stu-id="f72ed-202">In addition, it adds new interfaces that support accessing DDS-specific data, including block compressed pixel data:</span></span>

-   [<span data-ttu-id="f72ed-203">**ивикддсдекодер**</span><span class="sxs-lookup"><span data-stu-id="f72ed-203">**IWICDdsDecoder**</span></span>](/windows/desktop/api/wincodec/nn-wincodec-iwicddsdecoder)
-   [<span data-ttu-id="f72ed-204">**ивикддсенкодер**</span><span class="sxs-lookup"><span data-stu-id="f72ed-204">**IWICDdsEncoder**</span></span>](/windows/desktop/api/wincodec/nn-wincodec-iwicddsencoder)
-   [<span data-ttu-id="f72ed-205">**ивикддсфрамедекоде**</span><span class="sxs-lookup"><span data-stu-id="f72ed-205">**IWICDdsFrameDecode**</span></span>](/windows/desktop/api/wincodec/nn-wincodec-iwicddsframedecode)

### <a name="block-compressed-wic-pixel-formats"></a><span data-ttu-id="f72ed-206">Блокировать сжатые форматы пикселей WIC</span><span class="sxs-lookup"><span data-stu-id="f72ed-206">Block Compressed WIC pixel formats</span></span>

<span data-ttu-id="f72ed-207">В Windows 8.1 нет новых сжатых форматов пикселей с блоком WIC.</span><span class="sxs-lookup"><span data-stu-id="f72ed-207">There are no new WIC block compressed pixel formats in Windows 8.1.</span></span> <span data-ttu-id="f72ed-208">Вместо этого, если вы получаете [**IWICBitmapFrameDecode**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapframedecode) из декодера DDS и вызовите [**CopyPixels**](/windows/desktop/api/wincodec/nf-wincodec-iwicbitmapsource-copypixels), вы получите стандартные несжатые Пиксели, такие как WICPixelFormat32bppPBGRA.</span><span class="sxs-lookup"><span data-stu-id="f72ed-208">Instead, if you obtain an [**IWICBitmapFrameDecode**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapframedecode) from the DDS decoder and call [**CopyPixels**](/windows/desktop/api/wincodec/nf-wincodec-iwicbitmapsource-copypixels), you will receive standard uncompressed pixels such as WICPixelFormat32bppPBGRA.</span></span> <span data-ttu-id="f72ed-209">[**Ивикддсфрамедекоде:: копиблоккс**](/windows/desktop/api/wincodec/nf-wincodec-iwicddsframedecode-copyblocks) можно использовать для получения необработанных блочных данных в виде буфера памяти из файла DDS.</span><span class="sxs-lookup"><span data-stu-id="f72ed-209">You can use [**IWICDdsFrameDecode::CopyBlocks**](/windows/desktop/api/wincodec/nf-wincodec-iwicddsframedecode-copyblocks) to obtain the raw block compressed data in the form of a memory buffer from a DDS file.</span></span>

### <a name="multi-frame-dds-access"></a><span data-ttu-id="f72ed-210">Доступ к DDS с несколькими кадрами</span><span class="sxs-lookup"><span data-stu-id="f72ed-210">Multi-frame DDS access</span></span>

<span data-ttu-id="f72ed-211">Формат файла DDS позволяет хранить несколько связанных образов в одном файле.</span><span class="sxs-lookup"><span data-stu-id="f72ed-211">The DDS file format allows for multiple related images to be stored in a single file.</span></span> <span data-ttu-id="f72ed-212">Например, файл DDS может содержать кубической карты, текстуру тома или массив текстур, каждый из которых может быть мипмаппед.</span><span class="sxs-lookup"><span data-stu-id="f72ed-212">For example, a DDS file may contain a cubemap, volume texture, or texture array, all of which can be mipmapped.</span></span> <span data-ttu-id="f72ed-213">В Direct3D эти несколько образов предоставляются как подресурсы.</span><span class="sxs-lookup"><span data-stu-id="f72ed-213">In Direct3D, these multiple images are exposed as subresources.</span></span> <span data-ttu-id="f72ed-214">В WIC несколько изображений предоставляются как кадры ([**IWICBitmapFrameDecode**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapframedecode) и [**ивикбитмапфраминкоде**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapframeencode)).</span><span class="sxs-lookup"><span data-stu-id="f72ed-214">In WIC, multiple images are exposed as frames ([**IWICBitmapFrameDecode**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapframedecode) and [**IWICBitmapFrameEncode**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapframeencode)).</span></span>

<span data-ttu-id="f72ed-215">WIC поддерживает только понятие одномерного массива кадров, в то время как DDS поддерживает три независимых измерения (хотя в одном файле могут использоваться только два).</span><span class="sxs-lookup"><span data-stu-id="f72ed-215">WIC only supports the notion of a single dimensional array of frames, while DDS supports three independent dimensions (although only two may be used in any one file).</span></span> <span data-ttu-id="f72ed-216">WIC предоставляет удобные методы для помощи при сопоставлении между подресурсом DDS и фреймом WIC.</span><span class="sxs-lookup"><span data-stu-id="f72ed-216">WIC provides convenience methods to assist with mapping between a DDS subresource and WIC frame.</span></span> <span data-ttu-id="f72ed-217">Для декодирования [**ивикддсдекодер:: noframes**](/windows/desktop/api/wincodec/nf-wincodec-iwicddsdecoder-getframe) позволяет указать индекс массива, MIP уровень и Индекс среза для подресурса и возвращает правильный кадр WIC.</span><span class="sxs-lookup"><span data-stu-id="f72ed-217">For decoding, [**IWICDdsDecoder::GetFrame**](/windows/desktop/api/wincodec/nf-wincodec-iwicddsdecoder-getframe) lets you specify the array index, mip level and slice index of the subresource, and returns the correct WIC frame.</span></span>

<span data-ttu-id="f72ed-218">Для кодировки [**ивикддсенкодер:: CreateNewFrame**](/windows/desktop/api/wincodec/nf-wincodec-iwicddsencoder-createnewframe) выполняет вычисление результирующего индекса массива, уровня MIP и индекса среза при создании нового кадра.</span><span class="sxs-lookup"><span data-stu-id="f72ed-218">For encoding, [**IWICDdsEncoder::CreateNewFrame**](/windows/desktop/api/wincodec/nf-wincodec-iwicddsencoder-createnewframe) computes the resulting array index, mip level and slice index when you create a new frame.</span></span> <span data-ttu-id="f72ed-219">Чтобы определить параметры файла, относящиеся к DDS, необходимо сначала вызвать метод [**ивикддсенкодер:: SetParameters**](/windows/desktop/api/wincodec/nf-wincodec-iwicddsencoder-setparameters) .</span><span class="sxs-lookup"><span data-stu-id="f72ed-219">You must have first called [**IWICDdsEncoder::SetParameters**](/windows/desktop/api/wincodec/nf-wincodec-iwicddsencoder-setparameters) to define the DDS-specific file parameters.</span></span>

## <a name="related-topics"></a><span data-ttu-id="f72ed-220">См. также</span><span class="sxs-lookup"><span data-stu-id="f72ed-220">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="f72ed-221">[Практическое руководство. Экспорт текстуры для использования с приложениями Direct2D или Javascipt](/previous-versions/visualstudio/visual-studio-2013/dn392693(v=vs.120))</span><span class="sxs-lookup"><span data-stu-id="f72ed-221">[How to: Export a Texture for Use with Direct2D or Javascipt Apps](/previous-versions/visualstudio/visual-studio-2013/dn392693(v=vs.120))</span></span>
</dt> <dt>

[<span data-ttu-id="f72ed-222">Справочник по DDS</span><span class="sxs-lookup"><span data-stu-id="f72ed-222">Reference for DDS</span></span>](/windows/desktop/direct3ddds/dx-graphics-dds-reference)
</dt> <dt>

[<span data-ttu-id="f72ed-223">Блочное сжатие</span><span class="sxs-lookup"><span data-stu-id="f72ed-223">Block Compression</span></span>](/windows/desktop/direct3d10/d3d10-graphics-programming-guide-resources-block-compression)
</dt> </dl>

 

 