---
title: Использование API сервера служб развертывания Windows
description: В средах, где стандартное решение служб развертывания Windows (WDS) использовать нельзя, сервер WDS предоставляет API, позволяющий разработчикам писать подключаемые модули, называемые поставщиками, для обработки запросов среды выполнения (PXE).
ms.assetid: 5e25654a-33c6-4c0f-acc3-e938d1f4a4e7
keywords:
- Службы развертывания Windows в службах IIS, использующие API сервера
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d3634dffa73eddc9b5db92be6bc807cccbc5248f
ms.sourcegitcommit: c2a1c4314550ea9bd202d28adfcc7bfe6180932f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2020
ms.locfileid: "103789342"
---
# <a name="using-the-windows-deployment-services-server-api"></a><span data-ttu-id="fd630-104">Использование API сервера служб развертывания Windows</span><span class="sxs-lookup"><span data-stu-id="fd630-104">Using the Windows Deployment Services Server API</span></span>

<span data-ttu-id="fd630-105">В средах, где стандартное решение служб развертывания Windows (WDS) использовать нельзя, сервер WDS предоставляет API, позволяющий разработчикам писать подключаемые модули, называемые поставщиками, для обработки запросов среды выполнения (PXE).</span><span class="sxs-lookup"><span data-stu-id="fd630-105">In environments where the standard Windows Deployment Services (WDS) solution cannot be used, the WDS server exposes an API that enables developers to write plug-ins, referred to as providers, to handle preboot execution environment (PXE) requests.</span></span> <span data-ttu-id="fd630-106">При написании поставщиков PXE для WDS разработчики должны соблюдать следующие рекомендации.</span><span class="sxs-lookup"><span data-stu-id="fd630-106">Developers should adhere to the following guidelines when writing PXE providers for WDS.</span></span>

## <a name="install-the-wds-role-on-the-server"></a><span data-ttu-id="fd630-107">Установка роли WDS на сервере</span><span class="sxs-lookup"><span data-stu-id="fd630-107">Install the WDS Role on the Server</span></span>

-   <span data-ttu-id="fd630-108">Службы развертывания Windows (WDS) — это пересмотренная версия служб удаленной установки (RIS). для реализации PXE-сервера и поставщиков WDS потребуется роль сервера WDS.</span><span class="sxs-lookup"><span data-stu-id="fd630-108">Windows Deployment Services (WDS) is the revised version of Remote Installation Services (RIS), you will need the WDS server role to implement the WDS PXE server and providers.</span></span>
-   <span data-ttu-id="fd630-109">WDS заменяет службу RIS стандартным компонентом, начиная с Windows Server 2008 и Windows Server 2003 с пакетом обновления 2 (SP2).</span><span class="sxs-lookup"><span data-stu-id="fd630-109">WDS replaces RIS as the standard component starting with Windows Server 2008 and Windows Server 2003 with Service Pack 2 (SP2).</span></span>
-   <span data-ttu-id="fd630-110">Необходимо обновить сервер RIS до WDS на Windows Server 2003 с пакетом обновления 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="fd630-110">You must update the RIS server to WDS on Windows Server 2003 with Service Pack 1 (SP1).</span></span> <span data-ttu-id="fd630-111">Роль сервера WDS можно установить с помощью [пакет автоматической установки Windows (WAIK)](https://www.microsoft.com/download/details.aspx?id=10333).</span><span class="sxs-lookup"><span data-stu-id="fd630-111">You can install the WDS server role with the [Windows Automated Installation Kit (WAIK)](https://www.microsoft.com/download/details.aspx?id=10333).</span></span>

## <a name="register-providers"></a><span data-ttu-id="fd630-112">Регистрация поставщиков</span><span class="sxs-lookup"><span data-stu-id="fd630-112">Register Providers</span></span>

-   <span data-ttu-id="fd630-113">Зарегистрируйте библиотеку динамической компоновки (DLL) поставщика во время установки и вставьте поставщик в упорядоченный список зарегистрированных поставщиков.</span><span class="sxs-lookup"><span data-stu-id="fd630-113">Register the provider dynamic-link library (DLL) during its installation and insert the provider into the ordered list of registered providers.</span></span>
    > [!Note]  
    > <span data-ttu-id="fd630-114">При установке нового или измененного поставщика необходимо перезапустить службу PXE WDS, чтобы изменения вступили в силу.</span><span class="sxs-lookup"><span data-stu-id="fd630-114">When you install a new or modified provider, you will need to restart WDS PXE service for the changes to take effect.</span></span>

     

-   <span data-ttu-id="fd630-115">Используйте функцию [**пксепровидеррегистер**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderregister) для регистрации поставщика и его добавления в список.</span><span class="sxs-lookup"><span data-stu-id="fd630-115">Use the [**PxeProviderRegister**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderregister) function to register the provider and add it to the list.</span></span> <span data-ttu-id="fd630-116">Используйте функцию [**пксепровидерунрегистер**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderunregister) , чтобы отменить регистрацию зарегистрированного поставщика и удалить его из списка.</span><span class="sxs-lookup"><span data-stu-id="fd630-116">Use the [**PxeProviderUnRegister**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderunregister) function to unregister a registered provider and remove it from the list.</span></span>
-   <span data-ttu-id="fd630-117">Укажите последовательность поставщика в упорядоченном списке.</span><span class="sxs-lookup"><span data-stu-id="fd630-117">Specify the sequence of the provider in the ordered list.</span></span> <span data-ttu-id="fd630-118">Индекс поставщика в списке не может быть гарантирован, так как после этого другой поставщик может быть зарегистрирован.</span><span class="sxs-lookup"><span data-stu-id="fd630-118">The index of a provider in the list cannot be guaranteed because another provider may later be registered before it.</span></span> <span data-ttu-id="fd630-119">Чтобы вставить поставщик в список до или после другого зарегистрированного поставщика, сначала используйте функцию [**пксепровидеркуериндекс**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderqueryindex) для получения индекса зарегистрированного поставщика, а затем зарегистрируйте новый поставщик при указании большего или меньшего значения индекса.</span><span class="sxs-lookup"><span data-stu-id="fd630-119">To insert the provider in the list before or after another registered provider, first use the [**PxeProviderQueryIndex**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderqueryindex) function to get the index of the registered provider and then register the new provider while specifying a larger or smaller index value.</span></span>
-   <span data-ttu-id="fd630-120">Установка может хранить сведения о конфигурации поставщика в разделе реестра, возвращенном при регистрации поставщика.</span><span class="sxs-lookup"><span data-stu-id="fd630-120">The installation can store provider configuration information under the registry key returned when the provider is registered.</span></span> <span data-ttu-id="fd630-121">Адрес раздела реестра получен с помощью *Фпровидеркэй* [**пксепровидеррегистер**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderregister).</span><span class="sxs-lookup"><span data-stu-id="fd630-121">The address of the registry key is received by the *phProviderKey* of [**PxeProviderRegister**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderregister).</span></span> <span data-ttu-id="fd630-122">Поставщик получает маркер того же ключа, что и параметр *хпровидеркэй* , в его обратный вызов [*пксепровидеринитиализе*](pxeproviderinitialize.md) .</span><span class="sxs-lookup"><span data-stu-id="fd630-122">The provider receives a handle to this same key as the *hProviderKey* parameter to its [*PxeProviderInitialize*](pxeproviderinitialize.md) callback.</span></span> <span data-ttu-id="fd630-123">Поставщик должен хранить адрес этого ключа.</span><span class="sxs-lookup"><span data-stu-id="fd630-123">The provider should store the address of this key.</span></span>
-   <span data-ttu-id="fd630-124">Всегда устанавливайте библиотеку динамической компоновки (DLL) поставщика в папку Program Files сервера.</span><span class="sxs-lookup"><span data-stu-id="fd630-124">Always install the provider dynamic-link library (DLL) in the server's Program Files folder.</span></span>

## <a name="initialize"></a><span data-ttu-id="fd630-125">Инициализация</span><span class="sxs-lookup"><span data-stu-id="fd630-125">Initialize</span></span>

-   <span data-ttu-id="fd630-126">Включите библиотеку DLL, которая экспортирует функцию обратного вызова [*пксепровидеринитиализе*](pxeproviderinitialize.md) в поставщике.</span><span class="sxs-lookup"><span data-stu-id="fd630-126">Include a DLL that exports the [*PxeProviderInitialize*](pxeproviderinitialize.md) callback function in the provider.</span></span> <span data-ttu-id="fd630-127">Каждому поставщику требуется обратный вызов *пксепровидеринитиализе* .</span><span class="sxs-lookup"><span data-stu-id="fd630-127">Every provider requires a *PxeProviderInitialize* callback.</span></span> <span data-ttu-id="fd630-128">Когда служба WDS загружает поставщик, она вызывает функцию *пксепровидеринитиализе* поставщика и передает маркер тому же ключу, который используется для хранения сведений о конфигурации во время регистрации поставщика.</span><span class="sxs-lookup"><span data-stu-id="fd630-128">When WDS loads a provider, it calls the provider's *PxeProviderInitialize* function and passes a handle to the same key that is used to store configuration information during provider registration.</span></span>
-   <span data-ttu-id="fd630-129">Когда обратный вызов [*пксепровидеринитиализе*](pxeproviderinitialize.md) возвращает и завершается успешно, поставщик должен быть полностью инициализирован и готов к обработке запросов.</span><span class="sxs-lookup"><span data-stu-id="fd630-129">When the [*PxeProviderInitialize*](pxeproviderinitialize.md) callback returns and is successful, the provider should be fully initialized and ready to process requests.</span></span>
-   <span data-ttu-id="fd630-130">Регистрация каждого обратного вызова в поставщике во время обработки функции [*пксепровидеринитиализе*](pxeproviderinitialize.md) .</span><span class="sxs-lookup"><span data-stu-id="fd630-130">Register every callback in the provider during the processing of the [*PxeProviderInitialize*](pxeproviderinitialize.md) function.</span></span> <span data-ttu-id="fd630-131">Обратные вызовы должны быть зарегистрированы с помощью функции [**пксерегистеркаллбакк**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeregistercallback) .</span><span class="sxs-lookup"><span data-stu-id="fd630-131">Callbacks should be registered with the [**PxeRegisterCallback**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeregistercallback) function.</span></span>
-   <span data-ttu-id="fd630-132">Инициализируйте все внутренние ресурсы поставщика в процессе обработки своей функции [*пксепровидеринитиализе*](pxeproviderinitialize.md) .</span><span class="sxs-lookup"><span data-stu-id="fd630-132">Initialize all the provider's internal resources within the processing of its [*PxeProviderInitialize*](pxeproviderinitialize.md) function.</span></span>

## <a name="shutdown"></a><span data-ttu-id="fd630-133">Завершить работу</span><span class="sxs-lookup"><span data-stu-id="fd630-133">Shutdown</span></span>

-   <span data-ttu-id="fd630-134">Реализуйте обратный вызов [*пксепровидершутдовн*](pxeprovidershutdown.md) .</span><span class="sxs-lookup"><span data-stu-id="fd630-134">Implement the [*PxeProviderShutdown*](pxeprovidershutdown.md) callback.</span></span> <span data-ttu-id="fd630-135">Каждый поставщик должен иметь обратный вызов *пксепровидершутдовн*.</span><span class="sxs-lookup"><span data-stu-id="fd630-135">Every provider is required to have a *PxeProviderShutdown* callback.</span></span>
-   <span data-ttu-id="fd630-136">Функция обратного вызова [*пксепровидершутдовн*](pxeprovidershutdown.md) должна полностью завершить работу поставщика и освободить все его ресурсы.</span><span class="sxs-lookup"><span data-stu-id="fd630-136">The [*PxeProviderShutdown*](pxeprovidershutdown.md) callback function should fully shut down the provider and release all its resources.</span></span>
-   <span data-ttu-id="fd630-137">После возврата обратного вызова [*пксепровидершутдовн*](pxeprovidershutdown.md) в функцию [*пксепровидеринитиализе*](pxeproviderinitialize.md) передается обработчик *хпровидер* , который не должен использоваться для вызова WDS.</span><span class="sxs-lookup"><span data-stu-id="fd630-137">After the [*PxeProviderShutdown*](pxeprovidershutdown.md) callback returns, the *hProvider* handle passed to the [*PxeProviderInitialize*](pxeproviderinitialize.md) function is no longer valid and should not be used to call WDS.</span></span>
-   <span data-ttu-id="fd630-138">Зарегистрируйте обратный вызов [*пксепровидершутдовн*](pxeprovidershutdown.md) , вызвав функцию [**пксерегистеркаллбакк**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeregistercallback) с **\_ \_ завершением обратного вызова PXE** во время обработки обратного вызова [*пксепровидеринитиализе*](pxeproviderinitialize.md) .</span><span class="sxs-lookup"><span data-stu-id="fd630-138">Register the [*PxeProviderShutdown*](pxeprovidershutdown.md) callback by calling the [**PxeRegisterCallback**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeregistercallback) function with **PXE\_CALLBACK\_SHUTDOWN** during the processing of the [*PxeProviderInitialize*](pxeproviderinitialize.md) callback.</span></span> <span data-ttu-id="fd630-139">Не вызывайте обратный вызов *пксепровидершутдовн* в случае сбоя функции *пксепровидеринитиализе* .</span><span class="sxs-lookup"><span data-stu-id="fd630-139">Do not call the *PxeProviderShutdown* callback if the *PxeProviderInitialize* function fails.</span></span>

## <a name="handle-request-packet"></a><span data-ttu-id="fd630-140">Обработайте пакет запроса</span><span class="sxs-lookup"><span data-stu-id="fd630-140">Handle Request Packet</span></span>

<span data-ttu-id="fd630-141">Реализуйте обратный вызов [*пксепровидеррекврекуест*](pxeproviderrecvrequest.md) для поставщика.</span><span class="sxs-lookup"><span data-stu-id="fd630-141">Implement the [*PxeProviderRecvRequest*](pxeproviderrecvrequest.md) callback for the provider.</span></span> <span data-ttu-id="fd630-142">Каждый поставщик должен иметь обратный вызов *пксепровидеррекврекуест* .</span><span class="sxs-lookup"><span data-stu-id="fd630-142">Every provider is required to have a *PxeProviderRecvRequest* callback.</span></span> <span data-ttu-id="fd630-143">Когда WDS получает запрос, он вызывает обратный вызов *пксепровидеррекврекуест* для первого поставщика в списке зарегистрированных поставщиков.</span><span class="sxs-lookup"><span data-stu-id="fd630-143">When WDS receives a request, it calls the *PxeProviderRecvRequest* callback for the first provider in the registered provider list.</span></span>

-   <span data-ttu-id="fd630-144">Если поставщик будет обрабатывать этот запрос синхронно, функция [*пксепровидеррекврекуест*](pxeproviderrecvrequest.md) должна возвращать значение **ошибки \_ Success**.</span><span class="sxs-lookup"><span data-stu-id="fd630-144">If the provider will process this request synchronously, the [*PxeProviderRecvRequest*](pxeproviderrecvrequest.md) function should return a value of **ERROR\_SUCCESS**.</span></span> <span data-ttu-id="fd630-145">Если и только в том случае, если поставщик будет обрабатывать этот запрос асинхронно, обратный вызов *пксепровидеррекврекуест* должен возвратить **ошибку \_ ввода-вывода \_ в ожидании** и вызвать функцию [**пксеасинкреквдоне**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeasyncrecvdone) при обработке запроса.</span><span class="sxs-lookup"><span data-stu-id="fd630-145">If and only if the provider will process this request asynchronously, the *PxeProviderRecvRequest* callback should return **ERROR\_IO\_PENDING** and call the [**PxeAsyncRecvDone**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeasyncrecvdone) function when the request has been processed.</span></span>
-   <span data-ttu-id="fd630-146">Обратный вызов [*пксепровидеррекврекуест*](pxeproviderrecvrequest.md) и функция [**пксеасинкреквдоне**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeasyncrecvdone) возвращают адрес перечисления PXE для **\_ \_ операции загрузки** , описывающий действие, выполняемое поставщиком для выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="fd630-146">The [*PxeProviderRecvRequest*](pxeproviderrecvrequest.md) callback and the [**PxeAsyncRecvDone**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeasyncrecvdone) function returns the address of a **PXE\_BOOT\_ACTION** enum that describes the action taken by the provider to handle the request.</span></span>

    <span data-ttu-id="fd630-147">Существует четыре способа, с помощью которых поставщик обрабатывает запрос:</span><span class="sxs-lookup"><span data-stu-id="fd630-147">There are four ways for a provider to handle a request:</span></span>

    -   <span data-ttu-id="fd630-148">Поставщик отвечает на клиент с помощью стандартного пакета ответа DHCP, который содержит путь к программе сетевой загрузки.</span><span class="sxs-lookup"><span data-stu-id="fd630-148">The provider replies to the client with a standard DHCP response packet that contains a path to the Network Boot Program.</span></span> <span data-ttu-id="fd630-149">Возврат значения **\_ \_ NBP для протокола PXE** для перечисления означает, что поставщик успешно обработал пакет запроса и выполнил запрос, отправив ответный пакет, вызвав функции [**пксепаккеталлокате**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketallocate) и [**пксесендрепли**](/windows/win32/api/WdsPxe/nf-wdspxe-pxesendreply) .</span><span class="sxs-lookup"><span data-stu-id="fd630-149">Returning the **PXE\_BA\_NBP** value for the enum means that the provider has successfully processed the request packet and completed the request by sending a response packet by calling the [**PxePacketAllocate**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketallocate) and [**PxeSendReply**](/windows/win32/api/WdsPxe/nf-wdspxe-pxesendreply) functions.</span></span>
    -   <span data-ttu-id="fd630-150">Поставщик отвечает на клиент с пользовательским пакетом ответа, который не соответствует DHCP.</span><span class="sxs-lookup"><span data-stu-id="fd630-150">The provider replies to the client with a custom response packet that does not conform to DHCP.</span></span> <span data-ttu-id="fd630-151">Возвращение **\_ \_ настраиваемого** значения для типа PXE Ба для перечисления означает, что поставщик успешно обработал пакет запроса и выполнил запрос, отправив пользовательский пакет ответа путем вызова функций [**пксепаккеталлокате**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketallocate) и [**пксесендрепли**](/windows/win32/api/WdsPxe/nf-wdspxe-pxesendreply) .</span><span class="sxs-lookup"><span data-stu-id="fd630-151">Returning the **PXE\_BA\_CUSTOM** value for the enum means that the provider has successfully processed the request packet and completed the request by sending a custom response packet by calling the [**PxePacketAllocate**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketallocate) and [**PxeSendReply**](/windows/win32/api/WdsPxe/nf-wdspxe-pxesendreply) functions.</span></span>
    -   <span data-ttu-id="fd630-152">Поставщик определяет, что запрос следует игнорировать.</span><span class="sxs-lookup"><span data-stu-id="fd630-152">The provider determines the request should be ignored.</span></span> <span data-ttu-id="fd630-153">Возврат значения **\_ \_ игнорирования протокола PXE Ба** для перечисления означает, что поставщик освободил все ресурсы, связанные с запросом, и запрос не передается следующему поставщику в списке зарегистрированных поставщиков.</span><span class="sxs-lookup"><span data-stu-id="fd630-153">Returning the **PXE\_BA\_IGNORE** value for the enum means the provider has released all resources associated with the request and the request is not passed to the next provider in the list of registered providers.</span></span> <span data-ttu-id="fd630-154">Поставщики могут использовать этот параметр, если обнаруживают, что пакет запроса является недопустимым.</span><span class="sxs-lookup"><span data-stu-id="fd630-154">Providers may use this option if they detect that a request packet is invalid.</span></span>
    -   <span data-ttu-id="fd630-155">Поставщик отклоняет обслуживание запроса.</span><span class="sxs-lookup"><span data-stu-id="fd630-155">The provider declines to service the request.</span></span> <span data-ttu-id="fd630-156">Возврат значения **\_ \_ отклонения протокола PXE Ба** для перечисления дает системе команду передать запрос следующему поставщику в списке зарегистрированных поставщиков.</span><span class="sxs-lookup"><span data-stu-id="fd630-156">Returning the **PXE\_BA\_REJECT** value for the enum instructs the system to pass the request to the next provider in the list of registered providers.</span></span> <span data-ttu-id="fd630-157">Если это последний поставщик в списке, то освобождает все ресурсы, связанные с запросом, и запрос игнорируется.</span><span class="sxs-lookup"><span data-stu-id="fd630-157">If this were the last provider in the list, this releases all resources associated with the request and the request is ignored.</span></span>
    -   <span data-ttu-id="fd630-158">Зарегистрируйте обратный вызов [*пксепровидеррекврекуест*](pxeproviderrecvrequest.md) , вызвав функцию [**пксерегистеркаллбакк**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeregistercallback) с **\_ \_ \_ запросом обратного вызова PXE** во время обработки обратного вызова [*пксепровидеринитиализе*](pxeproviderinitialize.md) .</span><span class="sxs-lookup"><span data-stu-id="fd630-158">Register the [*PxeProviderRecvRequest*](pxeproviderrecvrequest.md) callback by calling the [**PxeRegisterCallback**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeregistercallback) function with **PXE\_CALLBACK\_RECV\_REQUEST** during the processing of the [*PxeProviderInitialize*](pxeproviderinitialize.md) callback.</span></span>

## <a name="generate-response-packet"></a><span data-ttu-id="fd630-159">Создать ответный пакет</span><span class="sxs-lookup"><span data-stu-id="fd630-159">Generate Response Packet</span></span>

-   <span data-ttu-id="fd630-160">Используйте API для записи поставщиков на обработку запросов DHCP и создания пакетов ответа.</span><span class="sxs-lookup"><span data-stu-id="fd630-160">Use the API to write providers to handle DHCP request and generate response packets.</span></span>
-   <span data-ttu-id="fd630-161">Функция [**пксепровидерсетаттрибуте**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeprovidersetattribute) указывает атрибуты, используемые поставщиком для фильтрации пакетов.</span><span class="sxs-lookup"><span data-stu-id="fd630-161">The [**PxeProviderSetAttribute**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeprovidersetattribute) function specifies the attributes used by the provider to filter packets.</span></span> <span data-ttu-id="fd630-162">Можно указать атрибуты поставщика, чтобы поставщик мог видеть все пакеты, поставщик видит только пакеты DHCP, или поставщик видит только пакеты DHCP, в которых указан параметр идентификатора класса вендора DHCP (60) как "Пксеклиент".</span><span class="sxs-lookup"><span data-stu-id="fd630-162">The attributes of the provider can be specified so that the provider see all packets, the provider sees only DHCP packets, or the provider sees only DHCP packets that specify the DHCP Vendor Class Identifier option (60) as "PXEClient".</span></span>
-   <span data-ttu-id="fd630-163">Функция [**пкседхкписвалид**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpisvalid) проверяет, является ли пакет допустимым пакетом DHCP.</span><span class="sxs-lookup"><span data-stu-id="fd630-163">The [**PxeDhcpIsValid**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpisvalid) function checks that a packet is a valid DHCP packet.</span></span> <span data-ttu-id="fd630-164">Поставщики могут использовать функцию **пкседхкписвалид** для проверки того, является ли пакет клиентом DHCP-пакетом, если фильтр, заданный функцией [**пксепровидерсетаттрибуте**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeprovidersetattribute) , настроен на получение всех пакетов, чтобы определить, является ли указанный пакет допустимым пакетом DHCP.</span><span class="sxs-lookup"><span data-stu-id="fd630-164">Providers can use the **PxeDhcpIsValid** function to check whether a packet from the client is a DHCP packet when the filter set with the [**PxeProviderSetAttribute**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeprovidersetattribute) function is set to receive all packets to determine if a specified packet is a valid DHCP packet.</span></span>
-   <span data-ttu-id="fd630-165">Функция [**пкседхкпинитиализе**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpinitialize) инициализирует ответный пакет как пакет ответа DHCP, основанный на данных пакета, полученного от клиента.</span><span class="sxs-lookup"><span data-stu-id="fd630-165">The [**PxeDhcpInitialize**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpinitialize) function initializes a response packet as a DHCP reply packet that is based on the information in a packet received from the client.</span></span> <span data-ttu-id="fd630-166">Функция [*пксепровидеринитиализе*](pxeproviderinitialize.md) принимает адрес допустимого DHCP-пакета, полученного от клиента в ответном вызове [*пксепровидеррекврекуест*](pxeproviderrecvrequest.md) .</span><span class="sxs-lookup"><span data-stu-id="fd630-166">The [*PxeProviderInitialize*](pxeproviderinitialize.md) function takes the address of a valid DHCP packet received from the client in the [*PxeProviderRecvRequest*](pxeproviderrecvrequest.md) callback.</span></span> <span data-ttu-id="fd630-167">Функция **пкседхкпинитиализе** принимает указатель на ответный пакет, выделенный с помощью функции [**пксепаккеталлокате**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketallocate) .</span><span class="sxs-lookup"><span data-stu-id="fd630-167">The **PxeDhcpInitialize** function takes a pointer to a reply packet allocated with the [**PxePacketAllocate**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketallocate) function.</span></span>
-   <span data-ttu-id="fd630-168">Функция [**пкседхкпжетоптионвалуе**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpgetoptionvalue) извлекает значение параметра из пакета DHCP.</span><span class="sxs-lookup"><span data-stu-id="fd630-168">The [**PxeDhcpGetOptionValue**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpgetoptionvalue) function retrieves an option value from a DHCP packet.</span></span> <span data-ttu-id="fd630-169">Функция [**пкседхкпжетвендороптионвалуе**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpgetvendoroptionvalue) извлекает значение параметра из поля сведений о конкретном поставщике (43) пакета DHCP.</span><span class="sxs-lookup"><span data-stu-id="fd630-169">The [**PxeDhcpGetVendorOptionValue**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpgetvendoroptionvalue) function retrieves an option value from the Vendor Specific Information field (43) of a DHCP packet.</span></span>
-   <span data-ttu-id="fd630-170">Затем поставщик может заполнить ответный пакет информацией и использовать функцию [**пксесендрепли**](/windows/win32/api/WdsPxe/nf-wdspxe-pxesendreply) для отправки ответного пакета клиенту.</span><span class="sxs-lookup"><span data-stu-id="fd630-170">The provider can then populate the reply packet with information and use the [**PxeSendReply**](/windows/win32/api/WdsPxe/nf-wdspxe-pxesendreply) function to send the reply packet to the client.</span></span> <span data-ttu-id="fd630-171">Функция [**пкседхкпаппендоптион**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpappendoption) добавляет параметр DHCP в ответный пакет.</span><span class="sxs-lookup"><span data-stu-id="fd630-171">The [**PxeDhcpAppendOption**](/windows/win32/api/WdsPxe/nf-wdspxe-pxedhcpappendoption) function appends a DHCP option to the reply packet.</span></span>
-   <span data-ttu-id="fd630-172">Поставщик, отвечающий на клиентские запросы путем отправки пакета, должен выделить ответный пакет с помощью функции [**пксепаккеталлокате**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketallocate) .</span><span class="sxs-lookup"><span data-stu-id="fd630-172">A provider that replies to client requests by sending a packet must allocate the response packet using the [**PxePacketAllocate**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketallocate) function.</span></span> <span data-ttu-id="fd630-173">Затем поставщик может заполнить ответный пакет информацией и использовать функцию [**пксесендрепли**](/windows/win32/api/WdsPxe/nf-wdspxe-pxesendreply) для отправки ответного пакета клиенту.</span><span class="sxs-lookup"><span data-stu-id="fd630-173">The provider can then populate the reply packet with information and use the [**PxeSendReply**](/windows/win32/api/WdsPxe/nf-wdspxe-pxesendreply) function to send the reply packet to the client.</span></span>
-   <span data-ttu-id="fd630-174">Если выделенная память больше не нужна, поставщик должен освободить его с помощью функции [**пксепаккетфри**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketfree) .</span><span class="sxs-lookup"><span data-stu-id="fd630-174">When the allocated memory is no longer needed, the provider should release it using the [**PxePacketFree**](/windows/win32/api/WdsPxe/nf-wdspxe-pxepacketfree) function.</span></span>

## <a name="enumerate-registered-providers"></a><span data-ttu-id="fd630-175">Перечисление зарегистрированных поставщиков</span><span class="sxs-lookup"><span data-stu-id="fd630-175">Enumerate Registered Providers</span></span>

-   <span data-ttu-id="fd630-176">Используйте API для записи поставщиков, которые перечисляют и проверяют другие зарегистрированные поставщики в списке.</span><span class="sxs-lookup"><span data-stu-id="fd630-176">Use the API to write providers that enumerate and check other registered providers in the list.</span></span>
-   <span data-ttu-id="fd630-177">Функция [**пксежетсерверинфо**](/windows/win32/api/WdsPxe/nf-wdspxe-pxegetserverinfo) возвращает сведения о PXE-сервере.</span><span class="sxs-lookup"><span data-stu-id="fd630-177">The [**PxeGetServerInfo**](/windows/win32/api/WdsPxe/nf-wdspxe-pxegetserverinfo) function returns information about the PXE server.</span></span> <span data-ttu-id="fd630-178">Функция **пксежетсерверинфо** возвращает **логическое** значение, указывающее, включена ли трассировка для сервера.</span><span class="sxs-lookup"><span data-stu-id="fd630-178">The **PxeGetServerInfo** function returns a **BOOL** that indicates whether tracing is enabled for the server.</span></span> <span data-ttu-id="fd630-179">**Значение true** указывает, что трассировка включена.</span><span class="sxs-lookup"><span data-stu-id="fd630-179">**TRUE** indicates that tracing is enabled.</span></span>
-   <span data-ttu-id="fd630-180">Функция [**пксепровидеренумфирст**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderenumfirst) запускает поставщиков енумератионоф в списке зарегистрированных поставщиков.</span><span class="sxs-lookup"><span data-stu-id="fd630-180">The [**PxeProviderEnumFirst**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderenumfirst) function starts an enumerationof providers in the registered provider list.</span></span> <span data-ttu-id="fd630-181">Функция **пксепровидеренумфирст** запускает перечисление и возвращает адрес маркера, который должен использоваться при вызове функции [**пксепровидеренумнекст**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderenumnext) .</span><span class="sxs-lookup"><span data-stu-id="fd630-181">The **PxeProviderEnumFirst** function starts the enumeration and returns the address of the handle that should be used when calling the [**PxeProviderEnumNext**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderenumnext) function.</span></span> <span data-ttu-id="fd630-182">Функция **пксепровидеренумнекст** возвращает структуру [**\_ поставщика PXE**](/windows/win32/api/wdspxe/ns-wdspxe-pxe_provider) , содержащую сведения о поставщике.</span><span class="sxs-lookup"><span data-stu-id="fd630-182">The **PxeProviderEnumNext** function returns a [**PXE\_PROVIDER**](/windows/win32/api/wdspxe/ns-wdspxe-pxe_provider) structure containing the information about the provider.</span></span> <span data-ttu-id="fd630-183">Функция [**пксепровидерфриинфо**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderfreeinfo) освобождает память, выделенную для структуры **\_ поставщика PXE** функцией **пксепровидеренумнекст** .</span><span class="sxs-lookup"><span data-stu-id="fd630-183">The [**PxeProviderFreeInfo**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderfreeinfo) function frees the memory that has been allocated for the **PXE\_PROVIDER** structure by the **PxeProviderEnumNext** function.</span></span> <span data-ttu-id="fd630-184">Функция [**пксепровидеренумклосе**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderenumclose) закрывает перечисление поставщиков в списке зарегистрированных поставщиков.</span><span class="sxs-lookup"><span data-stu-id="fd630-184">The [**PxeProviderEnumClose**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeproviderenumclose) function closes the enumeration of providers in the registered providers list.</span></span>

## <a name="handle-service-control-codes"></a><span data-ttu-id="fd630-185">Обработку кодов управления службами</span><span class="sxs-lookup"><span data-stu-id="fd630-185">Handle Service Control Codes</span></span>

-   <span data-ttu-id="fd630-186">При получении сообщения управления службой WDS вызывает обратный вызов [*пксепровидерсервицеконтрол*](pxeproviderservicecontrol.md) .</span><span class="sxs-lookup"><span data-stu-id="fd630-186">When a service control message is received, WDS calls the [*PxeProviderServiceControl*](pxeproviderservicecontrol.md) callback.</span></span>
-   <span data-ttu-id="fd630-187">Поставщик может определить функцию обратного вызова [*пксепровидерсервицеконтрол*](pxeproviderservicecontrol.md) для работы с сообщениями управления службами.</span><span class="sxs-lookup"><span data-stu-id="fd630-187">The provider can define a [*PxeProviderServiceControl*](pxeproviderservicecontrol.md) callback function to handle service control messages.</span></span>
-   <span data-ttu-id="fd630-188">Зарегистрируйте обратный вызов [*пксепровидерсервицеконтрол*](pxeproviderservicecontrol.md) , вызвав функцию [**пксерегистеркаллбакк**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeregistercallback) с **\_ \_ \_ контролем обратного вызова PXE** во время обработки обратного вызова [*пксепровидеринитиализе*](pxeproviderinitialize.md) .</span><span class="sxs-lookup"><span data-stu-id="fd630-188">Register the [*PxeProviderServiceControl*](pxeproviderservicecontrol.md) callback by calling the [**PxeRegisterCallback**](/windows/win32/api/WdsPxe/nf-wdspxe-pxeregistercallback) function with **PXE\_CALLBACK\_SERVICE\_CONTROL** during the processing of the [*PxeProviderInitialize*](pxeproviderinitialize.md) callback.</span></span>

## <a name="add-trace-entries-to-pxe-log"></a><span data-ttu-id="fd630-189">Добавление записей трассировки в журнал PXE</span><span class="sxs-lookup"><span data-stu-id="fd630-189">Add Trace Entries to PXE Log</span></span>

-   <span data-ttu-id="fd630-190">Функция [**пксетраце**](/windows/win32/api/WdsPxe/nf-wdspxe-pxetrace) добавляет запись трассировки в журнал PXE.</span><span class="sxs-lookup"><span data-stu-id="fd630-190">The [**PxeTrace**](/windows/win32/api/WdsPxe/nf-wdspxe-pxetrace) function adds a trace entry to the PXE log.</span></span> <span data-ttu-id="fd630-191">ВДСПКСЕ предоставляет трассировку, помогающую администраторам в устранении неполадок.</span><span class="sxs-lookup"><span data-stu-id="fd630-191">WDSPXE provides tracing to help administrators in troubleshooting.</span></span> <span data-ttu-id="fd630-192">Поставщики могут регистрировать записи трассировки с разными уровнями серьезности.</span><span class="sxs-lookup"><span data-stu-id="fd630-192">Providers can log trace entries of different severity levels.</span></span> <span data-ttu-id="fd630-193">Администраторы могут настроить ВДСПКСЕ на запись только тех записей, которые имеют определенный уровень серьезности.</span><span class="sxs-lookup"><span data-stu-id="fd630-193">The administrators can configure WDSPXE to only log entries for certain severity levels.</span></span>

## <a name="related-topics"></a><span data-ttu-id="fd630-194">См. также</span><span class="sxs-lookup"><span data-stu-id="fd630-194">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="fd630-195">Сведения об API служб развертывания Windows</span><span class="sxs-lookup"><span data-stu-id="fd630-195">About the Windows Deployment Services API</span></span>](about-the-windows-deployment-services-api.md)
</dt> <dt>

[<span data-ttu-id="fd630-196">Использование API клиента служб развертывания Windows</span><span class="sxs-lookup"><span data-stu-id="fd630-196">Using the Windows Deployment Services Client API</span></span>](using-the-windows-deployment-services-client-api.md)
</dt> </dl>

 

 




