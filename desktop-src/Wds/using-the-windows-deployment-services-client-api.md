---
title: Использование API клиента служб развертывания Windows
description: В средах, где стандартное решение служб развертывания Windows (WDS) нельзя использовать для установки Windows, API клиента WDS позволяет разработчикам создавать пользовательские приложения развертывания.
ms.assetid: abe2a7c7-989a-456e-80df-90d5b816db38
keywords:
- Службы развертывания Windows службы Deployment Services с использованием API клиента
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 872422a5c84bf1d8ea7c3688b122ba2389c1e968
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104070149"
---
# <a name="using-the-windows-deployment-services-client-api"></a><span data-ttu-id="59994-104">Использование API клиента служб развертывания Windows</span><span class="sxs-lookup"><span data-stu-id="59994-104">Using the Windows Deployment Services Client API</span></span>

<span data-ttu-id="59994-105">В средах, где стандартное решение служб развертывания Windows (WDS) нельзя использовать для установки Windows, API клиента WDS позволяет разработчикам создавать пользовательские приложения развертывания.</span><span class="sxs-lookup"><span data-stu-id="59994-105">In environments where a standard Windows Deployment Services (WDS) solution cannot be used to install Windows, the API of the WDS client enables developers to write custom deployment applications.</span></span> <span data-ttu-id="59994-106">Приложения могут использовать этот API для взаимодействия с сервером WDS для получения сведений о системных образах, доступных на сервере.</span><span class="sxs-lookup"><span data-stu-id="59994-106">Applications can use this API to communicate with the WDS server to get information about system images available from the server.</span></span> <span data-ttu-id="59994-107">Пользовательские клиентские приложения WDS должны соответствовать следующим рекомендациям.</span><span class="sxs-lookup"><span data-stu-id="59994-107">Custom WDS client applications should adhere to the following guidelines.</span></span>

## <a name="install-the-wds-role-on-the-server"></a><span data-ttu-id="59994-108">Установка роли WDS на сервере</span><span class="sxs-lookup"><span data-stu-id="59994-108">Install the WDS Role on the Server</span></span>

-   <span data-ttu-id="59994-109">Службы развертывания Windows (WDS) — это пересмотренная версия служб удаленной установки (RIS). для реализации пользовательских клиентских решений WDS потребуется роль сервера WDS на сервере.</span><span class="sxs-lookup"><span data-stu-id="59994-109">Windows Deployment Services (WDS) is the revised version of Remote Installation Services (RIS), you will need the WDS server role on the server to implement custom WDS client solutions.</span></span>
-   <span data-ttu-id="59994-110">WDS заменяет службу RIS стандартным компонентом, начиная с Windows Server 2008 и Windows Server 2003 с пакетом обновления 2 (SP2).</span><span class="sxs-lookup"><span data-stu-id="59994-110">WDS replaces RIS as the standard component starting with Windows Server 2008 and Windows Server 2003 with Service Pack 2 (SP2).</span></span>
-   <span data-ttu-id="59994-111">Необходимо обновить сервер RIS до WDS на Windows Server 2003 с пакетом обновления 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="59994-111">You must update the RIS server to WDS on Windows Server 2003 with Service Pack 1 (SP1).</span></span> <span data-ttu-id="59994-112">Роль сервера WDS можно установить с помощью [пакет автоматической установки Windows (WAIK)](https://www.microsoft.com/download/details.aspx?id=10333).</span><span class="sxs-lookup"><span data-stu-id="59994-112">You can install the WDS server role with the [Windows Automated Installation Kit (WAIK)](https://www.microsoft.com/download/details.aspx?id=10333).</span></span>

## <a name="start-windows-pe-20"></a><span data-ttu-id="59994-113">Запуск среды предустановки Windows 2,0</span><span class="sxs-lookup"><span data-stu-id="59994-113">Start Windows PE 2.0</span></span>

<span data-ttu-id="59994-114">Windows PE 2,0 должна быть запущена, если она еще не запущена.</span><span class="sxs-lookup"><span data-stu-id="59994-114">Windows PE 2.0 must be started, if not already started.</span></span> <span data-ttu-id="59994-115">Клиент WDS и вспомогательные библиотеки DLL загружаются только setup.exe, если они находятся на этапе обработки установки Microsoft среда предустановки Windows (Windows PE 2,0).</span><span class="sxs-lookup"><span data-stu-id="59994-115">The WDS client and supporting DLLs are only loaded by setup.exe when it is in the Microsoft Windows Preinstallation Environment (Windows PE 2.0) phase of setup processing.</span></span>

-   <span data-ttu-id="59994-116">При подключении нового компьютера к сети для загрузки программы сетевой загрузки можно использовать встроенную технологию среды выполнения предзагрузки (PXE).</span><span class="sxs-lookup"><span data-stu-id="59994-116">When a new computer is connected to the network, the built-in preboot execution environment (PXE) technology can be used to download the Network Boot Program.</span></span> <span data-ttu-id="59994-117">Дополнительные сведения о PXE-загрузке компьютера для установки Windows см. в пошаговом [руководств по обновлению служб развертывания Windows](/previous-versions/windows/it-pro/windows-vista/cc766320(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="59994-117">For more information about PXE-booting a computer to install Windows, see [The Windows Deployment Services Update Step-by-Step Guide](/previous-versions/windows/it-pro/windows-vista/cc766320(v=ws.10)).</span></span>
-   <span data-ttu-id="59994-118">Загрузочный образ диска RAMDISK Windows PE 2,0 можно сохранить в. Формат WIM и загружается как часть процесса сетевой загрузки.</span><span class="sxs-lookup"><span data-stu-id="59994-118">A RAMDISK bootable image of Windows PE 2.0 can be stored in the .WIM format and downloaded as part of the network boot process.</span></span> <span data-ttu-id="59994-119">Затем Windows PE можно загрузить и запустить непосредственно с этого носителя.</span><span class="sxs-lookup"><span data-stu-id="59994-119">Windows PE can then be loaded and run directly from that media.</span></span>

## <a name="open-a-session-with-the-wds-server"></a><span data-ttu-id="59994-120">Открытие сеанса с сервером WDS</span><span class="sxs-lookup"><span data-stu-id="59994-120">Open a session with the WDS server</span></span>

<span data-ttu-id="59994-121">Клиент WDS должен открыть сеанс с сервером WDS.</span><span class="sxs-lookup"><span data-stu-id="59994-121">The WDS client must open a session with a WDS server.</span></span>

-   <span data-ttu-id="59994-122">Используйте функцию [**вдскликреатесессион**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) , чтобы открыть сеанс с сервером WDS.</span><span class="sxs-lookup"><span data-stu-id="59994-122">Use the [**WdsCliCreateSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) function to open a session with a WDS server.</span></span> <span data-ttu-id="59994-123">Эта функция принимает имя или IP-адрес сервера и получает адрес маркера для сеанса клиента WDS.</span><span class="sxs-lookup"><span data-stu-id="59994-123">This function takes the name or IP address of the server and receives the address of the handle for the WDS client session.</span></span>
-   <span data-ttu-id="59994-124">Если открытие сеанса с сервером потребует проверки подлинности клиента WDS, то при вызове функции [**вдскликреатесессион**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) приложение должно предоставить адрес структуры [**\_ \_ cred CLI WDS**](/windows/win32/api/wdsclientapi/ns-wdsclientapi-wds_cli_cred) , содержащей учетные данные клиента.</span><span class="sxs-lookup"><span data-stu-id="59994-124">If opening the session with the server will require authenticating the WDS client, the application should provide the address of a [**WDS\_CLI\_CRED**](/windows/win32/api/wdsclientapi/ns-wdsclientapi-wds_cli_cred) structure containing the client credentials when calling the [**WdsCliCreateSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) function.</span></span> <span data-ttu-id="59994-125">Приложение может использовать функцию [**вдсклиаусоризесессион**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliauthorizesession) для преобразования анонимного сеанса в сеанс, прошедший проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="59994-125">The application can use the [**WdsCliAuthorizeSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliauthorizesession) function to convert an anonymous session into an authenticated session.</span></span>
-   <span data-ttu-id="59994-126">Когда сеанс, Открытый с помощью функции [**вдскликреатесессион**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) , больше не нужен, приложение должно использовать функцию [**вдскликлосе**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliclose) , чтобы закрыть обработчик и ресурсы освобождения, удерживаемые сеансом.</span><span class="sxs-lookup"><span data-stu-id="59994-126">When the session opened with the [**WdsCliCreateSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) function is no longer needed, the application should use the [**WdsCliClose**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliclose) function to close the handle and release resources held by the session.</span></span>

## <a name="enumerate-system-images-on-the-wds-server"></a><span data-ttu-id="59994-127">Перечисление образов системы на WDS-сервере</span><span class="sxs-lookup"><span data-stu-id="59994-127">Enumerate system images on the WDS server</span></span>

<span data-ttu-id="59994-128">Клиент WDS может использовать API для перечисления образов системы на сервере WDS.</span><span class="sxs-lookup"><span data-stu-id="59994-128">The WDS client can use the API to enumerate the system images on the WDS server.</span></span>

-   <span data-ttu-id="59994-129">Используйте функцию [**вдсклифиндфирстимаже**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) , чтобы получить маркер первого образа и инициализировать перечисление образов на сервере WDS.</span><span class="sxs-lookup"><span data-stu-id="59994-129">Use the [**WdsCliFindFirstImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) function to obtain a handle to the first image and to initialize the enumeration of images on the WDS server.</span></span>
-   <span data-ttu-id="59994-130">Используйте функцию [**вдсклифинднекстимаже**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) , чтобы увеличить перечисление, запущенное функцией [**вдсклифиндфирстимаже**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) .</span><span class="sxs-lookup"><span data-stu-id="59994-130">Use the [**WdsCliFindNextImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) function to increment the enumeration started by the [**WdsCliFindFirstImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) function.</span></span> <span data-ttu-id="59994-131">Функция **вдсклифинднекстимаже** получает маркер для следующего изображения.</span><span class="sxs-lookup"><span data-stu-id="59994-131">The **WdsCliFindNextImage** function gets the handle for the next image.</span></span>
-   <span data-ttu-id="59994-132">Используйте функцию [**вдсклижетимажеиндекс**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimageindex) для получения индекса образа для текущего изображения.</span><span class="sxs-lookup"><span data-stu-id="59994-132">Use the [**WdsCliGetImageIndex**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimageindex) function to obtain the image index for the current image.</span></span> <span data-ttu-id="59994-133">Это значение допустимо только до тех пор, пока функции [**вдсклифинднекстимаже**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) и [**вдскликлосе**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliclose) не будут использоваться повторно.</span><span class="sxs-lookup"><span data-stu-id="59994-133">This value is valid only until the [**WdsCliFindNextImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) or [**WdsCliClose**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliclose) functions are used again.</span></span>
-   <span data-ttu-id="59994-134">Используйте функцию [**вдсклижетенумератионфлагс**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetenumerationflags) для получения информационных флагов о фильтрации изображений.</span><span class="sxs-lookup"><span data-stu-id="59994-134">Use the [**WdsCliGetEnumerationFlags**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetenumerationflags) function to get informational flags about image filtering.</span></span>

## <a name="get-information-about-images"></a><span data-ttu-id="59994-135">Получение сведений об образах</span><span class="sxs-lookup"><span data-stu-id="59994-135">Get information about images</span></span>

<span data-ttu-id="59994-136">Клиент WDS может использовать API для получения сведений об образах на сервере WDS.</span><span class="sxs-lookup"><span data-stu-id="59994-136">The WDS client can use the API to get information about the images on a WDS server.</span></span> <span data-ttu-id="59994-137">Следующие функции получают сведения о текущем изображении.</span><span class="sxs-lookup"><span data-stu-id="59994-137">The following functions get information about the current image.</span></span> <span data-ttu-id="59994-138">Поскольку функции [**вдсклифиндфирстимаже**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) и [**вдсклифинднекстимаже**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) изменяют текущее значение обработчика изображения, приложение должно хранить все сведения, которые он получает, и потребуется в будущем перед повторным вызовом функций **вдсклифиндфирстимаже** или **вдсклифинднекстимаже** .</span><span class="sxs-lookup"><span data-stu-id="59994-138">Because the [**WdsCliFindFirstImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) and [**WdsCliFindNextImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) functions change the current image handle value, the application should store any information it gets and will need in the future before calling the **WdsCliFindFirstImage** or **WdsCliFindNextImage** functions again.</span></span>

-   <span data-ttu-id="59994-139">Используйте функцию [**вдсклижетимажеарчитектуре**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagearchitecture) для получения архитектуры процессора текущего образа.</span><span class="sxs-lookup"><span data-stu-id="59994-139">Use the [**WdsCliGetImageArchitecture**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagearchitecture) function to get the processor architecture of the current image.</span></span>
-   <span data-ttu-id="59994-140">Используйте функцию [**вдсклижетимажепас**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagepath) , чтобы получить относительный путь к файлу изображения, содержащему текущий образ.</span><span class="sxs-lookup"><span data-stu-id="59994-140">Use the [**WdsCliGetImagePath**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagepath) function to get the relative path to the image file that contains the current image.</span></span>
-   <span data-ttu-id="59994-141">Чтобы получить размер изображения, используйте функцию [**вдсклижетимажесизе**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagesize) .</span><span class="sxs-lookup"><span data-stu-id="59994-141">Use the [**WdsCliGetImageSize**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagesize) function to get the image size.</span></span>
-   <span data-ttu-id="59994-142">Используйте функцию [**вдсклижетимажеверсион**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimageversion) для получения версии образа.</span><span class="sxs-lookup"><span data-stu-id="59994-142">Use the [**WdsCliGetImageVersion**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimageversion) function to get the image version.</span></span>
-   <span data-ttu-id="59994-143">Используйте функцию [**вдсклижетимажелангуаже**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelanguage) , чтобы получить язык по умолчанию для текущего изображения.</span><span class="sxs-lookup"><span data-stu-id="59994-143">Use the [**WdsCliGetImageLanguage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelanguage) function to get the default language of the current image.</span></span>
-   <span data-ttu-id="59994-144">Используйте функцию [**вдсклижетимажелангуажес**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelanguages) для получения массива языков, поддерживаемых текущим изображением.</span><span class="sxs-lookup"><span data-stu-id="59994-144">Use the [**WdsCliGetImageLanguages**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelanguages) function to get an array of languages supported by the current image.</span></span>
-   <span data-ttu-id="59994-145">Использование [**вдсклижетимажеластмодифиедтиме**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelastmodifiedtime) Возвращает время последнего изменения для текущего изображения.</span><span class="sxs-lookup"><span data-stu-id="59994-145">Use the [**WdsCliGetImageLastModifiedTime**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelastmodifiedtime) returns the last-modified time for the current image.</span></span>
-   <span data-ttu-id="59994-146">Чтобы получить имя текущего изображения, используйте функцию [**вдсклижетимаженаме**](/windows/win32/api/WdsClientApi/nf-wdsclientapi-wdscligetimagename) .</span><span class="sxs-lookup"><span data-stu-id="59994-146">Use the [**WdsCliGetImageName**](/windows/win32/api/WdsClientApi/nf-wdsclientapi-wdscligetimagename) function to get the name of the current image.</span></span>
-   <span data-ttu-id="59994-147">Используйте функцию [**вдсклижетимажедескриптион**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagedescription) для получения описания текущего изображения.</span><span class="sxs-lookup"><span data-stu-id="59994-147">Use the [**WdsCliGetImageDescription**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagedescription) function to get the description of the current image.</span></span>
-   <span data-ttu-id="59994-148">Используйте функцию [**вдсклижетимажеграуп**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagegroup) , чтобы получить имя группы образов для текущего образа.</span><span class="sxs-lookup"><span data-stu-id="59994-148">Use the [**WdsCliGetImageGroup**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagegroup) function to get the image group name for the current image.</span></span>
-   <span data-ttu-id="59994-149">Используйте функцию [**вдсклижетимажехалнаме**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagehalname) , чтобы получить имя слоя абстрагирования оборудования (HAL) для текущего образа.</span><span class="sxs-lookup"><span data-stu-id="59994-149">Use the [**WdsCliGetImageHalName**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagehalname) function to get the Hardware Abstraction Layer (HAL) name for the current image.</span></span>

## <a name="log-wds-client-events"></a><span data-ttu-id="59994-150">Регистрация событий клиента WDS</span><span class="sxs-lookup"><span data-stu-id="59994-150">Log WDS Client Events</span></span>

<span data-ttu-id="59994-151">Функция ведения журнала клиентской библиотеки WDS позволяет отправлять события хода установки с клиента на сервер WDS.</span><span class="sxs-lookup"><span data-stu-id="59994-151">The logging functionality of the WDS client library enables installation progress events to be sent from the client to the WDS server.</span></span>

-   <span data-ttu-id="59994-152">Используйте функцию [**вдсклиинитиализелог**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliinitializelog) для инициализации журнала для сеанса клиента WDS.</span><span class="sxs-lookup"><span data-stu-id="59994-152">Use the [**WdsCliInitializeLog**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliinitializelog) function to initialize the log for the WDS client session.</span></span>
-   <span data-ttu-id="59994-153">Используйте функцию [**вдсклилог**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclilog) для записи сообщений о событиях в журнал сервера WDS.</span><span class="sxs-lookup"><span data-stu-id="59994-153">Use the [**WdsCliLog**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclilog) function to write event messages to the WDS server log.</span></span>
-   <span data-ttu-id="59994-154">В Windows Server 2008 сервер WDS записывает события клиента в журнал событий конкретного приложения, который можно просмотреть в eventvwr.exe, а также в журнале трассировки отладки.</span><span class="sxs-lookup"><span data-stu-id="59994-154">On Windows Server 2008, the WDS server writes client events to an application specific event log that is viewable through eventvwr.exe as well as the debug trace log.</span></span> <span data-ttu-id="59994-155">В Windows Server 2003 с включенным ведением журнала отладки сервер WDS будет записывать события клиента в файл журнала, расположенный в папке% WINDIR% \\ Tracing \\ WDSServer. log.</span><span class="sxs-lookup"><span data-stu-id="59994-155">On Windows Server 2003 with debug logging enabled, the WDS server will write client events to the log file located at %windir%\\tracing\\wdsserver.log.</span></span> <span data-ttu-id="59994-156">Для захвата этих событий необходимо включить ведение журнала клиента WDS на сервере.</span><span class="sxs-lookup"><span data-stu-id="59994-156">WDS Client logging must be enabled on the server to capture these events.</span></span>

## <a name="related-topics"></a><span data-ttu-id="59994-157">См. также</span><span class="sxs-lookup"><span data-stu-id="59994-157">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="59994-158">Сведения об API служб развертывания Windows</span><span class="sxs-lookup"><span data-stu-id="59994-158">About the Windows Deployment Services API</span></span>](about-the-windows-deployment-services-api.md)
</dt> <dt>

[<span data-ttu-id="59994-159">Использование API сервера служб развертывания Windows</span><span class="sxs-lookup"><span data-stu-id="59994-159">Using the Windows Deployment Services Server API</span></span>](using-the-windows-deployment-services-server-api.md)
</dt> </dl>

 

 