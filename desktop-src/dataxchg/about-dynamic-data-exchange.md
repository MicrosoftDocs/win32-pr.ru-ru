---
title: Сведения о платформа динамических данных Exchange
description: В этом разделе обсуждается передача данных между приложениями.
ms.assetid: 0bcd8de4-a6f0-4f2a-8b9d-0b1b638925fb
keywords:
- платформа динамических данных Exchange (DDE), о программе
- DDE (платформа динамических данных Exchange), сведения
- обмен данными, Exchange платформа динамических данных (DDE)
- платформа динамических данных Exchange (DDE), связывание с данными в режиме реального времени
- DDE (платформа динамических данных Exchange), связывание с данными в режиме реального времени
- платформа динамических данных Exchange (DDE), создание составных документов
- DDE (платформа динамических данных Exchange), создание составных документов
- платформа динамических данных Exchange (DDE), запросы данных
- DDE (платформа динамических данных Exchange), запросы данных
- платформа динамических данных Exchange (DDE), примеры
- DDE (платформа динамических данных Exchange), примеры
- платформа динамических данных Exchange (DDE), олицетворение
- DDE (платформа динамических данных Exchange), олицетворение
- платформа динамических данных Exchange (DDE), сообщения
- DDE (платформа динамических данных Exchange), сообщения
- платформа динамических данных Exchange (DDE), атомы
- DDE (платформа динамических данных Exchange), атомы
- платформа динамических данных Exchange (DDE), объекты общей памяти
- DDE (платформа динамических данных Exchange), объекты общей памяти
- платформа динамических данных Exchange (DDE), функции упаковки параметров
- DDE (платформа динамических данных Exchange), функции упаковки параметров
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 50331a69fac11dbc6f49acdc6f3245f4a8f1da4434774ae8b2931d50f8921e1d
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118811983"
---
# <a name="about-dynamic-data-exchange"></a>Сведения о платформа динамических данных Exchange

Windows предоставляет несколько методов передачи данных между приложениями. одним из способов является использование протокола платформа динамических данных Exchange (DDE). Протокол DDE — это набор сообщений и руководств. Он отправляет сообщения между приложениями, которые совместно используют данные, и использует общую память для обмена данными между приложениями. Приложения могут использовать протокол DDE для одноразовой передачи данных и для непрерывного обмена, при котором приложения отправляют обновления друг другу по мере того, как новые данные становятся доступными.

Windows также поддерживает библиотеку управления платформа динамических данных Exchange (ддемл). ДДЕМЛ — это библиотека динамической компоновки (DLL), которую приложения могут использовать для совместного использования данных. ДДЕМЛ предоставляет функции и сообщения, упрощающие задачу добавления возможностей DDE в приложение. Вместо отправки, публикации и обработки сообщений DDE напрямую приложение использует функции ДДЕМЛ для управления сеансами DDE. (Сеанс DDE — это взаимодействие между клиентскими и серверными приложениями.)

ДДЕМЛ также предоставляет средство для управления строками и данными, которые совместно используют приложения DDE. Вместо использования атомов и указателей на объекты общей памяти приложения DDE создают и обмениваются дескрипторами строк, которые обозначают строки и дескрипторы данных, определяющие объекты памяти. ДДЕМЛ также позволяет серверному приложению регистрировать имена служб, которые она поддерживает. Имена передаются в другие приложения в системе, которые могут использовать имена для подключения к серверу. Более того, ДДЕМЛ обеспечивает совместимость приложений DDE, представляя их единообразно реализовать протокол DDE.

Существующие приложения, использующие протокол DDE на основе сообщений, полностью совместимы с теми, которые используют ДДЕМЛ. Это значит, что приложение, использующее DDE на основе сообщений, может устанавливать диалоги и выполнять транзакции с приложениями, использующими ДДЕМЛ. Из-за множества преимуществ ДДЕМЛ новые приложения должны использовать его, а не сообщения DDE. Чтобы использовать элементы API ДДЕМЛ, необходимо включить в исходные файлы файл заголовка ДДЕМЛ, связать с библиотекой ДДЕМЛ и убедиться, что библиотека динамической компоновки ДДЕМЛ находится в системном пути поиска.

В этом разделе рассматриваются следующие темы.

-   [протокол Exchange платформа динамических данных](#dynamic-data-exchange-protocol)
-   [использование для Windows платформа динамических данных Exchange](#uses-for-windows-dynamic-data-exchange)
-   [платформа динамических данных Exchange с точки зрения пользователя](#dynamic-data-exchange-from-the-users-point-of-view)
-   [основные понятия Exchange платформа динамических данных](#dynamic-data-exchange-concepts)
    -   [Клиент, сервер и беседа](#client-server-and-conversation)
    -   [Имена приложений, разделов и элементов](#application-topic-and-item-names)
    -   [Раздел System](#the-system-topic)
    -   [Постоянные ссылки на данные](#permanent-data-links)
    -   [Атомы и объекты общей памяти](#atoms-and-shared-memory-objects)
-   [общие сведения о сообщениях Exchange платформа динамических данных](#dynamic-data-exchange-messages-overview)
-   [платформа динамических данных сообщение Exchange Flow](#dynamic-data-exchange-message-flow)
-   [Функции упаковки параметров](#parameter-packing-functions)
-   [платформа динамических данных Exchange и олицетворение](#dynamic-data-exchange-and-impersonation)

## <a name="dynamic-data-exchange-protocol"></a>протокол Exchange платформа динамических данных

так как Windows имеет архитектуру на основе сообщений, передача сообщений является наиболее подходящим методом для автоматической передачи информации между приложениями. Однако сообщения содержат только два параметра (*wParam* и *lParam*) для передачи данных. В результате эти параметры должны ссылаться косвенно на другие фрагменты данных, когда между приложениями передаются несколько слов данных. Протокол DDE точно определяет, как приложения должны использовать параметры *wParam* и *lParam* для передачи больших фрагментов данных с помощью глобальных атомов и дескрипторов общей памяти. Протокол DDE имеет определенные правила для выделения и удаления глобальных атомов и объектов общей памяти.

Глобальный Atom — это ссылка на символьную строку. В протоколе DDE атомы идентифицируют приложения, которые обмениваются данными, характер обмена данными и сами элементы данных. Дополнительные сведения о атомах см. в разделе [о атомах](about-atom-tables.md).

## <a name="uses-for-windows-dynamic-data-exchange"></a>использование для Windows платформа динамических данных Exchange

Протокол DDE наиболее подходит для обмена данными, который не требует текущего взаимодействия с пользователем. Как правило, приложение предоставляет пользователю способ установить связь между приложениями, которые обмениваются данными. Однако после того, как связь установлена, приложения обмениваются данными без участия пользователя.

DDE можно использовать для реализации широкого спектра функций приложений, например:

-   Связывание с данными в режиме реального времени, например с обновлениями рынка, научных инструментов или процессом управления процессами.
-   Создание составных документов, таких как документ обработки текста, который содержит диаграмму, созданную графическим приложением. При использовании DDE диаграмма изменится при изменении исходных данных, а оставшаяся часть документа останется неизменной.
-   Выполнение запросов данных между приложениями, например электронной таблицей, которая запрашивает у базы данных учетные записи, которые просрочены.

## <a name="dynamic-data-exchange-from-the-users-point-of-view"></a>платформа динамических данных Exchange с точки зрения пользователя

В следующем примере показано, как могут взаимодействовать два приложения DDE, как видно из точки зрения пользователя.

пользователь электронной таблицы хочет использовать Microsoft Excel для контроля цены на конкретный запас на бирже в нью-йорке Exchange. У пользователя есть приложение с именем quote, которое, в свою очередь, имеет доступ к данным Нисе. сеанс DDE между Excel и квотой происходит следующим образом:

-   Пользователь инициирует диалог, предоставляя имя приложения (цитата), которое будет предоставлять данные, и определенную тему интереса (Нисе). Полученный сеанс DDE используется для запроса квот на определенные акции.
-   Excel передает имена приложений и разделов во все приложения DDE, выполняющиеся в системе в данный момент. цитата отвечает, создавая беседу с Excel о разделе нисе.
-   Пользователь может создать формулу таблицы в ячейке, которая запрашивает автоматическое обновление таблицы при каждом изменении конкретного котировка. например, пользователь может запросить автоматическое обновление каждый раз, когда происходит изменение в продажной цене закскс акций, указав следующую формулу Excel: = ' Quote ' \| ' нисе '! закскс
-   Пользователь может в любое время завершить автоматическое обновление котировки ЗАКСКС. Другие ссылки на данные, которые были установлены отдельно (например, для предложений других акций), по-прежнему останутся активными в рамках одной Нисе диалога.
-   пользователь может также завершить весь диалог между Excel и кавычками в разделе нисе, чтобы не создавать никаких ссылок на данные в этом разделе, не инициируя новый диалог.

## <a name="dynamic-data-exchange-concepts"></a>основные понятия Exchange платформа динамических данных

В следующих разделах объясняются важные понятия и терминология, которые являются ключевыми для понимания динамического обмена данными.

-   [Клиент, сервер и беседа](#client-server-and-conversation)
-   [Имена приложений, разделов и элементов](#application-topic-and-item-names)
-   [Раздел System](#the-system-topic)
-   [Постоянные ссылки на данные](#permanent-data-links)
-   [Атомы и объекты общей памяти](#atoms-and-shared-memory-objects)

### <a name="client-server-and-conversation"></a>Клиент, сервер и беседа

Два приложения, участвующие в DDE, говорят, что они вовлечены в сеанс DDE. Приложение, инициирующее диалог, является клиентским приложением DDE. приложение, отвечающее на клиент, является приложением сервера DDE. Приложение может одновременно работать в нескольких диалогах, действуя как клиент в некоторых и в качестве сервера в других.

Сеанс DDE происходит между двумя окнами, по одному для каждого из участвующих в приложении приложений. Окно может быть основным окном приложения; окно, связанное с конкретным документом, как в приложении с многодокументным интерфейсом (MDI); или скрытое (невидимое) окно, предназначенное только для обработки сообщений DDE.

Так как сеанс DDE определяется парой дескрипторов для окон диалога, ни одно окно не должно быть вовлечено в несколько диалогов с другим окном. Клиентское приложение или серверное приложение должно предоставлять другое окно для каждого диалога с конкретным сервером или клиентским приложением.

Приложение может обеспечить, чтобы пара клиентских и серверных окон никогда не участвовала в нескольких диалогах, создавая скрытое окно для каждого диалога. Единственное назначение этого окна — Обработка сообщений DDE.

### <a name="application-topic-and-item-names"></a>Имена приложений, разделов и элементов

Протокол DDE определяет единицы данных, передаваемых между клиентом и сервером с трехуровневой иерархией имен приложений, разделов и элементов.

Каждый сеанс DDE однозначно определяется именем приложения и темой. В начале сеанса DDE клиент и сервер определяют имя приложения и раздел. Имя приложения обычно является именем серверного приложения. например, если Excel выступает в качестве сервера в диалоге, имя приложения будет Excel.

Раздел DDE представляет собой общую классификацию данных, в которой во время диалога несколько элементов данных могут быть «обсуждаемыми» (в Exchange). Для приложений, работающих с документами на основе файлов, раздел обычно представляет собой имя файла. Для других приложений раздел является именем, зависящим от приложения.

Так как окно клиента и сервера обрабатываются совместно, определите сеанс DDE, имя приложения и раздел, описывающие диалог, не могут быть изменены во время диалога.

Элемент данных DDE — это информация, относящаяся к теме диалога, который обменивается между приложениями. Значения для элемента данных могут передаваться с сервера клиенту или с клиента на сервер. Данные могут передаваться с помощью любого стандартного формата буфера обмена или с зарегистрированным форматом буфера обмена. Специальный зарегистрированный формат с именем Link определяет элемент в сеансе DDE. Дополнительные сведения о форматах буфера обмена см. в разделе [буфер обмена](clipboard.md).

### <a name="the-system-topic"></a>Раздел System

Приложения должны поддерживать системный раздел все время. В этом разделе представлен контекст для информации, которая может представлять собой общий интерес для другого приложения.

Значения элементов данных должны подготавливаться к просмотру в формате [**\_ текстовых**](standard-clipboard-formats.md) буферов CF. Отдельные элементы значений элементов для системного раздела должны быть разделены символами табуляции. В следующей таблице представлены некоторые элементы для системного раздела.



| Элемент          | Описание                                                                                                                                                                                                                                                                                             |
|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Форматы       | Разделенный символами табуляцией список форматов буфера обмена, которые приложение может визуализировать. Как правило, форматы **\_ CF** указываются с частью **" \_ CF**" удаляемых имен (например, **\_ текст CF** указан как "**Text**").                                                                                        |
| Справка          | Текст, который кратко описывает использование сервера DDE.                                                                                                                                                                                                                                                   |
| ретурнмессаже | Поддержка подробных сведений о недавно использованном сообщении [**WM \_ DDE \_ ACK**](wm-dde-ack.md) . Этот элемент полезен, если требуются более восьми бит возвращаемых данных приложения.                                                                                                                |
| Состояние        | Указывает текущее состояние приложения. Когда сервер получает сообщение [**запроса WM \_ DDE \_**](wm-dde-request.md) для этого элемента системы, он должен ответить, отправляя сообщение [**\_ \_ данных DDE WM**](wm-dde-data.md) со строкой, содержащей значение busy или Ready, в зависимости от ситуации. |
| сиситемс      | Список элементов системного раздела, поддерживаемых приложением.                                                                                                                                                                                                                                                    |
| топиЦитемлист | Аналогично элементу Сиситемс, за исключением того, что ТопиЦитемлист должен поддерживаться для каждого раздела, кроме системного раздела. Это позволяет просматривать элементы, поддерживаемые в любой теме. Если элементы не могут быть перечислены, этот элемент должен содержать только "ТопиЦитемлист".                                  |
| Разделы        | Список разделов, поддерживаемых приложением в настоящее время; Этот список может быть в разных секундах.                                                                                                                                                                                                  |



 

### <a name="permanent-data-links"></a>Постоянные ссылки на данные

После начала сеанса DDE клиент может установить одну или несколько постоянных ссылок на данные с сервера. Канал передачи данных — это механизм связи, с помощью которого сервер уведомляет клиента при каждом изменении значения указанного элемента данных. Канал данных является постоянным в том смысле, что этот процесс уведомления будет продолжаться до тех пор, пока не завершится связь с данными или сеанс DDE.

Существует два вида постоянных ссылок на данные DDE: горячий и горячий. В канале горячий передачи данных сервер уведомляет клиента о том, что значение элемента данных изменилось, но сервер не отправляет клиенту значение данных, пока клиент не запросит его. В канале горячего передачи данных сервер немедленно отправляет клиенту измененное значение данных.

Приложения, поддерживающие горячую или горячую связь, обычно предоставляют команду **Копировать** или **Вставить ссылку** в своем меню " **Правка** ", чтобы позволить пользователю устанавливать ссылки между приложениями.

### <a name="atoms-and-shared-memory-objects"></a>Атомы и объекты общей памяти

Некоторыми аргументами сообщений DDE являются глобальные атомы или объекты общей памяти. Приложения, использующие эти аргументы, должны следовать явным правилам о том, когда следует распределять и удалять их. Во всех случаях отправителю сообщения необходимо удалить любой объект Atom или Shared Memory, который не будет получен из-за состояния ошибки, например при сбое функции отправки [**сообщений**](/windows/desktop/api/winuser/nf-winuser-postmessagea) .

DDE использует объекты общей памяти для трех целей:

-   Для переноса значения элемента данных для обмена. Это элемент, на который ссылается параметр *хдата* в [**\_ \_ данных WM DDE**](wm-dde-data.md) , а [**WM DDE \_ — \_ Вставка**](wm-dde-poke.md) сообщений.
-   Для выполнения параметров в сообщении. Это элемент, на который ссылается параметр *хоптионс* в сообщении с рекомендацией [**WM \_ DDE \_**](wm-dde-advise.md) .
-   Для выполнения строки выполнения команды. Это элемент, на который ссылается параметр *хкоммандс* в сообщении об [**\_ \_ исполнении WM DDE**](wm-dde-execute.md) и соответствующее сообщение [**WM \_ DDE \_ ACK**](wm-dde-ack.md) .

Приложение, получающее объект общей памяти DDE, должно обрабатывать его как доступное только для чтения. Приложение не должно использовать объект в качестве обоюдной области для чтения и записи для бесплатного обмена данными.

Как и в случае с Atom DDE, приложение должно освободить объект общей памяти для эффективного управления памятью. Приложение также должно блокировать и разблокировать объекты памяти.

## <a name="dynamic-data-exchange-messages-overview"></a>общие сведения о сообщениях Exchange платформа динамических данных

Так как DDE является протоколом на основе сообщений, он не использует никаких функций или библиотек. Все транзакции DDE проходят через передачу определенных сообщений DDE между клиентскими и серверными окнами.

Имеется девять сообщений DDE; Символьные константы для этих сообщений определяются в файле заголовка DDE. Некоторые структуры для различных сообщений DDE также определяются в этом файле заголовка.

В следующей таблице перечислены сообщения DDE.



| Сообщение                                        | Описание                                                                                                                                      |
|------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|
| [**WM \_ DDE \_ ACK**](wm-dde-ack.md)             | Подтверждает получение или отсутствие получения сообщения.                                                                                               |
| [**Протокол WM \_ DDE \_ advise**](wm-dde-advise.md)       | Запрашивает серверное приложение на предоставление обновления или уведомления для элемента данных при каждом изменении. Это устанавливает постоянный канал данных. |
| [**\_данные DDE \_ WM**](wm-dde-data.md)           | Отправляет в клиентское приложение значение элемента данных.                                                                                               |
| [**\_выполнение WM DDE \_**](wm-dde-execute.md)     | Отправляет строку в серверное приложение, которое предполагает обработку строки в виде последовательности команд.                                       |
| [**\_Запуск WM DDE \_**](wm-dde-initiate.md)   | Инициирует диалог между клиентскими и серверными приложениями.                                                                             |
| [**\_Вставка DDE \_ WM**](wm-dde-poke.md)           | Отправляет значение элемента данных в серверное приложение.                                                                                               |
| [**\_запрос DDE \_ WM**](wm-dde-request.md)     | Запрашивает серверное приложение для предоставления значения элемента данных.                                                                             |
| [**\_прерывание работы WM DDE \_**](wm-dde-terminate.md) | Завершает диалог.                                                                                                                       |
| [**WM \_ DDE \_ unadvise**](wm-dde-unadvise.md)   | Завершает связь с постоянными данными.                                                                                                                |



 

Приложение вызывает [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage) , чтобы выдать сообщение об [**\_ \_ инициации DDE WM**](wm-dde-initiate.md) или сообщение [**WM \_ DDE \_ ACK**](wm-dde-ack.md) , отправленное в ответ на **Запуск программы WM \_ DDE \_**. Все остальные сообщения отправляются [**сообщением**](/windows/desktop/api/winuser/nf-winuser-postmessagea). Первый параметр этих вызовов — это обработчик принимающего окна; Второй параметр содержит отправляемое сообщение; Третий параметр определяет окно отправки; и четвертый параметр содержит аргументы, относящиеся к конкретному сообщению.

## <a name="dynamic-data-exchange-message-flow"></a>платформа динамических данных сообщение Exchange Flow

Типичный сеанс DDE состоит из следующих событий.

1.  Клиентское приложение инициирует диалог, и серверное приложение отвечает.
2.  Приложения обмениваются данными с помощью любого или всех следующих методов:
    -   -   Серверное приложение отправляет данные клиенту по запросу клиента.
        -   Клиентское приложение отправляет незапрошенные данные в серверное приложение.
        -   Клиентское приложение запрашивает серверное приложение для уведомления клиента при каждом изменении элемента данных (горячий канал данных).
        -   Клиентское приложение запрашивает серверное приложение на отправку данных при каждом изменении данных (ссылка на горячую передачу данных).
        -   Серверное приложение выполняет команду по запросу клиента.

3.  Клиент или серверное приложение завершает диалог.

Окно приложения, обрабатывающее запросы от клиента или сервера, должно обрабатывать их строго в том порядке, в котором они получены.

Клиент может устанавливать диалоги с несколькими серверами. сервер может иметь диалоги с несколькими клиентами. При обработке сообщений из более чем одного источника клиент или сервер должен синхронно обрабатывать сообщения диалога, но не должны обрабатывать все сообщения синхронно. Иными словами, он может переходить от одного диалога к другому при необходимости.

Если приложению не удается обработать входящий запрос, так как он ожидает ответа DDE, он должен предотвратить блокировку, отправляя сообщение [**WM \_ DDE \_ ACK**](wm-dde-ack.md) с членом **фбуси** структуры [**ддеакк**](/windows/desktop/api/Dde/ns-dde-ddeack) , равным 1. Приложение также может отправить занятое сообщение **WM \_ DDE \_ ACK** , если по какой-либо причине оно не может обработать входящий запрос в течение разумного промежутка времени.

Приложение должно быть способно обработать сбой клиента или сервера для реагирования на сообщение в течение определенного времени. Так как интервал времени ожидания может различаться в зависимости от характера приложения и конфигурации системы пользователя (включая подключение к сети), приложение должно предоставить пользователю способ указания интервала в.

## <a name="parameter-packing-functions"></a>Функции упаковки параметров

Параметр *lParam* многих сообщений DDE содержит два фрагмента данных. Например, *lParam* сообщения [**\_ \_ данных DDE WM**](wm-dde-data.md) содержит маркер данных и Atom. Приложения должны использовать функцию [**паккдделпарам**](/windows/desktop/api/Dde/nf-dde-packddelparam) для упаковки маркера и Atom в параметр *lParam* , а также функцию [**унпаккдделпарам**](/windows/desktop/api/Dde/nf-dde-unpackddelparam) для удаления значений. Приложения DDE должны использовать **паккдделпарам** и **унпаккдделпарам** для всех сообщений, опубликованных во время сеанса DDE.

Приложения также могут использовать функции [**реуседделпарам**](/windows/desktop/api/Dde/nf-dde-reuseddelparam) и [**фридделпарам**](/windows/desktop/api/Dde/nf-dde-freeddelparam) . **Реуседделпарам** позволяет приложению DDE повторно использовать упакованный параметр *lParam* , помогая сократить количество перераспределений памяти, которые приложение должно выполнить во время диалога. Приложение может использовать **фридделпарам** для высвобождения памяти, связанной с маркером данных, полученным во время сеанса DDE.

## <a name="dynamic-data-exchange-and-impersonation"></a>платформа динамических данных Exchange и олицетворение

Чтобы разрешить серверу олицетворять клиента, клиент вызывает функцию [**ддесеткуалитйофсервице**](/windows/desktop/api/Dde/nf-dde-ddesetqualityofservice) . Для управления уровнем олицетворения, который может выполнять сервер, используется структура [**\_ \_ уровня олицетворения безопасности**](/windows/win32/api/winnt/ne-winnt-security_impersonation_level) .

Сервер DDE может олицетворять клиент DDE, вызывая функцию [**имперсонатеддеклиентвиндов**](/windows/desktop/api/Dde/nf-dde-impersonateddeclientwindow) . Сервер ДДЕМЛ должен использовать функцию [**ддеимперсонатеклиент**](/windows/desktop/api/Ddeml/nf-ddeml-ddeimpersonateclient) .

 

 