---
title: О таблицах Atom
description: В этом разделе обсуждаются таблицы Atom.
ms.assetid: 12114a3e-99a4-480f-9d1a-57c1942b7382
keywords:
- атомы
- таблицы Atom
- имена Atom
- Платформа динамических данных Exchange (DDE), атомы
- DDE (платформа динамических данных Exchange), атомы
- глобальные таблицы Atom
- локальные таблицы Atom
- целочисленные атомы
- строковые атомы
ms.topic: article
ms.date: 08/25/2020
ms.openlocfilehash: 27f7cdb4bb2dc2fd97b4dba6909022b297df1a1d
ms.sourcegitcommit: e985e0532f0f895ae418e8c2658dac819cdae3b1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2020
ms.locfileid: "104413900"
---
# <a name="about-atom-tables"></a><span data-ttu-id="991ef-112">О таблицах Atom</span><span class="sxs-lookup"><span data-stu-id="991ef-112">About Atom Tables</span></span>

<span data-ttu-id="991ef-113">*Таблица Atom* — это определяемая системой таблица, в которой хранятся строки и соответствующие идентификаторы.</span><span class="sxs-lookup"><span data-stu-id="991ef-113">An *atom table* is a system-defined table that stores strings and corresponding identifiers.</span></span> <span data-ttu-id="991ef-114">Приложение помещает строку в таблицу Atom и получает 16-разрядное целое число, называемое *Atom*, которое можно использовать для доступа к строке.</span><span class="sxs-lookup"><span data-stu-id="991ef-114">An application places a string in an atom table and receives a 16-bit integer, called an *atom*, that can be used to access the string.</span></span> <span data-ttu-id="991ef-115">Строка, помещенная в таблицу Atom, называется *именем Atom*.</span><span class="sxs-lookup"><span data-stu-id="991ef-115">A string that has been placed in an atom table is called an *atom name*.</span></span>

<span data-ttu-id="991ef-116">Система предоставляет несколько таблиц Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-116">The system provides a number of atom tables.</span></span> <span data-ttu-id="991ef-117">Каждая таблица Atom служит другой целью.</span><span class="sxs-lookup"><span data-stu-id="991ef-117">Each atom table serves a different purpose.</span></span> <span data-ttu-id="991ef-118">Например, приложения платформа динамических данных Exchange (DDE) используют [глобальную таблицу Atom](#global-atom-table) для совместного использования строк имени элемента и имени раздела с другими приложениями.</span><span class="sxs-lookup"><span data-stu-id="991ef-118">For example, Dynamic Data Exchange (DDE) applications use the [global atom table](#global-atom-table) to share item-name and topic-name strings with other applications.</span></span> <span data-ttu-id="991ef-119">Вместо передачи фактических строк приложение DDE передает глобальные атомы в свое партнерское приложение.</span><span class="sxs-lookup"><span data-stu-id="991ef-119">Rather than passing actual strings, a DDE application passes global atoms to its partner application.</span></span> <span data-ttu-id="991ef-120">Участник использует атомы для получения строк из таблицы Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-120">The partner uses the atoms to obtain the strings from the atom table.</span></span>

<span data-ttu-id="991ef-121">Приложения могут использовать локальные таблицы Atom для хранения собственных сопоставлений имен элементов.</span><span class="sxs-lookup"><span data-stu-id="991ef-121">Applications can use local atom tables to store their own item-name associations.</span></span>

<span data-ttu-id="991ef-122">Система использует таблицы Atom, которые не доступны напрямую приложениям.</span><span class="sxs-lookup"><span data-stu-id="991ef-122">The system uses atom tables that are not directly accessible to applications.</span></span> <span data-ttu-id="991ef-123">Однако приложение использует эти атомы при вызове различных функций.</span><span class="sxs-lookup"><span data-stu-id="991ef-123">However, the application uses these atoms when calling a variety of functions.</span></span> <span data-ttu-id="991ef-124">Например, зарегистрированные форматы буфера обмена хранятся во внутренней таблице Atom, используемой системой.</span><span class="sxs-lookup"><span data-stu-id="991ef-124">For example, registered clipboard formats are stored in an internal atom table used by the system.</span></span> <span data-ttu-id="991ef-125">Приложение добавляет атомы в эту таблицу Atom с помощью функции [**регистерклипбоардформат**](/windows/desktop/api/Winuser/nf-winuser-registerclipboardformata) .</span><span class="sxs-lookup"><span data-stu-id="991ef-125">An application adds atoms to this atom table using the [**RegisterClipboardFormat**](/windows/desktop/api/Winuser/nf-winuser-registerclipboardformata) function.</span></span> <span data-ttu-id="991ef-126">Кроме того, зарегистрированные классы хранятся во внутренней таблице Atom, используемой системой.</span><span class="sxs-lookup"><span data-stu-id="991ef-126">Also, registered classes are stored in an internal atom table used by the system.</span></span> <span data-ttu-id="991ef-127">Приложение добавляет атомы в эту таблицу Atom с помощью функции [**registerClass**](/windows/desktop/api/winuser/nf-winuser-registerclassa) или [**RegisterClassEx**](/windows/desktop/api/winuser/nf-winuser-registerclassexa) .</span><span class="sxs-lookup"><span data-stu-id="991ef-127">An application adds atoms to this atom table using the [**RegisterClass**](/windows/desktop/api/winuser/nf-winuser-registerclassa) or [**RegisterClassEx**](/windows/desktop/api/winuser/nf-winuser-registerclassexa) function.</span></span>

<span data-ttu-id="991ef-128">В этом разделе рассматриваются следующие темы.</span><span class="sxs-lookup"><span data-stu-id="991ef-128">The following topics are discussed in this section.</span></span>

-   [<span data-ttu-id="991ef-129">Глобальная таблица Atom</span><span class="sxs-lookup"><span data-stu-id="991ef-129">Global Atom Table</span></span>](#global-atom-table)
-   [<span data-ttu-id="991ef-130">Пользовательская таблица Atom</span><span class="sxs-lookup"><span data-stu-id="991ef-130">User Atom Table</span></span>](#user-atom-table)
-   [<span data-ttu-id="991ef-131">Локальные таблицы Atom</span><span class="sxs-lookup"><span data-stu-id="991ef-131">Local Atom Tables</span></span>](#local-atom-tables)
-   [<span data-ttu-id="991ef-132">Типы Atom</span><span class="sxs-lookup"><span data-stu-id="991ef-132">Atom Types</span></span>](#atom-types)
    -   [<span data-ttu-id="991ef-133">Строковые атомы</span><span class="sxs-lookup"><span data-stu-id="991ef-133">String Atoms</span></span>](#string-atoms)
    -   [<span data-ttu-id="991ef-134">Целочисленные атомы</span><span class="sxs-lookup"><span data-stu-id="991ef-134">Integer Atoms</span></span>](#integer-atoms)
-   [<span data-ttu-id="991ef-135">Создание Atom и счетчик использования</span><span class="sxs-lookup"><span data-stu-id="991ef-135">Atom Creation and Usage Count</span></span>](#atom-creation-and-usage-count)
-   [<span data-ttu-id="991ef-136">Запросы Atom-Table</span><span class="sxs-lookup"><span data-stu-id="991ef-136">Atom-Table Queries</span></span>](#atom-table-queries)
-   [<span data-ttu-id="991ef-137">Форматы строк Atom</span><span class="sxs-lookup"><span data-stu-id="991ef-137">Atom String Formats</span></span>](#atom-string-formats)

## <a name="global-atom-table"></a><span data-ttu-id="991ef-138">Глобальная таблица Atom</span><span class="sxs-lookup"><span data-stu-id="991ef-138">Global Atom Table</span></span>

<span data-ttu-id="991ef-139">Глобальная таблица Atom доступна для всех приложений.</span><span class="sxs-lookup"><span data-stu-id="991ef-139">The global atom table is available to all applications.</span></span> <span data-ttu-id="991ef-140">Когда приложение помещает строку в глобальную таблицу Atom, система создает объект Atom, который уникален в пределах всей системы.</span><span class="sxs-lookup"><span data-stu-id="991ef-140">When an application places a string in the global atom table, the system generates an atom that is unique throughout the system.</span></span> <span data-ttu-id="991ef-141">Любое приложение, имеющее Atom, может получить строку, которую он идентифицирует, выполнив запрос к глобальной таблице Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-141">Any application that has the atom can obtain the string it identifies by querying the global atom table.</span></span>

<span data-ttu-id="991ef-142">Приложение, определяющее частный формат данных DDE для обмена данными с другими приложениями, должно размещать имя формата в глобальной таблице Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-142">An application that defines a private DDE-data format for sharing data with other applications should place the format name in the global atom table.</span></span> <span data-ttu-id="991ef-143">Этот метод предотвращает конфликты с именами форматов, определенных системой или другими приложениями, и делает идентификаторы (атомы) для сообщений или форматов, доступных для других приложений.</span><span class="sxs-lookup"><span data-stu-id="991ef-143">This technique prevents conflicts with the names of formats defined by the system or by other applications, and makes the identifiers (atoms) for the messages or formats available to the other applications.</span></span>

## <a name="user-atom-table"></a><span data-ttu-id="991ef-144">Пользовательская таблица Atom</span><span class="sxs-lookup"><span data-stu-id="991ef-144">User Atom Table</span></span>

<span data-ttu-id="991ef-145">В дополнение к глобальной таблице Atom пользовательская таблица Atom является другой системной таблицей Atom, которая также является общей для всех процессов.</span><span class="sxs-lookup"><span data-stu-id="991ef-145">In addition to the global atom table, the user atom table is another system atom table that is also shared across all processes.</span></span> <span data-ttu-id="991ef-146">Таблица user Atom используется для небольшого числа сценариев, внутренних для Win32k; Например, имена модулей Windows, хорошо известные строки в Win32k, форматы OLE и т. д. Несмотря на то, что приложения не взаимодействуют с пользовательской таблицей Atom напрямую, они вызывают несколько API-интерфейсов, таких как [registerClass](/windows/win32/api/winuser/nf-winuser-registerclassexa), [регистервиндовмессаже](/windows/win32/api/winuser/nf-winuser-registerwindowmessagea)и [регистерклипбоардформат](/windows/win32/api/winuser/nf-winuser-registerclipboardformata), которые добавляют записи в таблицу Atom пользователя.</span><span class="sxs-lookup"><span data-stu-id="991ef-146">The user atom table is used for a small number of scenarios internal to win32k; for example, windows module names, well known strings in win32k, OLE formats, etc. Although applications do not interact with the user atom table directly, they call several APIs—such as [RegisterClass](/windows/win32/api/winuser/nf-winuser-registerclassexa), [RegisterWindowMessage](/windows/win32/api/winuser/nf-winuser-registerwindowmessagea), and [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata)—that add entries to the user atom table.</span></span> <span data-ttu-id="991ef-147">Записи, добавленные, `RegisterClass` можно удалить с помощью `UnregisterClass` .</span><span class="sxs-lookup"><span data-stu-id="991ef-147">The entries added by `RegisterClass` can be deleted by `UnregisterClass`.</span></span> <span data-ttu-id="991ef-148">Однако записи, добавленные `RegisterWindowMessage` и, `RegisterClipboardFormat` не удаляются до завершения сеанса.</span><span class="sxs-lookup"><span data-stu-id="991ef-148">However, the entries added by `RegisterWindowMessage` and `RegisterClipboardFormat` do not get deleted until the session ends.</span></span> <span data-ttu-id="991ef-149">Если в таблице Atom пользователя больше нет пространства, а передаваемая строка еще не находится в таблице, вызов завершится ошибкой.</span><span class="sxs-lookup"><span data-stu-id="991ef-149">If the user atom table has no more space and the string being passed in is not already in the table, the call will fail.</span></span> 

### <a name="atom-table-size"></a><span data-ttu-id="991ef-150">Размер таблицы Atom</span><span class="sxs-lookup"><span data-stu-id="991ef-150">Atom Table Size</span></span>
 
<span data-ttu-id="991ef-151">Многие критические API, включая [CreateWindow](/windows/win32/api/winuser/nf-winuser-createwindowa), основываются на пользовательских атомах.</span><span class="sxs-lookup"><span data-stu-id="991ef-151">Many critical APIs, including [CreateWindow](/windows/win32/api/winuser/nf-winuser-createwindowa), rely on user atoms.</span></span> <span data-ttu-id="991ef-152">Поэтому нехватка пространства в таблице Atom пользователя приведет к серьезным проблемам. Например, не удается запустить все приложения.</span><span class="sxs-lookup"><span data-stu-id="991ef-152">Therefore, space exhaustion in the user atom table will result in serious issues; for example, all applications may fail to launch.</span></span> <span data-ttu-id="991ef-153">Ниже приведены некоторые рекомендации по эффективному использованию приложением таблиц Atom и обеспечению надежности и производительности приложения и системы.</span><span class="sxs-lookup"><span data-stu-id="991ef-153">Here are some recommendations to ensure your application utilizes atom tables efficiently and preserves the reliability and performance of the application and system:</span></span>  

1. <span data-ttu-id="991ef-154">Вы должны ограничить использование приложения пользовательской таблицей Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-154">You should limit your app's usage of the user atom table.</span></span> <span data-ttu-id="991ef-155">Хранение уникальных строк с помощью таких интерфейсов API, как `RegisterClass` , `RegisterWindowMessage` или, `RegisterClipboardFormat` занимает место в таблице Atom пользователя, которая используется глобально другими приложениями для регистрации классов окон с помощью строк.</span><span class="sxs-lookup"><span data-stu-id="991ef-155">Storing unique strings using APIs like `RegisterClass`, `RegisterWindowMessage`, or `RegisterClipboardFormat` takes space in the user atom table, which is used globally by other apps to register window classes using strings.</span></span> <span data-ttu-id="991ef-156">Если это возможно, следует использовать [аддатом](/windows/desktop/api/Winbase/nf-winbase-addatomw) / [делетеатом](/windows/desktop/api/Winbase/nf-winbase-deleteatom) для хранения строк в локальной таблице Atom или [глобаладдатом](/windows/desktop/api/Winbase/nf-winbase-globaladdatoma) / [глобалделетеатом](/windows/desktop/api/Winbase/nf-winbase-globaldeleteatom) , если атомы необходимы для кросс-процессов.</span><span class="sxs-lookup"><span data-stu-id="991ef-156">If at all possible, you should use [AddAtom](/windows/desktop/api/Winbase/nf-winbase-addatomw)/[DeleteAtom](/windows/desktop/api/Winbase/nf-winbase-deleteatom) to store strings in a local atom table, or  [GlobalAddAtom](/windows/desktop/api/Winbase/nf-winbase-globaladdatoma)/[GlobalDeleteAtom](/windows/desktop/api/Winbase/nf-winbase-globaldeleteatom) if the atoms are needed cross-process.</span></span>

1. <span data-ttu-id="991ef-157">Если возникает проблема с приложением, вызывающим проблемы с таблицей Atom пользователя, можно исследовать основную причину, подключившись к отладчику ядра и нарушая процесс при вызовах метода `UserAddAtomEx` ( `bae1 win32kbase!UserAddAtomEx /p <eprocess> "kc10;g"` ).</span><span class="sxs-lookup"><span data-stu-id="991ef-157">If there is concern about the application causing user atom table issues, you can investigate the root cause by connecting the kernel debugger and breaking into the process on calls to `UserAddAtomEx` (`bae1 win32kbase!UserAddAtomEx /p <eprocess> "kc10;g"`).</span></span> <span data-ttu-id="991ef-158">Найдите `user32!` в стеке вызовов, чтобы узнать, какой API вызывается.</span><span class="sxs-lookup"><span data-stu-id="991ef-158">Look for `user32!` on the callstack to see which API is being called.</span></span> <span data-ttu-id="991ef-159">Эта методика похожа на обнаружение ошибок глобальной таблицы Atom, описанных в разделе [Определение утечек глобальной таблицы Atom](/archive/blogs/ntdebugging/identifying-global-atom-table-leaks).</span><span class="sxs-lookup"><span data-stu-id="991ef-159">The methodology is similar to the global atom table issue detection explained in [Identifying Global Atom Table Leaks](/archive/blogs/ntdebugging/identifying-global-atom-table-leaks).</span></span> <span data-ttu-id="991ef-160">Другим способом дампа содержимого таблицы Atom пользователя является вызов [жетклипбоардформатнаме](/windows/win32/api/winuser/nf-winuser-getclipboardformatnamea) для диапазона возможных атомов от 0XC000 до 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="991ef-160">Another way to dump the contents of the user atom table is by calling [GetClipboardFormatName](/windows/win32/api/winuser/nf-winuser-getclipboardformatnamea) over the range of possible atoms from 0xC000 to 0xFFFF.</span></span> <span data-ttu-id="991ef-161">Если общее число атомов постоянно выходит во время работы приложения или не возвращается к базовому плану при закрытии приложения, возникает проблема.</span><span class="sxs-lookup"><span data-stu-id="991ef-161">If the total atom count steadily goes up while the application is running or does not return to baseline when the app is closed, there is a problem.</span></span>

## <a name="local-atom-tables"></a><span data-ttu-id="991ef-162">Локальные таблицы Atom</span><span class="sxs-lookup"><span data-stu-id="991ef-162">Local Atom Tables</span></span>

<span data-ttu-id="991ef-163">Приложение может использовать локальную таблицу Atom для эффективного управления большим количеством строк, используемых только в приложении.</span><span class="sxs-lookup"><span data-stu-id="991ef-163">An application can use a local atom table to efficiently manage a large number of strings used only within the application.</span></span> <span data-ttu-id="991ef-164">Эти строки и связанные с ними атомы доступны только для приложения, создавшего таблицу.</span><span class="sxs-lookup"><span data-stu-id="991ef-164">These strings, and the associated atoms, are available only to the application that created the table.</span></span>

<span data-ttu-id="991ef-165">Приложение, которому необходима одна и та же строка в нескольких структурах, может уменьшить использование памяти с помощью локальной таблицы Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-165">An application requiring the same string in a number of structures can reduce memory usage by using a local atom table.</span></span> <span data-ttu-id="991ef-166">Вместо копирования строки в каждую структуру приложение может поместить строку в таблицу Atom и включить результирующий объект Atom в структуры.</span><span class="sxs-lookup"><span data-stu-id="991ef-166">Rather than copying the string into each structure, the application can place the string in the atom table and include the resulting atom in the structures.</span></span> <span data-ttu-id="991ef-167">Таким образом, строка появляется только один раз в памяти, но может использоваться в приложении много раз.</span><span class="sxs-lookup"><span data-stu-id="991ef-167">In this way, a string appears only once in memory but can be used many times in the application.</span></span>

<span data-ttu-id="991ef-168">Приложения также могут использовать локальные таблицы Atom для экономии времени при поиске определенной строки.</span><span class="sxs-lookup"><span data-stu-id="991ef-168">Applications can also use local atom tables to save time when searching for a particular string.</span></span> <span data-ttu-id="991ef-169">Для выполнения поиска приложению требуется только поместить строку поиска в таблицу Atom и сравнить полученный объект Atom с атомами в соответствующих структурах.</span><span class="sxs-lookup"><span data-stu-id="991ef-169">To perform a search, an application need only place the search string in the atom table and compare the resulting atom with the atoms in the relevant structures.</span></span> <span data-ttu-id="991ef-170">Сравнение атомов обычно выполняется быстрее, чем сравнение строк.</span><span class="sxs-lookup"><span data-stu-id="991ef-170">Comparing atoms is typically faster than comparing strings.</span></span>

<span data-ttu-id="991ef-171">Таблицы Atom реализуются как хэш-таблицы.</span><span class="sxs-lookup"><span data-stu-id="991ef-171">Atom tables are implemented as hash tables.</span></span> <span data-ttu-id="991ef-172">По умолчанию в локальной таблице Atom для хэш-таблицы используются 37 контейнеров.</span><span class="sxs-lookup"><span data-stu-id="991ef-172">By default, a local atom table uses 37 buckets for its hash table.</span></span> <span data-ttu-id="991ef-173">Однако можно изменить число контейнеров, используемых при вызове функции [**инитатомтабле**](/windows/desktop/api/Winbase/nf-winbase-initatomtable) .</span><span class="sxs-lookup"><span data-stu-id="991ef-173">However, you can change the number of buckets used by calling the [**InitAtomTable**](/windows/desktop/api/Winbase/nf-winbase-initatomtable) function.</span></span> <span data-ttu-id="991ef-174">Если приложение вызывает **инитатомтабле**, это необходимо сделать до вызова любых других функций управления Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-174">If the application calls **InitAtomTable**, however, it must do so before calling any other atom-management functions.</span></span>

## <a name="atom-types"></a><span data-ttu-id="991ef-175">Типы Atom</span><span class="sxs-lookup"><span data-stu-id="991ef-175">Atom Types</span></span>

<span data-ttu-id="991ef-176">Приложения могут создавать два типа атомов: строковые атомы и целочисленные атомы.</span><span class="sxs-lookup"><span data-stu-id="991ef-176">Applications can create two types of atoms: string atoms and integer atoms.</span></span> <span data-ttu-id="991ef-177">Значения целочисленных атомов и строковых атомов не перекрываются, поэтому оба типа атомов можно использовать в одном блоке кода.</span><span class="sxs-lookup"><span data-stu-id="991ef-177">The values of integer atoms and string atoms do not overlap, so both types of atoms can be used in the same block of code.</span></span>

<span data-ttu-id="991ef-178">Несколько функций принимают в качестве параметров строки или атомы.</span><span class="sxs-lookup"><span data-stu-id="991ef-178">Several functions accept either strings or atoms as parameters.</span></span> <span data-ttu-id="991ef-179">При передаче Atom в эти функции приложение может использовать макрос [**макеинтатом**](/windows/desktop/api/Winbase/nf-winbase-makeintatom) для преобразования Atom в форму, которая может использоваться функцией.</span><span class="sxs-lookup"><span data-stu-id="991ef-179">When passing an atom to these functions, an application can use the [**MAKEINTATOM**](/windows/desktop/api/Winbase/nf-winbase-makeintatom) macro to convert the atom into a form that can be used by the function.</span></span>

<span data-ttu-id="991ef-180">В следующих разделах описываются типы Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-180">The following sections describe atom types.</span></span>

-   [<span data-ttu-id="991ef-181">Строковые атомы</span><span class="sxs-lookup"><span data-stu-id="991ef-181">String Atoms</span></span>](#string-atoms)
-   [<span data-ttu-id="991ef-182">Целочисленные атомы</span><span class="sxs-lookup"><span data-stu-id="991ef-182">Integer Atoms</span></span>](#integer-atoms)

### <a name="string-atoms"></a><span data-ttu-id="991ef-183">Строковые атомы</span><span class="sxs-lookup"><span data-stu-id="991ef-183">String Atoms</span></span>

<span data-ttu-id="991ef-184">Когда приложения передают строки, заканчивающиеся нулем, в функции [**глобаладдатом**](/windows/desktop/api/Winbase/nf-winbase-globaladdatoma), [**аддатом**](/windows/desktop/api/Winbase/nf-winbase-addatomw), [**глобалфиндатом**](/windows/desktop/api/Winbase/nf-winbase-globalfindatoma)и [**финдатом**](/windows/desktop/api/Winbase/nf-winbase-findatoma) , они получают *строковые атомы* (16-разрядные целые числа) в Return.</span><span class="sxs-lookup"><span data-stu-id="991ef-184">When applications pass null-terminated strings to the [**GlobalAddAtom**](/windows/desktop/api/Winbase/nf-winbase-globaladdatoma), [**AddAtom**](/windows/desktop/api/Winbase/nf-winbase-addatomw), [**GlobalFindAtom**](/windows/desktop/api/Winbase/nf-winbase-globalfindatoma), and [**FindAtom**](/windows/desktop/api/Winbase/nf-winbase-findatoma) functions, they receive *string atoms* (16-bit integers) in return.</span></span> <span data-ttu-id="991ef-185">Строковые атомы имеют следующие свойства:</span><span class="sxs-lookup"><span data-stu-id="991ef-185">String atoms have the following properties:</span></span>

-   <span data-ttu-id="991ef-186">Значения строковых атомов находятся в диапазоне от 0xC000 (МАКСИНТАТОМ) до 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="991ef-186">The values of string atoms are in the range 0xC000 (MAXINTATOM) through 0xFFFF.</span></span>
-   <span data-ttu-id="991ef-187">Регистр не важен при поиске имени Atom в таблице Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-187">Case is not significant in searches for an atom name in an atom table.</span></span> <span data-ttu-id="991ef-188">Кроме того, вся строка должна совпадать в операции поиска. сопоставление подстрок не выполняется.</span><span class="sxs-lookup"><span data-stu-id="991ef-188">Also, the entire string must match in a search operation; no substring matching is performed.</span></span>
-   <span data-ttu-id="991ef-189">Длина строки, связанной со строкой Atom, не может превышать 255 байт.</span><span class="sxs-lookup"><span data-stu-id="991ef-189">The string associated with a string atom can be no more than 255 bytes in size.</span></span> <span data-ttu-id="991ef-190">Это ограничение относится ко всем функциям Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-190">This limitation applies to all atom functions.</span></span>
-   <span data-ttu-id="991ef-191">*Счетчик ссылок* связан с каждым именем Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-191">A *reference count* is associated with each atom name.</span></span> <span data-ttu-id="991ef-192">Счетчик увеличивается каждый раз, когда имя Atom добавляется в таблицу и уменьшается каждый раз при удалении имени Atom из него.</span><span class="sxs-lookup"><span data-stu-id="991ef-192">The count is incremented each time the atom name is added to the table and decremented each time the atom name is deleted from it.</span></span> <span data-ttu-id="991ef-193">Это не позволяет разным пользователям одной и той же строки Atom уничтожить имена Atom друг друга.</span><span class="sxs-lookup"><span data-stu-id="991ef-193">This prevents different users of the same string atom from destroying each other's atom names.</span></span> <span data-ttu-id="991ef-194">Если число ссылок для имени Atom равно нулю, система удаляет Atom и имя Atom из таблицы.</span><span class="sxs-lookup"><span data-stu-id="991ef-194">When the reference count for an atom name equals zero, the system removes the atom and the atom name from the table.</span></span>

### <a name="integer-atoms"></a><span data-ttu-id="991ef-195">Целочисленные атомы</span><span class="sxs-lookup"><span data-stu-id="991ef-195">Integer Atoms</span></span>

<span data-ttu-id="991ef-196">Целочисленные атомы отличаются от строковых атомов следующими способами.</span><span class="sxs-lookup"><span data-stu-id="991ef-196">Integer atoms differ from string atoms in the following ways:</span></span>

-   <span data-ttu-id="991ef-197">Значения целочисленных атомов находятся в диапазоне от 0x0001 до 0xBFFF (**максинтатом**– 1).</span><span class="sxs-lookup"><span data-stu-id="991ef-197">The values of integer atoms are in the range 0x0001 through 0xBFFF (**MAXINTATOM**– 1).</span></span>
-   <span data-ttu-id="991ef-198">Строковое представление целочисленного атома имеет тип \# *dddd*, где значения, представленные в *dddd* , являются десятичными цифрами.</span><span class="sxs-lookup"><span data-stu-id="991ef-198">The string representation of an integer atom is \#*dddd*, where the values represented by *dddd* are decimal digits.</span></span> <span data-ttu-id="991ef-199">Ведущие нули игнорируются.</span><span class="sxs-lookup"><span data-stu-id="991ef-199">Leading zeros are ignored.</span></span>
-   <span data-ttu-id="991ef-200">Число ссылок или затраты на хранение, связанные с целым числом, отсутствуют.</span><span class="sxs-lookup"><span data-stu-id="991ef-200">There is no reference count or storage overhead associated with an integer atom.</span></span>

## <a name="atom-creation-and-usage-count"></a><span data-ttu-id="991ef-201">Создание Atom и счетчик использования</span><span class="sxs-lookup"><span data-stu-id="991ef-201">Atom Creation and Usage Count</span></span>

<span data-ttu-id="991ef-202">Приложение создает локальный экземпляр Atom, вызывая функцию [**аддатом**](/windows/desktop/api/Winbase/nf-winbase-addatomw) ; Он создает глобальный объект Atom, вызывая функцию [**глобаладдатом**](/windows/desktop/api/Winbase/nf-winbase-globaladdatoma) .</span><span class="sxs-lookup"><span data-stu-id="991ef-202">An application creates a local atom by calling the [**AddAtom**](/windows/desktop/api/Winbase/nf-winbase-addatomw) function; it creates a global atom by calling the [**GlobalAddAtom**](/windows/desktop/api/Winbase/nf-winbase-globaladdatoma) function.</span></span> <span data-ttu-id="991ef-203">Для обеих функций требуется указатель на строку.</span><span class="sxs-lookup"><span data-stu-id="991ef-203">Both functions require a pointer to a string.</span></span> <span data-ttu-id="991ef-204">Система выполняет поиск строки в соответствующей таблице Atom и возвращает в приложение соответствующий элемент Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-204">The system searches the appropriate atom table for the string and returns the corresponding atom to the application.</span></span> <span data-ttu-id="991ef-205">В случае с строкой Atom, если строка уже находится в таблице Atom, система увеличивает счетчик ссылок для строки во время этого процесса.</span><span class="sxs-lookup"><span data-stu-id="991ef-205">In the case of a string atom, if the string already resides in the atom table, the system increments the reference count for the string during this process.</span></span>

<span data-ttu-id="991ef-206">Повторные вызовы для добавления одного и того же имени Atom возвращают один и тот же элемент Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-206">Repeated calls to add the same atom name return the same atom.</span></span> <span data-ttu-id="991ef-207">Если имя Atom не существует в таблице при вызове [**аддатом**](/windows/desktop/api/Winbase/nf-winbase-addatomw) , имя Atom добавляется в таблицу и возвращается новый элемент Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-207">If the atom name does not exist in the table when [**AddAtom**](/windows/desktop/api/Winbase/nf-winbase-addatomw) is called, the atom name is added to the table and a new atom is returned.</span></span> <span data-ttu-id="991ef-208">Если это строковый Atom, то счетчик ссылок также имеет значение One.</span><span class="sxs-lookup"><span data-stu-id="991ef-208">If it is a string atom, its reference count is also set to one.</span></span>

<span data-ttu-id="991ef-209">Приложение должно вызывать функцию [**делетеатом**](/windows/desktop/api/Winbase/nf-winbase-deleteatom) , когда больше не требуется использовать локальный экземпляр Atom; Он должен вызывать функцию [**глобалделетеатом**](/windows/desktop/api/Winbase/nf-winbase-globaldeleteatom) , когда больше не требуется глобальный атом.</span><span class="sxs-lookup"><span data-stu-id="991ef-209">An application should call the [**DeleteAtom**](/windows/desktop/api/Winbase/nf-winbase-deleteatom) function when it no longer needs to use a local atom; it should call the [**GlobalDeleteAtom**](/windows/desktop/api/Winbase/nf-winbase-globaldeleteatom) function when it no longer needs a global atom.</span></span> <span data-ttu-id="991ef-210">В случае со строкой Atom любая из этих функций сокращает число ссылок соответствующего объекта Atom на единицу.</span><span class="sxs-lookup"><span data-stu-id="991ef-210">In the case of a string atom, either of these functions reduces the reference count of the corresponding atom by one.</span></span> <span data-ttu-id="991ef-211">Когда счетчик ссылок достигает нуля, система удаляет имя Atom из таблицы.</span><span class="sxs-lookup"><span data-stu-id="991ef-211">When the reference count reaches zero, the system deletes the atom name from the table.</span></span>

<span data-ttu-id="991ef-212">Имя Atom строкового Atom остается в глобальной таблице Atom, пока значение счетчика ссылок больше нуля, даже после того, как приложение, помещенное в таблицу, завершается.</span><span class="sxs-lookup"><span data-stu-id="991ef-212">The atom name of a string atom remains in the global atom table as long as its reference count is greater than zero, even after the application that placed it in the table terminates.</span></span> <span data-ttu-id="991ef-213">Локальная таблица Atom уничтожается при завершении связанного приложения независимо от количества ссылок на атомы в таблице.</span><span class="sxs-lookup"><span data-stu-id="991ef-213">A local atom table is destroyed when the associated application terminates, regardless of the reference counts of the atoms in the table.</span></span>

## <a name="atom-table-queries"></a><span data-ttu-id="991ef-214">Запросы Atom-Table</span><span class="sxs-lookup"><span data-stu-id="991ef-214">Atom-Table Queries</span></span>

<span data-ttu-id="991ef-215">Приложение может определить, уже определена ли строка в таблице Atom с помощью функции [**финдатом**](/windows/desktop/api/Winbase/nf-winbase-findatoma) или [**глобалфиндатом**](/windows/desktop/api/Winbase/nf-winbase-globalfindatoma) .</span><span class="sxs-lookup"><span data-stu-id="991ef-215">An application can determine whether a particular string is already in an atom table by using the [**FindAtom**](/windows/desktop/api/Winbase/nf-winbase-findatoma) or [**GlobalFindAtom**](/windows/desktop/api/Winbase/nf-winbase-globalfindatoma) function.</span></span> <span data-ttu-id="991ef-216">Эти функции выполняют поиск указанной строки в таблице Atom и, если строка находится в ней, возвращают соответствующий Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-216">These functions search an atom table for the specified string and, if the string is there, return the corresponding atom.</span></span>

<span data-ttu-id="991ef-217">Приложение может использовать функцию [**жетатомнаме**](/windows/desktop/api/Winbase/nf-winbase-getatomnamea) или [**глобалжетатомнаме**](/windows/desktop/api/Winbase/nf-winbase-globalgetatomnamea) для извлечения строки Atom-Name из таблицы Atom при условии, что приложение имеет объект Atom, соответствующий искомой строке.</span><span class="sxs-lookup"><span data-stu-id="991ef-217">An application can use the [**GetAtomName**](/windows/desktop/api/Winbase/nf-winbase-getatomnamea) or [**GlobalGetAtomName**](/windows/desktop/api/Winbase/nf-winbase-globalgetatomnamea) function to retrieve an atom-name string from an atom table, provided the application has the atom corresponding to the string being sought.</span></span> <span data-ttu-id="991ef-218">Обе функции копируют строку Atom-Name указанного Atom в буфер и возвращают длину скопированной строки.</span><span class="sxs-lookup"><span data-stu-id="991ef-218">Both functions copy the atom-name string of the specified atom to a buffer and return the length of the string that was copied.</span></span> <span data-ttu-id="991ef-219">**Жетатомнаме** извлекает строку Atom-Name из локальной таблицы Atom, а **глобалжетатомнаме** извлекает строку Atom-Name из глобальной таблицы Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-219">**GetAtomName** retrieves an atom-name string from a local atom table, and **GlobalGetAtomName** retrieves an atom-name string from the global atom table.</span></span>

## <a name="atom-string-formats"></a><span data-ttu-id="991ef-220">Форматы строк Atom</span><span class="sxs-lookup"><span data-stu-id="991ef-220">Atom String Formats</span></span>

<span data-ttu-id="991ef-221">Функции [**аддатом**](/windows/desktop/api/Winbase/nf-winbase-addatomw), [**глобаладдатом**](/windows/desktop/api/Winbase/nf-winbase-globaladdatoma), [**финдатом**](/windows/desktop/api/Winbase/nf-winbase-findatoma)и [**глобалфиндатом**](/windows/desktop/api/Winbase/nf-winbase-globalfindatoma) принимают указатель на строку, завершающуюся нулем.</span><span class="sxs-lookup"><span data-stu-id="991ef-221">The [**AddAtom**](/windows/desktop/api/Winbase/nf-winbase-addatomw), [**GlobalAddAtom**](/windows/desktop/api/Winbase/nf-winbase-globaladdatoma), [**FindAtom**](/windows/desktop/api/Winbase/nf-winbase-findatoma), and [**GlobalFindAtom**](/windows/desktop/api/Winbase/nf-winbase-globalfindatoma) functions take a pointer to a null-terminated string.</span></span> <span data-ttu-id="991ef-222">Приложение может указать этот указатель одним из следующих способов.</span><span class="sxs-lookup"><span data-stu-id="991ef-222">An application can specify this pointer in one of the following ways.</span></span>



|                    |                                                                                                    |
|--------------------|----------------------------------------------------------------------------------------------------|
| <span data-ttu-id="991ef-223">\#*dddd*</span><span class="sxs-lookup"><span data-stu-id="991ef-223">\#*dddd*</span></span>           | <span data-ttu-id="991ef-224">Целое число, заданное в виде десятичной строки.</span><span class="sxs-lookup"><span data-stu-id="991ef-224">An integer specified as a decimal string.</span></span> <span data-ttu-id="991ef-225">Используется для создания или поиска целочисленного атома.</span><span class="sxs-lookup"><span data-stu-id="991ef-225">Used to create or find an integer atom.</span></span>                  |
| <span data-ttu-id="991ef-226">*имя строкового Atom*</span><span class="sxs-lookup"><span data-stu-id="991ef-226">*string atom name*</span></span> | <span data-ttu-id="991ef-227">Имя строки Atom.</span><span class="sxs-lookup"><span data-stu-id="991ef-227">A string atom name.</span></span> <span data-ttu-id="991ef-228">Используется для добавления строкового имени Atom в таблицу Atom и получения Atom в Return.</span><span class="sxs-lookup"><span data-stu-id="991ef-228">Used to add a string atom name to an atom table and receive an atom in return.</span></span> |



 

 

 
