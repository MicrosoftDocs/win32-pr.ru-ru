---
description: 'Существует три способа завершения работы приложения на локальном или удаленном компьютере: завершение работы системшут системы и перезагрузка итшут приложения, завершение работы и перезагрузка системы и перезапуск всех приложений, зарегистрированных для перезапуска'
ms.assetid: acadf58f-3f68-4fa1-bdcf-8f85c8479263
title: Завершение работы
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e436dd9e3b115112e63b0440b4d51de4c7f9f619
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105664359"
---
# <a name="shutting-down"></a><span data-ttu-id="ecf12-103">Завершение работы</span><span class="sxs-lookup"><span data-stu-id="ecf12-103">Shutting Down</span></span>

<span data-ttu-id="ecf12-104">Существует три способа завершения работы приложения на локальном или удаленном компьютере:</span><span class="sxs-lookup"><span data-stu-id="ecf12-104">There are three ways for an application to shut down local or remote computers:</span></span>

-   <span data-ttu-id="ecf12-105">Завершение работы системы</span><span class="sxs-lookup"><span data-stu-id="ecf12-105">shut down the system</span></span>
-   <span data-ttu-id="ecf12-106">Завершите работу системы и перезапустите ее</span><span class="sxs-lookup"><span data-stu-id="ecf12-106">shut down the system and restart it</span></span>
-   <span data-ttu-id="ecf12-107">Завершите работу приложения, выключите и перезапустите систему и перезапустите все приложения, которые были зарегистрированы для перезапуска.</span><span class="sxs-lookup"><span data-stu-id="ecf12-107">shut down the application, shut down and restart the system, and restart any applications that have been registered for restart</span></span>

<span data-ttu-id="ecf12-108">Чтобы завершить работу системы, используйте функцию [**ExitWindowsEx**](/windows/desktop/api/Winuser/nf-winuser-exitwindowsex) с \_ флагом завершения работы евкс.</span><span class="sxs-lookup"><span data-stu-id="ecf12-108">To shut down the system, use the [**ExitWindowsEx**](/windows/desktop/api/Winuser/nf-winuser-exitwindowsex) function with the EWX\_SHUTDOWN flag.</span></span> <span data-ttu-id="ecf12-109">Пример см. в разделе [Завершение работы системы](how-to-shut-down-the-system.md).</span><span class="sxs-lookup"><span data-stu-id="ecf12-109">For an example, see [How to Shut Down the System](how-to-shut-down-the-system.md).</span></span> <span data-ttu-id="ecf12-110">Чтобы завершить работу и перезагрузить систему, используйте \_ флаг перезагрузки евкс.</span><span class="sxs-lookup"><span data-stu-id="ecf12-110">To shut down and restart the system, use the EWX\_REBOOT flag.</span></span> <span data-ttu-id="ecf12-111">Чтобы перезапустить все приложения, которые были зарегистрированы для перезапуска с помощью функции [**регистераппликатионрестарт**](/windows/win32/api/winbase/nf-winbase-registerapplicationrestart) , используйте \_ флаг ЕКСВ рестартаппс.</span><span class="sxs-lookup"><span data-stu-id="ecf12-111">To restart any applications that have been registered for restart using the [**RegisterApplicationRestart**](/windows/win32/api/winbase/nf-winbase-registerapplicationrestart) function, use the EXW\_RESTARTAPPS flag.</span></span>

<span data-ttu-id="ecf12-112">Функции [**инитиатешутдовн**](/windows/desktop/api/Winreg/nf-winreg-initiateshutdowna), [**инитиатесистемшутдовн**](/windows/desktop/api/Winreg/nf-winreg-initiatesystemshutdowna)и [**инитиатесистемшутдовнекс**](/windows/desktop/api/Winreg/nf-winreg-initiatesystemshutdownexa) запускают таймер и отображают диалоговое окно, предлагающее пользователю выйти из системы.</span><span class="sxs-lookup"><span data-stu-id="ecf12-112">The [**InitiateShutdown**](/windows/desktop/api/Winreg/nf-winreg-initiateshutdowna), [**InitiateSystemShutdown**](/windows/desktop/api/Winreg/nf-winreg-initiatesystemshutdowna), and [**InitiateSystemShutdownEx**](/windows/desktop/api/Winreg/nf-winreg-initiatesystemshutdownexa) functions start a timer and display a dialog box that prompts the user to log off.</span></span> <span data-ttu-id="ecf12-113">При отображении этого диалогового окна функция [**абортсистемшутдовн**](/windows/desktop/api/Winreg/nf-winreg-abortsystemshutdowna) может прерывать таймер и предотвращать завершение работы компьютера.</span><span class="sxs-lookup"><span data-stu-id="ecf12-113">While this dialog box is displayed, the [**AbortSystemShutdown**](/windows/desktop/api/Winreg/nf-winreg-abortsystemshutdowna) function can stop the timer and prevent the computer from shutting down.</span></span> <span data-ttu-id="ecf12-114">Однако если срок действия таймера истекает, компьютер завершает работу.</span><span class="sxs-lookup"><span data-stu-id="ecf12-114">However, if the timer expires, the computer is shut down.</span></span> <span data-ttu-id="ecf12-115">Эти функции также могут перезапустить компьютер после завершения операции отключения.</span><span class="sxs-lookup"><span data-stu-id="ecf12-115">These functions can also restart the computer following a shutdown operation.</span></span> <span data-ttu-id="ecf12-116">Дополнительные сведения см. [в разделе Отображение диалогового окна "завершение работы"](displaying-the-shutdown-dialog-box.md).</span><span class="sxs-lookup"><span data-stu-id="ecf12-116">For more information, see [Displaying the Shutdown Dialog Box](displaying-the-shutdown-dialog-box.md).</span></span>

## <a name="shutdown-notifications"></a><span data-ttu-id="ecf12-117">Уведомления о завершении работы</span><span class="sxs-lookup"><span data-stu-id="ecf12-117">Shutdown Notifications</span></span>

<span data-ttu-id="ecf12-118">Приложения с окном и очередью сообщений получают уведомления о завершении работы через сообщения [**WM \_ Куерендсессион**](wm-queryendsession.md) и [**WM \_ ENDSESSION**](wm-endsession.md) .</span><span class="sxs-lookup"><span data-stu-id="ecf12-118">Applications with a window and message queue receive shutdown notifications through the [**WM\_QUERYENDSESSION**](wm-queryendsession.md) and [**WM\_ENDSESSION**](wm-endsession.md) messages.</span></span> <span data-ttu-id="ecf12-119">Эти приложения должны возвращать **значение true** , чтобы указать, что они могут быть завершены.</span><span class="sxs-lookup"><span data-stu-id="ecf12-119">These applications should return **TRUE** to indicate that they can be terminated.</span></span> <span data-ttu-id="ecf12-120">Приложения не должны блокировать завершение работы системы, если это не является абсолютно необходимым.</span><span class="sxs-lookup"><span data-stu-id="ecf12-120">Applications should not block system shutdown unless it is absolutely necessary.</span></span> <span data-ttu-id="ecf12-121">Приложения должны выполнять необходимую очистку при обработке **WM \_ ENDSESSION**.</span><span class="sxs-lookup"><span data-stu-id="ecf12-121">Applications should perform any required cleanup while processing **WM\_ENDSESSION**.</span></span> <span data-ttu-id="ecf12-122">Приложения с несохраненными данными могут сохранить данные во временном расположении и восстановить их при следующем запуске приложения.</span><span class="sxs-lookup"><span data-stu-id="ecf12-122">Applications that have unsaved data could save the data to a temporary location and restore it the next time the application starts.</span></span> <span data-ttu-id="ecf12-123">Рекомендуется часто сохранять данные и состояние приложений. Например, автоматическое сохранение данных между операциями сохранения, инициированными пользователем, для уменьшения объема данных, сохраняемых при завершении работы.</span><span class="sxs-lookup"><span data-stu-id="ecf12-123">It is recommended that applications save their data and state frequently; for example, automatically save data between save operations initiated by the user to reduce the amount of data to be saved at shutdown.</span></span>

<span data-ttu-id="ecf12-124">Консольные приложения получают уведомления о завершении работы в своих подпрограммых обработчиков.</span><span class="sxs-lookup"><span data-stu-id="ecf12-124">Console applications receive shutdown notifications in their handler routines.</span></span> <span data-ttu-id="ecf12-125">Чтобы зарегистрировать обработчик консоли, используйте функцию [**SetConsoleCtrlHandler**](/windows/console/setconsolectrlhandler) .</span><span class="sxs-lookup"><span data-stu-id="ecf12-125">To register a console handler, use the [**SetConsoleCtrlHandler**](/windows/console/setconsolectrlhandler) function.</span></span>

<span data-ttu-id="ecf12-126">Приложения службы получают уведомления о завершении работы в своих подпрограммых обработчиков.</span><span class="sxs-lookup"><span data-stu-id="ecf12-126">Service applications receive shutdown notifications in their handler routines.</span></span> <span data-ttu-id="ecf12-127">Чтобы зарегистрировать обработчик управления службой, используйте функцию [**регистерсервицектрлхандлерекс**](/windows/win32/api/winsvc/nf-winsvc-registerservicectrlhandlerexa) .</span><span class="sxs-lookup"><span data-stu-id="ecf12-127">To register a service control handler, use the [**RegisterServiceCtrlHandlerEx**](/windows/win32/api/winsvc/nf-winsvc-registerservicectrlhandlerexa) function.</span></span>

## <a name="blocking-shutdown"></a><span data-ttu-id="ecf12-128">Блокировка завершения работы</span><span class="sxs-lookup"><span data-stu-id="ecf12-128">Blocking Shutdown</span></span>

<span data-ttu-id="ecf12-129">Если приложение должно блокировать потенциальное завершение работы системы, оно может вызвать функцию [**шутдовнблоккреасонкреате**](/windows/desktop/api/Winuser/nf-winuser-shutdownblockreasoncreate) .</span><span class="sxs-lookup"><span data-stu-id="ecf12-129">If an application must block a potential system shutdown, it can call the [**ShutdownBlockReasonCreate**](/windows/desktop/api/Winuser/nf-winuser-shutdownblockreasoncreate) function.</span></span> <span data-ttu-id="ecf12-130">Вызывающий объект предоставляет строку причины, которая будет отображаться пользователю.</span><span class="sxs-lookup"><span data-stu-id="ecf12-130">The caller provides a reason string that will be displayed to the user.</span></span> <span data-ttu-id="ecf12-131">Строка причины должна быть короткой и ясной, предоставляя пользователю сведения, необходимые для принятия решения о необходимости продолжения работы системы.</span><span class="sxs-lookup"><span data-stu-id="ecf12-131">The reason string should be short and clear, providing the user with the information necessary to decide whether to continue shutting down the system.</span></span>

## <a name="related-topics"></a><span data-ttu-id="ecf12-132">См. также</span><span class="sxs-lookup"><span data-stu-id="ecf12-132">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ecf12-133">Завершение работы системы</span><span class="sxs-lookup"><span data-stu-id="ecf12-133">How to Shut Down the System</span></span>](how-to-shut-down-the-system.md)
</dt> </dl>

 

 
