---
description: В следующей таблице перечислены различия между завершением работы в Windows Vista и Windows XP.
ms.assetid: da7985d2-85c8-47e1-a172-c9e92f450e24
title: Изменения завершения работы Windows Vista
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6e04bb20099349ce378384cf01c39e53ca03a896
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104080841"
---
# <a name="shutdown-changes-for-windows-vista"></a><span data-ttu-id="4a1bc-103">Изменения завершения работы Windows Vista</span><span class="sxs-lookup"><span data-stu-id="4a1bc-103">Shutdown Changes for Windows Vista</span></span>

<span data-ttu-id="4a1bc-104">В следующей таблице перечислены различия между завершением работы в Windows Vista и Windows XP.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-104">The following table summarizes the differences between shutdown on Windows Vista and Windows XP.</span></span>



| <span data-ttu-id="4a1bc-105">Функция</span><span class="sxs-lookup"><span data-stu-id="4a1bc-105">Feature</span></span>                 | <span data-ttu-id="4a1bc-106">Windows XP</span><span class="sxs-lookup"><span data-stu-id="4a1bc-106">Windows XP</span></span>                                                                                                                                                                                                                                                                                                                                                                                | <span data-ttu-id="4a1bc-107">Windows Vista</span><span class="sxs-lookup"><span data-stu-id="4a1bc-107">Windows Vista</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="4a1bc-108">Блокировка завершения работы</span><span class="sxs-lookup"><span data-stu-id="4a1bc-108">Blocking shutdown</span></span>       | <span data-ttu-id="4a1bc-109">Приложения могут задержать реагирование на [**WM \_ куерендсессион**](wm-queryendsession.md) в течение 5 секунд, а система позволяет пользователю завершить работу приложения.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-109">Applications can delay responding to [**WM\_QUERYENDSESSION**](wm-queryendsession.md) for 5 seconds, then the system allows the user to terminate the application.</span></span> <span data-ttu-id="4a1bc-110">Приложения, возвращающие **значение true** в ответ на **\_ куерендсессион WM** , могут отреагировать на [**\_ ENDSESSION WM**](wm-endsession.md) в течение 5 секунд, после чего система разрешает пользователю завершить работу приложения.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-110">Applications that return **TRUE** in response to **WM\_QUERYENDSESSION** can delay responding to [**WM\_ENDSESSION**](wm-endsession.md) for 5 seconds, then the system allows the user to terminate the application.</span></span> | <span data-ttu-id="4a1bc-111">Приложения могут отреагировать на запросы [**WM \_ куерендсессион**](wm-queryendsession.md) в течение 5 секунд, после чего система разрешает пользователю продолжить или отменить завершение работы.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-111">Applications can delay responding to [**WM\_QUERYENDSESSION**](wm-queryendsession.md) for 5 seconds, then the system allows the user to continue or cancel shutdown.</span></span> <span data-ttu-id="4a1bc-112">Приложения, возвращающие **значение true** в ответ на **\_ куерендсессион WM** , могут задержать ответ на [**\_ ENDSESSION WM**](wm-endsession.md) в течение 5 секунд, после чего система разрешает пользователю продолжить или отменить завершение работы.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-112">Applications that return **TRUE** in response to **WM\_QUERYENDSESSION** can delay responding to [**WM\_ENDSESSION**](wm-endsession.md) for 5 seconds, then the system allows the user to continue or cancel shutdown.</span></span>                                                                                                      |
| <span data-ttu-id="4a1bc-113">Отмена завершения работы</span><span class="sxs-lookup"><span data-stu-id="4a1bc-113">Canceling shutdown</span></span>      | <span data-ttu-id="4a1bc-114">Если приложение возвращает **значение false** в ответ на [**WM \_ куерендсессион**](wm-queryendsession.md), в большинстве случаев завершение работы отменяется.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-114">If an application returns **FALSE** in response to [**WM\_QUERYENDSESSION**](wm-queryendsession.md), shutdown is canceled in most cases.</span></span> <span data-ttu-id="4a1bc-115">Однако пользовательский интерфейс не отображается, поэтому пользователь может не знать, что завершение работы отменено.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-115">However, no UI is displayed, so the user may not be aware that shutdown has been canceled.</span></span>                                                                                                                                                      | <span data-ttu-id="4a1bc-116">Если приложение возвращает **значение false** в ответ на [**WM \_ куерендсессион**](wm-queryendsession.md), оно по-прежнему отображается в пользовательском интерфейсе завершения работы.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-116">If an application returns **FALSE** in response to [**WM\_QUERYENDSESSION**](wm-queryendsession.md), it still appears in the shutdown UI.</span></span> <span data-ttu-id="4a1bc-117">Обратите внимание, что система не позволяет консольным приложениям или приложениям без видимого окна отменить завершение работы.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-117">Note that the system does not allow console applications or applications without a visible window to cancel shutdown.</span></span> <span data-ttu-id="4a1bc-118">Эти приложения автоматически завершаются, если они не отвечают на **WM \_ Куерендсессион** или [**WM \_ ENDSESSION**](wm-endsession.md) в течение 5 секунд или если они возвращают **значение false** в ответ на **\_ куерендсессион WM**.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-118">These applications are automatically terminated if they do not respond to **WM\_QUERYENDSESSION** or [**WM\_ENDSESSION**](wm-endsession.md) within 5 seconds or if they return **FALSE** in response to **WM\_QUERYENDSESSION**.</span></span> |
| <span data-ttu-id="4a1bc-119">Пользовательский интерфейс завершения работы</span><span class="sxs-lookup"><span data-stu-id="4a1bc-119">Shutdown user interface</span></span> | <span data-ttu-id="4a1bc-120">Система отображает диалоговое окно для каждого приложения, блокирующего завершение работы.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-120">The system displays a dialog box for each application blocking shutdown.</span></span> <span data-ttu-id="4a1bc-121">Если пользователь настроил кнопку **End Now (Готово** ), приложение будет завершено.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-121">If the user click the **End Now** button, the application is terminated.</span></span> <span data-ttu-id="4a1bc-122">Если пользователь нажмет кнопку **Отмена** , завершение работы отменяется и приложение продолжит работу.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-122">If the user clicks the **Cancel** button, shutdown is canceled and the application continues to run.</span></span>                                                                                                                                    | <span data-ttu-id="4a1bc-123">Система отображает полный экран пользовательского интерфейса, который определяет все приложения, блокирующие завершение работы, и их причины (если они зарегистрировали причину с помощью [**шутдовнблоккреасонкреате**](/windows/desktop/api/Winuser/nf-winuser-shutdownblockreasoncreate)).</span><span class="sxs-lookup"><span data-stu-id="4a1bc-123">The system displays a full-screen UI that identifies all applications blocking shutdown and their reasons for doing so (if they have registered a reason using [**ShutdownBlockReasonCreate**](/windows/desktop/api/Winuser/nf-winuser-shutdownblockreasoncreate)).</span></span>                                                                                                                                                                                                                                                                    |



 

## <a name="best-practices"></a><span data-ttu-id="4a1bc-124">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="4a1bc-124">Best Practices</span></span>

-   <span data-ttu-id="4a1bc-125">Приложения не должны блокировать завершение работы.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-125">Applications should not block shutdown.</span></span> <span data-ttu-id="4a1bc-126">Реагирование на [**WM \_ куерендсессион**](wm-queryendsession.md) как можно быстрее и откладывать действия очистки до обработки сообщения [**WM \_ ENDSESSION**](wm-endsession.md) .</span><span class="sxs-lookup"><span data-stu-id="4a1bc-126">Respond to [**WM\_QUERYENDSESSION**](wm-queryendsession.md) as quickly as possible and postpone cleanup activities until processing the [**WM\_ENDSESSION**](wm-endsession.md) message.</span></span>
-   <span data-ttu-id="4a1bc-127">Приложения, которые должны блокировать завершение работы, должны использовать новую функцию [**шутдовнблоккреасонкреате**](/windows/desktop/api/Winuser/nf-winuser-shutdownblockreasoncreate) для регистрации строки, объясняющей причину для пользователя.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-127">Applications that must block shutdown should use the new [**ShutdownBlockReasonCreate**](/windows/desktop/api/Winuser/nf-winuser-shutdownblockreasoncreate) function to register a string that explains the reason to the user.</span></span> <span data-ttu-id="4a1bc-128">Пользователь может решить, следует ли продолжить или отменить завершение работы.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-128">The user can decide whether to continue or cancel shutdown.</span></span>
-   <span data-ttu-id="4a1bc-129">Приложения не могут полагаться на возможность блокировать завершение работы.</span><span class="sxs-lookup"><span data-stu-id="4a1bc-129">Applications cannot rely on being able to block shutdown.</span></span>

 

 



