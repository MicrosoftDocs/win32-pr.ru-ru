---
description: Упрощенные блокировки потоков чтения/записи (SRW) позволяют потокам одного процесса получать доступ к общим ресурсам. они оптимизированы для ускорения и занимают очень мало памяти.
ms.assetid: 2d439b21-291f-4ff0-910a-c1c27e800019
title: Упрощенные блокировки потоков чтения/записи (SRW)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fe7d76d956e1425531eae43b0daa6817002a92bc
ms.sourcegitcommit: 663239b4560bfd5314e86901c65805c9bbcab07d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2021
ms.locfileid: "105664781"
---
# <a name="slim-readerwriter-srw-locks"></a><span data-ttu-id="808b8-103">Упрощенные блокировки потоков чтения/записи (SRW)</span><span class="sxs-lookup"><span data-stu-id="808b8-103">Slim Reader/Writer (SRW) Locks</span></span>

<span data-ttu-id="808b8-104">Упрощенные блокировки потоков чтения/записи (SRW) позволяют потокам одного процесса получать доступ к общим ресурсам. они оптимизированы для ускорения и занимают очень мало памяти.</span><span class="sxs-lookup"><span data-stu-id="808b8-104">Slim reader/writer (SRW) locks enable the threads of a single process to access shared resources; they are optimized for speed and occupy very little memory.</span></span> <span data-ttu-id="808b8-105">Упрощенные блокировки чтения и записи не могут совместно использоваться разными процессами.</span><span class="sxs-lookup"><span data-stu-id="808b8-105">Slim reader-writer locks cannot be shared across processes.</span></span>

<span data-ttu-id="808b8-106">Потоки чтения считывают данные из общего ресурса, а потоки записи записывают данные в общий ресурс.</span><span class="sxs-lookup"><span data-stu-id="808b8-106">Reader threads read data from a shared resource whereas writer threads write data to a shared resource.</span></span> <span data-ttu-id="808b8-107">Когда несколько потоков считываются и записываются с помощью общего ресурса, монопольные блокировки, такие как критический раздел или мьютекс, могут стать узким местом, если потоки чтения работают непрерывно, но операции записи являются редкими.</span><span class="sxs-lookup"><span data-stu-id="808b8-107">When multiple threads are reading and writing using a shared resource, exclusive locks such as a critical section or mutex can become a bottleneck if the reader threads run continuously but write operations are rare.</span></span>

<span data-ttu-id="808b8-108">Блокировки SRW предоставляют два режима, в которых потоки могут получить доступ к общему ресурсу:</span><span class="sxs-lookup"><span data-stu-id="808b8-108">SRW locks provide two modes in which threads can access a shared resource:</span></span>

-   <span data-ttu-id="808b8-109">**Общий режим**, который предоставляет общий доступ только для чтения к нескольким потокам чтения, что позволяет им одновременно считывать данные из общего ресурса.</span><span class="sxs-lookup"><span data-stu-id="808b8-109">**Shared mode**, which grants shared read-only access to multiple reader threads, which enables them to read data from the shared resource concurrently.</span></span> <span data-ttu-id="808b8-110">Если операции чтения превышают операции записи, этот параллелизм повышает производительность и пропускную способность по сравнению с критическими секциями.</span><span class="sxs-lookup"><span data-stu-id="808b8-110">If read operations exceed write operations, this concurrency increases performance and throughput compared to critical sections.</span></span>
    > [!NOTE]
    > <span data-ttu-id="808b8-111">Блокировки SRW в общем режиме не должны быть получены рекурсивно, так как это может привести к взаимоблокировкам при объединении с монопольным получением.</span><span class="sxs-lookup"><span data-stu-id="808b8-111">Shared mode SRW locks should not be acquired recursively as this can lead to deadlocks when combined with exclusive acquisition.</span></span>

-   <span data-ttu-id="808b8-112">**Монопольный режим**, который предоставляет доступ на чтение и запись в один поток записи за раз.</span><span class="sxs-lookup"><span data-stu-id="808b8-112">**Exclusive mode**, which grants read/write access to one writer thread at a time.</span></span> <span data-ttu-id="808b8-113">Когда блокировка была получена в монопольном режиме, другой поток не сможет получить доступ к общему ресурсу до тех пор, пока модуль записи не освободит блокировку.</span><span class="sxs-lookup"><span data-stu-id="808b8-113">When the lock has been acquired in exclusive mode, no other thread can access the shared resource until the writer releases the lock.</span></span>
    > [!NOTE]
    > <span data-ttu-id="808b8-114">Блокировки с монопольным режимом SRW не могут быть получены рекурсивно.</span><span class="sxs-lookup"><span data-stu-id="808b8-114">Exclusive mode SRW locks cannot be acquired recursively.</span></span> <span data-ttu-id="808b8-115">Если поток пытается получить блокировку, которую он уже содержит, то эта попытка завершится ошибкой (для [**тряккуиресрвлоккексклусиве**](/windows/win32/api/synchapi/nf-synchapi-tryacquiresrwlockexclusive)) или взаимоблокировкой (для [**AcquireSRWLockExclusive**](/windows/win32/api/synchapi/nf-synchapi-acquiresrwlockexclusive)).</span><span class="sxs-lookup"><span data-stu-id="808b8-115">If a thread tries to acquire a lock that it already holds, that attempt will fail (for [**TryAcquireSRWLockExclusive**](/windows/win32/api/synchapi/nf-synchapi-tryacquiresrwlockexclusive)) or deadlock (for [**AcquireSRWLockExclusive**](/windows/win32/api/synchapi/nf-synchapi-acquiresrwlockexclusive))</span></span>

<span data-ttu-id="808b8-116">Одну блокировку SRW можно получить в любом из режимов. потоки чтения могут получить его в общем режиме, тогда как потоки модуля записи могут получить его в монопольном режиме.</span><span class="sxs-lookup"><span data-stu-id="808b8-116">A single SRW lock can be acquired in either mode; reader threads can acquire it in shared mode whereas writer threads can acquire it in exclusive mode.</span></span> <span data-ttu-id="808b8-117">Не гарантируется порядок, в котором для потоков, запрашивающих владение, будет предоставлен владение. Блокировки SRW не являются ни честными, ни FIFO.</span><span class="sxs-lookup"><span data-stu-id="808b8-117">There is no guarantee about the order in which threads that request ownership will be granted ownership; SRW locks are neither fair nor FIFO.</span></span>

<span data-ttu-id="808b8-118">Блокировка SRW — это размер указателя.</span><span class="sxs-lookup"><span data-stu-id="808b8-118">An SRW lock is the size of a pointer.</span></span> <span data-ttu-id="808b8-119">Преимущество в том, что обновление состояния блокировки происходит быстро.</span><span class="sxs-lookup"><span data-stu-id="808b8-119">The advantage is that it is fast to update the lock state.</span></span> <span data-ttu-id="808b8-120">Недостаток заключается в том, что можно хранить очень мало информации о состоянии, поэтому блокировки SRW не обнаруживают неправильное рекурсивное использование в общем режиме.</span><span class="sxs-lookup"><span data-stu-id="808b8-120">The disadvantage is that very little state information can be stored, so SRW locks do not detect incorrect recursive use in shared mode.</span></span> <span data-ttu-id="808b8-121">Кроме того, поток, владеющий блокировкой SRW в общем режиме, не может обновить его владение монопольным режимом.</span><span class="sxs-lookup"><span data-stu-id="808b8-121">In addition, a thread that owns an SRW lock in shared mode cannot upgrade its ownership of the lock to exclusive mode.</span></span>

<span data-ttu-id="808b8-122">Вызывающий объект должен выделить структуру SRWLOCK и инициализировать ее путем вызова [**инитиализесрвлокк**](/windows/win32/api/synchapi/nf-synchapi-initializesrwlock) (для динамической инициализации структуры) или назначения константы **SRWLock \_ init** переменной структуры (для статической инициализации структуры).</span><span class="sxs-lookup"><span data-stu-id="808b8-122">The caller must allocate an SRWLOCK structure and initialize it by either calling [**InitializeSRWLock**](/windows/win32/api/synchapi/nf-synchapi-initializesrwlock) (to initialize the structure dynamically) or assign the constant **SRWLOCK\_INIT** to the structure variable (to initialize the structure statically).</span></span>

<span data-ttu-id="808b8-123">[Средство проверки приложений](/windows-hardware/drivers/devtest/application-verifier) можно использовать для поиска рекурсивного (повторного) использования блокировок SRW.</span><span class="sxs-lookup"><span data-stu-id="808b8-123">You can use [Application Verifier](/windows-hardware/drivers/devtest/application-verifier) to find recursive (reentrant) use of SRW locks.</span></span>

<span data-ttu-id="808b8-124">Ниже приведены функции блокировки SRW.</span><span class="sxs-lookup"><span data-stu-id="808b8-124">The following are the SRW lock functions.</span></span>

| <span data-ttu-id="808b8-125">Функция блокировки SRW</span><span class="sxs-lookup"><span data-stu-id="808b8-125">SRW lock function</span></span>                                                | <span data-ttu-id="808b8-126">Описание</span><span class="sxs-lookup"><span data-stu-id="808b8-126">Description</span></span>                                                                                                                                       |
|------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="808b8-127">**AcquireSRWLockExclusive**</span><span class="sxs-lookup"><span data-stu-id="808b8-127">**AcquireSRWLockExclusive**</span></span>](/windows/win32/api/synchapi/nf-synchapi-acquiresrwlockexclusive)       | <span data-ttu-id="808b8-128">Получает блокировку SRW в монопольном режиме.</span><span class="sxs-lookup"><span data-stu-id="808b8-128">Acquires an SRW lock in exclusive mode.</span></span>                                                                                                           |
| [<span data-ttu-id="808b8-129">**аккуиресрвлоккшаред**</span><span class="sxs-lookup"><span data-stu-id="808b8-129">**AcquireSRWLockShared**</span></span>](/windows/win32/api/synchapi/nf-synchapi-acquiresrwlockshared)             | <span data-ttu-id="808b8-130">Получает блокировку SRW в общем режиме.</span><span class="sxs-lookup"><span data-stu-id="808b8-130">Acquires an SRW lock in shared mode.</span></span>                                                                                                              |
| [<span data-ttu-id="808b8-131">**инитиализесрвлокк**</span><span class="sxs-lookup"><span data-stu-id="808b8-131">**InitializeSRWLock**</span></span>](/windows/win32/api/synchapi/nf-synchapi-initializesrwlock)                   | <span data-ttu-id="808b8-132">Инициализация блокировки SRW.</span><span class="sxs-lookup"><span data-stu-id="808b8-132">Initialize an SRW lock.</span></span>                                                                                                                           |
| [<span data-ttu-id="808b8-133">**ReleaseSRWLockExclusive**</span><span class="sxs-lookup"><span data-stu-id="808b8-133">**ReleaseSRWLockExclusive**</span></span>](/windows/win32/api/synchapi/nf-synchapi-releasesrwlockexclusive)       | <span data-ttu-id="808b8-134">Освобождает блокировку SRW, которая была открыта в монопольном режиме.</span><span class="sxs-lookup"><span data-stu-id="808b8-134">Releases an SRW lock that was opened in exclusive mode.</span></span>                                                                                           |
| [<span data-ttu-id="808b8-135">**ReleaseSRWLockShared**</span><span class="sxs-lookup"><span data-stu-id="808b8-135">**ReleaseSRWLockShared**</span></span>](/windows/win32/api/synchapi/nf-synchapi-releasesrwlockshared)             | <span data-ttu-id="808b8-136">Освобождает блокировку SRW, которая была открыта в режиме общего доступа.</span><span class="sxs-lookup"><span data-stu-id="808b8-136">Releases an SRW lock that was opened in shared mode.</span></span>                                                                                              |
| [<span data-ttu-id="808b8-137">**SleepConditionVariableSRW**</span><span class="sxs-lookup"><span data-stu-id="808b8-137">**SleepConditionVariableSRW**</span></span>](/windows/win32/api/synchapi/nf-synchapi-sleepconditionvariablesrw)   | <span data-ttu-id="808b8-138">Закрывает указанную переменную условия и освобождает указанную блокировку как атомарную операцию.</span><span class="sxs-lookup"><span data-stu-id="808b8-138">Sleeps on the specified condition variable and releases the specified lock as an atomic operation.</span></span>                                                |
| [<span data-ttu-id="808b8-139">**тряккуиресрвлоккексклусиве**</span><span class="sxs-lookup"><span data-stu-id="808b8-139">**TryAcquireSRWLockExclusive**</span></span>](/windows/win32/api/synchapi/nf-synchapi-tryacquiresrwlockexclusive) | <span data-ttu-id="808b8-140">Пытается получить упрощенную блокировку чтения/записи (SRW) в монопольном режиме.</span><span class="sxs-lookup"><span data-stu-id="808b8-140">Attempts to acquire a slim reader/writer (SRW) lock in exclusive mode.</span></span> <span data-ttu-id="808b8-141">Если вызов выполнен успешно, вызывающий поток принимает владение блокировкой.</span><span class="sxs-lookup"><span data-stu-id="808b8-141">If the call is successful, the calling thread takes ownership of the lock.</span></span> |
| [<span data-ttu-id="808b8-142">**тряккуиресрвлоккшаред**</span><span class="sxs-lookup"><span data-stu-id="808b8-142">**TryAcquireSRWLockShared**</span></span>](/windows/win32/api/synchapi/nf-synchapi-tryacquiresrwlockshared)       | <span data-ttu-id="808b8-143">Пытается получить блокировку упрощенного чтения/записи (SRW) в общем режиме.</span><span class="sxs-lookup"><span data-stu-id="808b8-143">Attempts to acquire a slim reader/writer (SRW) lock in shared mode.</span></span> <span data-ttu-id="808b8-144">Если вызов выполнен успешно, вызывающий поток принимает владение блокировкой.</span><span class="sxs-lookup"><span data-stu-id="808b8-144">If the call is successful, the calling thread takes ownership of the lock.</span></span>    |

 
