---
description: Барьер синхронизации позволяет нескольким потокам ожидать до тех пор, пока все потоки достигли определенной точки выполнения до того, как поток будет продолжен.
ms.assetid: 3A76E6F7-C38B-4843-9496-36F3C78B700C
title: Барьеры синхронизации
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4276f0bbc5a10eef391c12cc51ebd475e563bd44
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104272248"
---
# <a name="synchronization-barriers"></a><span data-ttu-id="b3618-103">Барьеры синхронизации</span><span class="sxs-lookup"><span data-stu-id="b3618-103">Synchronization Barriers</span></span>

<span data-ttu-id="b3618-104">Барьер синхронизации позволяет нескольким потокам ожидать до тех пор, пока все потоки достигли определенной точки выполнения до того, как поток будет продолжен.</span><span class="sxs-lookup"><span data-stu-id="b3618-104">A synchronization barrier enables multiple threads to wait until all threads have all reached a particular point of execution before any thread continues.</span></span> <span data-ttu-id="b3618-105">Барьеры синхронизации нельзя совместно использовать в процессах.</span><span class="sxs-lookup"><span data-stu-id="b3618-105">Synchronization barriers cannot be shared across processes.</span></span>

<span data-ttu-id="b3618-106">Барьеры синхронизации полезны для поэтапных вычислений, в которых потоки, выполняющие один и тот же код в параллельном режиме, должны пройти один этап перед переходом к следующему.</span><span class="sxs-lookup"><span data-stu-id="b3618-106">Synchronization barriers are useful for phased computations, in which threads executing the same code in parallel must all complete one phase before moving on to the next.</span></span>

<span data-ttu-id="b3618-107">Чтобы создать барьер синхронизации, вызовите функцию [**инитиализесинчронизатионбарриер**](/windows/desktop/api/SynchAPI/nf-synchapi-initializesynchronizationbarrier) и укажите максимальное число потоков и количество раз, которое поток должен прокрутить перед его блокированием.</span><span class="sxs-lookup"><span data-stu-id="b3618-107">To create a synchronization barrier, call the [**InitializeSynchronizationBarrier**](/windows/desktop/api/SynchAPI/nf-synchapi-initializesynchronizationbarrier) function and specify a maximum number of threads and how many times a thread should spin before it blocks.</span></span> <span data-ttu-id="b3618-108">Затем запустите потоки, которые будут использовать барьер.</span><span class="sxs-lookup"><span data-stu-id="b3618-108">Then launch the threads that will use the barrier.</span></span> <span data-ttu-id="b3618-109">После того как каждый поток завершит свою работу, он вызывает [**ентерсинчронизатионбарриер**](/windows/desktop/api/synchapi/nf-synchapi-entersynchronizationbarrier) для ожидания в барьере.</span><span class="sxs-lookup"><span data-stu-id="b3618-109">After each thread finishes its work, it calls [**EnterSynchronizationBarrier**](/windows/desktop/api/synchapi/nf-synchapi-entersynchronizationbarrier) to wait at the barrier.</span></span> <span data-ttu-id="b3618-110">Функция **ентерсинчронизатионбарриер** блокирует каждый поток до тех пор, пока количество потоков, блокируемых в барьере, не достигнет максимального числа потоков для барьера, после чего **ентерсинчронизатионбарриер** разблокирует все потоки.</span><span class="sxs-lookup"><span data-stu-id="b3618-110">The **EnterSynchronizationBarrier** function blocks each thread until the number of threads blocked in the barrier reaches the maximum thread count for the barrier, at which point **EnterSynchronizationBarrier** unblocks all the threads.</span></span> <span data-ttu-id="b3618-111">Функция **ентерсинчронизатионбарриер** возвращает **значение true** только для одного из потоков, которые входили в барьер, и возвращает **false** для всех остальных потоков.</span><span class="sxs-lookup"><span data-stu-id="b3618-111">The **EnterSynchronizationBarrier** function returns **TRUE** for exactly one of the threads that entered the barrier, and returns **FALSE** for all other threads.</span></span>

<span data-ttu-id="b3618-112">Чтобы освободить барьер синхронизации, когда он больше не нужен, вызовите [**делетесинчронизатионбарриер**](/windows/desktop/api/SynchAPI/nf-synchapi-deletesynchronizationbarrier).</span><span class="sxs-lookup"><span data-stu-id="b3618-112">To release a synchronization barrier when it is no longer needed, call [**DeleteSynchronizationBarrier**](/windows/desktop/api/SynchAPI/nf-synchapi-deletesynchronizationbarrier).</span></span> <span data-ttu-id="b3618-113">Вызвать эту функцию можно сразу же после вызова [**ентерсинчронизатионбарриер**](/windows/desktop/api/synchapi/nf-synchapi-entersynchronizationbarrier) , так как эта функция гарантирует, что все потоки завершили работу с барьером до его освобождения.</span><span class="sxs-lookup"><span data-stu-id="b3618-113">It is safe to call this function immediately after calling [**EnterSynchronizationBarrier**](/windows/desktop/api/synchapi/nf-synchapi-entersynchronizationbarrier) because that function ensures that all threads have finished using the barrier before it is released.</span></span>

<span data-ttu-id="b3618-114">Если барьер синхронизации никогда не будет удален, потоки могут указать в качестве **барьера синхронизации флаги " \_ \_ \_ без \_ удаления** " при входе в барьер.</span><span class="sxs-lookup"><span data-stu-id="b3618-114">If a synchronization barrier will never be deleted, threads can specify the **SYNCHRONIZATION\_BARRIER\_FLAGS\_NO\_DELETE** flag when they enter the barrier.</span></span> <span data-ttu-id="b3618-115">Этот флаг должен быть указан во всех потоках, использующих барьер. Если какой-либо поток не имеет значение, флаг игнорируется.</span><span class="sxs-lookup"><span data-stu-id="b3618-115">All threads using the barrier must specify this flag; if any thread does not, the flag is ignored.</span></span> <span data-ttu-id="b3618-116">Этот флаг заставляет функцию пропустить дополнительную работу, необходимую для безопасности удаления, что может повысить производительность.</span><span class="sxs-lookup"><span data-stu-id="b3618-116">This flag causes the function to skip the extra work required for deletion safety, which can improve performance.</span></span> <span data-ttu-id="b3618-117">Обратите внимание, что удаление барьера, когда этот флаг действует, может привести к недопустимому доступу к обработке и одному или нескольким постоянным заблокированным потокам.</span><span class="sxs-lookup"><span data-stu-id="b3618-117">Note that deleting a barrier while this flag is in effect may result in an invalid handle access and one or more permanently blocked threads.</span></span>

 

 



