---
description: В этом разделе приведены рекомендации по выполнению асинхронных операций агента Центр обновления Windows (WUA).
ms.assetid: 1fb16904-732d-4341-8267-ab8896fc0f7c
title: Рекомендации по асинхронным операциям WUA
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c1a4b2198a235d9a03e3730e5d6dce2cd54c0e1f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105711606"
---
# <a name="guidelines-for-asynchronous-wua-operations"></a><span data-ttu-id="42852-103">Рекомендации по асинхронным операциям WUA</span><span class="sxs-lookup"><span data-stu-id="42852-103">Guidelines for Asynchronous WUA Operations</span></span>

<span data-ttu-id="42852-104">В этом разделе приведены рекомендации по выполнению асинхронных операций агента Центр обновления Windows (WUA).</span><span class="sxs-lookup"><span data-stu-id="42852-104">This topic identifies guidelines for you to the follow when you perform asynchronous Windows Update Agent (WUA) operations.</span></span>

-   <span data-ttu-id="42852-105">Асинхронные операции WUA не гарантируют определенную скорость выполнения.</span><span class="sxs-lookup"><span data-stu-id="42852-105">The asynchronous WUA operations do not guarantee any particular completion speed.</span></span> <span data-ttu-id="42852-106">Время завершения асинхронной операции WUA может сильно различаться в зависимости от оборудования компьютера, версии операционной системы и конфигурации сети.</span><span class="sxs-lookup"><span data-stu-id="42852-106">The completion time for an asynchronous WUA operation can vary widely depending on computer hardware, version of the operating system, and network configuration.</span></span> <span data-ttu-id="42852-107">Как и в случае с другими API Windows, которые имеют зависимости сети и не содержат параметр времени ожидания или задокументированное время ожидания, рекомендуется реализовать собственные механизмы времени ожидания, если требуется гарантированное время ответа.</span><span class="sxs-lookup"><span data-stu-id="42852-107">As with other Windows APIs that have network dependencies and that do not contain a time-out parameter or a documented time-out duration, we recommend that you consider implementing your own time-out mechanisms if you need guaranteed response times.</span></span> <span data-ttu-id="42852-108">Например, можно создать рабочий поток, вызывающий асинхронный метод WUA и задающий событие или другой объект синхронизации по завершении асинхронной операции WUA. Затем главный поток может использовать функцию [**WaitForSingleObject**](/windows/desktop/api/synchapi/nf-synchapi-waitforsingleobject) или [**WaitForMultipleObjects**](/windows/desktop/api/synchapi/nf-synchapi-waitformultipleobjects) , которая позволяет указать значение времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="42852-108">For example, you can create a worker thread that calls an asynchronous WUA method and that sets an event or other synchronization object when the asynchronous WUA operation completes; the main thread can then use the [**WaitForSingleObject**](/windows/desktop/api/synchapi/nf-synchapi-waitforsingleobject) or [**WaitForMultipleObjects**](/windows/desktop/api/synchapi/nf-synchapi-waitformultipleobjects) function, which allows you to specify a time-out value.</span></span>
-   <span data-ttu-id="42852-109">При завершении поиска, скачивания, установки или удаления обновлений можно использовать [**иупдатесеарчер:: ендсеарч**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-endsearch), [**Иупдатедовлоадер:: метод**](/windows/desktop/api/Wuapi/nn-wuapi-iupdatedownloader), [**Иупдатеинсталлер:: Ендинсталл**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-endinstall) и [**иупдатеинсталлер:: EndUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-enduninstall) из любого потока.</span><span class="sxs-lookup"><span data-stu-id="42852-109">When you end a search, download, installation, or uninstallation of updates, you can use [**IUpdateSearcher::EndSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-endsearch), [**IUpdateDowloader::EndDownload**](/windows/desktop/api/Wuapi/nn-wuapi-iupdatedownloader), [**IUpdateInstaller::EndInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-endinstall) and [**IUpdateInstaller::EndUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-enduninstall) from any thread.</span></span>
-   <span data-ttu-id="42852-110">При запуске поиска, скачивания, установки или удаления обновлений с помощью [**иупдатесеарчер:: бегинсеарч**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-beginsearch), [**Иупдатедовнлоадер:: BeginDownload**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatedownloader-begindownload), [**Иупдатеинсталлер:: Бегининсталл**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-begininstall)и [**иупдатеинсталлер:: BeginUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-beginuninstall)убедитесь, что при освобождении ссылок на объекты API WUA вы сохраняете достаточно прав доступа разрешения.</span><span class="sxs-lookup"><span data-stu-id="42852-110">When you start a search, download, installation, or uninstallation of updates by using [**IUpdateSearcher::BeginSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-beginsearch), [**IUpdateDownloader::BeginDownload**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatedownloader-begindownload), [**IUpdateInstaller::BeginInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-begininstall), and [**IUpdateInstaller::BeginUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-beginuninstall), ensure that you maintain sufficient access permisssions when you release references to WUA API objects.</span></span>
    -   <span data-ttu-id="42852-111">Убедитесь, что все объекты обратного вызова, используемые в асинхронной операции, не ссылаются до их уничтожения.</span><span class="sxs-lookup"><span data-stu-id="42852-111">Make sure any callback objects that are used in the asynchronous operation are unreferenced before you destroy them.</span></span> <span data-ttu-id="42852-112">Подождите, пока счетчик ссылок объекта обратного вызова вернется к начальному значению перед уничтожением.</span><span class="sxs-lookup"><span data-stu-id="42852-112">Wait for the reference count of a callback object to return to the initial value before you destroy it.</span></span>
    -   <span data-ttu-id="42852-113">Ссылка на объект задания, возвращаемый из соответствующего метода **Begin** , должна управляться объектом, который отличается от объектов обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="42852-113">The reference to the job object that is returned from the corresponding **Begin** method should be controlled by an object that differs from the callback objects.</span></span> <span data-ttu-id="42852-114">Используйте объект, отличающийся от объектов обратного вызова, чтобы избежать циклических ссылок.</span><span class="sxs-lookup"><span data-stu-id="42852-114">Use an object that differs from the callback objects to avoid circular references.</span></span>
    -   <span data-ttu-id="42852-115">При попытке управления ссылкой на объект задания с помощью объекта обратного вызова необходимо вызвать метод [**идовнлоаджоб:: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-idownloadjob-cleanup), [**Иинсталлатионжоб:: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-iinstallationjob-cleanup)или [**исеарчжоб:: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-isearchjob-cleanup) вне функции обратного вызова, чтобы отключить объект задания от объекта обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="42852-115">If you attempt to control the reference to the job object by using a callback object, you must call the [**IDownloadJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-idownloadjob-cleanup), [**IInstallationJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-iinstallationjob-cleanup), or [**ISearchJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-isearchjob-cleanup) method outside the callback function to disconnect the job object from the callback object.</span></span> <span data-ttu-id="42852-116">Это необходимо сделать перед тем, как освободить ссылку на объект задания, возвращаемый методом **Begin** .</span><span class="sxs-lookup"><span data-stu-id="42852-116">You must do this before you release the reference to the job object that is returned by the **Begin** method.</span></span>
-   <span data-ttu-id="42852-117">Убедитесь, что асинхронные операции WUA завершены.</span><span class="sxs-lookup"><span data-stu-id="42852-117">Make sure that asynchronous WUA operations are complete.</span></span> <span data-ttu-id="42852-118">Сервер сценариев Windows может завершить выполнение скрипта при завершении всех команд за пределами функции, даже если в API-интерфейсе WUA имеются ссылки на объект обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="42852-118">Windows Script Host can terminate a script when all the commands outside of any function are complete, even if the WUA API still has references to the callback object.</span></span>
    -   <span data-ttu-id="42852-119">Используйте один из методов **очистки** или задайте для функции обратного вызова общую глобальную переменную после завершения.</span><span class="sxs-lookup"><span data-stu-id="42852-119">Use one of the **CleanUp** methods or have the callback function set a shared global variable upon completion.</span></span>
    -   <span data-ttu-id="42852-120">Никогда не вызывайте [**идовнлоаджоб:: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-idownloadjob-cleanup), [**Иинсталлатионжоб:: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-iinstallationjob-cleanup)или [**исеарчжоб:: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-isearchjob-cleanup) в объекте задания в своей функции обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="42852-120">Never call [**IDownloadJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-idownloadjob-cleanup), [**IInstallationJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-iinstallationjob-cleanup), or [**ISearchJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-isearchjob-cleanup) on a job object in its callback function.</span></span>
    -   <span data-ttu-id="42852-121">Чтобы обеспечить правильную последовательность очистки в сценарии, работающем в Windows Internet Explorer, вызовите метод **Cleanup** для всех объектов задания при обработке Window. онбефореунлоад.</span><span class="sxs-lookup"><span data-stu-id="42852-121">To ensure the correct clean-up sequence in a script that is running on Windows Internet Explorer, call the **CleanUp** method on all the job objects when processing window.onbeforeunload.</span></span>
-   <span data-ttu-id="42852-122">Не используйте определяемые пользователем типы данных (UDT) для асинхронных операций WUA.</span><span class="sxs-lookup"><span data-stu-id="42852-122">Do not use user-defined data types (UDT) for asynchronous WUA operations.</span></span> <span data-ttu-id="42852-123">Тип не поддерживается [**иупдатесеарчер:: бегинсеарч**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-beginsearch), [**Иупдатедовнлоадер:: BeginDownload**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatedownloader-begindownload), [**Иупдатеинсталлер:: Бегининсталл**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-begininstall)или [**иупдатеинсталлер:: BeginUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-beginuninstall).</span><span class="sxs-lookup"><span data-stu-id="42852-123">The type is not supported by [**IUpdateSearcher::BeginSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-beginsearch), [**IUpdateDownloader::BeginDownload**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatedownloader-begindownload), [**IUpdateInstaller::BeginInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-begininstall), or [**IUpdateInstaller::BeginUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-beginuninstall).</span></span>

 

 
