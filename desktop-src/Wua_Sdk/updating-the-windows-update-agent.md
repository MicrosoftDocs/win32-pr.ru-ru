---
description: Агент Центр обновления Windows (WUA) автоматически обновляет себя при подключении к серверу Windows Server Update Services (WSUS) или Центр обновления Windows.
ms.assetid: 829112ab-b240-4cc4-8053-18b484934886
title: Обновление агента Центр обновления Windows
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b00fe439b1bea377e2699f6fe5714b208ac5d951
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105711175"
---
# <a name="updating-windows-update-agent"></a><span data-ttu-id="910e2-103">Обновление агента Центр обновления Windows</span><span class="sxs-lookup"><span data-stu-id="910e2-103">Updating Windows Update Agent</span></span>

<span data-ttu-id="910e2-104">Агент Центр обновления Windows (WUA) обновляется с помощью различных средств, в зависимости от версии Windows, работающей на устройстве.</span><span class="sxs-lookup"><span data-stu-id="910e2-104">Windows Update Agent (WUA) updates itself through various means, depending on the version of Windows running on the device.</span></span> <span data-ttu-id="910e2-105">Старые версии WUA не могут подключаться к текущим службам обновления, могут быть несовместимы со всеми обновлениями и могут не поддерживать все документированные API.</span><span class="sxs-lookup"><span data-stu-id="910e2-105">Old versions of WUA may not be able to connect to current update services, may not be compatible with all updates, and may not support all documented APIs.</span></span> <span data-ttu-id="910e2-106">Вот как можно убедиться, что WUA полностью обновлен и совместим.</span><span class="sxs-lookup"><span data-stu-id="910e2-106">Here is how to insure that WUA is fully updated and compatible.</span></span>

<span data-ttu-id="910e2-107">**В версиях Windows, начиная с Windows 7 и Windows Server 2008 R2**</span><span class="sxs-lookup"><span data-stu-id="910e2-107">**On versions of Windows beginning with Windows 7 and Windows Server 2008 R2**</span></span>

<span data-ttu-id="910e2-108">Обновления агента Центр обновления Windows (WUA) включены в регулярные периодические обновления Windows, распределенные по Центр обновления Windows или Windows Server Update Services (WSUS).</span><span class="sxs-lookup"><span data-stu-id="910e2-108">Windows Update Agent (WUA) updates are included in the regular periodic updates to Windows distributed through Windows Update or to Windows Server Update Services (WSUS).</span></span> <span data-ttu-id="910e2-109">Вам не нужно предпринимать никаких дополнительных действий по обновлению WUA в этих версиях Windows.</span><span class="sxs-lookup"><span data-stu-id="910e2-109">You do not need to take any special steps to update WUA on these Windows versions.</span></span>

<span data-ttu-id="910e2-110">**В версиях Windows до Windows 7 и Windows Server 2008 R2**</span><span class="sxs-lookup"><span data-stu-id="910e2-110">**On versions of Windows prior to Windows 7 and Windows Server 2008 R2**</span></span>

<span data-ttu-id="910e2-111">WUA автоматически обновляется, когда автоматическое обновление подключается к службам Центр обновления Windows или WSUS.</span><span class="sxs-lookup"><span data-stu-id="910e2-111">WUA automatically updates itself when Automatic Updates connects to Windows Update or to WSUS.</span></span>

<span data-ttu-id="910e2-112">Если автоматическое обновление еще не удалось запустить, возможно, на устройстве под управлением этих версий Windows будет запущена более старая версия WUA, которая не поддерживает все документированные API-интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="910e2-112">If Automatic Updates has not yet successfully run, it is possible that a device running these Windows versions will be running an older version of WUA that does not support all the documented APIs.</span></span> <span data-ttu-id="910e2-113">Если при использовании API-интерфейса WUA для выполнения проверки, загрузки или установки получен результат WU_E_SELFUPDATE_REQUIRED, эта ошибка говорит о том, что установленная версия WUA слишком старая для подключения к текущим службам Центр обновления Windows.</span><span class="sxs-lookup"><span data-stu-id="910e2-113">If you receive a WU_E_SELFUPDATE_REQUIRED result when you use the WUA API to perform a scan, download, or install, this error tells you that the installed version of WUA is too old to connect to current Windows Update services.</span></span> <span data-ttu-id="910e2-114">Вы не можете использовать обычные API-интерфейсы WUA для обновления WUA в этих операционных системах.</span><span class="sxs-lookup"><span data-stu-id="910e2-114">You cannot use the normal WUA APIs to update WUA on these operating systems.</span></span> 

<span data-ttu-id="910e2-115">Пользователь может вручную обновить WUA до текущей версии, открыв панель управления Центр обновления Windows, выбрав пункт Проверить обновления и приняв отображаемое самостоятельное обновление.</span><span class="sxs-lookup"><span data-stu-id="910e2-115">A user can manually update WUA to a current version by opening the Windows Update control panel, selecting Check for Updates, then accepting the self-update that appears.</span></span> <span data-ttu-id="910e2-116">Кроме того, агент WUA можно обновить программным способом.</span><span class="sxs-lookup"><span data-stu-id="910e2-116">Alternately, you can update WUA programmatically.</span></span>

<span data-ttu-id="910e2-117">**Программное обновление агента WUA в версиях Windows до Windows 7 и Windows Server 2008 R2**</span><span class="sxs-lookup"><span data-stu-id="910e2-117">**To programmatically update WUA on versions of Windows prior to Windows 7 and Windows Server 2008 R2**</span></span>

1.  <span data-ttu-id="910e2-118">Используйте API [WinHTTP](../winhttp/winhttp-start-page.md) для скачивания [Wuredist.cab](https://update.microsoft.com/redist/wuredist.cab).</span><span class="sxs-lookup"><span data-stu-id="910e2-118">Use the [WinHTTP](../winhttp/winhttp-start-page.md) APIs to download [Wuredist.cab](https://update.microsoft.com/redist/wuredist.cab).</span></span>
2.  <span data-ttu-id="910e2-119">Используйте [криптографические функции](../seccrypto/cryptography-functions.md) , чтобы убедиться, что скачанная копия [Wuredist.cab](https://update.microsoft.com/redist/wuredist.cab) имеет цифровую подпись от корпорации Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="910e2-119">Use the [Cryptography Functions](../seccrypto/cryptography-functions.md) to verify that the downloaded copy of [Wuredist.cab](https://update.microsoft.com/redist/wuredist.cab) has a digital signature from Microsoft.</span></span> <span data-ttu-id="910e2-120">Если вы не можете проверить цифровую подпись, прервите ее.</span><span class="sxs-lookup"><span data-stu-id="910e2-120">If you can't verify the digital signature, stop.</span></span>
3.  <span data-ttu-id="910e2-121">Используйте API [интерфейса распаковки файлов](../devnotes/cabinet-api-functions.md) для извлечения XML-файла из [Wuredist.cab](https://update.microsoft.com/redist/wuredist.cab).</span><span class="sxs-lookup"><span data-stu-id="910e2-121">Use the [File Decompression Interface](../devnotes/cabinet-api-functions.md) APIs to extract the XML file from [Wuredist.cab](https://update.microsoft.com/redist/wuredist.cab).</span></span>
4.  <span data-ttu-id="910e2-122">Используйте API-интерфейсы Microsoft XML Core Services ([MSXML](/previous-versions/windows/desktop/ms763742(v=vs.85))) для загрузки XML-файла и размещения узла файл Wuredist/стандалонередист/Architecture для архитектуры компьютера.</span><span class="sxs-lookup"><span data-stu-id="910e2-122">Use the Microsoft XML Core Services ([MSXML](/previous-versions/windows/desktop/ms763742(v=vs.85))) APIs to load the XML file and locate the WURedist/StandaloneRedist/architecture node for the computer's architecture.</span></span> <span data-ttu-id="910e2-123">Например, для x86 выберите узел файл Wuredist/Стандалонередист/Architecture с атрибутом **Name** платформы x86.</span><span class="sxs-lookup"><span data-stu-id="910e2-123">For example, for x86, locate the WURedist/StandaloneRedist/architecture node with the **name** attribute of x86.</span></span>
5.  <span data-ttu-id="910e2-124">Вызовите [**ивиндовсупдатеажентинфо:: info**](/windows/desktop/api/Wuapi/nf-wuapi-iwindowsupdateagentinfo-getinfo) , чтобы определить текущую версию WUA.</span><span class="sxs-lookup"><span data-stu-id="910e2-124">Call [**IWindowsUpdateAgentInfo::GetInfo**](/windows/desktop/api/Wuapi/nf-wuapi-iwindowsupdateagentinfo-getinfo) to determine the current version of WUA.</span></span> <span data-ttu-id="910e2-125">Если **ивиндовсупдатеажентинфо::-info** возвращает номер версии по крайней мере выше, чем атрибут **clientVersion** в узле архитектуры, который вы находили, прервите.</span><span class="sxs-lookup"><span data-stu-id="910e2-125">If **IWindowsUpdateAgentInfo::GetInfo** returns a version number that is at least as high as the **clientVersion** attribute in the architecture node you located, stop.</span></span>
6.  <span data-ttu-id="910e2-126">Используйте API-интерфейсы [MSXML](/previous-versions/windows/desktop/ms763742(v=vs.85)) для чтения атрибута **довнлоадурл** из найденного узла архитектуры.</span><span class="sxs-lookup"><span data-stu-id="910e2-126">Use the [MSXML](/previous-versions/windows/desktop/ms763742(v=vs.85)) APIs to read the **downloadUrl** attribute from the architecture node that you located.</span></span> <span data-ttu-id="910e2-127">**довнлоадурл** предоставляет URL-адрес для скачивания соответствующего установщика агента WUA для архитектуры компьютера.</span><span class="sxs-lookup"><span data-stu-id="910e2-127">**downloadUrl** gives you the download URL for the appropriate WUA installer for the computer's architecture.</span></span>
7.  <span data-ttu-id="910e2-128">Используйте API [WinHTTP](../winhttp/winhttp-start-page.md) для загрузки соответствующего установщика.</span><span class="sxs-lookup"><span data-stu-id="910e2-128">Use the [WinHTTP](../winhttp/winhttp-start-page.md) APIs to download the appropriate installer.</span></span>
8.  <span data-ttu-id="910e2-129">Используйте функцию [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) или аналогичный API для выполнения скачанного установщика.</span><span class="sxs-lookup"><span data-stu-id="910e2-129">Use the [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) function or a similar API to execute the downloaded installer.</span></span>

 

 
