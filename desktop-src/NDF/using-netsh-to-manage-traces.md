---
title: Использование команды Netsh для управления трассировками
description: В Windows 7 netsh.exe можно использовать из командной строки для включения и настройки трассировки сети. В этом разделе описаны некоторые команды netsh.exe, которые могут помочь при устранении неполадок, связанных с трассировкой, включая новые функции трассировки Netsh.
ms.assetid: f0f0fc7b-7cfa-43c7-89a3-3b80050875f8
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0c1cf869f60b69e227e78e19e8e05d3765ddb67d
ms.sourcegitcommit: b32433cc0394159c7263809ae67615ab5792d40d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/30/2021
ms.locfileid: "113119029"
---
# <a name="using-netsh-to-manage-traces"></a><span data-ttu-id="c3132-104">Использование команды Netsh для управления трассировками</span><span class="sxs-lookup"><span data-stu-id="c3132-104">Using Netsh to Manage Traces</span></span>

<span data-ttu-id="c3132-105">В Windows 7 netsh.exe можно использовать из командной строки для включения и настройки трассировки сети.</span><span class="sxs-lookup"><span data-stu-id="c3132-105">In Windows 7, netsh.exe can be used from a command prompt to enable and configure network traces.</span></span> <span data-ttu-id="c3132-106">В этом разделе описаны некоторые команды netsh.exe, которые могут помочь при устранении неполадок, связанных с трассировкой, включая новые функции **трассировки Netsh** .</span><span class="sxs-lookup"><span data-stu-id="c3132-106">This section describes some of the netsh.exe commands which can help in troubleshooting tracing issues, including the new **netsh trace** functionality.</span></span> <span data-ttu-id="c3132-107">Обратите внимание, что команды netsh необходимо запускать из командной строки с повышенными привилегиями.</span><span class="sxs-lookup"><span data-stu-id="c3132-107">Note that the netsh commands must be run from an elevated command prompt.</span></span>

## <a name="collecting-traces"></a><span data-ttu-id="c3132-108">Сбор трассировок</span><span class="sxs-lookup"><span data-stu-id="c3132-108">Collecting traces</span></span>

<span data-ttu-id="c3132-109">Сценарии — это предопределенные наборы поставщиков трассировки, которые можно включить для устранения неполадок.</span><span class="sxs-lookup"><span data-stu-id="c3132-109">Scenarios are predefined sets of trace providers which can be enabled for troubleshooting.</span></span> <span data-ttu-id="c3132-110">Чтобы отобразить список доступных сценариев, связанных с сетью, введите **netsh trace Показать сценарии** (для каждого из доступных поставщиков, включая те, которые не связаны с сетевыми подключениями, отображается список **поставщиков Netsh trace Показать поставщики** ).</span><span class="sxs-lookup"><span data-stu-id="c3132-110">To display the list of available network-related scenarios, type **netsh trace show scenarios** (**netsh trace show providers** lists every one of the available providers, including ones that are not relevant to networking).</span></span>

<span data-ttu-id="c3132-111">После определения сценария, который будет иметь отношение к вашим проблемам, можно просмотреть список всех поставщиков, входящих в этот сценарий.</span><span class="sxs-lookup"><span data-stu-id="c3132-111">When you have identified a scenario that looks relevant to your issues, you can see a list of all of the providers included in that scenario.</span></span> <span data-ttu-id="c3132-112">Например, чтобы просмотреть всех поставщиков, включенных в сценарии InternetClient, введите **команду netsh trace показать сценарий InternetClient**.</span><span class="sxs-lookup"><span data-stu-id="c3132-112">For example, to see all of the providers enabled under the InternetClient scenario, type **netsh trace show scenario internetclient**.</span></span>

<span data-ttu-id="c3132-113">Можно запустить трассировку для всех поставщиков в определенном сценарии или наборе сценариев.</span><span class="sxs-lookup"><span data-stu-id="c3132-113">You can start a trace for all of the providers in a given scenario or set of scenarios.</span></span> <span data-ttu-id="c3132-114">Например, чтобы запустить трассировку для всех поставщиков, включенных в сценарии InternetClient, введите **команду netsh trace Start Scenario = InternetClient**.</span><span class="sxs-lookup"><span data-stu-id="c3132-114">For example, to start a trace for all of the providers enabled under the InternetClient scenario, type **netsh trace start scenario=internetclient**.</span></span> <span data-ttu-id="c3132-115">Для сбора поставщиков в нескольких сценариях можно указать все соответствующие сценарии, такие как **netsh trace Start Scenario = филешаринг сценарий = DirectAccess**.</span><span class="sxs-lookup"><span data-stu-id="c3132-115">To capture providers for more than one scenario, you can specify all of the appropriate scenarios, such as **netsh trace start scenario=FileSharing scenario=DirectAccess**.</span></span> <span data-ttu-id="c3132-116">Обратите внимание, что в каждый момент времени может быть включен только один сеанс трассировки. нельзя одновременно собирать данные трассировки из разных наборов поставщиков в отдельных файлах.</span><span class="sxs-lookup"><span data-stu-id="c3132-116">Note that only one tracing session may be enabled at a time; it is not possible to simultaneously capture trace information from different sets of providers in separate files.</span></span>

<span data-ttu-id="c3132-117">Можно также запустить трассировку для дополнительных поставщиков, не входящих в этот конкретный сценарий.</span><span class="sxs-lookup"><span data-stu-id="c3132-117">You can also start a trace for additional providers not included in that particular scenario.</span></span> <span data-ttu-id="c3132-118">Например, может потребоваться запустить трассировку для всех поставщиков, включенных в сценарии WLAN, а также поставщика DHCP.</span><span class="sxs-lookup"><span data-stu-id="c3132-118">For example, you might want to start traces for all of the providers enabled under the WLAN scenario and also the DHCP provider.</span></span> <span data-ttu-id="c3132-119">Для этого введите **netsh trace Start сценарий = WLAN Provider = Microsoft-Windows-DHCP-Client**.</span><span class="sxs-lookup"><span data-stu-id="c3132-119">To do this, type **netsh trace start scenario=wlan provider=Microsoft-Windows-Dhcp-Client**.</span></span>

<span data-ttu-id="c3132-120">Можно также просмотреть дополнительные сведения о конкретном поставщике, введя **команду netsh trace Показать поставщик** , а затем имя поставщика.</span><span class="sxs-lookup"><span data-stu-id="c3132-120">You can also see more details about a specific provider by typing **netsh trace show provider** followed by the provider name.</span></span>

<span data-ttu-id="c3132-121">Чтобы просмотреть все доступные параметры и фильтры, введите **команду netsh trace Start/?**.</span><span class="sxs-lookup"><span data-stu-id="c3132-121">To see all of the options and filters available you can type **netsh trace start /?**.</span></span>

<span data-ttu-id="c3132-122">Чтобы прерывать трассировку, введите **команду netsh trace останавливаться**.</span><span class="sxs-lookup"><span data-stu-id="c3132-122">To stop tracing, type **netsh trace stop**.</span></span>

## <a name="using-the-output-files"></a><span data-ttu-id="c3132-123">Использование выходных файлов</span><span class="sxs-lookup"><span data-stu-id="c3132-123">Using the output files</span></span>

<span data-ttu-id="c3132-124">Когда трассировка остановлена, по умолчанию создаются два файла: файл журнала трассировки событий (ETL) и файл .cab.</span><span class="sxs-lookup"><span data-stu-id="c3132-124">When tracing is stopped, two files are generated by default: an Event Trace Log (ETL) file and a .cab file.</span></span>

<span data-ttu-id="c3132-125">События трассировки собираются в ETL-файле, который можно просмотреть с помощью таких средств, как сетевой монитор.</span><span class="sxs-lookup"><span data-stu-id="c3132-125">Trace events are collected in the ETL file, which can be viewed using tools such as Network Monitor.</span></span> <span data-ttu-id="c3132-126">ETL-файл будет называться NetTrace. ETL по умолчанию. также можно указать другое имя, включив **TraceFile = filename. ETL** при запуске трассировки.</span><span class="sxs-lookup"><span data-stu-id="c3132-126">The ETL file will be named nettrace.etl by default, or you can specify a different name by including **tracefile=filename.etl** when starting the trace.</span></span>

<span data-ttu-id="c3132-127">Файл .cab содержит подробные сведения о программном обеспечении и оборудовании в системе, такие как сведения о адаптере, сборка, параметры операционной системы и беспроводная связь.</span><span class="sxs-lookup"><span data-stu-id="c3132-127">The .cab file contains rich information about the software and hardware on the system such as the adapter information, build, operating system, and wireless settings.</span></span> <span data-ttu-id="c3132-128">Файл .cab будет называться nettrace.cab по умолчанию, если не указано другое имя, как указано выше.</span><span class="sxs-lookup"><span data-stu-id="c3132-128">The .cab file will be named nettrace.cab by default, unless another name was specified as indicated above.</span></span>

<span data-ttu-id="c3132-129">Этот файл .cab будет содержать два файла, имена которых всегда будут совпадать.</span><span class="sxs-lookup"><span data-stu-id="c3132-129">This .cab file will contain two files, which will always have the same name.</span></span> <span data-ttu-id="c3132-130">Report. ETL — это еще одна копия той же информации, которая содержится в NetTrace. ETL.</span><span class="sxs-lookup"><span data-stu-id="c3132-130">Report.etl is another copy of the same information included in nettrace.etl.</span></span> <span data-ttu-id="c3132-131">Файл report.html содержит дополнительные сведения о событиях трассировки и других собираемых данных.</span><span class="sxs-lookup"><span data-stu-id="c3132-131">The report.html file includes additional information about the trace events and the other information collected.</span></span> <span data-ttu-id="c3132-132">Чтобы получить наибольшую доступную информацию, включите команду **Report = Yes** при запуске трассировки.</span><span class="sxs-lookup"><span data-stu-id="c3132-132">To receive the most details available, include the command **report = yes** when starting a trace.</span></span>

## <a name="using-filters-to-reduce-the-amount-of-data-in-the-etl-trace-file"></a><span data-ttu-id="c3132-133">Использование фильтров для уменьшения объема данных в файле трассировки ETL</span><span class="sxs-lookup"><span data-stu-id="c3132-133">Using filters to reduce the amount of data in the ETL trace file</span></span>

<span data-ttu-id="c3132-134">Когда записи происходят в течение длительного периода времени, файл трассировки ETL может стать очень большим.</span><span class="sxs-lookup"><span data-stu-id="c3132-134">When captures happen over a long period of time, the ETL trace file can become very large.</span></span> <span data-ttu-id="c3132-135">В сценариях, в которых включен несколько поставщиков, что приводит к интенсивному трафику, ограничения буфера ETW могут привести к удалению некоторых трассировок.</span><span class="sxs-lookup"><span data-stu-id="c3132-135">In scenarios where multiple providers are enabled, resulting in high traffic, ETW buffer constraints may cause some traces to be dropped.</span></span> <span data-ttu-id="c3132-136">Помимо этого, уменьшение объема данных в файле трассировки ETL позволяет упростить устранение неполадок, уменьшая объем данных, которые необходимо проверить.</span><span class="sxs-lookup"><span data-stu-id="c3132-136">Aside from this consideration, reducing the amount of data in the ETL trace file can help make troubleshooting easier by reducing the amount of data to review.</span></span>

<span data-ttu-id="c3132-137">Для уменьшения размера файла трассировки ETL можно использовать команды netsh trace Filters.</span><span class="sxs-lookup"><span data-stu-id="c3132-137">Netsh trace filters can be used to reduce the ETL trace file size.</span></span> <span data-ttu-id="c3132-138">Эти фильтры трассировки являются уровнями ETW и ключевыми словами, которые можно применять к отдельным поставщикам.</span><span class="sxs-lookup"><span data-stu-id="c3132-138">These trace filters are ETW levels and keywords that can be applied to individual providers.</span></span>

<span data-ttu-id="c3132-139">Чтобы просмотреть список фильтров, которые можно применить, введите **команду netsh trace Start/?**</span><span class="sxs-lookup"><span data-stu-id="c3132-139">To see a list of filters which can be applied, type **netsh trace start /?**</span></span>

<span data-ttu-id="c3132-140">Пример фильтра — **netsh trace Start InternetClient Provider = Microsoft-Windows-tcpip Level = 5 keywords = UT: рецеивепас, UT: сендпас**.</span><span class="sxs-lookup"><span data-stu-id="c3132-140">An example of a filter is **netsh trace start InternetClient provider=Microsoft-Windows-TCPIP level=5 keywords=ut:ReceivePath,ut:SendPath**.</span></span>

<span data-ttu-id="c3132-141">В этом примере уровень равен 5, что означает, что отображается максимальное число событий.</span><span class="sxs-lookup"><span data-stu-id="c3132-141">In this example, the level is set to 5, which means that the maximum number of events will be shown.</span></span> <span data-ttu-id="c3132-142">В следующей таблице приведены доступные параметры.</span><span class="sxs-lookup"><span data-stu-id="c3132-142">The following table shows the settings available:</span></span>



| <span data-ttu-id="c3132-143">Level</span><span class="sxs-lookup"><span data-stu-id="c3132-143">Level</span></span>      | <span data-ttu-id="c3132-144">Параметр</span><span class="sxs-lookup"><span data-stu-id="c3132-144">Setting</span></span>              | <span data-ttu-id="c3132-145">Описание</span><span class="sxs-lookup"><span data-stu-id="c3132-145">Description</span></span>                                                                           |
|-------|---------------|----------------------------------------------------------------------------|
| <span data-ttu-id="c3132-146">1</span><span class="sxs-lookup"><span data-stu-id="c3132-146">1</span></span>     | <span data-ttu-id="c3132-147">Критически важно</span><span class="sxs-lookup"><span data-stu-id="c3132-147">Critical</span></span>      | <span data-ttu-id="c3132-148">Будут показаны только критические события.</span><span class="sxs-lookup"><span data-stu-id="c3132-148">Only critical events will be shown.</span></span>                                        |
| <span data-ttu-id="c3132-149">2</span><span class="sxs-lookup"><span data-stu-id="c3132-149">2</span></span>     | <span data-ttu-id="c3132-150">ошибки</span><span class="sxs-lookup"><span data-stu-id="c3132-150">Errors</span></span>        | <span data-ttu-id="c3132-151">Будут показаны критические события и ошибки.</span><span class="sxs-lookup"><span data-stu-id="c3132-151">Critical events and errors will be shown.</span></span>                                  |
| <span data-ttu-id="c3132-152">3</span><span class="sxs-lookup"><span data-stu-id="c3132-152">3</span></span>     | <span data-ttu-id="c3132-153">Предупреждения</span><span class="sxs-lookup"><span data-stu-id="c3132-153">Warnings</span></span>      | <span data-ttu-id="c3132-154">Будут показаны критические события, ошибки и предупреждения.</span><span class="sxs-lookup"><span data-stu-id="c3132-154">Critical events, errors, and warnings will be shown.</span></span>                       |
| <span data-ttu-id="c3132-155">4</span><span class="sxs-lookup"><span data-stu-id="c3132-155">4</span></span>     | <span data-ttu-id="c3132-156">Informational</span><span class="sxs-lookup"><span data-stu-id="c3132-156">Informational</span></span> | <span data-ttu-id="c3132-157">Будут показаны критические события, ошибки, предупреждения и информационные события.</span><span class="sxs-lookup"><span data-stu-id="c3132-157">Critical events, errors, warnings, and informational events will be shown.</span></span> |
| <span data-ttu-id="c3132-158">5</span><span class="sxs-lookup"><span data-stu-id="c3132-158">5</span></span>     | <span data-ttu-id="c3132-159">Подробный</span><span class="sxs-lookup"><span data-stu-id="c3132-159">Verbose</span></span>       | <span data-ttu-id="c3132-160">Будут показаны все события.</span><span class="sxs-lookup"><span data-stu-id="c3132-160">All events will be shown.</span></span>                                                  |



 

<span data-ttu-id="c3132-161">Ключевые слова **UT: рецеивепас** и **UT: сентпас** отфильтровывают события для отображения только тех событий, которые отслеживаются по пути получения или отправки.</span><span class="sxs-lookup"><span data-stu-id="c3132-161">The keywords **ut:ReceivePath** and **ut:SentPath** filters the events to show only those events traced on the receive or send path.</span></span> <span data-ttu-id="c3132-162">Полный список ключевых слов для конкретного поставщика можно найти, введя **команду netsh trace показывать поставщик** , а затем имя поставщика.</span><span class="sxs-lookup"><span data-stu-id="c3132-162">A complete list of keywords for a specific provider can be found by typing **netsh trace show provider** followed by the provider name.</span></span> <span data-ttu-id="c3132-163">Например, введите **netsh trace Показать поставщик Microsoft-Windows-tcpip** отобразит сведения о поставщике Microsoft-Windows-tcpip, включая список ключевых слов.</span><span class="sxs-lookup"><span data-stu-id="c3132-163">For example, typing **netsh trace show provider Microsoft-Windows-TCPIP** will display information about the Microsoft-Windows-TCPIP provider, including a list of keywords.</span></span>

<span data-ttu-id="c3132-164">Netsh также поддерживает возможность фильтрации пакетов (аналогично сетевой монитор) при включенной записи пакетов (установив **запись = Yes**).</span><span class="sxs-lookup"><span data-stu-id="c3132-164">Netsh also supports packet filtering capability (similar to Network Monitor) when packet capturing is turned on (by setting **capture = yes**).</span></span> <span data-ttu-id="c3132-165">Фильтрацию пакетов можно использовать для записи ограниченного числа пакетов в файле трассировки.</span><span class="sxs-lookup"><span data-stu-id="c3132-165">Packet filtering can be used to capture a limited number of packets in a trace file.</span></span> <span data-ttu-id="c3132-166">Например, **команда Netsh trace Start Capture = да IPv4. Address = = x. x. x. x** , где x. x. x. x — это IP-адрес, будет записывать только пакеты с трафиком IPv4 с указанным адресом источника или назначения.</span><span class="sxs-lookup"><span data-stu-id="c3132-166">For example, **netsh trace start capture = yes ipv4.address == x.x.x.x** , where x.x.x.x is the IP address, will only capture packets with ipv4 traffic with that specific source or destination address.</span></span>

<span data-ttu-id="c3132-167">Дополнительные сведения об использовании фильтрации пакетов можно ввести с помощью **команды netsh trace показывать каптурефилтерхелп**.</span><span class="sxs-lookup"><span data-stu-id="c3132-167">For additional information about how to use packet filtering, you can type **netsh trace show capturefilterHelp**.</span></span>

 

 




