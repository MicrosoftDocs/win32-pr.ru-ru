---
title: Использование функции NDF
description: Корпорация Майкрософт предоставляет доступ к функциональным возможностям NDF через общедоступный API. При возникновении проблемы приложение может использовать этот API для использования этой функции в контексте определенного приложения.
ms.assetid: db06b9a9-a64a-43ff-9b77-95230208cfd6
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5ca74a8a80f7babca75182625ec71dc1ec47cbc7
ms.sourcegitcommit: c9c66a09eeb9e46311879a5181342e89964c1dd8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/10/2020
ms.locfileid: "104412765"
---
# <a name="using-ndf-functionality"></a><span data-ttu-id="b44ba-104">Использование функции NDF</span><span class="sxs-lookup"><span data-stu-id="b44ba-104">Using NDF Functionality</span></span>

<span data-ttu-id="b44ba-105">Корпорация Майкрософт предоставляет доступ к функциональным возможностям NDF через общедоступный API.</span><span class="sxs-lookup"><span data-stu-id="b44ba-105">Microsoft provides access to NDF functionality through a public API.</span></span> <span data-ttu-id="b44ba-106">При возникновении проблемы приложение может использовать этот API для использования этой функции в контексте определенного приложения.</span><span class="sxs-lookup"><span data-stu-id="b44ba-106">When a problem occurs, the application can use this API to leverage this functionality within the context of a specific application.</span></span>

<span data-ttu-id="b44ba-107">Существует три этапа диагностики NDF: создание инцидента, выполнение диагностики и восстановления и закрытие инцидента.</span><span class="sxs-lookup"><span data-stu-id="b44ba-107">There are three stages of performing diagnosis with NDF: creating an incident, running diagnosis and repairs, and closing the incident.</span></span> <span data-ttu-id="b44ba-108">В этом обзоре указывается, какие функции NDF могут быть актуальными для конкретного сценария.</span><span class="sxs-lookup"><span data-stu-id="b44ba-108">This overview indicates which NDF functions may be relevant for a specific scenario.</span></span> <span data-ttu-id="b44ba-109">Подробные сведения о каждой функции можно найти в разделе [справочника по ndf](ndf-reference.md) .</span><span class="sxs-lookup"><span data-stu-id="b44ba-109">Detailed information on each function can be found in the [NDF Reference](ndf-reference.md) section.</span></span>

## <a name="creating-an-incident"></a><span data-ttu-id="b44ba-110">Создание инцидента</span><span class="sxs-lookup"><span data-stu-id="b44ba-110">Creating an Incident</span></span>

<span data-ttu-id="b44ba-111">Для сеанса диагностики NDF требуется конкретный инцидент для диагностики.</span><span class="sxs-lookup"><span data-stu-id="b44ba-111">An NDF diagnostics session requires a specific incident to diagnose.</span></span> <span data-ttu-id="b44ba-112">Существует несколько функций, которые можно использовать для создания инцидента.</span><span class="sxs-lookup"><span data-stu-id="b44ba-112">There are several functions which can be used to create an incident.</span></span> <span data-ttu-id="b44ba-113">Выберите функцию, которая наиболее точно соответствует тому, что пытается сделать приложение при возникновении сбоя.</span><span class="sxs-lookup"><span data-stu-id="b44ba-113">Choose the function which most closely matches what the application was trying to do when the failure occurred.</span></span>

-   <span data-ttu-id="b44ba-114">[**НдфкреатеконнективитинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreateconnectivityincident): общие проблемы с подключением к Интернету, для которых не требуются дополнительные сведения.</span><span class="sxs-lookup"><span data-stu-id="b44ba-114">[**NdfCreateConnectivityIncident**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreateconnectivityincident): General Internet connectivity problems which do not need additional information.</span></span>
-   <span data-ttu-id="b44ba-115">[**НдфкреатевебинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatewebincident) / [**НдфкреатевебинЦидентекс**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatewebincidentex): подключение к URL-адресу http или HTTPS.</span><span class="sxs-lookup"><span data-stu-id="b44ba-115">[**NdfCreateWebIncident**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatewebincident)/[**NdfCreateWebIncidentEx**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatewebincidentex): Connecting to an HTTP or HTTPS URL.</span></span>
-   <span data-ttu-id="b44ba-116">[**НдфкреатешарингинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatesharingincident): доступ к UNC-пути или общей папке.</span><span class="sxs-lookup"><span data-stu-id="b44ba-116">[**NdfCreateSharingIncident**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatesharingincident): Accessing a UNC path or file share.</span></span>
-   <span data-ttu-id="b44ba-117">[**НдфкреатеднсинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatednsincident): разрешение имени узла DNS.</span><span class="sxs-lookup"><span data-stu-id="b44ba-117">[**NdfCreateDNSIncident**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatednsincident): Resolving a DNS host name.</span></span>
-   <span data-ttu-id="b44ba-118">[**НдфкреатепнрпинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatepnrpincident): разрешение имени однорангового узла PNRP.</span><span class="sxs-lookup"><span data-stu-id="b44ba-118">[**NdfCreatePnrpIncident**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatepnrpincident): Resolving a PNRP peer name.</span></span>
-   <span data-ttu-id="b44ba-119">[**НдфкреатеграупингинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreategroupingincident): присоединение одноранговой группы.</span><span class="sxs-lookup"><span data-stu-id="b44ba-119">[**NdfCreateGroupingIncident**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreategroupingincident): Joining a peer-to-peer group.</span></span>
-   <span data-ttu-id="b44ba-120">[**НдфкреатевинсоккинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatewinsockincident): подключение к назначению с помощью сокета (если ни одна из других функций не применяется).</span><span class="sxs-lookup"><span data-stu-id="b44ba-120">[**NdfCreateWinSockIncident**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatewinsockincident): Connecting to a destination by using a socket (when none of the other functions specifically apply).</span></span>
-   <span data-ttu-id="b44ba-121">[**НдфкреатеинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreateincident): используется, если не подходит никакой другой сценарий и известен конкретный вспомогательный класс ndf (вместе с необходимыми аргументами).</span><span class="sxs-lookup"><span data-stu-id="b44ba-121">[**NdfCreateIncident**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreateincident): Used when no other scenario is appropriate and the specific NDF helper class to be invoked is known (along with the arguments it requires).</span></span> <span data-ttu-id="b44ba-122">В основном используется для целей тестирования разработчиками приложений, которые написали собственный вспомогательный класс.</span><span class="sxs-lookup"><span data-stu-id="b44ba-122">Primarily used for testing purposes by application developers who have written their own helper class.</span></span>

## <a name="running-diagnosis-and-repairs"></a><span data-ttu-id="b44ba-123">Выполнение диагностики и восстановления</span><span class="sxs-lookup"><span data-stu-id="b44ba-123">Running Diagnosis and Repairs</span></span>

<span data-ttu-id="b44ba-124">Существует два способа запуска функции диагностики и восстановления.</span><span class="sxs-lookup"><span data-stu-id="b44ba-124">There are two ways to launch the diagnosis and repair functionality.</span></span>

-   <span data-ttu-id="b44ba-125">Использование пользовательского интерфейса Windows (рекомендуется)</span><span class="sxs-lookup"><span data-stu-id="b44ba-125">Using the Windows User Interface (Recommended)</span></span>

    <span data-ttu-id="b44ba-126">При работе в стандартном пользовательском интерфейсе Windows можно просто вызвать функцию [**ндфексекутедиагносис**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfexecutediagnosis) .</span><span class="sxs-lookup"><span data-stu-id="b44ba-126">When running in the standard Windows user interface, you can simply call the [**NdfExecuteDiagnosis**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfexecutediagnosis) function.</span></span> <span data-ttu-id="b44ba-127">Мастер NDF запустит и поможет пользователю определить (и, если возможно, и устранить) проблему.</span><span class="sxs-lookup"><span data-stu-id="b44ba-127">The NDF Wizard will launch and assist the user in identifying (and if possible, and resolving) the problem.</span></span> <span data-ttu-id="b44ba-128">Функция будет возвращена после завершения этого процесса.</span><span class="sxs-lookup"><span data-stu-id="b44ba-128">The function will return after this process has finished.</span></span> <span data-ttu-id="b44ba-129">Пользовательский интерфейс является необязательно модальным для приложения.</span><span class="sxs-lookup"><span data-stu-id="b44ba-129">The user interface is optionally modal to your application.</span></span>

-   <span data-ttu-id="b44ba-130">Использование настраиваемого пользовательского интерфейса (только Windows 7 и более поздние версии)</span><span class="sxs-lookup"><span data-stu-id="b44ba-130">Using a Custom User Interface (Windows 7 and later only)</span></span>

    <span data-ttu-id="b44ba-131">Различные функции доступны для использования в сценариях, где не отображается пользовательский интерфейс или не используется стандартная среда Windows (например, Media Center, встраиваемые приложения и Командная строка).</span><span class="sxs-lookup"><span data-stu-id="b44ba-131">Different functions are available to use in scenarios where no user interface is being shown, or where the standard Windows experience is not being used (such as Media Center, embedded applications, and the command prompt).</span></span> <span data-ttu-id="b44ba-132">Этот параметр позволяет обойти функции взаимодействия с пользователем, предоставляемые мастером NDF, который позволяет ограничить результаты до полностью поддерживаемых основных причин, а также эвристику для предоставления пользователю возможности восстановления в рекомендуемом порядке.</span><span class="sxs-lookup"><span data-stu-id="b44ba-132">This option bypasses the user experience functionality provided in the NDF Wizard, which includes limiting the results to fully-supported root causes, as well as heuristics to present repairs to the user in recommended order.</span></span> <span data-ttu-id="b44ba-133">При использовании этих функций необходимо предоставить любую такую возможность самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="b44ba-133">When using these functions, you must provide any such functionality yourself.</span></span> <span data-ttu-id="b44ba-134">Кроме того, необходимо обеспечить освобождение памяти, используемой результатами диагностики.</span><span class="sxs-lookup"><span data-stu-id="b44ba-134">You must also make sure to free memory used by the diagnosis results.</span></span>

    <span data-ttu-id="b44ba-135">Чтобы начать диагностику, вызовите функцию [**ндфдиагносеинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfdiagnoseincident) .</span><span class="sxs-lookup"><span data-stu-id="b44ba-135">To begin diagnosis, call the [**NdfDiagnoseIncident**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfdiagnoseincident) function.</span></span> <span data-ttu-id="b44ba-136">Все найденные проблемы будут возвращены приложению в виде коллекции структур [**руткаусеинфо**](/windows/win32/api/ndattrib/ns-ndattrib-rootcauseinfo) , описывающих определенные основные причины и возможные варианты восстановления.</span><span class="sxs-lookup"><span data-stu-id="b44ba-136">Any problems found will be returned to the application as a collection of [**RootCauseInfo**](/windows/win32/api/ndattrib/ns-ndattrib-rootcauseinfo) structures describing identified root causes and possible repairs.</span></span>

    <span data-ttu-id="b44ba-137">После выбора восстановления (или запроса на выбор восстановления) следует вызвать [**ндфрепаиринЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfrepairincident) , чтобы попытаться восстановить и определить, была ли проблема устранена.</span><span class="sxs-lookup"><span data-stu-id="b44ba-137">After selecting a repair (or asking the user to select a repair), [**NdfRepairIncident**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfrepairincident) should be called to attempt the repair and determine whether the problem was resolved.</span></span>

    <span data-ttu-id="b44ba-138">В некоторых случаях восстановление может быть выполнено успешно, но проблема не будет устранена.</span><span class="sxs-lookup"><span data-stu-id="b44ba-138">In some cases, a repair may be successfully performed but will not resolve the problem.</span></span> <span data-ttu-id="b44ba-139">В таких случаях рекомендуется закрыть существующий инцидент, а затем открыть новый.</span><span class="sxs-lookup"><span data-stu-id="b44ba-139">In such cases, closing the existing incident and then opening a new one is recommended.</span></span> <span data-ttu-id="b44ba-140">Это гарантирует, что все новые проблемы, снятые с помощью начального восстановления, будут идентифицированы.</span><span class="sxs-lookup"><span data-stu-id="b44ba-140">This will ensure that any new problems unmasked by the initial repair are identified.</span></span> <span data-ttu-id="b44ba-141">Например, предположим, что беспроводные сети не были видны.</span><span class="sxs-lookup"><span data-stu-id="b44ba-141">For example, suppose that no wireless networks had been visible.</span></span> <span data-ttu-id="b44ba-142">После сброса адаптера Беспроводные сети будут видны, но ни один из них не будет включен в список предпочтительных.</span><span class="sxs-lookup"><span data-stu-id="b44ba-142">After resetting the adapter, wireless networks are visible, but none of them are on the preferred list.</span></span> <span data-ttu-id="b44ba-143">Это новая проблема, которая потребует новой диагностики для обнаружения.</span><span class="sxs-lookup"><span data-stu-id="b44ba-143">This is a new problem that would require a new diagnosis to identify.</span></span> <span data-ttu-id="b44ba-144">Если такая вторая попытка диагностики не выявляет дополнительные проблемы, можно попробовать выполнить другое восстановление, чтобы устранить исходную проблему, или пользователь может сообщить о том, что проблему не удалось устранить.</span><span class="sxs-lookup"><span data-stu-id="b44ba-144">If such a second diagnosis attempt does not identify additional problems, a different repair can be attempted to resolve the original issue, or the user can be informed that the problem could not be resolved.</span></span>

    <span data-ttu-id="b44ba-145">[**НдфдиагносеинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfdiagnoseincident) и [**ндфрепаиринЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfrepairincident) — это синхронные API.</span><span class="sxs-lookup"><span data-stu-id="b44ba-145">[**NdfDiagnoseIncident**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfdiagnoseincident) and [**NdfRepairIncident**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfrepairincident) are synchronous APIs.</span></span> <span data-ttu-id="b44ba-146">Если вы хотите отменить действие, инициированное этими функциями, вызовите [**ндфканцелинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcancelincident) из другого потока.</span><span class="sxs-lookup"><span data-stu-id="b44ba-146">If you wish to cancel activity initiated by these functions, call [**NdfCancelIncident**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcancelincident) from another thread.</span></span> <span data-ttu-id="b44ba-147">Функция возвратится к следующей доступной точке останова в процессе диагностики или восстановления.</span><span class="sxs-lookup"><span data-stu-id="b44ba-147">The function will return at the next available stopping point in the diagnosis or repair process.</span></span>

    <span data-ttu-id="b44ba-148">В любой момент вы можете вызвать [**ндфжеттрацефиле**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfgettracefile) , чтобы получить копию журнала ndf для текущего сеанса диагностики и включить ее в журналы приложения.</span><span class="sxs-lookup"><span data-stu-id="b44ba-148">At any point, you may optionally call [**NdfGetTraceFile**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfgettracefile) to retrieve a copy of the NDF log for the current diagnosis session and include it with your application logs.</span></span> <span data-ttu-id="b44ba-149">Журнал очищается после получения, и последующие вызовы будут получать только те события, которые произошли после последнего вызова этой функции.</span><span class="sxs-lookup"><span data-stu-id="b44ba-149">The log is flushed once retrieved, and subsequent calls will only retrieve events which occurred after the last call to this function.</span></span>

## <a name="closing-an-incident"></a><span data-ttu-id="b44ba-150">Закрытие инцидента</span><span class="sxs-lookup"><span data-stu-id="b44ba-150">Closing an Incident</span></span>

<span data-ttu-id="b44ba-151">После завершения диагностики инцидента вызовите [**ндфклосеинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcloseincident) , чтобы освободить системные ресурсы, связанные с выполнением диагностики для этого инцидента.</span><span class="sxs-lookup"><span data-stu-id="b44ba-151">When you are finished diagnosing an incident, call [**NdfCloseIncident**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcloseincident) to free system resources associated with performing diagnostics on that incident.</span></span> <span data-ttu-id="b44ba-152">(Обратите внимание, что это не освобождает объекты, созданные [**ндфдиагносеинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfdiagnoseincident).</span><span class="sxs-lookup"><span data-stu-id="b44ba-152">(Note that this does not free objects created by [**NdfDiagnoseIncident**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfdiagnoseincident).</span></span>
