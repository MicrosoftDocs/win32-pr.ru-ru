---
title: Расширяемый вспомогательный класс платформы фильтрации Windows
description: Платформа фильтрации Windows (WFP) включает класс поддержки инфраструктуры диагностики сети (NDF), называемый вспомогательным классом платформы фильтрации (ФФК).
ms.assetid: 006ea30c-8682-4a3d-803a-73dba5162696
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 858835c1a649602293ed042c13205ca982de9258
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103987590"
---
# <a name="windows-filtering-platform-extensible-helper-class"></a><span data-ttu-id="7a635-103">Расширяемый вспомогательный класс платформы фильтрации Windows</span><span class="sxs-lookup"><span data-stu-id="7a635-103">Windows Filtering Platform Extensible Helper Class</span></span>

<span data-ttu-id="7a635-104">[Платформа фильтрации Windows (WFP)](/windows/desktop/FWP/windows-filtering-platform-start-page) включает класс поддержки инфраструктуры диагностики сети (NDF), называемый вспомогательным классом платформы ФИЛЬТРАЦИИ (ФФК).</span><span class="sxs-lookup"><span data-stu-id="7a635-104">The [Windows Filtering Platform (WFP)](/windows/desktop/FWP/windows-filtering-platform-start-page) includes a Network Diagnostics Framework (NDF) helper class, called the Filtering Platform helper class (FPHC).</span></span> <span data-ttu-id="7a635-105">ФФК может помочь определить основные причины проблем с подключением, вызванных WFP.</span><span class="sxs-lookup"><span data-stu-id="7a635-105">FPHC can help identify the root causes of connectivity issues caused by WFP.</span></span> <span data-ttu-id="7a635-106">Сторонние разработчики брандмауэра могут реализовать собственные вспомогательные классы NDF.</span><span class="sxs-lookup"><span data-stu-id="7a635-106">Third-party firewall developers can implement their own NDF helper classes.</span></span> <span data-ttu-id="7a635-107">Расширяемость ФФК позволяет вызывать эти вспомогательные классы сторонних разработчиков во время диагностики.</span><span class="sxs-lookup"><span data-stu-id="7a635-107">FPHC extensibility allows these third-party helper classes to be invoked during diagnostics.</span></span>

<span data-ttu-id="7a635-108">В этом разделе предполагается знание [API WFP](/windows/desktop/FWP/windows-filtering-platform-start-page).</span><span class="sxs-lookup"><span data-stu-id="7a635-108">This topic assumes familiarity with the [WFP API](/windows/desktop/FWP/windows-filtering-platform-start-page).</span></span>

## <a name="why-extend-the-fphc"></a><span data-ttu-id="7a635-109">Зачем расширять ФФК?</span><span class="sxs-lookup"><span data-stu-id="7a635-109">Why Extend the FPHC?</span></span>

<span data-ttu-id="7a635-110">Все разработчики, которые пишут приложения, вызывающие API WFP, должны написать вспомогательный класс NDF, расширяющий ФФК.</span><span class="sxs-lookup"><span data-stu-id="7a635-110">All developers that write applications that call the WFP API should write an NDF helper class that extends FPHC.</span></span>

<span data-ttu-id="7a635-111">ФФК может опознать WFP как причину проблемы с подключением.</span><span class="sxs-lookup"><span data-stu-id="7a635-111">FPHC can identify WFP as the cause of a connectivity issue.</span></span> <span data-ttu-id="7a635-112">Если доступно, ФФК также может опознать поставщика, создавшего фильтр, который блокирует сетевой трафик.</span><span class="sxs-lookup"><span data-stu-id="7a635-112">If available, FPHC can also identify the provider that created the filter that is blocking network traffic.</span></span> <span data-ttu-id="7a635-113">ФФК передает эти сведения в NDF, который, в свою очередь, может уведомлять пользователя о том, что WFP вызывает проблему с подключением, и дает имя поставщика, блокирующего трафик.</span><span class="sxs-lookup"><span data-stu-id="7a635-113">FPHC passes this information to NDF, which in turn can then notify the user that WFP is causing the connectivity problem and give the name of the provider blocking traffic.</span></span>

<span data-ttu-id="7a635-114">Однако ФФК не может предложить пользователю корректирующее действие и не может указать причину, по которой фильтр блокирует трафик для пользователя.</span><span class="sxs-lookup"><span data-stu-id="7a635-114">However, the FPHC cannot suggest a corrective action to the user, nor can it provide the reason that the filter is blocking traffic to the user.</span></span> <span data-ttu-id="7a635-115">Только расширение ФФК может выполнять эти задачи.</span><span class="sxs-lookup"><span data-stu-id="7a635-115">Only a FPHC extension can perform those tasks.</span></span>

<span data-ttu-id="7a635-116">Рассмотрим стороннее приложение брандмауэра, вызывающее API WFP.</span><span class="sxs-lookup"><span data-stu-id="7a635-116">Consider a third-party firewall application that calls the WFP API.</span></span> <span data-ttu-id="7a635-117">Если брандмауэр стороннего разработчика реализует расширение ФФК, можно реализовать настраиваемые действия для обработки проблем с подключением, обнаруженных NDF.</span><span class="sxs-lookup"><span data-stu-id="7a635-117">If the third-party firewall implements a FPHC extension, then custom actions can be implemented to handle connectivity issues identified by NDF.</span></span> <span data-ttu-id="7a635-118">Когда NDF выполняет диагностику того, что приложение заблокировано брандмауэром стороннего разработчика, расширение ФФК может справиться с блокирующим событием.</span><span class="sxs-lookup"><span data-stu-id="7a635-118">When NDF diagnoses that an application has been blocked by the third-party firewall, the FPHC extension can handle the blocking event.</span></span> <span data-ttu-id="7a635-119">Одним из способов, которым расширение ФФК может справиться с событием, является предоставление пользователю запроса на разблокировку программы с помощью брандмауэра и последующее разблокирование программы после подтверждения пользователя.</span><span class="sxs-lookup"><span data-stu-id="7a635-119">One way that the FPHC extension could handle an event is to present the user with a prompt to unblock a program using the firewall and then unblock the program upon user confirmation.</span></span> <span data-ttu-id="7a635-120">Кроме того, расширение ФФК может справиться с событием, уведомляя пользователя о причине блокировки приложения, например о том, что приложение было заблокировано, так как оно было признано вредоносным по в брандмауэре.</span><span class="sxs-lookup"><span data-stu-id="7a635-120">Alternatively, the FPHC extension could handle an event by notifying the user of the reason why the application was blocked, such as an application was blocked because it was considered malware by the firewall.</span></span>

## <a name="about-wfp-diagnostics"></a><span data-ttu-id="7a635-121">О диагностике WFP</span><span class="sxs-lookup"><span data-stu-id="7a635-121">About WFP Diagnostics</span></span>

<span data-ttu-id="7a635-122">При вызове NDF для диагностики сетевой проблемы обратитесь к вспомогательным классам, чтобы определить причину проблемы.</span><span class="sxs-lookup"><span data-stu-id="7a635-122">When NDF is invoked to diagnose a network issue, helper classes are contacted to determine the cause of the issue.</span></span> <span data-ttu-id="7a635-123">Если вспомогательный класс более высокого уровня определяет, что сбой сети может быть вызван WFP, он создает гипотезу для ФФК на основе доступной информации.</span><span class="sxs-lookup"><span data-stu-id="7a635-123">If a higher-level helper class determines that a network failure may be caused by WFP, it generates a hypothesis for FPHC based on available information.</span></span> <span data-ttu-id="7a635-124">NDF передает эту гипотезу в виде нескольких атрибутов событий в ФФК.</span><span class="sxs-lookup"><span data-stu-id="7a635-124">NDF passes this hypothesis, in the form of several event attributes, to FPHC.</span></span> <span data-ttu-id="7a635-125">Эти атрибуты подробно описаны в разделе [атрибуты событий ФФК](#windows-filtering-platform-extensible-helper-class) ниже.</span><span class="sxs-lookup"><span data-stu-id="7a635-125">These attributes are described in detail in the [FPHC Event Attributes](#windows-filtering-platform-extensible-helper-class) section below.</span></span>

<span data-ttu-id="7a635-126">Сетевую проблему можно описать как проблему подключения, влияющую на конкретную попытки подключения.</span><span class="sxs-lookup"><span data-stu-id="7a635-126">A network issue can be described as a connectivity problem affecting a particular connection attempt.</span></span> <span data-ttu-id="7a635-127">Например, пользователь случайно заблокировал приложение, непреднамеренно нажимая кнопку **запретить**.</span><span class="sxs-lookup"><span data-stu-id="7a635-127">For example, the user may have accidentally blocked an application by inadvertently clicking **Don't allow**.</span></span> <span data-ttu-id="7a635-128">Затем брандмауэр блокирует привязку приложения к любому порту.</span><span class="sxs-lookup"><span data-stu-id="7a635-128">The firewall will then block the application from binding to any port.</span></span> <span data-ttu-id="7a635-129">Пользователь, не зная, почему приложение заблокирован, может попытаться диагностировать проблему с помощью точки входа, предлагаемой приложением.</span><span class="sxs-lookup"><span data-stu-id="7a635-129">The user, not knowing why the application is blocked, may try to diagnose the issue through an entry point offered by the application.</span></span> <span data-ttu-id="7a635-130">ФФК просматривает журналы, и при обнаружении совпадения он извлекает идентификатор фильтра и идентификатор поставщика этого фильтра.</span><span class="sxs-lookup"><span data-stu-id="7a635-130">FPHC will look at the logs, and if it finds a match it will retrieve the filter ID and the provider ID of that particular filter.</span></span> <span data-ttu-id="7a635-131">На этом этапе ФФК знает, кто является владельцем этого фильтра, и будет передавать диагностический процесс соответствующему вспомогательному классу для дальнейшей диагностики.</span><span class="sxs-lookup"><span data-stu-id="7a635-131">At this point, FPHC knows who the owner of that filter is, and it will hand over the diagnostic process to the appropriate helper class for further diagnosis.</span></span>

<span data-ttu-id="7a635-132">Наиболее свежее событие в журналах событий WFP, соответствующее атрибутам, выбирается в соответствии с сетевой проблемой.</span><span class="sxs-lookup"><span data-stu-id="7a635-132">The most recent event in the WFP event logs to match the attributes is selected as being relevant to the network issue.</span></span> <span data-ttu-id="7a635-133">Если соответствующие события не найдены и когда событие произошло в журнале WFP, ФФК указывает NDF, что он работоспособен.</span><span class="sxs-lookup"><span data-stu-id="7a635-133">If no matching events are found and the time the event happened is covered in the WFP log, FPHC indicates to NDF that it is healthy.</span></span> <span data-ttu-id="7a635-134">Если соответствующие события не найдены, а журналы WFP не содержат время возникновения события, ФФК возвращает неопределенное состояние в NDF.</span><span class="sxs-lookup"><span data-stu-id="7a635-134">If no matching events are found and the WFP logs do not include the time the event occurred, FPHC returns an indeterminate status to NDF.</span></span>

<span data-ttu-id="7a635-135">Если сопоставленное событие найдено, ФФК использует идентификатор поставщика фильтра, который вызывал событие для идентификации поставщика правила безопасности, которое блокирует подключение.</span><span class="sxs-lookup"><span data-stu-id="7a635-135">If a matching event is found, FPHC uses the provider ID of the filter which caused the event to identify the provider of the security rule that blocked connectivity.</span></span> <span data-ttu-id="7a635-136">Затем ФФК проверяет, существует ли расширение вспомогательного класса для этого поставщика.</span><span class="sxs-lookup"><span data-stu-id="7a635-136">FPHC then checks whether a helper class extension exists for that provider.</span></span> <span data-ttu-id="7a635-137">Если он найден, ФФК создает гипотезу для этого поставщика, а затем NDF вызывает расширение.</span><span class="sxs-lookup"><span data-stu-id="7a635-137">If one is found, FPHC generates a hypothesis for that provider and then NDF invokes the extension.</span></span> <span data-ttu-id="7a635-138">Расширение должно возвращать пользователю полезные сведения о диагностике и восстановлении.</span><span class="sxs-lookup"><span data-stu-id="7a635-138">The extension should return helpful diagnostic and repair information to the user.</span></span>

## <a name="helper-class-registration"></a><span data-ttu-id="7a635-139">Регистрация вспомогательного класса</span><span class="sxs-lookup"><span data-stu-id="7a635-139">Helper Class Registration</span></span>

<span data-ttu-id="7a635-140">Расширение ФФК должно быть зарегистрировано, как описано в статье [Регистрация расширений вспомогательного класса ndf](registering-ndf-helper-class-extensions.md).</span><span class="sxs-lookup"><span data-stu-id="7a635-140">A FPHC extension must be registered as described in [Registering NDF Helper Class Extensions](registering-ndf-helper-class-extensions.md).</span></span> <span data-ttu-id="7a635-141">Разработчики, реализующие вспомогательный класс, должны зарегистрировать свои расширения, чтобы гарантировать, что при необходимости расширение вызывается NDF.</span><span class="sxs-lookup"><span data-stu-id="7a635-141">Developers implementing a helper class must register their extensions to ensure that the extension is called by NDF when appropriate.</span></span> <span data-ttu-id="7a635-142">*Атрибут сопоставления* , описанный ниже, должен храниться в реестре в разделе **HKLM \\ System \\ CurrentControlSet \\ Control \\ нетдиагфкс** \\ *ИмяПоставщика* \\ **хостдллс** \\ *DLL-библиотеки вспомогательного класса* \\ **хелперклассес** \\ *имя вспомогательного класса* \\ **матчаттрибутес**.</span><span class="sxs-lookup"><span data-stu-id="7a635-142">The *matching attribute* described below must be stored in the registry under **HKLM\\System\\CurrentControlSet\\Control\\NetDiagFx**\\*VendorName*\\**HostDLLs**\\*Helper Class DLL*\\**HelperClasses**\\*Helper Class Name*\\**MatchAttributes**.</span></span>

<span data-ttu-id="7a635-143">В следующей таблице показан атрибут сопоставления, используемый для задания гипотезы, используемой в диагностике в журнале событий WFP.</span><span class="sxs-lookup"><span data-stu-id="7a635-143">The following table shows the matching attribute used to identify the hypothesis to use in diagnostics in the WFP event log.</span></span> 

| <span data-ttu-id="7a635-144">Имя</span><span class="sxs-lookup"><span data-stu-id="7a635-144">Name</span></span>       | <span data-ttu-id="7a635-145">Тип</span><span class="sxs-lookup"><span data-stu-id="7a635-145">Type</span></span>    | <span data-ttu-id="7a635-146">Описание</span><span class="sxs-lookup"><span data-stu-id="7a635-146">Description</span></span>                                                                                                                                                                                                                                                                                                 |
|------------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="7a635-147">ProviderID</span><span class="sxs-lookup"><span data-stu-id="7a635-147">ProviderID</span></span> | <span data-ttu-id="7a635-148">REG \_ SZ</span><span class="sxs-lookup"><span data-stu-id="7a635-148">REG\_SZ</span></span> | <span data-ttu-id="7a635-149">Идентификатор GUID расширения ФФК.</span><span class="sxs-lookup"><span data-stu-id="7a635-149">The GUID of the FPHC extension.</span></span> <span data-ttu-id="7a635-150">Это значение должно совпадать с идентификатором GUID поставщика WFP.</span><span class="sxs-lookup"><span data-stu-id="7a635-150">This value must be the same as the WFP Provider GUID.</span></span> <br/> <span data-ttu-id="7a635-151">В этой строке учитывается регистр.</span><span class="sxs-lookup"><span data-stu-id="7a635-151">This string is case-sensitive.</span></span> <span data-ttu-id="7a635-152">Он должен храниться в реестре в верхнем регистре с заключенными фигурными скобками и дефисами.</span><span class="sxs-lookup"><span data-stu-id="7a635-152">It should be stored in the registry in upper case with enclosing braces and hyphens.</span></span> <span data-ttu-id="7a635-153">Например, {C200E360-38C5-11CE-AE62-08002B2B79EF} является допустимым параметром ProviderID.</span><span class="sxs-lookup"><span data-stu-id="7a635-153">For example, {C200E360-38C5-11CE-AE62-08002B2B79EF} is a valid ProviderID.</span></span><br/> |



 

<span data-ttu-id="7a635-154">Если значение ProviderID фильтра блокировки совпадает с зарегистрированным вспомогательным классом, ФФК информирует службу NDF о необходимости вызова этого вспомогательного класса, тем самым расширяя возможности диагностики ФФК.</span><span class="sxs-lookup"><span data-stu-id="7a635-154">When the ProviderID of a blocking filter matches that of a registered helper class, FPHC informs NDF to invoke that helper class, thus extending the diagnostic capability of FPHC.</span></span>

## <a name="fphc-event-attributes"></a><span data-ttu-id="7a635-155">Атрибуты событий ФФК</span><span class="sxs-lookup"><span data-stu-id="7a635-155">FPHC Event Attributes</span></span>

<span data-ttu-id="7a635-156">В следующей таблице перечислены атрибуты событий, связанные с каждым сопоставленным событием.</span><span class="sxs-lookup"><span data-stu-id="7a635-156">The following table lists the event attributes associated with each matching event.</span></span> <span data-ttu-id="7a635-157">Каждый атрибут события хранится в структуре [**вспомогательного \_ атрибута**](/windows/win32/api/ndattrib/ns-ndattrib-helper_attribute) .</span><span class="sxs-lookup"><span data-stu-id="7a635-157">Each event attribute is stored in a [**HELPER\_ATTRIBUTE**](/windows/win32/api/ndattrib/ns-ndattrib-helper_attribute) structure.</span></span> <span data-ttu-id="7a635-158">Эти атрибуты передаются NDF в ФФК при обнаружении соответствующего события.</span><span class="sxs-lookup"><span data-stu-id="7a635-158">These attributes are passed by NDF to FPHC when a matching event is found.</span></span> <span data-ttu-id="7a635-159">Они могут передаваться в расширения ФФК.</span><span class="sxs-lookup"><span data-stu-id="7a635-159">These can in turn be passed to FPHC extensions.</span></span>



| <span data-ttu-id="7a635-160">attribute</span><span class="sxs-lookup"><span data-stu-id="7a635-160">Attribute</span></span>     | <span data-ttu-id="7a635-161">[**Атрибут \_ Значение типа**](/windows/win32/api/ndattrib/ne-ndattrib-attribute_type)</span><span class="sxs-lookup"><span data-stu-id="7a635-161">[**ATTRIBUTE\_TYPE**](/windows/win32/api/ndattrib/ne-ndattrib-attribute_type) value</span></span> | <span data-ttu-id="7a635-162">Описание</span><span class="sxs-lookup"><span data-stu-id="7a635-162">Description</span></span>                                                                                                                               |
|---------------|-------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="7a635-163">GUID поставщика</span><span class="sxs-lookup"><span data-stu-id="7a635-163">Provider GUID</span></span> | <span data-ttu-id="7a635-164">ПО \_ идентификатору GUID</span><span class="sxs-lookup"><span data-stu-id="7a635-164">AT\_GUID</span></span>                                        | <span data-ttu-id="7a635-165">Идентификатор GUID поставщика, связанного с фильтром.</span><span class="sxs-lookup"><span data-stu-id="7a635-165">The GUID of the provider associated with the filter.</span></span>                                                                                      |
| <span data-ttu-id="7a635-166">Отметка времени</span><span class="sxs-lookup"><span data-stu-id="7a635-166">Timestamp</span></span>     | <span data-ttu-id="7a635-167">в \_ строке октета \_</span><span class="sxs-lookup"><span data-stu-id="7a635-167">AT\_OCTET\_STRING</span></span>                               | <span data-ttu-id="7a635-168">Буфер типа FILETIME, указывающий время возникновения события.</span><span class="sxs-lookup"><span data-stu-id="7a635-168">A buffer of type FILETIME that specifies the time at which the event occurred.</span></span> <span data-ttu-id="7a635-169">Эта отметка времени может использоваться для уникальной идентификации события.</span><span class="sxs-lookup"><span data-stu-id="7a635-169">This time stamp can be used to uniquely identify an event.</span></span> |
| <span data-ttu-id="7a635-170">иппротокол</span><span class="sxs-lookup"><span data-stu-id="7a635-170">ipProtocol</span></span>    | <span data-ttu-id="7a635-171">В \_ UINT32</span><span class="sxs-lookup"><span data-stu-id="7a635-171">AT\_UINT32</span></span>                                      | <span data-ttu-id="7a635-172">Протокол транспортного уровня в формате UINT8.</span><span class="sxs-lookup"><span data-stu-id="7a635-172">The transport layer protocol, in UINT8 format.</span></span>                                                                                            |
| <span data-ttu-id="7a635-173">локаладдр</span><span class="sxs-lookup"><span data-stu-id="7a635-173">LocalAddr</span></span>     | <span data-ttu-id="7a635-174">по адресу \_ SOCKADDR</span><span class="sxs-lookup"><span data-stu-id="7a635-174">AT\_SOCKADDR</span></span>                                    | <span data-ttu-id="7a635-175">Локальный IP-адрес и порт, хранимые в структуре [**DIAG \_ SOCKADDR**](/windows/win32/api/ndattrib/ns-ndattrib-diag_sockaddr) .</span><span class="sxs-lookup"><span data-stu-id="7a635-175">The local IP address and port, stored in a [**DIAG\_SOCKADDR**](/windows/win32/api/ndattrib/ns-ndattrib-diag_sockaddr) structure.</span></span>                                             |
| <span data-ttu-id="7a635-176">ремотеаддр</span><span class="sxs-lookup"><span data-stu-id="7a635-176">RemoteAddr</span></span>    | <span data-ttu-id="7a635-177">по адресу \_ SOCKADDR</span><span class="sxs-lookup"><span data-stu-id="7a635-177">AT\_SOCKADDR</span></span>                                    | <span data-ttu-id="7a635-178">Удаленный IP-адрес и порт, хранимые в структуре [**DIAG \_ SOCKADDR**](/windows/win32/api/ndattrib/ns-ndattrib-diag_sockaddr) .</span><span class="sxs-lookup"><span data-stu-id="7a635-178">The remote IP address and port, stored in a [**DIAG\_SOCKADDR**](/windows/win32/api/ndattrib/ns-ndattrib-diag_sockaddr) structure.</span></span>                                            |
| <span data-ttu-id="7a635-179">userId</span><span class="sxs-lookup"><span data-stu-id="7a635-179">userId</span></span>        | <span data-ttu-id="7a635-180">в \_ строке октета \_</span><span class="sxs-lookup"><span data-stu-id="7a635-180">AT\_OCTET\_STRING</span></span>                               | <span data-ttu-id="7a635-181">Буфер типа SID, представляющий UserID.</span><span class="sxs-lookup"><span data-stu-id="7a635-181">A buffer of type SID that represents the userid.</span></span> <span data-ttu-id="7a635-182">Если userId имеет длину 0, идентификатор безопасности недоступен.</span><span class="sxs-lookup"><span data-stu-id="7a635-182">If userId is of length 0, the SID is unavailable.</span></span>                                        |
| <span data-ttu-id="7a635-183">appId</span><span class="sxs-lookup"><span data-stu-id="7a635-183">appId</span></span>         | <span data-ttu-id="7a635-184">в \_ строке</span><span class="sxs-lookup"><span data-stu-id="7a635-184">AT\_STRING</span></span>                                      | <span data-ttu-id="7a635-185">Буфер, в котором хранится полученный идентификатор приложения.</span><span class="sxs-lookup"><span data-stu-id="7a635-185">A buffer that stores the retrieved application identifier.</span></span> <span data-ttu-id="7a635-186">Если appId имеет значение L "", идентификатор приложения недоступен.</span><span class="sxs-lookup"><span data-stu-id="7a635-186">If appId has a value of L"", the application identifier is unavailable.</span></span>        |



 

## <a name="handling-fphc-events"></a><span data-ttu-id="7a635-187">Обработка событий ФФК</span><span class="sxs-lookup"><span data-stu-id="7a635-187">Handling FPHC Events</span></span>

<span data-ttu-id="7a635-188">Прежде чем предложить пользователю сведения о диагностике и восстановлении, расширение ФФК должно собрать больше данных, чем предоставлено в уведомлениях ФФК.</span><span class="sxs-lookup"><span data-stu-id="7a635-188">Before suggesting diagnostic and repair information to the user, a FPHC extension should gather more data than is provided by the FPHC notifications.</span></span> <span data-ttu-id="7a635-189">Эти данные могут быть получены из [функций управления событиями WFP](/windows/desktop/FWP/fwp-mgmt-functions).</span><span class="sxs-lookup"><span data-stu-id="7a635-189">This data can be acquired from the [WFP Event Management Functions](/windows/desktop/FWP/fwp-mgmt-functions).</span></span> <span data-ttu-id="7a635-190">Эти функции демонстрируются в примере [отображения событий NET](/windows/desktop/FWP/displaying-net-events) .</span><span class="sxs-lookup"><span data-stu-id="7a635-190">These functions are demonstrated in the [Displaying Net Events](/windows/desktop/FWP/displaying-net-events) sample.</span></span>

<span data-ttu-id="7a635-191">В пакет SDK входит пример более подробного управления событиями.</span><span class="sxs-lookup"><span data-stu-id="7a635-191">A more detailed event management sample is included in the SDK.</span></span> <span data-ttu-id="7a635-192">Исходный код для примера можно найти в расположении установки пакета SDK в разделе C: \\ Program Files \\ Microsoft SDKs \\ Windows \\ <version number> \\ Samples \\ нетдс \\ WFP \\ диажевентс.</span><span class="sxs-lookup"><span data-stu-id="7a635-192">The source code for the sample can be found in the SDK installation location under C:\\Program Files\\Microsoft SDKs\\Windows\\<version number>\\Samples\\NetDs\\WFP\\DiagEvents.</span></span> <span data-ttu-id="7a635-193">Пакет SDK для Windows Vista доступен в [центре загрузки](https://www.microsoft.com/downloads/details.aspx?FamilyID=f26b1aa4-741a-433a-9be5-fa919850bdbf).</span><span class="sxs-lookup"><span data-stu-id="7a635-193">The Windows Vista SDK is available from the [Download Center](https://www.microsoft.com/downloads/details.aspx?FamilyID=f26b1aa4-741a-433a-9be5-fa919850bdbf).</span></span>

## <a name="built-in-fphc-diagnostics"></a><span data-ttu-id="7a635-194">Встроенная диагностика ФФК</span><span class="sxs-lookup"><span data-stu-id="7a635-194">Built-in FPHC Diagnostics</span></span>

<span data-ttu-id="7a635-195">При отсутствии расширения ФФК ФФК может диагностировать сценарии, перечисленные ниже.</span><span class="sxs-lookup"><span data-stu-id="7a635-195">In the absence of an FPHC extension, FPHC can diagnose the scenarios listed below.</span></span> <span data-ttu-id="7a635-196">Большинство сбоев подключения, которые можно диагностировать с помощью ФФК, возникают, так как брандмауэры блокируют трафик.</span><span class="sxs-lookup"><span data-stu-id="7a635-196">Most connectivity failures diagnosed by FPHC occur because firewalls block traffic.</span></span> <span data-ttu-id="7a635-197">Сценарии IPsec менее распространены.</span><span class="sxs-lookup"><span data-stu-id="7a635-197">The IPsec scenarios are less common.</span></span>

<span data-ttu-id="7a635-198">В следующей таблице показаны некоторые сценарии, приводящие к сбоям подключения, которые можно диагностировать с помощью ФФК, а также описание и сведения об исправлении, передаваемые NDF.</span><span class="sxs-lookup"><span data-stu-id="7a635-198">The following table shows some scenarios causing connectivity failures that can be diagnosed by FPHC, along with the description and repair information passed to NDF.</span></span>



| <span data-ttu-id="7a635-199">Сценарий</span><span class="sxs-lookup"><span data-stu-id="7a635-199">Scenario</span></span>                   | <span data-ttu-id="7a635-200">Описание низкого уровня работоспособности</span><span class="sxs-lookup"><span data-stu-id="7a635-200">Low health description</span></span>                                                                                                               | <span data-ttu-id="7a635-201">Сведения об исправлении</span><span class="sxs-lookup"><span data-stu-id="7a635-201">Repair information</span></span>                   |
|----------------------------|--------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
| <span data-ttu-id="7a635-202">Брандмауэр Drop</span><span class="sxs-lookup"><span data-stu-id="7a635-202">Firewall drop</span></span>              | <span data-ttu-id="7a635-203">Параметры брандмауэра на этом компьютере блокируют подключение.</span><span class="sxs-lookup"><span data-stu-id="7a635-203">The firewall settings on this computer are blocking the connection.</span></span>                                                                  | <span data-ttu-id="7a635-204">Проверьте параметры брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="7a635-204">Verify your firewall settings.</span></span>       |
| <span data-ttu-id="7a635-205">Сбой основного режима</span><span class="sxs-lookup"><span data-stu-id="7a635-205">Main Mode Failure</span></span>          | <span data-ttu-id="7a635-206">Невозможно подключиться из-за несоответствия политики безопасности IPsec.</span><span class="sxs-lookup"><span data-stu-id="7a635-206">You cannot connect because of an IPsec security policy mismatch.</span></span>                                                                     | <span data-ttu-id="7a635-207">Обратитесь к владельцу политики IPsec.</span><span class="sxs-lookup"><span data-stu-id="7a635-207">Contact the IPsec policy owner.</span></span>      |
| <span data-ttu-id="7a635-208">Сбой быстрого режима</span><span class="sxs-lookup"><span data-stu-id="7a635-208">Quick Mode Failure</span></span>         | <span data-ttu-id="7a635-209">Невозможно подключиться из-за несоответствия политики безопасности IPsec.</span><span class="sxs-lookup"><span data-stu-id="7a635-209">You cannot connect because of an IPsec security policy mismatch.</span></span>                                                                     | <span data-ttu-id="7a635-210">Обратитесь к владельцу политики IPsec.</span><span class="sxs-lookup"><span data-stu-id="7a635-210">Contact the IPsec policy owner.</span></span>      |
| <span data-ttu-id="7a635-211">Сбой в пользовательском режиме</span><span class="sxs-lookup"><span data-stu-id="7a635-211">User Mode Failure</span></span>          | <span data-ttu-id="7a635-212">Невозможно подключиться из-за несоответствия политики безопасности IPsec.</span><span class="sxs-lookup"><span data-stu-id="7a635-212">You cannot connect because of an IPsec security policy mismatch.</span></span>                                                                     | <span data-ttu-id="7a635-213">Обратитесь к владельцу политики IPsec.</span><span class="sxs-lookup"><span data-stu-id="7a635-213">Contact the IPsec policy owner.</span></span>      |
| <span data-ttu-id="7a635-214">Сбой учетных данных</span><span class="sxs-lookup"><span data-stu-id="7a635-214">Credential Failure</span></span>         | <span data-ttu-id="7a635-215">Невозможно подключиться, так как корневой центр сертификации (ЦС) на этом компьютере не совпадает с корневым ЦС на удаленном компьютере.</span><span class="sxs-lookup"><span data-stu-id="7a635-215">You cannot connect because the root certification authority (CA) on this computer does not match the root CA on the remote computer.</span></span> | <span data-ttu-id="7a635-216">Обновите доверенный корневой сертификат.</span><span class="sxs-lookup"><span data-stu-id="7a635-216">Update the trusted root certificate.</span></span> |
| <span data-ttu-id="7a635-217">Сертификат с истекшим сроком действия</span><span class="sxs-lookup"><span data-stu-id="7a635-217">Expired Certificate</span></span>        | <span data-ttu-id="7a635-218">Срок действия сертификата, используемого для проверки подлинности IPsec, истек.</span><span class="sxs-lookup"><span data-stu-id="7a635-218">The certificate used for IPsec authentication has expired.</span></span>                                                                           | <span data-ttu-id="7a635-219">Запросите сертификат.</span><span class="sxs-lookup"><span data-stu-id="7a635-219">Request a certificate.</span></span>               |
| <span data-ttu-id="7a635-220">Другие сбои сертификатов</span><span class="sxs-lookup"><span data-stu-id="7a635-220">Other certificate failures</span></span> | <span data-ttu-id="7a635-221">Не найден допустимый сертификат для проверки подлинности IPsec.</span><span class="sxs-lookup"><span data-stu-id="7a635-221">A valid certificate was not found for IPsec authentication.</span></span>                                                                          | <span data-ttu-id="7a635-222">Запросите сертификат.</span><span class="sxs-lookup"><span data-stu-id="7a635-222">Request a certificate.</span></span>               |
| <span data-ttu-id="7a635-223">Сбой Kerberos</span><span class="sxs-lookup"><span data-stu-id="7a635-223">Kerberos failure</span></span>           | <span data-ttu-id="7a635-224">Компьютер не является частью этого домена.</span><span class="sxs-lookup"><span data-stu-id="7a635-224">The computer is not part of this domain.</span></span>                                                                                             | <span data-ttu-id="7a635-225">Присоединение этого компьютера к домену.</span><span class="sxs-lookup"><span data-stu-id="7a635-225">Join this computer to a domain.</span></span>      |
| <span data-ttu-id="7a635-226">Общий ключ</span><span class="sxs-lookup"><span data-stu-id="7a635-226">Preshared Key</span></span>              | <span data-ttu-id="7a635-227">Сбросьте все общие ключи.</span><span class="sxs-lookup"><span data-stu-id="7a635-227">Reset the preshared keys.</span></span>                                                                                                            | <span data-ttu-id="7a635-228">Сбросьте все общие ключи.</span><span class="sxs-lookup"><span data-stu-id="7a635-228">Reset the preshared keys.</span></span>            |



 

## <a name="related-topics"></a><span data-ttu-id="7a635-229">См. также</span><span class="sxs-lookup"><span data-stu-id="7a635-229">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="7a635-230">Платформа фильтрации Windows</span><span class="sxs-lookup"><span data-stu-id="7a635-230">Windows Filtering Platform</span></span>](/windows/desktop/FWP/windows-filtering-platform-start-page)
</dt> <dt>

[<span data-ttu-id="7a635-231">Проектирование расширений вспомогательных классов NDF</span><span class="sxs-lookup"><span data-stu-id="7a635-231">Designing NDF Helper Class Extensions</span></span>](designing-ndf-helper-class-extensions.md)
</dt> <dt>

[<span data-ttu-id="7a635-232">Регистрация расширений вспомогательного класса NDF</span><span class="sxs-lookup"><span data-stu-id="7a635-232">Registering NDF Helper Class Extensions</span></span>](registering-ndf-helper-class-extensions.md)
</dt> <dt>

[<span data-ttu-id="7a635-233">Примеры классов поддержки NDF</span><span class="sxs-lookup"><span data-stu-id="7a635-233">NDF Helper Class Examples</span></span>](ndf-helper-class-examples.md)
</dt> </dl>

 

