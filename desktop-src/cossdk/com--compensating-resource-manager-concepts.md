---
description: Можно использовать компенсирующий диспетчер ресурсов COM+ (CRM), чтобы легко и быстро интегрировать ресурсы приложений с транзакциями Microsoft координатор распределенных транзакций (DTC).
ms.assetid: 8d1d034f-8a09-40ae-842a-5251135bd3c8
title: Основные понятия о компенсации диспетчер ресурсов COM+
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 14206a54ffcb4f7e06ddf7362736a722393b0791
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103990546"
---
# <a name="com-compensating-resource-manager-concepts"></a><span data-ttu-id="51d08-103">Основные понятия о компенсации диспетчер ресурсов COM+</span><span class="sxs-lookup"><span data-stu-id="51d08-103">COM+ Compensating Resource Manager Concepts</span></span>

<span data-ttu-id="51d08-104">Можно использовать компенсирующий диспетчер ресурсов COM+ (CRM), чтобы легко и быстро интегрировать ресурсы приложений с транзакциями Microsoft координатор распределенных транзакций (DTC).</span><span class="sxs-lookup"><span data-stu-id="51d08-104">You can use the COM+ Compensating Resource Manager (CRM) to easily and quickly integrate application resources with Microsoft Distributed Transaction Coordinator (DTC) transactions.</span></span> <span data-ttu-id="51d08-105">Ресурсы приложения могут проголосовать за результат транзакции, а также получить конечное уведомление о его результатах.</span><span class="sxs-lookup"><span data-stu-id="51d08-105">Your application resources can vote on the outcome of a transaction and can receive final notification of its outcome.</span></span> <span data-ttu-id="51d08-106">Создается устойчивый журнал, чтобы ресурсы приложения могли записывать записи, которые остались неудачными, а CRM восстанавливает этот файл журнала при перезапуске приложения.</span><span class="sxs-lookup"><span data-stu-id="51d08-106">A durable log is generated so that your application resources can write records that survive failures, and the CRM recovers this log file when the application restarts.</span></span>

<span data-ttu-id="51d08-107">В состав CRM входят следующие два компонента:</span><span class="sxs-lookup"><span data-stu-id="51d08-107">A CRM consists of the following two components:</span></span>

-   <span data-ttu-id="51d08-108">Рабочая роль CRM.</span><span class="sxs-lookup"><span data-stu-id="51d08-108">CRM Worker.</span></span> <span data-ttu-id="51d08-109">Этот компонент выполняет основную работу конкретного CRM и реализует интерфейс, относящийся к задаче, которую он должен выполнить.</span><span class="sxs-lookup"><span data-stu-id="51d08-109">This component performs the main work of the specific CRM and implements an interface specific to the task it needs to perform.</span></span> <span data-ttu-id="51d08-110">Инфраструктура CRM предоставляет интерфейс рабочей роли CRM, с помощью которой Рабочая роль CRM может записывать записи в устойчивый файл журнала на диске.</span><span class="sxs-lookup"><span data-stu-id="51d08-110">The CRM infrastructure provides an interface to the CRM Worker through which the CRM Worker can write records to a durable log file on disk.</span></span> <span data-ttu-id="51d08-111">Рабочая роль CRM должна записать записи в журнал и сделать их устойчивыми, прежде чем выполнять свою работу, чтобы при возникновении сбоя восстановление могла выполняться правильно.</span><span class="sxs-lookup"><span data-stu-id="51d08-111">The CRM Worker must write records to the log and make them durable before it performs its work so that, if a crash occurs, recovery can occur correctly.</span></span> <span data-ttu-id="51d08-112">Работнику CRM всегда требуется транзакция.</span><span class="sxs-lookup"><span data-stu-id="51d08-112">The CRM Worker always requires a transaction.</span></span>
-   <span data-ttu-id="51d08-113">Компенсатор CRM.</span><span class="sxs-lookup"><span data-stu-id="51d08-113">CRM Compensator.</span></span> <span data-ttu-id="51d08-114">Этот компонент создается инфраструктурой CRM по завершении транзакции.</span><span class="sxs-lookup"><span data-stu-id="51d08-114">This component is created by the CRM infrastructure at the completion of the transaction.</span></span> <span data-ttu-id="51d08-115">Он реализует определенный интерфейс, с помощью которого инфраструктура CRM может передавать уведомления о завершении транзакций и записи журнала, которые ранее были записаны рабочей ролью CRM.</span><span class="sxs-lookup"><span data-stu-id="51d08-115">It implements a defined interface by which the CRM infrastructure can pass on notifications of transaction completion and the log records that were previously written by the CRM Worker.</span></span>

<span data-ttu-id="51d08-116">COM+ CRM обеспечивает атомарность с помощью уведомлений о транзакциях и устойчивость к журналу CRM, но не обеспечивает изоляцию ресурсов.</span><span class="sxs-lookup"><span data-stu-id="51d08-116">A COM+ CRM provides atomicity with transactional notifications, and durability with the CRM log, but does not provide isolation of resources.</span></span> <span data-ttu-id="51d08-117">В многопоточной среде обязанностью разработчика CRM является обеспечение того, что доступ к ресурсам с помощью нескольких рабочих ролей CRM или внешних приложений сериализуется во время транзакции.</span><span class="sxs-lookup"><span data-stu-id="51d08-117">In a multithreaded environment, it is the responsibility of the CRM developer to ensure that access to resources, either by multiple CRM Workers or external applications, is serialized while in a transaction.</span></span>

<span data-ttu-id="51d08-118">После того как транзакция пройдет фазу подготовки, сотрудники CRM и CRM могут работать параллельно.</span><span class="sxs-lookup"><span data-stu-id="51d08-118">After the transaction has passed the prepare phase, the CRM Compensator and CRM Workers can be running concurrently.</span></span> <span data-ttu-id="51d08-119">Рабочий компонент CRM новой транзакции может стать активным, пока компенсатор CRM предыдущей транзакции все еще обрабатывает предыдущую транзакцию.</span><span class="sxs-lookup"><span data-stu-id="51d08-119">It is possible for the CRM Worker component of a new transaction to become active while the CRM Compensator of a previous transaction is still processing the previous transaction.</span></span>

<span data-ttu-id="51d08-120">Во время сбоев до восстановления серверного приложения CRM прерванная транзакция должна считаться активной и незавершенной.</span><span class="sxs-lookup"><span data-stu-id="51d08-120">During failures prior to recovery of the CRM server application, an interrupted transaction should be considered active and not complete.</span></span> <span data-ttu-id="51d08-121">Внешние процессы не должны иметь возможности доступа к ресурсам, которые были изменены этой конкретной транзакцией до восстановления процесса сервера CRM.</span><span class="sxs-lookup"><span data-stu-id="51d08-121">It should not be possible for external processes to access the resources that were being changed by this particular transaction prior to recovery of the CRM server process.</span></span>

<span data-ttu-id="51d08-122">В CRM определены три типа интерфейсов для основных функций CRM:</span><span class="sxs-lookup"><span data-stu-id="51d08-122">The CRM defines three interface types for the basic CRM functions:</span></span>

-   <span data-ttu-id="51d08-123">[**Икрмлогконтрол**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol) реализуется в Клерке CRM и используется работником CRM для записи записей журнала в журнал.</span><span class="sxs-lookup"><span data-stu-id="51d08-123">[**ICrmLogControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol) is implemented on the CRM clerk and is used by the CRM Worker to write log records to the log.</span></span> <span data-ttu-id="51d08-124">Он также может использоваться компенсатором CRM.</span><span class="sxs-lookup"><span data-stu-id="51d08-124">It can also used by the CRM Compensator.</span></span>
-   <span data-ttu-id="51d08-125">[**Икрмкомпенсатор**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmcompensator) и [**Икрмкомпенсаторвариантс**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmcompensatorvariants) РЕАЛИЗУЮТСЯ в компенсаторе CRM.</span><span class="sxs-lookup"><span data-stu-id="51d08-125">[**ICrmCompensator**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmcompensator) and [**ICrmCompensatorVariants**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmcompensatorvariants) are implemented on the CRM Compensator.</span></span> <span data-ttu-id="51d08-126">Эти интерфейсы используются для доставки уведомлений о результатах транзакций и связанных с ними записей журнала в компенсатор CRM.</span><span class="sxs-lookup"><span data-stu-id="51d08-126">These interfaces are used to deliver transaction outcome notifications and their associated log records to the CRM Compensator.</span></span> <span data-ttu-id="51d08-127">Как правило, компенсатор CRM реализует только один из этих интерфейсов в зависимости от того, требуются ли ему неструктурированные или структурные записи журнала.</span><span class="sxs-lookup"><span data-stu-id="51d08-127">Normally, the CRM Compensator would implement only one of these interfaces, depending on whether it required unstructured or structured log records.</span></span> <span data-ttu-id="51d08-128">*Структурированные записи журнала* — это те, которые встроены в коллекцию вариантов и обычно используются в Microsoft Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="51d08-128">*Structured log records* are those that are built up as a collection of Variants and are typically for use by Microsoft Visual Basic.</span></span> <span data-ttu-id="51d08-129">*Неструктурированные записи журнала* представляют собой только буфер байтов и обычно используются Microsoft Visual C++.</span><span class="sxs-lookup"><span data-stu-id="51d08-129">*Unstructured log records* are just a buffer of bytes and are typically for use by Microsoft Visual C++.</span></span> <span data-ttu-id="51d08-130">Компенсатор CRM может реализовывать оба интерфейса компенсатора; Однако для доставки записей журнала используется только один объект за раз.</span><span class="sxs-lookup"><span data-stu-id="51d08-130">A CRM Compensator can implement both of the compensator interfaces; however, only one at a time is used to deliver log records.</span></span>
-   <span data-ttu-id="51d08-131">Интерфейсы мониторинга COM+ CRM используются для мониторинга Крмс в определенном серверном приложении.</span><span class="sxs-lookup"><span data-stu-id="51d08-131">The COM+ CRM monitoring interfaces are used for monitoring the CRMs within a particular server application.</span></span> <span data-ttu-id="51d08-132">Подробные сведения об интерфейсах мониторинга см. в разделе [com+ CRM Monitoring interfaces](com--crm-monitoring-interfaces.md).</span><span class="sxs-lookup"><span data-stu-id="51d08-132">For detailed information about the monitoring interfaces, see [COM+ CRM Monitoring Interfaces](com--crm-monitoring-interfaces.md).</span></span>

<span data-ttu-id="51d08-133">В следующих подразделах этого раздела содержатся дополнительные сведения о службе COM+ CRM.</span><span class="sxs-lookup"><span data-stu-id="51d08-133">The following topics in this section provide more detail about the COM+ CRM service:</span></span>

-   [<span data-ttu-id="51d08-134">Вопросы безопасности COM+ CRM</span><span class="sxs-lookup"><span data-stu-id="51d08-134">COM+ CRM Security Considerations</span></span>](com--crm-security-considerations.md)
-   [<span data-ttu-id="51d08-135">Операционный процесс COM+ CRM</span><span class="sxs-lookup"><span data-stu-id="51d08-135">COM+ CRM Operating Process</span></span>](com--crm-operating-process.md)
-   [<span data-ttu-id="51d08-136">Запуск и восстановление COM+ CRM</span><span class="sxs-lookup"><span data-stu-id="51d08-136">COM+ CRM Startup and Recovery</span></span>](com--crm-startup-and-recovery.md)
-   [<span data-ttu-id="51d08-137">Использование COM+ CRM в среде кластера</span><span class="sxs-lookup"><span data-stu-id="51d08-137">Using the COM+ CRM in a Cluster Environment</span></span>](using-the-com--crm-in-a-cluster-environment.md)
-   [<span data-ttu-id="51d08-138">Обработка ошибок в COM+ CRM</span><span class="sxs-lookup"><span data-stu-id="51d08-138">Error Handling in the COM+ CRM</span></span>](error-handling-in-the-com--crm.md)
-   [<span data-ttu-id="51d08-139">Параметры реестра COM+ CRM</span><span class="sxs-lookup"><span data-stu-id="51d08-139">COM+ CRM Registry Settings</span></span>](com--crm-registry-settings.md)
-   [<span data-ttu-id="51d08-140">Устранение неполадок COM+ CRM</span><span class="sxs-lookup"><span data-stu-id="51d08-140">Troubleshooting the COM+ CRM</span></span>](troubleshooting-the-com--crm.md)
-   [<span data-ttu-id="51d08-141">Предложения по проектированию для разработки COM+ CRM</span><span class="sxs-lookup"><span data-stu-id="51d08-141">Design Suggestions for Developing a COM+ CRM</span></span>](design-suggestions-for-developing-a-com--crm.md)
-   [<span data-ttu-id="51d08-142">Интерфейсы мониторинга COM+ CRM</span><span class="sxs-lookup"><span data-stu-id="51d08-142">COM+ CRM Monitoring Interfaces</span></span>](com--crm-monitoring-interfaces.md)
-   [<span data-ttu-id="51d08-143">Интерфейсы COM+ CRM</span><span class="sxs-lookup"><span data-stu-id="51d08-143">COM+ CRM Interfaces</span></span>](com--crm-interfaces.md)

## <a name="related-topics"></a><span data-ttu-id="51d08-144">См. также</span><span class="sxs-lookup"><span data-stu-id="51d08-144">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="51d08-145">Задачи компенсирующих диспетчер ресурсов COM+</span><span class="sxs-lookup"><span data-stu-id="51d08-145">COM+ Compensating Resource Manager Tasks</span></span>](com--compensating-resource-manager-tasks.md)
</dt> </dl>

 

 



