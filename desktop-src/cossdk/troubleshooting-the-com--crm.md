---
description: Устранение неполадок COM+ CRM
ms.assetid: 4d2d9372-b540-4e08-9b57-8687802610b6
title: Устранение неполадок COM+ CRM
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1b04e37d183dbf3df8d017e780917f955e14a033
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104539050"
---
# <a name="troubleshooting-the-com-crm"></a><span data-ttu-id="594fb-103">Устранение неполадок COM+ CRM</span><span class="sxs-lookup"><span data-stu-id="594fb-103">Troubleshooting the COM+ CRM</span></span>

<span data-ttu-id="594fb-104">Ниже перечислены наиболее распространенные проблемы, возникающие при разработке и использовании COM+ CRM.</span><span class="sxs-lookup"><span data-stu-id="594fb-104">Following are the most common problems encountered when developing and using the COM+ CRM:</span></span>

-   <span data-ttu-id="594fb-105">**Сообщения журнала событий.**</span><span class="sxs-lookup"><span data-stu-id="594fb-105">**Event log messages.**</span></span> <span data-ttu-id="594fb-106">Если серверное приложение CRM обнаруживает серьезную внутреннюю ошибку, оно будет FailFast (завершить процесс серверного приложения CRM) и записать сообщение в журнал событий Windows.</span><span class="sxs-lookup"><span data-stu-id="594fb-106">If the CRM server application encounters a serious internal error, it will failfast (terminate the CRM server application process) and write a message to the Windows event log.</span></span> <span data-ttu-id="594fb-107">Если возникнут проблемы, обратитесь к журналу событий.</span><span class="sxs-lookup"><span data-stu-id="594fb-107">Please refer to the event log if any problems are encountered.</span></span>

-   <span data-ttu-id="594fb-108">**Исключения из компенсатора CRM.**</span><span class="sxs-lookup"><span data-stu-id="594fb-108">**Exceptions from the CRM Compensator.**</span></span> <span data-ttu-id="594fb-109">Инфраструктура CRM создает компенсатор CRM и передает ему уведомления о результатах транзакции и записи журнала, записанные рабочим работником CRM.</span><span class="sxs-lookup"><span data-stu-id="594fb-109">The CRM infrastructure creates the CRM Compensator and passes it the transaction outcome notifications and the log records written by the CRM Worker.</span></span> <span data-ttu-id="594fb-110">Если CRM-компенсатор возвращает ошибку или создает исключение, оно перехватывается инфраструктурой CRM и вызывает FailFast.</span><span class="sxs-lookup"><span data-stu-id="594fb-110">If the CRM Compensator returns an error or throws an exception, it is caught by the CRM infrastructure and causes a failfast.</span></span> <span data-ttu-id="594fb-111">Сообщение в журнале событий указывает на то, что было получено исключение от компенсатора CRM.</span><span class="sxs-lookup"><span data-stu-id="594fb-111">A message in the event log indicates that an exception was received from the CRM Compensator.</span></span> <span data-ttu-id="594fb-112">Эти исключения можно игнорировать.</span><span class="sxs-lookup"><span data-stu-id="594fb-112">It is possible to force these exceptions to be ignored.</span></span> <span data-ttu-id="594fb-113">(См. [раздел Параметры системного реестра com+ CRM](com--crm-registry-settings.md).) Исключения из компенсатора CRM, скорее всего, означают проблему в конкретном компоненте CRM Compensator, а не в самой инфраструктуре CRM.</span><span class="sxs-lookup"><span data-stu-id="594fb-113">(See [COM+ CRM Registry Settings](com--crm-registry-settings.md).) Exceptions from the CRM Compensator most likely mean a problem in the specific CRM Compensator component and not in the CRM infrastructure itself.</span></span>

-   <span data-ttu-id="594fb-114">**Трассировка восстановления.**</span><span class="sxs-lookup"><span data-stu-id="594fb-114">**Recovery trace.**</span></span> <span data-ttu-id="594fb-115">Трассировка восстановления может быть очень полезной для определения проблем во время восстановления.</span><span class="sxs-lookup"><span data-stu-id="594fb-115">The recovery trace can be very useful to determine problems during recovery.</span></span> <span data-ttu-id="594fb-116">Дополнительные сведения о включении трассировки восстановления см. в разделе [параметры реестра com+ CRM](com--crm-registry-settings.md).</span><span class="sxs-lookup"><span data-stu-id="594fb-116">For information about enabling recovery trace, see [COM+ CRM Registry Settings](com--crm-registry-settings.md).</span></span>

-   <span data-ttu-id="594fb-117">**Попытка запуска с CRM не включена.**</span><span class="sxs-lookup"><span data-stu-id="594fb-117">**Trying to run with the CRM not enabled.**</span></span> <span data-ttu-id="594fb-118">Не достаточно просто поместить компоненты CRM Worker и CRM Compensator в серверное приложение COM+.</span><span class="sxs-lookup"><span data-stu-id="594fb-118">It is not sufficient simply to place the CRM Worker and CRM Compensator components into the COM+ server application.</span></span> <span data-ttu-id="594fb-119">Поддержка Крмс должна быть специально включена для конкретного серверного приложения COM+ с помощью параметра **Включить компенсирующие диспетчеры ресурсов** на вкладке **Дополнительно** страницы свойств приложения COM+.</span><span class="sxs-lookup"><span data-stu-id="594fb-119">Support for CRMs must be specifically enabled for the specific COM+ server application using the **Enable compensating resource managers** option on the **Advanced** tab of the COM+ application's property pages.</span></span> <span data-ttu-id="594fb-120">(Дополнительные сведения см. в разделе [Настройка компонентов COM+ CRM](configuring-com--crm-components.md) .) При попытке использовать CRM внутри серверного приложения, на котором не включен CRM, в рабочую роль CRM возвращается код ошибки.</span><span class="sxs-lookup"><span data-stu-id="594fb-120">(See [Configuring COM+ CRM Components](configuring-com--crm-components.md) for more information.) If an attempt is made to use a CRM inside a server application that does not have the CRM enabled, an error code is returned to the CRM Worker.</span></span>

-   <span data-ttu-id="594fb-121">**Попытка запуска Крмс в клиентских процессах.**</span><span class="sxs-lookup"><span data-stu-id="594fb-121">**Trying to run CRMs in client processes.**</span></span> <span data-ttu-id="594fb-122">Крмс не выполняются в клиентских процессах; они должны выполняться в процессе серверного приложения COM+.</span><span class="sxs-lookup"><span data-stu-id="594fb-122">CRMs do not run in client processes; they must run in a COM+ server application process.</span></span> <span data-ttu-id="594fb-123">Компоненты CRM могут быть помещены в пакет библиотеки для использования несколькими серверными приложениями COM+, но они недоступны для использования в клиентских процессах.</span><span class="sxs-lookup"><span data-stu-id="594fb-123">CRM components can be placed in a library package for use by multiple COM+ server applications, but they are not available for use within client processes.</span></span> <span data-ttu-id="594fb-124">При попытке использовать интерфейсы CRM внутри клиентского процесса возвращается код ошибки для рабочей роли CRM.</span><span class="sxs-lookup"><span data-stu-id="594fb-124">Attempting to use the CRM interfaces inside a client process returns an error code to the CRM Worker.</span></span>

-   <span data-ttu-id="594fb-125">**Выполняется восстановление.**</span><span class="sxs-lookup"><span data-stu-id="594fb-125">**Recovery in progress.**</span></span> <span data-ttu-id="594fb-126">Восстановление запускается при запуске приложения сервера CRM.</span><span class="sxs-lookup"><span data-stu-id="594fb-126">Recovery starts when a CRM server application starts.</span></span> <span data-ttu-id="594fb-127">Однако восстановление выполняется в фоновом режиме во время нормальной обработки серверного приложения CRM.</span><span class="sxs-lookup"><span data-stu-id="594fb-127">However, recovery occurs in the background during the normal processing of the CRM server application.</span></span> <span data-ttu-id="594fb-128">Рабочую роль CRM можно создать до завершения восстановления.</span><span class="sxs-lookup"><span data-stu-id="594fb-128">The CRM Worker can be created prior to recovery being completed.</span></span> <span data-ttu-id="594fb-129">Крмс нельзя использовать в процессе серверного приложения CRM до успешного завершения восстановления.</span><span class="sxs-lookup"><span data-stu-id="594fb-129">CRMs cannot be used in a CRM server application process until recovery has been successfully completed.</span></span> <span data-ttu-id="594fb-130">В этом случае Рабочая роль CRM получает код ошибки "выполняется восстановление" при попытке зарегистрировать компенсатор CRM.</span><span class="sxs-lookup"><span data-stu-id="594fb-130">In this case, the CRM Worker receives a "recovery in progress" error code as it tries to register the CRM Compensator.</span></span> <span data-ttu-id="594fb-131">Рабочая роль CRM должна опрашивать или иным образом откладываться до завершения восстановления.</span><span class="sxs-lookup"><span data-stu-id="594fb-131">The CRM Worker should poll or otherwise delay until recovery has been completed.</span></span> <span data-ttu-id="594fb-132">Время восстановления зависит от конкретного типа CRM, и его следует учитывать при проектировании CRM.</span><span class="sxs-lookup"><span data-stu-id="594fb-132">The recovery time is specific to a particular type of CRM, and this should be considered when designing the CRM.</span></span> <span data-ttu-id="594fb-133">Операции восстановления длительной длительности не являются желательными.</span><span class="sxs-lookup"><span data-stu-id="594fb-133">Long duration recoveries are not desirable.</span></span>

-   <span data-ttu-id="594fb-134">**Безопасность файла журнала CRM.**</span><span class="sxs-lookup"><span data-stu-id="594fb-134">**Security on the CRM log file.**</span></span> <span data-ttu-id="594fb-135">Если доступ к файлу журнала CRM запрещен, ознакомьтесь со статьей [вопросы безопасности COM+ CRM](com--crm-security-considerations.md) , описывающие, как задается безопасность в файле журнала CRM.</span><span class="sxs-lookup"><span data-stu-id="594fb-135">If access to the CRM log file is denied, please see [COM+ CRM Security Considerations](com--crm-security-considerations.md) for a description of how security is set on the CRM log file.</span></span>

-   <span data-ttu-id="594fb-136">**Сомнительные транзакции.**</span><span class="sxs-lookup"><span data-stu-id="594fb-136">**In-doubt transactions.**</span></span> <span data-ttu-id="594fb-137">В редких случаях транзакция DTC может переключиться в состояние «под сомнением». то есть DTC не может определить результат транзакции.</span><span class="sxs-lookup"><span data-stu-id="594fb-137">In rare cases, a DTC transaction might go into the in-doubt state; that is, the DTC cannot determine the transaction outcome.</span></span> <span data-ttu-id="594fb-138">В таких случаях в процессе восстановления CRM хранит записи журнала для этой транзакции в файле журнала CRM.</span><span class="sxs-lookup"><span data-stu-id="594fb-138">For these cases, during recovery, the CRM maintains the log records for that transaction in the CRM log file.</span></span> <span data-ttu-id="594fb-139">Если транзакция с сомнительными проблемами была разрешена координатором DTC, выполнение транзакции завершается другим восстановлением CRM.</span><span class="sxs-lookup"><span data-stu-id="594fb-139">When the in-doubt transaction has been resolved by the DTC, performing another CRM recovery completes the transaction.</span></span>

-   <span data-ttu-id="594fb-140">**Создание и выпуск компенсатора CRM.**</span><span class="sxs-lookup"><span data-stu-id="594fb-140">**Creation and release of CRM Compensator.**</span></span> <span data-ttu-id="594fb-141">При первом регистрации компенсатора CRM работником CRM он создается инфраструктурой CRM и запрашивается для определения того, какой из поддерживаемых им интерфейсов компенсатора CRM.</span><span class="sxs-lookup"><span data-stu-id="594fb-141">The first time a CRM Compensator is registered by a CRM Worker, it is created by the CRM infrastructure and queried to determine which of the CRM Compensator interfaces it supports.</span></span> <span data-ttu-id="594fb-142">Затем он немедленно освобождается.</span><span class="sxs-lookup"><span data-stu-id="594fb-142">It is then immediately released.</span></span> <span data-ttu-id="594fb-143">Компенсаторы CRM должны поддерживать возможность создания и освобождения без промежуточных вызовов методов.</span><span class="sxs-lookup"><span data-stu-id="594fb-143">CRM Compensators need to support the ability to be created and released without having had any intervening method calls.</span></span> <span data-ttu-id="594fb-144">Если компенсатор CRM не может быть создан правильно, возможно, из-за неправильной регистрации COM или если он не поддерживает хотя бы один из правильных интерфейсов CRM, то в рабочую роль CRM возвращается код ошибки.</span><span class="sxs-lookup"><span data-stu-id="594fb-144">If the CRM Compensator cannot be created correctly, perhaps due to incorrect COM registration, or if it does not support at least one of the correct CRM Compensator interfaces, an error code is returned to the CRM Worker.</span></span>

## <a name="related-topics"></a><span data-ttu-id="594fb-145">См. также</span><span class="sxs-lookup"><span data-stu-id="594fb-145">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="594fb-146">Основные понятия о компенсации диспетчер ресурсов COM+</span><span class="sxs-lookup"><span data-stu-id="594fb-146">COM+ Compensating Resource Manager Concepts</span></span>](com--compensating-resource-manager-concepts.md)
</dt> </dl>

 

 



