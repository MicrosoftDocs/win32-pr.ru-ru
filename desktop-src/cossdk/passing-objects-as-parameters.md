---
description: Передача объектов в качестве параметров
ms.assetid: 174847c8-4545-4f61-ae13-42bdec1405e7
title: Передача объектов в качестве параметров
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c47669d3e3e5af572b6dfd50dcbbefacf5c008971f276408fa87b37ccbed9a1b
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120070384"
---
# <a name="passing-objects-as-parameters"></a>Передача объектов в качестве параметров

Служба COM+ в очереди компонентов не включает очередь для каждого существующего COM-компонента. Существуют ограничения на типы методов, которые могут быть поставлены в очередь. Из-за ограничений обмена сообщениями методы должны соответствовать следующим правилам.

-   Они должны содержать только входные параметры.
-   Они должны возвращать не зависящий от приложения результат.

Кроме того, существуют ограничения на типы входных параметров, которые могут быть переданы в компонент, поставленный в очередь. Во время выполнения служба очередей компонентов упаковывает аргументы на клиенте и передает их компоненту сервера с помощью [очереди сообщений](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)). Простые типы, такие как целые числа и логические значения, можно легко маршалировать — более сложные типы не могут быть упакованы без помощи.

В случае передачи объекта через вызов метода очередного компонента в качестве параметра клиент передает объект в средство записи. Средство записи маршалирует объект в сообщение очереди сообщений и передает его в прослушиватель. После того как прослушиватель выберет сообщение и передаст его проигрывателю, проигрыватель должен повторно создать экземпляр объекта, чтобы передать его в вызов метода, указанный клиентом. В зависимости от времени существования клиента и сервера в среде, поставленной в очередь, это подразумевает, что эти объекты должны иметь возможность маршалировать по значению. Поскольку COM+ не предоставляет семантику передачи по значению для стандартных COM-объектов, средству записи и проигрывателя требуется помощь компонента для маршалирования и распаковки объекта.

Ссылки на объекты, поддерживающие [**IPersistStream**](/windows/desktop/api/objidl/nn-objidl-ipersiststream) , можно использовать в качестве параметров для вызовов методов в очередях компонентов. Объект не может делать предположения о том, когда будет создан его экземпляр. Например, сервер может быть недоступен, или серверный компонент может быть не запущен до тех пор, пока не истечет этот день. Объекты, не поддерживающие **IPersistStream** , возвращают ошибку.

## <a name="visual-basic-persistable-objects"></a>Visual Basic Сохраняемые объекты

Microsoft Visual Basic 6 позволяет создавать сохраняемые объекты. Эти объекты поддерживают [**IPersistStream**](/windows/desktop/api/objidl/nn-objidl-ipersiststream) и могут передаваться в качестве параметров в вызовы методов компонента в очереди. чтобы объект Visual Basic можно было передать в очередь компонента, необходимо инициализировать сохраняемый объект. Это можно сделать одним из следующих двух способов:

-   если приложение, создающее сохраняемый объект, написано на Visual Basic, среда выполнения Visual Basic автоматически обрабатывает инициализацию объекта.
-   если приложение, создающее Visual Basic сохраняемый объект, написано на языке, отличном от Visual Basic, например Microsoft Visual C++, приложение должно явным образом инициализировать компонент, либо запросив интерфейс [**ipersiststream**](/windows/desktop/api/objidl/nn-objidl-ipersiststream) для сохраняемого объекта, либо вызвав метод [**иперсистстреаминит:: InitNew**](/windows/desktop/api/ocidl/nf-ocidl-ipersiststreaminit-initnew)или [**IPersistStream:: Load**](/windows/desktop/api/objidl/nf-objidl-ipersiststream-load) .

## <a name="ado-recordsets-and-ole-db-rowsets"></a>Наборы записей ADO и OLE DB наборы строк

Передача **набора записей** ADO или OLE DB объектов наборов строк между компонентами позволяет одному компоненту обрабатывать результаты запросов, выполняемых другим компонентом. Это полезно при развертывании приложения на нескольких компьютерах. Объекты **наборов записей** и наборов строк могут передаваться как параметры метода в очереди компонентов со следующими ограничениями.

-   Объекты **набора записей** на стороне сервера нельзя маршалировать с помощью [**IPersistStream**](/windows/desktop/api/objidl/nn-objidl-ipersiststream). Только объекты **набора записей** на стороне клиента могут передаваться в качестве параметров в вызов метода компонента в очереди.
-   Если вы работаете непосредственно с OLE DB, набор строк OLE DB должен быть определен как набор строк на стороне клиента.

 

 
