---
description: В некоторых случаях серверное приложение должно представлять клиентское удостоверение для ресурсов, к которым он обращается от имени клиента. обычно это вызывает проверку доступа или проверку подлинности для удостоверения клиентов.
ms.assetid: fd75eb54-eefe-411f-a7aa-0bc8628f8778
title: Олицетворение и делегирование клиента
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7557dcde4cadf559dd8e116cf4e7bece4221aaae
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105662097"
---
# <a name="client-impersonation-and-delegation"></a><span data-ttu-id="e022f-103">Олицетворение и делегирование клиента</span><span class="sxs-lookup"><span data-stu-id="e022f-103">Client Impersonation and Delegation</span></span>

<span data-ttu-id="e022f-104">В некоторых случаях серверное приложение должно представлять идентификатор клиента для ресурсов, к которым он обращается от имени клиента. обычно это вызывает проверку доступа или проверку подлинности для удостоверения клиента.</span><span class="sxs-lookup"><span data-stu-id="e022f-104">In some circumstances, a server application needs to present a client's identity to resources it accesses on the client's behalf, usually to cause access checks or authentication to be performed against the client's identity.</span></span> <span data-ttu-id="e022f-105">В определенный экстент сервер может действовать под удостоверением клиента — действие, называемое олицетворением клиента.</span><span class="sxs-lookup"><span data-stu-id="e022f-105">To a certain extent, the server can act under the client's identity—an action referred to as impersonating the client.</span></span>

<span data-ttu-id="e022f-106">*Олицетворение* — это возможность выполнения потока в контексте безопасности, отличном от процесса, владеющего потоком.</span><span class="sxs-lookup"><span data-stu-id="e022f-106">*Impersonation* is the ability of a thread to execute in a security context different from that of the process owning the thread.</span></span> <span data-ttu-id="e022f-107">Серверный поток использует маркер доступа, представляющий учетные данные клиента, и при этом он может получить доступ к ресурсам, к которым у клиента есть доступ.</span><span class="sxs-lookup"><span data-stu-id="e022f-107">The server thread uses an access token representing the client's credentials, and with this, it can access resources that the client can access.</span></span>

<span data-ttu-id="e022f-108">Использование олицетворения гарантирует, что сервер может выполнять точно то, что может сделать клиент.</span><span class="sxs-lookup"><span data-stu-id="e022f-108">Using impersonation ensures that the server can do precisely what the client can do.</span></span> <span data-ttu-id="e022f-109">Доступ к ресурсам может быть либо ограничен, либо расширен, в зависимости от того, что у клиента есть разрешение.</span><span class="sxs-lookup"><span data-stu-id="e022f-109">Access to resources may be either restricted or expanded, depending on what the client has permission to do.</span></span>

<span data-ttu-id="e022f-110">Можно выбрать, чтобы сервер олицетворяет клиента при подключении к базе данных, чтобы база данных могла пройти проверку подлинности и авторизовать клиента.</span><span class="sxs-lookup"><span data-stu-id="e022f-110">You might choose to have a server impersonate a client when connecting to a database so that the database can authenticate and authorize the client for itself.</span></span> <span data-ttu-id="e022f-111">Или, если приложение получает доступ к файлам, защищенным с помощью дескриптора безопасности, и позволяет клиенту получать авторизованный доступ к данным в этих файлах, приложение может олицетворять клиента перед доступом к файлам.</span><span class="sxs-lookup"><span data-stu-id="e022f-111">Or, if your application accesses files that are protected with a security descriptor and to enable the client to obtain authorized access to information in these files, the application can impersonate the client before accessing the files.</span></span>

## <a name="how-to-implement-impersonation"></a><span data-ttu-id="e022f-112">Как реализовать олицетворение</span><span class="sxs-lookup"><span data-stu-id="e022f-112">How to Implement Impersonation</span></span>

<span data-ttu-id="e022f-113">Для олицетворения требуется участие как клиента, так и сервера (и, в некоторых случаях, системных администраторов).</span><span class="sxs-lookup"><span data-stu-id="e022f-113">Impersonation requires participation by both client and server (and, in some cases, system administrators).</span></span> <span data-ttu-id="e022f-114">Клиент должен указать его готовность, чтобы позволить серверу использовать удостоверение, и сервер должен явно предположить идентификацию клиента программным способом.</span><span class="sxs-lookup"><span data-stu-id="e022f-114">The client must indicate its willingness to let the server use its identity, and the server must explicitly assume the client's identity programmatically.</span></span> <span data-ttu-id="e022f-115">Дополнительные сведения см. в разделах [требования на стороне клиента для олицетворения](client-side-requirements-for-impersonation.md) и [требования на стороне сервера для олицетворения](server-side-requirements-for-impersonation.md).</span><span class="sxs-lookup"><span data-stu-id="e022f-115">For details, see the topics [Client-Side Requirements for Impersonation](client-side-requirements-for-impersonation.md) and [Server-Side Requirements for Impersonation](server-side-requirements-for-impersonation.md).</span></span>

## <a name="administrative-requirements-for-delegate-level-impersonation"></a><span data-ttu-id="e022f-116">Административные требования для Delegate-Level олицетворения</span><span class="sxs-lookup"><span data-stu-id="e022f-116">Administrative Requirements for Delegate-Level Impersonation</span></span>

<span data-ttu-id="e022f-117">Чтобы эффективно использовать наиболее мощную форму олицетворения, *делегирования*, которая является олицетворением клиентов по сети, учетные записи пользователей клиента и сервера должны быть правильно настроены в службе Active Directory для их поддержки (в дополнение к предоставлению клиентом полномочий на олицетворение на уровне делегирования), как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="e022f-117">To effectively use the most powerful form of impersonation, *delegation*, which is the impersonation of clients over the network, the client and server user accounts must be properly configured in the Active Directory Service to support it (in addition to the client granting authority to do delegate-level impersonation), as follows:</span></span>

-   <span data-ttu-id="e022f-118">Удостоверение сервера должно быть помечено как "доверенное для делегирования" в службе Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e022f-118">The server identity must be marked as "Trusted for delegation" in the Active Directory Service.</span></span>
-   <span data-ttu-id="e022f-119">Удостоверение клиента не должно быть помечено как "учетная запись является конфиденциальной и не может быть делегирована" в службе Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e022f-119">The client identity must not be marked as "Account is sensitive and cannot be delegated" in the Active Directory Service.</span></span>

<span data-ttu-id="e022f-120">Эти функции настройки дают администратору домена высокий уровень контроля над делегированием, что желательно, учитывая степень доверия (и, следовательно, риски безопасности).</span><span class="sxs-lookup"><span data-stu-id="e022f-120">These configuration features give the domain administrator a high degree of control over delegation, which is desirable, given how much trust (and hence security risk) is involved.</span></span> <span data-ttu-id="e022f-121">Дополнительные сведения о делегировании см. в разделе [Делегирование и олицетворение](/windows/desktop/com/delegation-and-impersonation).</span><span class="sxs-lookup"><span data-stu-id="e022f-121">For more detail about delegation, see [Delegation and Impersonation](/windows/desktop/com/delegation-and-impersonation).</span></span>

## <a name="cloaking"></a><span data-ttu-id="e022f-122">Маскировка</span><span class="sxs-lookup"><span data-stu-id="e022f-122">Cloaking</span></span>

<span data-ttu-id="e022f-123">Наряду с полномочиями, которые клиент предоставляет серверу через уровень олицетворения, функция маскировки сервера во многом определяет, как будет вести себя олицетворение.</span><span class="sxs-lookup"><span data-stu-id="e022f-123">Along with the authority a client grants a server through the impersonation level, the server's cloaking capability largely determines how impersonation will behave.</span></span> <span data-ttu-id="e022f-124">Маскировка влияет на то, какие удостоверения фактически представляются сервером, когда он выполняет вызовы от имени клиента — его собственный или клиентский.</span><span class="sxs-lookup"><span data-stu-id="e022f-124">Cloaking affects what identity is actually presented by the server when it makes calls on the client's behalf—its own or the client's.</span></span> <span data-ttu-id="e022f-125">Дополнительные сведения см. в разделе [маскировка](cloaking.md).</span><span class="sxs-lookup"><span data-stu-id="e022f-125">For details, see [Cloaking](cloaking.md).</span></span>

## <a name="performance-implications"></a><span data-ttu-id="e022f-126">Влияние на производительность</span><span class="sxs-lookup"><span data-stu-id="e022f-126">Performance Implications</span></span>

<span data-ttu-id="e022f-127">Олицетворение может значительно повлиять на производительность и масштабирование.</span><span class="sxs-lookup"><span data-stu-id="e022f-127">Impersonation can significantly affect performance and scaling.</span></span> <span data-ttu-id="e022f-128">Как правило, олицетворение клиента в вызове является более затратным, чем вызов напрямую.</span><span class="sxs-lookup"><span data-stu-id="e022f-128">It is generally more expensive to impersonate a client on a call than to make the call directly.</span></span> <span data-ttu-id="e022f-129">Ниже приведены некоторые проблемы, которые следует учитывать.</span><span class="sxs-lookup"><span data-stu-id="e022f-129">Following are some of the issues to consider:</span></span>

-   <span data-ttu-id="e022f-130">Вычислительные издержки на передачу идентификаторов в сложных шаблонах, особенно если включена Динамическая маскировка.</span><span class="sxs-lookup"><span data-stu-id="e022f-130">The computational overhead of passing around identity in complicated patterns, particularly if dynamic cloaking is enabled.</span></span>
-   <span data-ttu-id="e022f-131">Общая сложность применения избыточной проверки безопасности в многочисленных местах, а не просто централизованно на среднем уровне.</span><span class="sxs-lookup"><span data-stu-id="e022f-131">The general complexity of enforcing redundant security checking in numerous places, instead of just centrally in the middle tier.</span></span>
-   <span data-ttu-id="e022f-132">Такие ресурсы, как подключения к базе данных, при открытии олицетворения клиента, не могут быть повторно использованы для нескольких клиентов — очень большой препятствием для масштабирования.</span><span class="sxs-lookup"><span data-stu-id="e022f-132">Resources such as database connections, when opened impersonating a client, cannot be reused across multiple clients—a very large roadblock to scaling well.</span></span>

<span data-ttu-id="e022f-133">Иногда единственным эффективным решением проблемы является использование олицетворения, но это решение следует тщательно взвесить.</span><span class="sxs-lookup"><span data-stu-id="e022f-133">Sometimes the only effective solution to a problem is to use impersonation, but this decision should be carefully weighed.</span></span> <span data-ttu-id="e022f-134">Дополнительные сведения об этих проблемах см. в статье [многоуровневая защита приложений](multi-tier-application-security.md).</span><span class="sxs-lookup"><span data-stu-id="e022f-134">For a further discussion of these issues, see [Multi-Tier Application Security](multi-tier-application-security.md).</span></span>

## <a name="queued-components"></a><span data-ttu-id="e022f-135">Очереди компонентов</span><span class="sxs-lookup"><span data-stu-id="e022f-135">Queued Components</span></span>

<span data-ttu-id="e022f-136">[Поставленные в очередь компоненты](com--queued-components.md) не поддерживают олицетворение.</span><span class="sxs-lookup"><span data-stu-id="e022f-136">[Queued components](com--queued-components.md) do not support impersonation.</span></span> <span data-ttu-id="e022f-137">Когда клиент выполняет вызов объекта в очереди, фактически выполняется вызов средства записи, который упаковывает его как часть сообщения на сервер.</span><span class="sxs-lookup"><span data-stu-id="e022f-137">When a client makes a call to a queued object, the call is actually made to the recorder, which packages it as part of a message to the server.</span></span> <span data-ttu-id="e022f-138">Затем прослушиватель считывает сообщение из очереди и передает его проигрывателю, который вызывает фактический серверный компонент и выполняет тот же вызов метода.</span><span class="sxs-lookup"><span data-stu-id="e022f-138">The listener then reads the message from the queue and passes it to the player, which invokes the actual server component and makes the same method call.</span></span> <span data-ttu-id="e022f-139">Таким образом, когда сервер получает вызов, исходный маркер клиента недоступен через олицетворение.</span><span class="sxs-lookup"><span data-stu-id="e022f-139">As such, when the server receives the call, the original client token is unavailable via impersonation.</span></span> <span data-ttu-id="e022f-140">Тем не менее, безопасность на основе ролей по-прежнему применима и программная безопасность с помощью интерфейса [**исекуритикаллконтекст**](/windows/desktop/api/ComSvcs/nn-comsvcs-isecuritycallcontext) будет работать.</span><span class="sxs-lookup"><span data-stu-id="e022f-140">Role-based security still applies, however, and programmatic security using the [**ISecurityCallContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-isecuritycallcontext) interface will work.</span></span> <span data-ttu-id="e022f-141">Дополнительные сведения см. [в разделе Безопасность компонентов в очереди](queued-components-security.md).</span><span class="sxs-lookup"><span data-stu-id="e022f-141">For details, see [Queued Components Security](queued-components-security.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="e022f-142">См. также</span><span class="sxs-lookup"><span data-stu-id="e022f-142">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e022f-143">Аутентификация клиента</span><span class="sxs-lookup"><span data-stu-id="e022f-143">Client Authentication</span></span>](client-authentication.md)
</dt> <dt>

[<span data-ttu-id="e022f-144">Безопасность библиотечных приложений</span><span class="sxs-lookup"><span data-stu-id="e022f-144">Library Application Security</span></span>](library-application-security.md)
</dt> <dt>

[<span data-ttu-id="e022f-145">Многоуровневая защита приложений</span><span class="sxs-lookup"><span data-stu-id="e022f-145">Multi-Tier Application Security</span></span>](multi-tier-application-security.md)
</dt> <dt>

[<span data-ttu-id="e022f-146">Безопасность программных компонентов</span><span class="sxs-lookup"><span data-stu-id="e022f-146">Programmatic Component Security</span></span>](programmatic-component-security.md)
</dt> <dt>

[<span data-ttu-id="e022f-147">Администрирование безопасности на основе ролей</span><span class="sxs-lookup"><span data-stu-id="e022f-147">Role-Based Security Administration</span></span>](role-based-security-administration.md)
</dt> <dt>

[<span data-ttu-id="e022f-148">Использование политики ограниченного использования программ в COM+</span><span class="sxs-lookup"><span data-stu-id="e022f-148">Using the Software Restriction Policy in COM+</span></span>](using-the-software-restriction-policy-in-com-.md)
</dt> </dl>

 

 
