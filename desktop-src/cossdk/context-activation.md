---
description: В COM+ каждый COM-объект создается с помощью связанного контекста.
ms.assetid: e5602af2-5852-4c34-a792-6742e90b7d41
title: Активация контекста
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a652615d6c1288887085c857817e32e3a3b4081c
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104142001"
---
# <a name="context-activation"></a>Активация контекста

В COM+ каждый COM-объект создается с помощью связанного контекста. Это означает, что необходимо создать и инициализировать новый контекст или использовать соответствующий существующий контекст. Этот процесс называется *активацией*. В COM+ объект активируется либо в собственном контексте, либо в его создателе (объект, запрашивающий активацию объекта, например путем вызова [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance)).

В некоторых случаях, например при использовании [пула объектов](com--object-pooling.md), объект активируется без создания с нуля. В этом случае запущенный экземпляр активируется в контексте. Во время его существования оно может быть многократно активировано в разных контекстах.

В любом случае базовый механизм один и тот же — объект связан с контекстом, и этот контекст правильно инициализируется для представления потребностей объекта во время выполнения.

## <a name="flowing-of-context-properties"></a>Потоковая передача свойств контекста

Когда объект активируется в ответ на запрос на создание от другого объекта, COM+ должен подключаться между ними, чтобы правильно активировать нисходящий объект. COM+ должен сравнить контекст вызывающего объекта с конфигурацией вызываемого компонента, а затем решить, где активировать нисходящий компонент и как инициализировать его свойства контекста.

Для обнаружения конфигурации компонента COM+ ищет его в базе данных регистрации классов COM+, которая оптимизирована для чрезвычайно быстрых поисков во время выполнения. (Это определяется способом настройки компонента при его установке в приложение COM+.) Затем Конфигурация компонента проверяется по состоянию свойств контекста вызывающего объекта.

В некоторых случаях конфигурация согласуется с контекстом вызывающего объекта, и компонент может быть активирован в контексте вызывающего. Это может произойти только в том случае, если контекст вызывающего объекта удовлетворяет всем требованиям среды выполнения, предъявляемым новым объектом.

Если нисходящий компонент не может быть активирован в контексте вызывающего, он активируется в собственном контексте в соответствующем апартаменте. В этом случае некоторые свойства контекста могут передаваться от вызывающего к вызываемому. Например, если вызывающий объект связан с транзакцией, а вызываемая транзакция поддерживает транзакции, то новый объект получает собственный контекст (чтобы проголосовать за транзакцию, он должен иметь собственный последовательный флаг) и наследует идентификатор транзакции вызывающего объекта и идентификатор действия (которые находятся в одной транзакции и домене синхронизации).

## <a name="ignored-context-properties"></a>Игнорируемые свойства контекста

В зависимости от настройки компонента некоторые свойства контекста могут не играть никаких ролей в определении того, активирован ли он в контексте создателя или в его собственном контексте. Например, незаблокированные и отключенные параметры синхронизации, указывающие на присутствие транзакции или домена синхронизации, не играют никакой роли в активации компонента. Эти свойства фундаментально игнорируются при потоковой передаче контекста. Если компонент использует только проверку доступа на уровне процесса, свойство контекста безопасности игнорируется — конфигурация безопасности компонента никогда не будет играть роль при активации.

## <a name="forcing-activation-in-the-callers-context"></a>Принудительная активация в контексте вызывающего объекта

В некоторых случаях может потребоваться активировать объект только в его контексте вызывающего объекта, т. е. он никогда не активируется в своем собственном контексте. Например, может потребоваться управлять поведением объекта при его вызове через границу контекста.

Можно гарантировать, что объект не может быть активирован в собственном контексте, выбрав параметр **требуется активировать в контексте вызывающих объектов** на вкладке **Активация** страницы **Свойства** компонента с помощью средства администрирования "службы компонентов". (Пошаговые инструкции см. [в разделе принудительная активация в контексте вызывающего объекта](enforcing-activation-in-the-caller-s-context.md) .) При выборе этого параметра, если объект не может быть активирован в контексте вызывающего объекта, функция [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) завершается ошибкой, возвращая неудачную \_ \_ попытку \_ \_ создания \_ внешнего \_ \_ контекста клиента.

## <a name="default-context"></a>Контекст по умолчанию

Существуют контексты по умолчанию для поддержки ненастроенных компонентов, т. е. COM-компонентов, не установленных в приложениях COM+ и не зарегистрированных в базе данных регистрации классов COM+. Если ненастроенные компоненты имеют совместимую модель потоков, они активируются в контексте вызывающего. В противном случае они активируются в контексте по умолчанию в соответствующем апартаменте. Каждый апартамент имеет контекст по умолчанию для поддержки COM-объектов, которые не используют службы COM+.

## <a name="hooking-activation"></a>Подключение активации

Реализуя [**IObjectControl:: Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) и [**IObjectControl::D еактивате**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate), вы можете подключать активацию и деактивацию для выполнения специальной инициализации в новом контексте. Эти методы вызываются COM+ в определенных точках жизненного цикла объекта, когда объект настроен для использования JIT-активации или объединения объектов в пул. Дополнительные сведения см. [в статье JIT-активация com+](com--just-in-time-activation.md) и [группирование объектов COM+](com--object-pooling.md) .

## <a name="related-topics"></a>См. также

<dl> <dt>

[Перехват вызовов между контекстами](interception-of-cross-context-calls.md)
</dt> </dl>

 

 
