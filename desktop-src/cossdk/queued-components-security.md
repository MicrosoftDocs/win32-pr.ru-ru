---
description: Безопасность очередей компонентов
ms.assetid: 3fbeb81a-e3e4-495b-b891-896877fab92f
title: Безопасность очередей компонентов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 29b51592f6216d7380e877f2cd582a277f1583b8
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104141989"
---
# <a name="queued-components-security"></a><span data-ttu-id="1ae2f-103">Безопасность очередей компонентов</span><span class="sxs-lookup"><span data-stu-id="1ae2f-103">Queued Components Security</span></span>

<span data-ttu-id="1ae2f-104">Когда клиент выполняет вызов метода в очередь объекта, фактически выполняется вызов средства записи, который упаковывает его как часть сообщения на сервер.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-104">When a client makes a method call to a queued object, the call is actually made to the recorder, which packages it as part of a message to the server.</span></span> <span data-ttu-id="1ae2f-105">Прослушиватель считывает сообщение из очереди и передает его проигрывателю.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-105">The listener reads the message from the queue and passes it to the player.</span></span> <span data-ttu-id="1ae2f-106">Проигрыватель вызывает фактический серверный компонент и выполняет тот же вызов метода.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-106">The player invokes the actual server component and makes the same method call.</span></span> <span data-ttu-id="1ae2f-107">Серверный компонент должен наблюдать за контекстом вызова безопасности клиента (а не с контекстом вызова безопасности проигрывателя), когда проигрыватель выполняет вызов метода.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-107">The server component must observe the security call context of the client (not the player's security call context) when the player makes the method call.</span></span> <span data-ttu-id="1ae2f-108">Средство записи маршалирует контекст вызова безопасности клиента в сообщение, а проигрыватель демаршалирует его на сервер перед вызовом метода.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-108">The recorder marshals the client's security call context into the message, and the player unmarshals it at the server before making the method call.</span></span> <span data-ttu-id="1ae2f-109">Что касается объекта сервера, в контексте безопасности между прямым вызовом клиента и непрямым вызовом из проигрывателя нет различий между ними.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-109">As far as the server object is concerned, there is no difference in security context between a direct call from the client and an indirect call from the player.</span></span> <span data-ttu-id="1ae2f-110">В частности, вызываемые методы выполняются с привилегиями отправителя.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-110">In particular, the methods invoked execute with the sender's privileges.</span></span>

<span data-ttu-id="1ae2f-111">Компонент в очереди COM+ поддерживает семантику безопасности на основе ролей так же, как и другие компоненты, созданные для использования с приложениями COM+.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-111">A COM+ queued component supports role-based security semantics just like other components built for use with COM+ applications.</span></span> <span data-ttu-id="1ae2f-112">Таким образом, компоненты приложения, помещенного в очередь, могут использовать программные интерфейсы для обнаружения членства в роли вызывающего объекта ([**исекуритикаллконтекст:: искаллеринроле**](/windows/desktop/api/ComSvcs/nf-comsvcs-isecuritycallcontext-iscallerinrole)) или определенного пользователя ([**Исекуритикаллконтекст:: исусеринроле**](/windows/desktop/api/ComSvcs/nf-comsvcs-isecuritycallcontext-isuserinrole)).</span><span class="sxs-lookup"><span data-stu-id="1ae2f-112">Components of a queued application can therefore use programmatic interfaces to discover the role membership of their caller ([**ISecurityCallContext::IsCallerInRole**](/windows/desktop/api/ComSvcs/nf-comsvcs-isecuritycallcontext-iscallerinrole)) or a specific user ([**ISecurityCallContext::IsUserInRole**](/windows/desktop/api/ComSvcs/nf-comsvcs-isecuritycallcontext-isuserinrole)).</span></span> <span data-ttu-id="1ae2f-113">Рекомендуется, чтобы все компоненты в очереди с потенциальным влиянием на безопасность использовали эти интерфейсы для явной проверки учетных данных отправителя.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-113">It is recommended that any queued component with a potential security impact use these interfaces to explicitly check the sender's credentials.</span></span>

<span data-ttu-id="1ae2f-114">Удостоверение вызывающего объекта — это удостоверение, связанное с вызовом метода.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-114">The caller identity is the identity associated with a method call.</span></span> <span data-ttu-id="1ae2f-115">Удостоверение вызывающего объекта используется системой безопасности на основе ролей и содержится в контексте вызова безопасности.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-115">Caller identity is used by role-based security and is present in the security call context.</span></span> <span data-ttu-id="1ae2f-116">В компонентах, помещенных в очередь, удостоверение абонента представляется в виде данных в сообщении очереди сообщений.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-116">In queued components, the caller identity is represented as data in the Message Queuing message.</span></span> <span data-ttu-id="1ae2f-117">Служба очереди сообщений проверяет подлинность удостоверения отправителя сообщений.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-117">Message Queuing authenticates the message sender identity.</span></span> <span data-ttu-id="1ae2f-118">Если удостоверение вызывающей стороны и удостоверение отправителя сообщений одинаковы, то служба очередей сообщений выполняет проверку подлинности как сообщения, так и вызывающего.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-118">When the caller identity and the message sender identity are the same, Message Queuing authenticates both the message and the caller.</span></span> <span data-ttu-id="1ae2f-119">Это обычный случай.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-119">This is the usual case.</span></span>

> [!Note]  
> <span data-ttu-id="1ae2f-120">Компоненты, поставленные в очередь COM+, не поддерживают безопасность в стиле олицетворения, что позволяет серверу получить маркер доступа, соответствующий удостоверению клиента, и использовать его для выполнения проверок контроля доступа или для работы в контексте Client Security.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-120">COM+ queued components does not support impersonation-style security, which allows a server to obtain an access token corresponding to the client identity and use it either to perform access control checks or to act under the client security context.</span></span>

 

<span data-ttu-id="1ae2f-121">Когда вызывающая сторона компонента из очереди взаимодействует с компонентом через необработанный регистратор, идентификаторы вызывающего и отправителя сообщений могут отличаться.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-121">When the caller of a queued component is interacting with the component through an out-of-process recorder, the identities of the caller and message sender (recorder) can be different.</span></span> <span data-ttu-id="1ae2f-122">В этом случае компоненты, поставленные в очередь COM+, проверяют, что отправитель сообщения является членом роли доверенного пользователя QC на сервере.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-122">In this case, COM+ queued components verifies that the message sender is a member of the QC Trusted User role on the server.</span></span> <span data-ttu-id="1ae2f-123">Кроме того, для необработанного средства записи требуется сертификат проверки подлинности, так как он проходит проверку подлинности с помощью очереди сообщений.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-123">Additionally, the out-of-process recorder requires an authentication certificate because it is being authenticated by Message Queuing.</span></span>

<span data-ttu-id="1ae2f-124">Членам роли доверенного пользователя QC разрешено указывать произвольное удостоверение, что означает, что злоумышленник может выполнить вызов компонента в очереди с повышенными привилегиями.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-124">Members of the QC Trusted User role are allowed to specify an arbitrary identity, which means that a malicious member could execute a queued component call with elevated privileges.</span></span> <span data-ttu-id="1ae2f-125">Поэтому рекомендуется, чтобы количество таких пользователей хранилось в абсолютном минимальном объеме.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-125">It is therefore recommended that the number of such users be kept to an absolute minimum.</span></span>

<span data-ttu-id="1ae2f-126">Из-за риска сложной атаки, связанной с любым механизмом, который распространяет удостоверение по сети, а также риск простой атаки типа "отказ в обслуживании" путем переполнения очередей с помощью неисполняемых запросов, рекомендуется развертывать службу COM+ в очереди только в сети доверенных узлов (например, в частной сети или виртуальной частной сети). или за соответствующим образом настроенный брандмауэр.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-126">Because of the risk of a sophisticated attack associated with any mechanism which propagates identity across a network, as well as the risk of a simple denial of service attack by flooding the queues with unexecutable requests, it is recommended that you deploy the COM+ queued components service only on a network of trusted hosts—for example, on a private network or a virtual private network, or behind an appropriately configured firewall.</span></span>

<span data-ttu-id="1ae2f-127">Компоненты, поставленные в очередь COM+, выполняются через DCOM, поэтому вы можете защитить целостность и секретность вызовов методов в очереди, выбрав параметр " **Конфиденциальность пакетов** " в качестве **уровня проверки подлинности для вызовов** на вкладке " **Безопасность** " на странице **свойств** вашего приложения, помещенного в очередь.</span><span class="sxs-lookup"><span data-stu-id="1ae2f-127">COM+ queued components runs over DCOM, so you can help protect the integrity and secrecy of queued method calls by selecting **Packet Privacy** as the **Authentication Level of Calls** setting on the **Security** tab of your queued application's **Properties** sheet.</span></span>

## <a name="related-topics"></a><span data-ttu-id="1ae2f-128">См. также</span><span class="sxs-lookup"><span data-stu-id="1ae2f-128">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="1ae2f-129">Безопасность COM+</span><span class="sxs-lookup"><span data-stu-id="1ae2f-129">COM+ Security</span></span>](com--security.md)
</dt> <dt>

[<span data-ttu-id="1ae2f-130">Ограничения безопасности в режиме рабочей группы</span><span class="sxs-lookup"><span data-stu-id="1ae2f-130">Security Limitations in Workgroup Mode</span></span>](security-limitations-in-workgroup-mode.md)
</dt> <dt>

[<span data-ttu-id="1ae2f-131">Указание протокола проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="1ae2f-131">Specifying the Authentication Protocol</span></span>](specifying-the-authentication-protocol.md)
</dt> </dl>

 

 



