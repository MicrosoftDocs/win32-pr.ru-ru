---
description: Для настроенных компонентов, работающих в приложениях COM+, контексты являются основой, на которой предоставляются службы COM+.
ms.assetid: 62a0bef2-c3c2-4a60-a5d1-6c038958e13e
title: Контексты COM+
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5f0ae1228f89797f9124e817db07f11a23dbec12
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104423449"
---
# <a name="com-contexts"></a><span data-ttu-id="081ff-103">Контексты COM+</span><span class="sxs-lookup"><span data-stu-id="081ff-103">COM+ Contexts</span></span>

<span data-ttu-id="081ff-104">Для настроенных компонентов, работающих в приложениях COM+, *контексты* являются основой, на которой предоставляются службы COM+.</span><span class="sxs-lookup"><span data-stu-id="081ff-104">For configured components running within COM+ applications, *contexts* are the foundation on which COM+ services are provided.</span></span> <span data-ttu-id="081ff-105">В COM+ контекст определяется как набор свойств времени выполнения, связанных с одним или несколькими COM-объектами, которые используются для предоставления служб для этих объектов.</span><span class="sxs-lookup"><span data-stu-id="081ff-105">In COM+, a context is defined as set of run-time properties associated with one or more COM objects that are used to provide services for those objects.</span></span>

<span data-ttu-id="081ff-106">В COM+ каждый COM-объект связан точно с одним контекстом при его запуске (то есть между его активацией и деактивацией), и каждый контекст находится в пределах ровно одного подразделения COM.</span><span class="sxs-lookup"><span data-stu-id="081ff-106">In COM+, every COM object is associated with precisely one context as it runs (that is, between its activation and deactivation), and every context resides within precisely one COM apartment.</span></span> <span data-ttu-id="081ff-107">Несколько объектов могут выполняться в одном и том же контексте, и несколько контекстов могут находиться в одном апартаменте.</span><span class="sxs-lookup"><span data-stu-id="081ff-107">Multiple objects can run within the same context, and multiple contexts can reside within the same apartment.</span></span> <span data-ttu-id="081ff-108">Инициализировано при активации объекта, свойства контекста, такие как свойства контекста безопасности, представляют потребности объекта во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="081ff-108">Initialized when an object is activated, context properties, such as security context properties, represent the run-time needs of an object.</span></span>

> [!Note]  
> <span data-ttu-id="081ff-109">Для ненастроенных компонентов, которые не используют службы COM+, контекст, по большей части, игнорируется.</span><span class="sxs-lookup"><span data-stu-id="081ff-109">For unconfigured components that do not use COM+ services, the context is, for the most part, ignored.</span></span>

 

<span data-ttu-id="081ff-110">COM+ использует свойства контекста в качестве основания для предоставления служб времени выполнения.</span><span class="sxs-lookup"><span data-stu-id="081ff-110">COM+ uses context properties as the basis for providing run-time services.</span></span> <span data-ttu-id="081ff-111">Эти свойства сохраняют состояние, определяющее, как среда выполнения выполняет службы для объектов в контексте.</span><span class="sxs-lookup"><span data-stu-id="081ff-111">These properties hold state that determines how the execution environment performs services for objects within the context.</span></span> <span data-ttu-id="081ff-112">В некоторых случаях можно напрямую взаимодействовать со свойствами контекста объекта, чтобы указать некоторое состояние, относящееся к службе, предоставляемой для объекта.</span><span class="sxs-lookup"><span data-stu-id="081ff-112">In some cases, you can interact directly with an object's context properties to indicate some state relevant to a service being provided for the object.</span></span> <span data-ttu-id="081ff-113">Например, это можно сделать, когда объект, участвующий в автоматической проводке, продвигается в результате транзакции.</span><span class="sxs-lookup"><span data-stu-id="081ff-113">For example, you would do this when an object that is participating in an automatic transaction votes on the outcome of the transaction.</span></span>

<span data-ttu-id="081ff-114">Подробное описание COM-модели этих концепций см. в статье [процессы, потоки и подразделения](/windows/desktop/com/processes--threads--and-apartments).</span><span class="sxs-lookup"><span data-stu-id="081ff-114">For a detailed discussion of the COM foundation of these concepts, see [Processes, Threads, and Apartments](/windows/desktop/com/processes--threads--and-apartments).</span></span>

## <a name="programmatic-interaction-with-context-properties"></a><span data-ttu-id="081ff-115">Программное взаимодействие со свойствами контекста</span><span class="sxs-lookup"><span data-stu-id="081ff-115">Programmatic Interaction with Context Properties</span></span>

<span data-ttu-id="081ff-116">Каждый контекст имеет связанный объект [**ObjectContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-objectcontext) , который отслеживает его свойства.</span><span class="sxs-lookup"><span data-stu-id="081ff-116">Each context has an associated [**ObjectContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-objectcontext) object that keeps track of its properties.</span></span> <span data-ttu-id="081ff-117">Доступ к **контексту ObjectContext** можно получить, вызвав функцию метода [**ObjectContext**](/windows/desktop/api/ComSvcs/nf-comsvcs-getobjectcontext) .</span><span class="sxs-lookup"><span data-stu-id="081ff-117">You can access **ObjectContext** by calling the [**GetObjectContext**](/windows/desktop/api/ComSvcs/nf-comsvcs-getobjectcontext) function.</span></span> <span data-ttu-id="081ff-118">После доступа к классу **ObjectContext** можно вызывать методы в интерфейсе [**иобжектконтекст**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontext) , предоставляемом для управления свойствами контекста.</span><span class="sxs-lookup"><span data-stu-id="081ff-118">After you have accessed **ObjectContext**, you can call methods on the [**IObjectContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontext) interface it exposes to manipulate context properties.</span></span>

<span data-ttu-id="081ff-119">Например, вызов [**иобжектконтекст:: сеткомплете**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setcomplete) влияет на установку бита согласованности транзакций в значение "consistent", а бит выполнения [JIT-активации](com--just-in-time-activation.md) — на "Done" в контексте, связанном с объектом.</span><span class="sxs-lookup"><span data-stu-id="081ff-119">For example, calling [**IObjectContext::SetComplete**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setcomplete) has the effect of setting the transaction consistency bit to "consistent" and the [JIT-activation](com--just-in-time-activation.md) done bit to "done" on the context associated with the object.</span></span> <span data-ttu-id="081ff-120">"Последовательные" сигналы для COM+, которые проголосуют за фиксацию транзакции, и "Готово" означает, что объект готов к деактивации при возврате из метода.</span><span class="sxs-lookup"><span data-stu-id="081ff-120">"Consistent" signals to COM+ that you vote to commit the transaction, and "done" indicates that your object is ready to be deactivated when the method returns.</span></span>

<span data-ttu-id="081ff-121">Помимо [**иобжектконтекст**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontext), другие специализированные интерфейсы, предоставляющие доступ к свойствам контекста, — это [**иобжектконтекстинфо**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontextinfo), [**иконтекстстате**](/windows/desktop/api/ComSvcs/nn-comsvcs-icontextstate)и [**иобжектконтекстактивити**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontextactivity).</span><span class="sxs-lookup"><span data-stu-id="081ff-121">In addition to [**IObjectContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontext), other specialized interfaces providing access to context properties are [**IObjectContextInfo**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontextinfo), [**IContextState**](/windows/desktop/api/ComSvcs/nn-comsvcs-icontextstate), and [**IObjectContextActivity**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontextactivity).</span></span> <span data-ttu-id="081ff-122">В определенный экстент [**исекуритикаллконтекст**](/windows/desktop/api/ComSvcs/nn-comsvcs-isecuritycallcontext) также обращается к свойствам контекста.</span><span class="sxs-lookup"><span data-stu-id="081ff-122">To a certain extent, [**ISecurityCallContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-isecuritycallcontext) also accesses context properties.</span></span> <span data-ttu-id="081ff-123">Для получения **исекуритикаллконтекст** можно использовать [**Ижетсекуритикаллконтекст:: жетсекуритикаллконтекст**](/windows/desktop/api/ComSvcs/nf-comsvcs-igetsecuritycallcontext-getsecuritycallcontext) .</span><span class="sxs-lookup"><span data-stu-id="081ff-123">You can use [**IGetSecurityCallContext::GetSecurityCallContext**](/windows/desktop/api/ComSvcs/nf-comsvcs-igetsecuritycallcontext-getsecuritycallcontext) to obtain **ISecurityCallContext**.</span></span>

## <a name="understanding-activation-and-interception"></a><span data-ttu-id="081ff-124">Общие сведения об активации и перехвате</span><span class="sxs-lookup"><span data-stu-id="081ff-124">Understanding Activation and Interception</span></span>

<span data-ttu-id="081ff-125">Как правило, необходимо думать о контексте только в том экстенте, который представляет ряд свойств, некоторые из которых можно задать или получить, которые используются для предоставления служб COM+ для компонентов.</span><span class="sxs-lookup"><span data-stu-id="081ff-125">Generally, you need to think about context only to the extent that it represents a number of properties, some of which you can set or get, that are used to provide COM+ services for your components.</span></span> <span data-ttu-id="081ff-126">Однако в некоторых обстоятельствах может потребоваться рассмотреть два следующих взаимосвязанных аспекта контекстов:</span><span class="sxs-lookup"><span data-stu-id="081ff-126">In some circumstances, however, you might need to consider the following two interrelated facets of contexts in greater detail:</span></span>

-   <span data-ttu-id="081ff-127">[Активация контекста](context-activation.md)или инициализация объекта в соответствующем контексте.</span><span class="sxs-lookup"><span data-stu-id="081ff-127">[Context activation](context-activation.md), or the initialization of an object in an appropriate context.</span></span>
-   <span data-ttu-id="081ff-128">[Перехват](interception-of-cross-context-calls.md)или то, что делает com+ в вызовах через границу контекста.</span><span class="sxs-lookup"><span data-stu-id="081ff-128">[Interception](interception-of-cross-context-calls.md), or what COM+ does on calls across a context boundary.</span></span>

## <a name="relation-to-mts-context-wrappers"></a><span data-ttu-id="081ff-129">Связь с обертками контекста MTS</span><span class="sxs-lookup"><span data-stu-id="081ff-129">Relation to MTS Context Wrappers</span></span>

<span data-ttu-id="081ff-130">Контексты эффективно заменяют оболочки контекста MTS.</span><span class="sxs-lookup"><span data-stu-id="081ff-130">Contexts effectively replace the MTS context wrappers.</span></span> <span data-ttu-id="081ff-131">Предоставляемая им цель — предоставление автоматических служб путем перехвата запросов на создание — теперь является интегрированной функцией COM+.</span><span class="sxs-lookup"><span data-stu-id="081ff-131">The purpose they served—providing automatic services by trapping creation requests—is now an integrated feature of COM+.</span></span> <span data-ttu-id="081ff-132">В результате вам больше не нужно использовать функцию [**сафереф**](/windows/desktop/api/ComSvcs/nf-comsvcs-saferef) .</span><span class="sxs-lookup"><span data-stu-id="081ff-132">As a result, you no longer need to use the [**SafeRef**](/windows/desktop/api/ComSvcs/nf-comsvcs-saferef) function.</span></span> <span data-ttu-id="081ff-133">В MTS **сафереф** использовался для получения ссылки на объект, который мог быть передан за пределами оболочки контекста.</span><span class="sxs-lookup"><span data-stu-id="081ff-133">In MTS, **SafeRef** was used to obtain a reference to your object which could be passed outside of its context wrapper.</span></span> <span data-ttu-id="081ff-134">В COM+ это не требуется; обычные ссылки на объекты (**эти** указатели) работают.</span><span class="sxs-lookup"><span data-stu-id="081ff-134">In COM+, this is unnecessary; normal object references (**this** pointers) work.</span></span>

 

 
