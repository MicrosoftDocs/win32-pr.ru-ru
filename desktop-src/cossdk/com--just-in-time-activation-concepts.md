---
description: Служба JIT-активации позволяет COM+ деактивировать объект, когда клиент по-прежнему владеет активной ссылкой на этот объект.
ms.assetid: dbc7b257-8506-42c8-8a78-3474c6d4f4b6
title: Основные понятия JIT-активации COM+
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6c942bfeb342ea305083e0c7d7ebdea2fe96bf24
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105710707"
---
# <a name="com-just-in-time-activation-concepts"></a><span data-ttu-id="4baa9-103">Основные понятия JIT-активации COM+</span><span class="sxs-lookup"><span data-stu-id="4baa9-103">COM+ Just-in-Time Activation Concepts</span></span>

<span data-ttu-id="4baa9-104">Служба JIT-активации позволяет COM+ деактивировать объект, когда клиент по-прежнему владеет активной ссылкой на этот объект.</span><span class="sxs-lookup"><span data-stu-id="4baa9-104">The just-in-time (JIT) activation service enables COM+ to deactivate an object while a client still holds an active reference to that object.</span></span> <span data-ttu-id="4baa9-105">В следующий раз, когда клиент вызывает метод для объекта, который клиент считает активным, служба JIT-активации COM+ снова активирует объект прозрачно для клиента, по времени.</span><span class="sxs-lookup"><span data-stu-id="4baa9-105">The next time the client calls a method on the object, which the client believes to be still active, the COM+ JIT activation service reactivates the object transparently to the client, just in time.</span></span>

<span data-ttu-id="4baa9-106">Основное преимущество использования COM + JIT-активации заключается в том, что можно позволить клиентам хранить ссылки на объекты в течение всего времени, не требуя придерживать ценных ресурсов сервера, таких как память.</span><span class="sxs-lookup"><span data-stu-id="4baa9-106">The main advantage of using COM + JIT activation is that you can enable clients to hold references to objects for as long as they need them, without necessarily tying up valuable server resources such as memory.</span></span> <span data-ttu-id="4baa9-107">Ниже приведены другие важные преимущества.</span><span class="sxs-lookup"><span data-stu-id="4baa9-107">Other important benefits include the following:</span></span>

-   <span data-ttu-id="4baa9-108">Использование службы JIT-активации COM+ значительно упрощает модель программирования для клиента, поскольку клиент не должен думать о том, как он использует ресурсоемкие серверные объекты и серверные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="4baa9-108">Using the COM+ JIT activation service greatly simplifies the programming model for the client because the client doesn't have to think about how it uses expensive server objects and server resources.</span></span> <span data-ttu-id="4baa9-109">Без JIT-активации клиенты могут повлечь значительные штрафы, когда им часто приходится вызывать и освобождать объекты.</span><span class="sxs-lookup"><span data-stu-id="4baa9-109">Without JIT activation, clients can incur a significant penalty when they frequently need to call and release objects.</span></span>
    > [!Note]  
    > <span data-ttu-id="4baa9-110">Вы можете более подробно повысить производительность с помощью службы [пула объектов COM+](com--object-pooling.md) .</span><span class="sxs-lookup"><span data-stu-id="4baa9-110">You can refine this performance benefit further by using the [COM+ Object Pooling](com--object-pooling.md) service.</span></span> <span data-ttu-id="4baa9-111">Используя объекты, активируемые JIT-активацией, можно значительно ускорить повторную активацию объектов для клиентов при повторном использовании ресурсов, которые они могут хранить, что позволяет более точно контролировать объем памяти, используемой данным объектом на сервере.</span><span class="sxs-lookup"><span data-stu-id="4baa9-111">By pooling JIT-activated objects, you can greatly speed object reactivation for clients while reusing whatever resources they might be holding, giving you more precise control over how much memory is used by a given object on the server.</span></span> <span data-ttu-id="4baa9-112">Дополнительные сведения см. в разделе [группирование пулов объектов и JIT-активация com+](object-pooling-and-com--jit-activation.md).</span><span class="sxs-lookup"><span data-stu-id="4baa9-112">For more detail, see [Object Pooling and COM+ JIT Activation](object-pooling-and-com--jit-activation.md).</span></span>

     

-   <span data-ttu-id="4baa9-113">При использовании распределенных приложений для создания каждого объекта требуется дорогостоящий циклический обмен данными, а чем дальше клиент от сервера, тем выше затраты на активацию и упаковку объекта сервера, открытие канала и настройку прокси-сервера и заглушки.</span><span class="sxs-lookup"><span data-stu-id="4baa9-113">With distributed applications, an expensive network round-trip is required for the creation of every object, and the farther the client is from the server, the greater the costs of activating and marshaling the server object, opening the channel, and setting up the proxy and stub.</span></span> <span data-ttu-id="4baa9-114">С помощью службы JIT-активации COM+ можно сократить частоту создания объектов, чтобы значительно повысить производительность приложения.</span><span class="sxs-lookup"><span data-stu-id="4baa9-114">By using the COM+ JIT activation service, you can minimize the frequency of object creation to significantly improve the performance of your application.</span></span>
-   <span data-ttu-id="4baa9-115">При использовании JIT-активации COM+ для активации этих объектов, на которых клиенты хранят долгосрочные ссылки, но которые они не обязательно использовать, память сервера не всегда связана с поддержанием активности этих объектов.</span><span class="sxs-lookup"><span data-stu-id="4baa9-115">When you use COM+ JIT activation to activate those objects to which clients hold long-lived references but which they aren't necessarily using all the time, server memory is not always tied up keeping those objects alive.</span></span> <span data-ttu-id="4baa9-116">Это может значительно повысить масштабируемость приложения.</span><span class="sxs-lookup"><span data-stu-id="4baa9-116">This can significantly increase the scalability of your application.</span></span> <span data-ttu-id="4baa9-117">Единственная производительность, которую видят клиенты, — это время, затрачиваемое COM+ на повторную активацию объекта, обычно это просто больше времени, чем требуется для выделения памяти для объекта и значительно меньше, чем циклический обмен данными для создания удаленных объектов.</span><span class="sxs-lookup"><span data-stu-id="4baa9-117">The only performance hit that clients see is the time it takes COM+ to reactivate the object, usually just marginally more time than it takes to allocate memory for the object and substantially less than the network round-trip for remote object creation.</span></span>

## <a name="enabling-com-jit-activation"></a><span data-ttu-id="4baa9-118">Включение JIT-активации COM+</span><span class="sxs-lookup"><span data-stu-id="4baa9-118">Enabling COM+ JIT Activation</span></span>

<span data-ttu-id="4baa9-119">Включить службу JIT-активации COM+ для компонента можно с помощью средства администрирования "службы компонентов" или административных функций.</span><span class="sxs-lookup"><span data-stu-id="4baa9-119">You can enable the COM+ JIT activation service for a component by using either the Component Services administrative tool or the Administrative functions.</span></span> <span data-ttu-id="4baa9-120">Дополнительные сведения о том, как это сделать, см. [в разделе Включение JIT-активации для компонента](enabling-jit-activation-for-a-component.md).</span><span class="sxs-lookup"><span data-stu-id="4baa9-120">For details about how to do this, see [Enabling JIT Activation for a Component](enabling-jit-activation-for-a-component.md).</span></span>

<span data-ttu-id="4baa9-121">JIT-активация COM+ может взаимодействовать с другими службами COM+, например следующими:</span><span class="sxs-lookup"><span data-stu-id="4baa9-121">COM+ JIT activation can interact with other COM+ services, such as the following:</span></span>

-   <span data-ttu-id="4baa9-122">Если компонент требует транзакций, для него автоматически включается JIT-активация.</span><span class="sxs-lookup"><span data-stu-id="4baa9-122">When your component requires transactions, JIT activation is automatically enabled for it.</span></span> <span data-ttu-id="4baa9-123">Более подробные сведения см. в разделе [транзакции и JIT-активация com+](transactions-and-com--jit-activation.md).</span><span class="sxs-lookup"><span data-stu-id="4baa9-123">For greater detail, see [Transactions and COM+ JIT Activation](transactions-and-com--jit-activation.md).</span></span>
-   <span data-ttu-id="4baa9-124">Если для компонента включена JIT-активация, для синхронизации автоматически устанавливается значение обязательно.</span><span class="sxs-lookup"><span data-stu-id="4baa9-124">When your component is enabled for JIT activation, synchronization is automatically set to required.</span></span> <span data-ttu-id="4baa9-125">Это означает, что если два клиента одновременно вызывают JIT-активируемый компонент и вызов метода для одного из них, что приведет к деактивации объекта, то другой не будет потерян.</span><span class="sxs-lookup"><span data-stu-id="4baa9-125">This means that if two clients simultaneously call a JIT-activated component and a method call for one of them returns, causing the object to be deactivated, the other is not left stranded.</span></span>

## <a name="how-deactivation-is-triggered"></a><span data-ttu-id="4baa9-126">Как активируется деактивация</span><span class="sxs-lookup"><span data-stu-id="4baa9-126">How Deactivation Is Triggered</span></span>

<span data-ttu-id="4baa9-127">COM+ деактивирует объект на основе состояния бита завершения в контексте объекта.</span><span class="sxs-lookup"><span data-stu-id="4baa9-127">COM+ deactivates an object based on the status of the doneness bit on the object context.</span></span> <span data-ttu-id="4baa9-128">Объект может использовать этот бит, чтобы сообщить, выполняется ли он, то есть готов к деактивации — во время вызова метода.</span><span class="sxs-lookup"><span data-stu-id="4baa9-128">Your object can use this bit to signal whether it is done—that is, ready to be deactivated—during a given method call.</span></span> <span data-ttu-id="4baa9-129">Дополнительные сведения см. [в разделе Установка бита done](setting-the-done-bit.md).</span><span class="sxs-lookup"><span data-stu-id="4baa9-129">For more information, see [Setting the Done Bit](setting-the-done-bit.md).</span></span>

## <a name="using-the-auto-done-property"></a><span data-ttu-id="4baa9-130">Использование свойства автоматического завершения</span><span class="sxs-lookup"><span data-stu-id="4baa9-130">Using the Auto-Done Property</span></span>

<span data-ttu-id="4baa9-131">С помощью средства администрирования "службы компонентов" можно настроить метод таким способом, чтобы объект был автоматически деактивирован при возврате метода.</span><span class="sxs-lookup"><span data-stu-id="4baa9-131">Using the Component Services administrative tool, you can configure a method such that the object is automatically deactivated on method return.</span></span> <span data-ttu-id="4baa9-132">(Инструкции по заданию этого свойства см. [в разделе Включение автозаполнения для метода](enabling-auto-done-for-a-method.md) .) Выбрав этот параметр, можно исключить повторяющиеся вызовы метода для голосования в транзакциях.</span><span class="sxs-lookup"><span data-stu-id="4baa9-132">(See [Enabling Auto-Done for a Method](enabling-auto-done-for-a-method.md) for instructions about how to set this property.) By selecting this option, you can eliminate the repetitive method calls for voting in transactions.</span></span> <span data-ttu-id="4baa9-133">Поскольку значение по умолчанию для бита согласованности имеет значение true, если вы изменили бит done на true и не принимаете никаких действий для изменения этих параметров, [**иобжектконтекст:: сеткомплете**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setcomplete) вызывается автоматически после возврата метода.</span><span class="sxs-lookup"><span data-stu-id="4baa9-133">Because the default setting for the consistency bit is True, if you have changed the done bit to True as well and you take no action to change these settings, [**IObjectContext::SetComplete**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setcomplete) is called automatically after the method returns.</span></span>

<span data-ttu-id="4baa9-134">Однако существует одно предостережение этого поведения: COM+ будет проверять значение HRESULT, возвращаемое методом.</span><span class="sxs-lookup"><span data-stu-id="4baa9-134">However, there is one caveat to this behavior: COM+ will examine the HRESULT that the method returns.</span></span> <span data-ttu-id="4baa9-135">Если значение HRESULT указывает на сбой, бит согласованности имеет значение false и результат будет таким же, как при вызове [**иобжектконтекст:: SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort).</span><span class="sxs-lookup"><span data-stu-id="4baa9-135">If that HRESULT indicates failure, the consistency bit is set to False and the result is the same as if you had called [**IObjectContext::SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort).</span></span>

<span data-ttu-id="4baa9-136">Подводя итог, если выбрать автозаполнение для метода и не предпринимать никаких действий для задания каких-либо битов, и если возвращается значение HRESULT (HR), то применяется следующее:</span><span class="sxs-lookup"><span data-stu-id="4baa9-136">To summarize, if you select auto-done for a method and don't take any action to set any bits, and if an HRESULT(hr) is returned, the following applies:</span></span>

-   <span data-ttu-id="4baa9-137">В случае успешности (HR) это так, как если бы вы вызывали [**сеткомплете**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setcomplete).</span><span class="sxs-lookup"><span data-stu-id="4baa9-137">If SUCCEEDS(hr), it is as though you called [**SetComplete**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setcomplete).</span></span>
-   <span data-ttu-id="4baa9-138">Если произошел сбой (HR), это так, как если бы вы вызывали [**SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort).</span><span class="sxs-lookup"><span data-stu-id="4baa9-138">If FAILED(hr), it is as though you called [**SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort).</span></span>

## <a name="using-iobjectcontrol-to-manage-object-activation-and-deactivation"></a><span data-ttu-id="4baa9-139">Использование IObjectControl для управления активацией и деактивацией объектов</span><span class="sxs-lookup"><span data-stu-id="4baa9-139">Using IObjectControl to Manage Object Activation and Deactivation</span></span>

<span data-ttu-id="4baa9-140">Можно реализовать интерфейс [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol) , чтобы среда выполнения COM+ автоматически управляла деактивацией и реактивацией объектов.</span><span class="sxs-lookup"><span data-stu-id="4baa9-140">You can implement the [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol) interface so that the COM+ runtime automatically manages deactivation and reactivation for your objects.</span></span> <span data-ttu-id="4baa9-141">Когда объект реализует этот интерфейс, COM+ вызывает [**IObjectControl::D еактивате**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate) , когда он деактивирует объект и [**IObjectControl:: Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) при его повторной активации.</span><span class="sxs-lookup"><span data-stu-id="4baa9-141">When an object implements this interface, COM+ calls [**IObjectControl::Deactivate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate) when it deactivates the object and [**IObjectControl::Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) when it reactivates it.</span></span> <span data-ttu-id="4baa9-142">Эти методы обеспечивают автоматическую инициализацию контекста при активации объекта и очистке состояния при деактивации.</span><span class="sxs-lookup"><span data-stu-id="4baa9-142">These methods enable automatic context initialization on object activation and cleanup of state on deactivation.</span></span>

<span data-ttu-id="4baa9-143">При группировании объектов, использующих JIT-активацию COM+, настоятельно рекомендуется реализовать [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol).</span><span class="sxs-lookup"><span data-stu-id="4baa9-143">If you are pooling objects that use COM+ JIT activation, it is highly recommended that you implement [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol).</span></span> <span data-ttu-id="4baa9-144">Дополнительные сведения см. в разделе [группирование пулов объектов и JIT-активация com+](object-pooling-and-com--jit-activation.md).</span><span class="sxs-lookup"><span data-stu-id="4baa9-144">For more detail, see [Object Pooling and COM+ JIT Activation](object-pooling-and-com--jit-activation.md).</span></span>

## <a name="statelessness-and-jit-activation"></a><span data-ttu-id="4baa9-145">Стателесснесс и JIT-активация</span><span class="sxs-lookup"><span data-stu-id="4baa9-145">Statelessness and JIT Activation</span></span>

<span data-ttu-id="4baa9-146">Транзакционные объекты, как правило, не имеют состояния, так как вы не можете совместно использовать состояние через границу транзакции.</span><span class="sxs-lookup"><span data-stu-id="4baa9-146">Transactional objects are necessarily stateless because you cannot share state across a transaction boundary.</span></span> <span data-ttu-id="4baa9-147">Поэтому JIT-активацию следует использовать только в том случае, если объект не имеет состояния, которое было бы потеряно при деактивации. в противном случае вы нарушаете изоляцию транзакций.</span><span class="sxs-lookup"><span data-stu-id="4baa9-147">Therefore, you would use JIT activation only when your object holds no state that would be lost on deactivation; otherwise, you violate the isolation of the transactions.</span></span> <span data-ttu-id="4baa9-148">Из-за особенностей естественного использования объектов транзакций они выполняют определенную единицу работы и освобождают объект при фиксации или прерывании транзакции — JIT-активация и автоматические транзакции тесно связаны друг с друга.</span><span class="sxs-lookup"><span data-stu-id="4baa9-148">Due to the natural use patterns of transactional objects—they do some unit of work and release the object when the transaction commits or aborts—JIT activation and automatic transactions are closely related.</span></span> <span data-ttu-id="4baa9-149">Настройка объекта для требования транзакций активирует JIT-активацию COM+ автоматически.</span><span class="sxs-lookup"><span data-stu-id="4baa9-149">Configuring an object to require transactions enables COM+ JIT activation automatically.</span></span>

## <a name="related-topics"></a><span data-ttu-id="4baa9-150">См. также</span><span class="sxs-lookup"><span data-stu-id="4baa9-150">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4baa9-151">Задачи JIT-активации COM+</span><span class="sxs-lookup"><span data-stu-id="4baa9-151">COM+ Just-in-Time Activation Tasks</span></span>](com--just-in-time-activation-tasks.md)
</dt> <dt>

[<span data-ttu-id="4baa9-152">Объединение объектов в пул и JIT-активация COM+</span><span class="sxs-lookup"><span data-stu-id="4baa9-152">Object Pooling and COM+ JIT Activation</span></span>](object-pooling-and-com--jit-activation.md)
</dt> <dt>

[<span data-ttu-id="4baa9-153">Транзакции и JIT-активация COM+</span><span class="sxs-lookup"><span data-stu-id="4baa9-153">Transactions and COM+ JIT Activation</span></span>](transactions-and-com--jit-activation.md)
</dt> </dl>

 

 



