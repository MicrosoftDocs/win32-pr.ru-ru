---
description: Компоненты приложения используют распределитель ресурсов COM+ для доступа к общим и неустойчивым сведениям о состоянии, таким как подключения между компонентами и определенным диспетчером ресурсов, и управления ими.
ms.assetid: 252c7180-61b1-485d-883d-36bf77357a29
title: Основные понятия распределителя ресурсов COM+
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8f0fcf281d6d7b8ed0e087b6d77e4d686e28e1fa
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103807199"
---
# <a name="com-resource-dispenser-concepts"></a>Основные понятия распределителя ресурсов COM+

Компоненты приложения используют распределитель ресурсов COM+ для доступа к общим и неустойчивым сведениям о состоянии, таким как подключения между компонентами и определенным диспетчером ресурсов, и управления ими. В среде выполнения распределителя ресурсов становятся доступными динамические пулы ресурсов, такие как подключения к базам данных, сетевые подключения, подключения к очередям, потокам, объектам и блокам памяти. Процесс приложения достигает высокой производительности за счет использования минимального числа часто используемых ресурсов. Распределитель ресурсов также может автоматизировать транзакции и реорганизации. (Дополнительные сведения об этой функции см. в разделе [Автоматическое освобождение ресурсов](automatic-resource-reclamation.md) .)

> [!Note]  
> *Ресурс* — это все, что создает распределитель ресурсов. Например, подключение к диспетчеру ресурсов является общим ресурсом. Ресурсы находятся в памяти распределителя ресурсов и никогда не копируются в Диспетчер распределителя. Ресурс известен только непрозрачным маркером (**RESID**) и может или не может выполнять транзакции. Несмотря на то, что управляемые ресурсы часто бывают подключениями к компоненту, который управляет устойчивым состоянием, сами подключения не являются устойчивыми. Распределитель ресурсов часто использует связанный диспетчер ресурсов для сохранения устойчивого состояния.

 

В архитектуре система распределителя ресурсов COM+ состоит из распределительов ресурсов и диспетчера распределителя. Распределитель ресурсов — это предоставляемые пользователями компоненты, предоставляющие приложениям простые интерфейсы для общих ресурсов. Диспетчер распределителя — это компонент, предоставляемый COM+, который координирует действия различных распределительных ресурсов.

Распределитель ресурсов — это компонент библиотеки динамической компоновки (DLL), предоставляющий по меньшей мере два интерфейса. Первый, [**идиспенсердривер**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver), предоставляет диспетчеру распределителя основные сведения о том, как создавать, уничтожать и закреплять ресурсы, которыми он управляет. Вторая функция предоставляется приложениям и может быть COM-интерфейсом или набором интерфейсов, либо может быть интерфейсом прикладного программирования (API), с которым компонент связан через библиотеку импорта. Приложение может вызывать любой распределитель ресурсов, который, в свою очередь, может предложить любой API для приложения. Если распределитель ресурсов является компонентом автоматизации, доступ к нему можно получить из Microsoft Visual Basic. Экземпляр распределителя ресурсов создается, когда на него ссылается компонент приложения.

Диспетчер распределителя, предоставляемый COM+, отслеживает распределителя ресурсов и координаты между ними. Он реализует два интерфейса: [**идиспенсерманажер**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispensermanager) и [**ихолдер**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder). распределитель ресурсов регистрируется с помощью интерфейса **идиспенсерманажер** . Затем Диспетчер распределителя передает им указатель на **ихолдер** , который используется для уведомления диспетчера распределителя о своих действиях.

Распределитель ресурсов транзакций должен прикрепляться к транзакции координатор распределенных транзакций (DTC). Это подразумевает использование внутреннего или внешнего (для распределителя ресурсов) диспетчера ресурсов, совместимого с OLE-транзакциями.

> [!Note]  
> Модель программирования COM+ включает в себя *декларативные транзакции*, которые помогают защитить работу, выполняемую объектом приложения в течение его времени существования. Если объект приложения использует распределитель ресурсов COM+, выполняемая им работа автоматически преобразуется в транзакционную. то есть компоненту не нужно явно объявлять транзакции. Эти транзакции определяются в спецификации транзакций OLE, реализованной DTC, и инициируются от имени объекта приложения COM+. Дополнительные сведения см. в разделе рекомендации по разработке для DTC.

 

Ресурсы не должны быть транзакционными. Распределитель ресурсов, который группирует нетранзакционные ресурсы, по-прежнему может обеспечить высокую производительность, позволяя объектам приложения получать доступ к общему пулу этих ресурсов. Этот тип распределителя ресурсов возвращает \_ значение false из метода [**идиспенсердривер:: енлистресаурце.**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) это означает, что распределитель ресурсов не запустил ресурс, так как ресурс не является транзакционным.

Распределитель ресурсов также может работать независимо от COM+, предоставляя только возможности пула ресурсов. Например, если распределитель ресурсов предоставляет API (например, ODBC), распределитель ресурсов может быть библиотекой DLL, к которой приложение обращается через библиотеку импорта (или с помощью функций [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) и [**GetProcAddress**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getprocaddress) ). Распределитель ресурсов также может быть COM-компонентом, к которому обращается приложение, вызывая [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance). Без использования COM+ метод [**енлистресаурце**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) распределителя ресурсов не может быть вызван, так как диспетчер распределителя не имеет сведений о текущей транзакции компонента.

При запуске библиотека DLL распределителя ресурсов должна зарегистрироваться в диспетчере распределителя. Диспетчер распределителя — это управляющий руководитель, который управляет загрузкой и выгрузкой распределительов ресурсов, предоставляет контекст COM+ и управляет диспетчером статистики инвентаризации. (Дополнительные сведения см. в разделе [Диспетчер распределителя com+](com--dispenser-manager.md).) Распределитель ресурсов сначала вызывает функцию [**жетдиспенсерманажер**](/windows/desktop/api/MtxDM/nf-mtxdm-getdispensermanager) , а затем вызывает метод [**Идиспенсерманажер:: регистердиспенсер**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispensermanager-registerdispenser) , передавая указатель [**идиспенсердривер**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver) , который реализует распределитель ресурсов. Этот вызов возвращает ссылку на [**ихолдер**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder).

Чтобы завершить работу, распределитель ресурсов вызывает [**ихолдер:: Close**](/windows/desktop/api/ComSvcs/nf-comsvcs-iholder-close). Чтобы гарантировать завершение работы пакета, распределитель ресурсов должен иметь возможность обрабатывать ситуацию, когда вызовы продолжают поступать от бизнес-объектов после того, как COM+ запросил завершение работы распределителя.

В следующих подразделах этого раздела приведены более подробные сведения о службе распределителя ресурсов COM+.

-   [Диспетчер распределителя COM+](com--dispenser-manager.md)
-   [Типы потоков распределителя ресурсов COM+](com--resource-dispenser-thread-types.md)
-   [Состояния ресурсов в пуле, доступные для распределителя ресурсов COM+](pooled-resource-states-available-to-com--resource-dispenser.md)
-   [Прикрепление ресурса в транзакции](enlisting-a-resource-in-a-transaction.md)
-   [Процесс выделения ресурсов распределителя ресурсов](resource-dispenser-resource-allocation-process.md)
-   [Отслеживание нераспределенных ресурсов](tracking-non-allocated-resources.md)
-   [Автоматическое освобождение ресурсов](automatic-resource-reclamation.md)
-   [Типы, используемые в интерфейсах распределителя ресурсов COM+](types-used-in-com--resource-dispenser-interfaces.md)
-   [Интерфейсы распределителя ресурсов COM+](com--resource-dispenser-interfaces.md)

## <a name="related-topics"></a>См. также

<dl> <dt>

[Задачи распределителя ресурсов COM+](com--resource-dispenser-tasks.md)
</dt> </dl>

 

 
