---
description: Компоненты приложения используют распределитель ресурсов COM+ для доступа к общим и неустойчивым сведениям о состоянии, таким как подключения между компонентами и определенным диспетчером ресурсов, и управления ими.
ms.assetid: 252c7180-61b1-485d-883d-36bf77357a29
title: Основные понятия распределителя ресурсов COM+
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8f0fcf281d6d7b8ed0e087b6d77e4d686e28e1fa
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103807199"
---
# <a name="com-resource-dispenser-concepts"></a><span data-ttu-id="28546-103">Основные понятия распределителя ресурсов COM+</span><span class="sxs-lookup"><span data-stu-id="28546-103">COM+ Resource Dispenser Concepts</span></span>

<span data-ttu-id="28546-104">Компоненты приложения используют распределитель ресурсов COM+ для доступа к общим и неустойчивым сведениям о состоянии, таким как подключения между компонентами и определенным диспетчером ресурсов, и управления ими.</span><span class="sxs-lookup"><span data-stu-id="28546-104">Application components use the COM+ resource dispenser to access and manage shared, nondurable state information, such as connections between components and a given resource manager.</span></span> <span data-ttu-id="28546-105">В среде выполнения распределителя ресурсов становятся доступными динамические пулы ресурсов, такие как подключения к базам данных, сетевые подключения, подключения к очередям, потокам, объектам и блокам памяти.</span><span class="sxs-lookup"><span data-stu-id="28546-105">At runtime, dynamic pools of resources, such as database connections, network connections, connections to queues, threads, objects, and memory blocks, are made available to the resource dispenser.</span></span> <span data-ttu-id="28546-106">Процесс приложения достигает высокой производительности за счет использования минимального числа часто используемых ресурсов.</span><span class="sxs-lookup"><span data-stu-id="28546-106">The application process achieves high performance by using a minimum number of frequently used resources.</span></span> <span data-ttu-id="28546-107">Распределитель ресурсов также может автоматизировать транзакции и реорганизации.</span><span class="sxs-lookup"><span data-stu-id="28546-107">The resource dispenser can also automate transactions and reclamation.</span></span> <span data-ttu-id="28546-108">(Дополнительные сведения об этой функции см. в разделе [Автоматическое освобождение ресурсов](automatic-resource-reclamation.md) .)</span><span class="sxs-lookup"><span data-stu-id="28546-108">(See [Automatic Resource Reclamation](automatic-resource-reclamation.md) for more information about this feature.)</span></span>

> [!Note]  
> <span data-ttu-id="28546-109">*Ресурс* — это все, что создает распределитель ресурсов.</span><span class="sxs-lookup"><span data-stu-id="28546-109">A *resource* is anything a resource dispenser creates.</span></span> <span data-ttu-id="28546-110">Например, подключение к диспетчеру ресурсов является общим ресурсом.</span><span class="sxs-lookup"><span data-stu-id="28546-110">For example, a connection to a resource manager is a common resource.</span></span> <span data-ttu-id="28546-111">Ресурсы находятся в памяти распределителя ресурсов и никогда не копируются в Диспетчер распределителя.</span><span class="sxs-lookup"><span data-stu-id="28546-111">Resources reside in the resource dispenser's memory and are never copied to the dispenser manager.</span></span> <span data-ttu-id="28546-112">Ресурс известен только непрозрачным маркером (**RESID**) и может или не может выполнять транзакции.</span><span class="sxs-lookup"><span data-stu-id="28546-112">A resource is known only by an opaque handle (**RESID**) and may or may not be capable of performing transactions.</span></span> <span data-ttu-id="28546-113">Несмотря на то, что управляемые ресурсы часто бывают подключениями к компоненту, который управляет устойчивым состоянием, сами подключения не являются устойчивыми.</span><span class="sxs-lookup"><span data-stu-id="28546-113">Although the resources managed might often be connections to a component managing a durable state, the connections themselves are not durable.</span></span> <span data-ttu-id="28546-114">Распределитель ресурсов часто использует связанный диспетчер ресурсов для сохранения устойчивого состояния.</span><span class="sxs-lookup"><span data-stu-id="28546-114">A resource dispenser often uses a related resource manager to retain the durable state.</span></span>

 

<span data-ttu-id="28546-115">В архитектуре система распределителя ресурсов COM+ состоит из распределительов ресурсов и диспетчера распределителя.</span><span class="sxs-lookup"><span data-stu-id="28546-115">Architecturally, the COM+ resource dispenser system consists of resource dispensers and a dispenser manager.</span></span> <span data-ttu-id="28546-116">Распределитель ресурсов — это предоставляемые пользователями компоненты, предоставляющие приложениям простые интерфейсы для общих ресурсов.</span><span class="sxs-lookup"><span data-stu-id="28546-116">Resource dispensers are user-supplied components that provide applications with simple interfaces to shared resources.</span></span> <span data-ttu-id="28546-117">Диспетчер распределителя — это компонент, предоставляемый COM+, который координирует действия различных распределительных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="28546-117">The dispenser manager is a component provided by COM+ that coordinates the activities of the various resource dispensers.</span></span>

<span data-ttu-id="28546-118">Распределитель ресурсов — это компонент библиотеки динамической компоновки (DLL), предоставляющий по меньшей мере два интерфейса.</span><span class="sxs-lookup"><span data-stu-id="28546-118">A resource dispenser is a dynamic-link library (DLL) component that provides at least two interfaces.</span></span> <span data-ttu-id="28546-119">Первый, [**идиспенсердривер**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver), предоставляет диспетчеру распределителя основные сведения о том, как создавать, уничтожать и закреплять ресурсы, которыми он управляет.</span><span class="sxs-lookup"><span data-stu-id="28546-119">The first, [**IDispenserDriver**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver), provides the dispenser manager with basic information on how to create, destroy, and enlist the resources it manages.</span></span> <span data-ttu-id="28546-120">Вторая функция предоставляется приложениям и может быть COM-интерфейсом или набором интерфейсов, либо может быть интерфейсом прикладного программирования (API), с которым компонент связан через библиотеку импорта.</span><span class="sxs-lookup"><span data-stu-id="28546-120">The second is exposed to the applications and can be a COM interface or set of interfaces or can be an application programming interface (API) to which a component is linked via an import library.</span></span> <span data-ttu-id="28546-121">Приложение может вызывать любой распределитель ресурсов, который, в свою очередь, может предложить любой API для приложения.</span><span class="sxs-lookup"><span data-stu-id="28546-121">An application can call any resource dispenser, which in turn may offer any API to the application.</span></span> <span data-ttu-id="28546-122">Если распределитель ресурсов является компонентом автоматизации, доступ к нему можно получить из Microsoft Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="28546-122">If the resource dispenser is an Automation component, it can be accessed from Microsoft Visual Basic.</span></span> <span data-ttu-id="28546-123">Экземпляр распределителя ресурсов создается, когда на него ссылается компонент приложения.</span><span class="sxs-lookup"><span data-stu-id="28546-123">A resource dispenser is instantiated when an application component refers to it.</span></span>

<span data-ttu-id="28546-124">Диспетчер распределителя, предоставляемый COM+, отслеживает распределителя ресурсов и координаты между ними.</span><span class="sxs-lookup"><span data-stu-id="28546-124">The dispenser manager provided by COM+ tracks resource dispensers and coordinates among them.</span></span> <span data-ttu-id="28546-125">Он реализует два интерфейса: [**идиспенсерманажер**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispensermanager) и [**ихолдер**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder).</span><span class="sxs-lookup"><span data-stu-id="28546-125">It implements two interfaces: [**IDispenserManager**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispensermanager) and [**IHolder**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder).</span></span> <span data-ttu-id="28546-126">распределитель ресурсов регистрируется с помощью интерфейса **идиспенсерманажер** .</span><span class="sxs-lookup"><span data-stu-id="28546-126">resource dispensers register themselves using the **IDispenserManager** interface.</span></span> <span data-ttu-id="28546-127">Затем Диспетчер распределителя передает им указатель на **ихолдер** , который используется для уведомления диспетчера распределителя о своих действиях.</span><span class="sxs-lookup"><span data-stu-id="28546-127">The dispenser manager then gives them a pointer to an **IHolder** that they use to notify the dispenser manager of their activities.</span></span>

<span data-ttu-id="28546-128">Распределитель ресурсов транзакций должен прикрепляться к транзакции координатор распределенных транзакций (DTC).</span><span class="sxs-lookup"><span data-stu-id="28546-128">A transactional resource dispenser must enlist in a Distributed Transaction Coordinator (DTC) transaction.</span></span> <span data-ttu-id="28546-129">Это подразумевает использование внутреннего или внешнего (для распределителя ресурсов) диспетчера ресурсов, совместимого с OLE-транзакциями.</span><span class="sxs-lookup"><span data-stu-id="28546-129">This implies use of either an internal or an external (to the resource dispenser) resource manager that is OLE transactions-compliant.</span></span>

> [!Note]  
> <span data-ttu-id="28546-130">Модель программирования COM+ включает в себя *декларативные транзакции*, которые помогают защитить работу, выполняемую объектом приложения в течение его времени существования.</span><span class="sxs-lookup"><span data-stu-id="28546-130">The COM+ programming model includes *declarative transactions*, which help protect the work performed by an application object during its lifetime.</span></span> <span data-ttu-id="28546-131">Если объект приложения использует распределитель ресурсов COM+, выполняемая им работа автоматически преобразуется в транзакционную. то есть компоненту не нужно явно объявлять транзакции.</span><span class="sxs-lookup"><span data-stu-id="28546-131">When an application object uses a COM+ resource dispenser, the work it performs is automatically transactional; that is, the component doesn't have to explicitly declare transactions.</span></span> <span data-ttu-id="28546-132">Эти транзакции определяются в спецификации транзакций OLE, реализованной DTC, и инициируются от имени объекта приложения COM+.</span><span class="sxs-lookup"><span data-stu-id="28546-132">These transactions are defined in the OLE Transactions specification, implemented by the DTC, and initiated on behalf of the application object by COM+.</span></span> <span data-ttu-id="28546-133">Дополнительные сведения см. в разделе рекомендации по разработке для DTC.</span><span class="sxs-lookup"><span data-stu-id="28546-133">See the DTC Development Guide for more information.</span></span>

 

<span data-ttu-id="28546-134">Ресурсы не должны быть транзакционными.</span><span class="sxs-lookup"><span data-stu-id="28546-134">Resources need not be transactional.</span></span> <span data-ttu-id="28546-135">Распределитель ресурсов, который группирует нетранзакционные ресурсы, по-прежнему может обеспечить высокую производительность, позволяя объектам приложения получать доступ к общему пулу этих ресурсов.</span><span class="sxs-lookup"><span data-stu-id="28546-135">A resource dispenser that pools non-transactional resources can still achieve high performance by allowing application objects to access a shared pool of these resources.</span></span> <span data-ttu-id="28546-136">Этот тип распределителя ресурсов возвращает \_ значение false из метода [**идиспенсердривер:: енлистресаурце.**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) это означает, что распределитель ресурсов не запустил ресурс, так как ресурс не является транзакционным.</span><span class="sxs-lookup"><span data-stu-id="28546-136">This type of resource dispenser returns S\_FALSE from the [**IDispenserDriver::EnlistResource**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) method, which means that the resource dispenser did not enlist the resource because the resource is not transactional.</span></span>

<span data-ttu-id="28546-137">Распределитель ресурсов также может работать независимо от COM+, предоставляя только возможности пула ресурсов.</span><span class="sxs-lookup"><span data-stu-id="28546-137">The resource dispenser can also function independently of COM+, providing only resource pooling capabilities.</span></span> <span data-ttu-id="28546-138">Например, если распределитель ресурсов предоставляет API (например, ODBC), распределитель ресурсов может быть библиотекой DLL, к которой приложение обращается через библиотеку импорта (или с помощью функций [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) и [**GetProcAddress**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getprocaddress) ).</span><span class="sxs-lookup"><span data-stu-id="28546-138">For example, if a resource dispenser exposes an API (such as ODBC), the resource dispenser might be a DLL that is accessed by the application through an import library (or using the [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) and [**GetProcAddress**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getprocaddress) functions).</span></span> <span data-ttu-id="28546-139">Распределитель ресурсов также может быть COM-компонентом, к которому обращается приложение, вызывая [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance).</span><span class="sxs-lookup"><span data-stu-id="28546-139">A resource dispenser might also be a COM component that an application accesses by calling [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance).</span></span> <span data-ttu-id="28546-140">Без использования COM+ метод [**енлистресаурце**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) распределителя ресурсов не может быть вызван, так как диспетчер распределителя не имеет сведений о текущей транзакции компонента.</span><span class="sxs-lookup"><span data-stu-id="28546-140">Without COM+, a resource dispenser's [**EnlistResource**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) method can never be called because the dispenser manager has no knowledge of the current component transaction.</span></span>

<span data-ttu-id="28546-141">При запуске библиотека DLL распределителя ресурсов должна зарегистрироваться в диспетчере распределителя.</span><span class="sxs-lookup"><span data-stu-id="28546-141">On startup, a resource dispenser DLL must register itself with the dispenser manager.</span></span> <span data-ttu-id="28546-142">Диспетчер распределителя — это управляющий руководитель, который управляет загрузкой и выгрузкой распределительов ресурсов, предоставляет контекст COM+ и управляет диспетчером статистики инвентаризации.</span><span class="sxs-lookup"><span data-stu-id="28546-142">The dispenser manager is the controlling executive that manages the loading and unloading of resource dispensers, provides the COM+ context, and controls the inventory statistics manager.</span></span> <span data-ttu-id="28546-143">(Дополнительные сведения см. в разделе [Диспетчер распределителя com+](com--dispenser-manager.md).) Распределитель ресурсов сначала вызывает функцию [**жетдиспенсерманажер**](/windows/desktop/api/MtxDM/nf-mtxdm-getdispensermanager) , а затем вызывает метод [**Идиспенсерманажер:: регистердиспенсер**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispensermanager-registerdispenser) , передавая указатель [**идиспенсердривер**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver) , который реализует распределитель ресурсов.</span><span class="sxs-lookup"><span data-stu-id="28546-143">(For more information, see [COM+ Dispenser Manager](com--dispenser-manager.md).) The resource dispenser first calls the [**GetDispenserManager**](/windows/desktop/api/MtxDM/nf-mtxdm-getdispensermanager) function and then calls the [**IDispenserManager::RegisterDispenser**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispensermanager-registerdispenser) method, passing the [**IDispenserDriver**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver) pointer that the resource dispenser implements.</span></span> <span data-ttu-id="28546-144">Этот вызов возвращает ссылку на [**ихолдер**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder).</span><span class="sxs-lookup"><span data-stu-id="28546-144">This call returns a reference to [**IHolder**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder).</span></span>

<span data-ttu-id="28546-145">Чтобы завершить работу, распределитель ресурсов вызывает [**ихолдер:: Close**](/windows/desktop/api/ComSvcs/nf-comsvcs-iholder-close).</span><span class="sxs-lookup"><span data-stu-id="28546-145">To shut down, a resource dispenser calls [**IHolder::Close**](/windows/desktop/api/ComSvcs/nf-comsvcs-iholder-close).</span></span> <span data-ttu-id="28546-146">Чтобы гарантировать завершение работы пакета, распределитель ресурсов должен иметь возможность обрабатывать ситуацию, когда вызовы продолжают поступать от бизнес-объектов после того, как COM+ запросил завершение работы распределителя.</span><span class="sxs-lookup"><span data-stu-id="28546-146">To ensure a clean package shutdown, a resource dispenser must be able to handle the situation when calls continue to arrive from business objects after COM+ has asked the dispenser to shut down.</span></span>

<span data-ttu-id="28546-147">В следующих подразделах этого раздела приведены более подробные сведения о службе распределителя ресурсов COM+.</span><span class="sxs-lookup"><span data-stu-id="28546-147">The following topics in this section provide more detailed information about the COM+ resource dispenser service:</span></span>

-   [<span data-ttu-id="28546-148">Диспетчер распределителя COM+</span><span class="sxs-lookup"><span data-stu-id="28546-148">COM+ Dispenser Manager</span></span>](com--dispenser-manager.md)
-   [<span data-ttu-id="28546-149">Типы потоков распределителя ресурсов COM+</span><span class="sxs-lookup"><span data-stu-id="28546-149">COM+ Resource Dispenser Thread Types</span></span>](com--resource-dispenser-thread-types.md)
-   [<span data-ttu-id="28546-150">Состояния ресурсов в пуле, доступные для распределителя ресурсов COM+</span><span class="sxs-lookup"><span data-stu-id="28546-150">Pooled Resource States Available to COM+ Resource Dispenser</span></span>](pooled-resource-states-available-to-com--resource-dispenser.md)
-   [<span data-ttu-id="28546-151">Прикрепление ресурса в транзакции</span><span class="sxs-lookup"><span data-stu-id="28546-151">Enlisting a Resource in a Transaction</span></span>](enlisting-a-resource-in-a-transaction.md)
-   [<span data-ttu-id="28546-152">Процесс выделения ресурсов распределителя ресурсов</span><span class="sxs-lookup"><span data-stu-id="28546-152">Resource Dispenser Resource Allocation Process</span></span>](resource-dispenser-resource-allocation-process.md)
-   [<span data-ttu-id="28546-153">Отслеживание нераспределенных ресурсов</span><span class="sxs-lookup"><span data-stu-id="28546-153">Tracking Non-Allocated Resources</span></span>](tracking-non-allocated-resources.md)
-   [<span data-ttu-id="28546-154">Автоматическое освобождение ресурсов</span><span class="sxs-lookup"><span data-stu-id="28546-154">Automatic Resource Reclamation</span></span>](automatic-resource-reclamation.md)
-   [<span data-ttu-id="28546-155">Типы, используемые в интерфейсах распределителя ресурсов COM+</span><span class="sxs-lookup"><span data-stu-id="28546-155">Types Used in COM+ Resource Dispenser Interfaces</span></span>](types-used-in-com--resource-dispenser-interfaces.md)
-   [<span data-ttu-id="28546-156">Интерфейсы распределителя ресурсов COM+</span><span class="sxs-lookup"><span data-stu-id="28546-156">COM+ Resource Dispenser Interfaces</span></span>](com--resource-dispenser-interfaces.md)

## <a name="related-topics"></a><span data-ttu-id="28546-157">См. также</span><span class="sxs-lookup"><span data-stu-id="28546-157">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="28546-158">Задачи распределителя ресурсов COM+</span><span class="sxs-lookup"><span data-stu-id="28546-158">COM+ Resource Dispenser Tasks</span></span>](com--resource-dispenser-tasks.md)
</dt> </dl>

 

 
