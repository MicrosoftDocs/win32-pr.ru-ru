---
description: Повышение производительности с помощью пула объектов
ms.assetid: 7a8a38d8-6549-4686-a298-f3b427b380e3
title: Повышение производительности с помощью пула объектов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 398b9140080d3a439293b5152b4da7251978e800
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105701232"
---
# <a name="improving-performance-with-object-pooling"></a><span data-ttu-id="caee8-103">Повышение производительности с помощью пула объектов</span><span class="sxs-lookup"><span data-stu-id="caee8-103">Improving Performance with Object Pooling</span></span>

<span data-ttu-id="caee8-104">Использование пулов объектов в определенных обстоятельствах может быть очень эффективным, что приводит к существенному повышению производительности.</span><span class="sxs-lookup"><span data-stu-id="caee8-104">Object pooling can be extremely effective in certain circumstances, yielding substantial increases in performance.</span></span> <span data-ttu-id="caee8-105">Общая идея повторного использования объектов для лучшей работы заключается в том, чтобы использовать пул как можно больше ресурсов, вычисляя инициализацию от фактически выполненных работ, а затем административно подгонять характеристики пула к фактическому оборудованию во время развертывания.</span><span class="sxs-lookup"><span data-stu-id="caee8-105">The general idea for reusing objects to best advantage is to pool as many resources as possible, factoring out initialization from actual work performed, and then to administratively tailor the pool characteristics to actual hardware at deployment time.</span></span> <span data-ttu-id="caee8-106">То есть следует продолжать работу в соответствии с приведенными ниже шагами.</span><span class="sxs-lookup"><span data-stu-id="caee8-106">That is, you should proceed according to the following steps:</span></span>

1.  <span data-ttu-id="caee8-107">Напишите объект таким образом, чтобы выделять дорогостоящую инициализацию и получение ресурсов, которое выполняется для любого клиента в качестве необходимого компонента для выполнения фактической работы от имени клиента.</span><span class="sxs-lookup"><span data-stu-id="caee8-107">Write the object so as to factor out expensive initialization and resource acquisition that is performed for any client as a prerequisite to doing actual work on the client's behalf.</span></span> <span data-ttu-id="caee8-108">Запишите большие конструкторы объектов в пул как можно больше ресурсов, чтобы они удерживались объектом и немедленно доступны, когда клиенты получают объект из пула.</span><span class="sxs-lookup"><span data-stu-id="caee8-108">Write heavy object constructors to pool as many resources as possible so that these are held by the object and immediately available when clients get an object from the pool.</span></span>
2.  <span data-ttu-id="caee8-109">Административная Настройка пула для достижения наилучшего баланса в доступных аппаратных ресурсах, как правило, выдается объем памяти, выделенной для хранения пула определенного размера в Exchange для ускоренного клиентского доступа и использования объектов.</span><span class="sxs-lookup"><span data-stu-id="caee8-109">Administratively configure the pool to achieve the best balance in available hardware resources, usually trading the memory dedicated to maintaining a pool of a certain size in exchange for faster client access and use of objects.</span></span> <span data-ttu-id="caee8-110">В определенной точке группировка приведет к снижению числа возвратов, и вы сможете получить достаточно высокой производительности, ограничивая возможность использования ресурсов конкретным компонентом.</span><span class="sxs-lookup"><span data-stu-id="caee8-110">At a certain point, pooling will achieve diminishing returns and you can get good enough performance while limiting possible resource usage by a particular component.</span></span>

## <a name="doing-actual-work-or-acquiring-resources"></a><span data-ttu-id="caee8-111">Выполнение фактической работы или получение ресурсов</span><span class="sxs-lookup"><span data-stu-id="caee8-111">Doing Actual Work or Acquiring Resources</span></span>

<span data-ttu-id="caee8-112">Если у вас есть компонент, который клиенты будут использовать для краткого и быстрого успеха, где значительная часть времени использования объектов тратится на получение ресурсов или инициализацию до выполнения определенной работы для клиента, вероятно, что написание вашего компонента для использования пула объектов будет значительно выигрышом.</span><span class="sxs-lookup"><span data-stu-id="caee8-112">If you have a component that clients will use briefly and in rapid succession, where a significant portion of object use time is spent in acquiring resources or initializing prior to doing specific work for the client, chances are that writing your component to use object pooling will be a big win for you.</span></span>

<span data-ttu-id="caee8-113">Компонент можно написать таким образом, чтобы в конструкторе объекта выполнялась большая часть длительной работы, которая одинакова для всех клиентов, — получение одного или нескольких подключений, выполнение сценариев, получение данных инициализации из файлов или по сети и т. д.</span><span class="sxs-lookup"><span data-stu-id="caee8-113">You can write the component so that in the object's constructor you perform as much of the time-consuming work that is uniform for all clients as possible—acquiring one or several connections, running scripts, fetching initialization data from files or across a network, and so forth.</span></span> <span data-ttu-id="caee8-114">Это влияет на каждый такой ресурс в пуле.</span><span class="sxs-lookup"><span data-stu-id="caee8-114">This has the effect of pooling every such resource.</span></span> <span data-ttu-id="caee8-115">Вы объединяете сочетание ресурсов и универсальное состояние, необходимое для выполнения некоторой работы.</span><span class="sxs-lookup"><span data-stu-id="caee8-115">You are pooling the combination of resources and generic state necessary to perform some work.</span></span>

<span data-ttu-id="caee8-116">В этом случае, когда клиенты получают объект из пула, эти ресурсы немедленно становятся доступными.</span><span class="sxs-lookup"><span data-stu-id="caee8-116">In this circumstance, when clients get an object from the pool, they have those resources immediately available.</span></span> <span data-ttu-id="caee8-117">Как правило, они будут использовать объект для выполнения некоторой небольшой работы, отправки или извлечения данных, а затем объект вызывает [**иобжектконтекст:: сеткомплете**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setcomplete) или [**Иобжектконтекст:: SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort) и возвращает.</span><span class="sxs-lookup"><span data-stu-id="caee8-117">Typically, they will use the object to do some small unit of work, pushing or pulling data, and then the object will call [**IObjectContext::SetComplete**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setcomplete) or [**IObjectContext::SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort) and return.</span></span> <span data-ttu-id="caee8-118">Благодаря быстрому использованию шаблонов, таких как это, пул дает отличное преимущество в производительности.</span><span class="sxs-lookup"><span data-stu-id="caee8-118">With rapid-fire use patterns such as this, pooling yields excellent performance benefits.</span></span> <span data-ttu-id="caee8-119">Можно полностью использовать простоту модели автоматического программирования транзакций без отслеживания состояния, тем самым обеспечивая производительность по номиналу с традиционными компонентами с отслеживанием состояния.</span><span class="sxs-lookup"><span data-stu-id="caee8-119">You can fully leverage the simplicity of the stateless automatic transaction programming model yet achieve performance on par with traditional stateful components.</span></span>

<span data-ttu-id="caee8-120">Однако если клиенты используют объект в течение длительного времени при каждом его вызове, группирование будет менее разумным.</span><span class="sxs-lookup"><span data-stu-id="caee8-120">However, if clients use an object for a long time each time they call it, pooling will make less sense.</span></span> <span data-ttu-id="caee8-121">Преимущество скорости, которое вы получаете, очень выгодно по мере увеличения времени использования относительно времени инициализации.</span><span class="sxs-lookup"><span data-stu-id="caee8-121">The speed advantage that you gain is marginal as use time increases relative to initialization time.</span></span> <span data-ttu-id="caee8-122">Вы получаете снижение количества возвратов, которые могут не выдерживать стоимость памяти, необходимой для хранения пула активных объектов.</span><span class="sxs-lookup"><span data-stu-id="caee8-122">You get diminishing returns that may not justify the cost of the memory necessary to hold a pool of active objects.</span></span>

## <a name="sharing-cost-across-multiple-clients"></a><span data-ttu-id="caee8-123">Обмен затратами между несколькими клиентами</span><span class="sxs-lookup"><span data-stu-id="caee8-123">Sharing Cost Across Multiple Clients</span></span>

<span data-ttu-id="caee8-124">Вариант инициализации при дефакторинге заключается в том, что вы можете использовать пулы для статистического снижения затрат на приобретение дорогостоящих ресурсов.</span><span class="sxs-lookup"><span data-stu-id="caee8-124">A variation on factoring out initialization is that you can use pooling to statistically amortize the cost of acquiring expensive resources.</span></span> <span data-ttu-id="caee8-125">Если вы принимаете на себя получение или инициализацию, а затем повторно используете объект, вы совместно используете эту стоимость для всех клиентов, использующих объект в течение своего времени существования.</span><span class="sxs-lookup"><span data-stu-id="caee8-125">If you take the hit of acquisition or initialization once and then reuse the object, you share that cost across all clients that use the object during its lifetime.</span></span> <span data-ttu-id="caee8-126">Интенсивное время создания накладывается только один раз для каждого объекта.</span><span class="sxs-lookup"><span data-stu-id="caee8-126">Heavy construction time is incurred only once per object.</span></span>

## <a name="preallocating-objects"></a><span data-ttu-id="caee8-127">Предварительное выделение объектов</span><span class="sxs-lookup"><span data-stu-id="caee8-127">Preallocating Objects</span></span>

<span data-ttu-id="caee8-128">При указании ненулевого минимального размера пула это минимальное количество объектов будет создано и помещено в пул при запуске приложения и будет готово для всех клиентов, которые вызывают приложение.</span><span class="sxs-lookup"><span data-stu-id="caee8-128">If you specify a nonzero minimum pool size, that minimum number of objects will be created and pooled when the application starts, ready for any clients that call in to the application.</span></span>

## <a name="governing-resource-use-with-pool-management"></a><span data-ttu-id="caee8-129">Управление использованием ресурсов с помощью управления пулом</span><span class="sxs-lookup"><span data-stu-id="caee8-129">Governing Resource Use with Pool Management</span></span>

<span data-ttu-id="caee8-130">Вы можете использовать максимальный размер пула, чтобы точно управлять использованием ресурсов.</span><span class="sxs-lookup"><span data-stu-id="caee8-130">You can use the maximum pool size to govern very precisely how you use resources.</span></span> <span data-ttu-id="caee8-131">Например, если лицензировано определенное число подключений к базе данных, можно управлять количеством открытых подключений в любое время.</span><span class="sxs-lookup"><span data-stu-id="caee8-131">For example, if you have licensed a certain number of database connections, you can control how many connections you have open at any time.</span></span>

<span data-ttu-id="caee8-132">Когда вы принимаете во внимание шаблоны использования клиентов, характеристики использования объектов и физические ресурсы, такие как память и подключения, при настройке производительности, скорее всего, найдется некоторая оптимальная точка баланса.</span><span class="sxs-lookup"><span data-stu-id="caee8-132">When you take into consideration client use patterns, object use characteristics, and physical resources such as memory and connections, you are likely to find some optimal balance point when you do performance tuning.</span></span> <span data-ttu-id="caee8-133">Группировка объектов в пул приведет к снижению количества возвратов после определенной точки.</span><span class="sxs-lookup"><span data-stu-id="caee8-133">Pooling objects will yield diminishing returns after a certain point.</span></span> <span data-ttu-id="caee8-134">Вы можете определить требуемый уровень производительности и сбалансировать его с ресурсами, необходимыми для его достижения.</span><span class="sxs-lookup"><span data-stu-id="caee8-134">You can determine what level of performance you require and balance that against what resources are necessary to achieve it.</span></span>

<span data-ttu-id="caee8-135">Чтобы упростить настройку производительности при настройке пула объектов, можно отслеживать статистику объектов для компонентов в приложении.</span><span class="sxs-lookup"><span data-stu-id="caee8-135">To facilitate performance tuning when you configure object pooling, you can monitor object statistics for the components in an application.</span></span> <span data-ttu-id="caee8-136">Дополнительные сведения см. в разделе [мониторинг статистики объектов](monitoring-object-statistics.md).</span><span class="sxs-lookup"><span data-stu-id="caee8-136">For details, see [Monitoring Object Statistics](monitoring-object-statistics.md).</span></span>

## <a name="improve-performance-of-jit-activated-components"></a><span data-ttu-id="caee8-137">Повышение производительности компонентов JIT-Activated</span><span class="sxs-lookup"><span data-stu-id="caee8-137">Improve Performance of JIT-Activated Components</span></span>

<span data-ttu-id="caee8-138">Пул объектов работает очень хорошо в службе [JIT-активации COM+](com--just-in-time-activation.md) .</span><span class="sxs-lookup"><span data-stu-id="caee8-138">Object pooling works very well with the [COM+ just-in-time activation](com--just-in-time-activation.md) service.</span></span> <span data-ttu-id="caee8-139">При помощи пулов объектов, активируемых JIT-компилятором, можно ускорить повторную активацию объектов.</span><span class="sxs-lookup"><span data-stu-id="caee8-139">By pooling objects that are being JIT-activated, you can speed object reactivation.</span></span> <span data-ttu-id="caee8-140">Вы получаете преимущества использования канала, открытого JIT-активацией, и снижая затраты на повторную активацию.</span><span class="sxs-lookup"><span data-stu-id="caee8-140">You get the benefits of holding the channel open by JIT activation while mitigating the cost of reactivation.</span></span> <span data-ttu-id="caee8-141">В этом случае можно использовать пулы, чтобы управлять объемом памяти, выделяемой для объектов, для которых активна ссылка.</span><span class="sxs-lookup"><span data-stu-id="caee8-141">You can use pooling in this case to govern how much memory you wish to allocate to objects that have references active.</span></span>

<span data-ttu-id="caee8-142">Скорее всего, вы сможете составить пул JIT-активируемых компонентов, если они являются транзакционными.</span><span class="sxs-lookup"><span data-stu-id="caee8-142">You are most likely to be pooling JIT-activated components when they are transactional.</span></span> <span data-ttu-id="caee8-143">Пул объектов оптимизирован для обработки транзакционных компонентов.</span><span class="sxs-lookup"><span data-stu-id="caee8-143">Object pooling is optimized to handle transactional components.</span></span> <span data-ttu-id="caee8-144">Дополнительные сведения см. в разделе [объединение транзакционных объектов в пул](pooling-transactional-objects.md).</span><span class="sxs-lookup"><span data-stu-id="caee8-144">For more information, see [Pooling Transactional Objects](pooling-transactional-objects.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="caee8-145">См. также</span><span class="sxs-lookup"><span data-stu-id="caee8-145">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="caee8-146">Строки конструктора объектов COM+</span><span class="sxs-lookup"><span data-stu-id="caee8-146">COM+ Object Constructor Strings</span></span>](com--object-constructor-strings.md)
</dt> <dt>

[<span data-ttu-id="caee8-147">Управление временем существования и состоянием объекта</span><span class="sxs-lookup"><span data-stu-id="caee8-147">Controlling Object Lifetime and State</span></span>](controlling-object-lifetime-and-state.md)
</dt> <dt>

[<span data-ttu-id="caee8-148">Как работает пул объектов</span><span class="sxs-lookup"><span data-stu-id="caee8-148">How Object Pooling Works</span></span>](how-object-pooling-works.md)
</dt> <dt>

[<span data-ttu-id="caee8-149">Группирование транзакционных объектов в пул</span><span class="sxs-lookup"><span data-stu-id="caee8-149">Pooling Transactional Objects</span></span>](pooling-transactional-objects.md)
</dt> <dt>

[<span data-ttu-id="caee8-150">Требования к объектам в пуле</span><span class="sxs-lookup"><span data-stu-id="caee8-150">Requirements for Poolable Objects</span></span>](requirements-for-poolable-objects.md)
</dt> </dl>

 

 



