---
description: Предложения по проектированию для разработки COM+ CRM
ms.assetid: dde1b978-6d35-4a75-91fd-69dfcc6c43d2
title: Предложения по проектированию для разработки COM+ CRM
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8dcdb59f0ea23fb6879300d0bacec7df12970d81
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104262623"
---
# <a name="design-suggestions-for-developing-a-com-crm"></a><span data-ttu-id="a8d78-103">Предложения по проектированию для разработки COM+ CRM</span><span class="sxs-lookup"><span data-stu-id="a8d78-103">Design Suggestions for Developing a COM+ CRM</span></span>

<span data-ttu-id="a8d78-104">Ниже приведены рекомендуемые шаги для разработки COM+ CRM.</span><span class="sxs-lookup"><span data-stu-id="a8d78-104">Following are suggested steps for developing a COM+ CRM:</span></span>

1.  <span data-ttu-id="a8d78-105">Перед началом разработки задайте для параметра время ожидания транзакции значение 0 (с помощью средства администрирования "службы компонентов").</span><span class="sxs-lookup"><span data-stu-id="a8d78-105">Before starting development, set the transaction time-out to zero (using the Component Services administrative tool).</span></span> <span data-ttu-id="a8d78-106">Установите флаг реестра VTRACE1 (см. [раздел Параметры реестра com+ CRM](com--crm-registry-settings.md)), чтобы просмотреть предупреждения и сообщения об ОШИБКАх CRM в отладочной трассировке.</span><span class="sxs-lookup"><span data-stu-id="a8d78-106">Set the VTRACE1 registry flag (see [COM+ CRM Registry Settings](com--crm-registry-settings.md)) to see CRM warning and error messages on the debug trace.</span></span>
2.  <span data-ttu-id="a8d78-107">Определите, какой набор интерфейсов необходимо использовать, структурированных (вариантов) или неструктурированных.</span><span class="sxs-lookup"><span data-stu-id="a8d78-107">Determine which set of interfaces you need to use, structured (Variants) or non-structured.</span></span> <span data-ttu-id="a8d78-108">(См. раздел [интерфейсы COM+ CRM](com--crm-interfaces.md).) Это будет зависеть от языка, используемого для разработки CRM, например Microsoft Visual C++ или Microsoft Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="a8d78-108">(See [COM+ CRM Interfaces](com--crm-interfaces.md).) This will depend on the language that you use to develop your CRM—for example, Microsoft Visual C++ or Microsoft Visual Basic.</span></span>
3.  <span data-ttu-id="a8d78-109">Сначала Разрабатывайте рабочую роль CRM.</span><span class="sxs-lookup"><span data-stu-id="a8d78-109">Develop the CRM worker first.</span></span> <span data-ttu-id="a8d78-110">Определите сведения, необходимые в записях журнала.</span><span class="sxs-lookup"><span data-stu-id="a8d78-110">Determine the information that is required in the log records.</span></span> <span data-ttu-id="a8d78-111">Определите требуемые типы записей журнала и их формат.</span><span class="sxs-lookup"><span data-stu-id="a8d78-111">Define the types of log records required and their format.</span></span>
4.  <span data-ttu-id="a8d78-112">Отладочный компенсатор CRM предоставляется в составе примеров CRM (в Windows SDK).</span><span class="sxs-lookup"><span data-stu-id="a8d78-112">A debug CRM compensator is provided as part of the CRM samples (in the Windows SDK).</span></span> <span data-ttu-id="a8d78-113">Это можно временно использовать при отладке работника CRM вместо реального компенсатора CRM.</span><span class="sxs-lookup"><span data-stu-id="a8d78-113">This can be used temporarily when debugging the CRM worker in place of the real CRM compensator.</span></span>
5.  <span data-ttu-id="a8d78-114">Когда Рабочая роль CRM работает правильно, разрабатывайте реальный компенсатор CRM и заменяйте Этот компенсатор в реальном CRM.</span><span class="sxs-lookup"><span data-stu-id="a8d78-114">When the CRM worker is working correctly, develop the real CRM compensator and replace the debug CRM compensator with the real CRM compensator.</span></span>
6.  <span data-ttu-id="a8d78-115">Может быть желательно, чтобы изначально не протестировать случай восстановления.</span><span class="sxs-lookup"><span data-stu-id="a8d78-115">It may be desirable to initially not test the recovery case.</span></span> <span data-ttu-id="a8d78-116">Если да, то перед запуском этого серверного приложения CRM удалите файл журнала CRM для серверного приложения CRM.</span><span class="sxs-lookup"><span data-stu-id="a8d78-116">If so, delete the CRM log file for the CRM server application each time before starting that CRM server application.</span></span>

## <a name="considerations"></a><span data-ttu-id="a8d78-117">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="a8d78-117">Considerations</span></span>

1.  <span data-ttu-id="a8d78-118">**Запишите заранее.**</span><span class="sxs-lookup"><span data-stu-id="a8d78-118">**Write ahead.**</span></span> <span data-ttu-id="a8d78-119">Рабочий компонент CRM должен записаться заранее; то есть он должен записать запись в журнал, указывающую, что будет выполнено действие до фактического выполнения этого действия.</span><span class="sxs-lookup"><span data-stu-id="a8d78-119">The CRM worker component must write ahead; that is, it must write a log record indicating it is going to perform an action before actually performing that action.</span></span> <span data-ttu-id="a8d78-120">Кроме того, эта запись журнала должна быть принудительно преобразована на диск после записи и до выполнения действия.</span><span class="sxs-lookup"><span data-stu-id="a8d78-120">In addition, this log record must be forced to disk after the write and before the action is performed.</span></span>
2.  <span data-ttu-id="a8d78-121">**Изоляция**.</span><span class="sxs-lookup"><span data-stu-id="a8d78-121">**Isolation.**</span></span> <span data-ttu-id="a8d78-122">CRM не применяет изоляцию.</span><span class="sxs-lookup"><span data-stu-id="a8d78-122">The CRM does not enforce isolation.</span></span> <span data-ttu-id="a8d78-123">Проект CRM должен обеспечивать изоляцию между несколькими клиентами в отдельных транзакциях, а также учитывать случай перед восстановлением.</span><span class="sxs-lookup"><span data-stu-id="a8d78-123">The CRM design must provide isolation between multiple clients on separate transactions and must also consider the case prior to recovery.</span></span>
3.  <span data-ttu-id="a8d78-124">**Выполняется восстановление.**</span><span class="sxs-lookup"><span data-stu-id="a8d78-124">**Recovery in progress.**</span></span> <span data-ttu-id="a8d78-125">Рабочая роль CRM должна работать с кодом ошибки "выполняется восстановление".</span><span class="sxs-lookup"><span data-stu-id="a8d78-125">The CRM worker must handle the "recovery in progress" error code.</span></span> <span data-ttu-id="a8d78-126">Дополнительные сведения об этом коде ошибки см. [в разделе Устранение неполадок com+ CRM](troubleshooting-the-com--crm.md) .</span><span class="sxs-lookup"><span data-stu-id="a8d78-126">See [Troubleshooting the COM+ CRM](troubleshooting-the-com--crm.md) for more information about this error code.</span></span>
4.  <span data-ttu-id="a8d78-127">**Обработка ошибок.**</span><span class="sxs-lookup"><span data-stu-id="a8d78-127">**Error handling.**</span></span> <span data-ttu-id="a8d78-128">Рабочая роль CRM должна справиться с тем, что транзакция была прервана раньше, чем ожидалось.</span><span class="sxs-lookup"><span data-stu-id="a8d78-128">The CRM worker must cope with the case where the transaction is aborted earlier than expected.</span></span> <span data-ttu-id="a8d78-129">См. раздел [Обработка ошибок в com+ CRM](error-handling-in-the-com--crm.md).</span><span class="sxs-lookup"><span data-stu-id="a8d78-129">See the section [Error Handling in the COM+ CRM](error-handling-in-the-com--crm.md).</span></span>
5.  <span data-ttu-id="a8d78-130">**Время восстановления.**</span><span class="sxs-lookup"><span data-stu-id="a8d78-130">**Recovery time.**</span></span> <span data-ttu-id="a8d78-131">Компенсатор CRM должен быть спроектирован для быстрого восстановления, чтобы не ждать, пока новая работа приложения сервера CRM не подерживается.</span><span class="sxs-lookup"><span data-stu-id="a8d78-131">The CRM compensator should be designed to perform recovery quickly so that new work for that CRM server application does not have to wait.</span></span>
6.  <span data-ttu-id="a8d78-132">**Идемпотентность.**</span><span class="sxs-lookup"><span data-stu-id="a8d78-132">**Idempotence.**</span></span> <span data-ttu-id="a8d78-133">Возможно, компенсатор CRM снова получит одну и ту же запись журнала, чтобы отменить или повторить действие, которое уже было отменено или отменено.</span><span class="sxs-lookup"><span data-stu-id="a8d78-133">It is possible that a CRM compensator might receive the same log record again, to undo or redo an action that has already been undone or redone.</span></span> <span data-ttu-id="a8d78-134">Действия, которые может выполнить компенсатор CRM, должны быть идемпотентными, что часто означает, что коды ошибок, возвращаемые этими действиями, следует игнорировать.</span><span class="sxs-lookup"><span data-stu-id="a8d78-134">Actions that the CRM compensator might perform must be idempotent, which often means that the error codes returned from these actions should be ignored.</span></span>
7.  <span data-ttu-id="a8d78-135">**Инициация восстановления.**</span><span class="sxs-lookup"><span data-stu-id="a8d78-135">**Initiation of recovery.**</span></span> <span data-ttu-id="a8d78-136">Восстановление серверного приложения CRM выполняется при запуске этого серверного приложения CRM.</span><span class="sxs-lookup"><span data-stu-id="a8d78-136">Recovery of a CRM server application is performed when that CRM server application starts up.</span></span> <span data-ttu-id="a8d78-137">Однако автоматический запуск серверного приложения CRM отсутствует.</span><span class="sxs-lookup"><span data-stu-id="a8d78-137">However, there is no automatic startup of a CRM server application.</span></span> <span data-ttu-id="a8d78-138">Разработчик приложения должен определить, как следует инициировать запуск и восстановление.</span><span class="sxs-lookup"><span data-stu-id="a8d78-138">The application developer should consider how both startup and recovery should be initiated.</span></span>

## <a name="related-topics"></a><span data-ttu-id="a8d78-139">См. также</span><span class="sxs-lookup"><span data-stu-id="a8d78-139">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a8d78-140">Основные понятия о компенсации диспетчер ресурсов COM+</span><span class="sxs-lookup"><span data-stu-id="a8d78-140">COM+ Compensating Resource Manager Concepts</span></span>](com--compensating-resource-manager-concepts.md)
</dt> </dl>

 

 



