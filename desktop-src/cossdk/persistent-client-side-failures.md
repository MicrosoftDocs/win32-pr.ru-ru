---
description: Постоянные сбои Client-Side
ms.assetid: f991db71-8319-414d-8a25-2d02bc7c8b51
title: Постоянные сбои Client-Side
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 25d303e712257d62e4ae42497cb4463e782cfbb8
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104423374"
---
# <a name="persistent-client-side-failures"></a><span data-ttu-id="9bb49-103">Постоянные сбои Client-Side</span><span class="sxs-lookup"><span data-stu-id="9bb49-103">Persistent Client-Side Failures</span></span>

<span data-ttu-id="9bb49-104">В некоторых случаях [очередь сообщений](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)) может переместить сообщение в очередь назначения.</span><span class="sxs-lookup"><span data-stu-id="9bb49-104">In some cases, [Message Queuing](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)) can move a message to the destination queue.</span></span> <span data-ttu-id="9bb49-105">Например, если элементы управления доступом к очереди не допускают перемещение сообщения с клиента на сервер, то сообщение, вызвавшее ошибку, перемещается в очередь недоставленных сообщений на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="9bb49-105">For example, if the queue access controls do not permit the message to be moved from client to server, the offending message is moved to the client-side dead letter queue.</span></span> <span data-ttu-id="9bb49-106">В этом случае служба очередей компонентов COM+ позволяет связать класс исключения с компонентом.</span><span class="sxs-lookup"><span data-stu-id="9bb49-106">When this occurs, the COM+ queued components service allows an exception class to be associated with a component.</span></span> <span data-ttu-id="9bb49-107">Чтобы связать класс исключений с компонентом, используйте вкладку **Дополнительно** на странице Свойства компонента средства администрирования служб компонентов.</span><span class="sxs-lookup"><span data-stu-id="9bb49-107">To associate the exception class with the component, use the **Advanced** tab in the component properties page of the Component Services administration tool.</span></span> <span data-ttu-id="9bb49-108">Кроме того, класс исключений можно связать программно с помощью атрибута компонента каталога Ексцептионкласс административных функций COM+.</span><span class="sxs-lookup"><span data-stu-id="9bb49-108">You can also associate the exception class programmatically, by using the ExceptionClass catalog component attribute of the COM+ Administrative functions.</span></span>

<span data-ttu-id="9bb49-109">Класс исключения определяется как ProgID или CLSID компонента, реализующего [**иплайбаккконтрол**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol).</span><span class="sxs-lookup"><span data-stu-id="9bb49-109">The exception class is defined as either the ProgID or the CLSID of a component implementing [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol).</span></span> <span data-ttu-id="9bb49-110">Служба очередей компонентов имеет монитор очереди недоставленных сообщений, который сканирует очередь недоставленных сообщений о транзакции.</span><span class="sxs-lookup"><span data-stu-id="9bb49-110">The queued components service has a dead letter queue monitor that scans the Xact dead letter queue.</span></span> <span data-ttu-id="9bb49-111">Если в очереди имеется сообщение, монитор очереди недоставленных сообщений создает экземпляр обработчика исключений, связанного с целевым компонентом, и вызывает [**иплайбаккконтрол:: финалклиентретри**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry), указывая на то, что произошла неустранимая ошибка на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="9bb49-111">If there is a message on the queue, the dead letter queue monitor instantiates the exception handler associated with the target component and calls [**IPlaybackControl::FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry), indicating that there has been a client-side, unrecoverable error.</span></span>

<span data-ttu-id="9bb49-112">Помимо [**иплайбаккконтрол**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol), обработчик исключений должен реализовать тот же набор интерфейсов, что и серверный компонент, для которого он обрабатывает исключения.</span><span class="sxs-lookup"><span data-stu-id="9bb49-112">In addition to [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol), the exception handler should implement the same set of interfaces as the server component for which it is handling exceptions.</span></span> <span data-ttu-id="9bb49-113">Когда вызывается [**иплайбаккконтрол:: финалклиентретри**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) , компонент очереди компонентов во время выполнения воспроизводит сообщение, вызвавшее ошибку, в обработчик исключений.</span><span class="sxs-lookup"><span data-stu-id="9bb49-113">When [**IPlaybackControl::FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) is called, the queued components run-time plays back the failing message to the exception handler.</span></span> <span data-ttu-id="9bb49-114">Это позволяет обработчику исключений реализовать альтернативное поведение для сообщений, которые не могут быть перемещены на сервер, например путем создания компенсирующих транзакций.</span><span class="sxs-lookup"><span data-stu-id="9bb49-114">This allows the exception handler to implement an alternative behavior for messages that cannot be moved to the server—for example, by generating a compensating transaction.</span></span>

<span data-ttu-id="9bb49-115">Если обработчик исключений завершает все вызовы метода, то сообщение удаляется из очереди недоставленных сообщений об активных сообщениях и закрывается.</span><span class="sxs-lookup"><span data-stu-id="9bb49-115">If the exception handler completes all the method calls played back, the message is removed from the Xact dead letter queue and is dismissed.</span></span> <span data-ttu-id="9bb49-116">Однако если обработчик исключений прерывает сообщение, возвращая состояние сбоя одного из вызовов метода, сообщение возвращается в очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="9bb49-116">If, however, the exception handler aborts the message by returning a failure status from one of the method calls, the message is returned to the Xact dead letter queue.</span></span> <span data-ttu-id="9bb49-117">Следующая последовательность событий показывает, как обрабатываются исключения на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="9bb49-117">The following sequence of events shows how client-side exceptions are handled:</span></span>

1.  <span data-ttu-id="9bb49-118">Службе очереди сообщений не удается доставить сообщение на сервер и помещает его в очередь недоставленных сообщений транзакций.</span><span class="sxs-lookup"><span data-stu-id="9bb49-118">Message Queuing fails to deliver a message to the server and puts the message onto the Xact dead letter queue.</span></span>
2.  <span data-ttu-id="9bb49-119">Прослушиватель очереди недоставленных сообщений (ДЛКЛ) находит сообщение в очереди недоставленных сообщений о транзакции.</span><span class="sxs-lookup"><span data-stu-id="9bb49-119">The dead letter queue listener (DLQL) finds a message on the Xact dead letter queue.</span></span>
3.  <span data-ttu-id="9bb49-120">ДЛКЛ извлекает CLSID целевого компонента из сообщения и проверяет наличие класса исключения.</span><span class="sxs-lookup"><span data-stu-id="9bb49-120">The DLQL retrieves the target component CLSID from the message and checks for an exception class.</span></span>
4.  <span data-ttu-id="9bb49-121">ДЛКЛ создает экземпляр класса Exception.</span><span class="sxs-lookup"><span data-stu-id="9bb49-121">The DLQL instantiates the exception class.</span></span>
5.  <span data-ttu-id="9bb49-122">ДЛКЛ запрашивает [**иплайбаккконтрол**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol) для класса Exception.</span><span class="sxs-lookup"><span data-stu-id="9bb49-122">The DLQL queries for [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol) for the exception class.</span></span>
6.  <span data-ttu-id="9bb49-123">ДЛКЛ вызывает метод [**иплайбаккконтрол:: финалклиентретри**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) в классе Exception.</span><span class="sxs-lookup"><span data-stu-id="9bb49-123">The DLQL calls the [**IPlaybackControl::FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) method in the exception class.</span></span>
7.  <span data-ttu-id="9bb49-124">ДЛКЛ воспроизводит все вызовы свойств и методов из сообщения в класс Exception.</span><span class="sxs-lookup"><span data-stu-id="9bb49-124">The DLQL plays back all property and method calls from the message to the exception class.</span></span>
8.  <span data-ttu-id="9bb49-125">ДЛКЛ удаляет сообщение, если обработчик исключений успешно завершает транзакцию.</span><span class="sxs-lookup"><span data-stu-id="9bb49-125">The DLQL deletes the message if the exception handler completes the transaction successfully.</span></span> <span data-ttu-id="9bb49-126">Обработчик исключений может выдавать [**иобжектконтекст:: SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort), и сообщение останется в очереди недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="9bb49-126">The exception handler may issue [**IObjectContext::SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort), and the message will remain on the dead letter queue.</span></span>

<span data-ttu-id="9bb49-127">Если какое-либо из предыдущих шагов завершится неудачей, сообщение будет оставлено в очереди недоставленных сообщений активной транзакции.</span><span class="sxs-lookup"><span data-stu-id="9bb49-127">If any of the preceding steps fail, the message is left on the Xact dead letter queue.</span></span>

<span data-ttu-id="9bb49-128">При запуске ДЛКЛ считывает каждое сообщение в очередь недоставленных транзактных сообщений и создает экземпляр класса исключений для каждого сообщения компонента, помещенного в очередь.</span><span class="sxs-lookup"><span data-stu-id="9bb49-128">When started, the DLQL reads each message on the Message Queuing transactional dead letter queue and instantiates the exception class for each queued components message.</span></span> <span data-ttu-id="9bb49-129">После прохождения через очередь он ожидает поступления новых сообщений.</span><span class="sxs-lookup"><span data-stu-id="9bb49-129">After one pass through the queue, it waits for new messages.</span></span> <span data-ttu-id="9bb49-130">Затем он обрабатывает каждое новое сообщение очереди недоставленных сообщений по мере поступления.</span><span class="sxs-lookup"><span data-stu-id="9bb49-130">It then processes each new dead letter queue message as it arrives.</span></span>

<span data-ttu-id="9bb49-131">Если вам нужно поработать с описанным здесь процессом или переместить опасное сообщение из конечной очереди RESTful, используйте программу перемещения сообщений.</span><span class="sxs-lookup"><span data-stu-id="9bb49-131">If you need to intervene in the process described here or if you need to move a poison message out of its final resting queue, use the message mover utility.</span></span> <span data-ttu-id="9bb49-132">Дополнительные сведения о программе перемещения сообщений см. в разделе [Обработка ошибок](handling-errors-in-queued-components.md).</span><span class="sxs-lookup"><span data-stu-id="9bb49-132">For more information on the message mover utility, see [Handling Errors](handling-errors-in-queued-components.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="9bb49-133">См. также</span><span class="sxs-lookup"><span data-stu-id="9bb49-133">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="9bb49-134">Ошибки на стороне клиента</span><span class="sxs-lookup"><span data-stu-id="9bb49-134">Client-Side Errors</span></span>](client-side-errors.md)
</dt> <dt>

[<span data-ttu-id="9bb49-135">Ошибки на стороне сервера</span><span class="sxs-lookup"><span data-stu-id="9bb49-135">Server-Side Errors</span></span>](server-side-errors.md)
</dt> </dl>

 

 



