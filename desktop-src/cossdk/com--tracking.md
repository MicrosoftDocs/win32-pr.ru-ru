---
description: Отслеживание COM+
ms.assetid: ad3bdeb5-f303-411a-abfb-ccde3f9a86b9
title: Отслеживание COM+
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 828cc87b5a24363fd814d37c29e61a3ce204d988
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104496050"
---
# <a name="com-tracking"></a><span data-ttu-id="a3923-103">Отслеживание COM+</span><span class="sxs-lookup"><span data-stu-id="a3923-103">COM+ Tracking</span></span>

<span data-ttu-id="a3923-104">Служба отслеживания COM+ позволяет создавать собственные программы администрирования и диагностики, которые отслеживают состояние и производительность выполняющихся приложений COM+.</span><span class="sxs-lookup"><span data-stu-id="a3923-104">The COM+ tracking service enables you to build your own administrative and diagnostic programs that track the status and performance of running COM+ applications.</span></span> <span data-ttu-id="a3923-105">Отслеживание COM+ предоставляет статистические сведения об использовании приложений COM+, а также сведения о состоянии, например о том, приостановлен ли экземпляр серверного приложения COM+ или он был перезапущен.</span><span class="sxs-lookup"><span data-stu-id="a3923-105">COM+ tracking provides statistical information about the use of COM+ applications as well as status information, such as whether a COM+ server application instance is paused or has been recycled.</span></span> <span data-ttu-id="a3923-106">Средства могут использовать данные отслеживания в диагностической диагностике или в целях показа.</span><span class="sxs-lookup"><span data-stu-id="a3923-106">Tools can use tracking information in diagnostic monitoring or for display purposes.</span></span> <span data-ttu-id="a3923-107">Например, средство администрирования "службы компонентов" использует отслеживание COM+ для просмотра состояния экземпляров приложений COM+ в приложениях COM+ и запуска процессов.</span><span class="sxs-lookup"><span data-stu-id="a3923-107">For example, the Component Services administrative tool uses COM+ tracking to display the status of COM+ application instances in the COM+ Applications and Running Processes folders.</span></span>

<span data-ttu-id="a3923-108">Отслеживание COM+ вычисляет и периодически обновляет набор часто используемых метрик, делая эту информацию доступной для программ, которым она необходима.</span><span class="sxs-lookup"><span data-stu-id="a3923-108">COM+ tracking calculates and periodically updates a set of commonly-used metrics, making this information available to programs that need it.</span></span> <span data-ttu-id="a3923-109">Он похож на инструментирование COM+ в том, что обе службы автоматически собираются данные из экземпляров приложений COM+ и делают эти данные доступными для потребителей.</span><span class="sxs-lookup"><span data-stu-id="a3923-109">It is similar to COM+ Instrumentation in that both services automatically collect data from COM+ application instances and make this data available to consumers.</span></span> <span data-ttu-id="a3923-110">Однако существует ряд важных различий между этими службами, как в предоставленной функциональности, так и в типичном использовании.</span><span class="sxs-lookup"><span data-stu-id="a3923-110">However, there are some important differences between these services, both in the functionality provided and typical usage.</span></span> <span data-ttu-id="a3923-111">Эти различия обобщены в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="a3923-111">The following table summarizes these differences.</span></span>



| <span data-ttu-id="a3923-112">Инструментарий COM+</span><span class="sxs-lookup"><span data-stu-id="a3923-112">COM+ Instrumentation</span></span>                                                                                                                                                                                                   | <span data-ttu-id="a3923-113">Отслеживание COM+</span><span class="sxs-lookup"><span data-stu-id="a3923-113">COM+ Tracking</span></span>                                                                                                                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="a3923-114">Детализированные данные.</span><span class="sxs-lookup"><span data-stu-id="a3923-114">Fine-grained data.</span></span> <span data-ttu-id="a3923-115">Служба инструментария COM+ уведомляет зарегистрированных подписчиков отдельных дискретных событий (например, вызванный метод, уничтоженный объект), происходящий в экземпляре приложения COM+.</span><span class="sxs-lookup"><span data-stu-id="a3923-115">The COM+ instrumentation service notifies registered subscribers of individual discrete events (for example, method called, object destroyed) that occur in a COM+ application instance.</span></span><br/> | <span data-ttu-id="a3923-116">Статистические данные.</span><span class="sxs-lookup"><span data-stu-id="a3923-116">Aggregated data.</span></span> <span data-ttu-id="a3923-117">Отслеживание COM+ вычисляет и периодически обновляет часто используемые метрики для состояния и производительности экземпляров приложений COM+.</span><span class="sxs-lookup"><span data-stu-id="a3923-117">COM+ tracking calculates and periodically updates commonly-used metrics for the status and performance of COM+ application instances.</span></span><br/> |
| <span data-ttu-id="a3923-118">Подписчики на события обычно рассчитывают метрики самостоятельно, используя специальные алгоритмы и политики.</span><span class="sxs-lookup"><span data-stu-id="a3923-118">Event subscribers typically calculate metrics on their own, using ad-hoc algorithms and policies.</span></span><br/>                                                                                                           | <span data-ttu-id="a3923-119">Метрики рассчитываются автоматически службой отслеживания COM+.</span><span class="sxs-lookup"><span data-stu-id="a3923-119">Metrics are calculated automatically by the COM+ tracking service.</span></span> <span data-ttu-id="a3923-120">Все потребители получают одни и те же данные, без поддержки пользовательских метрик.</span><span class="sxs-lookup"><span data-stu-id="a3923-120">All consumers get the same data, with no support for custom metrics.</span></span><br/>                |
| <span data-ttu-id="a3923-121">После регистрации подписки потребитель не получает никаких сведений об экземпляре приложения COM+, пока не произойдет событие.</span><span class="sxs-lookup"><span data-stu-id="a3923-121">After registering a subscription, the consumer does not receive any information about a COM+ application instance until an event occurs.</span></span><br/>                                                                    | <span data-ttu-id="a3923-122">Данные отслеживания для всех экземпляров приложений COM+ могут быть получены в любое время.</span><span class="sxs-lookup"><span data-stu-id="a3923-122">Tracking data for all COM+ application instances may be retrieved at any time.</span></span><br/>                                                                         |
| <span data-ttu-id="a3923-123">Поддерживает только механизм подписки на основе событий COM+ для потребителей.</span><span class="sxs-lookup"><span data-stu-id="a3923-123">Supports only a COM+ events-based subscription mechanism for consumers.</span></span><br/>                                                                                                                                     | <span data-ttu-id="a3923-124">Поддерживает как механизм подписки COM+ на основе событий, так и опрос в интерфейсе локального сервера COM.</span><span class="sxs-lookup"><span data-stu-id="a3923-124">Supports both a COM+ events-based subscription mechanism and polling on a COM local server interface.</span></span><br/>                                                  |
| <span data-ttu-id="a3923-125">Примеры</span><span class="sxs-lookup"><span data-stu-id="a3923-125">Examples</span></span>                                                                                                                                                                                                               |                                                                                                                                                                   |
| <span data-ttu-id="a3923-126">Уведомления при вызове или возврате метода.</span><span class="sxs-lookup"><span data-stu-id="a3923-126">Notifications when a method is called or returns.</span></span><br/>                                                                                                                                                           | <span data-ttu-id="a3923-127">Среднее время ответа вызова, количество вызовов методов, успешно выполненных или завершившихся сбоем за последний период времени, число объектов, находящихся в данный момент в вызове метода.</span><span class="sxs-lookup"><span data-stu-id="a3923-127">Average call response time, number of method calls that succeeded or failed in a recent time period, number of objects currently in a method call.</span></span><br/>     |
| <span data-ttu-id="a3923-128">Уведомления при добавлении объекта в пул объектов или получении из него.</span><span class="sxs-lookup"><span data-stu-id="a3923-128">Notifications when an object is added to or obtained from the object pool.</span></span><br/>                                                                                                                                  | <span data-ttu-id="a3923-129">Количество объектов в пуле, общее число объектов.</span><span class="sxs-lookup"><span data-stu-id="a3923-129">Number of objects in the pool, total number of objects.</span></span><br/>                                                                                                |
| <span data-ttu-id="a3923-130">Уведомления при запуске, приостановке или перезапуске серверного приложения COM+.</span><span class="sxs-lookup"><span data-stu-id="a3923-130">Notifications when a COM+ server application is started, paused, or recycled.</span></span><br/>                                                                                                                               | <span data-ttu-id="a3923-131">Состояние процесса серверного приложения COM+ (например, является ли он приостановленным или перезапущенным).</span><span class="sxs-lookup"><span data-stu-id="a3923-131">Status of the COM+ server application process (for example, whether it is paused or recycled).</span></span><br/>                                                         |
| <span data-ttu-id="a3923-132">Уведомления о событиях запуска, подготовки, прерывания и фиксации транзакций.</span><span class="sxs-lookup"><span data-stu-id="a3923-132">Notifications of transaction start, prepare, abort, and commit events.</span></span><br/>                                                                                                                                      | <span data-ttu-id="a3923-133">Эквивалент отсутствует.</span><span class="sxs-lookup"><span data-stu-id="a3923-133">No equivalent.</span></span><br/>                                                                                                                                         |
| <span data-ttu-id="a3923-134">Уведомления об успешных и неудачных попытках проверки подлинности на уровне вызовов методов.</span><span class="sxs-lookup"><span data-stu-id="a3923-134">Notifications of successful and failed method call level authentication attempts.</span></span><br/>                                                                                                                           | <span data-ttu-id="a3923-135">Эквивалент отсутствует.</span><span class="sxs-lookup"><span data-stu-id="a3923-135">No equivalent.</span></span><br/>                                                                                                                                         |



 

<span data-ttu-id="a3923-136">Хотя отслеживание COM+ более ограничено с точки зрения области данных и гибкости при вычислении метрик, предоставляемые им метрики должны быть достаточными для широкого спектра административных и диагностических программ.</span><span class="sxs-lookup"><span data-stu-id="a3923-136">Although COM+ tracking is more limited in terms of data scope and flexibility for calculating metrics, the metrics it provides should be sufficient for a wide variety of administrative and diagnostic programs.</span></span> <span data-ttu-id="a3923-137">Использование отслеживания COM+, по возможности, может упростить разработку этих программ.</span><span class="sxs-lookup"><span data-stu-id="a3923-137">Using COM+ tracking, when possible, can simplify the design of these programs.</span></span> <span data-ttu-id="a3923-138">Кроме того, использование отслеживания COM+ в рабочих системах может существенно снизить производительность, что делает ее более подходящей для средств мониторинга в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="a3923-138">Additionally, using COM+ tracking in production systems can have a significantly lower performance impact, making it more appropriate for real-time monitoring tools.</span></span>

## <a name="how-com-tracking-collects-data"></a><span data-ttu-id="a3923-139">Как отслеживание COM+ собирает данные</span><span class="sxs-lookup"><span data-stu-id="a3923-139">How COM+ Tracking Collects Data</span></span>

<span data-ttu-id="a3923-140">При запуске процесса серверного приложения COM+ COM+ регистрирует процесс на *сервере Tracker*, компоненте системного приложения.</span><span class="sxs-lookup"><span data-stu-id="a3923-140">When a COM+ server application process is started, COM+ registers the process with the *tracker server*, a component of the system application.</span></span> <span data-ttu-id="a3923-141">Компоненты в приложениях и службах библиотеки COM+, не поддерживающих контексты Components (SWC), также поддерживают отслеживание.</span><span class="sxs-lookup"><span data-stu-id="a3923-141">Components in COM+ library applications and services without components (SWC) contexts also support tracking.</span></span> <span data-ttu-id="a3923-142">Когда в процессе создается компонент библиотеки или контекст SWC, COM+ регистрирует процесс на сервере мониторинга, если он еще не был зарегистрирован.</span><span class="sxs-lookup"><span data-stu-id="a3923-142">When a library component or SWC context is created in a process, COM+ registers the process with the tracker server if it has not been registered already.</span></span>

<span data-ttu-id="a3923-143">COM+ обновляет статистику для отслеживающего процесса при возникновении определенных событий в процессе, например при создании объекта или завершении вызова метода.</span><span class="sxs-lookup"><span data-stu-id="a3923-143">COM+ updates statistics for a tracked process when certain events occur in the process, such as the creation of an object or the completion of a method call.</span></span> <span data-ttu-id="a3923-144">Обновленные данные периодически передаются на сервер Tracker, после чего они становятся доступными для потребителей.</span><span class="sxs-lookup"><span data-stu-id="a3923-144">Updated data is periodically submitted to the tracker server, at which point it becomes available to consumers.</span></span> <span data-ttu-id="a3923-145">Сервер отслеживания также отвечает за вычисление некоторых метрик, используемых функциями перезапуска приложений COM+ и мониторинга зависания.</span><span class="sxs-lookup"><span data-stu-id="a3923-145">The tracker server is also responsible for calculating some of the metrics used by the COM+ application recycling and hang monitoring features.</span></span> <span data-ttu-id="a3923-146">Эти данные также доступны для потребителей.</span><span class="sxs-lookup"><span data-stu-id="a3923-146">This data is also available to consumers.</span></span>

<span data-ttu-id="a3923-147">Данные отслеживания упорядочены в соответствии с процессом, создавшим данные.</span><span class="sxs-lookup"><span data-stu-id="a3923-147">Tracking data is organized according to the process that generated the data.</span></span> <span data-ttu-id="a3923-148">Данные на уровне отдельных приложений или компонентов COM+ в процессе также доступны для потребителей, которым требуются эти сведения.</span><span class="sxs-lookup"><span data-stu-id="a3923-148">Data at the level of individual COM+ applications or components in the process is also available for consumers that need this information.</span></span>

## <a name="events-versus-polling"></a><span data-ttu-id="a3923-149">События и опрос</span><span class="sxs-lookup"><span data-stu-id="a3923-149">Events versus Polling</span></span>

<span data-ttu-id="a3923-150">Отслеживание COM+ поддерживает два механизма для получения данных отслеживания от сервера отслеживания, механизма подписки COM+ на основе событий и интерфейса локального сервера COM.</span><span class="sxs-lookup"><span data-stu-id="a3923-150">COM+ tracking supports two mechanisms for a consumer to obtain tracking data from the tracker server, a COM+ events-based subscription mechanism and a COM local server interface.</span></span>

<span data-ttu-id="a3923-151">Программы, требующие периодического уведомления с обновленными данными отслеживания, могут зарегистрировать подписку для интерфейса событий [**икомтраккингинфоевентс**](/windows/desktop/api/ComSvcs/nn-comsvcs-icomtrackinginfoevents) .</span><span class="sxs-lookup"><span data-stu-id="a3923-151">Programs that need to be notified periodically with updated tracking data can register a subscription for the [**IComTrackingInfoEvents**](/windows/desktop/api/ComSvcs/nn-comsvcs-icomtrackinginfoevents) event interface.</span></span> <span data-ttu-id="a3923-152">Примерно каждые три секунды сервер отслеживания вызывает метод [**икомтраккингинфоевентс:: онневтраккингинфо**](/windows/desktop/api/ComSvcs/nf-comsvcs-icomtrackinginfoevents-onnewtrackinginfo) каждого подписчика, отправляя последние данные отслеживания в виде объекта коллекции.</span><span class="sxs-lookup"><span data-stu-id="a3923-152">Roughly every three seconds, the tracker server calls each subscriber's [**IComTrackingInfoEvents::OnNewTrackingInfo**](/windows/desktop/api/ComSvcs/nf-comsvcs-icomtrackinginfoevents-onnewtrackinginfo) method, sending the most recent tracking data in the form of a collection object.</span></span> <span data-ttu-id="a3923-153">Этот объект реализует интерфейс [**икомтраккингинфоколлектион**](/windows/desktop/api/ComSvcs/nn-comsvcs-icomtrackinginfocollection) , и подписчики могут перемещаться по этой коллекции для поиска интересующих вас данных.</span><span class="sxs-lookup"><span data-stu-id="a3923-153">This object implements the [**IComTrackingInfoCollection**](/windows/desktop/api/ComSvcs/nn-comsvcs-icomtrackinginfocollection) interface, and subscribers can navigate this collection to find the data they are interested in.</span></span>

<span data-ttu-id="a3923-154">По различным причинам может быть целесообразно, чтобы программа обратилась к серверу отслеживания для получения данных.</span><span class="sxs-lookup"><span data-stu-id="a3923-154">For various reasons, it might make more sense for a program to poll tracker server for data.</span></span> <span data-ttu-id="a3923-155">Например, средство мониторинга может потребовать обновления гораздо реже, чем программа, отображающая состояние в пользовательском интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="a3923-155">For example, a monitoring tool may need updates much less frequently than a program that displays status in a user interface.</span></span> <span data-ttu-id="a3923-156">Кроме того, программа может использовать только небольшую часть данных отслеживания, доступных для системы (например, средство может отслеживать только производительность экземпляров одного приложения COM+).</span><span class="sxs-lookup"><span data-stu-id="a3923-156">Also, a program may use only a small portion of the tracking data available for the system (for example, a tool might only monitor the performance of instances of a single COM+ application).</span></span> <span data-ttu-id="a3923-157">Модель подписки отправляет каждому подписчику данные отслеживания для всех приложений COM+ в каждом уведомлении, и ответственность за поиск нужных данных отвечает подписчику.</span><span class="sxs-lookup"><span data-stu-id="a3923-157">The subscription model sends each subscriber the tracking data for all COM+ applications in each notification, and it is the responsibility of the subscriber to find the data it wants.</span></span> <span data-ttu-id="a3923-158">Наконец, события COM+ — это оптимальный механизм уведомления о событиях.</span><span class="sxs-lookup"><span data-stu-id="a3923-158">Finally, COM+ events is a best-effort event notification mechanism.</span></span> <span data-ttu-id="a3923-159">Надежные службы доставки сообщений не предоставляются, и подписчику не удается обнаружить, что серверу-Tracker не удалось отправить ему уведомление.</span><span class="sxs-lookup"><span data-stu-id="a3923-159">Reliable message delivery services are not provided, and there is no way for a subscriber to detect that the tracker server failed to send it a notification.</span></span>

<span data-ttu-id="a3923-160">Программа, которой требуется больший контроль над получением данных отслеживания, может использовать интерфейс [**ижетапптраккердата**](/windows/desktop/api/ComSvcs/nn-comsvcs-igetapptrackerdata) сервера отслеживания.</span><span class="sxs-lookup"><span data-stu-id="a3923-160">A program that needs greater control over its retrieval of tracking data can use the [**IGetAppTrackerData**](/windows/desktop/api/ComSvcs/nn-comsvcs-igetapptrackerdata) interface of the tracker server.</span></span>

 

 




