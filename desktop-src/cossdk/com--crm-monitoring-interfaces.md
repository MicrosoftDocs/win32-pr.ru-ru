---
description: Инфраструктура CRM предоставляет набор интерфейсов, которые можно использовать для мониторинга Крмс в определенном серверном приложении.
ms.assetid: b8f40c91-001b-4003-b377-57a918988100
title: Интерфейсы мониторинга COM+ CRM
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c893040c46810c980c647cbacdc808200e8d5f5e
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104262572"
---
# <a name="com-crm-monitoring-interfaces"></a><span data-ttu-id="96046-103">Интерфейсы мониторинга COM+ CRM</span><span class="sxs-lookup"><span data-stu-id="96046-103">COM+ CRM Monitoring Interfaces</span></span>

<span data-ttu-id="96046-104">Инфраструктура CRM предоставляет набор интерфейсов, которые можно использовать для мониторинга Крмс в определенном серверном приложении.</span><span class="sxs-lookup"><span data-stu-id="96046-104">The CRM infrastructure provides a set of interfaces that can be used for monitoring the CRMs within a particular server application.</span></span> <span data-ttu-id="96046-105">Для доступа к интерфейсам мониторинга компонент, работающий в серверном приложении, должен сначала создать специализированный клерк CRM под названием «клерк восстановления CRM».</span><span class="sxs-lookup"><span data-stu-id="96046-105">To access the monitoring interfaces, a component running within the server application must first create a specialized CRM clerk called the CRM recovery clerk.</span></span>

<span data-ttu-id="96046-106">При обычном использовании Крмс ожидается кратковременное использование транзакций, и, следовательно, работники CRM и компенсаторы CRM существуют в течение короткого периода времени, обычно всего несколько секунд.</span><span class="sxs-lookup"><span data-stu-id="96046-106">In normal use of CRMs, transactions are expected to be short-lived, and hence CRM Workers and CRM Compensators exist for a brief period of time, typically only a few seconds at most.</span></span> <span data-ttu-id="96046-107">Таким образом, интерфейсы мониторинга предназначены для создания моментального снимка состояния выполнения Крмс в определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="96046-107">The monitoring interfaces are therefore designed to give a snapshot of the state of the executing CRMs at a particular point in time.</span></span> <span data-ttu-id="96046-108">Если в какой бы то ни было из Крмс возникли проблемы, интерфейсы мониторинга можно использовать для того, чтобы обменяться в системе с неисправностью CRM, проверять записи журнала и прерывать ее транзакцию, если это необходимо.</span><span class="sxs-lookup"><span data-stu-id="96046-108">If any of the CRMs are having problems, the monitoring interfaces can be used to zero in on the troublesome CRM, to inspect its log records and to abort its transaction if required.</span></span>

<span data-ttu-id="96046-109">Ниже приведены три интерфейса мониторинга CRM и описания их работы.</span><span class="sxs-lookup"><span data-stu-id="96046-109">Following are the three CRM monitoring interfaces and descriptions of how they work.</span></span>



| <span data-ttu-id="96046-110">Интерфейс</span><span class="sxs-lookup"><span data-stu-id="96046-110">Interface</span></span>                                                         | <span data-ttu-id="96046-111">Описание</span><span class="sxs-lookup"><span data-stu-id="96046-111">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="96046-112">**икрммонитор**</span><span class="sxs-lookup"><span data-stu-id="96046-112">**ICrmMonitor**</span></span>](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmmonitor)<br/>                     | <span data-ttu-id="96046-113">С помощью [**икрммонитор::-клерков**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmmonitor-getclerks)можно получить моментальный снимок из текущего набора активных клерков CRM в серверном приложении.</span><span class="sxs-lookup"><span data-stu-id="96046-113">Using [**ICrmMonitor::GetClerks**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmmonitor-getclerks), a snapshot can be obtained of the current set of active CRM clerks within the server application.</span></span> <span data-ttu-id="96046-114">В этом случае можно найти конкретный интересующий вас объект коллекции CRM, включая текущее состояние транзакции и записи журнала, записанные в CRM.</span><span class="sxs-lookup"><span data-stu-id="96046-114">From this, a particular CRM clerk collection object of interest can be located and queried, including the current state of its transaction and the log records written by the CRM.</span></span><br/> <span data-ttu-id="96046-115">Когда средство мониторинга определило, какой клерк является интересным, он вызывает [**икрммонитор:: холдклерк**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmmonitor-holdclerk) , чтобы получить интерфейс [**икрммониторлогрекордс**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmmonitorlogrecords) на этом конкретном Клерке.</span><span class="sxs-lookup"><span data-stu-id="96046-115">When the monitoring tool has determined which clerk is of interest, it calls [**ICrmMonitor::HoldClerk**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmmonitor-holdclerk) to get an [**ICrmMonitorLogRecords**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmmonitorlogrecords) interface on that particular clerk.</span></span> <span data-ttu-id="96046-116">На этом этапе средство мониторинга хранит ссылку на этот Клерк, и, если транзакция завершается, клерк удерживается в памяти и не освобождается до тех пор, пока не будет сделано средство мониторинга.</span><span class="sxs-lookup"><span data-stu-id="96046-116">At this point, the monitoring tool is holding a reference to that clerk, and if the transaction completes, the clerk is held in memory and is not released until the monitoring tool is done.</span></span><br/>                                                                                                                                                                                                    |
| [<span data-ttu-id="96046-117">**икрммониторклеркс**</span><span class="sxs-lookup"><span data-stu-id="96046-117">**ICrmMonitorClerks**</span></span>](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmmonitorclerks)<br/>         | <span data-ttu-id="96046-118">С помощью этого интерфейса можно просмотреть объект коллекции клерков, чтобы получить сведения о состоянии коллекции клерков в момент получения.</span><span class="sxs-lookup"><span data-stu-id="96046-118">Using this interface, the clerk collection object can be browsed for information about the state of the clerk collection at the moment it was obtained.</span></span> <span data-ttu-id="96046-119">Эти сведения включают число клерков, идентификатор ProgID компенсатора CRM, используемый клерком, описание, предоставленное во время регистрации компенсатора CRM (с помощью [**икрмлогконтрол:: регистеркомпенсатор**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmlogcontrol-registercompensator)), идентификатор транзакции и идентификатор действия.</span><span class="sxs-lookup"><span data-stu-id="96046-119">This information includes the number of clerks, the ProgID of the CRM Compensator used by the clerk, the description provided at the time the CRM Compensator was registered (using [**ICrmLogControl::RegisterCompensator**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmlogcontrol-registercompensator)), the transaction unit-of-work ID, and the activity ID.</span></span> <span data-ttu-id="96046-120">Отдельные клерки также уникально идентифицируются с помощью идентификатора CLSID экземпляра клерка, который не является CLSID COM в обычном смысле термина, но является уникальным идентификатором GUID, идентифицирующим этот конкретный Клерк на время его существования.</span><span class="sxs-lookup"><span data-stu-id="96046-120">Individual clerks are also uniquely identified by a "clerk instance CLSID," which is not a COM CLSID in the usual sense of the term but simply a unique GUID that identifies this particular clerk for its lifetime.</span></span><br/>                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="96046-121">**икрммониторлогрекордс**</span><span class="sxs-lookup"><span data-stu-id="96046-121">**ICrmMonitorLogRecords**</span></span>](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmmonitorlogrecords)<br/> | <span data-ttu-id="96046-122">Этот интерфейс может использоваться для запроса текущего состояния транзакции, для определения количества записей журнала, записанных этим клерком CRM, и для получения фактических данных записи журнала.</span><span class="sxs-lookup"><span data-stu-id="96046-122">This interface can be used to query the current state of the transaction, to find out how many log records this CRM clerk has written, and to get the actual log record data.</span></span> <span data-ttu-id="96046-123">Записи журнала предоставляются из интерфейса [**икрммониторлогрекордс**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmmonitorlogrecords) в том же формате, в котором они были первоначально записаны (с помощью [**икрмлогконтрол**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol)).</span><span class="sxs-lookup"><span data-stu-id="96046-123">The log records are provided from the [**ICrmMonitorLogRecords**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmmonitorlogrecords) interface in the same format that they were originally written (using [**ICrmLogControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol)).</span></span> <span data-ttu-id="96046-124">Кроме того, **икрммониторлогрекордс** можно дополнительно реализовать для преобразования записей журнала в просматриваемый формат, чтобы их можно было представить с помощью универсального средства мониторинга.</span><span class="sxs-lookup"><span data-stu-id="96046-124">In addition, **ICrmMonitorLogRecords** can be optionally implemented to convert the log records to viewable format so they can be presented using a generic monitoring tool.</span></span><br/> <span data-ttu-id="96046-125">Так как [**икрммониторлогрекордс**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmmonitorlogrecords) реализована непосредственно в Клерке CRM, вы можете выпустить [**QueryInterface**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) для [**икрмлогконтрол**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol) (также реализованного в Клерке CRM).</span><span class="sxs-lookup"><span data-stu-id="96046-125">Because [**ICrmMonitorLogRecords**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmmonitorlogrecords) is implemented directly on the CRM clerk, you can [**QueryInterface**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) for [**ICrmLogControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol) (also implemented on the CRM clerk).</span></span> <span data-ttu-id="96046-126">Затем можно использовать, чтобы напрямую прервать транзакцию ([**икрмлогконтрол:: форцетрансактионтоаборт**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmlogcontrol-forcetransactiontoabort)).</span><span class="sxs-lookup"><span data-stu-id="96046-126">This can then be used to directly abort the transaction if required ([**ICrmLogControl::ForceTransactionToAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmlogcontrol-forcetransactiontoabort)).</span></span><br/> |



 

## <a name="related-topics"></a><span data-ttu-id="96046-127">См. также</span><span class="sxs-lookup"><span data-stu-id="96046-127">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="96046-128">Основные понятия о компенсации диспетчер ресурсов COM+</span><span class="sxs-lookup"><span data-stu-id="96046-128">COM+ Compensating Resource Manager Concepts</span></span>](com--compensating-resource-manager-concepts.md)
</dt> </dl>

 

