---
description: Объекты, которые могут быть объединены в пул, должны отвечать определенным требованиям, чтобы обеспечить использование одного экземпляра объекта несколькими клиентами.
ms.assetid: 2cd4211e-be12-4197-8b43-5cb9f2321016
title: Требования к объектам в пуле
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78d6834210f180ad8b514b51b6926b5cd30714fd
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103990541"
---
# <a name="requirements-for-poolable-objects"></a><span data-ttu-id="45034-103">Требования к объектам в пуле</span><span class="sxs-lookup"><span data-stu-id="45034-103">Requirements for Poolable Objects</span></span>

<span data-ttu-id="45034-104">Объекты, которые могут быть объединены в пул, должны отвечать определенным требованиям, чтобы обеспечить использование одного экземпляра объекта несколькими клиентами.</span><span class="sxs-lookup"><span data-stu-id="45034-104">Poolable objects must meet certain requirements to enable a single object instance to be used by multiple clients.</span></span>

## <a name="stateless"></a><span data-ttu-id="45034-105">Без отслеживания состояния</span><span class="sxs-lookup"><span data-stu-id="45034-105">Stateless</span></span>

<span data-ttu-id="45034-106">Для обеспечения безопасности, согласованности и изоляции объекты, которые могут быть помещены в пул, не должны содержать клиентское состояние от клиента к клиенту.</span><span class="sxs-lookup"><span data-stu-id="45034-106">To maintain security, consistency, and isolation, poolable objects should hold no client-specific state from client to client.</span></span> <span data-ttu-id="45034-107">Вы можете управлять любым состоянием каждого клиента с помощью [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol), выполняя инициализацию, зависящую от контекста, с помощью [**IObjectControl:: Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) и очищаются все состояния клиентов с [**IObjectControl::D еактивате**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate).</span><span class="sxs-lookup"><span data-stu-id="45034-107">You can manage any per-client state by using [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol), performing context-specific initialization with [**IObjectControl::Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) and cleaning up any client state with [**IObjectControl::Deactivate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate).</span></span> <span data-ttu-id="45034-108">Дополнительные сведения см. в разделе [Управление временем существования и состоянием объекта](controlling-object-lifetime-and-state.md).</span><span class="sxs-lookup"><span data-stu-id="45034-108">For more detail, see [Controlling Object Lifetime and State](controlling-object-lifetime-and-state.md).</span></span>

## <a name="no-thread-affinity"></a><span data-ttu-id="45034-109">Без сходства потоков</span><span class="sxs-lookup"><span data-stu-id="45034-109">No Thread Affinity</span></span>

<span data-ttu-id="45034-110">Объекты, являющиеся пулами, не могут быть привязаны к определенному потоку; в противном случае производительность может быть катастрофой.</span><span class="sxs-lookup"><span data-stu-id="45034-110">Poolable objects cannot be bound to a particular thread; otherwise, performance could be potentially disastrous.</span></span> <span data-ttu-id="45034-111">По этой причине объекты, которые могут быть помещены в пул, нельзя помечать для выполнения в модели апартамента. они должны выполняться в многопоточном апартаменте или в нейтральном апартаменте.</span><span class="sxs-lookup"><span data-stu-id="45034-111">For this reason, poolable objects cannot be marked to run in the apartment model; they must run in the multithreaded apartment or the neutral apartment.</span></span> <span data-ttu-id="45034-112">Кроме того, объекты, поддерживающие использование пула, не должны использовать локальное хранилище потока, а также не должны выполнять статистическое вычисление в свободном потоке.</span><span class="sxs-lookup"><span data-stu-id="45034-112">In addition, poolable objects should not use thread local storage nor should they aggregate the free-threaded marshaler.</span></span> <span data-ttu-id="45034-113">Дополнительные сведения о потоках в COM+ см. в разделе [модели потоков com+](com--threading-models.md).</span><span class="sxs-lookup"><span data-stu-id="45034-113">For more detail about threading in COM+, see [COM+ Threading Models](com--threading-models.md).</span></span>

> [!Note]  
> <span data-ttu-id="45034-114">Среда разработки Microsoft Visual Basic 6,0 и более ранних версий может создавать только компоненты модели подразделения.</span><span class="sxs-lookup"><span data-stu-id="45034-114">The Microsoft Visual Basic 6.0 and earlier development environments can create only apartment model components.</span></span> <span data-ttu-id="45034-115">Однако в Visual Basic .NET компоненты могут быть помещены в пул.</span><span class="sxs-lookup"><span data-stu-id="45034-115">However, in Visual Basic .NET, components can be pooled.</span></span>

 

## <a name="aggregatable"></a><span data-ttu-id="45034-116">Aggregatable</span><span class="sxs-lookup"><span data-stu-id="45034-116">Aggregatable</span></span>

<span data-ttu-id="45034-117">Объекты, которые могут быть объединены в пул, должны поддерживать агрегирование, то есть они должны поддерживать создание путем вызова [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) с аргументом *пункаутер* , отличным от NULL.</span><span class="sxs-lookup"><span data-stu-id="45034-117">Poolable objects must support aggregation—that is, they must support being created by invoking [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) with a non-NULL *pUnkOuter* argument.</span></span> <span data-ttu-id="45034-118">Когда COM+ активирует объект poold, он создает статистическое выражение для управления временем существования объекта poold и для вызова методов в [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol).</span><span class="sxs-lookup"><span data-stu-id="45034-118">When COM+ activates a pooled object, it creates an aggregate to manage the lifetime of the pooled object and to call methods on [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol).</span></span> <span data-ttu-id="45034-119">Дополнительные сведения о создании статистически обрабатываемых объектов см. в разделе [агрегирование](/windows/desktop/com/aggregation).</span><span class="sxs-lookup"><span data-stu-id="45034-119">For details on writing aggregatable objects, see [Aggregation](/windows/desktop/com/aggregation).</span></span>

## <a name="transactional-components"></a><span data-ttu-id="45034-120">Транзакционные компоненты</span><span class="sxs-lookup"><span data-stu-id="45034-120">Transactional Components</span></span>

<span data-ttu-id="45034-121">Объекты в пуле, участвующие в транзакциях, должны прикреплять управляемые ресурсы вручную.</span><span class="sxs-lookup"><span data-stu-id="45034-121">Poolable objects that participate in transactions must manually enlist managed resources.</span></span> <span data-ttu-id="45034-122">Если объект содержит управляемый ресурс, например подключение к базе данных, в пуле, то при активации объекта в заданном контексте диспетчер ресурсов не будет автоматически прикрепляться к транзакции.</span><span class="sxs-lookup"><span data-stu-id="45034-122">While it is pooled, if your object holds a managed resource such as a database connection, there will be no way for the resource manager to automatically enlist in a transaction when the object is activated in given context.</span></span> <span data-ttu-id="45034-123">Таким образом, сам объект должен управлять логикой обнаружения транзакции, отключив автоматическое прикрепление Resource Manager и вручную прикреплять все удерживаемые ресурсы.</span><span class="sxs-lookup"><span data-stu-id="45034-123">Therefore, the object itself must handle the logic of detecting the transaction, turning off the resource manager's auto-enlistment and manually enlisting any resources that it holds.</span></span> <span data-ttu-id="45034-124">Кроме того, объект в составе пула транзакций должен отражать текущее состояние его ресурсов в значениях параметров [**IObjectControl:: канбепулед**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled).</span><span class="sxs-lookup"><span data-stu-id="45034-124">In addition, a transactional pooled object should reflect the current state of its resources in the parameter values of [**IObjectControl::CanBePooled**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled).</span></span> <span data-ttu-id="45034-125">Дополнительные сведения см. в разделе [объединение транзакционных объектов в пул](pooling-transactional-objects.md).</span><span class="sxs-lookup"><span data-stu-id="45034-125">For more detail, see [Pooling Transactional Objects](pooling-transactional-objects.md).</span></span>

## <a name="implement-iobjectcontrol-to-manage-the-object-lifetime"></a><span data-ttu-id="45034-126">Реализация IObjectControl для управления временем жизни объекта</span><span class="sxs-lookup"><span data-stu-id="45034-126">Implement IObjectControl to Manage the Object Lifetime</span></span>

<span data-ttu-id="45034-127">Объекты в пуле должны реализовывать [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol), хотя это не является строго необходимым.</span><span class="sxs-lookup"><span data-stu-id="45034-127">Poolable objects should implement [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol), although it is not strictly necessary to do so.</span></span> <span data-ttu-id="45034-128">Однако транзакционные компоненты, которые входят в состав пула, должны реализовывать **IObjectControl**.</span><span class="sxs-lookup"><span data-stu-id="45034-128">Transactional components that are pooled, however, must implement **IObjectControl**.</span></span> <span data-ttu-id="45034-129">Эти компоненты должны отслеживать состояние ресурсов, которые они хранят, и указывать, когда их нельзя использовать повторно; Когда [**IObjectControl:: канбепулед**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled) возвращает значение false, он повреждение транзакцию.</span><span class="sxs-lookup"><span data-stu-id="45034-129">These components should monitor the state of the resources they hold and indicate when they can't be reused; when [**IObjectControl::CanBePooled**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled) returns false, it will doom a transaction.</span></span> <span data-ttu-id="45034-130">Дополнительные сведения см. в разделе [Управление временем существования и состоянием объекта](controlling-object-lifetime-and-state.md).</span><span class="sxs-lookup"><span data-stu-id="45034-130">For more detail, see [Controlling Object Lifetime and State](controlling-object-lifetime-and-state.md).</span></span>

## <a name="language-restrictions"></a><span data-ttu-id="45034-131">Ограничения языка</span><span class="sxs-lookup"><span data-stu-id="45034-131">Language Restrictions</span></span>

<span data-ttu-id="45034-132">Компоненты, разработанные с помощью Microsoft Visual Basic 6,0 и более ранних версий, не могут быть помещены в пул, поскольку эти компоненты будут потоковой моделью потоков.</span><span class="sxs-lookup"><span data-stu-id="45034-132">Components developed using Microsoft Visual Basic 6.0 and earlier cannot be pooled because these components will be apartment-model threaded.</span></span> <span data-ttu-id="45034-133">Однако в Visual Basic .NET компоненты могут быть помещены в пул.</span><span class="sxs-lookup"><span data-stu-id="45034-133">However, in Visual Basic .NET, components can be pooled.</span></span>

## <a name="legacy-components"></a><span data-ttu-id="45034-134">Устаревшие компоненты</span><span class="sxs-lookup"><span data-stu-id="45034-134">Legacy Components</span></span>

<span data-ttu-id="45034-135">Если они не являются транзакционными и соответствуют соответствующим предыдущим требованиям, компоненты могут быть помещены в пул, даже если они не были специально написаны с учетом возможности объединения в пул.</span><span class="sxs-lookup"><span data-stu-id="45034-135">As long as they are non-transactional and conform to the appropriate preceding requirements, components can be pooled even if they were not specifically written with pooling capability in mind.</span></span> <span data-ttu-id="45034-136">Нет необходимости реализовывать [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol); компонент, который не делает этого, просто не будет участвовать в управлении временем существования.</span><span class="sxs-lookup"><span data-stu-id="45034-136">It is not necessary to implement [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol); a component that does not do so simply won't participate in managing its lifetime.</span></span> <span data-ttu-id="45034-137">Если [**IObjectControl:: канбепулед**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled) не реализован, объект будет по-прежнему использоваться повторно, пока пул не достиг максимального размера.</span><span class="sxs-lookup"><span data-stu-id="45034-137">If [**IObjectControl::CanBePooled**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled) is not implemented, the object will continue to be reused until the pool attains maximum size.</span></span>

## <a name="related-topics"></a><span data-ttu-id="45034-138">См. также</span><span class="sxs-lookup"><span data-stu-id="45034-138">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="45034-139">Строки конструктора объектов COM+</span><span class="sxs-lookup"><span data-stu-id="45034-139">COM+ Object Constructor Strings</span></span>](com--object-constructor-strings.md)
</dt> <dt>

[<span data-ttu-id="45034-140">Управление временем существования и состоянием объекта</span><span class="sxs-lookup"><span data-stu-id="45034-140">Controlling Object Lifetime and State</span></span>](controlling-object-lifetime-and-state.md)
</dt> <dt>

[<span data-ttu-id="45034-141">Как работает пул объектов</span><span class="sxs-lookup"><span data-stu-id="45034-141">How Object Pooling Works</span></span>](how-object-pooling-works.md)
</dt> <dt>

[<span data-ttu-id="45034-142">Повышение производительности с помощью пула объектов</span><span class="sxs-lookup"><span data-stu-id="45034-142">Improving Performance with Object Pooling</span></span>](improving-performance-with-object-pooling.md)
</dt> <dt>

[<span data-ttu-id="45034-143">Группирование транзакционных объектов в пул</span><span class="sxs-lookup"><span data-stu-id="45034-143">Pooling Transactional Objects</span></span>](pooling-transactional-objects.md)
</dt> </dl>

 

 
