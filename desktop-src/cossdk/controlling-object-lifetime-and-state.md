---
description: Управление временем существования и состоянием объекта
ms.assetid: 172e07a2-1711-4353-9099-ff9d31a564c6
title: Управление временем существования и состоянием объекта
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 525cc1d582d85bc84ef2b1749a427711d1fe26fc
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105701239"
---
# <a name="controlling-object-lifetime-and-state"></a>Управление временем существования и состоянием объекта

Объект poold может принимать участие в том, как COM+ управляет своими действиями в пуле, реализуя [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol). При создании объекта в составе пула он объединяется в более крупный объект, который будет управлять этим объектом, вызывая следующие методы в **IObjectControl** в обычных точках жизненного цикла объекта:

-   [**Активация**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate)— вызывается при каждом возврате объекта клиенту, активированном в определенном контексте.
-   [**Деактивация —**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate)вызывается всякий раз, когда объект освобождается клиентом, или, в случае JIT-активируемого объекта, при деактивации.
-   [**Канбепулед**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled)— вызывается каждый раз, когда объект возвращается в общий пул.

Реализация [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol) является необязательной, за исключением объектов транзакций, которые всегда должны реализовывать [**канбепулед**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled) для отслеживания состояния ресурсов, которые они хранят. Однако рекомендуется реализовать **IObjectControl** в большинстве случаев, поскольку он обеспечивает эффективный способ управления поведением объекта в составе пула, как описано ниже.

## <a name="performing-context-specific-initialization"></a>Выполнение инициализации Context-Specific

С помощью функции [**Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate)можно инициализировать объект в контексте, в котором он активирован для данного клиента. Например, чтобы определить, имеет ли объект сходство транзакций (его ресурсы могут быть уже прикреплены), вы можете получить идентификатор транзакции, связанный с контекстом.

Обычно для выполнения инициализации, которая согласована в любых методах, предоставляемых объектом, как правило, используется команда [**Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate), которая рассматривается как часть конструктора объекта, относящаяся к контексту.

## <a name="cleaning-up-any-client-state"></a>Очистка любого состояния клиента

С помощью функции [**деактивации**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate)можно избавиться от любого клиентского состояния, которое может существовать, чтобы объект возвращался в пул в полностью общем состоянии и затем использоваться любым клиентом без ущерба для безопасности или изоляции.

## <a name="controlling-reuse-of-the-object"></a>Управление повторной использованием объекта

С помощью [**канбепулед**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled)можно отслеживать внутреннее состояние объекта и сообщать о его порасположении для повторного использования. Если **канбепулед** возвращает значение true, а максимальное значение пула не достигнуто, объект помещается обратно в общий пул. Если **канбепулед** возвращает значение false, объект отбрасывается. В случае с транзакционными компонентами возврат значения false приведет к повреждение текущей транзакции.

Как правило, вы сохраняете некоторые глобальные элементы данных для объекта, и если вы обнаружите, что подключение является недопустимым или ресурс какого-то типа находится в неисправном состоянии, установите его в соответствии с текущей ситуацией и верните его с помощью [**канбепулед**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled).

Если объект не реализует [**канбепулед**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled), экземпляры будут по-прежнему использоваться повторно, пока не будет достигнут максимальный уровень пула.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Строки конструктора объектов COM+](com--object-constructor-strings.md)
</dt> <dt>

[Как работает пул объектов](how-object-pooling-works.md)
</dt> <dt>

[Повышение производительности с помощью пула объектов](improving-performance-with-object-pooling.md)
</dt> <dt>

[Группирование транзакционных объектов в пул](pooling-transactional-objects.md)
</dt> <dt>

[Требования к объектам в пуле](requirements-for-poolable-objects.md)
</dt> </dl>

 

 



