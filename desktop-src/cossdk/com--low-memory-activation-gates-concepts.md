---
description: COM+ пытается предотвратить ситуации, в которых эти пути ошибок должны выполняться на сервере.
ms.assetid: 0de125a2-2e91-49b9-a903-6c2e173e22a2
title: Основные понятия о шлюзах активации COM+ Low-Memory
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 37d844a0492301ef067f5b3cd0e0749ec3a21779
ms.sourcegitcommit: bf526e267d3991892733bdd229c66d5365cf244a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2021
ms.locfileid: "103999815"
---
# <a name="com-low-memory-activation-gates-concepts"></a><span data-ttu-id="d79d7-103">Основные понятия о шлюзах активации COM+ Low-Memory</span><span class="sxs-lookup"><span data-stu-id="d79d7-103">COM+ Low-Memory Activation Gates Concepts</span></span>

<span data-ttu-id="d79d7-104">Как правило, синхронизация не требуется, если имеется однопотоковое подразделение (STA), так как подразделение обеспечивает синхронизацию.</span><span class="sxs-lookup"><span data-stu-id="d79d7-104">Generally, synchronization is not required when you have a single-threaded apartment (STA) because the apartment provides the synchronization for you.</span></span> <span data-ttu-id="d79d7-105">Синхронизация важна при наличии многопоточного апартамента (MTA) и объекта с произвольным потоком.</span><span class="sxs-lookup"><span data-stu-id="d79d7-105">Synchronization becomes important when you have a multithreaded apartment (MTA) and a free-threaded object.</span></span> <span data-ttu-id="d79d7-106">В прошлом объекты, работающие в свободной потоке, вынуждены обрабатывали блокировку.</span><span class="sxs-lookup"><span data-stu-id="d79d7-106">In the past, free-threaded objects have had to handle locking.</span></span> <span data-ttu-id="d79d7-107">Можно исключить необходимость использования блокировки, задав атрибут синхронизации для компонента.</span><span class="sxs-lookup"><span data-stu-id="d79d7-107">You can eliminate the need to use locking by setting the synchronization attribute for a component.</span></span>

<span data-ttu-id="d79d7-108">Проблемы надежности часто возникают, когда ресурсы сервера не могут эффективно реагировать на пиковые нагрузки.</span><span class="sxs-lookup"><span data-stu-id="d79d7-108">Reliability problems often occur when a server's resources cannot react efficiently to peak loads.</span></span> <span data-ttu-id="d79d7-109">Если на сервере недостаточно физических ресурсов для удовлетворения пикового спроса, виртуальная память может исчерпана.</span><span class="sxs-lookup"><span data-stu-id="d79d7-109">When a server doesn't have enough physical resources to meet peak demand, it can exhaust virtual memory.</span></span> <span data-ttu-id="d79d7-110">Это станет проблемой, если пользовательский код или системный код не обрабатывает ошибки выделения памяти ненадлежащим образом.</span><span class="sxs-lookup"><span data-stu-id="d79d7-110">This becomes a problem if the user code or system code does not properly handle memory allocation failures.</span></span> <span data-ttu-id="d79d7-111">Сервер начинает замедлять работу, и по мере исчерпания памяти происходит сбой выделения памяти.</span><span class="sxs-lookup"><span data-stu-id="d79d7-111">The server begins to slow down, and as memory is exhausted, memory allocations fail.</span></span> <span data-ttu-id="d79d7-112">Сервер выполняет пути ошибок, чтобы обработать ошибки выделения ресурсов.</span><span class="sxs-lookup"><span data-stu-id="d79d7-112">The server executes error paths to handle the allocation failures.</span></span> <span data-ttu-id="d79d7-113">Если путь ошибки содержит ошибку в системном или пользовательском коде, выполняемом на сервере, очень сложно выполнить перехват и обработку безопасного кода.</span><span class="sxs-lookup"><span data-stu-id="d79d7-113">If an error path contains a bug in the system or user code running on the server, it's extremely difficult to trap and handle safely.</span></span>

<span data-ttu-id="d79d7-114">COM+ пытается предотвратить ситуации, в которых эти пути ошибок должны выполняться на сервере.</span><span class="sxs-lookup"><span data-stu-id="d79d7-114">COM+ attempts to prevent situations in which these error paths have to be executed on a server.</span></span> <span data-ttu-id="d79d7-115">С помощью компонента "шлюзы активации нехватки памяти" COM+ активно отслеживает нагрузку на память в системе и обеспечивает доступность разумного объема памяти до выполнения пользовательского кода.</span><span class="sxs-lookup"><span data-stu-id="d79d7-115">Through the low-memory activation gates feature, COM+ proactively monitors memory load in the system and ensures that a reasonable amount of memory is available before executing user code.</span></span> <span data-ttu-id="d79d7-116">Если процентная доля виртуальной памяти, доступная для приложения, падает ниже фиксированного порога, активация завершается сбоем до создания серверного приложения или объекта COM+ (как показано на рисунке ниже).</span><span class="sxs-lookup"><span data-stu-id="d79d7-116">If the percentage of virtual memory available to the application falls below a fixed threshold, the activation fails before a COM+ server application or object is created (as shown in the illustration below).</span></span> <span data-ttu-id="d79d7-117">При сбое этих активаций, которые обычно запускаются, функция шлюзов нехватки памяти сокращает количество проблем, связанных с выделением памяти в пользовательском коде, что значительно повышает надежность системы.</span><span class="sxs-lookup"><span data-stu-id="d79d7-117">By failing these activations that would normally run, the low-memory activation gates feature minimizes the problems associated with memory allocations in user code, which significantly enhances system reliability.</span></span>

![Схема, показывающая связь между приложением COM+ и шлюзом активации нехватки памяти.](images/ada5ef02-f2b1-46bb-b0fc-fe7d65f31b43.png)

<span data-ttu-id="d79d7-119">Шлюз активации нехватки памяти применяется только к настроенным COM-компонентам, установленным в приложении COM+.</span><span class="sxs-lookup"><span data-stu-id="d79d7-119">The low-memory activation gates feature applies only to configured COM components that are installed in a COM+ application.</span></span>

## <a name="how-the-low-memory-activation-gates-feature-works"></a><span data-ttu-id="d79d7-120">Принципы работы функции "шлюзы активации Low-Memory"</span><span class="sxs-lookup"><span data-stu-id="d79d7-120">How the Low-Memory Activation Gates Feature Works</span></span>

<span data-ttu-id="d79d7-121">В зависимости от типа активации функция шлюза активации с нехваткой памяти использует другой фиксированный пороговый уровень.</span><span class="sxs-lookup"><span data-stu-id="d79d7-121">The low-memory activation gates feature uses a different fixed threshold level depending on the type of activation.</span></span> <span data-ttu-id="d79d7-122">При создании серверного приложения COM+ COM+ разрешает активацию, если доступно более 10% виртуальной памяти.</span><span class="sxs-lookup"><span data-stu-id="d79d7-122">When creating a COM+ server application, COM+ allows the activation if more than 10 percent of virtual memory is available.</span></span> <span data-ttu-id="d79d7-123">Если доступен менее 10 процентов, COM+ выполнит выделение тестов, чтобы определить, может ли файл подкачки расширяться в соответствии с новой загрузкой памяти.</span><span class="sxs-lookup"><span data-stu-id="d79d7-123">If less than 10 percent is available, COM+ makes a test allocation to find out if the paging file can expand to accommodate the new memory load.</span></span> <span data-ttu-id="d79d7-124">Если файл подкачки разворачивается, создается серверное приложение.</span><span class="sxs-lookup"><span data-stu-id="d79d7-124">If the paging file expands, the server application is created.</span></span> <span data-ttu-id="d79d7-125">Если не удается расширить файл подкачки, происходит сбой активации и память не выделяется.</span><span class="sxs-lookup"><span data-stu-id="d79d7-125">If the paging file cannot be expanded, the activation fails and memory is not allocated.</span></span>

<span data-ttu-id="d79d7-126">Процесс происходит аналогично при создании объекта.</span><span class="sxs-lookup"><span data-stu-id="d79d7-126">The process is similar when creating an object.</span></span> <span data-ttu-id="d79d7-127">В этом случае COM+ разрешает активацию, если доступно более 5% виртуальной памяти.</span><span class="sxs-lookup"><span data-stu-id="d79d7-127">In this case, COM+ allows the activation if more than 5 percent of virtual memory is available.</span></span> <span data-ttu-id="d79d7-128">Если доступен менее 5 процентов, COM+ продолжает выделение тестов.</span><span class="sxs-lookup"><span data-stu-id="d79d7-128">If less than 5 percent is available, COM+ proceeds with a test allocation.</span></span> <span data-ttu-id="d79d7-129">Опять же, если выделение тестов расширяет файл подкачки, создается объект.</span><span class="sxs-lookup"><span data-stu-id="d79d7-129">Again, if the test allocation expands the paging file, the object is created.</span></span> <span data-ttu-id="d79d7-130">В противном случае активация завершается ошибкой.</span><span class="sxs-lookup"><span data-stu-id="d79d7-130">If not, the activation fails.</span></span>

<span data-ttu-id="d79d7-131">Фиксированные уровни пороговых значений для шлюзов активации с нехваткой памяти сейчас не настраиваются.</span><span class="sxs-lookup"><span data-stu-id="d79d7-131">The fixed threshold levels for low-memory activation gates are currently not configurable.</span></span> <span data-ttu-id="d79d7-132">По этой причине нет задач, связанных с этой функцией.</span><span class="sxs-lookup"><span data-stu-id="d79d7-132">For this reason, there are no tasks associated with this feature.</span></span>

 

 



