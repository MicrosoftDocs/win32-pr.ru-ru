---
description: Windows GDI+ предоставляет классы Image и Bitmap для хранения изображений и управления ими.
ms.assetid: fcd7f3d9-8bad-44f8-8c9c-c2f5df4a7241
title: Использование матрицы цветов для преобразования одного цвета
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: db56d0a64c36c08a5415d76e3fb184158d473268
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104566876"
---
# <a name="using-a-color-matrix-to-transform-a-single-color"></a>Использование матрицы цветов для преобразования одного цвета

Windows GDI+ предоставляет классы [**Image**](/windows/win32/api/gdiplusheaders/nl-gdiplusheaders-image) и [**Bitmap**](/windows/win32/api/gdiplusheaders/nl-gdiplusheaders-bitmap) для хранения изображений и управления ими. Объекты **Image** и **Bitmap** хранят цвет каждого пикселя в виде 32-разрядного числа: по 8 бит для красного, зеленого, синего и альфа. Каждый из четырех компонентов — это число от 0 до 255, где 0 означает отсутствие интенсивности и 255, представляющие полную интенсивность. Альфа-компонент задает прозрачность цвета: 0 является полностью прозрачным, а 255 — полностью непрозрачным.

Цветовой вектор — это 4-элементный кортеж из формы (красный, зеленый, синий, альфа). Например, цветовой вектор (0, 255, 0, 255) представляет непрозрачный цвет, который не имеет красного или синего цвета, но имеет зеленый в полной интенсивности.

Другое соглашение для представления цветов использует число 1 для максимальной интенсивности и число 0 для минимальной интенсивности. При использовании этого соглашения цвет, описанный в предыдущем абзаце, будет представлен вектором (0, 1, 0, 1). При выполнении преобразований цветов в GDI+ используется соглашение 1 как полная интенсивность.

Линейные преобразования (вращение, масштабирование и т. д.) можно применять к цветным векторам путем умножения на матрицу размером 4 × 4. Однако нельзя использовать матрицу размером 4 × 4 для перевода (нелинейной). При добавлении фиктивной пятой координаты (например, номер 1) к каждому цветному вектору можно использовать матрицу 5 × 5 для применения любого сочетания линейных преобразований и переводов. Преобразование, состоящее из линейного преобразования, за которым следует перевод, называется аффинное преобразованием. Матрица 5 × 5, представляющая аффинное преобразование, называется однородной матрицей для преобразования в 4 пространства. Элемент в пятой и пятой столбцах однородной матрицы 5 × 5 должен быть равен 1, а все остальные записи в пятом столбце должны быть равны 0.

Например, предположим, что вы хотите начать с цвета (0,2, 0,0, 0,4, 1,0) и применить следующие преобразования:

1.  Двойное значение красного компонента
2.  Добавление 0,2 к красному, зеленому и синему компонентам

Следующее умножение матрицы будет выполнять пару преобразований в указанном порядке.

![Иллюстрация, демонстрирующая 5x1 матрицу чисел, умноженную на матрицу 5x5 для создания новой матрицы 5x1](images/recoloring01.png)

Элементы цветовой матрицы индексируются (отсчитывается от нуля) по строке, а затем по столбцу. Например, запись в пятой строке и третьем столбце матрицы M обозначается M \[ 4 \] \[ 2 \] .

Матрица идентификации 5 × 5 (показана на следующем рисунке) имеет 1 на диагонали и на нулях везде. При умножении вектора цвета на матрицу идентификаторов цветовой вектор не изменяется. Чтобы создать матрицу преобразования цвета, удобно начать с матрицы идентификаторов и внести небольшое изменение, которое приведет к желаемому преобразованию.

![Иллюстрация, демонстрирующая матрицу удостоверений 5x5; 1S в верхнем левом углу влево и вправо по диагонали и в любом месте](images/recoloring02.png)

Более подробное описание матриц и преобразований см. в разделе [системы координат и преобразования](-gdiplus-coordinate-systems-and-transformations-about.md).

В следующем примере берется изображение, которое имеет один цвет (0,2, 0,0, 0,4, 1,0), и применяется преобразование, описанное в предыдущих абзацах.


```
Image            image(L"InputColor.bmp");
ImageAttributes  imageAttributes;
UINT             width = image.GetWidth();
UINT             height = image.GetHeight();

ColorMatrix colorMatrix = {
   2.0f, 0.0f, 0.0f, 0.0f, 0.0f,
   0.0f, 1.0f, 0.0f, 0.0f, 0.0f,
   0.0f, 0.0f, 1.0f, 0.0f, 0.0f,
   0.0f, 0.0f, 0.0f, 1.0f, 0.0f,
   0.2f, 0.2f, 0.2f, 0.0f, 1.0f};
   
imageAttributes.SetColorMatrix(
   &colorMatrix, 
   ColorMatrixFlagsDefault,
   ColorAdjustTypeBitmap);
   
graphics.DrawImage(&image, 10, 10);

graphics.DrawImage(
   &image, 
   Rect(120, 10, width, height),  // destination rectangle 
   0, 0,        // upper-left corner of source rectangle 
   width,       // width of source rectangle
   height,      // height of source rectangle
   UnitPixel,
   &imageAttributes);
```



На следующем рисунке показано исходное изображение слева и преобразованное изображение справа.

![Иллюстрация, на которой показан прямоугольник, заполненный темным сплошным цветом, а затем один, заполненный светлым сплошным цветом ](images/colortrans1.png)

Код в предыдущем примере использует следующие шаги для выполнения перекрашивания.

1.  Инициализируйте структуру [**КолорМатрикс**](/windows/win32/api/Gdipluscolormatrix/ns-gdipluscolormatrix-colormatrix) .
2.  Создайте объект [**ImageAttributes**](/windows/win32/api/gdiplusimageattributes/nl-gdiplusimageattributes-imageattributes) и передайте адрес структуры [**КолорМатрикс**](/windows/win32/api/Gdipluscolormatrix/ns-gdipluscolormatrix-colormatrix) методу [**ImageAttributes:: сетколорматрикс**](/windows/win32/api/Gdiplusimageattributes/nf-gdiplusimageattributes-imageattributes-setcolormatrix) объекта **ImageAttributes** .
3.  Передайте адрес объекта [**ImageAttributes**](/windows/win32/api/gdiplusimageattributes/nl-gdiplusimageattributes-imageattributes) методу [методов DrawImage](/windows/win32/api/gdiplusgraphics/nf-gdiplusgraphics-graphics-drawimage(inimage_inconstpointf_inint)) объекта [**Graphics**](/windows/win32/api/gdiplusgraphics/nl-gdiplusgraphics-graphics) .

 

 



