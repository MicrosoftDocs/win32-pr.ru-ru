---
description: В этом разделе описаны функции обнаружения, реализованные в WSDAPI, но не описанные в спецификации DPWS или WS-Discovery.
ms.assetid: ae7eff53-c932-4cba-9e71-c60f308f0e2d
title: Дополнительные функции WS-Discovery
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ce9856605273bec9c757e0b29c389991bf061309
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104266221"
---
# <a name="additional-ws-discovery-functionality"></a><span data-ttu-id="73d44-103">Дополнительные функции WS-Discovery</span><span class="sxs-lookup"><span data-stu-id="73d44-103">Additional WS-Discovery Functionality</span></span>

<span data-ttu-id="73d44-104">В некоторых случаях [профиль устройств для веб-служб](https://specs.xmlsoap.org/ws/2006/02/devprof/) (DPWS) и связанные спецификации не определяют функции реализации явным образом.</span><span class="sxs-lookup"><span data-stu-id="73d44-104">In some cases, the [Devices Profile for Web Services](https://specs.xmlsoap.org/ws/2006/02/devprof/) (DPWS) and related specifications do not explicitly define implementation functionality.</span></span> <span data-ttu-id="73d44-105">Например, спецификация [WS-Discovery](https://specs.xmlsoap.org/ws/2005/04/discovery/ws-discovery.pdf) не определяет поведение клиента и узла в многосетевых средах.</span><span class="sxs-lookup"><span data-stu-id="73d44-105">For example, the [WS-Discovery](https://specs.xmlsoap.org/ws/2005/04/discovery/ws-discovery.pdf) specification does not define client and host behavior in multi-homed environments.</span></span> <span data-ttu-id="73d44-106">При реализации WSDAPI некоторые функции обнаружения были добавлены за пределы функций, определенных в спецификации.</span><span class="sxs-lookup"><span data-stu-id="73d44-106">When WSDAPI was implemented, some discovery functionality was added beyond the functionality defined in the specification.</span></span>

<span data-ttu-id="73d44-107">WSDAPI также реализует выбранные части WS-Discovery v 1.1 1 для взаимодействия с прокси-сервером обнаружения по протоколу HTTP.</span><span class="sxs-lookup"><span data-stu-id="73d44-107">WSDAPI also implements selected portions of WS-Discovery v1.1 CD1 for communicating with a discovery proxy over HTTP.</span></span>

<span data-ttu-id="73d44-108">В этом разделе описаны функции обнаружения, реализованные в WSDAPI, но не описанные в спецификации DPWS или WS-Discovery.</span><span class="sxs-lookup"><span data-stu-id="73d44-108">The purpose of this topic is to describe the discovery functionality implemented by WSDAPI but not otherwise described in the DPWS or WS-Discovery specifications.</span></span>

## <a name="ipv6-addresses-and-the-soapudp-uri-format"></a><span data-ttu-id="73d44-109">IPv6-адреса и формат URI SOAP. UDP</span><span class="sxs-lookup"><span data-stu-id="73d44-109">IPv6 addresses and the soap.udp URI format</span></span>

<span data-ttu-id="73d44-110">SOAP-over-UDP и WS-Discovery явно не описывают, как литеральный IPv6-адрес представлен в формате URI SOAP. UDP.</span><span class="sxs-lookup"><span data-stu-id="73d44-110">SOAP-over-UDP and WS-Discovery do not explicitly describe how a literal IPv6 address is represented in the soap.udp URI format.</span></span> <span data-ttu-id="73d44-111">[RFC 2396](https://www.ietf.org/rfc/rfc2396.txt), озаглавленный "универсальные идентификаторы ресурсов (URI): универсальный синтаксис", указывает, что литеральные IPv6-адреса не поддерживаются форматом URI SOAP. UDP.</span><span class="sxs-lookup"><span data-stu-id="73d44-111">[RFC 2396](https://www.ietf.org/rfc/rfc2396.txt), entitled "Uniform Resource Identifiers (URI): Generic Syntax", indicates that literal IPv6 addresses are not supported by the soap.udp URI format.</span></span>

<span data-ttu-id="73d44-112">Для простоты WSDAPI распознает IPv6-адреса, заключенные в квадратные скобки в схеме SOAP. UDP.</span><span class="sxs-lookup"><span data-stu-id="73d44-112">For simplicity, WSDAPI recognizes IPv6 addresses enclosed in square brackets in the soap.udp scheme.</span></span> <span data-ttu-id="73d44-113">Например, адрес `soap.udp://[2001:abcd:0001:0002:0003:0004:0005:0032]:3702` распознается WSDAPI.</span><span class="sxs-lookup"><span data-stu-id="73d44-113">For example, the address `soap.udp://[2001:abcd:0001:0002:0003:0004:0005:0032]:3702` is recognized by WSDAPI.</span></span> <span data-ttu-id="73d44-114">Это похоже на то, как IPv6-адреса обрабатываются в HTTP.</span><span class="sxs-lookup"><span data-stu-id="73d44-114">This is similar to how IPv6 addresses are handled in HTTP.</span></span>

## <a name="hello-and-xaddrs"></a><span data-ttu-id="73d44-115">Привет и Ксаддрс</span><span class="sxs-lookup"><span data-stu-id="73d44-115">Hello and XAddrs</span></span>

<span data-ttu-id="73d44-116">Объект размещения DPWS WSDAPI никогда не отправляет сообщение [Hello](hello-message.md) WS-Discovery с [ксаддрс](xaddr-validation-rules.md) в теле сообщения.</span><span class="sxs-lookup"><span data-stu-id="73d44-116">WSDAPI's DPWS hosting object will never send a WS-Discovery [Hello](hello-message.md) message with [XAddrs](xaddr-validation-rules.md) in the message body.</span></span> <span data-ttu-id="73d44-117">Клиент всегда будет отсылать сообщение с [разрешением](resolve-message.md) после получения сообщения Hello, если клиенту необходимо получить ксаддрс.</span><span class="sxs-lookup"><span data-stu-id="73d44-117">A client will always send a [Resolve](resolve-message.md) message after receiving a Hello message if the client needs to get the XAddrs.</span></span>

<span data-ttu-id="73d44-118">Существует два преимущества этого подхода.</span><span class="sxs-lookup"><span data-stu-id="73d44-118">There are two benefits of this approach.</span></span> <span data-ttu-id="73d44-119">Во-первых, устройство, созданное на WSDAPI, никогда не будет предоставлять Ксаддрс, которые раскрывают IP-адреса частных сетей.</span><span class="sxs-lookup"><span data-stu-id="73d44-119">First, a device built on WSDAPI will never expose XAddrs that disclose the IP addresses of private networks.</span></span> <span data-ttu-id="73d44-120">Во-вторых, устройство, созданное на WSDAPI, предоставляет доступ к Ксаддрс только для клиента, что означает, что IPv6-адреса никогда не отправляются клиенту IPv4.</span><span class="sxs-lookup"><span data-stu-id="73d44-120">Secondly, a device built on WSDAPI only exposes XAddrs that are accessible to the client, which means that IPv6 addresses are never sent to an IPv4 client.</span></span>

<span data-ttu-id="73d44-121">При получении сообщения [проверки](probe-message.md) или разрешения в ответ отправляется только одно ксаддр.</span><span class="sxs-lookup"><span data-stu-id="73d44-121">When a [Probe](probe-message.md) or Resolve message is received, only a single XAddr is sent in response.</span></span> <span data-ttu-id="73d44-122">Отправленный Ксаддр соответствует локальному адресу, на который был получен запрос.</span><span class="sxs-lookup"><span data-stu-id="73d44-122">The sent XAddr corresponds to the local address on which the request was received.</span></span> <span data-ttu-id="73d44-123">Если запрос был получен в подсетях по протоколу IPv6, то WSDAPI будет предоставлять глобальный IPv6-адрес в ответе.</span><span class="sxs-lookup"><span data-stu-id="73d44-123">If the request was received across subnets over IPv6, WSDAPI will provide a global IPv6 address in the response.</span></span>

## <a name="preferred-addresses"></a><span data-ttu-id="73d44-124">Предпочтительные адреса</span><span class="sxs-lookup"><span data-stu-id="73d44-124">Preferred addresses</span></span>

<span data-ttu-id="73d44-125">Устройство может предоставлять несколько Ксаддрс в сообщении [Hello](hello-message.md), [пробематч](probematches-message.md)или [ресолвематч](resolvematches-message.md) .</span><span class="sxs-lookup"><span data-stu-id="73d44-125">A device can provide multiple XAddrs in a [Hello](hello-message.md), [ProbeMatch](probematches-message.md), or [ResolveMatch](resolvematches-message.md) message.</span></span> <span data-ttu-id="73d44-126">Служба также может быть доступна на нескольких конечных точках с разными адресами транспорта.</span><span class="sxs-lookup"><span data-stu-id="73d44-126">A service can also be available at multiple endpoints with different transport addresses.</span></span> <span data-ttu-id="73d44-127">В таких случаях WSDAPI будет пытаться связаться с устройством по первому используемому адресу.</span><span class="sxs-lookup"><span data-stu-id="73d44-127">In these cases, WSDAPI will try to communicate with the device on the first usable address it finds.</span></span> <span data-ttu-id="73d44-128">Адрес можно использовать, если он доступен из доступного протокола, такого как IPv4 на компьютере, где установлена IPv4, или IPv6 на компьютере, где установлен IPv6.</span><span class="sxs-lookup"><span data-stu-id="73d44-128">An address is usable if it is from an available protocol, such as IPv4 on a machine where IPv4 is installed or IPv6 on a machine where IPv6 is installed.</span></span> <span data-ttu-id="73d44-129">Кроме того, если адрес поступил от устройства или службы, которые не находятся в локальной подсети, он может использоваться только в том случае, если он является IPv4, локальным сайтом IPv6 или локальным каналом IPv6.</span><span class="sxs-lookup"><span data-stu-id="73d44-129">Additionally, if the address came from a device or service that is not on the local subnet, it is usable only if it is IPv4, IPv6 site local, or IPv6 link local.</span></span>

## <a name="wsdl-in-metadata-exchange"></a><span data-ttu-id="73d44-130">WSDL в обмене метаданными</span><span class="sxs-lookup"><span data-stu-id="73d44-130">WSDL in metadata exchange</span></span>

<span data-ttu-id="73d44-131">Устройства и службы, созданные на сервере WSDAPI, не обеспечивают их WSDL в обмене метаданными, если только они не расширены приложением для предоставления этих сведений.</span><span class="sxs-lookup"><span data-stu-id="73d44-131">Devices and services built on WSDAPI do not provide their WSDL in metadata exchange unless extended by the application to provide this information.</span></span> <span data-ttu-id="73d44-132">По умолчанию наполнение WSDL не является частью модели программирования.</span><span class="sxs-lookup"><span data-stu-id="73d44-132">By default, WSDL provision is not part of the programming model.</span></span>

## <a name="app_max_delay"></a><span data-ttu-id="73d44-133">\_Максимальная \_ Задержка приложения</span><span class="sxs-lookup"><span data-stu-id="73d44-133">APP\_MAX\_DELAY</span></span>

<span data-ttu-id="73d44-134">DPWS определяет \_ максимальную \_ задержку приложения, случайный интервал для задержки между получением [пробы](probe-message.md) и отправкой [пробематч](probematches-message.md), как 5 000 миллисекунд.</span><span class="sxs-lookup"><span data-stu-id="73d44-134">DPWS defines APP\_MAX\_DELAY, the random interval to delay between receiving a [Probe](probe-message.md) and sending a [ProbeMatch](probematches-message.md), as 5,000 milliseconds.</span></span> <span data-ttu-id="73d44-135">Брандмауэр Windows требует, чтобы модель многоадресных запросов/одноадресных ответов для UDP работала только в 4-секундном окне брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="73d44-135">Windows Firewall requires that the multicast request/unicast response model for UDP will only work within the 4 second firewall window.</span></span> <span data-ttu-id="73d44-136">В результате WSDAPI будет передавать ответы в 2 500 мс или менее, а не в окне 5 000 MS, описанном в разделе \_ Max Delay (максимальная задержка приложения) \_ .</span><span class="sxs-lookup"><span data-stu-id="73d44-136">As a result, WSDAPI will transmit responses in 2,500 ms or less, instead of the 5,000 ms window described by APP\_MAX\_DELAY.</span></span>

## <a name="iana-port-reservations"></a><span data-ttu-id="73d44-137">Резервирования портов IANA</span><span class="sxs-lookup"><span data-stu-id="73d44-137">IANA port reservations</span></span>

<span data-ttu-id="73d44-138">Протокол WSDAPI использует TCP-порт 5357 для трафика HTTP и TCP-порт 5358 для трафика HTTPS по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="73d44-138">WSDAPI uses TCP port 5357 for HTTP traffic and TCP port 5358 for HTTPS traffic by default.</span></span> <span data-ttu-id="73d44-139">Эти порты зарезервированы для процессов с более низким уровнем привилегий с помощью резервирования URL-адресов в HTTP.sys и также зарезервированы IANA.</span><span class="sxs-lookup"><span data-stu-id="73d44-139">These ports are reserved for lower privilege processes through a URL reservation in HTTP.sys, and are also reserved with IANA.</span></span>

## <a name="udp-port-sharing"></a><span data-ttu-id="73d44-140">Общий доступ к портам UDP</span><span class="sxs-lookup"><span data-stu-id="73d44-140">UDP port sharing</span></span>

<span data-ttu-id="73d44-141">WSDAPI использует общий доступ к портам.</span><span class="sxs-lookup"><span data-stu-id="73d44-141">WSDAPI uses port sharing.</span></span> <span data-ttu-id="73d44-142">Одноадресные сообщения, отправленные на порт 3702, могут быть неправильно обработаны всеми приложениями на базе WSDAPI.</span><span class="sxs-lookup"><span data-stu-id="73d44-142">Unicast messages sent to port 3702 may not be properly handled by all WSDAPI-based applications.</span></span> <span data-ttu-id="73d44-143">Если приложение привязывается только к порту 3702, оно может препятствовать правильному использованию этого порта приложениями на основе WSDAPI.</span><span class="sxs-lookup"><span data-stu-id="73d44-143">If an application binds exclusively to port 3702, it may prevent WSDAPI-based applications from using that port correctly.</span></span>

## <a name="ws-discovery-v11-cd1-proxy"></a><span data-ttu-id="73d44-144">Прокси-сервер WS-Discovery v 1.1</span><span class="sxs-lookup"><span data-stu-id="73d44-144">WS-Discovery v1.1 CD1 Proxy</span></span>

<span data-ttu-id="73d44-145">WSDAPI будет искать и взаимодействовать с прокси-сервером обнаружения, который реализует протокол управляемого режима WS-Discovery v 1.1 с интерфейсом 1.</span><span class="sxs-lookup"><span data-stu-id="73d44-145">WSDAPI will search for and communicate with a discovery proxy that implements the WS-Discovery v1.1 CD1 managed mode protocol.</span></span> <span data-ttu-id="73d44-146">WS-Discovery v 1.1 1 – Первая редакция WS-Discovery включает явное описание протокола HTTP для обмена данными между прокси-сервером и клиентом или устройством.</span><span class="sxs-lookup"><span data-stu-id="73d44-146">WS-Discovery v1.1 CD1 is the first revision of WS-Discovery to include an explicit description of an HTTP protocol for communication between a proxy and a client or device.</span></span>

<span data-ttu-id="73d44-147">Чтобы ограничить количество одновременных версий, используемых в многоадресных запросах, WSDAPI отправляет запрос на проверку WS-Discovery в пространстве имен 2005/04, но ищет тип DiscoveryProxy WS-Discovery v 1.1 1.</span><span class="sxs-lookup"><span data-stu-id="73d44-147">To limit the number of concurrent versions used in multicast requests, WSDAPI sends a WS-Discovery Probe request in the 2005/04 namespace, but searches for the WS-Discovery v1.1 CD1 DiscoveryProxy type.</span></span> <span data-ttu-id="73d44-148">Если прокси-сервер отвечает, то WSDAPI отправляет проверку HTTP или разрешает запрос в указанную конечную точку прокси, как определено в WS-Discovery v 1.1 1.</span><span class="sxs-lookup"><span data-stu-id="73d44-148">If a proxy responds, WSDAPI will send an HTTP Probe or Resolve request to the specified proxy endpoint as defined in WS-Discovery v1.1 CD1.</span></span>

 

 



