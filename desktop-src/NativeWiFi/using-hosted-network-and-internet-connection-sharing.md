---
title: Использование беспроводной размещенной сети, общий доступ к подключению к Интернету
description: Использование беспроводной размещенной сети и общего доступа к подключению к Интернету
ms.assetid: 56e86ef8-f759-4e56-a591-74e03430125a
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 972774e921199e32eb70841c74c7478e2178cda9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103998410"
---
# <a name="use-wireless-hosted-network-internet-connection-sharing"></a><span data-ttu-id="d4d7f-103">Использование беспроводной размещенной сети, общий доступ к подключению к Интернету</span><span class="sxs-lookup"><span data-stu-id="d4d7f-103">Use Wireless Hosted Network, Internet Connection Sharing</span></span>

<span data-ttu-id="d4d7f-104">Беспроводная размещенная сеть — это новая функция WLAN, поддерживаемая в Windows 7 и Windows 8.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-104">The Wireless Hosted Network is a new WLAN feature supported on Windows 7 and Windows 8.</span></span> <span data-ttu-id="d4d7f-105">Она также поддерживается в Windows Server 2012 и Windows Server 2008 R2 с установленной службой беспроводной локальной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-105">It is also supported on Windows Server 2012 and Windows Server 2008 R2 with the Wireless LAN Service installed.</span></span> <span data-ttu-id="d4d7f-106">Эта функция реализует две основные функции:</span><span class="sxs-lookup"><span data-stu-id="d4d7f-106">This feature implements two major functions:</span></span>

-   <span data-ttu-id="d4d7f-107">Виртуализация физического беспроводного адаптера на более чем один виртуальный беспроводной адаптер иногда называется виртуальным Wi-Fi.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-107">The virtualization of a physical wireless adapter into more than one virtual wireless adapter sometimes referred to as Virtual Wi-Fi.</span></span>
-   <span data-ttu-id="d4d7f-108">Программная точка беспроводного доступа (AP) иногда называется Софтап, которая использует назначенный виртуальный беспроводной адаптер.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-108">A software-based wireless access point (AP) sometimes referred to as a SoftAP that uses a designated virtual wireless adapter.</span></span>

<span data-ttu-id="d4d7f-109">Общий доступ к подключению к Интернету (ICS) — это функция Windows, предоставляемая через службу SharedAccess.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-109">Internet Connection Sharing (ICS) is a feature in Windows provided through the SharedAccess Service.</span></span> <span data-ttu-id="d4d7f-110">Строго говоря, SharedAccess обеспечивает общий доступ к сети через компьютер, на котором общая сеть не обязательно обеспечивает доступ к Интернету.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-110">Strictly speaking, SharedAccess enables network sharing through a computer where the shared network access does not necessarily provide access to the Internet.</span></span> <span data-ttu-id="d4d7f-111">В этом разделе мы используем термин ICS и SharedAccess, так как общий доступ к подключению к Интернету является основным сценарием для беспроводной сети, а термин ICS лучше известен сообществу пользователей.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-111">We use the term ICS and SharedAccess interchangeably in this section, since Internet Connection Sharing is a major scenario for the wireless Hosted Network and the ICS term is better known to the user community.</span></span>

<span data-ttu-id="d4d7f-112">Беспроводная размещенная сеть тесно связана с ICS, чтобы обеспечить использование беспроводной личной сети (PAN) и сценариев общего доступа в Интернете.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-112">Wireless Hosted Network is closely tied to ICS to enable both the wireless personal area network (PAN) and the Internet sharing scenarios.</span></span> <span data-ttu-id="d4d7f-113">В этом разделе приводятся общие рекомендации для разработчиков приложений по интеграции беспроводной размещенной сети и ICS с помощью общедоступной беспроводной сети и интерфейсов API ICS.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-113">This section provides general recommendations to application developers on how to integrate wireless Hosted Network and ICS using the public wireless Hosted Network and ICS APIs.</span></span>

## <a name="internet-connection-sharing"></a><span data-ttu-id="d4d7f-114">Общий доступ к подключению Интернета</span><span class="sxs-lookup"><span data-stu-id="d4d7f-114">Internet Connection Sharing</span></span>

<span data-ttu-id="d4d7f-115">Служба ICS работает в одном из двух возможных режимов:</span><span class="sxs-lookup"><span data-stu-id="d4d7f-115">The ICS Service operates in one of the two possible modes:</span></span>

-   <span data-ttu-id="d4d7f-116">Автономный режим</span><span class="sxs-lookup"><span data-stu-id="d4d7f-116">Standalone mode</span></span>

    <span data-ttu-id="d4d7f-117">При вызове службы ICS работает только функция DHCPv4 Server.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-117">Only the DHCPv4 server function is operating when the ICS service is invoked.</span></span> <span data-ttu-id="d4d7f-118">Это специальный режим работы для ICS, который предоставляется только через сеть, размещенную в беспроводной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-118">This is a special operation mode for ICS and is only made available through the wireless Hosted Network.</span></span> <span data-ttu-id="d4d7f-119">Пользователь или приложение не может напрямую запускать и прекращать автономный ICS через общедоступные API ICS или команды **netsh** .</span><span class="sxs-lookup"><span data-stu-id="d4d7f-119">A user or application is not able to directly start and stop standalone ICS through public ICS APIs or **netsh** commands.</span></span> <span data-ttu-id="d4d7f-120">Запуск беспроводной размещенной сети обычно подразумевает запуск ICS в автономном режиме для использования функции DHCPv4-сервера, чтобы предоставить частные IPv4-адреса для подключенных устройств.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-120">Starting the wireless Hosted Network typically involves starting ICS in standalone mode to use the DHCPv4 server function to provide private IPv4 addresses for connected devices.</span></span> <span data-ttu-id="d4d7f-121">Сетевая связь для подключенных устройств ограничена отправкой и получением сетевых пакетов между подключенным устройством и локальным компьютером, на котором размещается беспроводная сеть, а также между подключенными устройствами.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-121">Network communication for the connected devices is limited to sending and receiving network packets between a connected device and the local computer hosting the wireless Hosted Network and among the connected devices themselves.</span></span> <span data-ttu-id="d4d7f-122">Это эффективно включает сценарий беспроводной личной сети для беспроводной размещенной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-122">This effectively enables the wireless personal area network scenario for the wireless Hosted Network.</span></span>

-   <span data-ttu-id="d4d7f-123">Полный режим</span><span class="sxs-lookup"><span data-stu-id="d4d7f-123">Full mode</span></span>

    <span data-ttu-id="d4d7f-124">Все функции ICS работают при вызове службы, например в функции преобразования сетевых адресов и DHCP-сервера как для IPv4, так и для IPv6.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-124">All the features of ICS are operating when the service is invoked, such as network address translation and DHCP server functions for both IPv4 and IPv6.</span></span> <span data-ttu-id="d4d7f-125">Это нормальный режим работы для ICS.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-125">This is the normal mode of operation for ICS.</span></span> <span data-ttu-id="d4d7f-126">Пользователь или приложение могут запускать и прекращать работу в полном режиме ICS через открытые API-интерфейсы или команды NetShell.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-126">A user or application may start and stop full ICS mode through public APIs or netshell commands.</span></span> <span data-ttu-id="d4d7f-127">Например, эту службу можно остановить с помощью команды net остановить SharedAccess из командной строки с повышенными привилегиями.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-127">For example, this service can be stopped using net stop sharedaccess from an elevated command prompt.</span></span> <span data-ttu-id="d4d7f-128">Сочетание беспроводной размещенной сети с полным ICS, сетевая связь для подключенных устройств не ограничена беспроводным PAN.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-128">Combining wireless Hosted Network with full ICS, Network communication for the connected devices is not limited to the wireless PAN.</span></span> <span data-ttu-id="d4d7f-129">Любое подключенное устройство имеет доступ к сети (например, к Интернету) через общее сетевое подключение с компьютера, на котором запущена беспроводная сеть.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-129">Any connected device has access to network (such as the Internet) through the shared network connection from the computer running the wireless Hosted Network.</span></span> <span data-ttu-id="d4d7f-130">Это позволяет эффективно использовать сетевой общий сценарий для беспроводной размещенной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-130">This effectively enables the Network sharing scenario for the wireless Hosted Network.</span></span>

<span data-ttu-id="d4d7f-131">В этом разделе мы используем термин полный общий доступ к подключению общего доступа (ICS) для обозначения случая, когда все функции ICS вызываются в службе ICS, чтобы обеспечить доступ ко всем функциям общего доступа к подключению к беспроводной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-131">In this section, we use the term full ICS to mean the case where all the ICS functions are invoked in ICS Service to provide access to all the full ICS features with the wireless Hosted Network.</span></span>

<span data-ttu-id="d4d7f-132">Два режима работы ICS являются взаимоисключающими с полными ICS с более высоким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-132">The two ICS operation modes are mutually exclusive with full ICS taking higher precedence.</span></span> <span data-ttu-id="d4d7f-133">Служба ICS может переходить из автономного режима в полный, но не из полного режима в автономный режим.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-133">The ICS Service may transition from standalone mode to full mode, but not from full mode to standalone mode.</span></span> <span data-ttu-id="d4d7f-134">Автономный режим ICS появился в Windows 7 и Windows Server 2008 R2 с помощью службы беспроводной локальной сети, установленной вместе с функцией беспроводной сетевой сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-134">The ICS standalone mode was introduced in Windows 7 and on Windows Server 2008 R2 with the Wireless LAN Service installed in conjunction with the wireless Hosted Network feature.</span></span> <span data-ttu-id="d4d7f-135">Она недоступна в предыдущих версиях Windows.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-135">It is not available in previous versions of Windows.</span></span>

<span data-ttu-id="d4d7f-136">Любая полная операция ICS состоит из двух разных сетевых адаптеров в системе:</span><span class="sxs-lookup"><span data-stu-id="d4d7f-136">Any full ICS operation involves two different network adapters in the system:</span></span>

-   <span data-ttu-id="d4d7f-137">Открытый интерфейс.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-137">The public interface.</span></span> <span data-ttu-id="d4d7f-138">Это сетевой интерфейс с доступом к Интернету.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-138">This is the network interface with access to the Internet.</span></span> <span data-ttu-id="d4d7f-139">Это интерфейс, который используется локальным компьютером, на котором работает ICS, для предоставления общего доступа к Интернету клиентам и устройствам, подключающимся к нему через Софтап.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-139">It is this interface that the local computer running ICS uses to share the Internet with clients and devices connecting to it via SoftAP.</span></span>
-   <span data-ttu-id="d4d7f-140">Частный интерфейс.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-140">The private interface.</span></span> <span data-ttu-id="d4d7f-141">Это сетевой интерфейс, используемый другими устройствами для подключения к локальному компьютеру, на котором работает ICS.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-141">This is the network interface that other devices use to connect to the local computer that is running ICS.</span></span> <span data-ttu-id="d4d7f-142">На этом частном интерфейсе работает DHCPv4-сервер для предоставления частных локальных IP адресов другим удаленным компьютерам.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-142">A DHCPv4 server is running on this private interface to provide private local IP addresses to the other remote computers.</span></span>

<span data-ttu-id="d4d7f-143">Если общедоступный интерфейс не имеет доступа к Интернету, DHCP-сервер на частном интерфейсе по-своему не предоставляет подключенным устройствам локальные IP адреса.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-143">When the public interface does not have Internet access, the DHCP server on the private interface continues to provide local IP addresses to the connected devices.</span></span> <span data-ttu-id="d4d7f-144">Автономный ICS включает только частный интерфейс, на котором работает Софтап. Он не участвует ни в одном открытом интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-144">Standalone ICS only involves the private interface on which SoftAP is running; it does not involve any public interface.</span></span>

<span data-ttu-id="d4d7f-145">В любой момент времени на локальном компьютере существует не более одного экземпляра полного доступа к сети (ICS).</span><span class="sxs-lookup"><span data-stu-id="d4d7f-145">At any time, there is at most one instance of full ICS running on the local computer.</span></span> <span data-ttu-id="d4d7f-146">Если полный ICS уже запущен на локальном компьютере, то при запуске другого полного ICS происходит следующее поведение:</span><span class="sxs-lookup"><span data-stu-id="d4d7f-146">If full ICS is already running on the local computer, starting another full ICS exhibits the following functional behaviors:</span></span>

-   <span data-ttu-id="d4d7f-147">Если общедоступный и частный интерфейсы нового полного ICS совпадают с имеющимся полным общим именем ICS, запуск второго полного ICS эквивалентен отсутствию операций.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-147">If the public and private interfaces of the new full ICS are the same as the existing full ICS, starting the second full ICS is equivalent to a no-op.</span></span>
-   <span data-ttu-id="d4d7f-148">Если новый общедоступный интерфейс отличается от старого общедоступного интерфейса, но новый частный интерфейс аналогичен старому частному интерфейсу, запуск второго полного ICS практически не повлияет на подключенные устройства в том же частном интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-148">If the new public interface is different from the old public interface, but the new private interface is the same as the old private interface, starting a second full ICS has little impact on the connected devices on the same private interface.</span></span> <span data-ttu-id="d4d7f-149">Возможность доступа к Интернету может измениться с помощью нового общедоступного интерфейса.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-149">The ability to access the Internet may change with the new public interface.</span></span>
-   <span data-ttu-id="d4d7f-150">Если новый частный интерфейс отличается от старого частного интерфейса, функции ICS перестанут работать со старым частным интерфейсом и приступит к применению к новому частному интерфейсу.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-150">If the new private interface is different than the old private interface, ICS functions will stop working on the old private interface and start applying to the new private interface.</span></span> <span data-ttu-id="d4d7f-151">Все удаленные устройства, подключающиеся к локальному компьютеру с помощью старого частного интерфейса, потеряют IP-подключение к локальному компьютеру.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-151">Any remote device connecting to the local computer using the old private interface will lose IP connectivity to the local computer.</span></span>

<span data-ttu-id="d4d7f-152">Если полный общий доступ к Интернету уже запущен, вызов второго полного ICS не нарушает работу удаленных устройств с помощью старого частного интерфейса, если вторая интеграция ICS использует другой новый частный интерфейс.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-152">When full ICS is already running, invoking a second full ICS is disruptive to remotely connected devices using the old private interface as long as the second ICS integration uses a different new private interface.</span></span>

<span data-ttu-id="d4d7f-153">Чтобы управлять и использовать службу ICS для поддержки интеграции ICS с беспроводной размещенной сетью, программное приложение сначала должно получить интерфейс [**инетшарингманажер**](/windows/win32/api/netcon/nn-netcon-inetsharingmanager) .</span><span class="sxs-lookup"><span data-stu-id="d4d7f-153">To manage and use the ICS service to support ICS integration with wireless Hosted Network, a software application must first obtain an [**INetSharingManager**](/windows/win32/api/netcon/nn-netcon-inetsharingmanager) interface.</span></span> <span data-ttu-id="d4d7f-154">Интерфейс **инетшарингманажер** предоставляет прямой или косвенный доступ ко всем другим COM-интерфейсам в API ICS.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-154">The **INetSharingManager** interface provides access directly or indirectly to all the other COM interfaces in the ICS API.</span></span> <span data-ttu-id="d4d7f-155">Метод [**Get \_ шарингинсталлед**](/windows/win32/api/netcon/nf-netcon-inetsharingmanager-get_sharinginstalled) в интерфейсе **инетшарингманажер** сообщает, поддерживает ли локальный компьютер общий доступ к подключениям.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-155">The [**get\_SharingInstalled**](/windows/win32/api/netcon/nf-netcon-inetsharingmanager-get_sharinginstalled) method on the **INetSharingManager** interface reports whether the local computer supports connection sharing.</span></span> <span data-ttu-id="d4d7f-156">Метод [**Get \_ енумевериконнектион**](/windows/win32/api/netcon/nf-netcon-inetsharingmanager-get_enumeveryconnection) в интерфейсе **инетшарингманажер** Извлекает интерфейс перечисления для всех соединений в папке Connections.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-156">The [**get\_EnumEveryConnection**](/windows/win32/api/netcon/nf-netcon-inetsharingmanager-get_enumeveryconnection) method on the **INetSharingManager** interface retrieves an enumeration interface for all connections in the connections folder.</span></span> <span data-ttu-id="d4d7f-157">Метод [**Get \_ инетшарингконфигуратионфоринетконнектион**](/windows/win32/api/netcon/nf-netcon-inetsharingmanager-get_inetsharingconfigurationforinetconnection) Извлекает интерфейс [**инетшарингконфигуратион**](/windows/win32/api/netcon/nn-netcon-inetsharingconfiguration) для указанного соединения.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-157">The [**get\_INetSharingConfigurationForINetConnection**](/windows/win32/api/netcon/nf-netcon-inetsharingmanager-get_inetsharingconfigurationforinetconnection) method retrieves an [**INetSharingConfiguration**](/windows/win32/api/netcon/nn-netcon-inetsharingconfiguration) interface for the specified connection.</span></span> <span data-ttu-id="d4d7f-158">Методы в интерфейсе **инетшарингконфигуратион** можно использовать для запроса и изменения параметров ICS.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-158">Methods on the **INetSharingConfiguration** interface can be used to query and change ICS settings.</span></span>

<span data-ttu-id="d4d7f-159">Беспроводная размещенная сеть должна быть запущена перед вызовом метода [**Get \_ енумевериконнектион**](/windows/win32/api/netcon/nf-netcon-inetsharingmanager-get_enumeveryconnection) в интерфейсе [**инетшарингманажер**](/windows/win32/api/netcon/nn-netcon-inetsharingmanager) для перечисления всех подключений в папке Connections.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-159">The wireless Hosted Network must be started before calling the [**get\_EnumEveryConnection**](/windows/win32/api/netcon/nf-netcon-inetsharingmanager-get_enumeveryconnection) method on the [**INetSharingManager**](/windows/win32/api/netcon/nn-netcon-inetsharingmanager) interface to enumerate all connections in the connections folder.</span></span>

<span data-ttu-id="d4d7f-160">Сведения об ICS и открытых интерфейсах и методах, которые можно использовать для запроса и изменения параметров ICS, см. в документации по [общему доступу к подключению к Интернету и брандмауэру подключения к Интернету](/previous-versions/windows/desktop/ics/about-internet-connection-sharing-and-internet-connection-firewall).</span><span class="sxs-lookup"><span data-stu-id="d4d7f-160">For information on ICS and the public interfaces and methods that can be used to query and change ICS settings, please see the documentation on [About Internet Connection Sharing and Internet Connection Firewall](/previous-versions/windows/desktop/ics/about-internet-connection-sharing-and-internet-connection-firewall).</span></span>

## <a name="hosted-network-and-ics-integration"></a><span data-ttu-id="d4d7f-161">Интеграция с размещенной сетью и ICS</span><span class="sxs-lookup"><span data-stu-id="d4d7f-161">Hosted Network and ICS Integration</span></span>

<span data-ttu-id="d4d7f-162">Если полный ICS не запущен, то при запуске беспроводной размещенной сети также выполняется внутреннее запуск службы ICS в автономном режиме с использованием только функции DHCPv4 Server для выделения IP-адресов подключенных устройств на сетевом интерфейсе, размещенном в беспроводной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-162">When full ICS is not running, starting a wireless Hosted Network also internally starts the ICS Service in standalone mode with only the DHCPv4 server function to allocate IP addresses for the connected devices on the wireless Hosted Network interface.</span></span> <span data-ttu-id="d4d7f-163">Диапазон адресов подсети для автономного сервера DHCPv4 — 192.168.173.0/24.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-163">The subnet address range for the standalone DHCPv4 server is 192.168.173.0/24.</span></span> <span data-ttu-id="d4d7f-164">Это отличается от диапазона подсети 192.168.137.0/24, используемого с полным ICS.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-164">This is different from the subnet range of 192.168.137.0/24 that is used with full ICS.</span></span>

<span data-ttu-id="d4d7f-165">Запуск беспроводной размещенной сети с полным ICS использует следующую логику:</span><span class="sxs-lookup"><span data-stu-id="d4d7f-165">Starting a wireless Hosted Network with full ICS employs the following logic:</span></span>

-   <span data-ttu-id="d4d7f-166">Если полный ICS еще не запущен, при запуске беспроводной размещенной сети также запускается служба ICS с автономным сервером DHCPv4.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-166">If full ICS is not already running, starting a wireless Hosted Network also starts the ICS Service with standalone DHCPv4 server.</span></span>
-   <span data-ttu-id="d4d7f-167">Если полный ICS уже запущен, а частный интерфейс — это сетевой интерфейс, размещенный в беспроводной сети, просто запустите беспроводную сеть.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-167">If full ICS is already running and the private interface is the wireless Hosted Network interface, just start the wireless Hosted Network.</span></span>
-   <span data-ttu-id="d4d7f-168">Если полный ICS уже запущен, но частный интерфейс не является беспроводным сетевым интерфейсом, размещенная беспроводная сеть будет запущена без функции DHCPv4-сервера на сетевом интерфейсе, размещенном в беспроводной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-168">If full ICS is already running but the private interface is not the wireless Hosted Network interface, the wireless Hosted Network will be started without the DHCPv4 server function on the wireless Hosted Network interface.</span></span>

<span data-ttu-id="d4d7f-169">Влияние логики выше выделяет следующие факты:</span><span class="sxs-lookup"><span data-stu-id="d4d7f-169">The impact of the logic above highlights the following facts:</span></span>

-   <span data-ttu-id="d4d7f-170">ICS не переходит из полного режима в автономный режим.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-170">ICS does not transition from full mode to standalone mode.</span></span>
-   <span data-ttu-id="d4d7f-171">Изолированный режим может вызываться только беспроводной сетью, когда ICS не работает в полном режиме.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-171">Standalone mode can only be invoked by the wireless Hosted Network when ICS is not running in full mode.</span></span>
-   <span data-ttu-id="d4d7f-172">Если ICS работает в автономном режиме, он будет прерван в полном режиме, если пользователь или приложение запустит ICS в полном режиме.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-172">If ICS is running in standalone mode, it will be preempted into full mode if a user or application starts ICS in full mode.</span></span>
-   <span data-ttu-id="d4d7f-173">Переход от автономного режима к полному в режиме ICS приведет к нарушению работы подключенных устройств в беспроводном PAN, если частный интерфейс полного ICS не совпадает с Софтап.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-173">Transitioning from standalone mode to full mode in ICS will be disruptive to connected devices in the wireless PAN if the private interface of full ICS is not the same as the one for SoftAP.</span></span>

<span data-ttu-id="d4d7f-174">Для запуска или завершения работы службы ICS на локальном компьютере в полном или автономном режиме требуется время.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-174">It takes time to start or stop the ICS Service on the local computer in either full or standalone mode.</span></span> <span data-ttu-id="d4d7f-175">Приложение должно проверить состояние службы ICS с помощью функции **NotifyServiceStatusChange** , чтобы убедиться, что служба ICS не находится в состоянии ожидания запуска/остановки, прежде чем запускать или останавливать беспроводную сеть для использования с интеграцией ICS.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-175">An application should check the state of ICS Service using the **NotifyServiceStatusChange** function to make sure that the ICS Service is not in the start/stop pending state before starting or stopping the wireless Hosted Network for use with ICS integration.</span></span>

## <a name="starting-and-stopping-the-wireless-hosted-network"></a><span data-ttu-id="d4d7f-176">Запуск и остановка беспроводной размещенной сети</span><span class="sxs-lookup"><span data-stu-id="d4d7f-176">Starting and Stopping the Wireless Hosted Network</span></span>

<span data-ttu-id="d4d7f-177">Windows предоставляет платформу, в которой несколько одновременно работающих приложений могут управлять беспроводной сетью в одно и то же время.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-177">Windows provides a platform where more than one concurrent application is allowed to manage a wireless Hosted Network at the same time.</span></span> <span data-ttu-id="d4d7f-178">В частности, каждое приложение может запускать и прекращать работу беспроводной сети без предварительного знания других приложений.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-178">Specifically each application can start and stop the wireless Hosted Network on its own, without prior knowledge about other applications.</span></span>

<span data-ttu-id="d4d7f-179">Существует два набора функций для запуска и завершения размещенной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-179">There are two sets of functions to start and stop a Hosted Network.</span></span>

<span data-ttu-id="d4d7f-180">Для нескольких приложений может потребоваться использовать сеть, размещенную в беспроводной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-180">Multiple applications may require the use of the wireless Hosted Network.</span></span> <span data-ttu-id="d4d7f-181">Функции [**вланхостеднетворкстартусинг**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) и [**вланхостеднетворкстопусинг**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing) запускают и останавливают работу входящий сетевой трафик, которая совместима с другими параллельными приложениями.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-181">The [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) and [**WlanHostedNetworkStopUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing) functions start and stop a wireless Hosted Network in a way that is compatible with other concurrent applications.</span></span> <span data-ttu-id="d4d7f-182">Функции **вланхостеднетворкстартусинг** и **вланхостеднетворкстопусинг** позволяют приложению иметь ссылку на сеть, размещенную в беспроводной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-182">The **WlanHostedNetworkStartUsing** and **WlanHostedNetworkStopUsing** functions allow an application to have a reference to the wireless Hosted Network.</span></span> <span data-ttu-id="d4d7f-183">Этот механизм обеспечивает работу размещенной беспроводной сети, так как по крайней мере у одного другого приложения есть текущая ссылка на сеть, размещенная в беспроводной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-183">This mechanism keeps the wireless Hosted Network running provided that at least one other application has a current reference to the wireless Hosted Network.</span></span> <span data-ttu-id="d4d7f-184">Любой пользователь может вызывать эти функции.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-184">Any user can call these functions.</span></span> <span data-ttu-id="d4d7f-185">Успешные вызовы **вланхостеднетворкстартусинг** должны соответствовать вызовам функции **вланхостеднетворкстопусинг** .</span><span class="sxs-lookup"><span data-stu-id="d4d7f-185">Successful calls to **WlanHostedNetworkStartUsing** must be matched by calls to the **WlanHostedNetworkStopUsing** function.</span></span> <span data-ttu-id="d4d7f-186">Любое изменение состояния размещенной сети, вызванное функцией **вланхостеднетворкстартусинг** , будет автоматически отменено, если вызывающее приложение закрывает свой вызывающий его вызов (путем вызова [**вланклосехандле**](/windows/desktop/api/wlanapi/nf-wlanapi-wlanclosehandle) с тем же параметром *хклиенсандле* , который передается **вланхостеднетворкстартусинг**) или завершает процесс.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-186">Any Hosted Network state change caused by the **WlanHostedNetworkStartUsing** function would be automatically undone if the calling application closes its calling handle (by calling [**WlanCloseHandle**](/windows/desktop/api/wlanapi/nf-wlanapi-wlanclosehandle) with the same *hClientHandle* parameter passed to **WlanHostedNetworkStartUsing**) or if the process ends.</span></span>

<span data-ttu-id="d4d7f-187">Функции [**вланхостеднетворкфорцестарт**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart) и [**вланхостеднетворкфорцестоп**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) принудительно запускают и останавливают сеть, размещенную в беспроводной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-187">The [**WlanHostedNetworkForceStart**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart) and [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) functions force start and stop a wireless Hosted Network.</span></span> <span data-ttu-id="d4d7f-188">Эти функции могут вызываться только в том случае, если у пользователя есть соответствующие привилегии с повышенными привилегиями.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-188">These functions can only be called if the user has the appropriate elevated privilege.</span></span> <span data-ttu-id="d4d7f-189">Успешные вызовы **вланхостеднетворкфорцестарт** могут быть сопоставлены вызовом функции **вланхостеднетворкфорцестоп** в зависимости от проекта приложения.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-189">Successful calls to **WlanHostedNetworkForceStart** may eventually be matched by a call to the **WlanHostedNetworkForceStop** function, depending on the application design.</span></span> <span data-ttu-id="d4d7f-190">Эти функции передают состояние беспроводной сети, не связывая запрос с маркером вызова приложения.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-190">These functions transition the wireless Hosted Network state without associating the request with the application's calling handle.</span></span> <span data-ttu-id="d4d7f-191">Любое изменение состояния размещенной сети, вызванное функцией **вланхостеднетворкфорцестарт** , не было автоматически отменено, если вызывающее приложение закрывает свой вызывающий его вызов (путем вызова [**вланклосехандле**](/windows/desktop/api/wlanapi/nf-wlanapi-wlanclosehandle) с тем же параметром *хклиенсандле* , который передан [**вланхостеднетворкстартусинг**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing)) или завершает процесс.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-191">Any Hosted Network state change caused by the **WlanHostedNetworkForceStart** function would not be automatically undone if the calling application closes its calling handle (by calling [**WlanCloseHandle**](/windows/desktop/api/wlanapi/nf-wlanapi-wlanclosehandle) with the same *hClientHandle* parameter passed to [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing)) or if the process ends.</span></span> <span data-ttu-id="d4d7f-192">Если приложение, вызвавшее функцию **вланхостеднетворкфорцестарт** , закроется без вызова одной из функций для отключения беспроводной сети, то размещенная сеть останется работающей.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-192">If the application that called the **WlanHostedNetworkForceStart** function closes without calling one of the functions to stop the wireless Hosted Network, then Hosted Network is left running.</span></span> <span data-ttu-id="d4d7f-193">Приложение может вызвать функцию **вланхостеднетворкфорцестарт** , убедившись, что Системный пользователь с повышенными правами принимает повышенные требования к питанию, связанные с выполнением беспроводной размещенной сети в течение продолжительного периода времени.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-193">An application might call the **WlanHostedNetworkForceStart** function after ensuring that an elevated system user accepts the increased power requirements involved in running the wireless Hosted Network for extended periods of time.</span></span>

<span data-ttu-id="d4d7f-194">Ниже приведены общие рекомендации по вызываемым функциям для запуска и отключения беспроводной размещенной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-194">The general recommendations on which functions to call to start and stop a wireless Hosted Network are as follows:</span></span>

-   <span data-ttu-id="d4d7f-195">Используйте функции [**вланхостеднетворкстартусинг**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) и [**вланхостеднетворкстопусинг**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing) в приложении, чтобы запускать и прекращать работу беспроводной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-195">Use the [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) and [**WlanHostedNetworkStopUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing) functions within an application to start and stop a wireless Hosted Network.</span></span>
-   <span data-ttu-id="d4d7f-196">Не используйте функцию [**вланхостеднетворкфорцестарт**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart) для запуска сети с беспроводной сетью, если она не является обязательной для приложения.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-196">Do not use the [**WlanHostedNetworkForceStart**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart) function to start a wireless Hosted Network unless it is absolutely required by the application.</span></span> <span data-ttu-id="d4d7f-197">Функция **вланхостеднетворкфорцестарт** также требует повышенных привилегий.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-197">The **WlanHostedNetworkForceStart** function also requires elevated privileges.</span></span>
-   <span data-ttu-id="d4d7f-198">Используйте только функцию [**вланхостеднетворкфорцестоп**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) в качестве метода восстановления.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-198">Only use the [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) function as a recovery method.</span></span> <span data-ttu-id="d4d7f-199">Функция **вланхостеднетворкфорцестоп** приводит к немедленной остановке беспроводной размещенной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-199">The **WlanHostedNetworkForceStop** function causes a wireless Hosted Network to stop immediately.</span></span> <span data-ttu-id="d4d7f-200">Другие приложения, которые прослушивают сетевые уведомления размещенной сети, могут потребовать действий по восстановлению.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-200">Other applications that listen for wireless Hosted Network notifications may need to take recovery actions.</span></span> <span data-ttu-id="d4d7f-201">Дополнительные сведения см. в обсуждении, приведенном ниже в последовательности восстановления для беспроводной размещенной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-201">For more information, see the discussion below on the recovery sequence for wireless Hosted Network.</span></span>

## <a name="start-sequence-for-wireless-hosted-network"></a><span data-ttu-id="d4d7f-202">Начальная последовательность для беспроводной размещенной сети</span><span class="sxs-lookup"><span data-stu-id="d4d7f-202">Start Sequence for Wireless Hosted Network</span></span>

<span data-ttu-id="d4d7f-203">Для приложения, запускающего беспроводную сеть с полным ICS, рекомендуется запустить сеть, размещенную в беспроводной сети, а затем запустить полный общий доступ к Интернету.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-203">For an application that starts a wireless Hosted Network with full ICS, the recommendation is to start the wireless Hosted Network, then start full ICS.</span></span> <span data-ttu-id="d4d7f-204">Если сеть, размещенная в беспроводной сети, уже запущена, приложение должно использовать функцию [**вланхостеднетворкфорцестоп**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) для отключения беспроводной сети, только если требуется полный ICS, но он не был включен до запуска размещенной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-204">If a wireless Hosted Network is already running, an application should use the [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) function to stop the wireless Hosted Network only if full ICS is required but has not been enabled before the Hosted Network was started.</span></span> <span data-ttu-id="d4d7f-205">Это позволит другим приложениям восстанавливаться после возможных нарушений, вызванных запуском полного ICS.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-205">This will allow other applications to recover from potential disruptions caused by the start of full ICS.</span></span> <span data-ttu-id="d4d7f-206">Дополнительные сведения см. в обсуждении, приведенном ниже в последовательности восстановления для беспроводной размещенной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-206">For more information, see the discussion below on the recovery sequence for wireless Hosted Network.</span></span> <span data-ttu-id="d4d7f-207">Общая операция должна завершиться успешно и завершиться ошибкой в целом.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-207">The combined operation should succeed and fail as a whole.</span></span>

> [!Note]  
> <span data-ttu-id="d4d7f-208">Необходимо запустить беспроводную сеть, прежде чем пытаться перечислить соответствующий адаптер с помощью интерфейса [**иенумнетшаринжевериконнектион**](/windows/win32/api/netcon/nn-netcon-ienumnetsharingeveryconnection) .</span><span class="sxs-lookup"><span data-stu-id="d4d7f-208">The wireless Hosted Network must be started before attempting to enumerate the corresponding adapter using the [**IEnumNetSharingEveryConnection**](/windows/win32/api/netcon/nn-netcon-ienumnetsharingeveryconnection) interface.</span></span>

 

<span data-ttu-id="d4d7f-209">Следующие упорядоченные шаги являются рекомендуемой начальной последовательностью в приложении, использующем беспроводную сеть с полным ICS:</span><span class="sxs-lookup"><span data-stu-id="d4d7f-209">The following ordered steps are the recommended start sequence in an application using wireless Hosted Network with full ICS:</span></span>

-   <span data-ttu-id="d4d7f-210">Вызовите функцию [**вланхостеднетворкинитсеттингс**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkinitsettings) , чтобы убедиться, что беспроводная размещенная сеть настроена и готова к использованию.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-210">Call the [**WlanHostedNetworkInitSettings**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkinitsettings) function to make sure wireless Hosted Network is configured and ready to be used.</span></span>
-   <span data-ttu-id="d4d7f-211">Вызовите функции [**вланхостеднетворккуеристатус**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkquerystatus) и [**вланхостеднетворккуерипроперти**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkqueryproperty) , чтобы определить, разрешены и доступны ли беспроводная размещенная сеть.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-211">Call the [**WlanHostedNetworkQueryStatus**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkquerystatus) and [**WlanHostedNetworkQueryProperty**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkqueryproperty) functions to determine if the wireless Hosted Network is allowed and available.</span></span> <span data-ttu-id="d4d7f-212">Если беспроводная размещенная сеть не разрешена и недоступна, возвращается ошибка.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-212">If the wireless Hosted Network is not allowed and not available, return an error.</span></span>
-   <span data-ttu-id="d4d7f-213">Проверьте, разрешена ли служба ICS, используемая для полного ICS.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-213">Test to see if the ICS Service used for full ICS is allowed.</span></span> <span data-ttu-id="d4d7f-214">Если служба ICS не может быть запущена, возвращается ошибка.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-214">If the ICS service cannot be started, return an error.</span></span>
-   <span data-ttu-id="d4d7f-215">Вызовите функцию [**вланхостеднетворкфорцестоп**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) , чтобы принудительно выполнить приостанавливает работу беспроводной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-215">Call the [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) function to force a stop of the wireless Hosted Network.</span></span>
-   <span data-ttu-id="d4d7f-216">Вызовите функцию [**вланхостеднетворкстартусинг**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) для запуска беспроводной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-216">Call the [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) function to start the wireless Hosted Network.</span></span>
-   <span data-ttu-id="d4d7f-217">Если беспроводная размещенная сеть не запускается, возвращает ошибку.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-217">If the wireless Hosted Network fails to start, return an error.</span></span>
-   <span data-ttu-id="d4d7f-218">Если полный ICS уже запущен, а текущий общедоступный или частный интерфейс отличается от нового интерфейса, кэширование текущих общедоступных и частных интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-218">If full ICS is already running and the current public or private interface is different from the new interface to be used, cache the current public and private interfaces.</span></span> <span data-ttu-id="d4d7f-219">Приложение может также вернуть сообщение об ошибке или запросить пользователя о том, что интеграция ICS уже запущена.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-219">An application may also choose to return an error or prompt the user if ICS integration is already running.</span></span>
-   <span data-ttu-id="d4d7f-220">Запустите полный ICS с новыми параметрами для общедоступных и частных интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-220">Start full ICS with the new settings for the public and private interfaces.</span></span>
-   <span data-ttu-id="d4d7f-221">Если не удается запустить полный ICS с этими параметрами, попробуйте запустить полную службу ICS с кэшированными общедоступными и частными интерфейсами, если был запущен полный ICS.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-221">If full ICS fails to start with these settings, try to start full ICS service with the cached public and private interfaces if full ICS was running before.</span></span> <span data-ttu-id="d4d7f-222">Вызовите функцию [**вланхостеднетворкфорцестоп**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) для отключения беспроводной размещенной сети и возврата ошибки.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-222">Call the [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) function to stop the wireless Hosted Network and return an error.</span></span>
-   <span data-ttu-id="d4d7f-223">Возвращает сообщение об успешном завершении работы беспроводной сети и полного ICS.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-223">Return success that the wireless Hosted Network and full ICS succeed.</span></span>

## <a name="stop-sequence-for-wireless-hosted-network"></a><span data-ttu-id="d4d7f-224">Прерывать последовательность для беспроводной размещенной сети</span><span class="sxs-lookup"><span data-stu-id="d4d7f-224">Stop Sequence for Wireless Hosted Network</span></span>

<span data-ttu-id="d4d7f-225">При использовании беспроводной размещенной сети с полным ICS приложение может захотеть отключить беспроводную сеть и службу ICS, используемую для полного ICS.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-225">When using wireless Hosted Network with full ICS, an application that has finished its work may want to stop the wireless Hosted Network and the ICS service used for full ICS.</span></span> <span data-ttu-id="d4d7f-226">В этом случае рекомендуется вызывать функцию [**вланхостеднетворкфорцестоп**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) для завершения размещенной сети вместо вызова функции [**вланхостеднетворкстопусинг**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing) .</span><span class="sxs-lookup"><span data-stu-id="d4d7f-226">In this case, it is recommended that the [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) function be called to stop the Hosted Network rather than calling the [**WlanHostedNetworkStopUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing) function.</span></span> <span data-ttu-id="d4d7f-227">Функция **вланхостеднетворкфорцестоп** останавливает сеть, размещенную в беспроводной сети, а также позволяет другим приложениям восстанавливаться.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-227">The **WlanHostedNetworkForceStop** function stops the wireless Hosted Network and also serves to allow other applications to recover.</span></span> <span data-ttu-id="d4d7f-228">Дополнительные сведения см. в обсуждении, приведенном ниже в последовательности восстановления для беспроводной размещенной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-228">For more information, see the discussion below on the recovery sequence for wireless Hosted Network.</span></span>

<span data-ttu-id="d4d7f-229">Следующие упорядоченные шаги являются рекомендуемой последовательностью в приложении, использующем беспроводную сеть и полный общий доступ к Интернету.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-229">The following ordered steps are the recommended stop sequence in an application using wireless Hosted Network and full ICS:</span></span>

-   <span data-ttu-id="d4d7f-230">Прерывать полный общий доступ к Интернету.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-230">Stop full ICS.</span></span>
-   <span data-ttu-id="d4d7f-231">Вызовите функцию [**вланхостеднетворкфорцестоп**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) для отключения беспроводной размещенной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-231">Call the [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) function to stop the wireless Hosted Network.</span></span>

<span data-ttu-id="d4d7f-232">Приложение, использующее беспроводную сетевую сеть без полного ICS, которое завершило свою работу, должно вызвать функцию [**вланхостеднетворкстопусинг**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing) или [**вланхостеднетворкфорцестоп**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) для отключения беспроводной размещенной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-232">An application using wireless Hosted Network without full ICS that is finished with its work just needs to call the [**WlanHostedNetworkStopUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing) or [**WlanHostedNetworkForceStop**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestop) function to stop the wireless Hosted Network.</span></span> <span data-ttu-id="d4d7f-233">Если функция [**вланхостеднетворкстартусинг**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) была вызвана для запуска беспроводной сети, приложение должно вызвать функцию **вланхостеднетворкстопусинг** для отключения беспроводной размещенной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-233">If the [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) function was called to start the wireless Hosted Network, then the application should call the **WlanHostedNetworkStopUsing** function to stop the wireless Hosted Network.</span></span> <span data-ttu-id="d4d7f-234">Если беспроводная размещенная сеть уже запущена до того, как приложение или приложение вызвало функцию [**вланхостеднетворкфорцестарт**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart) для принудительного запуска беспроводной сети, то приложение может вызвать функцию **вланхостеднетворкфорцестоп** , чтобы отключить беспроводную сеть или ничего не делать (не начата беспроводная размещенная сеть) в зависимости от сценария.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-234">If the wireless Hosted Network was was already started before the application or the application called the [**WlanHostedNetworkForceStart**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart) function to force start the wireless Hosted Network, then the application can call the **WlanHostedNetworkForceStop** function to stop the wireless Hosted Network or do nothing (leave wireless Hosted Network started) depending on the scenario.</span></span>

## <a name="recovery-sequence-for-wireless-hosted-network"></a><span data-ttu-id="d4d7f-235">Последовательность восстановления для беспроводной размещенной сети</span><span class="sxs-lookup"><span data-stu-id="d4d7f-235">Recovery Sequence for Wireless Hosted Network</span></span>

<span data-ttu-id="d4d7f-236">На приложение, использующее беспроводную сеть, может повлиять действие других приложений.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-236">An application using the wireless Hosted Network may be affected by the actions of other applications.</span></span> <span data-ttu-id="d4d7f-237">Служба ICS и интерфейсы для управления ICS не предоставляют способа регистрации приложений для уведомлений об изменениях ICS.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-237">The ICS service and the interfaces for managing ICS provide no method for an application to register for ICS change notifications.</span></span> <span data-ttu-id="d4d7f-238">Если другое приложение вызывает методы [**енаблешаринг**](/windows/win32/api/netcon/nf-netcon-inetsharingconfiguration-enablesharing) или [**дисаблешаринг**](/windows/win32/api/netcon/nf-netcon-inetsharingconfiguration-disablesharing) в интерфейсе [**инетшарингконфигуратион**](/windows/win32/api/netcon/nn-netcon-inetsharingconfiguration) для включения или отключения совместного использования в соединении, сообщение отправляется в пользовательский интерфейс (экран) на локальном компьютере, а не в другие приложения.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-238">If another application calls the [**EnableSharing**](/windows/win32/api/netcon/nf-netcon-inetsharingconfiguration-enablesharing) or the [**DisableSharing**](/windows/win32/api/netcon/nf-netcon-inetsharingconfiguration-disablesharing) methods on the [**INetSharingConfiguration**](/windows/win32/api/netcon/nn-netcon-inetsharingconfiguration) interface to enable or disable sharing on a connection, a message is sent to the user interface (the screen) on the local computer not to other applications.</span></span> <span data-ttu-id="d4d7f-239">Поэтому приложению необходимо полагаться на уведомления о беспроводном размещении сети для выполнения действий по восстановлению при возникновении изменений ICS или беспроводной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-239">So an application needs to rely on the wireless Hosted Network notifications to perform recovery actions when ICS or wireless Hosted Network changes occur.</span></span>

<span data-ttu-id="d4d7f-240">Приложение, использующее сеть, размещенное в беспроводной сети, должно зарегистрироваться для получения уведомлений о беспроводном размещении сети, вызвав [**вланрегистернотификатион**](/windows/desktop/api/wlanapi/nf-wlanapi-wlanregisternotification).</span><span class="sxs-lookup"><span data-stu-id="d4d7f-240">An application using the wireless Hosted Network should register for wireless Hosted Network notifications by calling the [**WlanRegisterNotification**](/windows/desktop/api/wlanapi/nf-wlanapi-wlanregisternotification).</span></span> <span data-ttu-id="d4d7f-241">Если требуются уведомления только для беспроводной размещенной сети, приложение должно передать **\_ источник уведомлений WLAN \_ \_ Хнвк** в параметре *двнотифсаурце* , переданном в **вланрегистернотификатион**.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-241">If notifications for only wireless Hosted Network are needed, then the application should pass **WLAN\_NOTIFICATION\_SOURCE\_HNWK** in the *dwNotifSource* parameter passed to the **WlanRegisterNotification**.</span></span> <span data-ttu-id="d4d7f-242">Если также требуются другие беспроводные **\_ уведомления, \_ \_ хнвк источника уведомлений WLAN** следует сочетать с константами источника уведомлений для других типов уведомлений о беспроводном подключении и передавать это значение в параметр *двнотифсаурце* .</span><span class="sxs-lookup"><span data-stu-id="d4d7f-242">If other wireless notications are also needed, then **WLAN\_NOTIFICATION\_SOURCE\_HNWK** should be combined with the notification source constants for other types of wireless notifications desired and pass this value in the *dwNotifSource* parameter.</span></span>

<span data-ttu-id="d4d7f-243">Последовательность восстановления одинакова для приложений с полным ICS или без него, предполагая, что приложения не хотят снова запускать службу ICS.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-243">The recovery sequence is the same for applications with or without full ICS, assuming that applications don’t want to start ICS service again.</span></span> <span data-ttu-id="d4d7f-244">После получения уведомления о беспроводной размещенной сети, которая была остановлена, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-244">Upon receiving a wireless Hosted Network notification that the Hosted Network has stopped, do the following:</span></span>

-   <span data-ttu-id="d4d7f-245">Если приложение с именем [**вланхостеднетворкфорцестарт**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart) запускает сеть, размещенную в беспроводной сети, перезапустите эту сеть, вызвав **вланхостеднетворкфорцестарт**.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-245">If the application called [**WlanHostedNetworkForceStart**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart) to start the wireless Hosted Network, then restart the Hosted Network by calling **WlanHostedNetworkForceStart**.</span></span> <span data-ttu-id="d4d7f-246">В противном случае вызовите [**вланхостеднетворкстартусинг**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) , чтобы перезапустить сеть, размещенную в беспроводной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-246">Otherwise, call [**WlanHostedNetworkStartUsing**](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing) to restart the wireless Hosted Network.</span></span>

## <a name="recovery-sequence-for-connected-devices"></a><span data-ttu-id="d4d7f-247">Последовательность восстановления для подключенных устройств</span><span class="sxs-lookup"><span data-stu-id="d4d7f-247">Recovery Sequence for Connected Devices</span></span>

<span data-ttu-id="d4d7f-248">На удаленные устройства или компьютеры, подключенные к беспроводной сети, могут повлиять действия других приложений, которые влияют на ICS и сеть, размещенную в беспроводной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-248">Remote devices or computers connected to the wireless Hosted Network may be affected by the actions of other applications that impact ICS and the wireless Hosted Network.</span></span> <span data-ttu-id="d4d7f-249">К счастью, большинство устройств имеют встроенную логику повторных попыток в приложении устройства, чтобы работать с временной потерей сигнала или роуминга.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-249">Fortunately, most devices have built in retry logic in the device application to deal with a temporary loss of signal or roaming.</span></span>

<span data-ttu-id="d4d7f-250">Возможны следующие последовательности восстановления для устройств или компьютеров, подключенных к беспроводной сети, которая потеряла контакт:</span><span class="sxs-lookup"><span data-stu-id="d4d7f-250">A possible recovery sequence for devices or computers connected to the wireless Hosted Network that lose contact is the following:</span></span>

-   <span data-ttu-id="d4d7f-251">Драйвер беспроводного устройства указывает на то, что носитель отключен от верхних уровней сетевого стека на устройстве.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-251">The wireless device driver indicates a media disconnect to the upper layers of the network stack on the device.</span></span>
-   <span data-ttu-id="d4d7f-252">Приложение устройства запускает периодические проверки доступности беспроводной размещенной сети.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-252">The device application starts periodic checks for the availability of the wireless Hosted Network.</span></span>
-   <span data-ttu-id="d4d7f-253">Когда приложение устройства снова обнаружит беспроводную сеть, оно инициирует беспроводное подключение.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-253">Once the device application again detects the wireless Hosted Network, the device initiates a wireless connection.</span></span>
-   <span data-ttu-id="d4d7f-254">При успешном подключении к беспроводной размещенной сети приложение устройства обновляет свои IP-параметры соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="d4d7f-254">Upon a successful connection with the wireless Hosted Network, the device application updates its IP settings accordingly.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d4d7f-255">См. также</span><span class="sxs-lookup"><span data-stu-id="d4d7f-255">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d4d7f-256">Сведения о беспроводной размещенной сети</span><span class="sxs-lookup"><span data-stu-id="d4d7f-256">About the Wireless Hosted Network</span></span>](about-the-wireless-hosted-network.md)
</dt> <dt>

[<span data-ttu-id="d4d7f-257">Пример беспроводной размещенной сети</span><span class="sxs-lookup"><span data-stu-id="d4d7f-257">Wireless Hosted Network Sample</span></span>](wireless-hosted-network-sample.md)
</dt> <dt>

[<span data-ttu-id="d4d7f-258">**вланхостеднетворкфорцестарт**</span><span class="sxs-lookup"><span data-stu-id="d4d7f-258">**WlanHostedNetworkForceStart**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkforcestart)
</dt> <dt>

[<span data-ttu-id="d4d7f-259">**вланхостеднетворкинитсеттингс**</span><span class="sxs-lookup"><span data-stu-id="d4d7f-259">**WlanHostedNetworkInitSettings**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkinitsettings)
</dt> <dt>

[<span data-ttu-id="d4d7f-260">**вланхостеднетворккуерипроперти**</span><span class="sxs-lookup"><span data-stu-id="d4d7f-260">**WlanHostedNetworkQueryProperty**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkqueryproperty)
</dt> <dt>

[<span data-ttu-id="d4d7f-261">**вланхостеднетворккуерисекондарикэй**</span><span class="sxs-lookup"><span data-stu-id="d4d7f-261">**WlanHostedNetworkQuerySecondaryKey**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkquerysecondarykey)
</dt> <dt>

[<span data-ttu-id="d4d7f-262">**вланхостеднетворккуеристатус**</span><span class="sxs-lookup"><span data-stu-id="d4d7f-262">**WlanHostedNetworkQueryStatus**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkquerystatus)
</dt> <dt>

[<span data-ttu-id="d4d7f-263">**вланхостеднетворкрефрешсекуритисеттингс**</span><span class="sxs-lookup"><span data-stu-id="d4d7f-263">**WlanHostedNetworkRefreshSecuritySettings**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkrefreshsecuritysettings)
</dt> <dt>

[<span data-ttu-id="d4d7f-264">**вланхостеднетворксетпроперти**</span><span class="sxs-lookup"><span data-stu-id="d4d7f-264">**WlanHostedNetworkSetProperty**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworksetproperty)
</dt> <dt>

[<span data-ttu-id="d4d7f-265">**вланхостеднетворксетсекондарикэй**</span><span class="sxs-lookup"><span data-stu-id="d4d7f-265">**WlanHostedNetworkSetSecondaryKey**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworksetsecondarykey)
</dt> <dt>

[<span data-ttu-id="d4d7f-266">**вланхостеднетворкстартусинг**</span><span class="sxs-lookup"><span data-stu-id="d4d7f-266">**WlanHostedNetworkStartUsing**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstartusing)
</dt> <dt>

[<span data-ttu-id="d4d7f-267">**вланхостеднетворкстопусинг**</span><span class="sxs-lookup"><span data-stu-id="d4d7f-267">**WlanHostedNetworkStopUsing**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanhostednetworkstopusing)
</dt> <dt>

[<span data-ttu-id="d4d7f-268">**вланрегистервиртуалстатионнотификатион**</span><span class="sxs-lookup"><span data-stu-id="d4d7f-268">**WlanRegisterVirtualStationNotification**</span></span>](/windows/desktop/api/Wlanapi/nf-wlanapi-wlanregistervirtualstationnotification)
</dt> </dl>

 

 
