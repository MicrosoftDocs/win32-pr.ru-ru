---
title: Пользовательские коллекции шрифтов (Windows 7/8)
description: DirectWrite предоставляет доступ к коллекции системных шрифтов с помощью метода Идвритефактори Жетсистемфонтколлектион.
ms.assetid: ec892904-6778-4fbd-93b4-62d0db5b82ea
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 39aa764330f27b72051ef682c6ce5f1176c42c7d
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103792661"
---
# <a name="custom-font-collections-windows-78"></a><span data-ttu-id="f9e8f-103">Пользовательские коллекции шрифтов (Windows 7/8)</span><span class="sxs-lookup"><span data-stu-id="f9e8f-103">Custom Font Collections (Windows 7/8)</span></span>

<span data-ttu-id="f9e8f-104">[DirectWrite](direct-write-portal.md) предоставляет доступ к коллекции системных шрифтов с помощью метода [**Идвритефактори:: жетсистемфонтколлектион**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-getsystemfontcollection) .</span><span class="sxs-lookup"><span data-stu-id="f9e8f-104">[DirectWrite](direct-write-portal.md) provides access to the system font collection by using the [**IDWriteFactory::GetSystemFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-getsystemfontcollection) method.</span></span> <span data-ttu-id="f9e8f-105">Это наиболее часто используемая коллекция шрифтов.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-105">This is the font collection that is most frequently used.</span></span> <span data-ttu-id="f9e8f-106">Однако некоторые приложения должны использовать шрифты, которые не установлены в системе, например из файлов шрифтов или шрифтов, внедренных в приложение.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-106">However some applications have to use fonts that are not installed on the system, such as from included font files or font files embedded in the application.</span></span>

<span data-ttu-id="f9e8f-107">Если нужные шрифты не находятся в коллекции системных шрифтов, можно создать пользовательскую коллекцию шрифтов, производную от [**идвритефонтколлектион**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollection).</span><span class="sxs-lookup"><span data-stu-id="f9e8f-107">If the fonts that you want are not in the system font collection, you can create a custom font collection derived from [**IDWriteFontCollection**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollection).</span></span>

<span data-ttu-id="f9e8f-108">Этот обзор состоит из следующих частей.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-108">This overview consists of the following parts:</span></span>

-   [<span data-ttu-id="f9e8f-109">Регистрация и Отмена регистрации загрузчика коллекции шрифтов</span><span class="sxs-lookup"><span data-stu-id="f9e8f-109">Registering and unregistering a Font Collection Loader</span></span>](#registering-and-unregistering-a-font-collection-loader)
-   [<span data-ttu-id="f9e8f-110">идвритефонтколлектионлоадер</span><span class="sxs-lookup"><span data-stu-id="f9e8f-110">IDWriteFontCollectionLoader</span></span>](#idwritefontcollectionloader)
-   [<span data-ttu-id="f9e8f-111">идвритефонтфилинумератор</span><span class="sxs-lookup"><span data-stu-id="f9e8f-111">IDWriteFontFileEnumerator</span></span>](#idwritefontfileenumerator)
-   [<span data-ttu-id="f9e8f-112">креатекустомфонтфилереференце</span><span class="sxs-lookup"><span data-stu-id="f9e8f-112">CreateCustomFontFileReference</span></span>](#createcustomfontfilereference)
-   [<span data-ttu-id="f9e8f-113">идвритефонтфилелоадер</span><span class="sxs-lookup"><span data-stu-id="f9e8f-113">IDWriteFontFileLoader</span></span>](#idwritefontfileloader)
-   [<span data-ttu-id="f9e8f-114">идвритефонтфилестреам</span><span class="sxs-lookup"><span data-stu-id="f9e8f-114">IDWriteFontFileStream</span></span>](#idwritefontfilestream)

## <a name="registering-and-unregistering-a-font-collection-loader"></a><span data-ttu-id="f9e8f-115">Регистрация и Отмена регистрации загрузчика коллекции шрифтов</span><span class="sxs-lookup"><span data-stu-id="f9e8f-115">Registering and unregistering a Font Collection Loader</span></span>

<span data-ttu-id="f9e8f-116">Вы регистрируете загрузчик коллекции шрифтов с помощью метода [**идвритефактори:: регистерфонтколлектионлоадер**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-registerfontcollectionloader) и передаете ему интерфейс [**идвритефонтколлектионлоадер**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollectionloader) , реализованный приложением как одноэлементный объект.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-116">You register a font collection loader by using the [**IDWriteFactory::RegisterFontCollectionLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-registerfontcollectionloader) method and passing it an [**IDWriteFontCollectionLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollectionloader) interface implemented by the application as a singleton object.</span></span> <span data-ttu-id="f9e8f-117">Этот объект будет загружать шрифты при запросе пользовательской коллекции.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-117">This object will load the fonts when the custom collection is requested.</span></span> <span data-ttu-id="f9e8f-118">И коллекция системных шрифтов, и пользовательские коллекции шрифтов кэшируются, поэтому шрифты загружаются только один раз.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-118">Both the system font collection and custom font collections are cached, so the fonts are only loaded one time.</span></span>

<span data-ttu-id="f9e8f-119">Загрузчик коллекции шрифтов должен быть выгружен в конечном итоге с помощью [**идвритефактори:: унрегистерфонтколлектионлоадер**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontcollectionloader).</span><span class="sxs-lookup"><span data-stu-id="f9e8f-119">The font collection loader must be unloaded eventually by using the [**IDWriteFactory::UnregisterFontCollectionLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontcollectionloader).</span></span>

> [!Note]  
> <span data-ttu-id="f9e8f-120">Регистрация загрузчика коллекции шрифтов добавляет к счетчику ссылок; не вызывайте [**унрегистерфонтколлектионлоадер**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontcollectionloader) из деструктора, иначе не будет отменена регистрация объекта загрузчика коллекции.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-120">Registering the font collection loader adds to the reference count; do not call [**UnregisterFontCollectionLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontcollectionloader) from within the destructor or the collection loader object will never be unregistered.</span></span>

 

## <a name="idwritefontcollectionloader"></a><span data-ttu-id="f9e8f-121">идвритефонтколлектионлоадер</span><span class="sxs-lookup"><span data-stu-id="f9e8f-121">IDWriteFontCollectionLoader</span></span>

<span data-ttu-id="f9e8f-122">Вы создадите объект [**идвритефонтфилинумератор**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator) с помощью [**Идвритефактори:: креатекустомфонтколлектион**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection) и передаем ему ключ, определяемый приложением.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-122">You create an [**IDWriteFontFileEnumerator**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator) object by using the [**IDWriteFactory::CreateCustomFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection) and passing it an application-defined key.</span></span> <span data-ttu-id="f9e8f-123">Ключ является указателем void, а тип данных, формат и значение определяются приложением и являются непрозрачными для системы шрифтов.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-123">The key is a void pointer and the data type, format, and meaning are defined by the application and are opaque to the font system.</span></span>

<span data-ttu-id="f9e8f-124">В то время как ключ может быть любым, [DirectWrite](direct-write-portal.md) требует, чтобы каждый ключ был одновременно:</span><span class="sxs-lookup"><span data-stu-id="f9e8f-124">Whereas the key can be anything, [DirectWrite](direct-write-portal.md) requires that each key is both:</span></span>

-   <span data-ttu-id="f9e8f-125">Уникальный для одной коллекции шрифтов в пределах области загрузчика.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-125">Unique to a single font collection within the scope of the loader.</span></span>
-   <span data-ttu-id="f9e8f-126">Допустимо, пока не будет отменена регистрация загрузчика с помощью фабрики.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-126">Valid until the loader is unregistered using the factory.</span></span>

<span data-ttu-id="f9e8f-127">Когда вызывается метод [**креатекустомфонтколлектион**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection) , [DirectWrite](direct-write-portal.md) обращается к интерфейсу [**идвритефонтколлектионлоадер**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollectionloader) , реализованному в виде одноэлементного объекта приложения.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-127">When the [**CreateCustomFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection) method is called, [DirectWrite](direct-write-portal.md) calls back to an [**IDWriteFontCollectionLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollectionloader) interface implemented as a singleton object by the application.</span></span> <span data-ttu-id="f9e8f-128">Метод обратного вызова [**идвритефонтколлектионлоадер:: креатинумераторфромкэй**](/windows/win32/api/dwrite/nf-dwrite-idwritefontcollectionloader-createenumeratorfromkey) используется DirectWrite для получения объекта [**идвритефонтфилинумератор**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator) , реализованного приложением.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-128">The [**IDWriteFontCollectionLoader::CreateEnumeratorFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontcollectionloader-createenumeratorfromkey) callback method is used by DirectWrite to retrieve an [**IDWriteFontFileEnumerator**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator) object implemented by the application.</span></span> <span data-ttu-id="f9e8f-129">Объект [**идвритефактори**](/windows/win32/api/dwrite/nn-dwrite-idwritefactory) , который используется для создания коллекции, передается этому методу и должен использоваться перечислителем файла шрифта для создания объектов [**идвритефонтфиле**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) , которые должны быть добавлены в коллекцию.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-129">The [**IDWriteFactory**](/windows/win32/api/dwrite/nn-dwrite-idwritefactory) object that is being used to create the collection is passed to this method and should be used by the font file enumerator to create the [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) objects to be included in the collection.</span></span>

<span data-ttu-id="f9e8f-130">Ключ, переданный этому методу, определяет коллекцию шрифтов и является тем же ключом, который передается в [**креатекустомфонтколлектион**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection).</span><span class="sxs-lookup"><span data-stu-id="f9e8f-130">The key passed to this method identifies the font collection and is the same key passed to [**CreateCustomFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontcollection).</span></span>

## <a name="idwritefontfileenumerator"></a><span data-ttu-id="f9e8f-131">идвритефонтфилинумератор</span><span class="sxs-lookup"><span data-stu-id="f9e8f-131">IDWriteFontFileEnumerator</span></span>

<span data-ttu-id="f9e8f-132">Определяемый приложением объект [**идвритефонтфилинумератор**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator) , созданный методом [**креатинумераторфромкэй**](/windows/win32/api/dwrite/nf-dwrite-idwritefontcollectionloader-createenumeratorfromkey) , используется для перечисления файлов шрифтов в коллекции, создания объекта [**идвритефонтфиле**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) для каждого файла.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-132">The application-defined [**IDWriteFontFileEnumerator**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileenumerator) object that was created by the [**CreateEnumeratorFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontcollectionloader-createenumeratorfromkey) method is used to enumerate the font files in a collection, creating an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object for each file.</span></span> <span data-ttu-id="f9e8f-133">Метод [**идвритефонтфилинумератор:: MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext) изменяет расположение на следующий файл шрифта.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-133">The [**IDWriteFontFileEnumerator::MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext) method changes the position to the next font file.</span></span> <span data-ttu-id="f9e8f-134">Если в позиции есть файл, для *хаскуррентфиле* будет задано **значение true**.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-134">If there is a file at the position, it will set the *hasCurrentFile* to **TRUE**.</span></span> <span data-ttu-id="f9e8f-135">В противном случае ему будет присвоено значение **false** , и метод возвратит **S \_ ОК**.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-135">Otherwise it will be set to **FALSE** and the method will return **S\_OK**.</span></span>

> [!Note]  
> <span data-ttu-id="f9e8f-136">Перечислитель файла шрифта должен начинаться с позиции перед первым элементом и дополнительно при первом вызове [**MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext).</span><span class="sxs-lookup"><span data-stu-id="f9e8f-136">The font file enumerator must start positioned before the first element and advanced at the first call to [**MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext).</span></span>

 

<span data-ttu-id="f9e8f-137">Объект [**идвритефонтфиле**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) выводится методом [**Идвритефонтфилинумератор:: жеткуррентфонтфиле**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-getcurrentfontfile) .</span><span class="sxs-lookup"><span data-stu-id="f9e8f-137">An [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object is output by the [**IDWriteFontFileEnumerator::GetCurrentFontFile**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-getcurrentfontfile) method.</span></span> <span data-ttu-id="f9e8f-138">Если в текущей позиции нет файла шрифта, поскольку метод [**MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext) еще не был вызван или хаскуррентфиле был установлен в **значение false**, то **жеткуррентфонтфиле** возвратит **E \_ Fail**.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-138">If there is no font file at the current position, because [**MoveNext**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-movenext) has not yet been called or hasCurrentFile was set to **FALSE**, then **GetCurrentFontFile** will return **E\_FAIL**.</span></span>

## <a name="createcustomfontfilereference"></a><span data-ttu-id="f9e8f-139">креатекустомфонтфилереференце</span><span class="sxs-lookup"><span data-stu-id="f9e8f-139">CreateCustomFontFileReference</span></span>

<span data-ttu-id="f9e8f-140">Выходные данные объекта [**идвритефонтфиле**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) с помощью [**жеткуррентфонтфиле**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-getcurrentfontfile) можно создать, вызвав [**идвритефактори:: креатекустомфонтфилереференце**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference).</span><span class="sxs-lookup"><span data-stu-id="f9e8f-140">The [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object output by [**GetCurrentFontFile**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileenumerator-getcurrentfontfile) can be created by calling [**IDWriteFactory::CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference).</span></span> <span data-ttu-id="f9e8f-141">Ключ ссылки на файл шрифта определяет определенную ссылку на файл шрифта и должен быть уникальным в пределах загрузчика файлов шрифтов, который будет загружать файл.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-141">The font file reference key identifies a specific font file reference and must be unique within the font file loader that will load the file.</span></span>

## <a name="idwritefontfileloader"></a><span data-ttu-id="f9e8f-142">идвритефонтфилелоадер</span><span class="sxs-lookup"><span data-stu-id="f9e8f-142">IDWriteFontFileLoader</span></span>

<span data-ttu-id="f9e8f-143">Метод [**креатекустомфонтфилереференце**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) принимает объект [**идвритефонтфилелоадер**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) , реализованный приложением, которое используется для загрузки шрифта.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-143">The [**CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) method takes an [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) object implemented by the application that is used to load the font.</span></span> <span data-ttu-id="f9e8f-144">Методу обратного вызова [**идвритефонтфилелоадер:: креатестреамфромкэй**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileloader-createstreamfromkey) передается ключ и выводится объект [**идвритефонтфилестреам**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) .</span><span class="sxs-lookup"><span data-stu-id="f9e8f-144">The [**IDWriteFontFileLoader::CreateStreamFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileloader-createstreamfromkey) callback method is passed the key and outputs an [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) object.</span></span>

## <a name="idwritefontfilestream"></a><span data-ttu-id="f9e8f-145">идвритефонтфилестреам</span><span class="sxs-lookup"><span data-stu-id="f9e8f-145">IDWriteFontFileStream</span></span>

<span data-ttu-id="f9e8f-146">Объект [**идвритефонтфилестреам**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) , реализованный приложением, предоставляет данные файла шрифта для ссылки на файл шрифта из пользовательского загрузчика файлов шрифтов.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-146">The application-implemented [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) object provides the font file data for a font file reference from a custom font file loader.</span></span> <span data-ttu-id="f9e8f-147">Вместе с размером файла и временем последней записи он предоставляет метод ([**реадфилефрагмент**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfilestream-readfilefragment)) для получения фрагментов файлов, которые должны быть скомпилированы в объект [**идвритефонтфиле**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) .</span><span class="sxs-lookup"><span data-stu-id="f9e8f-147">Together with the file size and last write time, it provides a method ([**ReadFileFragment**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfilestream-readfilefragment)) for retrieving file fragments that are to be compiled into an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object.</span></span>

> [!Note]  
> <span data-ttu-id="f9e8f-148">Реализации [**реадфилефрагмент**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfilestream-readfilefragment) должны возвращать ошибку, если запрошенный фрагмент находится вне границ файла.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-148">[**ReadFileFragment**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfilestream-readfilefragment) implementations should return an error if the requested fragment is outside the file bounds.</span></span>

 

<span data-ttu-id="f9e8f-149">[**Идвритефонтфилестреам**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) может получать содержимое файла шрифта из любого места, например с локального жесткого диска или из внедренных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="f9e8f-149">An [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) can get the font file contents from anywhere, such as the local hard disk drive, or embedded resources.</span></span>

 

 