---
title: Вертикальный текст
description: Начиная с Windows 8, DirectWrite имеет ряд новых API, позволяющих использовать вертикальный текст в приложениях.
ms.assetid: F40A79AE-F7BF-4CAC-9480-1489CD212DA8
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0db8788a6be97a55911694942a930e17dc69976a
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103987554"
---
# <a name="vertical-text"></a><span data-ttu-id="84727-103">Вертикальный текст</span><span class="sxs-lookup"><span data-stu-id="84727-103">Vertical Text</span></span>

<span data-ttu-id="84727-104">Начиная с Windows 8, [DirectWrite](direct-write-portal.md) имеет ряд новых API, позволяющих использовать вертикальный текст в приложениях.</span><span class="sxs-lookup"><span data-stu-id="84727-104">Starting with the Windows 8, [DirectWrite](direct-write-portal.md) has a number of new APIs that allow you to use vertical text in your apps.</span></span>

## <a name="drawing-vertical-text"></a><span data-ttu-id="84727-105">Рисование вертикального текста</span><span class="sxs-lookup"><span data-stu-id="84727-105">Drawing vertical text</span></span>

<span data-ttu-id="84727-106">Можно нарисовать вертикальный текст с помощью Direct2D, используя методы [**дравтекстлайаут**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) .</span><span class="sxs-lookup"><span data-stu-id="84727-106">You can draw vertical text with Direct2D by using the [**DrawTextLayout**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) methods.</span></span> <span data-ttu-id="84727-107">Чтобы нарисовать текст по вертикали, передайте [**дврите \_ \_ направление чтения \_ сверху \_ \_ вниз**](/windows/win32/api/dwrite/ne-dwrite-dwrite_reading_direction) в метод [**идвритетекстформат:: сетреадингдиректион**](/windows/win32/api/dwrite/nf-dwrite-idwritetextformat-setreadingdirection) и [**\_ направление потока дврите \_ \_ прямо \_ \_ влево**](/windows/win32/api/dwrite/ne-dwrite-dwrite_flow_direction) к методу [**идвритетекстформатсетфловдиректион**](/windows/win32/api/dwrite/nf-dwrite-idwritetextformat-setflowdirection) .</span><span class="sxs-lookup"><span data-stu-id="84727-107">To draw the text vertically, pass [**DWRITE\_READING\_DIRECTION\_TOP\_TO\_BOTTOM**](/windows/win32/api/dwrite/ne-dwrite-dwrite_reading_direction) to the [**IDWriteTextFormat::SetReadingDirection**](/windows/win32/api/dwrite/nf-dwrite-idwritetextformat-setreadingdirection) method and [**DWRITE\_FLOW\_DIRECTION\_RIGHT\_TO\_LEFT**](/windows/win32/api/dwrite/ne-dwrite-dwrite_flow_direction) to the [**IDWriteTextFormatSetFlowDirection**](/windows/win32/api/dwrite/nf-dwrite-idwritetextformat-setflowdirection) method.</span></span> <span data-ttu-id="84727-108">Затем можно создать и нарисовать вертикальный объект [**идвритетекстлайаут**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout) .</span><span class="sxs-lookup"><span data-stu-id="84727-108">Then you can create and draw a vertical [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout) object.</span></span>

## <a name="analyzing-character-orientation"></a><span data-ttu-id="84727-109">Анализ ориентации символов</span><span class="sxs-lookup"><span data-stu-id="84727-109">Analyzing character orientation</span></span>

<span data-ttu-id="84727-110">Каждый символ имеет предпочтительную ориентацию символов или направление, в котором этот символ должен быть ориентирован на любой направленный макет.</span><span class="sxs-lookup"><span data-stu-id="84727-110">Every character has a preferred character orientation, or the direction that the character should be oriented in any directional layout.</span></span> <span data-ttu-id="84727-111">Например, в традиционном горизонтальном макете текст на китайском языке и текст для китайского языка ориентированы вертикально.</span><span class="sxs-lookup"><span data-stu-id="84727-111">For example, in traditional horizontal layout, both the Latin text and the Chinese text are oriented vertically.</span></span> <span data-ttu-id="84727-112">С другой стороны, в вертикальном макете текст на китайском языке остается вертикальным, а Латинский текст поворачивается в 90 градусов.</span><span class="sxs-lookup"><span data-stu-id="84727-112">On the other hand, in a vertical layout, the Chinese text remains upright, and the Latin text is rotated 90 degrees.</span></span> <span data-ttu-id="84727-113">Это различие в ориентации рассматривается в этом примере.</span><span class="sxs-lookup"><span data-stu-id="84727-113">This difference in orientation is seen in the example here.</span></span>

![изображение английского и китайского текста в горизонтальном и вертикальном макетах.](images/vertical-text.png)

<span data-ttu-id="84727-115">Чтобы определить ориентацию текста, необходимо реализовать интерфейсы [**IDWriteTextAnalysisSink1**](/windows/win32/api/dwrite_1/nn-dwrite_1-idwritetextanalysissink1) и [**IDWriteTextAnalysisSource1**](/windows/win32/api/dwrite_1/nn-dwrite_1-idwritetextanalysissource1) .</span><span class="sxs-lookup"><span data-stu-id="84727-115">To determine the orientation of the text you have, you need to implement the [**IDWriteTextAnalysisSink1**](/windows/win32/api/dwrite_1/nn-dwrite_1-idwritetextanalysissink1) and [**IDWriteTextAnalysisSource1**](/windows/win32/api/dwrite_1/nn-dwrite_1-idwritetextanalysissource1) interfaces.</span></span> <span data-ttu-id="84727-116">Источник и приемник принимают глифы и позволяют проверить их ориентацию по вертикали.</span><span class="sxs-lookup"><span data-stu-id="84727-116">The source and sink take in the glyph runs and let you check if they are oriented vertically or not.</span></span>

<span data-ttu-id="84727-117">После реализации источника и приемника вызовите метод [**анализевертикалглифориентатион**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritetextanalyzer1-analyzeverticalglyphorientation) .</span><span class="sxs-lookup"><span data-stu-id="84727-117">After you implement your source and sink, you call the [**AnalyzeVerticalGlyphOrientation**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritetextanalyzer1-analyzeverticalglyphorientation) method.</span></span> <span data-ttu-id="84727-118">В примере образа эта функция возвращает 3 выполнения: "Английский", "中国" и "Английский".</span><span class="sxs-lookup"><span data-stu-id="84727-118">In the example image, this function returns 3 runs: "English", "中国", and "English."</span></span>

## <a name="going-from-characters-to-glyphs"></a><span data-ttu-id="84727-119">Переход от символов к глифам</span><span class="sxs-lookup"><span data-stu-id="84727-119">Going from characters to glyphs</span></span>

<span data-ttu-id="84727-120">Теперь, когда вы уверены, что выполнение содержит вертикальные глифы, необходимо получить доступ к этим глифам.</span><span class="sxs-lookup"><span data-stu-id="84727-120">Now that you know the run contains vertical glyphs, you need to get access to those glyphs.</span></span> <span data-ttu-id="84727-121">В приведенном выше примере существует 3 запуска: один с вертикальными глифами и два без.</span><span class="sxs-lookup"><span data-stu-id="84727-121">In the example so far, there are 3 runs: one with vertical glyphs and two without.</span></span> <span data-ttu-id="84727-122">Чтобы перейти от символов к глифам, вызовите [**жетглифиндицес**](/windows/win32/api/dwrite/nf-dwrite-idwritefontface-getglyphindices).</span><span class="sxs-lookup"><span data-stu-id="84727-122">To transition from characters to glyphs, you call [**GetGlyphIndices**](/windows/win32/api/dwrite/nf-dwrite-idwritefontface-getglyphindices).</span></span> <span data-ttu-id="84727-123">Этот метод возвращает соответствующие индексы глифов для символов в примере.</span><span class="sxs-lookup"><span data-stu-id="84727-123">This method returns the corresponding glyph indices for the characters in the example.</span></span> <span data-ttu-id="84727-124">Поскольку метод [**анализевертикалглифориентатион**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritetextanalyzer1-analyzeverticalglyphorientation) возвращает запуск с вертикальными глифами, необходимо вызвать [**жетвертикалглифвариантс**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritefontface1-getverticalglyphvariants), возвращающий вертикально ориентированные идентификаторы глифов вместо текущих идентификаторов глифов.</span><span class="sxs-lookup"><span data-stu-id="84727-124">Because the [**AnalyzeVerticalGlyphOrientation**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritetextanalyzer1-analyzeverticalglyphorientation) method returns a run with vertical glyphs, you need to call [**GetVerticalGlyphVariants**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritefontface1-getverticalglyphvariants), which returns the vertically oriented glyph IDs in place of the current glyph IDs.</span></span>

## <a name="drawing-text-vertically"></a><span data-ttu-id="84727-125">Рисование текста по вертикали</span><span class="sxs-lookup"><span data-stu-id="84727-125">Drawing text vertically</span></span>

<span data-ttu-id="84727-126">Наконец, необходимо разместить и нарисовать текст.</span><span class="sxs-lookup"><span data-stu-id="84727-126">Finally, you need to lay out and draw the text.</span></span> <span data-ttu-id="84727-127">Поскольку текст рисуется по вертикали, необходимо получить дополнительные сведения, чтобы текст латиницы был правильно выведен.</span><span class="sxs-lookup"><span data-stu-id="84727-127">Because you're drawing the text vertically, you need to get some more info so that the Latin text is drawn correctly.</span></span> <span data-ttu-id="84727-128">Если нарисовать весь текст на центральном базовом плане, то текст латиницы будет переводиться в середину строки.</span><span class="sxs-lookup"><span data-stu-id="84727-128">If you draw all of the text along the central baseline, the Latin text appears to float in the middle of the line.</span></span> <span data-ttu-id="84727-129">Для правильного согласования текста необходимо иметь доступ как к центральному, так и к базовому показателю латиницы.</span><span class="sxs-lookup"><span data-stu-id="84727-129">You need access to both the central and Roman baseline to align the text correctly.</span></span> <span data-ttu-id="84727-130">Используйте метод [**IDWriteTextAnalyzer1:: Onbaseline**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritetextanalyzer1-getbaseline) , чтобы получить числовые значения указанных базовых показателей.</span><span class="sxs-lookup"><span data-stu-id="84727-130">Use the [**IDWriteTextAnalyzer1::GetBaseline**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritetextanalyzer1-getbaseline) method to get the numerical values of the baselines you specify.</span></span> <span data-ttu-id="84727-131">Можно вычесть базовый план латиницы из центрального базового плана, чтобы получить смещение между ними.</span><span class="sxs-lookup"><span data-stu-id="84727-131">You can subtract the Roman baseline from the central baseline to get the offset between the two.</span></span>

<span data-ttu-id="84727-132">Все эти сведения позволяют нарисовать текст на экране.</span><span class="sxs-lookup"><span data-stu-id="84727-132">With all this info, you can draw the text on the screen.</span></span> <span data-ttu-id="84727-133">Сначала вызовите метод [**жетглифориентатионтрансформ**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritetextanalyzer1-getglyphorientationtransform) с результатами объектов [**IDWriteTextAnalysisSink1**](/windows/win32/api/dwrite_1/nn-dwrite_1-idwritetextanalysissink1) и [**IDWriteTextAnalysisSource1**](/windows/win32/api/dwrite_1/nn-dwrite_1-idwritetextanalysissource1) .</span><span class="sxs-lookup"><span data-stu-id="84727-133">First, call the [**GetGlyphOrientationTransform**](/windows/win32/api/dwrite_1/nf-dwrite_1-idwritetextanalyzer1-getglyphorientationtransform) method with the results from the [**IDWriteTextAnalysisSink1**](/windows/win32/api/dwrite_1/nn-dwrite_1-idwritetextanalysissink1) and [**IDWriteTextAnalysisSource1**](/windows/win32/api/dwrite_1/nn-dwrite_1-idwritetextanalysissource1) objects.</span></span>

<span data-ttu-id="84727-134">Если вы используете [Direct2D](rendering-by-using-direct2d.md) , необходимо также задать универсальное преобразование для целевого объекта отрисовки Direct2D для вертикальной отрисовки.</span><span class="sxs-lookup"><span data-stu-id="84727-134">If you’re using [Direct2D](rendering-by-using-direct2d.md) you also need to set the world transform on the Direct2D render target for vertical rendering.</span></span>

<span data-ttu-id="84727-135">Наконец, вызовите [**DrawGlyphRun**](/windows/win32/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun) три раза, один раз для каждого блока текста.</span><span class="sxs-lookup"><span data-stu-id="84727-135">Finally, call [**DrawGlyphRun**](/windows/win32/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun) three times, once on each block of text.</span></span> <span data-ttu-id="84727-136">На двух блоках текста, находящихся на английском языке, необходимо применить смещение, которое вычисляется между линиями латиницы и центральными планами.</span><span class="sxs-lookup"><span data-stu-id="84727-136">On the two blocks of text that are in English, you need to apply the offset that we calculated between the Roman and central baselines.</span></span>

<span data-ttu-id="84727-137">Теперь текст в приложении будет отображаться вертикально с правильной ориентацией на глифы.</span><span class="sxs-lookup"><span data-stu-id="84727-137">Now, the text in your app will be drawn vertically, with the correct glyph orientation.</span></span>

 

 