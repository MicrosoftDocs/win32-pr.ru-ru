---
title: Вспомогательные токены для заданий передачи BITS
description: Вспомогательные токены для заданий передачи BITS
ms.assetid: f29f9870-e406-472b-9342-203def7453ae
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 52925a6e0d5a9601e21848d514214bfb843f6246
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104488260"
---
# <a name="helper-tokens-for-bits-transfer-jobs"></a>Вспомогательные токены для заданий передачи BITS

В Windows Vista служба фоновая интеллектуальная служба передачи (BITS) позволяет приложению связать один маркер безопасности с заданием передачи BITS. Затем задание передачи BITS использует этот маркер для проверки подлинности и доступа к локальным и удаленным ресурсам.

В Windows 7 служба BITS связывает дополнительный маркер с заданием передачи BITS. Задание передачи BITS можно настроить с помощью дополнительного маркера безопасности, который является маркером олицетворения, созданным приложением, вызывающим API-интерфейс BITS. Эта модель вспомогательных токенов позволяет приложениям одновременно использовать два разных маркера безопасности для доступа к локальным файлам, сертификатам на стороне клиента, удаленным файлам и прокси-серверам. Например, создается задание передачи BITS, которое записывает Скачанные данные в привилегированный локальный каталог, а затем предоставляет удостоверение домена с низким уровнем прав для HTTP-сервера и прокси-сервера.

Приложение, как правило, служба Windows, указывает вспомогательный токен с помощью нового интерфейса [**ибитстокеноптионс**](/windows/desktop/api/Bits4_0/nn-bits4_0-ibitstokenoptions). Этот интерфейс реализуется с помощью объекта задания BITS. Приложение вызывает [**использованием метода ibackgroundcopyjob:: QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) для получения указателя интерфейса. Приложение олицетворяет вспомогательное удостоверение и вызывает [**ибитстокеноптионс:: сеселпертокен**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) для передачи маркера службе BITS. Затем приложение определяет ресурсы, к которым применяется маркер, передавая набор битовых флагов с помощью [**ибитстокеноптионс:: сеселпертокенфлагс**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags). Приложение очищает все флаги (с помощью **сеселпертокенфлагс** повторно), чтобы отменить это поведение. Служба BITS сохраняет битовые флаги и маркер в задании передачи BITS.

Когда владелец заданий передачи BITS выходит из системы, служба BITS отклоняет все вспомогательные маркеры, связанные с заданием передачи. Если перемещение не завершено, служба BITS помещает задание в состояние ошибки с помощью **\_ маркера BG E, \_ \_ необходимого** код ошибки, и удаляет вспомогательный токен. Клиентское приложение может обновить маркер, вызвав [**ибитстокеноптионс:: сеселпертокен**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) , а затем возобновить задание передачи BITS. Кроме того, клиентское приложение может очистить флаги вспомогательного маркера с помощью [**ибитстокеноптионс:: сеселпертокенфлагс**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags) , а затем возобновить задание на перемещение без вспомогательного токена.

Аналогичным образом, когда владелец сеанса служб терминалов выходит из системы, служба BITS должна удалить все вспомогательные токены из этого сеанса и поместить затронутые задания передачи в состояние ошибки с помощью **\_ \_ маркера BG \_ E** .

Для модели вспомогательного токена требуется изменение политики управления доступом к службе BITS. Предыдущие версии BITS реализовали проверки доступа при каждом вызове метода. Начиная с Windows 7 Проверка доступа должна выполняться внутри вызова [**использованием метода ibackgroundcopyjob:: QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) ; в противном случае вспомогательный токен может не иметь доступа к заданию перемещения.

> [!Note]  
> Более ранние реализации фактически требовали, чтобы пользователи службы BITS имели права администратора для установки вспомогательных маркеров. Начиная с Windows 10 версии 1607, пользователи, не являющиеся администраторами, могут использовать [**ибитстокеноптионс:: сеселпертокен**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) , чтобы задать вспомогательные токены без прав администратора в заданиях BITS, которыми они владеют. Это изменение позволяет пользователям BITS без прав администратора (например, службы фонового загрузчика, работающие под [учетной записью NetworkService](/windows/desktop/Services/networkservice-account)) задавать вспомогательные токены.
>
> В частности, реализация была изменена, чтобы разрешить пользователям без прав администратора настраивать вспомогательные маркеры, если выполняются следующие условия.
>
> -   во время вызова [**использованием метода ibackgroundcopyjob:: QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) идентификатор безопасности маркера среад'с вызывающего объекта совпадает с идентификатором безопасности учетной записи владельца задания.
> -   При вызове [**ибитстокеноптионс:: сеселпертокен**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) маркер вспомогательного приложения не имеет идентификатора безопасности администратора (**\_ псевдонимы домена \_ RID \_**).

 

## <a name="related-topics"></a>См. также

<dl> <dt>

[**ибитстокеноптионс**](/windows/desktop/api/Bits4_0/nn-bits4_0-ibitstokenoptions)
</dt> </dl>

 

 