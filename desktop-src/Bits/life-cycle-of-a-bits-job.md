---
title: Жизненный цикл задания BITS
description: Жизненный цикл задания BITS начинается при создании задания.
ms.assetid: b765a8ef-74bd-475e-9cd9-e9e2cf4f0305
ms.topic: article
ms.date: 11/13/2018
ms.openlocfilehash: c6ac23c598d28681968e9c0cbed776ba24c57e98
ms.sourcegitcommit: de72a1294df274b0a71dc0fdc42d757e5f6df0f3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "105656735"
---
# <a name="bits-job-states"></a><span data-ttu-id="15cdd-103">Состояния задания BITS</span><span class="sxs-lookup"><span data-stu-id="15cdd-103">BITS Job states</span></span>
<span data-ttu-id="15cdd-104">Существует четыре класса [**состояний**](/windows/desktop/api/Bits/ne-bits-bg_job_state)BITS: запуск, действие, передача и завершение.</span><span class="sxs-lookup"><span data-stu-id="15cdd-104">There are four classes of BITS [**states**](/windows/desktop/api/Bits/ne-bits-bg_job_state): starting, action, transferred, and final.</span></span> <span data-ttu-id="15cdd-105">При выполнении задания оно переходит между состояниями в разных классах состояний.</span><span class="sxs-lookup"><span data-stu-id="15cdd-105">As a job runs, it transitions between states in the different state classes.</span></span> <span data-ttu-id="15cdd-106">Когда задание находится в окончательном состоянии, оно не будет переноситься из конечного состояния и не будет отображаться в [перечислении заданий](/windows/desktop/api/bits/nf-bits-ibackgroundcopymanager-enumjobs).</span><span class="sxs-lookup"><span data-stu-id="15cdd-106">Once a job is in a final state, it won't move out of the final state and won't show up in a [job enumeration](/windows/desktop/api/bits/nf-bits-ibackgroundcopymanager-enumjobs).</span></span>

## <a name="state-changing-methods"></a><span data-ttu-id="15cdd-107">Методы изменения состояния</span><span class="sxs-lookup"><span data-stu-id="15cdd-107">State-changing methods</span></span>
<span data-ttu-id="15cdd-108">Существует четыре метода изменения состояния для задания: [**Отмена**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-cancel), [**Завершение**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-complete), [**возобновление**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-resume)и [**приостановка**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-suspend).</span><span class="sxs-lookup"><span data-stu-id="15cdd-108">There are four state-changing methods on a job: [**Cancel**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-cancel), [**Complete**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-complete), [**Resume**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-resume), and [**Suspend**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-suspend).</span></span> <span data-ttu-id="15cdd-109">Пока задание не находится в окончательном состоянии, можно вызвать любой из методов изменения состояния.</span><span class="sxs-lookup"><span data-stu-id="15cdd-109">As long as a job is not in a final state, you can call any of the state-changing methods.</span></span> 

<span data-ttu-id="15cdd-110">Метод [**Suspend**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-suspend) используется для переключения задания в состояние SUSPENDED.</span><span class="sxs-lookup"><span data-stu-id="15cdd-110">The [**Suspend**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-suspend) method is used to switch a job to the SUSPENDED state.</span></span> <span data-ttu-id="15cdd-111">При приостановке задания все его передачи будут остановлены и не будут возобновлены до тех пор, пока не будет вызвано возобновление.</span><span class="sxs-lookup"><span data-stu-id="15cdd-111">When a job is suspended, all of its transfers will be stopped and won't resume until you call Resume.</span></span>
<span data-ttu-id="15cdd-112">Уже приостановленное задание будет просто оставаться приостановленным.</span><span class="sxs-lookup"><span data-stu-id="15cdd-112">A job that's already suspended will simply stay suspended.</span></span>

<span data-ttu-id="15cdd-113">Метод [**Resume**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-resume) используется для запуска приостановленного задания.</span><span class="sxs-lookup"><span data-stu-id="15cdd-113">The [**Resume**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-resume) method is used to start a job that's suspended.</span></span> <span data-ttu-id="15cdd-114">Задания в состоянии ошибки или временной ошибки будут настроены для повторной попытки.</span><span class="sxs-lookup"><span data-stu-id="15cdd-114">Jobs in an error or transient error state will be set up to be retried.</span></span> <span data-ttu-id="15cdd-115">Задания, которые в настоящее время находятся в состоянии действия, останутся в этом состоянии.</span><span class="sxs-lookup"><span data-stu-id="15cdd-115">Jobs that are currently in an action state will stay in that state.</span></span>

<span data-ttu-id="15cdd-116">Метод [**Cancel**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-cancel) используется для отмены задания.</span><span class="sxs-lookup"><span data-stu-id="15cdd-116">The [**Cancel**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-cancel) method is used to cancel a job.</span></span> <span data-ttu-id="15cdd-117">Состояние будет переключаться на отменено.</span><span class="sxs-lookup"><span data-stu-id="15cdd-117">The state will switch to cancelled.</span></span> <span data-ttu-id="15cdd-118">Все файлы, передаваемые в данный момент, не будут завершены.</span><span class="sxs-lookup"><span data-stu-id="15cdd-118">Any files currently being transferred will not be completed.</span></span> <span data-ttu-id="15cdd-119">Все полностью переданные и частично перенесенные файлы будут удалены.</span><span class="sxs-lookup"><span data-stu-id="15cdd-119">All completely transferred and partially transferred files will be deleted.</span></span>

<span data-ttu-id="15cdd-120">Метод [**Complete**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-complete) завершит перенос.</span><span class="sxs-lookup"><span data-stu-id="15cdd-120">The [**Complete**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-complete) method will finish a transfer.</span></span> <span data-ttu-id="15cdd-121">Все полностью скачанные файлы будут сохранены; файлы, которые не были полностью переданы, будут удалены.</span><span class="sxs-lookup"><span data-stu-id="15cdd-121">Any fully downloaded files will be kept; files that are not fully transferred will be deleted.</span></span>

<span data-ttu-id="15cdd-122">Чтобы переместить задание в конечное состояние и очистить его, необходимо вызвать либо Cancel, либо Complete.</span><span class="sxs-lookup"><span data-stu-id="15cdd-122">You must call either Cancel or Complete to move your job to a final state and be cleaned up.</span></span> <span data-ttu-id="15cdd-123">Задания, которые не переходят в конечное состояние, занимают системные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="15cdd-123">Jobs that aren't transitioned to a final state will waste system resources.</span></span> <span data-ttu-id="15cdd-124">В конечном итоге службы BITS автоматически отменяют старые задания.</span><span class="sxs-lookup"><span data-stu-id="15cdd-124">BITS will eventually automatically cancel old jobs.</span></span> <span data-ttu-id="15cdd-125">По умолчанию [жобинактивититимеаут](/windows/desktop/Bits/group-policies) отменяет задания через 90 дней.</span><span class="sxs-lookup"><span data-stu-id="15cdd-125">The default [JobInactivityTimeout](/windows/desktop/Bits/group-policies) is to cancel jobs after 90 days.</span></span>


## <a name="starting-state"></a><span data-ttu-id="15cdd-126">Начальное состояние</span><span class="sxs-lookup"><span data-stu-id="15cdd-126">Starting state</span></span> 
<span data-ttu-id="15cdd-127">Начальное состояние **приостановлено**.</span><span class="sxs-lookup"><span data-stu-id="15cdd-127">The starting state is **SUSPENDED**.</span></span> <span data-ttu-id="15cdd-128">Здесь можно добавить файлы в задание и задать свойства задания и файла.</span><span class="sxs-lookup"><span data-stu-id="15cdd-128">From here, you can add files to the job and set job and file properties.</span></span> <span data-ttu-id="15cdd-129">Чтобы начать передачу задания, вызовите функцию Resume для задания.</span><span class="sxs-lookup"><span data-stu-id="15cdd-129">To start a job transferring, call Resume on the job.</span></span> <span data-ttu-id="15cdd-130">Если возобновить задание без файлов, оно вернет BG_E_EMPTY код ошибки, и задание останется приостановленным.</span><span class="sxs-lookup"><span data-stu-id="15cdd-130">If you resume a job with no files, it will return a BG_E_EMPTY error code and the job will stay suspended.</span></span>

## <a name="action-states"></a><span data-ttu-id="15cdd-131">Состояния действий</span><span class="sxs-lookup"><span data-stu-id="15cdd-131">Action states</span></span>
<span data-ttu-id="15cdd-132">В **очереди**, **подключении** и **передаче** состояний отображается текущее внутреннее действие задания.</span><span class="sxs-lookup"><span data-stu-id="15cdd-132">The **QUEUED**, **CONNECTING** and **TRANSFERRING** states show the current internal activity of your job.</span></span> <span data-ttu-id="15cdd-133">Задание, поставленное в очередь, готово к планированию, возможно, ожидание планировщика BITS или ожидание входа пользователя в систему.</span><span class="sxs-lookup"><span data-stu-id="15cdd-133">A job that's QUEUED is ready to be scheduled, possibly waiting for the BITS scheduler or waiting for the user to log in.</span></span> <span data-ttu-id="15cdd-134">Задание, которое ПОДКЛЮЧАЕТся, пытается подключиться к серверу, чтобы начать передачу файлов.</span><span class="sxs-lookup"><span data-stu-id="15cdd-134">A job that's CONNECTING is attempting to connect to the server to start transferring files.</span></span> <span data-ttu-id="15cdd-135">Переданное задание активно отправляет или скачивает файлы.</span><span class="sxs-lookup"><span data-stu-id="15cdd-135">A job that's TRANSFERRING is actively uploading or downloading your files.</span></span>

<span data-ttu-id="15cdd-136">Состояние **временной ошибки** означает, что задание попыталось выполнить и не смогло передать файл.</span><span class="sxs-lookup"><span data-stu-id="15cdd-136">The **TRANSIENT ERROR** state means that the job tried and failed to transfer the file.</span></span> <span data-ttu-id="15cdd-137">Это может быть вызвано причинами сетевой политики. Задание может быть заблокировано, так как текущая сеть слишком высока.</span><span class="sxs-lookup"><span data-stu-id="15cdd-137">This might be for network policy reasons; the job might be blocked because the current network is too expensive.</span></span> <span data-ttu-id="15cdd-138">Она также может быть заблокирована по причинам системы, например в режиме экономии заряда аккумулятора или игровой режим, либо из-за отсутствия подключения к Интернету.</span><span class="sxs-lookup"><span data-stu-id="15cdd-138">It might also be blocked for system reasons like the system being in battery saver or game mode, or because there's no internet connectivity.</span></span> 

<span data-ttu-id="15cdd-139">Задания в состоянии временной ошибки будут автоматически предприняты BITS при необходимости.</span><span class="sxs-lookup"><span data-stu-id="15cdd-139">Jobs in the transient error state will be retried automatically by BITS when appropriate.</span></span> <span data-ttu-id="15cdd-140">Служба BITS включает значение [минимумретриделай](/windows/desktop/api/bits/nf-bits-ibackgroundcopyjob-setminimumretrydelay) и [нопрогресстимеаут](/windows/desktop/api/bits/nf-bits-ibackgroundcopyjob-setnoprogresstimeout) , которое позволяет управлять повторным выполнением задания, а также когда служба BITS прекращает повторную попытку.</span><span class="sxs-lookup"><span data-stu-id="15cdd-140">BITS includes a [MinimumRetryDelay](/windows/desktop/api/bits/nf-bits-ibackgroundcopyjob-setminimumretrydelay) and [NoProgressTimeout](/windows/desktop/api/bits/nf-bits-ibackgroundcopyjob-setnoprogresstimeout) value to control when a job is retried and when BITS will finally stop retrying.</span></span>


## <a name="transferred-states"></a><span data-ttu-id="15cdd-141">Перенесенные состояния</span><span class="sxs-lookup"><span data-stu-id="15cdd-141">Transferred states</span></span>
<span data-ttu-id="15cdd-142">Переданные состояния происходят, когда больше не требуется выполнять передачу.</span><span class="sxs-lookup"><span data-stu-id="15cdd-142">The transferred states happen when there's no more transferring to be done.</span></span> <span data-ttu-id="15cdd-143">Необходимо либо отменить, либо завершить задание в этом состоянии.</span><span class="sxs-lookup"><span data-stu-id="15cdd-143">You must either cancel or complete a job in this state.</span></span> <span data-ttu-id="15cdd-144">Вы также можете добавить дополнительные файлы для перемещения и вызвать Resume (), но это не является распространенной практикой.</span><span class="sxs-lookup"><span data-stu-id="15cdd-144">You may also add more files to transfer and call Resume(), but this isn't a common practice.</span></span>

<span data-ttu-id="15cdd-145">Состояние **ошибки** возникает, когда операция перемещения выполнена (она не будет выполнена повторно), но не была полностью завершена.</span><span class="sxs-lookup"><span data-stu-id="15cdd-145">The **ERROR** state happens when a transfer is done (it won't be retried), but didn't fully succeed.</span></span> <span data-ttu-id="15cdd-146">Все файлы должны быть успешно переданы для успешного выполнения; если таковые имеются, то задание будет содержать ошибку.</span><span class="sxs-lookup"><span data-stu-id="15cdd-146">All the files must be transferred to be successful; if any have permanently failed the job will be in error.</span></span> <span data-ttu-id="15cdd-147">Как правило, вы вызываете Cancel или Complete, чтобы переместить задание в конечное состояние.</span><span class="sxs-lookup"><span data-stu-id="15cdd-147">You will typically either call Cancel or Complete to move the job to a final state.</span></span> <span data-ttu-id="15cdd-148">Практическая разница заключается в том, что при вызове Cancel любой успешно переданный файл будет удален, но если вызов завершен, любой успешно передаваемый файл не будет удален.</span><span class="sxs-lookup"><span data-stu-id="15cdd-148">The practical difference is that when you call Cancel, any successfully transferred file will be deleted, but if you call Complete, any successfully transferred file will not be deleted.</span></span>

<span data-ttu-id="15cdd-149">Причины в состоянии ошибки:</span><span class="sxs-lookup"><span data-stu-id="15cdd-149">Reasons for being in an ERROR state include</span></span> 
* <span data-ttu-id="15cdd-150">Сохранение слишком длинного состояния во ВРЕМЕННОм состоянии ошибки (за пределами параметра [нопрогресстимеаут](/windows/desktop/api/bits/nf-bits-ibackgroundcopyjob-setnoprogresstimeout) ).</span><span class="sxs-lookup"><span data-stu-id="15cdd-150">Staying too long in a TRANSIENT ERROR state (beyond the [NoProgressTimeout](/windows/desktop/api/bits/nf-bits-ibackgroundcopyjob-setnoprogresstimeout) setting).</span></span>
* <span data-ttu-id="15cdd-151">Получение BG_E_TOKEN_REQUIRED ошибки и потребовать помощи с [вспомогательными маркерами](/windows/desktop/Bits/helper-tokens-for-bits-transfer-jobs)</span><span class="sxs-lookup"><span data-stu-id="15cdd-151">Getting a BG_E_TOKEN_REQUIRED error and needing assistance with [helper tokens](/windows/desktop/Bits/helper-tokens-for-bits-transfer-jobs)</span></span>

<span data-ttu-id="15cdd-152">Распространенной практикой является перенастройка задания с ошибкой, а затем вызов Resume для повторного выполнения задания.</span><span class="sxs-lookup"><span data-stu-id="15cdd-152">It's a common practice to reconfigure an ERROR'd job and then call Resume to retry the job.</span></span> <span data-ttu-id="15cdd-153">Например, приложению может потребоваться обновить удаленное имя файла через [сетремотенаме](/windows/desktop/api/bits2_0/nf-bits2_0-ibackgroundcopyfile2-setremotename).</span><span class="sxs-lookup"><span data-stu-id="15cdd-153">For example, your app might need to update a file's remote name via [SetRemoteName](/windows/desktop/api/bits2_0/nf-bits2_0-ibackgroundcopyfile2-setremotename).</span></span>

<span data-ttu-id="15cdd-154">Переданное **состояние происходит, когда** передача выполнена и прошла успех.</span><span class="sxs-lookup"><span data-stu-id="15cdd-154">The **TRANSFERRED** state happens when a transfer is done and it succeeded.</span></span> <span data-ttu-id="15cdd-155">Чтобы завершить задание, необходимо вызвать функцию Complete. для заданий скачивания Скачанные файлы будут недоступны до тех пор, пока не будет выполнен вызов функции Complete.</span><span class="sxs-lookup"><span data-stu-id="15cdd-155">You must call Complete to finalize the job; for download jobs the downloaded files won't be available until after you call Complete.</span></span> <span data-ttu-id="15cdd-156">Исключением из этого правила являются задания, которые являются заданиями высокой производительности (и по-прежнему вызывают завершение).</span><span class="sxs-lookup"><span data-stu-id="15cdd-156">The exception to this rule is jobs which are the high performance jobs (and you should still call Complete).</span></span>

## <a name="final-states"></a><span data-ttu-id="15cdd-157">Окончательные состояния</span><span class="sxs-lookup"><span data-stu-id="15cdd-157">Final states</span></span>
<span data-ttu-id="15cdd-158">Когда задание находится в конечном состоянии, нельзя вызывать методы изменения состояния.</span><span class="sxs-lookup"><span data-stu-id="15cdd-158">Once a job is in a final state, you can't call any of the state-changing methods.</span></span> <span data-ttu-id="15cdd-159">Задание будет **подтверждено** после вызова функции Complete (), и все готовые Скачанные файлы будут доступны.</span><span class="sxs-lookup"><span data-stu-id="15cdd-159">The job will be **ACKNOWLEDGED** after you call Complete() and all completed downloaded files will be available.</span></span> <span data-ttu-id="15cdd-160">Задание будет **отменено** после вызова Cancel (), и все скачанные файлы будут удалены.</span><span class="sxs-lookup"><span data-stu-id="15cdd-160">The job will be **CANCELLED** after you call Cancel() and all downloaded files will be deleted.</span></span> 


## <a name="life-cycle-of-a-bits-job"></a><span data-ttu-id="15cdd-161">Жизненный цикл задания BITS</span><span class="sxs-lookup"><span data-stu-id="15cdd-161">Life Cycle of a BITS job</span></span>

<span data-ttu-id="15cdd-162">Жизненный цикл задания BITS начинается при создании задания.</span><span class="sxs-lookup"><span data-stu-id="15cdd-162">The life cycle of a BITS job begins when you create a job.</span></span> <span data-ttu-id="15cdd-163">Задание — это контейнер, содержащий один или несколько файлов для перемещения.</span><span class="sxs-lookup"><span data-stu-id="15cdd-163">A job is a container that contains one or more files to transfer.</span></span> <span data-ttu-id="15cdd-164">Задание также имеет свойства, указывающие, как BITS передает файлы и взаимодействует с приложением.</span><span class="sxs-lookup"><span data-stu-id="15cdd-164">A job also has properties that specify how BITS transfers the files and interacts with your application.</span></span> <span data-ttu-id="15cdd-165">Например, можно указать приоритет задания, будь это задание отправки или загрузки, а также события, для которых необходимо получить уведомления.</span><span class="sxs-lookup"><span data-stu-id="15cdd-165">For example, you can specify the priority of the job, whether the job is an upload or download job, and for which events you want to receive notification.</span></span>

<span data-ttu-id="15cdd-166">После создания задания добавьте один или несколько файлов (задания отправки могут содержать только один файл) в задание и измените любые значения свойств в соответствии с вашими приложениями.</span><span class="sxs-lookup"><span data-stu-id="15cdd-166">After you create the job, add one or more files (upload jobs can contain only one file) to the job and change any of the property values as appropriate for your application.</span></span> <span data-ttu-id="15cdd-167">При добавлении файла в задание укажите как локальное (клиент), так и удаленное (серверное) имя файла.</span><span class="sxs-lookup"><span data-stu-id="15cdd-167">When you add a file to the job, specify both the local (client) and remote (server) name of the file.</span></span> <span data-ttu-id="15cdd-168">Имя удаленного файла должно использовать протокол HTTP, HTTPS или SMB.</span><span class="sxs-lookup"><span data-stu-id="15cdd-168">The remote file name must use the HTTP, HTTPS, or SMB protocol.</span></span> <span data-ttu-id="15cdd-169">Файлы в задании обрабатываются последовательно (сначала в, сначала исходящий трафик).</span><span class="sxs-lookup"><span data-stu-id="15cdd-169">Files within a job are processed sequentially (first in, first out).</span></span>

<span data-ttu-id="15cdd-170">Служба BITS автоматически приостанавливает задания при их создании.</span><span class="sxs-lookup"><span data-stu-id="15cdd-170">BITS automatically suspends jobs when they are created.</span></span> <span data-ttu-id="15cdd-171">Необходимо возобновить задание, чтобы активировать его в очереди на перемещение.</span><span class="sxs-lookup"><span data-stu-id="15cdd-171">You must resume the job to activate it in the transfer queue.</span></span> <span data-ttu-id="15cdd-172">Вы можете приостановить или возобновить задание в любое время.</span><span class="sxs-lookup"><span data-stu-id="15cdd-172">You can suspend or resume a job at any time.</span></span> <span data-ttu-id="15cdd-173">Возобновление задания перемещает задание из приостановленного состояния в состояние очереди.</span><span class="sxs-lookup"><span data-stu-id="15cdd-173">Resuming the job moves the job from the suspended state to the queued state.</span></span> <span data-ttu-id="15cdd-174">Задание остается в состоянии очереди до тех пор, пока планировщик не определит, что это задание переносит файлы.</span><span class="sxs-lookup"><span data-stu-id="15cdd-174">The job stays in the queued state until the scheduler determines it is the job's turn to transfer files.</span></span> <span data-ttu-id="15cdd-175">Все задания переднего плана выполняются параллельно с одним фоновым заданием.</span><span class="sxs-lookup"><span data-stu-id="15cdd-175">All foreground jobs run concurrently with one background job.</span></span> <span data-ttu-id="15cdd-176">BITS обрабатывает файлы в заданиях переднего плана последовательно.</span><span class="sxs-lookup"><span data-stu-id="15cdd-176">BITS processes the files within foreground jobs serially.</span></span>

<span data-ttu-id="15cdd-177">Если задача переносит файлы, задание переходит в состояние подключения, а служба BITS подключается к удаленному серверу (указанному в имени удаленного файла).</span><span class="sxs-lookup"><span data-stu-id="15cdd-177">When it is a job's turn to transfer files, the job moves to the connecting state while BITS connects to the remote server (specified in the remote file name).</span></span> <span data-ttu-id="15cdd-178">Если служба BITS может подключиться к удаленному серверу, задание перемещается в состояние передачи, где оно остается до окончания временного среза, передача завершается, возникает ошибка или приложение приостанавливает задание.</span><span class="sxs-lookup"><span data-stu-id="15cdd-178">If BITS is able to connect to the remote server, the job moves to the transferring state where it stays until its time slice ends, the transfer is complete, an error occurs, or the application suspends the job.</span></span>

<span data-ttu-id="15cdd-179">Задание перемещается между состояниями, поставленными в очередь, подключением и передачей, пока служба BITS не перенесет все файлы в задании.</span><span class="sxs-lookup"><span data-stu-id="15cdd-179">The job moves between the queued, connecting, and transferring states until BITS transfers all files in the job.</span></span> <span data-ttu-id="15cdd-180">На этом этапе задание перемещается в состояние передано.</span><span class="sxs-lookup"><span data-stu-id="15cdd-180">At that point, the job moves to the transferred state.</span></span> <span data-ttu-id="15cdd-181">Служба BITS использует планирование циклического перебора для планирования заданий с одинаковым уровнем приоритета.</span><span class="sxs-lookup"><span data-stu-id="15cdd-181">BITS uses round-robin scheduling to schedule jobs that are at the same priority level.</span></span> <span data-ttu-id="15cdd-182">Каждому заданию присваивается срез времени для обработки файлов.</span><span class="sxs-lookup"><span data-stu-id="15cdd-182">Each job is given a slice of time to process its files.</span></span> <span data-ttu-id="15cdd-183">Если задание не завершается во время временного среза, задание возвращается в состояние очереди и активируется следующее задание в очереди.</span><span class="sxs-lookup"><span data-stu-id="15cdd-183">If the job does not complete during its time slice, the job goes back to the queued state and the next job in the queue is activated.</span></span> <span data-ttu-id="15cdd-184">Это мешает большим заданиям блокировать небольшие задания.</span><span class="sxs-lookup"><span data-stu-id="15cdd-184">This prevents large jobs from blocking smaller jobs.</span></span> <span data-ttu-id="15cdd-185">Задания в основном обрабатываются в порядке поступления (FIFO). Однако служба BITS не может гарантировать обработку FIFO из-за планирования с циклическим перебором, ошибок заданий и перезапусков служб.</span><span class="sxs-lookup"><span data-stu-id="15cdd-185">Jobs are processed largely on a first in, first out (FIFO) basis; however, BITS cannot guarantee FIFO processing because of round-robin scheduling, job errors, and service restarts.</span></span>

<span data-ttu-id="15cdd-186">Передаваемые файлы недоступны клиенту до тех пор, пока приложение не вызовет метод [**использованием метода ibackgroundcopyjob:: Complete**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-complete) для передачи прав владения файлами пользователю.</span><span class="sxs-lookup"><span data-stu-id="15cdd-186">The transferred files are not available to the client until the application calls the [**IBackgroundCopyJob::Complete**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-complete) method to transfer ownership of the files from BITS to the user.</span></span> <span data-ttu-id="15cdd-187">Если файл успешно получен сервером, заданиям передачи также присваивается состояние передано.</span><span class="sxs-lookup"><span data-stu-id="15cdd-187">Upload jobs are also set to the transferred state when the file is successfully received by the server.</span></span> <span data-ttu-id="15cdd-188">Заданиям отправки и ответа задаются переданные состояния после успешной отправки файла на сервер, и ответ от серверного приложения успешно передается клиенту.</span><span class="sxs-lookup"><span data-stu-id="15cdd-188">Upload-reply jobs are set to the transferred state after the file is successfully sent to the server and the reply from the server application is successfully transferred to the client.</span></span>

<span data-ttu-id="15cdd-189">При возникновении ошибки задание переходит в состояние неустранимой или временной ошибки.</span><span class="sxs-lookup"><span data-stu-id="15cdd-189">If an error occurs, the job moves to either the fatal or transient error state.</span></span> <span data-ttu-id="15cdd-190">Неустранимые ошибки — это ошибки, которые не могут быть восстановлены из или из которых требуется вмешательство для исправления.</span><span class="sxs-lookup"><span data-stu-id="15cdd-190">Fatal errors are errors that BITS cannot recover from or which require intervention to fix.</span></span> <span data-ttu-id="15cdd-191">Если приложение может исправить ошибку, приложение возобновляет задание, а служба BITS переместит задание в состояние очереди.</span><span class="sxs-lookup"><span data-stu-id="15cdd-191">If the application is able to fix the error, the application resumes the job and BITS moves the job to the queued state.</span></span> <span data-ttu-id="15cdd-192">Временные ошибки — это ошибки, которые могут быть устранены самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="15cdd-192">Transient errors are errors that may resolve themselves.</span></span> <span data-ttu-id="15cdd-193">Служба BITS повторяет задания в состоянии временной ошибки до тех пор, пока перемещение не будет выполнено или не истечет время ожидания задания. Время ожидания задания истекает, когда в течение заданного приложением периода не выполняется.</span><span class="sxs-lookup"><span data-stu-id="15cdd-193">BITS retries jobs in the transient error state until the transfer is successful or the job times out. The job times out when no progress is made within an application-specified period.</span></span> <span data-ttu-id="15cdd-194">Если время ожидания задания истекло, BITS перемещает задание в состояние неустранимой ошибки.</span><span class="sxs-lookup"><span data-stu-id="15cdd-194">If the job times out, BITS moves the job to fatal error state.</span></span>

<span data-ttu-id="15cdd-195">Дополнительные сведения о состояниях заданий см. в разделе [**\_ \_ состояние задания BG**](/windows/desktop/api/Bits/ne-bits-bg_job_state).</span><span class="sxs-lookup"><span data-stu-id="15cdd-195">For more information on job states, see [**BG\_JOB\_STATE**](/windows/desktop/api/Bits/ne-bits-bg_job_state).</span></span>
