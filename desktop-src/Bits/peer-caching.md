---
title: Одноранговое кэширование
description: Начиная с фоновая интеллектуальная служба передачи (BITS) 4,0 служба BITS была расширена, чтобы разрешить одноранговое кэширование на уровне подсети для загрузки данных URL-адресов с помощью Windows BranchCache.
ms.assetid: 4197eed3-1812-4440-99e7-9462635ef6ad
ms.topic: article
ms.date: 11/29/2018
ms.openlocfilehash: 3c87e6013bb37610e934c13414bd2636407108ef
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105654321"
---
# <a name="peer-caching"></a>Одноранговое кэширование

Начиная с фоновая интеллектуальная служба передачи (BITS) 4,0 служба BITS была расширена, чтобы разрешить одноранговое кэширование на уровне подсети для загрузки данных URL-адресов с помощью Windows BranchCache. Клиенты BITS могут получать данные с других компьютеров в собственной подсети, которые уже загрузили данные, вместо получения данных с удаленных серверов. Дополнительные сведения о Windows BranchCache см. в [обзоре BranchCache](/previous-versions/windows/it-pro/windows-7/dd755969(v=ws.10)).

Если администратор включит Windows BranchCache на клиентских и серверных компьютерах в Организации с помощью групповой политики или локальных параметров конфигурации, BITS будет использовать Windows BranchCache для передачи данных.

-   [Конфигурация для однорангового кэширования BITS 4,0](#configuration-for-bits-40-peer-caching)
-   [Отключение Windows BranchCache](#disabling-windows-branchcache)
-   [Проверка и мониторинг](#verification-and-monitoring)
-   [Одноранговое кэширование в БИТАХ 3,0](#peer-caching-in-bits-30)

## <a name="configuration-for-bits-40-peer-caching"></a>Конфигурация для однорангового кэширования BITS 4,0

Для работы однорангового кэширования в службе BITS 4,0 требуется следующая конфигурация:

-   Компонент Windows BranchCache должен быть включен на клиенте с помощью групповой политики или параметров локальной конфигурации. Дополнительные сведения см. в разделе [Конфигурация клиента BranchCache](/previous-versions/windows/it-pro/windows-7/dd637820(v=ws.10)).
    > [!Note]  
    > Функция Windows BranchCache по умолчанию отключена.

     

-   Компонент Windows BranchCache — это дополнительный компонент, который должен быть установлен на сервере. Дополнительные сведения см. в разделе [Конфигурация сервера BranchCache](/previous-versions/windows/it-pro/windows-7/dd637785(v=ws.10)).
-   Кроме того, сервер должен включить функцию Windows BranchCache, несмотря на настройки групповой политики или локальной конфигурации. Дополнительные сведения см. в разделе [Конфигурация сервера BranchCache](/previous-versions/windows/it-pro/windows-7/dd637785(v=ws.10)).
    > [!Note]  
    > Функция Windows BranchCache по умолчанию отключена.

     

Групповая политика BITS по умолчанию разрешает одноранговое кэширование. Если Windows BranchCache включена на компьютере глобально, эта функция также включена для заданий передачи BITS. Дополнительные сведения о групповых политиках, зависящих от BITS, см. в разделе [групповые политики](group-policies.md).

## <a name="disabling-windows-branchcache"></a>Отключение Windows BranchCache

Администратор может использовать групповую политику для отключения использования Windows BranchCache. (См. раздел [групповые политики](group-policies.md).) Если компонент Windows BranchCache отключен, клиенты BITS получают данные только с удаленных серверов.

Приложение может также отключать Windows BranchCache для каждого задания, вызывая метод [**IBackgroundCopyJob4:: сетпиркачингфлагс**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-setpeercachingflags) и устанавливая флаг, **\_ отключающий \_ \_ кэш ветвления** .

> [!Note]  
> Эти параметры не влияют на использование Windows BranchCache приложениями, отличными от BITS. Эти параметры не применяются к передаче BITS по протоколу SMB. Служба BITS не контролирует никакие параметры для передачи данных Windows BranchCache по протоколу SMB.

 

## <a name="verification-and-monitoring"></a>Проверка и мониторинг

Существует несколько способов проверки и отслеживания статистики однорангового кэширования. Администраторы могут вызвать метод [**IBackgroundCopyFile4:: жетпирдовнлоадстатс**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibackgroundcopyfile4-getpeerdownloadstats) , чтобы запросить объем данных, скачанных с одноранговых узлов и с исходных серверов. Администраторы также могут проверить журнал событий на наличие [события с идентификатором 60](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc734635(v=ws.10)), которое предоставляет сведения о конкретном задании.

Функция Windows BranchCache также предоставляет ряд механизмов для проверки и отслеживания статистики однорангового кэша. Дополнительные сведения см. в разделе [Проверка и мониторинг](/previous-versions/windows/it-pro/windows-7/dd637782(v=ws.10)) и [счетчики производительности](/previous-versions/windows/it-pro/windows-7/dd637826(v=ws.10)).

Модель однорангового кэширования, использующая Windows BranchCache, заменяет модель однорангового кэширования, используемую в БИТАХ 3,0. Дополнительные сведения о Windows BranchCache см. в следующих статьях:

-   [BranchCache,,](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj127252(v=ws.11))
-   [Обзор BranchCache](/previous-versions/windows/it-pro/windows-7/dd755969(v=ws.10))
-   [Службы Windows 7](../win7devguide/services.md)
-   [API однорангового распространения](../p2psdk/peer-distribution.md)

## <a name="peer-caching-in-bits-30"></a>Одноранговое кэширование в БИТАХ 3,0

> [!Note]  
> Начиная с Windows 7, модель однорангового кэширования BITS 3,0 устарела. Если установлена служба BITS 4,0, то модель однорангового кэширования BITS 3,0 недоступна.

 

Если администратор включает одноранговое кэширование, а задание разрешает загрузку содержимого с однорангового узла, служба BITS попытается загрузить содержимое с одного или нескольких узлов. Загрузка с однорангового узла выполняется гораздо быстрее, чем загрузка содержимого из Интернета. Одноранговое кэширование отключено по умолчанию, и задания должны явно разрешать загрузку содержимого с одноранговых узлов. Администратор может использовать групповую политику для включения однорангового кэширования. После включения однорангового кэширования администратор может отключить либо загрузку с однорангового узла, либо обслуживание содержимого на одноранговом узле.

Приложение также может включить одноранговый кэш, вызвав метод [**ибитспиркачеадминистратион:: сетконфигуратионфлагс**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibitspeercacheadministration-setconfigurationflags) . Однако эти параметры переопределяются параметрами групповой политики, если они заданы.

При включении однорангового кэширования служба BITS создает список одноранговых узлов, которые находятся в одной подсети и принадлежат одному и тому же домену. Список не будет содержать одноранговые узлы из доверенного домена. Одноранговый кэш может быть включен только в среде домена.

Служба BITS обнаруживает одноранговые узлы, выполняя следующие действия.

-   Прослушивание одноранговых серверов, сообщающих о себе. Одноранговый сервер будет объявлять себя при запуске. Служба BITS добавит одноранговый сервер в список, если клиенту требуется больше узлов в списке.
-   Широковещательная рассылка запроса на одноранговые серверы, когда ему требуется больше узлов в списке одноранговых узлов. Одноранговые серверы, которые могут обслуживать содержимое, отвечают на запрос.

Служба BITS удаляет одноранговые серверы из списка одноранговых узлов, если сервер выполняет следующие действия:

-   Не проходит проверку подлинности
-   Не в сети (недоступно) слишком долго
-   Предоставляет сертификат с ошибками

Когда задание запрашивает содержимое от однорангового узла, служба BITS случайным образом выбирает подмножество одноранговых узлов из списка одноранговых узлов и запрашивает их, если у них есть содержимое. Служба BITS может скачивать содержимое только с одноранговых серверов, прошедших проверку подлинности. Клиент и сервер изначально проходят проверку подлинности по протоколу Kerberos, а затем обмениваются самозаверяющими сертификатами для проверки подлинности во время обнаружения и скачивания содержимого.

Служба BITS скачивает содержимое с первого прошедшего проверку подлинности однорангового узла для ответа на запрос. Если один одноранговый узел не содержит все содержимое, то BITS загрузит его с одного или нескольких одноранговых узлов перед загрузкой оставшейся части с сервера источника. Если ни один из узлов не имеет содержимого или при скачивании с однорангового узла не возникает ошибки, BITS загружает содержимое с сервера-источника.

Загруженное содержимое будет доступно для обслуживания другим одноранговым узлам только после того, как приложение проверит содержимое файлов. Если приложение не проверяет файл явным образом, то он неявно проверяется, когда приложение завершает задание.

По умолчанию одноранговый сервер может обслуживать содержимое только для трех клиентов одновременно. Если сервер в настоящий момент занят обслуживанием трех клиентов, то задержка в ответ на другие запросы будет отложена. BITS ограничивает пропускную способность, используемую для обслуживания содержимого, до 1 Мбит/с. Чтобы изменить это ограничение, можно использовать групповую политику [максбандвидссервед](group-policies.md) .

> [!Note]  
> Эта функция поддерживается только в доменных сетях. одноранговое кэширование не поддерживается для рабочих групп и домашних сетей.

См. также [Администрирование однорангового кэша](/windows/desktop/Bits/administering-the-peer-cache)
 

 

 