---
title: Предотвращение нескольких отправок
description: При передаче файла служба BITS создает идентификатор сеанса, который определяет сеанс передачи как клиенту BITS, так и серверу BITS.
ms.assetid: 97283f8e-d2fa-4383-9b92-a05f46680443
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ae59bb1d605af7e4dd53b0c1d66618b6816e7886
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104067423"
---
# <a name="preventing-multiple-uploads"></a><span data-ttu-id="28457-103">Предотвращение нескольких отправок</span><span class="sxs-lookup"><span data-stu-id="28457-103">Preventing Multiple Uploads</span></span>

<span data-ttu-id="28457-104">При передаче файла служба BITS создает идентификатор сеанса, который определяет сеанс передачи как клиенту BITS, так и серверу BITS.</span><span class="sxs-lookup"><span data-stu-id="28457-104">When you upload a file, BITS creates a session ID that identifies the upload session to both the BITS client and BITS server.</span></span> <span data-ttu-id="28457-105">Если соединение между клиентом BITS и сервером разорвано, а BITS отправляет файл, клиент будет использовать идентификатор сеанса, чтобы попытаться возобновить передачу.</span><span class="sxs-lookup"><span data-stu-id="28457-105">If the connection between the BITS client and server is broken while BITS is uploading a file, the client will use the session ID to try to resume the upload.</span></span>

<span data-ttu-id="28457-106">Если клиент BITS подключается к тому же серверу, что и ранее, сервер распознает идентификатор сеанса, и передача будет возобновлена с точки прерывания.</span><span class="sxs-lookup"><span data-stu-id="28457-106">If the BITS client connects to the same server as before, the server will recognize the session ID and the upload will resume from the point of interruption.</span></span> <span data-ttu-id="28457-107">Однако если клиент подключается к другому серверу, клиент должен начать отправку с начала, поскольку на новом сервере отсутствует контекст сеанса или ранее загруженные данные.</span><span class="sxs-lookup"><span data-stu-id="28457-107">However, if the client connects to a different server, the client must start the upload from the beginning because the new server does not have the session context or the previously uploaded data.</span></span> <span data-ttu-id="28457-108">Служба BITS может подключаться к другому серверу, если сервер BITS размещается на веб-ферме, а свойство расширения IIS BITS [битшостид](bits-iis-extension-properties.md)не задано.</span><span class="sxs-lookup"><span data-stu-id="28457-108">BITS may connect to a different server when the BITS server is hosted on a web farm and the BITS IIS extension property, [BITSHostId](bits-iis-extension-properties.md), is not set.</span></span> <span data-ttu-id="28457-109">Свойство Битшостид предотвращает перезагрузку, заставляя клиент BITS подключаться к уникальному адресу предыдущего сервера вместо общего адреса сервера.</span><span class="sxs-lookup"><span data-stu-id="28457-109">The BITSHostId property prevents restarts by forcing the BITS client to connect to the previous server's unique address instead of the shared server address.</span></span>

<span data-ttu-id="28457-110">Сервер BITS попытается отправить файл отправки только один раз в серверное приложение, но возможно, что файл будет отправлен более одного раза.</span><span class="sxs-lookup"><span data-stu-id="28457-110">The BITS server will attempt to send the upload file only once to the server application, but it is possible that the file may be sent more than one time.</span></span> <span data-ttu-id="28457-111">Это может произойти, например, если сервер BITS отправляет файл в серверное приложение, а затем завершается при ожидании ответа от серверного приложения.</span><span class="sxs-lookup"><span data-stu-id="28457-111">This can occur, for example, if the BITS server sends the file to the server application and then terminates while waiting for the reply from the server application.</span></span> <span data-ttu-id="28457-112">Клиент BITS получит код ошибки на уровне HTTP и повторит попытку отправки после задержки.</span><span class="sxs-lookup"><span data-stu-id="28457-112">The BITS client will receive an error code from the HTTP layer, and retry the upload after a delay.</span></span> <span data-ttu-id="28457-113">Если сервер остается в автономном режиме дольше, чем время ожидания [битшостидфаллбакктимеаут](bits-iis-extension-properties.md) , клиент в конечном итоге отправит запрос к общему адресу сервера. другой сервер BITS получит файл и снова доставляет его в серверное приложение.</span><span class="sxs-lookup"><span data-stu-id="28457-113">If the server stays offline for longer than the [BITSHostIdFallbackTimeout](bits-iis-extension-properties.md) timeout, then the client will eventually send the request to the shared server address again; a different BITS server will receive the file and deliver it again to the server application.</span></span>

<span data-ttu-id="28457-114">Аналогичный случай может происходить даже с одним сервером переднего плана.</span><span class="sxs-lookup"><span data-stu-id="28457-114">A similar case can occur even with a single front-end server.</span></span> <span data-ttu-id="28457-115">Например, когда клиент перегружает весь файл на сервер, последний блок заставляет сервер пересылать файл в серверное приложение.</span><span class="sxs-lookup"><span data-stu-id="28457-115">For example, when the client has uploaded the entire file to the server, the final block causes the server to forward the file to the server application.</span></span> <span data-ttu-id="28457-116">Если сервер BITS или серверное приложение прерывают работу после обработки файла, но перед отправкой подтверждения клиенту, клиент получит код ошибки и повторите попытку позже.</span><span class="sxs-lookup"><span data-stu-id="28457-116">If the BITS server or the server application terminate after the file is processed but before the acknowledgment is sent to the client, then the client will receive an error code and retry later.</span></span> <span data-ttu-id="28457-117">Когда клиент повторяет попытку, сервер BITS увидит, что последний блок был отправлен, и снова перейдет файл в серверное приложение.</span><span class="sxs-lookup"><span data-stu-id="28457-117">When the client retries, the BITS server will see that the final block has been uploaded, and it will again forward the file to the server application.</span></span> <span data-ttu-id="28457-118">Если получение файла отправки выполняется несколько раз, то следует рассмотреть возможность включения идентификатора транзакции в данные.</span><span class="sxs-lookup"><span data-stu-id="28457-118">If receiving the upload file multiple times is an issue for your server application, you should consider including a transaction identifier in the data.</span></span>

 

 




