---
title: Рекомендации по использованию BITS
description: В этом разделе содержатся сведения, которые следует учитывать при проектировании приложения, использующего службу BITS.
ms.assetid: f4a09a80-2a85-4b59-b0fd-c23c128973f7
ms.topic: article
ms.date: 7/12/2019
ms.openlocfilehash: bbf69e75b99994eea3e8986d1be9920ff1a12bc5
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "103986245"
---
# <a name="best-practices-when-using-bits"></a><span data-ttu-id="27050-103">Рекомендации по использованию BITS</span><span class="sxs-lookup"><span data-stu-id="27050-103">Best Practices When Using BITS</span></span>

<span data-ttu-id="27050-104">В этом разделе содержатся сведения, которые следует учитывать при проектировании приложения, использующего службу BITS.</span><span class="sxs-lookup"><span data-stu-id="27050-104">This section contains information you should consider when designing an application that uses BITS.</span></span>

## <a name="user-context-or-service-context"></a><span data-ttu-id="27050-105">Контекст пользователя или службы</span><span class="sxs-lookup"><span data-stu-id="27050-105">User context or service context</span></span>

<span data-ttu-id="27050-106">Служба BITS передает файлы только в том случае, если владелец задания входит в систему на компьютере (пользователь должен войти в систему в интерактивном режиме).</span><span class="sxs-lookup"><span data-stu-id="27050-106">BITS transfers files only when the job's owner is logged on to the computer (the user must have logged on interactively).</span></span> <span data-ttu-id="27050-107">Служба BITS не поддерживает команду **runas** .</span><span class="sxs-lookup"><span data-stu-id="27050-107">BITS does not support the **RunAs** command.</span></span> <span data-ttu-id="27050-108">Дополнительные сведения см. в разделе [Пользователи и сетевые подключения](users-and-network-connections.md).</span><span class="sxs-lookup"><span data-stu-id="27050-108">For more details, see [Users and Network Connections](users-and-network-connections.md).</span></span>

<span data-ttu-id="27050-109">Если для вашего приложения контекст пользователя не требуется, попробуйте вместо этого написать службу, работающую как LocalSystem, LocalService или NetworkService.</span><span class="sxs-lookup"><span data-stu-id="27050-109">If you do not require a user's context for your application, consider writing a service running as LocalSystem, LocalService, or NetworkService instead.</span></span> <span data-ttu-id="27050-110">Эти системные учетные записи всегда входят в систему, поэтому перенос не проходит пользователя.</span><span class="sxs-lookup"><span data-stu-id="27050-110">These system accounts are always logged on, so the transfer is not subject to a user logging off.</span></span> <span data-ttu-id="27050-111">Однако если пользователь олицетворяет пользователя при создании задания, применяются правила интерактивного входа.</span><span class="sxs-lookup"><span data-stu-id="27050-111">However, if you impersonate a user when you create the job, the interactive logon rules apply.</span></span> <span data-ttu-id="27050-112">Дополнительные сведения см. в статье [учетные записи служб и службы BITS](service-accounts-and-bits.md).</span><span class="sxs-lookup"><span data-stu-id="27050-112">For more details, see [Service Accounts and BITS](service-accounts-and-bits.md).</span></span>

## <a name="jobs-are-persistent"></a><span data-ttu-id="27050-113">Задания являются постоянными</span><span class="sxs-lookup"><span data-stu-id="27050-113">Jobs are persistent</span></span>

<span data-ttu-id="27050-114">Задания остаются в очереди до тех пор, пока не будет вызван метод [**использованием метода ibackgroundcopyjob:: Complete**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-complete) или [**использованием метода ibackgroundcopyjob:: Cancel**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-cancel) .</span><span class="sxs-lookup"><span data-stu-id="27050-114">Jobs remain in the queue until you call the [**IBackgroundCopyJob::Complete**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-complete) or [**IBackgroundCopyJob::Cancel**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-cancel) method.</span></span> <span data-ttu-id="27050-115">Файлы в задании недоступны пользователю до тех пор, пока не будет выполнен вызов функции **Complete**.</span><span class="sxs-lookup"><span data-stu-id="27050-115">The files in the job are not available to the user until you call **Complete**.</span></span> <span data-ttu-id="27050-116">Как правило, вызов **завершается** , когда состояние задания **\_ \_ \_ передается в состояние задания BG** и вызывается **Cancel** , когда задание находится в состоянии **\_ задания BG \_ \_ Промежуточная \_ Ошибка** или **состояние \_ задания \_ \_ BG** и больше не может быть выполнено.</span><span class="sxs-lookup"><span data-stu-id="27050-116">Typically, you call **Complete** when the state of the job is **BG\_JOB\_STATE\_TRANSFERRED**, and you call **Cancel** when the job is in the **BG\_JOB\_STATE\_TRANSIENT\_ERROR** or **BG\_JOB\_STATE\_ERROR** state and can no longer make progress.</span></span>

<span data-ttu-id="27050-117">Если не вызвать метод [**Complete**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-complete) или метод [**Cancel**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-cancel) в течение 90 дней (по умолчанию групповая политика [жобинактивититимеаут](group-policies.md) ), служба отменяет задание.</span><span class="sxs-lookup"><span data-stu-id="27050-117">If you do not call the [**Complete**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-complete) method or the [**Cancel**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-cancel) method within 90 days (default [JobInactivityTimeout](group-policies.md) Group Policy), the service cancels the job.</span></span> <span data-ttu-id="27050-118">Следует всегда вызывать метод **Complete** или **Cancel** и не полагаться на политику жобинактивититимеаут для очистки заданий.</span><span class="sxs-lookup"><span data-stu-id="27050-118">You should always call the **Complete** or the **Cancel** method and not rely on the JobInactivityTimeout policy to cleanup your jobs.</span></span> <span data-ttu-id="27050-119">Задания, оставшиеся в очереди, могут помешать пользователям создавать другие задания при достижении предела политики Maxjobspermachine или MaxJobsPerMachine.</span><span class="sxs-lookup"><span data-stu-id="27050-119">Jobs left in the queue may prevent users from creating other jobs if the MaxJobsPerUser or MaxJobsPerMachine policy limit is reached.</span></span>

## <a name="when-to-use-foreground-or-background-priority"></a><span data-ttu-id="27050-120">Когда следует использовать приоритет переднего плана или фона</span><span class="sxs-lookup"><span data-stu-id="27050-120">When to use foreground or background priority</span></span>

<span data-ttu-id="27050-121">Если время выполнения задания не является критическим или пользователь находится в активном состоянии, следует всегда использовать приоритет фона.</span><span class="sxs-lookup"><span data-stu-id="27050-121">Unless the job is time critical or the user is actively waiting, you should always use a background priority.</span></span> <span data-ttu-id="27050-122">Однако бывают случаи, когда вам может потребоваться переключиться от приоритета фона к приоритету переднего плана, например, когда прокси или сервер не поддерживает заголовок Content-Range, или антивирусная программа на клиенте удаляет запрос заголовка диапазона.</span><span class="sxs-lookup"><span data-stu-id="27050-122">However, there are times when you may want to switch from background priority to foreground priority, for example, when the proxy or server does not support the Content-Range header, or antivirus software on the client removes the range header request.</span></span> <span data-ttu-id="27050-123">Переключение на приоритет переднего плана работает только для тех файлов, размер файла которых меньше 2 ГБ.</span><span class="sxs-lookup"><span data-stu-id="27050-123">Switching to foreground priority works only for those files whose file size is less than 2 GB.</span></span> <span data-ttu-id="27050-124">Пример см. в описании реализации метода [**ибаккграундкопикаллбакк:: жоберрор**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopycallback) .</span><span class="sxs-lookup"><span data-stu-id="27050-124">For an example, see the implementation for the [**IBackgroundCopyCallback::JobError**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopycallback) method.</span></span> <span data-ttu-id="27050-125">Также обратите внимание, что если задание переднего плана прерывается из-за отключения сети или входа пользователя в систему, задание завершится ошибкой, так как служба BITS отправит запрос к диапазону, чтобы попытаться перезапустить передачу с места остановки.</span><span class="sxs-lookup"><span data-stu-id="27050-125">Also note that if the foreground job is then interrupted due to a network disconnect or the user logging off, the job will fail because BITS will send a range request to try to restart the transfer from where it left off.</span></span>

<span data-ttu-id="27050-126">Начиная с Windows 8, следует настроить загрузку заданий с помощью **\_ \_ \_ динамического \_ содержимого** и **\_ \_ приоритета заданий по \_ раскрываемому** заданиям BITS, если целевые серверы не соответствуют [требованиям HTTP для загрузки BITS](http-requirements-for-bits-downloads.md).</span><span class="sxs-lookup"><span data-stu-id="27050-126">Starting with Windows 8, you should configure download jobs with **BITS\_JOB\_PROPERTY\_DYNAMIC\_CONTENT** and **BG\_JOB\_PRIORITY\_FOREGROUND** when targeting servers that do not meet the [HTTP Requirements for BITS Downloads](http-requirements-for-bits-downloads.md).</span></span> <span data-ttu-id="27050-127">Имейте в виду, что это приведет к тому, что служба BITS перезапускает загрузку с начала, если она будет прервана (например, из-за проблем с подключением или перезагрузки системы).</span><span class="sxs-lookup"><span data-stu-id="27050-127">Bear in mind that this will result in BITS having to restart the download from the beginning if it ever gets interrupted (for example, due to connectivity issues or system reboot).</span></span>

<span data-ttu-id="27050-128">Сведения о доступных приоритетах и о том, как служба BITS использует уровень приоритета для планирования заданий, см. в разделе " [**\_ \_ приоритет задания BG**](/windows/desktop/api/Bits/ne-bits-bg_job_priority)".</span><span class="sxs-lookup"><span data-stu-id="27050-128">For information on the available priorities and how BITS uses the priority level to schedule jobs, see [**BG\_JOB\_PRIORITY**](/windows/desktop/api/Bits/ne-bits-bg_job_priority).</span></span>

## <a name="transient-and-fatal-errors"></a><span data-ttu-id="27050-129">Временные и неустранимые ошибки</span><span class="sxs-lookup"><span data-stu-id="27050-129">Transient and fatal errors</span></span>

<span data-ttu-id="27050-130">Некоторые ошибки могут быть восстановлены, а некоторые — нет.</span><span class="sxs-lookup"><span data-stu-id="27050-130">Some errors are recoverable and some are not.</span></span> <span data-ttu-id="27050-131">Например, ошибка «сервер недоступна» является восстанавливаемой ошибкой, а ошибка «отказано в доступе» является неустранимой ошибкой.</span><span class="sxs-lookup"><span data-stu-id="27050-131">For example, the error "Server is Unavailable" is a recoverable error, and the error "Access Denied" is a fatal error.</span></span> <span data-ttu-id="27050-132">BITS помещает устранимые ошибки в состояние временной ошибки и повторяет задание через указанный интервал.</span><span class="sxs-lookup"><span data-stu-id="27050-132">BITS puts recoverable errors in a transient error state and tries the job again after a specified interval.</span></span> <span data-ttu-id="27050-133">Если задание не может выполнить ход выполнения, служба BITS переместит задание в состояние неустранимой ошибки.</span><span class="sxs-lookup"><span data-stu-id="27050-133">If the job is unable to make progress, BITS moves the job to a fatal error state.</span></span> <span data-ttu-id="27050-134">Используйте методы [**использованием метода ibackgroundcopyjob:: сетминимумретриделай**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setminimumretrydelay) и [**использованием метода ibackgroundcopyjob:: сетнопрогресстимеаут**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setnoprogresstimeout) для управления тем, как служба BITS обрабатывает временные ошибки.</span><span class="sxs-lookup"><span data-stu-id="27050-134">Use the [**IBackgroundCopyJob::SetMinimumRetryDelay**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setminimumretrydelay) and [**IBackgroundCopyJob::SetNoProgressTimeout**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setnoprogresstimeout) methods to control how BITS processes transient errors.</span></span>

<span data-ttu-id="27050-135">Для заданий переднего плана необходимо ограничить время, в течение которого задание остается в состоянии временной ошибки, и попытаться выполнить восстановление.</span><span class="sxs-lookup"><span data-stu-id="27050-135">For foreground jobs, you should limit the amount of time you let a job stay in the transient error state and try to recover.</span></span> <span data-ttu-id="27050-136">Используйте метод [**сетнопрогресстимеаут**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setnoprogresstimeout) , чтобы ограничить период времени, в течение которого задание остается в состоянии временной ошибки, или принудительно перевести задание в состояние неустранимой ошибки.</span><span class="sxs-lookup"><span data-stu-id="27050-136">Use the [**SetNoProgressTimeout**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setnoprogresstimeout) method to limit the amount of time a job stays in the transient error state or to force the job into the fatal error state.</span></span> <span data-ttu-id="27050-137">Если вы разрешите выполнить восстановление, используйте метод [**сетминимумретриделай**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setminimumretrydelay) , чтобы установить минимальную задержку повторных попыток в 60 секунд или вызвать метод [**использованием метода ibackgroundcopyjob:: Resume**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-resume) для повторной активации задания.</span><span class="sxs-lookup"><span data-stu-id="27050-137">If you let the job try to recover, you should use the [**SetMinimumRetryDelay**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setminimumretrydelay) method to set the minimum retry delay to 60 seconds or call the [**IBackgroundCopyJob::Resume**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-resume) method to activate the job again.</span></span>

<span data-ttu-id="27050-138">Дополнительные сведения см. в [**разделе \_ \_ состояние задания BG**](/windows/desktop/api/Bits/ne-bits-bg_job_state), [жизненный цикл задания BITS](life-cycle-of-a-bits-job.md)и [Обработка ошибок](handling-errors.md).</span><span class="sxs-lookup"><span data-stu-id="27050-138">For more information, see [**BG\_JOB\_STATE**](/windows/desktop/api/Bits/ne-bits-bg_job_state), [Life Cycle of a BITS Job](life-cycle-of-a-bits-job.md), and [Handling Errors](handling-errors.md).</span></span>

## <a name="measuring-network-bandwidth-usage"></a><span data-ttu-id="27050-139">Измерение использования пропускной способности сети</span><span class="sxs-lookup"><span data-stu-id="27050-139">Measuring network bandwidth usage</span></span>

<span data-ttu-id="27050-140">BITS может использовать сетевой адаптер клиента для оценки доступной пропускной способности сети.</span><span class="sxs-lookup"><span data-stu-id="27050-140">BITS might use the client's network adapter to estimate available network bandwidth.</span></span> <span data-ttu-id="27050-141">Поскольку службы BITS не могут измерять пропускную способность за пределами клиента, BITS может перегрузить канал WAN.</span><span class="sxs-lookup"><span data-stu-id="27050-141">Because BITS is not able to measure bandwidth beyond the client, BITS may congest the WAN link.</span></span> <span data-ttu-id="27050-142">Чтобы снизить нагрузку на канал WAN, можно использовать групповую политику **максинтернетбандвидс** для ограничения объема пропускной способности, используемой клиентом.</span><span class="sxs-lookup"><span data-stu-id="27050-142">To reduce congestion on the WAN link, you can use the **MaxInternetBandwidth** group policy to limit the amount of bandwidth that the client uses.</span></span> <span data-ttu-id="27050-143">Дополнительные сведения см. в статье [пропускная способность сети](network-bandwidth.md) и [групповые политики](group-policies.md).</span><span class="sxs-lookup"><span data-stu-id="27050-143">For more information, see [Network Bandwidth](network-bandwidth.md) and [Group Policies](group-policies.md).</span></span>

<span data-ttu-id="27050-144">При написании приложения, которое многие клиенты будут использовать для загрузки файлов с определенного сервера, следует рассмотреть схему, в которой загружаются запросы на загрузку, чтобы не перегружать сервер с запросами.</span><span class="sxs-lookup"><span data-stu-id="27050-144">If you are writing an application that many clients will use to download files from a given server, you should consider a scheme that staggers the download requests so you do not overload the server with requests.</span></span>

## <a name="setting-credentials-for-proxy-and-server-authentication"></a><span data-ttu-id="27050-145">Настройка учетных данных для проверки подлинности прокси и сервера</span><span class="sxs-lookup"><span data-stu-id="27050-145">Setting credentials for proxy and server authentication</span></span>

<span data-ttu-id="27050-146">Если предполагается, что прокси или сервер должны требовать учетные данные пользователя, необходимо предоставить учетные данные службе BITS.</span><span class="sxs-lookup"><span data-stu-id="27050-146">If you expect the proxy or server to require user credentials, you must provide the credentials to BITS.</span></span> <span data-ttu-id="27050-147">Чтобы указать учетные данные, вызовите метод [**IBackgroundCopyJob2:: сеткредентиалс**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) .</span><span class="sxs-lookup"><span data-stu-id="27050-147">To specify the credentials, call the [**IBackgroundCopyJob2::SetCredentials**](/windows/desktop/api/Bits1_5/nf-bits1_5-ibackgroundcopyjob2-setcredentials) method.</span></span> <span data-ttu-id="27050-148">Служба BITS поддерживает схемы проверки подлинности Basic, Digest, Negotiate, NTLM и Passport.</span><span class="sxs-lookup"><span data-stu-id="27050-148">BITS supports Basic, Digest, Negotiate, NTLM, and Passport authentication schemes.</span></span>

<span data-ttu-id="27050-149">Дополнительные сведения о проверке подлинности см. в разделе [Проверка подлинности](authentication.md).</span><span class="sxs-lookup"><span data-stu-id="27050-149">For details on authentication, see [Authentication](authentication.md).</span></span>

## <a name="specifying-proxy-settings-for-user-accounts-and-service-accounts"></a><span data-ttu-id="27050-150">Указание параметров прокси-сервера для учетных записей пользователей и служб</span><span class="sxs-lookup"><span data-stu-id="27050-150">Specifying proxy settings for user accounts and service accounts</span></span>

<span data-ttu-id="27050-151">По умолчанию служба BITS использует параметры прокси-сервера Internet Explorer пользователя.</span><span class="sxs-lookup"><span data-stu-id="27050-151">By default, BITS uses the user's Internet Explorer proxy settings.</span></span> <span data-ttu-id="27050-152">Чтобы переопределить параметры прокси-сервера Internet Explorer пользователя, вызовите метод [**использованием метода ibackgroundcopyjob:: SetProxySettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) .</span><span class="sxs-lookup"><span data-stu-id="27050-152">To override the user's Internet Explorer proxy settings, call the [**IBackgroundCopyJob::SetProxySettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) method.</span></span>

<span data-ttu-id="27050-153">Параметры прокси-сервера Internet Explorer не применяются к системным учетным записям, поэтому поведение прокси-сервера по умолчанию (Предварительная **\_ \_ \_ \_ Настройка использования прокси-сервера заданий BG**) будет работать правильно только в развертываниях протокола WPAD, если не выполняются дополнительные действия по настройке.</span><span class="sxs-lookup"><span data-stu-id="27050-153">The Internet Explorer proxy settings do not apply to system accounts, so the default proxy behavior (**BG\_JOB\_PROXY\_USAGE\_PRECONFIG**) will only work correctly in Web Proxy Auto-Discovery Protocol (WPAD) deployments, unless additional configuration steps are taken.</span></span> <span data-ttu-id="27050-154">Если приложение является службой, работающей как LocalSystem, LocalService или NetworkService, рассмотрите возможность настройки вспомогательного токена для заданий BITS или явное задание правильных параметров прокси-сервера путем вызова метода [**использованием метода ibackgroundcopyjob:: SetProxySettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) с **\_ \_ \_ \_ переопределением использования прокси-сервера задания BG**.</span><span class="sxs-lookup"><span data-stu-id="27050-154">If your application is a service running as LocalSystem, LocalService, or NetworkService, consider configuring a helper token on your BITS jobs, or explicitly setting the correct proxy settings by calling [**IBackgroundCopyJob::SetProxySettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) with **BG\_JOB\_PROXY\_USAGE\_OVERRIDE**.</span></span> <span data-ttu-id="27050-155">В качестве альтернативы можно использовать параметры **/утил/сетиепрокси** из BitsAdmin.exe, чтобы задать параметры прокси-сервера Internet Explorer для системной учетной записи LocalSystem, LocalService или NetworkService.</span><span class="sxs-lookup"><span data-stu-id="27050-155">As an alternative, you can use the **/Util /SetIEProxy** switches of BitsAdmin.exe to set Internet Explorer proxy settings for the LocalSystem, LocalService, or NetworkService system account.</span></span> <span data-ttu-id="27050-156">Дополнительные сведения см. в разделе [средство битсадмин](bitsadmin-tool.md).</span><span class="sxs-lookup"><span data-stu-id="27050-156">For details, see [BitsAdmin Tool](bitsadmin-tool.md).</span></span>

<span data-ttu-id="27050-157">Служба BITS не распознает параметры прокси-сервера, заданные с помощью файла Proxycfg.exe.</span><span class="sxs-lookup"><span data-stu-id="27050-157">BITS does not recognize the proxy settings that are set using the Proxycfg.exe file.</span></span>

<span data-ttu-id="27050-158">Начиная с обновления Windows 10 октября 2018 (10,0; Сборка 17763), BITS использует тот же порядок прокси-сервера, который используется WinHttp с AUTOMATIC_PROXY.</span><span class="sxs-lookup"><span data-stu-id="27050-158">Starting with the Windows 10 October 2018 Update (10.0; Build 17763), BITS uses the same proxy order that WinHttp uses with AUTOMATIC_PROXY.</span></span> <span data-ttu-id="27050-159">При указании BG_JOB_PROXY_USAGE_PRECONFIG BITS использует более совместимый порядок.</span><span class="sxs-lookup"><span data-stu-id="27050-159">BITS uses this more compatible ordering when BG_JOB_PROXY_USAGE_PRECONFIG is specified.</span></span> <span data-ttu-id="27050-160">BG_JOB_PROXY_USAGE_PRECONFIG является значением по умолчанию для указания прокси-сервера HTTP.</span><span class="sxs-lookup"><span data-stu-id="27050-160">BG_JOB_PROXY_USAGE_PRECONFIG is the default value for specifying the HTTP proxy.</span></span>

## <a name="specifying-user-specific-settings-for-authenticating-proxies"></a><span data-ttu-id="27050-161">Указание параметров пользователя для проверки подлинности прокси-серверов</span><span class="sxs-lookup"><span data-stu-id="27050-161">Specifying user-specific settings for authenticating proxies</span></span>

<span data-ttu-id="27050-162">При использовании BITS в среде, требующей проверки подлинности прокси-сервера при запуске в качестве учетной записи без использования учетных данных NTLM или Kerberos в сетевом домене компьютера, необходимо выполнить дополнительные действия для правильной проверки подлинности с помощью учетных данных другой учетной записи, которая имеет учетные данные в домене.</span><span class="sxs-lookup"><span data-stu-id="27050-162">If you are using BITS in an environment that requires proxy authentication while running as an account without usable NTLM or Kerberos credentials in the machine's network domain, you must take extra steps to authenticate properly by using the credentials of another user account that does have credentials on the domain.</span></span> <span data-ttu-id="27050-163">Это типичный сценарий, когда код BITS выполняется как системная служба, например LocalService, NetworkService или LocalSystem, так как эти учетные записи не имеют пригодных для использования учетных данных NTLM или Kerberos.</span><span class="sxs-lookup"><span data-stu-id="27050-163">This is a typical scenario when your BITS code is running as a system service such as LocalService, NetworkService, or LocalSystem, as those accounts do not have usable NTLM or Kerberos credentials.</span></span>

<span data-ttu-id="27050-164">Дополнительные сведения о том, как работает проверка подлинности в этом сценарии, см. в разделе [authentication.](authentication.md)</span><span class="sxs-lookup"><span data-stu-id="27050-164">For details on how authentication works in this scenario, see [Authentication.](authentication.md)</span></span>

## <a name="scalability"></a><span data-ttu-id="27050-165">Масштабируемость</span><span class="sxs-lookup"><span data-stu-id="27050-165">Scalability</span></span>

<span data-ttu-id="27050-166">Если в очереди находится более 100 заданий, производительность может быть снижена в зависимости от композиции задания.</span><span class="sxs-lookup"><span data-stu-id="27050-166">If more than 100 jobs are in the queue, performance may start to decrease depending on the composition of the job.</span></span> <span data-ttu-id="27050-167">Служба BITS использует параметр политики [MaxJobsPerMachine](group-policies.md) для принудительного ограничения числа заданий в очереди.</span><span class="sxs-lookup"><span data-stu-id="27050-167">BITS uses the [MaxJobsPerMachine](group-policies.md) policy setting to impose a hard limit on the number of jobs in the queue.</span></span> <span data-ttu-id="27050-168">Приложения должны ограничивать количество их заданий приблизительно в 10 раз, чтобы несколько приложений не превышали указания по 100-Job.</span><span class="sxs-lookup"><span data-stu-id="27050-168">Applications should limit the number of their jobs to about 10, so that multiple applications will have less of a chance of exceeding the 100-job guideline.</span></span> <span data-ttu-id="27050-169">Как правило, приложение с большим количеством выполняемых заданий сначала отправляет 10 заданий, а затем отправляет их по мере завершения каждого задания.</span><span class="sxs-lookup"><span data-stu-id="27050-169">Typically, an application with a large number of jobs to submit would first submit 10 jobs and then submit one at a time as each job finishes.</span></span>

<span data-ttu-id="27050-170">Число файлов в задании также должно быть ограничено максимум 10 файлами.</span><span class="sxs-lookup"><span data-stu-id="27050-170">The number of files in the job should also be limited to a maximum of 10 files.</span></span> <span data-ttu-id="27050-171">Если вы хотите переместить большое количество файлов для задания, рассмотрите возможность создания CAB-файла, содержащего все файлы.</span><span class="sxs-lookup"><span data-stu-id="27050-171">If you want to transfer a large number of files for a job, consider creating a CAB file that contains all the files instead.</span></span>

## <a name="http-headers-can-be-in-any-case"></a><span data-ttu-id="27050-172">Заголовки HTTP могут быть в любом случае</span><span class="sxs-lookup"><span data-stu-id="27050-172">HTTP Headers can be in any case</span></span>

<span data-ttu-id="27050-173">Стандарты HTTP всегда говорят, что заголовки HTTP должны обрабатываться без учета регистра (раздел 3,2 7230).</span><span class="sxs-lookup"><span data-stu-id="27050-173">The HTTP standards have always said that HTTP headers must be treated as case-insensitive (RFC 7230 section 3.2).</span></span> <span data-ttu-id="27050-174">Самый последний стандарт HTTP, RFC 7540, указывает на то, что трафик HTTP/2 должен сравнивать заголовки без учета регистра и должен представлять заголовки в нижнем регистре (RFC 6540, раздел BIND 8.1.2).</span><span class="sxs-lookup"><span data-stu-id="27050-174">The most recent HTTP standard, RFC 7540, goes further and says that HTTP/2 traffic must compare the headers as case-insensitive and must present headers in lower case (RFC 6540, section 8.1.2).</span></span> <span data-ttu-id="27050-175">Даже если трафик отправляется с заголовками, отличными от нижнего регистра, прокси-серверы могут выбрать принудительное выполнение заголовков в нижнем регистре.</span><span class="sxs-lookup"><span data-stu-id="27050-175">Even when traffic is sent with non lower-case headers, proxies may well choose to force the headers to lower-case.</span></span>

## <a name="avoiding-personally-identifiable-information-pii"></a><span data-ttu-id="27050-176">Предотвращение личных сведений (PII)</span><span class="sxs-lookup"><span data-stu-id="27050-176">Avoiding personally identifiable information (PII)</span></span>

<span data-ttu-id="27050-177">Задания BITS, включая отображаемое имя задания, описание и имена файлов, видимы всем пользователям с правами администратора.</span><span class="sxs-lookup"><span data-stu-id="27050-177">BITS jobs including the job display name and description and file names are visible to all users with admin privileges.</span></span> <span data-ttu-id="27050-178">Их также можно добавить в данные телеметрии Windows.</span><span class="sxs-lookup"><span data-stu-id="27050-178">They may also be added to Windows Telemetry.</span></span> <span data-ttu-id="27050-179">Не следует размещать конфиденциальные данные (например, собственное имя пользователя) в сведениях о задании.</span><span class="sxs-lookup"><span data-stu-id="27050-179">You should avoid putting sensitive data (like the user's own name) in the job details.</span></span>
