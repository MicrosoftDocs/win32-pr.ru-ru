---
title: Контроль учетных записей и служба BITS
description: Когда пользователь с правами администратора входит в систему на компьютере, создаются два маркера доступа. Один из них — отфильтрованный маркер доступа обычного пользователя, а другой — полный маркер доступа администратора.
ms.assetid: 02439ab3-b885-4a2f-b507-0c48d2b30b76
ms.topic: article
ms.date: 7/12/2019
ms.openlocfilehash: 3017b3a0d816ba393d1427c5c1d2315a68b2dcc0
ms.sourcegitcommit: be77ed1f97d3be57a2f42070589de21b66034adf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/29/2020
ms.locfileid: "103987277"
---
# <a name="bits-security-tokens-and-administrator-accounts"></a>Безопасность, токены и учетные записи администраторов BITS

## <a name="http-server-certificate-callbacks"></a>Обратные вызовы сертификатов HTTP-сервера
Правильная проверка сертификатов сервера является ключевой частью поддержания безопасности HTTPS. Служба BITS позволяет всегда проверять сертификаты сервера по списку требований, заданных параметром [**сетсекуритифлагс**](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags). По умолчанию BITS использует проверку сертификата в стиле браузера.

Можно также указать пользовательскую функцию для вызова для дальнейшей проверки сертификата. Задайте обратный вызов сертификата сервера с помощью метода [**сетсерверцертификатевалидатионинтерфаце**](/windows/desktop/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-setservercertificatevalidationinterface) . Метод будет вызван только после того, как операционная система проверила сертификат на основе вызова [ **сетсекуритифлаг**](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags) . 

## <a name="http-client-certificates"></a>Сертификаты клиента HTTP
Можно задать сертификат клиента для задания HTTP с двумя разными методами параметров сертификата. Сертификат можно задать по [идентификатору](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyid) или по [имени субъекта](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyname)сертификата. Сертификат клиента будет использоваться во время согласования TLS (или повторного согласования), если сервер требует проверки подлинности клиента.

## <a name="write-only-http-headers"></a>Заголовки HTTP только для записи
Служба BITS помогает защитить маркеры проверки подлинности HTTP от нежелательного доступа. Часто HTTP-серверу требуется определенный маркер безопасности или строка при скачивании или отправке файла на HTTP-серверы.

Служба BITS защищает эти маркеры проверки подлинности несколькими способами.
* Служба BITS позволяет использовать HTTP-подключения, защищенные с помощью TLS и SSL, путем указания URL-адреса HTTPS.
* Пользовательские заголовки всегда сохраняются в зашифрованном виде на диске.
* Вы можете запретить возврат заголовков клиентов другим программам с помощью метода [**IBackgroundCopyJobHttpOptions3:: макекустомхеадерсвритеонли**](/windows/win32/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-makecustomheaderswriteonly) .


## <a name="standard-and-administrator-users"></a>Пользователи Standard и Administrator
Пользователь, который входит в группу администраторов, может запустить процесс со стандартным доступом пользователей или в состоянии с повышенными правами (с правами администратора). Служба BITS будет запускать задание в любом состоянии при условии, что пользователь вошел в систему на компьютере. Однако если пользователь создал задание или не владеет заданием в привилегированном состоянии, он должен находиться в состоянии повышенной привилегии, чтобы получить или изменить задание (в противном случае вызов завершается с отказом в доступе (0x80070005)). Чтобы определить состояние задания с повышенными привилегиями, вызовите метод [**IBackgroundCopyJob4:: жетовнерелеватионстате**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerelevationstate) .

Стандартный пользователь не может перечислить или изменить задания, принадлежащие другим пользователям.

## <a name="integrity-level"></a>Уровень целостности
Помимо состояния с повышенными правами, уровень целостности токена может определять, может ли пользователь изменять задание. Клиент не может изменять задания, созданные маркером, с более высоким уровнем целостности. В частности, многие маркеры локальной системы имеют уровень целостности выше уровня целостности окна с повышенными привилегиями и поэтому не могут быть изменены администратором из обычного окна командной строки с повышенными привилегиями. Например, Центр обновления Windows и задания SMS выполняются от имени LocalSystem с более высоким уровнем целостности, чем маркер с повышенными правами, поэтому администратор не может изменять или удалять эти задания. Чтобы изменить это задание, создайте задачу планировщик задач, которая выполняется как локальная система. Задача может выполнять консольное приложение, использующее API BITS, или задача может выполнить сценарий, вызывающий BitsAdmin.exe. Чтобы определить используемый уровень целостности, вызовите метод [**IBackgroundCopyJob4:: жетовнеринтегритилевел**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerintegritylevel) .

## <a name="service-identity"></a>Удостоверение службы
Начиная с Windows 10 Май 2019 обновления (10,0; Сборка 18362). задания BITS, запущенные из службы, будут поддерживать удостоверение службы. Это позволяет службам, которые хотят использовать BITS, скачивать файлы или передавать их из каталога, разрешения которого привязаны к идентификатору безопасности службы. Кроме того, сетевой трафик будет правильно относиться к службе, которая запросила задание BITS вместо атрибута BITS.

 




