---
title: Учетные записи служб и службы BITS
description: Для передачи файлов из службы можно использовать службу BITS. Служба должна использовать системную учетную запись LocalSystem, LocalService или NetworkService. Эти учетные записи всегда входят в систему. Поэтому всегда выполняются задания, отправленные службой с помощью этих учетных записей.
ms.assetid: 43fb58d6-3a99-488f-ab43-dbb4a794fc2f
keywords:
- БИТЫ учетных записей служб
- БИТЫ задания передачи, владение, учетная запись службы
- БИТЫ прокси-сервера, учетные записи служб
- учетные данные для передачи битов задания
ms.topic: article
ms.date: 10/04/2018
ms.openlocfilehash: 475a623e6b105d3ef2bdc6586db613c010fe8923
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104134042"
---
# <a name="service-accounts-and-bits"></a><span data-ttu-id="b6760-109">Учетные записи служб и службы BITS</span><span class="sxs-lookup"><span data-stu-id="b6760-109">Service Accounts and BITS</span></span>

<span data-ttu-id="b6760-110">Для передачи файлов из службы можно использовать службу BITS.</span><span class="sxs-lookup"><span data-stu-id="b6760-110">You can use BITS to transfer files from a service.</span></span> <span data-ttu-id="b6760-111">Служба должна использовать системную учетную запись LocalSystem, LocalService или NetworkService.</span><span class="sxs-lookup"><span data-stu-id="b6760-111">The service must use the LocalSystem, LocalService, or NetworkService system account.</span></span> <span data-ttu-id="b6760-112">Эти учетные записи всегда входят в систему. Поэтому всегда выполняются задания, отправленные службой с помощью этих учетных записей.</span><span class="sxs-lookup"><span data-stu-id="b6760-112">These accounts are always logged on; therefore, jobs submitted by a service using these accounts always run.</span></span>

<span data-ttu-id="b6760-113">Если служба, работающая под системной учетной записью, олицетворяет пользователя перед вызовом BITS, служба BITS реагирует так же, как для любой учетной записи пользователя (например, пользователь должен войти на компьютер для выполнения передачи).</span><span class="sxs-lookup"><span data-stu-id="b6760-113">If a service running under a system account impersonates the user before calling BITS, BITS responds as it would for any user account (for example, the user needs to be logged on to the computer for the transfer to occur).</span></span> <span data-ttu-id="b6760-114">Служба должна также использовать динамическую маскировку с указателями интерфейса BITS при олицетворении пользователя.</span><span class="sxs-lookup"><span data-stu-id="b6760-114">The service should also use dynamic cloaking with the BITS interface pointers when impersonating the user.</span></span> <span data-ttu-id="b6760-115">Маскировка не наследуется, поэтому необходимо вызвать функцию [**CoSetProxyBlanket**](/windows/win32/api/combaseapi/nf-combaseapi-cosetproxyblanket) для каждого указателя интерфейса, полученного из битов (например, указатель задания, возвращаемый из вызова метода [**Ибаккграундкопиманажер:: CreateJob**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopymanager-createjob) ); Установка маскировки на указатель интерфейса диспетчера недостаточна.</span><span class="sxs-lookup"><span data-stu-id="b6760-115">Cloaking is not inherited, therefore you must call the [**CoSetProxyBlanket**](/windows/win32/api/combaseapi/nf-combaseapi-cosetproxyblanket) function on each interface pointer that you receive from BITS (for example, the job pointer returned from calling the [**IBackgroundCopyManager::CreateJob**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopymanager-createjob) method); it is not enough to set cloaking on the manager interface pointer.</span></span> <span data-ttu-id="b6760-116">Можно также вызвать функцию [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) для процесса вместо вызова функции **CoSetProxyBlanket** для каждого указателя интерфейса.</span><span class="sxs-lookup"><span data-stu-id="b6760-116">You can also call the [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) function for the process instead of calling the **CoSetProxyBlanket** function on each interface pointer.</span></span>

<span data-ttu-id="b6760-117">Однако если служба не олицетворяет пользователя, применяются следующие варианты поведения.</span><span class="sxs-lookup"><span data-stu-id="b6760-117">However, if the service does not impersonate the user, the following behaviors apply:</span></span>

- <span data-ttu-id="b6760-118">Задания, созданные учетной записью службы, принадлежат этой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="b6760-118">Jobs created by the service account are owned by that account.</span></span> <span data-ttu-id="b6760-119">Поскольку системные учетные записи всегда входят в систему, служба BITS передает файлы при условии, что компьютер работает и имеется сетевое подключение.</span><span class="sxs-lookup"><span data-stu-id="b6760-119">Because system accounts are always logged on, BITS transfers the files as long as the computer is running and there is a network connection.</span></span>
- <span data-ttu-id="b6760-120">Системные учетные записи не должны использовать сопоставленные буквы сетевого диска, так как буквы дисков относятся только к сеансу, а сопоставление может быть потеряно после перезагрузки компьютера.</span><span class="sxs-lookup"><span data-stu-id="b6760-120">System accounts should not use mapped network drive letters because the drive letters are specific to a session and the mapping may be lost after a computer restart.</span></span>
- <span data-ttu-id="b6760-121">При отсутствии [вспомогательного токена](helper-tokens-for-bits-transfer-jobs.md)сетевая аутентификация использует учетные данные компьютера для учетных записей LocalSystem и NetworkService, а также анонимные учетные данные для учетной записи LocalService.</span><span class="sxs-lookup"><span data-stu-id="b6760-121">In the absence of a [Helper Token](helper-tokens-for-bits-transfer-jobs.md), network authentication uses computer credentials for LocalSystem and NetworkService accounts and anonymous credentials for the LocalService account.</span></span> <span data-ttu-id="b6760-122">Служба BITS возвращает значение "отказано в доступе", если список управления доступом (ACL) для исходного файла ограничивает доступ к учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="b6760-122">BITS returns "access denied" if the access control list (ACL) for the source file limits access to a user account.</span></span>
- <span data-ttu-id="b6760-123">Дополнительные сведения о работе проверки подлинности при наличии [вспомогательного токена](helper-tokens-for-bits-transfer-jobs.md)см. в разделе [Проверка подлинности](authentication.md).</span><span class="sxs-lookup"><span data-stu-id="b6760-123">For details on how authentication works in the presence of a [Helper Token](helper-tokens-for-bits-transfer-jobs.md), see [Authentication](authentication.md).</span></span>
- <span data-ttu-id="b6760-124">Параметры прокси-сервера Microsoft Internet Explorer хранятся для каждого пользователя и не задаются для системных учетных записей.</span><span class="sxs-lookup"><span data-stu-id="b6760-124">Microsoft Internet Explorer proxy settings are stored per-user and are not set for system accounts.</span></span> <span data-ttu-id="b6760-125">Рассмотрите возможность настройки вспомогательного токена для заданий BITS или явное задание правильных параметров прокси-сервера путем вызова метода [**использованием метода ibackgroundcopyjob:: SetProxySettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) с **\_ \_ \_ \_ переопределением использования прокси-сервера задания BG**.</span><span class="sxs-lookup"><span data-stu-id="b6760-125">Consider configuring a helper token on your BITS jobs, or explicitly setting the correct proxy settings by calling [**IBackgroundCopyJob::SetProxySettings**](/windows/desktop/api/Bits/nf-bits-ibackgroundcopyjob-setproxysettings) with **BG\_JOB\_PROXY\_USAGE\_OVERRIDE**.</span></span> <span data-ttu-id="b6760-126">Кроме того, для настройки параметров прокси-сервера Internet Explorer для системной учетной записи LocalSystem, LocalService или NetworkService можно использовать параметры BitsAdmin.exe **/Сетиепрокси/утил** .</span><span class="sxs-lookup"><span data-stu-id="b6760-126">Alternatively, you can use the **/Util /SetIEProxy** switches of BitsAdmin.exe to set Internet Explorer proxy settings for the LocalSystem, LocalService, or NetworkService system account.</span></span> <span data-ttu-id="b6760-127">Дополнительные сведения см. в разделе [средство битсадмин](bitsadmin-tool.md).</span><span class="sxs-lookup"><span data-stu-id="b6760-127">For details, see [BitsAdmin Tool](bitsadmin-tool.md).</span></span>

<span data-ttu-id="b6760-128">Обратите внимание, что служба BITS не распознает параметры прокси-сервера, заданные с помощью файла Proxycfg.exe.</span><span class="sxs-lookup"><span data-stu-id="b6760-128">Note that BITS does not recognize the proxy settings that are set using the Proxycfg.exe file.</span></span>