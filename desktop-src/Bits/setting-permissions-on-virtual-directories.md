---
title: Настройка разрешений для виртуальных каталогов
description: По соображениям безопасности фоновая интеллектуальная служба передачи (BITS) не передает файлы в виртуальный каталог с включенными разрешениями сценариев и выполнения.
ms.assetid: cf5c8b50-066f-431e-8bdf-ed0692219b20
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e6753c326e926724a57e1905c3fb9fe24e28fdc7
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104070222"
---
# <a name="setting-permissions-on-virtual-directories"></a><span data-ttu-id="bf450-103">Настройка разрешений для виртуальных каталогов</span><span class="sxs-lookup"><span data-stu-id="bf450-103">Setting Permissions on Virtual Directories</span></span>

<span data-ttu-id="bf450-104">По соображениям безопасности фоновая интеллектуальная служба передачи (BITS) не передает файлы в виртуальный каталог с включенными разрешениями сценариев и выполнения.</span><span class="sxs-lookup"><span data-stu-id="bf450-104">For security reasons, Background Intelligent Transfer Service (BITS) does not upload files to a virtual directory that has scripting and execute permissions enabled.</span></span> <span data-ttu-id="bf450-105">Если вы отправите файл в виртуальный каталог, в котором включены эти разрешения, задание завершится с кодом ошибки BG \_ E \_ Server \_ Executed \_ .</span><span class="sxs-lookup"><span data-stu-id="bf450-105">If you upload a file to a virtual directory that has these permissions enabled, the job fails with an error code of BG\_E\_SERVER\_EXECUTE\_ENABLED.</span></span>

<span data-ttu-id="bf450-106">Для BITS не требуется, чтобы виртуальный каталог был разрешен записью, поэтому рекомендуется отключить доступ на запись к виртуальному каталогу.</span><span class="sxs-lookup"><span data-stu-id="bf450-106">BITS does not require the virtual directory to be write enabled, so it is recommended that you turn off write access to the virtual directory.</span></span>

<span data-ttu-id="bf450-107">Прошедший проверку подлинности пользователь (или анонимный пользователь IIS для анонимной проверки подлинности) должен иметь разрешения на изменение физического каталога, с которым сопоставлен виртуальный каталог; предоставление разрешений на запись не является достаточным.</span><span class="sxs-lookup"><span data-stu-id="bf450-107">The authenticated user (or IIS's Anonymous user for anonymous authentication) must have Change permissions on the physical directory to which the virtual directory is mapped; granting Write permissions does not suffice.</span></span>

## <a name="specifying-permissions-for-notifications"></a><span data-ttu-id="bf450-108">Указание разрешений для уведомлений</span><span class="sxs-lookup"><span data-stu-id="bf450-108">Specifying Permissions for Notifications</span></span>

<span data-ttu-id="bf450-109">Схема проверки подлинности, указанная для виртуального каталога и URL-адреса уведомления (см. свойство [битссервернотификатионурл](bits-iis-extension-properties.md) ), должна быть совместимой.</span><span class="sxs-lookup"><span data-stu-id="bf450-109">The authentication scheme you specify for the virtual directory and notification URL (see the [BITSServerNotificationURL](bits-iis-extension-properties.md) property) must be compatible.</span></span> <span data-ttu-id="bf450-110">Служба BITS использует схему проверки подлинности, указанную для виртуального каталога, для доступа к URL-адресу уведомления.</span><span class="sxs-lookup"><span data-stu-id="bf450-110">BITS uses the authentication scheme specified for the virtual directory to access the notification URL.</span></span> <span data-ttu-id="bf450-111">Задание отправки завершается сбоем, если службе BITS не удается получить доступ к URL-адресу уведомления из-за ошибки проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="bf450-111">The upload job fails if BITS is unable to access the notification URL due to authentication failure.</span></span>

<span data-ttu-id="bf450-112">Если тип уведомления (см. свойство [битссервернотификатионтипе](bits-iis-extension-properties.md) ) указан [по ссылке](using-bits-notification-request-response-headers.md), приложение должно обеспечить доступ пользователя к файлу, на который указывает ссылка (см. заголовок [File-Request--Name](notification-protocol-for-server-applications.md) ).</span><span class="sxs-lookup"><span data-stu-id="bf450-112">If the notification type (see the [BITSServerNotificationType](bits-iis-extension-properties.md) property) is [by reference](using-bits-notification-request-response-headers.md), the application must ensure the user has access to the referenced file (see the [BITS-Request-DataFile-Name](notification-protocol-for-server-applications.md) header).</span></span> <span data-ttu-id="bf450-113">Служба BITS устанавливает списки ACL для упоминаемого файла в соответствии с физическим каталогом, с которым сопоставлен виртуальный каталог.</span><span class="sxs-lookup"><span data-stu-id="bf450-113">BITS sets the ACLs on the referenced file to those of the physical directory to which the virtual directory is mapped.</span></span>

> [!Note]  
> <span data-ttu-id="bf450-114">Приложение с уведомлением должно иметь возможность сопоставлять и обращаться к удаленному файлу, даже если URL-адрес уведомления обслуживается веб-сервером, расположенным на компьютере, отличном от физического каталога передачи.</span><span class="sxs-lookup"><span data-stu-id="bf450-114">The notified application must be able to map and access the remote file even if the notification URL is serviced by a web server that is on a different computer than the physical upload directory.</span></span> <span data-ttu-id="bf450-115">Заголовок [BITS-Request-File-Name](notification-protocol-for-server-applications.md) всегда содержит спецификацию пути относительно компьютера, на котором размещен компонент расширений BITS.</span><span class="sxs-lookup"><span data-stu-id="bf450-115">The [BITS-Request-DataFile-Name](notification-protocol-for-server-applications.md) header always contains a path specification that is relative to the computer hosting the BITS Extensions component.</span></span> <span data-ttu-id="bf450-116">Приложению, выполняющемуся на другом компьютере, может потребоваться преобразовать путь в UNC-путь, прежде чем обращаться к нему.</span><span class="sxs-lookup"><span data-stu-id="bf450-116">An application running on another computer might need to convert the path to an UNC path before accessing it.</span></span>

 

<span data-ttu-id="bf450-117">Служба BITS поддерживает множество сочетаний схем проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="bf450-117">BITS supports many combinations of authentication schemes.</span></span> <span data-ttu-id="bf450-118">Тем не менее следует использовать следующую схему проверки подлинности для виртуального каталога и URL-адреса уведомления сопоставления.</span><span class="sxs-lookup"><span data-stu-id="bf450-118">However, you should use the following authentication scheme for the virtual directory and the matching notification URL.</span></span>

-   <span data-ttu-id="bf450-119">Для поддержки уведомлений по ссылке виртуальный каталог должен быть настроен на использование проверки подлинности NTLM (Negotiate), если физический каталог передачи (каталог, на который указывает виртуальный каталог) использует схему проверки подлинности, отличную от Anonymous.</span><span class="sxs-lookup"><span data-stu-id="bf450-119">To support by reference notifications, the virtual directory should be configured to use NTLM (negotiate) authentication if the physical upload directory (the directory to which the virtual directory points) uses an authentication scheme other than anonymous.</span></span> <span data-ttu-id="bf450-120">Если физический каталог отправки разрешает анонимные запросы (без проверки подлинности), виртуальный каталог должен включать анонимный режим (без проверки подлинности).</span><span class="sxs-lookup"><span data-stu-id="bf450-120">If the physical upload directory allows anonymous requests (no authentication), the virtual directory should enable anonymous (no authentication).</span></span>

    <span data-ttu-id="bf450-121">Списки ACL в каталоге физической передачи должны быть установлены таким, чтобы прошедший проверку подлинности пользователь мог считывать файлы в каталоге, на который указывает URL-адрес уведомления.</span><span class="sxs-lookup"><span data-stu-id="bf450-121">The ACLs on the physical upload directory must be set such that the authenticated user can read files on the directory to which the notification URL points.</span></span> <span data-ttu-id="bf450-122">Служба BITS использует списки ACL для физического каталога передачи, чтобы задать списки управления доступом для временного файла отправки (заголовок [BITS-Request-File-Name](notification-protocol-for-server-applications.md) содержит путь к временному файлу).</span><span class="sxs-lookup"><span data-stu-id="bf450-122">BITS uses the ACLs of the physical upload directory to set the ACLs of temporary upload file (the [BITS-Request-DataFile-Name](notification-protocol-for-server-applications.md) header contains the path to the temporary file).</span></span>

-   <span data-ttu-id="bf450-123">Так как для уведомлений [по значению](using-bits-notification-request-response-headers.md) не требуется, чтобы приложение с уведомлением получало доступ к временному файлу, содержащему содержимое передачи, схема проверки подлинности может быть анонимной или согласованной (NTLM).</span><span class="sxs-lookup"><span data-stu-id="bf450-123">Because [by value](using-bits-notification-request-response-headers.md) notifications do not require the notified application to access a temporary file that contains the upload contents, the authentication scheme can be either anonymous or negotiate (NTLM).</span></span> <span data-ttu-id="bf450-124">Единственное требование заключается в том, что прошедший проверку подлинности пользователя для виртуального каталога также должен быть разрешен доступ к URL-адресу уведомления.</span><span class="sxs-lookup"><span data-stu-id="bf450-124">The only requirement is that the authenticated user for the virtual directory must also be authorized to access the notification URL.</span></span>

## <a name="specifying-permissions-for-remote-shares"></a><span data-ttu-id="bf450-125">Указание разрешений для удаленных общих папок</span><span class="sxs-lookup"><span data-stu-id="bf450-125">Specifying Permissions for Remote Shares</span></span>

<span data-ttu-id="bf450-126">Виртуальный каталог может указывать на сопоставленный диск на другом компьютере или в общей сетевой папке.</span><span class="sxs-lookup"><span data-stu-id="bf450-126">A virtual directory can point to a mapped drive on a different machine or a network share.</span></span> <span data-ttu-id="bf450-127">Если он указывает на сопоставленный сетевой диск, учетные данные, используемые для сопоставления диска, должны иметь полный контроль над удаленной общей папкой.</span><span class="sxs-lookup"><span data-stu-id="bf450-127">If it points to a mapped network drive, the credentials used to map the drive should have full control on the remote share.</span></span>

<span data-ttu-id="bf450-128">Если виртуальный каталог указывает на сетевую папку, служба BITS использует для доступа к удаленной общей папке учетные данные пользователя **Connect от имени** этого виртуального каталога.</span><span class="sxs-lookup"><span data-stu-id="bf450-128">If the virtual directory points to a network share, BITS uses the virtual directory's **Connect As** user credentials to access the remote share.</span></span> <span data-ttu-id="bf450-129">Для доступа к удаленной общей папке учетная запись **подключения от имени** должна иметь привилегии, как описано в документации по функции [**LogonUser**](/windows/desktop/api/winbase/nf-winbase-logonusera) .</span><span class="sxs-lookup"><span data-stu-id="bf450-129">To access a remote share, the **Connect As** account needs to have privileges as described in the documentation for the [**LogonUser**](/windows/desktop/api/winbase/nf-winbase-logonusera) function.</span></span> <span data-ttu-id="bf450-130">Служба BITS выполняет вход в систему с использованием LOGON32 входа в систему \_ \_ или с LOGON32 \_ входом в \_ интерактивном режиме входа.</span><span class="sxs-lookup"><span data-stu-id="bf450-130">BITS logs on using LOGON32\_LOGON\_BATCH or LOGON32\_LOGON\_INTERACTIVE logon types.</span></span> <span data-ttu-id="bf450-131">Учетной записи пользователя **Connect AS** требуется Full-Access разрешения на удаленную общую папку. предоставление разрешений на запись не является достаточным.</span><span class="sxs-lookup"><span data-stu-id="bf450-131">The **Connect As** user account needs Full-Access permissions to the remote share; granting Write permissions does not suffice.</span></span>

<span data-ttu-id="bf450-132">Когда физический каталог отправки сопоставляется с общей сетевой папкой, идентификатор вызывающего объекта, запрашивающего URL-адрес уведомления, является либо пользователем **Connect AS** , либо прошедшим проверку подлинности пользователем физического каталога передачи (доступно только в IIS 6,0 и более поздних версиях, если флажок **всегда использовать учетные данные пользователя, прошедшего проверку подлинности при проверке доступа к сетевому ресурсу** выбран **в диалоговом окне**</span><span class="sxs-lookup"><span data-stu-id="bf450-132">When the physical upload directory is mapped to a network share, the identity of the caller requesting the notification URL is either the **Connect As** user, or the authenticated user of the physical upload directory (only available in IIS 6.0 and later, when the check box **Always use the authenticated user's credentials when validating access to the network resource** is selected on the **Connect As** dialog box).</span></span>

 

 