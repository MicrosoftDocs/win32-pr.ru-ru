---
description: Объект, инкапсулирующий несколько DSP, связанных с захватом голоса.
ms.assetid: 6c77c8f6-289e-4130-b56a-e1f0bcc40f3e
title: DSP для записи голоса (Вмкодекдсп. h)
ms.topic: reference
ms.date: 05/31/2018
ms.openlocfilehash: 6e48c3b3194873008f45ef80ef3a21dad416158b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103812569"
---
# <a name="voice-capture-dsp"></a><span data-ttu-id="9bdfb-103">DSP для записи речи</span><span class="sxs-lookup"><span data-stu-id="9bdfb-103">Voice Capture DSP</span></span>

<span data-ttu-id="9bdfb-104">Объект, инкапсулирующий несколько DSP, связанных с захватом голоса.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-104">An object that encapsulates several DSPs related to voice capture.</span></span>

## <a name="clsid"></a><span data-ttu-id="9bdfb-105">CLSID</span><span class="sxs-lookup"><span data-stu-id="9bdfb-105">CLSID</span></span>

<span data-ttu-id="9bdfb-106">\_КВМАУДИОАЕК CLSID</span><span class="sxs-lookup"><span data-stu-id="9bdfb-106">CLSID\_CWMAudioAEC</span></span>

## <a name="interfaces"></a><span data-ttu-id="9bdfb-107">Интерфейсы</span><span class="sxs-lookup"><span data-stu-id="9bdfb-107">Interfaces</span></span>

-   [<span data-ttu-id="9bdfb-108">**имедиаобжект**</span><span class="sxs-lookup"><span data-stu-id="9bdfb-108">**IMediaObject**</span></span>](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobject)
-   <span data-ttu-id="9bdfb-109">**ипропертисторе**</span><span class="sxs-lookup"><span data-stu-id="9bdfb-109">**IPropertyStore**</span></span>

## <a name="properties"></a><span data-ttu-id="9bdfb-110">Свойства</span><span class="sxs-lookup"><span data-stu-id="9bdfb-110">Properties</span></span>



| <span data-ttu-id="9bdfb-111">Свойство</span><span class="sxs-lookup"><span data-stu-id="9bdfb-111">Property</span></span>                                                                                     | <span data-ttu-id="9bdfb-112">Описание</span><span class="sxs-lookup"><span data-stu-id="9bdfb-112">Description</span></span>                                                                                       |
|----------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="9bdfb-113">\_ \_ индексы устройств мфпкэй вмааекма \_</span><span class="sxs-lookup"><span data-stu-id="9bdfb-113">MFPKEY\_WMAAECMA\_DEVICE\_INDEXES</span></span>](mfpkey-wmaaecma-device-indexesproperty.md)              | <span data-ttu-id="9bdfb-114">Указывает, какие звуковые устройства использует DMO для записи и визуализации звука.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-114">Specifies which audio devices the DMO uses for capturing and rendering audio.</span></span>                     |
| [<span data-ttu-id="9bdfb-115">МФПКЭЙ \_ вмааекма \_ девицепаир \_ GUID</span><span class="sxs-lookup"><span data-stu-id="9bdfb-115">MFPKEY\_WMAAECMA\_DEVICEPAIR\_GUID</span></span>](mfpkey-wmaaecma-devicepair-guidproperty.md)            | <span data-ttu-id="9bdfb-116">Определяет комбинацию звуковых устройств, которые в настоящее время используются приложением.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-116">Identifies the combination of audio devices that the application is currently using.</span></span>              |
| [<span data-ttu-id="9bdfb-117">\_ \_ \_ исходный режим мфпкэй вмааекма \_ DMO</span><span class="sxs-lookup"><span data-stu-id="9bdfb-117">MFPKEY\_WMAAECMA\_DMO\_SOURCE\_MODE</span></span>](mfpkey-wmaaecma-dmo-source-modeproperty.md)           | <span data-ttu-id="9bdfb-118">Указывает, использует ли DMO режим источника или фильтра.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-118">Specifies whether the DMO uses source mode or filter mode.</span></span>                                        |
| [<span data-ttu-id="9bdfb-119">МФПКЭЙ \_ вмааекма \_ феатр \_ AES</span><span class="sxs-lookup"><span data-stu-id="9bdfb-119">MFPKEY\_WMAAECMA\_FEATR\_AES</span></span>](mfpkey-wmaaecma-featr-aesproperty.md)                        | <span data-ttu-id="9bdfb-120">Указывает, сколько раз DMO выполняет подавление акустического эха (AES) на остаточном сигнале.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-120">Specifies how many times the DMO performs acoustic echo suppression (AES) on the residual signal.</span></span> |
| [<span data-ttu-id="9bdfb-121">МФПКЭЙ \_ вмааекма \_ феатр \_ АГК</span><span class="sxs-lookup"><span data-stu-id="9bdfb-121">MFPKEY\_WMAAECMA\_FEATR\_AGC</span></span>](mfpkey-wmaaecma-featr-agcproperty.md)                        | <span data-ttu-id="9bdfb-122">Указывает, выполняет ли DMO автоматический контроль усиления.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-122">Specifies whether the DMO performs automatic gain control.</span></span>                                        |
| [<span data-ttu-id="9bdfb-123">МФПКЭЙ \_ вмааекма \_ феатр \_ \_</span><span class="sxs-lookup"><span data-stu-id="9bdfb-123">MFPKEY\_WMAAECMA\_FEATR\_CENTER\_CLIP</span></span>](mfpkey-wmaaecma-featr-center-clipproperty.md)       | <span data-ttu-id="9bdfb-124">Указывает, выполняет ли DMO вырезание по центру.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-124">Specifies whether the DMO performs center clipping.</span></span>                                               |
| [<span data-ttu-id="9bdfb-125">МФПКЭЙ \_ вмааекма \_ феатр \_ \_ Длина эхо</span><span class="sxs-lookup"><span data-stu-id="9bdfb-125">MFPKEY\_WMAAECMA\_FEATR\_ECHO\_LENGTH</span></span>](mfpkey-wmaaecma-featr-echo-lengthproperty.md)       | <span data-ttu-id="9bdfb-126">Указывает длительность эха, который может обрабатывать алгоритм отмены акустических эха (AEC).</span><span class="sxs-lookup"><span data-stu-id="9bdfb-126">Specifies the duration of echo that the acoustic echo cancellation (AEC) algorithm can handle.</span></span>    |
| [<span data-ttu-id="9bdfb-127">МФПКЭЙ \_ вмааекма \_ феатр \_ \_ Размер кадра</span><span class="sxs-lookup"><span data-stu-id="9bdfb-127">MFPKEY\_WMAAECMA\_FEATR\_FRAME\_SIZE</span></span>](mfpkey-wmaaecma-featr-frame-sizeproperty.md)         | <span data-ttu-id="9bdfb-128">Задает размер звукового кадра.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-128">Specifies the audio frame size.</span></span>                                                                   |
| [<span data-ttu-id="9bdfb-129">МФПКЭЙ \_ вмааекма \_ феатр \_ микарр \_</span><span class="sxs-lookup"><span data-stu-id="9bdfb-129">MFPKEY\_WMAAECMA\_FEATR\_MICARR\_BEAM</span></span>](mfpkey-wmaaecma-featr-micarr-beamproperty.md)       | <span data-ttu-id="9bdfb-130">Указывает, какой образ используется DMO для обработки массива микрофона.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-130">Specifies which beam the DMO uses for microphone array processing.</span></span>                                |
| [<span data-ttu-id="9bdfb-131">МФПКЭЙ \_ вмааекма \_ феатр \_ микарр \_ mode</span><span class="sxs-lookup"><span data-stu-id="9bdfb-131">MFPKEY\_WMAAECMA\_FEATR\_MICARR\_MODE</span></span>](mfpkey-wmaaecma-featr-micarr-modeproperty.md)       | <span data-ttu-id="9bdfb-132">Указывает, как DMO выполняет обработку массива микрофона.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-132">Specifies how the DMO performs microphone array processing.</span></span>                                       |
| [<span data-ttu-id="9bdfb-133">МФПКЭЙ \_ вмааекма \_ феатр \_ микарр \_</span><span class="sxs-lookup"><span data-stu-id="9bdfb-133">MFPKEY\_WMAAECMA\_FEATR\_MICARR\_PREPROC</span></span>](mfpkey-wmaaecma-featr-micarr-preprocproperty.md) | <span data-ttu-id="9bdfb-134">Указывает, выполняет ли DMO предварительную обработку массива микрофонов.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-134">Specifies whether the DMO performs microphone array preprocessing.</span></span>                                |
| [<span data-ttu-id="9bdfb-135">МФПКЭЙ \_ вмааекма \_ феатр \_ , \_ Заливка шума</span><span class="sxs-lookup"><span data-stu-id="9bdfb-135">MFPKEY\_WMAAECMA\_FEATR\_NOISE\_FILL</span></span>](mfpkey-wmaaecma-featr-noise-fillproperty.md)         | <span data-ttu-id="9bdfb-136">Указывает, выполняет ли объект DMO заливку шума.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-136">Specifies whether the DMO performs noise filling.</span></span>                                                 |
| [<span data-ttu-id="9bdfb-137">МФПКЭЙ \_ вмааекма \_ феатр \_ NS</span><span class="sxs-lookup"><span data-stu-id="9bdfb-137">MFPKEY\_WMAAECMA\_FEATR\_NS</span></span>](mfpkey-wmaaecma-featr-nsproperty.md)                          | <span data-ttu-id="9bdfb-138">Указывает, выполняет ли DMO подавление шума.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-138">Specifies whether the DMO performs noise suppression.</span></span>                                             |
| [<span data-ttu-id="9bdfb-139">МФПКЭЙ \_ вмааекма \_ феатр \_ Вад</span><span class="sxs-lookup"><span data-stu-id="9bdfb-139">MFPKEY\_WMAAECMA\_FEATR\_VAD</span></span>](mfpkey-wmaaecma-featr-vadproperty.md)                        | <span data-ttu-id="9bdfb-140">Указывает тип обнаружения действий речи, выполняемых DMO.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-140">Specifies the type of voice activity detection that the DMO performs.</span></span>                             |
| [<span data-ttu-id="9bdfb-141">\_ \_ режим компонента мфпкэй \_ вмааекма</span><span class="sxs-lookup"><span data-stu-id="9bdfb-141">MFPKEY\_WMAAECMA\_FEATURE\_MODE</span></span>](mfpkey-wmaaecma-feature-modeproperty.md)                  | <span data-ttu-id="9bdfb-142">Позволяет приложению переопределять параметры по умолчанию для различных свойств.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-142">Enables the application to override the default settings on various properties.</span></span>                   |
| [<span data-ttu-id="9bdfb-143">МФПКЭЙ \_ вмааекма \_ для \_ усиления микрофона \_</span><span class="sxs-lookup"><span data-stu-id="9bdfb-143">MFPKEY\_WMAAECMA\_MIC\_GAIN\_BOUNDER</span></span>](mfpkey-wmaaecma-mic-gain-bounderproperty.md)         | <span data-ttu-id="9bdfb-144">Указывает, применяет ли DMO границы усиления микрофона.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-144">Specifies whether the DMO applies microphone gain bounding.</span></span>                                       |
| [<span data-ttu-id="9bdfb-145">МФПКЭЙ \_ вмааекма \_ микаррай \_ дескптр</span><span class="sxs-lookup"><span data-stu-id="9bdfb-145">MFPKEY\_WMAAECMA\_MICARRAY\_DESCPTR</span></span>](mfpkey-wmaaecma-micarray-descptrproperty.md)          | <span data-ttu-id="9bdfb-146">Задает геометрию массива микрофона.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-146">Specifies the microphone array geometry.</span></span>                                                          |
| [<span data-ttu-id="9bdfb-147">\_ \_ метрики качества мфпкэй вмааекма \_</span><span class="sxs-lookup"><span data-stu-id="9bdfb-147">MFPKEY\_WMAAECMA\_QUALITY\_METRICS</span></span>](mfpkey-wmaaecma-quality-metricsproperty.md)            | <span data-ttu-id="9bdfb-148">Получает метрики качества для контекста AEC.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-148">Retrieves quality metrics for AEC.</span></span>                                                                |
| [<span data-ttu-id="9bdfb-149">МФПКЭЙ \_ вмааекма \_ Получение \_ \_ статистики TS</span><span class="sxs-lookup"><span data-stu-id="9bdfb-149">MFPKEY\_WMAAECMA\_RETRIEVE\_TS\_STATS</span></span>](mfpkey-wmaaecma-retrieve-ts-statsproperty.md)       | <span data-ttu-id="9bdfb-150">Указывает, сохраняет ли объекты DMO статистику штампа времени в реестре.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-150">Specifies whether the DMO stores time stamp statistics in the registry.</span></span>                           |
| [<span data-ttu-id="9bdfb-151">МФПКЭЙ \_ вмааекма \_ \_ режим системы</span><span class="sxs-lookup"><span data-stu-id="9bdfb-151">MFPKEY\_WMAAECMA\_SYSTEM\_MODE</span></span>](mfpkey-wmaaecma-system-modeproperty.md)                    | <span data-ttu-id="9bdfb-152">Задает режим обработки.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-152">Sets the processing mode.</span></span>                                                                         |



 

## <a name="remarks"></a><span data-ttu-id="9bdfb-153">Комментарии</span><span class="sxs-lookup"><span data-stu-id="9bdfb-153">Remarks</span></span>

<span data-ttu-id="9bdfb-154">В отличие от других DSP, объект записи голоса инкапсулирует несколько DSP в один объект, а объект является только объектом DMO (он не реализует [**имфтрансформ**](/windows/desktop/api/mftransform/nn-mftransform-imftransform)).</span><span class="sxs-lookup"><span data-stu-id="9bdfb-154">Unlike the other DSPs, the voice capture object encapsulates multiple DSPs in a single object, and the object is a DMO object only (it does not implement [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform)).</span></span> <span data-ttu-id="9bdfb-155">Для записи голоса DMO включены следующие компоненты DSP:</span><span class="sxs-lookup"><span data-stu-id="9bdfb-155">The voice capture DMO includes the following DSP components:</span></span>

-   <span data-ttu-id="9bdfb-156">Отмена акустического эха (AEC)</span><span class="sxs-lookup"><span data-stu-id="9bdfb-156">Acoustic echo cancellation (AEC)</span></span>
-   <span data-ttu-id="9bdfb-157">Обработка массива микрофона</span><span class="sxs-lookup"><span data-stu-id="9bdfb-157">Microphone array processing</span></span>
-   <span data-ttu-id="9bdfb-158">Подавление шумов</span><span class="sxs-lookup"><span data-stu-id="9bdfb-158">Noise suppression</span></span>
-   <span data-ttu-id="9bdfb-159">Автоматическое усиление контроля</span><span class="sxs-lookup"><span data-stu-id="9bdfb-159">Automatic gain control</span></span>
-   <span data-ttu-id="9bdfb-160">Определение действий речи</span><span class="sxs-lookup"><span data-stu-id="9bdfb-160">Voice activity detection</span></span>

<span data-ttu-id="9bdfb-161">Приложения могут включать и отключать каждый компонент отдельно.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-161">Applications can turn each component on and off individually.</span></span>

<span data-ttu-id="9bdfb-162">Запись голоса DMO поддерживает два режима работы: режим *фильтрации* и *Исходный* режим.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-162">The voice capture DMO supports two modes of operation, *filter* mode and *source* mode.</span></span> <span data-ttu-id="9bdfb-163">В режиме фильтрации приложение отправляет звуковые примеры с микрофона и из линии динамика в DMO, и DMO выдает выходные данные.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-163">In filter mode, the application sends audio samples from the microphone and from the speaker line to the DMO, and the DMO produces output.</span></span>

<span data-ttu-id="9bdfb-164">В режиме исходного кода приложению не нужно доставлять примеры в DMO.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-164">In source mode, the application does not need to deliver samples to the DMO.</span></span> <span data-ttu-id="9bdfb-165">Вместо этого DMO управляет всеми операциями на звуковых устройствах, включая инициализацию устройств, запись и синхронизацию звуковых потоков, вычисление штампов времени и получение геометрии массива микрофона.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-165">Instead, the DMO manages all of the operations on the audio devices, including initializing the devices, capturing and synchronizing the audio streams, calculating time stamps, and retrieving the geometry of the microphone array.</span></span> <span data-ttu-id="9bdfb-166">При использовании исходного режима приложение просто настраивает DMO, а выходные данные DMO — это чистый, обработанный сигнал микрофона.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-166">Using source mode, the application simply configures the DMO, and the output from the DMO is a clean, processed microphone signal.</span></span> <span data-ttu-id="9bdfb-167">Режим исходного кода значительно проще в использовании, чем режим фильтрации, и рекомендуется для большинства приложений.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-167">Source mode is significantly easier to use than filter mode, and is recommended for most applications.</span></span>

<span data-ttu-id="9bdfb-168">В настоящее время потоковый захват DMO поддерживает только одноканальную отмену акустического эха (AEC), поэтому выходные данные из строки динамика должны быть одноканальными.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-168">Currently the voice capture DMO supports only single-channel acoustic echo cancellation (AEC), so the output from the speaker line must be single-channel.</span></span> <span data-ttu-id="9bdfb-169">Если обработка массива микрофона отключена, многоканальный вход будет сложен в один канал для обработки AEC.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-169">If microphone array processing is disabled, multi-channel input is folded down to one channel for AEC processing.</span></span> <span data-ttu-id="9bdfb-170">Если включены обе операции обработки и обработки AEC для массива микрофонов, то AEC выполняется для каждого элемента микрофона перед обработкой массива микрофона.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-170">If both microphone array processing and AEC processing are enabled, AEC is performed on each microphone element before microphone array processing.</span></span>

### <a name="microphone-array-processing"></a><span data-ttu-id="9bdfb-171">Обработка массива микрофона</span><span class="sxs-lookup"><span data-stu-id="9bdfb-171">Microphone Array Processing</span></span>

<span data-ttu-id="9bdfb-172">Массив микрофона — это набор тесно позиционированных микрофонов.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-172">A microphone array is a set of closely positioned microphones.</span></span> <span data-ttu-id="9bdfb-173">Для массивов микрофонов важна направленность, чем у одного микрофона, так как акустические волны поступают на каждый микрофон в несколько разные временные интервалы.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-173">Microphone arrays achieve better directionality than a single microphone, because the acoustic waves arrive at each microphone at a slightly different time.</span></span> <span data-ttu-id="9bdfb-174">Дополнительные сведения о массивах микрофонов см. в веб-статьях [Поддержка массивов микрофонов в Windows Vista](/windows-hardware/design/component-guidelines/audio) и [Создание и использование массивов микрофона для Windows Vista](/windows-hardware/drivers/audio/microphone-array-geometry-descriptor-format).</span><span class="sxs-lookup"><span data-stu-id="9bdfb-174">For more information on microphone arrays see the web articles [Microphone Array Support in Windows Vista](/windows-hardware/design/component-guidelines/audio) and [How to Build and Use Microphone Arrays for Windows Vista](/windows-hardware/drivers/audio/microphone-array-geometry-descriptor-format).</span></span>

### <a name="using-the-voice-capture-dsp"></a><span data-ttu-id="9bdfb-175">Использование схемы DSP для записи голоса</span><span class="sxs-lookup"><span data-stu-id="9bdfb-175">Using the Voice Capture DSP</span></span>

<span data-ttu-id="9bdfb-176">Чтобы использовать DSP для записи голоса, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-176">To use the Voice Capture DSP, perform the following steps.</span></span>

### <a name="1-initialize-the-dmo"></a><span data-ttu-id="9bdfb-177">1. Инициализация DMO</span><span class="sxs-lookup"><span data-stu-id="9bdfb-177">1. Initialize the DMO</span></span>

<span data-ttu-id="9bdfb-178">Создайте запись речи DMO, вызвав [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) с помощью CLSID CLSID **\_ квмаудиоаек**.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-178">Create the voice capture DMO by calling [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) with the CLSID **CLSID\_CWMAudioAEC**.</span></span> <span data-ttu-id="9bdfb-179">Запись голоса ДСДП предоставляет только интерфейсы [**имедиаобжект**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobject) и [**ипропертисторе**](/windows/win32/api/propsys/nn-propsys-ipropertystore) , поэтому ее можно использовать только в качестве DMO.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-179">The voice capture DSDP exposes only the [**IMediaObject**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobject) and [**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore) interfaces, so it can only be used as a DMO.</span></span>

<span data-ttu-id="9bdfb-180">По умолчанию DMO имеет режим источника.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-180">The DMO defaults to source mode.</span></span> <span data-ttu-id="9bdfb-181">Чтобы выбрать режим фильтрации, задайте для [свойства \_ \_ \_ \_ режим источника мфпкэй вмааекма DMO](mfpkey-wmaaecma-dmo-source-modeproperty.md) значение **Variant \_ false**.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-181">To select filter mode, set the [MFPKEY\_WMAAECMA\_DMO\_SOURCE\_MODE](mfpkey-wmaaecma-dmo-source-modeproperty.md) property to **VARIANT\_FALSE**.</span></span>

<span data-ttu-id="9bdfb-182">Затем настройте внутренние свойства DMO с помощью интерфейса [**ипропертисторе**](/windows/win32/api/propsys/nn-propsys-ipropertystore) .</span><span class="sxs-lookup"><span data-stu-id="9bdfb-182">Next, configure the internal properties of the DMO by using the [**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore) interface.</span></span> <span data-ttu-id="9bdfb-183">Единственное свойство, которое должно быть задано приложением, — это свойство [ \_ \_ системного \_ режима мфпкэй вмааекма](mfpkey-wmaaecma-system-modeproperty.md) .</span><span class="sxs-lookup"><span data-stu-id="9bdfb-183">The only property that an application must set is the [MFPKEY\_WMAAECMA\_SYSTEM\_MODE](mfpkey-wmaaecma-system-modeproperty.md) property.</span></span> <span data-ttu-id="9bdfb-184">Это свойство настраивает конвейер обработки в DMO.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-184">This property configures the processing pipeline within the DMO.</span></span> <span data-ttu-id="9bdfb-185">Другие свойства являются необязательными.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-185">The other properties are optional.</span></span>

### <a name="2-set-the-input-and-output-formats"></a><span data-ttu-id="9bdfb-186">2. Задание форматов входных и выходных данных</span><span class="sxs-lookup"><span data-stu-id="9bdfb-186">2. Set the Input and Output Formats</span></span>

<span data-ttu-id="9bdfb-187">При использовании DMO в режиме фильтрации задайте формат входных данных, вызвав [**имедиаобжект:: сетинпуттипе**](/previous-versions/windows/desktop/api/mediaobj/nf-mediaobj-imediaobject-setinputtype).</span><span class="sxs-lookup"><span data-stu-id="9bdfb-187">If you are using the DMO in filter mode, set the input format by calling [**IMediaObject::SetInputType**](/previous-versions/windows/desktop/api/mediaobj/nf-mediaobj-imediaobject-setinputtype).</span></span> <span data-ttu-id="9bdfb-188">Входной формат может быть практически любым допустимым несжатым типом данных PCM или с плавающей запятой IEEE-Point.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-188">The input format can be almost any valid uncompressed PCM or IEEE floating-point audio type.</span></span> <span data-ttu-id="9bdfb-189">Если входной формат не соответствует выходному формату, то DMO автоматически выполняет преобразование выборки.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-189">If the input format does not match the output format, the DMO automatically performs sample-rate conversion.</span></span>

<span data-ttu-id="9bdfb-190">При использовании DMO в режиме исходного кода не задавайте входной формат.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-190">If you are using the DMO in source mode, do not set the input format.</span></span> <span data-ttu-id="9bdfb-191">Объекты DMO автоматически настраивают входной формат на основе звуковых устройств.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-191">The DMO automatically configures the input format based on the audio devices.</span></span>

<span data-ttu-id="9bdfb-192">В любом режиме задайте формат вывода, вызвав [**имедиаобжект:: сетаутпуттипе**](/previous-versions/windows/desktop/api/mediaobj/nf-mediaobj-imediaobject-setoutputtype).</span><span class="sxs-lookup"><span data-stu-id="9bdfb-192">In either mode, set the output format by calling [**IMediaObject::SetOutputType**](/previous-versions/windows/desktop/api/mediaobj/nf-mediaobj-imediaobject-setoutputtype).</span></span> <span data-ttu-id="9bdfb-193">DMO может принимать следующие форматы вывода:</span><span class="sxs-lookup"><span data-stu-id="9bdfb-193">The DMO can accept the following output formats:</span></span>

-   <span data-ttu-id="9bdfb-194">Подтип: **медиасубтипе \_ PCM** или **медиасубтипе \_ IEEE \_ float**</span><span class="sxs-lookup"><span data-stu-id="9bdfb-194">Subtype: **MEDIASUBTYPE\_PCM** or **MEDIASUBTYPE\_IEEE\_FLOAT**</span></span>
-   <span data-ttu-id="9bdfb-195">Блок формата: [**вавеформат**](/windows/win32/api/mmreg/ns-mmreg-waveformat) или [**вавеформатекс**](/previous-versions/dd757713(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="9bdfb-195">Format block: [**WAVEFORMAT**](/windows/win32/api/mmreg/ns-mmreg-waveformat) or [**WAVEFORMATEX**](/previous-versions/dd757713(v=vs.85))</span></span>
-   <span data-ttu-id="9bdfb-196">Выборок в секунду: 8 000; 11 025; 16 000; или 22 050</span><span class="sxs-lookup"><span data-stu-id="9bdfb-196">Samples per second: 8,000; 11,025; 16,000; or 22,050</span></span>
-   <span data-ttu-id="9bdfb-197">Каналы: 1 для режима только AEC, 2 или 4 для обработки массива микрофона</span><span class="sxs-lookup"><span data-stu-id="9bdfb-197">Channels: 1 for AEC-only mode, 2 or 4 for microphone array processing</span></span>
-   <span data-ttu-id="9bdfb-198">Бит на выборку: 16</span><span class="sxs-lookup"><span data-stu-id="9bdfb-198">Bits per sample: 16</span></span>

<span data-ttu-id="9bdfb-199">Следующий код задает для типа выходных данных 16-битный звук PCM с одним каналом:</span><span class="sxs-lookup"><span data-stu-id="9bdfb-199">The following code sets the output type to 16-bit single-channel PCM audio:</span></span>


```
DMO_MEDIA_TYPE mt;  // Media type.
mt.majortype = MEDIATYPE_Audio;
mt.subtype = MEDIASUBTYPE_PCM;
mt.lSampleSize = 0;
mt.bFixedSizeSamples = TRUE;
mt.bTemporalCompression = FALSE;
mt.formattype = FORMAT_WaveFormatEx;

// Allocate the format block to hold the WAVEFORMATEX structure.
hr = MoInitMediaType(&mt, sizeof(WAVEFORMATEX));
if (SUCCEEDED(hr))
{
    WAVEFORMATEX *pwav = (WAVEFORMATEX*)mt.pbFormat;
    pwav->wFormatTag = WAVE_FORMAT_PCM;
    pwav->nChannels = 1;
    pwav->nSamplesPerSec = 16000;
    pwav->nAvgBytesPerSec = 32000;
    pwav->nBlockAlign = 2;
    pwav->wBitsPerSample = 16;
    pwav->cbSize = 0;

    // Set the output type.
    if (SUCCEEDED(hr))
    {
        hr = pDMO->SetOutputType(0, &mt, 0); 
    }
    // Free the format block.
    MoFreeMediaType(&mt);
}
```



### <a name="3-process-data"></a><span data-ttu-id="9bdfb-200">3. обработка данных</span><span class="sxs-lookup"><span data-stu-id="9bdfb-200">3. Process Data</span></span>

<span data-ttu-id="9bdfb-201">Перед обработкой любых данных рекомендуется вызвать метод [**имедиаобжект:: аллокатестреамингресаурцес**](/previous-versions/windows/desktop/api/mediaobj/nf-mediaobj-imediaobject-allocatestreamingresources).</span><span class="sxs-lookup"><span data-stu-id="9bdfb-201">Before processing any data, it is recommended to call [**IMediaObject::AllocateStreamingResources**](/previous-versions/windows/desktop/api/mediaobj/nf-mediaobj-imediaobject-allocatestreamingresources).</span></span> <span data-ttu-id="9bdfb-202">Этот метод выделяет ресурсы, используемые DMO внутри.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-202">This method allocates the resources used internally by the DMO.</span></span> <span data-ttu-id="9bdfb-203">Вызовите **аллокатестреамингресаурцес** после перечисленных выше шагов, а не до.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-203">Call **AllocateStreamingResources** after the steps listed previously, not before.</span></span> <span data-ttu-id="9bdfb-204">Если этот метод не вызывается, DMO автоматически выделяет ресурсы при начале обработки данных.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-204">If you do not call this method, the DMO automatically allocates resources when data processing starts.</span></span>

<span data-ttu-id="9bdfb-205">При использовании DMO в режиме фильтрации необходимо передать входные данные в DMO, вызвав [**имедиаобжект::P роцессинпут**](/previous-versions/windows/desktop/api/mediaobj/nf-mediaobj-imediaobject-processinput).</span><span class="sxs-lookup"><span data-stu-id="9bdfb-205">If you are using the DMO in filter mode, you must pass input data to the DMO by calling [**IMediaObject::ProcessInput**](/previous-versions/windows/desktop/api/mediaobj/nf-mediaobj-imediaobject-processinput).</span></span> <span data-ttu-id="9bdfb-206">Звуковые данные с микрофона переходят в поток 0, а звуковые данные из линии динамика — в поток 1.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-206">The audio data from the microphone goes to stream 0, and the audio data from the speaker line goes to stream 1.</span></span> <span data-ttu-id="9bdfb-207">При использовании DMO в режиме исходного кода не нужно вызывать **ProcessInput**.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-207">If you are using the DMO in source mode, you do not need to call **ProcessInput**.</span></span>

<span data-ttu-id="9bdfb-208">Чтобы получить выходные данные из DSP, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-208">To get output data from the DSP, perform the following steps:</span></span>

1.  <span data-ttu-id="9bdfb-209">Создайте объект buffer для хранения выходных данных.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-209">Create a buffer object to hold the output data.</span></span> <span data-ttu-id="9bdfb-210">Объект buffer должен реализовывать интерфейс [**имедиабуффер**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediabuffer) .</span><span class="sxs-lookup"><span data-stu-id="9bdfb-210">The buffer object must implement the [**IMediaBuffer**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediabuffer) interface.</span></span> <span data-ttu-id="9bdfb-211">Размер буфера зависит от требований приложения.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-211">The size of the buffer depends on the requirements of your application.</span></span> <span data-ttu-id="9bdfb-212">Выделение большего буфера может снизить вероятность возникновения сбоев.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-212">Allocating a larger buffer can reduce the chances of glitches occurring.</span></span>
2.  <span data-ttu-id="9bdfb-213">Объявите [**структуру \_ \_ \_ буфера выходных данных DMO**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_output_data_buffer) и установите элемент **pBuffer** , чтобы он указывал на объект buffer.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-213">Declare a [**DMO\_OUTPUT\_DATA\_BUFFER**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_output_data_buffer) structure and set the **pBuffer** member to point to your buffer object.</span></span>
3.  <span data-ttu-id="9bdfb-214">Передайте [**структуру \_ \_ \_ буфера выходных данных DMO**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_output_data_buffer) в метод [**имедиаобжект::P роцессаутпут**](/previous-versions/windows/desktop/api/mediaobj/nf-mediaobj-imediaobject-processoutput) .</span><span class="sxs-lookup"><span data-stu-id="9bdfb-214">Pass the [**DMO\_OUTPUT\_DATA\_BUFFER**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_output_data_buffer) structure to the [**IMediaObject::ProcessOutput**](/previous-versions/windows/desktop/api/mediaobj/nf-mediaobj-imediaobject-processoutput) method.</span></span>
4.  <span data-ttu-id="9bdfb-215">Продолжайте вызывать этот метод до тех пор, пока у DMO есть выходные данные.</span><span class="sxs-lookup"><span data-stu-id="9bdfb-215">Continue to call this method for as long as the DMO has output data.</span></span> <span data-ttu-id="9bdfb-216">DSP сообщает о том, что у него больше выходных данных, установив флаг **\_ \_ \_ Буфферф \_ для выходных данных DMO** в элементе **dwstatus устанавливается** структуры [**\_ буфера выходных \_ данных \_ DMO**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_output_data_buffer) .</span><span class="sxs-lookup"><span data-stu-id="9bdfb-216">The DSP signals that it has more output by setting the **DMO\_OUTPUT\_DATA\_BUFFERF\_INCOMPLETE** flag in the **dwStatus** member of the [**DMO\_OUTPUT\_DATA\_BUFFER**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_output_data_buffer) structure.</span></span>

## <a name="requirements"></a><span data-ttu-id="9bdfb-217">Требования</span><span class="sxs-lookup"><span data-stu-id="9bdfb-217">Requirements</span></span>



| <span data-ttu-id="9bdfb-218">Требование</span><span class="sxs-lookup"><span data-stu-id="9bdfb-218">Requirement</span></span> | <span data-ttu-id="9bdfb-219">Значение</span><span class="sxs-lookup"><span data-stu-id="9bdfb-219">Value</span></span> |
|-------------------------------------|-----------------------------------------------------------------------------------------|
| <span data-ttu-id="9bdfb-220">Минимальная версия клиента</span><span class="sxs-lookup"><span data-stu-id="9bdfb-220">Minimum supported client</span></span><br/> | <span data-ttu-id="9bdfb-221">Только для \[ классических приложений Windows Vista\]</span><span class="sxs-lookup"><span data-stu-id="9bdfb-221">Windows Vista \[desktop apps only\]</span></span><br/>                                          |
| <span data-ttu-id="9bdfb-222">Минимальная версия сервера</span><span class="sxs-lookup"><span data-stu-id="9bdfb-222">Minimum supported server</span></span><br/> | <span data-ttu-id="9bdfb-223">\[Только для настольных приложений Windows Server 2008\]</span><span class="sxs-lookup"><span data-stu-id="9bdfb-223">Windows Server 2008 \[desktop apps only\]</span></span><br/>                                    |
| <span data-ttu-id="9bdfb-224">Header</span><span class="sxs-lookup"><span data-stu-id="9bdfb-224">Header</span></span><br/>                   | <dl> <span data-ttu-id="9bdfb-225"><dt>Вмкодекдсп. h</dt></span><span class="sxs-lookup"><span data-stu-id="9bdfb-225"><dt>Wmcodecdsp.h</dt></span></span> </dl> |
| <span data-ttu-id="9bdfb-226">DLL</span><span class="sxs-lookup"><span data-stu-id="9bdfb-226">DLL</span></span><br/>                      | <dl> <span data-ttu-id="9bdfb-227"><dt>Mfwmaaec.dll</dt></span><span class="sxs-lookup"><span data-stu-id="9bdfb-227"><dt>Mfwmaaec.dll</dt></span></span> </dl> |



## <a name="see-also"></a><span data-ttu-id="9bdfb-228">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="9bdfb-228">See also</span></span>

<dl> <dt>

[<span data-ttu-id="9bdfb-229">Обработчики цифровых сигналов</span><span class="sxs-lookup"><span data-stu-id="9bdfb-229">Digital Signal Processors</span></span>](windowsmediadigitalsignalprocessors.md)
</dt> </dl>

 

 
