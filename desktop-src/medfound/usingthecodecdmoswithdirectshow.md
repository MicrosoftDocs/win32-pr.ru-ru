---
description: Использование оконных кодеков Windows в DirectShow
ms.assetid: 5b930447-6bf2-4bb3-8dfb-05f4c1e7cd64
title: Использование оконных кодеков Windows в DirectShow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 495a2675335474351da80b9845fba67f9e967d637d7c9d9c749ffc2f12ce3ea4
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120012184"
---
# <a name="using-the-window-media-codecs-in-directshow"></a>Использование оконных кодеков Windows в DirectShow

объекты кодировщика аудио, видео и декодера Windows мультимедиа изначально разрабатывались и оптимизированы для работы с форматом контейнера файлов ASF и пакетом SDK Windows Media format. объекты кодека хорошо работают в DirectShow для определенных сценариев, а именно один проход CBR и качество потока видео с поддержкой VBR. но если вы планируете использовать объекты кодека непосредственно в DirectShow использовании контейнеров файлов, отличных от ASF, существуют определенные поведения и проблемы, о которых следует помнить заранее.

> [!Note]  
> если вы собираетесь использовать автономные кодеки с DirectShow, скорее всего, их потребуется использовать как дмос. Иными словами, вы будете использовать интерфейс [**имедиаобжект**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobject) вместо [**имфтрансформ**](/windows/desktop/api/mftransform/nn-mftransform-imftransform).

 

## <a name="wm-audio-in-avi-files"></a>Звуковые файлы WM в AVI

DirectShow можно использовать для кодирования потоков WMA в любой формат контейнера файлов, для которого имеется фильтр мультиплексора. однако интерфейсы аудиокодеков Windows Media Audio и Video не поддерживают WMA в файлах avi, так как их невозможно использовать по умолчанию DirectShow фильтры воспроизведения avi, чтобы поддерживать синхронизацию видео в avi-файле с потоком WMA. Дополнительные сведения см. [в разделе Хранение сжатых файлов мультимедиа в AVI](storingcompressedmediainavifiles.md).

аудио кодировщик DMO выводит примеры различной длительности, даже если в режиме постоянной разрядной скорости. Поэтому лучше работает с форматами контейнеров файлов, которые используют метки времени. AVI-файлы не предоставляют метку времени для каждого звукового примера или группы образцов. в DirectShow фильтр avi-разделителя создает штампы времени для каждой группы выборок (каждый звуковой кадр) на основе значения **навгбитесперсек** в структуре [**вавеформатекс**](/previous-versions/dd757713(v=vs.85)) в заголовке AVI-потока.

Исходя из этого вычисления подразумевается, что все звуковые примеры в потоке имеют одинаковую длительность. однако выходные данные выборок DMO имеют неравную длительность, поэтому метки времени, применяемые разделителем AVI, неточны. таким образом, невозможно без изменения разделителя AVI или DMOного декодера, чтобы использовать любое приложение на основе DirectShow для воспроизведения AVI-файлов с синхронизацией аудио-и видеопотоков. в некоторых случаях голосовый кодек Windows Media Audio 9 будет работать, но даже в этом случае синхронизация будет потеряна после любой операции поиска, поэтому она не будет считаться приемлемым решением.

Если у вас есть кодировщик MP3, вы можете создавать AVI-файлы с помощью WMV и MP3 для звукового потока. такие файлы воспроизводятся и правильно ищутся в проигрыватель Windows Media и других DirectShow приложениях, поскольку разделитель AVI содержит специальный код обработки для потоков MP3. Другой вариант — использовать несжатый звук PCM, хотя, очевидно, размер файла будет значительно больше, чем в сжатом звуковом потоке. так как пример приложения DirectShow создает AVI-файлы, он не демонстрирует использование DMO кодировщика звука.

## <a name="one-pass-encoding"></a>Однопроходная кодировка

видеокодировщик DMO легко работает в DirectShow в двух режимах кодирования: CBR и quality на уровне VBR. При условии соблюдения правильного порядка операций при построении графа фильтра, как показано в примере приложения, можно относительно просто поместить содержимое WMV в AVI-файл с помощью AVI-мультиплексора и средства записи файлов.

## <a name="two-pass-encoding"></a>2-проходная кодировка

для режимов двусторонней кодировки требуется более сложный подход к построению и потоковой передаче графа, чтобы DMO не запустить содержимое первого прохода, прежде чем начать второй проход. в двухсторонней кодировке необходимо однократно запустить граф, чтобы DMO мог выполнить анализ предварительной обработки данных файла, а затем перемотать диаграмму и запустить ее снова, чтобы DMO мог выполнить фактическую кодировку.

когда граф переходит в состояние выполнения второго прохода, программа-оболочка DMO устанавливает флаг отключения для первого образца, так как отметка времени не является последовательной с последней меткой времени первого прохода. если DMO, который не предназначен для работы в DirectShow таким образом, получает флаг отключения, он выполняет очистку и теряет данные, хранящиеся на первом проходе. чтобы обойти эту ошибку, лучшим решением может быть написание пользовательского фильтра оболочки DMO, который не устанавливает флаг небесперебойности при поиске графа после первого прохода. в образце видео для Windows (VfW) в этом пакете SDK показано, как выполнить двустороннюю кодировку.

## <a name="interlaced-content"></a>Содержимое с чередованием

кодировщик WMV DMO может кодировать содержимое с чередованием, сохраняя при этом чересстрочную развертку, что полезно для содержимого, записанного на телевизоре, а также может воспроизводиться на телевизоре. однако невозможно сохранить чересстрочную развертку с помощью оболочки DMO по умолчанию, так как этот фильтр не поддерживает [**инссбуффер**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) на входных примерах.

DMO использует этот интерфейс для получения параметров с чередованием для каждого получаемого примера. если интерфейс не найден, как в случае с DMOной оболочкой, DMO просто рассматривает входные примеры как нечересстрочнуюющие. для выполнения чередования кодирования в DirectShow существует несколько альтернативных вариантов. самый простой подход, вероятно, использует пакет SDK для серии Windows Media Format 9 либо напрямую, либо с помощью фильтра модуля записи WM ASF DirectShow filter, чтобы создать файл ASF с чередованием. Затем можно перекодировать этот файл в другой формат. если перекодировать в AVI, будет создан файл с чередованием, но DirectShow стандартные фильтры воспроизведения avi не будут распознавать его как таковые, так как они не поддерживают [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2). другой подход заключается в написании собственного фильтра оболочки DMO, поддерживающего интерфейс [**инссбуффер**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) .

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Работа с кодеками дмос](workingwithcodecdmos.md)
</dt> </dl>

 

 
