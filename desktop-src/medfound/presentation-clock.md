---
description: Часы представления
ms.assetid: cb8bb62a-ef80-4de0-9a44-3bb77edc9dd5
title: Часы представления
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5f61ad02537a2591c681db78721376651f7854ec
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104155335"
---
# <a name="presentation-clock"></a><span data-ttu-id="40b93-103">Часы представления</span><span class="sxs-lookup"><span data-stu-id="40b93-103">Presentation Clock</span></span>

<span data-ttu-id="40b93-104">*Часы представления* — это объект, который создает время для представления.</span><span class="sxs-lookup"><span data-stu-id="40b93-104">The *presentation clock* is an object that generates the clock time for a presentation.</span></span> <span data-ttu-id="40b93-105">Время, сообщаемое часами представления, называется *временем презентации*.</span><span class="sxs-lookup"><span data-stu-id="40b93-105">The time reported by the presentation clock is called the *presentation time*.</span></span> <span data-ttu-id="40b93-106">Все потоки в презентации синхронизируются со временем презентации.</span><span class="sxs-lookup"><span data-stu-id="40b93-106">All streams in a presentation are synchronized to the presentation time.</span></span> <span data-ttu-id="40b93-107">Часы представления предоставляют следующие интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="40b93-107">The presentation clock exposes the following interfaces.</span></span>



| <span data-ttu-id="40b93-108">Интерфейс</span><span class="sxs-lookup"><span data-stu-id="40b93-108">Interface</span></span>                                            | <span data-ttu-id="40b93-109">Описание</span><span class="sxs-lookup"><span data-stu-id="40b93-109">Description</span></span>                                         |
|------------------------------------------------------|-----------------------------------------------------|
| [<span data-ttu-id="40b93-110">**имфпресентатионклокк**</span><span class="sxs-lookup"><span data-stu-id="40b93-110">**IMFPresentationClock**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationclock) | <span data-ttu-id="40b93-111">Основной интерфейс для использования часов представления.</span><span class="sxs-lookup"><span data-stu-id="40b93-111">Primary interface for using the presentation clock.</span></span> |
| [<span data-ttu-id="40b93-112">**имфратеконтрол**</span><span class="sxs-lookup"><span data-stu-id="40b93-112">**IMFRateControl**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol)             | <span data-ttu-id="40b93-113">Управляет частотой часов.</span><span class="sxs-lookup"><span data-stu-id="40b93-113">Controls the clock rate.</span></span>                            |
| [<span data-ttu-id="40b93-114">**имфтимер**</span><span class="sxs-lookup"><span data-stu-id="40b93-114">**IMFTimer**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imftimer)                         | <span data-ttu-id="40b93-115">Предоставляет обратный вызов таймера.</span><span class="sxs-lookup"><span data-stu-id="40b93-115">Provides a timer callback.</span></span>                          |
| [<span data-ttu-id="40b93-116">**имфшутдовн**</span><span class="sxs-lookup"><span data-stu-id="40b93-116">**IMFShutdown**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown)                   | <span data-ttu-id="40b93-117">Закрывает часы презентации.</span><span class="sxs-lookup"><span data-stu-id="40b93-117">Shuts down the presentation clock.</span></span>                  |



 

<span data-ttu-id="40b93-118">Приемники носителей используют время презентации, чтобы запланировать время подготовки к просмотру образцов.</span><span class="sxs-lookup"><span data-stu-id="40b93-118">Media sinks use the presentation time to schedule when to render samples.</span></span> <span data-ttu-id="40b93-119">Каждый раз, когда приемник мультимедиа получает новый пример, он получает отметку времени из образца и отображает образец в указанное время или как можно ближе к этому времени.</span><span class="sxs-lookup"><span data-stu-id="40b93-119">Whenever a media sink receives a new sample, it gets the time stamp from the sample and renders the sample at the indicated time, or as close to that time as possible.</span></span> <span data-ttu-id="40b93-120">Так как все приемники мультимедиа в топологии используют одни и те же часы представления, синхронизируются несколько потоков (например, аудио-и видеофайлы).</span><span class="sxs-lookup"><span data-stu-id="40b93-120">Because all of the media sinks in a topology share the same presentation clock, multiple streams (such as audio and video) are synchronized.</span></span> <span data-ttu-id="40b93-121">Источники мультимедиа и преобразования не используют часы презентации, так как они не запланируют, когда следует доставлять образцы.</span><span class="sxs-lookup"><span data-stu-id="40b93-121">Media sources and transforms do not use the presentation clock, because they do not schedule when to deliver samples.</span></span> <span data-ttu-id="40b93-122">Вместо этого они создают образцы каждый раз, когда конвейер запрашивает новый пример.</span><span class="sxs-lookup"><span data-stu-id="40b93-122">Instead, they produce samples whenever the pipeline requests a new sample.</span></span>

<span data-ttu-id="40b93-123">Если вы используете сеанс мультимедиа для воспроизведения, сеанс мультимедиа обрабатывает все сведения о создании часов представления, выборе источника времени и уведомлении приемников мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="40b93-123">If you are using the Media Session for playback, the Media Session handles all of the details of creating the presentation clock, selecting a time source, and notifying the media sinks.</span></span> <span data-ttu-id="40b93-124">Приложение может использовать часы презентации для получения текущего времени презентации во время воспроизведения, но в противном случае не будет вызывать никаких методов для часов презентации.</span><span class="sxs-lookup"><span data-stu-id="40b93-124">Your application might use the presentation clock to get the current presentation time during playback, but otherwise will not call any methods on the presentation clock.</span></span>

## <a name="clock-time-and-clock-states"></a><span data-ttu-id="40b93-125">Время и состояния часов</span><span class="sxs-lookup"><span data-stu-id="40b93-125">Clock Time and Clock States</span></span>

<span data-ttu-id="40b93-126">Чтобы получить последнее время в часах презентации, вызовите метод [**имфпресентатионклокк:: OnTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime).</span><span class="sxs-lookup"><span data-stu-id="40b93-126">To get the latest clock time from the presentation clock, call [**IMFPresentationClock::GetTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime).</span></span> <span data-ttu-id="40b93-127">Время часы всегда находятся в единицах 100-наносекундных, поэтому одна секунда — 10 000 000 (10 ^ 7) тактов.</span><span class="sxs-lookup"><span data-stu-id="40b93-127">Clock times are always in 100-nanosecond units, so one second is 10,000,000 (10^7) ticks.</span></span> <span data-ttu-id="40b93-128">Это соответствует частоте 10 МГц.</span><span class="sxs-lookup"><span data-stu-id="40b93-128">This corresponds to a frequency of 10 MHz.</span></span>

<span data-ttu-id="40b93-129">Часы презентации имеют три состояния: "работает", "приостановлено" и "остановлено".</span><span class="sxs-lookup"><span data-stu-id="40b93-129">The presentation clock has three states: Running, paused, and stopped.</span></span>

-   <span data-ttu-id="40b93-130">Чтобы запустить часы, вызовите [**имфпресентатионклокк:: Start**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-start).</span><span class="sxs-lookup"><span data-stu-id="40b93-130">To run the clock, call [**IMFPresentationClock::Start**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-start).</span></span> <span data-ttu-id="40b93-131">Метод **Start** задает время начала работы с часами.</span><span class="sxs-lookup"><span data-stu-id="40b93-131">The **Start** method specifies the clock's starting time.</span></span> <span data-ttu-id="40b93-132">Во время выполнения часов часы увеличиваются с момента начала по текущей ставке часов.</span><span class="sxs-lookup"><span data-stu-id="40b93-132">While the clock is running, the clock time increments from the starting time, at the current clock rate.</span></span>
-   <span data-ttu-id="40b93-133">Чтобы приостановить часы, вызовите [**имфпресентатионклокк::P Аусе**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-pause).</span><span class="sxs-lookup"><span data-stu-id="40b93-133">To pause the clock, call [**IMFPresentationClock::Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-pause).</span></span> <span data-ttu-id="40b93-134">Пока часы приостановлены, время не изменяется [**, а функция while Возвращает время**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) приостановки часов.</span><span class="sxs-lookup"><span data-stu-id="40b93-134">While the clock is paused, the clock time does not advance, and [**GetTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) returns the time at which the clock was paused.</span></span>
-   <span data-ttu-id="40b93-135">Чтобы прерывать часы, вызовите [**имфпресентатионклокк:: останавливаться**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-stop).</span><span class="sxs-lookup"><span data-stu-id="40b93-135">To stop the clock, call [**IMFPresentationClock::Stop**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-stop).</span></span> <span data-ttu-id="40b93-136">Когда часы остановлены, время не изменяется, а функция- [**время**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) возвращает ноль.</span><span class="sxs-lookup"><span data-stu-id="40b93-136">When the clock is stopped, the clock time does not advance, and [**GetTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) returns zero.</span></span>

<span data-ttu-id="40b93-137">По умолчанию тактовая частота увеличивается на 1,0, что означает 1 такт на 100 наносекунд.</span><span class="sxs-lookup"><span data-stu-id="40b93-137">By default, the clock advances at a rate of 1.0, meaning 1 tick per 100 nanoseconds.</span></span> <span data-ttu-id="40b93-138">Чтобы изменить скорость, с которой увеличивается время, запросите часы представления для интерфейса [**имфратеконтрол**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) и вызовите [**Имфратеконтрол:: сетрате**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate).</span><span class="sxs-lookup"><span data-stu-id="40b93-138">To change the rate at which the clock advances, query the presentation clock for the [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) interface and call [**IMFRateControl::SetRate**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate).</span></span>

<span data-ttu-id="40b93-139">Объекты могут получать уведомления об изменениях состояния (включая изменения скорости) из часов презентации.</span><span class="sxs-lookup"><span data-stu-id="40b93-139">Objects can receive notifications of state changes (including rate changes) from the presentation clock.</span></span> <span data-ttu-id="40b93-140">Чтобы получать уведомления, реализуйте интерфейс [**имфклоккстатесинк**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) и вызовите [**Имфпресентатионклокк:: аддклоккстатесинк**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-addclockstatesink) в часах презентации.</span><span class="sxs-lookup"><span data-stu-id="40b93-140">To receive notifications, implement the [**IMFClockStateSink**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) interface and call [**IMFPresentationClock::AddClockStateSink**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-addclockstatesink) on the presentation clock.</span></span> <span data-ttu-id="40b93-141">Перед завершением работы вызовите метод [**имфпресентатионклокк:: ремовеклоккстатесинк**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-removeclockstatesink) , чтобы отменить регистрацию объекта.</span><span class="sxs-lookup"><span data-stu-id="40b93-141">Before shutting down, call [**IMFPresentationClock::RemoveClockStateSink**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-removeclockstatesink) to unregister the object.</span></span> <span data-ttu-id="40b93-142">Приемники носителей используют этот механизм для получения уведомлений из часов.</span><span class="sxs-lookup"><span data-stu-id="40b93-142">Media sinks use this mechanism to receive notifications from the clock.</span></span>

## <a name="presentation-times"></a><span data-ttu-id="40b93-143">Время презентации</span><span class="sxs-lookup"><span data-stu-id="40b93-143">Presentation Times</span></span>

<span data-ttu-id="40b93-144">Приемник мультимедиа пытается запланировать каждый пример, чтобы образец отображался в нужное время, или как можно ближе к правильному времени.</span><span class="sxs-lookup"><span data-stu-id="40b93-144">A media sink tries to schedule each sample so that the sample is rendered at the correct time, or as close to the correct time as possible.</span></span> <span data-ttu-id="40b93-145">Применяются следующие определения:</span><span class="sxs-lookup"><span data-stu-id="40b93-145">The following definitions apply:</span></span>

-   <span data-ttu-id="40b93-146">*Время презентации.*</span><span class="sxs-lookup"><span data-stu-id="40b93-146">*Presentation time.*</span></span> <span data-ttu-id="40b93-147">Время, когда должен быть визуализирован образец.</span><span class="sxs-lookup"><span data-stu-id="40b93-147">The time when a sample should be rendered.</span></span> <span data-ttu-id="40b93-148">Время указывается в единицах 100 наносекунд.</span><span class="sxs-lookup"><span data-stu-id="40b93-148">Time is given in units of 100 nanoseconds.</span></span>
-   <span data-ttu-id="40b93-149">*Время мультимедиа.*</span><span class="sxs-lookup"><span data-stu-id="40b93-149">*Media time.*</span></span> <span data-ttu-id="40b93-150">Время относительно начала содержимого.</span><span class="sxs-lookup"><span data-stu-id="40b93-150">Time relative to the start of the content.</span></span> <span data-ttu-id="40b93-151">Например, если видеофайл имеет длину не более 10 секунд, то точка, половина пути к файлу, имеет время хранения в 5 секунд.</span><span class="sxs-lookup"><span data-stu-id="40b93-151">For example, if a video file is 10 seconds long, the point half way through the file has a media time of 5 seconds.</span></span>
-   <span data-ttu-id="40b93-152">*Метка времени.*</span><span class="sxs-lookup"><span data-stu-id="40b93-152">*Time stamp.*</span></span> <span data-ttu-id="40b93-153">Время, отмеченное на примере носителя.</span><span class="sxs-lookup"><span data-stu-id="40b93-153">The time marked on a media sample.</span></span> <span data-ttu-id="40b93-154">Чтобы получить метку времени, вызовите [**имфсампле:: жетсамплетиме**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-getsampletime).</span><span class="sxs-lookup"><span data-stu-id="40b93-154">To get the time stamp, call [**IMFSample::GetSampleTime**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-getsampletime).</span></span> <span data-ttu-id="40b93-155">Когда источник мультимедиа создает пример, он устанавливает отметку времени, равную времени носителя.</span><span class="sxs-lookup"><span data-stu-id="40b93-155">When a media source produces a sample, it sets the time stamp equal to the media time.</span></span> <span data-ttu-id="40b93-156">Сеанс мультимедиа преобразует метку времени в время презентации.</span><span class="sxs-lookup"><span data-stu-id="40b93-156">The Media Session translates the time stamp into presentation time.</span></span>

<span data-ttu-id="40b93-157">По умолчанию время и время презентации мультимедиа одинаковы, например, если кадр видео появляется в виде 5 секунд в исходном файле, время мультимедиа и время презентации — 5 секунд.</span><span class="sxs-lookup"><span data-stu-id="40b93-157">By default, media time and presentation time are the same, For example, if a video frame appears 5 seconds into the source file, the media time and the presentation time are both 5 seconds.</span></span> <span data-ttu-id="40b93-158">При использовании [источника Sequencer](sequencer-source.md)модель времени несколько сложнее, чтобы обеспечить плавные переходы между сегментами.</span><span class="sxs-lookup"><span data-stu-id="40b93-158">If you are using the [Sequencer Source](sequencer-source.md), the timing model is somewhat more complicated, to enable smooth transitions between segments.</span></span> <span data-ttu-id="40b93-159">Дополнительные сведения о модели времени источника Sequencer см. в разделе [время показа последовательностей](sequence-presentation-times.md).</span><span class="sxs-lookup"><span data-stu-id="40b93-159">For more information about the sequencer source's timing model, see [Sequence Presentation Times](sequence-presentation-times.md).</span></span>

<span data-ttu-id="40b93-160">Источник мультимедиа всегда задает отметку времени, равную времени носителя.</span><span class="sxs-lookup"><span data-stu-id="40b93-160">The media source always sets the time stamp equal to the media time.</span></span> <span data-ttu-id="40b93-161">Если время презентации не соответствует времени носителя, то сеанс мультимедиа преобразует метки времени на примерах носителя.</span><span class="sxs-lookup"><span data-stu-id="40b93-161">If presentation time is not aligned with media time, the Media Session converts the time stamps on the media samples.</span></span> <span data-ttu-id="40b93-162">К моменту, когда приемник получает образец, метка времени образца преобразуется в время презентации.</span><span class="sxs-lookup"><span data-stu-id="40b93-162">By the time the sink receives a sample, the sample's time stamp has been converted to presentation time.</span></span> <span data-ttu-id="40b93-163">Приемник планирует выборку в соответствии с текущим временем часов представления.</span><span class="sxs-lookup"><span data-stu-id="40b93-163">The sink schedules the sample against the presentation clock's current time.</span></span> <span data-ttu-id="40b93-164">(Приемники без учета частоты являются исключением, так как они игнорируют часы представления.)</span><span class="sxs-lookup"><span data-stu-id="40b93-164">(Rateless sinks are an exception, because they ignore the presentation clock.)</span></span>

<span data-ttu-id="40b93-165">Если приложение выполняет поиск в новой позиции, сеанс мультимедиа перезапускает часы представления в указанное время поиска.</span><span class="sxs-lookup"><span data-stu-id="40b93-165">If the application seeks to a new position, the Media Session restarts the presentation clock at the specified seek time.</span></span> <span data-ttu-id="40b93-166">Например, если приложение выполняет поиск по 5-секундной позиции в файле, сеанс мультимедиа запускает часы через 5 секунд.</span><span class="sxs-lookup"><span data-stu-id="40b93-166">For example, if the application seeks to the 5-second position in the file, the Media Session starts the clock at 5 seconds.</span></span> <span data-ttu-id="40b93-167">Источник мультимедиа может доставлять образцы с немного более ранней меткой времени, если время поиска не попадает на границу ключевого кадра.</span><span class="sxs-lookup"><span data-stu-id="40b93-167">The media source might deliver samples with a slightly earlier time stamp if the seek time does not fall on a key-frame boundary.</span></span> <span data-ttu-id="40b93-168">Это необходимо, чтобы декодеры могли декодировать все кадры.</span><span class="sxs-lookup"><span data-stu-id="40b93-168">This is required so that the decoders can decode all of the frames.</span></span> <span data-ttu-id="40b93-169">Сеанс мультимедиа удаляет или обрезает выборки перед достижением приемников мультимедиа, чтобы соответствовать запрошенному времени поиска.</span><span class="sxs-lookup"><span data-stu-id="40b93-169">The Media Session drops or trims samples before they reach the media sinks, in order to match the requested seek time.</span></span> <span data-ttu-id="40b93-170">Например, если время поиска составляет 5 секунд, первый образец звука может начаться через 4,5 секунд.</span><span class="sxs-lookup"><span data-stu-id="40b93-170">For example, if the seek time is 5 seconds, the first audio sample might start at 4.5 seconds.</span></span> <span data-ttu-id="40b93-171">Сеанс мультимедиа обрезает первые 0,5 секунд с первого декодированного аудио образца.</span><span class="sxs-lookup"><span data-stu-id="40b93-171">The Media Session will trim the first 0.5 seconds from the first decoded audio sample.</span></span>

## <a name="creating-the-presentation-clock"></a><span data-ttu-id="40b93-172">Создание часов представления</span><span class="sxs-lookup"><span data-stu-id="40b93-172">Creating the Presentation Clock</span></span>

<span data-ttu-id="40b93-173">Чтобы создать часы представления, вызовите [**мфкреатепресентатионклокк**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationclock).</span><span class="sxs-lookup"><span data-stu-id="40b93-173">To create the presentation clock, call [**MFCreatePresentationClock**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationclock).</span></span> <span data-ttu-id="40b93-174">Чтобы завершить работу часов, выполните запрос к интерфейсу [**имфшутдовн**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) и вызовите [**Имфшутдовн:: Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown).</span><span class="sxs-lookup"><span data-stu-id="40b93-174">To shut down the clock, query for the [**IMFShutdown**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) interface and call [**IMFShutdown::Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown).</span></span> <span data-ttu-id="40b93-175">Вызывающий объект **мфкреатепресентатионклокк** отвечает за вызов **завершения работы**. в большинстве случаев это сеанс мультимедиа, а не приложение.</span><span class="sxs-lookup"><span data-stu-id="40b93-175">The caller of **MFCreatePresentationClock** is responsible for calling **Shutdown**; in most cases, this is the Media Session rather than the application.</span></span>

## <a name="presentation-time-sources"></a><span data-ttu-id="40b93-176">Источники времени презентации</span><span class="sxs-lookup"><span data-stu-id="40b93-176">Presentation Time Sources</span></span>

<span data-ttu-id="40b93-177">Несмотря на свое имя, часы презентации фактически не реализуют часы.</span><span class="sxs-lookup"><span data-stu-id="40b93-177">Despite its name, the presentation clock does not actually implement a clock.</span></span> <span data-ttu-id="40b93-178">Вместо этого он получает значения часов из другого объекта, который называется *источником времени презентации*.</span><span class="sxs-lookup"><span data-stu-id="40b93-178">Instead, it gets the clock times from another object, called a *presentation time source*.</span></span> <span data-ttu-id="40b93-179">Источником времени может быть любой объект, создающий точные такты времени и предоставляющий интерфейс [**имфпресентатионтимесаурце**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) .</span><span class="sxs-lookup"><span data-stu-id="40b93-179">The time source can be any object that generates accurate clock ticks and exposes the [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) interface.</span></span> <span data-ttu-id="40b93-180">Данный процесс показан на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="40b93-180">The following illustration shows this process.</span></span>

![Схема, показывающая связь между часами представления и источником времени презентации](images/dedc255c-eb6d-49fc-8892-7b6076ed4488.gif)

<span data-ttu-id="40b93-182">При первом создании часов презентации он не имеет источника времени.</span><span class="sxs-lookup"><span data-stu-id="40b93-182">When the presentation clock is first created, it does not have a time source.</span></span> <span data-ttu-id="40b93-183">Чтобы задать источник времени, вызовите [**имфпресентатионклокк:: сеттимесаурце**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-settimesource) с указателем на интерфейс [**имфпресентатионтимесаурце**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) источника времени.</span><span class="sxs-lookup"><span data-stu-id="40b93-183">To set the time source, call [**IMFPresentationClock::SetTimeSource**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-settimesource) with a pointer to the time source's [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) interface.</span></span> <span data-ttu-id="40b93-184">Источник времени поддерживает те же состояния, что и часы представления (запуск, приостановка и остановка), и должен реализовывать интерфейс [**имфклоккстатесинк**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) .</span><span class="sxs-lookup"><span data-stu-id="40b93-184">A time source supports the same states as the presentation clock (running, paused, and stop), and must implement the [**IMFClockStateSink**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) interface.</span></span> <span data-ttu-id="40b93-185">Часы представления используют этот интерфейс для уведомления источника времени об изменении состояния.</span><span class="sxs-lookup"><span data-stu-id="40b93-185">The presentation clock uses this interface to notify the time source when to change state.</span></span> <span data-ttu-id="40b93-186">Таким образом, источник времени предоставляет такты часов, но часы представления инициируют изменения состояния в часах.</span><span class="sxs-lookup"><span data-stu-id="40b93-186">In this way, the time source provides the clock ticks, but the presentation clock initiates state changes in the clock.</span></span>

<span data-ttu-id="40b93-187">Некоторые приемники мультимедиа имеют доступ к точным часам и, таким образом, предоставляют интерфейс [**имфпресентатионтимесаурце**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) .</span><span class="sxs-lookup"><span data-stu-id="40b93-187">Some media sinks have access to an accurate clock, and therefore expose the [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) interface.</span></span> <span data-ttu-id="40b93-188">В частности, модуль подготовки звука может использовать частоту звуковой карты в виде часов.</span><span class="sxs-lookup"><span data-stu-id="40b93-188">In particular, the audio renderer can use the frequency of the sound card as a clock.</span></span> <span data-ttu-id="40b93-189">В воспроизведении звука полезно, чтобы модуль подготовки звука действовал в качестве источника времени, чтобы видео было синхронизировано с частотой воспроизведения звука.</span><span class="sxs-lookup"><span data-stu-id="40b93-189">In audio playback, it is useful for the audio renderer to act as the time source, so that video is synchronized to the audio playback rate.</span></span> <span data-ttu-id="40b93-190">Обычно это дает лучшие результаты, чем попытка сопоставить звук с внешними часами.</span><span class="sxs-lookup"><span data-stu-id="40b93-190">This generally produces better results than attempting to match the audio to an external clock.</span></span>

<span data-ttu-id="40b93-191">Media Foundation также предоставляет источник времени презентации на основе системных часов.</span><span class="sxs-lookup"><span data-stu-id="40b93-191">Media Foundation also provides a presentation time source based on the system clock.</span></span> <span data-ttu-id="40b93-192">Чтобы создать этот объект, вызовите [**мфкреатесистемтимесаурце**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatesystemtimesource).</span><span class="sxs-lookup"><span data-stu-id="40b93-192">To create this object, call [**MFCreateSystemTimeSource**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatesystemtimesource).</span></span> <span data-ttu-id="40b93-193">Системный источник времени можно использовать, когда приемники носителей не предоставляют источник времени.</span><span class="sxs-lookup"><span data-stu-id="40b93-193">The system time source can be used when no media sinks provide a time source.</span></span>

<span data-ttu-id="40b93-194">В общем случае приемник мультимедиа должен использовать предоставленные ему часы презентации независимо от источника времени, используемого часами представления.</span><span class="sxs-lookup"><span data-stu-id="40b93-194">In general, a media sink must use the presentation clock provided to it, regardless of which time source the presentation clock uses.</span></span> <span data-ttu-id="40b93-195">Это правило применяется, даже если приемник мультимедиа реализует [**имфпресентатионтимесаурце**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource).</span><span class="sxs-lookup"><span data-stu-id="40b93-195">This rule applies even when a media sink implements [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource).</span></span> <span data-ttu-id="40b93-196">Если часы презентации используют другой источник времени, приемник мультимедиа должен следовать за этим источником времени, а не со своими собственными внутренними часами.</span><span class="sxs-lookup"><span data-stu-id="40b93-196">If the presentation clock uses some other time source, the media sink must follow that time source, not its own internal clock.</span></span>

<span data-ttu-id="40b93-197">Существует две ситуации, когда приемник мультимедиа не будет следовать часам презентации:</span><span class="sxs-lookup"><span data-stu-id="40b93-197">There are two situations when a media sink will not follow the presentation clock:</span></span>

-   <span data-ttu-id="40b93-198">Некоторые приемники мультимедиа не имеют *интенсивности*.</span><span class="sxs-lookup"><span data-stu-id="40b93-198">Some media sinks are *rateless*.</span></span> <span data-ttu-id="40b93-199">Если приемник мультимедиа не зависит от скорости, он использует примеры как можно быстрее, не планируя их в соответствии с часами презентации.</span><span class="sxs-lookup"><span data-stu-id="40b93-199">If a media sink is rateless, it consumes samples as quickly as possible, without scheduling them according to the presentation clock.</span></span> <span data-ttu-id="40b93-200">Обычно приемники, не имеющие интенсивности, записывают данные в файл, поэтому желательно выполнить операцию как можно быстрее.</span><span class="sxs-lookup"><span data-stu-id="40b93-200">Typically, rateless sinks write data to a file, so it is desirable to complete the operation as quickly as possible.</span></span> <span data-ttu-id="40b93-201">Приемник с независимыми частотами возвращает \_ в метод [**имфмедиасинк::**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) медиасинк флаг безчастотной скорости.</span><span class="sxs-lookup"><span data-stu-id="40b93-201">A rateless sink returns the MEDIASINK\_RATELESS flag in its [**IMFMediaSink::GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) method.</span></span> <span data-ttu-id="40b93-202">Если все приемники в топологии не имеют скорости, сеанс передачи данных по мере возможности отправляет данные через конвейер.</span><span class="sxs-lookup"><span data-stu-id="40b93-202">When all the sinks in a topology are rateless, the Media Session pushes data through the pipeline as quickly as possible.</span></span>

-   <span data-ttu-id="40b93-203">Некоторые приемники мультимедиа не могут соответствовать тарифам с источником времени, отличным от самих.</span><span class="sxs-lookup"><span data-stu-id="40b93-203">Some media sinks cannot match rates with a time source other than themselves.</span></span> <span data-ttu-id="40b93-204">Если это так, приемник возвращает МЕДИАСИНК \_ не может \_ соответствовать \_ флагу часов в [](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) методе "Methods".</span><span class="sxs-lookup"><span data-stu-id="40b93-204">If so, the sink returns the MEDIASINK\_CANNOT\_MATCH\_CLOCK flag in its [**GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) method.</span></span> <span data-ttu-id="40b93-205">Конвейер может по-прежнему использовать другой источник времени, но результаты будут менее оптимальными.</span><span class="sxs-lookup"><span data-stu-id="40b93-205">The pipeline can still use another time source, but the results will be less than optimal.</span></span> <span data-ttu-id="40b93-206">Приемник, скорее всего, будет относиться к сбоям и вызывать сбои во время воспроизведения.</span><span class="sxs-lookup"><span data-stu-id="40b93-206">The sink will likely fall behind and cause glitches during playback.</span></span>

## <a name="related-topics"></a><span data-ttu-id="40b93-207">См. также</span><span class="sxs-lookup"><span data-stu-id="40b93-207">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="40b93-208">Media Foundation API платформы</span><span class="sxs-lookup"><span data-stu-id="40b93-208">Media Foundation Platform APIs</span></span>](media-foundation-platform-apis.md)
</dt> </dl>

 

 



