---
description: Расширенный обработчик видео (Евр) — это компонент, отображающий видео на мониторе пользователей.
ms.assetid: 1c985558-d25d-4f51-978a-58c05943dab9
title: Улучшенный модуль подготовки видео
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1ab0881da0827e6cc757a0ea855bcb51864dd98e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104342492"
---
# <a name="enhanced-video-renderer"></a><span data-ttu-id="c174d-103">Улучшенный модуль подготовки видео</span><span class="sxs-lookup"><span data-stu-id="c174d-103">Enhanced Video Renderer</span></span>

<span data-ttu-id="c174d-104">Расширенный обработчик видео (Евр) — это компонент, отображающий видео на мониторе пользователя.</span><span class="sxs-lookup"><span data-stu-id="c174d-104">The enhanced video renderer (EVR) is a component that displays video on the user's monitor.</span></span> <span data-ttu-id="c174d-105">Существуют две версии Евр:</span><span class="sxs-lookup"><span data-stu-id="c174d-105">Two versions of the EVR exist:</span></span>

-   <span data-ttu-id="c174d-106">Приемник мультимедиа Евр для приложений Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="c174d-106">The EVR media sink, for Media Foundation applications.</span></span>
-   <span data-ttu-id="c174d-107">Фильтр Евр для приложений DirectShow.</span><span class="sxs-lookup"><span data-stu-id="c174d-107">The EVR filter, for DirectShow applications.</span></span>

<span data-ttu-id="c174d-108">Обе версии используют одни и те же внутренние объекты для отрисовки видео и совместно используют многие из одних и тех же интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="c174d-108">Both versions use the same internal objects to render video, and they share many of the same interfaces.</span></span>

<span data-ttu-id="c174d-109">Евр может сочетать до 16 потоков видео.</span><span class="sxs-lookup"><span data-stu-id="c174d-109">The EVR can mix up to 16 video streams.</span></span> <span data-ttu-id="c174d-110">Первый входной поток называется *ссылочным потоком*.</span><span class="sxs-lookup"><span data-stu-id="c174d-110">The first input stream is called the *reference stream*.</span></span> <span data-ttu-id="c174d-111">Ссылочный поток всегда отображается первым в z-порядке.</span><span class="sxs-lookup"><span data-stu-id="c174d-111">The reference stream always appears first in the z-order.</span></span> <span data-ttu-id="c174d-112">Любые дополнительные потоки называются *подпотоками* и смешиваются поверх потока ссылок.</span><span class="sxs-lookup"><span data-stu-id="c174d-112">Any additional streams are called *substreams*, and are mixed on top of the reference stream.</span></span> <span data-ttu-id="c174d-113">Приложение может изменить z-порядок для подпотоков, но ни один из подпотоков не может быть первым в z-порядке.</span><span class="sxs-lookup"><span data-stu-id="c174d-113">The application can change the z-order of the substreams, but no substream can be first in the z-order.</span></span>

<span data-ttu-id="c174d-114">Графический драйвер определяет поддерживаемые форматы видео, но обычно они ограничены следующими элементами:</span><span class="sxs-lookup"><span data-stu-id="c174d-114">The graphics driver determines which video formats are supported, but typically they are limited to the following:</span></span>

-   <span data-ttu-id="c174d-115">Ссылочный поток: прогрессивное или чередование YUV без альфа-составляющей для каждого пикселя (например, NV12 или YUY2); или прогрессивный RGB.</span><span class="sxs-lookup"><span data-stu-id="c174d-115">Reference stream: Progressive or interlaced YUV with no per-pixel alpha (such as NV12 or YUY2); or progressive RGB.</span></span>
-   <span data-ttu-id="c174d-116">Подпотоки: прогрессивное YUV с поддержкой отдельных пикселей, например АЙУВ или AI44.</span><span class="sxs-lookup"><span data-stu-id="c174d-116">Substreams: Progressive YUV with per-pixel-alpha, such as AYUV or AI44.</span></span>

<span data-ttu-id="c174d-117">Доступные форматы подпотока могут зависеть от формата потока ссылок.</span><span class="sxs-lookup"><span data-stu-id="c174d-117">The available substream formats might depend on the format of the reference stream.</span></span> <span data-ttu-id="c174d-118">Дополнительные сведения см. в разделе [Евр Media Type переговоры](evr-media-type-negotiation.md).</span><span class="sxs-lookup"><span data-stu-id="c174d-118">For more information, see [EVR Media Type Negotiation](evr-media-type-negotiation.md).</span></span>

<span data-ttu-id="c174d-119">На внутреннем уровне Евр использует объект, называемый *микшером* , для совмещения кадров из входных потоков на одной поверхности для отрисовки.</span><span class="sxs-lookup"><span data-stu-id="c174d-119">Internally, the EVR uses an object called the *mixer* to composite the frames from the input streams onto one surface for rendering.</span></span> <span data-ttu-id="c174d-120">Микшер также выполняет дечередование и исправление цветов.</span><span class="sxs-lookup"><span data-stu-id="c174d-120">The mixer also performs deinterlacing and color correction.</span></span> <span data-ttu-id="c174d-121">Выходные данные микшера — это окончательный составной кадр видеоматериала.</span><span class="sxs-lookup"><span data-stu-id="c174d-121">The output from the mixer is the final composited video frame.</span></span> <span data-ttu-id="c174d-122">Второй объект, называемый *выступающим* , визуализирует видеокадр на экране.</span><span class="sxs-lookup"><span data-stu-id="c174d-122">A second object called the *presenter* renders the video frame to the display.</span></span> <span data-ttu-id="c174d-123">Выступающий планирует, когда кадры подготавливаются к просмотру и управляют устройством Direct3D.</span><span class="sxs-lookup"><span data-stu-id="c174d-123">The presenter schedules when the frames are rendered and manages the Direct3D device.</span></span> <span data-ttu-id="c174d-124">Приложение может предоставить пользовательскую реализацию либо микшера, либо выступающего.</span><span class="sxs-lookup"><span data-stu-id="c174d-124">An application can provide a custom implementation of either the mixer or the presenter.</span></span>

<span data-ttu-id="c174d-125">Частота выходных кадров заблокирована в ссылочном потоке.</span><span class="sxs-lookup"><span data-stu-id="c174d-125">The output frame rate is locked to the reference stream.</span></span> <span data-ttu-id="c174d-126">Когда подпотоки получают новые кадры, микшер удерживает их.</span><span class="sxs-lookup"><span data-stu-id="c174d-126">Whenever the substreams receive new frames, the mixer holds onto them.</span></span> <span data-ttu-id="c174d-127">Когда ссылочный поток получает новый кадр, микшер комбинирует этот кадр с кадрами подпотока.</span><span class="sxs-lookup"><span data-stu-id="c174d-127">When the reference stream receives a new frame, the mixer composites that frame with the substream frames.</span></span> <span data-ttu-id="c174d-128">(Если для потока ссылок используется чередование, для полного кадра ссылок может потребоваться несколько примеров мультимедиа.) Подпоток может получить более одного кадра, пока микшер ожидает ссылочного фрейма.</span><span class="sxs-lookup"><span data-stu-id="c174d-128">(If the reference stream is interlaced, a complete reference frame may require more than one media sample.) It is possible for a substream to receive more than one frame while the mixer is waiting for a reference frame.</span></span> <span data-ttu-id="c174d-129">В этом случае микшер просто удаляет предыдущий кадр подпотока.</span><span class="sxs-lookup"><span data-stu-id="c174d-129">In that case, the mixer simply discards the previous substream frame.</span></span>

<span data-ttu-id="c174d-130">Поскольку выступающий создает устройство Direct3D, оно также отвечает за предоставление общего доступа к устройству другим объектам конвейера, которым требуется доступ к службам DirectX Video Acceleration (ДКСВА).</span><span class="sxs-lookup"><span data-stu-id="c174d-130">Because the presenter creates the Direct3D device, it is also responsible for sharing the device with other pipeline objects that need to access DirectX Video Acceleration (DXVA) services.</span></span> <span data-ttu-id="c174d-131">В частности, микшер Евр использует службы обработки видео ДКСВА для дечередования и смешивания видео.</span><span class="sxs-lookup"><span data-stu-id="c174d-131">In particular, the EVR mixer uses the DXVA video processing services to deinterlace and mix the video.</span></span> <span data-ttu-id="c174d-132">По отношению к Евр программные декодеры могут использовать ДКСВА для ускорения декодирования видео.</span><span class="sxs-lookup"><span data-stu-id="c174d-132">External to the EVR, software decoders may use DXVA for accelerated video decoding.</span></span> <span data-ttu-id="c174d-133">Выступающий использует устройство Direct3D с помощью [Диспетчер устройств Direct3D](direct3d-device-manager.md).</span><span class="sxs-lookup"><span data-stu-id="c174d-133">The presenter shares the Direct3D device by means of the [Direct3D Device Manager](direct3d-device-manager.md).</span></span> <span data-ttu-id="c174d-134">На следующей диаграмме показана внутренняя архитектура Евр.</span><span class="sxs-lookup"><span data-stu-id="c174d-134">The following diagram shows the internal architecture of the EVR.</span></span> <span data-ttu-id="c174d-135">(Программный декодер, затененный серым цветом, не является частью Евр.)</span><span class="sxs-lookup"><span data-stu-id="c174d-135">(The software decoder, shaded in gray, is not part of the EVR.)</span></span>

![Схема архитектуры, показывающая Евр.](images/5d4a1fd9-25ff-4cc5-a486-0d22f34bbfd7.gif)

## <a name="evr-interfaces"></a><span data-ttu-id="c174d-137">Интерфейсы Евр</span><span class="sxs-lookup"><span data-stu-id="c174d-137">EVR Interfaces</span></span>

<span data-ttu-id="c174d-138">Евр поддерживает следующие интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="c174d-138">The EVR supports the following interfaces.</span></span> <span data-ttu-id="c174d-139">Некоторые из этих интерфейсов реализуются микшером или выступающим.</span><span class="sxs-lookup"><span data-stu-id="c174d-139">Some of these interfaces are implemented by the mixer or presenter.</span></span> <span data-ttu-id="c174d-140">Для каждого интерфейса справочный раздел описывает, как получить указатель на интерфейс.</span><span class="sxs-lookup"><span data-stu-id="c174d-140">For each interface, the reference topic describes how to get a pointer to the interface.</span></span>

| <span data-ttu-id="c174d-141">Интерфейс</span><span class="sxs-lookup"><span data-stu-id="c174d-141">Interface</span></span>                                                    | <span data-ttu-id="c174d-142">Описание</span><span class="sxs-lookup"><span data-stu-id="c174d-142">Description</span></span>                                                                                       |
|--------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="c174d-143">**иеврфилтерконфиг**</span><span class="sxs-lookup"><span data-stu-id="c174d-143">**IEVRFilterConfig**</span></span>](/windows/desktop/api/evr/nn-evr-ievrfilterconfig)                 | <span data-ttu-id="c174d-144">Задает количество входных ПИН-кодов в фильтре Евр (только DirectShow).</span><span class="sxs-lookup"><span data-stu-id="c174d-144">Sets the number of input pins on the EVR filter (DirectShow only).</span></span>                                |
| [<span data-ttu-id="c174d-145">**иеврфилтерконфижекс**</span><span class="sxs-lookup"><span data-stu-id="c174d-145">**IEVRFilterConfigEx**</span></span>](/windows/desktop/api/evr/nn-evr-ievrfilterconfigex)             | <span data-ttu-id="c174d-146">Настраивает фильтр Евр (только DirectShow).</span><span class="sxs-lookup"><span data-stu-id="c174d-146">Configures the EVR filter (DirectShow only).</span></span>                                                      |
| [<span data-ttu-id="c174d-147">**иевртрустедвидеоплугин**</span><span class="sxs-lookup"><span data-stu-id="c174d-147">**IEVRTrustedVideoPlugin**</span></span>](/windows/desktop/api/evr/nn-evr-ievrtrustedvideoplugin)     | <span data-ttu-id="c174d-148">Включает подключаемый модуль Евр для отображения защищенного видео.</span><span class="sxs-lookup"><span data-stu-id="c174d-148">Enables an EVR plug-in to render protected video.</span></span>                                                 |
| [<span data-ttu-id="c174d-149">**имфдесиредсампле**</span><span class="sxs-lookup"><span data-stu-id="c174d-149">**IMFDesiredSample**</span></span>](/windows/desktop/api/evr/nn-evr-imfdesiredsample)                 | <span data-ttu-id="c174d-150">Позволяет выступающему Евр запрашивать конкретный кадр из микшера.</span><span class="sxs-lookup"><span data-stu-id="c174d-150">Enables the EVR presenter to request a specific frame from the mixer.</span></span>                             |
| [<span data-ttu-id="c174d-151">**имфкуалитядвисе**</span><span class="sxs-lookup"><span data-stu-id="c174d-151">**IMFQualityAdvise**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfqualityadvise)                 | <span data-ttu-id="c174d-152">Позволяет менеджеру по качеству настраивать качество видео Евр.</span><span class="sxs-lookup"><span data-stu-id="c174d-152">Enables the quality manager to adjust the EVR video quality.</span></span>                                      |
| [<span data-ttu-id="c174d-153">**имфтопологисервицелукуп**</span><span class="sxs-lookup"><span data-stu-id="c174d-153">**IMFTopologyServiceLookup**</span></span>](/windows/desktop/api/evr/nn-evr-imftopologyservicelookup) | <span data-ttu-id="c174d-154">Включает пользовательский микшер или выступающий для получения указателей интерфейса из Евр.</span><span class="sxs-lookup"><span data-stu-id="c174d-154">Enables a custom mixer or presenter to get interface pointers from the EVR.</span></span>                       |
| [<span data-ttu-id="c174d-155">**имфвидеодевицеид**</span><span class="sxs-lookup"><span data-stu-id="c174d-155">**IMFVideoDeviceID**</span></span>](/windows/desktop/api/evr/nn-evr-imfvideodeviceid)                 | <span data-ttu-id="c174d-156">Возвращает идентификатор устройства для микшера Евр или Presenter.</span><span class="sxs-lookup"><span data-stu-id="c174d-156">Returns the device identifier of an EVR mixer or presenter.</span></span>                                       |
| [<span data-ttu-id="c174d-157">**имфвидеодисплайконтрол**</span><span class="sxs-lookup"><span data-stu-id="c174d-157">**IMFVideoDisplayControl**</span></span>](/windows/desktop/api/evr/nn-evr-imfvideodisplaycontrol)     | <span data-ttu-id="c174d-158">Управляет отображением видео в Евр.</span><span class="sxs-lookup"><span data-stu-id="c174d-158">Controls how the EVR displays video.</span></span>                                                              |
| [<span data-ttu-id="c174d-159">**имфвидеомиксербитмап**</span><span class="sxs-lookup"><span data-stu-id="c174d-159">**IMFVideoMixerBitmap**</span></span>](/windows/desktop/api/evr9/nn-evr9-imfvideomixerbitmap)           | <span data-ttu-id="c174d-160">Альфа — смешение статического растрового изображения с видео.</span><span class="sxs-lookup"><span data-stu-id="c174d-160">Alpha-blends a static bitmap image with the video.</span></span>                                                |
| [<span data-ttu-id="c174d-161">**имфвидеомиксерконтрол**</span><span class="sxs-lookup"><span data-stu-id="c174d-161">**IMFVideoMixerControl**</span></span>](/windows/desktop/api/evr/nn-evr-imfvideomixercontrol)         | <span data-ttu-id="c174d-162">Управляет тем, как Расширенный модуль подготовки видео (Евр) смешивает видеопотоки.</span><span class="sxs-lookup"><span data-stu-id="c174d-162">Controls how the Enhanced Video Renderer (EVR) mixes video substreams.</span></span>                            |
| [<span data-ttu-id="c174d-163">**IMFVideoMixerControl2**</span><span class="sxs-lookup"><span data-stu-id="c174d-163">**IMFVideoMixerControl2**</span></span>](/windows/desktop/api/evr/nn-evr-imfvideomixercontrol2)       | <span data-ttu-id="c174d-164">Управляет параметрами для устранения нечередующихся видео.</span><span class="sxs-lookup"><span data-stu-id="c174d-164">Controls preferences for video deinterlacing.</span></span>                                                     |
| [<span data-ttu-id="c174d-165">**имфвидеопоситионмаппер**</span><span class="sxs-lookup"><span data-stu-id="c174d-165">**IMFVideoPositionMapper**</span></span>](/windows/desktop/api/evr/nn-evr-imfvideopositionmapper)     | <span data-ttu-id="c174d-166">Сопоставляет расположение входного видеопотока с соответствующей позицией в выходном видеопотоке.</span><span class="sxs-lookup"><span data-stu-id="c174d-166">Maps a position on an input video stream to the corresponding position on an output video stream.</span></span> |
| [<span data-ttu-id="c174d-167">**имфвидеопресентер**</span><span class="sxs-lookup"><span data-stu-id="c174d-167">**IMFVideoPresenter**</span></span>](/windows/desktop/api/evr/nn-evr-imfvideopresenter)               | <span data-ttu-id="c174d-168">Предоставляется средством отображения Евр.</span><span class="sxs-lookup"><span data-stu-id="c174d-168">Exposed by the EVR presenter.</span></span>                                                                     |
| [<span data-ttu-id="c174d-169">**имфвидеопроцессор**</span><span class="sxs-lookup"><span data-stu-id="c174d-169">**IMFVideoProcessor**</span></span>](/windows/desktop/api/evr9/nn-evr9-imfvideoprocessor)               | <span data-ttu-id="c174d-170">Управляет обработкой видео, включая корректировку, фильтры шума и подробные фильтры.</span><span class="sxs-lookup"><span data-stu-id="c174d-170">Controls video processing, including adjustment, noise filters, and detail filters.</span></span>               |
| [<span data-ttu-id="c174d-171">**имфвидеорендерер**</span><span class="sxs-lookup"><span data-stu-id="c174d-171">**IMFVideoRenderer**</span></span>](/windows/desktop/api/evr/nn-evr-imfvideorenderer)                 | <span data-ttu-id="c174d-172">Задает микшер или выступающий на Евр.</span><span class="sxs-lookup"><span data-stu-id="c174d-172">Sets a mixer or presenter on the EVR.</span></span>                                                             |
| [<span data-ttu-id="c174d-173">**имфвидеосамплеаллокатор**</span><span class="sxs-lookup"><span data-stu-id="c174d-173">**IMFVideoSampleAllocator**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfvideosampleallocator)   | <span data-ttu-id="c174d-174">Выделяет образцы видео.</span><span class="sxs-lookup"><span data-stu-id="c174d-174">Allocates video samples.</span></span>                                                                          |



 

## <a name="in-this-section"></a><span data-ttu-id="c174d-175">в этом разделе</span><span class="sxs-lookup"><span data-stu-id="c174d-175">In This Section</span></span>



| <span data-ttu-id="c174d-176">Раздел</span><span class="sxs-lookup"><span data-stu-id="c174d-176">Topic</span></span>                                                                    | <span data-ttu-id="c174d-177">Описание</span><span class="sxs-lookup"><span data-stu-id="c174d-177">Description</span></span>                                                                           |
|--------------------------------------------------------------------------|---------------------------------------------------------------------------------------|
| [<span data-ttu-id="c174d-178">Использование фильтра Евр DirectShow</span><span class="sxs-lookup"><span data-stu-id="c174d-178">Using the DirectShow EVR Filter</span></span>](using-the-directshow-evr-filter.md)   | <span data-ttu-id="c174d-179">Использование Евр в приложении DirectShow.</span><span class="sxs-lookup"><span data-stu-id="c174d-179">How to use the EVR in a DirectShow application.</span></span>                                       |
| [<span data-ttu-id="c174d-180">Использование приемника мультимедиа Евр</span><span class="sxs-lookup"><span data-stu-id="c174d-180">Using the EVR Media Sink</span></span>](using-the-evr-media-sink.md)                 | <span data-ttu-id="c174d-181">Как использовать Евр в приложении Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="c174d-181">How to use the EVR in a Media Foundation application.</span></span>                                 |
| [<span data-ttu-id="c174d-182">Использование элементов управления отображением видео</span><span class="sxs-lookup"><span data-stu-id="c174d-182">Using the Video Display Controls</span></span>](using-the-video-display-controls.md) | <span data-ttu-id="c174d-183">Как управлять способом отображения видео в окне приложения Евр.</span><span class="sxs-lookup"><span data-stu-id="c174d-183">How to control the way in which the EVR displays video inside the application window.</span></span> |
| [<span data-ttu-id="c174d-184">Использование элементов управления "микшер видео"</span><span class="sxs-lookup"><span data-stu-id="c174d-184">Using the Video Mixer Controls</span></span>](using-the-video-mixer-controls.md)     | <span data-ttu-id="c174d-185">Как управлять способом, которым работает микшер Евр.</span><span class="sxs-lookup"><span data-stu-id="c174d-185">How to control the way in which the EVR mixer operates.</span></span>                               |
| [<span data-ttu-id="c174d-186">Согласование типа носителя Евр</span><span class="sxs-lookup"><span data-stu-id="c174d-186">EVR Media Type Negotiation</span></span>](evr-media-type-negotiation.md)             | <span data-ttu-id="c174d-187">Описывает, как Евр определяет, какие видеоформаты он может принимать в качестве входных данных.</span><span class="sxs-lookup"><span data-stu-id="c174d-187">Describes how the EVR determines which video formats it can accept as input.</span></span>          |
| [<span data-ttu-id="c174d-188">Пользовательские Миксерс</span><span class="sxs-lookup"><span data-stu-id="c174d-188">Custom Mixers</span></span>](custom-mixers.md)                                       | <span data-ttu-id="c174d-189">Как написать пользовательское микшер для Евр.</span><span class="sxs-lookup"><span data-stu-id="c174d-189">How to write a custom mixer for the EVR.</span></span>                                              |
| [<span data-ttu-id="c174d-190">Написание выступающего Евр</span><span class="sxs-lookup"><span data-stu-id="c174d-190">How to Write an EVR Presenter</span></span>](how-to-write-an-evr-presenter.md)       | <span data-ttu-id="c174d-191">Как написать пользовательский объект Presenter для Евр.</span><span class="sxs-lookup"><span data-stu-id="c174d-191">How to write a custom presenter for the EVR.</span></span>                                          |



 

## <a name="related-topics"></a><span data-ttu-id="c174d-192">См. также</span><span class="sxs-lookup"><span data-stu-id="c174d-192">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c174d-193">Воспроизведение звука/видео</span><span class="sxs-lookup"><span data-stu-id="c174d-193">Audio/Video Playback</span></span>](audio-video-playback.md)
</dt> </dl>

 

 



