---
description: В этой статье содержатся общие рекомендации по использованию API-интерфейсов видео Direct3D 12.
ms.assetid: ''
title: Видеообзор Direct3D 12
ms.topic: article
ms.date: 06/03/2019
ms.openlocfilehash: b21587f2784b34131da9c050655b6f3fbe43582d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104539575"
---
# <a name="direct3d-12-video-overview"></a><span data-ttu-id="75f83-103">Видеообзор Direct3D 12</span><span class="sxs-lookup"><span data-stu-id="75f83-103">Direct3D 12 Video Overview</span></span>

<span data-ttu-id="75f83-104">В этой статье содержатся общие рекомендации по использованию API-интерфейсов видео Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="75f83-104">This article contains general guidance for using the Direct3D 12 video APIs.</span></span>

## <a name="about-direct3d-12-video"></a><span data-ttu-id="75f83-105">Видео о Direct3D 12</span><span class="sxs-lookup"><span data-stu-id="75f83-105">About Direct3D 12 Video</span></span>

<span data-ttu-id="75f83-106">Видеоинтерфейс Direct3D 12 предоставляет приложениям новый способ реализации декодирования и обработки видео.</span><span class="sxs-lookup"><span data-stu-id="75f83-106">The Direct3D 12 video interface provides a new way for apps to implement video decoding and process.</span></span> <span data-ttu-id="75f83-107">Интерфейс Direct3D 12 отличается от предыдущего интерфейса Direct3D 11, так как он спроектирован так, чтобы соответствовать принципам и стилю Direct3D 12, включая следующие:</span><span class="sxs-lookup"><span data-stu-id="75f83-107">The Direct3D 12 interface is different from the previous Direct3D 11 interface because it was designed to be consistent with the Direct3D 12 principles and style, which includes the following:</span></span>

- <span data-ttu-id="75f83-108">Предоставление разработчикам дополнительных возможностей управления</span><span class="sxs-lookup"><span data-stu-id="75f83-108">Give developers more control</span></span>
 - <span data-ttu-id="75f83-109">Выделение памяти, доступной для оборудования</span><span class="sxs-lookup"><span data-stu-id="75f83-109">Allocation of hardware-accessible memory</span></span>
 - <span data-ttu-id="75f83-110">Потоки ЦП, используемые для создания команд отправки &</span><span class="sxs-lookup"><span data-stu-id="75f83-110">CPU threads used to generate & submit commands</span></span>
   - <span data-ttu-id="75f83-111">Независимое поколение и отправка</span><span class="sxs-lookup"><span data-stu-id="75f83-111">Independent generation and submission</span></span>
   - <span data-ttu-id="75f83-112">Неблокирующий</span><span class="sxs-lookup"><span data-stu-id="75f83-112">Non-blocking</span></span>
 - <span data-ttu-id="75f83-113">Планирование работы оборудования</span><span class="sxs-lookup"><span data-stu-id="75f83-113">Scheduling of hardware work</span></span>
- <span data-ttu-id="75f83-114">В этой статье рассматриваются существующие функциональные возможности, включая большинство функций видео Direct3D 11, но в то же время обеспечивает простоту и простоту использования.</span><span class="sxs-lookup"><span data-stu-id="75f83-114">Covers existing functionality, including most Direct3D 11 video functionality, but at the same time, keeps simplicity and ease of use in mind</span></span>
- <span data-ttu-id="75f83-115">Питание и производительность основных приложений Direct3D 12, которые равны или более чем Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="75f83-115">Power and performance of main Direct3D 12 applications equal to or better than Direct3D 11</span></span>
- <span data-ttu-id="75f83-116">Согласованность с другими API-интерфейсами Direct3D 12</span><span class="sxs-lookup"><span data-stu-id="75f83-116">Consistency with other Direct3D 12 APIs</span></span>
- <span data-ttu-id="75f83-117">Взаимодействие с существующими API графических интерфейсов</span><span class="sxs-lookup"><span data-stu-id="75f83-117">Interoperability with existing graphics APIs</span></span>


## <a name="video-decoding"></a><span data-ttu-id="75f83-118">Декодирование видео</span><span class="sxs-lookup"><span data-stu-id="75f83-118">Video decoding</span></span>

<span data-ttu-id="75f83-119">В следующих разделах описаны некоторые задачи, связанные с реализацией декодирования видео Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="75f83-119">The following sections describe some of the tasks involved in implementing Direct3D 12 video decoding.</span></span>

### <a name="query-for-decoding-capabilities"></a><span data-ttu-id="75f83-120">Запрос возможностей декодирования</span><span class="sxs-lookup"><span data-stu-id="75f83-120">Query for decoding capabilities</span></span>

<span data-ttu-id="75f83-121">Вызовите [ID3D12VideoDevice:: чеккфеатуресуппорт](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videodevice-checkfeaturesupport) , чтобы проверить сведения о поддержке для операций декодирования видео Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="75f83-121">Call [ID3D12VideoDevice::CheckFeatureSupport](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videodevice-checkfeaturesupport) to check for the support details for Direct3D 12 video decoding operations.</span></span> <span data-ttu-id="75f83-122">Передайте значение из перечисления [D3D12_FEATURE_VIDEO](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_feature_video) , чтобы указать компонент, для которого запрашиваются сведения о поддержке.</span><span class="sxs-lookup"><span data-stu-id="75f83-122">Pass a value from the [D3D12_FEATURE_VIDEO](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_feature_video) enumeration to specify the feature for which you are requesting support information.</span></span>

### <a name="create-the-video-decoder"></a><span data-ttu-id="75f83-123">Создание видеодекодера</span><span class="sxs-lookup"><span data-stu-id="75f83-123">Create the video decoder</span></span>

<span data-ttu-id="75f83-124">Вызовите метод [ID3D12VideoDevice:: креатевидеодекодер](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videodevice-createvideodecoder) , чтобы создать экземпляр интерфейса [ID3D12VideoDecoder](/windows/desktop/api/d3d12video/nn-d3d12video-id3d12videodecoder) .</span><span class="sxs-lookup"><span data-stu-id="75f83-124">Call [ID3D12VideoDevice::CreateVideoDecoder](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videodevice-createvideodecoder) to create an instance of the [ID3D12VideoDecoder](/windows/desktop/api/d3d12video/nn-d3d12video-id3d12videodecoder) interface.</span></span> <span data-ttu-id="75f83-125">Декодер содержит состояние сеанса декодирования, включая данные, связанные со ссылками, такие как векторы движения.</span><span class="sxs-lookup"><span data-stu-id="75f83-125">The decoder holds state for a decode session, including reference-related data such as motion vectors.</span></span>  <span data-ttu-id="75f83-126">В случае изменения разрешения или [максдекодепиктуребуфферкаунт](/windows/desktop/api/d3d12video/ns-d3d12video-d3d12_video_decoder_heap_desc) объект декодера создается повторно.</span><span class="sxs-lookup"><span data-stu-id="75f83-126">In the event of a resolution change or a [MaxDecodePictureBufferCount](/windows/desktop/api/d3d12video/ns-d3d12video-d3d12_video_decoder_heap_desc) change, the decoder object is recreated.</span></span> <span data-ttu-id="75f83-127">Ширина и высота декодирования укажите собственное разрешение потока перед любым масштабом.</span><span class="sxs-lookup"><span data-stu-id="75f83-127">The decode width and height specify the native stream resolution before any scale.</span></span>  <span data-ttu-id="75f83-128">В поле Максимальное число раскодированных буферов рисунков (ДПБ) указано наибольшее число ДПБ, которое можно использовать без повторного создания видеодекодера.</span><span class="sxs-lookup"><span data-stu-id="75f83-128">The maximum Decode Picture Buffer (DPB) count specifies the largest DPB count that can be used without recreating the video decoder.</span></span>

<span data-ttu-id="75f83-129">Декодер может использоваться для записи команд из нескольких списков команд, но может быть связан только с одним списком команд за раз.</span><span class="sxs-lookup"><span data-stu-id="75f83-129">The decoder may be used to record commands from multiple command lists, but may only be associated with one command list at a time.</span></span>  <span data-ttu-id="75f83-130">Приложение отвечает за синхронизацию доступа к декодеру.</span><span class="sxs-lookup"><span data-stu-id="75f83-130">The application is responsible for synchronizing access to the decoder.</span></span>

### <a name="create-the-video-decoder-heap"></a><span data-ttu-id="75f83-131">Создание кучи видеодекодера</span><span class="sxs-lookup"><span data-stu-id="75f83-131">Create the video decoder heap</span></span> 

<span data-ttu-id="75f83-132">Вызовите метод [ID3D12VideoDevice:: креатевидеодекодерхеап](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videodevice-createvideodecoderheap) , чтобы создать экземпляр интерфейса [ID3D12VideoDecoderHeap](/windows/desktop/api/d3d12video/nn-d3d12video-id3d12videodecoderheap) .</span><span class="sxs-lookup"><span data-stu-id="75f83-132">Call [ID3D12VideoDevice::CreateVideoDecoderHeap](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videodevice-createvideodecoderheap) to create an instance of the [ID3D12VideoDecoderHeap](/windows/desktop/api/d3d12video/nn-d3d12video-id3d12videodecoderheap) interface.</span></span> <span data-ttu-id="75f83-133">Этот объект содержит ресурсы и состояние драйвера, зависящие от разрешения.</span><span class="sxs-lookup"><span data-stu-id="75f83-133">This object contains the resolution-dependent driver resources and state.</span></span>

### <a name="decoding-a-frame"></a><span data-ttu-id="75f83-134">Декодирование кадра</span><span class="sxs-lookup"><span data-stu-id="75f83-134">Decoding a frame</span></span>

<span data-ttu-id="75f83-135">Все входные и выходные параметры для операций обработки видео организованы в структуру входных параметров, [D3D12_VIDEO_DECODE_INPUT_STREAM_ARGUMENTS](/windows/desktop/api/d3d12video/ns-d3d12video-d3d12_video_decode_input_stream_arguments)и структуру выходного параметра [D3D12_VIDEO_DECODE_OUTPUT_STREAM_ARGUMENTS](/windows/desktop/api/d3d12video/ns-d3d12video-d3d12_video_decode_output_stream_arguments).</span><span class="sxs-lookup"><span data-stu-id="75f83-135">All input and output parameters for the video processing operations are organized into an input parameter structure, [D3D12_VIDEO_DECODE_INPUT_STREAM_ARGUMENTS](/windows/desktop/api/d3d12video/ns-d3d12video-d3d12_video_decode_input_stream_arguments), and an output parameter structure, [D3D12_VIDEO_DECODE_OUTPUT_STREAM_ARGUMENTS](/windows/desktop/api/d3d12video/ns-d3d12video-d3d12_video_decode_output_stream_arguments).</span></span>
<span data-ttu-id="75f83-136">Приложение управляет эталонными кадрами и, таким образом, должно задать опорные кадры для каждой операции декодирования.</span><span class="sxs-lookup"><span data-stu-id="75f83-136">The application manages the reference frames, and as such, needs to set the reference frames for every decoding operation.</span></span>
<span data-ttu-id="75f83-137">Когда список команд записывается правильно, вызовите [ID3D12CommandQueue:: ексекутекоммандлистс](/windows/desktop/api/d3d12/nf-d3d12-id3d12commandqueue-executecommandlists) в очереди команд видео, чтобы отправить кадр в код GPU.</span><span class="sxs-lookup"><span data-stu-id="75f83-137">When the command list is properly recorded, call [ID3D12CommandQueue::ExecuteCommandLists](/windows/desktop/api/d3d12/nf-d3d12-id3d12commandqueue-executecommandlists) on the video command queue to submit the frame decoding to the GPU.</span></span>


### <a name="enabling-decoder-output-conversions"></a><span data-ttu-id="75f83-138">Включение преобразования выходных данных декодера</span><span class="sxs-lookup"><span data-stu-id="75f83-138">Enabling decoder output conversions</span></span>
<span data-ttu-id="75f83-139">Если декодер поддерживает преобразование, включите необходимые преобразования, правильно заполнив структуру [D3D12_VIDEO_DECODE_CONVERSION_ARGUMENTS](/windows/desktop/api/d3d12video/ns-d3d12video-d3d12_video_decode_conversion_arguments) .</span><span class="sxs-lookup"><span data-stu-id="75f83-139">If the decoder supports conversion, then enable the desired conversions by properly filling the [D3D12_VIDEO_DECODE_CONVERSION_ARGUMENTS](/windows/desktop/api/d3d12video/ns-d3d12video-d3d12_video_decode_conversion_arguments) structure.</span></span> <span data-ttu-id="75f83-140">Формат и разрешение требуемых выходных данных и собственных выходных данных декодера передаются через различия в цветовых пространствах и разрешениях, указанных в параметрах преобразования.</span><span class="sxs-lookup"><span data-stu-id="75f83-140">The format and resolutions of the desired output versus the native output of the decoder are communicated via the difference in color space and resolutions specified in the conversion parameters.</span></span>

##  <a name="querying-decoding-status"></a><span data-ttu-id="75f83-141">Запрос состояния декодирования</span><span class="sxs-lookup"><span data-stu-id="75f83-141">Querying decoding status</span></span> 
<span data-ttu-id="75f83-142">Используйте методы [ID3D12VideoDecodeCommandList:: бегинкуери](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videodecodecommandlist-beginquery) и [ID3D12VideoDecodeCommandList:: ендкуери](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videodecodecommandlist-endquery) для запроса состояния операции декодирования.</span><span class="sxs-lookup"><span data-stu-id="75f83-142">Use the methods [ID3D12VideoDecodeCommandList::BeginQuery](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videodecodecommandlist-beginquery) and [ID3D12VideoDecodeCommandList::EndQuery](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videodecodecommandlist-endquery) to query the status of the decoding operation.</span></span>

<span data-ttu-id="75f83-143">Структура [D3D12_QUERY_DATA_VIDEO_DECODE_STATISTICS](/windows/win32/api/d3d12video/ns-d3d12video-d3d12_query_data_video_decode_statistics) используется для описания статистики видеорасшифровки.</span><span class="sxs-lookup"><span data-stu-id="75f83-143">The [D3D12_QUERY_DATA_VIDEO_DECODE_STATISTICS](/windows/win32/api/d3d12video/ns-d3d12video-d3d12_query_data_video_decode_statistics) structure is used to describe video decode statistics.</span></span> <span data-ttu-id="75f83-144">Чтобы получить экземпляр этой структуры, необходимо вызвать [ID3D12VideoDecodeCommandList:: ендкуери](/windows/win32/api/d3d12video/nf-d3d12video-id3d12videodecodecommandlist-endquery), передав значение типа запроса кучи, равное [D3D12_QUERY_TYPE_VIDEO_DECODE_STATISTIC](/windows/win32/api/d3d12/ne-d3d12-d3d12_query_type).</span><span class="sxs-lookup"><span data-stu-id="75f83-144">To get an instance of this structure call [ID3D12VideoDecodeCommandList::EndQuery](/windows/win32/api/d3d12video/nf-d3d12video-id3d12videodecodecommandlist-endquery), passing in the heap query type value of [D3D12_QUERY_TYPE_VIDEO_DECODE_STATISTIC](/windows/win32/api/d3d12/ne-d3d12-d3d12_query_type).</span></span> <span data-ttu-id="75f83-145">Обратите внимание, что этот запрос не использует [ID3D12VideoDecodeCommandList:: бегинкуери](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videodecodecommandlist-beginquery).</span><span class="sxs-lookup"><span data-stu-id="75f83-145">Note that this query does not use [ID3D12VideoDecodeCommandList::BeginQuery](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videodecodecommandlist-beginquery).</span></span>

## <a name="video-processing"></a><span data-ttu-id="75f83-146">Обработка видео</span><span class="sxs-lookup"><span data-stu-id="75f83-146">Video processing</span></span>

<span data-ttu-id="75f83-147">API-интерфейсы видео Direct3D 12 используют упрощенный подход к обработке видео, устраняя возможности Direct3D 11, которые не использовались широко, и удаляют проверки возможностей для компонентов, которые являются обязательными на разных устройствах.</span><span class="sxs-lookup"><span data-stu-id="75f83-147">Direct3D 12 video APIs take a streamlined approach to video processing, eliminating features of Direct3D 11 that weren't widely used and removing capability checks for features that are mandatory across devices.</span></span> <span data-ttu-id="75f83-148">Процесс перечисления для обработки видео исключен.</span><span class="sxs-lookup"><span data-stu-id="75f83-148">The enumeration process for video processing is eliminated.</span></span> <span data-ttu-id="75f83-149">Вместо этого вызовите [ID3D12VideoDevice:: чеккфеатуресуппорт](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videodevice-checkfeaturesupport) , который позволяет приложению обнаруживать возможности обработчика видео.</span><span class="sxs-lookup"><span data-stu-id="75f83-149">Instead, call [ID3D12VideoDevice::CheckFeatureSupport](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videodevice-checkfeaturesupport) which allows an app to identify the capabilities of the video processor.</span></span> <span data-ttu-id="75f83-150">Требуемое видео, чересстрочную развертку, форматы стерео и скорости предоставляются в качестве входных данных для **чеккфеатуресуппорт**.</span><span class="sxs-lookup"><span data-stu-id="75f83-150">The desired video, interlace, stereo formats and rates are provided as as input to **CheckFeatureSupport**.</span></span>

### <a name="removed-capabilities"></a><span data-ttu-id="75f83-151">Удаленные возможности</span><span class="sxs-lookup"><span data-stu-id="75f83-151">Removed capabilities</span></span>

<span data-ttu-id="75f83-152">Следующие возможности Direct3D 11 не поддерживаются при обработке видео Direct3D 12:</span><span class="sxs-lookup"><span data-stu-id="75f83-152">The following capabilities from Direct3D 11 are not supported in Direct3D 12 video processing:</span></span>
- <span data-ttu-id="75f83-153">Настраиваемые тарифы.</span><span class="sxs-lookup"><span data-stu-id="75f83-153">Custom rates.</span></span>  <span data-ttu-id="75f83-154">Вместо этого существует скорость ввода и вывода, заданная во время записи команды [ID3D12VideoProcessCommandList::P роцессфрамес](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videoprocesscommandlist-processframes) .</span><span class="sxs-lookup"><span data-stu-id="75f83-154">Instead, there is an input and output rate given during the [ID3D12VideoProcessCommandList::ProcessFrames](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videoprocesscommandlist-processframes) command recording.</span></span>
- <span data-ttu-id="75f83-155">Теперь доступны только два режима разчередования: [Bob](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_process_deinterlace_flags) и [Custom](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_process_deinterlace_flags).</span><span class="sxs-lookup"><span data-stu-id="75f83-155">There are just two deinterlacing modes available now: [BOB](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_process_deinterlace_flags) and [CUSTOM](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_process_deinterlace_flags).</span></span> <span data-ttu-id="75f83-156">Другие режимы были исключены.</span><span class="sxs-lookup"><span data-stu-id="75f83-156">Other modes have been eliminated.</span></span> <span data-ttu-id="75f83-157">CUSTOM — это высококачественный режим с чередованием, предоставляемый поставщиком оборудования.</span><span class="sxs-lookup"><span data-stu-id="75f83-157">CUSTOM is a high-quality deinterlacing mode provided by the hardware vendor.</span></span>
- <span data-ttu-id="75f83-158">Все необязательные форматы стерео в [D3D11_VIDEO_PROCESSOR_STEREO_CAPS](/windows/desktop/api/d3d11/ne-d3d11-d3d11_video_processor_stereo_caps) больше не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="75f83-158">All of the optional stereo formats in [D3D11_VIDEO_PROCESSOR_STEREO_CAPS](/windows/desktop/api/d3d11/ne-d3d11-d3d11_video_processor_stereo_caps) are no longer supported.</span></span> <span data-ttu-id="75f83-159">Вместо этого [Ноно](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_frame_stereo_format), [горизонтальные](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_frame_stereo_format), [вертикальные](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_frame_stereo_format)и [отдельные](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_frame_stereo_format) являются обязательными для всех аппаратных устройств, если поддерживается стерео.</span><span class="sxs-lookup"><span data-stu-id="75f83-159">Instead, [nono](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_frame_stereo_format), [horizontal](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_frame_stereo_format), [vertical](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_frame_stereo_format), and [separate](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_frame_stereo_format) are mandatory for all hardware devices if stereo is supported.</span></span>
- <span data-ttu-id="75f83-160">Для [D3D11_VIDEO_PROCESSOR_FORMAT_CAPS](/windows/desktop/api/d3d11/ne-d3d11-d3d11_video_processor_format_caps) или [D3D11_VIDEO_PROCESSOR_AUTO_STREAM_CAPS](/windows/desktop/api/d3d11/ne-d3d11-d3d11_video_processor_auto_stream_caps)не существует эквивалента.</span><span class="sxs-lookup"><span data-stu-id="75f83-160">There is no equivalent for [D3D11_VIDEO_PROCESSOR_FORMAT_CAPS](/windows/desktop/api/d3d11/ne-d3d11-d3d11_video_processor_format_caps) or [D3D11_VIDEO_PROCESSOR_AUTO_STREAM_CAPS](/windows/desktop/api/d3d11/ne-d3d11-d3d11_video_processor_auto_stream_caps).</span></span> <span data-ttu-id="75f83-161">Вместо этого входные и выходные форматы являются аргументами для создания видеопроцессора и в это время должны быть известны, если обработчик видео может или не может выполнить операцию с заданным форматом.</span><span class="sxs-lookup"><span data-stu-id="75f83-161">Instead, input and output formats are arguments to the creation of the video processor, and at that time, it should be known if the video processor can or cannot perform the operation with the given format.</span></span> <span data-ttu-id="75f83-162">[D3D12_VIDEO_PROCESS_AUTO_PROCESSING_FLAGS](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_process_auto_processing_flags) используется, чтобы указать, доступны ли функции автоматической обработки.</span><span class="sxs-lookup"><span data-stu-id="75f83-162">The [D3D12_VIDEO_PROCESS_AUTO_PROCESSING_FLAGS](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_process_auto_processing_flags) is used to indicate if auto processing features are available.</span></span>
- <span data-ttu-id="75f83-163">Для [D3D11_VIDEO_PROCESSOR_CAPS_LEGACY](/windows/desktop/api/d3d11/ne-d3d11-d3d11_video_processor_feature_caps)не существует эквивалента.</span><span class="sxs-lookup"><span data-stu-id="75f83-163">There is no equivalent for [D3D11_VIDEO_PROCESSOR_CAPS_LEGACY](/windows/desktop/api/d3d11/ne-d3d11-d3d11_video_processor_feature_caps).</span></span>
- <span data-ttu-id="75f83-164">Для [D3D11_VIDEO_PROCESSOR_CAPS_CONSTRICTION](/windows/desktop/api/d3d11/ne-d3d11-d3d11_video_processor_feature_caps)не существует эквивалента.</span><span class="sxs-lookup"><span data-stu-id="75f83-164">There is no equivalent for [D3D11_VIDEO_PROCESSOR_CAPS_CONSTRICTION](/windows/desktop/api/d3d11/ne-d3d11-d3d11_video_processor_feature_caps).</span></span>
- <span data-ttu-id="75f83-165">При преобразовании из стерео в Mono предполагается, что базовое представление равно 0.</span><span class="sxs-lookup"><span data-stu-id="75f83-165">When converting from stereo to mono, we assume the baseline view is 0.</span></span>
- <span data-ttu-id="75f83-166">Видео-обработка Direct3D 12 не поддерживает преобразование Mono в стерео и не поддерживает смещение Mono.</span><span class="sxs-lookup"><span data-stu-id="75f83-166">Direct3D 12 video processing does not support converting mono to stereo and there is no support for mono offset.</span></span> 


### <a name="creating-a-video-processor"></a><span data-ttu-id="75f83-167">Создание видеопроцессора</span><span class="sxs-lookup"><span data-stu-id="75f83-167">Creating a video processor</span></span>

<span data-ttu-id="75f83-168">Вызовите метод [ID3D12VideoDevice:: креатевидеопроцессор](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videodevice-createvideoprocessor) , чтобы создать экземпляр [ID3D12VideoProcessor](/windows/desktop/api/d3d12video/nn-d3d12video-id3d12videoprocessor).</span><span class="sxs-lookup"><span data-stu-id="75f83-168">Call [ID3D12VideoDevice::CreateVideoProcessor](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videodevice-createvideoprocessor) to create an instance of the [ID3D12VideoProcessor](/windows/desktop/api/d3d12video/nn-d3d12video-id3d12videoprocessor).</span></span> <span data-ttu-id="75f83-169">Обработчик видео содержит состояние сеанса обработки видео, включая требуемую промежуточную память, кэшированные данные обработки или другое временное рабочее пространство.</span><span class="sxs-lookup"><span data-stu-id="75f83-169">The video processor holds state for a video processing session, including required intermediate memory, cached processing data, or other temporary working space.</span></span> <span data-ttu-id="75f83-170">Аргументы создания видеопроцессора указывают, какие операции выполняются или доступны в [ID3D12VideoProcessCommandList1::P rocessframes1](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videoprocesscommandlist1-processframes1) Time.</span><span class="sxs-lookup"><span data-stu-id="75f83-170">The video processor creation arguments specify which operations are performed or are available at [ID3D12VideoProcessCommandList1::ProcessFrames1](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videoprocesscommandlist1-processframes1) time.</span></span>  <span data-ttu-id="75f83-171">Выделение драйвера для выполнения операции видеопроцесса (например, промежуточные) выделяется во время создания видеопроцессора.</span><span class="sxs-lookup"><span data-stu-id="75f83-171">Driver allocations to perform the video process operation (e.g. intermediates) are allocated at video processor creation time.</span></span>  <span data-ttu-id="75f83-172">Чтобы заранее определить размер выделения видеопроцессора, используйте [D3D12_FEATURE_VIDEO_PROCESSOR_SIZE](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_feature_video) .</span><span class="sxs-lookup"><span data-stu-id="75f83-172">Use [D3D12_FEATURE_VIDEO_PROCESSOR_SIZE](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_feature_video) to determine the allocation size of the video processor in advance.</span></span>

<span data-ttu-id="75f83-173">Обработчик видео может использоваться только для записи команд из нескольких списков команд, но может быть связан только с одним списком команд за раз.</span><span class="sxs-lookup"><span data-stu-id="75f83-173">The video processor may only be used to record commands from multiple command lists, but may only be associated with one command list at a time.</span></span>  <span data-ttu-id="75f83-174">Приложение отвечает за синхронизацию доступа к обработчику видео.</span><span class="sxs-lookup"><span data-stu-id="75f83-174">The application is responsible for synchronizing access to the video processor.</span></span>  <span data-ttu-id="75f83-175">Приложение также должно записывать команды обработки видео в прокоессор видео в том порядке, в котором они выполняются на GPU.</span><span class="sxs-lookup"><span data-stu-id="75f83-175">The application must also record video processing commands against the video procoessor in the order that they are executed on the GPU.</span></span>

<span data-ttu-id="75f83-176">Все входные и выходные аргументы для операций обработки видео организованы в структуру входных аргументов, [D3D12_VIDEO_PROCESS_INPUT_STREAM_ARGUMENTS](/windows/desktop/api/d3d12video/ns-d3d12video-d3d12_video_process_input_stream_arguments)и структуру выходного аргумента [D3D12_VIDEO_PROCESS_OUTPUT_STREAM_ARGUMENTS](/windows/desktop/api/d3d12video/ns-d3d12video-d3d12_video_process_output_stream_arguments).</span><span class="sxs-lookup"><span data-stu-id="75f83-176">All input and output arguments for the video processing operations are organized into an input argument structure, [D3D12_VIDEO_PROCESS_INPUT_STREAM_ARGUMENTS](/windows/desktop/api/d3d12video/ns-d3d12video-d3d12_video_process_input_stream_arguments), and an output argument structure, [D3D12_VIDEO_PROCESS_OUTPUT_STREAM_ARGUMENTS](/windows/desktop/api/d3d12video/ns-d3d12video-d3d12_video_process_output_stream_arguments).</span></span> <span data-ttu-id="75f83-177">Приложение должно вызвать [ID3D12VideoProcessCommandList::P роцессфрамес](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videoprocesscommandlist-processframes) , чтобы записать операцию обработки видео, которую нужно выполнить.</span><span class="sxs-lookup"><span data-stu-id="75f83-177">The application must call [ID3D12VideoProcessCommandList::ProcessFrames](/windows/desktop/api/d3d12video/nf-d3d12video-id3d12videoprocesscommandlist-processframes) to record the video processing operation it wants to execute.</span></span> 

<span data-ttu-id="75f83-178">Когда список команд записывается, вызовите [ID3D12CommandQueue:: ексекутекоммандлистс](/windows/desktop/api/d3d12/nf-d3d12-id3d12commandqueue-executecommandlists) в очереди команд видео, чтобы отправить кадровую обработку в GPU.</span><span class="sxs-lookup"><span data-stu-id="75f83-178">When the command list is recorded, call [ID3D12CommandQueue::ExecuteCommandLists](/windows/desktop/api/d3d12/nf-d3d12-id3d12commandqueue-executecommandlists) on the video command queue to submit the frame processing to the GPU.</span></span>


## <a name="tiers"></a><span data-ttu-id="75f83-179">Уровни</span><span class="sxs-lookup"><span data-stu-id="75f83-179">Tiers</span></span>

<span data-ttu-id="75f83-180">Видео Direct3D 12 определяет уровни, которые группируют возможности аппаратных устройств, чтобы у приложения было меньше путей кода для работы с различными аппаратными средствами.</span><span class="sxs-lookup"><span data-stu-id="75f83-180">Direct3D 12 video defines tiers that group the capabilities of hardware devices, so that the app can have fewer code paths to cater to the variety of hardware.</span></span> <span data-ttu-id="75f83-181">Уровни указываются с помощью перечисления [D3D12_VIDEO_DECODE_TIER](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_decode_tier) .</span><span class="sxs-lookup"><span data-stu-id="75f83-181">The tiers are specified with the [D3D12_VIDEO_DECODE_TIER](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_decode_tier) enumeration.</span></span>

<span data-ttu-id="75f83-182">На всех уровнях будут доступны следующие возможности:</span><span class="sxs-lookup"><span data-stu-id="75f83-182">In all the tiers, the following will be available:</span></span>

- <span data-ttu-id="75f83-183">Нет необходимости в воспроизведении декодера при изменениях разрешения.</span><span class="sxs-lookup"><span data-stu-id="75f83-183">No need for decoder recreation on resolution changes.</span></span> <span data-ttu-id="75f83-184">При изменении разрешения необходимо повторно создать только кучу декодера.</span><span class="sxs-lookup"><span data-stu-id="75f83-184">Only the decoder heap needs to be recreated on resolution change.</span></span>
- <span data-ttu-id="75f83-185">Все фреймы ссылок будут управляться приложением.</span><span class="sxs-lookup"><span data-stu-id="75f83-185">All reference frames will be managed by the app.</span></span> <span data-ttu-id="75f83-186">Это позволяет системе экономить память, поскольку нам не нужно выделять максимальное количество Дпбс на время создания декодера на некоторых уровнях и обеспечивает гибкость приложений в сценариях изменения разрешения.</span><span class="sxs-lookup"><span data-stu-id="75f83-186">This allows the system to save memory since we do not need to allocate the maximum number of DPBs at decoder creation time in some tiers, and gives apps flexibility in resolution changing scenarios.</span></span>

<span data-ttu-id="75f83-187">Обратите внимание, что уровни являются наборами.</span><span class="sxs-lookup"><span data-stu-id="75f83-187">Note that the tiers are supersets.</span></span> <span data-ttu-id="75f83-188">Приложение может принять решение об уровне 1 и не использовать функции более высокого уровня, которые являются допустимыми, но могут не предоставлять оптимальные производительности.</span><span class="sxs-lookup"><span data-stu-id="75f83-188">An app may decide to do tier 1, and not use the higher level features, which is allowed but may not provide optimal performace.</span></span> <span data-ttu-id="75f83-189">Дополнительные сведения о возможностях, связанных с различными уровнями уровней, см. в разделе [D3D12_VIDEO_DECODE_TIER](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_decode_tier).</span><span class="sxs-lookup"><span data-stu-id="75f83-189">For more information on the capabilities associated with different tier levels, see [D3D12_VIDEO_DECODE_TIER](/windows/desktop/api/d3d12video/ne-d3d12video-d3d12_video_decode_tier).</span></span>

## <a name="reference-frames"></a><span data-ttu-id="75f83-190">Опорные кадры</span><span class="sxs-lookup"><span data-stu-id="75f83-190">Reference frames</span></span>

<span data-ttu-id="75f83-191">В видеоролике Direct3D 12 ссылочные кадры передаются явным образом.</span><span class="sxs-lookup"><span data-stu-id="75f83-191">With Direct3D 12 video, reference frames are passed explicitly.</span></span> <span data-ttu-id="75f83-192">Это позволяет очищать использование массива текстур или массивов текстур при декодировании кадров.</span><span class="sxs-lookup"><span data-stu-id="75f83-192">This allows for clear usage of array of textures or texture arrays when we are decoding frames.</span></span> <span data-ttu-id="75f83-193">Приложению не обязательно передавать тот же самый маркер ресурса при использовании его в качестве ссылки; Например, можно скопировать один ресурс в другой, а затем передать копию вместо исходной.</span><span class="sxs-lookup"><span data-stu-id="75f83-193">The app is not required to pass the exact same resource handle when using it as a reference; it may, for instance, decide to copy one resource to another and then pass the copy instead of the original one.</span></span> <span data-ttu-id="75f83-194">Индексы ДКСВА *реффрамелист* и *куррпик* по-прежнему используются драйвером для хранения релевантных данных для каждого декодированного кадра.</span><span class="sxs-lookup"><span data-stu-id="75f83-194">The DXVA *RefFrameList* and *CurrPic* indices are still used by the driver to store relevant data for each decoded frame.</span></span>


## <a name="directx-12-fences"></a><span data-ttu-id="75f83-195">Ограждения DirectX 12</span><span class="sxs-lookup"><span data-stu-id="75f83-195">DirectX 12 fences</span></span>

<span data-ttu-id="75f83-196">В DirectX 12 приложение отвечает за синхронизацию доступа к своим буферам.</span><span class="sxs-lookup"><span data-stu-id="75f83-196">In DirectX 12, the app is responsible for synchronizing the access to their buffers.</span></span> <span data-ttu-id="75f83-197">В случае декодирования потребуется добавить ограждения во входные буферы и в выходные буферы.</span><span class="sxs-lookup"><span data-stu-id="75f83-197">For the decoding case, there will be the need for adding fences to the input buffers and to the output buffers.</span></span> <span data-ttu-id="75f83-198">С каждой ограждением связано значение и используются для синхронизации ПРОЦЕССОРов и аппаратных ядер.</span><span class="sxs-lookup"><span data-stu-id="75f83-198">Each fence has a value associated with it, and are used for synchronization of the CPU and the hardware engines.</span></span> <span data-ttu-id="75f83-199">Дополнительные сведения см. [в статье использование барьеров ресурсов для синхронизации состояний ресурсов в Direct3D 12](/windows/desktop/direct3d12/using-resource-barriers-to-synchronize-resource-states-in-direct3d-12).</span><span class="sxs-lookup"><span data-stu-id="75f83-199">For more information, see [Using Resource Barriers to Synchronize Resource States in Direct3D 12](/windows/desktop/direct3d12/using-resource-barriers-to-synchronize-resource-states-in-direct3d-12).</span></span>

<span data-ttu-id="75f83-200">Типичная реализация будет иметь ограждение для каждого входного буфера.</span><span class="sxs-lookup"><span data-stu-id="75f83-200">A typical implementation will have a fence for each input buffer.</span></span> <span data-ttu-id="75f83-201">В случае входных буферов возможно, что буфер может быть доступен до завершения всего процесса декодирования.</span><span class="sxs-lookup"><span data-stu-id="75f83-201">In the case of input buffers, it is possible that the buffer may be available before the whole decoding process is done.</span></span> <span data-ttu-id="75f83-202">Система игнорирует этот случай и предполагает, что входной буфер будет доступен при декодировании.</span><span class="sxs-lookup"><span data-stu-id="75f83-202">The system will ignore this case and assume that the input buffer is available when decoding is done.</span></span>
<span data-ttu-id="75f83-203">Реализация также обычно имеет ограждение для каждого выходного буфера.</span><span class="sxs-lookup"><span data-stu-id="75f83-203">An implementation will also usually have a fence for each output buffer.</span></span> <span data-ttu-id="75f83-204">Например, при отправке выходных данных в компоновщик требуется ограждение, сообщающее о том, что эта презентация в конечном итоге выполняется, указывая, что выходные данные снова доступны для декодера.</span><span class="sxs-lookup"><span data-stu-id="75f83-204">In the case of sending the output to the compositor, for instance, a fence is needed that is signaled when that presentation of that frame is finally done, indicating that the output is again available for the decoder.</span></span>


## <a name="related-topics"></a><span data-ttu-id="75f83-205">См. также</span><span class="sxs-lookup"><span data-stu-id="75f83-205">Related topics</span></span>

<dl> <span data-ttu-id="75f83-206"><dt>
[API-интерфейсы](direct3d-12-video-apis.md) 
 видео Direct3D 12 [Media Foundationое программное руководством](media-foundation-programming-guide.md)
</dt> </span><span class="sxs-lookup"><span data-stu-id="75f83-206"><dt>
[Direct3D 12 Video APIs](direct3d-12-video-apis.md)
[Media Foundation Programming Guide](media-foundation-programming-guide.md)
</dt> </span></span></dl>

 

 
