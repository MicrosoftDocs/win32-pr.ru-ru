---
description: Использование элементов управления "микшер видео"
ms.assetid: 475996c6-a205-4133-8882-f55beaf9f8fd
title: Использование элементов управления "микшер видео"
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0a8a062c6f984e0eac0128bd67c72bf691c95af6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104080567"
---
# <a name="using-the-video-mixer-controls"></a>Использование элементов управления "микшер видео"

Микшер Евр предоставляет несколько интерфейсов, которые приложение может использовать для управления процессом обработки видео микшера. Эти интерфейсы можно использовать либо в DirectShow, либо в Media Foundation.



| Интерфейс                                                      | Описание                                                                                                                                                                                                                                 |
|----------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Интерфейс [**имфвидеомиксербитмап**](/windows/desktop/api/evr9/nn-evr9-imfvideomixerbitmap)   | Альфа — смешение статического растрового изображения на видео.                                                                                                                                                                                          |
| Интерфейс [**имфвидеомиксерконтрол**](/windows/desktop/api/evr/nn-evr-imfvideomixercontrol) | Управляет тем, как Евр смешивает видео подпотоки.                                                                                                                                                                                                |
| Интерфейс [**имфвидеопроцессор**](/windows/desktop/api/evr9/nn-evr9-imfvideoprocessor)       | Управляет настройкой цвета, фильтрами изображений и другими возможностями обработки видео. Этот интерфейс предоставляет доступ к функциям, реализованным графическим драйвером, поэтому конкретные возможности будут зависеть от драйвера графического пользователя. |



 

Правильный способ получения указателей на эти интерфейсы зависит от того, используется ли версия DirectShow Евр или версия Media Foundation. Для Media Foundation Евр это также зависит от того, используется ли Евр напрямую или с помощью [сеанса мультимедиа](media-session.md). (Обычно приложение будет использовать Евр через сеанс мультимедиа, а не напрямую).

Чтобы получить указатель на любой из этих интерфейсов, выполните следующие действия.

1.  Получите указатель на интерфейс [**имфжетсервице**](/windows/desktop/api/mfidl/nn-mfidl-imfgetservice) в Евр.

    -   Если используется фильтр Евр DirectShow, вызовите **QueryInterface** в фильтре.

    -   Если вы используете приемник мультимедиа Евр напрямую, вызовите **QueryInterface** в приемнике мультимедиа.

    -   Если вы используете сеанс мультимедиа, вызовите **QueryInterface** в сеансе мультимедиа.

2.  Если вы используете сеанс мультимедиа, подождите, пока сеанс мультимедиа отправит событие [месессионтопологистатус](mesessiontopologystatus.md) со значением status, равным MF \_ топостатус \_ Ready. (Пропустите этот шаг, если сеанс мультимедиа не используется.)

3.  Вызовите [**имфжетсервице:: Get Service**](/windows/desktop/api/mfidl/nf-mfidl-imfgetservice-getservice) , чтобы получить интерфейс микшера. Используйте службу "идентификатор службы" MR \_ Video \_ микшера \_ .

## <a name="alpha-blending-a-bitmap-onto-the-video"></a>Альфа-смешение растрового изображения на видео

Вы можете использовать интерфейс [**имфвидеомиксербитмап**](/windows/desktop/api/evr9/nn-evr9-imfvideomixerbitmap) для альфа-смешения статического растрового изображения на видео во время воспроизведения. Точечный рисунок можно сохранить в области Direct3D, указанном как указатель **IDirect3DSurface9** , или использовать точечный рисунок GDI.

Если для точечного рисунка используется поверхность Direct3D, поверхность может содержать альфа-данные для каждого пикселя, которые будут использоваться, когда микшер альфа-смешение изображения. Кроме того, можно определить ключ цвета, т. е. один цвет, который будет прозрачным везде, где он отображается в точечном рисунке. Кроме того, можно указать альфа-значение, которое будет применено ко всему изображению. Можно также задать исходный прямоугольник для обрезки растрового изображения и прямоугольник назначения для размещения растрового изображения в кадре видео.

Чтобы задать точечный рисунок, вызовите метод [**имфвидеомиксербитмап:: сеталфабитмап**](/windows/desktop/api/evr9/nf-evr9-imfvideomixerbitmap-setalphabitmap). Этот метод принимает указатель на структуру [**мфвидеоалфабитмап**](/windows/desktop/api/evr9/ns-evr9-mfvideoalphabitmap) , указывающую точечный рисунок и параметры альфа-смешения. Пример кода см. в разделе справки по методу **сеталфабитмап** .

После установки точечного рисунка можно обновить параметры смешения, включая исходный и целевой реканглес, вызвав [**имфвидеомиксербитмап:: упдатеалфабитмаппараметерс**](/windows/desktop/api/evr9/nf-evr9-imfvideomixerbitmap-updatealphabitmapparameters). Обновление вступает в силу на следующем кадре видео. Чтобы обновление было выполнено, должно быть продолжено воспроизведение видео. Этот метод можно использовать для выполнения простых анимаций на точечном рисунке. (Если вам нужны более сложные эффекты, попробуйте написать пользовательский микшер Евр.)

Чтобы очистить точечный рисунок, вызовите метод [**имфвидеомиксербитмап:: клеаралфабитмап**](/windows/desktop/api/evr9/nf-evr9-imfvideomixerbitmap-clearalphabitmap).

## <a name="controlling-substreams"></a>Управление подпотоками

Евр может смешивать один или несколько подпотоков видео на основном видеопотоке. Для управления смешением подпотока используйте интерфейс [**имфвидеомиксерконтрол**](/windows/desktop/api/evr/nn-evr-imfvideomixercontrol) .

-   Вызовите метод [**имфвидеомиксерконтрол:: сетстреамаутпутрект**](/windows/desktop/api/evr/nf-evr-imfvideomixercontrol-setstreamoutputrect) , чтобы задать расположение вложенного потока в составном видеокадре.

-   Вызовите метод [**имфвидеомиксерконтрол:: сетстреамзордер**](/windows/desktop/api/evr/nf-evr-imfvideomixercontrol-setstreamzorder) , чтобы задать z-порядок для подпотоков. Евр рисует видеопотоки в порядке их значений z-порядка, начиная с нуля. Основной видеопоток всегда находится сначала в z-порядке.

## <a name="video-processor-settings"></a>Параметры обработчика видео

Микшер Евр использует ускорение видео DirectX (ДКСВА) для выполнения обработки видео во входных потоках. Точные возможности обработки зависят от драйвера графики. Возможности обработки видео описаны с помощью структуры [**DXVA2 \_ видеопроцессоркапс**](/windows/desktop/api/dxva2api/ns-dxva2api-dxva2_videoprocessorcaps) . Определенный набор возможностей называется *режимом обработки видео*, каждый из которых идентифицируется по идентификатору GUID. Список стандартных идентификаторов GUID см. в разделе [**идиректксвидеопроцессорсервице:: жетвидеопроцессордевицегуидс**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideoprocessorservice-getvideoprocessordeviceguids). Драйвер может определять дополнительные идентификаторы GUID, относящиеся к поставщику, которые представляют различные сочетания возможностей.

Чтобы найти поддерживаемые режимы и возможности каждого режима, выполните следующие действия.

1.  Вызовите [**имфжетсервице::-Service**](/windows/desktop/api/mfidl/nf-mfidl-imfgetservice-getservice) , чтобы получить указатель на интерфейс [**имфвидеопроцессор**](/windows/desktop/api/evr9/nn-evr9-imfvideoprocessor) микшера.

2.  Вызовите [**имфвидеопроцессор:: жетаваилаблевидеопроцессормодес**](/windows/desktop/api/evr9/nf-evr9-imfvideoprocessor-getavailablevideoprocessormodes). Этот метод возвращает массив идентификаторов GUID, которые идентифицируют доступные режимы видеопроцессора. Список возвращается в порядке убывания качества, режим с наивысшим качеством, отображаемый первым в списке. Список может изменяться в зависимости от формата видео.

3.  Для каждого идентификатора GUID в списке вызовите [**имфвидеопроцессор:: жетвидеопроцессоркапс**](/windows/desktop/api/evr9/nf-evr9-imfvideoprocessor-getvideoprocessorcaps) , чтобы найти возможности соответствующего режима видеопроцессора. Метод заполняет структуру [**DXVA2 \_ видеопроцессоркапс**](/windows/desktop/api/dxva2api/ns-dxva2api-dxva2_videoprocessorcaps) с помощью описания возможностей.

4.  Чтобы выбрать режим, вызовите метод [**имфвидеопроцессор:: сетвидеопроцессормоде**](/windows/desktop/api/evr9/nf-evr9-imfvideoprocessor-setvideoprocessormode). В противном случае Евр автоматически выбирает режим при запуске потоковой передачи. В этом случае можно вызвать метод [**имфвидеопроцессор:: жетвидеопроцессормоде**](/windows/desktop/api/evr9/nf-evr9-imfvideoprocessor-getvideoprocessormode) , чтобы найти выбранный режим.

Большая часть полей в структуре [**DXVA2 \_ видеопроцессоркапс**](/windows/desktop/api/dxva2api/ns-dxva2api-dxva2_videoprocessorcaps) описывает поведение драйвера низкого уровня и не представляет интереса в обычном приложении. Наиболее интересны следующие поля:

-   **Девицекапс**. Это поле указывает, выполняется ли обработка видео в аппаратном или программном обеспечении, а также является ли драйвер графики устаревшим драйвером ДКСВА 1,0.

-   **Деинтерлацетечнологи**. В этом поле приводятся некоторые сведения о том, какой уровень качества разряда можно рассчитывать, если исходное видео переводится в режим чередования.

-   **Прокампконтролкапс**. В этом поле указываются доступные элементы управления коррекцией цвета. Список возможных цветовых корректировок см. в разделе [Параметры параметра Camp](procamp-settings.md). Если драйвер не может выполнить настройку цвета, это поле будет равно нулю.

-   **Видеопроцессороператионс**. В этом поле содержатся флаги, описывающие различные возможности обработки видео. Два флага с определенной важностью — \_ флаг DXVA2 видеопроцесс \_ подпотоков и \_ флаг DXVA2 видеопроцесс \_ подпотоков. По крайней мере один из этих флагов должен присутствовать, если Евр будет смешивать подпотоки на видеопотоке ссылок. Если ни один из флагов не указан, ЕВР ограничивается одним видеопотоком.

-   **Ноисефилтертечнологи**. Это поле указывает, какие фильтры шума поддерживаются графическим драйвером. Если драйвер не поддерживает фильтрацию шума, значение DXVA2 \_ ноисефилтертеч не \_ поддерживается.

-   **Детаилфилтертечнологи**. Это поле показывает, какие фильтры детализации поддерживаются графическим драйвером. Если драйвер не поддерживает фильтрацию шума, значение DXVA2 \_ детаилфилтертеч не \_ поддерживается.

## <a name="color-adjustment-and-image-filtering"></a>Настройка цвета и фильтрация изображений

Графический драйвер может поддерживать настройку цвета (также называемую *усилением процесса* или *просто* проделать) и фильтрацию изображений. При выполнении с помощью GPU можно выполнять настройку цветов и фильтрацию изображений в режиме реального времени без дополнительной нагрузки на ЦП.

Чтобы использовать эти функции, выполните следующие действия.

1.  Выберите режим обработки видео, как описано в предыдущем разделе.

2.  Вызовите метод [**имфвидеопроцессор:: жетвидеопроцессоркапс**](/windows/desktop/api/evr9/nf-evr9-imfvideoprocessor-getvideoprocessorcaps) , чтобы найти возможности обработки видео, как описано в предыдущем разделе. Метод заполняет структуру [**DXVA2 \_ видеопроцессоркапс**](/windows/desktop/api/dxva2api/ns-dxva2api-dxva2_videoprocessorcaps) , которая описывает возможности, включая, поддерживает ли драйвер настройку цветов и фильтр изображений.

3.  Для каждой настройки цвета, поддерживаемой драйвером, вызовите [**имфвидеопроцессор:: жетпрокампранже**](/windows/desktop/api/evr9/nf-evr9-imfvideoprocessor-getprocamprange) , чтобы найти возможный диапазон значений для этого параметра. Этот метод также возвращает значение по умолчанию для параметра. Вызовите метод [**имфвидеопроцессор:: жетпрокампвалуес**](/windows/desktop/api/evr9/nf-evr9-imfvideoprocessor-getprocampvalues) , чтобы найти текущее значение параметров. Значения не имеют указанных единиц. Для определения диапазона значений используется драйвер.

4.  Вызовите метод [**имфвидеопроцессор:: сетфилтерингвалуе**](/windows/desktop/api/evr9/nf-evr9-imfvideoprocessor-setfilteringvalue) , чтобы задать значение коррекции цвета.

5.  Если драйвер поддерживает фильтрацию изображений, то каждый тип фильтра (шум и сведения) поддерживает три параметра: уровень, радиус и пороговое значение — в чрома и яркости. (См. раздел [Параметры фильтра изображений дксва](dxva-image-filter-settings.md).) Для каждого параметра вызовите [**имфвидеопроцессор:: жетфилтерингранже**](/windows/desktop/api/evr9/nf-evr9-imfvideoprocessor-getfilteringrange) , чтобы получить диапазон возможных значений, и вызовите [**Имфвидеопроцессор:: жетфилтерингвалуе**](/windows/desktop/api/evr9/nf-evr9-imfvideoprocessor-getfilteringvalue) , чтобы получить текущее значение.

6.  Чтобы изменить параметр фильтра изображений, вызовите [**имфвидеопроцессор:: сетфилтерингвалуе**](/windows/desktop/api/evr9/nf-evr9-imfvideoprocessor-setfilteringvalue).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Улучшенный модуль подготовки видео](enhanced-video-renderer.md)
</dt> </dl>

 

 



