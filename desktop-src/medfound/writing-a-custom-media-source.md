---
description: В этом разделе описано, как реализовать пользовательский источник мультимедиа в Microsoft Media Foundation.
ms.assetid: 82db6f32-ad94-4563-b8bd-8a5072c5b221
title: Запись пользовательского источника мультимедиа
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8769fa16d4dcbfd3438b66f9a9e78c34274735a5
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "105703469"
---
# <a name="writing-a-custom-media-source"></a><span data-ttu-id="a9c2d-103">Запись пользовательского источника мультимедиа</span><span class="sxs-lookup"><span data-stu-id="a9c2d-103">Writing a Custom Media Source</span></span>

<span data-ttu-id="a9c2d-104">В этом разделе описано, как реализовать пользовательский источник мультимедиа в Microsoft Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-104">This topic describes how to implement a custom media source in Microsoft Media Foundation.</span></span> <span data-ttu-id="a9c2d-105">Он содержит следующие подразделы:</span><span class="sxs-lookup"><span data-stu-id="a9c2d-105">It contains the following sections:</span></span>

-   [<span data-ttu-id="a9c2d-106">Создание дескриптора презентации</span><span class="sxs-lookup"><span data-stu-id="a9c2d-106">Creating the Presentation Descriptor</span></span>](#creating-the-presentation-descriptor)
-   [<span data-ttu-id="a9c2d-107">Запуск источника мультимедиа</span><span class="sxs-lookup"><span data-stu-id="a9c2d-107">Starting the Media Source</span></span>](#starting-the-media-source)
    -   [<span data-ttu-id="a9c2d-108">Нужна</span><span class="sxs-lookup"><span data-stu-id="a9c2d-108">Seeking</span></span>](#seeking)
-   [<span data-ttu-id="a9c2d-109">Приостановка источника мультимедиа</span><span class="sxs-lookup"><span data-stu-id="a9c2d-109">Pausing the Media Source</span></span>](#pausing-the-media-source)
-   [<span data-ttu-id="a9c2d-110">Создание исходных данных</span><span class="sxs-lookup"><span data-stu-id="a9c2d-110">Generating Source Data</span></span>](#generating-source-data)
    -   [<span data-ttu-id="a9c2d-111">Примеры запросов</span><span class="sxs-lookup"><span data-stu-id="a9c2d-111">Sample Requests</span></span>](#sample-requests)
    -   [<span data-ttu-id="a9c2d-112">Выделение выборок</span><span class="sxs-lookup"><span data-stu-id="a9c2d-112">Allocating Samples</span></span>](#allocating-samples)
    -   [<span data-ttu-id="a9c2d-113">Пробелы в потоке</span><span class="sxs-lookup"><span data-stu-id="a9c2d-113">Gaps in the Stream</span></span>](#gaps-in-the-stream)
-   [<span data-ttu-id="a9c2d-114">Завершение работы источника мультимедиа</span><span class="sxs-lookup"><span data-stu-id="a9c2d-114">Shutting Down the Media Source</span></span>](#shutting-down-the-media-source)
-   [<span data-ttu-id="a9c2d-115">Активные источники</span><span class="sxs-lookup"><span data-stu-id="a9c2d-115">Live Sources</span></span>](#live-sources)
-   [<span data-ttu-id="a9c2d-116">См. также</span><span class="sxs-lookup"><span data-stu-id="a9c2d-116">Related topics</span></span>](#related-topics)

## <a name="creating-the-presentation-descriptor"></a><span data-ttu-id="a9c2d-117">Создание дескриптора презентации</span><span class="sxs-lookup"><span data-stu-id="a9c2d-117">Creating the Presentation Descriptor</span></span>

<span data-ttu-id="a9c2d-118">Метод [**имфмедиасаурце:: креатепресентатиондескриптор**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) возвращает копию дескриптора представления источника.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-118">The [**IMFMediaSource::CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) method returns a copy of the source's presentation descriptor.</span></span> <span data-ttu-id="a9c2d-119">Чтобы создать дескриптор представления, необходимо выяснить число потоков в исходном содержимом и возможные форматы каждого потока.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-119">To create the presentation descriptor, you must know the number of streams in the source content, and the possible formats of each stream.</span></span> <span data-ttu-id="a9c2d-120">Для каждого потока создайте дескриптор потока следующим образом:</span><span class="sxs-lookup"><span data-stu-id="a9c2d-120">For each stream, create a stream descriptor as follows:</span></span>

1.  <span data-ttu-id="a9c2d-121">Создайте массив типов мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-121">Create an array of media types.</span></span> <span data-ttu-id="a9c2d-122">Каждый тип носителя в массиве представляет возможный формат для потока.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-122">Each media type in the array represents a possible format for the stream.</span></span> <span data-ttu-id="a9c2d-123">Дополнительные сведения о создании типов носителей см. в разделе [типы носителей](media-types.md).</span><span class="sxs-lookup"><span data-stu-id="a9c2d-123">For more information about creating media types, see [Media Types](media-types.md).</span></span>
2.  <span data-ttu-id="a9c2d-124">Вызовите [**мфкреатестреамдескриптор**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatestreamdescriptor) , чтобы создать дескриптор потока.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-124">Call [**MFCreateStreamDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatestreamdescriptor) to create the stream descriptor.</span></span> <span data-ttu-id="a9c2d-125">Передайте массив типов мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-125">Pass in the array of media types.</span></span> <span data-ttu-id="a9c2d-126">Функция возвращает указатель [**имфстреамдескриптор**](/windows/desktop/api/mfidl/nn-mfidl-imfstreamdescriptor) .</span><span class="sxs-lookup"><span data-stu-id="a9c2d-126">The function returns an [**IMFStreamDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfstreamdescriptor) pointer.</span></span>
3.  <span data-ttu-id="a9c2d-127">Вызовите метод [**имфстреамдескриптор:: жетмедиатипехандлер**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getmediatypehandler) , чтобы получить обработчик типа мультимедиа дескриптора потока.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-127">Call [**IMFStreamDescriptor::GetMediaTypeHandler**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getmediatypehandler) to get the stream descriptor's media type handler.</span></span>
4.  <span data-ttu-id="a9c2d-128">Вызовите метод [**имфмедиатипехандлер:: сеткуррентмедиатипе**](/windows/desktop/api/mfidl/nf-mfidl-imfmediatypehandler-setcurrentmediatype) , чтобы задать формат потока по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-128">Call [**IMFMediaTypeHandler::SetCurrentMediaType**](/windows/desktop/api/mfidl/nf-mfidl-imfmediatypehandler-setcurrentmediatype) to set the default stream format.</span></span> <span data-ttu-id="a9c2d-129">Используйте один из типов носителей, созданный на шаге 1.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-129">Use one of the media types that you created in step 1.</span></span> <span data-ttu-id="a9c2d-130">Как правило, следует использовать формат с самым высоким качеством.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-130">Generally, you should use the format with the highest quality.</span></span>
5.  <span data-ttu-id="a9c2d-131">При необходимости задайте атрибуты для дескриптора потока.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-131">Optionally, set attributes on the stream descriptor.</span></span> <span data-ttu-id="a9c2d-132">Список атрибутов, применяемых к дескрипторам потоков, см. в разделе [атрибуты дескриптора потока](stream-descriptor-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="a9c2d-132">For a list of attributes that apply to stream descriptors, see [Stream Descriptor Attributes](stream-descriptor-attributes.md).</span></span>

<span data-ttu-id="a9c2d-133">Теперь создайте дескриптор презентации:</span><span class="sxs-lookup"><span data-stu-id="a9c2d-133">Now create the presentation descriptor:</span></span>

1.  <span data-ttu-id="a9c2d-134">Вызовите [**мфкреатепресентатиондескриптор**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationdescriptor) и передайте массив дескрипторов потока.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-134">Call [**MFCreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationdescriptor) and pass in the array of stream descriptors.</span></span> <span data-ttu-id="a9c2d-135">Функция возвращает указатель [**имфпресентатиондескриптор**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationdescriptor) .</span><span class="sxs-lookup"><span data-stu-id="a9c2d-135">The function returns an [**IMFPresentationDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationdescriptor) pointer.</span></span>
2.  <span data-ttu-id="a9c2d-136">Выберите Выбор потока по умолчанию, вызвав [**имфпресентатиондескриптор:: селектстреам**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-selectstream) , чтобы выбрать один или несколько потоков.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-136">Choose the default stream selection by calling [**IMFPresentationDescriptor::SelectStream**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-selectstream) to select one or more streams.</span></span> <span data-ttu-id="a9c2d-137">В конфигурации по умолчанию должен быть выбран хотя бы один поток.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-137">At least one stream must be selected in the default configuration.</span></span>
3.  <span data-ttu-id="a9c2d-138">При необходимости задайте атрибуты для дескриптора презентации.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-138">Optionally, set attributes on the presentation descriptor.</span></span> <span data-ttu-id="a9c2d-139">Список атрибутов, применяемых к дескрипторам потоков, см. в разделе [атрибуты дескриптора представления](presentation-descriptor-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="a9c2d-139">For a list of attributes that apply to stream descriptors, see [Presentation Descriptor Attributes](presentation-descriptor-attributes.md).</span></span>

<span data-ttu-id="a9c2d-140">Вы должны создать дескриптор представления один раз: при запуске или после того, как источник анализирует достаточное количество исходных данных для определения содержимого.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-140">You should create the presentation descriptor once, either at startup or after the source has parsed enough of the source data to determine the contents.</span></span> <span data-ttu-id="a9c2d-141">Метод [**креатепресентатиондескриптор**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) должен возвращать копию дескриптора презентации.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-141">The [**CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) method should return a copy of presentation descriptor.</span></span> <span data-ttu-id="a9c2d-142">Чтобы создать копию, вызовите [**имфпресентатиондескриптор:: Clone**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-clone).</span><span class="sxs-lookup"><span data-stu-id="a9c2d-142">To create the copy, call [**IMFPresentationDescriptor::Clone**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-clone).</span></span> <span data-ttu-id="a9c2d-143">Возврат копии не дает клиенту изменять состояние исходного дескриптора презентации, например атрибуты или выбор потока.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-143">Returning a copy prevents the client from modifying the state of the original presentation descriptor, such as the attributes or the stream selection.</span></span> <span data-ttu-id="a9c2d-144">Однако следует иметь в виду, что **клон** создает неполную копию, поэтому клиент потенциально может изменять базовые дескрипторы потока.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-144">However, be aware that **Clone** creates a shallow copy, so the client can potentially modify the underlying stream descriptors.</span></span>

## <a name="starting-the-media-source"></a><span data-ttu-id="a9c2d-145">Запуск источника мультимедиа</span><span class="sxs-lookup"><span data-stu-id="a9c2d-145">Starting the Media Source</span></span>

<span data-ttu-id="a9c2d-146">Метод [**имфмедиасаурце:: Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) запускает источник мультимедиа или выполняет поиск новой позицией.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-146">The [**IMFMediaSource::Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method starts the media source or seeks to a new position.</span></span> <span data-ttu-id="a9c2d-147">Вызов метода **Start** вызывает *Поиск* , когда предыдущее состояние было приостановлено или запущено, и указано новое время начала.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-147">A call to **Start** causes a *seek* when the previous state was either paused or running, and a new start time is specified.</span></span> <span data-ttu-id="a9c2d-148">В противном случае метод **Start** вызывает *Запуск*.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-148">Otherwise, the **Start** method causes a *start*.</span></span> <span data-ttu-id="a9c2d-149">После завершения операции **запуска** отправьте следующие события.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-149">When the **Start** operation completes, send the following events.</span></span>

1.  <span data-ttu-id="a9c2d-150">Отправка события [меневстреам](menewstream.md) для каждого нового потока, то есть каждого потока, который был выбран ранее, и теперь выбирается.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-150">Send an [MENewStream](menewstream.md) event for each new stream—that is, each stream that was previously deselected and is now selected.</span></span> <span data-ttu-id="a9c2d-151">Данные события являются указателем на поток.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-151">The event data is a pointer to the stream.</span></span>
2.  <span data-ttu-id="a9c2d-152">Отправляет событие [меупдатедстреам](meupdatedstream.md) для каждого ранее выбранного потока, который по-прежнему выбран.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-152">Send an [MEUpdatedStream](meupdatedstream.md) event for each stream that was previously selected and is still selected.</span></span> <span data-ttu-id="a9c2d-153">Данные события являются указателем на поток.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-153">The event data is a pointer to the stream.</span></span> <span data-ttu-id="a9c2d-154">(Не отправляйте событие для невыбранных потоков.)</span><span class="sxs-lookup"><span data-stu-id="a9c2d-154">(Do not send an event for deselected streams.)</span></span>
3.  <span data-ttu-id="a9c2d-155">Если источник ищется, отправьте событие [месаурцесикед](mesourceseeked.md) .</span><span class="sxs-lookup"><span data-stu-id="a9c2d-155">If the source is seeking, send an [MESourceSeeked](mesourceseeked.md) event.</span></span> <span data-ttu-id="a9c2d-156">В противном случае отправьте событие [месаурцестартед](mesourcestarted.md) .</span><span class="sxs-lookup"><span data-stu-id="a9c2d-156">Otherwise, send an [MESourceStarted](mesourcestarted.md) event.</span></span> <span data-ttu-id="a9c2d-157">Данные события — это время начала, указанное в методе [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) .</span><span class="sxs-lookup"><span data-stu-id="a9c2d-157">The event data is the start time that was specified in the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method.</span></span> <span data-ttu-id="a9c2d-158">Для события Месаурцестартед, если время начала равно VT \_ , установите атрибут " [**\_ Источник события MF" \_ \_ фактического \_ запуска**](mf-event-source-actual-start-attribute.md) для события.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-158">For the MESourceStarted event, if the start time is VT\_EMPTY, set the [**MF\_EVENT\_SOURCE\_ACTUAL\_START**](mf-event-source-actual-start-attribute.md) attribute on the event.</span></span> <span data-ttu-id="a9c2d-159">Значение атрибута — это фактическое время начала.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-159">The attribute value is the actual start time.</span></span>
4.  <span data-ttu-id="a9c2d-160">Для каждого потока, если источник ищется, отправьте событие [местреамсикед](mestreamseeked.md) .</span><span class="sxs-lookup"><span data-stu-id="a9c2d-160">For each stream, if the source is seeking, send an [MEStreamSeeked](mestreamseeked.md) event.</span></span> <span data-ttu-id="a9c2d-161">В противном случае отправьте событие [местреамстартед](mestreamstarted.md) .</span><span class="sxs-lookup"><span data-stu-id="a9c2d-161">Otherwise, send an [MEStreamStarted](mestreamstarted.md) event.</span></span> <span data-ttu-id="a9c2d-162">Данные события — это время начала.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-162">The event data is the start time.</span></span> <span data-ttu-id="a9c2d-163">(Источник мультимедиа может поставить в очередь событие в потоке, вызвав метод [**имфмедиаевентженератор:: куеуивент**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-queueevent) потока.)</span><span class="sxs-lookup"><span data-stu-id="a9c2d-163">(The media source can queue an event on the stream by calling the stream's [**IMFMediaEventGenerator::QueueEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-queueevent) method.)</span></span>

<span data-ttu-id="a9c2d-164">Когда поток не выбран, завершите работу потока.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-164">When a stream is deselected, shut down the stream.</span></span> <span data-ttu-id="a9c2d-165">В этом месте поток не должен ставить в очередь больше событий.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-165">The stream should not queue any more events at that point.</span></span>

<span data-ttu-id="a9c2d-166">Формат времени для метода [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) указывается в параметре *пгуидтимеформат* .</span><span class="sxs-lookup"><span data-stu-id="a9c2d-166">The time format for the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method is given in the *pguidTimeFormat* parameter.</span></span> <span data-ttu-id="a9c2d-167">Стандартный формат времени, обозначенный **GUID \_ null**, равен 100-наносекундных единицам.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-167">The standard time format, indicated by **GUID\_NULL**, is 100-nanosecond units.</span></span> <span data-ttu-id="a9c2d-168">Источник мультимедиа должен поддерживать этот формат времени.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-168">A media source must support this time format.</span></span>

### <a name="seeking"></a><span data-ttu-id="a9c2d-169">Нужна</span><span class="sxs-lookup"><span data-stu-id="a9c2d-169">Seeking</span></span>

<span data-ttu-id="a9c2d-170">При поиске запрошенное начальное расположение может не попадать в точную границу выборки.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-170">When seeking, the requested start position might not fall on an exact sample boundary.</span></span> <span data-ttu-id="a9c2d-171">Кроме того, для сжатого содержимого начальное расположение может находиться между опорными кадрами.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-171">Also, for compressed content, the start position might fall between key frames.</span></span> <span data-ttu-id="a9c2d-172">Поток должен доставлять образцы из самой ранней точки, необходимой для создания несжатого образца в запрошенной начальной позиции.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-172">A stream should deliver samples from the earliest point needed to produce an uncompressed sample at the requested start position.</span></span> <span data-ttu-id="a9c2d-173">Для видео это означает, что начинается с предыдущего ключевого кадра.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-173">For video, that means starting from the previous key frame.</span></span> <span data-ttu-id="a9c2d-174">Конвейер отвечает за удаление дополнительных кадров из декодера, чтобы воспроизведение начиналось в запрошенное время.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-174">The pipeline is responsible for dropping the extra frames from the decoder, so that playback starts at the requested time.</span></span>

<span data-ttu-id="a9c2d-175">Время начала, заданное в исходных событиях ([месаурцестартед](mesourcestarted.md), [месаурцесикед](mesourceseeked.md), [местреамстартед](mestreamstarted.md)и [местреамсикед](mestreamseeked.md)), является запрошенным временем начала (значение, заданное в методе [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) ), независимо от фактической начальной точки.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-175">The starting time given in the source events ([MESourceStarted](mesourcestarted.md), [MESourceSeeked](mesourceseeked.md), [MEStreamStarted](mestreamstarted.md), and [MEStreamSeeked](mestreamseeked.md)) is the requested starting time (the value given in the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method), regardless of the actual start position.</span></span>

<span data-ttu-id="a9c2d-176">Например, предположим, что первые несколько кадров потока видео имеют следующие характеристики:</span><span class="sxs-lookup"><span data-stu-id="a9c2d-176">For example, suppose the first few frames of a video stream have the following characteristics:</span></span>



| <span data-ttu-id="a9c2d-177">Образец</span><span class="sxs-lookup"><span data-stu-id="a9c2d-177">Sample</span></span>     | <span data-ttu-id="a9c2d-178">1</span><span class="sxs-lookup"><span data-stu-id="a9c2d-178">1</span></span>       | <span data-ttu-id="a9c2d-179">2</span><span class="sxs-lookup"><span data-stu-id="a9c2d-179">2</span></span>       | <span data-ttu-id="a9c2d-180">3</span><span class="sxs-lookup"><span data-stu-id="a9c2d-180">3</span></span>        | <span data-ttu-id="a9c2d-181">4</span><span class="sxs-lookup"><span data-stu-id="a9c2d-181">4</span></span>        |
|------------|---------|---------|----------|----------|
| <span data-ttu-id="a9c2d-182">Time</span><span class="sxs-lookup"><span data-stu-id="a9c2d-182">Time</span></span>       | <span data-ttu-id="a9c2d-183">33 МС</span><span class="sxs-lookup"><span data-stu-id="a9c2d-183">33 msec</span></span> | <span data-ttu-id="a9c2d-184">66 МС</span><span class="sxs-lookup"><span data-stu-id="a9c2d-184">66 msec</span></span> | <span data-ttu-id="a9c2d-185">100 мс</span><span class="sxs-lookup"><span data-stu-id="a9c2d-185">100 msec</span></span> | <span data-ttu-id="a9c2d-186">133 МС</span><span class="sxs-lookup"><span data-stu-id="a9c2d-186">133 msec</span></span> |
| <span data-ttu-id="a9c2d-187">Ключевой кадр?</span><span class="sxs-lookup"><span data-stu-id="a9c2d-187">Key frame?</span></span> | <span data-ttu-id="a9c2d-188">Да</span><span class="sxs-lookup"><span data-stu-id="a9c2d-188">Yes</span></span>     | <span data-ttu-id="a9c2d-189">Нет</span><span class="sxs-lookup"><span data-stu-id="a9c2d-189">No</span></span>      | <span data-ttu-id="a9c2d-190">Нет</span><span class="sxs-lookup"><span data-stu-id="a9c2d-190">No</span></span>       | <span data-ttu-id="a9c2d-191">Да</span><span class="sxs-lookup"><span data-stu-id="a9c2d-191">Yes</span></span>      |



 

<span data-ttu-id="a9c2d-192">Если метод [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) вызывается со значением 100 миллисекунд, то источнику необходимо выводить видео, начиная с кадра 1, первого ключевого кадра до этого времени.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-192">If the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method is called with a value of 100 milliseconds, the source needs to output video starting from frame 1, the first key frame prior to this time.</span></span> <span data-ttu-id="a9c2d-193">Событие Start по-прежнему будет указывать в данных события 100 миллисекунд.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-193">The start event will still indicate 100 milliseconds in the event data.</span></span>

## <a name="pausing-the-media-source"></a><span data-ttu-id="a9c2d-194">Приостановка источника мультимедиа</span><span class="sxs-lookup"><span data-stu-id="a9c2d-194">Pausing the Media Source</span></span>

<span data-ttu-id="a9c2d-195">Метод [**имфмедиасаурце::P Аусе**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) приостанавливает источник мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-195">The [**IMFMediaSource::Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) method pauses the media source.</span></span>

<span data-ttu-id="a9c2d-196">Пока источник приостановлен, поток может создавать новые примеры и сохранять их в очереди, но поток не доставляет образцы.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-196">While the source is paused, a stream can create new samples and store them on a queue, but the stream does not deliver the samples.</span></span> <span data-ttu-id="a9c2d-197">Ниже приведены некоторые исключения из этого правила.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-197">Here are some exceptions to this rule:</span></span>

-   <span data-ttu-id="a9c2d-198">В активных источниках следует удалять данные при приостановке.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-198">Live sources should drop data while paused.</span></span>
-   <span data-ttu-id="a9c2d-199">Если источник получает данные из сети, он может приостановить работу сервера.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-199">If the source gets data from a network, it might pause the server.</span></span>

<span data-ttu-id="a9c2d-200">Если клиент вызывает [**имфмедиастреам:: рекуестсампле**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) во время приостановки источника, запрос также помещается в очередь до тех пор, пока источник не будет запущен снова.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-200">If the client calls [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) while the source is paused, the request is also queued until the source is started again.</span></span> <span data-ttu-id="a9c2d-201">Запросы не должны удаляться.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-201">Requests should not be dropped.</span></span>

<span data-ttu-id="a9c2d-202">Приостановка может выполняться только в состоянии запуска.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-202">Pausing is allowed only from the started state.</span></span> <span data-ttu-id="a9c2d-203">В противном случае [**приостановка**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) должна возвращать **MF \_ E \_ Недопустимый \_ \_ переход состояния**.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-203">Otherwise, [**Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) should return **MF\_E\_INVALID\_STATE\_TRANSITION**.</span></span>

## <a name="generating-source-data"></a><span data-ttu-id="a9c2d-204">Создание исходных данных</span><span class="sxs-lookup"><span data-stu-id="a9c2d-204">Generating Source Data</span></span>

<span data-ttu-id="a9c2d-205">Media Foundation использует *модель извлечения*, то есть потоки создают и доставляют образцы в ответ на запросы из конвейера.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-205">Media Foundation uses a *pull model*, meaning that streams generate and deliver samples in response to requests from the pipeline.</span></span> <span data-ttu-id="a9c2d-206">Поток может доставлять образцы при выполнении источника мультимедиа и выборе потока.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-206">A stream can deliver samples when the media source is running and the stream is selected.</span></span> <span data-ttu-id="a9c2d-207">Поток доставляет данные только в том случае, если клиент запрашивает новый пример.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-207">A stream delivers data only when the client requests a new sample.</span></span>

### <a name="sample-requests"></a><span data-ttu-id="a9c2d-208">Образец запросов</span><span class="sxs-lookup"><span data-stu-id="a9c2d-208">Sample Requests</span></span>

<span data-ttu-id="a9c2d-209">Клиент запрашивает новый пример, вызывая [**имфмедиастреам:: рекуестсампле**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span><span class="sxs-lookup"><span data-stu-id="a9c2d-209">The client requests a new sample by calling [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span> <span data-ttu-id="a9c2d-210">Ниже приведена последовательность операций.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-210">Here is the sequence of operations:</span></span>

1.  <span data-ttu-id="a9c2d-211">Клиент вызывает [**имфмедиастреам:: рекуестсампле**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span><span class="sxs-lookup"><span data-stu-id="a9c2d-211">The client calls [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span> <span data-ttu-id="a9c2d-212">Аргумент — это указатель на необязательный объект *Token* , который клиент использует для отслеживания запроса.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-212">The argument is a pointer to an optional *token* object that the client uses to track the request.</span></span> <span data-ttu-id="a9c2d-213">Клиент реализует токен.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-213">The client implements the token.</span></span> <span data-ttu-id="a9c2d-214">Токены должны предоставлять интерфейс **IUnknown** .</span><span class="sxs-lookup"><span data-stu-id="a9c2d-214">Tokens must expose the **IUnknown** interface.</span></span> <span data-ttu-id="a9c2d-215">Клиент также может передать указатель NULL вместо токена.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-215">The client can also pass in a NULL pointer instead of a token.</span></span>
2.  <span data-ttu-id="a9c2d-216">Если клиент предоставил маркер, поток мультимедиа вызывает **AddRef** для маркера и помещает маркер в очередь по первому попервому поверху.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-216">If the client provided a token, the media stream calls **AddRef** on the token and places the token in a first-in, first-out queue.</span></span> <span data-ttu-id="a9c2d-217">Метод возвращает, а оставшиеся шаги выполняются асинхронно.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-217">The method returns, and the remaining steps occur asynchronously.</span></span>

3.  <span data-ttu-id="a9c2d-218">Если доступны дополнительные данные, поток мультимедиа создает новый пример.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-218">When more data is available, the media stream creates a new sample.</span></span> <span data-ttu-id="a9c2d-219">(Этот шаг подробно описан в следующем разделе.)</span><span class="sxs-lookup"><span data-stu-id="a9c2d-219">(This step is described in more detail in the next section.)</span></span>
4.  <span data-ttu-id="a9c2d-220">Поток мультимедиа извлекает первый токен из очереди.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-220">The media stream pulls the first token from the queue.</span></span>
5.  <span data-ttu-id="a9c2d-221">Если токен не равен **null**, поток мультимедиа задает атрибут [**\_ токена мфсампликстенсион**](mfsampleextension-token-attribute.md) в образце носителя.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-221">If the token is not **NULL**, the media stream sets the [**MFSampleExtension\_Token**](mfsampleextension-token-attribute.md) attribute on the media sample.</span></span> <span data-ttu-id="a9c2d-222">Значение атрибута является указателем на маркер.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-222">The value of the attribute is a pointer to the token.</span></span>
6.  <span data-ttu-id="a9c2d-223">Поток мультимедиа отправляет событие [мемедиасампле](memediasample.md) .</span><span class="sxs-lookup"><span data-stu-id="a9c2d-223">The media stream sends an [MEMediaSample](memediasample.md) event.</span></span> <span data-ttu-id="a9c2d-224">Данные события являются указателем на интерфейс [**имфсампле**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) образца.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-224">The event data is a pointer to the sample's [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) interface.</span></span>
7.  <span data-ttu-id="a9c2d-225">Если клиент предоставил маркер, поток мультимедиа вызывает метод **Release** для объекта Token.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-225">If the client provided a token, the media stream calls **Release** on the token object.</span></span>

<span data-ttu-id="a9c2d-226">Если поток мультимедиа не может выполнить запрос [**рекуестсампле**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) клиента, он извлекает маркер из очереди и вызывает **выпуск** для маркера, но не отправляет событие [мемедиасампле](memediasample.md) .</span><span class="sxs-lookup"><span data-stu-id="a9c2d-226">If the media stream cannot fulfill the client's [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) request, it pulls the token from the queue and calls **Release** on the token, but does not send an [MEMediaSample](memediasample.md) event.</span></span>

<span data-ttu-id="a9c2d-227">Клиент может использовать маркер для наблюдения за состоянием запроса.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-227">The client can use the token to track the status of the request.</span></span> <span data-ttu-id="a9c2d-228">Когда клиент получает событие [мемедиасампле](memediasample.md) , он может получить маркер из примера и сопоставить его с исходным запросом.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-228">When the client receives the [MEMediaSample](memediasample.md) event, it can get the token from the sample and match it against the original request.</span></span> <span data-ttu-id="a9c2d-229">Клиент также может использовать токен для определения, удалил ли источник мультимедиа запрос.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-229">The client can also use the token to detect if the media source dropped the request.</span></span> <span data-ttu-id="a9c2d-230">Если счетчик ссылок маркера становится равным нулю, а поток мультимедиа не отправляет событие Мемедиасампле, это означает, что запрос был удален.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-230">If the token's reference count falls to zero and the media stream does not send an MEMediaSample event, it means that the request was dropped.</span></span>

<span data-ttu-id="a9c2d-231">В описанных здесь действиях предполагается, что метод [**рекуестсампле**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) реализован как асинхронная операция.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-231">The steps listed here assume that [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) method is implemented as an asynchronous operation.</span></span> <span data-ttu-id="a9c2d-232">Если метод является синхронным, то не нужно помещаться в очередь маркера запроса.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-232">If the method is synchronous, you do not need to put the request token on a queue.</span></span> <span data-ttu-id="a9c2d-233">Однако если создание данных занимает значительное время, рекомендуется асинхронный подход, например, если источник считывает данные из байтового потока.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-233">However, if generating data takes any significant amount of time, an asynchronous approach is recommended—for example, if the source reads data from a byte stream.</span></span>

<span data-ttu-id="a9c2d-234">Поток отвечает за буферизацию всех данных, которые накапливаются между вызовами [**рекуестсампле**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span><span class="sxs-lookup"><span data-stu-id="a9c2d-234">The stream is responsible for buffering any data that accumulates between calls to [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span>

<span data-ttu-id="a9c2d-235">Когда поток мультимедиа достигает конца потока, он отправляет событие [миндофстреам](meendofstream.md) после последней выборки.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-235">When the media stream reaches the end of the stream, it sends an [MEEndOfStream](meendofstream.md) event after the last sample.</span></span> <span data-ttu-id="a9c2d-236">После завершения каждого потока источник мультимедиа отправляет событие [миндофпресентатион](meendofpresentation.md) .</span><span class="sxs-lookup"><span data-stu-id="a9c2d-236">After every stream has ended, the media source sends an [MEEndOfPresentation](meendofpresentation.md) event.</span></span> <span data-ttu-id="a9c2d-237">После того как поток мультимедиа отправит событие Миндофстреам, метод [**рекуестсампле**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) возвращает **MF- \_ е \_ конец \_ \_ потока** до перезапуска источника.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-237">After a media stream sends the MEEndOfStream event, the [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) method returns **MF\_E\_END\_OF\_STREAM** until the source is restarted.</span></span>

### <a name="allocating-samples"></a><span data-ttu-id="a9c2d-238">Выделение выборок</span><span class="sxs-lookup"><span data-stu-id="a9c2d-238">Allocating Samples</span></span>

<span data-ttu-id="a9c2d-239">Когда поток готов к заполнению ожидающего запроса образца, он создает новый пример и добавляет в образец один или несколько буферов мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-239">When the stream is ready to fill a pending sample request, it creates a new sample and adds one or more media buffers to the sample.</span></span> <span data-ttu-id="a9c2d-240">Дополнительные сведения о создании буферов мультимедиа см. в разделе [буферы мультимедиа](media-buffers.md).</span><span class="sxs-lookup"><span data-stu-id="a9c2d-240">For more information about creating media buffers, see [Media Buffers](media-buffers.md).</span></span>

<span data-ttu-id="a9c2d-241">Поток должен задать отметку времени и длительность, если она известна.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-241">The stream must set the time stamp and the duration, if known.</span></span> <span data-ttu-id="a9c2d-242">Метка времени относится к источнику.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-242">The time stamp is relative to the source.</span></span> <span data-ttu-id="a9c2d-243">В большинстве случаев начало содержимого соответствует отметке времени, равной нулю.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-243">In most cases, the start of the content corresponds to a time stamp of zero.</span></span> <span data-ttu-id="a9c2d-244">Например, если источник считывает данные из файла мультимедиа, то начало файла будет иметь отметку времени, равную нулю.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-244">For example, if the source reads from a media file, the start of the file would have a time stamp of zero.</span></span>

<span data-ttu-id="a9c2d-245">Метка времени в образце не обязательно равна времени презентации.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-245">The time stamp on the sample does not necessarily equal the presentation time.</span></span> <span data-ttu-id="a9c2d-246">Сеанс мультимедиа преобразуется из исходного времени в время представления.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-246">The Media Session translates from source time to presentation time.</span></span> <span data-ttu-id="a9c2d-247">Для сжатых данных поток должен создать данные, начиная с ближайшего ключевого кадра до времени начала.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-247">For compressed data, the stream should generate data starting from the nearest key frame before the start time.</span></span> <span data-ttu-id="a9c2d-248">Это позволяет декодеру доставлять фрейм, отображаемый в запрошенном времени начала.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-248">This enables the decoder to deliver the frame that appears at the requested start time.</span></span> <span data-ttu-id="a9c2d-249">(В противном случае декодеру придется дождаться следующего ключевого кадра.)</span><span class="sxs-lookup"><span data-stu-id="a9c2d-249">(Otherwise, the decoder would need to wait until the following key frame.)</span></span>

<span data-ttu-id="a9c2d-250">Если скорость воспроизведения выше, чем 1,0, то в конвейере корректируется частота часов представления.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-250">If the playback rate is faster or slower than 1.0, the pipeline adjusts the rate of the presentation clock.</span></span> <span data-ttu-id="a9c2d-251">Источник не корректирует отметки времени для выборок.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-251">The source does not adjust the time stamps on samples.</span></span>

<span data-ttu-id="a9c2d-252">Источник может задавать дополнительные сведения о примере, задавая атрибуты.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-252">The source can set additional information on the sample by setting attributes.</span></span> <span data-ttu-id="a9c2d-253">Список образцов атрибутов см. в разделе [Sample Attributes](sample-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="a9c2d-253">For a list of sample attributes, see [Sample Attributes](sample-attributes.md).</span></span>

### <a name="gaps-in-the-stream"></a><span data-ttu-id="a9c2d-254">Пробелы в потоке</span><span class="sxs-lookup"><span data-stu-id="a9c2d-254">Gaps in the Stream</span></span>

<span data-ttu-id="a9c2d-255">Если поток содержит зазор значительной длины, рекомендуется, чтобы поток отправлял событие [местреамтикк](mestreamtick.md) .</span><span class="sxs-lookup"><span data-stu-id="a9c2d-255">If a stream contains a gap of significant length, it is recommended that the stream send an [MEStreamTick](mestreamtick.md) event.</span></span> <span data-ttu-id="a9c2d-256">Это событие уведомляет клиента о том, что образец отсутствует.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-256">This event notifies the client that a sample is missing.</span></span> <span data-ttu-id="a9c2d-257">Данные события — это отметка времени отсутствующего примера в единицах измерения 100-наносекундных (**VT \_ i8**).</span><span class="sxs-lookup"><span data-stu-id="a9c2d-257">The event data is the time stamp of the missing sample, in 100-nanosecond units (**VT\_I8**).</span></span> <span data-ttu-id="a9c2d-258">Это событие может сохранять нисходящие компоненты из ожидания для выборки, которые не будут поступать.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-258">This event can save downstream components from waiting for samples that will not arrive.</span></span> <span data-ttu-id="a9c2d-259">Поток может отправить столько событий Местреамтикк, сколько необходимо, чтобы охватить разрыв в потоке.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-259">The stream can send as many MEStreamTick events as needed to span the gap in the stream.</span></span>

## <a name="shutting-down-the-media-source"></a><span data-ttu-id="a9c2d-260">Завершение работы источника мультимедиа</span><span class="sxs-lookup"><span data-stu-id="a9c2d-260">Shutting Down the Media Source</span></span>

<span data-ttu-id="a9c2d-261">Когда клиент выполняется с помощью источника мультимедиа, он вызывает [**имфмедиасаурце:: Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-shutdown).</span><span class="sxs-lookup"><span data-stu-id="a9c2d-261">When the client is done using the media source, it calls [**IMFMediaSource::Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-shutdown).</span></span> <span data-ttu-id="a9c2d-262">Внутри этого метода источник мультимедиа должен нарушить все циклические ссылки.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-262">Inside this method, the media source should break any circular reference counts.</span></span> <span data-ttu-id="a9c2d-263">Как правило, между источником мультимедиа и потоками мультимедиа будут использоваться циклические ссылки.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-263">Typically, there will be circular references between the media source and the media streams.</span></span>

<span data-ttu-id="a9c2d-264">Если вы используете очередь событий для реализации [**имфмедиаевентженератор**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator), вызовите [**Имфмедиаевенткуеуе:: Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown) в очереди событий.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-264">If you are using the event queue to implement [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator), call [**IMFMediaEventQueue::Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown) on the event queue.</span></span> <span data-ttu-id="a9c2d-265">Этот метод завершает работу очереди событий и сигнализирует любому вызывающему объекту, который в данный момент ожидает события.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-265">This method shuts down the event queue and signals any caller that is currently waiting for an event.</span></span>

<span data-ttu-id="a9c2d-266">После завершения работы все методы в источнике возвращают **MF \_ E \_ Shutdown**, за исключением методов **IUnknown** .</span><span class="sxs-lookup"><span data-stu-id="a9c2d-266">After shutdown, all methods on the source return **MF\_E\_SHUTDOWN**, with the exception of **IUnknown** methods.</span></span>

## <a name="live-sources"></a><span data-ttu-id="a9c2d-267">Активные источники</span><span class="sxs-lookup"><span data-stu-id="a9c2d-267">Live Sources</span></span>

<span data-ttu-id="a9c2d-268">Начиная с Windows 7, Media Foundation автоматически поддерживает устройства видеозаписи аудио и видео.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-268">Starting in Windows 7, Media Foundation automatically supports audio and video capture devices.</span></span> <span data-ttu-id="a9c2d-269">Для видео устройство должно предоставить минидриверу ядра (KS) в категории видеозаписи.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-269">For video, the device must provide a kernel streaming (KS) minidriver in the video capture category.</span></span> <span data-ttu-id="a9c2d-270">Media Foundation использует путь PnP для перечисления устройства.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-270">Media Foundation uses the PnP path to enumerate the device.</span></span> <span data-ttu-id="a9c2d-271">Для аудио Media Foundation использует API устройства Windows мультимедиа (Ммдевице) для перечисления устройств конечных точек аудио.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-271">For audio, Media Foundation uses the Windows Multimedia Device (MMDevice) API to enumerate audio endpoint devices.</span></span> <span data-ttu-id="a9c2d-272">Если устройство соответствует этим критериям, нет необходимости реализовывать пользовательский источник мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-272">If the device meets these criteria, there is no need to implement a custom media source.</span></span>

<span data-ttu-id="a9c2d-273">Однако может потребоваться реализовать пользовательский источник мультимедиа для какого-либо другого типа устройства или другого источника данных в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-273">However, you might want to implement a custom media source for some other type of device or other live data source.</span></span> <span data-ttu-id="a9c2d-274">Существует лишь несколько различий между источником Live и другими источниками мультимедиа:</span><span class="sxs-lookup"><span data-stu-id="a9c2d-274">There are only a few differences between a live source and other media sources:</span></span>

-   <span data-ttu-id="a9c2d-275">В методе [**имфмедиасаурце::**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-getcharacteristics) -Methods возвратите флаг **мфмедиасаурце в \_ \_ режиме реального времени** .</span><span class="sxs-lookup"><span data-stu-id="a9c2d-275">In the [**IMFMediaSource::GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-getcharacteristics) method, return the **MFMEDIASOURCE\_IS\_LIVE** flag.</span></span>
-   <span data-ttu-id="a9c2d-276">Первый пример должен иметь отметку времени, равную нулю.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-276">The first sample should have a time stamp of zero.</span></span>
-   <span data-ttu-id="a9c2d-277">Состояния событий и потоковой передачи обрабатываются так же, как источники мультимедиа, за исключением приостановленного состояния.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-277">Events and streaming states are handled the same as media sources, with the exception of the paused state.</span></span>
-   <span data-ttu-id="a9c2d-278">При приостановке не следует ставить в очередь образцы.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-278">While paused, do not queue samples.</span></span> <span data-ttu-id="a9c2d-279">Удалите все данные, созданные при приостановке.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-279">Drop any data that is generated while paused.</span></span>
-   <span data-ttu-id="a9c2d-280">Активные источники обычно не поддерживают поиск, обратную воспроизведение или управление скоростью.</span><span class="sxs-lookup"><span data-stu-id="a9c2d-280">Live sources typically do not support seeking, reverse play, or rate control.</span></span>

## <a name="related-topics"></a><span data-ttu-id="a9c2d-281">См. также</span><span class="sxs-lookup"><span data-stu-id="a9c2d-281">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a9c2d-282">Источники мультимедиа</span><span class="sxs-lookup"><span data-stu-id="a9c2d-282">Media Sources</span></span>](media-sources.md)
</dt> <dt>

[<span data-ttu-id="a9c2d-283">Учебник. запись пользовательского источника мультимедиа</span><span class="sxs-lookup"><span data-stu-id="a9c2d-283">Tutorial: Writing a Custom Media Source</span></span>](tutorial--writing-a-custom-media-source.md)
</dt> </dl>

 

 



