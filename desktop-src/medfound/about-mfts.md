---
description: О МФТС
ms.assetid: ca9cef70-b897-4fd5-9a13-8bf1c2b84b00
title: О МФТС
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 09adce4bc93c110cf98e4fd8ed427ffcd009c3c1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103897522"
---
# <a name="about-mfts"></a><span data-ttu-id="a6053-103">О МФТС</span><span class="sxs-lookup"><span data-stu-id="a6053-103">About MFTs</span></span>

<span data-ttu-id="a6053-104">Media Foundation преобразования (МФТС) предоставляют универсальную модель для обработки данных мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="a6053-104">Media Foundation transforms (MFTs) provide a generic model for processing media data.</span></span> <span data-ttu-id="a6053-105">МФТС используются для декодеров, кодировщиков и обработчиков цифровых сигналов (DSP).</span><span class="sxs-lookup"><span data-stu-id="a6053-105">MFTs are used for decoders, encoders, and digital signal processors (DSPs).</span></span> <span data-ttu-id="a6053-106">Вкратце, все, что располагается в конвейере мультимедиа между источником мультимедиа и приемником мультимедиа, является MFT.</span><span class="sxs-lookup"><span data-stu-id="a6053-106">In short, anything that sits in the media pipeline between the media source and the media sink is an MFT.</span></span>

<span data-ttu-id="a6053-107">Для большинства приложений сведения об обработке данных MFT скрыты на более высоких уровнях архитектуры Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="a6053-107">For most applications, the details of MFT data processing are hidden by higher layers of the Media Foundation architecture.</span></span> <span data-ttu-id="a6053-108">Многие Media Foundation приложения никогда не выполняют прямой вызов к MFT.</span><span class="sxs-lookup"><span data-stu-id="a6053-108">Many Media Foundation applications will never make a direct call to an MFT.</span></span> <span data-ttu-id="a6053-109">Однако, конечно, можно разместить MFT непосредственно в приложении.</span><span class="sxs-lookup"><span data-stu-id="a6053-109">However, it is certainly possible to host an MFT directly in your application.</span></span>

<span data-ttu-id="a6053-110">МФТС — это эволюция модели преобразования, впервые представленной в DirectX Media Objects (дмос).</span><span class="sxs-lookup"><span data-stu-id="a6053-110">MFTs are an evolution of the transform model first introduced with DirectX Media Objects (DMOs).</span></span> <span data-ttu-id="a6053-111">На самом деле, сравнительно легко создать преобразование, которое поддерживает обе модели.</span><span class="sxs-lookup"><span data-stu-id="a6053-111">In fact, it is relatively easy to create a transform that supports both models.</span></span> <span data-ttu-id="a6053-112">По сравнению с дмос, требуемые поведения МФТС более четко указаны, что упрощает написание правильной реализации.</span><span class="sxs-lookup"><span data-stu-id="a6053-112">Compared with DMOs, the required behaviors of MFTs are more clearly specified, which makes it easier to write a correct implementation.</span></span> <span data-ttu-id="a6053-113">Кроме того, МФТС может поддерживать обработку видео с аппаратным ускорением.</span><span class="sxs-lookup"><span data-stu-id="a6053-113">In addition, MFTs can support hardware-accelerated video processing.</span></span>

<span data-ttu-id="a6053-114">В этом разделе приводится краткий обзор модели обработки MFT, в которой основное внимание уделяется общему проектированию, а не к конкретным вызовам методов.</span><span class="sxs-lookup"><span data-stu-id="a6053-114">This topic gives a brief overview of the MFT processing model, focusing on the overall design rather than specific method calls.</span></span> <span data-ttu-id="a6053-115">Более подробное пошаговое описание см. в разделе [Базовая модель обработки MFT](basic-mft-processing-model.md).</span><span class="sxs-lookup"><span data-stu-id="a6053-115">For a more detailed, step-by-step description, see [Basic MFT Processing Model](basic-mft-processing-model.md).</span></span>

## <a name="streams"></a><span data-ttu-id="a6053-116">Потоки</span><span class="sxs-lookup"><span data-stu-id="a6053-116">Streams</span></span>

<span data-ttu-id="a6053-117">Файловая Таблица MFT содержит входные потоки и выходные потоки.</span><span class="sxs-lookup"><span data-stu-id="a6053-117">An MFT has input streams and output streams.</span></span> <span data-ttu-id="a6053-118">Входные потоки получают данные, а выходные потоки создают данные.</span><span class="sxs-lookup"><span data-stu-id="a6053-118">Input streams receive data, and output streams produce data.</span></span> <span data-ttu-id="a6053-119">Например, декодер имеет один входной поток, который получает закодированные данные, и один выходной поток, который создает декодированные данные.</span><span class="sxs-lookup"><span data-stu-id="a6053-119">For example, a decoder has one input stream, which receives the encoded data, and one output stream, which produces the decoded data.</span></span>

<span data-ttu-id="a6053-120">Потоки в таблице MFT не представляются как отдельные COM-объекты.</span><span class="sxs-lookup"><span data-stu-id="a6053-120">The streams on an MFT are not represented as distinct COM objects.</span></span> <span data-ttu-id="a6053-121">Вместо этого каждый поток имеет назначенный идентификатор потока, а методы в интерфейсе [**имфтрансформ**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) принимают идентификаторы потоков в качестве входных параметров.</span><span class="sxs-lookup"><span data-stu-id="a6053-121">Instead, each stream has a designated stream identifier, and the methods in the [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) interface take stream identifiers as input parameters.</span></span>

<span data-ttu-id="a6053-122">Некоторые МФТС имеют фиксированное число потоков.</span><span class="sxs-lookup"><span data-stu-id="a6053-122">Some MFTs have a fixed number of streams.</span></span> <span data-ttu-id="a6053-123">Например, декодеры и кодировщики обычно имеют ровно один вход и один выход.</span><span class="sxs-lookup"><span data-stu-id="a6053-123">For example, decoders and encoders normally have exactly one input and one output.</span></span> <span data-ttu-id="a6053-124">Другие МФТС имеют динамическое число потоков.</span><span class="sxs-lookup"><span data-stu-id="a6053-124">Other MFTs have a dynamic number of streams.</span></span> <span data-ttu-id="a6053-125">Если MFT поддерживает динамические потоки, клиент может добавлять новые входные потоки.</span><span class="sxs-lookup"><span data-stu-id="a6053-125">If an MFT supports dynamic streams, the client can add new input streams.</span></span> <span data-ttu-id="a6053-126">Клиент не может добавлять выходные потоки, но MFT может добавлять или удалять выходные потоки во время обработки.</span><span class="sxs-lookup"><span data-stu-id="a6053-126">The client cannot add output streams, but the MFT might add or remove output streams during processing.</span></span> <span data-ttu-id="a6053-127">Например, мультиплексоры обычно позволяют клиенту добавлять входные потоки и иметь один выход для мультиплексированного потока.</span><span class="sxs-lookup"><span data-stu-id="a6053-127">For example, multiplexers typically allow the client to add input streams and have one output for the multiplexed stream.</span></span> <span data-ttu-id="a6053-128">Демультиплексоры являются обратными, с одним входом, но с динамическим числом выходных потоков, в зависимости от содержимого входного потока.</span><span class="sxs-lookup"><span data-stu-id="a6053-128">Demultiplexers are the reverse, with one input but a dynamic number of output streams, depending on the contents of the input stream.</span></span> <span data-ttu-id="a6053-129">На следующем рисунке показано различие между мультиплексором и демультиплексором.</span><span class="sxs-lookup"><span data-stu-id="a6053-129">The following illustration shows the difference between multiplexer and demultiplexer.</span></span>

![Схема, показывающая кодировщик/декодер (1 вход, 1 выход), мультиплексор (2 входа, 1 выход) и демультиплексор (1 вход, 2 выхода)](images/f2b95bd5-f862-4d66-9d75-550a90f6cc97.gif)

## <a name="media-types"></a><span data-ttu-id="a6053-131">Типы носителей</span><span class="sxs-lookup"><span data-stu-id="a6053-131">Media Types</span></span>

<span data-ttu-id="a6053-132">При первом создании таблицы MFT ни один из потоков не имеет установленного формата.</span><span class="sxs-lookup"><span data-stu-id="a6053-132">When an MFT is first created, none of the streams has an established format.</span></span> <span data-ttu-id="a6053-133">Прежде чем MFT сможет обработать данные, клиент должен задать форматы для потоков.</span><span class="sxs-lookup"><span data-stu-id="a6053-133">Before the MFT can process data, the client must set the formats for the streams.</span></span> <span data-ttu-id="a6053-134">Например, при использовании декодера входной формат является форматом сжатия, используемым в исходном файле исходного кода, а формат выходных данных — несжатым форматом, например с аудио-или видеороликом PCM.</span><span class="sxs-lookup"><span data-stu-id="a6053-134">For example, with a decoder, the input format is the compression format used in the original source file, and the output format is an uncompressed format, such as PCM audio or RGB video.</span></span> <span data-ttu-id="a6053-135">Форматы потоков описаны с помощью [типов мультимедиа](media-types.md).</span><span class="sxs-lookup"><span data-stu-id="a6053-135">The stream formats are described using [Media Types](media-types.md).</span></span>

<span data-ttu-id="a6053-136">В зависимости от внутреннего состояния MFT оно может предоставить список возможных типов носителей для каждого потока.</span><span class="sxs-lookup"><span data-stu-id="a6053-136">Depending on the internal state of the MFT, it might provide a list of possible media types for each stream.</span></span> <span data-ttu-id="a6053-137">Этот список можно использовать в качестве подсказки при задании типов мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="a6053-137">You can use this list as a hint when you set the media types.</span></span> <span data-ttu-id="a6053-138">Установка типа мультимедиа в одном потоке может изменить список возможных типов для другого потока.</span><span class="sxs-lookup"><span data-stu-id="a6053-138">Setting the media type on one stream can change the list of possible types for a another stream.</span></span> <span data-ttu-id="a6053-139">Например, декодер обычно не может предоставлять типы вывода, пока клиент не установит входной тип.</span><span class="sxs-lookup"><span data-stu-id="a6053-139">For example, a decoder typically cannot provide any output types until the client sets the input type.</span></span> <span data-ttu-id="a6053-140">Тип входных данных содержит сведения, необходимые декодеру для возврата списка возможных типов вывода.</span><span class="sxs-lookup"><span data-stu-id="a6053-140">The input type contains the information that the decoder needs to return a list of possible output types.</span></span>

<span data-ttu-id="a6053-141">Чтобы задать тип мультимедиа в потоке, вызовите метод [**имфтрансформ:: сетинпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) или [**Имфтрансформ:: сетаутпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span><span class="sxs-lookup"><span data-stu-id="a6053-141">To set the media type on a stream, call [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) or [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span></span> <span data-ttu-id="a6053-142">Чтобы получить список возможных типов носителей для потока, вызовите метод [**имфтрансформ:: жетинпутаваилаблетипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) или [**Имфтрансформ:: жетаутпутаваилаблетипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype).</span><span class="sxs-lookup"><span data-stu-id="a6053-142">To get the list of possible media types for a stream, call [**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) or [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype).</span></span>

## <a name="processing-data"></a><span data-ttu-id="a6053-143">Обработка данных</span><span class="sxs-lookup"><span data-stu-id="a6053-143">Processing Data</span></span>

<span data-ttu-id="a6053-144">После того как клиент установит типы носителей в потоках, Таблица MFT готова к обработке данных.</span><span class="sxs-lookup"><span data-stu-id="a6053-144">After the client sets the media types on the streams, the MFT is ready to process data.</span></span> <span data-ttu-id="a6053-145">Чтобы сделать это, клиент переводится между вводом входных данных в MFT и получением выходных данных из MFT:</span><span class="sxs-lookup"><span data-stu-id="a6053-145">To make this happen, the client alternates between providing input data to the MFT and getting output data from the MFT:</span></span>

-   <span data-ttu-id="a6053-146">Чтобы предоставить входные данные в MFT, вызовите [**имфтрансформ::P роцессинпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="a6053-146">To give input data to the MFT, call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span>
-   <span data-ttu-id="a6053-147">Чтобы извлечь выходные данные из MFT, вызовите [**имфтрансформ::P роцессаутпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="a6053-147">To pull output data from the MFT, call [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

<span data-ttu-id="a6053-148">Метод [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) принимает указатель на пример носителя, выделенный клиентом.</span><span class="sxs-lookup"><span data-stu-id="a6053-148">The [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) method takes a pointer to a media sample allocated by the client.</span></span> <span data-ttu-id="a6053-149">Пример носителя содержит один или несколько буферов, а каждый буфер содержит входные данные для обработки MFT.</span><span class="sxs-lookup"><span data-stu-id="a6053-149">The media sample contains one or more buffers, and each buffer contains input data for the MFT to process.</span></span>

<span data-ttu-id="a6053-150">Метод [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) поддерживает две различные модели распределения: Таблица MFT выделяет выходные буферы, или клиент выделяет буферы вывода.</span><span class="sxs-lookup"><span data-stu-id="a6053-150">The [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method supports two different allocation models: Either the MFT allocates the output buffers, or the client allocates the output buffers.</span></span> <span data-ttu-id="a6053-151">Некоторые МФТС поддерживают обе модели распределения, но не требуется для поддержки обоих файлов MFT.</span><span class="sxs-lookup"><span data-stu-id="a6053-151">Some MFTs support both allocation models, but it is not required for an MFT to support both.</span></span> <span data-ttu-id="a6053-152">Например, для MFT может потребоваться, чтобы клиент выделил буферы вывода.</span><span class="sxs-lookup"><span data-stu-id="a6053-152">For example, an MFT might require the client to allocate the output buffers.</span></span> <span data-ttu-id="a6053-153">Метод [**имфтрансформ:: жетаутпутстреаминфо**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) возвращает сведения о потоке вывода, включая модель выделения, поддерживаемую MFT.</span><span class="sxs-lookup"><span data-stu-id="a6053-153">The [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns information about an output stream, including which allocation model the MFT supports.</span></span>

<span data-ttu-id="a6053-154">МФТС предназначены для последовательного буферизации как можно меньшего объема данных, чтобы свести к минимуму задержки в конвейере.</span><span class="sxs-lookup"><span data-stu-id="a6053-154">MFTs are designed to buffer as little data as possible, in order to minimize latency in the pipeline.</span></span> <span data-ttu-id="a6053-155">Таким образом, в любой момент времени MFT может сообщить одно из следующих условий:</span><span class="sxs-lookup"><span data-stu-id="a6053-155">Therefore, at any given time, the MFT can signal one of the following conditions:</span></span>

-   <span data-ttu-id="a6053-156">Для MFT требуются дополнительные входные данные.</span><span class="sxs-lookup"><span data-stu-id="a6053-156">The MFT requires more input data.</span></span> <span data-ttu-id="a6053-157">В этом состоянии MFT не может создавать выходные данные, пока клиент не вызовет метод [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) по крайней мере один раз.</span><span class="sxs-lookup"><span data-stu-id="a6053-157">In this state, the MFT cannot produce output until the client calls [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) at least once.</span></span>
-   <span data-ttu-id="a6053-158">MFT не будет принимать никаких входных данных, пока клиент не вызовет [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) по крайней мере один раз.</span><span class="sxs-lookup"><span data-stu-id="a6053-158">The MFT will not accept any more input until the client calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) at least once.</span></span>

<span data-ttu-id="a6053-159">Например, предположим, что вы используете видеодекодер для декодирования видеопотока, содержащего сочетание ключевых кадров и разностных кадров.</span><span class="sxs-lookup"><span data-stu-id="a6053-159">For example, suppose that you are using a video decoder to decode a video stream that contains a mix of key frames and delta frames.</span></span> <span data-ttu-id="a6053-160">Первоначально MFT требует ввода некоторых входных данных, прежде чем он сможет декодировать все кадры.</span><span class="sxs-lookup"><span data-stu-id="a6053-160">Initially, the MFT requires some input before it can decode any frames.</span></span> <span data-ttu-id="a6053-161">Клиент вызывает метод [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) для доставки первого кадра.</span><span class="sxs-lookup"><span data-stu-id="a6053-161">The client calls [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) to deliver the first frame.</span></span> <span data-ttu-id="a6053-162">Предположим, что первый кадр является разностным (показан на следующей схеме как "P" для прогнозируемого кадра).</span><span class="sxs-lookup"><span data-stu-id="a6053-162">Suppose that the first frame is a delta frame (shown in the following diagram as 'P' for predicted frame).</span></span> <span data-ttu-id="a6053-163">Декодер удерживает этот фрейм, но не может вывести выходные данные, пока не получит следующий ключевой кадр.</span><span class="sxs-lookup"><span data-stu-id="a6053-163">The decoder holds onto this frame, but it cannot produce any output until it gets the next key frame.</span></span>

![Схема, показывающая таблицу MFT, для которой требуются входные данные, указывающие на прогнозируемый кадр](images/f5a88ac6-24da-40e5-b356-649aa6f811c3.gif)

<span data-ttu-id="a6053-165">Клиент по-прежнему вызывает метод [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) и в конечном итоге достигает следующего ключевого кадра (показан на следующей схеме как i для внутреннего фрейма).</span><span class="sxs-lookup"><span data-stu-id="a6053-165">The client continues to call [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and eventually reaches the next key frame (shown in the next diagram as 'I' for intra-coded frame).</span></span> <span data-ttu-id="a6053-166">Теперь у декодера достаточно кадров, чтобы начать декодирование.</span><span class="sxs-lookup"><span data-stu-id="a6053-166">Now the decoder has enough frames to start decoding.</span></span> <span data-ttu-id="a6053-167">На этом этапе он останавливает прием входных данных, и клиент должен вызвать [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) , чтобы получить раскодированные кадры.</span><span class="sxs-lookup"><span data-stu-id="a6053-167">At this point it stops accepting input, and the client must call [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get the decoded frames.</span></span>

![Схема, показывающая таблицу MFT, которая не принимает входные данные, указывает на один внутренний кадр и три прогнозируемых кадра](images/ae014a1a-9d03-4cfa-a04d-4a63bdc83f73.gif)

<span data-ttu-id="a6053-169">Самый простой подход для клиента — это просто альтернативные вызовы [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) и [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="a6053-169">The simplest approach for the client is simply to alternate calls to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="a6053-170">Более сложный алгоритм описывается в разделе [Базовая модель обработки MFT](basic-mft-processing-model.md).</span><span class="sxs-lookup"><span data-stu-id="a6053-170">A more sophisticated algorithm is described in the topic [Basic MFT Processing Model](basic-mft-processing-model.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="a6053-171">См. также</span><span class="sxs-lookup"><span data-stu-id="a6053-171">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a6053-172">Преобразования Media Foundation</span><span class="sxs-lookup"><span data-stu-id="a6053-172">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 



