---
description: В этом разделе описывается написание Media Foundation преобразования (MFT), которое выступает в качестве прокси-сервера для аппаратного кодировщика, декодера или процессора цифровых сигналов (DSP).
ms.assetid: 9922d403-5d0d-433f-ad9f-c86142ac0f46
title: Оборудование МФТС
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ac5ce05b4fdad6040b51f66f543c1737fc3918d2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104263445"
---
# <a name="hardware-mfts"></a><span data-ttu-id="2ef86-103">Оборудование МФТС</span><span class="sxs-lookup"><span data-stu-id="2ef86-103">Hardware MFTs</span></span>

> [!Note]  
> <span data-ttu-id="2ef86-104">Этот раздел относится к Windows 7 или более поздним версиям.</span><span class="sxs-lookup"><span data-stu-id="2ef86-104">This topic applies to Windows 7 or later.</span></span>

 

<span data-ttu-id="2ef86-105">В этом разделе описывается написание Media Foundation преобразования (MFT), которое выступает в качестве прокси-сервера для аппаратного кодировщика, декодера или процессора цифровых сигналов (DSP).</span><span class="sxs-lookup"><span data-stu-id="2ef86-105">This topic describes how to write a Media Foundation transform (MFT) that acts as a proxy to a hardware encoder, decoder, or digital signal processor (DSP).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="2ef86-106">Если аппаратный кодек использует драйвер класса мультимедиа Австреам, для него не требуется настраиваемая таблица MFT.</span><span class="sxs-lookup"><span data-stu-id="2ef86-106">If a hardware codec uses the AVStream multimedia class driver, it does not require a custom MFT.</span></span> <span data-ttu-id="2ef86-107">Для этой цели Media Foundation предоставляет прокси-сервер Австреам.</span><span class="sxs-lookup"><span data-stu-id="2ef86-107">Media Foundation provides an AVStream proxy for this purpose.</span></span> <span data-ttu-id="2ef86-108">Сведения в этом разделе относятся только к особому случайУ, когда аппаратный кодек не использует Австреам.</span><span class="sxs-lookup"><span data-stu-id="2ef86-108">The information in this topic applies only in the special case where the hardware codec does not use AVStream.</span></span> <span data-ttu-id="2ef86-109">Дополнительные сведения см. [в разделе Поддержка аппаратных кодеков в австреам](https://msdn.microsoft.com/library/dd568169.aspx).</span><span class="sxs-lookup"><span data-stu-id="2ef86-109">For more information, see [Hardware Codec Support in AVStream](https://msdn.microsoft.com/library/dd568169.aspx).</span></span>

 

<span data-ttu-id="2ef86-110">В этом разделе содержатся следующие подразделы.</span><span class="sxs-lookup"><span data-stu-id="2ef86-110">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="2ef86-111">Введение</span><span class="sxs-lookup"><span data-stu-id="2ef86-111">Introduction</span></span>](#introduction)
-   [<span data-ttu-id="2ef86-112">Атрибуты оборудования MFT</span><span class="sxs-lookup"><span data-stu-id="2ef86-112">Hardware MFT Attributes</span></span>](#hardware-mft-attributes)
-   [<span data-ttu-id="2ef86-113">Последовательность подтверждения оборудования</span><span class="sxs-lookup"><span data-stu-id="2ef86-113">Hardware Handshake Sequence</span></span>](#hardware-handshake-sequence)
-   [<span data-ttu-id="2ef86-114">Обработка данных</span><span class="sxs-lookup"><span data-stu-id="2ef86-114">Data Processing</span></span>](#data-processing)
-   [<span data-ttu-id="2ef86-115">Парный декодер и кодировщик</span><span class="sxs-lookup"><span data-stu-id="2ef86-115">Paired Decoder/Encoder</span></span>](#paired-decoderencoder)
-   [<span data-ttu-id="2ef86-116">См. также</span><span class="sxs-lookup"><span data-stu-id="2ef86-116">Related topics</span></span>](#related-topics)

## <a name="introduction"></a><span data-ttu-id="2ef86-117">Введение</span><span class="sxs-lookup"><span data-stu-id="2ef86-117">Introduction</span></span>

<span data-ttu-id="2ef86-118">Любой аппаратный кодек, который не основан на Австреам, должен предоставлять собственный MFT для использования в качестве прокси-сервера для драйвера.</span><span class="sxs-lookup"><span data-stu-id="2ef86-118">Any hardware codec that is not based on AVStream must provide its own MFT to act as a proxy to the driver.</span></span> <span data-ttu-id="2ef86-119">Аппаратный кодек может включать несколько отдельных функциональных блоков:</span><span class="sxs-lookup"><span data-stu-id="2ef86-119">A hardware codec might incorporate several distinct functional blocks:</span></span>

-   <span data-ttu-id="2ef86-120">Кодировщик</span><span class="sxs-lookup"><span data-stu-id="2ef86-120">Encoder</span></span>
-   <span data-ttu-id="2ef86-121">Показан</span><span class="sxs-lookup"><span data-stu-id="2ef86-121">Decoder</span></span>
-   <span data-ttu-id="2ef86-122">Масштабирование кадров и преобразование формата</span><span class="sxs-lookup"><span data-stu-id="2ef86-122">Frame scaling/format conversion</span></span>

<span data-ttu-id="2ef86-123">Каждая из этих функций должна управляться отдельной таблицей MFT.</span><span class="sxs-lookup"><span data-stu-id="2ef86-123">Each of these functions should be managed by a separate MFT.</span></span> <span data-ttu-id="2ef86-124">Оборудование MFT не должно действовать как многозначный "транспрограммный".</span><span class="sxs-lookup"><span data-stu-id="2ef86-124">A hardware MFT should never act as a multi-purpose "transcoder."</span></span> <span data-ttu-id="2ef86-125">Вместо этого следует размещать функции кодирования в файле MFT кодировщика и декодировать функции в MFT декодера.</span><span class="sxs-lookup"><span data-stu-id="2ef86-125">Instead, put encoding functions into an encoder MFT and decoding functions into a decoder MFT.</span></span> <span data-ttu-id="2ef86-126">Если оборудование обеспечивает масштабирование кадров и преобразование форматов, разместите эти функции в отдельном видеопроцессоре, зарегистрированном в категории **MFT " \_ \_ \_ обработчик видео** ".</span><span class="sxs-lookup"><span data-stu-id="2ef86-126">If the hardware offers frame scaling and format conversions, place those functions in a separate video processor, registered in the **MFT\_CATEGORY\_VIDEO\_PROCESSOR** category.</span></span> <span data-ttu-id="2ef86-127">Если оборудование не поддерживает масштабирование кадров или преобразование формата, Media Foundation предоставляет обработчик видео по.</span><span class="sxs-lookup"><span data-stu-id="2ef86-127">If the hardware does not support frame scaling or format conversion, Media Foundation provides a software video processor.</span></span>

<span data-ttu-id="2ef86-128">Оборудование МФТС имеет следующие общие требования.</span><span class="sxs-lookup"><span data-stu-id="2ef86-128">Hardware MFTs have the following general requirements:</span></span>

-   <span data-ttu-id="2ef86-129">Оборудование МФТС должно использовать новую модель асинхронной обработки, как описано в разделе [асинхронная МФТС](asynchronous-mfts.md).</span><span class="sxs-lookup"><span data-stu-id="2ef86-129">Hardware MFTs must use the new asynchronous processing model, as described in [Asynchronous MFTs](asynchronous-mfts.md).</span></span>
-   <span data-ttu-id="2ef86-130">Оборудование МФТС должно поддерживать динамические изменения формата, как описано в разделе [динамические изменения формата](basic-mft-processing-model.md).</span><span class="sxs-lookup"><span data-stu-id="2ef86-130">Hardware MFTs must support dynamic format changes, as described in [Dynamic Format Changes](basic-mft-processing-model.md).</span></span>

## <a name="hardware-mft-attributes"></a><span data-ttu-id="2ef86-131">Атрибуты оборудования MFT</span><span class="sxs-lookup"><span data-stu-id="2ef86-131">Hardware MFT Attributes</span></span>

<span data-ttu-id="2ef86-132">Оборудование MFT должно реализовывать следующие методы, связанные с атрибутами:</span><span class="sxs-lookup"><span data-stu-id="2ef86-132">A hardware MFT must implement following methods related to attributes:</span></span>

-   <span data-ttu-id="2ef86-133">[**Имфтрансформ:: OutAttribute**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes): Возвращает хранилище атрибутов для глобальных атрибутов MFT.</span><span class="sxs-lookup"><span data-stu-id="2ef86-133">[**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes): Returns an attribute store for global MFT attributes.</span></span>
-   <span data-ttu-id="2ef86-134">[**Имфтрансформ:: жетинпутстреаматтрибутес**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes): Возвращает хранилище атрибутов для входного потока.</span><span class="sxs-lookup"><span data-stu-id="2ef86-134">[**IMFTransform::GetInputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes): Returns an attribute store for an input stream.</span></span>
-   <span data-ttu-id="2ef86-135">[**Имфтрансформ:: жетаутпутстреаматтрибутес**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes): Возвращает хранилище атрибутов для выходного потока.</span><span class="sxs-lookup"><span data-stu-id="2ef86-135">[**IMFTransform::GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes): Returns an attribute store for an output stream.</span></span>

<span data-ttu-id="2ef86-136">Когда таблица MFT создается впервые, она должна задать следующие атрибуты в собственном хранилище глобальных атрибутов (то есть хранилищем атрибутов, возвращаемом методом [**InAttribute**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes)):</span><span class="sxs-lookup"><span data-stu-id="2ef86-136">When the MFT is first created, it must set the following attributes on its own global attribute store (that is, the attribute store returned by [**GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes)):</span></span>



| <span data-ttu-id="2ef86-137">attribute</span><span class="sxs-lookup"><span data-stu-id="2ef86-137">Attribute</span></span>                                                                                    | <span data-ttu-id="2ef86-138">Описание</span><span class="sxs-lookup"><span data-stu-id="2ef86-138">Description</span></span>                                                                                                                                                                            |
|----------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="2ef86-139">\_ \_ асинхронное преобразование MF</span><span class="sxs-lookup"><span data-stu-id="2ef86-139">MF\_TRANSFORM\_ASYNC</span></span>](mf-transform-async.md)                                               | <span data-ttu-id="2ef86-140">Необходимо задать значение **true**.</span><span class="sxs-lookup"><span data-stu-id="2ef86-140">Must be set to **TRUE**.</span></span> <span data-ttu-id="2ef86-141">Указывает, что MFT выполняет асинхронную обработку.</span><span class="sxs-lookup"><span data-stu-id="2ef86-141">Indicates that the MFT performs asynchronous processing.</span></span>                                                                                                      |
| [<span data-ttu-id="2ef86-142">\_ \_ Атрибут аппаратного \_ URL-адреса перечисления MFT \_</span><span class="sxs-lookup"><span data-stu-id="2ef86-142">MFT\_ENUM\_HARDWARE\_URL\_Attribute</span></span>](mft-enum-hardware-url-attribute.md)                   | <span data-ttu-id="2ef86-143">Содержит символьную ссылку для аппаратного устройства.</span><span class="sxs-lookup"><span data-stu-id="2ef86-143">Contains the symbolic link for the hardware device.</span></span><br/> <span data-ttu-id="2ef86-144">Загрузчик топологии использует наличие этого атрибута для проверки того, представляет ли MFT устройство.</span><span class="sxs-lookup"><span data-stu-id="2ef86-144">The topology loader uses the presence of this attribute to test whether an MFT represents a hardware device.</span></span><br/> |
| [<span data-ttu-id="2ef86-145">**Основная таблица MFT \_ поддерживает \_ \_ изменение динамического формата \_**</span><span class="sxs-lookup"><span data-stu-id="2ef86-145">**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**</span></span>](mft-support-dynamic-format-change-attribute.md) | <span data-ttu-id="2ef86-146">Необходимо задать значение **true**.</span><span class="sxs-lookup"><span data-stu-id="2ef86-146">Must be set to **TRUE**.</span></span> <span data-ttu-id="2ef86-147">Указывает, что MFT поддерживает изменения динамического формата.</span><span class="sxs-lookup"><span data-stu-id="2ef86-147">Indicates that the MFT supports dynamic format changes.</span></span>                                                                                                       |



 

## <a name="hardware-handshake-sequence"></a><span data-ttu-id="2ef86-148">Последовательность подтверждения оборудования</span><span class="sxs-lookup"><span data-stu-id="2ef86-148">Hardware Handshake Sequence</span></span>

<span data-ttu-id="2ef86-149">Если два МФТС представляют одно и то же физическое устройство, они могут обмениваться данными внутри оборудования, например, через аппаратную шину.</span><span class="sxs-lookup"><span data-stu-id="2ef86-149">If two MFTs represent the same physical device, they can exchange data within the hardware—for example, over a hardware bus.</span></span> <span data-ttu-id="2ef86-150">Нет необходимости копировать данные в системную память, а затем обратно на устройство.</span><span class="sxs-lookup"><span data-stu-id="2ef86-150">There is no need to copy the data into system memory and then back to the device.</span></span>

<span data-ttu-id="2ef86-151">На следующей схеме МФТС, обозначенные как "A" и "B", представляют функциональные блоки в одном и том же оборудовании.</span><span class="sxs-lookup"><span data-stu-id="2ef86-151">In the following diagram, the MFTs labeled "A" and "B" represent functional blocks within the same hardware.</span></span> <span data-ttu-id="2ef86-152">Например, в сценарии перекодировки "A" может представлять аппаратный декодер, а "B" — аппаратный кодировщик.</span><span class="sxs-lookup"><span data-stu-id="2ef86-152">For example, in a transcoding scenario, "A" might represent a hardware decoder and "B" might represent a hardware encoder.</span></span> <span data-ttu-id="2ef86-153">Поток данных между "A" и "B" находится в пределах оборудования.</span><span class="sxs-lookup"><span data-stu-id="2ef86-153">The data flow between "A" and "B" occurs within the hardware.</span></span> <span data-ttu-id="2ef86-154">MFT с меткой "C" — это программная MFT.</span><span class="sxs-lookup"><span data-stu-id="2ef86-154">The MFT labeled "C" is a software MFT.</span></span> <span data-ttu-id="2ef86-155">Поток данных из "B" в "C" использует системную память.</span><span class="sxs-lookup"><span data-stu-id="2ef86-155">Data flow from "B" to "C" uses system memory.</span></span>

![Диаграмма с полями, обозначенными с помощью c, и аппаратным кодеком: a указывает на b и кодек, кодек указывает на b, а b указывает на c](images/proxy-mft.png)

<span data-ttu-id="2ef86-157">Для установления аппаратного подключения два МФТС оборудования должны использовать частный канал связи.</span><span class="sxs-lookup"><span data-stu-id="2ef86-157">To establish a hardware connection, the two hardware MFTs must use a private communication channel.</span></span> <span data-ttu-id="2ef86-158">Это соединение устанавливается во время согласования формата до установки типов мультимедиа и перед первым вызовом [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="2ef86-158">This connection is established during format negotiation, before the media types are set and before the first call to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span> <span data-ttu-id="2ef86-159">Процесс подключения работает следующим образом.</span><span class="sxs-lookup"><span data-stu-id="2ef86-159">The connection process works as follows:</span></span>

1.  <span data-ttu-id="2ef86-160">Загрузчик топологии проверяет оба МФТС на наличие атрибута [ \_ \_ \_ \_ атрибута аппаратного URL-адреса перечисления MFT](mft-enum-hardware-url-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="2ef86-160">The topology loader checks both MFTs for the presence of the [MFT\_ENUM\_HARDWARE\_URL\_Attribute](mft-enum-hardware-url-attribute.md) attribute.</span></span> <span data-ttu-id="2ef86-161">Обратите внимание, что он не проверяет значение этого атрибута.</span><span class="sxs-lookup"><span data-stu-id="2ef86-161">Note that it does not examine the value of this attribute.</span></span>
2.  <span data-ttu-id="2ef86-162">Если [ \_ атрибут " \_ \_ URL- \_ адрес аппаратного обеспечения перечисления MFT](mft-enum-hardware-url-attribute.md) " существует в обоих МФТС, то загрузчик топологии выполняет следующие действия:</span><span class="sxs-lookup"><span data-stu-id="2ef86-162">If [MFT\_ENUM\_HARDWARE\_URL\_Attribute](mft-enum-hardware-url-attribute.md) is present on both MFTs, the topology loader does the following:</span></span>
    1.  <span data-ttu-id="2ef86-163">Загрузчик топологии вызывает [**имфтрансформ:: жетаутпутстреаматтрибутес**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes) в вышестоящей MFT (а).</span><span class="sxs-lookup"><span data-stu-id="2ef86-163">The topology loader calls [**IMFTransform::GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes) on the upstream MFT (A).</span></span> <span data-ttu-id="2ef86-164">Этот метод возвращает указатель [**имфаттрибутес**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) .</span><span class="sxs-lookup"><span data-stu-id="2ef86-164">This method returns an [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) pointer.</span></span> <span data-ttu-id="2ef86-165">Пусть этот указатель обозначен *пупстреам*.</span><span class="sxs-lookup"><span data-stu-id="2ef86-165">Let this pointer be denoted *pUpstream*.</span></span>
    2.  <span data-ttu-id="2ef86-166">Загрузчик топологии вызывает [**имфтрансформ:: жетинпутстреаматтрибутес**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes) в ПОДЧИНЕННОЙ таблице MFT (B).</span><span class="sxs-lookup"><span data-stu-id="2ef86-166">The topology loader calls [**IMFTransform::GetInputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes) on the downstream MFT (B).</span></span> <span data-ttu-id="2ef86-167">Этот вызов также возвращает указатель [**имфаттрибутес**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) .</span><span class="sxs-lookup"><span data-stu-id="2ef86-167">This call also returns an [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) pointer.</span></span> <span data-ttu-id="2ef86-168">Пусть этот указатель обозначен *пдовнстреам*.</span><span class="sxs-lookup"><span data-stu-id="2ef86-168">Let this pointer be denoted *pDownstream*.</span></span>
    3.  <span data-ttu-id="2ef86-169">Загрузчик топологии задает атрибут [ \_ связанного \_ потока \_ MFT](mft-connected-stream-attribute.md) для *пдовнстреам* , вызывая [**имфаттрибутес:: сетункновн**](/windows/desktop/api/mfobjects/nf-mfobjects-imfattributes-setunknown).</span><span class="sxs-lookup"><span data-stu-id="2ef86-169">The topology loader sets the [MFT\_CONNECTED\_STREAM\_ATTRIBUTE](mft-connected-stream-attribute.md) attribute on *pDownstream* by calling [**IMFAttributes::SetUnknown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfattributes-setunknown).</span></span> <span data-ttu-id="2ef86-170">Значением атрибута является указатель *пупстреам* .</span><span class="sxs-lookup"><span data-stu-id="2ef86-170">The value of the attribute is the *pUpstream* pointer.</span></span>
    4.  <span data-ttu-id="2ef86-171">Загрузчик топологии задает **значение true** для [MFT, \_ подключенного к атрибуту \_ \_ \_ потока оборудования](mft-connected-to-hw-stream.md) , в *пдовнстреам* и *пупстреам*.</span><span class="sxs-lookup"><span data-stu-id="2ef86-171">The topology loader sets the [MFT\_CONNECTED\_TO\_HW\_STREAM](mft-connected-to-hw-stream.md) attribute to **TRUE** on both *pDownstream* and *pUpstream*.</span></span>
3.  <span data-ttu-id="2ef86-172">На этом этапе подчиненная таблица MFT имеет указатель на вышестоящее хранилище атрибутов MFT, как показано на следующей схеме.</span><span class="sxs-lookup"><span data-stu-id="2ef86-172">At this point, the downstream MFT has a pointer to the upstream MFT's attribute store, as shown in the following diagram.</span></span>

    ![схема с каждым МФТС, указывающим на свой поток, каждый поток, указывающий на его хранилище, и входное хранилище с пунктирной линией в выходное хранилище](images/proxy-mft2.png)

    > [!Note]  
    > <span data-ttu-id="2ef86-174">Для ясности на этой диаграмме показаны потоки, а атрибуты хранятся как отдельные объекты, но это не является обязательным для реализации.</span><span class="sxs-lookup"><span data-stu-id="2ef86-174">For clarity, this diagram shows the streams and the attribute stores as distinct objects, but that is not required for the implementation.</span></span>

     

4.  <span data-ttu-id="2ef86-175">В подчиненной таблице MFT для установления частного канала связи с вышестоящей MFT используется указатель [**имфаттрибутес**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) .</span><span class="sxs-lookup"><span data-stu-id="2ef86-175">The downstream MFT uses the [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) pointer to establish a private communication channel with the upstream MFT.</span></span> <span data-ttu-id="2ef86-176">Так как канал является частным, точный механизм определяется реализацией.</span><span class="sxs-lookup"><span data-stu-id="2ef86-176">Because the channel is private, the exact mechanism is defined by the implementation.</span></span> <span data-ttu-id="2ef86-177">Например, Таблица MFT может запрашивать частный COM-интерфейс.</span><span class="sxs-lookup"><span data-stu-id="2ef86-177">For example, the MFT might query for a private COM interface.</span></span>

<span data-ttu-id="2ef86-178">На шаге 4 нисходящий файл MFT должен проверить, имеет ли две МФТС одно и то же физическое устройство.</span><span class="sxs-lookup"><span data-stu-id="2ef86-178">During step 4, the downstream MFT must verify whether the two MFTs share the same physical device.</span></span> <span data-ttu-id="2ef86-179">В противном случае они должны возвращаться к использованию системной памяти для передачи данных.</span><span class="sxs-lookup"><span data-stu-id="2ef86-179">If not, they must fall back to using system memory for data transport.</span></span> <span data-ttu-id="2ef86-180">Это позволит таблице MFT правильно работать с программным обеспечением МФТС и другими аппаратными устройствами.</span><span class="sxs-lookup"><span data-stu-id="2ef86-180">This enables the MFT to operate correctly with software MFTs and other hardware devices.</span></span>

<span data-ttu-id="2ef86-181">Если подтверждение проходит, а два МФТС совместно используют закрытый канал данных, они не используют стандартную модель обработки данных (описанную в следующем разделе) в точке подключения.</span><span class="sxs-lookup"><span data-stu-id="2ef86-181">If the handshake succeeds and the two MFTs share a private data channel, they do not use the standard data processing model (described in the next section) at the connection point.</span></span> <span data-ttu-id="2ef86-182">В частности, подчиненная таблица MFT не отправляет события [метрансформнидинпут](metransformneedinput.md) . Дополнительные сведения см. в следующем разделе этой статьи.</span><span class="sxs-lookup"><span data-stu-id="2ef86-182">Specifically, the downstream MFT does not send [METransformNeedInput](metransformneedinput.md) events; for more details, refer to the next section in this topic.</span></span>

## <a name="data-processing"></a><span data-ttu-id="2ef86-183">Обработка данных</span><span class="sxs-lookup"><span data-stu-id="2ef86-183">Data Processing</span></span>

<span data-ttu-id="2ef86-184">Если оборудование MFT использует системную память для передачи данных, этот процесс работает следующим образом.</span><span class="sxs-lookup"><span data-stu-id="2ef86-184">When a hardware MFT uses system memory for data transport, the process works as follows:</span></span>

1.  <span data-ttu-id="2ef86-185">Чтобы запросить дополнительные входные данные, MFT отправляет событие [метрансформнидинпут](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="2ef86-185">To request more input, the MFT sends an [METransformNeedInput](metransformneedinput.md) event.</span></span>
2.  <span data-ttu-id="2ef86-186">Событие [метрансформнидинпут](metransformneedinput.md) заставляет конвейер вызывать [**Имфтрансформ::P роцессинпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="2ef86-186">The [METransformNeedInput](metransformneedinput.md) event causes the pipeline to call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span>
3.  <span data-ttu-id="2ef86-187">Когда файл MFT содержит выходные данные, MFT отправляет событие [метрансформхавеаутпут](metransformhaveoutput.md) .</span><span class="sxs-lookup"><span data-stu-id="2ef86-187">When the MFT has output data, the MFT sends an [METransformHaveOutput](metransformhaveoutput.md) event.</span></span>
4.  <span data-ttu-id="2ef86-188">Событие [метрансформхавеаутпут](metransformhaveoutput.md) заставляет конвейер вызывать [**Имфтрансформ::P роцессаутпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="2ef86-188">The [METransformHaveOutput](metransformhaveoutput.md) event causes the pipeline to call [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

<span data-ttu-id="2ef86-189">Дополнительные сведения см. в статье [асинхронный МФТС](asynchronous-mfts.md).</span><span class="sxs-lookup"><span data-stu-id="2ef86-189">For details, refer to [Asynchronous MFTs](asynchronous-mfts.md).</span></span>

<span data-ttu-id="2ef86-190">Однако если в MFT используется аппаратный канал, он не отправляет эти события в точке подключения оборудования, так как вся передача данных выполняется внутри оборудования.</span><span class="sxs-lookup"><span data-stu-id="2ef86-190">If the MFT uses a hardware channel, however, it does not send these events at the hardware connection point, because all data transfer happens internally within the hardware.</span></span> <span data-ttu-id="2ef86-191">Поэтому конвейер не вызывает [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) или [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) в точке соединения.</span><span class="sxs-lookup"><span data-stu-id="2ef86-191">Therefore, the pipeline does not call [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) or [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) at the connection point.</span></span>

<span data-ttu-id="2ef86-192">Например, рассмотрим первую диаграмму в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="2ef86-192">For example, consider the first diagram in this topic.</span></span> <span data-ttu-id="2ef86-193">При данной конфигурации обработка данных будет происходить следующим образом:</span><span class="sxs-lookup"><span data-stu-id="2ef86-193">Given this configuration, data processing would occur as follows:</span></span>

1.  <span data-ttu-id="2ef86-194">"A" отправляет [метрансформнидинпут](metransformneedinput.md) для запроса данных.</span><span class="sxs-lookup"><span data-stu-id="2ef86-194">"A" sends [METransformNeedInput](metransformneedinput.md) to request data.</span></span>
2.  <span data-ttu-id="2ef86-195">Конвейер вызывает метод [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) для "A".</span><span class="sxs-lookup"><span data-stu-id="2ef86-195">The pipeline calls [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) on "A".</span></span>
3.  <span data-ttu-id="2ef86-196">"A" и "B" обрабатывают данные в оборудовании.</span><span class="sxs-lookup"><span data-stu-id="2ef86-196">"A" and "B" process the data in hardware.</span></span>
4.  <span data-ttu-id="2ef86-197">После завершения обработки "B" отправляет событие [метрансформхавеаутпут](metransformhaveoutput.md) .</span><span class="sxs-lookup"><span data-stu-id="2ef86-197">When the processing is complete, "B" sends an [METransformHaveOutput](metransformhaveoutput.md) event.</span></span>
5.  <span data-ttu-id="2ef86-198">Конвейер вызывает [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) для "B".</span><span class="sxs-lookup"><span data-stu-id="2ef86-198">The pipeline calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) on "B".</span></span>

## <a name="paired-decoderencoder"></a><span data-ttu-id="2ef86-199">Парный декодер и кодировщик</span><span class="sxs-lookup"><span data-stu-id="2ef86-199">Paired Decoder/Encoder</span></span>

<span data-ttu-id="2ef86-200">Если декодер и кодировщик расположены в одной микросхеме оборудования, то при перекодировании может оказаться предпочтительным их использование вместе.</span><span class="sxs-lookup"><span data-stu-id="2ef86-200">If a decoder and encoder are located on the same hardware chip, it may be preferable to use them together when transcoding.</span></span> <span data-ttu-id="2ef86-201">То есть выбор одного из них должен привести к выбору другого в конвейере перекодирования.</span><span class="sxs-lookup"><span data-stu-id="2ef86-201">That is, selecting one should cause the other to be selected in the transcoding pipeline.</span></span> <span data-ttu-id="2ef86-202">Чтобы убедиться, что выбраны соответствующие аппаратные кодеки, оба кодека МФТС должны предоставлять пользовательский тип мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="2ef86-202">To ensure that matching hardware codecs are chosen, both codec MFTs should offer a custom media type.</span></span> <span data-ttu-id="2ef86-203">Чтобы создать пользовательский тип мультимедиа, сделайте следующее:</span><span class="sxs-lookup"><span data-stu-id="2ef86-203">To create a custom media type:</span></span>

-   <span data-ttu-id="2ef86-204">Задайте для атрибута " [**\_ \_ основной \_ тип MF MT**](mf-mt-major-type-attribute.md) " **мфмедиатипе \_ аудио** или **мфмедиатипе \_ видео** соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="2ef86-204">Set the [**MF\_MT\_MAJOR\_TYPE**](mf-mt-major-type-attribute.md) attribute to **MFMediaType\_Audio** or **MFMediaType\_Video**, as appropriate.</span></span>
-   <span data-ttu-id="2ef86-205">Установите атрибут [**\_ \_ подтипа MF MT**](mf-mt-subtype-attribute.md) в значение настраиваемого идентификатора GUID.</span><span class="sxs-lookup"><span data-stu-id="2ef86-205">Set the [**MF\_MT\_SUBTYPE**](mf-mt-subtype-attribute.md) attribute to a custom GUID value.</span></span>

<span data-ttu-id="2ef86-206">Другие атрибуты типа являются необязательными.</span><span class="sxs-lookup"><span data-stu-id="2ef86-206">Other type attributes are optional.</span></span> <span data-ttu-id="2ef86-207">Декодер возвращает пользовательский тип из [**имфтрансформ:: жетаутпутаваилаблетипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype), а кодировщик возвращает пользовательский тип из метода [**Имфтрансформ:: жетинпутаваилаблетипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) .</span><span class="sxs-lookup"><span data-stu-id="2ef86-207">The decoder returns the custom type from its [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype), and the encoder returns the custom type from its [**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) method.</span></span> <span data-ttu-id="2ef86-208">В обоих случаях пользовательский тип должен быть первой записью в списке (*двтипеиндекс* = 0).</span><span class="sxs-lookup"><span data-stu-id="2ef86-208">In both cases, the custom type must be the first entry in the list (*dwTypeIndex* = 0).</span></span>

<span data-ttu-id="2ef86-209">Для работы с программными кодеками кодек должен также возвращать по крайней мере один стандартный формат, например NV12 для видео.</span><span class="sxs-lookup"><span data-stu-id="2ef86-209">To work with software codecs, the codec should also return at least one standard format, such as NV12 for video.</span></span> <span data-ttu-id="2ef86-210">Стандартные форматы должны отображаться после пользовательского типа (*двтипеиндекс* > 0).</span><span class="sxs-lookup"><span data-stu-id="2ef86-210">Standard formats should appear after the custom type (*dwTypeIndex* > 0).</span></span> <span data-ttu-id="2ef86-211">Если два кодека всегда должны быть парными и не могут взаимодействовать с программными кодеками, МФТС должен возвращать только пользовательский формат и не возвращать стандартные форматы.</span><span class="sxs-lookup"><span data-stu-id="2ef86-211">If the two codecs must always be paired and cannot interoperate with software codecs, the MFTs should return only the custom format and not return any standard formats.</span></span>

> [!Note]  
> <span data-ttu-id="2ef86-212">Если декодер не возвращает ни одного стандартного формата, его нельзя использовать для воспроизведения с [улучшенным модулем подготовки видео](enhanced-video-renderer.md).</span><span class="sxs-lookup"><span data-stu-id="2ef86-212">If a decoder does not return any standard formats, it cannot be used for playback with the [Enhanced Video Renderer](enhanced-video-renderer.md).</span></span> <span data-ttu-id="2ef86-213">В этом случае он должен быть зарегистрирован как декодер только для кодирования.</span><span class="sxs-lookup"><span data-stu-id="2ef86-213">In that case, it should be registered as a transcode-only decoder.</span></span> <span data-ttu-id="2ef86-214">См. раздел [декодеры только для кодирования](implementing-a-codec-mft.md).</span><span class="sxs-lookup"><span data-stu-id="2ef86-214">See [Transcode-Only Decoders](implementing-a-codec-mft.md).</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="2ef86-215">См. также</span><span class="sxs-lookup"><span data-stu-id="2ef86-215">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2ef86-216">Запись пользовательского MFT</span><span class="sxs-lookup"><span data-stu-id="2ef86-216">Writing a Custom MFT</span></span>](writing-a-custom-mft.md)
</dt> <dt>

[<span data-ttu-id="2ef86-217">Реализация MFT кодека</span><span class="sxs-lookup"><span data-stu-id="2ef86-217">Implementing a Codec MFT</span></span>](implementing-a-codec-mft.md)
</dt> <dt>

[<span data-ttu-id="2ef86-218">Преобразования Media Foundation</span><span class="sxs-lookup"><span data-stu-id="2ef86-218">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 




