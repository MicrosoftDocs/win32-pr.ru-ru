---
description: .
ms.assetid: CF3A427D-31D2-45FF-BE87-F192B758204E
title: Сеанс PMP мультимедиа
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5f0e14d9e403620d273bb4aeb3347cba523f304b
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "104351175"
---
# <a name="pmp-media-session"></a><span data-ttu-id="7de58-103">Сеанс PMP мультимедиа</span><span class="sxs-lookup"><span data-stu-id="7de58-103">PMP Media Session</span></span>

<span data-ttu-id="7de58-104">Приложение может создать [сеанс мультимедиа](media-session.md) в отдельном процессе, называемом процессом [защищенного пути к носителю](protected-media-path.md) (PMP).</span><span class="sxs-lookup"><span data-stu-id="7de58-104">An application can create the [Media Session](media-session.md) in a separate process called the [Protected Media Path](protected-media-path.md) (PMP) process.</span></span> <span data-ttu-id="7de58-105">Основной целью процесса PMP является обеспечение воспроизведения защищенного содержимого с помощью управления цифровыми правами (DRM).</span><span class="sxs-lookup"><span data-stu-id="7de58-105">The main purpose of the PMP process is to enable playback of protected content using digital rights management (DRM).</span></span> <span data-ttu-id="7de58-106">По умолчанию процесс PMP создается в защищенной среде (PE).</span><span class="sxs-lookup"><span data-stu-id="7de58-106">By default, the PMP process is created inside a Protected Environment (PE).</span></span> <span data-ttu-id="7de58-107">В PE можно загружать только надежные подписанные компоненты.</span><span class="sxs-lookup"><span data-stu-id="7de58-107">Only trusted, signed components can be loaded inside a PE.</span></span> <span data-ttu-id="7de58-108">Дополнительное преимущество процесса PMP заключается в том, что он изолирует процесс приложения от конвейера мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="7de58-108">A secondary benefit of the PMP process is that it isolates the application process from the media pipeline.</span></span> <span data-ttu-id="7de58-109">Дополнительные сведения о процессе PMP см. в разделе [путь к защищенному носителю](protected-media-path.md).</span><span class="sxs-lookup"><span data-stu-id="7de58-109">For more information about the PMP process, see [Protected Media Path](protected-media-path.md).</span></span>

<span data-ttu-id="7de58-110">Чтобы создать сеанс мультимедиа внутри процесса PMP, вызовите функцию [**мфкреатепмпмедиасессион**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepmpmediasession) .</span><span class="sxs-lookup"><span data-stu-id="7de58-110">To create the Media Session inside the PMP process, call the [**MFCreatePMPMediaSession**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepmpmediasession) function.</span></span> <span data-ttu-id="7de58-111">При необходимости можно передать флаг **\_ незащищенного \_ процесса мфпмпсессион** .</span><span class="sxs-lookup"><span data-stu-id="7de58-111">Optionally, you can pass in the **MFPMPSESSION\_UNPROTECTED\_PROCESS** flag.</span></span> <span data-ttu-id="7de58-112">Если этот флаг установлен, процесс PMP создается в незащищенном процессе, а не в PE-процессе.</span><span class="sxs-lookup"><span data-stu-id="7de58-112">If this flag is set, the PMP process is created inside an unprotected process, and not a PE process.</span></span> <span data-ttu-id="7de58-113">Незащищенный процесс не может использоваться для воспроизведения DRM, но предоставляет преимущества изоляции процессов.</span><span class="sxs-lookup"><span data-stu-id="7de58-113">The unprotected process cannot be used for DRM playback, but does give you the benefits of process isolation.</span></span>

<span data-ttu-id="7de58-114">Функция [**мфкреатепмпмедиасессион**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepmpmediasession) возвращает указатель на прокси-объект для сеанса мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="7de58-114">The [**MFCreatePMPMediaSession**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepmpmediasession) function returns a pointer to a proxy object for the Media Session.</span></span> <span data-ttu-id="7de58-115">Приложение взаимодействует с сеансом мультимедиа через прокси-сервер.</span><span class="sxs-lookup"><span data-stu-id="7de58-115">The application communicates with the Media Session through the proxy.</span></span>

![Иллюстрация сеанса мультимедиа внутри процесса PMP](images/pmp01.png)

<span data-ttu-id="7de58-117">По умолчанию, когда приложение создает топологию, источник мультимедиа создается внутри процесса приложения.</span><span class="sxs-lookup"><span data-stu-id="7de58-117">By default, when the application creates a topology, the media source is created inside the application process.</span></span> <span data-ttu-id="7de58-118">В процессе PMP создается прокси-сервер для источника носителя.</span><span class="sxs-lookup"><span data-stu-id="7de58-118">A proxy to the media source is created inside the PMP process.</span></span> <span data-ttu-id="7de58-119">Источник мультимедиа может создавать объекты внутри процесса PMP с помощью интерфейса [**имфпмфост**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphost-createobjectbyclsid) .</span><span class="sxs-lookup"><span data-stu-id="7de58-119">The media source can create objects inside the PMP process by using the [**IMFPMPHost**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphost-createobjectbyclsid) interface.</span></span> <span data-ttu-id="7de58-120">Например, для поддержки DRM источник мультимедиа создает объект, называемый *входным центром доверия* (ITA).</span><span class="sxs-lookup"><span data-stu-id="7de58-120">For example, to support DRM, a media source creates an object called an *input trust authority* (ITA).</span></span> <span data-ttu-id="7de58-121">Значение ITA должно быть создано внутри процесса PMP.</span><span class="sxs-lookup"><span data-stu-id="7de58-121">The ITA must be created inside the PMP process.</span></span> <span data-ttu-id="7de58-122">(Дополнительные сведения о ИТАС см. в разделе [путь к защищенному носителю](protected-media-path.md).) Чтобы использовать интерфейс [**имфпмфост**](/windows/desktop/api/mfidl/nn-mfidl-imfpmphost) , выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="7de58-122">(For more information about ITAs, see [Protected Media Path](protected-media-path.md).) To use the [**IMFPMPHost**](/windows/desktop/api/mfidl/nn-mfidl-imfpmphost) interface, do the following:</span></span>

1.  <span data-ttu-id="7de58-123">Источник мультимедиа должен реализовывать интерфейс [**имфпмпклиент**](/windows/desktop/api/mfidl/nn-mfidl-imfpmpclient) .</span><span class="sxs-lookup"><span data-stu-id="7de58-123">The media source must implement the [**IMFPMPClient**](/windows/desktop/api/mfidl/nn-mfidl-imfpmpclient) interface.</span></span>
2.  <span data-ttu-id="7de58-124">Во время разрешения топологии прокси-сервер сеанса мультимедиа вызывает метод [**имфпмпклиент:: сетпмфост**](/windows/desktop/api/mfidl/nf-mfidl-imfpmpclient-setpmphost) в источнике мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="7de58-124">During topology resolution, the Media Session proxy calls the [**IMFPMPClient::SetPMPHost**](/windows/desktop/api/mfidl/nf-mfidl-imfpmpclient-setpmphost) method on the media source.</span></span>
3.  <span data-ttu-id="7de58-125">Источник мультимедиа вызывает [**имфпмфост:: креатеобжектбиклсид**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphost-createobjectbyclsid) , чтобы создать объект внутри процесса PMP.</span><span class="sxs-lookup"><span data-stu-id="7de58-125">The media source calls [**IMFPMPHost::CreateObjectByCLSID**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphost-createobjectbyclsid) to create the object inside the PMP process.</span></span> <span data-ttu-id="7de58-126">Объект должен иметь зарегистрированный идентификатор CLSID.</span><span class="sxs-lookup"><span data-stu-id="7de58-126">The object must have a registered CLSID.</span></span> <span data-ttu-id="7de58-127">Кроме того, для загрузки в PE объект должен быть доверенным и подписанным цифровой подписью.</span><span class="sxs-lookup"><span data-stu-id="7de58-127">Also, to load inside the PE, the object must be trusted and digitally signed.</span></span> <span data-ttu-id="7de58-128">Дополнительные сведения о подписывания кода для компонентов защищенного носителя см. в техническом документе [подпись для компонентов защищенного мультимедиа в Windows Vista](/windows-hardware/test/hlk/) .</span><span class="sxs-lookup"><span data-stu-id="7de58-128">For information about code signing protected media components, see the white paper [Code Signing for Protected Media Components in Windows Vista](/windows-hardware/test/hlk/)</span></span>

<span data-ttu-id="7de58-129">На следующем рисунке показан источник мультимедиа, созданный в процессе приложения.</span><span class="sxs-lookup"><span data-stu-id="7de58-129">The following illustration shows the media source created in the application process.</span></span>

![Иллюстрация источника мультимедиа в процессе приложения.](images/pmp02.png)

<span data-ttu-id="7de58-131">Другой вариант — создать источник мультимедиа в сеансе PMP.</span><span class="sxs-lookup"><span data-stu-id="7de58-131">Another alternative is to create the media source inside the PMP session.</span></span>

1.  <span data-ttu-id="7de58-132">При создании сеанса мультимедиа задайте атрибут [**\_ \_ \_ \_ режим удаленного источника MF Session**](mf-session-remote-source-mode-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="7de58-132">Set the [**MF\_SESSION\_REMOTE\_SOURCE\_MODE**](mf-session-remote-source-mode-attribute.md) attribute when you create the Media Session.</span></span> <span data-ttu-id="7de58-133">Атрибуты конфигурации указываются в параметре *пконфигуратион* функции [**мфкреатепмпмедиасессион**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepmpmediasession) .</span><span class="sxs-lookup"><span data-stu-id="7de58-133">Configuration attributes are specified in the *pConfiguration* parameter of the [**MFCreatePMPMediaSession**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepmpmediasession) function.</span></span>
2.  <span data-ttu-id="7de58-134">Вызовите [**мфжетсервице**](/windows/desktop/api/mfidl/nf-mfidl-mfgetservice) в сеансе мультимедиа, чтобы получить указатель на интерфейс [**имфпмфост**](/windows/desktop/api/mfidl/nn-mfidl-imfpmphost) .</span><span class="sxs-lookup"><span data-stu-id="7de58-134">Call [**MFGetService**](/windows/desktop/api/mfidl/nf-mfidl-mfgetservice) on the Media Session to get a pointer to the [**IMFPMPHost**](/windows/desktop/api/mfidl/nn-mfidl-imfpmphost) interface.</span></span> <span data-ttu-id="7de58-135">Идентификатор службы — **MF \_ PMP \_ Service**.</span><span class="sxs-lookup"><span data-stu-id="7de58-135">The service identifier is **MF\_PMP\_SERVICE**.</span></span>
3.  <span data-ttu-id="7de58-136">Вызовите [**имфпмфост:: креатеобжектбиклсид**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphost-createobjectbyclsid) с идентификатором класса **CLSID \_ мфсаурцересолвер** , чтобы создать сопоставитель источника в процессе PMP.</span><span class="sxs-lookup"><span data-stu-id="7de58-136">Call [**IMFPMPHost::CreateObjectByCLSID**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphost-createobjectbyclsid) with the class identifier **CLSID\_MFSourceResolver** to create the source resolver inside the PMP process.</span></span> <span data-ttu-id="7de58-137">Метод возвращает указатель на прокси-сервер для сопоставителя источника.</span><span class="sxs-lookup"><span data-stu-id="7de58-137">The method returns a pointer to a proxy for the source resolver.</span></span>
4.  <span data-ttu-id="7de58-138">Вызовите [**имфсаурцересолвер:: бегинкреатеобжектфромурл**](/windows/desktop/api/mfidl/nf-mfidl-imfsourceresolver-begincreateobjectfromurl) или [**Имфсаурцересолвер:: бегинкреатеобжектфромбитестреам**](/windows/desktop/api/mfidl/nf-mfidl-imfsourceresolver-begincreateobjectfrombytestream) , чтобы создать источник мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="7de58-138">Call [**IMFSourceResolver::BeginCreateObjectFromURL**](/windows/desktop/api/mfidl/nf-mfidl-imfsourceresolver-begincreateobjectfromurl) or [**IMFSourceResolver::BeginCreateObjectFromByteStream**](/windows/desktop/api/mfidl/nf-mfidl-imfsourceresolver-begincreateobjectfrombytestream) to create the media source.</span></span>
    > [!Note]  
    > <span data-ttu-id="7de58-139">В этом случае необходимо использовать асинхронные версии этих методов, так как синхронные версии не поддерживают удаленное взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="7de58-139">In this case, you must use the asynchronous versions of these methods, because the synchronous versions are not remotable.</span></span>

     

<span data-ttu-id="7de58-140">На следующем рисунке показан источник мультимедиа, созданный в процессе PMP.</span><span class="sxs-lookup"><span data-stu-id="7de58-140">The following illustration shows the media source created in the PMP process.</span></span>

![Иллюстрация источника мультимедиа в процессе PMP.](images/pmp03.png)

## <a name="related-topics"></a><span data-ttu-id="7de58-142">См. также</span><span class="sxs-lookup"><span data-stu-id="7de58-142">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="7de58-143">Воспроизведение защищенных файлов мультимедиа</span><span class="sxs-lookup"><span data-stu-id="7de58-143">How to Play Protected Media Files</span></span>](how-to-play-protected-media-files.md)
</dt> <dt>

[<span data-ttu-id="7de58-144">Сеанс мультимедиа</span><span class="sxs-lookup"><span data-stu-id="7de58-144">Media Session</span></span>](media-session.md)
</dt> <dt>

[<span data-ttu-id="7de58-145">Путь к защищенному носителю</span><span class="sxs-lookup"><span data-stu-id="7de58-145">Protected Media Path</span></span>](protected-media-path.md)
</dt> </dl>

 

 
