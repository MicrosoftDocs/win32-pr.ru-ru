---
description: Методы кодирования
ms.assetid: 17ab5ecc-0173-4c5c-9d65-40e506ab7e07
title: Методы кодирования (Microsoft Media Foundation)
ms.topic: reference
ms.date: 05/31/2018
ms.openlocfilehash: e4366f11ea9d120d638c5600f84fc16f6c5320f8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105710816"
---
# <a name="encoding-methods-microsoft-media-foundation"></a><span data-ttu-id="4472e-103">Методы кодирования (Microsoft Media Foundation)</span><span class="sxs-lookup"><span data-stu-id="4472e-103">Encoding Methods (Microsoft Media Foundation)</span></span>

<span data-ttu-id="4472e-104">Большинство кодеков аудио и видео Windows Media поддерживает несколько методов кодирования.</span><span class="sxs-lookup"><span data-stu-id="4472e-104">Most of the Windows Media Audio and Video codecs support multiple encoding methods.</span></span> <span data-ttu-id="4472e-105">Знание того, как и когда следует использовать каждый из методов, может помочь в создании высококачественного сжатого содержимого.</span><span class="sxs-lookup"><span data-stu-id="4472e-105">Knowing how and when to use each method can help you create high-quality compressed content.</span></span>

<span data-ttu-id="4472e-106">Все методы кодирования сосредоточены на буфере, используемом декодером для управления сжатыми входными данными.</span><span class="sxs-lookup"><span data-stu-id="4472e-106">The encoding methods all focus on the buffer used by the decoder to manage compressed input data.</span></span> <span data-ttu-id="4472e-107">Этот буфер определяется скоростью потока в битах в секунду и окном буфера в миллисекундах.</span><span class="sxs-lookup"><span data-stu-id="4472e-107">This buffer is defined by the bit rate of the stream, in bits per second, and the buffer window, in milliseconds.</span></span> <span data-ttu-id="4472e-108">При кодировании кодек придерживается ограничений буфера.</span><span class="sxs-lookup"><span data-stu-id="4472e-108">When encoding, the codec abides by the restraints of the buffer.</span></span> <span data-ttu-id="4472e-109">Дополнительные сведения о буфере см. [в разделе Модель буфера для сегмента утечки](the-leaky-bucket-buffer-model.md).</span><span class="sxs-lookup"><span data-stu-id="4472e-109">For more information about the buffer, see [The Leaky Bucket Buffer Model](the-leaky-bucket-buffer-model.md).</span></span>

## <a name="constant-bit-rate-encoding"></a><span data-ttu-id="4472e-110">Кодирование постоянной скорости потока</span><span class="sxs-lookup"><span data-stu-id="4472e-110">Constant Bit Rate Encoding</span></span>

<span data-ttu-id="4472e-111">Скорость потока, закодированная одним из кодеков аудио-и видеофайлов Windows Media, не является константой.</span><span class="sxs-lookup"><span data-stu-id="4472e-111">The bit rate for any stream encoded by one of the Windows Media Audio and Video codecs is not constant.</span></span> <span data-ttu-id="4472e-112">Кодирование с постоянной скоростью (CBR) — это, следовательно, неверное условие.</span><span class="sxs-lookup"><span data-stu-id="4472e-112">Constant bit rate (CBR) encoding is, therefore, a somewhat misleading term.</span></span> <span data-ttu-id="4472e-113">Отличительная особенность потока, закодированного с помощью CBR, — это небольшое окно буфера, которое ограничивает вариант размеров выборки.</span><span class="sxs-lookup"><span data-stu-id="4472e-113">The distinguishing feature of a CBR-encoded stream is a small buffer window, which limits the variation of sample sizes.</span></span> <span data-ttu-id="4472e-114">Кодировка CBR используется в основном для содержимого, которое передается в потоке по сети в место назначения.</span><span class="sxs-lookup"><span data-stu-id="4472e-114">CBR encoding is used primarily for content that is streamed over a network to its destination.</span></span> <span data-ttu-id="4472e-115">В таком случае важно иметь возможность полагаться на единообразное использование пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="4472e-115">In such a scenario, it is important to be able to rely on consistent bandwidth usage.</span></span>

<span data-ttu-id="4472e-116">С точки зрения конфигурации, кодировка CBR отличается от других режимов в том, что перед началом кодирования устанавливается как средняя скорость потока выходного содержимого, так и окно буфера, которое применяется к этой скорости.</span><span class="sxs-lookup"><span data-stu-id="4472e-116">From a configuration point of view, CBR encoding differs from the other modes in that before starting to encode, you set both the average bit rate of the output content, and the buffer window that applies to that bit rate.</span></span> <span data-ttu-id="4472e-117">В других режимах одно или оба этих значения неизвестны при настройке кодировщика и вычисляются кодеком во время кодирования.</span><span class="sxs-lookup"><span data-stu-id="4472e-117">In other modes, one or both of those values is unknown when you configure the encoder, and is computed by the codec while it encodes.</span></span> <span data-ttu-id="4472e-118">CBR — стандартный режим кодирования, используемый кодировщиком Windows Media Encoder дмос.</span><span class="sxs-lookup"><span data-stu-id="4472e-118">CBR is the standard encoding mode used by the Windows Media Encoder DMOs.</span></span>

## <a name="two-pass-constant-bit-rate-encoding"></a><span data-ttu-id="4472e-119">Кодирование постоянной скорости Two-Pass</span><span class="sxs-lookup"><span data-stu-id="4472e-119">Two-Pass Constant Bit Rate Encoding</span></span>

<span data-ttu-id="4472e-120">Стандартный CBR использует только один проход кодирования.</span><span class="sxs-lookup"><span data-stu-id="4472e-120">Standard CBR uses only a single encoding pass.</span></span> <span data-ttu-id="4472e-121">Вы предоставляете содержимое в качестве входных примеров, а кодек сжимает содержимое и возвращает выходные примеры.</span><span class="sxs-lookup"><span data-stu-id="4472e-121">You provide your content as input samples, and the codec compresses the content and returns output samples.</span></span> <span data-ttu-id="4472e-122">Также можно дважды обработать входные примеры.</span><span class="sxs-lookup"><span data-stu-id="4472e-122">It is also possible to process input samples twice.</span></span> <span data-ttu-id="4472e-123">На первом этапе кодек выполняет вычисления для оптимизации кодирования содержимого.</span><span class="sxs-lookup"><span data-stu-id="4472e-123">On the first pass, the codec performs calculations to optimize encoding for your content.</span></span> <span data-ttu-id="4472e-124">На втором этапе кодек использует данные, собранные во время первого прохода для кодирования содержимого.</span><span class="sxs-lookup"><span data-stu-id="4472e-124">On the second pass, the codec uses the data gathered during the first pass to encode the content.</span></span>

<span data-ttu-id="4472e-125">CBR кодировка с двумя проходами имеет много преимуществ.</span><span class="sxs-lookup"><span data-stu-id="4472e-125">Two-pass CBR encoding has many advantages.</span></span> <span data-ttu-id="4472e-126">Он часто дает значительные преимущества по сравнению со стандартной кодировкой CBR, не изменяя никаких требований к буферизации.</span><span class="sxs-lookup"><span data-stu-id="4472e-126">It often yields significant quality gains over standard CBR encoding without changing any of the buffering requirements.</span></span> <span data-ttu-id="4472e-127">Это делает этот режим кодировки идеальным для содержимого, переходящего по сети.</span><span class="sxs-lookup"><span data-stu-id="4472e-127">This makes this encoding mode ideal for content that is streamed over a network.</span></span> <span data-ttu-id="4472e-128">Единственная ситуация, в которой два этапа CBR нецелесообразна, заключается в том, что вы кодируете содержимое из активного источника и не можете использовать второй проход.</span><span class="sxs-lookup"><span data-stu-id="4472e-128">The only situation where two-pass CBR is not feasible is when you encode content from a live source and cannot use a second pass.</span></span>

<span data-ttu-id="4472e-129">Тип выходного носителя CBR потока данных идентичен стандартному потоку CBR. Вы по-прежнему указываете скорость и окно буфера для использования.</span><span class="sxs-lookup"><span data-stu-id="4472e-129">The output media type of a two-pass CBR stream is identical to that of a standard CBR stream; you still specify the bit rate and buffer window to use.</span></span> <span data-ttu-id="4472e-130">При настройке DMO необходимо задать для него выполнение двух этапов.</span><span class="sxs-lookup"><span data-stu-id="4472e-130">When configuring the DMO, you must set it to perform two passes.</span></span> <span data-ttu-id="4472e-131">И необходимо уведомить DMO по завершении отправки образцов для первого прохода.</span><span class="sxs-lookup"><span data-stu-id="4472e-131">And you must notify the DMO when you are finished sending samples for the first pass.</span></span>

## <a name="quality-based-variable-bit-rate-encoding"></a><span data-ttu-id="4472e-132">Quality-Based кодирование переменной скорости</span><span class="sxs-lookup"><span data-stu-id="4472e-132">Quality-Based Variable Bit Rate Encoding</span></span>

<span data-ttu-id="4472e-133">Поскольку кодировка CBR на самом деле не поддерживает постоянную скорость потока, различие между ней и переменной скоростью кодирования (VBR) может показаться немного Хази.</span><span class="sxs-lookup"><span data-stu-id="4472e-133">Because CBR encoding does not actually maintain a constant bit rate, the distinction between it and variable bit rate encoding (VBR) may seem a little hazy.</span></span> <span data-ttu-id="4472e-134">Основное различие между CBR и VBR — размер используемого окна буфера.</span><span class="sxs-lookup"><span data-stu-id="4472e-134">The primary difference between CBR and VBR is the size of the buffer window used.</span></span> <span data-ttu-id="4472e-135">Потоки с кодированием VBR обычно имеют большие окна буфера по сравнению с потоками, закодированными CBR.</span><span class="sxs-lookup"><span data-stu-id="4472e-135">VBR-encoded streams usually have large buffer windows compared to CBR-encoded streams.</span></span> <span data-ttu-id="4472e-136">Частота, основанная на уровне качества, не является исключением. в этом случае для него не определена скорость или окно буфера.</span><span class="sxs-lookup"><span data-stu-id="4472e-136">Quality-based VBR is no exception, in that you define neither bit rate nor buffer window for it.</span></span> <span data-ttu-id="4472e-137">Вместо этого задается значение качества.</span><span class="sxs-lookup"><span data-stu-id="4472e-137">Instead, you set a quality value.</span></span> <span data-ttu-id="4472e-138">Затем кодек пытается сжать данные, чтобы качество закодированного носителя было согласованным в течение всего времени, независимо от требований к буферу результирующего потока.</span><span class="sxs-lookup"><span data-stu-id="4472e-138">The codec then attempts to compress the data so that the quality of the encoded media is consistent throughout its duration, regardless of the buffer requirements of the resulting stream.</span></span>

<span data-ttu-id="4472e-139">На основе качества VBR используется один проход кодирования, который обычно создает большие сжатые потоки.</span><span class="sxs-lookup"><span data-stu-id="4472e-139">Quality-based VBR uses a single encoding pass and tends to create large compressed streams.</span></span> <span data-ttu-id="4472e-140">После завершения кодирования кодек устанавливает требования к буферу, чтобы декодер мог распаковать данные.</span><span class="sxs-lookup"><span data-stu-id="4472e-140">When encoding is complete, the codec sets the buffer requirements so that the decoder can decompress the data.</span></span> <span data-ttu-id="4472e-141">Закодированный поток VBR не подходит для потоковой передачи по сети, поэтому скорость на основе качества должна использоваться только для локальных сценариев воспроизведения (или для загрузки и воспроизведения).</span><span class="sxs-lookup"><span data-stu-id="4472e-141">The encoded VBR stream is not suitable for streaming over a network, so quality-based VBR should be used only for local playback scenarios (or download and play).</span></span>

## <a name="unconstrained-variable-bit-rate-encoding"></a><span data-ttu-id="4472e-142">Кодирование переменной скорости с неограниченным битом</span><span class="sxs-lookup"><span data-stu-id="4472e-142">Unconstrained Variable Bit Rate Encoding</span></span>

<span data-ttu-id="4472e-143">В отличие от VBR с неограниченным качеством, неограниченное значение VBR не кодируется на конкретный уровень качества.</span><span class="sxs-lookup"><span data-stu-id="4472e-143">Unlike quality-based VBR, unconstrained VBR does not encode to a specific quality level.</span></span> <span data-ttu-id="4472e-144">Вместо этого он кодирует содержимое на максимально возможное качество, сохраняя заданную скорость.</span><span class="sxs-lookup"><span data-stu-id="4472e-144">Instead, it encodes the content to the highest possible quality while maintaining a specified bit rate.</span></span> <span data-ttu-id="4472e-145">Неограниченная VBR использует два прохода кодирования и похожа на два прохода CBR, за исключением того, что для потока не задан параметр окна буфера.</span><span class="sxs-lookup"><span data-stu-id="4472e-145">Unconstrained VBR uses two encoding passes and is similar to two-pass CBR, except that you do not specify a buffer window setting for the stream.</span></span> <span data-ttu-id="4472e-146">Это означает, что ограничение размера отдельных выборок в потоке не ограничено, если средняя скорость потока меньше или равна заданному значению.</span><span class="sxs-lookup"><span data-stu-id="4472e-146">This means that there is no limit to the size of individual samples in the stream, as long as the average bit rate is less than or equal to the value you set.</span></span>

<span data-ttu-id="4472e-147">Неограниченная VBR имеет ограниченный объем использования, так как существует несколько сценариев воспроизведения, требующих сохранения требований к буферу.</span><span class="sxs-lookup"><span data-stu-id="4472e-147">Unconstrained VBR is of limited use, because there are few playback scenarios that have requirements in keeping with its buffer requirements.</span></span> <span data-ttu-id="4472e-148">Кодек может установить в окне буфера любое значение, необходимое после кодирования, что позволяет не контролировать размер буфера.</span><span class="sxs-lookup"><span data-stu-id="4472e-148">The codec can set the buffer window to whatever value is required after encoding, giving you no control over the buffer size.</span></span> <span data-ttu-id="4472e-149">В большинстве случаев, если вы не собираетесь беспокоиться о размере буфера или при согласовании использования пропускной способности, следует использовать значение VBR на основе качества.</span><span class="sxs-lookup"><span data-stu-id="4472e-149">In most cases, if you are not concerned about the size of the buffer or the consistency of bandwidth usage, you should use quality-based VBR.</span></span>

## <a name="peak-constrained-variable-bit-rate-encoding"></a><span data-ttu-id="4472e-150">Peak-Constrained кодирование переменной скорости</span><span class="sxs-lookup"><span data-stu-id="4472e-150">Peak-Constrained Variable Bit Rate Encoding</span></span>

<span data-ttu-id="4472e-151">Режим последней кодировки — Пиковая с ограниченным числом VBR.</span><span class="sxs-lookup"><span data-stu-id="4472e-151">The final encoding mode is peak-constrained VBR.</span></span> <span data-ttu-id="4472e-152">Как и в случае с неограниченными VBR, в этом режиме используется два прохода кодирования и кодируется в указанную скорость.</span><span class="sxs-lookup"><span data-stu-id="4472e-152">Like unconstrained VBR, this mode uses two encoding passes and encodes to a specified bit rate.</span></span> <span data-ttu-id="4472e-153">Однако с пиковым числом VBR также настраивается пиковое значение для кодировки.</span><span class="sxs-lookup"><span data-stu-id="4472e-153">However, with peak constrained VBR you also configure the peak value for the encoding.</span></span> <span data-ttu-id="4472e-154">Пиковые значения похожи на обычные значения конфигурации буфера: Пиковая скорость и пиковое окно буфера.</span><span class="sxs-lookup"><span data-stu-id="4472e-154">Peak values are similar to normal buffer configuration values: there is a peak bit rate and a peak buffer window.</span></span> <span data-ttu-id="4472e-155">Файл кодируется в соответствии с буфером, описанным в пиковых значениях, с условием, что общая средняя скорость потока равна или меньше средней указанной величине скорости.</span><span class="sxs-lookup"><span data-stu-id="4472e-155">The file is encoded to conform to a buffer described by the peak values, with the condition that the overall average bit rate of the stream be equal to or less than the average bit rate value you specify.</span></span>

<span data-ttu-id="4472e-156">Ограниченные VBR могут быть трудно концептуализировать.</span><span class="sxs-lookup"><span data-stu-id="4472e-156">Constrained VBR can be difficult to conceptualize.</span></span> <span data-ttu-id="4472e-157">Ниже приведен самый простой способ представить используемую модель буферизации.</span><span class="sxs-lookup"><span data-stu-id="4472e-157">Here is the easiest way to think of the buffering model used.</span></span> <span data-ttu-id="4472e-158">Предположим, поток представляет собой поток CBR с пиковой скоростью потока и пиковым окном буфера, используемым для определения буфера.</span><span class="sxs-lookup"><span data-stu-id="4472e-158">Suppose the stream is a CBR stream with the peak bit rate and peak buffer window used to define the buffer.</span></span> <span data-ttu-id="4472e-159">Как правило, Пиковая скорость очень высока.</span><span class="sxs-lookup"><span data-stu-id="4472e-159">Typically, the peak bit rate is quite high.</span></span> <span data-ttu-id="4472e-160">Кодировщик гарантирует, что ожидаемое среднее значение скорости передачи, которое вы указали, будет поддерживаться на протяжении потока.</span><span class="sxs-lookup"><span data-stu-id="4472e-160">The encoder ensures that the expected average bit rate value you indicate is maintained over the duration of the stream.</span></span> <span data-ttu-id="4472e-161">В любой конкретный момент в потоке средняя скорость потока гарантированно превышает общий размер в битах, деленный на длительность потока в секундах).</span><span class="sxs-lookup"><span data-stu-id="4472e-161">At any particular point in the stream, the average bit rate is guaranteed to be greater than the total stream size in bits divided by the stream duration in seconds).</span></span>

<span data-ttu-id="4472e-162">Рассмотрим следующий пример: вы настраиваете поток с средним битом скорости в 16 000 бит/с, пиковой скоростью в 48 000 бит/с и пиковым окном буфера в 3 000 (3 секунды).</span><span class="sxs-lookup"><span data-stu-id="4472e-162">Consider the following example: You configure a stream with an average bit rate of 16,000 bits per second, a peak bit rate of 48,000 bits per second, and a peak buffer window of 3,000 (3 seconds).</span></span> <span data-ttu-id="4472e-163">Размер буфера, используемого для потока, составляет 144 000 бит (48 000 бит в секунду x 3 секунды), определяемый значениями пиковой нагрузки.</span><span class="sxs-lookup"><span data-stu-id="4472e-163">The size of the buffer used for the stream is 144,000 bits (48,000 bits per second x 3 seconds) as determined by the peak values.</span></span> <span data-ttu-id="4472e-164">Кодировщик сжимает данные, чтобы они соответствовали этому буферу.</span><span class="sxs-lookup"><span data-stu-id="4472e-164">The encoder compresses the data to conform to that buffer.</span></span> <span data-ttu-id="4472e-165">Кроме того, средняя скорость потока должна составлять 16 000 или меньше.</span><span class="sxs-lookup"><span data-stu-id="4472e-165">Additionally, the average bit rate of the stream must be 16,000 or less.</span></span> <span data-ttu-id="4472e-166">Если кодировщику необходимо сделать несколько очень больших выборок для работы с сложным сегментом содержимого, то может воспользоваться преимуществами большого размера буфера.</span><span class="sxs-lookup"><span data-stu-id="4472e-166">If the encoder needs to make some very large samples to handle a complex segment of content, it can take advantage of the large buffer size.</span></span> <span data-ttu-id="4472e-167">Однако другие части потока должны быть закодированы с более низкой скоростью, чтобы сократить среднее до указанного уровня.</span><span class="sxs-lookup"><span data-stu-id="4472e-167">But other parts of the stream must be encoded at a lower bit rate to bring the average down to the specified level.</span></span>

<span data-ttu-id="4472e-168">Скорость кодирования с ограничением в пиковую пользу полезна для устройств воспроизведения с ограниченной емкостью буфера и некоторыми ограничениями на скорость передачи данных.</span><span class="sxs-lookup"><span data-stu-id="4472e-168">Peak-constrained VBR encoding is useful for playback devices with a finite buffer capacity and some data rate constraints.</span></span> <span data-ttu-id="4472e-169">Распространенный пример — это кодировка, используемая для DVD.</span><span class="sxs-lookup"><span data-stu-id="4472e-169">A common example of this is the encoding used for DVDs.</span></span>

## <a name="related-topics"></a><span data-ttu-id="4472e-170">См. также</span><span class="sxs-lookup"><span data-stu-id="4472e-170">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4472e-171">Использование кодирования VBR</span><span class="sxs-lookup"><span data-stu-id="4472e-171">Using VBR Encoding</span></span>](usingvbrencoding.md)
</dt> <dt>

[<span data-ttu-id="4472e-172">Кодеки Windows Media</span><span class="sxs-lookup"><span data-stu-id="4472e-172">Windows Media Codecs</span></span>](windows-media-codecs.md)
</dt> </dl>

 

 



