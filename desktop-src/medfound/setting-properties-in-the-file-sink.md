---
description: Приемник ASF-файлов — это реализация Имфмедиасинк, предоставляемая Media Foundation, которую приложение может использовать для архивации данных ASF Media в файл. Сведения об объектной модели приемников ASF Media и общем использовании см. в статье приемники мультимедиа ASF.
ms.assetid: a47caabd-23e3-4d22-b4b6-5fdb79d62ca1
title: Задание свойств в приемнике файла
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 30af39cf13e88f6edf2a6ab68caac27c2400955a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104344402"
---
# <a name="setting-properties-in-the-file-sink"></a><span data-ttu-id="9cf70-104">Задание свойств в приемнике файла</span><span class="sxs-lookup"><span data-stu-id="9cf70-104">Setting Properties in the File Sink</span></span>

<span data-ttu-id="9cf70-105">Приемник ASF-файлов — это реализация [**имфмедиасинк**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) , предоставляемая Media Foundation, которую приложение может использовать для архивации данных ASF Media в файл.</span><span class="sxs-lookup"><span data-stu-id="9cf70-105">The ASF file sink is an implementation of [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) provided by Media Foundation that an application can use to archive ASF media data to a file.</span></span> <span data-ttu-id="9cf70-106">Сведения об объектной модели приемников ASF Media и общем использовании см. в статье [приемники мультимедиа ASF](asf-media-sinks.md).</span><span class="sxs-lookup"><span data-stu-id="9cf70-106">For information about ASF Media Sinks' object model and general usage, see [ASF Media Sinks](asf-media-sinks.md).</span></span>

<span data-ttu-id="9cf70-107">После [создания приемника файлов ASF](creating-the-asf-file-sink.md)его необходимо настроить с помощью сведений о потоках в выходном файле.</span><span class="sxs-lookup"><span data-stu-id="9cf70-107">After [Creating the ASF file sink](creating-the-asf-file-sink.md), it must be configured with information about the streams in the output file.</span></span> <span data-ttu-id="9cf70-108">Эта процедура описана в разделе [Добавление сведений о потоке в приемник ASF-файлов](adding-stream-information-to-the-asf-file-sink.md).</span><span class="sxs-lookup"><span data-stu-id="9cf70-108">This procedure is described in [Adding Stream Information to the ASF File Sink](adding-stream-information-to-the-asf-file-sink.md).</span></span> <span data-ttu-id="9cf70-109">В зависимости от типа кодировки можно задать дополнительные свойства для приемника файлов. сегменты утечки; Общие свойства файла.</span><span class="sxs-lookup"><span data-stu-id="9cf70-109">You can set additional properties on the file sink depending on the type of encoding; leaky buckets; general file properties.</span></span> <span data-ttu-id="9cf70-110">Эти параметры не записываются в окончательный объект заголовка ASF.</span><span class="sxs-lookup"><span data-stu-id="9cf70-110">These settings are not written in the final ASF Header Object.</span></span> <span data-ttu-id="9cf70-111">В этом разделе описывается процесс добавления этих свойств в хранилище свойств приемника файлов.</span><span class="sxs-lookup"><span data-stu-id="9cf70-111">This topic describes process of adding these properties in the file sink's property store.</span></span>

<span data-ttu-id="9cf70-112">Объект Контентинфо хранит свойства глобального файла и отдельные свойства потока для приемника файла.</span><span class="sxs-lookup"><span data-stu-id="9cf70-112">The ContentInfo object maintains the global file properties and individual stream properties for the file sink.</span></span> <span data-ttu-id="9cf70-113">Дополнительные сведения о получении ссылки на объект ASF Контентинфо в приемнике файлов см. [в разделе Создание приемника файлов ASF](creating-the-asf-file-sink.md).</span><span class="sxs-lookup"><span data-stu-id="9cf70-113">For information about getting a reference to the file sink's ASF ContentInfo object, see [Creating the ASF File Sink](creating-the-asf-file-sink.md).</span></span>

<span data-ttu-id="9cf70-114">Чтобы получить ссылку на хранилище свойств приемника файла ([**ипропертисторе**](/windows/win32/api/propsys/nn-propsys-ipropertystore)), вызовите [**Имфасфконтентинфо:: жетенкодингконфигуратионпропертисторе**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfcontentinfo-getencodingconfigurationpropertystore) в ссылке на объект контентинфо файла приемника файлов.</span><span class="sxs-lookup"><span data-stu-id="9cf70-114">To get a reference to the file sink's property store ([**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore)), call [**IMFASFContentInfo::GetEncodingConfigurationPropertyStore**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfcontentinfo-getencodingconfigurationpropertystore) on the file sink's ContentInfo object's reference.</span></span>

## <a name="stream-encoding-properties"></a><span data-ttu-id="9cf70-115">Свойства кодирования потока</span><span class="sxs-lookup"><span data-stu-id="9cf70-115">Stream Encoding Properties</span></span>

<span data-ttu-id="9cf70-116">Для правильного кодирования содержимого файл должен иметь определенные сведения о кодировке, такие как тип кодировки и связанные параметры кодировки.</span><span class="sxs-lookup"><span data-stu-id="9cf70-116">To encode content properly the file needs to know certain encoding information such as type of encoding and the related encoding parameters.</span></span> <span data-ttu-id="9cf70-117">Эти значения задаются в приемнике файлов как значения свойств в хранилище свойств, которое поддерживается объектом ASF Контентинфо.</span><span class="sxs-lookup"><span data-stu-id="9cf70-117">These values are set on the file sink as property values in a property store that is maintained by the ASF ContentInfo object.</span></span> <span data-ttu-id="9cf70-118">Если вы настраиваете приемник файлов перед созданием экземпляров соответствующих кодировщиков, можно использовать объект Контентинфо со всеми заполненными свойствами для создания кодировщиков Windows Media.</span><span class="sxs-lookup"><span data-stu-id="9cf70-118">If you are configuring the file sink before instantiating the relevant encoders, you can use the ContentInfo object with all the populated properties to create the Windows Media encoders.</span></span> <span data-ttu-id="9cf70-119">В этом случае свойства автоматически устанавливаются для экземпляров кодировщиков.</span><span class="sxs-lookup"><span data-stu-id="9cf70-119">In this case, the properties are automatically set on the instantiated encoders.</span></span> <span data-ttu-id="9cf70-120">И наоборот, если вы создаете кодировщики перед приемником, убедитесь, что свойства, заданные в кодировщиках, копируются в хранилище свойств приемника файлов.</span><span class="sxs-lookup"><span data-stu-id="9cf70-120">Conversely, if you are creating the encoders before the sink, make sure that the properties that you set on the encoders are copied into the file sink's property store.</span></span>

<span data-ttu-id="9cf70-121">Чтобы задать свойства кодировки, необходим доступ к хранилищу свойств на уровне потока для приемника файла.</span><span class="sxs-lookup"><span data-stu-id="9cf70-121">To set encoding properties, you need access to the file sink's stream-level property store.</span></span> <span data-ttu-id="9cf70-122">Передайте номер потока в параметре *встреамнумбер* метода [**Имфасфконтентинфо:: жетенкодингконфигуратионпропертисторе**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfcontentinfo-getencodingconfigurationpropertystore) .</span><span class="sxs-lookup"><span data-stu-id="9cf70-122">Pass the stream number in the *wStreamNumber* parameter of the [**IMFASFContentInfo::GetEncodingConfigurationPropertyStore**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfcontentinfo-getencodingconfigurationpropertystore) method.</span></span> <span data-ttu-id="9cf70-123">Номера потоков должны совпадать со значениями, заданными при настройке каждого потока в профиле.</span><span class="sxs-lookup"><span data-stu-id="9cf70-123">The stream numbers must match the values set while configuring each stream in the profile.</span></span> <span data-ttu-id="9cf70-124">Значения свойств задаются путем вызова метода [**ипропертисторе:: SetValue**](/windows/win32/api/propsys/nn-propsys-ipropertystore).</span><span class="sxs-lookup"><span data-stu-id="9cf70-124">Property values are set by calling [**IPropertyStore::SetValue**](/windows/win32/api/propsys/nn-propsys-ipropertystore).</span></span> <span data-ttu-id="9cf70-125">В следующей таблице описаны поддерживаемые свойства.</span><span class="sxs-lookup"><span data-stu-id="9cf70-125">The following table describes the supported properties.</span></span>

<span data-ttu-id="9cf70-126">Свойства зависят от типа кодировки.</span><span class="sxs-lookup"><span data-stu-id="9cf70-126">The properties depend on the type of encoding.</span></span> <span data-ttu-id="9cf70-127">Сведения о свойствах и соответствующих значениях, которые необходимо задать, см. в разделе [Свойства кодировки](configuring-the-encoder.md).</span><span class="sxs-lookup"><span data-stu-id="9cf70-127">For information about the properties and the respective values that you must set, see [Encoding Properties](configuring-the-encoder.md).</span></span>

## <a name="leaky-bucket-property"></a><span data-ttu-id="9cf70-128">Свойство контейнера с утечкой</span><span class="sxs-lookup"><span data-stu-id="9cf70-128">Leaky Bucket Property</span></span>

<span data-ttu-id="9cf70-129">Параметры сегмента с утечкой определяют фактическое окно буфера, используемое кодировщиком для потока.</span><span class="sxs-lookup"><span data-stu-id="9cf70-129">Leaky bucket parameters determine the actual buffer window used by the encoder for the stream.</span></span> <span data-ttu-id="9cf70-130">Свойство [**мфпкэй \_ асфстреамсинк \_ \_**](mfpkey-asfstreamsink-corrected-leakybucket-property.md) для приемника файлов содержит параметры контейнера с утечкой, скорость потока, окно буфера и заполнение исходного буфера. Это свойство задается в хранилище свойств уровня потока для приемника файла и должно быть задано после создания и настройки кодировщиков.</span><span class="sxs-lookup"><span data-stu-id="9cf70-130">The file sink's [**MFPKEY\_ASFSTREAMSINK\_CORRECTED\_LEAKYBUCKET**](mfpkey-asfstreamsink-corrected-leakybucket-property.md) property contains the leaky bucket parameters, bit rate, buffer window, and initial buffer fullness.This property is set in the stream-level property property store for the file sink and must be set after encoders have been created and configured.</span></span> <span data-ttu-id="9cf70-131">Это значение задается в.</span><span class="sxs-lookup"><span data-stu-id="9cf70-131">This value is set in the .</span></span> <span data-ttu-id="9cf70-132">Во время согласования типа мультимедиа кодировщик решает окно буфера и используемую скорость.</span><span class="sxs-lookup"><span data-stu-id="9cf70-132">During the media type negotiation, the encoder decides the buffer window and the bit rate to use.</span></span> <span data-ttu-id="9cf70-133">Эти значения можно получить с помощью интерфейса **ивмкодеклеакибуккет** , который определен в вмкодеЦифацес. h, и необходимо создать ссылку на вмкодекдспууид. lib для вызова его методов.</span><span class="sxs-lookup"><span data-stu-id="9cf70-133">You can get these values by using the **IWMCodecLeakyBucket** interface, which is defined in wmcodecifaces.h and you must link to wmcodecdspuuid.lib to call its methods.</span></span>

<span data-ttu-id="9cf70-134">Извлеченные значения можно задать для этого свойства в каждом потоке в приемнике файлов ASF.</span><span class="sxs-lookup"><span data-stu-id="9cf70-134">The retrieved values can be set for this property for each stream in the ASF file sink.</span></span>

## <a name="global-file-sink-properties"></a><span data-ttu-id="9cf70-135">Свойства приемника глобальных файлов</span><span class="sxs-lookup"><span data-stu-id="9cf70-135">Global File Sink Properties</span></span>

<span data-ttu-id="9cf70-136">Чтобы получить глобальное хранилище свойств приемника файлов, передайте 0 в параметре *встреамнумбер* метода [**Имфасфконтентинфо:: жетенкодингконфигуратионпропертисторе**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfcontentinfo-getencodingconfigurationpropertystore) .</span><span class="sxs-lookup"><span data-stu-id="9cf70-136">To get the file sink's global property store, pass 0 in the *wStreamNumber* parameter of the [**IMFASFContentInfo::GetEncodingConfigurationPropertyStore**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfcontentinfo-getencodingconfigurationpropertystore) method.</span></span> <span data-ttu-id="9cf70-137">Значения свойств задаются путем вызова метода [**ипропертисторе:: SetValue**](/windows/win32/api/propsys/nn-propsys-ipropertystore).</span><span class="sxs-lookup"><span data-stu-id="9cf70-137">Property values are set by calling [**IPropertyStore::SetValue**](/windows/win32/api/propsys/nn-propsys-ipropertystore).</span></span> <span data-ttu-id="9cf70-138">В следующей таблице описаны поддерживаемые свойства.</span><span class="sxs-lookup"><span data-stu-id="9cf70-138">The following table describes the supported properties.</span></span>

| <span data-ttu-id="9cf70-139">Свойства уровня файла</span><span class="sxs-lookup"><span data-stu-id="9cf70-139">File-level Properties</span></span>                                                                                | <span data-ttu-id="9cf70-140">Описание</span><span class="sxs-lookup"><span data-stu-id="9cf70-140">Description</span></span>                                                                                                                                                                                                                                                                                           |
|------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="9cf70-141">**МФПКЭЙ \_ асфмедиасинк \_ Base \_ сендтиме**</span><span class="sxs-lookup"><span data-stu-id="9cf70-141">**MFPKEY\_ASFMEDIASINK\_BASE\_SENDTIME**</span></span>](mfpkey-asfmediasink-base-sendtime-property.md)           | <span data-ttu-id="9cf70-142">Время отправки указывает, когда будут освобождены полезные данные внутри сегмента утечки.</span><span class="sxs-lookup"><span data-stu-id="9cf70-142">The send time indicates when the payload inside the leaky bucket will be released.</span></span> <span data-ttu-id="9cf70-143">Это значение свойства указывает первое время отправки.</span><span class="sxs-lookup"><span data-stu-id="9cf70-143">This property value indicates the first send time.</span></span> <span data-ttu-id="9cf70-144">Мультиплексор использует это значение для вычисления последующего времени отправки для созданных пакетов и гарантирует, что данные непрерывно проходят через сегмент утечки.</span><span class="sxs-lookup"><span data-stu-id="9cf70-144">The multiplexer uses this value to calculate the subsequent send times for the generated packets and ensures that data flows steadily through the leaky bucket.</span></span> |
| [<span data-ttu-id="9cf70-145">**МФПКЭЙ \_ асфмедиасинк \_ АВТОнастройка скорости \_**</span><span class="sxs-lookup"><span data-stu-id="9cf70-145">**MFPKEY\_ASFMEDIASINK\_AUTOADJUST\_BITRATE**</span></span>](mfpkey-asfmediasink-autoadjust-bitrate-property.md) | <span data-ttu-id="9cf70-146">Это логическое значение указывает, нужно ли мультиплексору автоматически настраивать скорость потока, чтобы гарантировать, что данные не будут переполнены контейнером утечки.</span><span class="sxs-lookup"><span data-stu-id="9cf70-146">This BOOL value indicates whether the multiplexer needs to adjust the bit rate automatically to ensure that data does not overflow the leaky bucket.</span></span>                                                                                                                                                  |
| [<span data-ttu-id="9cf70-147">**МФПКЭЙ \_ асфмедиасинк \_ дрмактион**</span><span class="sxs-lookup"><span data-stu-id="9cf70-147">**MFPKEY\_ASFMEDIASINK\_DRMACTION**</span></span>](mfpkey-asfmediasink-drmaction-property.md)                    | <span data-ttu-id="9cf70-148">Указывает действие DRM для приемника мультимедиа ASF при создании файла.</span><span class="sxs-lookup"><span data-stu-id="9cf70-148">This indicates the ASF media sink DRM action for file generation.</span></span> <span data-ttu-id="9cf70-149">В этом выпуске поддерживается только перекодировать DRM.</span><span class="sxs-lookup"><span data-stu-id="9cf70-149">In this release, only DRM transcode is supported.</span></span>                                                                                                                                                                                   |



 

## <a name="related-topics"></a><span data-ttu-id="9cf70-150">См. также</span><span class="sxs-lookup"><span data-stu-id="9cf70-150">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="9cf70-151">Приемники мультимедиа ASF</span><span class="sxs-lookup"><span data-stu-id="9cf70-151">ASF Media Sinks</span></span>](asf-media-sinks.md)
</dt> <dt>

[<span data-ttu-id="9cf70-152">Компоненты ASF уровня конвейера</span><span class="sxs-lookup"><span data-stu-id="9cf70-152">Pipeline Layer ASF Components</span></span>](pipeline-layer-asf-components.md)
</dt> <dt>

[<span data-ttu-id="9cf70-153">Поддержка ASF в Media Foundation</span><span class="sxs-lookup"><span data-stu-id="9cf70-153">ASF Support in Media Foundation</span></span>](asf-support-in-media-foundation.md)
</dt> </dl>

 

 
