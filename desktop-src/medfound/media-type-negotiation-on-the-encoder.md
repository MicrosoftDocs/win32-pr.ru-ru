---
description: Согласование типов мультимедиа в кодировщике
ms.assetid: c8ae543e-68f7-4c74-9cb7-2a200bd51820
title: Согласование типов мультимедиа в кодировщике
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c7845e9d50c5d418198dc0e08313e2e9329ffab8
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "103999970"
---
# <a name="media-type-negotiation-on-the-encoder"></a><span data-ttu-id="ec6c5-103">Согласование типов мультимедиа в кодировщике</span><span class="sxs-lookup"><span data-stu-id="ec6c5-103">Media Type Negotiation on the Encoder</span></span>

<span data-ttu-id="ec6c5-104">В Microsoft Media Foundation кодировщики реализуются как [Media Foundation преобразования](media-foundation-transforms.md) (МФТС) с одним входом и одним выходом.</span><span class="sxs-lookup"><span data-stu-id="ec6c5-104">In Microsoft Media Foundation, encoders are implemented as [Media Foundation transforms](media-foundation-transforms.md) (MFTs) with one input and one output.</span></span> <span data-ttu-id="ec6c5-105">Перед сеансом кодирования кодировщику необходимо выяснить характеристики потока, который он получает в качестве входных данных, и формат потока, который он будет выдавать в качестве выходных данных.</span><span class="sxs-lookup"><span data-stu-id="ec6c5-105">Before an encoding session, an encoder needs to know the characteristics of the stream it will receive as input and the format of the stream it will produce as output.</span></span> <span data-ttu-id="ec6c5-106">Перед передачей данных через кодировщик необходимо задать типы входных и выходных носителей и связанные характеристики.</span><span class="sxs-lookup"><span data-stu-id="ec6c5-106">You must set the input and output media types and related characteristics before you pass data through the encoder.</span></span> <span data-ttu-id="ec6c5-107">Необходимо указать форматы входных и выходных данных, указав соответствующие [идентификаторы GUID типа носителя](media-type-guids.md) и задав характеристики выходного потока, установив соответствующие [атрибуты типа мультимедиа](media-type-attributes.md) для выходного типа носителя.</span><span class="sxs-lookup"><span data-stu-id="ec6c5-107">You must supply the input and output formats by specifying the appropriate [Media Type GUIDs](media-type-guids.md) and set the characteristics of the output stream by setting the relevant [Media Type Attributes](media-type-attributes.md) on the output media type.</span></span> <span data-ttu-id="ec6c5-108">В новом экземпляре кодировщика не заданы типы носителей.</span><span class="sxs-lookup"><span data-stu-id="ec6c5-108">A newly instantiated encoder does not have any set media types.</span></span>

<span data-ttu-id="ec6c5-109">Тип входного носителя — это несжатый формат, например видеозапись PCM или видео в формате RGB.</span><span class="sxs-lookup"><span data-stu-id="ec6c5-109">The input media type is an uncompressed format, such as PCM audio or RGB video.</span></span> <span data-ttu-id="ec6c5-110">Типы форматов, используемые кодировщиком, ограничиваются теми, которые описаны структурами **видеоинфохеадер** и **вавеформатекс** .</span><span class="sxs-lookup"><span data-stu-id="ec6c5-110">The format types that are used by the encoder are limited to those described by the **VIDEOINFOHEADER** and **WAVEFORMATEX** structures.</span></span> <span data-ttu-id="ec6c5-111">Дополнительные сведения об этих структурах см. в документации по Windows SDK. Media Foundation предоставляет вспомогательные функции для создания типов мультимедиа из структур форматов.</span><span class="sxs-lookup"><span data-stu-id="ec6c5-111">For more information about these structures, see the Windows SDK documentation.Media foundation provides helper functions to create media types from format structures.</span></span> <span data-ttu-id="ec6c5-112">Например, функция [**мфинитмедиатипефромвидеоинфохеадер**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromvideoinfoheader) инициализирует тип видео из структуры **видеоинфохеадер** , а функция [**мфинитмедиатипефромвавеформатекс**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromwaveformatex) инициализирует тип видео из структуры **WAVEFORMATEX** или **WAVEFORMATEXTENSIBLE** .</span><span class="sxs-lookup"><span data-stu-id="ec6c5-112">For example, the [**MFInitMediaTypeFromVideoInfoHeader**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromvideoinfoheader) function initializes a video type from a **VIDEOINFOHEADER** structure, and the [**MFInitMediaTypeFromWaveFormatEx**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromwaveformatex) function initializes a video type from a **WAVEFORMATEX** or **WAVEFORMATEXTENSIBLE** structure.</span></span> <span data-ttu-id="ec6c5-113">Дополнительные сведения см. в разделе [преобразования типов мультимедиа](media-type-conversions.md).</span><span class="sxs-lookup"><span data-stu-id="ec6c5-113">For more information, see [Media Type Conversions](media-type-conversions.md).</span></span> <span data-ttu-id="ec6c5-114">Необходимо задать тип входного носителя в кодировщике, вызвав [**имфтрансформ:: сетинпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype).</span><span class="sxs-lookup"><span data-stu-id="ec6c5-114">You must set the input media type on the encoder by calling [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype).</span></span>

<span data-ttu-id="ec6c5-115">Тип выходного носителя — это формат сжатия, используемый в окончательном исходном потоке или файле.</span><span class="sxs-lookup"><span data-stu-id="ec6c5-115">The output media type is the compression format used in the final source stream or file.</span></span> <span data-ttu-id="ec6c5-116">Тип доступного выходного носителя можно задать только после задания типа входного носителя.</span><span class="sxs-lookup"><span data-stu-id="ec6c5-116">You can set the available output media type only after setting the input media type.</span></span> <span data-ttu-id="ec6c5-117">Поддерживаемые типы выходных данных можно получить, вызвав [**имфтрансформ:: жетаутпутаваилаблетипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) в цикле до тех пор, пока кодировщик не возвратит значение **MF \_ E больше \_ \_ \_ типов**.</span><span class="sxs-lookup"><span data-stu-id="ec6c5-117">You can retrieve the supported output types by calling [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) in a loop until the encoder returns **MF\_E\_NO\_MORE\_TYPES**.</span></span> <span data-ttu-id="ec6c5-118">Увеличьте индекс типа с каждой итерацией.</span><span class="sxs-lookup"><span data-stu-id="ec6c5-118">Increment the type index with each iteration.</span></span> <span data-ttu-id="ec6c5-119">При обнаружении соответствующего типа носителя задайте тип выходного носителя, вызвав [**имфтрансформ:: сетаутпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span><span class="sxs-lookup"><span data-stu-id="ec6c5-119">When you find an appropriate media type, set the output media type by calling [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span></span>

<span data-ttu-id="ec6c5-120">Выбор типа выходного носителя зависит от типа кодировки и требований к кодировке.</span><span class="sxs-lookup"><span data-stu-id="ec6c5-120">The deciding factor in choosing the output media type depends on the type of encoding and your encoding requirements.</span></span> <span data-ttu-id="ec6c5-121">Например, для звуковых потоков, CBR в кодировке, необходимо найти тип мультимедиа, который соответствует вашим входным данным и имеет битовую скорость, максимально близкую к целевому значению.</span><span class="sxs-lookup"><span data-stu-id="ec6c5-121">For example, for audio streams that are CBR-encoded, you want to find a media type that matches your input and has a bit rate that is as close as possible to a target value.</span></span>

<span data-ttu-id="ec6c5-122">Если вы хотите использовать режим кодирования, отличный от CBR, необходимо установить режим, а затем перечислить типы выходных данных для этого режима, так как кодировщик изменяет Поддерживаемые типы вывода в зависимости от набора режимов.</span><span class="sxs-lookup"><span data-stu-id="ec6c5-122">If you want to use an encoding mode other than CBR, you must set the mode and then enumerate the output types for that mode, because the encoder changes the supported output types depending upon the mode set.</span></span> <span data-ttu-id="ec6c5-123">Свойства, управляющие режимом кодирования, — это [**мфпкэй \_ Вбренаблед**](mfpkey-vbrenabledproperty.md) и [**мфпкэй \_ пассесусед**](mfpkey-passesusedproperty.md).</span><span class="sxs-lookup"><span data-stu-id="ec6c5-123">The properties that control the encoding mode are [**MFPKEY\_VBRENABLED**](mfpkey-vbrenabledproperty.md) and [**MFPKEY\_PASSESUSED**](mfpkey-passesusedproperty.md).</span></span> <span data-ttu-id="ec6c5-124">Например, при перечислении типов выходных данных для кодирования с использованием качества VBR тип мультимедиа зависит от значения качества, которое вы решили использовать.</span><span class="sxs-lookup"><span data-stu-id="ec6c5-124">For example, if you are enumerating output types for VBR-quality encoding, the media type depends on the quality value you decide to use.</span></span> <span data-ttu-id="ec6c5-125">Дополнительные сведения об установке этих свойств см. в разделе [Свойства кодировки](configuring-the-encoder.md).</span><span class="sxs-lookup"><span data-stu-id="ec6c5-125">For information about setting these properties, see [Encoding Properties](configuring-the-encoder.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="ec6c5-126">См. также</span><span class="sxs-lookup"><span data-stu-id="ec6c5-126">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ec6c5-127">Создание экземпляра MFT для кодировщика</span><span class="sxs-lookup"><span data-stu-id="ec6c5-127">Instantiating an Encoder MFT</span></span>](instantiating-the-encoder-mft.md)
</dt> <dt>

[<span data-ttu-id="ec6c5-128">Кодировщики Windows Media</span><span class="sxs-lookup"><span data-stu-id="ec6c5-128">Windows Media Encoders</span></span>](windows-media-encoders.md)
</dt> </dl>

 

 



