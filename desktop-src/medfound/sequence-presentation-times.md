---
description: В этом разделе описывается, как источник Sequencer обрабатывает время презентации во время воспроизведения.
ms.assetid: 0d095e25-5ccf-4319-8767-07b417ed7ee8
title: Время представления последовательности
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d17f5b0ff4bd6f0cfee2b1b461d6fbd11bdbf0fb
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104543807"
---
# <a name="sequence-presentation-times"></a><span data-ttu-id="a37cc-103">Время представления последовательности</span><span class="sxs-lookup"><span data-stu-id="a37cc-103">Sequence Presentation Times</span></span>

<span data-ttu-id="a37cc-104">В этом разделе описывается, как [источник Sequencer](sequencer-source.md) обрабатывает время презентации во время воспроизведения.</span><span class="sxs-lookup"><span data-stu-id="a37cc-104">This topic describes how the [Sequencer Source](sequencer-source.md) handles presentation times during playback.</span></span>

## <a name="overview"></a><span data-ttu-id="a37cc-105">Обзор</span><span class="sxs-lookup"><span data-stu-id="a37cc-105">Overview</span></span>

<span data-ttu-id="a37cc-106">Источник Sequencer поддерживает два разных режима: последовательности воспроизведения и изменения последовательностей.</span><span class="sxs-lookup"><span data-stu-id="a37cc-106">The sequencer source supports two different modes: playlist sequences and editing sequences.</span></span>

<span data-ttu-id="a37cc-107">В последовательности редактирования приложение задает длительность каждого сегмента заранее перед началом воспроизведения.</span><span class="sxs-lookup"><span data-stu-id="a37cc-107">In an editing sequence, the application specifies the duration of each segment in advance, before starting playback.</span></span> <span data-ttu-id="a37cc-108">В последовательности списков воспроизведения приложение не указывает длительность заранее.</span><span class="sxs-lookup"><span data-stu-id="a37cc-108">In a playlist sequence, the application does not specify the duration in advance.</span></span> <span data-ttu-id="a37cc-109">(На самом деле, длительность может быть неизвестной.)</span><span class="sxs-lookup"><span data-stu-id="a37cc-109">(In fact, the duration might not be known.)</span></span>

<span data-ttu-id="a37cc-110">В обоих случаях можно указать время начала и окончания носителя сегмента.</span><span class="sxs-lookup"><span data-stu-id="a37cc-110">In both cases, you can specify a segment's media start and media stop time.</span></span> <span data-ttu-id="a37cc-111">Эти значения указывают позицию начала и конца сегмента в исходном файле.</span><span class="sxs-lookup"><span data-stu-id="a37cc-111">These times specify the position in the source file where the segment begins and ends.</span></span> <span data-ttu-id="a37cc-112">Например, предположим, что исходный файл имеет длину в 90 секунд.</span><span class="sxs-lookup"><span data-stu-id="a37cc-112">For example, suppose that the source file is 90 seconds long.</span></span> <span data-ttu-id="a37cc-113">Если вы хотите обрезать первые 10 секунд, а последние 10 секунд, укажите следующие значения:</span><span class="sxs-lookup"><span data-stu-id="a37cc-113">If you wanted to trim the first 10 seconds and the last 10 seconds, you would specify the following values:</span></span>

-   <span data-ttu-id="a37cc-114">Начало носителя: 10 секунд</span><span class="sxs-lookup"><span data-stu-id="a37cc-114">Media start: 10 seconds</span></span>
-   <span data-ttu-id="a37cc-115">Окончание носителя: 80 с</span><span class="sxs-lookup"><span data-stu-id="a37cc-115">Media stop: 80 seconds</span></span>

<span data-ttu-id="a37cc-116">Чтобы указать время запуска носителя, установите атрибут [MF \_ топоноде \_ медиастарт](mf-toponode-mediastart-attribute.md) на исходном узле.</span><span class="sxs-lookup"><span data-stu-id="a37cc-116">To specify the media start time, set the [MF\_TOPONODE\_MEDIASTART](mf-toponode-mediastart-attribute.md) attribute on the source node.</span></span> <span data-ttu-id="a37cc-117">Чтобы указать время завершения носителя, установите атрибут [MF \_ топоноде \_ медиастоп](mf-toponode-mediastop-attribute.md) на исходном узле.</span><span class="sxs-lookup"><span data-stu-id="a37cc-117">To specify the media stop time, set the [MF\_TOPONODE\_MEDIASTOP](mf-toponode-mediastop-attribute.md) attribute on the source node.</span></span>

<span data-ttu-id="a37cc-118">Чтобы создать последовательность редактирования, задайте атрибут [ \_ \_ глобального \_ времени сеанса MF](mf-session-global-time-attribute.md) при создании сеанса мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="a37cc-118">To create an editing sequence, set the [MF\_SESSION\_GLOBAL\_TIME](mf-session-global-time-attribute.md) attribute when you create the Media Session.</span></span> <span data-ttu-id="a37cc-119">В противном случае сеансу мультимедиа требуются последовательности списков воспроизведения.</span><span class="sxs-lookup"><span data-stu-id="a37cc-119">Otherwise, the Media Session expects playlist sequences.</span></span> <span data-ttu-id="a37cc-120">В последовательности редактирования Каждая топология сегмента должна иметь атрибут [MF \_ Topology \_ прожектстарт](mf-topology-projectstart-attribute.md) и атрибут [ \_ \_ прожектстоп Topology](mf-topology-projectstop-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="a37cc-120">In an editing sequence, every segment topology must have the [MF\_TOPOLOGY\_PROJECTSTART](mf-topology-projectstart-attribute.md) attribute and the [MF\_TOPOLOGY\_PROJECTSTOP](mf-topology-projectstop-attribute.md) attribute.</span></span>

## <a name="playlist-sequences"></a><span data-ttu-id="a37cc-121">Последовательности списков воспроизведения</span><span class="sxs-lookup"><span data-stu-id="a37cc-121">Playlist Sequences</span></span>

<span data-ttu-id="a37cc-122">В последовательности воспроизведения часы представления начинаются с нуля и по границам сегментов.</span><span class="sxs-lookup"><span data-stu-id="a37cc-122">In a playlist sequence, the presentation clock starts at zero and continues across segment boundaries.</span></span> <span data-ttu-id="a37cc-123">Собственные источники предоставляют образцы с отметками времени, равными времени носителя.</span><span class="sxs-lookup"><span data-stu-id="a37cc-123">The native sources deliver samples with time stamps equal to the media time.</span></span> <span data-ttu-id="a37cc-124">Конвейер преобразует отметки времени в правильное время презентации следующим образом:</span><span class="sxs-lookup"><span data-stu-id="a37cc-124">The pipeline converts the time stamps to the correct presentation time as follows:</span></span>

-   <span data-ttu-id="a37cc-125">Новая метка времени = медиа время + смещение — начало носителя</span><span class="sxs-lookup"><span data-stu-id="a37cc-125">New time stamp = media time + offset − media start</span></span>

<span data-ttu-id="a37cc-126">Значение *offset* — это время презентации, с которой закончился предыдущий сегмент.</span><span class="sxs-lookup"><span data-stu-id="a37cc-126">The value of *offset* is the presentation time at which the previous segment ended.</span></span> <span data-ttu-id="a37cc-127">Для первого сегмента смещение равно нулю.</span><span class="sxs-lookup"><span data-stu-id="a37cc-127">For the first segment, the offset is zero.</span></span> <span data-ttu-id="a37cc-128">Ниже приведены два примера того, как рассчитываются эти преобразования штампа времени:</span><span class="sxs-lookup"><span data-stu-id="a37cc-128">Here are two examples of how these time-stamp conversions are calculated:</span></span>

-   <span data-ttu-id="a37cc-129">Пример 1. Предположим, что первый сегмент (S1) находится в течение 10 секунд, а второй сегмент (S2) имеет нулевое время начала воспроизведения.</span><span class="sxs-lookup"><span data-stu-id="a37cc-129">Example 1: Suppose the first segment (S1) is 10 seconds long, and the second segment (S2) has a media start time of zero.</span></span> <span data-ttu-id="a37cc-130">Собственный источник использует время носителя для штампов времени, поэтому Первая выборка из S2 имеет отметку времени, равную нулю.</span><span class="sxs-lookup"><span data-stu-id="a37cc-130">The native source uses the media time for its time stamps, so the first sample from S2 has a time stamp of zero.</span></span> <span data-ttu-id="a37cc-131">Смещение составляет 10 секунд (длительность S1), поэтому скорректированная отметка времени имеет следующие значения: 0 + 10 – 0 = 10 секунд.</span><span class="sxs-lookup"><span data-stu-id="a37cc-131">The offset is 10 seconds (the duration of S1), so the adjusted time stamp is:0 + 10 − 0 = 10 seconds.</span></span>
-   <span data-ttu-id="a37cc-132">Пример 2. Предположим, что сегмент S1 имеет длину 10 секунд, а S2 — время начала работы с носителем 5 секунд.</span><span class="sxs-lookup"><span data-stu-id="a37cc-132">Example 2: Suppose segment S1 is 10 seconds long, and S2 has a media start time of 5 seconds.</span></span> <span data-ttu-id="a37cc-133">Первый пример из S2 имеет отметку времени 5 секунд (время мультимедиа).</span><span class="sxs-lookup"><span data-stu-id="a37cc-133">The first sample from S2 has a time stamp of 5 seconds (media time).</span></span> <span data-ttu-id="a37cc-134">Смещение составляет 10 секунд, поэтому скорректированная отметка времени: 5 + 10 − 5 = 10 секунд.</span><span class="sxs-lookup"><span data-stu-id="a37cc-134">The offset is 10 seconds, so the adjusted time stamp is:5 + 10 − 5 = 10 seconds.</span></span>

<span data-ttu-id="a37cc-135">Все компоненты конвейера, нисходящие от исходных узлов, получают образцы с скорректированными штампами времени.</span><span class="sxs-lookup"><span data-stu-id="a37cc-135">All pipeline components downstream from the source nodes receive samples with the adjusted time stamps.</span></span> <span data-ttu-id="a37cc-136">Исходные узлы в топологии могут иметь разные значения времени начала носителя, поэтому эти изменения рассчитываются отдельно для каждой ветви топологии.</span><span class="sxs-lookup"><span data-stu-id="a37cc-136">The source nodes in a topology can have different media start times, so the adjustments are calculated separately for each branch of the topology.</span></span>

<span data-ttu-id="a37cc-137">Когда презентация переходит к следующему сегменту, часы презентации не останавливаются и не сбрасываются, а время презентации увеличивается монотонно.</span><span class="sxs-lookup"><span data-stu-id="a37cc-137">When the presentation switches to the next segment, the presentation clock does not stop or reset, and the presentation time increases monotonically.</span></span> <span data-ttu-id="a37cc-138">Прежде чем начать новый сегмент, сеанс мультимедиа отправляет приложению событие [месессионнотифипресентатионтиме](mesessionnotifypresentationtime.md) .</span><span class="sxs-lookup"><span data-stu-id="a37cc-138">Before a new segment starts, the Media Session sends the application an [MESessionNotifyPresentationTime](mesessionnotifypresentationtime.md) event.</span></span> <span data-ttu-id="a37cc-139">Событие указывает начальное время сегмента относительно часов представления и значение смещения.</span><span class="sxs-lookup"><span data-stu-id="a37cc-139">The event specifies the starting time of the segment, relative to the presentation clock, and the value of the offset.</span></span> <span data-ttu-id="a37cc-140">При запуске нового сегмента конвейер вызывает [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) в источнике Sequencer со значением VT \_ Empty.</span><span class="sxs-lookup"><span data-stu-id="a37cc-140">When a new segment starts, the pipeline calls [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) on the sequencer source with the value VT\_EMPTY.</span></span> <span data-ttu-id="a37cc-141">Источник Sequencer отправляет событие [месаурцестартед](mesourcestarted.md) без времени начала.</span><span class="sxs-lookup"><span data-stu-id="a37cc-141">The sequencer source sends an [MESourceStarted](mesourcestarted.md) event with no start time.</span></span>

<span data-ttu-id="a37cc-142">Для поиска приложение указывает идентификатор сегмента и смещение времени в пределах сегмента.</span><span class="sxs-lookup"><span data-stu-id="a37cc-142">To seek, the application specifies a segment identifier plus a time offset within the segment.</span></span> <span data-ttu-id="a37cc-143">После поиска время проведения презентации начинается с смещения *сегмента* .</span><span class="sxs-lookup"><span data-stu-id="a37cc-143">After the seek, the presentation clock starts at the *segment* offset.</span></span> <span data-ttu-id="a37cc-144">Ниже приведен пример того, как работает этот процесс.</span><span class="sxs-lookup"><span data-stu-id="a37cc-144">Here is an example of how that process works:</span></span>

-   <span data-ttu-id="a37cc-145">Пример 3. приложение выполняет поиск сегмента S3 с смещением сегмента в 10 секунд.</span><span class="sxs-lookup"><span data-stu-id="a37cc-145">Example 3: The application seeks to segment S3, with a segment offset of 10 seconds.</span></span> <span data-ttu-id="a37cc-146">Время презентации начинается с 10 секунд (смещение сегмента).</span><span class="sxs-lookup"><span data-stu-id="a37cc-146">The presentation clock starts at 10 seconds (the segment offset).</span></span> <span data-ttu-id="a37cc-147">Смещение не включает продолжительность сегментов S1 и S2.</span><span class="sxs-lookup"><span data-stu-id="a37cc-147">The offset does not include the duration of segments S1 and S2.</span></span> <span data-ttu-id="a37cc-148">Источник Sequencer отправляет событие [месаурцестартед](mesourcestarted.md) с временем начала, равным смещению сегмента, 10 секунд.</span><span class="sxs-lookup"><span data-stu-id="a37cc-148">The sequencer source sends an [MESourceStarted](mesourcestarted.md) event with a start time equal to the segment offset, 10 seconds.</span></span>

<span data-ttu-id="a37cc-149">После поиска, если воспроизведение переходит к следующему сегменту, переход работает так же, как в предыдущих примерах, за исключением того, что смещение не включает пропущенные сегменты.</span><span class="sxs-lookup"><span data-stu-id="a37cc-149">After a seek, if playback continues to the next segment, the transition works just like the previous examples, except that the offset does not include the skipped segments.</span></span>

<span data-ttu-id="a37cc-150">Ниже приведены некоторые дополнительные сведения, которые влияют на отметку времени в примерах.</span><span class="sxs-lookup"><span data-stu-id="a37cc-150">Here are some further details that affect how samples are time stamped:</span></span>

-   <span data-ttu-id="a37cc-151">Декодерам могут потребоваться данные за пределами времени окончания.</span><span class="sxs-lookup"><span data-stu-id="a37cc-151">Decoders may need data beyond the media stop time.</span></span> <span data-ttu-id="a37cc-152">Конвейер извлекает столько данных из источника, сколько требуется декодеру, а затем обрезает образцы выходных данных декодера.</span><span class="sxs-lookup"><span data-stu-id="a37cc-152">The pipeline pulls as much data from the source as the decoder requires, and then trims the decoder's output samples.</span></span>
-   <span data-ttu-id="a37cc-153">Преобразования могут буферизовать данные в буфере.</span><span class="sxs-lookup"><span data-stu-id="a37cc-153">Transforms might buffer data.</span></span> <span data-ttu-id="a37cc-154">Например, может потребоваться звуковой эффекты.</span><span class="sxs-lookup"><span data-stu-id="a37cc-154">For example, an audio effect might need to do this.</span></span> <span data-ttu-id="a37cc-155">Когда сегмент заканчивается, отметка времени в последней выборки из преобразования предшествует концу сегмента, поскольку преобразование удерживает некоторые данные.</span><span class="sxs-lookup"><span data-stu-id="a37cc-155">When a segment ends, the time stamp on the last sample from the transform is earlier than the end of the segment, because the transform is holding back some data.</span></span> <span data-ttu-id="a37cc-156">При запуске следующего сегмента отметка времени в первом примере немного раньше, чем начало сегмента.</span><span class="sxs-lookup"><span data-stu-id="a37cc-156">When the next segment starts, the time stamp on the first sample is slightly earlier than the start of the segment.</span></span> <span data-ttu-id="a37cc-157">В метках времени нет зазора, поэтому данные, которые достигают приемника мультимедиа, непрерывны.</span><span class="sxs-lookup"><span data-stu-id="a37cc-157">There is no gap in the time stamps, so the data that reaches the media sink is continuous.</span></span> <span data-ttu-id="a37cc-158">По окончании последнего сегмента конвейер прекращает преобразование, поэтому данные не теряются.</span><span class="sxs-lookup"><span data-stu-id="a37cc-158">When the final segment ends, the pipeline drains the transform, so no data is lost.</span></span>
-   <span data-ttu-id="a37cc-159">Для получения предыдущего ключевого кадра источнику может потребоваться несколько времени до начала работы с носителем.</span><span class="sxs-lookup"><span data-stu-id="a37cc-159">The source may need to start slightly earlier than the media start time, to pick up the previous key frame.</span></span> <span data-ttu-id="a37cc-160">Таким образом, после корректировки первый пример может иметь отрицательное время презентации.</span><span class="sxs-lookup"><span data-stu-id="a37cc-160">Therefore, after the adjustment, the first sample might have a negative presentation time.</span></span>

## <a name="editing-sequences"></a><span data-ttu-id="a37cc-161">Изменение последовательностей</span><span class="sxs-lookup"><span data-stu-id="a37cc-161">Editing Sequences</span></span>

<span data-ttu-id="a37cc-162">В последовательности редактирования приложение указывает границы сегмента заранее, установив атрибуты [**\_ топологии MF \_ прожектстарт**](mf-topology-projectstart-attribute.md) и [**MF \_ Topology \_ прожектстоп**](mf-topology-projectstop-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="a37cc-162">In an editing sequence, the application specifies the segment boundaries in advance, by setting the [**MF\_TOPOLOGY\_PROJECTSTART**](mf-topology-projectstart-attribute.md) and [**MF\_TOPOLOGY\_PROJECTSTOP**](mf-topology-projectstop-attribute.md) attributes.</span></span> <span data-ttu-id="a37cc-163">Конвейер вычисляет корректировки для меток времени почти так же, как для последовательности воспроизведения:</span><span class="sxs-lookup"><span data-stu-id="a37cc-163">The pipeline calculates adjustments for the time stamps in almost the same way as for a playlist sequence:</span></span>

-   <span data-ttu-id="a37cc-164">Для смещения используется значение [**MF \_ TOPOLOGY \_ прожектстарт**](mf-topology-projectstart-attribute.md), вместо того чтобы использовать наблюдаемый конец сегмента.</span><span class="sxs-lookup"><span data-stu-id="a37cc-164">For the offset, it uses the value of [**MF\_TOPOLOGY\_PROJECTSTART**](mf-topology-projectstart-attribute.md), instead of using the observed end of the segment.</span></span>

-   <span data-ttu-id="a37cc-165">Для поиска смещение использует значение, равное значению [**\_ \_ прожектстарт топологии MF**](mf-topology-projectstart-attribute.md) и смещению сегмента.</span><span class="sxs-lookup"><span data-stu-id="a37cc-165">For seeking, the offset uses a value equal to the segment's [**MF\_TOPOLOGY\_PROJECTSTART**](mf-topology-projectstart-attribute.md) value plus the segment offset.</span></span>

<span data-ttu-id="a37cc-166">Поэтому время презентации в последовательности редактирования всегда отсчитывается относительно начала презентации, даже если приложение выполняет поиск в другом сегменте.</span><span class="sxs-lookup"><span data-stu-id="a37cc-166">Therefore, the presentation time in an editing sequence is always relative to the start of the presentation, even if the application seeks to another segment.</span></span>

## <a name="related-topics"></a><span data-ttu-id="a37cc-167">См. также</span><span class="sxs-lookup"><span data-stu-id="a37cc-167">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a37cc-168">Сеанс мультимедиа</span><span class="sxs-lookup"><span data-stu-id="a37cc-168">Media Session</span></span>](media-session.md)
</dt> <dt>

[<span data-ttu-id="a37cc-169">Источник Sequencer</span><span class="sxs-lookup"><span data-stu-id="a37cc-169">Sequencer Source</span></span>](sequencer-source.md)
</dt> </dl>

 

 



