---
description: В этом разделе описывается, как преобразования Media Foundation должны управлять штампами времени.
ms.assetid: 4ab576ce-becd-4736-921e-e463c0dff841
title: Метки времени и длительности
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2323c11fa0e3ec2b2b2d5ba1cefe4f5d5fa80c5b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104155311"
---
# <a name="time-stamps-and-durations"></a><span data-ttu-id="35266-103">Метки времени и длительности</span><span class="sxs-lookup"><span data-stu-id="35266-103">Time Stamps and Durations</span></span>

<span data-ttu-id="35266-104">В этом разделе описывается, как [преобразования Media Foundation](media-foundation-transforms.md) должны управлять штампами времени.</span><span class="sxs-lookup"><span data-stu-id="35266-104">This topic describes how [Media Foundation Transforms](media-foundation-transforms.md) should handle time stamps.</span></span>

<span data-ttu-id="35266-105">Файл MFT должен задавать как можно более точную отметку времени и продолжительность во всех выходных образцах.</span><span class="sxs-lookup"><span data-stu-id="35266-105">An MFT must set as accurate a time stamp and duration as possible on all output samples.</span></span> <span data-ttu-id="35266-106">Для простой таблицы MFT, которая принимает один входной буфер и полностью обрабатывает его в выходном буфере, файл MFT должен просто скопировать отметку времени и длительность непосредственно из примера входных данных в образец Output.</span><span class="sxs-lookup"><span data-stu-id="35266-106">For a simple MFT that takes one input buffer and completely processes it into an output buffer, the MFT should just copy the time stamp and duration directly from the input sample to the output sample.</span></span> <span data-ttu-id="35266-107">Однако многие преобразования сложнее, чем это, и могут потребовать более сложных вычислений времени вывода.</span><span class="sxs-lookup"><span data-stu-id="35266-107">However, many transforms are more complex than this and may require more complex calculations of output time.</span></span> <span data-ttu-id="35266-108">Все МФТС должны соблюдать следующие основные правила.</span><span class="sxs-lookup"><span data-stu-id="35266-108">All MFTs should observe the following basic rules:</span></span>

-   <span data-ttu-id="35266-109">Файловая Таблица MFT должна попытаться установить метку времени и длительность на всех несжатых образцах видео или звука, если для входных образцов задана точная метка времени или длительность, и их можно вычислить.</span><span class="sxs-lookup"><span data-stu-id="35266-109">An MFT should try to put a time stamp and duration on all uncompressed video or audio output samples if an accurate time stamp or duration is given on the input samples or can be calculated.</span></span> <span data-ttu-id="35266-110">Для некоторых меток времени вывода может потребоваться интерполяция, особенно для декодеров.</span><span class="sxs-lookup"><span data-stu-id="35266-110">Interpolation may be required for some output time stamps, especially for decoders.</span></span>
-   <span data-ttu-id="35266-111">Метки времени и длительности входных образцов должны сохраняться в выходных данных как можно больше.</span><span class="sxs-lookup"><span data-stu-id="35266-111">The time stamps and durations of the input samples should be preserved on the output samples as much as possible.</span></span>
-   <span data-ttu-id="35266-112">Метки времени вывода или длительности могут не соответствовать входным данным, так как MFT удерживает обратную передачу данных или разбивает выходные данные на части, размеры которых отличаются от входных.</span><span class="sxs-lookup"><span data-stu-id="35266-112">The output time stamps or durations might not match the input because the MFT is holding back data or breaking the output into different-sized pieces than the input.</span></span> <span data-ttu-id="35266-113">В этом случае MFT должна вычислить метку времени вывода из самого раннего входного образца, содержащего данные, используемые для создания образца выходных данных.</span><span class="sxs-lookup"><span data-stu-id="35266-113">In that case, the MFT should calculate the output time stamp from the earliest input sample that contains data used to create the output sample.</span></span> <span data-ttu-id="35266-114">Чтобы вычислить отметку времени вывода, добавьте метку времени для соответствующего входного образца на время, которое уже было преобразовано из этого образца.</span><span class="sxs-lookup"><span data-stu-id="35266-114">To calculate the output time stamp, add the input time stamp of the appropriate input sample to the duration of data that has already been transformed from that sample.</span></span> <span data-ttu-id="35266-115">Второй пример в конце этого раздела иллюстрирует эту идею.</span><span class="sxs-lookup"><span data-stu-id="35266-115">The second example at the end of this section illustrates this idea.</span></span>
-   <span data-ttu-id="35266-116">Если входные образцы имеют длительность, эта длительность должна быть сохранена.</span><span class="sxs-lookup"><span data-stu-id="35266-116">If the input samples have duration, that duration should be preserved.</span></span> <span data-ttu-id="35266-117">Если у входного образца нет длительности, MFT следует вычислить длительность по возможности из размера выходного буфера или скорости передачи данных, заданной типом носителя.</span><span class="sxs-lookup"><span data-stu-id="35266-117">If an input sample does not have duration, the MFT should calculate a duration if possible from the size of the output buffer or the data rate given by the media type.</span></span>
-   <span data-ttu-id="35266-118">Вычисленные длительности должны быть усечены (округляются вниз), а не округляться до ближайшего приращения.</span><span class="sxs-lookup"><span data-stu-id="35266-118">Calculated durations should be truncated (rounded down), not rounded to the nearest increment.</span></span> <span data-ttu-id="35266-119">У конвейера достаточно времени для обработки длительности, которые немного неточны, но для конвейера проще обрабатывалась длительность в 1% слишком короткая, чем длительность 1%.</span><span class="sxs-lookup"><span data-stu-id="35266-119">The pipeline has enough slack to handle durations that are slightly inaccurate, but it is easier for the pipeline to handle a duration that is 1% too short than a duration that is 1% too long.</span></span> <span data-ttu-id="35266-120">С другой стороны, нет смысла в сокращении длительности, за исключением округления.</span><span class="sxs-lookup"><span data-stu-id="35266-120">That said, there is no reason to deliberately shorten the durations, other than by rounding.</span></span>

### <a name="decoders"></a><span data-ttu-id="35266-121">Декодеров</span><span class="sxs-lookup"><span data-stu-id="35266-121">Decoders</span></span>

<span data-ttu-id="35266-122">Декодер преобразует сжатые пакеты в несжатые данные.</span><span class="sxs-lookup"><span data-stu-id="35266-122">A decoder converts compressed packets into uncompressed data.</span></span> <span data-ttu-id="35266-123">Поскольку выходные данные не сжаты, декодеры имеют специальное обязательство для получения правильных меток времени и длительности.</span><span class="sxs-lookup"><span data-stu-id="35266-123">Because the output is uncompressed, decoders have a special obligation to get the time stamps and durations correct.</span></span> <span data-ttu-id="35266-124">Некоторые сжатые форматы, в частности, MPEG-2, не имеют штампов времени во всех входящих пакетах и часто не имеют длительности какого-либо пакета.</span><span class="sxs-lookup"><span data-stu-id="35266-124">Some compressed formats, most notably MPEG-2, do not have time stamps on all input packets and often have no duration on any packet.</span></span> <span data-ttu-id="35266-125">Для этих форматов декодер отвечает за размещение допустимой отметки времени и длительности для каждого выходного образца, суммируя неявные длительности всех выходных данных с момента последнего ввода-вывода с помощью последней отметки времени.</span><span class="sxs-lookup"><span data-stu-id="35266-125">For these formats, the decoder is responsible for putting a valid time stamp and duration on every output sample, by summing the implied durations of all the output since the last time-stamped input sample.</span></span>

<span data-ttu-id="35266-126">Для видео, если длительность недоступна в сжатом формате, декодер должен вычислить продолжительность в виде обратной величины частоты кадров, преобразованную в единицы с частотой в 100 НС и округляя вниз.</span><span class="sxs-lookup"><span data-stu-id="35266-126">For video, if the duration is not available in the compressed format, the decoder should calculate the duration as the inverse of the frame rate, converted to 100-nanosecond units and rounded down.</span></span>

<span data-ttu-id="35266-127">Для звукового сигнала, если длительность недоступна в сжатом формате, декодер должен вычислить продолжительность как обратную частоту выборки звука, умноженную на число выборок в выходном буфере, преобразованное в единицы в 100-наносекундных единиц и округление вниз.</span><span class="sxs-lookup"><span data-stu-id="35266-127">For audio, if the duration is not available in the compressed format, the decoder should calculate the duration as the inverse of the audio sample rate multiplied by the number of samples in the output buffer, converted to 100-nanosecond units and rounded down.</span></span>

<span data-ttu-id="35266-128">Единственный раз, когда преобразование должно выводить пример без отметки времени, является то, что Таблица MFT никогда не получала метку времени на входном образце или если нет способа вычислить точную метку времени вывода из предыдущей входной метки времени.</span><span class="sxs-lookup"><span data-stu-id="35266-128">The only time a transform should output a sample without a time stamp is if the MFT has never received a time stamp on an input sample, or if there is no way to calculate an accurate output time stamp from the previous input time stamp.</span></span>

### <a name="audio-decoders"></a><span data-ttu-id="35266-129">Звуковые декодеры</span><span class="sxs-lookup"><span data-stu-id="35266-129">Audio Decoders</span></span>

<span data-ttu-id="35266-130">Для звуковых декодеров продолжительность каждого образца выходных данных вычисляется на основе частоты выборки звука и количества выборок PCM на канал в выходном буфере.</span><span class="sxs-lookup"><span data-stu-id="35266-130">For audio decoders, the duration of each output sample is calculated from the audio sampling rate and the number of PCM samples per channel in the output buffer.</span></span>

<span data-ttu-id="35266-131">Правильный способ вычисления меток времени вывода зависит от того, содержат ли входные образцы метки времени.</span><span class="sxs-lookup"><span data-stu-id="35266-131">The correct way to calculate output time stamps depends on whether the input samples contain time stamps.</span></span>

<span data-ttu-id="35266-132">Если входные образцы содержат отметки времени, декодер вычисляет метки времени вывода из меток времени ввода, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="35266-132">If the input samples contain time stamps, the decoder calculates the output time stamps from the input time stamps, as follows:</span></span>

-   <span data-ttu-id="35266-133">Если каждый входной буфер содержит один или несколько полных сжатых кадров без частичных кадров, то метка времени вывода равна входной метке времени, за вычетом известной задержки декодера.</span><span class="sxs-lookup"><span data-stu-id="35266-133">If each input buffer contains a one or more complete compressed frames, with no partial frames, the output time stamp equals the input time stamp, minus the known latency of the decoder.</span></span> <span data-ttu-id="35266-134">Например, декодер Dolby Digital (AC-3) имеет задержку 256 примеров PCM.</span><span class="sxs-lookup"><span data-stu-id="35266-134">For example, a Dolby Digital (AC-3) decoder has a latency of 256 PCM samples.</span></span> <span data-ttu-id="35266-135">Например, при частоте выборки 48-кГц задержка составляет 5,33 миллисекунд (МС).</span><span class="sxs-lookup"><span data-stu-id="35266-135">For example, at 48-kHz sampling rate, the latency is 5.33 milliseconds (msec).</span></span> <span data-ttu-id="35266-136">Таким образом, если метка времени ввода составляет 1000 мс, то метка времени вывода составляет 1000 – 5,33 = 994,66 МС.</span><span class="sxs-lookup"><span data-stu-id="35266-136">Therefore, if the input time stamp is 1000 msec, the output time stamp is 1000 – 5.33 = 994.66 msec.</span></span> <span data-ttu-id="35266-137">Если входной буфер содержит более одного целого сжатого кадра, декодер выдает один выходной пример для каждого кадра во входном примере.</span><span class="sxs-lookup"><span data-stu-id="35266-137">If the input buffer includes more than one whole compressed frame, the decoder will produce one output sample for every frame in the input sample.</span></span> <span data-ttu-id="35266-138">Все выходные образцы будут правильно отмечаться метками времени, что не содержит пробелов.</span><span class="sxs-lookup"><span data-stu-id="35266-138">All output samples will be time stamped correctly such that there are no gaps.</span></span>
-   <span data-ttu-id="35266-139">В зависимости от формата транспорта входной буфер может содержать частичные кадры.</span><span class="sxs-lookup"><span data-stu-id="35266-139">Depending on the transport format, an input buffer might contain partial frames.</span></span> <span data-ttu-id="35266-140">Например, буфер может содержать часть кадра из предыдущего входного буфера, за которой следуют один или несколько полных кадров, а затем начало следующего кадра.</span><span class="sxs-lookup"><span data-stu-id="35266-140">For example, a buffer might contain part of a frame from the previous input buffer, followed by one or more complete frames, followed by the start of the next frame.</span></span> <span data-ttu-id="35266-141">В этом случае, как правило, предполагается, что метка времени ввода соответствует первому кадру, который начинается в буфере.</span><span class="sxs-lookup"><span data-stu-id="35266-141">In this case, it is generally correct to assume that the input time stamp corresponds to the first frame that starts within the buffer.</span></span> <span data-ttu-id="35266-142">(То есть, частичный кадр, запущенный в предыдущем буфере, не включается в отметку времени текущего буфера.) Соответствующим образом Вычислите отметку времени вывода.</span><span class="sxs-lookup"><span data-stu-id="35266-142">(That is, a partial frame that started in the previous buffer is not included in the time stamp for the current buffer.) Calculate the output time stamp accordingly.</span></span>

<span data-ttu-id="35266-143">Если входные образцы не содержат метки времени:</span><span class="sxs-lookup"><span data-stu-id="35266-143">If the input samples do not contain any time stamps:</span></span>

-   <span data-ttu-id="35266-144">Декодер должен создавать собственные отметки времени, устанавливая нулевую отметку времени вывода.</span><span class="sxs-lookup"><span data-stu-id="35266-144">The decoder should generate its own time stamps, setting the first output time stamp to zero.</span></span>
-   <span data-ttu-id="35266-145">Длительность выборки вычисляется на основе количества выходных выборок в буфере и частоты выборки.</span><span class="sxs-lookup"><span data-stu-id="35266-145">The sample duration is calculated from the number of output samples in the buffer and the sample rate.</span></span>
-   <span data-ttu-id="35266-146">Последующие отметки времени вычисляются на основе предыдущей метки времени и длительности: текущая метка времени + текущая длительность = Следующая отметка времени.</span><span class="sxs-lookup"><span data-stu-id="35266-146">Subsequent time stamps are calculated from the previous time stamp and duration: Current time stamp + current duration = next time stamp.</span></span> <span data-ttu-id="35266-147">В метках времени вывода не должно быть пробелов.</span><span class="sxs-lookup"><span data-stu-id="35266-147">There should be no gaps in the output time stamps.</span></span>

<span data-ttu-id="35266-148">Если входной поток изначально содержит штампы времени, но по какой-либо причине не имеет отметки времени, декодер должен продолжать создавать собственные метки времени вывода, чтобы они были непрерывными и не пропасть.</span><span class="sxs-lookup"><span data-stu-id="35266-148">If the input stream initially contains time stamps, but for some reason switches to no time stamps, the decoder should continue to generate its own output time stamps, such that they are continuous and there is no gap.</span></span>

<span data-ttu-id="35266-149">Если входной поток содержит отметки времени, но при этом возникают промежутки времени, декодер просто распространяет эти пропуски.</span><span class="sxs-lookup"><span data-stu-id="35266-149">If the input stream contains time stamps, but there are gaps in the times, the decoder will simply propagate these gaps.</span></span> <span data-ttu-id="35266-150">Иными словами, декодер не должен пытаться исправить несоответствующие отметки времени во входном потоке.</span><span class="sxs-lookup"><span data-stu-id="35266-150">In other words, the decoder should not attempt to fix inconsistent time stamps in the input stream.</span></span>

### <a name="mixers"></a><span data-ttu-id="35266-151">миксерс</span><span class="sxs-lookup"><span data-stu-id="35266-151">Mixers</span></span>

> [!Note]  
> <span data-ttu-id="35266-152">В Windows Vista конвейер Media Foundation не поддерживает МФТС с более чем одним входом.</span><span class="sxs-lookup"><span data-stu-id="35266-152">In Windows Vista, the Media Foundation pipeline does not support MFTs with more than one input.</span></span> <span data-ttu-id="35266-153">В Windows 7 поддерживаются множественные входные МФТС.</span><span class="sxs-lookup"><span data-stu-id="35266-153">Multiple-input MFTs are supported in Windows 7.</span></span>

 

<span data-ttu-id="35266-154">Микшер принимает несколько входов и смешивает их в один выход.</span><span class="sxs-lookup"><span data-stu-id="35266-154">A mixer takes multiple inputs and mixes them into one output.</span></span> <span data-ttu-id="35266-155">Если входные потоки не полностью заблокированы или немного смещены по времени друг от друга, может быть неоднозначность того, какое время должно быть задано для выходных данных.</span><span class="sxs-lookup"><span data-stu-id="35266-155">If the input streams are not completely rate-locked, or are slightly offset in time from each other, there can be ambiguity about which time to set on the output.</span></span> <span data-ttu-id="35266-156">Ниже приведены некоторые рекомендации в зависимости от типа носителя.</span><span class="sxs-lookup"><span data-stu-id="35266-156">Here are some guidelines, depending on the media type:</span></span>

-   <span data-ttu-id="35266-157">Аудиосигнал.</span><span class="sxs-lookup"><span data-stu-id="35266-157">Audio.</span></span> <span data-ttu-id="35266-158">При запуске или сразу после очистки или сброса звука звуковые МИКШЕРЫ должны дожидаться создания выходных образцов, пока он не получит входной образец во всех необходимых потоках ввода.</span><span class="sxs-lookup"><span data-stu-id="35266-158">At startup or immediately after a drain or flush, an audio mixer should wait to produce output samples until it has received an input sample on all required input streams.</span></span> <span data-ttu-id="35266-159">На этом этапе он должен выбрать самую раннюю отметку времени первоначальных выборок, чтобы использовать их в качестве базовых для меток времени вывода.</span><span class="sxs-lookup"><span data-stu-id="35266-159">At that point, it should choose the earliest time stamp of the initial samples to use as a baseline for the output time stamps.</span></span> <span data-ttu-id="35266-160">Другие потоки должны быть дополнены тишиной, чтобы отменять любое несоответствие времени.</span><span class="sxs-lookup"><span data-stu-id="35266-160">The other streams should be padded with silence to make up any time discrepancy.</span></span> <span data-ttu-id="35266-161">Если образец получен во необязательном входном потоке, он также должен быть разделен на вычисление.</span><span class="sxs-lookup"><span data-stu-id="35266-161">If a sample is received on an optional input stream, it should also be factored into the calculation.</span></span> <span data-ttu-id="35266-162">С этого момента Таблица MFT должна стремиться к созданию непрерывной и неповрежденной цепочки меток времени вывода.</span><span class="sxs-lookup"><span data-stu-id="35266-162">From that point on, the MFT should strive to produce a continuous and unbroken chain of output time stamps.</span></span> <span data-ttu-id="35266-163">Как правило, MFT не должно пытаться учитывать один поток, переходящий относительно другого.</span><span class="sxs-lookup"><span data-stu-id="35266-163">In general, the MFT should not try to account for one stream drifting relative to another.</span></span> <span data-ttu-id="35266-164">Вместо этого он должен вычислять метки времени вывода на основе временной метки времени, частоты вывода и размеров буфера.</span><span class="sxs-lookup"><span data-stu-id="35266-164">Instead, it should calculate the output time stamps from the baseline time stamp, the output rate, and the buffer sizes.</span></span> <span data-ttu-id="35266-165">Когда происходит другой сток или очистка, MFT следует сбросить ее базовые метки времени.</span><span class="sxs-lookup"><span data-stu-id="35266-165">When another drain or flush occurs, the MFT should reset its baseline time stamps.</span></span>

-   <span data-ttu-id="35266-166">Видео.</span><span class="sxs-lookup"><span data-stu-id="35266-166">Video.</span></span> <span data-ttu-id="35266-167">При запуске или сразу после очистки или сброса Видеомикшер должен подождать создания выходных образцов, пока он не получит входной образец во всех необходимых входных потоках.</span><span class="sxs-lookup"><span data-stu-id="35266-167">At startup or immediately after a drain or flush, a video mixer should wait to produce output samples until it has received an input sample on all required input streams.</span></span> <span data-ttu-id="35266-168">На этом этапе он должен выбрать самую раннюю отметку времени первоначальных выборок, чтобы использовать их в качестве базовых для меток времени вывода.</span><span class="sxs-lookup"><span data-stu-id="35266-168">At that point, it should choose the earliest time stamp of the initial samples to use as a baseline for the output time stamps.</span></span> <span data-ttu-id="35266-169">Как правило, следует стремиться к постоянному и регулярному выходу выходных и фиксированных длительностей, даже если входные данные не являются обычными, если это необходимо для повторения входных кадров.</span><span class="sxs-lookup"><span data-stu-id="35266-169">In general, it should strive to keep continuous and regular output time stamps and fixed durations, even if the input is not as regular, if necessary by repeating input frames.</span></span>

### <a name="encoders"></a><span data-ttu-id="35266-170">Кодировщики</span><span class="sxs-lookup"><span data-stu-id="35266-170">Encoders</span></span>

<span data-ttu-id="35266-171">Кодировщик преобразует несжатые аудио или видео в сжатые пакеты.</span><span class="sxs-lookup"><span data-stu-id="35266-171">An encoder converts uncompressed audio or video into compressed packets.</span></span> <span data-ttu-id="35266-172">Кодировщик должен следовать приведенным ниже рекомендациям.</span><span class="sxs-lookup"><span data-stu-id="35266-172">An encoder should follow these guidelines:</span></span>

-   <span data-ttu-id="35266-173">Кодировщик должен следовать правилам формата выходных данных.</span><span class="sxs-lookup"><span data-stu-id="35266-173">The encoder should follow the conventions of the output format.</span></span> <span data-ttu-id="35266-174">Если формат обычно не имеет метки времени, как в MPEG-2, не каждый образец вывода должен иметь отметку времени и длительность.</span><span class="sxs-lookup"><span data-stu-id="35266-174">If the format does not typically time stamp every sample, as in MPEG-2, not every output sample needs to have a time stamp and a duration.</span></span>

-   <span data-ttu-id="35266-175">Метки времени ввода должны сохраняться в выходном формате, если в формате есть поля для меток времени, если только более подробные сведения о времени не будут доступны из другого источника, например самого приложения.</span><span class="sxs-lookup"><span data-stu-id="35266-175">The input time stamps should be preserved in the output format, if the format has fields for time stamps, unless better time information is a available from another source, such as the application itself.</span></span>

### <a name="multiplexers"></a><span data-ttu-id="35266-176">Мультиплексоры</span><span class="sxs-lookup"><span data-stu-id="35266-176">Multiplexers</span></span>

> [!Note]  
> <span data-ttu-id="35266-177">В Windows Vista конвейер Media Foundation не поддерживает МФТС с более чем одним входом.</span><span class="sxs-lookup"><span data-stu-id="35266-177">In Windows Vista, the Media Foundation pipeline does not support MFTs with more than one input.</span></span> <span data-ttu-id="35266-178">В Windows 7 поддерживаются множественные входные МФТС.</span><span class="sxs-lookup"><span data-stu-id="35266-178">Multiple-input MFTs are supported in Windows 7.</span></span>

 

<span data-ttu-id="35266-179">Мультиплексор объединяет два разных аудио-или видеопотока в один формат чередования, например AVI или MPEG-2.</span><span class="sxs-lookup"><span data-stu-id="35266-179">A multiplexer combines two different audio or video streams into one interleaved format, such as AVI or MPEG-2 Transport Stream.</span></span> <span data-ttu-id="35266-180">Мультиплексор должен следовать следующим рекомендациям:</span><span class="sxs-lookup"><span data-stu-id="35266-180">A multiplexer should follow these guidelines:</span></span>

-   <span data-ttu-id="35266-181">Мультиплексор должен следовать правилам формата выходных данных.</span><span class="sxs-lookup"><span data-stu-id="35266-181">The multiplexer should follow the conventions of the output format.</span></span> <span data-ttu-id="35266-182">Если формат обычно не имеет метки времени, как в MPEG-2, не каждый образец вывода должен иметь отметку времени и длительность.</span><span class="sxs-lookup"><span data-stu-id="35266-182">If the format does not typically time stamp every sample, as in MPEG-2, not every output sample needs to have a time stamp and a duration.</span></span>

-   <span data-ttu-id="35266-183">Метка времени должна отражать самое раннее время, которое будет помещено в любой кадр, который начинается в этом пакете, или время первого звукового примера, который будет декодирован из этого пакета.</span><span class="sxs-lookup"><span data-stu-id="35266-183">The time stamp should reflect the earliest time that would be placed on any frame that begins in that packet, or the time of the first audio sample that would be decoded from that packet.</span></span> <span data-ttu-id="35266-184">Пропускать это правило, если оно конфликтует с соглашениями выходного формата.</span><span class="sxs-lookup"><span data-stu-id="35266-184">Ignore this guideline if it conflicts with the conventions of the output format.</span></span>

### <a name="demultiplexers"></a><span data-ttu-id="35266-185">Демультиплексоры</span><span class="sxs-lookup"><span data-stu-id="35266-185">Demultiplexers</span></span>

<span data-ttu-id="35266-186">Демультиплексор разделяет формат с чередованием, такой как транспорт AVI или MPEG-2, в базовые потоки аудио и видео.</span><span class="sxs-lookup"><span data-stu-id="35266-186">A demultiplexer splits an interleaved format, such as AVI or MPEG-2 Transport Stream, into the underlying audio and video streams.</span></span>

<span data-ttu-id="35266-187">Если формат содержит определенные сведения о временной метке, которые можно использовать для вычисления точных меток времени вывода на основе меток времени ввода, эти сведения следует использовать.</span><span class="sxs-lookup"><span data-stu-id="35266-187">If the format contains specific time stamp information that can be used to calculate accurate output time stamps based on the input time stamps, that information should be used.</span></span> <span data-ttu-id="35266-188">Однако если формат содержит значения времени в совершенно другой базе, не имеющей связи с метками времени ввода, и точное смещение метки времени не может быть вычислено, то собственное значение формата не должно учитываться.</span><span class="sxs-lookup"><span data-stu-id="35266-188">However, if the format contains times in a completely different base that bear no relation to the input time stamps, and an accurate offset to the input time stamp cannot be calculated, the format's own times should be ignored.</span></span>

<span data-ttu-id="35266-189">Если формат не содержит сведений о метке времени, демультиплексор должен соответствовать следующим правилам.</span><span class="sxs-lookup"><span data-stu-id="35266-189">If the format does not have usable time stamp information, the demultiplexer should follow these rules:</span></span>

-   <span data-ttu-id="35266-190">Несжатые выходные потоки должны иметь допустимые метки времени и длительности, вычисленные на основе ближайшей предыдущей метки времени ввода.</span><span class="sxs-lookup"><span data-stu-id="35266-190">Uncompressed output streams should have valid time stamps and durations if possible, calculated from the closest previous input time stamp.</span></span>

-   <span data-ttu-id="35266-191">Сжатые выходные потоки должны иметь штампы времени только для первого выходного примера, производного от входного образца с отметкой времени.</span><span class="sxs-lookup"><span data-stu-id="35266-191">Compressed output streams should have time stamps on only the first output sample derived from an input sample with a time stamp.</span></span> <span data-ttu-id="35266-192">Если в образце входных данных нет отметки времени, то выходные образцы, производные от этого примера, должны иметь отметку времени.</span><span class="sxs-lookup"><span data-stu-id="35266-192">If the input sample does not have a time stamp, no output samples derived from that input sample should have a time stamp.</span></span> <span data-ttu-id="35266-193">Если образец входных данных разбивается на несколько выходных образцов, только первый из них должен иметь отметку времени, а остальные не должны иметь отметки времени.</span><span class="sxs-lookup"><span data-stu-id="35266-193">If the input sample is broken into multiple output samples, only the first output sample should have a time stamp, and the rest should have no time stamps.</span></span>

### <a name="examples"></a><span data-ttu-id="35266-194">Примеры</span><span class="sxs-lookup"><span data-stu-id="35266-194">Examples</span></span>

<span data-ttu-id="35266-195">Пример 1.</span><span class="sxs-lookup"><span data-stu-id="35266-195">Example 1.</span></span> <span data-ttu-id="35266-196">Предположим, что видеоизображение всегда принимает несжатый входной фрейм, применяет этот результат и копирует его в выходные данные.</span><span class="sxs-lookup"><span data-stu-id="35266-196">Suppose that a video effect always takes an uncompressed input frame, applies the effect, and copies it to the output.</span></span> <span data-ttu-id="35266-197">Он никогда не содержит никаких кадров или буферов.</span><span class="sxs-lookup"><span data-stu-id="35266-197">It never holds back any frames or buffers any input.</span></span> <span data-ttu-id="35266-198">Эта MFT просто копирует отметку времени и продолжительность из образца входных данных в образец вывода, если они доступны, и не выполняет расчеты по времени.</span><span class="sxs-lookup"><span data-stu-id="35266-198">This MFT simply copies the time stamp and duration from the input sample to the output sample, if they are available, and does no time calculations at all.</span></span>

<span data-ttu-id="35266-199">Пример 2.</span><span class="sxs-lookup"><span data-stu-id="35266-199">Example 2.</span></span> <span data-ttu-id="35266-200">Предположим, что звуковой результат преобразует все, кроме 10 миллисекунд (МС) каждого входного буфера, сохраняя дополнительные 10 мс для объединения со следующим буфером.</span><span class="sxs-lookup"><span data-stu-id="35266-200">Suppose that an audio effect transforms all but 10 milliseconds (ms) of each input buffer, saving the extra 10 ms to combine with the next buffer.</span></span> <span data-ttu-id="35266-201">Он получает поток образцов со сроком 50 мс.</span><span class="sxs-lookup"><span data-stu-id="35266-201">It gets a stream of samples that all have a duration of 50 ms.</span></span> <span data-ttu-id="35266-202">Время ввода показано в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="35266-202">The input times are shown in the following table.</span></span>



| <span data-ttu-id="35266-203">Образец</span><span class="sxs-lookup"><span data-stu-id="35266-203">Sample</span></span> | <span data-ttu-id="35266-204">Входное время</span><span class="sxs-lookup"><span data-stu-id="35266-204">Input time</span></span> | <span data-ttu-id="35266-205">Длительность ввода</span><span class="sxs-lookup"><span data-stu-id="35266-205">Input duration</span></span> | <span data-ttu-id="35266-206">Время вывода</span><span class="sxs-lookup"><span data-stu-id="35266-206">Output time</span></span> | <span data-ttu-id="35266-207">Длительность вывода</span><span class="sxs-lookup"><span data-stu-id="35266-207">Output duration</span></span> |
|--------|------------|----------------|-------------|-----------------|
| <span data-ttu-id="35266-208">1</span><span class="sxs-lookup"><span data-stu-id="35266-208">1</span></span>      | <span data-ttu-id="35266-209">20</span><span class="sxs-lookup"><span data-stu-id="35266-209">20</span></span>         | <span data-ttu-id="35266-210">50</span><span class="sxs-lookup"><span data-stu-id="35266-210">50</span></span>             | <span data-ttu-id="35266-211">20</span><span class="sxs-lookup"><span data-stu-id="35266-211">20</span></span>          | <span data-ttu-id="35266-212">40</span><span class="sxs-lookup"><span data-stu-id="35266-212">40</span></span>              |
| <span data-ttu-id="35266-213">2</span><span class="sxs-lookup"><span data-stu-id="35266-213">2</span></span>      | <span data-ttu-id="35266-214">70</span><span class="sxs-lookup"><span data-stu-id="35266-214">70</span></span>         | <span data-ttu-id="35266-215">50</span><span class="sxs-lookup"><span data-stu-id="35266-215">50</span></span>             | <span data-ttu-id="35266-216">60</span><span class="sxs-lookup"><span data-stu-id="35266-216">60</span></span>          | <span data-ttu-id="35266-217">50</span><span class="sxs-lookup"><span data-stu-id="35266-217">50</span></span>              |
| <span data-ttu-id="35266-218">3</span><span class="sxs-lookup"><span data-stu-id="35266-218">3</span></span>      | <span data-ttu-id="35266-219">121</span><span class="sxs-lookup"><span data-stu-id="35266-219">121</span></span>        | <span data-ttu-id="35266-220">50</span><span class="sxs-lookup"><span data-stu-id="35266-220">50</span></span>             | <span data-ttu-id="35266-221">110</span><span class="sxs-lookup"><span data-stu-id="35266-221">110</span></span>         | <span data-ttu-id="35266-222">50</span><span class="sxs-lookup"><span data-stu-id="35266-222">50</span></span>              |
| <span data-ttu-id="35266-223">4</span><span class="sxs-lookup"><span data-stu-id="35266-223">4</span></span>      | <span data-ttu-id="35266-224">171</span><span class="sxs-lookup"><span data-stu-id="35266-224">171</span></span>        | <span data-ttu-id="35266-225">50</span><span class="sxs-lookup"><span data-stu-id="35266-225">50</span></span>             | <span data-ttu-id="35266-226">161</span><span class="sxs-lookup"><span data-stu-id="35266-226">161</span></span>         | <span data-ttu-id="35266-227">50</span><span class="sxs-lookup"><span data-stu-id="35266-227">50</span></span>              |



 

<span data-ttu-id="35266-228">Обратите внимание, что 1-MS расхождение между фактической длительностью выборки 2 и подразумеваемой длительностью, основанной на следующей отметке времени (121?</span><span class="sxs-lookup"><span data-stu-id="35266-228">Note the 1-ms discrepancy between the actual duration of sample 2 and the implied duration based on the next time stamp (121 ?</span></span> <span data-ttu-id="35266-229">70 = 51).</span><span class="sxs-lookup"><span data-stu-id="35266-229">70 = 51).</span></span>

<span data-ttu-id="35266-230">Поскольку таблица MFT содержит обратно 10 мс, она выводит первый 40 мс входного примера 1 в качестве образца вывода 1 с меткой времени 20 мс и длительностью 40 мс.</span><span class="sxs-lookup"><span data-stu-id="35266-230">Because the MFT holds back 10 ms, it outputs the first 40 ms of input sample 1 as output sample 1, with a time stamp of 20 ms and a duration of 40 ms.</span></span>

<span data-ttu-id="35266-231">Пример выходных данных 2 объединяет 10 мс, которые были ранее записаны в 40 мс входного примера 2.</span><span class="sxs-lookup"><span data-stu-id="35266-231">Output sample 2 combines the 10 ms previously held back with 40 ms of input sample 2.</span></span> <span data-ttu-id="35266-232">Этому образцу присваивается метка времени 60 мс (метка времени предыдущего входного примера, 20 мс, а также длительность данных, уже обработанных из этого образца, 40ms).</span><span class="sxs-lookup"><span data-stu-id="35266-232">This sample is given a time stamp of 60 ms (the time stamp of the previous input sample, 20ms, plus the duration of the data already processed from that sample, 40ms).</span></span> <span data-ttu-id="35266-233">Ей присваивается длительность 50 мс.</span><span class="sxs-lookup"><span data-stu-id="35266-233">It is given a duration of 50ms.</span></span>

<span data-ttu-id="35266-234">Аналогичным образом в следующем примере показана метка времени 110ms (70ms + 40ms) с длительностью 50 мс.</span><span class="sxs-lookup"><span data-stu-id="35266-234">Similarly, the next sample has a time stamp of 110ms (70ms + 40ms) with a duration of 50 ms.</span></span>

<span data-ttu-id="35266-235">Следующее вычисление является более интересным.</span><span class="sxs-lookup"><span data-stu-id="35266-235">The next calculation is more interesting.</span></span> <span data-ttu-id="35266-236">Неявная отметка времени предыдущего выходного времени и длительности составит 160 мс (отметка времени 110 MS + Duration 50 мс).</span><span class="sxs-lookup"><span data-stu-id="35266-236">The implied time stamp from the previous output time and duration would be 160 ms (time stamp 110 ms + duration 50 ms).</span></span> <span data-ttu-id="35266-237">Однако отметка времени вывода должна быть вычислена с временной метки времени самого раннего входного примера, который перекрывает образец вывода в течение времени, а также длину всех данных, уже обработанных из этого образца.</span><span class="sxs-lookup"><span data-stu-id="35266-237">However, the output time stamp is supposed to be calculated from the input time stamp of the earliest input sample that overlaps the output sample in time, plus the length of any data already processed from that sample.</span></span> <span data-ttu-id="35266-238">Ближайший перекрывающий пример входных данных — пример 4 (метка времени = 171), но это не самая ранняя.</span><span class="sxs-lookup"><span data-stu-id="35266-238">The closest overlapping input sample is the sample 4 (time stamp = 171), but this is not the earliest one.</span></span> <span data-ttu-id="35266-239">Самый ранний перекрывающий пример — пример 3 (метка времени = 121).</span><span class="sxs-lookup"><span data-stu-id="35266-239">The earliest overlapping sample is sample 3 (time stamp = 121).</span></span> <span data-ttu-id="35266-240">При добавлении 40ms, который уже был обработан из этого образца, результат будет 161.</span><span class="sxs-lookup"><span data-stu-id="35266-240">Adding the 40ms that has already been processed from that sample, the result is 161.</span></span>

## <a name="related-topics"></a><span data-ttu-id="35266-241">См. также</span><span class="sxs-lookup"><span data-stu-id="35266-241">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="35266-242">Запись пользовательского MFT</span><span class="sxs-lookup"><span data-stu-id="35266-242">Writing a Custom MFT</span></span>](writing-a-custom-mft.md)
</dt> </dl>

 

 



