---
description: Поле ограничений использования
ms.assetid: 36f28e4c-2baf-4618-9935-5d4615f6bc77
title: Поле ограничений использования
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b16f57de7642fa789a08c886a32bf906faffb72b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104342472"
---
# <a name="field-of-use-restrictions"></a><span data-ttu-id="b272e-103">Поле ограничений использования</span><span class="sxs-lookup"><span data-stu-id="b272e-103">Field of Use Restrictions</span></span>

> [!Note]  
> <span data-ttu-id="b272e-104">Этот раздел относится к Windows 7 или более поздним версиям.</span><span class="sxs-lookup"><span data-stu-id="b272e-104">This topic applies to Windows 7 or later.</span></span>

 

<span data-ttu-id="b272e-105">Ограничение на *Использование полей* — это подготовка, которая ограничивает возможности использования лицензии для определенной технологии.</span><span class="sxs-lookup"><span data-stu-id="b272e-105">A *field-of-use* restriction is a provision that limits how a license for a particular technology can be used.</span></span>

<span data-ttu-id="b272e-106">Media Foundation предоставляет механизм для применения ограничений на использование полей для Media Foundation преобразований (МФТС), особенно кодеков.</span><span class="sxs-lookup"><span data-stu-id="b272e-106">Media Foundation provides a mechanism for enforcing field-of-use restrictions on Media Foundation transforms (MFTs), particularly codecs.</span></span> <span data-ttu-id="b272e-107">Этот механизм требует, чтобы основная таблица файлов блокировала свое использование приложениями до тех пор, пока приложение не выйдет подтверждение с MFT.</span><span class="sxs-lookup"><span data-stu-id="b272e-107">This mechanism requires the MFT to block its own use by applications until the application has performed a handshake with the MFT.</span></span> <span data-ttu-id="b272e-108">Media Foundation не определяет подтверждение, как правило, это влечет за собой некоторый вид криптографических обменов.</span><span class="sxs-lookup"><span data-stu-id="b272e-108">Media Foundation does not define the handshake—typically, it would involve some sort of cryptographic exchange.</span></span>

### <a name="registration-and-enumeration"></a><span data-ttu-id="b272e-109">Регистрация и перечисление</span><span class="sxs-lookup"><span data-stu-id="b272e-109">Registration and Enumeration</span></span>

<span data-ttu-id="b272e-110">Если в MFT есть ограничения на использование полей, установите флаг **\_ \_ \_ Фиелдофусе флага ПЕРЕЧИСЛЕНИЯ MFT** при регистрации MFT.</span><span class="sxs-lookup"><span data-stu-id="b272e-110">If an MFT has field-of-use restrictions, set the **MFT\_ENUM\_FLAG\_FIELDOFUSE** flag when you register the MFT.</span></span> <span data-ttu-id="b272e-111">Этот флаг применяется к следующим API регистрации MFT:</span><span class="sxs-lookup"><span data-stu-id="b272e-111">This flag applies to the following MFT registration APIs:</span></span>

-   [<span data-ttu-id="b272e-112">**мфтрегистер**</span><span class="sxs-lookup"><span data-stu-id="b272e-112">**MFTRegister**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mftregister)
-   [<span data-ttu-id="b272e-113">**мфтрегистерлокал**</span><span class="sxs-lookup"><span data-stu-id="b272e-113">**MFTRegisterLocal**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mftregisterlocal)
-   [<span data-ttu-id="b272e-114">**мфтрегистерлокалбиклсид**</span><span class="sxs-lookup"><span data-stu-id="b272e-114">**MFTRegisterLocalByCLSID**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mftregisterlocalbyclsid)
-   [<span data-ttu-id="b272e-115">**Имфлокалмфтрегистратион:: Регистермфтс**</span><span class="sxs-lookup"><span data-stu-id="b272e-115">**IMFLocalMFTRegistration::RegisterMFTs**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imflocalmftregistration-registermfts)

<span data-ttu-id="b272e-116">По умолчанию МФТС, зарегистрированные с помощью этого флага, исключаются из результатов перечисления.</span><span class="sxs-lookup"><span data-stu-id="b272e-116">By default, MFTs registered with this flag are excluded from enumeration results.</span></span> <span data-ttu-id="b272e-117">Чтобы перечислить МФТС с ограничениями на использование полей, вызовите [**мфтенумекс**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) и укажите **флаг \_ перечисления MFT \_ флаг \_ фиелдофусе** в параметре *flags* .</span><span class="sxs-lookup"><span data-stu-id="b272e-117">To enumerate MFTs with field-of-use restrictions, call [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) and specify the **MFT\_ENUM\_FLAG\_FIELDOFUSE** flag in the *Flags* parameter.</span></span> <span data-ttu-id="b272e-118">Этот процесс представлен на схеме ниже.</span><span class="sxs-lookup"><span data-stu-id="b272e-118">The following diagram illustrates this process.</span></span>

![Схема, демонстрирующая MFT и приложение, отправляющее данные в реестр](images/mft-fou01.gif)

<span data-ttu-id="b272e-120">Функция [**мфтенум**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) всегда исключает все МФТС с ограничениями на использование полей.</span><span class="sxs-lookup"><span data-stu-id="b272e-120">The [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) function always excludes any MFTs that have field-of-use restrictions.</span></span>

### <a name="unlocking-the-mft"></a><span data-ttu-id="b272e-121">Разблокировка MFT</span><span class="sxs-lookup"><span data-stu-id="b272e-121">Unlocking the MFT</span></span>

<span data-ttu-id="b272e-122">Чтобы использовать таблицу MFT с ограничениями на использование полей, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="b272e-122">To use an MFT with field-of-use restrictions, perform the following steps:</span></span>

1.  <span data-ttu-id="b272e-123">Приложение реализует интерфейс [**имффиелдофусемфтунлокк**](/windows/desktop/api/mfidl/nn-mfidl-imffieldofusemftunlock) .</span><span class="sxs-lookup"><span data-stu-id="b272e-123">The application implements the [**IMFFieldOfUseMFTUnlock**](/windows/desktop/api/mfidl/nn-mfidl-imffieldofusemftunlock) interface.</span></span>
2.  <span data-ttu-id="b272e-124">Метод [**имффиелдофусемфтунлокк:: Unlock**](/windows/desktop/api/mfidl/nf-mfidl-imffieldofusemftunlock-unlock) принимает указатель на интерфейс **IUnknown** таблицы MFT.</span><span class="sxs-lookup"><span data-stu-id="b272e-124">The [**IMFFieldOfUseMFTUnlock::Unlock**](/windows/desktop/api/mfidl/nf-mfidl-imffieldofusemftunlock-unlock) method takes a pointer to the **IUnknown** interface of the MFT.</span></span>
3.  <span data-ttu-id="b272e-125">В методе [**Unlock**](/windows/desktop/api/mfidl/nf-mfidl-imffieldofusemftunlock-unlock) приложение выполняет необходимое подтверждение, используя любой механизм, определяемый MFT.</span><span class="sxs-lookup"><span data-stu-id="b272e-125">In the [**Unlock**](/windows/desktop/api/mfidl/nf-mfidl-imffieldofusemftunlock-unlock) method, the application performs the required handshake, using whatever mechanism is defined by the MFT.</span></span> <span data-ttu-id="b272e-126">Этот шаг не определяется Media Foundation API.</span><span class="sxs-lookup"><span data-stu-id="b272e-126">This step is not defined by Media Foundation API.</span></span>
4.  <span data-ttu-id="b272e-127">Если метод [**Unlock**](/windows/desktop/api/mfidl/nf-mfidl-imffieldofusemftunlock-unlock) завершился, Таблица MFT разблокируется.</span><span class="sxs-lookup"><span data-stu-id="b272e-127">If the [**Unlock**](/windows/desktop/api/mfidl/nf-mfidl-imffieldofusemftunlock-unlock) method succeeds, the MFT unlocks itself.</span></span>

<span data-ttu-id="b272e-128">Приложение задает указатель [**имффиелдофусемфтунлокк**](/windows/desktop/api/mfidl/nn-mfidl-imffieldofusemftunlock) , устанавливая атрибут [MFT \_ фиелдофусе \_ Unlock \_](mft-fieldofuse-unlock-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="b272e-128">The application specifies the [**IMFFieldOfUseMFTUnlock**](/windows/desktop/api/mfidl/nn-mfidl-imffieldofusemftunlock) pointer by setting the [MFT\_FIELDOFUSE\_UNLOCK\_Attribute](mft-fieldofuse-unlock-attribute.md) attribute.</span></span> <span data-ttu-id="b272e-129">Задать этот атрибут можно несколькими способами в зависимости от того, как ваше приложение создает кодировщик или конвейер кодирования:</span><span class="sxs-lookup"><span data-stu-id="b272e-129">There are several different ways to set this attribute, depending on how your application creates the decoder or encoding pipeline:</span></span>



| <span data-ttu-id="b272e-130">API</span><span class="sxs-lookup"><span data-stu-id="b272e-130">API</span></span>                   | <span data-ttu-id="b272e-131">Как разблокировать используемое поле</span><span class="sxs-lookup"><span data-stu-id="b272e-131">How to Unlock Field-Of-Use</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|-----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="b272e-132">Модуль чтения исходного кода</span><span class="sxs-lookup"><span data-stu-id="b272e-132">Source Reader</span></span>         | <span data-ttu-id="b272e-133">Если приложение использует [модуль чтения исходного кода](source-reader.md) для декодирования файла мультимедиа, установите атрибут [ \_ Фиелдофусе \_ Unlock \_ ](mft-fieldofuse-unlock-attribute.md) в файле MFT в параметрах конфигурации.</span><span class="sxs-lookup"><span data-stu-id="b272e-133">If your application uses the [Source Reader](source-reader.md) to decode a media file, set the [MFT\_FIELDOFUSE\_UNLOCK\_Attribute](mft-fieldofuse-unlock-attribute.md) attribute in the configuration parameters.</span></span> <span data-ttu-id="b272e-134">См. раздел [атрибуты модуля чтения исходного кода](source-reader-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="b272e-134">See [Source Reader Attributes](source-reader-attributes.md).</span></span>                                                                                                                                                                                                                                                                         |
| <span data-ttu-id="b272e-135">Модуль записи приемников</span><span class="sxs-lookup"><span data-stu-id="b272e-135">Sink Writer</span></span>           | <span data-ttu-id="b272e-136">Если приложение использует модуль записи приемника для кодирования файла мультимедиа, установите атрибут [ \_ фиелдофусе \_ Unlock \_ для MFT](mft-fieldofuse-unlock-attribute.md) в параметрах конфигурации.</span><span class="sxs-lookup"><span data-stu-id="b272e-136">If your application uses the sink writer to encode a media file, set the [MFT\_FIELDOFUSE\_UNLOCK\_Attribute](mft-fieldofuse-unlock-attribute.md) attribute in the configuration parameters.</span></span> <span data-ttu-id="b272e-137">См. раздел [атрибуты модуля записи приемника](sink-writer-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="b272e-137">See [Sink Writer Attributes](sink-writer-attributes.md).</span></span>                                                                                                                                                                                                                                                                                                    |
| <span data-ttu-id="b272e-138">Быстрый перекодированный</span><span class="sxs-lookup"><span data-stu-id="b272e-138">Fast Transcode</span></span>        | <span data-ttu-id="b272e-139">Если приложение использует функцию быстрого перекодирования для создания топологии кодирования, установите [ \_ \_ \_ атрибут MFT фиелдофусе Unlock](mft-fieldofuse-unlock-attribute.md) при вызове [**имфтранскодепрофиле:: сетконтаинераттрибутес**](/windows/desktop/api/mfidl/nf-mfidl-imftranscodeprofile-setcontainerattributes).</span><span class="sxs-lookup"><span data-stu-id="b272e-139">If your application uses the Fast Transcode feature to create an encoding topology, set the [MFT\_FIELDOFUSE\_UNLOCK\_Attribute](mft-fieldofuse-unlock-attribute.md) when you call [**IMFTranscodeProfile::SetContainerAttributes**](/windows/desktop/api/mfidl/nf-mfidl-imftranscodeprofile-setcontainerattributes).</span></span> <span data-ttu-id="b272e-140">Дополнительные сведения о функции быстрого перекодирования см. в разделе [API перекодирования](transcode-api.md).</span><span class="sxs-lookup"><span data-stu-id="b272e-140">For more information about the Fast Transcode feature, see [Transcode API](transcode-api.md).</span></span>                                                                                                                                                                      |
| <span data-ttu-id="b272e-141">Топология</span><span class="sxs-lookup"><span data-stu-id="b272e-141">Topology</span></span>              | <span data-ttu-id="b272e-142">Если топология создается напрямую, установите [ \_ \_ \_ атрибут MFT фиелдофусе Unlock](mft-fieldofuse-unlock-attribute.md) в качестве атрибута в топологии.</span><span class="sxs-lookup"><span data-stu-id="b272e-142">If you create a topology directly, set the [MFT\_FIELDOFUSE\_UNLOCK\_Attribute](mft-fieldofuse-unlock-attribute.md) as an attribute on the topology.</span></span> <span data-ttu-id="b272e-143">См. раздел [атрибуты топологии](topology-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="b272e-143">See [Topology Attributes](topology-attributes.md).</span></span>                                                                                                                                                                                                                                                                                                                                                  |
| <span data-ttu-id="b272e-144">Объект активации MFT</span><span class="sxs-lookup"><span data-stu-id="b272e-144">MFT Activation Object</span></span> | <span data-ttu-id="b272e-145">Если приложение напрямую перечисляет декодеры или кодировщики, которые он будет использовать, установите [ \_ \_ \_ атрибут MFT фиелдофусе Unlock](mft-fieldofuse-unlock-attribute.md) для указателей [**имфактивате**](/windows/desktop/api/mfobjects/nn-mfobjects-imfactivate) , возвращаемых функцией [**мфтенумекс**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) .</span><span class="sxs-lookup"><span data-stu-id="b272e-145">If your application directly enumerates the decoders or encoders that it will use, set the [MFT\_FIELDOFUSE\_UNLOCK\_Attribute](mft-fieldofuse-unlock-attribute.md) on the [**IMFActivate**](/windows/desktop/api/mfobjects/nn-mfobjects-imfactivate) pointers returned by the [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) function.</span></span> <br/> <span data-ttu-id="b272e-146">Задайте атрибут перед вызовом [**имфактивате:: активатеобжект**](/windows/desktop/api/mfobjects/nf-mfobjects-imfactivate-activateobject) , чтобы создать таблицу MFT.</span><span class="sxs-lookup"><span data-stu-id="b272e-146">Set the attribute before calling [**IMFActivate::ActivateObject**](/windows/desktop/api/mfobjects/nf-mfobjects-imfactivate-activateobject) to create the MFT.</span></span> <span data-ttu-id="b272e-147">Объект активации вызывает [**имффиелдофусемфтунлокк:: Unlock**](/windows/desktop/api/mfidl/nf-mfidl-imffieldofusemftunlock-unlock) при создании MFT.</span><span class="sxs-lookup"><span data-stu-id="b272e-147">The activation object calls [**IMFFieldOfUseMFTUnlock::Unlock**](/windows/desktop/api/mfidl/nf-mfidl-imffieldofusemftunlock-unlock) when it creates the MFT.</span></span><br/> |



 

<span data-ttu-id="b272e-148">На следующей схеме показана связь между объектами активации MFT и интерфейсом [**имффиелдофусемфтунлокк**](/windows/desktop/api/mfidl/nn-mfidl-imffieldofusemftunlock) .</span><span class="sxs-lookup"><span data-stu-id="b272e-148">The following diagram shows the relation between MFT activation objects and the [**IMFFieldOfUseMFTUnlock**](/windows/desktop/api/mfidl/nn-mfidl-imffieldofusemftunlock) interface.</span></span>

![Схема, показывающая приложение, объект активации и MFT со стрелками к объекту Фау, который имеет стрелку обратно в MFT](images/mft-fou02.gif)

## <a name="related-topics"></a><span data-ttu-id="b272e-150">См. также</span><span class="sxs-lookup"><span data-stu-id="b272e-150">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b272e-151">Преобразования Media Foundation</span><span class="sxs-lookup"><span data-stu-id="b272e-151">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 




