---
description: В этом разделе описано, как преобразование Media Foundation (MFT) должно выполнять обработку изменений формата во время потоковой передачи.
ms.assetid: b0a94760-b4dd-4e50-a5ce-a1f674dde156
title: Обработка изменений в потоке
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2adf3cbc0504a37fe611b77047c73f85b9d1e742
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104263446"
---
# <a name="handling-stream-changes"></a><span data-ttu-id="c6501-103">Обработка изменений в потоке</span><span class="sxs-lookup"><span data-stu-id="c6501-103">Handling Stream Changes</span></span>

<span data-ttu-id="c6501-104">В этом разделе описано, как преобразование Media Foundation (MFT) должно выполнять обработку изменений формата во время потоковой передачи.</span><span class="sxs-lookup"><span data-stu-id="c6501-104">This topic describes how a Media Foundation transform (MFT) should handle format changes during streaming.</span></span>

> [!IMPORTANT]
>
> <span data-ttu-id="c6501-105">Этот раздел не относится к кодировщикам.</span><span class="sxs-lookup"><span data-stu-id="c6501-105">This topic does not apply to encoders.</span></span> <span data-ttu-id="c6501-106">Кодировщики не должны распространять изменения формата, как описано в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="c6501-106">Encoders should not propagate format changes as described in this topic.</span></span> <span data-ttu-id="c6501-107">Кодировщики должны принимать только входной тип, совпадающий с настроенным типом выходных данных.</span><span class="sxs-lookup"><span data-stu-id="c6501-107">Encoders should only accept an input type that matches the currently configured output type.</span></span>

 

## <a name="overview-of-format-changes"></a><span data-ttu-id="c6501-108">Общие сведения об изменениях формата</span><span class="sxs-lookup"><span data-stu-id="c6501-108">Overview of Format Changes</span></span>

<span data-ttu-id="c6501-109">Обычно существует две причины, по которым формат может измениться во время потоковой передачи.</span><span class="sxs-lookup"><span data-stu-id="c6501-109">Generally, there are two reasons that a format can change during streaming.</span></span>

-   <span data-ttu-id="c6501-110">Клиент может переключиться в поток с новым форматом.</span><span class="sxs-lookup"><span data-stu-id="c6501-110">The client might switch to a stream with a new format.</span></span> <span data-ttu-id="c6501-111">Например, в цифровом телевизоре это может произойти из-за изменения канала.</span><span class="sxs-lookup"><span data-stu-id="c6501-111">For example, in digital television, this can occur due to a channel change.</span></span>
-   <span data-ttu-id="c6501-112">В некоторых форматах видео, таких как H. 264, битовый поток может сигнализировать об изменении формата.</span><span class="sxs-lookup"><span data-stu-id="c6501-112">In some video formats, such as H.264, the bitstream can signal a format change.</span></span> <span data-ttu-id="c6501-113">К таким изменениям могут относиться изменения в поле превосходство, разрешение видео или пропорции пикселей.</span><span class="sxs-lookup"><span data-stu-id="c6501-113">Such changes might include changes in field dominance, video resolution, or pixel aspect ratio.</span></span>

<span data-ttu-id="c6501-114">Если тип кодировки изменится, клиенту может потребоваться удалить MFT из конвейера и заменить его другой MFT.</span><span class="sxs-lookup"><span data-stu-id="c6501-114">If the encoding type changes, the client might need to remove the MFT from the pipeline and replace it with another MFT.</span></span> <span data-ttu-id="c6501-115">(Например, клиенту может потребоваться поменять местами новый декодер.) Эта ситуация не рассматривается в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="c6501-115">(For example, the client might need to swap in a new decoder.) This topic does not cover that situation.</span></span> <span data-ttu-id="c6501-116">В этом разделе рассматривается только тот случай, когда текущая таблица MFT может работать с новым форматом.</span><span class="sxs-lookup"><span data-stu-id="c6501-116">This topic covers only the case where the current MFT can handle the new format.</span></span>

<span data-ttu-id="c6501-117">При изменении формата MFT может потребоваться новый тип входных данных, новый тип вывода или и то, и другое.</span><span class="sxs-lookup"><span data-stu-id="c6501-117">If the format changes, the MFT might require a new input type, a new output type, or both.</span></span>

-   <span data-ttu-id="c6501-118">Изменения типа ввода инициируются клиентом.</span><span class="sxs-lookup"><span data-stu-id="c6501-118">Changes to input type are initiated by the client.</span></span> <span data-ttu-id="c6501-119">MFT никогда не изменяет собственный тип входных данных.</span><span class="sxs-lookup"><span data-stu-id="c6501-119">An MFT never changes its own input type.</span></span>
-   <span data-ttu-id="c6501-120">Изменения типа выходных данных инициируются MFT.</span><span class="sxs-lookup"><span data-stu-id="c6501-120">Changes to output type are initiated by the MFT.</span></span> <span data-ttu-id="c6501-121">MFT сообщает, что требуется новый тип выходных данных, и клиент согласовывает новый тип вывода с MFT.</span><span class="sxs-lookup"><span data-stu-id="c6501-121">The MFT signals that it requires a new output type, and the client negotiates the new output type with the MFT.</span></span>

<span data-ttu-id="c6501-122">Таким образом, возможны три разных варианта:</span><span class="sxs-lookup"><span data-stu-id="c6501-122">Thus, three distinct cases are possible:</span></span>

-   <span data-ttu-id="c6501-123">Клиент задает новый тип входных данных.</span><span class="sxs-lookup"><span data-stu-id="c6501-123">The client sets a new input type.</span></span> <span data-ttu-id="c6501-124">Файловая Таблица MFT использует новый формат без изменения его типа вывода.</span><span class="sxs-lookup"><span data-stu-id="c6501-124">The MFT consumes the new format, with no change to its output type.</span></span>
-   <span data-ttu-id="c6501-125">Клиент устанавливает новый тип входных данных, и это активирует изменение типа выходных данных.</span><span class="sxs-lookup"><span data-stu-id="c6501-125">The client sets a new input type, and this triggers a change in the output type.</span></span>
-   <span data-ttu-id="c6501-126">Тип входных данных не изменяется, но MFT обнаруживает изменение формата в битовый поток, для которого требуется новый тип выходных данных.</span><span class="sxs-lookup"><span data-stu-id="c6501-126">The input type does not change, but the MFT detects a format change in the bitstream, which requires a new output type.</span></span>

## <a name="implementing-format-changes"></a><span data-ttu-id="c6501-127">Реализация изменений формата</span><span class="sxs-lookup"><span data-stu-id="c6501-127">Implementing Format Changes</span></span>

<span data-ttu-id="c6501-128">Оставшаяся часть этого раздела описывает, как клиент должен обработать изменение формата и как реализовать изменения формата в таблице MFT.</span><span class="sxs-lookup"><span data-stu-id="c6501-128">The remainder of this topic describes how the client should process a format change, and how to implement format changes in an MFT.</span></span>

### <a name="output-type"></a><span data-ttu-id="c6501-129">Тип выходных данных</span><span class="sxs-lookup"><span data-stu-id="c6501-129">Output Type</span></span>

<span data-ttu-id="c6501-130">Любые файлы MFT могут инициировать изменение типа выходных данных следующим образом:</span><span class="sxs-lookup"><span data-stu-id="c6501-130">Any MFT can initiate a change to its output type, as follows:</span></span>

1.  <span data-ttu-id="c6501-131">Клиент вызывает [**имфтрансформ::P роцессаутпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="c6501-131">The client calls [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="c6501-132">Основная таблица MFT реагирует следующим образом:</span><span class="sxs-lookup"><span data-stu-id="c6501-132">The MFT responds as follows:</span></span>
    1.  <span data-ttu-id="c6501-133">MFT не создает пример выходных данных в [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="c6501-133">The MFT does not produce an output sample in [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>
    2.  <span data-ttu-id="c6501-134">MFT задает флаг **\_ \_ \_ \_ \_ изменения формата буфера выходных данных MFT** в элементе **dwstatus устанавливается** структуры [**\_ \_ \_ буфера выходных данных MFT**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_data_buffer) .</span><span class="sxs-lookup"><span data-stu-id="c6501-134">The MFT sets the **MFT\_OUTPUT\_DATA\_BUFFER\_FORMAT\_CHANGE** flag in the **dwStatus** member of the [**MFT\_OUTPUT\_DATA\_BUFFER**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_data_buffer) structure.</span></span>
    3.  <span data-ttu-id="c6501-135">Метод [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) возвращает **\_ \_ \_ \_ изменение потока преобразования**, код ошибки MF E.</span><span class="sxs-lookup"><span data-stu-id="c6501-135">The [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method returns the error code **MF\_E\_TRANSFORM\_STREAM\_CHANGE**.</span></span>
2.  <span data-ttu-id="c6501-136">Клиент вызывает [**имфтрансформ:: жетаутпутаваилаблетипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype).</span><span class="sxs-lookup"><span data-stu-id="c6501-136">The client calls [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype).</span></span> <span data-ttu-id="c6501-137">Этот метод возвращает обновленный набор выходных типов.</span><span class="sxs-lookup"><span data-stu-id="c6501-137">This method returns an updated set of output types.</span></span>
3.  <span data-ttu-id="c6501-138">Клиент вызывает [**сетаутпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) для установки нового типа выходных данных.</span><span class="sxs-lookup"><span data-stu-id="c6501-138">The client calls [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) to set a new output type.</span></span>
4.  <span data-ttu-id="c6501-139">Клиент возобновляет вызов метода [**ProcessInput**](/windows/desktop/api/mfidl/nf-mfidl-imfqualitymanager-notifyprocessinput) / [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="c6501-139">The client resumes calling [**ProcessInput**](/windows/desktop/api/mfidl/nf-mfidl-imfqualitymanager-notifyprocessinput)/[**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

### <a name="input-type"></a><span data-ttu-id="c6501-140">Тип входных данных</span><span class="sxs-lookup"><span data-stu-id="c6501-140">Input Type</span></span>

<span data-ttu-id="c6501-141">Изменения типа входных данных инициируются клиентом, а не MFT.</span><span class="sxs-lookup"><span data-stu-id="c6501-141">Changes to the input type are initiated by the client, never by the MFT.</span></span> <span data-ttu-id="c6501-142">Если тип ввода изменяется, он может активировать изменение типа выходных данных.</span><span class="sxs-lookup"><span data-stu-id="c6501-142">If the input type changes, it might trigger a change to the output type.</span></span>

<span data-ttu-id="c6501-143">Точная последовательность событий зависит от значения атрибута [**MFT, \_ поддерживающего \_ динамическое \_ \_ изменение формата**](mft-support-dynamic-format-change-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="c6501-143">The exact sequence of events depends on the value of the [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) attribute.</span></span>



| <span data-ttu-id="c6501-144">Значение</span><span class="sxs-lookup"><span data-stu-id="c6501-144">Value</span></span>     | <span data-ttu-id="c6501-145">Описание</span><span class="sxs-lookup"><span data-stu-id="c6501-145">Description</span></span>                                                     |
|-----------|-----------------------------------------------------------------|
| <span data-ttu-id="c6501-146">**FALSE**</span><span class="sxs-lookup"><span data-stu-id="c6501-146">**FALSE**</span></span> | <span data-ttu-id="c6501-147">Прежде чем клиент установит новый тип входных данных, он должен очистить MFT.</span><span class="sxs-lookup"><span data-stu-id="c6501-147">Before the client sets a new input type, it must drain the MFT.</span></span> |
| <span data-ttu-id="c6501-148">**TRUE**</span><span class="sxs-lookup"><span data-stu-id="c6501-148">**TRUE**</span></span>  | <span data-ttu-id="c6501-149">Клиент может задать новый тип входных данных без очистки MFT.</span><span class="sxs-lookup"><span data-stu-id="c6501-149">The client can set a new input type without draining the MFT.</span></span>   |



 

<span data-ttu-id="c6501-150">MFT предоставляет этот атрибут через его метод [**имфтрансформ:: InAttribute**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) .</span><span class="sxs-lookup"><span data-stu-id="c6501-150">An MFT exposes this attribute through its [**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) method.</span></span> <span data-ttu-id="c6501-151">Значение этого атрибута по умолчанию равно **false**. Если в таблице MFT не задан атрибут, значение следует рассматривать как **false**.</span><span class="sxs-lookup"><span data-stu-id="c6501-151">The default value of this attribute is **FALSE**; if the MFT does not set the attribute, treat the value as **FALSE**.</span></span>

<span data-ttu-id="c6501-152">**\_ \_ Динамическое \_ изменение формата MFT \_ имеет значение false**</span><span class="sxs-lookup"><span data-stu-id="c6501-152">**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE is FALSE**</span></span>

1.  <span data-ttu-id="c6501-153">Клиент отправляет сообщение о [**\_ \_ \_ стоке команды сообщения MFT**](mft-message-command-drain.md) .</span><span class="sxs-lookup"><span data-stu-id="c6501-153">The client sends the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.</span></span>
2.  <span data-ttu-id="c6501-154">Клиент перейдет MFT, вызвав [**имфтрансформ::P роцессаутпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) до тех пор, пока **ProcessOutput** возвращает для **\_ преобразования MF E \_ \_ требуется \_ больше \_ входных данных**.</span><span class="sxs-lookup"><span data-stu-id="c6501-154">The client drains the MFT by calling [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) until **ProcessOutput** returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**.</span></span>
3.  <span data-ttu-id="c6501-155">Клиент вызывает [**имфтрансформ:: сетинпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) для установки нового типа входных данных.</span><span class="sxs-lookup"><span data-stu-id="c6501-155">The client calls [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) to set the new input type.</span></span>
4.  <span data-ttu-id="c6501-156">MFT проверяет тип входных данных.</span><span class="sxs-lookup"><span data-stu-id="c6501-156">The MFT validates the input type.</span></span> <span data-ttu-id="c6501-157">Если тип является недопустимым, [**сетинпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) возвращает **MF \_ E \_ инвалидмедиатипе** или другой код ошибки.</span><span class="sxs-lookup"><span data-stu-id="c6501-157">If the type is invalid, [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) returns **MF\_E\_INVALIDMEDIATYPE** or another error code.</span></span> <span data-ttu-id="c6501-158">В противном случае **сетинпуттипе** возвращает значение S \_ ОК.</span><span class="sxs-lookup"><span data-stu-id="c6501-158">Otherwise, **SetInputType** returns S\_OK.</span></span>
5.  <span data-ttu-id="c6501-159">Предполагая, что входной тип является допустимым, MFT проверяет, изменяется ли тип выходных данных.</span><span class="sxs-lookup"><span data-stu-id="c6501-159">Assuming the input type is valid, the MFT evaluates whether the output type also changes.</span></span> <span data-ttu-id="c6501-160">Если нет, потоковая передача продолжается, и дальнейшие действия не требуются.</span><span class="sxs-lookup"><span data-stu-id="c6501-160">If not, streaming continues, and no further action is required.</span></span>
6.  <span data-ttu-id="c6501-161">Если тип выходных данных изменится:</span><span class="sxs-lookup"><span data-stu-id="c6501-161">If the output type changes:</span></span>
    1.  <span data-ttu-id="c6501-162">Файл MFT делает текущий тип выходного носителя недействительным и обновляет список доступных типов выходных носителей.</span><span class="sxs-lookup"><span data-stu-id="c6501-162">The MFT invalidates its current output media type, and updates the list of available output media types.</span></span>
    2.  <span data-ttu-id="c6501-163">При следующем вызове метода [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) возвращается значение **MF \_ E \_ преобразования \_ Stream \_**, как описано в предыдущем разделе.</span><span class="sxs-lookup"><span data-stu-id="c6501-163">The next call to [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) returns **MF\_E\_TRANSFORM\_STREAM\_CHANGE**, as described in the previous section.</span></span>
    3.  <span data-ttu-id="c6501-164">Клиент вызывает [**имфтрансформ:: жетаутпутаваилаблетипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) , чтобы получить обновленный список типов выходных данных.</span><span class="sxs-lookup"><span data-stu-id="c6501-164">The client calls [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) to get the updated list of output types.</span></span>
    4.  <span data-ttu-id="c6501-165">Клиент вызывает [**сетаутпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span><span class="sxs-lookup"><span data-stu-id="c6501-165">The client calls [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span></span>

<span data-ttu-id="c6501-166">**\_Поддерживается \_ динамическое \_ \_ изменение формата MFT**</span><span class="sxs-lookup"><span data-stu-id="c6501-166">**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE is TRUE**</span></span>

1.  <span data-ttu-id="c6501-167">Клиент вызывает [**имфтрансформ:: сетинпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) для установки нового типа входных данных.</span><span class="sxs-lookup"><span data-stu-id="c6501-167">The client calls [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) to set the new input type.</span></span>
2.  <span data-ttu-id="c6501-168">MFT проверяет тип входных данных.</span><span class="sxs-lookup"><span data-stu-id="c6501-168">The MFT validates the input type.</span></span> <span data-ttu-id="c6501-169">Если тип является недопустимым, [**сетинпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) возвращает **MF \_ E \_ инвалидмедиатипе** или другой код ошибки.</span><span class="sxs-lookup"><span data-stu-id="c6501-169">If the type is invalid, [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) returns **MF\_E\_INVALIDMEDIATYPE** or another error code.</span></span> <span data-ttu-id="c6501-170">В противном случае **сетинпуттипе** возвращает значение S \_ ОК.</span><span class="sxs-lookup"><span data-stu-id="c6501-170">Otherwise, **SetInputType** returns S\_OK.</span></span>
3.  <span data-ttu-id="c6501-171">Предполагая, что входной тип является допустимым, MFT проверяет, изменяется ли тип выходных данных.</span><span class="sxs-lookup"><span data-stu-id="c6501-171">Assuming the input type is valid, the MFT evaluates whether the output type also changes.</span></span> <span data-ttu-id="c6501-172">Если нет, потоковая передача продолжается, и дальнейшие действия не требуются.</span><span class="sxs-lookup"><span data-stu-id="c6501-172">If not, streaming continues, and no further action is required.</span></span>
4.  <span data-ttu-id="c6501-173">Перед изменением типа выходных данных MFT должен обработать все кэшированные входные примеры, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="c6501-173">Before the output type changes, the MFT must process any cached input samples, as follows:</span></span>
    1.  <span data-ttu-id="c6501-174">Таблица MFT не делает ее текущим типом вывода.</span><span class="sxs-lookup"><span data-stu-id="c6501-174">The MFT does not invalidate its current output type.</span></span>
    2.  <span data-ttu-id="c6501-175">MFT создает столько выходных данных, сколько можно из кэшированных входных примеров.</span><span class="sxs-lookup"><span data-stu-id="c6501-175">The MFT produces as much output as it can from the cached input samples.</span></span>
    3.  <span data-ttu-id="c6501-176">Необязательно, принимает ли MFT новые входные образцы во время обработки кэшированных образцов.</span><span class="sxs-lookup"><span data-stu-id="c6501-176">It is optional whether the MFT accepts new input samples while it processes the cached samples.</span></span> <span data-ttu-id="c6501-177">В этом случае новые входные образцы будут использовать новый формат входных данных, поэтому MFT должен отследить точку при изменении формата.</span><span class="sxs-lookup"><span data-stu-id="c6501-177">If so, the new input samples will use the new input format, so the MFT must keep track of the point when the format changed.</span></span>
5.  <span data-ttu-id="c6501-178">После того как MFT обработает все примеры, полученные перед изменением типа входных данных, [**имфтрансформ::P роцессаутпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) возвращает значение **MF \_ E \_ преобразования \_ потока \_**.</span><span class="sxs-lookup"><span data-stu-id="c6501-178">After the MFT processes all of the samples that it received before the input type changed, the [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) returns **MF\_E\_TRANSFORM\_STREAM\_CHANGE**.</span></span>
6.  <span data-ttu-id="c6501-179">Файл MFT делает текущий тип выходных данных недействительным и обновляет список доступных типов выходных носителей.</span><span class="sxs-lookup"><span data-stu-id="c6501-179">The MFT invalidates its current output type, and updates the list of available output media types.</span></span>
7.  <span data-ttu-id="c6501-180">Клиент согласовывает новый тип вывода, как описано выше.</span><span class="sxs-lookup"><span data-stu-id="c6501-180">The client negotiates the new output type, as described previously.</span></span>

<span data-ttu-id="c6501-181">[Асинхронный МФТС](asynchronous-mfts.md) должен возвращать значение **true** для атрибута [**MFT, \_ поддерживающего \_ динамическое \_ \_ изменение формата**](mft-support-dynamic-format-change-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="c6501-181">[Asynchronous MFTs](asynchronous-mfts.md) must return the value **TRUE** for the [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) attribute.</span></span> <span data-ttu-id="c6501-182">При использовании асинхронной таблицы MFT клиент может предположить, что для **атрибута \_ \_ динамической настройки \_ формата \_ MFT** задано значение **true**.</span><span class="sxs-lookup"><span data-stu-id="c6501-182">When using an asynchronous MFT, the client can assume that the **MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE** attribute is set to **TRUE**.</span></span>

<span data-ttu-id="c6501-183">Если [**\_ \_ динамическое \_ \_ изменение формата MFT**](mft-support-dynamic-format-change-attribute.md) имеет **значение true**, основное различие заключается в том, что клиенту не требуется выполнять сток MFT перед установкой нового типа входных данных.</span><span class="sxs-lookup"><span data-stu-id="c6501-183">When [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) is **TRUE**, the main difference is that the client is not required to drain the MFT before setting a new input type.</span></span> <span data-ttu-id="c6501-184">В результате тип входных данных может измениться, когда MFT удерживается на входных образцах.</span><span class="sxs-lookup"><span data-stu-id="c6501-184">As a result, the input type might change while the MFT is holding onto input samples.</span></span> <span data-ttu-id="c6501-185">Очень важно, чтобы в MFT не было просто удалять эти образцы.</span><span class="sxs-lookup"><span data-stu-id="c6501-185">It is important that the MFT does not simply drop these samples.</span></span> <span data-ttu-id="c6501-186">Кроме того, тип выходных данных не может измениться, пока MFT обрабатывает все кэшированные данные.</span><span class="sxs-lookup"><span data-stu-id="c6501-186">Also, the output type cannot change until the MFT processes all of its cached data.</span></span>

<span data-ttu-id="c6501-187">Предыдущий абзац применяется особенно для видеодекодеров, которые могут принимать промежуточные кадры из временного порядка, и поэтому их необходимо кэшировать.</span><span class="sxs-lookup"><span data-stu-id="c6501-187">The previous paragraph applies especially to video decoders, which can receive inter-coded frames out of temporal order, and thus need to cache them.</span></span> <span data-ttu-id="c6501-188">Если таблица MFT не кэширует входные образцы, то сток является, по сути, отсутствием операций.</span><span class="sxs-lookup"><span data-stu-id="c6501-188">If an MFT does not cache input samples, draining is essentially a no-op.</span></span> <span data-ttu-id="c6501-189">В этом случае MFT может установить [**\_ \_ динамическое \_ \_ изменение формата MFT**](mft-support-dynamic-format-change-attribute.md) на **false** (или оставить атрибут неопределенным).</span><span class="sxs-lookup"><span data-stu-id="c6501-189">In that case, the MFT can set [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) to **FALSE** (or leave the attribute unset).</span></span>

<span data-ttu-id="c6501-190">Кроме того, обратите внимание, что каждый MFT должен правильно работать с изменениями формата после его очистки.</span><span class="sxs-lookup"><span data-stu-id="c6501-190">Also, note that every MFT is expected to handle format changes correctly after being drained.</span></span> <span data-ttu-id="c6501-191">В [**\_ \_ динамическом атрибуте \_ \_ изменения формата MFT**](mft-support-dynamic-format-change-attribute.md) указывается, поддерживает ли MFT изменение формата без стока.</span><span class="sxs-lookup"><span data-stu-id="c6501-191">The [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) attribute indicates whether the MFT supports format changes without draining.</span></span>

## <a name="change-in-interlace-mode"></a><span data-ttu-id="c6501-192">Изменение в режиме чередования</span><span class="sxs-lookup"><span data-stu-id="c6501-192">Change in Interlace Mode</span></span>

<span data-ttu-id="c6501-193">Изменения в режиме чередования видео являются особым случаем, так как они не делают недействительными текущий тип носителя.</span><span class="sxs-lookup"><span data-stu-id="c6501-193">Changes in the video interlacing mode are a special case, because they do not invalidate the current media type.</span></span> <span data-ttu-id="c6501-194">Вместо этого для каждого видеокадра задается режим чередования, устанавливая атрибуты на примере носителя.</span><span class="sxs-lookup"><span data-stu-id="c6501-194">Instead, the interlace mode is specified for each video frame by setting attributes on the media sample.</span></span> <span data-ttu-id="c6501-195">Видеофайл MFT должен проверять каждый входной образец на наличие этих флагов.</span><span class="sxs-lookup"><span data-stu-id="c6501-195">A video MFT should check each input sample for the presence of these flags.</span></span>

<span data-ttu-id="c6501-196">Режим чересстрочная развертки может изменяться, когда поле превосходство переключается от верхнего поля к нижнему полю или когда видео переключается между последовательными и чередованиями изображений.</span><span class="sxs-lookup"><span data-stu-id="c6501-196">The interlace mode can change when the field dominance switches from top-field to bottom-field, or when the video switches between progressive and interlaced pictures.</span></span>

<span data-ttu-id="c6501-197">Дополнительные сведения см. [в разделе чередование флагов в примерах](video-interlacing.md).</span><span class="sxs-lookup"><span data-stu-id="c6501-197">For more information, see [Interlace Flags on Samples](video-interlacing.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="c6501-198">См. также</span><span class="sxs-lookup"><span data-stu-id="c6501-198">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c6501-199">Запись пользовательского MFT</span><span class="sxs-lookup"><span data-stu-id="c6501-199">Writing a Custom MFT</span></span>](writing-a-custom-mft.md)
</dt> </dl>

 

 



