---
description: В этом разделе описывается асинхронная обработка данных для Media Foundation преобразований (МФТС).
ms.assetid: d438ffae-fc50-454f-8ce4-2d6676500fff
title: Асинхронный МФТС
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4a16950cf431eff16f2befb382a77910c49ccb2e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105701334"
---
# <a name="asynchronous-mfts"></a><span data-ttu-id="0c1f2-103">Асинхронный МФТС</span><span class="sxs-lookup"><span data-stu-id="0c1f2-103">Asynchronous MFTs</span></span>

<span data-ttu-id="0c1f2-104">В этом разделе описывается асинхронная обработка данных для Media Foundation преобразований (МФТС).</span><span class="sxs-lookup"><span data-stu-id="0c1f2-104">This topic describes asynchronous data processing for Media Foundation transforms (MFTs).</span></span>

> [!Note]  
> <span data-ttu-id="0c1f2-105">Этот раздел относится к Windows 7 или более поздним версиям.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-105">This topic applies to Windows 7 or later.</span></span>

 

-   [<span data-ttu-id="0c1f2-106">Об асинхронном МФТС</span><span class="sxs-lookup"><span data-stu-id="0c1f2-106">About Asynchronous MFTs</span></span>](#about-asynchronous-mfts)
-   [<span data-ttu-id="0c1f2-107">Общие требования</span><span class="sxs-lookup"><span data-stu-id="0c1f2-107">General Requirements</span></span>](#general-requirements)
-   [<span data-ttu-id="0c1f2-108">События</span><span class="sxs-lookup"><span data-stu-id="0c1f2-108">Events</span></span>](#events)
-   [<span data-ttu-id="0c1f2-109">ProcessInput</span><span class="sxs-lookup"><span data-stu-id="0c1f2-109">ProcessInput</span></span>](#processinput)
-   [<span data-ttu-id="0c1f2-110">ProcessOutput</span><span class="sxs-lookup"><span data-stu-id="0c1f2-110">ProcessOutput</span></span>](#processoutput)
-   [<span data-ttu-id="0c1f2-111">Очистки</span><span class="sxs-lookup"><span data-stu-id="0c1f2-111">Draining</span></span>](#draining)
-   [<span data-ttu-id="0c1f2-112">Очистки</span><span class="sxs-lookup"><span data-stu-id="0c1f2-112">Flushing</span></span>](#flushing)
-   [<span data-ttu-id="0c1f2-113">Метки</span><span class="sxs-lookup"><span data-stu-id="0c1f2-113">Markers</span></span>](#markers)
-   [<span data-ttu-id="0c1f2-114">Изменения формата</span><span class="sxs-lookup"><span data-stu-id="0c1f2-114">Format Changes</span></span>](#format-changes)
-   [<span data-ttu-id="0c1f2-115">Атрибуты</span><span class="sxs-lookup"><span data-stu-id="0c1f2-115">Attributes</span></span>](#attributes)
-   [<span data-ttu-id="0c1f2-116">Разблокировка асинхронного МФТС</span><span class="sxs-lookup"><span data-stu-id="0c1f2-116">Unlocking Asynchronous MFTs</span></span>](#unlocking-asynchronous-mfts)
-   [<span data-ttu-id="0c1f2-117">Завершение работы MFT</span><span class="sxs-lookup"><span data-stu-id="0c1f2-117">Shutting Down the MFT</span></span>](#shutting-down-the-mft)
-   [<span data-ttu-id="0c1f2-118">Регистрация и перечисление</span><span class="sxs-lookup"><span data-stu-id="0c1f2-118">Registration and Enumeration</span></span>](#registration-and-enumeration)
-   [<span data-ttu-id="0c1f2-119">См. также</span><span class="sxs-lookup"><span data-stu-id="0c1f2-119">Related topics</span></span>](#related-topics)

## <a name="about-asynchronous-mfts"></a><span data-ttu-id="0c1f2-120">Об асинхронном МФТС</span><span class="sxs-lookup"><span data-stu-id="0c1f2-120">About Asynchronous MFTs</span></span>

<span data-ttu-id="0c1f2-121">Когда в Windows Vista появились МФТС, API был разработан для *синхронной* обработки данных.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-121">When MFTs were introduced in Windows Vista, the API was designed for *synchronous* data processing.</span></span> <span data-ttu-id="0c1f2-122">В этой модели MFT всегда ожидает получения входных данных или ожидания получения выходных данных.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-122">In that model, the MFT is always either waiting to get input, or waiting to produce output.</span></span>

<span data-ttu-id="0c1f2-123">Рассмотрим типичный видеодекодер.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-123">Consider a typical video decoder.</span></span> <span data-ttu-id="0c1f2-124">Чтобы получить декодированный кадр, клиент вызывает [**имфтрансформ::P роцессаутпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="0c1f2-124">To get a decoded frame, the client calls [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="0c1f2-125">Если у декодера достаточно данных для декодирования кадра, **ProcessOutput** блокируется, пока MFT декодирует кадр.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-125">If the decoder has enough data to decode a frame, **ProcessOutput** blocks while the MFT decodes the frame.</span></span> <span data-ttu-id="0c1f2-126">В противном случае **ProcessOutput** возвращает **MF_E_TRANSFORM_NEED_MORE_INPUT**, что означает, что клиент должен вызвать [**имфтрансформ::P роцессинпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="0c1f2-126">Otherwise, **ProcessOutput** returns **MF_E_TRANSFORM_NEED_MORE_INPUT**, indicating that the client should call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span>

<span data-ttu-id="0c1f2-127">Эта модель хорошо работает, если декодер выполняет все операции декодирования в одном потоке.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-127">This model works well if the decoder performs all of its decoding operations on one thread.</span></span> <span data-ttu-id="0c1f2-128">Но предположим, что декодер использует несколько потоков для параллельного декодирования кадров.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-128">But suppose the decoder uses several threads to decode frames in parallel.</span></span> <span data-ttu-id="0c1f2-129">Для лучшей производительности декодер должен получить новые входные данные всякий раз, когда поток декодирования переходит в состояние бездействия.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-129">For the best performance, the decoder should receive new input whenever a decoding thread becomes idle.</span></span> <span data-ttu-id="0c1f2-130">Но скорость, с которой потоки завершают операции декодирования, не будет точно согласована с вызовами клиента [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) и [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput), что приведет к потокам, ожидающим работы.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-130">But the rate at which threads complete decoding operations will not align exactly with the client's calls to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput), resulting in threads waiting for work.</span></span>

<span data-ttu-id="0c1f2-131">В Windows 7 реализована *асинхронная* обработка на основе событий для МФТС.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-131">Windows 7 introduces event-driven, *asynchronous* processing for MFTs.</span></span> <span data-ttu-id="0c1f2-132">В этой модели каждый раз, когда таблица MFT требует ввода или вывода данных, она отправляет клиенту событие.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-132">In this model, whenever the MFT needs input or has output, it sends an event to the client.</span></span>

## <a name="general-requirements"></a><span data-ttu-id="0c1f2-133">Общие требования</span><span class="sxs-lookup"><span data-stu-id="0c1f2-133">General Requirements</span></span>

<span data-ttu-id="0c1f2-134">В этом разделе описывается, как асинхронные МФТС отличаются от синхронных файлов MFT.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-134">This topic describes how asynchronous MFTs differ from synchronous MFT.</span></span> <span data-ttu-id="0c1f2-135">За исключением случаев, оговоренных в этом разделе, две модели обработки одинаковы.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-135">Except where noted in this topic, the two processing models are the same.</span></span> <span data-ttu-id="0c1f2-136">(В частности, согласование формата одинаково.)</span><span class="sxs-lookup"><span data-stu-id="0c1f2-136">(In particular, format negotiation is the same.)</span></span>

<span data-ttu-id="0c1f2-137">Асинхронная Таблица MFT должна реализовывать следующие интерфейсы:</span><span class="sxs-lookup"><span data-stu-id="0c1f2-137">An asynchronous MFT must implement the following interfaces:</span></span>

-   [<span data-ttu-id="0c1f2-138">**имфтрансформ**</span><span class="sxs-lookup"><span data-stu-id="0c1f2-138">**IMFTransform**</span></span>](/windows/desktop/api/mftransform/nn-mftransform-imftransform)
-   [<span data-ttu-id="0c1f2-139">**имфмедиаевентженератор**</span><span class="sxs-lookup"><span data-stu-id="0c1f2-139">**IMFMediaEventGenerator**</span></span>](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator)
-   [<span data-ttu-id="0c1f2-140">**имфшутдовн**</span><span class="sxs-lookup"><span data-stu-id="0c1f2-140">**IMFShutdown**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown)

## <a name="events"></a><span data-ttu-id="0c1f2-141">События</span><span class="sxs-lookup"><span data-stu-id="0c1f2-141">Events</span></span>

<span data-ttu-id="0c1f2-142">Асинхронная MFT использует следующие события для сигнализации состояния обработки данных:</span><span class="sxs-lookup"><span data-stu-id="0c1f2-142">An asynchronous MFT uses the following events to signal its data-processing status:</span></span>



| <span data-ttu-id="0c1f2-143">Событие</span><span class="sxs-lookup"><span data-stu-id="0c1f2-143">Event</span></span>                                                    | <span data-ttu-id="0c1f2-144">Описание</span><span class="sxs-lookup"><span data-stu-id="0c1f2-144">Description</span></span>                                                       |
|----------------------------------------------------------|-------------------------------------------------------------------|
| [<span data-ttu-id="0c1f2-145">метрансформнидинпут</span><span class="sxs-lookup"><span data-stu-id="0c1f2-145">METransformNeedInput</span></span>](metransformneedinput.md)         | <span data-ttu-id="0c1f2-146">Посылается, когда MFT может принимать больше входных данных.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-146">Sent when the MFT can accept more input.</span></span>                          |
| [<span data-ttu-id="0c1f2-147">метрансформхавеаутпут</span><span class="sxs-lookup"><span data-stu-id="0c1f2-147">METransformHaveOutput</span></span>](metransformhaveoutput.md)       | <span data-ttu-id="0c1f2-148">Посылается, когда файл MFT содержит выходные данные.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-148">Sent when the MFT has output.</span></span>                                     |
| [<span data-ttu-id="0c1f2-149">метрансформдраинкомплете</span><span class="sxs-lookup"><span data-stu-id="0c1f2-149">METransformDrainComplete</span></span>](metransformdraincomplete.md) | <span data-ttu-id="0c1f2-150">Посылается после завершения операции очистки.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-150">Sent when a drain operation completes.</span></span> <span data-ttu-id="0c1f2-151">См. раздел [сток](#draining).</span><span class="sxs-lookup"><span data-stu-id="0c1f2-151">See [Draining](#draining).</span></span> |
| [<span data-ttu-id="0c1f2-152">метрансформмаркер</span><span class="sxs-lookup"><span data-stu-id="0c1f2-152">METransformMarker</span></span>](metransformmarker.md)               | <span data-ttu-id="0c1f2-153">Посылается, когда маркер обрабатывается.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-153">Sent when a marker is process.</span></span> <span data-ttu-id="0c1f2-154">См. раздел [маркеры](#markers).</span><span class="sxs-lookup"><span data-stu-id="0c1f2-154">See [Markers](#markers).</span></span>           |



 

<span data-ttu-id="0c1f2-155">Эти события отправляются по внешнему каналу.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-155">These events are sent out-of-band.</span></span> <span data-ttu-id="0c1f2-156">Важно понимать разницу между внешними и внешними событиями в контексте MFT.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-156">It is important to understand the difference between in-band and out-of-band events in the context of an MFT.</span></span>

<span data-ttu-id="0c1f2-157">Исходная структура MFT поддерживает события *с чередованием* .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-157">The original MFT design supports *in-band* events.</span></span> <span data-ttu-id="0c1f2-158">Событие с чередованием содержит сведения о потоке данных, например сведения об изменении формата.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-158">An in-band event contains information about the data stream, such as information about a format change.</span></span> <span data-ttu-id="0c1f2-159">Клиент отправляет события в основном файле MFT, вызывая [**имфтрансформ::P роцессевент**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span><span class="sxs-lookup"><span data-stu-id="0c1f2-159">The client sends in-band events to the MFT by calling [**IMFTransform::ProcessEvent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span></span> <span data-ttu-id="0c1f2-160">Таблица MFT может отправить события с внутренним каналом обратно клиенту в методе [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-160">The MFT can send in-band events back to the client in the [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method.</span></span> <span data-ttu-id="0c1f2-161">(В частности, события передаются в элемент **певентс** структуры [**MFT_OUTPUT_DATA_BUFFER**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_data_buffer) .)</span><span class="sxs-lookup"><span data-stu-id="0c1f2-161">(Specifically, events are conveyed in the **pEvents** member of the [**MFT_OUTPUT_DATA_BUFFER**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_data_buffer) structure.)</span></span>

<span data-ttu-id="0c1f2-162">MFT отправляет события внешнего вида через интерфейс [**имфмедиаевентженератор**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) следующим образом:</span><span class="sxs-lookup"><span data-stu-id="0c1f2-162">An MFT sends out-of-band events through the [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) interface as follows:</span></span>

1.  <span data-ttu-id="0c1f2-163">MFT реализует интерфейс [**имфмедиаевентженератор**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) , как описано в статье [генераторы событий мультимедиа](media-event-generators.md).</span><span class="sxs-lookup"><span data-stu-id="0c1f2-163">The MFT implements the [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) interface, as described in [Media Event Generators](media-event-generators.md).</span></span>
2.  <span data-ttu-id="0c1f2-164">Клиент вызывает **IUnknown:: QueryInterface** в MFT для интерфейса [**имфмедиаевентженератор**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-164">The client calls **IUnknown::QueryInterface** on the MFT for the [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) interface.</span></span> <span data-ttu-id="0c1f2-165">Асинхронный MFT должен предоставлять этот интерфейс.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-165">An asynchronous MFT must expose this interface.</span></span> <span data-ttu-id="0c1f2-166">Синхронный МФТС не должен предоставлять этот интерфейс.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-166">Synchronous MFTs should not expose this interface.</span></span>
3.  <span data-ttu-id="0c1f2-167">Клиент вызывает [**имфмедиаевентженератор:: бегинжетевент**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-begingetevent) и [**Имфмедиаевентженератор:: енджетевент**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-endgetevent) для получения событий, находящихся вне диапазона, из MFT.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-167">The client calls [**IMFMediaEventGenerator::BeginGetEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-begingetevent) and [**IMFMediaEventGenerator::EndGetEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-endgetevent) to receive out-of-band events from the MFT.</span></span>

## <a name="processinput"></a><span data-ttu-id="0c1f2-168">ProcessInput</span><span class="sxs-lookup"><span data-stu-id="0c1f2-168">ProcessInput</span></span>

<span data-ttu-id="0c1f2-169">Метод [**имфтрансформ::P роцессинпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) изменяется следующим образом:</span><span class="sxs-lookup"><span data-stu-id="0c1f2-169">The [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) method is modified as follows:</span></span>

1.  <span data-ttu-id="0c1f2-170">При запуске потоковой передачи клиент отправляет сообщение [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-170">When streaming starts, the client sends the [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) message.</span></span>
2.  <span data-ttu-id="0c1f2-171">Во время потоковой передачи MFT запрашивает данные, отправляя событие [метрансформнидинпут](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-171">During streaming, the MFT requests data by sending an [METransformNeedInput](metransformneedinput.md) event.</span></span> <span data-ttu-id="0c1f2-172">Данные события являются идентификатором потока.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-172">The event data is the stream identifier.</span></span>
3.  <span data-ttu-id="0c1f2-173">Для каждого события [метрансформнидинпут](metransformneedinput.md) клиент вызывает метод [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) для указанного потока.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-173">For each [METransformNeedInput](metransformneedinput.md) event, the client calls [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) for the specified stream.</span></span>
4.  <span data-ttu-id="0c1f2-174">По завершении потоковой передачи клиент может вызвать [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) с сообщением [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-174">At the end of streaming, the client may call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) message.</span></span>

<span data-ttu-id="0c1f2-175">Примечания по реализации:</span><span class="sxs-lookup"><span data-stu-id="0c1f2-175">Implementation notes:</span></span>

-   <span data-ttu-id="0c1f2-176">Таблица MFT не должна отсылать никаких событий [метрансформнидинпут](metransformneedinput.md) , пока не получит сообщение [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-176">The MFT must not send any [METransformNeedInput](metransformneedinput.md) events until it receives the [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) message.</span></span>
-   <span data-ttu-id="0c1f2-177">Во время потоковой передачи MFT может отправить события [метрансформнидинпут](metransformneedinput.md) в любое время.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-177">During streaming, the MFT may send [METransformNeedInput](metransformneedinput.md) events at any time.</span></span>
-   <span data-ttu-id="0c1f2-178">MFT должно поддерживать количество ожидающих событий [метрансформнидинпут](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-178">The MFT should maintain a count of pending [METransformNeedInput](metransformneedinput.md) events.</span></span> <span data-ttu-id="0c1f2-179">Любой вызов метода [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) , который не соответствует событию метрансформнидинпут, должен возвращать **MF_E_NOTACCEPTING**.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-179">Any call to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) that does not correspond to an METransformNeedInput event must return **MF_E_NOTACCEPTING**.</span></span>
-   <span data-ttu-id="0c1f2-180">Когда MFT получает сообщение [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) , оно сбрасывает число ожидающих событий [метрансформнидинпут](metransformneedinput.md) в ноль.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-180">When the MFT receives the [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) message, it resets the count of pending [METransformNeedInput](metransformneedinput.md) events to zero.</span></span>
-   <span data-ttu-id="0c1f2-181">Таблица MFT не должна отсылать никаких событий [метрансформнидинпут](metransformneedinput.md) после получения сообщения [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-181">The MFT must not send any [METransformNeedInput](metransformneedinput.md) events after it receives the [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) message.</span></span>
-   <span data-ttu-id="0c1f2-182">Если метод [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) вызывается до [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) или после [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md), он должен возвращать **MF_E_NOTACCEPTING**.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-182">If [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) is called before [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) or after [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md), the method must return **MF_E_NOTACCEPTING**.</span></span>

## <a name="processoutput"></a><span data-ttu-id="0c1f2-183">ProcessOutput</span><span class="sxs-lookup"><span data-stu-id="0c1f2-183">ProcessOutput</span></span>

<span data-ttu-id="0c1f2-184">Метод [**имфтрансформ::P роцессаутпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) изменяется следующим образом:</span><span class="sxs-lookup"><span data-stu-id="0c1f2-184">The [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method is modified as follows:</span></span>

1.  <span data-ttu-id="0c1f2-185">Каждый раз, когда файл MFT имеет выходные данные, он отправляет событие [метрансформхавеаутпут](metransformhaveoutput.md) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-185">Whenever the MFT has output, it sends an [METransformHaveOutput](metransformhaveoutput.md) event.</span></span>
2.  <span data-ttu-id="0c1f2-186">Для каждого события [метрансформхавеаутпут](metransformhaveoutput.md) клиент вызывает [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="0c1f2-186">For each [METransformHaveOutput](metransformhaveoutput.md) event, the client calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

<span data-ttu-id="0c1f2-187">Примечания по реализации:</span><span class="sxs-lookup"><span data-stu-id="0c1f2-187">Implementation notes:</span></span>

-   <span data-ttu-id="0c1f2-188">Если клиент вызывает [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) в любое другое время, метод возвращает **E_UNEXPECTED**.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-188">If the client calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) at any other time, the method returns **E_UNEXPECTED**.</span></span>
-   <span data-ttu-id="0c1f2-189">Асинхронная Таблица MFT не должна возвращать **MF_E_TRANSFORM_NEED_MORE_INPUT** из метода [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-189">An asynchronous MFT should never return **MF_E_TRANSFORM_NEED_MORE_INPUT** from the [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method.</span></span> <span data-ttu-id="0c1f2-190">Если таблица MFT требует больше входных данных, она отправляет событие [метрансформнидинпут](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-190">If the MFT requires more input, it sends an [METransformNeedInput](metransformneedinput.md) event.</span></span>

## <a name="draining"></a><span data-ttu-id="0c1f2-191">Очистки</span><span class="sxs-lookup"><span data-stu-id="0c1f2-191">Draining</span></span>

<span data-ttu-id="0c1f2-192">Очистка MFT приводит к тому, что MFT создает как можно больше выходных данных, так как это может быть уже отправленные входные данные.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-192">Draining an MFT causes the MFT to produce as much output as it can from whatever input data has already been sent.</span></span> <span data-ttu-id="0c1f2-193">Сток асинхронной MFT работает следующим образом:</span><span class="sxs-lookup"><span data-stu-id="0c1f2-193">Draining an asynchronous MFT works as follows:</span></span>

1.  <span data-ttu-id="0c1f2-194">Клиент отправляет сообщение [**MFT_MESSAGE_COMMAND_DRAIN**](mft-message-command-drain.md) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-194">The client sends the [**MFT_MESSAGE_COMMAND_DRAIN**](mft-message-command-drain.md) message.</span></span>
2.  <span data-ttu-id="0c1f2-195">Таблица MFT продолжит отсылать события [метрансформхавеаутпут](metransformhaveoutput.md) , пока не будет больше данных для обработки.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-195">The MFT continues to send [METransformHaveOutput](metransformhaveoutput.md) events until it has no more data to process.</span></span> <span data-ttu-id="0c1f2-196">В течение этого времени события [метрансформнидинпут](metransformneedinput.md) не отправляются.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-196">It does not send [METransformNeedInput](metransformneedinput.md) events during this time.</span></span>
3.  <span data-ttu-id="0c1f2-197">После того как MFT отправляет Последнее событие [метрансформхавеаутпут](metransformhaveoutput.md) , оно отправляет событие [метрансформдраинкомплете](metransformdraincomplete.md) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-197">After the MFT sends the last [METransformHaveOutput](metransformhaveoutput.md) event, it sends an [METransformDrainComplete](metransformdraincomplete.md) event.</span></span>

<span data-ttu-id="0c1f2-198">После завершения очистки Таблица MFT не отправляет другое событие [метрансформнидинпут](metransformneedinput.md) , пока не получит сообщение [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) от клиента.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-198">After draining is complete, the MFT does not send another [METransformNeedInput](metransformneedinput.md) event until it receives an [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) message from the client.</span></span>

## <a name="flushing"></a><span data-ttu-id="0c1f2-199">Очистки</span><span class="sxs-lookup"><span data-stu-id="0c1f2-199">Flushing</span></span>

<span data-ttu-id="0c1f2-200">Клиент может очистить MFT, отправив сообщение [**MFT_MESSAGE_COMMAND_FLUSH**](mft-message-command-flush.md) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-200">The client can flush the MFT by sending the [**MFT_MESSAGE_COMMAND_FLUSH**](mft-message-command-flush.md) message.</span></span> <span data-ttu-id="0c1f2-201">MFT удаляет все входные и выходные примеры, которые он удерживает.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-201">The MFT drops all of the input and output samples it is holding.</span></span>

<span data-ttu-id="0c1f2-202">Таблица MFT не отправляет другое событие [метрансформнидинпут](metransformneedinput.md) , пока не получит сообщение [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) от клиента.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-202">The MFT does not send another [METransformNeedInput](metransformneedinput.md) event until it receives an [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) message from the client.</span></span>

## <a name="markers"></a><span data-ttu-id="0c1f2-203">Метки</span><span class="sxs-lookup"><span data-stu-id="0c1f2-203">Markers</span></span>

<span data-ttu-id="0c1f2-204">Клиент может пометить точку в потоке, отправив сообщение [**MFT_MESSAGE_COMMAND_MARKER**](mft-message-command-marker.md) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-204">The client can mark a point in the stream by sending the [**MFT_MESSAGE_COMMAND_MARKER**](mft-message-command-marker.md) message.</span></span> <span data-ttu-id="0c1f2-205">Основная таблица MFT реагирует следующим образом:</span><span class="sxs-lookup"><span data-stu-id="0c1f2-205">The MFT responds as follows:</span></span>

1.  <span data-ttu-id="0c1f2-206">MFT создает столько выходных образцов, сколько можно из существующих входных данных, отправляя событие [метрансформхавеаутпут](metransformhaveoutput.md) для каждого выходного примера.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-206">The MFT generates as many output samples as it can from the existing input data, sending an [METransformHaveOutput](metransformhaveoutput.md) event for each output sample.</span></span>
2.  <span data-ttu-id="0c1f2-207">После создания всех выходных данных MFT отправляет событие [метрансформмаркер](metransformmarker.md) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-207">After all of the output is generated, the MFT sends an [METransformMarker](metransformmarker.md) event.</span></span> <span data-ttu-id="0c1f2-208">Это событие должно быть отправлено после всех событий [метрансформхавеаутпут](metransformhaveoutput.md) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-208">This event must be sent after all of the [METransformHaveOutput](metransformhaveoutput.md) events.</span></span>

<span data-ttu-id="0c1f2-209">Например, предположим, что у декодера достаточно входных данных для создания четырех выходных образцов.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-209">For example, suppose that a decoder has enough input data to produce four output samples.</span></span> <span data-ttu-id="0c1f2-210">Если клиент отправляет [**MFT_MESSAGE_COMMAND_MARKER**](mft-message-command-marker.md) сообщение, файл MFT будет ставить в очередь четыре [метрансформхавеаутпут](metransformhaveoutput.md) события (по одному на каждый пример вывода), за которыми следует событие [метрансформмаркер](metransformmarker.md) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-210">If the client sends the [**MFT_MESSAGE_COMMAND_MARKER**](mft-message-command-marker.md) message, the MFT will queue four [METransformHaveOutput](metransformhaveoutput.md) events (one per output sample), followed by an [METransformMarker](metransformmarker.md) event.</span></span>

<span data-ttu-id="0c1f2-211">Сообщение маркера похоже на сообщение стока.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-211">The marker message is similar to the drain message.</span></span> <span data-ttu-id="0c1f2-212">Однако сток считается перерывом в потоке, а маркер — нет.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-212">However, a drain is considered a break in the stream, whereas a marker is not.</span></span> <span data-ttu-id="0c1f2-213">Сток и маркеры имеют следующие отличия.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-213">Draining and markers have the following differences.</span></span>

<span data-ttu-id="0c1f2-214">Очистки</span><span class="sxs-lookup"><span data-stu-id="0c1f2-214">Draining:</span></span>

-   <span data-ttu-id="0c1f2-215">При стоке MFT не отправляет события [метрансформнидинпут](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-215">While draining, the MFT does not send [METransformNeedInput](metransformneedinput.md) events.</span></span>
-   <span data-ttu-id="0c1f2-216">MFT удаляет все входные данные, которые не могут быть использованы для создания образца выходных данных.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-216">The MFT discards any input data that cannot be used to create an output sample.</span></span>
-   <span data-ttu-id="0c1f2-217">Некоторые МФТС создают "хвост" в конце данных.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-217">Some MFTs produce a "tail" at the end of the data.</span></span> <span data-ttu-id="0c1f2-218">Например, звуковые эффекты, такие как переглаголы или эхо, создают дополнительные данные после остановки входных данных.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-218">For example, audio effects such as reverb or echo produce extra data after the input data has stopped.</span></span> <span data-ttu-id="0c1f2-219">Таблица MFT, которая создает хвост, должна сделать это в конце операции очистки.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-219">An MFT that generates a tail should do so at the end of a drain operation.</span></span>
-   <span data-ttu-id="0c1f2-220">После завершения очистки MFT помечает следующий выходной пример атрибутом [**MFSampleExtension_Discontinuity**](mfsampleextension-discontinuity-attribute.md) , чтобы указать на ненепрерывность потока.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-220">After the MFT has finished draining, it marks the next output sample with the [**MFSampleExtension_Discontinuity**](mfsampleextension-discontinuity-attribute.md) attribute, to indicate a discontinuity in the stream.</span></span>

<span data-ttu-id="0c1f2-221">Фломастер</span><span class="sxs-lookup"><span data-stu-id="0c1f2-221">Marker:</span></span>

-   <span data-ttu-id="0c1f2-222">Таблица MFT продолжит отправлять события [метрансформнидинпут](metransformneedinput.md) перед отправкой события маркера.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-222">The MFT continues to send [METransformNeedInput](metransformneedinput.md) events before sending the marker event.</span></span>
-   <span data-ttu-id="0c1f2-223">Таблица MFT не удаляет входные данные.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-223">The MFT does not discard any input data.</span></span> <span data-ttu-id="0c1f2-224">Если имеются частичные данные, они должны обрабатываться после точки маркера.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-224">If there is partial data, it should be processed after the marker point.</span></span>
-   <span data-ttu-id="0c1f2-225">MFT не создает хвост в точке маркера.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-225">The MFT does not produce a tail at the marker point.</span></span>
-   <span data-ttu-id="0c1f2-226">Таблица MFT не устанавливает флаг небесперебойности после точки маркера.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-226">The MFT does not set the discontinuity flag after the marker point.</span></span>

## <a name="format-changes"></a><span data-ttu-id="0c1f2-227">Изменения формата</span><span class="sxs-lookup"><span data-stu-id="0c1f2-227">Format Changes</span></span>

<span data-ttu-id="0c1f2-228">Асинхронная Таблица MFT должна поддерживать динамические изменения формата, как описано в разделе [Обработка изменений потока](handling-stream-changes.md).</span><span class="sxs-lookup"><span data-stu-id="0c1f2-228">An asynchronous MFT must support dynamic format changes, as described in [Handling Stream Changes](handling-stream-changes.md).</span></span>

## <a name="attributes"></a><span data-ttu-id="0c1f2-229">Атрибуты</span><span class="sxs-lookup"><span data-stu-id="0c1f2-229">Attributes</span></span>

<span data-ttu-id="0c1f2-230">Асинхронная Таблица MFT должна реализовывать метод [**имфтрансформ:: InAttribute**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) , возвращающий допустимое хранилище атрибутов.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-230">An asynchronous MFT must implement the [**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) method to return a valid attribute store.</span></span> <span data-ttu-id="0c1f2-231">К асинхронному МФТС применяются следующие атрибуты:</span><span class="sxs-lookup"><span data-stu-id="0c1f2-231">The following attributes apply to asynchronous MFTs:</span></span>



| <span data-ttu-id="0c1f2-232">attribute</span><span class="sxs-lookup"><span data-stu-id="0c1f2-232">Attribute</span></span>                                                                                    | <span data-ttu-id="0c1f2-233">Описание</span><span class="sxs-lookup"><span data-stu-id="0c1f2-233">Description</span></span>                                                                                                                       |
|----------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="0c1f2-234">MF_TRANSFORM_ASYNC</span><span class="sxs-lookup"><span data-stu-id="0c1f2-234">MF_TRANSFORM_ASYNC</span></span>](mf-transform-async.md)                                               | <span data-ttu-id="0c1f2-235">MFT должен присвоить этому атрибуту **значение true** (1).</span><span class="sxs-lookup"><span data-stu-id="0c1f2-235">The MFT must set this attribute to **TRUE** (1).</span></span> <span data-ttu-id="0c1f2-236">Клиент может запросить этот атрибут, чтобы определить, является ли MFT асинхронным.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-236">The client can query this attribute to discover whether the MFT is asynchronous.</span></span> |
| [<span data-ttu-id="0c1f2-237">MF_TRANSFORM_ASYNC_UNLOCK</span><span class="sxs-lookup"><span data-stu-id="0c1f2-237">MF_TRANSFORM_ASYNC_UNLOCK</span></span>](mf-transform-async-unlock.md)                                |                                                                                                                                   |
| [<span data-ttu-id="0c1f2-238">**MFT_SUPPORT_DYNAMIC_FORMAT_CHANGE**</span><span class="sxs-lookup"><span data-stu-id="0c1f2-238">**MFT_SUPPORT_DYNAMIC_FORMAT_CHANGE**</span></span>](mft-support-dynamic-format-change-attribute.md) | <span data-ttu-id="0c1f2-239">MFT должен присвоить этому атрибуту **значение true** (1).</span><span class="sxs-lookup"><span data-stu-id="0c1f2-239">The MFT must set this attribute to **TRUE** (1).</span></span> <span data-ttu-id="0c1f2-240">Клиент может предположить, что этот атрибут задан.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-240">The client can assume that this attribute is set.</span></span>                                |



 

## <a name="unlocking-asynchronous-mfts"></a><span data-ttu-id="0c1f2-241">Разблокировка асинхронного МФТС</span><span class="sxs-lookup"><span data-stu-id="0c1f2-241">Unlocking Asynchronous MFTs</span></span>

<span data-ttu-id="0c1f2-242">Асинхронные МФТС несовместимы с исходной моделью обработки данных MFT.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-242">Asynchronous MFTs are not compatible with the original MFT data processing model.</span></span> <span data-ttu-id="0c1f2-243">Чтобы избежать нарушения работы асинхронных МФТС, определяется следующий механизм:</span><span class="sxs-lookup"><span data-stu-id="0c1f2-243">To prevent asynchronous MFTs from breaking existing applications, the following mechanism is defined:</span></span>

<dl> <span data-ttu-id="0c1f2-244">Клиент вызывает <a href="/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes">имфтрансформ:: OutAttribute</a> для MFT.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-244">The client calls <a href="/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes">IMFTransform::GetAttributes</a> on the MFT.</span></span>  
<span data-ttu-id="0c1f2-245">Клиент запрашивает для этого атрибута <a href="mf-transform-async.md">MF_TRANSFORM_ASYNC</a> .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-245">The client queries the for this <a href="mf-transform-async.md">MF_TRANSFORM_ASYNC</a> attribute.</span></span> <span data-ttu-id="0c1f2-246">Для асинхронной MFT значение этого атрибута равно **true**.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-246">For an asynchronous MFT, the value of this attribute is **TRUE**.</span></span>  
<span data-ttu-id="0c1f2-247">Чтобы разблокировать MFT, клиент должен присвоить атрибуту <a href="mf-transform-async-unlock.md">MF_TRANSFORM_ASYNC_UNLOCK</a> **значение true**.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-247">To unlock the MFT, the client must sets the <a href="mf-transform-async-unlock.md">MF_TRANSFORM_ASYNC_UNLOCK</a> attribute to **TRUE**.</span></span>  
</dl>

<span data-ttu-id="0c1f2-248">Пока клиент не разблокирует MFT, все методы [**имфтрансформ**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) должны возвращать **MF_E_TRANSFORM_ASYNC_LOCKED**, за исключением следующих:</span><span class="sxs-lookup"><span data-stu-id="0c1f2-248">Until the client unlocks the MFT, all [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) methods should return **MF_E_TRANSFORM_ASYNC_LOCKED**, with the following exceptions:</span></span>

-   <span data-ttu-id="0c1f2-249">[**Имфтрансформ:: OutAttribute**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) (все асинхронные МФТС)</span><span class="sxs-lookup"><span data-stu-id="0c1f2-249">[**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) (all asynchronous MFTs)</span></span>
-   <span data-ttu-id="0c1f2-250">[**Имфтрансформ:: жетинпутаваилаблетипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) (все асинхронные МФТС)</span><span class="sxs-lookup"><span data-stu-id="0c1f2-250">[**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) (all asynchronous MFTs)</span></span>
-   <span data-ttu-id="0c1f2-251">[**Имфтрансформ:: жетаутпуткурренттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputcurrenttype) (только кодировщики)</span><span class="sxs-lookup"><span data-stu-id="0c1f2-251">[**IMFTransform::GetOutputCurrentType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputcurrenttype) (encoders only)</span></span>
-   <span data-ttu-id="0c1f2-252">[**Имфтрансформ:: сетаутпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) (только кодировщики)</span><span class="sxs-lookup"><span data-stu-id="0c1f2-252">[**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) (encoders only)</span></span>
-   <span data-ttu-id="0c1f2-253">[**Имфтрансформ:: жетстреамкаунт**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) (все асинхронные МФТС)</span><span class="sxs-lookup"><span data-stu-id="0c1f2-253">[**IMFTransform::GetStreamCount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) (all asynchronous MFTs)</span></span>
-   <span data-ttu-id="0c1f2-254">[**Имфтрансформ:: жетстреамидс**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) (все асинхронные МФТС)</span><span class="sxs-lookup"><span data-stu-id="0c1f2-254">[**IMFTransform::GetStreamIDs**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) (all asynchronous MFTs)</span></span>

<span data-ttu-id="0c1f2-255">В следующем коде показано, как разблокировать асинхронную таблицу MFT:</span><span class="sxs-lookup"><span data-stu-id="0c1f2-255">The following code shows how to unlock an asynchronous MFT:</span></span>


```C++
HRESULT UnlockAsyncMFT(IMFTransform *pMFT)
{
    IMFAttributes *pAttributes = NULL;

    HRESULT hr = hr = pMFT->GetAttributes(&pAttributes);

    if (SUCCEEDED(hr))
    {
        hr = pAttributes->SetUINT32(MF_TRANSFORM_ASYNC_UNLOCK, TRUE);
        pAttributes->Release();
    }
    
    return hr;
}
```



## <a name="shutting-down-the-mft"></a><span data-ttu-id="0c1f2-256">Завершение работы MFT</span><span class="sxs-lookup"><span data-stu-id="0c1f2-256">Shutting Down the MFT</span></span>

<span data-ttu-id="0c1f2-257">Асинхронный МФТС должен реализовывать интерфейс [**имфшутдовн**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-257">Asynchronous MFTs must implement the [**IMFShutdown**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) interface.</span></span>

-   <span data-ttu-id="0c1f2-258">[**Завершение работы**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown). Таблица MFT должна завершить свою очередь событий.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-258">[**Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown): The MFT must shut down its event queue.</span></span> <span data-ttu-id="0c1f2-259">При использовании стандартной очереди событий вызовите [**имфмедиаевенткуеуе:: Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown).</span><span class="sxs-lookup"><span data-stu-id="0c1f2-259">If using the standard event queue, call [**IMFMediaEventQueue::Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown).</span></span> <span data-ttu-id="0c1f2-260">Кроме того, MFT может освободить другие ресурсы.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-260">Optionally, the MFT may release other resources.</span></span> <span data-ttu-id="0c1f2-261">Клиент не должен использовать MFT после вызова метода **Shutdown**.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-261">The client must not use the MFT after calling **Shutdown**.</span></span>
-   <span data-ttu-id="0c1f2-262">[**Жетшутдовнстатус**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-getshutdownstatus): после [**завершения работы**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown) вызывается Таблица MFT, которая должна возвращать значение **MFSHUTDOWN_COMPLETED** в параметре *пстатус* .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-262">[**GetShutdownStatus**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-getshutdownstatus): After [**Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown) has been called, the MFT should return the value **MFSHUTDOWN_COMPLETED** in the *pStatus* parameter.</span></span> <span data-ttu-id="0c1f2-263">Он не должен возвращать значение **MFSHUTDOWN_INITIATED**.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-263">It should not return the value **MFSHUTDOWN_INITIATED**.</span></span>

## <a name="registration-and-enumeration"></a><span data-ttu-id="0c1f2-264">Регистрация и перечисление</span><span class="sxs-lookup"><span data-stu-id="0c1f2-264">Registration and Enumeration</span></span>

<span data-ttu-id="0c1f2-265">Чтобы зарегистрировать асинхронную таблицу MFT, вызовите функцию [**мфтрегистер**](/windows/desktop/api/mfapi/nf-mfapi-mftregister) и установите флаг **MFT_ENUM_FLAG_ASYNCMFT** в параметре *flags* .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-265">To register an asynchronous MFT, call the [**MFTRegister**](/windows/desktop/api/mfapi/nf-mfapi-mftregister) function and set the **MFT_ENUM_FLAG_ASYNCMFT** flag in the *Flags* parameter.</span></span> <span data-ttu-id="0c1f2-266">(Ранее этот флаг зарезервирован.)</span><span class="sxs-lookup"><span data-stu-id="0c1f2-266">(Previously this flag was reserved.)</span></span>

<span data-ttu-id="0c1f2-267">Чтобы перечислить асинхронные МФТС, вызовите функцию [**мфтенумекс**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) и установите флаг **MFT_ENUM_FLAG_ASYNCMFT** в параметре *flags* .</span><span class="sxs-lookup"><span data-stu-id="0c1f2-267">To enumerate asynchronous MFTs, call the [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) function and set the **MFT_ENUM_FLAG_ASYNCMFT** flag in the *Flags* parameter.</span></span> <span data-ttu-id="0c1f2-268">Для обратной совместимости функция [**мфтенум**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) не перечисляет асинхронные МФТС.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-268">For backward compatibility, the [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) function does not enumerate asynchronous MFTs.</span></span> <span data-ttu-id="0c1f2-269">В противном случае установка асинхронной таблицы MFT на компьютере пользователя может нарушить работу существующих приложений.</span><span class="sxs-lookup"><span data-stu-id="0c1f2-269">Otherwise, installing an asynchronous MFT on the user's computer could break existing applications.</span></span>

## <a name="related-topics"></a><span data-ttu-id="0c1f2-270">См. также</span><span class="sxs-lookup"><span data-stu-id="0c1f2-270">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="0c1f2-271">Преобразования Media Foundation</span><span class="sxs-lookup"><span data-stu-id="0c1f2-271">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 



