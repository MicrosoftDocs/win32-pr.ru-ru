---
description: Для преобразования файлов мультимедиа в формат ASF можно использовать кодировщики Windows Media. Чтобы использовать эти кодировщики, они должны быть зарегистрированы в системе.
ms.assetid: 18c26619-6047-4f7f-bb65-ca418f02e5b1
title: Использование объектов активации кодировщиков
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bfd44a1b97ad0f133b7215ff4474835ddfba66bb
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103898702"
---
# <a name="using-an-encoders-activation-objects"></a><span data-ttu-id="990ce-104">Использование объектов активации кодировщика</span><span class="sxs-lookup"><span data-stu-id="990ce-104">Using an Encoder's Activation Objects</span></span>

<span data-ttu-id="990ce-105">Для преобразования файлов мультимедиа в формат ASF можно использовать кодировщики Windows Media.</span><span class="sxs-lookup"><span data-stu-id="990ce-105">For converting media files into ASF format, you can use Windows Media encoders.</span></span> <span data-ttu-id="990ce-106">Чтобы использовать эти кодировщики, они должны быть зарегистрированы в системе.</span><span class="sxs-lookup"><span data-stu-id="990ce-106">To use these encoders, they must be registered with the system.</span></span>

<span data-ttu-id="990ce-107">Дополнительные сведения о регистрации кодировщика см. [в разделе Создание экземпляра MFT кодировщика](instantiating-the-encoder-mft.md).</span><span class="sxs-lookup"><span data-stu-id="990ce-107">For information about encoder registration, see [Instantiating an Encoder MFT](instantiating-the-encoder-mft.md).</span></span>

-   [<span data-ttu-id="990ce-108">Использование объектов активации кодировщика</span><span class="sxs-lookup"><span data-stu-id="990ce-108">Using an Encoder's Activation Objects</span></span>](#using-an-encoders-activation-objects)
-   [<span data-ttu-id="990ce-109">Перечисление кодировщиков в Windows 7 и более поздних версиях</span><span class="sxs-lookup"><span data-stu-id="990ce-109">Encoder Enumeration in Windows 7 and Later</span></span>](#encoder-enumeration-in-windows-7-and-later)
-   [<span data-ttu-id="990ce-110">См. также</span><span class="sxs-lookup"><span data-stu-id="990ce-110">Related topics</span></span>](#related-topics)

## <a name="using-an-encoders-activation-objects"></a><span data-ttu-id="990ce-111">Использование объектов активации кодировщика</span><span class="sxs-lookup"><span data-stu-id="990ce-111">Using an Encoder's Activation Objects</span></span>

<span data-ttu-id="990ce-112">В качестве альтернативы использованию интерфейса [**имфтрансформ**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) кодировщика (описанного в разделе [Создание кодировщика с помощью CoCreateInstance](using-an-encoder-s-imftransform--interface.md)) можно создать экземпляр объекта активации для кодировщика.</span><span class="sxs-lookup"><span data-stu-id="990ce-112">As an alternative to using an encoder's [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) interface (described in [Creating an Encoder by Using CoCreateInstance](using-an-encoder-s-imftransform--interface.md)), you can create an instance of the activation object for the encoder.</span></span> <span data-ttu-id="990ce-113">Объекты активации упрощают создание кодировщика и Media Foundation предоставляют следующие две функции для этого подхода:</span><span class="sxs-lookup"><span data-stu-id="990ce-113">Activation objects facilitates encoder creation and Media Foundation provides the following two functions for this approach:</span></span>

-   <span data-ttu-id="990ce-114">[**Мфкреатевмаенкодерактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) для создания экземпляра кодировщика Windows Media Audio.</span><span class="sxs-lookup"><span data-stu-id="990ce-114">[**MFCreateWMAEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) for instantiating the Windows Media audio encoder.</span></span>
-   <span data-ttu-id="990ce-115">[**Мфкреатевмвенкодерактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate) для создания экземпляра кодировщика видео Windows Media.</span><span class="sxs-lookup"><span data-stu-id="990ce-115">[**MFCreateWMVEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate) for instantiating the Windows Media video encoder.</span></span>

<span data-ttu-id="990ce-116">Для обоих этих функций требуется создать целевой тип носителя и задать свойства кодировки перед вызовом этих функций.</span><span class="sxs-lookup"><span data-stu-id="990ce-116">Both these functions require that you create the target media type and set the encoding properties before calling these functions.</span></span> <span data-ttu-id="990ce-117">Если приложение использует [компоненты ASF уровня конвейера](pipeline-layer-asf-components.md) для кодирования файла в формат ASF и уже создали и настроили [приемники мультимедиа ASF](asf-media-sinks.md), вы можете получить этот набор сведений из приемника ASF Media.</span><span class="sxs-lookup"><span data-stu-id="990ce-117">If your application is using [Pipeline Layer ASF Components](pipeline-layer-asf-components.md) to encode a file to ASF format, and have already created and configured the [ASF Media Sinks](asf-media-sinks.md), you can get this set of information from the ASF media sink.</span></span>

<span data-ttu-id="990ce-118">[**Мфкреатевмаенкодерактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) и [**мфкреатевмвенкодерактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate) устанавливают тип выходных данных кодировщика в тип мультимедиа, заданный приложением.</span><span class="sxs-lookup"><span data-stu-id="990ce-118">[**MFCreateWMAEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) and [**MFCreateWMVEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate) set the output type of the encoder to the media type specified by the application.</span></span>

<span data-ttu-id="990ce-119">**Примечание**  .  Если вы используете [**мфкреатевмаенкодерактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) и [**мфкреатевмвенкодерактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate) , можно активировать кодировщик, вызвав [**имфактивате:: активатеобжект**](/windows/desktop/api/mfobjects/nf-mfobjects-imfactivate-activateobject) , но нельзя изменить входные и выходные типы выходных данных кодировщика, а также не изменять свойства кодировки.</span><span class="sxs-lookup"><span data-stu-id="990ce-119">**Note**  If you are using [**MFCreateWMAEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) and [**MFCreateWMVEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate) you can activate the encoder by calling [**IMFActivate::ActivateObject**](/windows/desktop/api/mfobjects/nf-mfobjects-imfactivate-activateobject) but you cannot change the input and the output media types of the encoder nor can you change any of the encoding properties.</span></span>

<span data-ttu-id="990ce-120">Дополнительные сведения о создании объектов Media Foundation с помощью объектов активации см. в разделе [объекты активации](activation-objects.md).</span><span class="sxs-lookup"><span data-stu-id="990ce-120">For more information about creating Media Foundation objects by using activation objects, see [Activation Objects](activation-objects.md).</span></span>

<span data-ttu-id="990ce-121">**Получение типа целевого носителя из приемника ASF Media**</span><span class="sxs-lookup"><span data-stu-id="990ce-121">**To get the target media type from the ASF media sink**</span></span>

1.  <span data-ttu-id="990ce-122">Получите указатель на указатель [**имфасфконтентинфо**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) приемника мультимедиа ASF, вызвав **Имфмедиасинк:: QueryInterface** в приемнике ASF Media и передав идентификатор **IID \_ имфасфконтентинфо** в качестве идентификатора интерфейса.</span><span class="sxs-lookup"><span data-stu-id="990ce-122">Get a pointer to the [**IMFASFContentInfo**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) pointer of the ASF media sink by calling **IMFMediaSink::QueryInterface** on the ASF media sink and passing **IID\_IMFASFContentInfo** as the interface identifier.</span></span>
2.  <span data-ttu-id="990ce-123">Получите объект профиля ASF, связанный с объектом Контентинфо.</span><span class="sxs-lookup"><span data-stu-id="990ce-123">Get the ASF profile object associated with the ContentInfo object.</span></span>
3.  <span data-ttu-id="990ce-124">Перечислите потоки в профиле, чтобы получить тип носителя потока.</span><span class="sxs-lookup"><span data-stu-id="990ce-124">Enumerate the streams in the profile to get the stream's media type.</span></span>

<span data-ttu-id="990ce-125">**Получение свойств кодировки из приемника мультимедиа ASF**</span><span class="sxs-lookup"><span data-stu-id="990ce-125">**To get the encoding properties from the ASF media sink**</span></span>

1.  <span data-ttu-id="990ce-126">Если вы настроили [Свойства кодировки](configuring-the-encoder.md) в приемнике мультимедиа (см. описание в разделе [Установка свойств в приемнике файлов](setting-properties-in-the-file-sink.md)), можно получить ссылку на хранилище свойств приемника, вызвав **имфмедиасинк:: QueryInterface** в приемнике ASF Media и передав **IID \_ ипропертисторе** в качестве идентификатора интерфейса.</span><span class="sxs-lookup"><span data-stu-id="990ce-126">If you have configured the [Encoding Properties](configuring-the-encoder.md) in the media sink (described in [Setting Properties in the File Sink](setting-properties-in-the-file-sink.md)), you can a reference to the sink's property store by calling **IMFMediaSink::QueryInterface** on the ASF media sink and passing **IID\_IPropertyStore** as the interface identifier.</span></span>
2.  <span data-ttu-id="990ce-127">Если у вас есть указатель на объект Контентинфо приемника, можно вызвать [**имфасфконтентинфо:: жетенкодингконфигуратионпропертисторе**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfcontentinfo-getencodingconfigurationpropertystore) , чтобы получить ссылку на хранилище свойств приемника мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="990ce-127">If you have a pointer to the sink's ContentInfo object, you can call [**IMFASFContentInfo::GetEncodingConfigurationPropertyStore**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfcontentinfo-getencodingconfigurationpropertystore) to get a reference to the media sink's property store.</span></span>

    <span data-ttu-id="990ce-128">Убедитесь, что все свойства кодировки, заданные для приемника мультимедиа ASF, отражены в хранилище свойств, переданном в [**мфкреатевмаенкодерактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) и [**мфкреатевмвенкодерактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate).</span><span class="sxs-lookup"><span data-stu-id="990ce-128">Make sure that all of encoding properties that are set on the ASF media sink are reflected in the property store passed to [**MFCreateWMAEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) and [**MFCreateWMVEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate).</span></span> <span data-ttu-id="990ce-129">Кодировщик настраивается автоматически на основе параметров, заданных приложением.</span><span class="sxs-lookup"><span data-stu-id="990ce-129">The encoder is configured automatically based on the settings specified by the application.</span></span>

<span data-ttu-id="990ce-130">При создании узла преобразования в топологии кодирования можно задать тип объекта как указатель [**имфактивате**](/windows/desktop/api/mfobjects/nn-mfobjects-imfactivate) , полученный в этих двух вызовах.</span><span class="sxs-lookup"><span data-stu-id="990ce-130">While creating the transform node in the encoding topology, you can set the object type as an [**IMFActivate**](/windows/desktop/api/mfobjects/nn-mfobjects-imfactivate) pointer received in these two calls.</span></span> <span data-ttu-id="990ce-131">При разрешении топологии сеанс мультимедиа использует объект активации для создания экземпляра файла MFT кодировщика.</span><span class="sxs-lookup"><span data-stu-id="990ce-131">When the topology is resolved, the Media Session uses the activation object to create an instance of the encoder MFT.</span></span>

## <a name="encoder-enumeration-in-windows-7-and-later"></a><span data-ttu-id="990ce-132">Перечисление кодировщиков в Windows 7 и более поздних версиях</span><span class="sxs-lookup"><span data-stu-id="990ce-132">Encoder Enumeration in Windows 7 and Later</span></span>

<span data-ttu-id="990ce-133">Для приложений, работающих в Windows 7, в дополнение к [**мфтенум**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) можно перечислить кодировщик МФТС, вызвав [**мфтенумекс**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex).</span><span class="sxs-lookup"><span data-stu-id="990ce-133">For applications that are running on Windows 7, in addition to [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) you can enumerate the encoder MFTs by calling [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex).</span></span> <span data-ttu-id="990ce-134">Эта функция возвращает указатель на объект активации MFT для кодировщика.</span><span class="sxs-lookup"><span data-stu-id="990ce-134">This function returns a pointer to the activation object of the encoder MFT.</span></span> <span data-ttu-id="990ce-135">Структура функции очень похожа на **мфтенум** , описанную выше, за исключением того, что **мфтенумекс** возвращает массив указателей [**имфактивате**](/windows/desktop/api/mfobjects/nn-mfobjects-imfactivate) для кодировщика МФТС, соответствующих условиям поиска.</span><span class="sxs-lookup"><span data-stu-id="990ce-135">The structure of the function is very similar to **MFTEnum** described above except **MFTEnumEx** returns an array of [**IMFActivate**](/windows/desktop/api/mfobjects/nn-mfobjects-imfactivate) pointers for the encoder MFTs that match the search criteria.</span></span>

## <a name="related-topics"></a><span data-ttu-id="990ce-136">См. также</span><span class="sxs-lookup"><span data-stu-id="990ce-136">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="990ce-137">Создание экземпляра MFT для кодировщика</span><span class="sxs-lookup"><span data-stu-id="990ce-137">Instantiating an Encoder MFT</span></span>](instantiating-the-encoder-mft.md)
</dt> <dt>

[<span data-ttu-id="990ce-138">Кодировщики Windows Media</span><span class="sxs-lookup"><span data-stu-id="990ce-138">Windows Media Encoders</span></span>](windows-media-encoders.md)
</dt> <dt>

[<span data-ttu-id="990ce-139">Объекты активации</span><span class="sxs-lookup"><span data-stu-id="990ce-139">Activation Objects</span></span>](activation-objects.md)
</dt> </dl>

 

 



