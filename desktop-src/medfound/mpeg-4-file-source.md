---
description: Источник файлов MPEG-4 анализирует файлы MP4 и 3GPP.
ms.assetid: e64c1554-9702-4cc0-98ad-8a33e04ed09d
title: Источник файла MPEG-4
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c90df56d58df19a53c37436bd631a1cc68dd8114
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104263511"
---
# <a name="mpeg-4-file-source"></a>Источник файла MPEG-4

Источник файлов MPEG-4 анализирует файлы MP4 и 3GPP. Дополнительные сведения о формате файла MP4 см. в следующих документах по стандартам:

-   ISO/IEC 14496-12: *информационные технологии — Программирование звуковых визуальных объектов — часть 12: формат файла основного носителя ISO*
-   ISO/IEC 14496-14: *информационные технологии — Программирование звуковых визуальных объектов — часть 14: формат файла MP4*

> [!Note]  
> (Эти ресурсы могут быть недоступны в некоторых языках и странах.)

 

Источник файлов MPEG-4 не расшифровывает аудио-и видеоданные в файле.

В этом разделе содержатся следующие подразделы.

## <a name="file-extensions-and-mime-types"></a>Расширения файлов и типы MIME

Источник файлов MPEG-4 является источником мультимедиа по умолчанию для следующих расширений имен файлов.



| Расширение файла | Описание           |
|----------------|-----------------------|
| .3g2           | 3GPP2                 |
| .3gp           | 3GPP                  |
| .3gp2          | 3GPP2                 |
| .3gpp          | 3GPP                  |
| .m4a           | Аудио MPEG-4          |
| .m4v           | Видео MPEG-4          |
| .mov           | Ролик Apple QuickTime |
| .mp4           | Аудио или видео MPEG-4 |
| .mp4v          | Видео MPEG-4          |



 

Он также является источником мультимедиа по умолчанию для следующих типов MIME.



| тип MIME   | Описание  |
|-------------|--------------|
| аудио/3GPP  | 3GPP аудио   |
| аудио/3GPP2 | 3GPP2 аудио  |
| аудио/MP4   | Аудио MPEG-4 |
| видео и 3GPP  | видео 3GPP   |
| видео и 3GPP2 | видео 3GPP2  |
| видео и MP4   | Видео MPEG-4 |



 

## <a name="media-types"></a>Типы носителей

MP4 — это расширяемый формат контейнеров. Спецификация MP4 не определяет фиксированную структуру для описания типов мультимедиа в контейнере MP4. Вместо этого он определяет иерархию объектов, позволяющую определять пользовательские структуры для каждого формата. Описание формата хранится в поле "пример описания" ("стсд") для этого потока. В поле Описание примера содержится список образцов записей. Для каждой записи примера 4-байтовый код, аналогичный набору FOURCC, определяет структуру формата.

Это расширение означает, что источник файла MPEG-4 не может распознать каждое возможное описание формата. Вместо этого он использует двухуровневый подход при создании типов мультимедиа для потоков. Как минимум каждый тип носителя содержит следующие атрибуты.



| attribute                                                                     | Описание                                                    |
|-------------------------------------------------------------------------------|----------------------------------------------------------------|
| [**\_ \_ основной тип MF \_ MT**](mf-mt-major-type-attribute.md)                     | Равно **мфмедиатипе \_ Audio** или **мфмедиатипе \_ Video**.     |
| [**подтип MF \_ MT \_**](mf-mt-subtype-attribute.md)                            | Указывает подтип потока.                                  |
| [\_ \_ \_ Описание образца MPEG4 \_ MF](mf-mt-mpeg4-sample-description.md)      | Содержит полное поле описания примера как двоичный BLOB-объект. |
| [\_ \_ \_ \_ Запись текущего примера \_ в MF MT](mf-mt-mpeg4-current-sample-entry.md) | Задает текущую запись в поле Описание образца.     |



 

Источник файлов MPEG-4 распознает некоторые примеры типов записей. Для этих записей можно выполнить синтаксический анализ структуры формата и создать полный тип мультимедиа с дополнительными атрибутами, описывающими сведения о формате. См. раздел [атрибуты типа носителя](media-type-attributes.md).

Источник файлов MPEG-4 может анализировать следующие записи образцов.



| Пример кода записи | Основной тип | Subtype                                                               | Описание                                         | Примечания                                                                                                                                                                                            |
|-------------------|------------|-----------------------------------------------------------------------|-----------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| "Алав"            | звук;      | **\_Формат волны \_ Алав**                                                | Написание закона                                        |                                                                                                                                                                                                  |
| Рисунок            | Видео      | **Мфвидеоформат \_ мжпг**                                               | Фото — поток JPEG                                   | Формат контейнера QuickTime также поддерживает потоки перемещения JPEG с записями "мжпа" или "мжпб", но источник файлов MPEG-4 не предоставляет полный тип носителя для этих типов.               |
| 'avc1'            | Видео      | **Мфвидеоформат \_ H264 Single bitrate**                                               | Видео H. 264                                         |                                                                                                                                                                                                  |
| 'mp4a'            | звук;      | **Мфаудиоформат \_ AAC**<br/> **Мфаудиоформат \_ MP3**<br/>   | AAC или MP3                                          | Запись "mp4a" может описывать другие аудио-форматы MPEG, но источник файлов MPEG-4 не анализирует структуру формата.                                                                          |
| 'mp4v'            | Видео      | **Мфвидеоформат \_ M4S2**<br/> **Мфвидеоформат \_ MP4V**<br/> | MPEG-4 часть 2                                       | **Мфвидеоформат \_ M4S2** используется для простого профиля MPEG-4 Part 2.<br/> **Мфвидеоформат \_ MP4V** используется для всех других профилей MPEG-4 Part 2, включая расширенный простой профиль.<br/> |
| чтен            | звук;      | **Мфаудиоформат \_ PCM**                                                | 8-разрядный звук PCM                                     |                                                                                                                                                                                                  |
| "СОВТ"            | звук;      | **Мфаудиоформат \_ PCM**                                                | 16-битный звук PCM с прямым порядком байтов                      |                                                                                                                                                                                                  |
| парных            | звук;      | **Мфаудиоформат \_ PCM**                                                | 16-битный звук PCM с обратным порядком байтов                         | Источник файлов MPEG-4 преобразует звуковые данные в формат с прямым порядком байтов.                                                                                                                          |
| "Улав"            | звук;      | **\_Формат волны \_ мулав**                                               | μное написание закона                                        |                                                                                                                                                                                                  |
| "VC-1"            | Видео      | **Мфвидеоформат \_ WVC1**                                               | Видео VC-1                                          |                                                                                                                                                                                                  |
| None            | звук;      | **Мфаудиоформат \_ PCM**                                                | 8-битный или 16-битный звук PCM с обратным порядком байтов                | Источник файлов MPEG-4 преобразует звуковые данные в формат с прямым порядком байтов.                                                                                                                          |
| 0x00000000        | звук;      | **Мфаудиоформат \_ PCM**                                                | 8-битный или 16-битный звук PCM с обратным порядком байтов                | Источник файлов MPEG-4 преобразует звуковые данные в формат с прямым порядком байтов.                                                                                                                          |
| 0x6d730002        | звук;      | **\_Формат волны \_ ADPCM**                                               | Адаптивное разностное импульсное программное средство модуляции (ADPCM) |                                                                                                                                                                                                  |
| 0x6d730011        | звук;      | **\_Формат волны \_ Има \_ ADPCM**                                          | СЖАТИЯ                                               |                                                                                                                                                                                                  |



 

Для любых других кодов, не показанных в предыдущей таблице, тип источника MPEG-4 задает следующий подтип:

1.  *подтип* = MFMPEG4Format \_ base
2.  *подтип*. Файл1 = пример кода записи

Для кодов, не показанных в таблице, декодер должен использовать атрибут [ \_ Description для \_ \_ \_ описания образца в MF](mf-mt-mpeg4-sample-description.md) , чтобы проанализировать поле описания.

Список примеров кодов входа и ссылки на соответствующие спецификации см. на веб-сайте [центра регистрации MP4](https://mp4ra.org) .

## <a name="limitations"></a>Ограничения

Источник файлов MPEG-4 не поддерживает следующие возможности файлов MP4:

-   Внешние дорожки.
-   Фрагменты роликов (поля "moof" или "mfra"). "moof" поддерживается в Windows 8.
-   Потоковые презентации. Источник файлов MPEG-4 автоматически игнорирует дорожки подсказок.
-   Поиск по коду времени SMPTE.
-   ("Кмов") атомы.

Поддерживаются только потоки видео и аудио. Все дорожки, содержащие другие типы потоков, игнорируются без уведомления. Данные мультимедиа должны размещаться в атомах "mdat".

Если на компьютере установлена поддержка обновления платформы для Windows Vista, источник файлов MPEG-4 доступен в Windows Vista, но доступен только в Windows Vista с помощью [средства чтения исходного кода](source-reader.md).

## <a name="windows-8-updates-to-mpeg-4-source-and-sink"></a>Обновления Windows 8 для источника и приемника MPEG-4

-   Поддержка вращения чтения и записи добавлена в источнике и приемнике Windows 8 MPEG-4. Это не поддерживается в источнике и приемнике Windows 7 MPEG-4.

    Источник MPEG-4 считывает угол поворота для активной видеодорожки в виде суммы угла вращения из "мвхд" и из "ткхд".

    Приемник Microsoft MPEG-4 записывает угол вращения в "ткхд", но записывает матрицу 0 градусов (Identity) в "мвхд". Обратите внимание, что приемник Microsoft MPEG-4 поддерживает только одну видеодорожку.

    Ипропертисторе считывает угол поворота только для первой видеодорожки в виде суммы угла вращения из "мвхд" и из "ткхд".

    Ипропертисторе записывает угол поворота только для первой видеодорожки в "ткхд" после того, как угол вращения изменяется в соответствии с углом вращения в "мвхд", если он существует.

-   Фрагменты роликов ("moof") поддерживаются в источнике и приемнике Windows 8 MPEG-4, но "mfra" — нет.
-   H. 263 поддерживается в источнике Windows 8 MPEG-4.

    Источник MPEG-4 теперь сопоставляет два объекта FourCC "H263" и 263 "в формате MPEG-4 с типом мультимедиа **мфвидеоформат \_ H263**.

-   Дополнительная поддержка FourCC добавлена для МЖПЕГ в источнике Windows 8 MPEG-4.

    Источник MPEG-4 сопоставляет фаукк из "DMB1" с типом мультимедиа **мфвидеоформат \_ мжпг**.

-   Поддержка метаданных фуригана добавлена в источник Windows 8 MPEG-4.

    Источник MPEG-4 считывает метаданные фуригана из "СОАЛ", "взлетел", "соаа", "сонм" и "Соко". Ипропертисторе считывает метаданные Фуригнана через набор соответствующих PKEY.

    В следующей таблице показано сопоставление канонического имени оболочки, ключа свойства и идентификатора поля/тега в формате файла MPEG-4.

    

    | Поле                                | Ключ свойства                         | ИДЕНТИФИКАТОР тега или Box |
    |--------------------------------------|--------------------------------------|------------|
    | System. Music. Албумтитлесортоверриде  | \_ \_ Албумтитлесортоверриденая музыка PKEY  | соал       |
    | System. Music. Артистсортоверриде      | \_ \_ Артистсортоверриденая музыка PKEY      | взлетел       |
    | System. Music. Албумартистсортоверриде | \_ \_ Албумартистсортоверриденая музыка PKEY | соаа       |
    | System. Титлесортоверриде             | PKEY \_ титлесортоверриде             | сонм       |
    | System. Music. Компосерсортоверриде    | \_ \_ Компосерсортоверриденая музыка PKEY    | соко       |

    

     

-   Поддержка стерео 3D Atom добавлена в источнике Windows 8 MPEG-4.

-   Поддержка AC3 и DD + добавлена в источник и приемник Windows 8 MPEG-4.
-   Файлы размером более 4 гигабайт (ГБ) поддерживаются в приемнике MPEG-4 Windows 8 для нефрагментированного MP4.
-   Очистка оптимизирована в источнике Windows 8 MPEG-4.

    Чтобы сократить задержку, сведения о двух ближайших ключевых кадрах для конкретной должности предоставляются через [**имфсикинфо:: жетнеаресткэйфрамес**](/windows/desktop/api/mfidl/nf-mfidl-imfseekinfo-getnearestkeyframes). Так как ключевой кадр не имеет зависимых кадров, он представляет кадр после декодирования только одного кадра. Используйте [**имфжетсервице::-Service**](/windows/desktop/api/mfidl/nf-mfidl-imfgetservice-getservice) для получения этого интерфейса через источник мультимедиа, конвейер или приложение.

    Задайте для параметра rate (нулевое значение) в источнике MPEG-4. Если конвейер находится в режиме очистки, скорость равна нулю.

-   SPS и PPS могут храниться в образцах данных в приемнике MPEG-4.

    [MF \_ Атрибут \_ \_ транзитного спсппс MPEG4SINK](mf-mpeg4sink-spspps-passthrough.md) в приемнике MPEG-4 определен, чтобы разрешить сохранение SPS и PPS вместе со входными образцами (H. 264 Video Data). Созданные зажимы MP4 воспроизводятся с помощью Windows 7 MPEG-4 и других источников.

-   SPS и PPS можно извлечь из примеров входных данных в приемнике MPEG-4.

    Если в качестве входного носителя для приемника MPEG-4 не заданы протоколы SPS и PPS с использованием [ \_ \_ \_ \_ заголовка последовательного входа MPEG MT](mf-mt-mpeg-sequence-header-attribute.md) , приемник MPEG-4 попытается извлечь SPS и PPS из входных образцов. Приемник MPEG-4 игнорирует все входные образцы, пока не найдет первый сервер SPS и PPS, так как все входные образцы без SPS и PPS не поддерживают декодирование.

-   Объемная информация в записи конфигурации AVC поддерживается для нефрагментированного MP4.
-   НАЛУ длина предоставляется для сжатых образцов H. 264 для оптимизации H. 264 ВЛД ДКСВА декодирования.

    Набор исходных файлов MPEG- [4 \_ имеет длину MF налу, \_ \_ установленную](mf-nalu-length-set.md) на выходном типе носителя **мфвидеоформат \_ H264 Single bitrate** или **мфвидеоформат \_ H264 Single bitrate**. Он задает большой двоичный [объект \_ налу \_ длины \_ MF](mf-nalu-length-information.md) для каждого выходного образца с 4-байтовой длиной налу для разных налу в одном сжатом примере.

-   Добавлена поддержка для звука MPEG2 ADTS в источнике MP4.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Источники и приемники мультимедиа](media-sources-and-sinks.md)
</dt> <dt>

[Поддержка MPEG-4 в Media Foundation](mpeg-4-support-in-media-foundation.md)
</dt> <dt>

[Поддерживаемые форматы мультимедиа в Media Foundation](supported-media-formats-in-media-foundation.md)
</dt> </dl>

 

 




