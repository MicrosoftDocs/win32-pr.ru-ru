---
description: В этом разделе описаны улучшения в Windows 8 для рабочих очередей и работе с потоками на платформе Microsoft Media Foundation.
ms.assetid: 9E2A1D94-BF82-488E-8297-D524683ABE17
title: Усовершенствования рабочей очереди и потоков
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 07b307cb00316696e075e9e9cc2a138e98e149be
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "104081722"
---
# <a name="work-queue-and-threading-improvements"></a><span data-ttu-id="f34cc-103">Усовершенствования рабочей очереди и потоков</span><span class="sxs-lookup"><span data-stu-id="f34cc-103">Work Queue and Threading Improvements</span></span>

<span data-ttu-id="f34cc-104">В этом разделе описаны улучшения в Windows 8 для рабочих очередей и работе с потоками на платформе Microsoft Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="f34cc-104">This topic describes improvements in Windows 8 for work queues and threading in the Microsoft Media Foundation platform.</span></span>

-   [<span data-ttu-id="f34cc-105">Поведение Windows 7</span><span class="sxs-lookup"><span data-stu-id="f34cc-105">Windows 7 Behavior</span></span>](#windows-7-behavior)
    -   [<span data-ttu-id="f34cc-106">Рабочие очереди</span><span class="sxs-lookup"><span data-stu-id="f34cc-106">Work Queues</span></span>](#work-queues)
    -   [<span data-ttu-id="f34cc-107">Поддержка MMCSS</span><span class="sxs-lookup"><span data-stu-id="f34cc-107">MMCSS Support</span></span>](#mmcss-support)
    -   [<span data-ttu-id="f34cc-108">имфреалтимеклиент</span><span class="sxs-lookup"><span data-stu-id="f34cc-108">IMFRealTimeClient</span></span>](#imfrealtimeclientex)
-   [<span data-ttu-id="f34cc-109">Улучшения Windows 8</span><span class="sxs-lookup"><span data-stu-id="f34cc-109">Windows 8 Improvements</span></span>](#windows-8-improvements)
    -   [<span data-ttu-id="f34cc-110">Многопоточные рабочие очереди</span><span class="sxs-lookup"><span data-stu-id="f34cc-110">Multithreaded Work Queues</span></span>](#multithreaded-work-queues)
    -   [<span data-ttu-id="f34cc-111">Рабочие очереди общей задачи</span><span class="sxs-lookup"><span data-stu-id="f34cc-111">Shared Task Work Queues</span></span>](#shared-task-work-queues)
    -   [<span data-ttu-id="f34cc-112">Очередь ожидания</span><span class="sxs-lookup"><span data-stu-id="f34cc-112">Wait Queue</span></span>](#wait-queue)
    -   [<span data-ttu-id="f34cc-113">Усовершенствования поддержки MMCSS</span><span class="sxs-lookup"><span data-stu-id="f34cc-113">Enhancements to MMCSS Support</span></span>](#enhancements-to-mmcss-support)
    -   [<span data-ttu-id="f34cc-114">имфреалтимеклиентекс</span><span class="sxs-lookup"><span data-stu-id="f34cc-114">IMFRealTimeClientEx</span></span>](#imfrealtimeclientex)
    -   [<span data-ttu-id="f34cc-115">Ветви топологии</span><span class="sxs-lookup"><span data-stu-id="f34cc-115">Topology Branches</span></span>](#topology-branches)
-   [<span data-ttu-id="f34cc-116">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="f34cc-116">Recommendations</span></span>](#recommendations)
-   [<span data-ttu-id="f34cc-117">Сводка</span><span class="sxs-lookup"><span data-stu-id="f34cc-117">Summary</span></span>](#summary)
-   [<span data-ttu-id="f34cc-118">См. также</span><span class="sxs-lookup"><span data-stu-id="f34cc-118">Related topics</span></span>](#related-topics)

## <a name="windows-7-behavior"></a><span data-ttu-id="f34cc-119">Поведение Windows 7</span><span class="sxs-lookup"><span data-stu-id="f34cc-119">Windows 7 Behavior</span></span>

<span data-ttu-id="f34cc-120">В этом разделе приводится краткое описание поведения Media Foundation рабочих очередей в Windows 7.</span><span class="sxs-lookup"><span data-stu-id="f34cc-120">This section summarizes the behavior of Media Foundation work queues in Windows 7.</span></span>

### <a name="work-queues"></a><span data-ttu-id="f34cc-121">Рабочие очереди</span><span class="sxs-lookup"><span data-stu-id="f34cc-121">Work Queues</span></span>

<span data-ttu-id="f34cc-122">Платформа Media Foundation создает несколько стандартных рабочих очередей.</span><span class="sxs-lookup"><span data-stu-id="f34cc-122">The Media Foundation platform creates several standard work queues.</span></span> <span data-ttu-id="f34cc-123">В качестве общего использования приложения задокументировано только два.</span><span class="sxs-lookup"><span data-stu-id="f34cc-123">Only two are documented as being for general application use:</span></span>

-   <span data-ttu-id="f34cc-124">**\_стандартная очередь обратного вызова мфасинк \_ \_**</span><span class="sxs-lookup"><span data-stu-id="f34cc-124">**MFASYNC\_CALLBACK\_QUEUE\_STANDARD**</span></span>
-   <span data-ttu-id="f34cc-125">**\_ \_ функция long в очереди обратного вызова мфасинк \_ \_**</span><span class="sxs-lookup"><span data-stu-id="f34cc-125">**MFASYNC\_CALLBACK\_QUEUE\_LONG\_FUNCTION**</span></span>

<span data-ttu-id="f34cc-126">Приложение или компонент может распределять новые рабочие очереди путем вызова [**мфаллокатеворккуеуе**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueue) или [**мфаллокатеворккуеуикс**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueueex).</span><span class="sxs-lookup"><span data-stu-id="f34cc-126">An application or component can allocate new work queues by calling [**MFAllocateWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueue) or [**MFAllocateWorkQueueEx**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueueex).</span></span> <span data-ttu-id="f34cc-127">Функция **мфаллокатеворккуеуикс** определяет два типа рабочей очереди:</span><span class="sxs-lookup"><span data-stu-id="f34cc-127">The **MFAllocateWorkQueueEx** function defines two types of work queue:</span></span>

-   <span data-ttu-id="f34cc-128">**MF \_ Стандартный \_ ворккуеуе** создает рабочую очередь без цикла обработки сообщений.</span><span class="sxs-lookup"><span data-stu-id="f34cc-128">**MF\_STANDARD\_WORKQUEUE** creates a work queue without a message loop.</span></span>
-   <span data-ttu-id="f34cc-129">**MF \_ ОКНО \_ ворккуеуе** создает рабочую очередь с циклом обработки сообщений.</span><span class="sxs-lookup"><span data-stu-id="f34cc-129">**MF\_WINDOW\_WORKQUEUE** creates a work queue with a message loop.</span></span>

<span data-ttu-id="f34cc-130">Чтобы поместить рабочий элемент в очередь, вызовите [**мфпутворкитем**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) или [**мфпутворкитемекс**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex).</span><span class="sxs-lookup"><span data-stu-id="f34cc-130">To queue a work item, call [**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) or [**MFPutWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex).</span></span> <span data-ttu-id="f34cc-131">Платформа выполняет рабочий элемент, вызывая предоставляемую вызывающим объектом реализацию [**имфасинккаллбакк**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback).</span><span class="sxs-lookup"><span data-stu-id="f34cc-131">The platform executes the work item by invoking the caller-provided implementation of [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback).</span></span> <span data-ttu-id="f34cc-132">В Windows 7 и более ранних версиях платформа создает по одному потоку на рабочую очередь.</span><span class="sxs-lookup"><span data-stu-id="f34cc-132">In Windows 7 and earlier, the platform creates one thread per work queue.</span></span>

### <a name="mmcss-support"></a><span data-ttu-id="f34cc-133">Поддержка MMCSS</span><span class="sxs-lookup"><span data-stu-id="f34cc-133">MMCSS Support</span></span>

<span data-ttu-id="f34cc-134">Служба управления персоналом [класса мультимедиа](../procthread/multimedia-class-scheduler-service.md) (MMCSS) управляет приоритетами потоков, чтобы мультимедийные приложения могли получать регулярные срезы времени ЦП, не запрещая ресурсы ЦП приложениям с более низким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="f34cc-134">The [Multimedia Class Scheduler Service](../procthread/multimedia-class-scheduler-service.md) (MMCSS) manages thread priorities so that multimedia applications get regular slices of CPU time, without denying CPU resources to lower-priority applications.</span></span> <span data-ttu-id="f34cc-135">Служба MMCSS определяет набор *задач* с разными профилями использования ЦП.</span><span class="sxs-lookup"><span data-stu-id="f34cc-135">MMCSS defines a set of *tasks* that have different CPU utilization profiles.</span></span> <span data-ttu-id="f34cc-136">Когда поток присоединяется к задаче MMCSS, Служба MMCSS устанавливает приоритет потока на основе нескольких факторов:</span><span class="sxs-lookup"><span data-stu-id="f34cc-136">When a thread joins an MMCSS task, MMCSS sets the priority of the thread based on several factors:</span></span>

-   <span data-ttu-id="f34cc-137">Базовый приоритет задачи, заданный в реестре.</span><span class="sxs-lookup"><span data-stu-id="f34cc-137">The base priority of the task, which is set in the registry.</span></span>
-   <span data-ttu-id="f34cc-138">Относительный приоритет потока, который задается во время выполнения путем вызова [**авсетммсреадприорити**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadpriority).</span><span class="sxs-lookup"><span data-stu-id="f34cc-138">The relative thread priority, which is set at run time by calling [**AvSetMmThreadPriority**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadpriority).</span></span>
-   <span data-ttu-id="f34cc-139">Различные характеристики времени выполнения, например, находится ли приложение на переднем плане, и сколько времени ЦП потребляется потоками в каждом классе MMCSS.</span><span class="sxs-lookup"><span data-stu-id="f34cc-139">Various run-time characteristics, such as whether the application is in the foreground, and how much CPU time is being consumed by the threads in each MMCSS class.</span></span>

<span data-ttu-id="f34cc-140">Приложение может зарегистрировать рабочую очередь с помощью MMCSS, вызвав [**мфбегинрегистерворккуеуевисммксс**](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcss).</span><span class="sxs-lookup"><span data-stu-id="f34cc-140">An application can register a work queue with MMCSS by calling [**MFBeginRegisterWorkQueueWithMMCSS**](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcss).</span></span> <span data-ttu-id="f34cc-141">Эта функция принимает идентификатор рабочей очереди, класс MMCSS (имя задачи) и идентификатор задачи MMCSS.</span><span class="sxs-lookup"><span data-stu-id="f34cc-141">This function takes a work queue ID, an MMCSS class (task name), and the MMCSS task identifier.</span></span> <span data-ttu-id="f34cc-142">Внутри он вызывает [**авсетммсреадчарактеристикс**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadcharacteristicsa) с именем задачи и идентификатором задачи.</span><span class="sxs-lookup"><span data-stu-id="f34cc-142">Internally, it calls [**AvSetMmThreadCharacteristics**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadcharacteristicsa) with the task name and task ID.</span></span> <span data-ttu-id="f34cc-143">После регистрации рабочей очереди в службе MMCSS можно получить идентификатор класса и задачи, вызвав [**мфжетворккуеуеммксскласс**](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcssclass) и [**мфжетворккуеуеммксстаскид**](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcsstaskid).</span><span class="sxs-lookup"><span data-stu-id="f34cc-143">After a work queue is registered with MMCSS, you can get the class and task ID by calling [**MFGetWorkQueueMMCSSClass**](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcssclass) and [**MFGetWorkQueueMMCSSTaskId**](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcsstaskid).</span></span>

<span data-ttu-id="f34cc-144">[Сеанс мультимедиа](media-session.md) обеспечивает более высокий уровень доступа к этим API через интерфейс [**имфворккуеуесервицес**](/windows/desktop/api/mfidl/nn-mfidl-imfworkqueueservices) .</span><span class="sxs-lookup"><span data-stu-id="f34cc-144">The [Media Session](media-session.md) provides somewhat higher-level access to these APIs, through the [**IMFWorkQueueServices**](/windows/desktop/api/mfidl/nn-mfidl-imfworkqueueservices) interface.</span></span> <span data-ttu-id="f34cc-145">Этот интерфейс предоставляет два основных метода:</span><span class="sxs-lookup"><span data-stu-id="f34cc-145">This interface provides two primary methods:</span></span>

| <span data-ttu-id="f34cc-146">Метод</span><span class="sxs-lookup"><span data-stu-id="f34cc-146">Method</span></span>                                                                                                            | <span data-ttu-id="f34cc-147">Описание</span><span class="sxs-lookup"><span data-stu-id="f34cc-147">Description</span></span>                                                                                                                                                                                                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="f34cc-148">**бегинрегистерплатформворккуеуевисммксс**</span><span class="sxs-lookup"><span data-stu-id="f34cc-148">**BeginRegisterPlatformWorkQueueWithMMCSS**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregisterplatformworkqueuewithmmcss)   | <span data-ttu-id="f34cc-149">Регистрирует рабочую очередь с помощью задачи MMCSS.</span><span class="sxs-lookup"><span data-stu-id="f34cc-149">Registers a work queue with an MMCSS task.</span></span> <span data-ttu-id="f34cc-150">Этот метод по сути является тонкой оболочкой для [**мфбегинрегистерворккуеуевисммксс**](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcss), но вы можете передать **значение \_ очереди ответного вызова мфасинк \_ \_ ALL** , чтобы зарегистрировать все рабочие очереди платформы одновременно.</span><span class="sxs-lookup"><span data-stu-id="f34cc-150">This method is essentially a thin wrapper around [**MFBeginRegisterWorkQueueWithMMCSS**](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcss), but you can pass the value **MFASYNC\_CALLBACK\_QUEUE\_ALL** to register all of the platform work queues at once.</span></span> |
| [<span data-ttu-id="f34cc-151">**бегинрегистертопологиворккуеуесвисммксс**</span><span class="sxs-lookup"><span data-stu-id="f34cc-151">**BeginRegisterTopologyWorkQueuesWithMMCSS**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) | <span data-ttu-id="f34cc-152">Регистрирует ветвь топологии с рабочей очередью.</span><span class="sxs-lookup"><span data-stu-id="f34cc-152">Registers a branch of the topology with a work queue.</span></span>                                                                                                                                                                                                                                         |



 

<span data-ttu-id="f34cc-153">Чтобы зарегистрировать ветвь топологии, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="f34cc-153">To register a topology branch, do the following.</span></span>

1.  <span data-ttu-id="f34cc-154">Задайте атрибут [ \_ \_ \_ ID MF топоноде ворккуеуе](mf-toponode-workqueue-id-attribute.md) в исходном узле ветви.</span><span class="sxs-lookup"><span data-stu-id="f34cc-154">Set the [MF\_TOPONODE\_WORKQUEUE\_ID](mf-toponode-workqueue-id-attribute.md) attribute on the source node for the branch.</span></span> <span data-ttu-id="f34cc-155">Используйте любое значение, определенное приложением.</span><span class="sxs-lookup"><span data-stu-id="f34cc-155">Use any application-defined value.</span></span>
2.  <span data-ttu-id="f34cc-156">При необходимости задайте **\_ \_ \_ \_ класс MMCSS топоноде ворккуеуе** , чтобы присоединить рабочую очередь к задаче MMCSS.</span><span class="sxs-lookup"><span data-stu-id="f34cc-156">Optionally, set the **MF\_TOPONODE\_WORKQUEUE\_MMCSS\_CLASS** to join the work queue to an MMCSS task.</span></span>
3.  <span data-ttu-id="f34cc-157">Вызовите [**бегинрегистертопологиворккуеуесвисммксс**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) в разрешенной топологии.</span><span class="sxs-lookup"><span data-stu-id="f34cc-157">Call [**BeginRegisterTopologyWorkQueuesWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) on the resolved topology.</span></span>

<span data-ttu-id="f34cc-158">Сеанс мультимедиа выделяет новую рабочую очередь для каждого уникального значения [ \_ топоноде \_ ворккуеуе \_ ID](mf-toponode-workqueue-id-attribute.md).</span><span class="sxs-lookup"><span data-stu-id="f34cc-158">The Media Session allocates a new work queue for each unique value of [MF\_TOPONODE\_WORKQUEUE\_ID](mf-toponode-workqueue-id-attribute.md).</span></span> <span data-ttu-id="f34cc-159">Для каждой ветви топологии асинхронные операции конвейера выполняются в рабочей очереди, назначенной ветви.</span><span class="sxs-lookup"><span data-stu-id="f34cc-159">For each topology branch, asynchronous pipeline operations are performed on the work queue that is assigned to the branch.</span></span>

### <a name="imfrealtimeclient"></a><span data-ttu-id="f34cc-160">имфреалтимеклиент</span><span class="sxs-lookup"><span data-stu-id="f34cc-160">IMFRealTimeClient</span></span>

<span data-ttu-id="f34cc-161">Интерфейс [**имфреалтимеклиент**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclient) предназначен для компонентов конвейера, которые либо создают собственные потоки, либо используют рабочие очереди для асинхронных операций.</span><span class="sxs-lookup"><span data-stu-id="f34cc-161">The [**IMFRealTimeClient**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclient) interface is intended for pipeline components that either create their own threads or use work queues for asynchronous operations.</span></span> <span data-ttu-id="f34cc-162">Сеанс мультимедиа использует этот интерфейс для уведомления компонента конвейера о правильном поведении, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="f34cc-162">The Media Session uses this interface to notify the pipeline component of the correct behavior, as follows:</span></span>

-   <span data-ttu-id="f34cc-163">Если компонент конвейера создает рабочий поток, метод [**имфреалтимеклиент:: регистерсреадс**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-registerthreads) уведомляет компонент, к которому присоединяется класс MMCSS.</span><span class="sxs-lookup"><span data-stu-id="f34cc-163">If the pipeline component creates a worker thread, the [**IMFRealTimeClient::RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-registerthreads) method notifies the component which MMCSS class to join.</span></span>
-   <span data-ttu-id="f34cc-164">Если компонент конвейера использует рабочую очередь, метод [**имфреалтимеклиент:: сетворккуеуе**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-setworkqueue) сообщает компоненту, какую рабочую очередь следует использовать.</span><span class="sxs-lookup"><span data-stu-id="f34cc-164">If the pipeline component uses a work queue, the [**IMFRealTimeClient::SetWorkQueue**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-setworkqueue) method tells the component which work queue to use.</span></span>

<span data-ttu-id="f34cc-165">Как правило, компонент конвейера использует либо поток, либо рабочую очередь для выполнения асинхронных задач, но не то и другое одновременно.</span><span class="sxs-lookup"><span data-stu-id="f34cc-165">Typically, a pipeline component uses either a thread or a work queue to perform asynchronous tasks, but not both.</span></span>

## <a name="windows-8-improvements"></a><span data-ttu-id="f34cc-166">Улучшения Windows 8</span><span class="sxs-lookup"><span data-stu-id="f34cc-166">Windows 8 Improvements</span></span>

### <a name="multithreaded-work-queues"></a><span data-ttu-id="f34cc-167">Многопоточные рабочие очереди</span><span class="sxs-lookup"><span data-stu-id="f34cc-167">Multithreaded Work Queues</span></span>

<span data-ttu-id="f34cc-168">В Windows 8 Media Foundation поддерживает новый тип рабочей очереди, называемой *многопоточной очередью*.</span><span class="sxs-lookup"><span data-stu-id="f34cc-168">In Windows 8, Media Foundation supports a new type of work queue called the *multithreaded queue*.</span></span> <span data-ttu-id="f34cc-169">В многопоточной очереди для отправки рабочих элементов используется пул системных потоков.</span><span class="sxs-lookup"><span data-stu-id="f34cc-169">A multithreaded queue uses a system thread pool to dispatch work items.</span></span> <span data-ttu-id="f34cc-170">Многопоточные очереди масштабируются лучше, чем предыдущие однопотоковые очереди.</span><span class="sxs-lookup"><span data-stu-id="f34cc-170">The multithreaded queue scales better than the previous single-threaded queues.</span></span> <span data-ttu-id="f34cc-171">Например,</span><span class="sxs-lookup"><span data-stu-id="f34cc-171">For example,</span></span>

-   <span data-ttu-id="f34cc-172">Несколько компонентов могут совместно использовать многопоточную очередь, не блокируя друг друга, требуя создания меньшего числа потоков.</span><span class="sxs-lookup"><span data-stu-id="f34cc-172">Several components can share a multithreaded queue without blocking one another, requiring the creation of fewer threads.</span></span>

-   <span data-ttu-id="f34cc-173">Рабочие элементы оптимизируются, чтобы избежать переключения контекста, если событие уже задано.</span><span class="sxs-lookup"><span data-stu-id="f34cc-173">Work items are optimized to avoid context switches if an event is already set.</span></span> <span data-ttu-id="f34cc-174">Это более эффективно, чем создание собственных потоков для ожидания событий.</span><span class="sxs-lookup"><span data-stu-id="f34cc-174">This is more efficient than creating your own threads to wait on events.</span></span>

<span data-ttu-id="f34cc-175">При использовании [**имфреалтимеклиентекс**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex)приложения должны избегать использования потоков и вместо этого использовать рабочие очереди.</span><span class="sxs-lookup"><span data-stu-id="f34cc-175">When using [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex), applications should avoid spinning up threads and instead should use the work queues.</span></span> <span data-ttu-id="f34cc-176">Для этого приложения должны реализовать [**сетворккуеуикс**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-setworkqueueex) и не использовать [**регистерсреадс**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-registerthreadsex) и [**унрегистерсреадс**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-unregisterthreads).</span><span class="sxs-lookup"><span data-stu-id="f34cc-176">To accomplish this, applications should implement [**SetWorkQueueEx**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-setworkqueueex) and not use [**RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-registerthreadsex) and [**UnregisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-unregisterthreads).</span></span>

<span data-ttu-id="f34cc-177">При инициализации Media Foundationной платформы создается многопоточная очередь с Мфасинк идентификатором **\_ \_ очереди \_ ответного вызова**.</span><span class="sxs-lookup"><span data-stu-id="f34cc-177">When the Media Foundation platform is initialized, it creates a multithreaded queue with the identifier **MFASYNC\_CALLBACK\_QUEUE\_MULTITHREADED**.</span></span>

<span data-ttu-id="f34cc-178">Многопоточная очередь не выполняет сериализацию рабочих элементов.</span><span class="sxs-lookup"><span data-stu-id="f34cc-178">A multithreaded queue does not serialize work items.</span></span> <span data-ttu-id="f34cc-179">Каждый раз, когда поток из пула потоков становится доступным, отправляется следующий рабочий элемент в очереди.</span><span class="sxs-lookup"><span data-stu-id="f34cc-179">Whenever a thread from the thread pool becomes available, the next work item on the queue is dispatched.</span></span> <span data-ttu-id="f34cc-180">Вызывающий объект должен обеспечить правильную сериализацию работы.</span><span class="sxs-lookup"><span data-stu-id="f34cc-180">The caller must ensure that work is serialized correctly.</span></span> <span data-ttu-id="f34cc-181">Чтобы упростить это, Media Foundation определяет *последовательную рабочую очередь*.</span><span class="sxs-lookup"><span data-stu-id="f34cc-181">To make this easier, Media Foundation defines a *serial work queue*.</span></span> <span data-ttu-id="f34cc-182">Последовательная очередь создает оболочку для другой рабочей очереди, но гарантирует полное сериализованное выполнение.</span><span class="sxs-lookup"><span data-stu-id="f34cc-182">A serial queue wraps another work queue but guarantees fully serialized execution.</span></span> <span data-ttu-id="f34cc-183">Следующий элемент в очереди не отправляется, пока не завершится предыдущий элемент.</span><span class="sxs-lookup"><span data-stu-id="f34cc-183">The next item on the queue is not dispatched until the previous item completes.</span></span>

<span data-ttu-id="f34cc-184">Следующий код создает очередь сериализатора для многопоточной очереди платформы.</span><span class="sxs-lookup"><span data-stu-id="f34cc-184">The following code creates a serializer queue over the platform multithreaded queue.</span></span>


```C++
DWORD workQueueID;
hr = MFAllocateSerialWorkQueue(MFASYNC_CALLBACK_QUEUE_MULTITHREADED, &workQueueID); 
```



<span data-ttu-id="f34cc-185">Несколько последовательных очередей могут переносить одну и ту же многопоточные очереди.</span><span class="sxs-lookup"><span data-stu-id="f34cc-185">More than one serial queue can wrap the same multithreaded queue.</span></span> <span data-ttu-id="f34cc-186">Затем последовательные очереди используют один и тот же пул потоков, а сериализованное выполнение применяется в каждой очереди.</span><span class="sxs-lookup"><span data-stu-id="f34cc-186">The serial queues then share the same thread pool, and serialized execution is enforced within each queue.</span></span>

<span data-ttu-id="f34cc-187">Стандартные рабочие очереди, существовавшие до Windows 8, теперь реализованы в виде последовательных рабочих очередей, которые создают оболочку для многопоточной очереди платформы.</span><span class="sxs-lookup"><span data-stu-id="f34cc-187">The standard work queues that existed prior to Windows 8 are now implemented as serial work queues that wrap the platform multithreaded queue.</span></span> <span data-ttu-id="f34cc-188">Это изменение сохраняет обратную совместимость.</span><span class="sxs-lookup"><span data-stu-id="f34cc-188">This change preserves backward compatibility.</span></span>

### <a name="shared-task-work-queues"></a><span data-ttu-id="f34cc-189">Рабочие очереди общей задачи</span><span class="sxs-lookup"><span data-stu-id="f34cc-189">Shared Task Work Queues</span></span>

<span data-ttu-id="f34cc-190">Для правильной работы с планировщиком ядра необходимо наличие одной многопоточной рабочей очереди для каждой используемой задачи MMCSS.</span><span class="sxs-lookup"><span data-stu-id="f34cc-190">To work correctly with the kernel scheduler, there should be one multithreaded work queue for each MMCSS task that you use.</span></span> <span data-ttu-id="f34cc-191">Платформа Media Foundation выделяет эти данные по мере необходимости, по одному на каждую задачу MMCSS на процесс.</span><span class="sxs-lookup"><span data-stu-id="f34cc-191">The Media Foundation platform allocates these as needed, up to one per MMCSS task, per process.</span></span> <span data-ttu-id="f34cc-192">Чтобы получить общую рабочую очередь для определенной задачи MMCSS, вызовите [**мфлоккшаредворккуеуе**](/windows/desktop/api/mfapi/nf-mfapi-mflocksharedworkqueue) и укажите имя задачи.</span><span class="sxs-lookup"><span data-stu-id="f34cc-192">To get the shared work queue for a particular MMCSS task, call [**MFLockSharedWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mflocksharedworkqueue) and specify the task name.</span></span> <span data-ttu-id="f34cc-193">Функция ищет имя задачи в таблице.</span><span class="sxs-lookup"><span data-stu-id="f34cc-193">The function looks up the task name in a table.</span></span> <span data-ttu-id="f34cc-194">Если для этой задачи еще не существует рабочей очереди, функция выделяет новую рабочую очередь MT и немедленно присоединяет ее к задаче MMCSS.</span><span class="sxs-lookup"><span data-stu-id="f34cc-194">If a work queue does not already exist for this task, the function allocates a new MT work queue and immediately joins it to the MMCSS task.</span></span> <span data-ttu-id="f34cc-195">Если для этой задачи уже существует Рабочая очередь, функция возвращает идентификатор существующей рабочей очереди.</span><span class="sxs-lookup"><span data-stu-id="f34cc-195">If a work queue already exists for that task, the function returns the identifier of the existing work queue.</span></span>

### <a name="wait-queue"></a><span data-ttu-id="f34cc-196">Очередь ожидания</span><span class="sxs-lookup"><span data-stu-id="f34cc-196">Wait Queue</span></span>

<span data-ttu-id="f34cc-197">*Очередь ожидания* — это специальная рабочая очередь платформы, которая ожидает оповещения о событиях.</span><span class="sxs-lookup"><span data-stu-id="f34cc-197">The *wait queue* is a special platform work queue that waits on events to be signaled.</span></span> <span data-ttu-id="f34cc-198">Если компоненту требуется дождаться сигнала события, он может использовать очередь ожидания вместо создания рабочего потока для ожидания события.</span><span class="sxs-lookup"><span data-stu-id="f34cc-198">If a component needs to wait for an event to be signaled, it can use the wait queue instead of creating a worker thread to wait on the event.</span></span>

<span data-ttu-id="f34cc-199">Чтобы использовать очередь ожидания, вызовите [**мфпутваитингворкитем**](/windows/desktop/api/mfapi/nf-mfapi-mfputwaitingworkitem).</span><span class="sxs-lookup"><span data-stu-id="f34cc-199">To use the wait queue, call [**MFPutWaitingWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputwaitingworkitem).</span></span> <span data-ttu-id="f34cc-200">Параметры включают в себя маркер события и указатель [**имфасинкресулт**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) .</span><span class="sxs-lookup"><span data-stu-id="f34cc-200">The parameters include the event handle and an [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) pointer.</span></span> <span data-ttu-id="f34cc-201">Когда событие получает сигнал, очередь ожидания вызывает обратный вызов.</span><span class="sxs-lookup"><span data-stu-id="f34cc-201">When the event is signaled, the wait queue invokes your callback.</span></span> <span data-ttu-id="f34cc-202">Очередь ожидания одной платформы. приложения не могут создавать собственные очереди ожидания.</span><span class="sxs-lookup"><span data-stu-id="f34cc-202">There is a single platform wait queue; applications cannot create their own wait queues.</span></span>

### <a name="enhancements-to-mmcss-support"></a><span data-ttu-id="f34cc-203">Усовершенствования поддержки MMCSS</span><span class="sxs-lookup"><span data-stu-id="f34cc-203">Enhancements to MMCSS Support</span></span>

<span data-ttu-id="f34cc-204">Следующие новые функции Media Foundation платформы относятся к MMCSS.</span><span class="sxs-lookup"><span data-stu-id="f34cc-204">The following new Media Foundation platform functions relate to MMCSS.</span></span>



| <span data-ttu-id="f34cc-205">Функция</span><span class="sxs-lookup"><span data-stu-id="f34cc-205">Function</span></span>                                                                           | <span data-ttu-id="f34cc-206">Описание</span><span class="sxs-lookup"><span data-stu-id="f34cc-206">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="f34cc-207">**мфбегинрегистерворккуеуевисммкссекс**</span><span class="sxs-lookup"><span data-stu-id="f34cc-207">**MFBeginRegisterWorkQueueWithMMCSSEx**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcssex) | <span data-ttu-id="f34cc-208">Регистрирует рабочую очередь с помощью MMCSS.</span><span class="sxs-lookup"><span data-stu-id="f34cc-208">Registers a work queue with MMCSS.</span></span> <span data-ttu-id="f34cc-209">Эта функция включает параметр для указания относительного приоритета потока.</span><span class="sxs-lookup"><span data-stu-id="f34cc-209">This function includes a parameter to specify relative thread priority.</span></span> <span data-ttu-id="f34cc-210">На внутреннем уровне это значение преобразуется в вызов [**авсетммсреадприорити**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadpriority).</span><span class="sxs-lookup"><span data-stu-id="f34cc-210">Internally, this value is translated into a call to [**AvSetMmThreadPriority**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadpriority).</span></span>                                                                                                                                                                               |
| [<span data-ttu-id="f34cc-211">**мфжетворккуеуеммкссприорити**</span><span class="sxs-lookup"><span data-stu-id="f34cc-211">**MFGetWorkQueueMMCSSPriority**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcsspriority)                 | <span data-ttu-id="f34cc-212">Запрашивает приоритет рабочей очереди.</span><span class="sxs-lookup"><span data-stu-id="f34cc-212">Queries the priority of a work queue.</span></span>                                                                                                                                                                                                                                                                                                                                                                 |
| [<span data-ttu-id="f34cc-213">**мфрегистерплатформвисммксс**</span><span class="sxs-lookup"><span data-stu-id="f34cc-213">**MFRegisterPlatformWithMMCSS**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfregisterplatformwithmmcss)                 | <span data-ttu-id="f34cc-214">Регистрирует все рабочие очереди платформы с помощью задачи MMCSS.</span><span class="sxs-lookup"><span data-stu-id="f34cc-214">Registers all of the platform work queues with an MMCSS task.</span></span> <span data-ttu-id="f34cc-215">Эта функция аналогична методу [**имфворккуеуесервицес:: бегинрегистерплатформворккуеуевисммксс**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregisterplatformworkqueuewithmmcss) , но ее можно использовать без создания экземпляра сеанса мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="f34cc-215">This function is similar to the [**IMFWorkQueueServices::BeginRegisterPlatformWorkQueueWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregisterplatformworkqueuewithmmcss) method, but it can be used without creating an instance of the Media Session.</span></span> <span data-ttu-id="f34cc-216">Кроме того, функция включает параметр для указания приоритета базового потока.</span><span class="sxs-lookup"><span data-stu-id="f34cc-216">In addition, the function includes a parameter to specify the base thread priority.</span></span> |



 

<span data-ttu-id="f34cc-217">Приложения, использующие сеанс мультимедиа, должны установить атрибут [ \_ класса топоноде \_ ворккуеуе \_ MMCSS \_ ](mf-toponode-workqueue-mmcss-class-attribute.md) в значение Audio для ветви подготовки звука.</span><span class="sxs-lookup"><span data-stu-id="f34cc-217">Applications that use the Media Session should set the [MF\_TOPONODE\_WORKQUEUE\_MMCSS\_CLASS](mf-toponode-workqueue-mmcss-class-attribute.md) attribute to "Audio" for the audio rendering branch.</span></span> <span data-ttu-id="f34cc-218">Задайте для атрибута значение "Воспроизведение" для ветви отрисовки видео.</span><span class="sxs-lookup"><span data-stu-id="f34cc-218">Set the attribute to "Playback" for the video rendering branch.</span></span>

### <a name="imfrealtimeclientex"></a><span data-ttu-id="f34cc-219">имфреалтимеклиентекс</span><span class="sxs-lookup"><span data-stu-id="f34cc-219">IMFRealTimeClientEx</span></span>

<span data-ttu-id="f34cc-220">Интерфейс [**имфреалтимеклиентекс**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex) для замены имфреалтимеклиент для компонентов конвейера, выполняющих асинхронные операции.</span><span class="sxs-lookup"><span data-stu-id="f34cc-220">The [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex) interface to replaces IMFRealTimeClient, for pipeline components that perform asynchronous operations.</span></span>



| <span data-ttu-id="f34cc-221">Метод</span><span class="sxs-lookup"><span data-stu-id="f34cc-221">Method</span></span>                                                             | <span data-ttu-id="f34cc-222">Описание</span><span class="sxs-lookup"><span data-stu-id="f34cc-222">Description</span></span>                                                                                                                                                                                                                    |
|--------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="f34cc-223">**регистерсреадсекс**</span><span class="sxs-lookup"><span data-stu-id="f34cc-223">**RegisterThreadsEx**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-registerthreadsex) | <span data-ttu-id="f34cc-224">Уведомляет компонент о необходимости регистрации своих потоков с помощью MMCSS.</span><span class="sxs-lookup"><span data-stu-id="f34cc-224">Notifies the component to register its threads with MMCSS.</span></span> <span data-ttu-id="f34cc-225">Этот метод эквивалентен [**имфреалтимеклиент:: регистерсреадс**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-registerthreads), но добавляет параметр для приоритета базового потока.</span><span class="sxs-lookup"><span data-stu-id="f34cc-225">This method is equivalent to [**IMFRealTimeClient::RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-registerthreads), but it adds a parameter for the base thread priority.</span></span> |
| [<span data-ttu-id="f34cc-226">**сетворккуеуикс**</span><span class="sxs-lookup"><span data-stu-id="f34cc-226">**SetWorkQueueEx**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-setworkqueueex)       | <span data-ttu-id="f34cc-227">Уведомляет компонент об использовании определенной рабочей очереди.</span><span class="sxs-lookup"><span data-stu-id="f34cc-227">Notifies the component to use a specific work queue.</span></span> <span data-ttu-id="f34cc-228">Этот метод эквивалентен [**имфреадтимеклиент:: сетворккуеуе**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-setworkqueue), но добавляет параметр для приоритета рабочего элемента.</span><span class="sxs-lookup"><span data-stu-id="f34cc-228">This method is equivalent to [**IMFReadTimeClient::SetWorkQueue**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-setworkqueue), but it adds a parameter for the work item priority.</span></span>               |
| [<span data-ttu-id="f34cc-229">**унрегистерсреадс**</span><span class="sxs-lookup"><span data-stu-id="f34cc-229">**UnregisterThreads**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-unregisterthreads) | <span data-ttu-id="f34cc-230">Уведомляет компонент о необходимости отмены регистрации своих потоков из MMCSS.</span><span class="sxs-lookup"><span data-stu-id="f34cc-230">Notifies the component to unregister its threads from MMCSS.</span></span> <span data-ttu-id="f34cc-231">Этот метод идентичен методу [**имфреалтимеклиент:: унрегистерсреадс**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-unregisterthreads) .</span><span class="sxs-lookup"><span data-stu-id="f34cc-231">This method is identical to the [**IMFRealTimeClient::UnregisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-unregisterthreads) method.</span></span>                                       |



 

<span data-ttu-id="f34cc-232">Компоненты конвейера должны использовать рабочие очереди и не должны создавать рабочие потоки по следующим причинам.</span><span class="sxs-lookup"><span data-stu-id="f34cc-232">Pipeline components should use work queues, and should not create worker threads, for the following reasons:</span></span>

-   <span data-ttu-id="f34cc-233">Рабочие очереди лучше масштабировать, так как они используют пулы потоков ОС.</span><span class="sxs-lookup"><span data-stu-id="f34cc-233">Work queues scale better, because they use the OS thread pools.</span></span>
-   <span data-ttu-id="f34cc-234">Платформа обрабатывает сведения о регистрации рабочих очередей с помощью MMCSS.</span><span class="sxs-lookup"><span data-stu-id="f34cc-234">The platform handles the details of registering work queues with MMCSS.</span></span>
-   <span data-ttu-id="f34cc-235">Рабочий поток может легко вызвать взаимоблокировку, которую трудно отладить.</span><span class="sxs-lookup"><span data-stu-id="f34cc-235">A worker thread can easily cause a deadlock that is hard to debug.</span></span>

<span data-ttu-id="f34cc-236">Кроме того, рекомендуется использовать рабочую очередь сериализатора, если необходимо сериализовать асинхронные операции.</span><span class="sxs-lookup"><span data-stu-id="f34cc-236">Also, consider using the serializer work queue if you need to serialize your asynchronous operations.</span></span>

### <a name="topology-branches"></a><span data-ttu-id="f34cc-237">Ветви топологии</span><span class="sxs-lookup"><span data-stu-id="f34cc-237">Topology Branches</span></span>

<span data-ttu-id="f34cc-238">Если атрибут [ \_ \_ \_ \_ класса MMCSS топоноде ворккуеуе (MF](mf-toponode-workqueue-mmcss-class-attribute.md) ) регистрирует ветвь топологии с помощью MMCSS, в Windows 8 сеанс мультимедиа использует рабочие очереди общего MT.</span><span class="sxs-lookup"><span data-stu-id="f34cc-238">If the [MF\_TOPONODE\_WORKQUEUE\_MMCSS\_CLASS](mf-toponode-workqueue-mmcss-class-attribute.md) attribute registers a topology branch with MMCSS, in Windows 8 the Media Session uses the shared MT work queues.</span></span> <span data-ttu-id="f34cc-239">В более ранних версиях Windows сеанс мультимедиа выделил новую рабочую очередь.</span><span class="sxs-lookup"><span data-stu-id="f34cc-239">In earlier versions of Windows, the Media Session allocated a new work queue.</span></span>

<span data-ttu-id="f34cc-240">Для регистрации ветви топологии с помощью MMCSS определены два новых атрибута.</span><span class="sxs-lookup"><span data-stu-id="f34cc-240">Two new attributes are defined for registering a topology branch with MMCSS.</span></span>



| <span data-ttu-id="f34cc-241">attribute</span><span class="sxs-lookup"><span data-stu-id="f34cc-241">Attribute</span></span>                                                                            | <span data-ttu-id="f34cc-242">Описание</span><span class="sxs-lookup"><span data-stu-id="f34cc-242">Description</span></span>                         |
|--------------------------------------------------------------------------------------|-------------------------------------|
| [<span data-ttu-id="f34cc-243">\_ТОПОНОДЕ MF \_ ворккуеуе \_ с \_ приоритетом MMCSS</span><span class="sxs-lookup"><span data-stu-id="f34cc-243">MF\_TOPONODE\_WORKQUEUE\_MMCSS\_PRIORITY</span></span>](mf-toponode-workqueue-mmcss-priority.md) | <span data-ttu-id="f34cc-244">Указывает приоритет базового потока.</span><span class="sxs-lookup"><span data-stu-id="f34cc-244">Specifies the base thread priority.</span></span> |
| [<span data-ttu-id="f34cc-245">\_ \_ \_ приоритет элемента MF топоноде \_ ворккуеуе</span><span class="sxs-lookup"><span data-stu-id="f34cc-245">MF\_TOPONODE\_WORKQUEUE\_ITEM\_PRIORITY</span></span>](mf-toponode-workqueue-item-priority.md)   | <span data-ttu-id="f34cc-246">Указывает приоритет рабочего элемента.</span><span class="sxs-lookup"><span data-stu-id="f34cc-246">Specifies the work item priority.</span></span>   |



 

## <a name="recommendations"></a><span data-ttu-id="f34cc-247">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="f34cc-247">Recommendations</span></span>

-   <span data-ttu-id="f34cc-248">Приложения, использующие сеанс мультимедиа, должны задать [для \_ \_ \_ \_ класса MMCSS топоноде ворккуеуе](mf-toponode-workqueue-mmcss-class-attribute.md) для передачи звука значение "Audio" для ветви подготовки к просмотру и "Воспроизведение" для ветви отрисовки видео.</span><span class="sxs-lookup"><span data-stu-id="f34cc-248">Applications that use the Media Session should set [MF\_TOPONODE\_WORKQUEUE\_MMCSS\_CLASS](mf-toponode-workqueue-mmcss-class-attribute.md) to "Audio" for the audio rendering branch and "Playback" for the video rendering branch.</span></span>
-   <span data-ttu-id="f34cc-249">Приложения, использующие сеанс мультимедиа, должны вызывать [**имфворккуеуесервицес:: бегинрегистертопологиворккуеуесвисммксс**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) в топологии.</span><span class="sxs-lookup"><span data-stu-id="f34cc-249">Applications that use the Media Session should call [**IMFWorkQueueServices::BeginRegisterTopologyWorkQueuesWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) on the topology.</span></span>
-   <span data-ttu-id="f34cc-250">Для компонентов конвейера рекомендуется использовать рабочие очереди вместо рабочих потоков.</span><span class="sxs-lookup"><span data-stu-id="f34cc-250">For pipeline components, work queues are recommended instead of worker threads.</span></span> <span data-ttu-id="f34cc-251">Если компонент использует либо рабочие очереди, либо рабочие потоки, реализуйте [**имфреалтимеклиентекс**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex).</span><span class="sxs-lookup"><span data-stu-id="f34cc-251">If the component uses either work queues or worker threads, implement [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex).</span></span>
-   <span data-ttu-id="f34cc-252">Не создавайте частные рабочие очереди, так как это нарушает назначение рабочих очередей платформы.</span><span class="sxs-lookup"><span data-stu-id="f34cc-252">Do not create private work queues, as this defeats the purpose of the platform work queues.</span></span> <span data-ttu-id="f34cc-253">Используйте многопотоковую очередь платформы или последовательную очередь, которая создает оболочку для многопоточной очереди платформы.</span><span class="sxs-lookup"><span data-stu-id="f34cc-253">Use either the platform multithreaded queue or a serial queue that wraps the platform multithreaded queue.</span></span>
-   <span data-ttu-id="f34cc-254">Если необходимо сериализовать асинхронные операции, используйте последовательную очередь.</span><span class="sxs-lookup"><span data-stu-id="f34cc-254">If you need to serialize asynchronous operations, use a serial queue.</span></span>

## <a name="summary"></a><span data-ttu-id="f34cc-255">Сводка</span><span class="sxs-lookup"><span data-stu-id="f34cc-255">Summary</span></span>

<span data-ttu-id="f34cc-256">Следующие Media Foundation API платформы, относящиеся к потокам и рабочим очередям, являются новыми для Windows 8.</span><span class="sxs-lookup"><span data-stu-id="f34cc-256">The following Media Foundation platform APIs that relate to threads and work queues are new for Windows 8.</span></span>

-   [<span data-ttu-id="f34cc-257">\_ \_ \_ приоритет элемента MF топоноде \_ ворккуеуе</span><span class="sxs-lookup"><span data-stu-id="f34cc-257">MF\_TOPONODE\_WORKQUEUE\_ITEM\_PRIORITY</span></span>](mf-toponode-workqueue-item-priority.md)
-   [<span data-ttu-id="f34cc-258">\_ТОПОНОДЕ MF \_ ворккуеуе \_ с \_ приоритетом MMCSS</span><span class="sxs-lookup"><span data-stu-id="f34cc-258">MF\_TOPONODE\_WORKQUEUE\_MMCSS\_PRIORITY</span></span>](mf-toponode-workqueue-mmcss-priority.md)
-   [<span data-ttu-id="f34cc-259">**мфаллокатесериалворккуеуе**</span><span class="sxs-lookup"><span data-stu-id="f34cc-259">**MFAllocateSerialWorkQueue**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfallocateserialworkqueue)
-   [<span data-ttu-id="f34cc-260">**мфбегинрегистерворккуеуевисммкссекс**</span><span class="sxs-lookup"><span data-stu-id="f34cc-260">**MFBeginRegisterWorkQueueWithMMCSSEx**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcssex)
-   [<span data-ttu-id="f34cc-261">**мфжетворккуеуеммкссприорити**</span><span class="sxs-lookup"><span data-stu-id="f34cc-261">**MFGetWorkQueueMMCSSPriority**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcsspriority)
-   [<span data-ttu-id="f34cc-262">**мфпутваитингворкитем**</span><span class="sxs-lookup"><span data-stu-id="f34cc-262">**MFPutWaitingWorkItem**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfputwaitingworkitem)
-   [<span data-ttu-id="f34cc-263">**MFPutWorkItem2**</span><span class="sxs-lookup"><span data-stu-id="f34cc-263">**MFPutWorkItem2**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem2)
-   [<span data-ttu-id="f34cc-264">**MFPutWorkItemEx2**</span><span class="sxs-lookup"><span data-stu-id="f34cc-264">**MFPutWorkItemEx2**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex2)
-   [<span data-ttu-id="f34cc-265">**мфрегистерплатформвисммксс**</span><span class="sxs-lookup"><span data-stu-id="f34cc-265">**MFRegisterPlatformWithMMCSS**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfregisterplatformwithmmcss)
-   [<span data-ttu-id="f34cc-266">**мфунрегистерплатформфромммксс**</span><span class="sxs-lookup"><span data-stu-id="f34cc-266">**MFUnregisterPlatformFromMMCSS**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfunregisterplatformfrommmcss)
-   [<span data-ttu-id="f34cc-267">**мфлоккшаредворккуеуе**</span><span class="sxs-lookup"><span data-stu-id="f34cc-267">**MFLockSharedWorkQueue**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mflocksharedworkqueue)
-   [<span data-ttu-id="f34cc-268">**имфреалтимеклиентекс**</span><span class="sxs-lookup"><span data-stu-id="f34cc-268">**IMFRealTimeClientEx**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex)

## <a name="related-topics"></a><span data-ttu-id="f34cc-269">См. также</span><span class="sxs-lookup"><span data-stu-id="f34cc-269">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f34cc-270">Рабочие очереди</span><span class="sxs-lookup"><span data-stu-id="f34cc-270">Work Queues</span></span>](work-queues.md)
</dt> </dl>

 

 
