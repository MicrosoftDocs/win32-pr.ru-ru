---
description: Настройка объекта разделителя ASF
ms.assetid: 8e2ba659-e1f6-42be-afd6-21fc841dc8d3
title: Настройка объекта разделителя ASF
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 14f27885e602dd52012808d330d997f9b7a7e983
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104143213"
---
# <a name="configuring-the-asf-splitter-object"></a><span data-ttu-id="0e6a3-103">Настройка объекта разделителя ASF</span><span class="sxs-lookup"><span data-stu-id="0e6a3-103">Configuring the ASF Splitter Object</span></span>

<span data-ttu-id="0e6a3-104">Объект- *Разделитель* ASF — это объект слоя вмконтаинер, который анализирует объект данных ASF в файле ASF.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-104">The ASF *splitter* object is a WMContainer layer object that parses the ASF Data Object of an Advanced Systems Format (ASF) file.</span></span> <span data-ttu-id="0e6a3-105">После того как разделитель создан и инициализирован для анализа объекта данных ASF файла мультимедиа, разделитель должен быть настроен для создания образцов для конкретных потоков.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-105">After the splitter is created and initialized to parse the ASF Data Object of a media file, the splitter must be configured to generate samples for specific streams.</span></span> <span data-ttu-id="0e6a3-106">Вызовите метод [**имфасфсплиттер:: селектстреамс**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-selectstreams) , чтобы выбрать необходимые потоки.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-106">Call [**IMFASFSplitter::SelectStreams**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-selectstreams) to select the required streams.</span></span>

<span data-ttu-id="0e6a3-107">При необходимости приложение также может настроить его для создания примеров в обратный порядок или создать образцы для защищенного содержимого.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-107">Optionally, an application can also configure it to generate samples in reverse order or generate samples for protected content.</span></span> <span data-ttu-id="0e6a3-108">Чтобы задать эти параметры, вызовите метод [**имфасфсплиттер:: сетфлагс**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-setflags) и передайте требуемое побитовое сочетание поддерживаемых флагов.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-108">To set these options, call [**IMFASFSplitter::SetFlags**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-setflags) and pass the required bitwise combination of the supported flags.</span></span> <span data-ttu-id="0e6a3-109">Перед вызовом этого метода клиент должен успешно завершить вызов [**имфасфсплиттер:: Initialize**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-initialize) ; в противном случае **сетфлагс** завершается с ошибкой **MF \_ E \_ не \_ инициализирован** код ошибки.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-109">Before calling this method, the client must complete the [**IMFASFSplitter::Initialize**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-initialize) call successfully; otherwise, **SetFlags** fails with **MF\_E\_NOT\_INITIALIZED** error code.</span></span> <span data-ttu-id="0e6a3-110">Дополнительные сведения об инициализации разделителя см. [в разделе Создание объекта РАЗДЕЛИТЕЛЯ ASF](creating-the-asf-splitter-object.md).</span><span class="sxs-lookup"><span data-stu-id="0e6a3-110">For information about initializing the splitter, see [Creating the ASF Splitter Object](creating-the-asf-splitter-object.md).</span></span>

<span data-ttu-id="0e6a3-111">Чтобы проверить, установлен ли этот флаг в данный момент в разделителе, вызовите [**имфасфсплиттер::-flags**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-getflags).</span><span class="sxs-lookup"><span data-stu-id="0e6a3-111">To check whether this flag is currently set on the splitter, call [**IMFASFSplitter::GetFlags**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-getflags).</span></span>

## <a name="selecting-streams-for-parsing"></a><span data-ttu-id="0e6a3-112">Выбор потоков для синтаксического анализа</span><span class="sxs-lookup"><span data-stu-id="0e6a3-112">Selecting Streams for Parsing</span></span>

<span data-ttu-id="0e6a3-113">В процессе инициализации с помощью вызова [**имфасфсплиттер:: Initialize**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-initialize) разделитель определяет количество потоков и идентификаторов потоков в файле ASF.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-113">During the initialization process through [**IMFASFSplitter::Initialize**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-initialize) call, the splitter detects the number of streams and the stream identifiers in the ASF file.</span></span> <span data-ttu-id="0e6a3-114">По умолчанию разделитель не выбирает потоки.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-114">By default, no streams are selected by the splitter.</span></span> <span data-ttu-id="0e6a3-115">Приложение должно выбрать потоки, вызвав [**имфасфсплиттер:: селектстреамс**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-selectstreams).</span><span class="sxs-lookup"><span data-stu-id="0e6a3-115">The application must select the streams by calling [**IMFASFSplitter::SelectStreams**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-selectstreams).</span></span> <span data-ttu-id="0e6a3-116">Этот метод принимает массив номеров потоков.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-116">This method takes an array of stream numbers.</span></span> <span data-ttu-id="0e6a3-117">Чтобы получить номер потока для потока, вызовите [**имфасфпрофиле::-Stream**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-getstream) в профиле ASF или вызовите [**Имфстреамдескриптор:: жетстреамидентифиер**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getstreamidentifier) в дескрипторе потока.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-117">To get the stream number for a stream, call [**IMFASFProfile::GetStream**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-getstream) on the ASF profile or call [**IMFStreamDescriptor::GetStreamIdentifier**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getstreamidentifier) on the stream descriptor.</span></span> <span data-ttu-id="0e6a3-118">(Как профиль ASF, так и дескриптор потока можно получить из объекта Контентинфо.) Если клиент передает номер потока, который не распознается разделителем, он завершается ошибкой **MF \_ E \_ инвалидстреамнумбер** .</span><span class="sxs-lookup"><span data-stu-id="0e6a3-118">(You can obtain both the ASF profile and the stream descriptor from the ContentInfo object.) If the client passes a stream number that is not recognized by the splitter, it fails with a **MF\_E\_INVALIDSTREAMNUMBER** error.</span></span>

<span data-ttu-id="0e6a3-119">При вызове [**селектстреамс**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-selectstreams) очищается предыдущий выбор.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-119">Calling [**SelectStreams**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-selectstreams) clears the previous selections.</span></span> <span data-ttu-id="0e6a3-120">Любой поток, не указанный в массиве, не выбран.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-120">Any stream that is not specified in the array is not selected.</span></span> <span data-ttu-id="0e6a3-121">Чтобы получить список потоков, выбранных в данный момент, вызовите метод [**имфасфсплиттер:: жетселектедстреамс**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-getselectedstreams).</span><span class="sxs-lookup"><span data-stu-id="0e6a3-121">To get a list of streams that are currently selected, call [**IMFASFSplitter::GetSelectedStreams**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-getselectedstreams).</span></span> <span data-ttu-id="0e6a3-122">Этот метод принимает указатель на массив, который метод заполняет номерами потоков.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-122">This method takes a pointer to an array, which the method fills with the stream numbers.</span></span> <span data-ttu-id="0e6a3-123">Если размер массива меньше числа выбранных потоков, метод завершается с ошибкой **MF \_ E \_ буффертусмалл** .</span><span class="sxs-lookup"><span data-stu-id="0e6a3-123">If the array size is less than the number of selected streams, the method fails with the **MF\_E\_BUFFERTOOSMALL** error.</span></span> <span data-ttu-id="0e6a3-124">В этом случае метод возвращает число выбранных потоков в параметре *пвнумстреамс* .</span><span class="sxs-lookup"><span data-stu-id="0e6a3-124">In this case, the method returns the number of selected streams in the *pwNumStreams* parameter.</span></span> <span data-ttu-id="0e6a3-125">Затем это число можно использовать для выделения массива правильного размера и повторного вызова метода.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-125">You can then use this number to allocate an array of the correct size and call the method again.</span></span>

<span data-ttu-id="0e6a3-126">Пример кода см. в разделе «Выбор потока для синтаксического анализа» раздела [учебник. чтение файла ASF](tutorial--reading-an-asf-file.md).</span><span class="sxs-lookup"><span data-stu-id="0e6a3-126">For example code, see "Select a Stream for Parsing" in [Tutorial: Reading an ASF File](tutorial--reading-an-asf-file.md).</span></span>

## <a name="reverse-playback-setting"></a><span data-ttu-id="0e6a3-127">Параметр отмены воспроизведения</span><span class="sxs-lookup"><span data-stu-id="0e6a3-127">Reverse Playback Setting</span></span>

<span data-ttu-id="0e6a3-128">В процессе инициализации разделителя определяется, поддерживает ли содержимое ASF обратную воспроизведение.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-128">During the initialization process of the splitter, it determines if the ASF content supports reverse playback.</span></span> <span data-ttu-id="0e6a3-129">Если это так, разделитель можно настроить для создания выборок в обратный порядок, установив флаг **мфасф \_ разделителя \_** .</span><span class="sxs-lookup"><span data-stu-id="0e6a3-129">If it does, the splitter can be configured to generate samples in reverse order by setting the **MFASF\_SPLITTER\_REVERSE** flag.</span></span> <span data-ttu-id="0e6a3-130">Если содержимое не поддерживает обратную воспроизведение, [**имфасфсплиттер:: сетфлагс**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-setflags) возвращает **MF \_ E \_ инвалидрекуест**, но для разделителя задан флаг.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-130">If the content does not support reverse playback, the [**IMFASFSplitter::SetFlags**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-setflags) returns **MF\_E\_INVALIDREQUEST**, but the flag is set on the splitter.</span></span>

<span data-ttu-id="0e6a3-131">Если разделитель настроен для синтаксического анализа в обратном направлении, разделитель всегда начинает анализ в конце буфера, содержащего объект данных ASF.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-131">If the splitter is configured to parse in the reverse direction, then the splitter always starts parsing at the end of the buffer that contains the ASF Data Object.</span></span> <span data-ttu-id="0e6a3-132">Таким образом, для отмены синтаксического анализа смещение данных и длина анализируемых данных должны быть заданы соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-132">Therefore, for reverse parsing the data offset and the length of the data to parse must be set appropriately.</span></span> <span data-ttu-id="0e6a3-133">Сведения о задании правильных значений см. [в разделе Создание образцов потоков из существующего объекта данных ASF](generating-stream-samples-from-an-existing-asf-data-object.md).</span><span class="sxs-lookup"><span data-stu-id="0e6a3-133">For information about setting the correct values, see [Generating Stream Samples from an Existing ASF Data Object](generating-stream-samples-from-an-existing-asf-data-object.md).</span></span>

## <a name="protected-content-setting"></a><span data-ttu-id="0e6a3-134">Параметр защищенного содержимого</span><span class="sxs-lookup"><span data-stu-id="0e6a3-134">Protected Content Setting</span></span>

<span data-ttu-id="0e6a3-135">Разделитель можно настроить для работы с содержимым шифрования на уровне пакетов, установив **мфасф \_ разделитель \_ WMDRM** через [**имфасфсплиттер:: сетфлагс**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-setflags).</span><span class="sxs-lookup"><span data-stu-id="0e6a3-135">The splitter can be configured to work with packet-level encryption content by setting the **MFASF\_SPLITTER\_WMDRM** through [**IMFASFSplitter::SetFlags**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-setflags).</span></span> <span data-ttu-id="0e6a3-136">Это указывает разделителю предоставлять образцы содержимого, защищенного цифровыми Rights Managementми Windows Media (DRM).</span><span class="sxs-lookup"><span data-stu-id="0e6a3-136">This instructs the splitter to deliver samples for content that is protected by Windows Media Digital Rights Management (DRM).</span></span> <span data-ttu-id="0e6a3-137">Если этот флаг установлен, образцы, формируемые разделителем, содержат сведения, необходимые для расшифровки данных мультимедиа и воссоздания этих кадров, например атрибут [**мфсампликстенсион \_ паккеткроссоффсетс**](mfsampleextension-packetcrossoffsets-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="0e6a3-137">When this flag is set, the samples generated by the splitter contain information required to decrypt media data and reconstruct the frames, such as the [**MFSampleExtension\_PacketCrossOffsets**](mfsampleextension-packetcrossoffsets-attribute.md) attribute.</span></span> <span data-ttu-id="0e6a3-138">Этот атрибут представляет собой большой двоичный объект, содержащий массив **DWORD** s.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-138">This attribute is a blob that contains an array of **DWORD** s.</span></span> <span data-ttu-id="0e6a3-139">Каждый **DWORD** предоставляет границы полезных данных для кадра относительно начала кадра.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-139">Each **DWORD** provides you the payload boundaries for the frame relative to the beginning of the frame.</span></span> <span data-ttu-id="0e6a3-140">Если этот атрибут отсутствует, кадр содержится в одной полезной нагрузке.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-140">If this attribute is not present, the frame is contained in a single payload.</span></span> <span data-ttu-id="0e6a3-141">Как правило, образцы, формируемые разделителем, содержат несколько буферов мультимедиа, поэтому приложение может скопировать все буферы в один непрерывный буфер путем вызова [**имфсампле:: конверттоконтигуаусбуффер**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-converttocontiguousbuffer).</span><span class="sxs-lookup"><span data-stu-id="0e6a3-141">Typically, the samples generated by the splitter contain multiple media buffers, the application can copy all the buffers into one contiguous buffer by calling [**IMFSample::ConvertToContiguousBuffer**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-converttocontiguousbuffer).</span></span> <span data-ttu-id="0e6a3-142">Результирующий буфер содержит кадр, а значение атрибута содержит смещения в этом буфере.</span><span class="sxs-lookup"><span data-stu-id="0e6a3-142">The resulting buffer contains the frame and the attribute value contains offsets into this buffer.</span></span>

## <a name="related-topics"></a><span data-ttu-id="0e6a3-143">См. также</span><span class="sxs-lookup"><span data-stu-id="0e6a3-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="0e6a3-144">Разделитель ASF</span><span class="sxs-lookup"><span data-stu-id="0e6a3-144">ASF Splitter</span></span>](asf-splitter.md)
</dt> </dl>

 

 



