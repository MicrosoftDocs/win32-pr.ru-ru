---
description: В этом разделе приводятся некоторые рекомендации по реализации декодера или кодировщика в качестве Media Foundation преобразования (MFT).
ms.assetid: b15bda0a-0fdd-4601-975d-a71c47c974bf
title: Реализация MFT кодека
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4412db23747e9a6b3468e9e428120d099b2445ff
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104272508"
---
# <a name="implementing-a-codec-mft"></a>Реализация MFT кодека

В этом разделе приводятся некоторые рекомендации по реализации декодера или кодировщика в качестве Media Foundation преобразования (MFT).

-   [Кодировщики](#encoders)
    -   [Согласование формата кодировщика](#encoder-format-negotiation)
-   [Декодеров](#decoders)
    -   [Декодеры только для кодирования](#transcode-only-decoders)
    -   [Атрибуты чересстрочности](#telecine-attributes)
-   [См. также](#related-topics)

## <a name="encoders"></a>Кодировщики

### <a name="encoder-format-negotiation"></a>Согласование формата кодировщика

Для инициализации кодировщика используется следующая процедура:

1.  Запросите таблицу MFT для интерфейса [**икодекапи**](/windows/win32/api/strmif/nn-strmif-icodecapi) .
2.  Вызовите метод [**икодекапи:: SetValue**](/windows/win32/api/strmif/nf-strmif-icodecapi-setvalue) , чтобы задать свойства кодировки.
3.  Вызовите метод [**имфтрансформ:: сетаутпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) , чтобы задать формат кодирования.
4.  Вызовите метод [**имфтрансформ:: жетинпутаваилаблетипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) , чтобы получить список совместимых входных типов. (Этот шаг можно пропустить.)
5.  Вызовите метод [**имфтрансформ:: сетинпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) , чтобы задать несжатый входной формат.

После того как тип выходных данных задан на шаге 3, метод [**жетинпутаваилаблетипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) должен возвращать список входных типов, совместимых с текущим типом выходных данных. Иными словами, все типы, возвращаемые функцией **жетинпутаваилаблетипе** в этой точке, должны быть допустимыми для [**сетинпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype).

Для декодеров порядок, в котором устанавливаются типы, изменяется на обратный: сначала устанавливается тип входных данных, а затем тип выходных данных. После установки входного типа метод [**имфтрансформ:: жетаутпутаваилаблетипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) должен возвращать список типов, которые могут быть переданы в метод [**Имфтрансформ:: сетаутпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) .

Кодировщики и декодеры должны поддерживать NV12 как распространенный несжатый формат. Это гарантирует, что компоненты конвейера могут взаимодействовать с минимальными колорспаце преобразованиями. Конечно же, также поддерживаются и другие форматы.

## <a name="decoders"></a>Декодеров

### <a name="transcode-only-decoders"></a>Transcode-Only декодеры

Некоторые декодеры оптимизированы для перекодирования (декодирования и повторного кодирования потока) и не подходят для использования во время воспроизведения.

Если таблица MFT декодера предназначена только для перекодировки, установите **флаг \_ перечисления MFT Enum \_ \_ \_ только** при регистрации MFT. (См. [**мфтрегистер**](/windows/desktop/api/mfapi/nf-mfapi-mftregister).)

По умолчанию декодированные декодеры не возвращаются функцией [**мфтенумекс**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) . Чтобы перечислить декодеры перекодировки, вызовите **мфтенумекс** и установите флаг перечисления MFT "флаг" **\_ \_ \_ \_ только** в параметре *flags* . При использовании в функции **мфтенумекс** этот флаг перечисляет как декодеры кодирования, так и другие декодеры.



| **\_ Перечисление \_ флагов \_ \_ перечисления MFT** мфтрегистер | **\_ Перечисление \_ флагов \_ \_ перечисления MFT** мфтенумекс | Перечислен ли MFT? |
|--------------------------------------------------|------------------------------------------------|--------------------|
| 1                                                | 1                                              | Да                |
| 1                                                | 0                                              | Нет                 |
| 0                                                | 1                                              | Да                |
| 0                                                | 0                                              | Да                |



 

### <a name="telecine-attributes"></a>Атрибуты чересстрочности

Источник мультимедиа может присоединить следующие атрибуты чересстрочности к примерам мультимедиа, которые он доставляет.



| attribute                                                                                   | Описание                                    |
|---------------------------------------------------------------------------------------------|------------------------------------------------|
| [**Мфсампликстенсион \_ репеатфирстфиелд**](mfsampleextension-repeatfirstfield-attribute.md) | Эквивалентно флагу "повторить первое поле" (РФФ). |
| [**Мфсампликстенсион \_ боттомфиелдфирст**](mfsampleextension-bottomfieldfirst-attribute.md) | Обратный флаг "первое поле" (ТФФ).       |



 

Эти флаги предоставляют подсказку расширенному обработчику видео (Евр) при выполнении дечередования. Декодер должен распространять эти флаги в нисходящем порядке, копируя их в выходные образцы, чтобы они достигли Евр.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Запись пользовательского MFT](writing-a-custom-mft.md)
</dt> </dl>

 

 
