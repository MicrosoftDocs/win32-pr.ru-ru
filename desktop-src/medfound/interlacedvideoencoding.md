---
description: Кодирование видео с чередованием
ms.assetid: 7695d4e3-4a75-4972-ab02-bc532d6a4dce
title: Кодирование видео с чередованием (Microsoft Media Foundation)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fafacb56f29964e81b040c59cdb75d8ebb35830b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103999350"
---
# <a name="interlaced-video-encoding-microsoft-media-foundation"></a><span data-ttu-id="c023d-103">Кодирование видео с чередованием (Microsoft Media Foundation)</span><span class="sxs-lookup"><span data-stu-id="c023d-103">Interlaced Video Encoding (Microsoft Media Foundation)</span></span>

<span data-ttu-id="c023d-104">Данные видео, предназначенные для использования с компьютерами, обычно *прогрессивны*, то есть каждый кадр кодируется как единое изображение.</span><span class="sxs-lookup"><span data-stu-id="c023d-104">Video data intended for use with computers is typically *progressive*, meaning that each frame is encoded as a single image.</span></span> <span data-ttu-id="c023d-105">Некоторые устройства, например телевизоры, не отображают кадры одновременно, но как два изображения.</span><span class="sxs-lookup"><span data-stu-id="c023d-105">Some devices, like televisions, do not display a frame all at once, but as two images.</span></span> <span data-ttu-id="c023d-106">Одно из изображений или полей содержит все четное число строк.</span><span class="sxs-lookup"><span data-stu-id="c023d-106">One of the images, or fields, contains all of the even numbered rows.</span></span> <span data-ttu-id="c023d-107">Другое поле содержит данные для всех нечетных строк.</span><span class="sxs-lookup"><span data-stu-id="c023d-107">The other field contains the data for all of the odd numbered rows.</span></span> <span data-ttu-id="c023d-108">Видео, закодированное с помощью нескольких полей на кадр, называется чередованием, так как оно отображается путем переключения между четным и нечетным полем.</span><span class="sxs-lookup"><span data-stu-id="c023d-108">Video encoded with more than one field per frame is called interlaced, because it is rendered by switching between the even field and the odd field.</span></span>

<span data-ttu-id="c023d-109">В прошлом чередующиеся видеоматериалы всегда переходились без чередования перед кодированием с помощью видеокодека Windows Media.</span><span class="sxs-lookup"><span data-stu-id="c023d-109">In the past, interlaced video content was always de-interlaced before encoding with the Windows Media Video codec.</span></span> <span data-ttu-id="c023d-110">Однако начиная с серии Windows Media 9, кодировщик видео поддерживает сжатие содержимого с чередованием без предварительного преобразования его в прогрессивное.</span><span class="sxs-lookup"><span data-stu-id="c023d-110">Beginning with Windows Media 9 Series, however, the video encoder supports compression of interlaced content without first converting it to progressive.</span></span> <span data-ttu-id="c023d-111">Сохранение чередования в закодированном файле важно, если содержимое отображается в виде чередования, например телевизора.</span><span class="sxs-lookup"><span data-stu-id="c023d-111">Maintaining interlacing in an encoded file is important if the content is ever rendered on an interlaced display, such as a television.</span></span> <span data-ttu-id="c023d-112">Эта функция имеет более высокую важность, так как поддержка распространения содержимого на основе Windows Media для проигрывателей DVD, приставок и других бытовой электроники.</span><span class="sxs-lookup"><span data-stu-id="c023d-112">This feature is of increasing importance, as support for Windows Media-based content spreads to DVD players, set-top boxes, and other home electronics.</span></span>

<span data-ttu-id="c023d-113">Самый простой способ кодирования и доставки видео с чередованием — разработка приложения с помощью пакета SDK Windows Media Format и сохранение содержимого в ASF-файлах.</span><span class="sxs-lookup"><span data-stu-id="c023d-113">The easiest way to encode and deliver interlaced video is to develop your application using the Windows Media Format SDK and storing the content in ASF files.</span></span> <span data-ttu-id="c023d-114">Чередующиеся сведения о кадрах передаются в кодек с помощью модулей обработки данных, что хорошо подходит для содержимого ASF, но в других контейнерах это немного сложнее.</span><span class="sxs-lookup"><span data-stu-id="c023d-114">The interlaced information about frames is passed to the codec using data unit extensions, which work well for ASF content, but are a little trickier to support in other containers.</span></span> <span data-ttu-id="c023d-115">Дополнительные сведения о модулях обработки данных см. [в разделе Использование расширений модулей данных](usingdataunitextensions.md).</span><span class="sxs-lookup"><span data-stu-id="c023d-115">For more information about data unit extensions, see [Using Data Unit Extensions](usingdataunitextensions.md).</span></span>

<span data-ttu-id="c023d-116">Для поддержки чередования кодирование включает в себя два основных шага: получение сведений о кадре кодировщику и предоставление информации в приложении для отрисовки.</span><span class="sxs-lookup"><span data-stu-id="c023d-116">To support interlaced encoding involves two major steps: getting the frame information to the encoder, and delivering the information to the rendering application.</span></span> <span data-ttu-id="c023d-117">Эти действия описаны в следующих абзацах.</span><span class="sxs-lookup"><span data-stu-id="c023d-117">These steps are described in the following paragraphs.</span></span>

## <a name="interlaced-video-and-the-encoder"></a><span data-ttu-id="c023d-118">Чередование видео и кодировщика</span><span class="sxs-lookup"><span data-stu-id="c023d-118">Interlaced Video and the Encoder</span></span>

<span data-ttu-id="c023d-119">Первым шагом в кодировании видео с сохраненным чередованием является Настройка кодировщика для кодирования полей с чередованием.</span><span class="sxs-lookup"><span data-stu-id="c023d-119">The first step in encoding video with maintained interlacing is to configure the encoder to encode interlaced fields.</span></span> <span data-ttu-id="c023d-120">Для этого задайте для свойства [мфпкэй \_ Интерлацедкодинженаблед](mfpkey-interlacedcodingenabledproperty.md) значение **true**.</span><span class="sxs-lookup"><span data-stu-id="c023d-120">To do this, set the [MFPKEY\_INTERLACEDCODINGENABLED](mfpkey-interlacedcodingenabledproperty.md) property to **TRUE**.</span></span> <span data-ttu-id="c023d-121">Это подготавливает кодировщик для получения образцов с чередованием.</span><span class="sxs-lookup"><span data-stu-id="c023d-121">This prepares the encoder to receive interlaced samples.</span></span> <span data-ttu-id="c023d-122">Каждый входной образец должен содержать оба поля.</span><span class="sxs-lookup"><span data-stu-id="c023d-122">Each input sample must contain both fields.</span></span>

<span data-ttu-id="c023d-123">Каждый пример, который обрабатывается с помощью кодировщика после активации чередования кодирования, должен иметь вложенное расширение модуля данных.</span><span class="sxs-lookup"><span data-stu-id="c023d-123">Each sample that you process with the encoder after activating interlaced encoding should have a data unit extension attached.</span></span> <span data-ttu-id="c023d-124">Предполагается, что примеры без ожидаемого расширения модулей данных будут прогрессивными.</span><span class="sxs-lookup"><span data-stu-id="c023d-124">Samples without the expected data unit extension are assumed to be progressive.</span></span> <span data-ttu-id="c023d-125">Идентификатор GUID, определяющий расширение, — D590DC20-07BC-436C-9CF7-F3BBFBF1A4DC.</span><span class="sxs-lookup"><span data-stu-id="c023d-125">The GUID identifying the extension is D590DC20-07BC-436C-9CF7-F3BBFBF1A4DC.</span></span> <span data-ttu-id="c023d-126">Значения, передаваемые объектами пакета SDK Windows Media Format, определены в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="c023d-126">The values passed by the objects of the Windows Media Format SDK are defined in the following table.</span></span>



| <span data-ttu-id="c023d-127">Значение</span><span class="sxs-lookup"><span data-stu-id="c023d-127">Value</span></span>      | <span data-ttu-id="c023d-128">Описание</span><span class="sxs-lookup"><span data-stu-id="c023d-128">Description</span></span>                                                                                                                              |
|------------|------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="c023d-129">0x00000020</span><span class="sxs-lookup"><span data-stu-id="c023d-129">0x00000020</span></span> | <span data-ttu-id="c023d-130">Указывает, что образец кодируется в нижнем поле первым.</span><span class="sxs-lookup"><span data-stu-id="c023d-130">Specifies that the sample is encoded with the bottom field first.</span></span> <span data-ttu-id="c023d-131">Это значение имеет смысл только в сочетании с чередованием значений.</span><span class="sxs-lookup"><span data-stu-id="c023d-131">This value is only meaningful when combined with the interlaced value.</span></span> |
| <span data-ttu-id="c023d-132">0x00000040</span><span class="sxs-lookup"><span data-stu-id="c023d-132">0x00000040</span></span> | <span data-ttu-id="c023d-133">Указывает, что образец сначала кодируется в верхнее поле.</span><span class="sxs-lookup"><span data-stu-id="c023d-133">Specifies that the sample is encoded with the top field first.</span></span> <span data-ttu-id="c023d-134">Это значение имеет смысл только в сочетании с чередованием значений.</span><span class="sxs-lookup"><span data-stu-id="c023d-134">This value is only meaningful when combined with the interlaced value.</span></span>    |
| <span data-ttu-id="c023d-135">0x00000080</span><span class="sxs-lookup"><span data-stu-id="c023d-135">0x00000080</span></span> | <span data-ttu-id="c023d-136">Указывает, что образец является чередованием.</span><span class="sxs-lookup"><span data-stu-id="c023d-136">Specifies that the sample is interlaced.</span></span> <span data-ttu-id="c023d-137">Это единственное значение, которое является значимым для кодека дмос.</span><span class="sxs-lookup"><span data-stu-id="c023d-137">This is the only value that is meaningful to the codec DMOs.</span></span>                                    |



 

<span data-ttu-id="c023d-138">Одно из первых двух значений всегда объединяется с 0x80 с помощью побитовой операции **или** до установки в образце.</span><span class="sxs-lookup"><span data-stu-id="c023d-138">One of the first two values is always combined with 0x80 using a bitwise **OR** before being set on the sample.</span></span> <span data-ttu-id="c023d-139">Однако кодировщик проверяет только 0x80 и не учитывает остальную часть расширения.</span><span class="sxs-lookup"><span data-stu-id="c023d-139">However, the encoder only checks for 0x80 and disregards the rest of the extension.</span></span> <span data-ttu-id="c023d-140">Если расширение определяет пример с чередованием, кодировщик сохраняет пример чередования в сжатом потоке и внедряет в поток флаг индикации, чтобы декодер мог идентифицировать кадры с чередованием.</span><span class="sxs-lookup"><span data-stu-id="c023d-140">If the extension identifies the sample as interlaced, the encoder maintains the sample interlacing in the compressed stream, and embeds an indication flag in the stream so that the decoder can identify interlaced frames.</span></span> <span data-ttu-id="c023d-141">Каждый чередующийся образец помечен, чтобы исходное содержимое, которое является сочетанием прогрессивного и чередования, можно было кодировать в поток вместе.</span><span class="sxs-lookup"><span data-stu-id="c023d-141">Each interlaced sample is marked, so that source content that is a mix of progressive and interlaced can be encoded into a stream together.</span></span>

<span data-ttu-id="c023d-142">Объект модуля записи SDK формата Windows Media содержит расширения единиц измерения содержимого в примерах, которые записываются в раздел данных контейнера ASF для использования во время отрисовки.</span><span class="sxs-lookup"><span data-stu-id="c023d-142">The Windows Media Format SDK writer object includes the content type data unit extensions in the samples that it writes to the data section of the ASF container for use at the time of rendering.</span></span>

## <a name="reading-and-rendering-interlaced-video"></a><span data-ttu-id="c023d-143">Чтение и визуализация видео с чередованием</span><span class="sxs-lookup"><span data-stu-id="c023d-143">Reading and Rendering Interlaced Video</span></span>

<span data-ttu-id="c023d-144">Декодер определяет чередующиеся примеры на основе флага, установленного в потоке кодировщиком.</span><span class="sxs-lookup"><span data-stu-id="c023d-144">The decoder identifies interlaced samples based on the flag set in the stream by the encoder.</span></span> <span data-ttu-id="c023d-145">По умолчанию декодер выполняет чередование образцов и обеспечивает последовательные выходные данные.</span><span class="sxs-lookup"><span data-stu-id="c023d-145">As a default, the decoder deinterlaces the samples and delivers progressive outputs.</span></span> <span data-ttu-id="c023d-146">Приложение проигрывателя может настроить декодер для обработки выходных данных с помощью чередования, установив свойство [ \_ \_ дечередования декодера мфпкэй](mfpkey-decoder-deinterlacingproperty.md) .</span><span class="sxs-lookup"><span data-stu-id="c023d-146">The player application can configure the decoder to process outputs with interlacing maintained by setting the [MFPKEY\_DECODER\_DEINTERLACING](mfpkey-decoder-deinterlacingproperty.md) property.</span></span>

<span data-ttu-id="c023d-147">Сложность воспроизведения видео с чередованием возникает после того, как декодер доставляет образцы.</span><span class="sxs-lookup"><span data-stu-id="c023d-147">The difficulty in interlaced video playback arises after the decoder delivers the samples.</span></span> <span data-ttu-id="c023d-148">Модуль подготовки отчетов (видеоадаптер или микросхема устройства) не может правильно отобразить видеосодержимое, не зная, какое именно поле.</span><span class="sxs-lookup"><span data-stu-id="c023d-148">The renderer (video card or chip in a device) cannot properly display the video content without knowing which field is which.</span></span> <span data-ttu-id="c023d-149">В приложениях, использующих пакет SDK для формата Windows Media, расширение единицы данных типа содержимого извлекается из несжатых образцов и может быть передано на устройство.</span><span class="sxs-lookup"><span data-stu-id="c023d-149">In applications using the Windows Media Format SDK, the content type data unit extension is retrieved from the uncompressed samples, and can be passed to the device.</span></span>

<span data-ttu-id="c023d-150">При непосредственном использовании объектов кодека ни один из этих данных не является автоматическим.</span><span class="sxs-lookup"><span data-stu-id="c023d-150">When using the codec objects directly, none of this data transfer is automatic.</span></span> <span data-ttu-id="c023d-151">Необходимо реализовать поддержку модулей обработки данных как в объектах буфера, так и в контейнере, который используется для закодированного содержимого.</span><span class="sxs-lookup"><span data-stu-id="c023d-151">You must implement data-unit-extension support, both in your buffer objects and in the container that you use for your encoded content.</span></span> <span data-ttu-id="c023d-152">Наиболее распространенные типы контейнеров мультимедиа (например, AVI) не поддерживают метаданные уровня образца.</span><span class="sxs-lookup"><span data-stu-id="c023d-152">Most common types of media containers (like AVI) do not support sample-level metadata.</span></span> <span data-ttu-id="c023d-153">Вы можете реализовать собственную систему для хранения данных в файле и связать ее с отдельными примерами, но только настраиваемый читатель сможет получить его.</span><span class="sxs-lookup"><span data-stu-id="c023d-153">You can implement your own system to store the data in the file and associate it with individual samples, but only a customized reader would be able to retrieve it.</span></span>

> [!Note]  
> <span data-ttu-id="c023d-154">Если задать для свойства [мфпкэй \_ Интерлацедкодинженаблед](mfpkey-interlacedcodingenabledproperty.md) **значение true**, а затем не отправлять образцы с присоединенным расширением модуля данных Content-Type, это может привести к сбою кодировщика.</span><span class="sxs-lookup"><span data-stu-id="c023d-154">Setting the [MFPKEY\_INTERLACEDCODINGENABLED](mfpkey-interlacedcodingenabledproperty.md) property to **TRUE**, and then not sending any samples with the content-type data-unit extension attached can cause the encoder to crash.</span></span> <span data-ttu-id="c023d-155">Задайте кодировщик для чередования кодирования, только если имеются чередующиеся образцы для доставки.</span><span class="sxs-lookup"><span data-stu-id="c023d-155">Set the encoder for interlaced encoding only if you have interlaced samples to deliver.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="c023d-156">См. также</span><span class="sxs-lookup"><span data-stu-id="c023d-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c023d-157">Работа с видео</span><span class="sxs-lookup"><span data-stu-id="c023d-157">Working with Video</span></span>](workingwithvideo.md)
</dt> </dl>

 

 



