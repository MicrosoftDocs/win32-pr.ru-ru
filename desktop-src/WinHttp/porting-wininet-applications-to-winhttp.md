---
description: Службы Microsoft Windows HTTP (WinHTTP) нацелены на приложения среднего уровня и серверных серверов, которым требуется доступ к стеку клиента HTTP.
ms.assetid: 5b0cf321-8f69-4526-a628-e6ca0f9d4a58
title: Перенос приложений WinINet в WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6f64c4ecc825934d32b1d363f010bd04e1484428
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103999560"
---
# <a name="porting-wininet-applications-to-winhttp"></a><span data-ttu-id="bb807-103">Перенос приложений WinINet в WinHTTP</span><span class="sxs-lookup"><span data-stu-id="bb807-103">Porting WinINet Applications to WinHTTP</span></span>

<span data-ttu-id="bb807-104">Службы Microsoft Windows HTTP (WinHTTP) нацелены на приложения среднего уровня и серверных серверов, которым требуется доступ к стеку клиента HTTP.</span><span class="sxs-lookup"><span data-stu-id="bb807-104">Microsoft Windows HTTP Services (WinHTTP) is targeted at middle-tier and back-end server applications that require access to an HTTP client stack.</span></span> <span data-ttu-id="bb807-105">[Microsoft Windows Internet (WinInet)](winhttp-start-page.md) предоставляет стек клиента HTTP для клиентских приложений, а также доступ к протоколам протокол FTP (FTP), SOCKSv4 и gopher.</span><span class="sxs-lookup"><span data-stu-id="bb807-105">[Microsoft Windows Internet (WinINet)](winhttp-start-page.md) provides an HTTP client stack for client applications, as well as access to the File Transfer Protocol (FTP), SOCKSv4, and Gopher protocols.</span></span> <span data-ttu-id="bb807-106">Этот обзор поможет определить, будет ли использоваться перенос приложений WinINet в службы WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="bb807-106">This overview can help determine whether porting your WinINet applications to WinHTTP would be beneficial.</span></span> <span data-ttu-id="bb807-107">Он также описывает конкретные требования к преобразованию.</span><span class="sxs-lookup"><span data-stu-id="bb807-107">It also describes specific conversion requirements.</span></span>

-   [<span data-ttu-id="bb807-108">Вопросы, которые следует учитывать перед переносом приложения WinINet</span><span class="sxs-lookup"><span data-stu-id="bb807-108">Things to Consider Before Porting Your WinINet Application</span></span>](#things-to-consider-before-porting-your-wininet-application)
-   [<span data-ttu-id="bb807-109">Эквиваленты WinHTTP для функций WinINet</span><span class="sxs-lookup"><span data-stu-id="bb807-109">WinHTTP Equivalents to WinINet Functions</span></span>](#winhttp-equivalents-to-wininet-functions)
-   [<span data-ttu-id="bb807-110">Разная Обработка асинхронных запросов</span><span class="sxs-lookup"><span data-stu-id="bb807-110">Different Handling of Asynchronous Requests</span></span>](#different-handling-of-asynchronous-requests)
-   [<span data-ttu-id="bb807-111">Различия в уведомлениях обратного вызова WinHTTP</span><span class="sxs-lookup"><span data-stu-id="bb807-111">Differences in WinHTTP Callback Notifications</span></span>](#differences-in-winhttp-callback-notifications)
-   [<span data-ttu-id="bb807-112">Различия в проверке подлинности</span><span class="sxs-lookup"><span data-stu-id="bb807-112">Authentication Differences</span></span>](#authentication-differences)
-   [<span data-ttu-id="bb807-113">Различия в защищенных транзакциях HTTP</span><span class="sxs-lookup"><span data-stu-id="bb807-113">Differences in Secure HTTP Transactions</span></span>](#differences-in-secure-http-transactions)

## <a name="things-to-consider-before-porting-your-wininet-application"></a><span data-ttu-id="bb807-114">Вопросы, которые следует учитывать перед переносом приложения WinINet</span><span class="sxs-lookup"><span data-stu-id="bb807-114">Things to Consider Before Porting Your WinINet Application</span></span>

<span data-ttu-id="bb807-115">Рассмотрите возможность переноса приложения WinINet на WinHTTP, если ваше приложение получит следующие преимущества:</span><span class="sxs-lookup"><span data-stu-id="bb807-115">Consider porting your WinINet application to WinHTTP if your application would benefit from:</span></span>

-   <span data-ttu-id="bb807-116">Серверный стек HTTP-клиента.</span><span class="sxs-lookup"><span data-stu-id="bb807-116">A server-safe HTTP client stack.</span></span>
-   <span data-ttu-id="bb807-117">Минимальное использование стека.</span><span class="sxs-lookup"><span data-stu-id="bb807-117">Minimized stack usage.</span></span>
-   <span data-ttu-id="bb807-118">Масштабируемость серверного приложения.</span><span class="sxs-lookup"><span data-stu-id="bb807-118">The scalability of a server application.</span></span>
-   <span data-ttu-id="bb807-119">Меньше зависимостей от интерфейсов API, связанных с платформой.</span><span class="sxs-lookup"><span data-stu-id="bb807-119">Fewer dependencies on platform-related APIs.</span></span>
-   <span data-ttu-id="bb807-120">Поддержка олицетворения потоков.</span><span class="sxs-lookup"><span data-stu-id="bb807-120">Support for thread impersonation.</span></span>
-   <span data-ttu-id="bb807-121">Удобный для службы стек HTTP.</span><span class="sxs-lookup"><span data-stu-id="bb807-121">A service-friendly HTTP stack.</span></span>
-   <span data-ttu-id="bb807-122">Доступ к объекту [**WinHttpRequest**](winhttprequest.md) , поддерживающему скрипт.</span><span class="sxs-lookup"><span data-stu-id="bb807-122">Access to the scriptable [**WinHttpRequest**](winhttprequest.md) object.</span></span>

<span data-ttu-id="bb807-123">Не рекомендуется переносить приложение WinINet на WinHTTP, если оно должно поддерживать одно или несколько из следующих действий:</span><span class="sxs-lookup"><span data-stu-id="bb807-123">Do not consider porting your WinINet application to WinHTTP if it must support one or more of the following:</span></span>

-   <span data-ttu-id="bb807-124">Протокол FTP или gopher из стека HTTP.</span><span class="sxs-lookup"><span data-stu-id="bb807-124">The FTP or Gopher protocol from the HTTP stack.</span></span>
-   <span data-ttu-id="bb807-125">Поддержка протокола SOCKSv4 для взаимодействия с прокси-серверами SOCKS.</span><span class="sxs-lookup"><span data-stu-id="bb807-125">Support for SOCKSv4 protocol for communicating with SOCKS proxies.</span></span>
-   <span data-ttu-id="bb807-126">Автоматические службы коммутируемого доступа.</span><span class="sxs-lookup"><span data-stu-id="bb807-126">Automatic dial-up services.</span></span>

<span data-ttu-id="bb807-127">Если вы решили перенести приложение на службу WinHTTP, в следующих разделах описывается процесс преобразования.</span><span class="sxs-lookup"><span data-stu-id="bb807-127">If you decide to port your application to WinHTTP, the following sections guide you through the conversion process.</span></span>

<span data-ttu-id="bb807-128">Чтобы получить пример приложения для WinINet и WinHTTP, Сравните пример Асинкдемо для WinINet с примером Асинкдемо для WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="bb807-128">For a sample application for both WinINet and WinHTTP, compare the AsyncDemo sample for WinINet with the AsyncDemo sample for WinHTTP.</span></span>

## <a name="winhttp-equivalents-to-wininet-functions"></a><span data-ttu-id="bb807-129">Эквиваленты WinHTTP для функций WinINet</span><span class="sxs-lookup"><span data-stu-id="bb807-129">WinHTTP Equivalents to WinINet Functions</span></span>

<span data-ttu-id="bb807-130">В следующей таблице перечислены функции WinINet, относящиеся к стеку клиента HTTP, а также эквиваленты WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="bb807-130">The following table lists WinINet functions related to the HTTP client stack together with the WinHTTP equivalents.</span></span>

<span data-ttu-id="bb807-131">Если приложению требуются функции WinINet, которых нет в списке, не переносите приложение на WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="bb807-131">If your application requires WinINet functions that are not listed, do not port your application to WinHTTP.</span></span>



| <span data-ttu-id="bb807-132">WinINet, функция</span><span class="sxs-lookup"><span data-stu-id="bb807-132">WinINet function</span></span>                                                       | <span data-ttu-id="bb807-133">Эквивалент WinHTTP</span><span class="sxs-lookup"><span data-stu-id="bb807-133">WinHTTP equivalent</span></span>                                                                                                                                                                                     | <span data-ttu-id="bb807-134">Важные изменения</span><span class="sxs-lookup"><span data-stu-id="bb807-134">Notable changes</span></span>                                                                                                                                                                                                                                                                                                                      |
|------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="bb807-135">**хттпаддрекуессеадерс**</span><span class="sxs-lookup"><span data-stu-id="bb807-135">**HttpAddRequestHeaders**</span></span>](/windows/desktop/api/wininet/nf-wininet-httpaddrequestheadersa)             | [<span data-ttu-id="bb807-136">**винхттпаддрекуессеадерс**</span><span class="sxs-lookup"><span data-stu-id="bb807-136">**WinHttpAddRequestHeaders**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders)                                                                                                                                           | <span data-ttu-id="bb807-137">Нет.</span><span class="sxs-lookup"><span data-stu-id="bb807-137">None.</span></span>                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="bb807-138">**хттпендрекуест**</span><span class="sxs-lookup"><span data-stu-id="bb807-138">**HttpEndRequest**</span></span>](/windows/desktop/api/wininet/nf-wininet-httpendrequesta)                           | [<span data-ttu-id="bb807-139">**WinHttpReceiveResponse**</span><span class="sxs-lookup"><span data-stu-id="bb807-139">**WinHttpReceiveResponse**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse)                                                                                                                                               | <span data-ttu-id="bb807-140">Значение контекста задается с помощью [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) или [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="bb807-140">The context value is set with [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) or [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span> <span data-ttu-id="bb807-141">Параметры запроса задаются с помощью [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span><span class="sxs-lookup"><span data-stu-id="bb807-141">Request options are set with [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span></span> <span data-ttu-id="bb807-142">[**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) должен вызываться после отправки запроса.</span><span class="sxs-lookup"><span data-stu-id="bb807-142">[**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) must be called after sending a request.</span></span>                      |
| [<span data-ttu-id="bb807-143">**хттпопенрекуест**</span><span class="sxs-lookup"><span data-stu-id="bb807-143">**HttpOpenRequest**</span></span>](/windows/desktop/api/wininet/nf-wininet-httpopenrequesta)                         | [<span data-ttu-id="bb807-144">**WinHttpOpenRequest**</span><span class="sxs-lookup"><span data-stu-id="bb807-144">**WinHttpOpenRequest**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest)                                                                                                                                                       | <span data-ttu-id="bb807-145">Значение контекста задается с помощью [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) или [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="bb807-145">The context value is set with [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) or [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span>                                                                                                                                                                                                      |
| [<span data-ttu-id="bb807-146">**хттпкуеринфо**</span><span class="sxs-lookup"><span data-stu-id="bb807-146">**HttpQueryInfo**</span></span>](/windows/desktop/api/wininet/nf-wininet-httpqueryinfoa)                             | [<span data-ttu-id="bb807-147">**WinHttpQueryHeaders**</span><span class="sxs-lookup"><span data-stu-id="bb807-147">**WinHttpQueryHeaders**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryheaders)                                                                                                                                                     | <span data-ttu-id="bb807-148">Нет.</span><span class="sxs-lookup"><span data-stu-id="bb807-148">None.</span></span>                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="bb807-149">**хттпсендрекуест**</span><span class="sxs-lookup"><span data-stu-id="bb807-149">**HttpSendRequest**</span></span>](/windows/desktop/api/wininet/nf-wininet-httpsendrequesta)                         | [<span data-ttu-id="bb807-150">**WinHttpSendRequest**</span><span class="sxs-lookup"><span data-stu-id="bb807-150">**WinHttpSendRequest**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest)                                                                                                                                                       | <span data-ttu-id="bb807-151">Значение контекста можно задать с помощью [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest).</span><span class="sxs-lookup"><span data-stu-id="bb807-151">The context value can be set with [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest).</span></span>                                                                                                                                                                                                                                                  |
| [<span data-ttu-id="bb807-152">**хттпсендрекуестекс**</span><span class="sxs-lookup"><span data-stu-id="bb807-152">**HttpSendRequestEx**</span></span>](/windows/desktop/api/wininet/nf-wininet-httpsendrequestexa)                     | [<span data-ttu-id="bb807-153">**WinHttpSendRequest**</span><span class="sxs-lookup"><span data-stu-id="bb807-153">**WinHttpSendRequest**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest)                                                                                                                                                       | <span data-ttu-id="bb807-154">Невозможно предоставить буферы.</span><span class="sxs-lookup"><span data-stu-id="bb807-154">Buffers cannot be provided.</span></span>                                                                                                                                                                                                                                                                                                          |
| [<span data-ttu-id="bb807-155">**интернетканоникализеурл**</span><span class="sxs-lookup"><span data-stu-id="bb807-155">**InternetCanonicalizeUrl**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetcanonicalizeurla)         | <span data-ttu-id="bb807-156">Эквивалент отсутствует</span><span class="sxs-lookup"><span data-stu-id="bb807-156">No equivalent</span></span>                                                                                                                                                                                          | <span data-ttu-id="bb807-157">URL-адреса теперь помещаются в каноническую форму в [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span><span class="sxs-lookup"><span data-stu-id="bb807-157">URLs are now put in canonical form in [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span></span>                                                                                                                                                                                                                                              |
| [<span data-ttu-id="bb807-158">**интернетчеккконнектион**</span><span class="sxs-lookup"><span data-stu-id="bb807-158">**InternetCheckConnection**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetcheckconnectiona)         | <span data-ttu-id="bb807-159">Эквивалент отсутствует</span><span class="sxs-lookup"><span data-stu-id="bb807-159">No equivalent</span></span>                                                                                                                                                                                          | <span data-ttu-id="bb807-160">Не реализовано в WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="bb807-160">Not implemented in WinHTTP.</span></span>                                                                                                                                                                                                                                                                                                          |
| [<span data-ttu-id="bb807-161">**интернетклосехандле**</span><span class="sxs-lookup"><span data-stu-id="bb807-161">**InternetCloseHandle**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetclosehandle)                 | [<span data-ttu-id="bb807-162">**WinHttpCloseHandle**</span><span class="sxs-lookup"><span data-stu-id="bb807-162">**WinHttpCloseHandle**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpclosehandle)                                                                                                                                                       | <span data-ttu-id="bb807-163">Закрытие родительского дескриптора в WinHTTP не приводит к рекурсивному закрытию дочерних дескрипторов.</span><span class="sxs-lookup"><span data-stu-id="bb807-163">Closing a parent handle in WinHTTP does not recursively close child handles.</span></span>                                                                                                                                                                                                                                                         |
| [<span data-ttu-id="bb807-164">**интернеткомбинеурл**</span><span class="sxs-lookup"><span data-stu-id="bb807-164">**InternetCombineUrl**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetcombineurla)                   | <span data-ttu-id="bb807-165">Эквивалент отсутствует</span><span class="sxs-lookup"><span data-stu-id="bb807-165">No equivalent</span></span>                                                                                                                                                                                          | <span data-ttu-id="bb807-166">Для сборки URL-адресов можно использовать функцию [**винхттпкреатеурл**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpcreateurl) .</span><span class="sxs-lookup"><span data-stu-id="bb807-166">URLs can be assembled with the [**WinHttpCreateUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpcreateurl) function.</span></span>                                                                                                                                                                                                                                                |
| [<span data-ttu-id="bb807-167">**интернетконфирмзонекроссинг**</span><span class="sxs-lookup"><span data-stu-id="bb807-167">**InternetConfirmZoneCrossing**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetconfirmzonecrossing) | <span data-ttu-id="bb807-168">Эквивалент отсутствует</span><span class="sxs-lookup"><span data-stu-id="bb807-168">No equivalent</span></span>                                                                                                                                                                                          | <span data-ttu-id="bb807-169">Не реализовано в WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="bb807-169">Not implemented in WinHTTP.</span></span>                                                                                                                                                                                                                                                                                                          |
| [<span data-ttu-id="bb807-170">**интернетконнект**</span><span class="sxs-lookup"><span data-stu-id="bb807-170">**InternetConnect**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetconnecta)                         | [<span data-ttu-id="bb807-171">**винхттпконнект**</span><span class="sxs-lookup"><span data-stu-id="bb807-171">**WinHttpConnect**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect)                                                                                                                                                               | <span data-ttu-id="bb807-172">Значение контекста задается с помощью [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) или [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="bb807-172">The context value is set with [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) or [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span> <span data-ttu-id="bb807-173">Параметры запроса задаются с помощью [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span><span class="sxs-lookup"><span data-stu-id="bb807-173">Request options are set with [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span></span> <span data-ttu-id="bb807-174">Учетные данные пользователя задаются с помощью [**винхттпсеткредентиалс**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials).</span><span class="sxs-lookup"><span data-stu-id="bb807-174">User credentials are set with [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials).</span></span>                                 |
| [<span data-ttu-id="bb807-175">**интернеткраккурл**</span><span class="sxs-lookup"><span data-stu-id="bb807-175">**InternetCrackUrl**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetcrackurla)                       | [<span data-ttu-id="bb807-176">**винхттпкраккурл**</span><span class="sxs-lookup"><span data-stu-id="bb807-176">**WinHttpCrackUrl**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpcrackurl)                                                                                                                                                             | <span data-ttu-id="bb807-177">Противоположное поведение \_ флага escape-последовательности ICU: при использовании [**интернеткраккурл**](/windows/desktop/api/wininet/nf-wininet-internetcrackurla)этот флаг приводит к преобразованию escape-последовательностей (% XX) в символы, но с [**винхттпкраккурл**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpcrackurl)это приводит к тому, что символы, которые должны быть экранированы из HTTP-запроса, преобразуются в управляющие последовательности.</span><span class="sxs-lookup"><span data-stu-id="bb807-177">Opposite behavior of the ICU\_ESCAPE flag: with [**InternetCrackUrl**](/windows/desktop/api/wininet/nf-wininet-internetcrackurla), this flag causes escape sequences (%xx) to be converted to characters, but with [**WinHttpCrackUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpcrackurl), it causes characters that must be escaped from in an HTTP request to be converted to escape sequences.</span></span> |
| [<span data-ttu-id="bb807-178">**интернеткреатеурл**</span><span class="sxs-lookup"><span data-stu-id="bb807-178">**InternetCreateUrl**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetcreateurla)                     | [<span data-ttu-id="bb807-179">**винхттпкреатеурл**</span><span class="sxs-lookup"><span data-stu-id="bb807-179">**WinHttpCreateUrl**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpcreateurl)                                                                                                                                                           | <span data-ttu-id="bb807-180">Нет.</span><span class="sxs-lookup"><span data-stu-id="bb807-180">None.</span></span>                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="bb807-181">**интернетеррордлг**</span><span class="sxs-lookup"><span data-stu-id="bb807-181">**InternetErrorDlg**</span></span>](/windows/desktop/api/wininet/nf-wininet-interneterrordlg)                       | <span data-ttu-id="bb807-182">Эквивалент отсутствует</span><span class="sxs-lookup"><span data-stu-id="bb807-182">No equivalent</span></span>                                                                                                                                                                                          | <span data-ttu-id="bb807-183">Поскольку служба WinHTTP нацелена на приложения на стороне сервера, она не реализует пользовательский интерфейс.</span><span class="sxs-lookup"><span data-stu-id="bb807-183">Because WinHTTP is targeted at server-side applications, it does not implement any user interface.</span></span>                                                                                                                                                                                                                                   |
| [<span data-ttu-id="bb807-184">**интернетжеткукие**</span><span class="sxs-lookup"><span data-stu-id="bb807-184">**InternetGetCookie**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetgetcookiea)                     | <span data-ttu-id="bb807-185">Эквивалент отсутствует</span><span class="sxs-lookup"><span data-stu-id="bb807-185">No equivalent</span></span>                                                                                                                                                                                          | <span data-ttu-id="bb807-186">Служба WinHTTP не сохраняет данные между сеансами и не может получить доступ к файлам cookie WinINet.</span><span class="sxs-lookup"><span data-stu-id="bb807-186">WinHTTP does not persist data between sessions and cannot access WinINet cookies.</span></span>                                                                                                                                                                                                                                                    |
| [<span data-ttu-id="bb807-187">**интернетопен**</span><span class="sxs-lookup"><span data-stu-id="bb807-187">**InternetOpen**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetopena)                               | [<span data-ttu-id="bb807-188">**WinHttpOpen**</span><span class="sxs-lookup"><span data-stu-id="bb807-188">**WinHttpOpen**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen)                                                                                                                                                                     | <span data-ttu-id="bb807-189">Нет.</span><span class="sxs-lookup"><span data-stu-id="bb807-189">None.</span></span>                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="bb807-190">**интернетопенурл**</span><span class="sxs-lookup"><span data-stu-id="bb807-190">**InternetOpenUrl**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetopenurla)                         | <span data-ttu-id="bb807-191">[**Винхттпконнект**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect), [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest), [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest), [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse)</span><span class="sxs-lookup"><span data-stu-id="bb807-191">[**WinHttpConnect**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect), [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest), [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest), [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse)</span></span> | <span data-ttu-id="bb807-192">Эта функция доступна в перечисленных функциях WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="bb807-192">This functionality is available in the WinHTTP functions listed.</span></span>                                                                                                                                                                                                                                                                     |
| [<span data-ttu-id="bb807-193">**интернеткуеридатааваилабле**</span><span class="sxs-lookup"><span data-stu-id="bb807-193">**InternetQueryDataAvailable**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetquerydataavailable)   | [<span data-ttu-id="bb807-194">**WinHttpQueryDataAvailable**</span><span class="sxs-lookup"><span data-stu-id="bb807-194">**WinHttpQueryDataAvailable**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable)                                                                                                                                         | <span data-ttu-id="bb807-195">Нет зарезервированных параметров.</span><span class="sxs-lookup"><span data-stu-id="bb807-195">No reserved parameters.</span></span>                                                                                                                                                                                                                                                                                                              |
| [<span data-ttu-id="bb807-196">**интернеткуерйоптион**</span><span class="sxs-lookup"><span data-stu-id="bb807-196">**InternetQueryOption**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetqueryoptiona)                 | [<span data-ttu-id="bb807-197">**винхттпкуерйоптион**</span><span class="sxs-lookup"><span data-stu-id="bb807-197">**WinHttpQueryOption**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption)                                                                                                                                                       | <span data-ttu-id="bb807-198">WinHTTP предлагает другой набор параметров от WinINet.</span><span class="sxs-lookup"><span data-stu-id="bb807-198">WinHTTP offers a different set of options from WinINet.</span></span> <span data-ttu-id="bb807-199">Дополнительные сведения и параметры, предлагаемые WinHTTP, см. в разделе [**флаги параметров**](option-flags.md).</span><span class="sxs-lookup"><span data-stu-id="bb807-199">For more information and options offered by WinHTTP, see [**Option Flags**](option-flags.md).</span></span>                                                                                                                                                                               |
| [<span data-ttu-id="bb807-200">**интернетреадфиле**</span><span class="sxs-lookup"><span data-stu-id="bb807-200">**InternetReadFile**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetreadfile)                       | [<span data-ttu-id="bb807-201">**WinHttpReadData**</span><span class="sxs-lookup"><span data-stu-id="bb807-201">**WinHttpReadData**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata)                                                                                                                                                             | <span data-ttu-id="bb807-202">Нет.</span><span class="sxs-lookup"><span data-stu-id="bb807-202">None.</span></span>                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="bb807-203">**интернетреадфиликс**</span><span class="sxs-lookup"><span data-stu-id="bb807-203">**InternetReadFileEx**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetreadfileexa)                   | [<span data-ttu-id="bb807-204">**WinHttpReadData**</span><span class="sxs-lookup"><span data-stu-id="bb807-204">**WinHttpReadData**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata)                                                                                                                                                             | <span data-ttu-id="bb807-205">Вместо структуры буфер является областью памяти, адресованной указателю.</span><span class="sxs-lookup"><span data-stu-id="bb807-205">Rather than a structure, the buffer is a region of memory addressed with a pointer.</span></span>                                                                                                                                                                                                                                                  |
| [<span data-ttu-id="bb807-206">**интернетсетоптион**</span><span class="sxs-lookup"><span data-stu-id="bb807-206">**InternetSetOption**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetsetoptiona)                     | [<span data-ttu-id="bb807-207">**винхттпсетоптион**</span><span class="sxs-lookup"><span data-stu-id="bb807-207">**WinHttpSetOption**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption)                                                                                                                                                           | <span data-ttu-id="bb807-208">Нет.</span><span class="sxs-lookup"><span data-stu-id="bb807-208">None.</span></span>                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="bb807-209">**интернетсетстатускаллбакк**</span><span class="sxs-lookup"><span data-stu-id="bb807-209">**InternetSetStatusCallback**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetsetstatuscallback)     | [<span data-ttu-id="bb807-210">**WinHttpSetStatusCallback**</span><span class="sxs-lookup"><span data-stu-id="bb807-210">**WinHttpSetStatusCallback**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback)                                                                                                                                           | <span data-ttu-id="bb807-211">Дополнительные сведения см. в подразделе «различные методы обработки асинхронных запросов» этого раздела.</span><span class="sxs-lookup"><span data-stu-id="bb807-211">For more information, see "Different Handling of Asynchronous Requests" in this topic.</span></span>                                                                                                                                                                                                                                               |
| [<span data-ttu-id="bb807-212">**интернеттимефромсистемтиме**</span><span class="sxs-lookup"><span data-stu-id="bb807-212">**InternetTimeFromSystemTime**</span></span>](/windows/desktop/api/wininet/nf-wininet-internettimefromsystemtime)   | [<span data-ttu-id="bb807-213">**винхттптимефромсистемтиме**</span><span class="sxs-lookup"><span data-stu-id="bb807-213">**WinHttpTimeFromSystemTime**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttptimefromsystemtime)                                                                                                                                         | <span data-ttu-id="bb807-214">Нет.</span><span class="sxs-lookup"><span data-stu-id="bb807-214">None.</span></span>                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="bb807-215">**интернеттиметосистемтиме**</span><span class="sxs-lookup"><span data-stu-id="bb807-215">**InternetTimeToSystemTime**</span></span>](/windows/desktop/api/wininet/nf-wininet-internettimetosystemtime)       | [<span data-ttu-id="bb807-216">**винхттптиметосистемтиме**</span><span class="sxs-lookup"><span data-stu-id="bb807-216">**WinHttpTimeToSystemTime**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttptimetosystemtime)                                                                                                                                             | <span data-ttu-id="bb807-217">Нет.</span><span class="sxs-lookup"><span data-stu-id="bb807-217">None.</span></span>                                                                                                                                                                                                                                                                                                                                |
| [<span data-ttu-id="bb807-218">**интернетвритефиле**</span><span class="sxs-lookup"><span data-stu-id="bb807-218">**InternetWriteFile**</span></span>](/windows/desktop/api/wininet/nf-wininet-internetwritefile)                     | [<span data-ttu-id="bb807-219">**WinHttpWriteData**</span><span class="sxs-lookup"><span data-stu-id="bb807-219">**WinHttpWriteData**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata)                                                                                                                                                           | <span data-ttu-id="bb807-220">Нет.</span><span class="sxs-lookup"><span data-stu-id="bb807-220">None.</span></span>                                                                                                                                                                                                                                                                                                                                |



 

## <a name="different-handling-of-asynchronous-requests"></a><span data-ttu-id="bb807-221">Разная Обработка асинхронных запросов</span><span class="sxs-lookup"><span data-stu-id="bb807-221">Different Handling of Asynchronous Requests</span></span>

<span data-ttu-id="bb807-222">Имейте в виду, что в WinINet и WinHTTP некоторые функции могут выполнять асинхронные запросы синхронно или асинхронно.</span><span class="sxs-lookup"><span data-stu-id="bb807-222">Be aware that in WinINet and WinHTTP, some functions can complete asynchronous requests either synchronously or asynchronously.</span></span> <span data-ttu-id="bb807-223">Приложение должно работать в любой ситуации.</span><span class="sxs-lookup"><span data-stu-id="bb807-223">Your application must handle either situation.</span></span> <span data-ttu-id="bb807-224">Существуют значительные отличия в том, как WinINet и WinHTTP обрабатывают эти потенциально асинхронные функции.</span><span class="sxs-lookup"><span data-stu-id="bb807-224">There are significant differences in how WinINet and WinHTTP handle these potentially asynchronous functions.</span></span>

<span data-ttu-id="bb807-225">Операционной</span><span class="sxs-lookup"><span data-stu-id="bb807-225">WinINet</span></span>

-   <span data-ttu-id="bb807-226">Синхронное завершение: Если потенциально асинхронный вызов функции WinINet завершается синхронно, выходные параметры функции возвращают результаты операции.</span><span class="sxs-lookup"><span data-stu-id="bb807-226">Synchronous completion: If a potentially asynchronous WinINet function call completes synchronously, the OUT parameters of the function return the results of the operation.</span></span> <span data-ttu-id="bb807-227">При возникновении ошибки извлеките код ошибки, вызвав [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) после вызова функции WinInet.</span><span class="sxs-lookup"><span data-stu-id="bb807-227">When an error occurs, retrieve the error code by calling [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) after the WinINet function call.</span></span>

-   <span data-ttu-id="bb807-228">Асинхронное завершение: Если потенциально асинхронный вызов функции завершается асинхронно, результаты операции и любые ошибки становятся доступными в функции обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="bb807-228">Asynchronous completion: If a potentially asynchronous function call completes asynchronously, the results of the operation, and any errors, are accessible in the callback function.</span></span> <span data-ttu-id="bb807-229">Функция обратного вызова выполняется в рабочем потоке, а не в потоке, который выполнил первоначальный вызов функции.</span><span class="sxs-lookup"><span data-stu-id="bb807-229">The callback function is executed on a worker thread, not on the thread that made the initial function call.</span></span>

<span data-ttu-id="bb807-230">Иными словами, приложение должно дублировать логику для обработки результатов таких операций в двух местах: сразу после вызова функции и в функции обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="bb807-230">In other words, your application must duplicate logic to handle the results of such operations in two places: both immediately after the function call and in the callback function.</span></span>

<span data-ttu-id="bb807-231">Служба WinHTTP упрощает эту модель, позволяя реализовать операционную логику только в функции обратного вызова, которая получает уведомление о завершении независимо от того, завершилась ли операция синхронно или асинхронно.</span><span class="sxs-lookup"><span data-stu-id="bb807-231">WinHTTP simplifies this model by enabling you to implement the operational logic only in the callback function, which receives a completion notification regardless of whether the operation completed synchronously or asynchronously.</span></span> <span data-ttu-id="bb807-232">Если асинхронная операция включена, параметры OUT функций WinHTTP не возвращают значимые данные и должны иметь значение **null**.</span><span class="sxs-lookup"><span data-stu-id="bb807-232">When asynchronous operation is enabled, the OUT parameters of WinHTTP functions do not return meaningful data and must be set to **NULL**.</span></span>

<span data-ttu-id="bb807-233">Единственным существенным различием между асинхронным и синхронным завершением в WinHTTP с точки зрения приложения является место, где выполняется функция обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="bb807-233">The only significant difference between asynchronous and synchronous completion in WinHTTP, from the application perspective, is in where the callback function is executed.</span></span>

<span data-ttu-id="bb807-234">Известен</span><span class="sxs-lookup"><span data-stu-id="bb807-234">WinHTTP</span></span>

-   <span data-ttu-id="bb807-235">Синхронное завершение: когда операция завершается синхронно, результаты возвращаются в функцию обратного вызова, которая выполняется в том же потоке, что и исходный вызов функции.</span><span class="sxs-lookup"><span data-stu-id="bb807-235">Synchronous completion: When an operation completes synchronously, the results are returned in a callback function that executes in the same thread as the original function call.</span></span>

-   <span data-ttu-id="bb807-236">Асинхронное завершение: когда операция завершается асинхронно, результаты возвращаются в функции обратного вызова, которая выполняется в рабочем потоке.</span><span class="sxs-lookup"><span data-stu-id="bb807-236">Asynchronous completion: When an operation completes asynchronously, the results are returned in a callback function that executes in a worker thread.</span></span>

<span data-ttu-id="bb807-237">Несмотря на то, что большинство ошибок может обрабатываться полностью в рамках функции обратного вызова, приложения WinHTTP должны быть готовы к тому, чтобы функция возвращала **значение false** из-за ошибки \_ недопустимого \_ параметра или другой подобной ошибки, полученной при вызове [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror).</span><span class="sxs-lookup"><span data-stu-id="bb807-237">Although most errors can also be handled entirely within the callback function, WinHTTP applications must still be prepared for a function to return **FALSE** because of an ERROR\_INVALID\_PARAMETER or other similar error retrieved by calling [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror).</span></span>

<span data-ttu-id="bb807-238">В отличие от WinINet, который может выполнять несколько асинхронных операций одновременно, WinHTTP применяет политику для одной ожидающей асинхронной операции на каждый обработчик запроса.</span><span class="sxs-lookup"><span data-stu-id="bb807-238">Unlike WinINet, which can execute multiple asynchronous operations simultaneously, WinHTTP enforces a policy of one pending asynchronous operation per request handle.</span></span> <span data-ttu-id="bb807-239">Если одна операция находится в состоянии ожидания и вызывается другая функция WinHTTP, вторая функция завершается ошибкой, а [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) возвращает ошибку \_ Недопустимая \_ операция.</span><span class="sxs-lookup"><span data-stu-id="bb807-239">If one operation is pending and another WinHTTP function is called, the second function fails and [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) returns ERROR\_INVALID\_OPERATION.</span></span>

<span data-ttu-id="bb807-240">Служба WinHTTP упрощает эту модель, позволяя реализовать операционную логику только в функции обратного вызова, которая получает уведомление о завершении независимо от того, завершилась ли операция синхронно или асинхронно.</span><span class="sxs-lookup"><span data-stu-id="bb807-240">WinHTTP simplifies this model by enabling you to implement the operational logic only in the callback function, which receives a completion notification regardless of whether the operation completed synchronously or asynchronously.</span></span> <span data-ttu-id="bb807-241">Если асинхронная операция включена, параметры OUT функций WinHTTP не возвращают значимые данные и должны иметь значение **null**.</span><span class="sxs-lookup"><span data-stu-id="bb807-241">When asynchronous operation is enabled, the OUT parameters of WinHTTP functions do not return meaningful data and must be set to **NULL**.</span></span>

## <a name="differences-in-winhttp-callback-notifications"></a><span data-ttu-id="bb807-242">Различия в уведомлениях обратного вызова WinHTTP</span><span class="sxs-lookup"><span data-stu-id="bb807-242">Differences in WinHTTP Callback Notifications</span></span>

<span data-ttu-id="bb807-243">Функция обратного вызова состояния получает обновления состояния операций с помощью флагов уведомлений.</span><span class="sxs-lookup"><span data-stu-id="bb807-243">The status callback function receives updates on the status of operations through notification flags.</span></span> <span data-ttu-id="bb807-244">В WinHTTP уведомления выбираются с помощью параметра *двнотификатионфлагс* функции [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) .</span><span class="sxs-lookup"><span data-stu-id="bb807-244">In WinHTTP, notifications are selected using the *dwNotificationFlags* parameter of the [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) function.</span></span> <span data-ttu-id="bb807-245">Используйте флаг **\_ обратного вызова WinHTTP \_ \_ все \_ уведомления** , чтобы получать уведомления обо всех обновлениях состояния.</span><span class="sxs-lookup"><span data-stu-id="bb807-245">Use the **WINHTTP\_CALLBACK\_FLAG\_ALL\_NOTIFICATIONS** flag to be notified of all status updates.</span></span>

<span data-ttu-id="bb807-246">Уведомления, указывающие на завершение определенной операции, называются уведомлениями о завершении или просто завершением.</span><span class="sxs-lookup"><span data-stu-id="bb807-246">Notifications that indicate a particular operation is complete are called completion notifications, or just completions.</span></span> <span data-ttu-id="bb807-247">В WinINet каждый раз, когда функция обратного вызова получает завершение, параметр *лпвстатусинформатион* содержит [**\_ \_ результирующую структуру Internet Async**](/windows/desktop/api/wininet/ns-wininet-internet_async_result) .</span><span class="sxs-lookup"><span data-stu-id="bb807-247">In WinINet, each time the callback function receives a completion, the *lpvStatusInformation* parameter contains an [**INTERNET\_ASYNC\_RESULT**](/windows/desktop/api/wininet/ns-wininet-internet_async_result) structure.</span></span> <span data-ttu-id="bb807-248">В WinHTTP эта структура недоступна для всех завершений.</span><span class="sxs-lookup"><span data-stu-id="bb807-248">In WinHTTP, this structure is not available for all completions.</span></span> <span data-ttu-id="bb807-249">Важно ознакомиться со страницей ссылки для [**\_ \_ обратного вызова состояния WinHTTP**](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback), который содержит сведения об уведомлениях и о типе данных, которые могут быть ожидаемыми для каждого из них.</span><span class="sxs-lookup"><span data-stu-id="bb807-249">It is important to review the reference page for [**WINHTTP\_STATUS\_CALLBACK**](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback), which contains information about notifications and what type of data can be expected for each.</span></span>

<span data-ttu-id="bb807-250">В WinHTTP одна операция завершения, **\_ \_ \_ \_ Ошибка запроса состояния обратного вызова WinHTTP**, указывает на сбой операции.</span><span class="sxs-lookup"><span data-stu-id="bb807-250">In WinHTTP, a single completion, **WINHTTP\_CALLBACK\_STATUS\_REQUEST\_ERROR**, indicates that an operation failed.</span></span> <span data-ttu-id="bb807-251">Все остальные завершения указывают на успешную операцию.</span><span class="sxs-lookup"><span data-stu-id="bb807-251">All other completions indicate a successful operation.</span></span>

<span data-ttu-id="bb807-252">И WinINet, и WinHTTP используют определяемое пользователем значение контекста для передачи информации из основного потока в функцию обратного вызова состояния, которая может быть выполнена в рабочем потоке.</span><span class="sxs-lookup"><span data-stu-id="bb807-252">Both WinINet and WinHTTP use a user-defined context value to pass information from the main thread to the status callback function, which can be executed on a worker thread.</span></span> <span data-ttu-id="bb807-253">В WinINet значение контекста, используемое функцией обратного вызова состояния, задается путем вызова одной из нескольких функций.</span><span class="sxs-lookup"><span data-stu-id="bb807-253">In WinINet, the context value used by the status callback function is set by calling one of several functions.</span></span> <span data-ttu-id="bb807-254">В WinHTTP значение контекста задается только с помощью [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) или [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="bb807-254">In WinHTTP, the context value is set only with [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) or [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span> <span data-ttu-id="bb807-255">В связи с этим в WinHTTP может происходить уведомление до установки значения контекста.</span><span class="sxs-lookup"><span data-stu-id="bb807-255">Because of this, it is possible in WinHTTP for a notification to occur before a context value is set.</span></span> <span data-ttu-id="bb807-256">Если функция обратного вызова получает уведомление до установки значения контекста, приложение должно быть подготовлено к получению значения **null** в параметре *двконтекст* функции обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="bb807-256">If the callback function receives a notification before the context value is set, the application must be prepared to receive **NULL** in the *dwContext* parameter of the callback function.</span></span>

## <a name="authentication-differences"></a><span data-ttu-id="bb807-257">Различия в проверке подлинности</span><span class="sxs-lookup"><span data-stu-id="bb807-257">Authentication Differences</span></span>

<span data-ttu-id="bb807-258">В WinINet учетные данные пользователя задаются путем вызова функции [**интернетсетоптион**](/windows/desktop/api/wininet/nf-wininet-internetsetoptiona) с использованием кода, аналогичного приведенному в следующем примере кода.</span><span class="sxs-lookup"><span data-stu-id="bb807-258">In WinINet, user credentials are set by calling the [**InternetSetOption**](/windows/desktop/api/wininet/nf-wininet-internetsetoptiona) function, using code similar to that provided in the following code example.</span></span>

``` syntax
// Use the WinINet InternetSetOption function to set the 
// user credentials to the user name contained in strUsername 
// and the password to the contents of strPassword.
       
InternetSetOption( hRequest, INTERNET_OPTION_PROXY_USERNAME, 
                   strUsername, strlen(strUsername) + 1 );

InternetSetOption( hRequest, INTERNET_OPTION_PROXY_PASSWORD, 
                   strPassword, strlen(strPassword) + 1 );
```

<span data-ttu-id="bb807-259">Для совместимости учетные данные пользователя также можно задать в WinHTTP с помощью функции [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) , но это не рекомендуется, так как это может привести к уязвимости системы безопасности.</span><span class="sxs-lookup"><span data-stu-id="bb807-259">For compatibility, user credentials can similarly be set in WinHTTP using the [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) function, but this is not recommended because it can pose a security vulnerability.</span></span>

<span data-ttu-id="bb807-260">Вместо этого, когда приложение получает код состояния 401 в WinHTTP, рекомендуемый метод настройки учетных данных — сначала определить схему проверки подлинности с помощью [**винхттпкуеряуссчемес**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes) и, во-вторых, задать учетные данные с помощью [**винхттпсеткредентиалс**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials).</span><span class="sxs-lookup"><span data-stu-id="bb807-260">Instead, when an application receives a 401 status code in WinHTTP, the recommended method of setting credentials is first to identify an authentication scheme using [**WinHttpQueryAuthSchemes**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes) and, second, set the credentials using [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials).</span></span> <span data-ttu-id="bb807-261">В следующем примере кода показано, как это сделать.</span><span class="sxs-lookup"><span data-stu-id="bb807-261">The following code example shows how to do this.</span></span>

``` syntax
DWORD dwSupportedSchemes;
DWORD dwPrefered;
DWORD dwTarget;

// Obtain the supported and first schemes.
WinHttpQueryAuthSchemes( hRequest, &dwSupportedSchemes, &dwPrefered, &dwTarget );

// Set the credentials before resending the request.
WinHttpSetCredentials( hRequest, dwTarget, dwPrefered, strUsername, strPassword, NULL );
```

<span data-ttu-id="bb807-262">Так как в WinHTTP нет эквивалента [**интернетеррордлг**](/windows/desktop/api/wininet/nf-wininet-interneterrordlg) , приложения, которые получают учетные данные через пользовательский интерфейс, должны предоставлять собственный интерфейс.</span><span class="sxs-lookup"><span data-stu-id="bb807-262">Because there is no equivalent to [**InternetErrorDlg**](/windows/desktop/api/wininet/nf-wininet-interneterrordlg) in WinHTTP, applications that obtain credentials through a user interface must provide their own interface.</span></span>

<span data-ttu-id="bb807-263">В отличие от WinINet, WinHTTP не кэширует пароли.</span><span class="sxs-lookup"><span data-stu-id="bb807-263">Unlike WinINet, WinHTTP does not cache passwords.</span></span> <span data-ttu-id="bb807-264">Для каждого запроса необходимо указать действительные учетные данные пользователя.</span><span class="sxs-lookup"><span data-stu-id="bb807-264">Valid user credentials must be supplied for each request.</span></span>

<span data-ttu-id="bb807-265">Служба WinHTTP не поддерживает схему распределенных паролей с проверкой подлинности (DPA), поддерживаемую WinINet.</span><span class="sxs-lookup"><span data-stu-id="bb807-265">WinHTTP does not support the Distributed Password Authentication (DPA) scheme supported by WinINet.</span></span> <span data-ttu-id="bb807-266">Однако WinHTTP поддерживает Microsoft Passport 1,4.</span><span class="sxs-lookup"><span data-stu-id="bb807-266">WinHTTP does, however, support Microsoft Passport 1.4.</span></span> <span data-ttu-id="bb807-267">Дополнительные сведения об использовании проверки подлинности Passport в WinHTTP см. в статье Проверка подлинности [Passport в WinHTTP](passport-authentication-in-winhttp.md).</span><span class="sxs-lookup"><span data-stu-id="bb807-267">For more information about using Passport authentication in WinHTTP, see [Passport Authentication in WinHTTP](passport-authentication-in-winhttp.md).</span></span>

<span data-ttu-id="bb807-268">Служба WinHTTP не использует параметры Internet Explorer для определения политики автоматического входа в систему.</span><span class="sxs-lookup"><span data-stu-id="bb807-268">WinHTTP does not rely on Internet Explorer settings to determine the automatic logon policy.</span></span> <span data-ttu-id="bb807-269">Вместо этого для политики автоматического входа задано значение [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="bb807-269">Instead, the auto-logon policy is set with [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span> <span data-ttu-id="bb807-270">Дополнительные сведения о проверке подлинности в WinHTTP, включая политику автоматического входа, см. [в статье Проверка подлинности в WinHTTP](authentication-in-winhttp.md).</span><span class="sxs-lookup"><span data-stu-id="bb807-270">For more information about authentication in WinHTTP, including the auto-logon policy, see [Authentication in WinHTTP](authentication-in-winhttp.md).</span></span>

## <a name="differences-in-secure-http-transactions"></a><span data-ttu-id="bb807-271">Различия в защищенных транзакциях HTTP</span><span class="sxs-lookup"><span data-stu-id="bb807-271">Differences in Secure HTTP Transactions</span></span>

<span data-ttu-id="bb807-272">В WinINet запустите безопасный сеанс с помощью [**хттпопенрекуест**](/windows/desktop/api/wininet/nf-wininet-httpopenrequesta) или [**интернетконнект**](/windows/desktop/api/wininet/nf-wininet-internetconnecta), но в WinHTTP необходимо вызвать [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest) с помощью флага **\_ \_ Secure** флага WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="bb807-272">In WinINet, initiate a secure session using either [**HttpOpenRequest**](/windows/desktop/api/wininet/nf-wininet-httpopenrequesta) or [**InternetConnect**](/windows/desktop/api/wininet/nf-wininet-internetconnecta), but in WinHTTP, you must call [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest) using the **WINHTTP\_FLAG\_SECURE** flag.</span></span>

<span data-ttu-id="bb807-273">В безопасной транзакции HTTP сертификаты сервера можно использовать для проверки подлинности сервера для клиента.</span><span class="sxs-lookup"><span data-stu-id="bb807-273">In a secure HTTP transaction, server certificates can be used to authenticate a server to the client.</span></span> <span data-ttu-id="bb807-274">В WinINet, если сертификат сервера содержит ошибки, [**хттпсендрекуест**](/windows/desktop/api/wininet/nf-wininet-httpsendrequesta) завершается сбоем и предоставляет сведения об ошибках сертификата.</span><span class="sxs-lookup"><span data-stu-id="bb807-274">In WinINet, if a server certificate contains errors, [**HttpSendRequest**](/windows/desktop/api/wininet/nf-wininet-httpsendrequesta) fails and provides details about the certificate errors.</span></span>

<span data-ttu-id="bb807-275">В WinHttp ошибки сертификата сервера обрабатываются в соответствии с версией следующим образом.</span><span class="sxs-lookup"><span data-stu-id="bb807-275">In WinHttp, server certificate errors are handled according to the version as follows:</span></span>

-   <span data-ttu-id="bb807-276">Начиная с WinHttp 5,1, если сертификат сервера завершается ошибкой или содержит ошибки, вызов [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) сообщает о **\_ состоянии обратного вызова WinHTTP, \_ \_ защищенном \_** в функции обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="bb807-276">Starting with WinHttp 5.1, if a server certificate fails or contains errors, the call to [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) reports a **WINHTTP\_CALLBACK\_STATUS\_SECURE\_FAILURE** in the callback function.</span></span> <span data-ttu-id="bb807-277">Если ошибка, созданная **WinHttpSendRequest** , игнорируется, последующие вызовы [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) завершаются ошибкой, \_ когда \_ Операция WinHTTP \_ отменила ошибку.</span><span class="sxs-lookup"><span data-stu-id="bb807-277">If the error generated by **WinHttpSendRequest** is ignored, subsequent calls to [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) fail with an ERROR\_WINHTTP\_OPERATION\_CANCELLED error.</span></span>
-   <span data-ttu-id="bb807-278">В WinHTTP 5,0 ошибки в сертификатах сервера по умолчанию не вызывают ошибку запроса.</span><span class="sxs-lookup"><span data-stu-id="bb807-278">In WinHTTP 5.0, errors in server certificates do not, by default, cause a request to fail.</span></span> <span data-ttu-id="bb807-279">Вместо этого ошибки выводятся в функции обратного вызова с уведомлением о **\_ \_ \_ \_ сбое обратного вызова WinHTTP** .</span><span class="sxs-lookup"><span data-stu-id="bb807-279">Instead, the errors are reported in the callback function with the **WINHTTP\_CALLBACK\_STATUS\_SECURE\_FAILURE** notification.</span></span>

<span data-ttu-id="bb807-280">На некоторых более ранних платформах WinINet поддерживал протоколы исключительно (PCT) и (или) Fortezza, хотя и не в Windows XP.</span><span class="sxs-lookup"><span data-stu-id="bb807-280">On some earlier platforms, WinINet supported the Private Communication Technology (PCT) and/or Fortezza protocols, although not on Windows XP.</span></span>

<span data-ttu-id="bb807-281">Служба WinHTTP не поддерживает протоколы PCT и Fortezza на любой платформе, а использует SSL (SSL) 2,0, SSL 3,0 или TLS 1,0.</span><span class="sxs-lookup"><span data-stu-id="bb807-281">WinHTTP does not support the PCT and Fortezza protocols on any platform, and instead relies on Secure Sockets Layer (SSL) 2.0, SSL 3.0, or Transport Layer Security (TLS) 1.0.</span></span>

 

 
