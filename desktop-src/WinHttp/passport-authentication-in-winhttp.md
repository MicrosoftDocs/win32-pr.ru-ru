---
description: Службы Microsoft Windows HTTP Services (WinHTTP) полностью поддерживают использование Microsoft Passport протокола проверки подлинности на стороне клиента. В этом разделе приводятся общие сведения о транзакциях, участвующих в проверке подлинности паспорта, и способах их решения.
ms.assetid: 395d7aef-4da0-4664-8328-7d31ce58fedd
title: Проверка подлинности Passport в WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7b8fc00217c7c14fbd4635fab68398d2056c1ea5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104496890"
---
# <a name="passport-authentication-in-winhttp"></a><span data-ttu-id="94d47-104">Проверка подлинности Passport в WinHTTP</span><span class="sxs-lookup"><span data-stu-id="94d47-104">Passport Authentication in WinHTTP</span></span>

<span data-ttu-id="94d47-105">Службы Microsoft Windows HTTP Services (WinHTTP) полностью поддерживают использование Microsoft Passport протокола проверки подлинности на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="94d47-105">Microsoft Windows HTTP Services (WinHTTP) fully support the client side use of the Microsoft Passport authentication protocol.</span></span> <span data-ttu-id="94d47-106">В этом разделе приводятся общие сведения о транзакциях, участвующих в проверке подлинности паспорта, и способах их решения.</span><span class="sxs-lookup"><span data-stu-id="94d47-106">This topic provides an overview of the transactions involved in Passport authentication and how to handle them.</span></span>

> [!Note]  
> <span data-ttu-id="94d47-107">В WinHTTP 5,1 Проверка подлинности по паспорту отключена по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="94d47-107">In WinHTTP 5.1, Passport authentication is disabled by default.</span></span>

 

## <a name="passport-14"></a><span data-ttu-id="94d47-108">Паспорт 1,4</span><span class="sxs-lookup"><span data-stu-id="94d47-108">Passport 1.4</span></span>

<span data-ttu-id="94d47-109">Passport является основным компонентом Microsoft .NET стандартных блочных служб.</span><span class="sxs-lookup"><span data-stu-id="94d47-109">Passport is a core component of the Microsoft .NET building block services.</span></span> <span data-ttu-id="94d47-110">Она позволяет компаниям разрабатывать и предлагать распределенные веб-службы в широком спектре приложений, а также позволяет своим участникам использовать одно имя входа и пароль на всех участвующих веб-сайтах.</span><span class="sxs-lookup"><span data-stu-id="94d47-110">It enables businesses to develop and offer distributed Web services across a wide range of applications and enables its members to use one sign-in name and password at all participating Web sites.</span></span>

<span data-ttu-id="94d47-111">WinHTTP обеспечивает поддержку платформы для Microsoft Passport 1,4, реализуя клиентский протокол для проверки подлинности Passport 1,4.</span><span class="sxs-lookup"><span data-stu-id="94d47-111">WinHTTP provides platform support for Microsoft Passport 1.4 by implementing the client-side protocol for Passport 1.4 authentication.</span></span> <span data-ttu-id="94d47-112">Он освобождает приложения от сведений о взаимодействии с инфраструктурой Passport, а также о сохраненных именах пользователей и паролях в Windows XP.</span><span class="sxs-lookup"><span data-stu-id="94d47-112">It frees applications from the details of interacting with the Passport infrastructure and the Stored User Names and Passwords in Windows XP.</span></span> <span data-ttu-id="94d47-113">Эта абстракция делает использование паспорта не отличается от перспективы разработчика, чем использование традиционных схем проверки подлинности, таких как Basic или Digest.</span><span class="sxs-lookup"><span data-stu-id="94d47-113">This abstraction makes using Passport no different from a developer's perspective than using traditional authentication schemes like Basic or Digest.</span></span>

<span data-ttu-id="94d47-114">**Windows XP:** Раздел **HKCU \\ Software \\ Microsoft \\ Windows \\ CurrentVersion \\ Internet Settings \\ Passport \\ нумрегистратионрунс** , определяющий, сколько раз будет отображаться мастер проверки подлинности Passport при необходимости проверки подлинности Passport.</span><span class="sxs-lookup"><span data-stu-id="94d47-114">**Windows XP:** The **HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\Passport\\NumRegistrationRuns** registry key identifies the number of times the Passport Authentication Wizard is displayed when PassPort authentication is required.</span></span> <span data-ttu-id="94d47-115">Если для этого параметра задано число больше 5, мастер не отображается.</span><span class="sxs-lookup"><span data-stu-id="94d47-115">If the value for this key is set to a number greater than 5, the wizard is not displayed.</span></span>

<span data-ttu-id="94d47-116">В следующих разделах описываются транзакции, вовлеченные в проверку подлинности Passport с точки зрения клиентского приложения.</span><span class="sxs-lookup"><span data-stu-id="94d47-116">The following sections describe the transactions involved in Passport authentication from the point of view of a client application.</span></span> <span data-ttu-id="94d47-117">Сведения о разработке паспортов на стороне сервера см. в документации по пакету SDK для Passport.</span><span class="sxs-lookup"><span data-stu-id="94d47-117">For server-side Passport development, see the Passport SDK Documentation Overview.</span></span>

-   [<span data-ttu-id="94d47-118">Первоначальный запрос</span><span class="sxs-lookup"><span data-stu-id="94d47-118">Initial Request</span></span>](#initial-request)
-   [<span data-ttu-id="94d47-119">Сервер входа Passport</span><span class="sxs-lookup"><span data-stu-id="94d47-119">Passport Login Server</span></span>](#passport-login-server)
-   [<span data-ttu-id="94d47-120">Проверенный запрос</span><span class="sxs-lookup"><span data-stu-id="94d47-120">Authenticated Request</span></span>](#authenticated-request)

### <a name="initial-request"></a><span data-ttu-id="94d47-121">Первоначальный запрос</span><span class="sxs-lookup"><span data-stu-id="94d47-121">Initial Request</span></span>

<span data-ttu-id="94d47-122">Когда клиент запрашивает ресурс на сервере, для которого требуется проверка подлинности Passport, сервер проверяет запрос на наличие [*билетов*](glossary.md).</span><span class="sxs-lookup"><span data-stu-id="94d47-122">When a client requests a resource on a server that requires Passport authentication, the server checks the request for the presence of [*tickets*](glossary.md).</span></span> <span data-ttu-id="94d47-123">Если с запросом отправляется допустимый *билет* , сервер отвечает запрошенному ресурсу.</span><span class="sxs-lookup"><span data-stu-id="94d47-123">If a valid *ticket* is sent with the request, the server responds with the requested resource.</span></span> <span data-ttu-id="94d47-124">Если *билет* не существует на клиенте, сервер отвечает кодом состояния 302.</span><span class="sxs-lookup"><span data-stu-id="94d47-124">If the *ticket* does not exist on the client, the server responds with a 302 status code.</span></span> <span data-ttu-id="94d47-125">Ответ включает заголовок запроса "WWW-Authenticate: Passport 1.4".</span><span class="sxs-lookup"><span data-stu-id="94d47-125">The response includes the challenge header, "WWW-Authenticate: Passport1.4".</span></span> <span data-ttu-id="94d47-126">Клиенты, не использующие Passport, могут следовать перенаправлению на сервер входа Passport.</span><span class="sxs-lookup"><span data-stu-id="94d47-126">Clients that are not using Passport can follow the redirection to the Passport login server.</span></span> <span data-ttu-id="94d47-127">Более сложные клиенты обычно подключаются к своему хранилище Passport, чтобы определить расположение сервера входа Passport.</span><span class="sxs-lookup"><span data-stu-id="94d47-127">More advanced clients typically contact the Passport nexus to determine the location of the Passport login server.</span></span>

> [!Note]  
> <span data-ttu-id="94d47-128">Центральной частью Microsoft Passport сети является хранилище Passport, которое упрощает синхронизацию узлов- *участников паспорта,* чтобы убедиться в том, что каждый сайт имеет последние сведения о конфигурации сети и других проблемах.</span><span class="sxs-lookup"><span data-stu-id="94d47-128">Central to the Microsoft Passport network is the Passport *Nexus*, which facilitates synchronization of Passport participant sites to assure that each site has the latest details on network configuration and other issues.</span></span> <span data-ttu-id="94d47-129">Каждый компонент паспорта (Диспетчер паспортов, серверы входа, серверы обновлений и т. д.) периодически обменивается данными с хранилищами для получения сведений, необходимых для поиска и правильной связи с другими компонентами в сети Passport.</span><span class="sxs-lookup"><span data-stu-id="94d47-129">Each Passport component (Passport Manager, Login servers, Update servers, and so on) periodically communicates with the Nexus to retrieve the information it needs to locate, and properly communicate with, the other components in the Passport network.</span></span> <span data-ttu-id="94d47-130">Эти сведения извлекаются в виде XML-документа, который называется документом конфигурации компонента или ККД.</span><span class="sxs-lookup"><span data-stu-id="94d47-130">This information is retrieved as an XML document called a Component Configuration Document, or CCD.</span></span>

 

<span data-ttu-id="94d47-131">На следующем рисунке показан первоначальный запрос к дочерней службе Passport.</span><span class="sxs-lookup"><span data-stu-id="94d47-131">The following image shows the initial request to a Passport affiliate.</span></span>

![на рисунке показан первоначальный запрос к дочернему службе Passport.](images/art-passport1.png)

### <a name="passport-login-server"></a><span data-ttu-id="94d47-133">Сервер входа Passport</span><span class="sxs-lookup"><span data-stu-id="94d47-133">Passport Login Server</span></span>

<span data-ttu-id="94d47-134">Сервер входа Passport обрабатывает все запросы на [*билеты*](glossary.md) для любого ресурса в *доменном центре* Passport.</span><span class="sxs-lookup"><span data-stu-id="94d47-134">A Passport login server handles all requests for [*tickets*](glossary.md) for any resource in a Passport *domain authority*.</span></span> <span data-ttu-id="94d47-135">Перед проверкой подлинности запроса с помощью Passport клиентское приложение должно обратиться к серверу входа, чтобы получить соответствующие *билеты*.</span><span class="sxs-lookup"><span data-stu-id="94d47-135">Before a request can be authenticated using Passport, the client application must contact the login server to obtain the appropriate *tickets*.</span></span>

<span data-ttu-id="94d47-136">Когда клиент запрашивает [*билеты*](glossary.md) с сервера входа Passport, сервер входа обычно отвечает на код состояния 401, чтобы указать, что необходимо предоставить учетные данные пользователя.</span><span class="sxs-lookup"><span data-stu-id="94d47-136">When a client requests [*tickets*](glossary.md) from a Passport login server, the login server typically responds with a 401 status code to indicate that user credentials must be provided.</span></span> <span data-ttu-id="94d47-137">При указании этих учетных данных сервер входа отвечает с *билетами* , необходимыми для доступа к указанному ресурсу на сервере, содержащем изначально запрошенный ресурс.</span><span class="sxs-lookup"><span data-stu-id="94d47-137">When these credentials are provided, the login server responds with the *tickets* required to access the specified resource on the server that contains the originally requested resource.</span></span> <span data-ttu-id="94d47-138">Сервер входа также может перенаправить клиент на другой сервер, который может предоставить запрошенный ресурс.</span><span class="sxs-lookup"><span data-stu-id="94d47-138">The login server can also redirect the client to another server that can provide the requested resource.</span></span>

![на рисунке показан запрос клиентского билета к серверу входа Passport.](images/art-passport2.png)

### <a name="authenticated-request"></a><span data-ttu-id="94d47-140">Проверенный запрос</span><span class="sxs-lookup"><span data-stu-id="94d47-140">Authenticated Request</span></span>

<span data-ttu-id="94d47-141">Если у клиента есть [*билеты*](glossary.md) , соответствующие заданному серверу, эти *билеты* включаются во все запросы к этому серверу.</span><span class="sxs-lookup"><span data-stu-id="94d47-141">When the client has the [*tickets*](glossary.md) that correspond to a given server, those *tickets* are included with all requests to that server.</span></span> <span data-ttu-id="94d47-142">Если эти *билеты* не изменялись с момента получения с сервера входа в систему Passport, а *билеты* действительны для сервера ресурсов, сервер ресурсов отправляет ответ, который содержит как запрошенный ресурс, так и файлы cookie, указывающие, что пользователь прошел проверку подлинности для будущих запросов.</span><span class="sxs-lookup"><span data-stu-id="94d47-142">If the *tickets* have not been modified since they were retrieved from the Passport login server, and the *tickets* are valid for the resource server, the resource server sends a response that includes both the requested resource and cookies that indicate that the user is authenticated for future requests.</span></span>

<span data-ttu-id="94d47-143">Дополнительные файлы cookie в ответе предназначены для ускорения процесса проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="94d47-143">The additional cookies in the response are intended to speed the authentication process.</span></span> <span data-ttu-id="94d47-144">Дополнительные запросы в одном сеансе для ресурсов на серверах в одном и том же домене службы Passport включают эти дополнительные файлы cookie.</span><span class="sxs-lookup"><span data-stu-id="94d47-144">Additional requests in the same session for resources on servers in the same Passport Domain Authority all include these additional cookies.</span></span> <span data-ttu-id="94d47-145">Учетные данные не нужно отправлять на сервер входа повторно, пока не истечет срок действия файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="94d47-145">Credentials do not need to be sent to the login server again until the cookies expire.</span></span>

![на рисунке показан запрос, прошедший проверку подлинности, на сервер входа Passport.](images/art-passport3.png)

## <a name="using-passport-in-winhttp"></a><span data-ttu-id="94d47-147">Использование паспорта в WinHTTP</span><span class="sxs-lookup"><span data-stu-id="94d47-147">Using Passport in WinHTTP</span></span>

<span data-ttu-id="94d47-148">Проверка подлинности по паспорту в WinHTTP очень похожа на другие схемы проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="94d47-148">Passport authentication in WinHTTP is very similar to other authentication schemes.</span></span> <span data-ttu-id="94d47-149">Общие сведения о проверке подлинности в WinHTTP см. в статье [Проверка подлинности в WinHTTP](authentication-in-winhttp.md) .</span><span class="sxs-lookup"><span data-stu-id="94d47-149">See [Authentication in WinHTTP](authentication-in-winhttp.md) for an overview of authentication in WinHTTP.</span></span>

<span data-ttu-id="94d47-150">В WinHTTP 5,1 Проверка подлинности паспорта отключена по умолчанию и должна быть явно включена с помощью [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) перед использованием.</span><span class="sxs-lookup"><span data-stu-id="94d47-150">In WinHTTP 5.1, Passport authentication is disabled by default and must be explicitly enabled with [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) before use.</span></span>

<span data-ttu-id="94d47-151">Служба WinHTTP обрабатывает многие сведения о транзакциях внутренне для проверки подлинности Passport.</span><span class="sxs-lookup"><span data-stu-id="94d47-151">WinHTTP handles many of the transaction details internally for Passport authentication.</span></span> <span data-ttu-id="94d47-152">Во время первоначального запроса сервер возвращает код состояния 302, если требуется проверка подлинности.</span><span class="sxs-lookup"><span data-stu-id="94d47-152">During the initial request, the server responds with a 302 status code when authentication is necessary.</span></span> <span data-ttu-id="94d47-153">Код состояния 302 на самом деле указывает на перенаправление и является частью протокола Passport для обеспечения обратной совместимости.</span><span class="sxs-lookup"><span data-stu-id="94d47-153">The 302 status code actually indicates a redirection and is part of the Passport protocol for backwards compatibility.</span></span> <span data-ttu-id="94d47-154">Служба WinHTTP скрывает код состояния 302 и обращается к подпапке Passport, а затем к серверу входа.</span><span class="sxs-lookup"><span data-stu-id="94d47-154">WinHTTP hides the 302 status code and contacts the Passport nexus, and then the login server.</span></span> <span data-ttu-id="94d47-155">Приложение WinHTTP уведомляет о коде состояния 401, отправленном сервером входа, для запроса учетных данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="94d47-155">The WinHTTP application is notified of the 401 status code sent by the login server to request user credentials.</span></span> <span data-ttu-id="94d47-156">Однако для приложения он выглядит так, как если бы состояние 401 было получено с сервера, с которого был запрошен ресурс.</span><span class="sxs-lookup"><span data-stu-id="94d47-156">To the application, however, it appears as if the 401 status originates from the server from which the resource was requested.</span></span> <span data-ttu-id="94d47-157">Таким образом, приложение WinHTTP не знает о взаимодействии с другими серверами и может обрабатывать проверку подлинности Passport с помощью того же кода, который обрабатывает другие схемы проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="94d47-157">In this way, the WinHTTP application is unaware of interactions with other servers, and it can handle Passport authentication with the same code that handles other authentication schemes.</span></span>

<span data-ttu-id="94d47-158">Как правило, WinHTTP-приложение реагирует на код состояния 401, указав учетные данные для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="94d47-158">Typically, a WinHTTP application responds to a 401 status code by supplying authentication credentials.</span></span> <span data-ttu-id="94d47-159">Если учетные данные предоставляются с помощью [**винхттпсеткредентиалс**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials) или [**сеткредентиалс**](iwinhttprequest-setcredentials.md) для проверки подлинности Passport, учетные данные фактически отправляются на сервер входа, а не на сервер, указанный в запросе.</span><span class="sxs-lookup"><span data-stu-id="94d47-159">When credentials are supplied with [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials) or [**SetCredentials**](iwinhttprequest-setcredentials.md) for passport authentication, the credentials are actually being sent to the login server, not to the server indicated in the request.</span></span>

<span data-ttu-id="94d47-160">Однако при ответе на код состояния 407 приложение WinHTTP должно использовать [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) для предоставления учетных данных прокси-сервера, а не [**винхттпсеткредентиалс**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials).</span><span class="sxs-lookup"><span data-stu-id="94d47-160">However, when responding to a 407 status code, a WinHTTP application must use [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) to provide proxy credentials, rather than [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials).</span></span> <span data-ttu-id="94d47-161">Так как **винхттпсетоптион** является менее безопасным способом предоставления учетных данных, его обычно следует избегать.</span><span class="sxs-lookup"><span data-stu-id="94d47-161">Because **WinHttpSetOption** is a less secure way to supply credentials, it should normally be avoided.</span></span>

<span data-ttu-id="94d47-162">После извлечения [*билеты*](glossary.md) управляются внутренним образом и автоматически отправляются на соответствующие серверы в будущих запросах.</span><span class="sxs-lookup"><span data-stu-id="94d47-162">Once retrieved, [*tickets*](glossary.md) are managed internally and are automatically sent to applicable servers in future requests.</span></span>

> [!Note]  
> <span data-ttu-id="94d47-163">Служба WinHTTP позволяет отключить автоматическое перенаправление, вызвав функцию [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) для [**параметра WinHTTP отключить флаг \_ \_ \_ функции**](option-flags.md) и указав значение, чтобы [**\_ Отключить \_ перенаправления WinHTTP**](option-flags.md).</span><span class="sxs-lookup"><span data-stu-id="94d47-163">WinHTTP enables you to disable automatic redirection by calling the [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) function for the [**WINHTTP\_OPTION\_DISABLE\_FEATURE**](option-flags.md) flag and specifying a value of [**WINHTTP\_DISABLE\_REDIRECTS**](option-flags.md).</span></span> <span data-ttu-id="94d47-164">Отключение перенаправления не мешает перенаправлению, которое обслуживает службы WinHTTP для транзакций Passport.</span><span class="sxs-lookup"><span data-stu-id="94d47-164">Disabling redirection does not interfere with the redirection that WinHTTP handles internally for Passport transactions.</span></span>

 

<span data-ttu-id="94d47-165">Служба WinHTTP может успешно завершить проверку подлинности Passport, даже если приложение отключает автоматическое перенаправление.</span><span class="sxs-lookup"><span data-stu-id="94d47-165">WinHTTP can successfully complete the Passport authentication even if an application disables auto redirection.</span></span> <span data-ttu-id="94d47-166">Однако после завершения проверки подлинности паспорта неявное перенаправление должно осуществляться с URL-адреса сервера входа Passport обратно на исходный URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="94d47-166">However, after the Passport authentication is complete, an implicit redirect must occur from the Passport login server URL back to the original URL.</span></span> <span data-ttu-id="94d47-167">Это перенаправление не запускается HTTP-ответом 302, но является неявным в протоколе Passport.</span><span class="sxs-lookup"><span data-stu-id="94d47-167">This redirect is not triggered by a 302 HTTP response, but is implicit in the Passport protocol.</span></span>

<span data-ttu-id="94d47-168">WinHTTP обрабатывает это неявное перенаправление специально.</span><span class="sxs-lookup"><span data-stu-id="94d47-168">WinHTTP handles this implicit redirect specially.</span></span> <span data-ttu-id="94d47-169">Если приложение отключило автоматическое перенаправление, служба WinHTTP требует, чтобы приложение было предоставлено разрешение WinHTTP для автоматического перенаправления в этом специальном случае.</span><span class="sxs-lookup"><span data-stu-id="94d47-169">If an application has disabled automatic redirection, WinHTTP requires that the application give WinHTTP "permission" to redirect automatically in this special case.</span></span>

<span data-ttu-id="94d47-170">Чтобы служба WinHTTP перенаправлялась обратно на исходный URL-адрес после проверки подлинности, приложение должно зарегистрировать функцию обратного вызова с помощью [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback).</span><span class="sxs-lookup"><span data-stu-id="94d47-170">In order to have WinHTTP redirect back to the original URL after authentication, the application must register a callback function using [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback).</span></span> <span data-ttu-id="94d47-171">Служба WinHTTP может уведомить приложение о \_ состоянии обратного вызова WinHTTP \_ \_ , что позволяет приложению отменить перенаправление.</span><span class="sxs-lookup"><span data-stu-id="94d47-171">WinHTTP can then notify the application with a WINHTTP\_CALLBACK\_STATUS\_REDIRECT callback, which allows the application to cancel the redirect.</span></span> <span data-ttu-id="94d47-172">Приложению не требуется предоставлять какие бы то ни было функции в функции обратного вызова. Регистрация обратного вызова достаточно, чтобы служба WinHTTP подследовала этому Специальному перенаправлению.</span><span class="sxs-lookup"><span data-stu-id="94d47-172">An application does not need to provide any functionality in the callback function; registration of the callback is sufficient to enable WinHTTP to follow this special-case redirect.</span></span>

<span data-ttu-id="94d47-173">Сообщение об ошибке "ошибка \_ входа WinHTTP" \_ создается, \_ Если функция обратного вызова не задана приложением.</span><span class="sxs-lookup"><span data-stu-id="94d47-173">The ERROR\_WINHTTP\_LOGIN\_FAILURE message is generated if a callback function is not set by the application.</span></span>

### <a name="passport-cobranding"></a><span data-ttu-id="94d47-174">Фирменная символика Passport</span><span class="sxs-lookup"><span data-stu-id="94d47-174">Passport Cobranding</span></span>

<span data-ttu-id="94d47-175">В отличие от традиционных схем проверки подлинности, поддерживаемых WinHTTP, Passport может быть обширной [*фирменной символикой*](glossary.md).</span><span class="sxs-lookup"><span data-stu-id="94d47-175">Unlike traditional authentication schemes supported by WinHTTP, Passport can be extensively [*cobranded*](glossary.md).</span></span> <span data-ttu-id="94d47-176">При получении кода состояния 401, указывающего на проблему, приложение может *получить графический рисунок* и текст.</span><span class="sxs-lookup"><span data-stu-id="94d47-176">Upon receiving a 401 status code that indicates a challenge, an application can retrieve the *cobranding* graphic and text.</span></span> <span data-ttu-id="94d47-177">Получите URL-адрес для *фирменной символики* , вызвав [**винхттпкуерйоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) с \_ параметром WinHTTP " \_ \_ \_ URL-адрес кофирменной символики Passport".</span><span class="sxs-lookup"><span data-stu-id="94d47-177">Retrieve a URL for the *cobranding* graphic by calling [**WinHttpQueryOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) with the WINHTTP\_OPTION\_PASSPORT\_COBRANDING\_URL flag.</span></span> <span data-ttu-id="94d47-178">Получите текст *кофирменной символики* , вызвав [**винхттпкуерйоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) , установив флаг WinHTTP для \_ параметра \_ \_ \_ Text.</span><span class="sxs-lookup"><span data-stu-id="94d47-178">Retrieve the *cobranding* text by calling [**WinHttpQueryOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) with the WINHTTP\_OPTION\_PASSPORT\_COBRANDING\_TEXT flag.</span></span> <span data-ttu-id="94d47-179">Эти элементы можно использовать для настройки диалогового окна сбора учетных данных.</span><span class="sxs-lookup"><span data-stu-id="94d47-179">These items can be used to customize a credential-gathering dialog.</span></span>

### <a name="stored-user-names-and-passwords"></a><span data-ttu-id="94d47-180">Сохранение имен пользователей и паролей</span><span class="sxs-lookup"><span data-stu-id="94d47-180">Stored User Names and Passwords</span></span>

<span data-ttu-id="94d47-181">В Windows XP была представлена концепция сохраненных имен пользователей и паролей.</span><span class="sxs-lookup"><span data-stu-id="94d47-181">Windows XP introduced the concept of Stored User Names and Passwords.</span></span> <span data-ttu-id="94d47-182">Если учетные данные пользователя Passport сохраняются с помощью **мастера регистрации паспорта** или стандартного **диалогового окна учетных данных**, они сохраняются в сохраненных именах пользователей и паролях.</span><span class="sxs-lookup"><span data-stu-id="94d47-182">If a user's Passport credentials are saved through the **Passport Registration Wizard** or the standard **Credential Dialog**, it is saved in the Stored User Names and Passwords.</span></span> <span data-ttu-id="94d47-183">При использовании WinHTTP в Windows XP или более поздней версии WinHTTP автоматически использует учетные данные в сохраненных именах пользователей и паролях, если учетные данные не заданы явно.</span><span class="sxs-lookup"><span data-stu-id="94d47-183">When using WinHTTP on Windows XP or later, WinHTTP automatically uses the credentials in the Stored User Names and Passwords if credentials are not explicitly set.</span></span> <span data-ttu-id="94d47-184">Это похоже на поддержку учетных данных входа по умолчанию для NTLM/Kerberos.</span><span class="sxs-lookup"><span data-stu-id="94d47-184">This is similar to the support of default logon credentials for NTLM/Kerberos.</span></span> <span data-ttu-id="94d47-185">Однако использование учетных данных паспорта по умолчанию не подчиняется параметрам политики автоматического входа.</span><span class="sxs-lookup"><span data-stu-id="94d47-185">However, use of default Passport credentials is not subject to the automatic logon policy settings.</span></span>

### <a name="disabling-passport-authentication"></a><span data-ttu-id="94d47-186">Отключение проверки подлинности паспорта</span><span class="sxs-lookup"><span data-stu-id="94d47-186">Disabling Passport Authentication</span></span>

<span data-ttu-id="94d47-187">Некоторым приложениям может потребоваться возможность отключения проверки подлинности Passport.</span><span class="sxs-lookup"><span data-stu-id="94d47-187">Some applications might require the ability to disable Passport authentication.</span></span> <span data-ttu-id="94d47-188">Например, когда дочерний элемент Passport реагирует на код первоначального состояния 302, может быть предпочтительнее следовать указанному перенаправлению и визуализировать страницу проверки подлинности в формате HTML Passport, а не разрешать внутренней обработке проверки подлинности службой WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="94d47-188">For example, when a Passport affiliate responds with the initial 302 status code, it might be preferable to follow the indicated redirection and render the HTML Passport authentication page rather than allowing WinHTTP to handle the authentication internally.</span></span> <span data-ttu-id="94d47-189">Проверка подлинности Passport отключена в WinHTTP путем вызова функции [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) с параметром WinHTTP \_ \_ \_ AUTH configure \_ и передачи значения WinHTTP \_ disable \_ Passport \_ AUTH.</span><span class="sxs-lookup"><span data-stu-id="94d47-189">Passport authentication is disabled in WinHTTP by calling the [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) function with the WINHTTP\_OPTION\_CONFIGURE\_PASSPORT\_AUTH option and passing the value WINHTTP\_DISABLE\_PASSPORT\_AUTH.</span></span> <span data-ttu-id="94d47-190">Позже ее можно будет включить повторно с помощью WINHTTP \_ включить \_ проверку \_ подлинности Passport.</span><span class="sxs-lookup"><span data-stu-id="94d47-190">It can later be re-enabled with WINHTTP\_ENABLE\_PASSPORT\_AUTH.</span></span>

<span data-ttu-id="94d47-191">Проверку подлинности Passport нельзя отключить при использовании объекта [**WinHttpRequest**](winhttprequest.md) .</span><span class="sxs-lookup"><span data-stu-id="94d47-191">Passport authentication cannot be disabled when using the [**WinHttpRequest**](winhttprequest.md) object.</span></span>

<span data-ttu-id="94d47-192">Как отмечалось ранее в этом разделе, проверка подлинности паспорта по умолчанию отключена в WinHTTP 5,1 и должна быть явно включена с помощью [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) перед использованием.</span><span class="sxs-lookup"><span data-stu-id="94d47-192">As noted earlier in this section, Passport authentication is disabled by default in WinHTTP 5.1, and must be explicitly enabled with [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) before use.</span></span>

## <a name="passport-configuration-overrides-used-for-testing"></a><span data-ttu-id="94d47-193">Переопределения конфигурации паспорта, используемые для тестирования</span><span class="sxs-lookup"><span data-stu-id="94d47-193">Passport Configuration Overrides Used for Testing</span></span>

<span data-ttu-id="94d47-194">Служба WinHTTP полагается на сведения о конфигурации, загружаемые с сервера хранилища Passport для поддержки проверки подлинности Passport 1,4.</span><span class="sxs-lookup"><span data-stu-id="94d47-194">WinHTTP relies on the configuration information it downloads from the passport nexus server to support Passport 1.4 authentication.</span></span> <span data-ttu-id="94d47-195">По умолчанию этот сервер защищен (SSL) — nexus.passport.com, а ресурс конфигурации — RDR/ппрдр. ASP, известный как динамическая конфигурация Passport.</span><span class="sxs-lookup"><span data-stu-id="94d47-195">By default this secure (SSL) server is nexus.passport.com, and the configuration resource is rdr/pprdr.asp, which is known as the "live" passport configuration.</span></span> <span data-ttu-id="94d47-196">Формат данных — это пользовательский заголовок HTTP "Пасспортурлс", за которым следуют пары "атрибут-значение", разделенные запятыми.</span><span class="sxs-lookup"><span data-stu-id="94d47-196">The format of the information is a custom HTTP header "PassportURLs", followed by comma delimited attribute-value pairs.</span></span>

<span data-ttu-id="94d47-197">Например, " https://nexus.passport.com/rdr/pprdr.asp " возвращает следующие сведения о конфигурации:</span><span class="sxs-lookup"><span data-stu-id="94d47-197">For example, "https://nexus.passport.com/rdr/pprdr.asp" returns the following configuration information:</span></span>

``` syntax
PassportURLs: DARealm=Passport.net,
DALogin=login.passport.com/login2.asp,
DAReg=https://register.passport.com/defaultwiz.asp,
Properties=https://memberservices.passport.com/ppsecure/MSRV_EditProfile.asp,
Privacy=https://www.passport.com/consumer/privacypolicy.asp,
GeneralRedir=https://nexusrdr.passport.com/redir.asp,
Help=https://memberservices.passport.com/UI/MSRV_UI_Help.asp,
ConfigVersion=2
\r\n
```

<span data-ttu-id="94d47-198">Части, относящиеся к WinHTTP, — это Дареалм, Далогин и Конфигверсион.</span><span class="sxs-lookup"><span data-stu-id="94d47-198">The parts that are relevant to WinHTTP are DARealm, DALogin, and ConfigVersion.</span></span> <span data-ttu-id="94d47-199">Из соображений производительности они кэшируются в течение времени существования сеанса WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="94d47-199">For performance reasons, they are cached for the lifetime of a WinHTTP session.</span></span> <span data-ttu-id="94d47-200">Эти три значения могут быть переопределены приложениями, необходимыми для работы с другой инфраструктурой Passport, отличной от реальной рабочей настройки, изменяя соответствующие параметры реестра в разделе</span><span class="sxs-lookup"><span data-stu-id="94d47-200">These three values can be overridden by applications that are required to work with another passport infrastructure other than the "live" production setup by changing the appropriate registry settings under</span></span>

```
HKEY_LOCAL_MACHINE
   SOFTWARE
      Microsoft
         Windows
            CurrentVersion
               Internet Settings
                  WinHttp
                     Passport Test
```

``` syntax
LoginServerRealm (REG_SZ)    For example: abc.net
LoginServerUrl (REG_SZ)      For example: https://private-login.passport.com/login2.asp
ConfigVersion (REG_DWORD)    For example: 10
```

<span data-ttu-id="94d47-201">Если в реестре есть Логинсерверурл, служба WinHTTP не свяжется с сервером хранилища для получения других значений конфигурации.</span><span class="sxs-lookup"><span data-stu-id="94d47-201">If LoginServerUrl is present in the registry, WinHTTP does not contact the nexus server for other configuration values.</span></span> <span data-ttu-id="94d47-202">В этом случае Логинсерверреалм и Конфигверсион также должны быть установлены в реестре для исправления значений.</span><span class="sxs-lookup"><span data-stu-id="94d47-202">In this case, LoginServerRealm and ConfigVersion should also be set through the registry to correct values.</span></span>

<span data-ttu-id="94d47-203">Приложение может потребоваться для тестирования, чтобы загрузить конфигурацию паспорта с закрытого сервера хранилища.</span><span class="sxs-lookup"><span data-stu-id="94d47-203">An application may, for testing purposes, be required to download passport configuration from a private nexus server.</span></span> <span data-ttu-id="94d47-204">Это можно сделать, переопределив два значения реестра в разделе</span><span class="sxs-lookup"><span data-stu-id="94d47-204">This can be done by overriding two registry values under</span></span>

```
HKEY_LOCAL_MACHINE
   SOFTWARE
      Microsoft
         Windows
            CurrentVersion
               Internet Settings
                  WinHttp
                     Passport Test
```

``` syntax
NexusHost (REG_SZ)    e.g. private-nexus.passport.com
NexusObj(REG_SZ)      e.g. config/passport.asp
```

## <a name="related-topics"></a><span data-ttu-id="94d47-205">См. также</span><span class="sxs-lookup"><span data-stu-id="94d47-205">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="94d47-206">Проверка подлинности в WinHTTP</span><span class="sxs-lookup"><span data-stu-id="94d47-206">Authentication in WinHTTP</span></span>](authentication-in-winhttp.md)
</dt> </dl>

 

 



