---
description: Службы Microsoft Windows HTTP (WinHTTP) используют дескрипторы для наблюдения за параметрами и сведениями, необходимыми при использовании протокола HTTP.
ms.assetid: 0bd82860-1347-40c8-ae77-c4d865c109be
title: Дескрипторы ХИНТЕРНЕТ в WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bf374675ad6f2114dd48e0a3ff1db50cd0dd7f9c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104559334"
---
# <a name="hinternet-handles-in-winhttp"></a><span data-ttu-id="4c560-103">Дескрипторы ХИНТЕРНЕТ в WinHTTP</span><span class="sxs-lookup"><span data-stu-id="4c560-103">HINTERNET Handles in WinHTTP</span></span>

<span data-ttu-id="4c560-104">Службы Microsoft Windows HTTP (WinHTTP) используют дескрипторы для наблюдения за параметрами и сведениями, необходимыми при использовании протокола HTTP.</span><span class="sxs-lookup"><span data-stu-id="4c560-104">Microsoft Windows HTTP Services (WinHTTP) uses handles to keep track of settings and information required when using the HTTP protocol.</span></span> <span data-ttu-id="4c560-105">Каждый обработчик сохраняет информацию, относящуюся к сеансу HTTP, соединению с HTTP-сервером или определенному ресурсу.</span><span class="sxs-lookup"><span data-stu-id="4c560-105">Each handle maintains information pertinent to an HTTP session, a connection with an HTTP server, or a specific resource.</span></span> <span data-ttu-id="4c560-106">В этом разделе описываются различные типы дескрипторов, соглашения об именовании для этих дескрипторов и их иерархическая структура.</span><span class="sxs-lookup"><span data-stu-id="4c560-106">This topic describes the various types of handles, the naming conventions for these handles, and their hierarchical structure.</span></span>

-   [<span data-ttu-id="4c560-107">О дескрипторах ХИНТЕРНЕТ</span><span class="sxs-lookup"><span data-stu-id="4c560-107">About HINTERNET Handles</span></span>](#about-hinternet-handles)
-   [<span data-ttu-id="4c560-108">Дескрипторы именования</span><span class="sxs-lookup"><span data-stu-id="4c560-108">Naming Handles</span></span>](#naming-handles)
-   [<span data-ttu-id="4c560-109">Иерархия маркеров</span><span class="sxs-lookup"><span data-stu-id="4c560-109">Handle Hierarchy</span></span>](#handle-hierarchy)
-   [<span data-ttu-id="4c560-110">Объяснение иерархии маркеров</span><span class="sxs-lookup"><span data-stu-id="4c560-110">Explanation of the Handle Hierarchy</span></span>](#explanation-of-the-handle-hierarchy)

## <a name="about-hinternet-handles"></a><span data-ttu-id="4c560-111">О дескрипторах ХИНТЕРНЕТ</span><span class="sxs-lookup"><span data-stu-id="4c560-111">About HINTERNET Handles</span></span>

<span data-ttu-id="4c560-112">Дескрипторы, создаваемые и используемые WinHTTP, называются дескрипторами **хинтернет** .</span><span class="sxs-lookup"><span data-stu-id="4c560-112">The handles that are created and used by WinHTTP are called **HINTERNET** handles.</span></span> <span data-ttu-id="4c560-113">Функции WinHTTP возвращают дескрипторы **хинтернет** , которые не взаимозаменяемы с другими дескрипторами, поэтому их нельзя использовать с такими функциями, как [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) или [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle).</span><span class="sxs-lookup"><span data-stu-id="4c560-113">The WinHTTP functions return **HINTERNET** handles that are not interchangeable with other handles, so they cannot be used with functions such as [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) or [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle).</span></span> <span data-ttu-id="4c560-114">Аналогично, другие дескрипторы нельзя использовать с функциями WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="4c560-114">Similarly, other handles cannot be used with WinHTTP functions.</span></span> <span data-ttu-id="4c560-115">Например, маркер, возвращаемый [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) , не может быть передан в [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata).</span><span class="sxs-lookup"><span data-stu-id="4c560-115">For example, a handle returned by [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) cannot be passed to [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata).</span></span> <span data-ttu-id="4c560-116">Эти дескрипторы **хинтернет** не могут быть закрыты, пока выполняется вызов API, использующий дескриптор.</span><span class="sxs-lookup"><span data-stu-id="4c560-116">These **HINTERNET** handles cannot be closed while an API call using the handle is in progress.</span></span> <span data-ttu-id="4c560-117">Чтобы избежать состояния гонки, приложения должны защищать обработчик и предотвращать его закрытие до тех пор, пока выполняется вызов API.</span><span class="sxs-lookup"><span data-stu-id="4c560-117">To avoid a race condition, applications should protect the handle and prevent it from being closed for as long as the API call is in progress.</span></span>

<span data-ttu-id="4c560-118">Функции Microsoft Win32 Интернета (WinInet) также используют дескрипторы **хинтернет** .</span><span class="sxs-lookup"><span data-stu-id="4c560-118">Microsoft Win32 Internet (WinInet) functions also use **HINTERNET** handles.</span></span> <span data-ttu-id="4c560-119">Однако дескрипторы, используемые в функциях WinInet, не могут быть взаимозаменяемыми с дескрипторами, используемыми в функциях WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="4c560-119">However, the handles used in WinInet functions cannot be interchanged with the handles used in WinHTTP functions.</span></span> <span data-ttu-id="4c560-120">Дополнительные сведения о WinInet см. в разделе [About WinInet](/windows/desktop/WinInet/about-wininet).</span><span class="sxs-lookup"><span data-stu-id="4c560-120">For more information about WinInet, see [About WinINet](/windows/desktop/WinInet/about-wininet).</span></span>

<span data-ttu-id="4c560-121">Функция [**WinHttpCloseHandle**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpclosehandle) закрывает дескрипторы WinHTTP **хинтернет** .</span><span class="sxs-lookup"><span data-stu-id="4c560-121">The [**WinHttpCloseHandle**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpclosehandle) function closes WinHTTP **HINTERNET** handles.</span></span>

## <a name="naming-handles"></a><span data-ttu-id="4c560-122">Дескрипторы именования</span><span class="sxs-lookup"><span data-stu-id="4c560-122">Naming Handles</span></span>

<span data-ttu-id="4c560-123">В документации по WinHTTP описаны функции в интерфейсе прикладного программирования (API) и примеры кода, демонстрирующие создание и использование различных типов дескрипторов **хинтернет** .</span><span class="sxs-lookup"><span data-stu-id="4c560-123">Throughout the WinHTTP documentation, descriptions of functions in the application programming interface (API) and sample code show the creation and use of various types of **HINTERNET** handles.</span></span> <span data-ttu-id="4c560-124">Чтобы контролировать различные типы доступных дескрипторов, имена этих дескрипторов согласуются.</span><span class="sxs-lookup"><span data-stu-id="4c560-124">To keep track of the different types of handles available, the naming of these handles is consistent.</span></span> <span data-ttu-id="4c560-125">В следующей таблице приведены идентификаторы, используемые соглашением в документации.</span><span class="sxs-lookup"><span data-stu-id="4c560-125">The following table shows the identifiers used by convention in the documentation.</span></span>



| <span data-ttu-id="4c560-126">Тип обработчика</span><span class="sxs-lookup"><span data-stu-id="4c560-126">Handle type</span></span>       | <span data-ttu-id="4c560-127">Создание маркера</span><span class="sxs-lookup"><span data-stu-id="4c560-127">Function creating handle</span></span>                                                                                                          | <span data-ttu-id="4c560-128">Идентификатор</span><span class="sxs-lookup"><span data-stu-id="4c560-128">Identifier</span></span> |
|-------------------|-----------------------------------------------------------------------------------------------------------------------------------|------------|
| <span data-ttu-id="4c560-129">Универсальный маркер</span><span class="sxs-lookup"><span data-stu-id="4c560-129">Generic handle</span></span>    | <span data-ttu-id="4c560-130">[**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen), [**винхттпконнект**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect)или [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest)</span><span class="sxs-lookup"><span data-stu-id="4c560-130">[**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen), [**WinHttpConnect**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect), or [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest)</span></span> | <span data-ttu-id="4c560-131">хинтернет</span><span class="sxs-lookup"><span data-stu-id="4c560-131">hInternet</span></span>  |
| <span data-ttu-id="4c560-132">Обработчик сеанса</span><span class="sxs-lookup"><span data-stu-id="4c560-132">Session handle</span></span>    | [<span data-ttu-id="4c560-133">**WinHttpOpen**</span><span class="sxs-lookup"><span data-stu-id="4c560-133">**WinHttpOpen**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen)                                                                                                | <span data-ttu-id="4c560-134">хсессион</span><span class="sxs-lookup"><span data-stu-id="4c560-134">hSession</span></span>   |
| <span data-ttu-id="4c560-135">Маркер подключения</span><span class="sxs-lookup"><span data-stu-id="4c560-135">Connection handle</span></span> | [<span data-ttu-id="4c560-136">**винхттпконнект**</span><span class="sxs-lookup"><span data-stu-id="4c560-136">**WinHttpConnect**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect)                                                                                          | <span data-ttu-id="4c560-137">хконнект</span><span class="sxs-lookup"><span data-stu-id="4c560-137">hConnect</span></span>   |
| <span data-ttu-id="4c560-138">Маркер запроса</span><span class="sxs-lookup"><span data-stu-id="4c560-138">Request handle</span></span>    | [<span data-ttu-id="4c560-139">**WinHttpOpenRequest**</span><span class="sxs-lookup"><span data-stu-id="4c560-139">**WinHttpOpenRequest**</span></span>](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest)                                                                                  | <span data-ttu-id="4c560-140">хрекуест</span><span class="sxs-lookup"><span data-stu-id="4c560-140">hRequest</span></span>   |



 

## <a name="handle-hierarchy"></a><span data-ttu-id="4c560-141">Иерархия маркеров</span><span class="sxs-lookup"><span data-stu-id="4c560-141">Handle Hierarchy</span></span>

<span data-ttu-id="4c560-142">Дескрипторы **хинтернет** поддерживаются в иерархии.</span><span class="sxs-lookup"><span data-stu-id="4c560-142">The **HINTERNET** handles are maintained in a hierarchy.</span></span> <span data-ttu-id="4c560-143">Маркер, возвращаемый функцией [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) , представляет собой обработчик **хинтернет** сеанса.</span><span class="sxs-lookup"><span data-stu-id="4c560-143">The handle returned by [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) is the session **HINTERNET** handle.</span></span> <span data-ttu-id="4c560-144">Вызов **WinHttpOpen** инициализирует функции WinHTTP и запускает контекст сеанса, который сохраняет сведения о пользователе и параметры на протяжении всего жизненного цикла обработчика сеанса.</span><span class="sxs-lookup"><span data-stu-id="4c560-144">Calling **WinHttpOpen** initializes the WinHTTP functions and begins a session context that maintains user information and settings throughout the life of the session handle.</span></span> <span data-ttu-id="4c560-145">[**Винхттпконнект**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect) указывает целевой сервер HTTP или HTTPS и создает обработчик соединения **хинтернет** .</span><span class="sxs-lookup"><span data-stu-id="4c560-145">[**WinHttpConnect**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect) specifies a target HTTP or HTTPS server and creates a connection **HINTERNET** handle.</span></span> <span data-ttu-id="4c560-146">По умолчанию маркер соединения наследует параметры для обработчика сеанса.</span><span class="sxs-lookup"><span data-stu-id="4c560-146">By default, the connection handle inherits the settings for the session handle.</span></span> <span data-ttu-id="4c560-147">Каждому ресурсу, указанному с помощью вызова [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest) , присваивается обработчик запроса **хинтернет** .</span><span class="sxs-lookup"><span data-stu-id="4c560-147">Each resource specified with a call to [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest) is assigned a request **HINTERNET** handle.</span></span>

<span data-ttu-id="4c560-148">На следующей схеме показана иерархия дескрипторов **хинтернет** .</span><span class="sxs-lookup"><span data-stu-id="4c560-148">The following diagram illustrates the hierarchy of **HINTERNET** handles.</span></span> <span data-ttu-id="4c560-149">Каждое поле на схеме представляет функцию WinHTTP, которая возвращает обработчик **хинтернет** .</span><span class="sxs-lookup"><span data-stu-id="4c560-149">Each box in the diagram represents a WinHTTP function that returns an **HINTERNET** handle.</span></span>

![функции, создающие дескрипторы](images/art-winhttp2.png)

<span data-ttu-id="4c560-151">После закрытия маркера приложение должно быть подготовлено к получению уведомлений о обратном вызове для этого маркера до тех пор, пока не будет возвращено окончательное **\_ состояние обратного вызова \_ \_ \_ WinHTTP** , чтобы показать, что этот маркер полностью закрыт.</span><span class="sxs-lookup"><span data-stu-id="4c560-151">After closing a handle, the application must be prepared to receive callback notifications on the handle until the final **WINHTTP\_CALLBACK\_STATUS\_HANDLE\_CLOSED** value is returned to indicate that the handle is completely closed.</span></span>

<span data-ttu-id="4c560-152">Маркер сеанса называется родителем любого используемого для создания обработчика соединения. Аналогичным образом, как маркер соединения, так и его родительский обработчик сеанса являются элементами с терминами любого маркера запроса, который используется для создания.</span><span class="sxs-lookup"><span data-stu-id="4c560-152">A session handle is termed the parent of any connection handle it used to create; likewise, both the connection handle and its parent session handle are termed parents of any request handle that the connection handle is used to create.</span></span>

<span data-ttu-id="4c560-153">При закрытии родительского маркера все его дочерние элементы косвенно становятся недействительными, даже если они не закрыты, а последующие запросы, использующие их, завершаются ошибкой с **\_ недопустимым \_ маркером**.</span><span class="sxs-lookup"><span data-stu-id="4c560-153">When a parent handle is closed, any children it has are indirectly invalidated even if not closed themselves, and subsequent requests using them fail with the error **ERROR\_INVALID\_HANDLE**.</span></span> <span data-ttu-id="4c560-154">Ожидающие асинхронные запросы не могут быть правильно выполнены.</span><span class="sxs-lookup"><span data-stu-id="4c560-154">Pending asynchronous requests cannot be relied on to complete correctly.</span></span>

<span data-ttu-id="4c560-155">На следующей диаграмме показаны функции, использующие обработчик **хинтернет** , созданный [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span><span class="sxs-lookup"><span data-stu-id="4c560-155">The following diagram shows the functions that use the **HINTERNET** handle created by [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span></span> <span data-ttu-id="4c560-156">Затененные поля представляют функции WinHTTP, которые создают дескрипторы, а в обычных полях отображаются функции, которые используют эти дескрипторы **хинтернет** .</span><span class="sxs-lookup"><span data-stu-id="4c560-156">The shaded boxes represent WinHTTP functions that create handles, and the plain boxes show the functions that use those **HINTERNET** handles.</span></span> <span data-ttu-id="4c560-157">Схема также упорядочена для отображения порядка, в котором функции WinHTTP обычно вызываются.</span><span class="sxs-lookup"><span data-stu-id="4c560-157">The diagram is also organized to show the order in which WinHTTP functions are normally called.</span></span>

![функции, создающие дескрипторы](images/art-winhttp2.png)

## <a name="explanation-of-the-handle-hierarchy"></a><span data-ttu-id="4c560-159">Объяснение иерархии маркеров</span><span class="sxs-lookup"><span data-stu-id="4c560-159">Explanation of the Handle Hierarchy</span></span>

<span data-ttu-id="4c560-160">Во-первых, создается обработчик сеанса с [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen).</span><span class="sxs-lookup"><span data-stu-id="4c560-160">First, a session handle is created with [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen).</span></span> <span data-ttu-id="4c560-161">[**Винхттпконнект**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect) требует, чтобы обработчик сеанса был первым параметром, и возвращал маркер соединения для указанного сервера.</span><span class="sxs-lookup"><span data-stu-id="4c560-161">[**WinHttpConnect**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect) requires the session handle as its first parameter and returns a connection handle for a specified server.</span></span> <span data-ttu-id="4c560-162">Обработчик запроса создается с помощью [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest), который использует маркер соединения, созданный [**винхттпконнект**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect).</span><span class="sxs-lookup"><span data-stu-id="4c560-162">A request handle is created by [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest), which uses the connection handle created by [**WinHttpConnect**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpconnect).</span></span> <span data-ttu-id="4c560-163">Если приложение выбирает Добавление дополнительных заголовков в запрос или требуется, чтобы приложение задали учетные данные для проверки подлинности, [**винхттпаддрекуессеадерс**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) и [**винхттпсеткредентиалс**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials) могут быть вызваны с помощью этого обработчика запросов.</span><span class="sxs-lookup"><span data-stu-id="4c560-163">If the application chooses to add additional headers to the request, or if is it necessary for the application to set credentials for authentication, [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) and [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials) can be called using this request handle.</span></span> <span data-ttu-id="4c560-164">Запрос отправляется функцией [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest), которая использует этот обработчик запроса.</span><span class="sxs-lookup"><span data-stu-id="4c560-164">The request is sent by [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest), which uses the request handle.</span></span> <span data-ttu-id="4c560-165">После отправки запроса дополнительные данные могут быть отправлены на сервер с помощью [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata), или приложение может сразу же перейти к [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) , чтобы указать, что больше никакой информации не будет отправлено на сервер.</span><span class="sxs-lookup"><span data-stu-id="4c560-165">After sending the request, additional data can be sent to the server using [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata), or the application can skip directly to [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) to specify that no more information is sent to the server.</span></span> <span data-ttu-id="4c560-166">На этом этапе, в зависимости от назначения приложения, обработчик запроса можно использовать для вызова [**WinHttpQueryHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryheaders), [**винхттпкуеряуссчемес**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes)или получения ресурса с помощью [**винхттпкуеридатааваилабле**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable) и [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata).</span><span class="sxs-lookup"><span data-stu-id="4c560-166">At this point, depending on the purpose of the application, the request handle can be used to call [**WinHttpQueryHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryheaders), [**WinHttpQueryAuthSchemes**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes), or retrieve a resource with [**WinHttpQueryDataAvailable**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable) and [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata).</span></span>

 

 
