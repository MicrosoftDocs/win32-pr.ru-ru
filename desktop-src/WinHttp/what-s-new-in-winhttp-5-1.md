---
description: В этом разделе описаны наиболее важные различия между WinHTTP версии 5,1 и 5,0.
ms.assetid: df3fcf27-3012-4818-b29c-b8a4dc409828
title: Новые возможности в WinHTTP 5,1
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 909d5ae8fb1d169af01782d21d2ead56b25c940c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105711071"
---
# <a name="whats-new-in-winhttp-51"></a>Новые возможности в WinHTTP 5,1

В этом разделе описаны наиболее важные различия между WinHTTP версии 5,1 и 5,0. Во многих из этих различий требуется изменение кода в приложениях, выполняющих миграцию с версии 5,0 на версию 5,1. Некоторые функции версии 5,1 доступны только начиная с Windows Server 2003 и Windows XP с пакетом обновления 2 (SP2), особенно функций, связанных с улучшением безопасности клиента на вредоносных веб-серверах.

> [!IMPORTANT]
> В выпуске WinHTTP версии 5,1 Загрузка WinHTTP 5,0 больше не доступна. Начиная с 1 октября 2004 г. Корпорация Майкрософт удалила пакет SDK для WinHTTP 5,0 с сайта MSDN и прекратил поддержку продукта для версии 5,0.

 

## <a name="dll-name-change"></a>Изменение имени DLL

Имя новой библиотеки WinHTTP 5,1 Winhttp.dll, в то время как имя библиотеки WinHTTP 5,0 Winhttp5.dll.

WinHTTP 5,0 и 5,1 могут сосуществовать в одной системе. WinHTTP 5,1 не заменяет или не устанавливают WinHTTP 5,0.

## <a name="redistribution"></a>Повторное распространение

Служба WinHTTP 5,1 доступна только в Windows Server 2003, Windows 2000 Professional с пакетом обновления 3 (SP3), Windows XP с пакетом обновления 1 (SP1) и более поздних операционных системах. Распространяемый файл модуля слияния (MSM) недоступен для WinHTTP 5,1.

## <a name="winhttprequest-progid"></a>Идентификатор ProgID WinHttpRequest

Идентификатор ProgID компонента WinHttpRequest изменился с "WinHttp. WinHttpRequest. 5" на "WinHttp. WinHttpRequest. 5.1". Идентификатор CLSID класса [**WinHttpRequest**](winhttprequest.md) также изменился.

## <a name="async-callback-behavior-change"></a>Изменение режима асинхронного обратного вызова

При вызове функций [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata), [**винхттпкуеридатааваилабле**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable) и [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata) в асинхронном режиме не следует полагаться на соответствующие параметры out *лпдвнумберофбитесвриттен*, *лпдвнумберофбитесаваилабле* и *lpdwNumberOfBytesRead* . Если вызов функции завершается асинхронно, WinHTTP не выполняет запись в эти указатели, предоставляемые кодом приложения. Вместо этого приложение должно получить эти значения с помощью параметров *лпвстатусинформатион* и *двстатусинформатионленгс* функции обратного вызова.

## <a name="changes-to-default-settings"></a>Изменения параметров по умолчанию

Изменения параметров по умолчанию включают:

-   Проверка сертификата сервера SSL включена по умолчанию в WinHTTP 5,1. WinHTTP 5,0 не обрабатывает сбои, обнаруженные при проверке сертификата сервера как неустранимых ошибок; они передаются в приложение с помощью уведомления о обратном вызове **безопасного \_ сбоя** , но не приводят к прерыванию запроса. WinHTTP 5,1 также обрабатывает ошибки проверки сертификата сервера как неустранимые ошибки, которые прерывают выполнение запроса. Приложение может указать WinHTTP на игнорирование небольшого подмножества ошибок сертификата, таких как неизвестный ЦС, недопустимый или истекший срок действия сертификата, или недопустимое имя субъекта сертификата с помощью параметра **WinHTTP \_ Option \_ Security \_ flags** .
-   Поддержка проверки подлинности паспорта отключена по умолчанию в WinHTTP 5,1. Службу поддержки Passport можно включить с помощью **\_ параметра WinHTTP \_ \_ \_ Проверка подлинности Passport** . Функция автоматического поиска учетных данных Passport в наборе ключей также отключена по умолчанию.
-   Изменение поведения перенаправления: перенаправление HTTP с защищенного **https:** URL-адрес обычного URL-адреса **http:** больше не выполняется автоматически по соображениям безопасности по умолчанию. Существует новый параметр **\_ \_ \_ политика перенаправления для параметра WinHTTP**, переопределяющий поведение перенаправления по умолчанию в WinHTTP 5,1. С помощью компонента COM **WinHttpRequest** используйте параметр New **винхттпрекуестоптион \_ енаблехттпстохттпредиректс** , чтобы разрешить перенаправления с HTTPS: на http: URL-адреса.
-   При создании файла трассировки WinHTTP доступ к нему ограничивается списком ACL, так что только администраторы могут читать или записывать файл. Учетная запись пользователя, под которой был создан TraceFile, также может изменить список ACL для предоставления другим пользователям доступа. Эта защита доступна только в файловых системах, поддерживающих безопасность; то есть NTFS, а не FAT32).
-   Начиная с Windows Server 2003 и Windows XP с пакетом обновления 2 (SP2), Отправка запросов к следующим хорошо известным, а не HTTP портам ограничена по соображениям безопасности: 21 (FTP), 25 (SMTP), 70 (GOPHER), 110 (POP3), 119 (NNTP), 143 (IMAP).
-   Начиная с Windows Server 2003 и Windows XP с пакетом обновления 2 (SP2), максимальный объем данных в заголовке, принимаемый в HTTP-ответе, по умолчанию — 64 КБ. Если серверный ответ HTTP содержит больше 64 КБ данных из общего заголовка, служба WinHTTP не сможет выполнить запрос с ошибкой Ошибка "ошибка **\_ \_ \_ серверного \_ ответа WinHTTP** ". Ограничение в 64 КБ можно переопределить с помощью параметра новый **\_ параметр \_ максимального \_ \_ \_ размера заголовка ответа** .

## <a name="ipv6-support"></a>Поддержка IPv6

В WinHTTP 5,1 добавлена поддержка протокола IP версии 6 (IPv6). Служба WinHTTP может отправить HTTP-запросы на сервер, DNS-имя которого разрешается в IPv6-адрес, и начиная с Windows Server 2003 и Windows XP с пакетом обновления 2 (SP2), службы WinHTTP также поддерживают литеральные адреса IPv6.

## <a name="new-options-in-the-cc-api-for-winhttp"></a>Новые параметры в API C/C++ для WinHTTP

WinHTTP 5,1 реализует следующие новые параметры.

<dl> " \# Определение параметров WinHTTP выход \_ \_ \_ из паспорта \_ 86"  
" \# Определение параметра WinHTTP, \_ \_ возвращаемого паспортом, \_ \_ URL-адрес 87"  
" \# Определение параметров WinHTTP, \_ \_ политика перенаправления \_ 88"  
</dl>

Начиная с Windows Server 2003 и Windows XP с пакетом обновления 2 (SP2), WinHTTP 5,1 реализует следующие новые возможности. Однако в Windows 2000 Professional с SP3 или Windows XP с пакетом обновления 1 (SP1) вызовы [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) или [**винхттпкуерйоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) с использованием этих идентификаторов параметров завершаются ошибкой:

<dl> " \# определить \_ параметр WinHTTP \_ \_ \_ время ожидания ответа 7"  
" \# определить \_ параметр WinHTTP \_ Максимальное \_ число \_ автоматических \_ перенаправлений HTTP 89"  
" \# определение \_ максимального состояния HTTP для параметра" define WinHTTP \_ \_ \_ \_ — продолжение 90 "  
" \# определить \_ параметр WinHTTP \_ максимальный \_ \_ размер заголовка ответа \_ 91"  
" \# определить \_ параметр WinHTTP \_ Max \_ ответ на максимальный \_ \_ Размер 92"  
</dl>

## <a name="new-options-in-the-winhttprequest-51-component"></a>Новые параметры в компоненте WinHttpRequest 5,1

Компонент WinHttpRequest 5,1 реализует следующие новые параметры:

<dl> "Винхттпрекуестоптион \_ ревертимперсонатионоверссл"  
"Винхттпрекуестоптион \_ енаблехттпстохттпредиректс"  
"Винхттпрекуестоптион \_ енаблепасспортаусентикатион"  
</dl>

Следующие новые параметры WinHttpRequest 5,1 доступны начиная с Windows Server 2003 и Windows XP с пакетом обновления 2 (SP2):

<dl> "Винхттпрекуестоптион \_ максаутоматикредиректс"  
"Винхттпрекуестоптион \_ максреспонсехеадерсизе"  
"Винхттпрекуестоптион \_ максреспонседраинсизе"  
"Винхттпрекуестоптионс \_ EnableHttp1 \_ 1"  
</dl>

## <a name="proxies-are-not-trusted-when-auto-logon-security-is-set-to-high"></a>Учетные записи-посредники не являются доверенными, если для параметров автоматического входа задано значение Высокая.

В WinHTTP 5,0 прокси-серверы всегда являются доверенными для автоматического входа. Эта функция больше не действует для WinHTTP 5,1, работающей в Windows Server 2003 и Windows XP с пакетом обновления 2 (SP2), если установлен параметр **\_ \_ \_ \_ высокий уровень безопасности для автоматического входа WinHTTP** .

## <a name="web-proxy-auto-discovery-autoproxy-api"></a>API автоматического обнаружения веб-прокси (автопрокси)

Чтобы упростить настройку параметров прокси-сервера для приложений на основе WinHTTP, служба WinHTTP теперь реализует протокол автоматического обнаружения веб-прокси (WPAD), который также называется *автопрокси*. Это тот же протокол, который используется веб-браузерами, например Internet Explorer, для автоматического обнаружения конфигурации прокси-сервера без необходимости указывать прокси-сервер вручную для конечного пользователя. Для поддержки автопрокси WinHTTP 5,1 реализует новую функцию C/C++, [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl), а также две вспомогательные функции: [**винхттпдетектаутопроксиконфигурл**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpdetectautoproxyconfigurl) и [**винхттпжетиепроксиконфигфоркуррентусер**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).

## <a name="known-issues"></a>Известные проблемы

Следующие проблемы существуют в WinHTTP 5,1 в Windows 2000 Professional с пакетом обновления 3 (SP3) и Windows XP с пакетом обновлений 1 (SP1). Эти проблемы разрешаются для WinHTTP, начиная с Windows Server 2003 и Windows XP с пакетом обновления 2 (SP2):

-   Если приложение использует функцию [**винхттпсеттимеаутс**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsettimeouts) или метод [**сеттимеаутс**](iwinhttprequest-settimeouts.md) в компоненте [**WinHttpRequest**](iwinhttprequest-interface.md) для установки бесконечного времени ожидания разрешения DNS, такого как параметр *двресолветимеаут* , происходит утечка дескриптора потока каждый раз, когда WinHTTP разрешает DNS-имя. При большом количестве HTTP-запросов это приводит к значительной утечке памяти. Чтобы обойти это решение, оставьте неизменным значение по умолчанию бесконечного истечения разрешения (значение 0 указывает на бесконечное время ожидания). Это настоятельно рекомендуется в любом случае, так как поддержка времени ожидания в разрешениях DNS-имен в WinHTTP является дорогостоящей с точки зрения производительности. Для Windows 2000 и более поздних версий Установка времени ожидания разрешения DNS в WinHTTP не требуется, так как базовая служба DNS реализует собственное время ожидания разрешения.
-   При обработке асинхронных запросов Служба WinHTTP не поддерживает олицетворение потоков надлежащим образом. Это приводит к сбою запросов, требующих проверки подлинности NTLM/Negotiate, если учетные данные явно не заданы с помощью функций [**винхттпсеткредентиалс**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials) или [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) .

 

 



