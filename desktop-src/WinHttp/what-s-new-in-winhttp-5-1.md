---
description: В этом разделе описаны наиболее важные различия между WinHTTP версии 5,1 и 5,0.
ms.assetid: df3fcf27-3012-4818-b29c-b8a4dc409828
title: Новые возможности в WinHTTP 5,1
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 909d5ae8fb1d169af01782d21d2ead56b25c940c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105711071"
---
# <a name="whats-new-in-winhttp-51"></a><span data-ttu-id="b177d-103">Новые возможности в WinHTTP 5,1</span><span class="sxs-lookup"><span data-stu-id="b177d-103">What's New in WinHTTP 5.1</span></span>

<span data-ttu-id="b177d-104">В этом разделе описаны наиболее важные различия между WinHTTP версии 5,1 и 5,0.</span><span class="sxs-lookup"><span data-stu-id="b177d-104">This topic describes the most important differences between WinHTTP version 5.1 and version 5.0.</span></span> <span data-ttu-id="b177d-105">Во многих из этих различий требуется изменение кода в приложениях, выполняющих миграцию с версии 5,0 на версию 5,1.</span><span class="sxs-lookup"><span data-stu-id="b177d-105">Many of these differences require code changes in applications migrating from version 5.0 to version 5.1.</span></span> <span data-ttu-id="b177d-106">Некоторые функции версии 5,1 доступны только начиная с Windows Server 2003 и Windows XP с пакетом обновления 2 (SP2), особенно функций, связанных с улучшением безопасности клиента на вредоносных веб-серверах.</span><span class="sxs-lookup"><span data-stu-id="b177d-106">Some of the features in version 5.1 are only available starting with Windows Server 2003 and Windows XP with Service Pack 2 (SP2), particularly features related to improving the security of the client against malicious Web servers.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b177d-107">В выпуске WinHTTP версии 5,1 Загрузка WinHTTP 5,0 больше не доступна.</span><span class="sxs-lookup"><span data-stu-id="b177d-107">With the release of WinHTTP Version 5.1, the WinHTTP 5.0 download is no longer available.</span></span> <span data-ttu-id="b177d-108">Начиная с 1 октября 2004 г. Корпорация Майкрософт удалила пакет SDK для WinHTTP 5,0 с сайта MSDN и прекратил поддержку продукта для версии 5,0.</span><span class="sxs-lookup"><span data-stu-id="b177d-108">As of October 1, 2004, Microsoft has removed the WinHTTP 5.0 SDK download from MSDN and has terminated product support for version 5.0.</span></span>

 

## <a name="dll-name-change"></a><span data-ttu-id="b177d-109">Изменение имени DLL</span><span class="sxs-lookup"><span data-stu-id="b177d-109">DLL Name Change</span></span>

<span data-ttu-id="b177d-110">Имя новой библиотеки WinHTTP 5,1 Winhttp.dll, в то время как имя библиотеки WinHTTP 5,0 Winhttp5.dll.</span><span class="sxs-lookup"><span data-stu-id="b177d-110">The name of the new WinHTTP 5.1 DLL is Winhttp.dll, whereas the name of the WinHTTP 5.0 DLL is Winhttp5.dll.</span></span>

<span data-ttu-id="b177d-111">WinHTTP 5,0 и 5,1 могут сосуществовать в одной системе. WinHTTP 5,1 не заменяет или не устанавливают WinHTTP 5,0.</span><span class="sxs-lookup"><span data-stu-id="b177d-111">WinHTTP 5.0 and 5.1 can coexist on the same system; WinHTTP 5.1 does not replace, or install over, WinHTTP 5.0.</span></span>

## <a name="redistribution"></a><span data-ttu-id="b177d-112">Повторное распространение</span><span class="sxs-lookup"><span data-stu-id="b177d-112">Redistribution</span></span>

<span data-ttu-id="b177d-113">Служба WinHTTP 5,1 доступна только в Windows Server 2003, Windows 2000 Professional с пакетом обновления 3 (SP3), Windows XP с пакетом обновления 1 (SP1) и более поздних операционных системах.</span><span class="sxs-lookup"><span data-stu-id="b177d-113">WinHTTP 5.1 is available only with Windows Server 2003, Windows 2000 Professional with Service Pack 3 (SP3), Windows XP with Service Pack 1 (SP1), and later operating systems.</span></span> <span data-ttu-id="b177d-114">Распространяемый файл модуля слияния (MSM) недоступен для WinHTTP 5,1.</span><span class="sxs-lookup"><span data-stu-id="b177d-114">A redistributable merge module (.msm) file is not available for WinHTTP 5.1.</span></span>

## <a name="winhttprequest-progid"></a><span data-ttu-id="b177d-115">Идентификатор ProgID WinHttpRequest</span><span class="sxs-lookup"><span data-stu-id="b177d-115">WinHttpRequest ProgID</span></span>

<span data-ttu-id="b177d-116">Идентификатор ProgID компонента WinHttpRequest изменился с "WinHttp. WinHttpRequest. 5" на "WinHttp. WinHttpRequest. 5.1".</span><span class="sxs-lookup"><span data-stu-id="b177d-116">The ProgID of the WinHttpRequest component has changed from "WinHttp.WinHttpRequest.5" to "WinHttp.WinHttpRequest.5.1".</span></span> <span data-ttu-id="b177d-117">Идентификатор CLSID класса [**WinHttpRequest**](winhttprequest.md) также изменился.</span><span class="sxs-lookup"><span data-stu-id="b177d-117">The CLSID of the [**WinHttpRequest**](winhttprequest.md) class has also changed.</span></span>

## <a name="async-callback-behavior-change"></a><span data-ttu-id="b177d-118">Изменение режима асинхронного обратного вызова</span><span class="sxs-lookup"><span data-stu-id="b177d-118">Async Callback Behavior Change</span></span>

<span data-ttu-id="b177d-119">При вызове функций [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata), [**винхттпкуеридатааваилабле**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable) и [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata) в асинхронном режиме не следует полагаться на соответствующие параметры out *лпдвнумберофбитесвриттен*, *лпдвнумберофбитесаваилабле* и *lpdwNumberOfBytesRead* .</span><span class="sxs-lookup"><span data-stu-id="b177d-119">When calling the [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata), [**WinHttpQueryDataAvailable**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable) and [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata) functions in asynchronous mode, do not rely on the respective *lpdwNumberOfBytesWritten*, *lpdwNumberOfBytesAvailable*, and *lpdwNumberOfBytesRead* OUT parameters to be set.</span></span> <span data-ttu-id="b177d-120">Если вызов функции завершается асинхронно, WinHTTP не выполняет запись в эти указатели, предоставляемые кодом приложения.</span><span class="sxs-lookup"><span data-stu-id="b177d-120">If the function call completes asynchronously, WinHTTP does not write to these pointers supplied by the application code.</span></span> <span data-ttu-id="b177d-121">Вместо этого приложение должно получить эти значения с помощью параметров *лпвстатусинформатион* и *двстатусинформатионленгс* функции обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="b177d-121">Instead, the application should retrieve these values using *lpvStatusInformation* and *dwStatusInformationLength* parameters to the callback function.</span></span>

## <a name="changes-to-default-settings"></a><span data-ttu-id="b177d-122">Изменения параметров по умолчанию</span><span class="sxs-lookup"><span data-stu-id="b177d-122">Changes to Default Settings</span></span>

<span data-ttu-id="b177d-123">Изменения параметров по умолчанию включают:</span><span class="sxs-lookup"><span data-stu-id="b177d-123">Changes to default settings include:</span></span>

-   <span data-ttu-id="b177d-124">Проверка сертификата сервера SSL включена по умолчанию в WinHTTP 5,1.</span><span class="sxs-lookup"><span data-stu-id="b177d-124">SSL server certificate verification is enabled by default in WinHTTP 5.1.</span></span> <span data-ttu-id="b177d-125">WinHTTP 5,0 не обрабатывает сбои, обнаруженные при проверке сертификата сервера как неустранимых ошибок; они передаются в приложение с помощью уведомления о обратном вызове **безопасного \_ сбоя** , но не приводят к прерыванию запроса.</span><span class="sxs-lookup"><span data-stu-id="b177d-125">WinHTTP 5.0 does not handle failures encountered when validating the server certificate as fatal errors; they are reported to the application using a **SECURE\_FAILURE** callback notification, but does not cause the request to be aborted.</span></span> <span data-ttu-id="b177d-126">WinHTTP 5,1 также обрабатывает ошибки проверки сертификата сервера как неустранимые ошибки, которые прерывают выполнение запроса.</span><span class="sxs-lookup"><span data-stu-id="b177d-126">WinHTTP 5.1, alternatively, handles server certificate validation failures as fatal errors that abort the request.</span></span> <span data-ttu-id="b177d-127">Приложение может указать WinHTTP на игнорирование небольшого подмножества ошибок сертификата, таких как неизвестный ЦС, недопустимый или истекший срок действия сертификата, или недопустимое имя субъекта сертификата с помощью параметра **WinHTTP \_ Option \_ Security \_ flags** .</span><span class="sxs-lookup"><span data-stu-id="b177d-127">The application can instruct WinHTTP to ignore a small subset of certificate errors such as unknown CA, invalid/expired certificate date, or invalid certificate subject name, using the **WINHTTP\_OPTION\_SECURITY\_FLAGS** option.</span></span>
-   <span data-ttu-id="b177d-128">Поддержка проверки подлинности паспорта отключена по умолчанию в WinHTTP 5,1.</span><span class="sxs-lookup"><span data-stu-id="b177d-128">Passport authentication support is disabled by default in WinHTTP 5.1.</span></span> <span data-ttu-id="b177d-129">Службу поддержки Passport можно включить с помощью **\_ параметра WinHTTP \_ \_ \_ Проверка подлинности Passport** .</span><span class="sxs-lookup"><span data-stu-id="b177d-129">Passport support can be enabled with the **WINHTTP\_OPTION\_CONFIGURE\_PASSPORT\_AUTH** option.</span></span> <span data-ttu-id="b177d-130">Функция автоматического поиска учетных данных Passport в наборе ключей также отключена по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="b177d-130">Automatic Passport credential look-up in the Keyring is also disabled by default.</span></span>
-   <span data-ttu-id="b177d-131">Изменение поведения перенаправления: перенаправление HTTP с защищенного **https:** URL-адрес обычного URL-адреса **http:** больше не выполняется автоматически по соображениям безопасности по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="b177d-131">Redirect behavior change: HTTP redirects from a secure **https:** URL to a regular **http:** URL are no longer followed automatically by default for security reasons.</span></span> <span data-ttu-id="b177d-132">Существует новый параметр **\_ \_ \_ политика перенаправления для параметра WinHTTP**, переопределяющий поведение перенаправления по умолчанию в WinHTTP 5,1.</span><span class="sxs-lookup"><span data-stu-id="b177d-132">There is a new option, **WINHTTP\_OPTION\_REDIRECT\_POLICY**, to override the default redirect behavior in WinHTTP 5.1.</span></span> <span data-ttu-id="b177d-133">С помощью компонента COM **WinHttpRequest** используйте параметр New **винхттпрекуестоптион \_ енаблехттпстохттпредиректс** , чтобы разрешить перенаправления с HTTPS: на http: URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b177d-133">With the **WinHttpRequest** COM component, use the new **WinHttpRequestOption\_EnableHttpsToHttpRedirects** option to enable redirects from https: to http: URLs.</span></span>
-   <span data-ttu-id="b177d-134">При создании файла трассировки WinHTTP доступ к нему ограничивается списком ACL, так что только администраторы могут читать или записывать файл.</span><span class="sxs-lookup"><span data-stu-id="b177d-134">When a WinHTTP trace file is created, access is restricted with an ACL such that only administrators can read or write the file.</span></span> <span data-ttu-id="b177d-135">Учетная запись пользователя, под которой был создан TraceFile, также может изменить список ACL для предоставления другим пользователям доступа.</span><span class="sxs-lookup"><span data-stu-id="b177d-135">The user account under which the tracefile was created can also modify the ACL to grant others access.</span></span> <span data-ttu-id="b177d-136">Эта защита доступна только в файловых системах, поддерживающих безопасность; то есть NTFS, а не FAT32).</span><span class="sxs-lookup"><span data-stu-id="b177d-136">This protection is available only on file systems which support security; that is, NTFS, not FAT32).</span></span>
-   <span data-ttu-id="b177d-137">Начиная с Windows Server 2003 и Windows XP с пакетом обновления 2 (SP2), Отправка запросов к следующим хорошо известным, а не HTTP портам ограничена по соображениям безопасности: 21 (FTP), 25 (SMTP), 70 (GOPHER), 110 (POP3), 119 (NNTP), 143 (IMAP).</span><span class="sxs-lookup"><span data-stu-id="b177d-137">Starting with Windows Server 2003 and Windows XP with SP2, sending requests to the following well-known, non-HTTP, ports is restricted for security reasons: 21 (FTP), 25 (SMTP), 70 (GOPHER), 110 (POP3), 119 (NNTP), 143 (IMAP).</span></span>
-   <span data-ttu-id="b177d-138">Начиная с Windows Server 2003 и Windows XP с пакетом обновления 2 (SP2), максимальный объем данных в заголовке, принимаемый в HTTP-ответе, по умолчанию — 64 КБ.</span><span class="sxs-lookup"><span data-stu-id="b177d-138">Starting with Windows Server 2003, and Windows XP with SP2, the maximum amount of header data WinHTTP accepts in an HTTP response is 64K, by default.</span></span> <span data-ttu-id="b177d-139">Если серверный ответ HTTP содержит больше 64 КБ данных из общего заголовка, служба WinHTTP не сможет выполнить запрос с ошибкой Ошибка "ошибка **\_ \_ \_ серверного \_ ответа WinHTTP** ".</span><span class="sxs-lookup"><span data-stu-id="b177d-139">If the server HTTP response contains more that 64K of total header data, WinHTTP fails the request with an **ERROR\_WINHTTP\_INVALID\_SERVER\_RESPONSE** error.</span></span> <span data-ttu-id="b177d-140">Ограничение в 64 КБ можно переопределить с помощью параметра новый **\_ параметр \_ максимального \_ \_ \_ размера заголовка ответа** .</span><span class="sxs-lookup"><span data-stu-id="b177d-140">This 64K limit can be overridden using the new **WINHTTP\_OPTION\_MAX\_RESPONSE\_HEADER\_SIZE** option.</span></span>

## <a name="ipv6-support"></a><span data-ttu-id="b177d-141">Поддержка IPv6</span><span class="sxs-lookup"><span data-stu-id="b177d-141">IPv6 Support</span></span>

<span data-ttu-id="b177d-142">В WinHTTP 5,1 добавлена поддержка протокола IP версии 6 (IPv6).</span><span class="sxs-lookup"><span data-stu-id="b177d-142">WinHTTP 5.1 adds support for Internet Protocol Version 6 (IPv6).</span></span> <span data-ttu-id="b177d-143">Служба WinHTTP может отправить HTTP-запросы на сервер, DNS-имя которого разрешается в IPv6-адрес, и начиная с Windows Server 2003 и Windows XP с пакетом обновления 2 (SP2), службы WinHTTP также поддерживают литеральные адреса IPv6.</span><span class="sxs-lookup"><span data-stu-id="b177d-143">WinHTTP can send HTTP requests to a server whose DNS name resolves into an IPv6 address, and starting with Windows Server 2003 and Windows XP with SP2, WinHTTP also supports IPv6 literal addresses.</span></span>

## <a name="new-options-in-the-cc-api-for-winhttp"></a><span data-ttu-id="b177d-144">Новые параметры в API C/C++ для WinHTTP</span><span class="sxs-lookup"><span data-stu-id="b177d-144">New Options in the C/C++ API for WinHTTP</span></span>

<span data-ttu-id="b177d-145">WinHTTP 5,1 реализует следующие новые параметры.</span><span class="sxs-lookup"><span data-stu-id="b177d-145">WinHTTP 5.1 implements the following new options:</span></span>

<dl> <span data-ttu-id="b177d-146">" \# Определение параметров WinHTTP выход \_ \_ \_ из паспорта \_ 86"</span><span class="sxs-lookup"><span data-stu-id="b177d-146">"\#define WINHTTP\_OPTION\_PASSPORT\_SIGN\_OUT 86"</span></span>  
<span data-ttu-id="b177d-147">" \# Определение параметра WinHTTP, \_ \_ возвращаемого паспортом, \_ \_ URL-адрес 87"</span><span class="sxs-lookup"><span data-stu-id="b177d-147">"\#define WINHTTP\_OPTION\_PASSPORT\_RETURN\_URL 87"</span></span>  
<span data-ttu-id="b177d-148">" \# Определение параметров WinHTTP, \_ \_ политика перенаправления \_ 88"</span><span class="sxs-lookup"><span data-stu-id="b177d-148">"\#define WINHTTP\_OPTION\_REDIRECT\_POLICY 88"</span></span>  
</dl>

<span data-ttu-id="b177d-149">Начиная с Windows Server 2003 и Windows XP с пакетом обновления 2 (SP2), WinHTTP 5,1 реализует следующие новые возможности.</span><span class="sxs-lookup"><span data-stu-id="b177d-149">Starting with Windows Server 2003 and Windows XP with SP2, WinHTTP 5.1 implements the following new options.</span></span> <span data-ttu-id="b177d-150">Однако в Windows 2000 Professional с SP3 или Windows XP с пакетом обновления 1 (SP1) вызовы [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) или [**винхттпкуерйоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) с использованием этих идентификаторов параметров завершаются ошибкой:</span><span class="sxs-lookup"><span data-stu-id="b177d-150">On Windows 2000 Professional with SP3 or Windows XP with SP1, however, calls to [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) or [**WinHttpQueryOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) with these option IDs fail:</span></span>

<dl> <span data-ttu-id="b177d-151">" \# определить \_ параметр WinHTTP \_ \_ \_ время ожидания ответа 7"</span><span class="sxs-lookup"><span data-stu-id="b177d-151">"\#define WINHTTP\_OPTION\_RECEIVE\_RESPONSE\_TIMEOUT 7"</span></span>  
<span data-ttu-id="b177d-152">" \# определить \_ параметр WinHTTP \_ Максимальное \_ число \_ автоматических \_ перенаправлений HTTP 89"</span><span class="sxs-lookup"><span data-stu-id="b177d-152">"\#define WINHTTP\_OPTION\_MAX\_HTTP\_AUTOMATIC\_REDIRECTS 89"</span></span>  
<span data-ttu-id="b177d-153">" \# определение \_ максимального состояния HTTP для параметра" define WinHTTP \_ \_ \_ \_ — продолжение 90 "</span><span class="sxs-lookup"><span data-stu-id="b177d-153">"\#define WINHTTP\_OPTION\_MAX\_HTTP\_STATUS\_CONTINUE 90"</span></span>  
<span data-ttu-id="b177d-154">" \# определить \_ параметр WinHTTP \_ максимальный \_ \_ размер заголовка ответа \_ 91"</span><span class="sxs-lookup"><span data-stu-id="b177d-154">"\#define WINHTTP\_OPTION\_MAX\_RESPONSE\_HEADER\_SIZE 91"</span></span>  
<span data-ttu-id="b177d-155">" \# определить \_ параметр WinHTTP \_ Max \_ ответ на максимальный \_ \_ Размер 92"</span><span class="sxs-lookup"><span data-stu-id="b177d-155">"\#define WINHTTP\_OPTION\_MAX\_RESPONSE\_DRAIN\_SIZE 92"</span></span>  
</dl>

## <a name="new-options-in-the-winhttprequest-51-component"></a><span data-ttu-id="b177d-156">Новые параметры в компоненте WinHttpRequest 5,1</span><span class="sxs-lookup"><span data-stu-id="b177d-156">New Options in the WinHttpRequest 5.1 Component</span></span>

<span data-ttu-id="b177d-157">Компонент WinHttpRequest 5,1 реализует следующие новые параметры:</span><span class="sxs-lookup"><span data-stu-id="b177d-157">The WinHttpRequest 5.1 component implements the following new options:</span></span>

<dl> <span data-ttu-id="b177d-158">"Винхттпрекуестоптион \_ ревертимперсонатионоверссл"</span><span class="sxs-lookup"><span data-stu-id="b177d-158">"WinHttpRequestOption\_RevertImpersonationOverSsl"</span></span>  
<span data-ttu-id="b177d-159">"Винхттпрекуестоптион \_ енаблехттпстохттпредиректс"</span><span class="sxs-lookup"><span data-stu-id="b177d-159">"WinHttpRequestOption\_EnableHttpsToHttpRedirects"</span></span>  
<span data-ttu-id="b177d-160">"Винхттпрекуестоптион \_ енаблепасспортаусентикатион"</span><span class="sxs-lookup"><span data-stu-id="b177d-160">"WinHttpRequestOption\_EnablePassportAuthentication"</span></span>  
</dl>

<span data-ttu-id="b177d-161">Следующие новые параметры WinHttpRequest 5,1 доступны начиная с Windows Server 2003 и Windows XP с пакетом обновления 2 (SP2):</span><span class="sxs-lookup"><span data-stu-id="b177d-161">The following new WinHttpRequest 5.1 options are available starting with Windows Server 2003 and Windows XP with SP2:</span></span>

<dl> <span data-ttu-id="b177d-162">"Винхттпрекуестоптион \_ максаутоматикредиректс"</span><span class="sxs-lookup"><span data-stu-id="b177d-162">"WinHttpRequestOption\_MaxAutomaticRedirects"</span></span>  
<span data-ttu-id="b177d-163">"Винхттпрекуестоптион \_ максреспонсехеадерсизе"</span><span class="sxs-lookup"><span data-stu-id="b177d-163">"WinHttpRequestOption\_MaxResponseHeaderSize"</span></span>  
<span data-ttu-id="b177d-164">"Винхттпрекуестоптион \_ максреспонседраинсизе"</span><span class="sxs-lookup"><span data-stu-id="b177d-164">"WinHttpRequestOption\_MaxResponseDrainSize"</span></span>  
<span data-ttu-id="b177d-165">"Винхттпрекуестоптионс \_ EnableHttp1 \_ 1"</span><span class="sxs-lookup"><span data-stu-id="b177d-165">"WinHttpRequestOptions\_EnableHttp1\_1"</span></span>  
</dl>

## <a name="proxies-are-not-trusted-when-auto-logon-security-is-set-to-high"></a><span data-ttu-id="b177d-166">Учетные записи-посредники не являются доверенными, если для параметров автоматического входа задано значение Высокая.</span><span class="sxs-lookup"><span data-stu-id="b177d-166">Proxies Are Not Trusted When Auto-Logon Security is Set to High</span></span>

<span data-ttu-id="b177d-167">В WinHTTP 5,0 прокси-серверы всегда являются доверенными для автоматического входа.</span><span class="sxs-lookup"><span data-stu-id="b177d-167">In WinHTTP 5.0, proxy servers are always trusted for auto-logon.</span></span> <span data-ttu-id="b177d-168">Эта функция больше не действует для WinHTTP 5,1, работающей в Windows Server 2003 и Windows XP с пакетом обновления 2 (SP2), если установлен параметр **\_ \_ \_ \_ высокий уровень безопасности для автоматического входа WinHTTP** .</span><span class="sxs-lookup"><span data-stu-id="b177d-168">This is no longer valid for WinHTTP 5.1 running on Windows Server 2003 and Windows XP with SP2 when the **WINHTTP\_AUTOLOGON\_SECURITY\_LEVEL\_HIGH** policy option is set.</span></span>

## <a name="web-proxy-auto-discovery-autoproxy-api"></a><span data-ttu-id="b177d-169">API автоматического обнаружения веб-прокси (автопрокси)</span><span class="sxs-lookup"><span data-stu-id="b177d-169">Web Proxy Auto-Discovery (AutoProxy) API</span></span>

<span data-ttu-id="b177d-170">Чтобы упростить настройку параметров прокси-сервера для приложений на основе WinHTTP, служба WinHTTP теперь реализует протокол автоматического обнаружения веб-прокси (WPAD), который также называется *автопрокси*.</span><span class="sxs-lookup"><span data-stu-id="b177d-170">To ease the configuration of proxy settings for WinHTTP-based applications, WinHTTP now implements the Web Proxy Auto-Discovery (WPAD) protocol, also referred to as *autoproxy*.</span></span> <span data-ttu-id="b177d-171">Это тот же протокол, который используется веб-браузерами, например Internet Explorer, для автоматического обнаружения конфигурации прокси-сервера без необходимости указывать прокси-сервер вручную для конечного пользователя.</span><span class="sxs-lookup"><span data-stu-id="b177d-171">This is the same protocol that web browsers, such as Internet Explorer, implement to discover the proxy configuration automatically without requiring an end-user to specify a proxy server manually.</span></span> <span data-ttu-id="b177d-172">Для поддержки автопрокси WinHTTP 5,1 реализует новую функцию C/C++, [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl), а также две вспомогательные функции: [**винхттпдетектаутопроксиконфигурл**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpdetectautoproxyconfigurl) и [**винхттпжетиепроксиконфигфоркуррентусер**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span><span class="sxs-lookup"><span data-stu-id="b177d-172">To support autoproxy, WinHTTP 5.1 implements a new C/C++ function, [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl), plus two supporting functions, [**WinHttpDetectAutoProxyConfigUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpdetectautoproxyconfigurl) and [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span></span>

## <a name="known-issues"></a><span data-ttu-id="b177d-173">Известные проблемы</span><span class="sxs-lookup"><span data-stu-id="b177d-173">Known Issues</span></span>

<span data-ttu-id="b177d-174">Следующие проблемы существуют в WinHTTP 5,1 в Windows 2000 Professional с пакетом обновления 3 (SP3) и Windows XP с пакетом обновлений 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="b177d-174">The following issues are known to exist in WinHTTP 5.1 on Windows 2000 Professional with SP3 and Windows XP with SP1.</span></span> <span data-ttu-id="b177d-175">Эти проблемы разрешаются для WinHTTP, начиная с Windows Server 2003 и Windows XP с пакетом обновления 2 (SP2):</span><span class="sxs-lookup"><span data-stu-id="b177d-175">These issues are resolved for WinHTTP starting with Windows Server 2003 and Windows XP with SP2:</span></span>

-   <span data-ttu-id="b177d-176">Если приложение использует функцию [**винхттпсеттимеаутс**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsettimeouts) или метод [**сеттимеаутс**](iwinhttprequest-settimeouts.md) в компоненте [**WinHttpRequest**](iwinhttprequest-interface.md) для установки бесконечного времени ожидания разрешения DNS, такого как параметр *двресолветимеаут* , происходит утечка дескриптора потока каждый раз, когда WinHTTP разрешает DNS-имя.</span><span class="sxs-lookup"><span data-stu-id="b177d-176">If the application uses the [**WinHttpSetTimeouts**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsettimeouts) function or the [**SetTimeouts**](iwinhttprequest-settimeouts.md) method on the [**WinHttpRequest**](iwinhttprequest-interface.md) component to set a non-infinite DNS resolve timeout such as the *dwResolveTimeout* parameter, a thread handle leak occurs each time WinHTTP resolves a DNS name.</span></span> <span data-ttu-id="b177d-177">При большом количестве HTTP-запросов это приводит к значительной утечке памяти.</span><span class="sxs-lookup"><span data-stu-id="b177d-177">Over a large number of HTTP requests, this causes a significant memory leak.</span></span> <span data-ttu-id="b177d-178">Чтобы обойти это решение, оставьте неизменным значение по умолчанию бесконечного истечения разрешения (значение 0 указывает на бесконечное время ожидания).</span><span class="sxs-lookup"><span data-stu-id="b177d-178">The workaround is to leave the default infinite resolve timeout setting unchanged (a value of 0 specifies an infinite timeout).</span></span> <span data-ttu-id="b177d-179">Это настоятельно рекомендуется в любом случае, так как поддержка времени ожидания в разрешениях DNS-имен в WinHTTP является дорогостоящей с точки зрения производительности.</span><span class="sxs-lookup"><span data-stu-id="b177d-179">This is strongly recommended in any case as supporting timeouts on DNS name resolutions in WinHTTP is expensive in terms of performance.</span></span> <span data-ttu-id="b177d-180">Для Windows 2000 и более поздних версий Установка времени ожидания разрешения DNS в WinHTTP не требуется, так как базовая служба DNS реализует собственное время ожидания разрешения.</span><span class="sxs-lookup"><span data-stu-id="b177d-180">For Windows 2000 and later, setting a DNS resolve timeout in WinHTTP is unnecessary as the underlying DNS client service implements its own resolve timeout.</span></span>
-   <span data-ttu-id="b177d-181">При обработке асинхронных запросов Служба WinHTTP не поддерживает олицетворение потоков надлежащим образом.</span><span class="sxs-lookup"><span data-stu-id="b177d-181">When processing asynchronous requests, WinHTTP does not handle thread impersonation properly.</span></span> <span data-ttu-id="b177d-182">Это приводит к сбою запросов, требующих проверки подлинности NTLM/Negotiate, если учетные данные явно не заданы с помощью функций [**винхттпсеткредентиалс**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials) или [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) .</span><span class="sxs-lookup"><span data-stu-id="b177d-182">This causes requests that require NTLM/Negotiate authentication to fail, unless credentials are explicitly given using the [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials) or [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) functions.</span></span>

 

 



