---
description: Если файл автоматической конфигурации прокси-сервера не был развернут в локальной сети, WinHttpGetProxyForUrl не сможет найти прокси-сервер.
ms.assetid: a170e63a-8586-47df-af5e-4ee3621795b2
title: Обнаружение без файла автоматической настройки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b6a5ec281c2ef74e2a377cecbd30f16cbc49bd79
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105713202"
---
# <a name="discovery-without-an-auto-config-file"></a><span data-ttu-id="c5b25-103">Обнаружение без файла автоматической настройки</span><span class="sxs-lookup"><span data-stu-id="c5b25-103">Discovery Without an Auto-Config File</span></span>

<span data-ttu-id="c5b25-104">Если файл автоматической конфигурации прокси-сервера не был развернут в локальной сети, [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) не сможет найти прокси-сервер.</span><span class="sxs-lookup"><span data-stu-id="c5b25-104">If a proxy auto-configuration file has not been deployed on the local network, [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) cannot find a proxy server.</span></span> <span data-ttu-id="c5b25-105">В случае сбоя **WinHttpGetProxyForUrl** существует несколько возможных стратегий отката для получения работоспособной конфигурации прокси-сервера в зависимости от среды выполнения.</span><span class="sxs-lookup"><span data-stu-id="c5b25-105">If **WinHttpGetProxyForUrl** fails, there are several possible fall-back strategies for obtaining a viable proxy configuration, depending on its runtime environment.</span></span> <span data-ttu-id="c5b25-106">К ним относятся запросы настройки прокси-сервера через пользовательский интерфейс, необходимость сохранения конфигурации прокси-сервера в реестре с помощью служебной программы WinHTTP "ProxyCfg.exe" или с помощью [**винхттпжетиепроксиконфигфоркуррентусер**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) для проверки того, указан ли прокси-сервер в параметрах Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="c5b25-106">These include prompting for the proxy setting through a user interface, requiring someone to store the proxy configuration in the registry using the WinHTTP "ProxyCfg.exe" utility, or using [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) to check whether a proxy server is listed in Internet Explorer's settings.</span></span>

<span data-ttu-id="c5b25-107">Возможно, отсутствует файл автоматической настройки прокси-сервера, так как у клиента есть прямое подключение к Интернету, например через поставщика услуг Интернета, и не требуется прокси-сервер.</span><span class="sxs-lookup"><span data-stu-id="c5b25-107">It is possible that there is no proxy auto-configuration file because the client has a direct Internet connection, such as through an ISP, and does not need a proxy server.</span></span>

<span data-ttu-id="c5b25-108">С другой стороны, может потребоваться прокси-сервер, но локальная сеть может не поддерживать WPAD.</span><span class="sxs-lookup"><span data-stu-id="c5b25-108">A proxy server may be required, on the other hand, but the local network may not support WPAD.</span></span> <span data-ttu-id="c5b25-109">В этом случае конфигурация прокси-сервера должна быть получена от пользователя или находиться в другом месте на клиентском компьютере.</span><span class="sxs-lookup"><span data-stu-id="c5b25-109">In this case, the proxy configuration must be obtained from the user or found somewhere on the client machine.</span></span>

<span data-ttu-id="c5b25-110">Приложение на базе WinHTTP, работающее в среде сервера среднего уровня, например в приложении COM+ или ASP, должно полагаться на администратора сервера, настроив конфигурацию прокси-сервера по умолчанию в реестре с помощью служебной программы "ProxyCfg.exe".</span><span class="sxs-lookup"><span data-stu-id="c5b25-110">A WinHTTP-based application running in a middle-tier server environment, such as a COM+ or ASP application, should rely on a server administrator setting a default proxy configuration in the registry using the "ProxyCfg.exe" utility.</span></span> <span data-ttu-id="c5b25-111">Эти сведения о конфигурации по умолчанию можно получить с помощью функции [**винхттпжетдефаултпроксиконфигуратион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetdefaultproxyconfiguration) или просто указав в вызове [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) флаг **\_ \_ \_ настройки типа доступа WinHTTP** .</span><span class="sxs-lookup"><span data-stu-id="c5b25-111">This default configuration information can then be retrieved either by using the [**WinHttpGetDefaultProxyConfiguration**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetdefaultproxyconfiguration) function, or simply by specifying the **WINHTTP\_ACCESS\_TYPE\_PRECONFIG** flag in the [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) call.</span></span>

<span data-ttu-id="c5b25-112">С другой стороны, приложение WinHTTP, работающее на клиентском компьютере клиента, может попытаться проверить параметры прокси Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="c5b25-112">On the other hand, a WinHTTP application running on a client desktop machine can attempt to examine Internet Explorer's proxy settings.</span></span> <span data-ttu-id="c5b25-113">[**Винхттпжетиепроксиконфигфоркуррентусер**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) заполняет структуру [**\_ \_ \_ \_ \_ конфигурации прокси-сервера WinHTTP текущего**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) пользователя, используя параметры прокси Internet Explorer текущего пользователя для текущего активного подключения (коммутируемое подключение, VPN или локальная сеть).</span><span class="sxs-lookup"><span data-stu-id="c5b25-113">[**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) fills in a caller-supplied [**WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) structure with the current user's Internet Explorer proxy settings for the current active connection (dial-up, VPN or LAN).</span></span> <span data-ttu-id="c5b25-114">Такая конфигурация может указывать на то, что используется автоматическое обнаружение или может указываться URL-адрес для файла автоматической конфигурации прокси-сервера, или же он может указывать на действующий прокси-сервер или сочетание трех.</span><span class="sxs-lookup"><span data-stu-id="c5b25-114">This configuration may indicate that auto-detection is used, or it may specify a URL for a proxy auto-configuration file, or it may specify an actual proxy server to use, or it may specify a combination of the three.</span></span> <span data-ttu-id="c5b25-115">Если эти сведения включают URL-адрес PAC или прокси-сервер, то приложение WinHTTP может использовать их.</span><span class="sxs-lookup"><span data-stu-id="c5b25-115">If this information includes a PAC URL or a proxy server, the WinHTTP application can try using those.</span></span>

<span data-ttu-id="c5b25-116">Пример, в котором используются функции [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) и [**винхттпжетиепроксиконфигфоркуррентусер**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) , можно найти в примерах WinHTTP в пакете SDK для платформы.</span><span class="sxs-lookup"><span data-stu-id="c5b25-116">A sample that uses the [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) and [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) functions can be found in the Platform Software Development Kit (SDK) WinHTTP samples.</span></span>

 

 



