---
description: Кэш автопрокси
ms.assetid: 087104e8-ab38-4ba4-be70-23a5ea2bb130
title: Кэш автопрокси
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6d0492bec116bad8a82da0e961cf6d851d27c787
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105712899"
---
# <a name="autoproxy-cache"></a><span data-ttu-id="d3554-103">Кэш автопрокси</span><span class="sxs-lookup"><span data-stu-id="d3554-103">AutoProxy Cache</span></span>

<span data-ttu-id="d3554-104">Функция [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) выполняет поиск по запросу автопрокси для каждого запроса на основе указанного URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="d3554-104">The [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) function performs autoproxy lookup on a per-request basis for the specified URL.</span></span> <span data-ttu-id="d3554-105">Если возвращается несколько прокси-серверов, клиентские приложения должны протестировать каждый прокси перед отправкой запроса (Дополнительные сведения см. в разделе " [единственный прокси-сервер сейчас поддерживается](autoproxy-issues-in-winhttp.md) " в статье проблемы с автопрокси в WinHTTP).</span><span class="sxs-lookup"><span data-stu-id="d3554-105">If multiple proxies are returned, client applications should test each proxy before sending the request (for more information, see the [Only One Proxy Server is Currently Supported](autoproxy-issues-in-winhttp.md) section in AutoProxy Issues in WinHTTP).</span></span> <span data-ttu-id="d3554-106">Сведения в этом разделе применяются к вызовам **WinHttpGetProxyForUrl** , когда клиент указывает автоматическое обнаружение прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="d3554-106">The information in this topic applies to calls to **WinHttpGetProxyForUrl** when the client specifies automatic proxy discovery.</span></span>

<span data-ttu-id="d3554-107">[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) при необходимости находит URL-адрес автопрокси и скачивает сценарий автопрокси с этого сайта.</span><span class="sxs-lookup"><span data-stu-id="d3554-107">[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) optionally locates the autoproxy URL and downloads the autoproxy script from that site.</span></span> <span data-ttu-id="d3554-108">WinHttp использует скрипт автопрокси для нахождение прокси-серверов.</span><span class="sxs-lookup"><span data-stu-id="d3554-108">WinHttp uses the autoproxy script to locate the proxy servers.</span></span> <span data-ttu-id="d3554-109">URL-адрес автопрокси и скрипт автопрокси кэшируются для указанного сеанса.</span><span class="sxs-lookup"><span data-stu-id="d3554-109">Both the autoproxy URL and the autoproxy script are cached for the specified session.</span></span> <span data-ttu-id="d3554-110">Для каждого сеанса кэшируются только один URL-адрес и сценарий для автопрокси.</span><span class="sxs-lookup"><span data-stu-id="d3554-110">Only one autoproxy URL and script are cached for each session.</span></span> <span data-ttu-id="d3554-111">Как правило, скрипт и URL-адрес автопрокси кэшируются до тех пор, пока не изменится IP-адрес, связанный с компьютером.</span><span class="sxs-lookup"><span data-stu-id="d3554-111">Typically, the autoproxy script and URL are cached until the IP address associated with the computer changes.</span></span> <span data-ttu-id="d3554-112">Если при вызове **WinHttpGetProxyForUrl** обнаружен новый IP-адрес, вызов попытается найти новый URL-адрес и скрипт для автопрокси-сервера и кэшировать результаты.</span><span class="sxs-lookup"><span data-stu-id="d3554-112">If a new IP address is detected during a call to **WinHttpGetProxyForUrl**, the call will attempt to locate a new autoproxy URL and script and cache the results.</span></span> <span data-ttu-id="d3554-113">В каждом сеансе должно быть разрешено только одного пользователя, чтобы кэшированные данные не были доступны другим пользователям на компьютере.</span><span class="sxs-lookup"><span data-stu-id="d3554-113">Only one user should be allowed per session, so that the cached data is not shared with other users on the computer.</span></span> <span data-ttu-id="d3554-114">Дополнительные сведения см. в статье [Общие сведения о сеансах WinHTTP](winhttp-sessions-overview.md).</span><span class="sxs-lookup"><span data-stu-id="d3554-114">For more information, see [WinHTTP Sessions Overview](winhttp-sessions-overview.md).</span></span>

<span data-ttu-id="d3554-115">Если служба вне процесса активна при вызове [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) , кэшированный URL-адрес и скрипт для автопрокси доступны для всего компьютера.</span><span class="sxs-lookup"><span data-stu-id="d3554-115">If the out-of-process service is active when [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) is called, the cached autoproxy URL and script are available to the whole computer.</span></span> <span data-ttu-id="d3554-116">Однако если используется служба вне процесса и флаг **фаутологонифчалленжед** в структуре *паутопроксйоптионс* имеет значение true, то URL-адрес и сценарий для автопрокси не кэшируются.</span><span class="sxs-lookup"><span data-stu-id="d3554-116">However, if the out-of-process service is used, and the **fAutoLogonIfChallenged** flag in the *pAutoProxyOptions* structure is true, then the autoproxy URL and script are not cached.</span></span> <span data-ttu-id="d3554-117">Поэтому вызов **WinHttpGetProxyForUrl** с набором элементов **фаутологонифчалленжед** , равным **true** , приводит к дополнительным операциям с дополнительной нагрузкой, которые могут повлиять на производительность.</span><span class="sxs-lookup"><span data-stu-id="d3554-117">Therefore, calling **WinHttpGetProxyForUrl** with the **fAutoLogonIfChallenged** member set to **TRUE** results in additional overhead operations that may affect performance.</span></span> <span data-ttu-id="d3554-118">Для повышения производительности можно использовать следующие шаги.</span><span class="sxs-lookup"><span data-stu-id="d3554-118">The following steps can be used to improve performance.</span></span>

<span data-ttu-id="d3554-119">**Для повышения производительности**</span><span class="sxs-lookup"><span data-stu-id="d3554-119">**To improve performance**</span></span>

1.  <span data-ttu-id="d3554-120">Вызовите [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) , указав для параметра фаутологонифчалленжед значение **false**.</span><span class="sxs-lookup"><span data-stu-id="d3554-120">Call [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) with the fAutoLogonIfChallenged parameter set to **false**.</span></span> <span data-ttu-id="d3554-121">URL-адрес и скрипт для автопрокси кэшируются для будущих вызовов **WinHttpGetProxyForUrl**.</span><span class="sxs-lookup"><span data-stu-id="d3554-121">The autoproxy URL and script are cached for future calls to **WinHttpGetProxyForUrl**.</span></span>
2.  <span data-ttu-id="d3554-122">Если шаг 1 завершается ошибкой, при **ошибке \_ \_ входа WinHTTP \_ возникла ошибка**, затем вызовите [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) , указав для члена **фаутологонифчалленжед** значение **true**.</span><span class="sxs-lookup"><span data-stu-id="d3554-122">If Step 1 fails, with **ERROR\_WINHTTP\_LOGIN\_FAILURE**, then call [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) with the **fAutoLogonIfChallenged** member set to **TRUE**.</span></span>

 

 



