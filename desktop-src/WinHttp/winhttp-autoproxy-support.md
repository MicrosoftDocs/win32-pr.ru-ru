---
description: Чтобы упростить настройку параметров прокси-сервера, WinHTTP 5,1 реализует протокол автоматического обнаружения веб-прокси (WPAD), также известный как автопрокси.
ms.assetid: f766f37b-a1aa-420f-ac3b-d03485630d88
title: Поддержка автопрокси WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 26584bd0b1809f3866ed42adc7198275f40f991c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105701581"
---
# <a name="winhttp-autoproxy-support"></a><span data-ttu-id="2480b-103">Поддержка автопрокси WinHTTP</span><span class="sxs-lookup"><span data-stu-id="2480b-103">WinHTTP AutoProxy Support</span></span>

<span data-ttu-id="2480b-104">Чтобы упростить настройку параметров прокси-сервера, WinHTTP 5,1 реализует протокол автоматического обнаружения веб-прокси (WPAD), также известный как автопрокси.</span><span class="sxs-lookup"><span data-stu-id="2480b-104">To ease the configuration of proxy settings, WinHTTP 5.1 implements the Web Proxy Auto-Discovery (WPAD) protocol, also known as autoproxy.</span></span>

## <a name="overview-of-autoproxy"></a><span data-ttu-id="2480b-105">Общие сведения об автопрокси</span><span class="sxs-lookup"><span data-stu-id="2480b-105">Overview of AutoProxy</span></span>

<span data-ttu-id="2480b-106">Приложения и компоненты, использующие WinHTTP для отправки HTTP-запросов, должны обеспечить правильную настройку прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="2480b-106">Applications and components that use WinHTTP to send HTTP requests should ensure that the proxy configuration is set correctly.</span></span> <span data-ttu-id="2480b-107">Если у клиента нет прямого подключения к Интернету, HTTP-запрос обычно должен отправляться через сервер веб-прокси, соединяющий локальную сеть клиента с Интернетом (например, это часто случается для клиентов в корпоративной локальной сети).</span><span class="sxs-lookup"><span data-stu-id="2480b-107">Unless the client has a direct Internet connection, an HTTP request should normally be sent through a web proxy server that connects the client's local network to the Internet (for example, this is often the case for Web clients on a corporate LAN).</span></span> <span data-ttu-id="2480b-108">Для серверных приложений конфигурация прокси-сервера обычно управляется администратором сервера с помощью служебной программы ProxyCfg.exe WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="2480b-108">For server-based applications, the proxy configuration is normally managed by the server's administrator using the WinHTTP ProxyCfg.exe utility.</span></span> <span data-ttu-id="2480b-109">Администратор сервера знает имя прокси-сервера заранее и использует ProxyCfg.exe для записи этого параметра в реестре, где служба WinHTTP может его найти.</span><span class="sxs-lookup"><span data-stu-id="2480b-109">The server administrator knows the name of the proxy server in advance and uses ProxyCfg.exe to record this setting in the registry where WinHTTP can look it up.</span></span> <span data-ttu-id="2480b-110">Однако требуется, чтобы пользователи клиентского рабочего стола вручную настроили параметры прокси-сервера WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="2480b-110">However, requiring client desktop end-users to manually configure WinHTTP proxy settings is problematic.</span></span> <span data-ttu-id="2480b-111">Конечному пользователю может быть неизвестно имя прокси-сервера; необходимость запуска программы ProxyCfg.exe может быть недоступна для Организации.</span><span class="sxs-lookup"><span data-stu-id="2480b-111">The end-user may not know the name of the proxy server; requiring the end-user to run the ProxyCfg.exe utility can be a support burden for an organization.</span></span> <span data-ttu-id="2480b-112">Для поддержки хорошего взаимодействия с пользователем веб-клиентское приложение должно определять конфигурацию прокси-сервера без вмешательства пользователя.</span><span class="sxs-lookup"><span data-stu-id="2480b-112">To support a good user experience, a web-enabled client application should determine the proxy configuration without user intervention.</span></span>

<span data-ttu-id="2480b-113">Чтобы упростить настройку параметров прокси-сервера для приложений на базе WinHTTP, служба WinHTTP теперь реализует [протокол автоматического обнаружения веб-прокси (WPAD)](https://tools.ietf.org/html/draft-ietf-wrec-wpad-01), который часто называют *автопрокси*.</span><span class="sxs-lookup"><span data-stu-id="2480b-113">To make configuring the proxy settings for WinHTTP-based applications easier, WinHTTP now implements the [Web Proxy Auto-Discovery (WPAD) protocol](https://tools.ietf.org/html/draft-ietf-wrec-wpad-01), often referred to as *autoproxy*.</span></span> <span data-ttu-id="2480b-114">Это тот же протокол, который реализуется веб-браузерами для автоматического обнаружения конфигурации прокси, не требуя от пользователя указывать прокси-сервер вручную.</span><span class="sxs-lookup"><span data-stu-id="2480b-114">This is the same protocol that web browsers implement to automatically discover the proxy configuration without requiring an end-user to specify a proxy server manually.</span></span> <span data-ttu-id="2480b-115">Эта функция доступна начиная с версии WinHTTP 5,1 в Windows 2000 с пакетом обновления 3 (SP1), Windows XP с пакетом обновления 1 и Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="2480b-115">This feature is available starting with WinHTTP version 5.1 in Windows 2000 Service Pack 3, Windows XP Service Pack 1 and Windows Server 2003.</span></span> <span data-ttu-id="2480b-116">Обратите внимание, что хотя Microsoft Internet Explorer и Microsoft WinHTTP поддерживают WPAD, спецификация никогда не выходит за пределы "Интернет-черновиков" и срок ее действия истекает 2001 мая.</span><span class="sxs-lookup"><span data-stu-id="2480b-116">Note that although both Microsoft Internet Explorer and Microsoft WinHTTP support WPAD, the specification never progressed beyond the "Internet-Draft" stage, and expired in May 2001.</span></span>

<span data-ttu-id="2480b-117">Протокол WPAD работает следующим образом.</span><span class="sxs-lookup"><span data-stu-id="2480b-117">The WPAD protocol works as follows:</span></span>

1.  <span data-ttu-id="2480b-118">При использовании сетевых протоколов DHCP и/или DNS происходит обнаружение URL-адреса файла автоматической настройки прокси-сервера (PAC).</span><span class="sxs-lookup"><span data-stu-id="2480b-118">Using the DHCP and/or DNS network protocols, the URL of a Proxy Auto-Configuration (PAC) file is discovered.</span></span> <span data-ttu-id="2480b-119">URL-адрес определяет файл PAC в локальной сети клиента.</span><span class="sxs-lookup"><span data-stu-id="2480b-119">The URL identifies a PAC file on the client's local network.</span></span> <span data-ttu-id="2480b-120">WinHTTP поддерживает только URL-адреса PAC "http:" и "https:"; Например, он не поддерживает URL-адреса "file:".</span><span class="sxs-lookup"><span data-stu-id="2480b-120">WinHTTP supports only "http:" and "https:" PAC URLs; it does not, for example, support "file:" URLS.</span></span>
2.  <span data-ttu-id="2480b-121">Файл PAC загружается и при необходимости кэшируется на клиентском компьютере.</span><span class="sxs-lookup"><span data-stu-id="2480b-121">The PAC file is downloaded and optionally cached on the client's computer.</span></span> <span data-ttu-id="2480b-122">PAC-файл — это исполняемый скрипт, создающий список из одного или нескольких прокси-серверов по заданному имени и URL-адресу целевого узла.</span><span class="sxs-lookup"><span data-stu-id="2480b-122">The PAC file is an executable script that generates a list of one or more proxy servers given a target host name and URL.</span></span> <span data-ttu-id="2480b-123">WinHTTP поддерживает только файлы PAC на основе ECMAScript.</span><span class="sxs-lookup"><span data-stu-id="2480b-123">WinHTTP supports only ECMAScript-based PAC files.</span></span>
3.  <span data-ttu-id="2480b-124">В каждом HTTP-запросе выполняется код скрипта PAC с именем узла и URL-адресом запроса HTTP, переданным в качестве параметров.</span><span class="sxs-lookup"><span data-stu-id="2480b-124">On each HTTP request, the PAC script code is executed, with the host name and URL of the HTTP request passed in as parameters.</span></span> <span data-ttu-id="2480b-125">Службы WinHTTP предполагают, что код сценария PAC содержит функцию с именем **финдпроксифорурл** в следующем виде:</span><span class="sxs-lookup"><span data-stu-id="2480b-125">WinHTTP expects the PAC script code to contain a function called **FindProxyForURL**, in the form:</span></span>
4.  ``` syntax
    FindProxyForURL( url, host );
    ```

    <span data-ttu-id="2480b-126">Эта функция вычислит список из одного или нескольких прокси-серверов, которые могут использоваться клиентом HTTP для передачи запроса.</span><span class="sxs-lookup"><span data-stu-id="2480b-126">This function computes a list of one or more proxy servers that can be used by the HTTP client in order to transmit the request.</span></span> <span data-ttu-id="2480b-127">Если сценарий PAC определяет, что HTTP-клиент может связаться с целевым сервером напрямую, не используя прокси-сервер, он указывает, что используется специальное возвращаемое значение.</span><span class="sxs-lookup"><span data-stu-id="2480b-127">If the PAC script determines that the HTTP client can reach the target server directly without going through a proxy server at all, it indicates this using a special return value.</span></span>

## <a name="autoproxy-topics"></a><span data-ttu-id="2480b-128">Разделы по автопрокси</span><span class="sxs-lookup"><span data-stu-id="2480b-128">AutoProxy Topics</span></span>

-   [<span data-ttu-id="2480b-129">Функции автопрокси WinHTTP</span><span class="sxs-lookup"><span data-stu-id="2480b-129">WinHTTP AutoProxy Functions</span></span>](winhttp-autoproxy-api.md)
-   [<span data-ttu-id="2480b-130">Обнаружение без файла автоматической настройки</span><span class="sxs-lookup"><span data-stu-id="2480b-130">Discovery Without an Auto-Config File</span></span>](discovery-without-an-auto-config-file.md)
-   [<span data-ttu-id="2480b-131">Проблемы с автопрокси в WinHTTP</span><span class="sxs-lookup"><span data-stu-id="2480b-131">AutoProxy Issues in WinHTTP</span></span>](autoproxy-issues-in-winhttp.md)
-   [<span data-ttu-id="2480b-132">Настройка конфигураций прокси-сервера WinInet в WinHTTP</span><span class="sxs-lookup"><span data-stu-id="2480b-132">Setting WinInet Proxy Configurations in WinHTTP</span></span>](setting-wininet-proxy-configurations-in-winhttp.md)
-   [<span data-ttu-id="2480b-133">Кэш автопрокси</span><span class="sxs-lookup"><span data-stu-id="2480b-133">AutoProxy Cache</span></span>](autoproxy-cache.md)
-   [<span data-ttu-id="2480b-134">Расширения IPv6 для формата файла автоматической настройки Navigator</span><span class="sxs-lookup"><span data-stu-id="2480b-134">IPv6 Extensions to Navigator Auto-Config File Format</span></span>](ipv6-extensions-to-navigator-auto-config-file-format.md)

 

 



