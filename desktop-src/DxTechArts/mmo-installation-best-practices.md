---
title: Рекомендации по установке для массовых многопользовательских интернет-игр
description: В этой статье описывается создание цепочки отношений доверия для установки клиента в Интернет-играх с широкими усилиями (ММОГ) и пользовательских систем обновления игр, которые хорошо работают с Windows и моделью безопасности Windows Vista и Windows 7.
ms.assetid: b719cff7-97e8-5e0a-9c91-3bd8178da7c8
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e81003a434b830f046c29d606355104fe618d1f5
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104070238"
---
# <a name="installation-best-practices-for-massively-multiplayer-online-games"></a><span data-ttu-id="246f8-103">Рекомендации по установке для массовых многопользовательских интернет-игр</span><span class="sxs-lookup"><span data-stu-id="246f8-103">Installation Best Practices for Massively Multiplayer Online Games</span></span>

<span data-ttu-id="246f8-104">В этой статье описывается создание цепочки отношений доверия для установки клиента в Интернет-играх с широкими усилиями (ММОГ) и пользовательских систем обновления игр, которые хорошо работают с Windows и моделью безопасности Windows Vista и Windows 7.</span><span class="sxs-lookup"><span data-stu-id="246f8-104">This article describes creating a chain of trust design for Massively Multiplayer Online Games (MMOG) client installation and custom game update systems that work well with Windows and the security model of Windows Vista and Windows 7.</span></span> <span data-ttu-id="246f8-105">Этот подход предназначен для включения исправлений в названиях ММОГ при поддержке стандартных учетных записей пользователей, имеющих ограниченный доступ к жесткому диску и системному реестру.</span><span class="sxs-lookup"><span data-stu-id="246f8-105">The approach is designed to enable patching of MMOG titles while supporting standard user accounts, which have restricted access to the hard drive and system registry.</span></span>

-   [<span data-ttu-id="246f8-106">Почему у клиентов ММОГ разные требования к традиционным розничным приобретенным играм</span><span class="sxs-lookup"><span data-stu-id="246f8-106">Why MMOG Clients Have Different Requirements to Traditional Retail Purchased Games</span></span>](#why-mmog-clients-have-different-requirements-to-traditional-retail-purchased-games)
-   [<span data-ttu-id="246f8-107">Общие сведения о цепочке подхода к доверию</span><span class="sxs-lookup"><span data-stu-id="246f8-107">Overview of a Chain of Trust Approach</span></span>](#overview-of-a-chain-of-trust-approach)
-   [<span data-ttu-id="246f8-108">Все проверяется на сервере, почему следует беспокоиться о взломе клиента?</span><span class="sxs-lookup"><span data-stu-id="246f8-108">Everything is validated on the server, why should I worry if my client gets hacked?</span></span>](#everything-is-validated-on-the-server-why-should-i-worry-if-my-client-gets-hacked)
-   [<span data-ttu-id="246f8-109">Создание приложения Trust-Worthy Loader</span><span class="sxs-lookup"><span data-stu-id="246f8-109">Construction of the Trust-Worthy Loader Application</span></span>](#construction-of-the-trust-worthy-loader-application)
    -   [<span data-ttu-id="246f8-110">Фоновое чтение</span><span class="sxs-lookup"><span data-stu-id="246f8-110">Background Reading</span></span>](#background-reading)
    -   [<span data-ttu-id="246f8-111">Установка доверенного загрузчика и диспетчера</span><span class="sxs-lookup"><span data-stu-id="246f8-111">Installation of the Trusted Loader and Patcher</span></span>](#installation-of-the-trusted-loader-and-patcher)
    -   [<span data-ttu-id="246f8-112">Установка игровых исполняемых файлов, библиотек DLL и данных</span><span class="sxs-lookup"><span data-stu-id="246f8-112">Installation of the Game Executables, DLLs, and Data</span></span>](#installation-of-the-game-executables-dlls-and-data)
    -   [<span data-ttu-id="246f8-113">Код изменения списка управления доступом</span><span class="sxs-lookup"><span data-stu-id="246f8-113">Access Control List Modification Code</span></span>](#access-control-list-modification-code)
    -   [<span data-ttu-id="246f8-114">Установки для опытных пользователей</span><span class="sxs-lookup"><span data-stu-id="246f8-114">Installations for Advanced Users</span></span>](#installations-for-advanced-users)
    -   [<span data-ttu-id="246f8-115">Проверка доверия загрузчика</span><span class="sxs-lookup"><span data-stu-id="246f8-115">The Loader's Verification of Trust</span></span>](#the-loaders-verification-of-trust)
    -   [<span data-ttu-id="246f8-116">Проверка данных</span><span class="sxs-lookup"><span data-stu-id="246f8-116">Data Validation</span></span>](#data-validation)

## <a name="why-mmog-clients-have-different-requirements-to-traditional-retail-purchased-games"></a><span data-ttu-id="246f8-117">Почему у клиентов ММОГ разные требования к традиционным розничным приобретенным играм</span><span class="sxs-lookup"><span data-stu-id="246f8-117">Why MMOG Clients Have Different Requirements to Traditional Retail Purchased Games</span></span>

<span data-ttu-id="246f8-118">Постоянно подключенная и развивающаяся природа MMOG делает это фундаментальным требованием для регулярного обновления кода и содержимого клиента, чтобы устранить уязвимости системы безопасности и расширить возможности игрового процесса.</span><span class="sxs-lookup"><span data-stu-id="246f8-118">The constantly connected and evolving nature of MMOGs makes it a fundamental requirement to provide regular updates of client code and content to fix security vulnerabilities and extend the gameplay experience.</span></span> <span data-ttu-id="246f8-119">С возможностью почти ежедневного обновления сценарий ММОГ требует тщательного управления, чтобы обеспечить удобство работы пользователя.</span><span class="sxs-lookup"><span data-stu-id="246f8-119">With the potential for almost daily updates, the MMOG scenario requires careful management to ensure a user friendly experience.</span></span> <span data-ttu-id="246f8-120">Это отличается от традиционной модели розничной покупки, где небольшое количество исправлений можно указать ближе к розничной дате поставки продукта.</span><span class="sxs-lookup"><span data-stu-id="246f8-120">This differs from the traditional retail purchase model where a small number of patches may be provided close to the retail ship date of the product.</span></span> <span data-ttu-id="246f8-121">Установщик Windows ограниченная технология исправления пользователей, обеспечиваемая операционной системой, предназначена для работы с небольшим количеством исправлений приложений, а не большим числом и высокой частотой, необходимой для MMOG.</span><span class="sxs-lookup"><span data-stu-id="246f8-121">The Windows Installer limited user patching technology provided with the operating system is designed to handle small numbers of application patches, and not the large quantity and high frequency needed by MMOGs.</span></span> <span data-ttu-id="246f8-122">Поэтому часто требуется разработать пользовательские системы исправлений для удовлетворения потребностей MMOG, включая специальные требования, характерные для конкретных ММОГ, которые разрабатываются.</span><span class="sxs-lookup"><span data-stu-id="246f8-122">It is therefore often necessary for custom patching systems to be developed to address the needs of MMOGs, including any special requirements specific to the particular MMOG being developed.</span></span>

<span data-ttu-id="246f8-123">Так как многие компьютеры подключены к Интернету, Windows Vista и Windows 7 имеют более жесткие ограничения безопасности и защиты для пользователей, что ограничивает доступ приложений к различным областям жесткого диска.</span><span class="sxs-lookup"><span data-stu-id="246f8-123">Because so many computers are connected to the Internet, Windows Vista and Windows 7 have tougher security restrictions and safeguards for users, which limit the access that applications have to various areas of the hard drive.</span></span> <span data-ttu-id="246f8-124">В отличие от Windows XP, эти ограничения включены в режим по умолчанию для учетных записей пользователей.</span><span class="sxs-lookup"><span data-stu-id="246f8-124">Unlike Windows XP, these restrictions are enabled for the default mode for user accounts.</span></span> <span data-ttu-id="246f8-125">Эти ограничения следует учитывать при проектировании макета игры, исполняемого файла и данных, а также связанной с ней системы исправлений.</span><span class="sxs-lookup"><span data-stu-id="246f8-125">These restrictions must be taken into account when designing the layout of a game, executable and data, and its associated patching system.</span></span> <span data-ttu-id="246f8-126">Дополнительные сведения о мерах безопасности, предоставляемых операционной системой, см. в разделе [Управление учетными записями пользователей для разработчиков игр](/windows/desktop/DxTechArts/user-account-control-for-game-developers).</span><span class="sxs-lookup"><span data-stu-id="246f8-126">For more details about the security measures provided by the operating system, see [User Account Control for Game Developers](/windows/desktop/DxTechArts/user-account-control-for-game-developers).</span></span>

## <a name="overview-of-a-chain-of-trust-approach"></a><span data-ttu-id="246f8-127">Общие сведения о цепочке подхода к доверию</span><span class="sxs-lookup"><span data-stu-id="246f8-127">Overview of a Chain of Trust Approach</span></span>

<span data-ttu-id="246f8-128">Подход к пользовательскому обновлению, представленный в этом техническом документе, основан на использовании надежного приложения загрузчика в папке защищенных файлов, сохраняя при этом исполняемые файлы и данные игр в общей области, доступной для всех пользователей.</span><span class="sxs-lookup"><span data-stu-id="246f8-128">The custom update approach presented in this whitepaper is based upon having a trustworthy loader application installed to the protected Program Files folder while keeping the games executable files and data in a shared all-user-accessible area.</span></span> <span data-ttu-id="246f8-129">Цепочка доверия начинается с загрузчика, который выполняет проверки достоверности двоичных файлов и данных игр перед запуском.</span><span class="sxs-lookup"><span data-stu-id="246f8-129">A chain of trust starts with the loader which performs validity checks on the game binaries and data before launch.</span></span>

![Цепочка доверия начинается с надежного загрузчика](images/mmo-installation-best-practices-01.gif)

<span data-ttu-id="246f8-131">Надежному загрузчику необходимо иметь достаточное количество логики, чтобы убедиться, что исполняемый файл и другие двоичные файлы игры не были изменены перед запуском игры.</span><span class="sxs-lookup"><span data-stu-id="246f8-131">The trustworthy loader needs to have enough logic to be able to verify that the game's executable and other binaries have not been tampered with before launching the game.</span></span> <span data-ttu-id="246f8-132">Загрузчик также может проверять данные игры по мере необходимости, однако размер данных игры обычно слишком велик, чтобы их можно было проверять каждый раз за один проход.</span><span class="sxs-lookup"><span data-stu-id="246f8-132">The loader may also verify game data as often as needed, however, the size of game data is usually too large to allow it be checked every time in a single pass.</span></span> <span data-ttu-id="246f8-133">Альтернативный подход заключается в использовании шаблона выборки, который гарантирует, что проверка всего набора данных выполняется в течение продолжительного периода времени.</span><span class="sxs-lookup"><span data-stu-id="246f8-133">An alternative approach is to use a sampling pattern which ensures that verification of the entire data set occurs over an extended period of time.</span></span> <span data-ttu-id="246f8-134">Приложение Loader может содержать подсистему установки игр, которая предоставляет метод достойной доверия для интеграции обновлений с установленной игрой.</span><span class="sxs-lookup"><span data-stu-id="246f8-134">The loader application may contain a game patching engine, which provides a trust worthy method by to integrate updates with the installed game.</span></span>

## <a name="everything-is-validated-on-the-server-why-should-i-worry-if-my-client-gets-hacked"></a><span data-ttu-id="246f8-135">Все проверяется на сервере, почему следует беспокоиться о взломе клиента?</span><span class="sxs-lookup"><span data-stu-id="246f8-135">Everything is validated on the server, why should I worry if my client gets hacked?</span></span>

<span data-ttu-id="246f8-136">Невозможно доверять, что клиент не был скомпрометирован; Таким образом, серверы ММОГ обычно проверяют все данные, полученные от клиента.</span><span class="sxs-lookup"><span data-stu-id="246f8-136">It is impossible to trust that the client has not been compromised; therefore it is common for MMOG servers to validate all data received from the client.</span></span> <span data-ttu-id="246f8-137">Хотя эта обработка может определять скомпрометированные или обмана Игровые клиенты в среде игры, сервер не может легко найти все проблемы, с которыми может предоставляться игровой клиент.</span><span class="sxs-lookup"><span data-stu-id="246f8-137">While this processing can identify compromised or cheating game clients within the game universe, the server cannot easily identify all issues the game client can be exposed to.</span></span> <span data-ttu-id="246f8-138">Важно усилить защиту от хакеров, желающих использовать клиент в качестве платформы для атак на вашу службу, других пользователей или даже в качестве вектора для самостоятельной атаки на клиентские компьютеры.</span><span class="sxs-lookup"><span data-stu-id="246f8-138">It's important to strengthen protection from hackers who wish to use your client as a platform for attacks on your service, other users, or even simply as a vector for attacking the client machines themselves.</span></span> <span data-ttu-id="246f8-139">Применение методов подписывания кода и проверки данных помогает обнаружить скомпрометированные клиенты перед их выполнением.</span><span class="sxs-lookup"><span data-stu-id="246f8-139">The application of code signing and data verification techniques can help detect compromised clients before they get executed.</span></span> <span data-ttu-id="246f8-140">Поскольку механизму исправления требуется предоставлять двоичные файлы исполняемых файлов и библиотек DLL, которые не защищены стандартными разрешениями только для чтения в программах, проверка этих файлов перед их запуском важна для обеспечения общей безопасности системы.</span><span class="sxs-lookup"><span data-stu-id="246f8-140">Since the patching mechanism requires exposing executable and DLL binaries that are not protected by the standard read-only permissions on Program Files, validating these files before launching them is important for overall system security.</span></span>

<span data-ttu-id="246f8-141">Эта модель не пытается справиться с сценарием пользователя вредоносного администратора, в котором сам загрузчик может стать скомпрометированным, но он посвящен защите обычных пользователей от случайного выполнения незаконного кода.</span><span class="sxs-lookup"><span data-stu-id="246f8-141">This model does not attempt to deal with the malicious admin user scenario where the loader itself could become compromised but focuses on protecting standard users from accidentally running tampered code.</span></span> <span data-ttu-id="246f8-142">Традиционные методики проверки сервера и клиента являются единственным возможным устранением вредоносных системных администраторов.</span><span class="sxs-lookup"><span data-stu-id="246f8-142">Traditional server-client validation techniques are really the only possible mitigation for malicious client system administrators.</span></span>

## <a name="construction-of-the-trust-worthy-loader-application"></a><span data-ttu-id="246f8-143">Создание приложения Trust-Worthy Loader</span><span class="sxs-lookup"><span data-stu-id="246f8-143">Construction of the Trust-Worthy Loader Application</span></span>

### <a name="background-reading"></a><span data-ttu-id="246f8-144">Фоновое чтение</span><span class="sxs-lookup"><span data-stu-id="246f8-144">Background Reading</span></span>

<span data-ttu-id="246f8-145">Читатели должны ознакомиться со следующей документацией, в которой приводятся подробные сведения о технологии, обеспечивающей наилучшее отношение доверия на основе программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="246f8-145">Readers should familiarize themselves with the following documentation, which provides details of the foundation technology for ensuring best practice for software based trust.</span></span>

<dl> <dt>

<span data-ttu-id="246f8-146"><span id="Code_Signing"></span><span id="code_signing"></span><span id="CODE_SIGNING"></span>Подписывание кода</span><span class="sxs-lookup"><span data-stu-id="246f8-146"><span id="Code_Signing"></span><span id="code_signing"></span><span id="CODE_SIGNING"></span>Code Signing</span></span>
</dt> <dd>

[<span data-ttu-id="246f8-147">Подписывание Authenticode для разработчиков игр</span><span class="sxs-lookup"><span data-stu-id="246f8-147">Authenticode Signing for Game Developers</span></span>](/windows/desktop/DxTechArts/authenticode-signing-for-game-developers)

</dd> <dt>

<span data-ttu-id="246f8-148"><span id="SignTool"></span><span id="signtool"></span><span id="SIGNTOOL"></span>Средство</span><span class="sxs-lookup"><span data-stu-id="246f8-148"><span id="SignTool"></span><span id="signtool"></span><span id="SIGNTOOL"></span>SignTool</span></span>
</dt> <dd>

<span data-ttu-id="246f8-149">Средство [SignTool](/windows/desktop/SecCrypto/signtool) на MSDN</span><span class="sxs-lookup"><span data-stu-id="246f8-149">[SignTool](/windows/desktop/SecCrypto/signtool) on MSDN</span></span>

</dd> </dl>

<span data-ttu-id="246f8-150">В следующем разделе описаны интерфейсы API, которые следует использовать для создания приложения загрузчика, поддерживающего структуру диска для установки и проверки доверия.</span><span class="sxs-lookup"><span data-stu-id="246f8-150">The following section details the APIs that should be used to construct the loader application, which support disc layout for install and verification of trust checking.</span></span>

### <a name="installation-of-the-trusted-loader-and-patcher"></a><span data-ttu-id="246f8-151">Установка доверенного загрузчика и диспетчера</span><span class="sxs-lookup"><span data-stu-id="246f8-151">Installation of the Trusted Loader and Patcher</span></span>

<span data-ttu-id="246f8-152">Доверенный загрузчик и базовая версия служебной программы исправления должны быть установлены в папке защищенных файлов на жестком диске так же, как в традиционных установках.</span><span class="sxs-lookup"><span data-stu-id="246f8-152">The trusted loader and base version of the patcher utility should be installed under the protected Program Files folder on the HDD just as in traditional installs.</span></span> <span data-ttu-id="246f8-153">Для установки и исправления приложения загрузчика требуются права администратора, поэтому важно обеспечить минимальную частоту обновления для загрузчика, чтобы гарантировать, что конечным пользователям не нужно часто повышать уровень прав, хотя установщик Windows ограниченный набор исправлений пользователей можно использовать, чтобы избежать повышения прав для исправлений загрузчика.</span><span class="sxs-lookup"><span data-stu-id="246f8-153">Installation and patching of the loader application requires Admin rights so it is important to minimize the frequency of update for the loader to ensure end users do not need to elevate often, although Windows Installer limited user patching could be used to avoid elevation for loader patches.</span></span>

<span data-ttu-id="246f8-154">См. статью Установка игровых программ в Windows XP, Windows Vista и Windows 7.</span><span class="sxs-lookup"><span data-stu-id="246f8-154">See the article Patching Game Software in Windows XP, Windows Vista, and Windows 7.</span></span>

### <a name="installation-of-the-game-executables-dlls-and-data"></a><span data-ttu-id="246f8-155">Установка игровых исполняемых файлов, библиотек DLL и данных</span><span class="sxs-lookup"><span data-stu-id="246f8-155">Installation of the Game Executables, DLLs, and Data</span></span>

<span data-ttu-id="246f8-156">Чтобы упростить обновление стандартных пользователей игры без прав администратора, необходимо установить исполняемые файлы, библиотеки DLL и данные в область жесткого диска, доступную для записи всем пользователям.</span><span class="sxs-lookup"><span data-stu-id="246f8-156">In order to facilitate Standard User updates of the game without administrative privilege, the games executable, DLLs, and data must be installed to an area of the hard disk that is write accessible for all users.</span></span> <span data-ttu-id="246f8-157">Операционная система предоставляет область "все данные приложений пользователей", которую можно использовать в качестве расположения по умолчанию для установки.</span><span class="sxs-lookup"><span data-stu-id="246f8-157">The operating system provides an "All Users Application Data" area which can be used as the default location for installation.</span></span> <span data-ttu-id="246f8-158">[**Шжетфолдерпас**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) следует использовать вместе с \_ общим \_ ключом AppData, чтобы определить путь к файлу для этой области.</span><span class="sxs-lookup"><span data-stu-id="246f8-158">[**SHGetFolderPath**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) should be used with the CSIDL\_COMMON\_APPDATA key to determine the file path for this area.</span></span> <span data-ttu-id="246f8-159">Важно, чтобы в пути, к которому этот ключ возвращается, не предполагалось никаких допущений, так как он может быть настраиваемым пользователем.</span><span class="sxs-lookup"><span data-stu-id="246f8-159">It is important that no assumptions be made about the path to which this key returns as it may be user configurable.</span></span>

<span data-ttu-id="246f8-160">Установка должна изменить разрешения папки или управлять ею, чтобы обеспечить доступ для всех пользователей и общих операций записи, необходимых для обновления заголовка.</span><span class="sxs-lookup"><span data-stu-id="246f8-160">The installation needs to alter or manage the folder permissions in order to achieve the all-user-shared-write access needed for updating the title.</span></span> <span data-ttu-id="246f8-161">С учетом правильных разрешений функция средства обновления игр может легко исправить игру, не требуя наличия специальной привилегии для всех пользователей, включая время запуска обычных пользователей.</span><span class="sxs-lookup"><span data-stu-id="246f8-161">With the correct permissions, the game updater functionality of the loader program can easily patch the game without the need for special privilege from any users account including times when launched by standard users.</span></span>

### <a name="access-control-list-modification-code"></a><span data-ttu-id="246f8-162">Код изменения списка управления доступом</span><span class="sxs-lookup"><span data-stu-id="246f8-162">Access Control List Modification Code</span></span>

<span data-ttu-id="246f8-163">Для Windows XP необходимо выполнить код для изменения списка управления доступом (ACL) вручную. ниже приведен пример функции, которая показывает, как это сделать.</span><span class="sxs-lookup"><span data-stu-id="246f8-163">For Windows XP, you will need to execute code to change the access control list (ACL) manually, here is an example function that demonstrates how to do this:</span></span>

``` syntax
HRESULT ChangeACLtoAllowUserRW( WCHAR* strDir )
{
    EXPLICIT_ACCESS explicitaccess;
    PACL NewAcl = NULL;
    DWORD dwError;

    BuildExplicitAccessWithName( &explicitaccess, L"BUILTIN\\Users",
                                 GENERIC_ALL, GRANT_ACCESS,
                                 SUB_CONTAINERS_AND_OBJECTS_INHERIT );
                                 
    dwError = SetEntriesInAcl( 1, &explicitaccess, NULL, &NewAcl );
    if( dwError == ERROR_SUCCESS) 
    {
        dwError = SetNamedSecurityInfo( strDir, SE_FILE_OBJECT,
                                        DACL_SECURITY_INFORMATION,
                                        NULL, NULL, NewAcl, NULL );
        if( dwError == ERROR_SUCCESS)
        {
            if( NewAcl != NULL ) AccFree( NewAcl );
            return S_OK;
        }
    }

    if( NewAcl != NULL ) AccFree( NewAcl );
    return E_FAIL;
}
```

<span data-ttu-id="246f8-164">Этот пример кода также будет работать в Windows Vista и Windows 7; Однако они также предоставляют программу командной строки Icacls для редактирования ACL файлов, которые можно использовать вместо этого.</span><span class="sxs-lookup"><span data-stu-id="246f8-164">This code example will also work for Windows Vista and Windows 7; however, they also provide the command line utility icacls to edit file ACLS which you may choose to use instead.</span></span>

<span data-ttu-id="246f8-165">При выполнении этого средства отображается подробная справка, но одним из примеров использования этого средства является:</span><span class="sxs-lookup"><span data-stu-id="246f8-165">The tool provides a detailed help when executed however, one example usage for the tool is:</span></span>

``` syntax
icacls "C:\Users\All Users\Game" /grant Rex:(D,WDAC)
```

<span data-ttu-id="246f8-166">Это позволит пользователю Rex удалить и записать разрешения DAC в игровую папку, хранящуюся в области все пользователи жесткого диска.</span><span class="sxs-lookup"><span data-stu-id="246f8-166">This usage will grant the user Rex Delete and Write DAC permissions to game folder stored in the All Users areas of the hard drive.</span></span>

### <a name="installations-for-advanced-users"></a><span data-ttu-id="246f8-167">Установки для опытных пользователей</span><span class="sxs-lookup"><span data-stu-id="246f8-167">Installations for Advanced Users</span></span>

<span data-ttu-id="246f8-168">В случае расширенных сценариев установки пользователю может потребоваться указать путь установки игр вручную.</span><span class="sxs-lookup"><span data-stu-id="246f8-168">For advanced user installation scenarios, a user may want to specify the games installation path manually.</span></span> <span data-ttu-id="246f8-169">Выбор каталога должен быть ограничен одним за пределами программных файлов, чтобы эта папка находилась в полностью разделяемой области жесткого диска.</span><span class="sxs-lookup"><span data-stu-id="246f8-169">The directory selection should be restricted to one outside of program files to ensure the folder is in a truly sharable area of the hard drive.</span></span> <span data-ttu-id="246f8-170">Выбранный пользователем путь следует использовать только для исполняемых файлов и exe, так как загрузчик игры и исполняемый файл исправления всегда должны быть установлены в папку "защищенные файлы программ" для повышения безопасности.</span><span class="sxs-lookup"><span data-stu-id="246f8-170">The user selected path should only be used for the games exes and data as the game Loader and Patcher exes should always be installed under the secure Program Files folder for better security.</span></span>

### <a name="the-loaders-verification-of-trust"></a><span data-ttu-id="246f8-171">Проверка доверия загрузчика</span><span class="sxs-lookup"><span data-stu-id="246f8-171">The Loader's Verification of Trust</span></span>

<span data-ttu-id="246f8-172">Windows предоставляет функцию [**WinVerifyTrust**](/windows/desktop/api/wintrust/nf-wintrust-winverifytrust) для проверки допустимости подписанного кода и основана на службах шифрования в операционной системе.</span><span class="sxs-lookup"><span data-stu-id="246f8-172">Windows provides the [**WinVerifyTrust**](/windows/desktop/api/wintrust/nf-wintrust-winverifytrust) function for checking the validity of signed code and is based on the cryptographic services in the operating system.</span></span> <span data-ttu-id="246f8-173">Функция полностью документирована в функции MSDN: **WinVerifyTrust** .</span><span class="sxs-lookup"><span data-stu-id="246f8-173">The function is fully documented on MSDN: **WinVerifyTrust** Function.</span></span>

<span data-ttu-id="246f8-174">В следующем примере программы на сайте MSDN подробно описывается использование функции для определения того, подписан ли исполняемый файл программы действительным сертификатом: [Пример программы C: Проверка подписи PE-файла](/windows/desktop/SecCrypto/example-c-program--verifying-the-signature-of-a-pe-file).</span><span class="sxs-lookup"><span data-stu-id="246f8-174">The following example program on MSDN details the use of the function to determine whether a program executable is signed with a valid certificate: [Example C Program: Verifying the Signature of a PE File](/windows/desktop/SecCrypto/example-c-program--verifying-the-signature-of-a-pe-file).</span></span>

<span data-ttu-id="246f8-175">В целях проверки того, что подписанный исполняемый файл игры надежен для выполнения в загрузчике, будет достаточно универсальное действие проверки:</span><span class="sxs-lookup"><span data-stu-id="246f8-175">For the purposes of verifying that the signed game executable is trustworthy to be executed from within the loader, the Generic Verify action will suffice:</span></span>

<dl> <dt>

<span data-ttu-id="246f8-176"><span id="Value"></span><span id="value"></span><span id="VALUE"></span>Значений</span><span class="sxs-lookup"><span data-stu-id="246f8-176"><span id="Value"></span><span id="value"></span><span id="VALUE"></span>Value</span></span>
</dt> <dd>

<span data-ttu-id="246f8-177">ВИНТРУСТ \_ действие \_ Generic \_ Проверка \_ версии 2</span><span class="sxs-lookup"><span data-stu-id="246f8-177">WINTRUST\_ACTION\_GENERIC\_VERIFY\_V2</span></span>

</dd> <dt>

<span data-ttu-id="246f8-178"><span id="Meaning"></span><span id="meaning"></span><span id="MEANING"></span>А</span><span class="sxs-lookup"><span data-stu-id="246f8-178"><span id="Meaning"></span><span id="meaning"></span><span id="MEANING"></span>Meaning</span></span>
</dt> <dd>

<span data-ttu-id="246f8-179">Проверьте файл или объект с помощью поставщика политики Authenticode.</span><span class="sxs-lookup"><span data-stu-id="246f8-179">Verify a file or object using the Authenticode policy provider.</span></span>

</dd> </dl>

<span data-ttu-id="246f8-180">Функция принимает аргумент структуры ввода, который содержит сведения, необходимые поставщику доверия для обработки указанного действия.</span><span class="sxs-lookup"><span data-stu-id="246f8-180">The function takes an input structure argument which contains information that the trust provider needs to process the specified action.</span></span> <span data-ttu-id="246f8-181">Как правило, как и в предыдущем примере, структура включает сведения, определяющие объект, который должен оценивать поставщик доверия.</span><span class="sxs-lookup"><span data-stu-id="246f8-181">Typically, as in the preceding example case, the structure includes information that identifies the object that the trust provider must evaluate.</span></span>

<span data-ttu-id="246f8-182">Формат структуры зависит от идентификатора действия.</span><span class="sxs-lookup"><span data-stu-id="246f8-182">The format of the structure is specific to the action identifier.</span></span> <span data-ttu-id="246f8-183">Следующий раздел на сайте MSDN подробно демонстрирует структуру структуры [**\_ данных**](/windows/desktop/api/wintrust/ns-wintrust-wintrust_data) поставщика винтруст: винтруст.</span><span class="sxs-lookup"><span data-stu-id="246f8-183">The following topic on MSDN details the example structure for the WinTrust provider: [**WINTRUST\_DATA**](/windows/desktop/api/wintrust/ns-wintrust-wintrust_data) Structure.</span></span>

<span data-ttu-id="246f8-184">Если поставщик доверия проверяет, что субъект является доверенным для указанного действия, возвращаемое значение равно нулю.</span><span class="sxs-lookup"><span data-stu-id="246f8-184">If the trust provider verifies that the subject is trusted for the specified action, the return value is zero.</span></span> <span data-ttu-id="246f8-185">Никакое другое значение, кроме нуля, не следует рассматривать как успешный возврат.</span><span class="sxs-lookup"><span data-stu-id="246f8-185">No other value besides zero should be considered a successful return.</span></span>

### <a name="data-validation"></a><span data-ttu-id="246f8-186">Проверка данных</span><span class="sxs-lookup"><span data-stu-id="246f8-186">Data Validation</span></span>

<span data-ttu-id="246f8-187">Механизм сопроектирования поддерживает только подписывание нескольких конкретных типов файлов, включая исполняемые файлы, библиотеки DLL, пакеты установщик Windows (MSI-файлы) и CAB-файлы.</span><span class="sxs-lookup"><span data-stu-id="246f8-187">The codesigning mechanism only supports signing a few specific types of files, including executables, DLLs, Windows Installer packages (.msi files), and cabinet (.cab) files.</span></span> <span data-ttu-id="246f8-188">API [**WinVerifyTrust**](/windows/desktop/api/wintrust/nf-wintrust-winverifytrust) не следует использовать для проверки того, что большие файлы данных (например, CAB-файлы) не были изменены, так как при проверке очень больших файлов возникают проблемы с производительностью и стабильностью.</span><span class="sxs-lookup"><span data-stu-id="246f8-188">The [**WinVerifyTrust**](/windows/desktop/api/wintrust/nf-wintrust-winverifytrust) API should not be used to verify that large data files (.cab files for example) have not been tampered with, as there are some issues with performance and stability when validating very large files.</span></span> <span data-ttu-id="246f8-189">Исполняемые файлы программы, как правило, достаточно малы для проверки полного доверия с помощью поставщика Винтруст, но файлы данных для игр часто представляют собой область многих гигабайтов в размере.</span><span class="sxs-lookup"><span data-stu-id="246f8-189">Program executables tend be small enough for a full trust check to occur using the WinTrust provider but data files for games are often of the realm of many gigabytes in size.</span></span> <span data-ttu-id="246f8-190">Метод, выполняемый загрузчиком для проверки данных игры, должен быть одним из них, где небольшой образец набора данных тестируется во время выполнения игры.</span><span class="sxs-lookup"><span data-stu-id="246f8-190">The approach taken by the loader for verification of game data should be one where a small sample of the dataset is tested over the run time of the game.</span></span> <span data-ttu-id="246f8-191">При таком подходе затраты на проверку проверяются в течение жизненного цикла игры и могут обеспечивать удобство работы пользователей без длительного времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="246f8-191">This approach spreads the cost of verification tests over the life of the game play experience and can provide a seamless user experience without long wait times.</span></span> <span data-ttu-id="246f8-192">Чтобы добиться этого, может потребоваться тщательная организация данных.</span><span class="sxs-lookup"><span data-stu-id="246f8-192">To achieve this, careful organization of the data may be required.</span></span> <span data-ttu-id="246f8-193">Некоторые MMOG используют подход к базе данных, чтобы помочь в управлении, обслуживании и проверке правильности игровых ресурсов в течение времени.</span><span class="sxs-lookup"><span data-stu-id="246f8-193">Some MMOGs employ a database approach to help manage, maintain and verify correctness of game assets over time.</span></span>

<span data-ttu-id="246f8-194">С точки зрения безопасности клиентский код должен быть разработан таким образом, чтобы не доверять файлам данных, даже если используется какая-либо базовая проверка данных с надежным загрузчиком.</span><span class="sxs-lookup"><span data-stu-id="246f8-194">From a security standpoint, the client code should be designed to not trust data files even if using some kind of basic data validation with the trusted loader.</span></span> <span data-ttu-id="246f8-195">Следует применять проверки заголовков, хэши и другую традиционную проверку целостности.</span><span class="sxs-lookup"><span data-stu-id="246f8-195">Header checks, hashes, and other traditional integrity checking should be employed.</span></span> <span data-ttu-id="246f8-196">Работа с усилением защиты кода ввода-вывода клиента должна также выполняться с помощью таких методов, как тестирование методом нечеткого тестирования, а также использования средств автоматического анализа статического кода, таких как параметр **/Analyze** в visual Studio 2005 и visual Studio 2008 (доступно в Visual Studio Team System и бесплатный компилятор, поставляемый с Windows SDK).</span><span class="sxs-lookup"><span data-stu-id="246f8-196">Work to hardened the client's I/O code should also be done using techniques such as fuzz testing as well as taking advantage of automatic static code analysis tools such as the **/analyze** switch in Visual Studio 2005 and Visual Studio 2008 (available in Visual Studio Team System and the free compiler that ships with the Windows SDK).</span></span>

<span data-ttu-id="246f8-197">Дополнительные сведения о безопасности программного обеспечения см. [в разделе Лучшие методики обеспечения безопасности при разработке игр](/windows/desktop/DxTechArts/best-security-practices-in-game-development).</span><span class="sxs-lookup"><span data-stu-id="246f8-197">For more information about software security, see [Best Security Practices in Game Development](/windows/desktop/DxTechArts/best-security-practices-in-game-development).</span></span>

 

 