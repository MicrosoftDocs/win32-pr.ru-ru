---
title: Подписывание Authenticode для разработчиков игр
description: В этой статье описывается, как приступить к проверке подлинности в игре и интеграции проверки подлинности в процесс ежедневной сборки.
ms.assetid: 0b3138ea-e4ea-57fb-756b-62fdc20cf813
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8f304e6cc8e185264699709987f62dfdca17bf8b
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105661757"
---
# <a name="authenticode-signing-for-game-developers"></a><span data-ttu-id="66239-103">Подписывание Authenticode для разработчиков игр</span><span class="sxs-lookup"><span data-stu-id="66239-103">Authenticode Signing for Game Developers</span></span>

<span data-ttu-id="66239-104">Проверка подлинности данных все еще важна для разработчиков игр.</span><span class="sxs-lookup"><span data-stu-id="66239-104">Data authentication is increasingly important for game developers.</span></span> <span data-ttu-id="66239-105">В Windows Vista и Windows 7 имеется ряд функций, таких как родительский контроль, требующих правильной подписи игр, чтобы гарантировать, что никто не подписался на данные.</span><span class="sxs-lookup"><span data-stu-id="66239-105">Windows Vista and Windows 7 have a number of features, such as parental controls, that require games to be properly signed to ensure that no one has tampered with the data.</span></span> <span data-ttu-id="66239-106">Microsoft Authenticode позволяет конечным пользователям и операционной системе проверять, поступает ли программный код от законного владельца и что он не был изменен или случайно поврежден.</span><span class="sxs-lookup"><span data-stu-id="66239-106">Microsoft Authenticode enables end users and the operating system to verify that program code comes from the rightful owner and that it hasn't been maliciously altered or accidentally corrupted.</span></span> <span data-ttu-id="66239-107">В этой статье описывается, как приступить к проверке подлинности в игре и интеграции проверки подлинности в процесс ежедневной сборки.</span><span class="sxs-lookup"><span data-stu-id="66239-107">This article discusses how to get started with authenticating your game and how to integrate authentication into a daily build process.</span></span>

-   [<span data-ttu-id="66239-108">Фон</span><span class="sxs-lookup"><span data-stu-id="66239-108">Background</span></span>](#background)
-   [<span data-ttu-id="66239-109">Начало работы</span><span class="sxs-lookup"><span data-stu-id="66239-109">Getting Started</span></span>](#getting-started)
-   [<span data-ttu-id="66239-110">Использование доверенного центра сертификации</span><span class="sxs-lookup"><span data-stu-id="66239-110">Using a Trusted Certificate Authority</span></span>](#using-a-trusted-certificate-authority)
-   [<span data-ttu-id="66239-111">Пример с использованием тестового сертификата</span><span class="sxs-lookup"><span data-stu-id="66239-111">Example Using a Test Certificate</span></span>](#example-using-a-test-certificate)
-   [<span data-ttu-id="66239-112">Интеграция кода для входа в систему ежедневной сборки</span><span class="sxs-lookup"><span data-stu-id="66239-112">Integrating Code Signing into the Daily Build System</span></span>](#integrating-code-signing-into-the-daily-build-system)
-   [<span data-ttu-id="66239-113">Запрет доступа</span><span class="sxs-lookup"><span data-stu-id="66239-113">Revocation</span></span>](#revocation)
-   [<span data-ttu-id="66239-114">Драйверы подписывания кода</span><span class="sxs-lookup"><span data-stu-id="66239-114">Code-Signing Drivers</span></span>](#code-signing-drivers)
-   [<span data-ttu-id="66239-115">Сводка</span><span class="sxs-lookup"><span data-stu-id="66239-115">Summary</span></span>](#summary)
-   [<span data-ttu-id="66239-116">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="66239-116">More information</span></span>](#more-information)

> [!Note]  
> <span data-ttu-id="66239-117">По состоянию на 1 января 2016 г. в Windows 7 и более поздних версиях больше не будет доверять сертификат подписи кода SHA-1 с датой истечения 1 января 2016 или более поздней.</span><span class="sxs-lookup"><span data-stu-id="66239-117">As of January 1, 2016, Windows 7 and later no longer trust any SHA-1 code signing certificate with an expiration date of January 1, 2016 or later.</span></span> <span data-ttu-id="66239-118">Дополнительные сведения см. в разделе [принудительное применение подписи кода Authenticode и метки времени](https://social.technet.microsoft.com/wiki/contents/articles/32288.windows-enforcement-of-sha1-certificates.aspx) .</span><span class="sxs-lookup"><span data-stu-id="66239-118">See [Windows Enforcement of Authenticode Code Signing and Timestamping](https://social.technet.microsoft.com/wiki/contents/articles/32288.windows-enforcement-of-sha1-certificates.aspx) for more information.</span></span>

 

## <a name="background"></a><span data-ttu-id="66239-119">Историческая справка</span><span class="sxs-lookup"><span data-stu-id="66239-119">Background</span></span>

<span data-ttu-id="66239-120">Цифровые сертификаты используются для определения удостоверения автора.</span><span class="sxs-lookup"><span data-stu-id="66239-120">Digital certificates are used to establish the identity of the author.</span></span> <span data-ttu-id="66239-121">Цифровые сертификаты выдаются доверенным сторонним сторонним лицом, известным как центр сертификации (ЦС), например VeriSign или Thawte.</span><span class="sxs-lookup"><span data-stu-id="66239-121">Digital certificates are issued by a trusted third party known as a Certificate Authority (CA) such as VeriSign or Thawte.</span></span> <span data-ttu-id="66239-122">ЦС отвечает за проверку того, что владелец не заказывает в ложном определении.</span><span class="sxs-lookup"><span data-stu-id="66239-122">The CA is responsible for verifying that owner is not claiming a false identify.</span></span> <span data-ttu-id="66239-123">После применения к центру сертификации для сертификата коммерческие разработчики могут рассчитывать на ответ на приложение менее чем за две недели.</span><span class="sxs-lookup"><span data-stu-id="66239-123">After applying to a CA for a certificate, commercial developers can expect a response to their application in less than two weeks.</span></span>

<span data-ttu-id="66239-124">После того как ЦС решит, что вы отвечаете условиям политики, он создает сертификат подписи кода, который соответствует X. 509, стандартному формату сертификата, созданному в международной телекоммуникационному объединению с расширениями версии 3.</span><span class="sxs-lookup"><span data-stu-id="66239-124">After the CA decides that you meet its policy criteria, it generates a code-signing certificate that conforms to X.509, the industry-standard certificate format created by the International Telecommunications Union, with Version 3 extensions.</span></span> <span data-ttu-id="66239-125">Этот сертификат идентифицирует вас и содержит открытый ключ.</span><span class="sxs-lookup"><span data-stu-id="66239-125">This certificate identifies you and contains your public key.</span></span> <span data-ttu-id="66239-126">Он хранится в центре сертификации для справки, а копия предоставляется в электронном виде.</span><span class="sxs-lookup"><span data-stu-id="66239-126">It is stored by the CA for reference, and a copy is given to you electronically.</span></span> <span data-ttu-id="66239-127">В то же время вы также создадите закрытый ключ, который необходимо защитить и который не должен предоставляться никому, даже в центре сертификации.</span><span class="sxs-lookup"><span data-stu-id="66239-127">At the same time, you also create a private, key which you must keep safe and which you must not share with anyone, even the CA.</span></span>

<span data-ttu-id="66239-128">После создания открытого и закрытого ключей можно приступать к распространению подписанного программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="66239-128">After you have a public and private key, you can then begin distributing signed software.</span></span> <span data-ttu-id="66239-129">Корпорация Майкрософт предоставляет средства для этого в Windows SDK.</span><span class="sxs-lookup"><span data-stu-id="66239-129">Microsoft provides tools to do this in the Windows SDK.</span></span> <span data-ttu-id="66239-130">Средства используют односторонний хэш, создают дайджест фиксированной длины и создают зашифрованную подпись с закрытым ключом.</span><span class="sxs-lookup"><span data-stu-id="66239-130">The tools utilize a one-way hash, produce a fixed-length digest, and generate an encrypted signature with a private key.</span></span> <span data-ttu-id="66239-131">Затем они объединяют зашифрованную подпись с сертификатом и учетными данными в структуру, известную как блок подписи, и внедряют ее в файловый формат исполняемого файла.</span><span class="sxs-lookup"><span data-stu-id="66239-131">They then combine that encrypted signature with your certificate and credentials into a structure known as a signature block and embed it into the file format of the executable.</span></span> <span data-ttu-id="66239-132">Любой тип исполняемого двоичного файла может быть подписан, включая библиотеки DLL, исполняемые файлы и CAB-файлы.</span><span class="sxs-lookup"><span data-stu-id="66239-132">Any type of executable binary file can be signed, including DLLs, executable files, and cabinet files.</span></span>

<span data-ttu-id="66239-133">Подпись может быть проверена несколькими способами.</span><span class="sxs-lookup"><span data-stu-id="66239-133">The signature can be verified in multiple ways.</span></span> <span data-ttu-id="66239-134">Программы могут вызывать функцию Цертверифицертификатечаинполици, а средство SignTool (signtool.exe) можно использовать для проверки подписи из командной строки.</span><span class="sxs-lookup"><span data-stu-id="66239-134">Programs can call the CertVerifyCertificateChainPolicy function, and SignTool (signtool.exe) can be used to verify a signature from the command-line prompt.</span></span> <span data-ttu-id="66239-135">Проводник Windows также имеет вкладку Цифровые подписи в свойствах файла, где отображаются все сертификаты подписанного двоичного файла.</span><span class="sxs-lookup"><span data-stu-id="66239-135">Windows Explorer also has a Digital Signatures tab in File Properties that displays each certificate of a signed binary file.</span></span> <span data-ttu-id="66239-136">(Вкладка цифровые подписи отображается только в свойствах файлов для подписанных файлов.) Кроме того, приложение может самостоятельно проверить с помощью [**цертверифицертификатечаинполици**](/windows/desktop/api/wincrypt/nf-wincrypt-certverifycertificatechainpolicy).</span><span class="sxs-lookup"><span data-stu-id="66239-136">(The Digital Signatures tab only appears in File Properties for signed files.) Also, an application can be self-verifying by use of [**CertVerifyCertificateChainPolicy**](/windows/desktop/api/wincrypt/nf-wincrypt-certverifycertificatechainpolicy).</span></span>

<span data-ttu-id="66239-137">Подписывание Authenticode применяется не только для проверки подлинности данных конечными пользователями, но и для исправления ограниченных учетных записей пользователей и родительскими элементами управления в Windows Vista и Windows 7.</span><span class="sxs-lookup"><span data-stu-id="66239-137">Authenticode signing is not only useful for data authentication by end users, but is also needed for patching of Limited User Accounts and by parental controls in Windows Vista and Windows 7.</span></span> <span data-ttu-id="66239-138">Кроме того, для будущих технологий в операционных системах Windows также может потребоваться подпись кода, поэтому настоятельно рекомендуется, чтобы все профессиональные и пугала разработчики получили сертификат подписи кода от центра сертификации.</span><span class="sxs-lookup"><span data-stu-id="66239-138">In addition, future technologies in Windows operating systems may also require that code is signed, so it is strongly advised that all professional and amateur developers acquire a code-signing certificate from a CA.</span></span> <span data-ttu-id="66239-139">Дополнительные сведения о том, как это сделать, можно найти далее в этой статье в разделе [использование доверенного центра сертификации](#using-a-trusted-certificate-authority).</span><span class="sxs-lookup"><span data-stu-id="66239-139">More information on how this is done can be found later in this article in [Using a Trusted Certificate Authority](#using-a-trusted-certificate-authority).</span></span>

<span data-ttu-id="66239-140">Код игры, диспетчеры и установщики могут дополнительно использовать подписывание Аусеникоде, проверяя, что файлы подлинны в коде.</span><span class="sxs-lookup"><span data-stu-id="66239-140">Game code, patchers, and installers can further leverage Authenicode signing by verifying files are authentic in code.</span></span> <span data-ttu-id="66239-141">Это можно использовать для защиты от Памятка по и общей безопасности сети.</span><span class="sxs-lookup"><span data-stu-id="66239-141">This can be used for anti-cheat and general network security.</span></span> <span data-ttu-id="66239-142">Пример кода для проверки подписи файла можно найти здесь: [Пример программы на языке C: Проверка сигнатуры PE-файла](/windows/desktop/SecCrypto/example-c-program--verifying-the-signature-of-a-pe-file)и пример кода для проверки принадлежности сертификата подписи к подписанному файлу можно найти здесь: [как получить сведения из исполняемых файлов, подписанных Authenticode](https://support.microsoft.com/kb/323809).</span><span class="sxs-lookup"><span data-stu-id="66239-142">Example code for checking if a file is signed can be found here: [Example C Program: Verifying the Signature of a PE File](/windows/desktop/SecCrypto/example-c-program--verifying-the-signature-of-a-pe-file), and example code for checking ownership of a signing certificate on a signed file can be found here: [How To Get Information from Authenticode Signed Executables](https://support.microsoft.com/kb/323809).</span></span>

## <a name="getting-started"></a><span data-ttu-id="66239-143">Приступая к работе</span><span class="sxs-lookup"><span data-stu-id="66239-143">Getting Started</span></span>

<span data-ttu-id="66239-144">Чтобы приступить к работе, корпорация Майкрософт предоставляет средства с Visual Studio 2005 и Visual Studio 2008, а также в [Windows SDK](https://msdn.microsoft.com/windowsserver/bb980924.aspx), чтобы помочь выполнить и проверить процесс подписывания кода.</span><span class="sxs-lookup"><span data-stu-id="66239-144">To get started, Microsoft provides tools with Visual Studio 2005 and Visual Studio 2008, and in the [Windows SDK](https://msdn.microsoft.com/windowsserver/bb980924.aspx), to help perform and verify the code-signing process.</span></span> <span data-ttu-id="66239-145">После установки Visual Studio или Windows SDK средства, описанные в этой технической статье, находятся в подкаталоге установки, который может включать в себя один или несколько из следующих компонентов:</span><span class="sxs-lookup"><span data-stu-id="66239-145">After installing Visual Studio or the Windows SDK, the tools described in this technical article are located in a subdirectory of the installation, which may include one or more of the following:</span></span>

-   <span data-ttu-id="66239-146">% SystemDrive% \\ Program files \\ Microsoft Visual Studio 8 \\ SDK \\ v 2.0 \\ bin</span><span class="sxs-lookup"><span data-stu-id="66239-146">%SystemDrive%\\Program Files\\Microsoft Visual Studio 8\\SDK\\v2.0\\Bin</span></span>
-   <span data-ttu-id="66239-147">% SystemDrive% \\ Program files \\ Microsoft Visual Studio 8 \\ VC \\ платформсдк \\ bin</span><span class="sxs-lookup"><span data-stu-id="66239-147">%SystemDrive%\\Program Files\\Microsoft Visual Studio 8\\VC\\PlatformSDK\\Bin</span></span>
-   <span data-ttu-id="66239-148">% SystemDrive% \\ Program files \\ Microsoft Visual Studio 9,0 \\ смартдевицес \\ SDK \\ сдктулс</span><span class="sxs-lookup"><span data-stu-id="66239-148">%SystemDrive%\\Program Files\\Microsoft Visual Studio 9.0\\SmartDevices\\SDK\\SDKTools</span></span>\\
-   <span data-ttu-id="66239-149">% SystemDrive% \\ Program Files \\ Microsoft SDKs \\ Windows \\ v 6.0 a \\ bin</span><span class="sxs-lookup"><span data-stu-id="66239-149">%SystemDrive%\\Program Files\\Microsoft SDKs\\Windows\\v6.0A\\bin</span></span>\\

<span data-ttu-id="66239-150">Следующие средства наиболее полезны для подписания кода:</span><span class="sxs-lookup"><span data-stu-id="66239-150">The following tools are the most useful for signing code:</span></span>

<dl> <dt>

<span data-ttu-id="66239-151"><span id="Certificate_Creation_Tool__MakeCert.exe_"></span><span id="certificate_creation_tool__makecert.exe_"></span><span id="CERTIFICATE_CREATION_TOOL__MAKECERT.EXE_"></span>Средство создания сертификатов (MakeCert.exe)</span><span class="sxs-lookup"><span data-stu-id="66239-151"><span id="Certificate_Creation_Tool__MakeCert.exe_"></span><span id="certificate_creation_tool__makecert.exe_"></span><span id="CERTIFICATE_CREATION_TOOL__MAKECERT.EXE_"></span>Certificate Creation Tool (MakeCert.exe)</span></span>
</dt> <dd>

<span data-ttu-id="66239-152">Создает тестовый сертификат X. 509 в виде CER-файла, который содержит открытый ключ и закрытый ключ в виде PVK-файла.</span><span class="sxs-lookup"><span data-stu-id="66239-152">Generates a test X.509 certificate, as a .cer file, that contains your public key and a private key, as a .pvk file.</span></span> <span data-ttu-id="66239-153">Этот сертификат предназначен только для внутренних целей тестирования и не может использоваться в публичном виде.</span><span class="sxs-lookup"><span data-stu-id="66239-153">This certificate is only for internal testing purposes and can't be used publicly.</span></span>

</dd> <dt>

<span data-ttu-id="66239-154"><span id="pvk2pfx.exe"></span><span id="PVK2PFX.EXE"></span>pvk2pfx.exe</span><span class="sxs-lookup"><span data-stu-id="66239-154"><span id="pvk2pfx.exe"></span><span id="PVK2PFX.EXE"></span>pvk2pfx.exe</span></span>
</dt> <dd>

<span data-ttu-id="66239-155">Создает файл обмена личной информацией (PFX) из пары файлов. cer и. PVK.</span><span class="sxs-lookup"><span data-stu-id="66239-155">Creates a Personal Information Exchange (.pfx) file from a pair of .cer and .pvk files.</span></span> <span data-ttu-id="66239-156">PFX-файл содержит как открытый, так и закрытый ключ.</span><span class="sxs-lookup"><span data-stu-id="66239-156">The .pfx file contains both your public and private key.</span></span>

</dd> <dt>

<span data-ttu-id="66239-157"><span id="SignTool__SignTool.exe_"></span><span id="signtool__signtool.exe_"></span><span id="SIGNTOOL__SIGNTOOL.EXE_"></span>Средство SignTool (SignTool.exe)</span><span class="sxs-lookup"><span data-stu-id="66239-157"><span id="SignTool__SignTool.exe_"></span><span id="signtool__signtool.exe_"></span><span id="SIGNTOOL__SIGNTOOL.EXE_"></span>SignTool (SignTool.exe)</span></span>
</dt> <dd>

<span data-ttu-id="66239-158">Подписывает файл с помощью PFX-файла.</span><span class="sxs-lookup"><span data-stu-id="66239-158">Signs file by using the .pfx file.</span></span> <span data-ttu-id="66239-159">Средство SignTool поддерживает подписывание DLL-файлов, исполняемых файлов, файлов установщик Windows (. msi) и CAB-файлов.</span><span class="sxs-lookup"><span data-stu-id="66239-159">SignTool supports the signing of DLL files, executable files, Windows Installer (.msi) files, and cabinet (.cab) files.</span></span>

</dd> </dl>

> [!Note]  
> <span data-ttu-id="66239-160">При чтении другой документации могут оказаться ссылки на SignCode (SignCode.exe), но это средство является устаревшим и больше не поддерживается — используйте SignTool.</span><span class="sxs-lookup"><span data-stu-id="66239-160">While reading other documentation, you might find references to SignCode (SignCode.exe), but this tool is deprecated and is no longer supported—use SignTool instead.</span></span>

 

## <a name="using-a-trusted-certificate-authority"></a><span data-ttu-id="66239-161">Использование доверенного центра сертификации</span><span class="sxs-lookup"><span data-stu-id="66239-161">Using a Trusted Certificate Authority</span></span>

<span data-ttu-id="66239-162">Чтобы получить доверенный сертификат, необходимо применить к центру сертификации (CA), например VeriSign или Thawte.</span><span class="sxs-lookup"><span data-stu-id="66239-162">To obtain a trusted certificate, you must apply to a Certificate Authority (CA), such as VeriSign or Thawte.</span></span> <span data-ttu-id="66239-163">Корпорация Майкрософт не рекомендует использовать какой-либо центр сертификации, но если вы хотите интегрировать его со службой отчеты об ошибках Windows (WER), рекомендуется использовать VeriSign для выдаче сертификата, так как для доступа к базе данных WER требуется учетная запись Винкуал, для которой требуется идентификатор VeriSign.</span><span class="sxs-lookup"><span data-stu-id="66239-163">Microsoft doesn't recommend any CA over another, but if you want to integrate into the Windows Error Reporting (WER) service, you should consider using VeriSign to issue the certificate, because accessing the WER database requires a WinQual account which requires a VeriSign ID.</span></span> <span data-ttu-id="66239-164">Полный список доверенных сторонних центров сертификации см. в [статье участники программы корневых сертификатов Майкрософт](/previous-versions/ms995347(v=msdn.10)).</span><span class="sxs-lookup"><span data-stu-id="66239-164">For a complete list of trusted third-party certificate authorities, see [Microsoft Root Certificate Program Members](/previous-versions/ms995347(v=msdn.10)).</span></span> <span data-ttu-id="66239-165">Дополнительные сведения о регистрации с помощью WER см. в разделе "[Введение в отчеты об ошибках Windows](https://msdn.microsoft.com/)" в [зоне ISV](https://msdn.microsoft.com/).</span><span class="sxs-lookup"><span data-stu-id="66239-165">For more information about registering with WER, see "[Introducing Windows Error Reporting](https://msdn.microsoft.com/)" in [ISV Zone](https://msdn.microsoft.com/).</span></span>

<span data-ttu-id="66239-166">После получения сертификата из ЦС можно подписать программу с помощью средства SignTool и отпустить программу в общедоступной версии.</span><span class="sxs-lookup"><span data-stu-id="66239-166">After you receive your certificate from the CA, you can sign your program by using SignTool and release your program to the public.</span></span> <span data-ttu-id="66239-167">Однако необходимо соблюдать осторожность при защите закрытого ключа, который содержится в файлах PFX и PVK.</span><span class="sxs-lookup"><span data-stu-id="66239-167">However, you must be careful to protect your private key, which is contained in your .pfx and .pvk files.</span></span> <span data-ttu-id="66239-168">Не забудьте хранить эти файлы в безопасном месте.</span><span class="sxs-lookup"><span data-stu-id="66239-168">Be sure to keep these files in a secure location.</span></span>

## <a name="example-using-a-test-certificate"></a><span data-ttu-id="66239-169">Пример с использованием тестового сертификата</span><span class="sxs-lookup"><span data-stu-id="66239-169">Example Using a Test Certificate</span></span>

<span data-ttu-id="66239-170">Следующие шаги демонстрируют создание сертификата подписи кода для целей тестирования, а также подписывание примера программы Direct3D (с именем BasicHLSL.exe) с помощью этого тестового сертификата.</span><span class="sxs-lookup"><span data-stu-id="66239-170">The following steps demonstrate the creation of a code-signing certificate for testing purposes, followed by the signing of a Direct3D sample program (called BasicHLSL.exe) with this test certificate.</span></span> <span data-ttu-id="66239-171">Эта процедура создает CER-и PVK-файлы (открытые и закрытые ключи соответственно), которые не могут использоваться для общедоступной сертификации.</span><span class="sxs-lookup"><span data-stu-id="66239-171">This procedure creates .cer and .pvk files—your public and private keys, respectively — which cannot be used for public certification.</span></span>

<span data-ttu-id="66239-172">В этом примере отметка времени также добавляется в сигнатуру.</span><span class="sxs-lookup"><span data-stu-id="66239-172">In this example, a time stamp is also added to the signature.</span></span> <span data-ttu-id="66239-173">Метка времени предотвращает недействительность подписи после истечения срока действия сертификата.</span><span class="sxs-lookup"><span data-stu-id="66239-173">A time stamp prevents the signature from becoming invalid when the certificate expires.</span></span> <span data-ttu-id="66239-174">Код, который подписан, но отсутствует метка времени, не будет проверяться после истечения срока действия сертификата.</span><span class="sxs-lookup"><span data-stu-id="66239-174">Code that is signed but lacking a time stamp will not validate after the certificate expires.</span></span> <span data-ttu-id="66239-175">Таким образом, весь открытый код должен иметь отметку времени.</span><span class="sxs-lookup"><span data-stu-id="66239-175">Therefore, all publicly released code should have a time stamp.</span></span>

<span data-ttu-id="66239-176">**Создание сертификата и подписание программы**</span><span class="sxs-lookup"><span data-stu-id="66239-176">**To create a certificate and sign a program**</span></span>

1.  <span data-ttu-id="66239-177">Создайте тестовый сертификат и закрытый ключ с помощью средства создания сертификатов (MakeCert.exe).</span><span class="sxs-lookup"><span data-stu-id="66239-177">Create a test certificate and private key by using the Certificate Creation Tool (MakeCert.exe).</span></span>

    <span data-ttu-id="66239-178">Следующий пример командной строки задает MyPrivateKey в качестве имени файла для файла закрытого ключа (. PVK), Мипубликкэй в качестве имени файла сертификата (CER) и Мисофтварекомпани в качестве имени сертификата.</span><span class="sxs-lookup"><span data-stu-id="66239-178">The following command-line example specifies MyPrivateKey as the file name for the private key (.pvk) file, MyPublicKey as the file name for the certificate (.cer) file, and MySoftwareCompany as the name of the certificate.</span></span> <span data-ttu-id="66239-179">Он также создает самозаверяющий сертификат, чтобы он не имел ненадежного корневого центра сертификации.</span><span class="sxs-lookup"><span data-stu-id="66239-179">It also makes the certificate self-signed, so that it does not have an untrusted root authority.</span></span>

    ```
    MakeCert /n CN=MySoftwareCompany /r /h 0 /eku "1.3.6.1.5.5.7.3.3,1.3.6.1.4.1.311.10.3.13" /e 12-31-2020 /sv MyPrivateKey.pvk MyPublicKey.cer
    ```

    

2.  <span data-ttu-id="66239-180">Создайте файл обмена личной информацией (PFX) из файла закрытого ключа (. PVK) и файла сертификата (CER) с помощью pvk2pfx.exe.</span><span class="sxs-lookup"><span data-stu-id="66239-180">Create a Personal Information Exchange (.pfx) file from your private key (.pvk) file and certificate (.cer) file by using pvk2pfx.exe.</span></span>

    <span data-ttu-id="66239-181">PFX-файл объединяет открытые и закрытые ключи в один файл.</span><span class="sxs-lookup"><span data-stu-id="66239-181">The .pfx file combines your public and private keys into a single file.</span></span> <span data-ttu-id="66239-182">Следующий пример командной строки использует PVK-и CER-файлы из предыдущего шага, чтобы создать PFX-файл с именем Мипфкс и паролем \_ :</span><span class="sxs-lookup"><span data-stu-id="66239-182">The following command-line example uses the .pvk and .cer files from the previous step to create the .pfx file named MyPFX with the password your\_password:</span></span>

    ```
    pvk2pfx.exe -pvk MyPrivateKey.pvk -spc MyPublicKey.cer -pfx MyPFX.pfx -po your_password
    ```

    

3.  <span data-ttu-id="66239-183">Подпишите программу с помощью средства SignTool, используя файл обмена личной информацией (PFX).</span><span class="sxs-lookup"><span data-stu-id="66239-183">Sign your program with your Personal Information Exchange (.pfx) file by using SignTool.</span></span>

    <span data-ttu-id="66239-184">В командной строке можно указать несколько параметров.</span><span class="sxs-lookup"><span data-stu-id="66239-184">You can specify several options on the command line.</span></span> <span data-ttu-id="66239-185">В следующем примере командной строки используется PFX-файл из предыдущего шага, в качестве пароля задается \_ пароль, указывается басичлсл в качестве файла для подписи и извлекается метка времени из указанного сервера:</span><span class="sxs-lookup"><span data-stu-id="66239-185">The following command-line example uses the .pfx file from the previous step, gives your\_password as the password, specifies BasicHLSL as the file to be signed, and retrieves a time stamp from a specified server:</span></span>

    ```
    signtool.exe sign /fd SHA256 /f MyPFX.pfx /p your_password /v /t URL_to_time_stamp_service BasicHLSL.exe
    ```

    

    > [!Note]  
    > <span data-ttu-id="66239-186">URL-адрес службы отметок времени предоставляется центром сертификации и является необязательным для тестирования.</span><span class="sxs-lookup"><span data-stu-id="66239-186">The URL to the time stamp service is provided by the CA, and is optional for testing.</span></span> <span data-ttu-id="66239-187">Для рабочего подписывания важно включить допустимый центр отметок времени, иначе подпись не сможет проверить срок действия сертификата.</span><span class="sxs-lookup"><span data-stu-id="66239-187">It is important for production signing to include a valid time stamp authority, or the signature will fail to validate when the certificate expires.</span></span>

     

4.  <span data-ttu-id="66239-188">Убедитесь, что программа подписана с помощью средства SignTool.</span><span class="sxs-lookup"><span data-stu-id="66239-188">Verify that the program is signed by using SignTool.</span></span>

    <span data-ttu-id="66239-189">Следующий пример командной строки указывает, что средство SignTool должно попытаться проверить подпись на BasicHLSL.exe с помощью всех доступных методов, в то же время предоставляя подробные выходные данные:</span><span class="sxs-lookup"><span data-stu-id="66239-189">The following command-line example specifies that SignTool should attempt to verify the signature on BasicHLSL.exe by using all available methods while providing verbose output:</span></span>

    ```
    signtool.exe verify /a /v BasicHLSL.exe
    ```

    

    <span data-ttu-id="66239-190">В этом примере средство SignTool должно указывать, что сертификат присоединен, а также о том, что он не является доверенным, так как он не выдается центром сертификации.</span><span class="sxs-lookup"><span data-stu-id="66239-190">In this example, SignTool should indicate that the certificate is attached, while also stating that it is not trusted, since it is not issued by a CA.</span></span>

5.  <span data-ttu-id="66239-191">Доверять тестовому сертификату.</span><span class="sxs-lookup"><span data-stu-id="66239-191">Trust the test certificate.</span></span>

    <span data-ttu-id="66239-192">Для тестовых сертификатов необходимо доверять сертификату.</span><span class="sxs-lookup"><span data-stu-id="66239-192">For test certificates you need to trust the certificate.</span></span> <span data-ttu-id="66239-193">Этот шаг следует пропустить для сертификатов, предоставляемых центром сертификации, так как они будут доверенными по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="66239-193">This step should be skipped for certificates provided by a CA since those will trusted by default.</span></span>

    <span data-ttu-id="66239-194">На компьютерах, на которых требуется доверять тестовому сертификату, выполните следующую команду:</span><span class="sxs-lookup"><span data-stu-id="66239-194">On only the computers where you want to trust the test certificate, run the following:</span></span>

    ```
    certmgr.msc
    ```

    

    <span data-ttu-id="66239-195">Затем щелкните правой кнопкой мыши Доверенные корневые центры сертификации и выберите все задачи \| Импорт.</span><span class="sxs-lookup"><span data-stu-id="66239-195">Then right click on Trusted Root Certification Authorities and choose All Tasks \| Import.</span></span> <span data-ttu-id="66239-196">Затем перейдите к созданному PFX-файлу и следуйте инструкциям мастера, поместив сертификат в список доверенных корневых центров сертификации.</span><span class="sxs-lookup"><span data-stu-id="66239-196">Then browse to the .pfx file you created and follow the wizard steps, placing the certificate in the Trusted Root Certification Authorities.</span></span>

    <span data-ttu-id="66239-197">По завершении работы мастера можно начать тестирование с помощью доверенного сертификата на этом компьютере.</span><span class="sxs-lookup"><span data-stu-id="66239-197">When the wizard completes, you can start testing with the trusted certificate on that computer.</span></span>

## <a name="integrating-code-signing-into-the-daily-build-system"></a><span data-ttu-id="66239-198">Интеграция кода для входа в систему ежедневной сборки</span><span class="sxs-lookup"><span data-stu-id="66239-198">Integrating Code Signing into the Daily Build System</span></span>

<span data-ttu-id="66239-199">Чтобы интегрировать подписывание кода в проект, можно создать пакетный файл или скрипт для запуска программ командной строки.</span><span class="sxs-lookup"><span data-stu-id="66239-199">To integrate code signing into a project, you can create a batch file or script to run the command line tools.</span></span> <span data-ttu-id="66239-200">После сборки проекта запустите средство SignTool с соответствующими параметрами (как показано на шаге 3 нашего примера).</span><span class="sxs-lookup"><span data-stu-id="66239-200">After the project is built, run SignTool with the proper settings (as shown in step 3 of our example).</span></span>

<span data-ttu-id="66239-201">Будьте особенно осторожны в процессе сборки, чтобы гарантировать, что доступ к файлам PFX и PVK ограничен минимальным числом компьютеров и пользователей.</span><span class="sxs-lookup"><span data-stu-id="66239-201">Be especially cautious in your build process to insure that access to the .pfx and .pvk files is restricted to as few computers and users as possible.</span></span> <span data-ttu-id="66239-202">Рекомендуется только подписать код с помощью тестового сертификата до тех пор, пока они не будут готовы к отправке.</span><span class="sxs-lookup"><span data-stu-id="66239-202">As a best practice, developers should only sign code by using the test certificate until they are ready to ship.</span></span> <span data-ttu-id="66239-203">Опять же, закрытый ключ (. PVK) должен храниться в защищенном расположении, например в надежной или защищенной комнате, и в идеале — на устройстве шифрования, например на смарт-карте.</span><span class="sxs-lookup"><span data-stu-id="66239-203">Again, the private key (.pvk) should be kept in a secured location, like a safe or locked room, and ideally on a cryptographic device, like a smart card.</span></span>

<span data-ttu-id="66239-204">Другой уровень защиты обеспечивается с помощью Microsoft Authenticode для подписи самого пакета установщик Windows (MSI).</span><span class="sxs-lookup"><span data-stu-id="66239-204">Another layer of protection is provided by using Microsoft Authenticode to sign the Windows Installer (MSI) package itself.</span></span> <span data-ttu-id="66239-205">Это помогает защитить пакет MSI от несанкционированного изменения и случайного повреждения.</span><span class="sxs-lookup"><span data-stu-id="66239-205">This helps protect the MSI package against tampering and accidental corruption.</span></span> <span data-ttu-id="66239-206">Дополнительные сведения о том, как подписывать пакеты с помощью Authenticode, см. в документации по своему средству создания MSI.</span><span class="sxs-lookup"><span data-stu-id="66239-206">Refer to the documentation for your MSI creation tool for more information about how to sign packages with Authenticode.</span></span>

## <a name="revocation"></a><span data-ttu-id="66239-207">Запрет доступа</span><span class="sxs-lookup"><span data-stu-id="66239-207">Revocation</span></span>

<span data-ttu-id="66239-208">В случае, если безопасность закрытого ключа скомпрометирована или какое-либо событие, связанное с безопасностью, отрисовывает Code-Signing сертификат недействителен, разработчик должен отозвать сертификат.</span><span class="sxs-lookup"><span data-stu-id="66239-208">In the event that the security of the private key is compromised or some security-related event renders a Code-Signing certificate invalid, the developer must revoke the certificate.</span></span> <span data-ttu-id="66239-209">Это не приведет к ослаблению целостности разработчика и эффективности кода подписи.</span><span class="sxs-lookup"><span data-stu-id="66239-209">Not doing so would weaken the integrity of the developer and the effectiveness of signing code.</span></span> <span data-ttu-id="66239-210">Центр сертификации также может выдать отзыв с заданным временем; код, подписанный с помощью метки времени до момента повторного вызова, по-прежнему будет считаться действительным, но код со следующей отметкой времени будет недействительным.</span><span class="sxs-lookup"><span data-stu-id="66239-210">A CA can also issue a revocation with specific time; code signed with a time stamp prior to the revocation time will still be considered valid, but code with a subsequent time stamp will be invalid.</span></span> <span data-ttu-id="66239-211">Отзыв сертификата влияет на код в любых приложениях, подписанных отозванным сертификатом.</span><span class="sxs-lookup"><span data-stu-id="66239-211">Certificate revocation affects code in any applications that is signed with the revoked certificate.</span></span>

## <a name="code-signing-drivers"></a><span data-ttu-id="66239-212">Драйверы Code-Signing</span><span class="sxs-lookup"><span data-stu-id="66239-212">Code-Signing Drivers</span></span>

<span data-ttu-id="66239-213">Драйверы могут и должны быть подписаны с поддержкой Authenticode.</span><span class="sxs-lookup"><span data-stu-id="66239-213">Drivers can and should be Authenticode-signed.</span></span> <span data-ttu-id="66239-214">Драйверы режима ядра предъявляют дополнительные требования: 64-разрядные выпуски Windows Vista и Windows 7 препятствуют установке всех неподписанных драйверов в режиме ядра, а все версии Windows будут представлять предупреждение, когда пользователь пытается установить неподписанный драйвер.</span><span class="sxs-lookup"><span data-stu-id="66239-214">Kernel-mode drivers have additional requirements: 64-bit editions of Windows Vista and Windows 7 will prevent installation of all unsigned kernel-mode drivers, and all versions of Windows will present a warning prompt when a user attempts to install an unsigned driver.</span></span> <span data-ttu-id="66239-215">Кроме того, администраторы могут задать групповая политика, чтобы предотвратить установку неподписанных драйверов в Microsoft Windows Server 2003, Windows XP Professional x64 Edition и 32-разрядных выпусках Windows Vista и Windows 7.</span><span class="sxs-lookup"><span data-stu-id="66239-215">In addition, administrators can set Group Policy to prevent unsigned drivers from being installed on Microsoft Windows Server 2003, Windows XP Professional x64 Edition, and 32-bit editions of Windows Vista and Windows 7.</span></span>

<span data-ttu-id="66239-216">Многие типы драйверов могут быть подписаны с помощью подписи, доверенной корпорацией Майкрософт, в рамках программы сертификации Windows для [лаборатории](https://www.microsoft.com/whdc/whql/) WHQL или [программы неклассифицированных подписей](https://www.microsoft.com/whdc/winlogo/drvsign/dqs.mspx) (прежнее название — подпись надежности драйвера), что позволяет системе полностью доверять этим драйверам и устанавливать их даже без административных учетных данных.</span><span class="sxs-lookup"><span data-stu-id="66239-216">Many types of drivers can be signed with a Microsoft-trusted signature — as part of the Windows Certification Program of [Windows Hardware Quality Labs](https://www.microsoft.com/whdc/whql/) (WHQL) or the [Unclassified Signature Program](https://www.microsoft.com/whdc/winlogo/drvsign/dqs.mspx) (formerly named Driver Reliability Signature) — which allows the system to fully trust these drivers and install them even without administrative credentials.</span></span>

<span data-ttu-id="66239-217">Как минимум, драйверы должны быть подписаны с помощью Authenticode, так как драйверы, которые не подписаны или не имеют собственной подписи (то есть подписанные с помощью тестового сертификата), не смогут установить на многих платформах на базе Windows.</span><span class="sxs-lookup"><span data-stu-id="66239-217">At a minimum, drivers should be Authenticode-signed, because drivers that are unsigned or self-signed (that is, signed with a test certificate) will fail to install on many Windows-based platforms.</span></span> <span data-ttu-id="66239-218">Дополнительные сведения о подписывании драйверов и коде и связанных компонентах см. в статье [требования к подписывания драйверов для Windows](https://www.microsoft.com/whdc/winlogo/drvsign/drvsign.mspx) в [центре разработчиков оборудования Windows](https://www.microsoft.com/whdc/).</span><span class="sxs-lookup"><span data-stu-id="66239-218">For more information about signing drivers and code and related feature, see [Driver Signing Requirements for Windows](https://www.microsoft.com/whdc/winlogo/drvsign/drvsign.mspx) on [Windows Hardware Developer Central](https://www.microsoft.com/whdc/).</span></span>

## <a name="summary"></a><span data-ttu-id="66239-219">Сводка</span><span class="sxs-lookup"><span data-stu-id="66239-219">Summary</span></span>

<span data-ttu-id="66239-220">Использование Microsoft Authenticode — это простой процесс.</span><span class="sxs-lookup"><span data-stu-id="66239-220">Using Microsoft Authenticode is a straightforward process.</span></span> <span data-ttu-id="66239-221">После получения CER-файла и создания закрытого ключа достаточно просто использовать средства, предоставляемые корпорацией Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="66239-221">Once you have obtained a CER and created a private key, it is a simple matter of using the tools provided by Microsoft.</span></span> <span data-ttu-id="66239-222">Затем можно включить важные функции в Windows Vista и Windows 7, такие как родительский контроль, и сообщить клиентам, что ваш продукт поступает непосредственно от его законного владельца.</span><span class="sxs-lookup"><span data-stu-id="66239-222">You can then enable important features in Windows Vista and Windows 7, such as parental controls, and let customers know that your product comes directly from its rightful owner.</span></span>

## <a name="more-information"></a><span data-ttu-id="66239-223">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="66239-223">More information</span></span>

<span data-ttu-id="66239-224">Дополнительные сведения о средствах и процессах, связанных с кодом подписи, см. по следующим ссылкам:</span><span class="sxs-lookup"><span data-stu-id="66239-224">More information about tools and processes related to signing code, see the following links:</span></span>

-   [<span data-ttu-id="66239-225">Средства шифрования</span><span class="sxs-lookup"><span data-stu-id="66239-225">Cryptography Tools</span></span>](/windows/desktop/SecCrypto/cryptography-tools)
-   [<span data-ttu-id="66239-226">Справочник по средствам API шифрования</span><span class="sxs-lookup"><span data-stu-id="66239-226">Crypto API Tools Reference</span></span>](/windows/desktop/SecCrypto/cryptoapi-tools-reference)
-   <span data-ttu-id="66239-227">[Общие сведения о Authenticode и Турториалс](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537360(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="66239-227">[Authenticode Overview and Turtorials](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537360(v=vs.85))</span></span>
-   [<span data-ttu-id="66239-228">Цифровые сертификаты</span><span class="sxs-lookup"><span data-stu-id="66239-228">Digital Certificates</span></span>](/windows/desktop/SecCrypto/digital-certificates)
-   [<span data-ttu-id="66239-229">Развертывание Authenticode</span><span class="sxs-lookup"><span data-stu-id="66239-229">Deploying Authenticode</span></span>](https://www.microsoft.com/technet/security/topics/cryptographyetc/authenticodets.mspx)
-   [<span data-ttu-id="66239-230">Как создать временные сертификаты для использования во время разработки</span><span class="sxs-lookup"><span data-stu-id="66239-230">How To: Create Temporary Certificates for Use During Development</span></span>](/dotnet/framework/wcf/feature-details/how-to-create-temporary-certificates-for-use-during-development)

 

 