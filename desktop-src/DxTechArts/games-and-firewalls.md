---
title: Брандмауэр Windows для разработчиков игр
description: В этой статье описывается брандмауэр Windows, почему он существует, что он делает и как это сделать. Что важнее всего, здесь описывается настройка игры для работы с брандмауэром.
ms.assetid: 2ee9f769-03dc-3661-5d5b-6a4ecd151fd5
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 88656fb3f622a847c15544646c333b807f3a0fb2
ms.sourcegitcommit: b7a1da2711221fa99072079bf52399cbdfc6bd9d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "104547447"
---
# <a name="windows-firewall-for-game-developers"></a><span data-ttu-id="68664-104">Брандмауэр Windows для разработчиков игр</span><span class="sxs-lookup"><span data-stu-id="68664-104">Windows Firewall for Game Developers</span></span>

<span data-ttu-id="68664-105">В этой статье описывается брандмауэр Windows, почему он существует, что он делает и как это сделать.</span><span class="sxs-lookup"><span data-stu-id="68664-105">This article describes the Windows Firewall - why it exists, what it accomplishes, and how it does so.</span></span> <span data-ttu-id="68664-106">Что важнее всего, здесь описывается настройка игры для работы с брандмауэром.</span><span class="sxs-lookup"><span data-stu-id="68664-106">Most importantly, it describes how to configure your game to work well with the firewall.</span></span>

<span data-ttu-id="68664-107">Содержимое:</span><span class="sxs-lookup"><span data-stu-id="68664-107">Contents:</span></span>

-   [<span data-ttu-id="68664-108">Что такое брандмауэр?</span><span class="sxs-lookup"><span data-stu-id="68664-108">What is a Firewall?</span></span>](#what-is-a-firewall)
-   [<span data-ttu-id="68664-109">Как узнать, затрагивается ли моя игра?</span><span class="sxs-lookup"><span data-stu-id="68664-109">How can I tell if my game is affected?</span></span>](#how-can-i-tell-if-my-game-is-affected)
-   [<span data-ttu-id="68664-110">Брандмауэр до выхода Windows XP SP2</span><span class="sxs-lookup"><span data-stu-id="68664-110">The Firewall Before Windows XP SP2</span></span>](#the-firewall-before-windows-xp-sp2)
-   [<span data-ttu-id="68664-111">Брандмауэр Windows XP с пакетом обновления 2 (SP2) лучше</span><span class="sxs-lookup"><span data-stu-id="68664-111">Windows XP SP2 Firewall Is Better</span></span>](#windows-xp-sp2-firewall-is-better)
-   [<span data-ttu-id="68664-112">Работа с брандмауэром Windows</span><span class="sxs-lookup"><span data-stu-id="68664-112">Working with the Windows Firewall</span></span>](#working-with-the-windows-firewall)
-   [<span data-ttu-id="68664-113">Интеграция с помощью InstallShield Инсталлскрипт</span><span class="sxs-lookup"><span data-stu-id="68664-113">Integrating using InstallShield InstallScript</span></span>](#integrating-using-installshield-installscript)
-   [<span data-ttu-id="68664-114">Интеграция в разумные для установщик Windows</span><span class="sxs-lookup"><span data-stu-id="68664-114">Integrating into Wise for Windows Installer</span></span>](#integrating-into-wise-for-windows-installer)
-   [<span data-ttu-id="68664-115">Интеграция в установщик Windows</span><span class="sxs-lookup"><span data-stu-id="68664-115">Integrating into Windows Installer</span></span>](#integrating-into-windows-installer)
-   [<span data-ttu-id="68664-116">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="68664-116">Recommendations</span></span>](#recommendations)

## <a name="what-is-a-firewall"></a><span data-ttu-id="68664-117">Что такое брандмауэр?</span><span class="sxs-lookup"><span data-stu-id="68664-117">What is a Firewall?</span></span>

<span data-ttu-id="68664-118">Брандмауэр обеспечивает барьер для вторжений на основе сети.</span><span class="sxs-lookup"><span data-stu-id="68664-118">The firewall provides a barrier against network-based intrusions.</span></span> <span data-ttu-id="68664-119">Он блокирует незапрошенный входящий трафик и делает систему в основном невидимой в Интернете, отклоняя запросы протокола ICMP.</span><span class="sxs-lookup"><span data-stu-id="68664-119">It blocks unsolicited incoming traffic, and makes the system mostly invisible on the internet by rejecting Internet Control Message Protocol (ICMP) requests.</span></span> <span data-ttu-id="68664-120">Это означает, что проверка связи и средство tracert не будут работать.</span><span class="sxs-lookup"><span data-stu-id="68664-120">This means that ping and tracert will not work.</span></span> <span data-ttu-id="68664-121">Брандмауэр также выявляет и отклоняет недопустимые пакеты.</span><span class="sxs-lookup"><span data-stu-id="68664-121">The firewall also looks and rejects invalid packets.</span></span>

<span data-ttu-id="68664-122">Этот барьер предотвращает уступающую атаки.</span><span class="sxs-lookup"><span data-stu-id="68664-122">This barrier prevents opportunistic attacks.</span></span> <span data-ttu-id="68664-123">Атаки распространяются на множество систем с одной и той же уязвимостью.</span><span class="sxs-lookup"><span data-stu-id="68664-123">Attacks spread by finding many systems with the same vulnerability.</span></span> <span data-ttu-id="68664-124">Брандмауэр может воспрепятствовать большому количеству атак, поместив знак "не беспокоить" для этих функций, которые сейчас не используются; Атака пропускается и не заменяется домом.</span><span class="sxs-lookup"><span data-stu-id="68664-124">The firewall can thwart many attacks by putting up a "do not disturb" sign for those features not currently in use; the attack is ignored and does not strike home.</span></span> <span data-ttu-id="68664-125">Основным преимуществом брандмауэра Windows является то, что функции и приложения, которые не используются, не могут подвергнуться атаке.</span><span class="sxs-lookup"><span data-stu-id="68664-125">The essential benefit of the Windows Firewall is that features and applications that are not in use cannot be avenues for attack.</span></span>

<span data-ttu-id="68664-126">Пользователь настраивает систему, чтобы определить, какие приложения и компоненты необходимы и должны быть открыты для сети.</span><span class="sxs-lookup"><span data-stu-id="68664-126">The user configures the system to identify what applications and features are needed and should be open to the network.</span></span> <span data-ttu-id="68664-127">Это происходит либо при установке приложения, либо при попытке открыть его в сети.</span><span class="sxs-lookup"><span data-stu-id="68664-127">This happens either when an application is installed or when it tries to open itself to the network.</span></span>

## <a name="how-can-i-tell-if-my-game-is-affected"></a><span data-ttu-id="68664-128">Как узнать, затрагивается ли моя игра?</span><span class="sxs-lookup"><span data-stu-id="68664-128">How can I tell if my game is affected?</span></span>

<span data-ttu-id="68664-129">После появления пакета обновления 2 (SP2) для Windows XP брандмауэр Windows был широко развернут.</span><span class="sxs-lookup"><span data-stu-id="68664-129">With the arrival of Windows XP SP2, the Windows Firewall has been widely deployed.</span></span> <span data-ttu-id="68664-130">Все многопользовательские игры Windows оказываются в некоторой степени.</span><span class="sxs-lookup"><span data-stu-id="68664-130">All multiplayer Windows games are affected to some degree.</span></span> <span data-ttu-id="68664-131">Хотя клиенты, как правило, являются хорошей формой, серверами, узлами и одноранговыми узлами в одноранговой сети, необходимо настроить брандмауэр для продолжения работы.</span><span class="sxs-lookup"><span data-stu-id="68664-131">While clients are generally in good shape, servers, hosts, and peers in peer-to-peer all need the firewall configured to continue working.</span></span> <span data-ttu-id="68664-132">В частности, входящий незапрошенный трафик удаляется.</span><span class="sxs-lookup"><span data-stu-id="68664-132">Specifically, incoming unsolicited traffic is dropped.</span></span> <span data-ttu-id="68664-133">Брандмауэр перехватывает пакеты фильтрации сетевого трафика на основе содержимого пакетов и последней сетевой активности.</span><span class="sxs-lookup"><span data-stu-id="68664-133">The firewall intercepts network-traffic filter packets based on the packet contents and recent network activity.</span></span> <span data-ttu-id="68664-134">Брандмауэр использует содержимое и действие для принятия решения о пересылке или удалении пакета.</span><span class="sxs-lookup"><span data-stu-id="68664-134">The firewall uses the contents and activity to decide to forward or drop a packet.</span></span> <span data-ttu-id="68664-135">После правильной настройки брандмауэра игра сможет принимать входящий нежелательный трафик, как и раньше.</span><span class="sxs-lookup"><span data-stu-id="68664-135">Once the firewall is properly configured, a game will be able to accept inbound unsolicited traffic as before.</span></span>

<span data-ttu-id="68664-136">Кто имеет входящий нежелательный трафик?</span><span class="sxs-lookup"><span data-stu-id="68664-136">Who has inbound unsolicited traffic?</span></span>

-   <span data-ttu-id="68664-137">Клиент/сервер: все участники подключаются к центральному серверу.</span><span class="sxs-lookup"><span data-stu-id="68664-137">Client/Server: All participants connect to a central server.</span></span> <span data-ttu-id="68664-138">Центральным сервером является сервер с входящим нежелательным трафиком.</span><span class="sxs-lookup"><span data-stu-id="68664-138">The central server is the one with incoming unsolicited traffic.</span></span> <span data-ttu-id="68664-139">Клиенты, подключающиеся к серверу, запрашивает возвращаемый трафик, который является ожидаемым и может проходить через брандмауэр при соблюдении правил для клиентов.</span><span class="sxs-lookup"><span data-stu-id="68664-139">The clients connecting to the server are soliciting return traffic, which is expected and is allowed to pass through the firewall if the rules for clients are followed.</span></span> <span data-ttu-id="68664-140">Центральный сервер должен быть настроен на принятие незапрошенного трафика, чтобы разрешить передачу трафика клиента через брандмауэр.</span><span class="sxs-lookup"><span data-stu-id="68664-140">The central server must be configured to accept the unsolicited traffic to allow the client traffic to pass through the firewall.</span></span>
-   <span data-ttu-id="68664-141">Массовый многопользовательский режим (MMP). все участники подключены к центру обработки данных.</span><span class="sxs-lookup"><span data-stu-id="68664-141">Massively Multiplayer (MMP): All participants are connected to a data center.</span></span> <span data-ttu-id="68664-142">Это количество для сложной связи "клиент-сервер", так как центр обработки данных имеет входящий незапрошенный трафик.</span><span class="sxs-lookup"><span data-stu-id="68664-142">This amounts to a complex client/server relationship, as the data center has the inbound unsolicited traffic.</span></span> <span data-ttu-id="68664-143">Участники являются клиентами, и в общем случае не требуется принимать незапрошенный трафик.</span><span class="sxs-lookup"><span data-stu-id="68664-143">The participants are clients, and in general do not need to accept unsolicited traffic.</span></span>
-   <span data-ttu-id="68664-144">Одноранговая сеть, в которой все участники соединены друг с другом напрямую. все участники должны быть готовы к приему незапрошенного трафика от любого нового игрока, присоединяемого к группе.</span><span class="sxs-lookup"><span data-stu-id="68664-144">Peer-to-Peer, where all participants are connected to each other directly: All participants must be ready to accept unsolicited traffic from any new player joining the group.</span></span> <span data-ttu-id="68664-145">В определенном смысле, каждый из участников должен функционировать как узел, поэтому все они должны быть настроены так, как будто они являются узлами.</span><span class="sxs-lookup"><span data-stu-id="68664-145">In a sense, each of the participants must function as a host, so they must all be configured as if they were hosts.</span></span>

<span data-ttu-id="68664-146">Обычно клиенты являются хорошей формой.</span><span class="sxs-lookup"><span data-stu-id="68664-146">Clients are generally in good shape.</span></span> <span data-ttu-id="68664-147">Их исходящие подключения протокола управления передачей (TCP/IP) будут работать, как и исходящие сообщения протокола датаграмм (UDP), а также своевременные ответы на эти сообщения. Этот порт остается открытым в течение 90 секунд после каждого исходящего сообщения в ожидаемом ответе.</span><span class="sxs-lookup"><span data-stu-id="68664-147">Their outgoing Transmission Control Protocol/Internet Protocol (TCP/IP) connections will work fine, as will outgoing User Datagram Protocol (UDP) messages along with timely responses to those messages - the firewall keeps the port open for 90 seconds after each outgoing message in anticipation of a reply.</span></span>

## <a name="the-firewall-before-windows-xp-sp2"></a><span data-ttu-id="68664-148">Брандмауэр до выхода Windows XP SP2</span><span class="sxs-lookup"><span data-stu-id="68664-148">The Firewall Before Windows XP SP2</span></span>

<span data-ttu-id="68664-149">Брандмауэр подключения к Интернету (ICF) в Windows XP и Windows Server 2003 является фильтром пакетов с отслеживанием состояния и обрабатывает как протокол IP версии 4 (IPv4), так и Протокол Интернета версии 6 (IPv6).</span><span class="sxs-lookup"><span data-stu-id="68664-149">The Internet Connection Firewall (ICF) in Windows XP and Windows Server 2003 is a stateful packet filter, and handles both Internet Protocol, version 4 (IPv4) and Internet Protocol, version 6 (IPv6).</span></span> <span data-ttu-id="68664-150">Однако он не включен по умолчанию и не поддерживает сторонние сетевые стеки, в которых имеется значительный номер в мире, например крупные Интернет-поставщики, включая местные телефонные компании.</span><span class="sxs-lookup"><span data-stu-id="68664-150">However, it is not on by default and does not support 3rd party network stacks, of which there are a significant number in the world, such as large internet providers including national telephone companies.</span></span>

<span data-ttu-id="68664-151">Для тех, которые не включены в Windows XP с пакетом обновления 2 (SP2), настоятельно рекомендуется включить ICF.</span><span class="sxs-lookup"><span data-stu-id="68664-151">For those not on Windows XP SP2, turning on the ICF is highly recommended.</span></span> <span data-ttu-id="68664-152">См. инструкции по использованию брандмауэра Интернета в https://www.microsoft.com/security/protect качестве первого шага по обеспечению безопасности компьютера.</span><span class="sxs-lookup"><span data-stu-id="68664-152">See the instructions "Use an Internet Firewall" on https://www.microsoft.com/security/protect as the first step to securing your PC.</span></span> <span data-ttu-id="68664-153">Брандмауэр подключения к Интернету (ICF) предоставляет сопоставление портов для переопределения фильтра пакетов.</span><span class="sxs-lookup"><span data-stu-id="68664-153">The Internet Connection Firewall (ICF) provides port mapping to override the packet filter.</span></span> <span data-ttu-id="68664-154">По сути, вы указываете порт для открытия, который остается открытым, пока он не будет закрыт.</span><span class="sxs-lookup"><span data-stu-id="68664-154">Essentially, you specify the port to open and it remains opened until you close it.</span></span> <span data-ttu-id="68664-155">Если пользователь перезагружается перед закрытием, он остается открытым, пока не будет закрыт.</span><span class="sxs-lookup"><span data-stu-id="68664-155">If the user reboots before it is closed, it will remain open until specifically closed.</span></span> <span data-ttu-id="68664-156">Управление брандмауэром и управление сопоставлением портов осуществляется с помощью [**инетшарингманажер**](/previous-versions/windows/desktop/api/netcon/nn-netcon-inetsharingmanager) (IPv4) и [**INetFwV6Mgr**](/previous-versions/windows/desktop/ics/inetfwv6mgr) (IPv6).</span><span class="sxs-lookup"><span data-stu-id="68664-156">The control of the firewall and the management of the port mappings is done via [**INetSharingManager**](/previous-versions/windows/desktop/api/netcon/nn-netcon-inetsharingmanager) (IPv4) and [**INetFwV6Mgr**](/previous-versions/windows/desktop/ics/inetfwv6mgr) (IPv6).</span></span>

<span data-ttu-id="68664-157">Брандмауэр Windows для Windows XP с пакетом обновления 2 (SP2) — это более комплексное решение, которое поддерживает сторонние сетевые стеки и обеспечивает более интеллектуальный доступ к портам: порты остаются открытыми, пока приложения, которым они требуются, остаются активными.</span><span class="sxs-lookup"><span data-stu-id="68664-157">The Windows Firewall for Windows XP SP2 is a more comprehensive solution that does support 3rd party network stacks, and handles ports more intelligently: ports are kept open only so long as the application that needs them is still active.</span></span>

## <a name="windows-xp-sp2-firewall-is-better"></a><span data-ttu-id="68664-158">Брандмауэр Windows XP с пакетом обновления 2 (SP2) лучше</span><span class="sxs-lookup"><span data-stu-id="68664-158">Windows XP SP2 Firewall Is Better</span></span>

<span data-ttu-id="68664-159">Windows XP с пакетом обновления 2 (SP2) предоставляет варианты и параметры безопасности на передний план.</span><span class="sxs-lookup"><span data-stu-id="68664-159">Windows XP SP2 puts the security choices and settings out front.</span></span> <span data-ttu-id="68664-160">Целью является защита по умолчанию и предоставление пользователю возможности получать сведения о том, какие приложения разрешено запускать на своем компьютере.</span><span class="sxs-lookup"><span data-stu-id="68664-160">The goal is to protect by default, and allow the user to make informed choices about what applications are allowed to run on their machine.</span></span>

<span data-ttu-id="68664-161">Новый брандмауэр Windows доступен в Windows XP SP2 и Windows Server 2003 с пакетом обновления 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="68664-161">The new Windows Firewall is available on both Windows XP SP2 and Windows Server 2003 Service Pack 1 (SP1).</span></span> <span data-ttu-id="68664-162">Как и ICF, это программный брандмауэр, поддерживающий как IPv4, так и IPv6, но в отличие от ICF брандмауэр Windows:</span><span class="sxs-lookup"><span data-stu-id="68664-162">Like the ICF, it is a software firewall that supports both IPv4 and IPv6, but unlike ICF the Windows Firewall:</span></span>

-   <span data-ttu-id="68664-163">Имеет защиту системы во время загрузки, устраняя небольшое окно уязвимости во время загрузки.</span><span class="sxs-lookup"><span data-stu-id="68664-163">Has boot-time protection of the system, eliminating a small window of vulnerability during boot.</span></span>
-   <span data-ttu-id="68664-164">Поддерживает сторонние сетевые стеки.</span><span class="sxs-lookup"><span data-stu-id="68664-164">Supports 3rd party network stacks.</span></span>
-   <span data-ttu-id="68664-165">Имеет режим "включено без исключений", который блокирует все незапрошенные входящие пакеты.</span><span class="sxs-lookup"><span data-stu-id="68664-165">Has an "on with no exceptions" mode that blocks all unsolicited incoming packets.</span></span> <span data-ttu-id="68664-166">Это замечательно, если вы используете общедоступную сеть, например в аэропорту или кафе.</span><span class="sxs-lookup"><span data-stu-id="68664-166">This is great when you're using a public network, such as in an airport or coffee shop.</span></span>

<span data-ttu-id="68664-167">В режиме "вкл. без исключений" все статические отверстия закрываются.</span><span class="sxs-lookup"><span data-stu-id="68664-167">In the "on with no exceptions" mode, all static holes are closed.</span></span> <span data-ttu-id="68664-168">Вызовы API для открытия статического отверстия разрешены, но отложены; то есть они не применяются до тех пор, пока брандмауэр не вернется к нормальной работе.</span><span class="sxs-lookup"><span data-stu-id="68664-168">API calls to open a static hole are allowed but deferred; that is, they are not applied until the firewall switches back to normal operation.</span></span> <span data-ttu-id="68664-169">Все запросы на прослушивание приложениями также будут игнорироваться.</span><span class="sxs-lookup"><span data-stu-id="68664-169">All listen requests by applications will also be ignored.</span></span> <span data-ttu-id="68664-170">Исходящие подключения по-прежнему будут выполнены.</span><span class="sxs-lookup"><span data-stu-id="68664-170">Outbound connections will still succeed.</span></span>

<span data-ttu-id="68664-171">Для новых приложений добавьте приложение в список исключений во время установки.</span><span class="sxs-lookup"><span data-stu-id="68664-171">For new applications, add your application to the "Exceptions List" during installation.</span></span> <span data-ttu-id="68664-172">Вы можете добавить приложение с помощью интерфейса [**инетфваусоризедаппликатионс**](/previous-versions/windows/desktop/api/netfw/nn-netfw-inetfwauthorizedapplications) , указав полный путь.</span><span class="sxs-lookup"><span data-stu-id="68664-172">You can add the application using the [**INetFwAuthorizedApplications**](/previous-versions/windows/desktop/api/netfw/nn-netfw-inetfwauthorizedapplications) interface, supplying the full path.</span></span> <span data-ttu-id="68664-173">В этом примере будут рассмотрены подробные сведения.</span><span class="sxs-lookup"><span data-stu-id="68664-173">We'll cover the details in the sample.</span></span>

<span data-ttu-id="68664-174">В качестве побочной заметки может возникнуть вопрос, что это угроза безопасности, с которой приложения могут добавлять и удалять приложения из списка исключений, или, возможно, вы думаете, что приложения могут полностью отключить брандмауэр.</span><span class="sxs-lookup"><span data-stu-id="68664-174">As a side note, you may be wondering if it is a security risk that applications can add and remove applications from the exceptions list any user intervention, or perhaps you think that the bigger risk is that applications can disable the firewall altogether.</span></span> <span data-ttu-id="68664-175">Для выполнения этих феатс приложение должно иметь права администратора.</span><span class="sxs-lookup"><span data-stu-id="68664-175">To perform these feats, the application must have administrator privileges.</span></span> <span data-ttu-id="68664-176">Если вредоносный код работает в системе в режиме администратора, игра уже переключается и хакер уже выиграл.</span><span class="sxs-lookup"><span data-stu-id="68664-176">If you have malicious code running in administrator mode on your system, the game is already over and the hacker has already won.</span></span> <span data-ttu-id="68664-177">Возможность отключения брандмауэра может помешать атаке на несколько сносок.</span><span class="sxs-lookup"><span data-stu-id="68664-177">The hacker's ability to disable the firewall would merit little more than a footnote.</span></span>

<span data-ttu-id="68664-178">Устаревшие приложения, включая приложения, установленные до обновления до Windows XP с пакетом обновления 2 (SP2), обрабатываются с помощью всплывающего окна список исключений (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="68664-178">Legacy applications, including applications installed before the user upgraded to Windows XP SP2, are handled with the Exceptions List popup (see Figure 1).</span></span> <span data-ttu-id="68664-179">В этом диалоговом окне показано, когда приложение пытается открыть порт для входящего трафика. при вызове BIND () с ненулевым портом для UDP или Accept () для протокола TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="68664-179">This dialog shows when an application tries to open a port for incoming traffic - either when calling bind() with a non-zero port for UDP, or accept() for TCP/IP protocol.</span></span> <span data-ttu-id="68664-180">Вы должны работать от имени администратора для "разблокирования" приложений, в то время как параметр "спрашивать позже" запрещает это время, но снова запрашивается в следующий раз.</span><span class="sxs-lookup"><span data-stu-id="68664-180">You must be running as an Administrator to "Unblock" applications, while "Ask Me Later" disallows this time around but asks again next time.</span></span>

<span data-ttu-id="68664-181">Это не блокирующее, Системное модальное диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="68664-181">This is a non-blocking, system modal dialog box.</span></span> <span data-ttu-id="68664-182">При запуске приложения Microsoft Direct3D в полноэкранном режим диалоговое окно находится под названием. и пользователь может обменять его, когда приложение выходит из полноэкранного режима или Alt-вкладки на Рабочий стол.</span><span class="sxs-lookup"><span data-stu-id="68664-182">When running a fullscreen Microsoft Direct3D application, the dialog comes in underneath; and the user can then handle it when the application exits fullscreen mode or alt-tabs back to the desktop.</span></span> <span data-ttu-id="68664-183">Однако не всегда очевидно, что это диалоговое окно появлялось при полноэкранном запуске игры, поэтому важно избегать появления этого диалогового окна с помощью интерфейса [**инетфваусоризедаппликатионс**](/previous-versions/windows/desktop/api/netfw/nn-netfw-inetfwauthorizedapplications) , как описано ниже.</span><span class="sxs-lookup"><span data-stu-id="68664-183">However, it is not always obvious to the user that this dialog has appeared when a game is running fullscreen, so it is important to avoid causing this dialog to appear by using [**INetFwAuthorizedApplications**](/previous-versions/windows/desktop/api/netfw/nn-netfw-inetfwauthorizedapplications) interface as discussed below.</span></span>

<span data-ttu-id="68664-184">**Рис. 1. Всплывающее диалоговое окно списка исключений**</span><span class="sxs-lookup"><span data-stu-id="68664-184">**Figure 1. Exceptions List Popup Dialog**</span></span>

![всплывающее диалоговое окно списка исключений](images/firewalls1.jpg)

<span data-ttu-id="68664-186">Вы заметите, что всплывающее окно знает имя и издателя приложения.</span><span class="sxs-lookup"><span data-stu-id="68664-186">You'll notice that the popup knows the name and publisher of the application.</span></span> <span data-ttu-id="68664-187">Здесь нет никакого волшебства — он извлекается из информации о версии исполняемого файла.</span><span class="sxs-lookup"><span data-stu-id="68664-187">There's no magic here - it's pulled from the executable's version information.</span></span> <span data-ttu-id="68664-188">Эта информация является важным средством администрирования системы. Он используется даже для текущей работы совместимости приложений.</span><span class="sxs-lookup"><span data-stu-id="68664-188">This information is an important system administration tool; it is even used for ongoing application compatibility work.</span></span> <span data-ttu-id="68664-189">Некоторые приложения не сохраняют сведения о версии в актуальном состоянии.</span><span class="sxs-lookup"><span data-stu-id="68664-189">Some applications neglect to keep this version information up-to-date.</span></span>

<span data-ttu-id="68664-190">Пользователи также могут добавлять свои приложения через пользовательский интерфейс (см. рис. 2).</span><span class="sxs-lookup"><span data-stu-id="68664-190">Users can also add their applications through the user interface (UI) (see Figure 2)</span></span>

<span data-ttu-id="68664-191">**Рис. 2. Настройка брандмауэра**</span><span class="sxs-lookup"><span data-stu-id="68664-191">**Figure 2. Configuring the Firewall**</span></span>

![Настройка брандмауэра](images/firewalls2.jpg)

<span data-ttu-id="68664-193">**Рис. 3. Добавление программы в список исключений брандмауэра**</span><span class="sxs-lookup"><span data-stu-id="68664-193">**Figure 3. Adding a Program to the Firewall Exceptions List**</span></span>

![Добавление программы в список исключений брандмауэра](images/firewalls3.jpg)

<span data-ttu-id="68664-195">Лучшим сценарием является автоматическое добавление добавлений и удалений из списка исключений.</span><span class="sxs-lookup"><span data-stu-id="68664-195">The best scenario is to make additions and removals from the exception list automated.</span></span> <span data-ttu-id="68664-196">Лучшим моментом для выполнения этих дополнений является процесс установки и удаления.</span><span class="sxs-lookup"><span data-stu-id="68664-196">The best time to perform these additions and removals is during the install and uninstall process.</span></span> <span data-ttu-id="68664-197">Для добавления или удаления из списка исключений брандмауэра требуются права администратора, поэтому обязательно примите это в учетную запись.</span><span class="sxs-lookup"><span data-stu-id="68664-197">Adding or removing from the firewall exception list requires administrator privileges, so be sure to take this into account.</span></span>

## <a name="working-with-the-windows-firewall"></a><span data-ttu-id="68664-198">Работа с брандмауэром Windows</span><span class="sxs-lookup"><span data-stu-id="68664-198">Working with the Windows Firewall</span></span>

<span data-ttu-id="68664-199">Опять же, большинство игр необходимо добавить в список исключений брандмауэра, если они могут работать как сервер или если они реализуют протокол однорангового обмена данными.</span><span class="sxs-lookup"><span data-stu-id="68664-199">Again, most games only need to be added to the firewall exception list if they can function as a server or if they implement a peer-to-peer communication protocol.</span></span> <span data-ttu-id="68664-200">FirewallInstallHelper.dll является примером библиотеки DLL, которую можно вызывать из установщика.</span><span class="sxs-lookup"><span data-stu-id="68664-200">The FirewallInstallHelper.dll is a sample DLL that can be called from an installer.</span></span> <span data-ttu-id="68664-201">Источник предоставляется, если вы хотите интегрировать источник непосредственно в собственное приложение.</span><span class="sxs-lookup"><span data-stu-id="68664-201">Source is provided if you want to integrate the source directly into your own application.</span></span> <span data-ttu-id="68664-202">Пример можно найти здесь:</span><span class="sxs-lookup"><span data-stu-id="68664-202">The sample can be found here:</span></span>



|             |                                                                              |
|-------------|------------------------------------------------------------------------------|
| <span data-ttu-id="68664-203">Источник:</span><span class="sxs-lookup"><span data-stu-id="68664-203">Source:</span></span>     | <span data-ttu-id="68664-204">(Корень пакета SDK) \\ Примеры \\ C++ \\ Разное \\ фиреваллинсталлхелпер</span><span class="sxs-lookup"><span data-stu-id="68664-204">(SDK root)\\Samples\\C++\\Misc\\FirewallInstallHelper</span></span>                        |
| <span data-ttu-id="68664-205">Исполняемый файл:</span><span class="sxs-lookup"><span data-stu-id="68664-205">Executable:</span></span> | <span data-ttu-id="68664-206">(Корень пакета SDK) \\ Примеры \\ для \\ \\ \\ <arch> \\FirewallInstallHelper.dll "прочие ячейки C++"</span><span class="sxs-lookup"><span data-stu-id="68664-206">(SDK root)\\Samples\\C++\\Misc\\Bin\\<arch>\\FirewallInstallHelper.dll</span></span> |



 

<span data-ttu-id="68664-207">Ниже перечислены функции, экспортируемые этой библиотекой DLL.</span><span class="sxs-lookup"><span data-stu-id="68664-207">The functions exported by this DLL are the following:</span></span>

<dl> <dt>

<span data-ttu-id="68664-208"><span id="AddApplicationToExceptionListW"></span><span id="addapplicationtoexceptionlistw"></span><span id="ADDAPPLICATIONTOEXCEPTIONLISTW"></span>**аддаппликатионтоексцептионлиств**</span><span class="sxs-lookup"><span data-stu-id="68664-208"><span id="AddApplicationToExceptionListW"></span><span id="addapplicationtoexceptionlistw"></span><span id="ADDAPPLICATIONTOEXCEPTIONLISTW"></span>**AddApplicationToExceptionListW**</span></span>
</dt> <dd>

<span data-ttu-id="68664-209">Эта функция добавляет приложение в список исключений.</span><span class="sxs-lookup"><span data-stu-id="68664-209">This function adds an application to the exception list.</span></span> <span data-ttu-id="68664-210">Он принимает полный путь к исполняемому файлу и понятное имя, которое будет отображаться в списке исключений брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="68664-210">It takes a complete path to the executable and a friendly name that will appear in the firewall exception list.</span></span> <span data-ttu-id="68664-211">Для этой функции требуются права администратора.</span><span class="sxs-lookup"><span data-stu-id="68664-211">This function requires administrator privileges.</span></span>

</dd> <dt>

<span data-ttu-id="68664-212"><span id="AddApplicationToExceptionListA"></span><span id="addapplicationtoexceptionlista"></span><span id="ADDAPPLICATIONTOEXCEPTIONLISTA"></span>**аддаппликатионтоексцептионлиста**</span><span class="sxs-lookup"><span data-stu-id="68664-212"><span id="AddApplicationToExceptionListA"></span><span id="addapplicationtoexceptionlista"></span><span id="ADDAPPLICATIONTOEXCEPTIONLISTA"></span>**AddApplicationToExceptionListA**</span></span>
</dt> <dd>

<span data-ttu-id="68664-213">Версия **аддаппликатионтоексцептионлиств** для ANSI</span><span class="sxs-lookup"><span data-stu-id="68664-213">ANSI version of **AddApplicationToExceptionListW**</span></span>

</dd> <dt>

<span data-ttu-id="68664-214"><span id="RemoveApplicationFromExceptionListW"></span><span id="removeapplicationfromexceptionlistw"></span><span id="REMOVEAPPLICATIONFROMEXCEPTIONLISTW"></span>**ремовеаппликатионфромексцептионлиств**</span><span class="sxs-lookup"><span data-stu-id="68664-214"><span id="RemoveApplicationFromExceptionListW"></span><span id="removeapplicationfromexceptionlistw"></span><span id="REMOVEAPPLICATIONFROMEXCEPTIONLISTW"></span>**RemoveApplicationFromExceptionListW**</span></span>
</dt> <dd>

<span data-ttu-id="68664-215">Эта функция удаляет приложение из списка исключений.</span><span class="sxs-lookup"><span data-stu-id="68664-215">This function removes the application from the exception list.</span></span> <span data-ttu-id="68664-216">Он принимает полный путь к исполняемому файлу.</span><span class="sxs-lookup"><span data-stu-id="68664-216">It takes in a complete path to the executable.</span></span> <span data-ttu-id="68664-217">Для этой функции требуются права администратора</span><span class="sxs-lookup"><span data-stu-id="68664-217">This function requires administrator privileges</span></span>

</dd> <dt>

<span data-ttu-id="68664-218"><span id="RemoveApplicationFromExceptionListA"></span><span id="removeapplicationfromexceptionlista"></span><span id="REMOVEAPPLICATIONFROMEXCEPTIONLISTA"></span>**ремовеаппликатионфромексцептионлиста**</span><span class="sxs-lookup"><span data-stu-id="68664-218"><span id="RemoveApplicationFromExceptionListA"></span><span id="removeapplicationfromexceptionlista"></span><span id="REMOVEAPPLICATIONFROMEXCEPTIONLISTA"></span>**RemoveApplicationFromExceptionListA**</span></span>
</dt> <dd>

<span data-ttu-id="68664-219">Версия **ремовеаппликатионфромексцептионлиств** для ANSI</span><span class="sxs-lookup"><span data-stu-id="68664-219">ANSI version of **RemoveApplicationFromExceptionListW**</span></span>

</dd> <dt>

<span data-ttu-id="68664-220"><span id="CanLaunchMultiplayerGameW"></span><span id="canlaunchmultiplayergamew"></span><span id="CANLAUNCHMULTIPLAYERGAMEW"></span>**канлаунчмултиплайергамев**</span><span class="sxs-lookup"><span data-stu-id="68664-220"><span id="CanLaunchMultiplayerGameW"></span><span id="canlaunchmultiplayergamew"></span><span id="CANLAUNCHMULTIPLAYERGAMEW"></span>**CanLaunchMultiplayerGameW**</span></span>
</dt> <dd>

<span data-ttu-id="68664-221">Эта функция сообщает, было ли приложение отключено или удалено из списка исключений.</span><span class="sxs-lookup"><span data-stu-id="68664-221">This function reports if the application has been disabled or removed from the exceptions list.</span></span> <span data-ttu-id="68664-222">Он должен вызываться при каждом запуске игры.</span><span class="sxs-lookup"><span data-stu-id="68664-222">It should be called every time the game is run.</span></span> <span data-ttu-id="68664-223">Функция принимает полный путь к исполняемому файлу.</span><span class="sxs-lookup"><span data-stu-id="68664-223">The function takes in a complete path to the executable.</span></span> <span data-ttu-id="68664-224">Эта функция не требует прав администратора.</span><span class="sxs-lookup"><span data-stu-id="68664-224">This function does not require administrator privileges.</span></span>

</dd> <dt>

<span data-ttu-id="68664-225"><span id="CanLaunchMultiplayerGameA"></span><span id="canlaunchmultiplayergamea"></span><span id="CANLAUNCHMULTIPLAYERGAMEA"></span>**канлаунчмултиплайергамеа**</span><span class="sxs-lookup"><span data-stu-id="68664-225"><span id="CanLaunchMultiplayerGameA"></span><span id="canlaunchmultiplayergamea"></span><span id="CANLAUNCHMULTIPLAYERGAMEA"></span>**CanLaunchMultiplayerGameA**</span></span>
</dt> <dd>

<span data-ttu-id="68664-226">Версия **канлаунчмултиплайергамев** для ANSI</span><span class="sxs-lookup"><span data-stu-id="68664-226">ANSI version of **CanLaunchMultiplayerGameW**</span></span>

</dd> <dt>

<span data-ttu-id="68664-227"><span id="SetMSIFirewallProperties"></span><span id="setmsifirewallproperties"></span><span id="SETMSIFIREWALLPROPERTIES"></span>**сетмсифиреваллпропертиес**</span><span class="sxs-lookup"><span data-stu-id="68664-227"><span id="SetMSIFirewallProperties"></span><span id="setmsifirewallproperties"></span><span id="SETMSIFIREWALLPROPERTIES"></span>**SetMSIFirewallProperties**</span></span>
</dt> <dd>

<span data-ttu-id="68664-228">Этот метод следует вызывать только при использовании настраиваемых действий в установщик Windows.</span><span class="sxs-lookup"><span data-stu-id="68664-228">Call this only if you are using custom actions in Windows Installer.</span></span> <span data-ttu-id="68664-229">Дополнительные сведения см. ниже.</span><span class="sxs-lookup"><span data-stu-id="68664-229">See below for more details.</span></span>

</dd> <dt>

<span data-ttu-id="68664-230"><span id="AddToExceptionListUsingMSI"></span><span id="addtoexceptionlistusingmsi"></span><span id="ADDTOEXCEPTIONLISTUSINGMSI"></span>**аддтоексцептионлистусингмси**</span><span class="sxs-lookup"><span data-stu-id="68664-230"><span id="AddToExceptionListUsingMSI"></span><span id="addtoexceptionlistusingmsi"></span><span id="ADDTOEXCEPTIONLISTUSINGMSI"></span>**AddToExceptionListUsingMSI**</span></span>
</dt> <dd>

<span data-ttu-id="68664-231">Этот метод следует вызывать только при использовании настраиваемых действий в установщик Windows.</span><span class="sxs-lookup"><span data-stu-id="68664-231">Call this only if you are using custom actions in Windows Installer.</span></span> <span data-ttu-id="68664-232">Дополнительные сведения см. ниже.</span><span class="sxs-lookup"><span data-stu-id="68664-232">See below for more details.</span></span>

</dd> <dt>

<span data-ttu-id="68664-233"><span id="RemoveFromExceptionListUsingMSI"></span><span id="removefromexceptionlistusingmsi"></span><span id="REMOVEFROMEXCEPTIONLISTUSINGMSI"></span>**ремовефромексцептионлистусингмси**</span><span class="sxs-lookup"><span data-stu-id="68664-233"><span id="RemoveFromExceptionListUsingMSI"></span><span id="removefromexceptionlistusingmsi"></span><span id="REMOVEFROMEXCEPTIONLISTUSINGMSI"></span>**RemoveFromExceptionListUsingMSI**</span></span>
</dt> <dd>

<span data-ttu-id="68664-234">Этот метод следует вызывать только при использовании настраиваемых действий в установщик Windows.</span><span class="sxs-lookup"><span data-stu-id="68664-234">Call this only if you are using custom actions in Windows Installer.</span></span> <span data-ttu-id="68664-235">Дополнительные сведения см. ниже.</span><span class="sxs-lookup"><span data-stu-id="68664-235">See below for more details.</span></span>

</dd> </dl>

<span data-ttu-id="68664-236">В следующих разделах описываются конкретные методы вызова экспортированных функций DLL из этого Фиреваллинсталлхелпер из пакета InstallShield, разумно или установщик Windows.</span><span class="sxs-lookup"><span data-stu-id="68664-236">The following sections describe specific methods of calling the exported DLL functions from this FirewallInstallHelper from within an InstallShield, Wise, or Windows Installer package.</span></span> <span data-ttu-id="68664-237">Все методы отображают одинаковые результаты, и разработчик может определить, какой метод реализовать.</span><span class="sxs-lookup"><span data-stu-id="68664-237">All methods render the same results and it is up to the developer to determine which method to implement.</span></span>

## <a name="integrating-using-installshield-installscript"></a><span data-ttu-id="68664-238">Интеграция с помощью InstallShield Инсталлскрипт</span><span class="sxs-lookup"><span data-stu-id="68664-238">Integrating using InstallShield InstallScript</span></span>

<span data-ttu-id="68664-239">Альтернативный способ использования API брандмауэра заключается в добавлении вызовов функции в InstallShield Инсталлскрипт.</span><span class="sxs-lookup"><span data-stu-id="68664-239">An alternate method of using the Firewall APIs is to add the function calls to an InstallShield InstallScript.</span></span> <span data-ttu-id="68664-240">Шаги, необходимые для интеграции, довольно просты:</span><span class="sxs-lookup"><span data-stu-id="68664-240">The steps required to integrate are fairly simple:</span></span>

1.  <span data-ttu-id="68664-241">Откройте проект Инсталлскрипт в редакторе InstallShield.</span><span class="sxs-lookup"><span data-stu-id="68664-241">Open an InstallScript project in the InstallShield editor.</span></span>
2.  <span data-ttu-id="68664-242">Добавьте FirewallInstallHelper.dll в проект в виде файла поддержки.</span><span class="sxs-lookup"><span data-stu-id="68664-242">Add the FirewallInstallHelper.dll to the project as a support file.</span></span>

    1.  <span data-ttu-id="68664-243">На вкладке помощник по проекту откройте вкладку файлы приложения.</span><span class="sxs-lookup"><span data-stu-id="68664-243">Under Project Assistant tab, open the Application Files tab.</span></span>
    2.  <span data-ttu-id="68664-244">Нажмите кнопку Добавить файлы, чтобы добавить файлы в целевую папку приложения.</span><span class="sxs-lookup"><span data-stu-id="68664-244">Click on the Add Files button to add files to the Application Target Folder.</span></span>
    3.  <span data-ttu-id="68664-245">Перейдите к созданной FirewallInstallHelper.dll или используйте ту, которая была создана в пакете SDK для DirectX, и добавьте ее в проект.</span><span class="sxs-lookup"><span data-stu-id="68664-245">Browse to the FirewallInstallHelper.dll that you have built or use the one provided in the DirectX SDK and add it to the project.</span></span>

3.  <span data-ttu-id="68664-246">Добавьте Инсталлскрипт в проект.</span><span class="sxs-lookup"><span data-stu-id="68664-246">Add InstallScript to the project.</span></span>

    1.  <span data-ttu-id="68664-247">Откройте представление конструктора установки и щелкните поведение и логику \| инсталлскрипт</span><span class="sxs-lookup"><span data-stu-id="68664-247">Open the Installation Designer view, and click on the Behavior and Logic \| InstallScript</span></span>
    2.  <span data-ttu-id="68664-248">Щелкните файл Инсталлскрипт (обычно Setup. RUL), чтобы открыть его в редакторе.</span><span class="sxs-lookup"><span data-stu-id="68664-248">Click on the InstallScript file (usually setup.rul) to open it in the editor</span></span>
    3.  <span data-ttu-id="68664-249">Вставьте следующий код в файл Инсталлскрипт:</span><span class="sxs-lookup"><span data-stu-id="68664-249">Paste the following code into the InstallScript file:</span></span>

    ``` syntax
    #include "ifx.h"

    prototype BOOL FirewallInstallHelper.AddApplicationToExceptionListW( WSTRING, WSTRING );
    prototype BOOL FirewallInstallHelper.RemoveApplicationFromExceptionListW( WSTRING );

    function OnMoved()
        WSTRING path[256];
    begin
        // The DLL has been installed into the TARGETDIR
        if !MAINTENANCE then // TRUE when installing
            UseDLL( TARGETDIR ^ "FirewallInstallHelper.dll" );
            path = TARGETDIR ^ "TODO: change to relative path to executable from install directory";
            FirewallInstallHelper.AddApplicationToExceptionListW( path, "TODO: change to friendly app name" );
            UnUseDLL( TARGETDIR ^ "FirewallInstallHelper.dll" );
        endif;
    end;
          

    function OnMoving()
        WSTRING path[256];
    begin
        // The DLL is about to be removed from TARGETDIR
        if MAINTENANCE && UNINST != "" then // TRUE when uninstalling
            UseDLL( TARGETDIR ^ "FirewallInstallHelper.dll" );
            path = TARGETDIR ^ "TODO: change to relative path to executable from install directory";
            FirewallInstallHelper.RemoveApplicationFromExceptionListW( path );
            UnUseDLL( TARGETDIR ^ "FirewallInstallHelper.dll" );
        endif;
    end;
    ```

    4.  <span data-ttu-id="68664-250">Измените комментарии TODO, указав имя приложения, которое будет отображаться в списке исключений брандмауэра, и путь к исполняемому файлу игры относительно каталога установки.</span><span class="sxs-lookup"><span data-stu-id="68664-250">Change the TODO comments with the application name that will be shown in the Firewall Exception List and the path to the game executable relative to the installation directory.</span></span>

## <a name="integrating-into-wise-for-windows-installer"></a><span data-ttu-id="68664-251">Интеграция в разумные для установщик Windows</span><span class="sxs-lookup"><span data-stu-id="68664-251">Integrating into Wise for Windows Installer</span></span>

<span data-ttu-id="68664-252">Чтобы выполнить интеграцию с разумным для установщик Windows, необходимо выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="68664-252">To integrate with Wise for Windows Installer, these steps have to be done:</span></span>

1.  <span data-ttu-id="68664-253">Откройте проект установщик Windows.</span><span class="sxs-lookup"><span data-stu-id="68664-253">Open your Wise for Windows Installer project.</span></span>
2.  <span data-ttu-id="68664-254">Выберите вкладку "эксперт по установке" в нижней части страницы.</span><span class="sxs-lookup"><span data-stu-id="68664-254">Select the "Installation Expert" tab at the bottom.</span></span>
3.  <span data-ttu-id="68664-255">Щелкните файлы и добавьте FirewallInstallHelper.dll из ДКССДК в каталог установки игры.</span><span class="sxs-lookup"><span data-stu-id="68664-255">Click on Files, and add the FirewallInstallHelper.dll from the DXSDK to the game's install directory.</span></span>
4.  <span data-ttu-id="68664-256">Выберите вкладку "Скрипт MSI" внизу.</span><span class="sxs-lookup"><span data-stu-id="68664-256">Select the "MSI script" tab at the bottom.</span></span>
5.  <span data-ttu-id="68664-257">В нижней части экрана перейдите на вкладку "Выполнение немедленного выполнения".</span><span class="sxs-lookup"><span data-stu-id="68664-257">Select the "Execute Immediate" tab near the bottom.</span></span>
6.  <span data-ttu-id="68664-258">После Костфинализе добавьте действие "Set Property", которое задает для параметра FULLPATH значение " \[ INSTALLDIR \] относительный путь к исполняемому файлу из каталога установки".</span><span class="sxs-lookup"><span data-stu-id="68664-258">After CostFinalize, add a "Set Property" action that sets FULLPATH to "\[INSTALLDIR\]relative path to executable from install directory".</span></span> <span data-ttu-id="68664-259">Например, " \[ INSTALLDIR \]game.exe" без кавычек</span><span class="sxs-lookup"><span data-stu-id="68664-259">For example, "\[INSTALLDIR\]game.exe" without the quotes</span></span>
7.  <span data-ttu-id="68664-260">В нижней части страницы выберите вкладку "выполнение отложена".</span><span class="sxs-lookup"><span data-stu-id="68664-260">Select the "Execute Deferred" tab near the bottom.</span></span>
8.  <span data-ttu-id="68664-261">После Публишпродукт добавьте оператор If с условием "не установлено" (с учетом регистра).</span><span class="sxs-lookup"><span data-stu-id="68664-261">After PublishProduct, add an "If statement" with the condition "NOT Installed" (case sensitive).</span></span>
9.  <span data-ttu-id="68664-262">В блоке if добавьте действие "вызов пользовательской библиотеки DLL из назначения".</span><span class="sxs-lookup"><span data-stu-id="68664-262">Within the If block, add a "Call Custom DLL from Destination" action.</span></span>

    1.  <span data-ttu-id="68664-263">Задайте для поля DLL-файла значение « \[ INSTALLDIR \]FirewallInstallHelper.dll».</span><span class="sxs-lookup"><span data-stu-id="68664-263">Set the DLL File field to "\[INSTALLDIR\]FirewallInstallHelper.dll."</span></span>
    2.  <span data-ttu-id="68664-264">Задайте для поля имя функции значение "Аддаппликатионтоексцептионлиста".</span><span class="sxs-lookup"><span data-stu-id="68664-264">Set the Function Name field to "AddApplicationToExceptionListA."</span></span>
    3.  <span data-ttu-id="68664-265">Добавьте параметр с типом "указатель строки", свойством "источник значения" и именем свойства "FULLPATH".</span><span class="sxs-lookup"><span data-stu-id="68664-265">Add a parameter with type "string pointer", value source "Property", and property name "FULLPATH."</span></span>
    4.  <span data-ttu-id="68664-266">Добавьте второй параметр с типом "указатель строки", значением Source "Constant" и задайте в качестве значения константы понятное имя приложения, которое должно отображаться в списке исключений брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="68664-266">Add a second parameter with type "string pointer", value source "Constant", and set the constant value to the friendly application name you want displayed in the firewall exception list.</span></span>
    5.  <span data-ttu-id="68664-267">Закройте блок If, добавив оператор End.</span><span class="sxs-lookup"><span data-stu-id="68664-267">Close the If block by adding an "End Statement."</span></span>

10. <span data-ttu-id="68664-268">Непосредственно над действием Ремовефилес в верхней части добавьте еще один блок If с условием "Remove ~ =" ALL "" (с учетом регистра и без внешних кавычек).</span><span class="sxs-lookup"><span data-stu-id="68664-268">Just above the RemoveFiles action near the top, add another If block, with the condition to be "REMOVE~="ALL"" (case sensitive and without the outer quotes).</span></span>
11. <span data-ttu-id="68664-269">В втором блоке if добавьте действие "вызов пользовательской библиотеки DLL из назначения".</span><span class="sxs-lookup"><span data-stu-id="68664-269">Within the second If block, add a "Call Custom DLL from Destination" action.</span></span>

    1.  <span data-ttu-id="68664-270">Задайте для поля DLL-файла значение « \[ INSTALLDIR \]FirewallInstallHelper.dll».</span><span class="sxs-lookup"><span data-stu-id="68664-270">Set the DLL File field to "\[INSTALLDIR\]FirewallInstallHelper.dll."</span></span>
    2.  <span data-ttu-id="68664-271">Задайте для поля имя функции значение "Ремовеаппликатионфромексцептионлиста".</span><span class="sxs-lookup"><span data-stu-id="68664-271">Set the Function Name field to "RemoveApplicationFromExceptionListA."</span></span>
    3.  <span data-ttu-id="68664-272">Добавьте параметр с типом "указатель строки", свойством "источник значения" и именем свойства "FULLPATH".</span><span class="sxs-lookup"><span data-stu-id="68664-272">Add a parameter with type "string pointer", value source "Property", and property name "FULLPATH."</span></span>
    4.  <span data-ttu-id="68664-273">Закройте второй блок If, добавив оператор End.</span><span class="sxs-lookup"><span data-stu-id="68664-273">Close the second If block by adding an "End Statement."</span></span>

## <a name="integrating-into-windows-installer"></a><span data-ttu-id="68664-274">Интеграция в установщик Windows</span><span class="sxs-lookup"><span data-stu-id="68664-274">Integrating into Windows Installer</span></span>

<span data-ttu-id="68664-275">Для интеграции с установщик Windows на высоком уровне необходимо выполнить эти действия.</span><span class="sxs-lookup"><span data-stu-id="68664-275">To integrate with Windows Installer at the high level, these steps have to be done.</span></span> <span data-ttu-id="68664-276">Они будут подробно описаны ниже.</span><span class="sxs-lookup"><span data-stu-id="68664-276">They will be explained in detail below:</span></span>

-   <span data-ttu-id="68664-277">Добавьте 2 свойства "Фриендлинамефорфиревалл" и "Релативепастоексефорфиревалл", как описано ниже.</span><span class="sxs-lookup"><span data-stu-id="68664-277">Add 2 properties "FriendlyNameForFirewall" and "RelativePathToExeForFirewall" as described below.</span></span>
-   <span data-ttu-id="68664-278">После действия Костфинализе вызовите "Сетмсифиреваллпропертиес" в непосредственных настраиваемых действиях, чтобы задать соответствующие свойства MSI для других настраиваемых действий.</span><span class="sxs-lookup"><span data-stu-id="68664-278">After the CostFinalize action, call "SetMSIFirewallProperties" in an immediate custom action to set the appropriate MSI properties for the other custom actions.</span></span>
-   <span data-ttu-id="68664-279">Во время установки после действия Инсталлфилес вызовите отложенное настраиваемое действие, которое использует функцию Аддтоексцептионлистусингмси в Фиреваллинсталлхелпер.</span><span class="sxs-lookup"><span data-stu-id="68664-279">During install after the InstallFiles action, call a deferred custom action that uses the FirewallInstallHelper's "AddToExceptionListUsingMSI" function.</span></span>
-   <span data-ttu-id="68664-280">Во время удаления после действия Инсталлфилес вызовите отложенное настраиваемое действие, использующее функцию Фиреваллинсталлхелпер "Ремовефромексцептионлистусингмси".</span><span class="sxs-lookup"><span data-stu-id="68664-280">During uninstall after the InstallFiles action, call a deferred custom action that uses the FirewallInstallHelper's "RemoveFromExceptionListUsingMSI" function.</span></span>
-   <span data-ttu-id="68664-281">Во время отката вызовите отложенное пользовательское действие, которое также вызывает функцию "Ремовефромексцептионлистусингмси" Фиреваллинсталлхелпер.</span><span class="sxs-lookup"><span data-stu-id="68664-281">During rollback, call a deferred custom action which also calls the FirewallInstallHelper's "RemoveFromExceptionListUsingMSI" function.</span></span>

<span data-ttu-id="68664-282">Ниже приведены шаги, необходимые для выполнения этой задачи с помощью редактора MSI, например Orca, найденного в пакете Platform SDK.</span><span class="sxs-lookup"><span data-stu-id="68664-282">The following is the steps needed to do this using an MSI editor such as Orca found in the Platform SDK.</span></span> <span data-ttu-id="68664-283">Обратите внимание, что некоторые редакторы имеют мастера, упрощающие некоторые из этих шагов:</span><span class="sxs-lookup"><span data-stu-id="68664-283">Note that some editors have wizards that simplify some of these steps:</span></span>

1.  <span data-ttu-id="68664-284">Откройте пакет MSI в Orca.</span><span class="sxs-lookup"><span data-stu-id="68664-284">Open the MSI package in Orca.</span></span>
2.  <span data-ttu-id="68664-285">Добавьте следующий код в двоичную таблицу:</span><span class="sxs-lookup"><span data-stu-id="68664-285">Add the following to the Binary table:</span></span>

    

    | <span data-ttu-id="68664-286">Имя</span><span class="sxs-lookup"><span data-stu-id="68664-286">Name</span></span>     | <span data-ttu-id="68664-287">Данные</span><span class="sxs-lookup"><span data-stu-id="68664-287">Data</span></span>                                                                                                                                                                          |
    |----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | <span data-ttu-id="68664-288">БРАНДМАУЭРА</span><span class="sxs-lookup"><span data-stu-id="68664-288">FIREWALL</span></span> | <span data-ttu-id="68664-289">Наведите его на FirewallInstallHelper.dll.</span><span class="sxs-lookup"><span data-stu-id="68664-289">Point it to the FirewallInstallHelper.dll.</span></span> <span data-ttu-id="68664-290">Этот файл будет внедрен в пакет MSI, поэтому этот шаг придется выполнять каждый раз при повторной компиляции FirewallInstallHelper.dll.</span><span class="sxs-lookup"><span data-stu-id="68664-290">This file will be embedded in the MSI package so you will have to do this step every time you recompile FirewallInstallHelper.dll.</span></span> |

    

     

3.  <span data-ttu-id="68664-291">Добавьте следующий объект в таблицу CustomAction:</span><span class="sxs-lookup"><span data-stu-id="68664-291">Add the following to CustomAction table:</span></span>

    

    | <span data-ttu-id="68664-292">Действие</span><span class="sxs-lookup"><span data-stu-id="68664-292">Action</span></span>                   | <span data-ttu-id="68664-293">Тип</span><span class="sxs-lookup"><span data-stu-id="68664-293">Type</span></span>                                                                                                                                                                                                   | <span data-ttu-id="68664-294">Источник</span><span class="sxs-lookup"><span data-stu-id="68664-294">Source</span></span>   | <span data-ttu-id="68664-295">Назначение</span><span class="sxs-lookup"><span data-stu-id="68664-295">Target</span></span>                          |
    |--------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|---------------------------------|
    | <span data-ttu-id="68664-296">фиреваллсетмсипропертиес</span><span class="sxs-lookup"><span data-stu-id="68664-296">FirewallSetMSIProperties</span></span> | <span data-ttu-id="68664-297">Мсидбкустомактионтипедлл + Мсидбкустомактионтипебинаридата + Мсидбкустомактионтипеконтинуе = 65</span><span class="sxs-lookup"><span data-stu-id="68664-297">msidbCustomActionTypeDll + msidbCustomActionTypeBinaryData + msidbCustomActionTypeContinue = 65</span></span>                                                                                                        | <span data-ttu-id="68664-298">БРАНДМАУЭРА</span><span class="sxs-lookup"><span data-stu-id="68664-298">FIREWALL</span></span> | <span data-ttu-id="68664-299">сетмсифиреваллпропертиес</span><span class="sxs-lookup"><span data-stu-id="68664-299">SetMSIFirewallProperties</span></span>        |
    | <span data-ttu-id="68664-300">фиревалладд</span><span class="sxs-lookup"><span data-stu-id="68664-300">FirewallAdd</span></span>              | <span data-ttu-id="68664-301">Мсидбкустомактионтипедлл + Мсидбкустомактионтипебинаридата + Мсидбкустомактионтипеконтинуе + msidbCustomActionTypeInScript + msidbCustomActionTypeNoImpersonate = 3137</span><span class="sxs-lookup"><span data-stu-id="68664-301">msidbCustomActionTypeDll + msidbCustomActionTypeBinaryData + msidbCustomActionTypeContinue + msidbCustomActionTypeInScript + msidbCustomActionTypeNoImpersonate = 3137</span></span>                                 | <span data-ttu-id="68664-302">БРАНДМАУЭРА</span><span class="sxs-lookup"><span data-stu-id="68664-302">FIREWALL</span></span> | <span data-ttu-id="68664-303">аддтоексцептионлистусингмси</span><span class="sxs-lookup"><span data-stu-id="68664-303">AddToExceptionListUsingMSI</span></span>      |
    | <span data-ttu-id="68664-304">фиреваллремове</span><span class="sxs-lookup"><span data-stu-id="68664-304">FirewallRemove</span></span>           | <span data-ttu-id="68664-305">Мсидбкустомактионтипедлл + Мсидбкустомактионтипебинаридата + Мсидбкустомактионтипеконтинуе + msidbCustomActionTypeInScript + msidbCustomActionTypeNoImpersonate = 3137</span><span class="sxs-lookup"><span data-stu-id="68664-305">msidbCustomActionTypeDll + msidbCustomActionTypeBinaryData + msidbCustomActionTypeContinue + msidbCustomActionTypeInScript + msidbCustomActionTypeNoImpersonate = 3137</span></span>                                 | <span data-ttu-id="68664-306">БРАНДМАУЭРА</span><span class="sxs-lookup"><span data-stu-id="68664-306">FIREWALL</span></span> | <span data-ttu-id="68664-307">ремовефромексцептионлистусингмси</span><span class="sxs-lookup"><span data-stu-id="68664-307">RemoveFromExceptionListUsingMSI</span></span> |
    | <span data-ttu-id="68664-308">фиреваллроллбаккадд</span><span class="sxs-lookup"><span data-stu-id="68664-308">FirewallRollBackAdd</span></span>      | <span data-ttu-id="68664-309">Мсидбкустомактионтипедлл + Мсидбкустомактионтипебинаридата + Мсидбкустомактионтипеконтинуе + msidbCustomActionTypeRollback + msidbCustomActionTypeInScript + msidbCustomActionTypeNoImpersonate = 3393</span><span class="sxs-lookup"><span data-stu-id="68664-309">msidbCustomActionTypeDll + msidbCustomActionTypeBinaryData + msidbCustomActionTypeContinue + msidbCustomActionTypeRollback + msidbCustomActionTypeInScript + msidbCustomActionTypeNoImpersonate = 3393</span></span> | <span data-ttu-id="68664-310">БРАНДМАУЭРА</span><span class="sxs-lookup"><span data-stu-id="68664-310">FIREWALL</span></span> | <span data-ttu-id="68664-311">ремовефромексцептионлистусингмси</span><span class="sxs-lookup"><span data-stu-id="68664-311">RemoveFromExceptionListUsingMSI</span></span> |
    | <span data-ttu-id="68664-312">фиреваллроллбаккремове</span><span class="sxs-lookup"><span data-stu-id="68664-312">FirewallRollBackRemove</span></span>   | <span data-ttu-id="68664-313">Мсидбкустомактионтипедлл + Мсидбкустомактионтипебинаридата + Мсидбкустомактионтипеконтинуе + msidbCustomActionTypeRollback + msidbCustomActionTypeInScript + msidbCustomActionTypeNoImpersonate = 3393</span><span class="sxs-lookup"><span data-stu-id="68664-313">msidbCustomActionTypeDll + msidbCustomActionTypeBinaryData + msidbCustomActionTypeContinue + msidbCustomActionTypeRollback + msidbCustomActionTypeInScript + msidbCustomActionTypeNoImpersonate = 3393</span></span> | <span data-ttu-id="68664-314">БРАНДМАУЭРА</span><span class="sxs-lookup"><span data-stu-id="68664-314">FIREWALL</span></span> | <span data-ttu-id="68664-315">аддтоексцептионлистусингмси</span><span class="sxs-lookup"><span data-stu-id="68664-315">AddToExceptionListUsingMSI</span></span>      |

    

     

4.  <span data-ttu-id="68664-316">Добавьте в таблицу Инсталлексекутесекуенце следующее:</span><span class="sxs-lookup"><span data-stu-id="68664-316">Add the following to the InstallExecuteSequence table:</span></span>

    

    | <span data-ttu-id="68664-317">Действие</span><span class="sxs-lookup"><span data-stu-id="68664-317">Action</span></span>                   | <span data-ttu-id="68664-318">Условие</span><span class="sxs-lookup"><span data-stu-id="68664-318">Condition</span></span>     | <span data-ttu-id="68664-319">Последовательность</span><span class="sxs-lookup"><span data-stu-id="68664-319">Sequence</span></span> | <span data-ttu-id="68664-320">Примечания</span><span class="sxs-lookup"><span data-stu-id="68664-320">Notes</span></span>                                                                                                                                                                      |
    |--------------------------|---------------|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | <span data-ttu-id="68664-321">фиреваллсетмсипропертиес</span><span class="sxs-lookup"><span data-stu-id="68664-321">FirewallSetMSIProperties</span></span> |               | <span data-ttu-id="68664-322">1010</span><span class="sxs-lookup"><span data-stu-id="68664-322">1010</span></span>     | <span data-ttu-id="68664-323">Это место вскоре после Костфинализе.</span><span class="sxs-lookup"><span data-stu-id="68664-323">This places soon after CostFinalize.</span></span>                                                                                                                                       |
    | <span data-ttu-id="68664-324">фиревалладд</span><span class="sxs-lookup"><span data-stu-id="68664-324">FirewallAdd</span></span>              | <span data-ttu-id="68664-325">НЕ установлено</span><span class="sxs-lookup"><span data-stu-id="68664-325">NOT Installed</span></span> | <span data-ttu-id="68664-326">4021</span><span class="sxs-lookup"><span data-stu-id="68664-326">4021</span></span>     | <span data-ttu-id="68664-327">Это пользовательское действие выполняется только во время новой установки.</span><span class="sxs-lookup"><span data-stu-id="68664-327">This custom action will only happen during a fresh install.</span></span> <span data-ttu-id="68664-328">Порядковый номер помещает действие после Инсталлфилес и после отката.</span><span class="sxs-lookup"><span data-stu-id="68664-328">The sequence number places the action after InstallFiles and after the rollbacks.</span></span>                              |
    | <span data-ttu-id="68664-329">фиреваллроллбаккадд</span><span class="sxs-lookup"><span data-stu-id="68664-329">FirewallRollBackAdd</span></span>      | <span data-ttu-id="68664-330">НЕ установлено</span><span class="sxs-lookup"><span data-stu-id="68664-330">NOT Installed</span></span> | <span data-ttu-id="68664-331">4020</span><span class="sxs-lookup"><span data-stu-id="68664-331">4020</span></span>     | <span data-ttu-id="68664-332">Это пользовательское действие выполняется только при отмене новой установки.</span><span class="sxs-lookup"><span data-stu-id="68664-332">This custom action will only happen when a fresh install is cancelled.</span></span> <span data-ttu-id="68664-333">Порядковый номер помещает действие после Инсталлфилес и перед добавлением настраиваемого действия.</span><span class="sxs-lookup"><span data-stu-id="68664-333">The sequence number places the action after InstallFiles and before the Add custom action.</span></span>          |
    | <span data-ttu-id="68664-334">фиреваллремове</span><span class="sxs-lookup"><span data-stu-id="68664-334">FirewallRemove</span></span>           | <span data-ttu-id="68664-335">Установлено</span><span class="sxs-lookup"><span data-stu-id="68664-335">Installed</span></span>     | <span data-ttu-id="68664-336">3461</span><span class="sxs-lookup"><span data-stu-id="68664-336">3461</span></span>     | <span data-ttu-id="68664-337">Это пользовательское действие будет происходить только во время удаления.</span><span class="sxs-lookup"><span data-stu-id="68664-337">This custom action will only happen during uninstall.</span></span> <span data-ttu-id="68664-338">Порядковый номер помещает действие непосредственно перед Ремовефилес и после отката.</span><span class="sxs-lookup"><span data-stu-id="68664-338">The sequence number places the action directly before RemoveFiles and after the rollbacks.</span></span>                           |
    | <span data-ttu-id="68664-339">фиреваллроллбаккремове</span><span class="sxs-lookup"><span data-stu-id="68664-339">FirewallRollBackRemove</span></span>   | <span data-ttu-id="68664-340">НЕ установлено</span><span class="sxs-lookup"><span data-stu-id="68664-340">NOT Installed</span></span> | <span data-ttu-id="68664-341">3460</span><span class="sxs-lookup"><span data-stu-id="68664-341">3460</span></span>     | <span data-ttu-id="68664-342">Это пользовательское действие выполняется только при отмене удаления.</span><span class="sxs-lookup"><span data-stu-id="68664-342">This custom action will only happen when an uninstall is cancelled.</span></span> <span data-ttu-id="68664-343">Порядковый номер помещает действие непосредственно перед Ремовефилес и перед удалением настраиваемого действия.</span><span class="sxs-lookup"><span data-stu-id="68664-343">The sequence number places the action directly before RemoveFiles and before the Remove custom action.</span></span> |

    

     

5.  <span data-ttu-id="68664-344">Добавьте следующий фрагмент в таблицу свойств:</span><span class="sxs-lookup"><span data-stu-id="68664-344">Add the following to the Property table:</span></span>

    

    | <span data-ttu-id="68664-345">Свойство</span><span class="sxs-lookup"><span data-stu-id="68664-345">Property</span></span>                     | <span data-ttu-id="68664-346">Значение</span><span class="sxs-lookup"><span data-stu-id="68664-346">Value</span></span>                                                                             |
    |------------------------------|-----------------------------------------------------------------------------------|
    | <span data-ttu-id="68664-347">фриендлинамефорфиревалл</span><span class="sxs-lookup"><span data-stu-id="68664-347">FriendlyNameForFirewall</span></span>      | <span data-ttu-id="68664-348">Должно быть именем, которое будет отображаться в списке исключений.</span><span class="sxs-lookup"><span data-stu-id="68664-348">Needs to be the name the exception list will display.</span></span> <span data-ttu-id="68664-349">Например, "example Game"</span><span class="sxs-lookup"><span data-stu-id="68664-349">For example, "Example Game"</span></span> |
    | <span data-ttu-id="68664-350">релативепастоексефорфиревалл</span><span class="sxs-lookup"><span data-stu-id="68664-350">RelativePathToExeForFirewall</span></span> | <span data-ttu-id="68664-351">Должен быть установленным исполняемым файлом игры.</span><span class="sxs-lookup"><span data-stu-id="68664-351">Needs to be the installed executable of the game.</span></span> <span data-ttu-id="68664-352">Например, "ExampleGame.exe"</span><span class="sxs-lookup"><span data-stu-id="68664-352">For example, "ExampleGame.exe"</span></span>  |

    

     

<span data-ttu-id="68664-353">Дополнительные сведения о установщик Windows см. в разделе [установщик Windows](/windows/desktop/Msi/windows-installer-portal).</span><span class="sxs-lookup"><span data-stu-id="68664-353">For more information on Windows Installer, see [Windows Installer](/windows/desktop/Msi/windows-installer-portal).</span></span>

## <a name="recommendations"></a><span data-ttu-id="68664-354">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="68664-354">Recommendations</span></span>

<span data-ttu-id="68664-355">Брандмауэр будет оставаться в курсе.</span><span class="sxs-lookup"><span data-stu-id="68664-355">The firewall is here to stay.</span></span> <span data-ttu-id="68664-356">Эти рекомендации позволят вашим заказчикам лучше работать с брандмауэром Windows.</span><span class="sxs-lookup"><span data-stu-id="68664-356">These recommendations will give your customers a good firewall experience with your Windows game:</span></span>

-   <span data-ttu-id="68664-357">Не сообщайте пользователям о необходимости отключения брандмауэра для игры.</span><span class="sxs-lookup"><span data-stu-id="68664-357">Don't tell users to disable the firewall to play your game.</span></span> <span data-ttu-id="68664-358">Это делает весь компьютер уязвимым даже в том случае, если они не воспроизводят игру.</span><span class="sxs-lookup"><span data-stu-id="68664-358">This makes the entire machine vulnerable even when they aren't playing your game.</span></span>
-   <span data-ttu-id="68664-359">Сделайте конфигурацию брандмауэра удобной для пользователей.</span><span class="sxs-lookup"><span data-stu-id="68664-359">Make the firewall configuration seamless for your users.</span></span> <span data-ttu-id="68664-360">Добавьте приложение в список исключений во время установки и удалите приложение из списка исключений во время установки.</span><span class="sxs-lookup"><span data-stu-id="68664-360">Add your application to the exception list during installation, and remove your application from the exception list during installation.</span></span>
-   <span data-ttu-id="68664-361">Сообщите пользователю о том, что многопользовательский режим блокируется состоянием брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="68664-361">Give feedback to the user if multiplayer is blocked by the firewall state.</span></span> <span data-ttu-id="68664-362">Например, отключите сетевые функции, если они не работают, так как приложение не разрешено или система находится в режиме "без исключений".</span><span class="sxs-lookup"><span data-stu-id="68664-362">For example, disable networking features if they won't work either because the application is disallowed or because the system is in the "no exceptions" mode.</span></span>

 

 