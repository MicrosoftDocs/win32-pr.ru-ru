---
title: Установка по запросу для игр
description: 'В этой технической статье обсуждаются два метода: Установка по запросу и установка в фоновом режиме с помощью установщик Windows.'
ms.assetid: abaaa7bf-8ed8-0425-6845-3671a56fe7fc
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 064dc58c563c372d1320a21040920e492e4e65e4
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105672339"
---
# <a name="install-on-demand-for-games"></a><span data-ttu-id="3e6ef-103">Установка по запросу для игр</span><span class="sxs-lookup"><span data-stu-id="3e6ef-103">Install-on-Demand for Games</span></span>

<span data-ttu-id="3e6ef-104">В этой технической статье обсуждаются два метода: Установка по запросу и установка в фоновом режиме с помощью [установщик Windows](/windows/desktop/Msi/windows-installer-portal).</span><span class="sxs-lookup"><span data-stu-id="3e6ef-104">This technical article discusses two techniques, install-on-demand and background install, using [Windows Installer](/windows/desktop/Msi/windows-installer-portal).</span></span> <span data-ttu-id="3e6ef-105">Игры могут использовать эти методы установки для обеспечения лучшей и более приятный игр для игроков, уменьшая время установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-105">Games can utilize these installation techniques to provide a better and more pleasant gaming experience for players by reducing the installation time.</span></span>

-   [<span data-ttu-id="3e6ef-106">Обзор</span><span class="sxs-lookup"><span data-stu-id="3e6ef-106">Overview</span></span>](#overview)
-   [<span data-ttu-id="3e6ef-107">Поддержка исправлений</span><span class="sxs-lookup"><span data-stu-id="3e6ef-107">Patching Support</span></span>](#patching-support)
-   [<span data-ttu-id="3e6ef-108">Пример пакета SDK для Инсталлондеманд</span><span class="sxs-lookup"><span data-stu-id="3e6ef-108">The InstallOnDemand SDK Sample</span></span>](#the-installondemand-sdk-sample)
-   [<span data-ttu-id="3e6ef-109">Функции и компоненты примера</span><span class="sxs-lookup"><span data-stu-id="3e6ef-109">The Sample's Features and Components</span></span>](#the-samples-features-and-components)
-   [<span data-ttu-id="3e6ef-110">Установка</span><span class="sxs-lookup"><span data-stu-id="3e6ef-110">Installation</span></span>](#installation)
-   [<span data-ttu-id="3e6ef-111">Ограничения</span><span class="sxs-lookup"><span data-stu-id="3e6ef-111">Limitation</span></span>](#limitation)

## <a name="overview"></a><span data-ttu-id="3e6ef-112">Обзор</span><span class="sxs-lookup"><span data-stu-id="3e6ef-112">Overview</span></span>

<span data-ttu-id="3e6ef-113">Установка является элементом компьютерных приложений в течение длительного времени.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-113">Installation has been an element of computer-based applications for a long time.</span></span> <span data-ttu-id="3e6ef-114">Для большинства приложений сегодня необходимо сначала установить их на локальный жесткий диск пользователя, прежде чем их можно будет использовать.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-114">Most applications today require that they be installed on the user's local hard drive first before they can be used.</span></span> <span data-ttu-id="3e6ef-115">Компьютерные игры не являются исключением; когда потребитель покупает игру Microsoft Windows и пытается ее запустить, он должен сначала пройти процесс установки, который копирует необходимые файлы с диска игры на жесткий диск.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-115">Computer games are no exception; when a consumer buys a Microsoft Windows game and tries to run it, he must first go through an installation process that copies necessary files from the game disc to the hard drive.</span></span> <span data-ttu-id="3e6ef-116">Этот процесс установки обычно имеет длину и может занять до часа.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-116">This installation process is usually lengthy and can take as much as an hour to complete.</span></span> <span data-ttu-id="3e6ef-117">Время установки — это фактор, который делает компьютерные игры более желательными, чем компьютерные игры для некоторых игроков, так как они могут сразу же играть в игру консоли после вставки диска. Технология, описанная в этой статье, попытается устранить эту проблему, радикально уменьшая время установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-117">The installation time is a factor that makes console games more desirable than computer-based games for some players, as they are able to immediately play a console game after inserting the game disc. The technology discussed in this article will attempt to remedy this by drastically reducing the installation time.</span></span>

<span data-ttu-id="3e6ef-118">Обычно для игр требуется, чтобы все или большинство файлов были установлены перед запуском.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-118">Traditionally, games require that all or most of the files be installed prior to launching.</span></span> <span data-ttu-id="3e6ef-119">Чтобы обеспечить возможность установки по запросу, ресурсы игры должны быть модульными; то есть разработчик должен разделить ресурсы приложения (графические, аудио и т. д.) на компоненты.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-119">In order to achieve install-on-demand, the game resources need to be modular; that is, the developer must divide the application's resources (graphics, audio, and so on) into components.</span></span> <span data-ttu-id="3e6ef-120">Каждый компонент — это набор ресурсов, которые можно установить или удалить как единое целое.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-120">Each component is a set of resources that can be installed or removed as a unit.</span></span> <span data-ttu-id="3e6ef-121">После этого разработчик игры определяет одну или несколько функций (обычно по одному или нескольким уровням или зонам).</span><span class="sxs-lookup"><span data-stu-id="3e6ef-121">Once this is done, the game developer defines one or more features, typically one or more per level or zone.</span></span> <span data-ttu-id="3e6ef-122">Каждая функция приложения указывает набор компонентов, необходимых для выполнения этой конкретной функции.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-122">Each feature of an application specifies a set of components necessary for running that particular feature.</span></span> <span data-ttu-id="3e6ef-123">После установки приложения его функции могут быть помечены как «Install» (компоненты, скопированные на локальный жесткий диск во время установки) или «объявлено» (компоненты, скопированные на локальный жесткий диск после первоначальной установки, когда приложение использует эту функцию).</span><span class="sxs-lookup"><span data-stu-id="3e6ef-123">When an application is installed, its features can be marked as "install" (components copied to the local hard drive at installation time) or "advertised" (components copied to the local hard drive after the initial install when the application uses that feature).</span></span> <span data-ttu-id="3e6ef-124">Разработчик игр может сократить время установки, разрабатывая игру для запуска и запуска с минимальным набором установленных компонентов.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-124">A game developer can reduce the installation time by designing the game to launch and run with a minimal set of features installed.</span></span> <span data-ttu-id="3e6ef-125">Остальные функции могут быть помечены как объявленные и установленные по запросу, если приложение действительно должно использовать функциональные возможности, предоставляемые этими функциями.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-125">The rest of its features can be marked as advertised and installed on demand when the application actually needs to use functionalities that those features provide.</span></span>

<span data-ttu-id="3e6ef-126">Игры могут вызывать [установщик Windows](/windows/desktop/Msi/windows-installer-portal) для установки определенного компонента, который, возможно, не был установлен.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-126">Games can call [Windows Installer](/windows/desktop/Msi/windows-installer-portal) to install a particular feature that may not have been installed.</span></span> <span data-ttu-id="3e6ef-127">Чтобы установка отображалась в фоновом режиме, можно использовать рабочий поток для вызова установщика, в то время как основной поток продолжит обрабатывать игровую логику и визуализировать экран.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-127">To make the installation appear in the background, a worker thread can be used to make the calls to the installer while the primary thread continues to handle game logic and to render the screen.</span></span> <span data-ttu-id="3e6ef-128">Это позволяет минимизировать перебои в работе игрового процесса, вызванной установкой.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-128">This minimizes the disruption of gameplay caused by the installation.</span></span> <span data-ttu-id="3e6ef-129">Игра может начать установку в любое время.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-129">The game can initiate the installation at any time.</span></span> <span data-ttu-id="3e6ef-130">Тем не менее, поскольку установка потребляет процессорные циклы, обычно не рекомендуется выполнять установку, когда основной поток имеет важную нагрузку на вычислительную мощность, например, когда пользователь находится в середине действия.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-130">However, because the installation consumes processor cycles, it is generally not a good idea to perform the installation when the primary thread is in critical need of processing power, such as when the user is in the middle of the action.</span></span> <span data-ttu-id="3e6ef-131">Например, хорошим временем выполнения установки может быть время, когда пользователь находится в меню «игра», когда игра приостановлена или уменьшена, или когда пользователь наблюдает за введением или кутсценес.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-131">For example, a good time to perform the installation may be during the time the user is in the game menu, when the game is paused or minimized, or when the user is watching the introduction movie or cutscenes.</span></span>

## <a name="patching-support"></a><span data-ttu-id="3e6ef-132">Поддержка исправлений</span><span class="sxs-lookup"><span data-stu-id="3e6ef-132">Patching Support</span></span>

<span data-ttu-id="3e6ef-133">В настоящее время большинство игр необходимо обновлять даже после погрузки, так как ошибки будут устранены, и новые функции будут добавлены.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-133">Most games today need to be updated even after they ship as bugs get fixed and new features get added.</span></span> <span data-ttu-id="3e6ef-134">Для обновления часто требуется исправление, которое обычно является простой процедурой для игр.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-134">Updating often requires patching, which is traditionally a straightforward procedure for games.</span></span> <span data-ttu-id="3e6ef-135">Поскольку все необходимые файлы устанавливаются на жесткий диск пользователя, исправление игры включает копирование измененных файлов на жесткий диск, перезапись существующих файлов.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-135">Because all of the necessary files are installed onto the user's hard drive, patching a game involves copying revised files onto the hard drive, overwriting existing files.</span></span> <span data-ttu-id="3e6ef-136">При использовании Install-On-Demand не все файлы устанавливаются и копируются во время установки исправлений.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-136">When install-on-demand is employed, not all files are installed and copied at the time of patching.</span></span> <span data-ttu-id="3e6ef-137">Таким образом, диспетчер не может просто записать обновленные файлы в игровую папку.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-137">Therefore, the patcher cannot simply write updated files onto the game folder.</span></span>

<span data-ttu-id="3e6ef-138">[Установщик Windows](/windows/desktop/Msi/windows-installer-portal) содержит функции для установки исправлений приложений, использующих установку по запросу.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-138">[Windows Installer](/windows/desktop/Msi/windows-installer-portal) has features for patching applications that use install-on-demand.</span></span> <span data-ttu-id="3e6ef-139">При применении исправления установщик кэширует исправление в системе.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-139">When applying a patch, the installer caches the patch onto the system.</span></span> <span data-ttu-id="3e6ef-140">Эта функция хорошо подходит для исправлений с небольшими разностными данными.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-140">This feature works well for patches with small deltas.</span></span> <span data-ttu-id="3e6ef-141">Изначально выпущенные файлы больше не должны находиться на диске во время установки исправлений, поэтому эти файлы можно объявить.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-141">The originally released files no longer need to be on the disk at the time of patching, so those files can be advertised.</span></span> <span data-ttu-id="3e6ef-142">Позднее, когда приложение запускается и ему требуется доступ к файлам, установщик устанавливает последние версии этих файлов путем копирования первоначально выпущенной версии с носителя (например, с компакт-диска) и установки исправления после считывания сохраненных данных исправления.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-142">Later, when the application runs and needs to access the files, the installer installs the most recent version of those files by copying the originally released version from the media (for example, CDs) and applying the patch after reading the saved patch data.</span></span>

## <a name="the-installondemand-sdk-sample"></a><span data-ttu-id="3e6ef-143">Пример пакета SDK для Инсталлондеманд</span><span class="sxs-lookup"><span data-stu-id="3e6ef-143">The InstallOnDemand SDK Sample</span></span>

<span data-ttu-id="3e6ef-144">Образец Install-On-Demand для игр демонстрирует методы установки по запросу, описанные в этой статье.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-144">The Install-on-Demand for Games sample demonstrates the install-on-demand techniques discussed in this article.</span></span> <span data-ttu-id="3e6ef-145">В отличие от других примеров, установка по запросу для игр не может быть выполнена непосредственно из примера браузера.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-145">Unlike other samples, Install-on-Demand for Games cannot be run directly from the sample browser.</span></span> <span data-ttu-id="3e6ef-146">Поскольку в примере используется [установщик Windows](/windows/desktop/Msi/windows-installer-portal) для управления его установкой, он должен быть добавлен в базу данных установщика установленных приложений.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-146">Because the sample uses the [Windows Installer](/windows/desktop/Msi/windows-installer-portal) to manage its installation, it needs to be included in the installer's database of installed applications.</span></span>

<span data-ttu-id="3e6ef-147">**Запуск примера**</span><span class="sxs-lookup"><span data-stu-id="3e6ef-147">**To launch the sample**</span></span>

1.  <span data-ttu-id="3e6ef-148">Используйте ссылку установить проект в образце браузера, чтобы скопировать файлы примера в папку.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-148">Use the Install Project link in the sample browser to copy the sample's files to a folder.</span></span>
2.  <span data-ttu-id="3e6ef-149">Дважды щелкните InstallOnDemand.msi, чтобы установить пример.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-149">Double click InstallOnDemand.msi to install the sample.</span></span>
3.  <span data-ttu-id="3e6ef-150">Выберите Обычная установка.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-150">Select Typical Install.</span></span>
4.  <span data-ttu-id="3e6ef-151">Запустите пример, запустив InstallOnDemand.exe в папке installed (обычно Program Files \\ инсталлондеманд) или запустив из меню "Пуск" \\ программы.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-151">Start the sample by launching the InstallOnDemand.exe in the installed folder (typically Program Files\\InstallOnDemand) or by launching from Start Menu\\Programs.</span></span>

<span data-ttu-id="3e6ef-152">InstallOnDemand.msi — это база данных, распознанная установщиком.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-152">InstallOnDemand.msi is a database recognized by the installer.</span></span> <span data-ttu-id="3e6ef-153">Он определяет весь процесс установки: структуру каталогов, то, что будет и не будет копировать, какие ресурсы будут копироваться вместе, какие значения реестра следует записать, какие ярлыки создавать и т. д.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-153">It defines the entire installation process: the directory structure, what will and will not be copied, what resources will be copied together, what registry values to write, what shortcuts to create, and so forth.</span></span>

<span data-ttu-id="3e6ef-154">При запуске образец воспроизводит последовательность вводов.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-154">When launched, the sample plays an introduction sequence.</span></span> <span data-ttu-id="3e6ef-155">Проигрыватель может завершить его и войти в главное меню, нажав клавишу ESC.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-155">The player can end it and enter the main menu by pressing the ESC key.</span></span> <span data-ttu-id="3e6ef-156">После введения игрок может начать новую игру, введя имя символа и прокрутите статистику.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-156">Following the introduction, the player can start a new game by entering a character name and scrolling through the statistics.</span></span> <span data-ttu-id="3e6ef-157">Прежде чем образец начнет воспроизводить последовательность введения, пример вызывает функцию установщика, чтобы проверить, установлен ли компонент для уровня 1.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-157">Before the sample begins to play the introduction sequence, the sample calls an installer function to check if the feature for level 1 is installed.</span></span> <span data-ttu-id="3e6ef-158">Если компонент уровня 1 не установлен, то в примере используется фоновый поток, который запросит установщик установить игру, а основной поток выполняет что-то другое (например, воспроизведение последовательности введения, отображение меню или взаимодействие с проигрывателем при создании символа).</span><span class="sxs-lookup"><span data-stu-id="3e6ef-158">If the level 1 feature has not been installed, the sample uses a background thread to ask the installer to install the game, while the primary thread is doing something else (such as playing the introduction sequence, rendering the menu, or interacting with the player on character creation).</span></span> <span data-ttu-id="3e6ef-159">Процедура отличается от традиционной установки игры тем, что пользователь занят в игре (Просмотр введения или создание нового символа) во время установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-159">The experience is different from traditional game installation in that the user is occupied in the game (watching the introduction or creating a new character) while installation is in progress.</span></span> <span data-ttu-id="3e6ef-160">После того как проигрыватель завершит создание символа, в примере загружаются ресурсы для уровня 1.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-160">After the player has finished creating a character, the sample loads the resources for level 1.</span></span>

<span data-ttu-id="3e6ef-161">В правой части образца экрана расположены пять кнопок с пометкой "уровень воспроизведения 1" до "уровень воспроизведения 5".</span><span class="sxs-lookup"><span data-stu-id="3e6ef-161">On the right side of the sample screen are five buttons marked "Play Level 1" through "Play Level 5."</span></span> <span data-ttu-id="3e6ef-162">Эти кнопки имитируют завершение игрока текущего уровня и перепродвижения на следующий.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-162">These buttons simulate the player's completion of the current level and advancement to the next.</span></span> <span data-ttu-id="3e6ef-163">При нажатии одной из этих кнопок отображается экран статистики, на которой отображаются сведения о том уровне, который он только что завершил.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-163">When one of these buttons is clicked, a statistics screen appears showing information about the level that he has just finished.</span></span> <span data-ttu-id="3e6ef-164">В этом примере также запрашивает у установщика проверку и установку следующего уровня, если он еще не установлен.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-164">The sample also takes this time to ask the installer to check and install the next level, if it is not already installed.</span></span> <span data-ttu-id="3e6ef-165">Установка происходит, когда проигрыватель считывает экран статистики, поэтому когда пользователь нажимает кнопку ОК, чтобы перейти на следующий уровень, все ресурсы уровня будут установлены и готовы к загрузке.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-165">The installation occurs while the player is reading the statistics screen, so that when the user clicks OK to enter the next level, the level's resources are all installed and ready to be loaded.</span></span>

## <a name="the-samples-features-and-components"></a><span data-ttu-id="3e6ef-166">Функции и компоненты примера</span><span class="sxs-lookup"><span data-stu-id="3e6ef-166">The Sample's Features and Components</span></span>

<span data-ttu-id="3e6ef-167">Обычно для игр требуется, чтобы все или большинство файлов были установлены перед запуском.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-167">Traditionally, games require that all or most of the files be installed prior to launching.</span></span> <span data-ttu-id="3e6ef-168">Чтобы обеспечить возможность установки по запросу, ресурсы игры должны быть модульными; то есть разработчик должен разделить ресурсы приложения (графические, аудио и т. д.) на компоненты.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-168">In order to achieve install-on-demand, the game resources need to be modular; that is, the developer must divide the application's resources (graphics, audio, and so on) into components.</span></span> <span data-ttu-id="3e6ef-169">Каждый компонент — это набор ресурсов, которые можно установить или удалить как единое целое.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-169">Each component is a set of resources that can be installed or removed as a unit.</span></span> <span data-ttu-id="3e6ef-170">После этого разработчик игры определяет одну или несколько функций (обычно по одному или нескольким уровням или зонам).</span><span class="sxs-lookup"><span data-stu-id="3e6ef-170">Once this is done, the game developer defines one or more features, typically one or more per level or zone.</span></span> <span data-ttu-id="3e6ef-171">Каждая функция приложения указывает набор компонентов, необходимых для выполнения этой конкретной функции.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-171">Each feature of an application specifies a set of components necessary for running that particular feature.</span></span> <span data-ttu-id="3e6ef-172">При установке приложения его функции могут быть помечены как "Install" (компоненты, скопированные на локальный жесткий диск во время установки) или "объявлено" (компоненты, скопированные на локальный жесткий диск, если в дальнейшем приложение использует эту функцию).</span><span class="sxs-lookup"><span data-stu-id="3e6ef-172">When an application is installed, its features can be marked as "install" (components copied to the local hard drive at installation time) or "advertised" (components copied to the local hard drive when the application later uses that feature).</span></span> <span data-ttu-id="3e6ef-173">Разработчик игр может сократить время установки, разрабатывая игру для запуска и запуска с минимальным набором установленных компонентов.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-173">A game developer can reduce the installation time by designing the game to launch and start running with a minimal set of features installed.</span></span> <span data-ttu-id="3e6ef-174">Остальные функции могут быть помечены как объявленные и установленные по запросу, если приложение действительно должно использовать функциональные возможности, предоставляемые этими функциями.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-174">The rest of its features can be marked as advertised and installed on-demand when the application actually needs to use functionalities that those features provide.</span></span>

<span data-ttu-id="3e6ef-175">В следующей таблице перечислены шесть функций верхнего уровня, определяемых образцом.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-175">The following table lists the six top-level features that the sample defines.</span></span>



| <span data-ttu-id="3e6ef-176">Имя функции</span><span class="sxs-lookup"><span data-stu-id="3e6ef-176">Feature Name</span></span> | <span data-ttu-id="3e6ef-177">Функциональность</span><span class="sxs-lookup"><span data-stu-id="3e6ef-177">Functionality</span></span>                                                                                                                                                                                                             | <span data-ttu-id="3e6ef-178">Компоненты</span><span class="sxs-lookup"><span data-stu-id="3e6ef-178">Components</span></span>  | <span data-ttu-id="3e6ef-179">Файлы</span><span class="sxs-lookup"><span data-stu-id="3e6ef-179">Files</span></span>                                                                     |
|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|---------------------------------------------------------------------------|
| <span data-ttu-id="3e6ef-180">Основные сведения</span><span class="sxs-lookup"><span data-stu-id="3e6ef-180">Core</span></span>         | <span data-ttu-id="3e6ef-181">Включает ресурсы, необходимые для всех случаев, независимо от уровня.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-181">Includes resources required at all times, regardless of level.</span></span> <span data-ttu-id="3e6ef-182">Эти ресурсы: Пример исполняемого файла, носитель, необходимый для последовательности и загрузки экрана, и файл. FX, который обрабатывает всю отрисовку в примере.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-182">These resources are: sample executable, media required by introduction sequence and loading screen, and .fx file that handles all rendering in the sample.</span></span> | <span data-ttu-id="3e6ef-183">Основные сведения</span><span class="sxs-lookup"><span data-stu-id="3e6ef-183">Core</span></span>        | <span data-ttu-id="3e6ef-184">InstallOnDemand.exe, Инсталлондеманд. FX, Loading.bmp, Level. x</span><span class="sxs-lookup"><span data-stu-id="3e6ef-184">InstallOnDemand.exe, InstallOnDemand.fx, Loading.bmp, Level.x</span></span>             |
| <span data-ttu-id="3e6ef-185">Основные сведения</span><span class="sxs-lookup"><span data-stu-id="3e6ef-185">Core</span></span>         | <span data-ttu-id="3e6ef-186">(то же, что и выше)</span><span class="sxs-lookup"><span data-stu-id="3e6ef-186">(same as above)</span></span>                                                                                                                                                                                                           | <span data-ttu-id="3e6ef-187">кореуи</span><span class="sxs-lookup"><span data-stu-id="3e6ef-187">CoreUI</span></span>      | <span data-ttu-id="3e6ef-188">\\Пользовательский интерфейс мультимедиа \\ дксутконтролс. DDS, Media \\ UI \\ дксутшаред. FX, Media \\ UI \\ Arrow. x</span><span class="sxs-lookup"><span data-stu-id="3e6ef-188">Media\\UI\\dxutcontrols.dds, Media\\UI\\DXUTShared.fx, Media\\UI\\arrow.x</span></span> |
| <span data-ttu-id="3e6ef-189">Основные сведения</span><span class="sxs-lookup"><span data-stu-id="3e6ef-189">Core</span></span>         | <span data-ttu-id="3e6ef-190">(то же, что и выше)</span><span class="sxs-lookup"><span data-stu-id="3e6ef-190">(same as above)</span></span>                                                                                                                                                                                                           | <span data-ttu-id="3e6ef-191">коремиск</span><span class="sxs-lookup"><span data-stu-id="3e6ef-191">CoreMisc</span></span>    | <span data-ttu-id="3e6ef-192">Мультимедиа \\ \\ , сеафлур. x, мультимедиа, \\ Прочие \\seafloor.bmp</span><span class="sxs-lookup"><span data-stu-id="3e6ef-192">Media\\Misc\\seafloor.x, Media\\Misc\\seafloor.bmp</span></span>                        |
| <span data-ttu-id="3e6ef-193">Основные сведения</span><span class="sxs-lookup"><span data-stu-id="3e6ef-193">Core</span></span>         | <span data-ttu-id="3e6ef-194">(то же, что и выше)</span><span class="sxs-lookup"><span data-stu-id="3e6ef-194">(same as above)</span></span>                                                                                                                                                                                                           | <span data-ttu-id="3e6ef-195">кореспидер</span><span class="sxs-lookup"><span data-stu-id="3e6ef-195">CoreSpeeder</span></span> | <span data-ttu-id="3e6ef-196">Media \\ PRT Demo \\ ландшарк. x, \\ демонстрационный ускоритель мультимедиа PRT \\ \_diff.jpg</span><span class="sxs-lookup"><span data-stu-id="3e6ef-196">Media\\PRT Demo\\LandShark.x, Media\\PRT Demo\\speeder\_diff.jpg</span></span>          |
| <span data-ttu-id="3e6ef-197">Основные сведения</span><span class="sxs-lookup"><span data-stu-id="3e6ef-197">Core</span></span>         | <span data-ttu-id="3e6ef-198">(то же, что и выше)</span><span class="sxs-lookup"><span data-stu-id="3e6ef-198">(same as above)</span></span>                                                                                                                                                                                                           | <span data-ttu-id="3e6ef-199">коререг</span><span class="sxs-lookup"><span data-stu-id="3e6ef-199">CoreReg</span></span>     | <span data-ttu-id="3e6ef-200">Н/д (значение реестра)</span><span class="sxs-lookup"><span data-stu-id="3e6ef-200">N/A (registry value)</span></span>                                                      |
| <span data-ttu-id="3e6ef-201">Level1</span><span class="sxs-lookup"><span data-stu-id="3e6ef-201">Level1</span></span>       | <span data-ttu-id="3e6ef-202">Предоставляет ресурсы, используемые уровнем 1.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-202">Provides resources used by level 1.</span></span>                                                                                                                                                                                       | <span data-ttu-id="3e6ef-203">Level1</span><span class="sxs-lookup"><span data-stu-id="3e6ef-203">Level1</span></span>      | <span data-ttu-id="3e6ef-204">Level1.jpg</span><span class="sxs-lookup"><span data-stu-id="3e6ef-204">Level1.jpg</span></span>                                                                |
| <span data-ttu-id="3e6ef-205">Level1</span><span class="sxs-lookup"><span data-stu-id="3e6ef-205">Level1</span></span>       | <span data-ttu-id="3e6ef-206">(то же, что и в предыдущем)</span><span class="sxs-lookup"><span data-stu-id="3e6ef-206">(same as previous)</span></span>                                                                                                                                                                                                        | <span data-ttu-id="3e6ef-207">L1Skybox</span><span class="sxs-lookup"><span data-stu-id="3e6ef-207">L1Skybox</span></span>    | <span data-ttu-id="3e6ef-208">Media \\ Light зонды \\ Галилео \_ Cross. DDS</span><span class="sxs-lookup"><span data-stu-id="3e6ef-208">Media\\Light Probes\\galileo\_cross.dds</span></span>                                   |
| <span data-ttu-id="3e6ef-209">Level2</span><span class="sxs-lookup"><span data-stu-id="3e6ef-209">Level2</span></span>       | <span data-ttu-id="3e6ef-210">Предоставляет ресурсы, используемые уровнем 2.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-210">Provides resources used by level 2.</span></span>                                                                                                                                                                                       | <span data-ttu-id="3e6ef-211">Level2</span><span class="sxs-lookup"><span data-stu-id="3e6ef-211">Level2</span></span>      | <span data-ttu-id="3e6ef-212">Level2.jpg</span><span class="sxs-lookup"><span data-stu-id="3e6ef-212">Level2.jpg</span></span>                                                                |
| <span data-ttu-id="3e6ef-213">Level2</span><span class="sxs-lookup"><span data-stu-id="3e6ef-213">Level2</span></span>       | <span data-ttu-id="3e6ef-214">(то же, что и в предыдущем)</span><span class="sxs-lookup"><span data-stu-id="3e6ef-214">(same as previous)</span></span>                                                                                                                                                                                                        | <span data-ttu-id="3e6ef-215">L2Skybox</span><span class="sxs-lookup"><span data-stu-id="3e6ef-215">L2Skybox</span></span>    | <span data-ttu-id="3e6ef-216">Media \\ Light проверяет \\ льготный период \_ перекрестный. DDS</span><span class="sxs-lookup"><span data-stu-id="3e6ef-216">Media\\Light Probes\\grace\_cross.dds</span></span>                                     |
| <span data-ttu-id="3e6ef-217">Level3</span><span class="sxs-lookup"><span data-stu-id="3e6ef-217">Level3</span></span>       | <span data-ttu-id="3e6ef-218">Предоставляет ресурсы, используемые на уровне 3.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-218">Provides resources used by level 3.</span></span>                                                                                                                                                                                       | <span data-ttu-id="3e6ef-219">Level3</span><span class="sxs-lookup"><span data-stu-id="3e6ef-219">Level3</span></span>      | <span data-ttu-id="3e6ef-220">Level3.jpg</span><span class="sxs-lookup"><span data-stu-id="3e6ef-220">Level3.jpg</span></span>                                                                |
| <span data-ttu-id="3e6ef-221">Level3</span><span class="sxs-lookup"><span data-stu-id="3e6ef-221">Level3</span></span>       | <span data-ttu-id="3e6ef-222">(то же, что и в предыдущем)</span><span class="sxs-lookup"><span data-stu-id="3e6ef-222">(same as previous)</span></span>                                                                                                                                                                                                        | <span data-ttu-id="3e6ef-223">L3Skybox</span><span class="sxs-lookup"><span data-stu-id="3e6ef-223">L3Skybox</span></span>    | <span data-ttu-id="3e6ef-224">Media \\ Light зонды \\ RNL \_ Cross. DDS</span><span class="sxs-lookup"><span data-stu-id="3e6ef-224">Media\\Light Probes\\rnl\_cross.dds</span></span>                                       |
| <span data-ttu-id="3e6ef-225">Level4</span><span class="sxs-lookup"><span data-stu-id="3e6ef-225">Level4</span></span>       | <span data-ttu-id="3e6ef-226">Предоставляет ресурсы, используемые уровнем 4.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-226">Provides resources used by level 4.</span></span>                                                                                                                                                                                       | <span data-ttu-id="3e6ef-227">Level4</span><span class="sxs-lookup"><span data-stu-id="3e6ef-227">Level4</span></span>      | <span data-ttu-id="3e6ef-228">Level4.jpg</span><span class="sxs-lookup"><span data-stu-id="3e6ef-228">Level4.jpg</span></span>                                                                |
| <span data-ttu-id="3e6ef-229">Level4</span><span class="sxs-lookup"><span data-stu-id="3e6ef-229">Level4</span></span>       | <span data-ttu-id="3e6ef-230">(то же, что и в предыдущем)</span><span class="sxs-lookup"><span data-stu-id="3e6ef-230">(same as previous)</span></span>                                                                                                                                                                                                        | <span data-ttu-id="3e6ef-231">L4Skybox</span><span class="sxs-lookup"><span data-stu-id="3e6ef-231">L4Skybox</span></span>    | <span data-ttu-id="3e6ef-232">Media \\ Light зонды \\ стпетерс \_ Cross. DDS</span><span class="sxs-lookup"><span data-stu-id="3e6ef-232">Media\\Light Probes\\stpeters\_cross.dds</span></span>                                  |
| <span data-ttu-id="3e6ef-233">Level5</span><span class="sxs-lookup"><span data-stu-id="3e6ef-233">Level5</span></span>       | <span data-ttu-id="3e6ef-234">Предоставляет ресурсы, используемые уровнем 5.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-234">Provides resources used by level 5.</span></span>                                                                                                                                                                                       | <span data-ttu-id="3e6ef-235">Level5</span><span class="sxs-lookup"><span data-stu-id="3e6ef-235">Level5</span></span>      | <span data-ttu-id="3e6ef-236">Level5.jpg</span><span class="sxs-lookup"><span data-stu-id="3e6ef-236">Level5.jpg</span></span>                                                                |
| <span data-ttu-id="3e6ef-237">Level5</span><span class="sxs-lookup"><span data-stu-id="3e6ef-237">Level5</span></span>       | <span data-ttu-id="3e6ef-238">(то же, что и в предыдущем)</span><span class="sxs-lookup"><span data-stu-id="3e6ef-238">(same as previous)</span></span>                                                                                                                                                                                                        | <span data-ttu-id="3e6ef-239">L5Skybox</span><span class="sxs-lookup"><span data-stu-id="3e6ef-239">L5Skybox</span></span>    | <span data-ttu-id="3e6ef-240">Media \\ Light зонды \\ уффизи \_ Cross. DDS</span><span class="sxs-lookup"><span data-stu-id="3e6ef-240">Media\\Light Probes\\uffizi\_cross.dds</span></span>                                    |



 

<span data-ttu-id="3e6ef-241">Функции level1 и Level5 имеют дополнительные вложенные функции, которые содержат файлы, которые не используются непосредственно в образце.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-241">The Level1 through Level5 features have additional sub-features that contain files not directly used by the sample.</span></span> <span data-ttu-id="3e6ef-242">Эти файлы подкомпонентов были добавлены для выполнения установки дольше.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-242">These sub-features files have been added to make the installation take longer.</span></span> <span data-ttu-id="3e6ef-243">Это делается для иллюстрации текущей операции установки, выполняемой в фоновом режиме во время выполнения примера.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-243">This is done to illustrate the ongoing installation operation that is running in the background while the sample is running.</span></span>

<span data-ttu-id="3e6ef-244">В следующей таблице перечислены подфункции.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-244">The following table lists the sub-features.</span></span>



| <span data-ttu-id="3e6ef-245">Функция</span><span class="sxs-lookup"><span data-stu-id="3e6ef-245">Feature</span></span> | <span data-ttu-id="3e6ef-246">Подфункции</span><span class="sxs-lookup"><span data-stu-id="3e6ef-246">Sub-features</span></span>                      | <span data-ttu-id="3e6ef-247">Файлы</span><span class="sxs-lookup"><span data-stu-id="3e6ef-247">Files</span></span>                                                                                                                                                                          |
|---------|-----------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="3e6ef-248">Level1</span><span class="sxs-lookup"><span data-stu-id="3e6ef-248">Level1</span></span>  | <span data-ttu-id="3e6ef-249">L1PH1, L1PH2, L1PH3, L1PH4, L1PH5</span><span class="sxs-lookup"><span data-stu-id="3e6ef-249">L1PH1, L1PH2, L1PH3, L1PH4, L1PH5</span></span> | <span data-ttu-id="3e6ef-250">Level1 заполнитель данных \\ L1PH1. dat level1 данные заполнителя \\ L1PH2. dat level1 PlaceHolder Data \\ L1PH3. dat level1 заполнителя Data \\ L1PH4. dat level1 PlaceHolder Data \\ L1PH5. dat</span><span class="sxs-lookup"><span data-stu-id="3e6ef-250">Level1 Placeholder Data\\L1PH1.dat Level1 Placeholder Data\\L1PH2.dat Level1 Placeholder Data\\L1PH3.dat Level1 Placeholder Data\\L1PH4.dat Level1 Placeholder Data\\L1PH5.dat</span></span> |
| <span data-ttu-id="3e6ef-251">Level2</span><span class="sxs-lookup"><span data-stu-id="3e6ef-251">Level2</span></span>  | <span data-ttu-id="3e6ef-252">L2PH1, L2PH2, L2PH3, L2PH4, L2PH5</span><span class="sxs-lookup"><span data-stu-id="3e6ef-252">L2PH1, L2PH2, L2PH3, L2PH4, L2PH5</span></span> | <span data-ttu-id="3e6ef-253">Level2 заполнитель данных \\ L2PH1. dat level2 данные заполнителя \\ L2PH2. dat level2 PlaceHolder Data \\ L2PH3. dat level2 заполнителя Data \\ L2PH4. dat level2 PlaceHolder Data \\ L2PH5. dat</span><span class="sxs-lookup"><span data-stu-id="3e6ef-253">Level2 Placeholder Data\\L2PH1.dat Level2 Placeholder Data\\L2PH2.dat Level2 Placeholder Data\\L2PH3.dat Level2 Placeholder Data\\L2PH4.dat Level2 Placeholder Data\\L2PH5.dat</span></span> |
| <span data-ttu-id="3e6ef-254">Level3</span><span class="sxs-lookup"><span data-stu-id="3e6ef-254">Level3</span></span>  | <span data-ttu-id="3e6ef-255">L3PH1, L3PH2, L3PH3, L3PH4, L3PH5</span><span class="sxs-lookup"><span data-stu-id="3e6ef-255">L3PH1, L3PH2, L3PH3, L3PH4, L3PH5</span></span> | <span data-ttu-id="3e6ef-256">Level3 заполнитель данных \\ L3PH1. dat Level3 данные заполнителя \\ L3PH2. dat Level3 PlaceHolder Data \\ L3PH3. dat Level3 заполнителя Data \\ L3PH4. dat Level3 PlaceHolder Data \\ L3PH5. dat</span><span class="sxs-lookup"><span data-stu-id="3e6ef-256">Level3 Placeholder Data\\L3PH1.dat Level3 Placeholder Data\\L3PH2.dat Level3 Placeholder Data\\L3PH3.dat Level3 Placeholder Data\\L3PH4.dat Level3 Placeholder Data\\L3PH5.dat</span></span> |
| <span data-ttu-id="3e6ef-257">Level4</span><span class="sxs-lookup"><span data-stu-id="3e6ef-257">Level4</span></span>  | <span data-ttu-id="3e6ef-258">L4PH1, L4PH2, L4PH3, L4PH4, L4PH5</span><span class="sxs-lookup"><span data-stu-id="3e6ef-258">L4PH1, L4PH2, L4PH3, L4PH4, L4PH5</span></span> | <span data-ttu-id="3e6ef-259">Level4 заполнитель данных \\ L4PH1. dat Level4 данные заполнителя \\ L4PH2. dat Level4 PlaceHolder Data \\ L4PH3. dat Level4 заполнителя Data \\ L4PH4. dat Level4 PlaceHolder Data \\ L4PH5. dat</span><span class="sxs-lookup"><span data-stu-id="3e6ef-259">Level4 Placeholder Data\\L4PH1.dat Level4 Placeholder Data\\L4PH2.dat Level4 Placeholder Data\\L4PH3.dat Level4 Placeholder Data\\L4PH4.dat Level4 Placeholder Data\\L4PH5.dat</span></span> |
| <span data-ttu-id="3e6ef-260">Level5</span><span class="sxs-lookup"><span data-stu-id="3e6ef-260">Level5</span></span>  | <span data-ttu-id="3e6ef-261">L5PH1, L5PH2, L5PH3, L5PH4, L5PH5</span><span class="sxs-lookup"><span data-stu-id="3e6ef-261">L5PH1, L5PH2, L5PH3, L5PH4, L5PH5</span></span> | <span data-ttu-id="3e6ef-262">Level5 заполнитель данных \\ L5PH1. dat Level5 данные заполнителя \\ L5PH2. dat Level5 PlaceHolder Data \\ L5PH3. dat Level5 заполнителя Data \\ L5PH4. dat Level5 PlaceHolder Data \\ L5PH5. dat</span><span class="sxs-lookup"><span data-stu-id="3e6ef-262">Level5 Placeholder Data\\L5PH1.dat Level5 Placeholder Data\\L5PH2.dat Level5 Placeholder Data\\L5PH3.dat Level5 Placeholder Data\\L5PH4.dat Level5 Placeholder Data\\L5PH5.dat</span></span> |



 

<span data-ttu-id="3e6ef-263">Во время установки основной компонент должен быть помечен как "Install", а все остальные компоненты должны быть помечены как "объявленные".</span><span class="sxs-lookup"><span data-stu-id="3e6ef-263">During installation, the core feature should be marked "install" and all other features should be marked "advertised."</span></span> <span data-ttu-id="3e6ef-264">Устанавливая только один компонент, а не шесть, время, в течение которого проигрыватель будет ожидать запуска игры, значительно уменьшится.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-264">By only installing one feature instead of six, the time that the player must wait until the game launches is significantly reduced.</span></span>

## <a name="installation"></a><span data-ttu-id="3e6ef-265">Установка</span><span class="sxs-lookup"><span data-stu-id="3e6ef-265">Installation</span></span>

<span data-ttu-id="3e6ef-266">[Установщик Windows](/windows/desktop/Msi/windows-installer-portal) предоставляет приложению механизм запроса на установку объявленного компонента.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-266">The [Windows Installer](/windows/desktop/Msi/windows-installer-portal) provides a mechanism for an application to request that an advertised feature be installed.</span></span> <span data-ttu-id="3e6ef-267">Однако механизм является синхронным вызовом интерфейса программирования приложений (API), что означает, что приложение должно ждать в вызове до завершения установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-267">However, the mechanism is a synchronous application programming interface (API) call, which means that the application has to wait inside the call until the installation is complete.</span></span> <span data-ttu-id="3e6ef-268">Для установки в фоновом режиме требуется рабочий поток, чтобы главный поток приложения не выполнял другие важные задачи, такие как отрисовка на экране, чтобы продолжить отклика визуализации проигрывателя.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-268">To achieve background installation, a worker thread is required so that the main application thread is free to perform other important tasks, such as rendering on the screen to continue giving the player visual feedback.</span></span>

<span data-ttu-id="3e6ef-269">В этом примере существует три состояния установки, которые происходят во время выполнения примера: активная установка, пассивная Установка и без установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-269">In the sample, there are three states of installation that happen during the sample execution: active installation, passive installation, and no installation.</span></span>

-   <span data-ttu-id="3e6ef-270">Активная установка — это запрос, инициированный образцом, когда ему требуется доступ к ресурсам или их загрузка, предоставляемых одним или несколькими компонентами.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-270">Active installation is a request initiated by the sample when it needs to access or load resources provided by one or more features.</span></span> <span data-ttu-id="3e6ef-271">Этот пример делает это, когда он не может продолжать работу до установки ресурса.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-271">The sample does this when it can not continue until the resource is installed.</span></span>
-   <span data-ttu-id="3e6ef-272">Пассивная установка инициируется, когда образец не выполняет критическую задачу, например, когда игрок находится в меню или просматривает вырезанную сцену.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-272">Passive installation is initiated when the sample is not performing a critical task such as when the player is at a menu or watching a cut scene.</span></span> <span data-ttu-id="3e6ef-273">В этом случае рабочий поток проверяет, объявлена ли какая-либо функция образца.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-273">When this is the case, the worker thread checks if any feature of the sample is still advertised.</span></span> <span data-ttu-id="3e6ef-274">Если он может найти его, он вызывает установщик для установки этого компонента.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-274">If it can find one, it calls the installer to install that feature.</span></span> <span data-ttu-id="3e6ef-275">Этот процесс повторяется до тех пор, пока не будут установлены все компоненты образца.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-275">This process repeats until every feature of the sample is installed.</span></span> <span data-ttu-id="3e6ef-276">По сути, пассивная установка использует дополнительные процессорные циклы для установки в фоновом режиме, если он является наименее вредоносным для основного примера.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-276">Essentially, passive installation utilizes extra processor cycles to perform installation in the background when it is least intrusive to the main sample.</span></span>
-   <span data-ttu-id="3e6ef-277">Если проигрыватель активно находится в игре, установка не выполняется. Это предотвращает удаление частоты кадров, что привело бы к нарушению работы пользователя.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-277">No installation happens when the player is actively engaged in the game; this prevents a framerate drop which would disrupt the user experience.</span></span>

<span data-ttu-id="3e6ef-278">В примере класс Кмсиутил определен для выполнения всех задач, связанных с установкой.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-278">In the sample, a class CMsiUtil is defined to handle all installation-related tasks.</span></span> <span data-ttu-id="3e6ef-279">По сути, Кмсиутил использует рабочий поток, который вызывает установщик для установки компонентов примера в цикле.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-279">Essentially, CMsiUtil uses a worker thread that invokes the installer to install the sample's features in a loop.</span></span> <span data-ttu-id="3e6ef-280">Класс содержит две очереди, в которых хранятся запросы на установку: одна очередь с высоким приоритетом для активной установки и одна очередь с низким приоритетом для пассивной установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-280">The class has two queues that store installation requests: one high priority queue for active installation and one low priority queue for passive installation.</span></span> <span data-ttu-id="3e6ef-281">Во время инициализации класс перечисляет все компоненты продукта и добавляет их в очередь пассивной установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-281">During initialization, the class enumerates all features of the product and adds them to the passive installation queue.</span></span> <span data-ttu-id="3e6ef-282">Так как весь продукт помещается в очередь таким образом, весь продукт со временем будет установлен, если в примере достаточно свободных циклов процессора.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-282">Because the entire product is queued this way, the entire product will eventually be installed if the sample has enough free processor cycles.</span></span>

<span data-ttu-id="3e6ef-283">Когда пример должен запросить активную установку, этот пример может вызвать Кмсиутил:: Усефеатуресет () и передать имя функции верхнего уровня.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-283">When the sample needs to request an active installation, the sample can call CMsiUtil::UseFeatureSet() and pass the name of the top-level feature.</span></span> <span data-ttu-id="3e6ef-284">Усефеатуресет () будет ставить в очередь запрошенную функцию и все ее вложенные компоненты в активной очереди установки, чтобы рабочий поток мог их установить.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-284">UseFeatureSet() will queue the requested feature and all of its sub-features in the active installation queue so that the worker thread can install them.</span></span>

<span data-ttu-id="3e6ef-285">При выполнении запроса на установку рабочий поток проверит активную очередь установки, а также очередь пассивной установки, чтобы узнать, есть ли в очереди какие либо дополнительные запросы.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-285">While executing an install request, the worker thread will check the active installation queue as well as the passive installation queue to see if either queue has any additional requests.</span></span> <span data-ttu-id="3e6ef-286">Каждый раз, когда поток находит запрос, он будет вызывать API установщика для выполнения фактической установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-286">Each time the thread finds a request, it will call the installer API to perform the actual installation.</span></span> <span data-ttu-id="3e6ef-287">После того как обе очереди пусты, Рабочий поток перейдет в спящий режим с помощью вызова [**WaitForSingleObject**](/windows/desktop/api/synchapi/nf-synchapi-waitforsingleobject).</span><span class="sxs-lookup"><span data-stu-id="3e6ef-287">Once both queues are empty, the worker thread will go to sleep with a call to [**WaitForSingleObject**](/windows/desktop/api/synchapi/nf-synchapi-waitforsingleobject).</span></span> <span data-ttu-id="3e6ef-288">Так как весь продукт помещается в очередь пассивной установки во время инициализации, пустая очередь подразумевает, что установлен весь продукт.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-288">Because the entire product is placed in the passive installation queue during initialization, an empty queue implies that the entire product has been installed.</span></span>

<span data-ttu-id="3e6ef-289">Пример вызывает Кмсиутил:: Енаблепассивеинсталл (), чтобы включить или отключить пассивную установку.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-289">The sample calls CMsiUtil::EnablePassiveInstall() to enable or disable passive installation.</span></span> <span data-ttu-id="3e6ef-290">Енаблепассивеинсталл (true) увеличивает значение счетчика включения для пассивной установки, а Енаблепассивеинсталл (false) уменьшает его.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-290">EnablePassiveInstall(true) increments the enable count for passive installation, and EnablePassiveInstall(false) decrements it.</span></span> <span data-ttu-id="3e6ef-291">Если значение счетчика включения больше 0, класс будет обрабатывать очередь пассивной установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-291">If the enable count is greater than 0, the class will process the passive installation queue.</span></span> <span data-ttu-id="3e6ef-292">Пример разрешает пассивную установку при выполнении любого из следующих условий.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-292">The sample allows passive installation when any of the following is true:</span></span>

-   <span data-ttu-id="3e6ef-293">Пользователь просматривает начальную последовательность введения.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-293">The user is viewing the initial introduction sequence.</span></span>
-   <span data-ttu-id="3e6ef-294">Пользователь находится в меню выборки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-294">The user is navigating in the sample menu.</span></span>
-   <span data-ttu-id="3e6ef-295">Пользователь просматривает статистику в конце уровня.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-295">The user is viewing the statistics at the end of a level.</span></span>
-   <span data-ttu-id="3e6ef-296">Пример приложения теряет фокус и переходит к фону.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-296">The sample application loses its focus and goes to the background.</span></span>

<span data-ttu-id="3e6ef-297">Ниже перечислены методы Кмсиутил.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-297">The methods of CMsiUtil are listed below:</span></span>



| <span data-ttu-id="3e6ef-298">Метод</span><span class="sxs-lookup"><span data-stu-id="3e6ef-298">Method</span></span>                | <span data-ttu-id="3e6ef-299">Описание</span><span class="sxs-lookup"><span data-stu-id="3e6ef-299">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="3e6ef-300">аборталлрекуестс</span><span class="sxs-lookup"><span data-stu-id="3e6ef-300">AbortAllRequests</span></span>      | <span data-ttu-id="3e6ef-301">Приводит к прерыванию текущей установки и очистке очереди активных запросов на установку.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-301">Causes the current installation to abort and empties the active installation request queue.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| <span data-ttu-id="3e6ef-302">аборткуррентрекуест</span><span class="sxs-lookup"><span data-stu-id="3e6ef-302">AbortCurrentRequest</span></span>   | <span data-ttu-id="3e6ef-303">Вызывает аварийное завершение установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-303">Causes the installation in progress to abort.</span></span> <span data-ttu-id="3e6ef-304">Затем рабочий поток обрабатывает следующий запрос в очереди, если он существует.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-304">The worker thread then processes the next request in the queue, if one exists.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| <span data-ttu-id="3e6ef-305">енаблепассивеинсталл</span><span class="sxs-lookup"><span data-stu-id="3e6ef-305">EnablePassiveInstall</span></span>  | <span data-ttu-id="3e6ef-306">Увеличивает или уменьшает число включений пассивной установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-306">Increments or decrements passive installation enable count.</span></span> <span data-ttu-id="3e6ef-307">В примере этот вызов используется для управления тем, когда пассивная установка может и не произойти.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-307">The sample uses this call to control when passive installation can and cannot happen.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| <span data-ttu-id="3e6ef-308">жеткуррентфеатуренаме</span><span class="sxs-lookup"><span data-stu-id="3e6ef-308">GetCurrentFeatureName</span></span> | <span data-ttu-id="3e6ef-309">Возвращает имя активной установки компонента.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-309">Returns the name of the feature that is actively being installed.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| <span data-ttu-id="3e6ef-310">жетфеатурепрогресс</span><span class="sxs-lookup"><span data-stu-id="3e6ef-310">GetFeatureProgress</span></span>    | <span data-ttu-id="3e6ef-311">Возвращает текущую точку Tick для устанавливаемого компонента.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-311">Returns the current tick position for the feature that is being installed.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="3e6ef-312">жетфеатурепрогрессмакс</span><span class="sxs-lookup"><span data-stu-id="3e6ef-312">GetFeatureProgressMax</span></span> | <span data-ttu-id="3e6ef-313">Возвращает максимальное число тактов хода выполнения для устанавливаемого компонента.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-313">Returns the maximum number of progress tick for the feature that is being installed.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <span data-ttu-id="3e6ef-314">GetLastError</span><span class="sxs-lookup"><span data-stu-id="3e6ef-314">GetLastError</span></span>          | <span data-ttu-id="3e6ef-315">Этот метод используется для получения кода возврата из предыдущего запроса на установку.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-315">Use this method to retrieve the return code from the previous installation request.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| <span data-ttu-id="3e6ef-316">жетпассивепрогресс</span><span class="sxs-lookup"><span data-stu-id="3e6ef-316">GetPassiveProgress</span></span>    | <span data-ttu-id="3e6ef-317">Возвращает расположение индикатора хода выполнения для пассивной установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-317">Returns the progress bar tick position for passive installation.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| <span data-ttu-id="3e6ef-318">жетпассивепрогрессмакс</span><span class="sxs-lookup"><span data-stu-id="3e6ef-318">GetPassiveProgressMax</span></span> | <span data-ttu-id="3e6ef-319">Возвращает текущую координату Tick и максимальное число тактов для пассивной установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-319">Returns the current tick position and the maximum number of ticks for passive installation.</span></span> <span data-ttu-id="3e6ef-320">Вместе этот пример может использовать их для отображения общего хода выполнения пассивной установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-320">Together, the sample can use them to show the overall progress of the passive installation.</span></span>                                                                                                                                                                                                                                                                                                                                                                                               |
| <span data-ttu-id="3e6ef-321">GetProgress</span><span class="sxs-lookup"><span data-stu-id="3e6ef-321">GetProgress</span></span>           | <span data-ttu-id="3e6ef-322">Возвращает расположение индикатора хода выполнения для установки активного набора компонентов.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-322">Returns the progress bar tick position for the active feature set installation.</span></span> <span data-ttu-id="3e6ef-323">Используется, когда образец отображает индикатор выполнения установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-323">This is used when the sample renders the installation progress bar.</span></span> <span data-ttu-id="3e6ef-324">Поскольку установщик Windows предоставляет только сведения о ходе установки одной из компонентов, метод разделяет индикатор выполнения между запрошенными компонентами, чтобы пользователь по-прежнему видит всю установку как одну задачу.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-324">Because the Windows Installer only provides progress information for the one feature being installed, the method divides the progress bar among the requested features so that the user still sees the entire installation as one task.</span></span>                                                                                                                                                                                           |
| <span data-ttu-id="3e6ef-325">жетпрогрессмакс</span><span class="sxs-lookup"><span data-stu-id="3e6ef-325">GetProgressMax</span></span>        | <span data-ttu-id="3e6ef-326">Возвращает максимальное число тактов индикатора выполнения для установки активного набора компонентов.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-326">Returns the maximum progress bar tick count for the active feature set installation.</span></span> <span data-ttu-id="3e6ef-327">Используется, когда образец отображает индикатор выполнения установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-327">This is used when the sample renders the installation progress bar.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                              |
| <span data-ttu-id="3e6ef-328">Инициализация</span><span class="sxs-lookup"><span data-stu-id="3e6ef-328">Initialize</span></span>            | <span data-ttu-id="3e6ef-329">Инициализирует класс с глобальным уникальным идентификатором (GUID) продукта.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-329">Initializes the class with the product globally unique identifier (GUID).</span></span> <span data-ttu-id="3e6ef-330">Этот метод также перечисляет все компоненты приложения, которые были объявлены, но еще не установлены, и помещает его в очередь пассивной установки для настройки пассивной установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-330">This method also enumerates every feature of the application which has been advertised but not yet installed, and places it in the passive installation queue to set up the passive installation.</span></span>                                                                                                                                                                                                                                                                                                           |
| <span data-ttu-id="3e6ef-331">исинсталлинпрогресс</span><span class="sxs-lookup"><span data-stu-id="3e6ef-331">IsInstallInProgress</span></span>   | <span data-ttu-id="3e6ef-332">Используйте этот метод, чтобы определить, обрабатывается ли активная установка.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-332">Use this method to find out whether an active installation is being processed.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| <span data-ttu-id="3e6ef-333">усефеатуре</span><span class="sxs-lookup"><span data-stu-id="3e6ef-333">UseFeature</span></span>            | <span data-ttu-id="3e6ef-334">Закрытый метод, вызываемый методом Усефеатуресет.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-334">Private method called by UseFeatureSet.</span></span> <span data-ttu-id="3e6ef-335">Проверяет, установлен ли компонент.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-335">Checks if a feature is installed.</span></span> <span data-ttu-id="3e6ef-336">Если запрошенный компонент установлен, метод возвращает значение.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-336">If the requested feature is installed the method returns.</span></span> <span data-ttu-id="3e6ef-337">Если компонент еще не установлен (объявлен), метод помещает новый активный запрос на установку для рабочего потока, а затем возвращает.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-337">If the feature is not yet installed (advertised), the method queues a new active installation request for the worker thread and then returns.</span></span> <span data-ttu-id="3e6ef-338">Необязательный дескриптор события, который будет получать сигнал о завершении запрошенной установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-338">The optional event handle that will be signaled when the requested installation is complete.</span></span>                                                                                                                                                                                                        |
| <span data-ttu-id="3e6ef-339">усефеатуресет</span><span class="sxs-lookup"><span data-stu-id="3e6ef-339">UseFeatureSet</span></span>         | <span data-ttu-id="3e6ef-340">Вызывается образцом, когда ему требуется доступ к функциональным возможностям, предоставляемым определенной функцией или ее вложенными компонентами.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-340">Called by the sample when it needs to access functionalities provided by a particular feature or any of its sub-features.</span></span> <span data-ttu-id="3e6ef-341">Метод перечисляет все функции примера и вызывает Усефеатуре () для подкомпонентов указанной корневой функции.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-341">The method enumerates all features of the sample and calls UseFeature() for sub-features of the specified root feature.</span></span> <span data-ttu-id="3e6ef-342">Пример может передать дескриптор события, который будет получать сигнал при установке всего набора компонентов.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-342">The sample can pass in an event handle that will be signaled when the entire feature set is installed.</span></span> <span data-ttu-id="3e6ef-343">Поскольку все компоненты устанавливаются в набор, для последней функции, поставленной в очередь Усефеатуре (), задается маркер, чтобы после установки всех запрошенных компонентов этот пример получал уведомления.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-343">Because the features all installed as a set, The handle is specified for the last feature queued by UseFeature() instead of every feature, so that the sample gets notified once after all requested features are installed.</span></span> |
| <span data-ttu-id="3e6ef-344">усепродукт</span><span class="sxs-lookup"><span data-stu-id="3e6ef-344">UseProduct</span></span>            | <span data-ttu-id="3e6ef-345">Помещает в очередь запрос на активную установку для рабочего потока, чтобы вызвать установщик для выполнения полной установки продукта.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-345">Queues an active installation request for the worker thread to call the installer to perform a full product installation.</span></span> <span data-ttu-id="3e6ef-346">Необязательный дескриптор события, который будет получать сигнал о завершении запрошенной установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-346">The optional event handle that will be signaled when the requested installation is complete.</span></span>                                                                                                                                                                                                                                                                                                                                                                |



 

## <a name="limitation"></a><span data-ttu-id="3e6ef-347">Ограничение</span><span class="sxs-lookup"><span data-stu-id="3e6ef-347">Limitation</span></span>

<span data-ttu-id="3e6ef-348">Текущая версия установщика не предназначена для одновременного доступа нескольких потоков.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-348">The current version of installer is not designed for simultaneous access by multiple threads.</span></span> <span data-ttu-id="3e6ef-349">Таким образом, когда рабочий поток вызывает установщик, основной поток не должен вызывать установщик.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-349">Therefore, when the worker thread is calling into the installer, the main thread should not call the installer.</span></span> <span data-ttu-id="3e6ef-350">Пример такого ограничения возникает в примере, когда основной поток запрашивает функцию, а затем повторно запрашивает эту функцию, прежде чем рабочий поток завершит установку.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-350">An example of this limitation occurs in the sample when the main thread requests a feature, then requests the same feature again before the worker thread completes the installation.</span></span> <span data-ttu-id="3e6ef-351">Второй запрос вызывает Мсикуерифеатурестате (), чтобы узнать, установлен ли уже запрошенный компонент, так как иногда установщик может указать, что эта функция полностью установлена при копировании файлов рабочим потоком.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-351">The second request calls MsiQueryFeatureState() to find out whether the requested feature is already installed, since the installer may sometimes indicate that the feature is completely installed when the worker thread is still copying the files.</span></span>

<span data-ttu-id="3e6ef-352">К счастью, существует простая работа.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-352">Fortunately, there is an easy work-around for this.</span></span> <span data-ttu-id="3e6ef-353">Кмсиутил проверит, устанавливается ли компонент рабочим потоком, прежде чем он вызовет такие функции, как Мсикуерифеатурестате () или Мсиусефеатуре (), чтобы запрашивать состояние установки рассматриваемой функции.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-353">CMsiUtil will check whether a feature is being installed by the worker thread before it calls functions such as MsiQueryFeatureState() or MsiUseFeature() to ask for the install state of the feature in question.</span></span> <span data-ttu-id="3e6ef-354">Имейте в виду, что это ограничение также может стать проблемой в других случаях.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-354">Be aware that this limitation can also become an issue elsewhere.</span></span>

<span data-ttu-id="3e6ef-355">Исправление может повлиять на то, насколько хорошо работает установка по запросу на компьютере конечного пользователя.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-355">Patching can affect how well install-on-demand works on an end-user's computer.</span></span> <span data-ttu-id="3e6ef-356">Применение исправления, которое содержит только данные, измененные с предыдущей версии, может потребовать установки предыдущей версии обновленного файла для применения изменений.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-356">Applying a patch that only contains data that has changed from the previous version may require that the previous version of the updated file be installed in order to apply the delta.</span></span> <span data-ttu-id="3e6ef-357">В этом случае исправление должно запрашивать, что установщик устанавливает затронутые объявленные компоненты перед применением исправления к игре.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-357">In this situation, the patch must request that the installer install affected advertised features before applying the patch to the game.</span></span>

<span data-ttu-id="3e6ef-358">Пример устанавливается путем запуска InstallOnDemand.msi, так как предполагается, что на компьютере есть [установщик Windows](/windows/desktop/Msi/windows-installer-portal) .</span><span class="sxs-lookup"><span data-stu-id="3e6ef-358">The sample is installed by launching InstallOnDemand.msi because it assumes that the [Windows Installer](/windows/desktop/Msi/windows-installer-portal) is present on the computer.</span></span> <span data-ttu-id="3e6ef-359">Если установщик отсутствует, MSI-файлы не распознаются и их запуск не будет работать.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-359">If the installer is absent, .msi files are not recognized and launching them will not work.</span></span> <span data-ttu-id="3e6ef-360">Чтобы преодолеть эту проблему, приложение должно использовать программу установки для выполнения этой задачи.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-360">To overcome this problem, an application should use an installation program to perform the task.</span></span> <span data-ttu-id="3e6ef-361">Эта программа должна сначала проверить наличие установщика и, если да, его версию.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-361">This program should first check to see if the installer is present, and if so, its version.</span></span> <span data-ttu-id="3e6ef-362">Если версия не соответствует требованиям приложения, программа установки должна установить установщик Windows, а затем запустить MSI файл.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-362">If the version does not meet the application's requirement, the installation program should install the Windows Installer, then launch the .msi file.</span></span> <span data-ttu-id="3e6ef-363">Этот процесс называется начальной загрузкой.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-363">This process is known as bootstrapping.</span></span> <span data-ttu-id="3e6ef-364">Приложения обычно применяют имя программы установки начальной загрузки Setup.exe.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-364">Applications typically name their bootstrapping installation program Setup.exe.</span></span> <span data-ttu-id="3e6ef-365">Образец не обрабатывает начальную загрузку.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-365">The sample does not handle bootstrapping.</span></span> <span data-ttu-id="3e6ef-366">Однако полные сведения о начальной загрузке можно найти в установщик Windows.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-366">However, complete details on bootstrapping can be found in the Windows Installer.</span></span>

<span data-ttu-id="3e6ef-367">Разработчики также должны обратить внимание на размер каждого компонента в играх.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-367">Developers should also pay attention to the size of each feature in their games.</span></span> <span data-ttu-id="3e6ef-368">При отмене установки программа установки восстанавливает состояние компьютера до установки.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-368">When canceling an installation in progress, the installer restores the computer to the state before the installation.</span></span> <span data-ttu-id="3e6ef-369">Это означает, что установка компонента полностью отменена и частичная установка компонентов не выполняется.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-369">This means that the installation of the feature is completely undone, and there is no partial feature installation.</span></span> <span data-ttu-id="3e6ef-370">Большая функция требует больше времени для установки, что либо увеличивает вероятность того, что установка будет прервана и отменена, либо установка помешает основному приложению.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-370">A large feature requires longer time to install, which either increases the likelihood that the install will be interrupted and cancelled or the install will interfere with the main application.</span></span> <span data-ttu-id="3e6ef-371">В качестве примера можно включить пассивную установку, когда пользователь открывает игровое меню в середине игры.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-371">An example would be enabling passive installation when the user brings up the game menu in the middle of game play.</span></span> <span data-ttu-id="3e6ef-372">Если компонент устанавливается и пользователь возвращается к игре, то игра может выполнить одно из двух действий: это может позволить завершить выполнение пассивной установки или отменить пассивную установку.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-372">If a feature is installing and the user goes back to playing, the game can do one of two things: it can let the passive installation complete, or it can cancel the passive installation.</span></span> <span data-ttu-id="3e6ef-373">Большая функция будет плохо соответствовать любой из моделей.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-373">A large feature would fit poorly with either model.</span></span> <span data-ttu-id="3e6ef-374">Если игра позволяет завершить большую установку, установка может снизить производительность визуализации игры в течение длительного времени.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-374">If the game lets the large installation complete, the installation may hinder the game's rendering performance for a long time.</span></span> <span data-ttu-id="3e6ef-375">И наоборот, если в игре отменяется установка, пользователь должен оставаться в меню в течение длительного времени, прежде чем вернуться к игре.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-375">Conversely, if the game cancels the installation, then the user must stay in the menu for a long time before returning to the game.</span></span> <span data-ttu-id="3e6ef-376">Разработчики должны найти оптимальный размер функции, который лучше подходит для отдельных игр.</span><span class="sxs-lookup"><span data-stu-id="3e6ef-376">Developers should find a balanced feature size that works best for their individual games.</span></span>

 

 