---
title: Контроль учетных записей для разработчиков игр
description: В этой статье описываются рекомендации и рекомендации для разработчиков игр по эффективному взаимодействии с функцией безопасности контроля учетных записей (UAC), представленной в Windows Vista.
ms.assetid: dbac1c07-73dd-f2bc-3c5c-d6160368a88f
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 57d5533a3fbdd349cc25dfde501a234bbd7b05b1
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104413270"
---
# <a name="user-account-control-for-game-developers"></a><span data-ttu-id="82f10-103">Контроль учетных записей для разработчиков игр</span><span class="sxs-lookup"><span data-stu-id="82f10-103">User Account Control for Game Developers</span></span>

<span data-ttu-id="82f10-104">В этой статье описываются рекомендации и рекомендации для разработчиков игр по эффективному взаимодействии с функцией безопасности контроля учетных записей (UAC), представленной в Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="82f10-104">This article describes the guidelines and best practices for game developers to work effectively with the User Account Control (UAC) security feature introduced in Windows Vista.</span></span>

-   [<span data-ttu-id="82f10-105">Общие сведения об управлении учетными записями пользователей</span><span class="sxs-lookup"><span data-stu-id="82f10-105">Overview of User Account Control</span></span>](#overview-of-user-account-control)
-   [<span data-ttu-id="82f10-106">Учетные записи пользователей в Windows Vista</span><span class="sxs-lookup"><span data-stu-id="82f10-106">User Accounts in Windows Vista</span></span>](#user-accounts-in-windows-vista)
-   [<span data-ttu-id="82f10-107">Доступ к файлу как обычный пользователь</span><span class="sxs-lookup"><span data-stu-id="82f10-107">File Access as a Standard User</span></span>](#file-access-as-a-standard-user)
-   [<span data-ttu-id="82f10-108">Доступ к реестру как обычный пользователь</span><span class="sxs-lookup"><span data-stu-id="82f10-108">Registry Access as a Standard User</span></span>](#registry-access-as-a-standard-user)
-   [<span data-ttu-id="82f10-109">Повышение привилегий</span><span class="sxs-lookup"><span data-stu-id="82f10-109">Privilege Elevation</span></span>](#privilege-elevation)
-   [<span data-ttu-id="82f10-110">Влияние контроля учетных записей на функцию CreateProcess ()</span><span class="sxs-lookup"><span data-stu-id="82f10-110">UAC Implications with CreateProcess()</span></span>](#uac-implications-with-createprocess)
-   [<span data-ttu-id="82f10-111">Задание уровня выполнения в манифесте приложения</span><span class="sxs-lookup"><span data-stu-id="82f10-111">Setting the Execution Level in the Application Manifest</span></span>](#setting-the-execution-level-in-the-application-manifest)
-   [<span data-ttu-id="82f10-112">Встраивание манифеста в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="82f10-112">Embedding a Manifest in Visual Studio</span></span>](#embedding-a-manifest-in-visual-studio)
-   [<span data-ttu-id="82f10-113">Совместимость UAC с более старыми играми</span><span class="sxs-lookup"><span data-stu-id="82f10-113">UAC Compatibility with Older Games</span></span>](#uac-compatibility-with-older-games)
-   [<span data-ttu-id="82f10-114">Устаревшие сценарии и манифесты</span><span class="sxs-lookup"><span data-stu-id="82f10-114">Legacy Scenarios and Manifests</span></span>](#legacy-scenarios-and-manifests)
-   [<span data-ttu-id="82f10-115">Заключение</span><span class="sxs-lookup"><span data-stu-id="82f10-115">Conclusion</span></span>](#conclusion)
-   [<span data-ttu-id="82f10-116">Дополнительные материалы</span><span class="sxs-lookup"><span data-stu-id="82f10-116">Further Reading</span></span>](#further-reading)

## <a name="overview-of-user-account-control"></a><span data-ttu-id="82f10-117">Общие сведения об управлении учетными записями пользователей</span><span class="sxs-lookup"><span data-stu-id="82f10-117">Overview of User Account Control</span></span>

<span data-ttu-id="82f10-118">Контроль учетных записей (UAC), появившийся в Windows Vista, — это функция безопасности, которая призвана помочь предотвратить использование слабых злоумышленниками уязвимостей или ошибок, обнаруженных в широко используемых приложениях, для изменения операционной системы или других установленных программ.</span><span class="sxs-lookup"><span data-stu-id="82f10-118">User Account Control (UAC), introduced in Windows Vista, is a security feature that is designed to help prevent malicious attackers from using weaknesses or bugs found in widely-used applications to alter the operating system or other installed programs.</span></span> <span data-ttu-id="82f10-119">Это достигается путем запуска подавляющего большинства программ и процессов в качестве стандартного пользователя (также известного как ограниченный пользователь, ограниченный пользователь или пользователь Least-Privileged), даже если учетная запись текущего пользователя имеет учетные данные администратора.</span><span class="sxs-lookup"><span data-stu-id="82f10-119">This is accomplished by running the vast majority of programs and processes as a Standard User (also known as a Limited User, Restricted User, or Least-Privileged User) even if the current user's account has administrative credentials.</span></span> <span data-ttu-id="82f10-120">Процесс с правами обычного пользователя имеет множество ограничений, которые не позволяют вносить изменения на уровне системы.</span><span class="sxs-lookup"><span data-stu-id="82f10-120">A process with standard user privileges has many inherent restrictions that prevent it from making system-wide changes.</span></span>

<span data-ttu-id="82f10-121">UAC также отвечает за повышение привилегий процесса, используя схему проверки подлинности на основе диалоговых окон, инициированную при выполнении определенных процессов, которые обозначаются как обязательные права администратора.</span><span class="sxs-lookup"><span data-stu-id="82f10-121">UAC is also responsible for privilege elevation of a process by use of a dialog-based, authentication scheme initiated upon execution of certain processes that are designated as requiring administrative privileges.</span></span> <span data-ttu-id="82f10-122">Повышение привилегий позволяет администраторам запускать большинство приложений на уровне безопасности (то же самое, что и любой другой стандартный пользователь), но также разрешать выполнение процессов и операций, требующих прав администратора.</span><span class="sxs-lookup"><span data-stu-id="82f10-122">Privilege elevation allows administrators to run the majority of their applications at a safe privilege level (the same as any other standard user), but also allow processes and operations that require administrative privileges.</span></span> <span data-ttu-id="82f10-123">UAC поддерживает сквозную проверку подлинности, чтобы администратор мог предоставить программе повышенные привилегии, пока Стандартный пользователь в системе не вошел в систему.</span><span class="sxs-lookup"><span data-stu-id="82f10-123">UAC supports over-the-shoulder authentication so that an administrator can grant elevated privileges to a program while a standard user is currently logged onto the system.</span></span>

<span data-ttu-id="82f10-124">Функция UAC включена по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="82f10-124">The UAC feature is enabled by default.</span></span> <span data-ttu-id="82f10-125">Хотя Администратор может отключить UAC на уровне всей системы, это имеет ряд негативных последствий.</span><span class="sxs-lookup"><span data-stu-id="82f10-125">While it is possible for an administrator to disable UAC system-wide, doing so has a number of negative ramifications.</span></span> <span data-ttu-id="82f10-126">Во первых, это приводит к ослаблению безопасности всех административных учетных записей, так как все процессы запускаются с административными учетными данными, даже если они действительно не требуются большинству приложений.</span><span class="sxs-lookup"><span data-stu-id="82f10-126">First, this weakens the security of all administrative accounts, as all processes would be run with administrative credentials, even when most applications do not actually require them.</span></span> <span data-ttu-id="82f10-127">Если UAC отключен, стандартное пользовательское приложение, предоставляющее уязвимую уязвимость в системе безопасности, потенциально может быть использовано для кражи частной информации, установки rootkit-программ или шпионского по, уничтожения целостности системы или размещения зомби-атак в других системах.</span><span class="sxs-lookup"><span data-stu-id="82f10-127">With UAC disabled, a standard user application that exposes an exploitable vulnerability in security can potentially be used to steal private information, install rootkits or spyware, destroy the system integrity, or host zombie attacks on other systems.</span></span> <span data-ttu-id="82f10-128">В то время как функция UAC включена, запуск большинства программного обеспечения в качестве обычного пользователя значительно ограничивает потенциальный ущерб от такой ошибки.</span><span class="sxs-lookup"><span data-stu-id="82f10-128">Whereas with UAC enabled, running the majority of software as a standard user greatly limits the potential damage from such a bug.</span></span> <span data-ttu-id="82f10-129">Во-вторых, отключение UAC отключает многие обходные пути для совместимости приложений, которые позволяют обычным пользователям успешно запускать широкий спектр приложений.</span><span class="sxs-lookup"><span data-stu-id="82f10-129">Secondly, turning off UAC disables many of the workarounds for application compatibility that allow true standard users to successfully run a broad range of applications.</span></span> <span data-ttu-id="82f10-130">Отключение UAC не рекомендуется использовать в качестве решения для совместимости.</span><span class="sxs-lookup"><span data-stu-id="82f10-130">Disabling UAC should never be recommended as a compatibility workaround.</span></span>

<span data-ttu-id="82f10-131">Важно отметить, что приложения должны использовать стандартные права пользователя, только если это возможно.</span><span class="sxs-lookup"><span data-stu-id="82f10-131">It is important to note that applications should strive to only use standard user rights if at all possible.</span></span> <span data-ttu-id="82f10-132">Администраторы могут легко повышать уровень привилегий процесса, однако при каждом запуске приложения все равно требуется вмешательство пользователя и подтверждение, требующее учетных данных администратора.</span><span class="sxs-lookup"><span data-stu-id="82f10-132">While administrators can easily elevate the privileges of a process, the elevation still requires user interaction and acknowledgement every time that an application is run that requires administrative credentials.</span></span> <span data-ttu-id="82f10-133">Это повышение необходимо также выполнить во время запуска программы, поэтому требование учетных данных администратора даже для одной операции требует предоставления системе большего риска для всего времени выполнения приложения.</span><span class="sxs-lookup"><span data-stu-id="82f10-133">This elevation must also be done at the time that the program starts, so requiring administrative credentials   even for a single operation   requires exposing the system to greater risk for the entire running time of the application.</span></span> <span data-ttu-id="82f10-134">Обычные пользователи, не имеющие возможности повышать свои привилегии, также часто встречаются в параметрах семьи и бизнеса.</span><span class="sxs-lookup"><span data-stu-id="82f10-134">Standard users without any ability to elevate their privileges are also common in family and business settings.</span></span> <span data-ttu-id="82f10-135">«Запуск от имени администратора» не является хорошим решением для обеспечения совместимости, предоставляет пользователю и системе повышенную угрозу безопасности и создает разочарование для пользователей во многих ситуациях.</span><span class="sxs-lookup"><span data-stu-id="82f10-135">"Run As Administrator" is not a good workaround for compatibility, exposes the user and the system to greater security risk, and creates frustration for users in many situations.</span></span>

> [!Note]  
> <span data-ttu-id="82f10-136">Функция контроля учетных записей пользователей, появившаяся в Windows Vista, также присутствует в Windows 7.</span><span class="sxs-lookup"><span data-stu-id="82f10-136">The User Account Control feature introduced in Windows Vista is also present in Windows 7.</span></span> <span data-ttu-id="82f10-137">В то время как взаимодействие с пользователем, работающее с различными системными функциями, было улучшено по отношению к контролю учетных записей пользователей, влияние на приложения практически не отличается.</span><span class="sxs-lookup"><span data-stu-id="82f10-137">While the user experience working with the various system features has been improved with respect to User Account Control, the impact on applications is basically the same.</span></span> <span data-ttu-id="82f10-138">Все рекомендации по Windows Vista, приведенные в этой статье, применимы и к Windows 7.</span><span class="sxs-lookup"><span data-stu-id="82f10-138">All of the Windows Vista recommendations in this article apply to Windows 7 as well.</span></span> <span data-ttu-id="82f10-139">Дополнительные сведения об изменениях пользовательского интерфейса UAC для Windows 7 см. в разделе [Пользовательский интерфейс — обновления диалогового окна управления учетными записями пользователей](../win7appqual/user-interface---user-account-control-dialog-updates.md).</span><span class="sxs-lookup"><span data-stu-id="82f10-139">For details on the UAC UI changes for Windows 7, see [User Interface - User Account Control Dialog Updates](../win7appqual/user-interface---user-account-control-dialog-updates.md).</span></span>

 

## <a name="user-accounts-in-windows-vista"></a><span data-ttu-id="82f10-140">Учетные записи пользователей в Windows Vista</span><span class="sxs-lookup"><span data-stu-id="82f10-140">User Accounts in Windows Vista</span></span>

<span data-ttu-id="82f10-141">В Windows Vista каждый пользователь распределяется по двум типам учетных записей: Администраторы и обычные пользователи.</span><span class="sxs-lookup"><span data-stu-id="82f10-141">Windows Vista categorizes every user into two user account types: administrators and standard users.</span></span>

<span data-ttu-id="82f10-142">Учетная запись обычного пользователя аналогична учетной записи с ограниченным доступом в Windows XP.</span><span class="sxs-lookup"><span data-stu-id="82f10-142">A standard user account is similar to a limited-user account in Windows XP.</span></span> <span data-ttu-id="82f10-143">Как и в Windows XP, Стандартный пользователь не может записывать в папку Program Files, не может записывать в \_ раздел реестра hKey на локальном \_ компьютере и выполнять задачи, которые изменяют систему, например установку драйвера режима ядра или доступ к системным пространствам системного уровня.</span><span class="sxs-lookup"><span data-stu-id="82f10-143">Like in Windows XP, a standard user cannot write to the Program Files folder, cannot write to the HKEY\_LOCAL\_MACHINE portion of the registry, and cannot perform tasks that alter the system, such as installing a kernel-mode driver or accessing system-level process spaces.</span></span>

<span data-ttu-id="82f10-144">С момента выпуска Windows XP учетная запись администратора значительно изменилась.</span><span class="sxs-lookup"><span data-stu-id="82f10-144">The Administrator account has significantly changed since Windows XP was released.</span></span> <span data-ttu-id="82f10-145">Ранее всем процессам, запущенным членом группы "Администраторы", были предоставлены права администратора.</span><span class="sxs-lookup"><span data-stu-id="82f10-145">Previously, all processes launched by a member of the Administrators group were given administrative privileges.</span></span> <span data-ttu-id="82f10-146">При включенном контроле учетных записей все процессы выполняются с правами обычного пользователя, если только администратор не повышают их.</span><span class="sxs-lookup"><span data-stu-id="82f10-146">With UAC enabled, all processes execute with standard user privileges, unless specifically elevated by an administrator.</span></span> <span data-ttu-id="82f10-147">Это различие делает учетные записи в группе «Администраторы» более безопасными, уменьшая риски безопасности, вызванные потенциальными ошибками в большинстве программ.</span><span class="sxs-lookup"><span data-stu-id="82f10-147">This difference makes accounts in the Administrators group more secure by reducing the security risk posed by potential bugs in most programs.</span></span>

<span data-ttu-id="82f10-148">Важно, чтобы все приложения, особенно игры, работали эффективно и в соответствии с выполняемыми процессами обычного пользователя.</span><span class="sxs-lookup"><span data-stu-id="82f10-148">It is important that all applications, especially games, operate effectively and responsibly when run as a standard user process.</span></span> <span data-ttu-id="82f10-149">Все операции, требующие прав администратора, должны выполняться во время установки или с помощью вспомогательных программ, которые явно запрашивают учетные данные администратора.</span><span class="sxs-lookup"><span data-stu-id="82f10-149">All operations that require administrative privileges should be done either at installation time or by auxiliary programs that explicitly request administrative credentials.</span></span> <span data-ttu-id="82f10-150">Хотя повышение привилегий довольно тривиально для члена группы "Администраторы", стандартные пользователи должны откладываться на учетные данные администратора, чтобы физически ввести пароль для повышения привилегий.</span><span class="sxs-lookup"><span data-stu-id="82f10-150">While privilege elevation is fairly trivial for a member of the Administrators group, standard users must defer to someone with administrative credentials to physically enter their password to elevate privileges.</span></span> <span data-ttu-id="82f10-151">Поскольку учетные записи, защищенные с помощью родительского контроля, должны быть обычными пользователями, это будет очень распространенной ситуацией для любителей, использующих Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="82f10-151">Since accounts protected by parental controls must be standard users, this will be a very common situation for gamers who are using Windows Vista.</span></span>

<span data-ttu-id="82f10-152">Если ваша игра уже работает под управлением Windows XP с ограниченными учетными записями пользователей, то переход на систему управления учетными записями пользователей в Windows Vista должен быть очень простым.</span><span class="sxs-lookup"><span data-stu-id="82f10-152">If your game is already working on Windows XP with limited-user accounts, then the move to User Account Control on Windows Vista should be very easy.</span></span> <span data-ttu-id="82f10-153">Большинство таких приложений будет работать как есть, хотя настоятельно рекомендуется добавить манифест приложения.</span><span class="sxs-lookup"><span data-stu-id="82f10-153">The majority of such applications will work as-is, although adding an application manifest is highly recommended.</span></span> <span data-ttu-id="82f10-154">(Манифесты описаны далее в этом разделе, посвященном [настройке уровня выполнения в манифесте приложения](#setting-the-execution-level-in-the-application-manifest).)</span><span class="sxs-lookup"><span data-stu-id="82f10-154">(Manifests are described later in this topic in [Setting the Execution Level in the Application Manifest](#setting-the-execution-level-in-the-application-manifest).)</span></span>

## <a name="file-access-as-a-standard-user"></a><span data-ttu-id="82f10-155">Доступ к файлу как обычный пользователь</span><span class="sxs-lookup"><span data-stu-id="82f10-155">File Access as a Standard User</span></span>

<span data-ttu-id="82f10-156">Аспектом игры, которые наиболее подвержены ограничениям обычного пользователя, являются организация файловой системы и специальные возможности.</span><span class="sxs-lookup"><span data-stu-id="82f10-156">The aspect of your game most affected by standard user restrictions is file system organization and accessibility.</span></span> <span data-ttu-id="82f10-157">Никогда не следует рассчитывать, что игра может записывать файлы в папку, в которой установлена игра.</span><span class="sxs-lookup"><span data-stu-id="82f10-157">You should never assume that your game can write files to the folder where your game is installed.</span></span> <span data-ttu-id="82f10-158">Например, в Windows Vista операционная система должна повысить привилегии пользователя, прежде чем приложение сможет выполнять запись в папку Program Files.</span><span class="sxs-lookup"><span data-stu-id="82f10-158">In Windows Vista for instance, a user s privileges must be elevated by the operating system before an application can write to the Program Files folder.</span></span> <span data-ttu-id="82f10-159">Чтобы избежать этого, следует классифицировать файлы данных игр по области и доступности, а также использовать функцию [**шжетфолдерпас**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) вместе с КОНСТАНТами CSid, предоставляемыми оболочкой Windows, для создания соответствующих путей к файлам.</span><span class="sxs-lookup"><span data-stu-id="82f10-159">To avoid this, you should categorize your game s data files by scope and accessibility, and use the [**SHGetFolderPath**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) function, along with the CSIDL constants provided by the Windows shell, to generate the appropriate file paths.</span></span> <span data-ttu-id="82f10-160">Константы CSID соответствуют известным папкам в файловой системе, используемой операционной системой, и позволяют секционировать глобальные и пользовательские файлы.</span><span class="sxs-lookup"><span data-stu-id="82f10-160">The CSIDL constants correspond to known folders in the file system that the operating system uses and promotes to partition global and user-specific files.</span></span>

<span data-ttu-id="82f10-161">Попытка создать или записать файл или каталог в папке, не предоставляющей разрешение на запись в процесс, приведет к сбою в Windows Vista, если приложение не имеет прав администратора.</span><span class="sxs-lookup"><span data-stu-id="82f10-161">Attempting to create or write a file or directory under a folder which does not grant write permission to the process will fail under Windows Vista if the application does not have administrative privileges.</span></span> <span data-ttu-id="82f10-162">Если исполняемый файл 32-разрядной игры работает в устаревшем режиме, так как он не объявил запрошенный уровень выполнения, операции записи будут выполнены успешно, но будут подвергаться виртуализации, как описано в разделе "совместимость UAC с более старыми играми" Далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="82f10-162">If your 32-bit game executable is running in legacy mode, because it did not declare a requested execution level, its write operations will succeed, but they will be subjected to virtualization as described in the section "UAC Compatibility with Older Games" later in this article.</span></span>

<span data-ttu-id="82f10-163">**Таблица 1. Известные папки**</span><span class="sxs-lookup"><span data-stu-id="82f10-163">**Table 1. Known Folders**</span></span>



| <span data-ttu-id="82f10-164">Имя CSID</span><span class="sxs-lookup"><span data-stu-id="82f10-164">CSIDL Name</span></span>             | <span data-ttu-id="82f10-165">Стандартный путь (Windows Vista)</span><span class="sxs-lookup"><span data-stu-id="82f10-165">Typical Path (Windows Vista)</span></span>                                                   | <span data-ttu-id="82f10-166">Права обычного пользователя</span><span class="sxs-lookup"><span data-stu-id="82f10-166">Standard User Rights</span></span> | <span data-ttu-id="82f10-167">Права администратора</span><span class="sxs-lookup"><span data-stu-id="82f10-167">Administrator Rights</span></span> | <span data-ttu-id="82f10-168">Область доступа</span><span class="sxs-lookup"><span data-stu-id="82f10-168">Access Scope</span></span> | <span data-ttu-id="82f10-169">Описание</span><span class="sxs-lookup"><span data-stu-id="82f10-169">Description</span></span>                                                                                                                      | <span data-ttu-id="82f10-170">Примеры</span><span class="sxs-lookup"><span data-stu-id="82f10-170">Examples</span></span>                                                          |
|------------------------|--------------------------------------------------------------------------------|----------------------|----------------------|--------------|----------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|
| <span data-ttu-id="82f10-171">личный код CSID \_</span><span class="sxs-lookup"><span data-stu-id="82f10-171">CSIDL\_PERSONAL</span></span>        | <span data-ttu-id="82f10-172">В. \\ Пользователи, \\ документы, имена пользователей \\</span><span class="sxs-lookup"><span data-stu-id="82f10-172">C:\\Users\\user name\\Documents</span></span>                                                | <span data-ttu-id="82f10-173">Чтение/запись</span><span class="sxs-lookup"><span data-stu-id="82f10-173">Read/Write</span></span>           | <span data-ttu-id="82f10-174">Чтение/запись</span><span class="sxs-lookup"><span data-stu-id="82f10-174">Read/Write</span></span>           | <span data-ttu-id="82f10-175">Per-User</span><span class="sxs-lookup"><span data-stu-id="82f10-175">Per-User</span></span>     | <span data-ttu-id="82f10-176">Пользовательские файлы игр, которые считываются и изменяются и могут управляться за пределами контекста игры.</span><span class="sxs-lookup"><span data-stu-id="82f10-176">User-specific game files that are read and modified and can be manipulated outside of the game context.</span></span>                          | <span data-ttu-id="82f10-177">Снимки экрана.</span><span class="sxs-lookup"><span data-stu-id="82f10-177">Screen shots.</span></span> <span data-ttu-id="82f10-178">Сохраненные игровые файлы с сопоставлением с расширением файла.</span><span class="sxs-lookup"><span data-stu-id="82f10-178">Saved game files with a file extension association.</span></span> |
| <span data-ttu-id="82f10-179">\_Локальная папка \_ AppData CSid</span><span class="sxs-lookup"><span data-stu-id="82f10-179">CSIDL\_LOCAL\_APPDATA</span></span>  | <span data-ttu-id="82f10-180">В: \\ Пользователи \\ имя пользователя \\ AppData \\ Local</span><span class="sxs-lookup"><span data-stu-id="82f10-180">C:\\Users\\user name\\AppData\\Local</span></span>                                           | <span data-ttu-id="82f10-181">Чтение/запись</span><span class="sxs-lookup"><span data-stu-id="82f10-181">Read/Write</span></span>           | <span data-ttu-id="82f10-182">Чтение/запись</span><span class="sxs-lookup"><span data-stu-id="82f10-182">Read/Write</span></span>           | <span data-ttu-id="82f10-183">Per-User</span><span class="sxs-lookup"><span data-stu-id="82f10-183">Per-User</span></span>     | <span data-ttu-id="82f10-184">Файлы игр для отдельных пользователей, которые считываются и изменяются и используются только в контексте игры.</span><span class="sxs-lookup"><span data-stu-id="82f10-184">User-specific game files that are read and modified and are of use only within the game context.</span></span>                                 | <span data-ttu-id="82f10-185">Файлы игрового кэша.</span><span class="sxs-lookup"><span data-stu-id="82f10-185">Game cache files.</span></span> <span data-ttu-id="82f10-186">Конфигурации проигрывателя.</span><span class="sxs-lookup"><span data-stu-id="82f10-186">Player configurations.</span></span>                          |
| <span data-ttu-id="82f10-187">\_распространенная папка \_ AppData</span><span class="sxs-lookup"><span data-stu-id="82f10-187">CSIDL\_COMMON\_APPDATA</span></span> | <span data-ttu-id="82f10-188">C: \\ папка ProgramData</span><span class="sxs-lookup"><span data-stu-id="82f10-188">C:\\ProgramData</span></span>                                                                | <span data-ttu-id="82f10-189">Чтение и запись, если владелец</span><span class="sxs-lookup"><span data-stu-id="82f10-189">Read/Write if owner</span></span>  | <span data-ttu-id="82f10-190">Чтение/запись</span><span class="sxs-lookup"><span data-stu-id="82f10-190">Read/Write</span></span>           | <span data-ttu-id="82f10-191">Все пользователи</span><span class="sxs-lookup"><span data-stu-id="82f10-191">All Users</span></span>    | <span data-ttu-id="82f10-192">Файлы игр, которые могут быть созданы пользователем и прочитаны всеми пользователями.</span><span class="sxs-lookup"><span data-stu-id="82f10-192">Game files that can be created by a user and read by all users.</span></span> <span data-ttu-id="82f10-193">Доступ на запись предоставляется только создателю файла (owner).</span><span class="sxs-lookup"><span data-stu-id="82f10-193">Write access is granted only to the creator of the file (owner).</span></span> | <span data-ttu-id="82f10-194">Профили пользователей</span><span class="sxs-lookup"><span data-stu-id="82f10-194">User Profiles</span></span>                                                     |
| <span data-ttu-id="82f10-195">\_программные \_ файлы CSid</span><span class="sxs-lookup"><span data-stu-id="82f10-195">CSIDL\_PROGRAM\_FILES</span></span>  | <span data-ttu-id="82f10-196">C: \\ Program Files</span><span class="sxs-lookup"><span data-stu-id="82f10-196">C:\\Program Files</span></span><br/> <span data-ttu-id="82f10-197">или</span><span class="sxs-lookup"><span data-stu-id="82f10-197">or</span></span><br/> <span data-ttu-id="82f10-198">C: \\ Program Files (x86)</span><span class="sxs-lookup"><span data-stu-id="82f10-198">C:\\Program Files (x86)</span></span> <br/> | <span data-ttu-id="82f10-199">Только чтение</span><span class="sxs-lookup"><span data-stu-id="82f10-199">Read only</span></span>            | <span data-ttu-id="82f10-200">Чтение/запись</span><span class="sxs-lookup"><span data-stu-id="82f10-200">Read/Write</span></span>           | <span data-ttu-id="82f10-201">Все пользователи</span><span class="sxs-lookup"><span data-stu-id="82f10-201">All Users</span></span>    | <span data-ttu-id="82f10-202">Статические игровые файлы, написанные установщиком игр, которые считываются всеми пользователями.</span><span class="sxs-lookup"><span data-stu-id="82f10-202">Static game files written by the game s installer that are read by all users.</span></span>                                                    | <span data-ttu-id="82f10-203">Игровые ресурсы, такие как материалы и сетки.</span><span class="sxs-lookup"><span data-stu-id="82f10-203">Game assets, such as materials and meshes.</span></span>                        |



 

<span data-ttu-id="82f10-204">Как правило, ваша игра устанавливается в папку в папке, представленной \_ \_ константой программных файлов CSid.</span><span class="sxs-lookup"><span data-stu-id="82f10-204">Your game will typically be installed in a folder under the folder represented by the CSIDL\_PROGRAM\_FILES constant.</span></span> <span data-ttu-id="82f10-205">Однако это не всегда так.</span><span class="sxs-lookup"><span data-stu-id="82f10-205">However, this is not always the case.</span></span> <span data-ttu-id="82f10-206">Вместо этого следует использовать относительный путь из исполняемого файла при создании строк пути к файлам или каталогам, расположенным в папке установки.</span><span class="sxs-lookup"><span data-stu-id="82f10-206">You should instead use a relative path from your executable file when generating path strings to files or directories located under your installation folder.</span></span>

<span data-ttu-id="82f10-207">Кроме того, следует отменять использование жестко запрограммированных допущений относительно известных путей к папкам.</span><span class="sxs-lookup"><span data-stu-id="82f10-207">You should also refrain from hard-coded assumptions about the known folder paths.</span></span> <span data-ttu-id="82f10-208">Например, в Windows XP Professional 64-bit Edition и Windows Vista x64 путь к файлам программы — C: \\ Program Files (x86) для 32-разрядных программ и C: \\ Program Files для 64-разрядных программ.</span><span class="sxs-lookup"><span data-stu-id="82f10-208">For example, on Windows XP Professional 64-bit Edition and Windows Vista x64, the program files path is C:\\Program Files (x86) for 32-bit programs and C:\\Program Files for 64-bit programs.</span></span> <span data-ttu-id="82f10-209">Эти известные пути изменяются с Windows XP, и пользователи могут повторно настраивать расположение многих из этих папок и даже размещать их на разных дисках.</span><span class="sxs-lookup"><span data-stu-id="82f10-209">These known paths are changed from Windows XP, and users can reconfigure the location of many of these folders and even locate them on different drives.</span></span> <span data-ttu-id="82f10-210">Поэтому всегда используйте константы CSID, чтобы избежать путаницы и потенциальных проблем.</span><span class="sxs-lookup"><span data-stu-id="82f10-210">So, always use the CSIDL constants to avoid confusion and potential problems.</span></span> <span data-ttu-id="82f10-211">Программа установки Windows распознает эти известные расположения папок и переместит данные при обновлении операционной системы Windows XP; в отличие от этого, использование нестандартных расположений или жестко запрограммированных путей может привести к сбою после обновления ОС.</span><span class="sxs-lookup"><span data-stu-id="82f10-211">Windows Setup understands these known folder locations and will move the data when upgrading the operating system from Windows XP; in contrast, use of non-standard locations or hard-coded paths may well fail after an OS upgrade.</span></span>

<span data-ttu-id="82f10-212">Обратите внимание на очевидные различия в удобстве использования пользовательских папок, заданных стандартом CSID \_ и локальной AppData (CSID) \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="82f10-212">Attention should be given to the subtle usability differences between the user-specific folders specified by CSIDL\_PERSONAL and CSIDL\_LOCAL\_APPDATA.</span></span> <span data-ttu-id="82f10-213">Рекомендуемым вариантом выбора константы CSID для записи файла является использование CSID \_ Personal, если предполагается, что пользователь взаимодействует с файлом, например двойным щелчком мыши, чтобы открыть его в средстве или приложении, и использовать \_ локальную \_ AppData для других файлов с именем CSid.</span><span class="sxs-lookup"><span data-stu-id="82f10-213">The recommended practice for selecting the CSIDL constant to use for writing a file is to use CSIDL\_PERSONAL if the user is expected to interact with the file, such as double-clicking on it to open it in a tool or application, and to use CSIDL\_LOCAL\_APPDATA for other files.</span></span> <span data-ttu-id="82f10-214">Обе папки могут использоваться приложением для хранения и организации файлов данных, относящихся к пользователю, так как они не отличаются в области доступа или уровня привилегий.</span><span class="sxs-lookup"><span data-stu-id="82f10-214">Both folders can be leveraged by your application to store and organize user-specific data files, as there is no difference in their access scope or privilege level.</span></span> <span data-ttu-id="82f10-215">Следует соблюдать осторожность при создании имен путей, которые достаточно уникальны для того, чтобы не конфликтовать с другими приложениями, но достаточно коротко, чтобы хранить количество символов в полном пути меньше, чем значение MAX \_ path, 260.</span><span class="sxs-lookup"><span data-stu-id="82f10-215">Care should be taken to create path names that are unique enough to not collide with other applications, but short enough to keep the number of characters in the full path fewer than the value of MAX\_PATH, 260.</span></span>

<span data-ttu-id="82f10-216">В следующем коде приведен пример того, как записать файл в известную папку:</span><span class="sxs-lookup"><span data-stu-id="82f10-216">The following code provides an example of how to write a file to a known folder:</span></span>

``` syntax
#include <windows.h>
#include <shlobj.h>
#include <shlwapi.h>
        ...
        ...
        ...
        TCHAR strPath[MAX_PATH];
        if( SUCCEEDED(
        SHGetFolderPath( NULL, CSIDL_PERSONAL, NULL, SHGFP_TYPE_CURRENT, strPath ) ) )
        {
        PathAppend( strPath, TEXT( "Company Name\\Title" ) );

        if( !PathFileExists( strPath ) )
        {
        if( ERROR_SUCCESS != SHCreateDirectoryEx( NULL, strPath, NULL ) )
        return E_FAIL;
        }

        PathAppend( strPath, TEXT( "gamefile.txt" ) );

        // strPath is now something like:
        // C:\Users\<current user>\Documents\Company Name\Title\gamefile.txt
        // Open the file for writing
        HANDLE hFile = CreateFile(strPath, GENERIC_WRITE, NULL, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);

        if( INVALID_HANDLE_VALUE != hFile )
        {
        // TODO: Write to file
        CloseHandle(hFile);
        }
        }
```

## <a name="registry-access-as-a-standard-user"></a><span data-ttu-id="82f10-217">Доступ к реестру как обычный пользователь</span><span class="sxs-lookup"><span data-stu-id="82f10-217">Registry Access as a Standard User</span></span>

<span data-ttu-id="82f10-218">Доступ к реестру обычного пользователя ограничивается тем же способом, что и файловая система.</span><span class="sxs-lookup"><span data-stu-id="82f10-218">Registry access by a standard user is restricted in a similar fashion as the file system.</span></span> <span data-ttu-id="82f10-219">Обычному пользователю разрешен доступ на чтение ко всем ключам в реестре; Тем не менее доступ на запись предоставляется только \_ \_ поддереву, которое сопоставляется внутренне с поддеревом пользователя hKey \_ \\ ID безопасности (SID) текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="82f10-219">A standard user is permitted read access to all keys in the registry; however, write access is only granted to the HKEY\_CURRENT\_USER (HKCU) subtree, which is mapped internally to the user-specific subkey HKEY\_USERS\\Security ID (SID) of current user.</span></span> <span data-ttu-id="82f10-220">Приложению, для которого требуется выполнить запись в реестр, отличный от \_ текущего пользователя hKey, \_ требуются права администратора.</span><span class="sxs-lookup"><span data-stu-id="82f10-220">An application that needs to write to any registry location other than HKEY\_CURRENT\_USER requires administrative privileges.</span></span>

<span data-ttu-id="82f10-221">Если 32-разрядное приложение не содержит запрошенный уровень выполнения в манифесте, то все операции записи в программу HKEY на \_ локальном \_ компьютере \\ будут виртуализированы, а запись в другие расположения за пределами текущего пользователя hKey завершится \_ \_ ошибкой.</span><span class="sxs-lookup"><span data-stu-id="82f10-221">If the 32-bit application does not contain a requested execution level in its manifest, then all writes to HKEY\_LOCAL\_MACHINE\\Software will be virtualized, while writes to other locations outside of HKEY\_CURRENT\_USER will fail.</span></span>

<span data-ttu-id="82f10-222">Хранение постоянных данных в реестре, например конфигурации пользователя, не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="82f10-222">Storing persistent data in the registry, like a user's configuration, is not recommended.</span></span> <span data-ttu-id="82f10-223">Предпочтительным способом хранения постоянных данных из игры является запись данных в файловую систему путем вызова [**шжетфолдерпас**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) и получения значения константы CSid, описанной в предыдущем разделе.</span><span class="sxs-lookup"><span data-stu-id="82f10-223">The preferred method of storing persistent data from your game is to write the data to the file system by calling [**SHGetFolderPath**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) and to get the value of a CSIDL constant, described in the previous section.</span></span>

## <a name="privilege-elevation"></a><span data-ttu-id="82f10-224">Повышение привилегий</span><span class="sxs-lookup"><span data-stu-id="82f10-224">Privilege Elevation</span></span>

<span data-ttu-id="82f10-225">В Windows Vista любое приложение, требующее прав администратора, должно объявлять запрос на уровне администрирования в своем манифесте (как описано в следующем разделе [Установка уровня выполнения в манифесте приложения](#setting-the-execution-level-in-the-application-manifest)).</span><span class="sxs-lookup"><span data-stu-id="82f10-225">In Windows Vista, any application that requires administrative privileges must declare a request for an administrative execution level in its manifest (described in the next section, [Setting the Execution Level in the Application Manifest](#setting-the-execution-level-in-the-application-manifest)).</span></span>

<span data-ttu-id="82f10-226">Повышение уровня, как известно, — это процедура, управляемая функцией UAC для продвижения процесса к административному процессу.</span><span class="sxs-lookup"><span data-stu-id="82f10-226">Elevation, as it is known, is the procedure driven by UAC to promote a process to an administrative process.</span></span> <span data-ttu-id="82f10-227">Привилегии процесса могут повышаться только во время создания.</span><span class="sxs-lookup"><span data-stu-id="82f10-227">The privileges of a process can only be elevated at creation time.</span></span> <span data-ttu-id="82f10-228">После создания процесс никогда не будет повышен до более высокого уровня привилегий.</span><span class="sxs-lookup"><span data-stu-id="82f10-228">Once created, a process will never be promoted to a higher privilege level.</span></span> <span data-ttu-id="82f10-229">По этой причине.</span><span class="sxs-lookup"><span data-stu-id="82f10-229">For this reason.</span></span> <span data-ttu-id="82f10-230">операции, требующие административных учетных данных, должны быть изолированы от отдельных установщиков и других вспомогательных программ.</span><span class="sxs-lookup"><span data-stu-id="82f10-230">operations that require administrative credentials should be isolated to separate installers and other auxiliary programs.</span></span>

<span data-ttu-id="82f10-231">При выполнении программы UAC проверяет запрошенный уровень выполнения в манифесте и, если требуются повышенные привилегии, запрашивает у текущего пользователя одно из двух стандартных диалоговых окон: одно для обычного пользователя и другое для администратора.</span><span class="sxs-lookup"><span data-stu-id="82f10-231">Upon execution of a program, UAC inspects the requested execution level in the manifest, and if elevated privileges are required, prompts the current user with one of two standard dialog boxes: one for a standard user and one for an administrator.</span></span>

<span data-ttu-id="82f10-232">Если текущий пользователь является обычным пользователем, UAC запрашивает у пользователя учетные данные администратора, прежде чем разрешить выполнение программы.</span><span class="sxs-lookup"><span data-stu-id="82f10-232">If the current user is a standard user, UAC prompts the user for the credentials of an administrator before allowing the program to run.</span></span>

<span data-ttu-id="82f10-233">**Рис. 1. Запрос стандартного пользователя на ввод учетных данных для учетной записи администратора**</span><span class="sxs-lookup"><span data-stu-id="82f10-233">**Figure 1. Prompt for a Standard User to enter credentials for an administrative account**</span></span>

![запрос стандартного пользователя на ввод учетных данных для учетной записи администратора](images/uac-prompt-elevation.jpg)

<span data-ttu-id="82f10-235">Если текущий пользователь является администратором, функция UAC запрашивает у пользователя разрешение, прежде чем разрешить выполнение программы.</span><span class="sxs-lookup"><span data-stu-id="82f10-235">If the current user is an administrator, UAC prompts the user for permission before allowing the program to run.</span></span>

<span data-ttu-id="82f10-236">**Рис. 2. Запрос администратора на авторизацию изменений на компьютере**</span><span class="sxs-lookup"><span data-stu-id="82f10-236">**Figure 2. Prompt for an Administrator to authorize changes to the computer**</span></span>

![запрос администратора на авторизацию изменений на компьютере](images/uac-prompt-authorization.jpg)

<span data-ttu-id="82f10-238">Приложению предоставляются права администратора, только если стандартный пользователь предоставил правильные учетные данные администратора или пользователь с правами администратора предоставит подтверждение. что-то еще приведет к завершению работы приложения.</span><span class="sxs-lookup"><span data-stu-id="82f10-238">The application will only be granted administrative privileges if a standard user provides the proper administrative credentials or an administrative user provides acknowledgement; anything else will cause the application to terminate.</span></span>

<span data-ttu-id="82f10-239">Важно отметить, что процесс с повышенными привилегиями выполняется от имени пользователя с правами администратора, который вводит учетные данные в запрос UAC, а не в качестве стандартного пользователя, выполнившего вход в систему.</span><span class="sxs-lookup"><span data-stu-id="82f10-239">It is important to note that a process with elevated privileges runs as the administrative user who entered credentials in the UAC prompt rather than as the standard user who is currently logged in.</span></span> <span data-ttu-id="82f10-240">Это аналогично **запуску программы runas** в Windows XP. процесс с повышенными правами получает доступ к папке и разделам реестра администратора при обращении к данным для каждого пользователя, а все программы, запускаемые процессом с повышенными правами, также наследуют права администратора и расположения учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="82f10-240">This is similar to **RunAs** in Windows XP   the elevated process gets the administrator's folder and registry keys when accessing per-user data, and all programs that the elevated process launches also inherit both the administrative rights and user account locations.</span></span> <span data-ttu-id="82f10-241">Для администраторов, которые запрашивают подтверждение ( "продолжить **" или "Отмена"**), эти расположения будут соответствовать расположениям текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="82f10-241">For administrators who are prompted for acknowledgement (**Continue** or **Cancel**), these locations will match the currently user's locations.</span></span> <span data-ttu-id="82f10-242">Однако в общем случае процессы, требующие повышения прав, не должны обрабатывать данные для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="82f10-242">In general, however, processes that require elevation should not operate on per-user data.</span></span> <span data-ttu-id="82f10-243">Обратите внимание, что это может существенно повлиять на работу установщика.</span><span class="sxs-lookup"><span data-stu-id="82f10-243">Note that this can substantially affect how your installer must operate!</span></span> <span data-ttu-id="82f10-244">Если установщик, работающий от имени администратора, записывает данные в HKCU или профиль пользователя, он может быть очень хорошо записан в неправильное расположение.</span><span class="sxs-lookup"><span data-stu-id="82f10-244">If the installer, running as an administrator, writes to HKCU or to a user's profile, it may very well be writing to the wrong location.</span></span> <span data-ttu-id="82f10-245">Рассмотрите возможность создания этих значений для каждого пользователя при первом запуске игры.</span><span class="sxs-lookup"><span data-stu-id="82f10-245">Consider creating these per-user values upon the first run of the game.</span></span>

## <a name="uac-implications-with-createprocess"></a><span data-ttu-id="82f10-246">Влияние контроля учетных записей на функцию CreateProcess ()</span><span class="sxs-lookup"><span data-stu-id="82f10-246">UAC Implications with CreateProcess()</span></span>

<span data-ttu-id="82f10-247">Механизм повышения прав UAC не будет вызываться из вызова функции Win32 [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa)() для запуска исполняемого файла, который настроен так, чтобы требовать более высокий уровень выполнения по сравнению с текущим процессом.</span><span class="sxs-lookup"><span data-stu-id="82f10-247">The UAC elevation mechanism will not be invoked from a call to the Win32 [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa)() function to start an executable which is configured to require a higher execution level than the current process.</span></span> <span data-ttu-id="82f10-248">В результате вызов функции **CreateProcess**() завершится с ошибкой [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror)(), возвращающей повышение погрешности \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="82f10-248">As a result, the call to **CreateProcess**() will fail with [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror)() returning ERROR\_ELEVATION\_REQUIRED.</span></span> <span data-ttu-id="82f10-249">Процедура **CreateProcess**() будет выполнена только в том случае, если уровень выполнения вызываемого объекта равен или меньше значения вызывающего объекта.</span><span class="sxs-lookup"><span data-stu-id="82f10-249">**CreateProcess**() will only succeed when the execution level of the callee is equal-to or less-than that of the caller.</span></span> <span data-ttu-id="82f10-250">Процесс без повышения прав, который должен порождать процессы с повышенными правами, должен сделать это с помощью функции [**ShellExecute**](/windows/win32/api/shellapi/nf-shellapi-shellexecutea)(), которая приведет к активации механизма повышения прав UAC с помощью оболочки.</span><span class="sxs-lookup"><span data-stu-id="82f10-250">A non-elevated process that must spawn elevated processes should do so using the [**ShellExecute**](/windows/win32/api/shellapi/nf-shellapi-shellexecutea)() function, which will cause the UAC elevation mechanism to be triggered by means of the shell.</span></span>

## <a name="setting-the-execution-level-in-the-application-manifest"></a><span data-ttu-id="82f10-251">Задание уровня выполнения в манифесте приложения</span><span class="sxs-lookup"><span data-stu-id="82f10-251">Setting the Execution Level in the Application Manifest</span></span>

<span data-ttu-id="82f10-252">Вы объявили запрошенный уровень выполнения игры, добавив расширение в манифест приложения.</span><span class="sxs-lookup"><span data-stu-id="82f10-252">You declare the requested execution level of your game by adding an extension to the application s manifest.</span></span> <span data-ttu-id="82f10-253">В следующем коде XML показана минимальная конфигурация, необходимая для установки уровня выполнения для приложения.</span><span class="sxs-lookup"><span data-stu-id="82f10-253">The following XML code shows the minimal configuration required to set the execution level for an application:</span></span>

``` syntax
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
    <ms_asmv2:trustInfo xmlns:ms_asmv2="urn:schemas-microsoft-com:asm.v2">
        <ms_asmv2:security>
            <ms_asmv2:requestedPrivileges>
                <ms_asmv2:requestedExecutionLevel level="asInvoker" uiAccess="false" />
            </ms_asmv2:requestedPrivileges>
        </ms_asmv2:security>
    </ms_asmv2:trustInfo>
</assembly>
```

<span data-ttu-id="82f10-254">В приведенном выше коде операционная система сообщила, что для игры требуются права обычного пользователя только по следующему тегу:</span><span class="sxs-lookup"><span data-stu-id="82f10-254">In the preceding code, the operating system is informed that the game only requires standard user privileges by the following tag:</span></span>

``` syntax
<ms_asmv2:requestedExecutionLevel level="asInvoker" uiAccess="false" />
```

<span data-ttu-id="82f10-255">При явном задании requestedExecutionLevel в значение "asInvoker" Этот пример утверждает операционной системе, что игра будет работать нормально без прав администратора.</span><span class="sxs-lookup"><span data-stu-id="82f10-255">By explicitly setting requestedExecutionLevel to "asInvoker", this example asserts to the operating system that the game will behave properly without administrative privileges.</span></span> <span data-ttu-id="82f10-256">В результате UAC отключает виртуализацию и запускает игру с теми же привилегиями, что и вызывающий объект, который обычно имеет привилегии обычного пользователя, так как проводник Windows запускается от имени обычного пользователя.</span><span class="sxs-lookup"><span data-stu-id="82f10-256">As a result, UAC disables virtualization and runs the game with the same privileges as the invoker   which is typically standard user privileges, since Windows Explorer runs as standard user.</span></span>

<span data-ttu-id="82f10-257">Чтобы получить доступ к операционной системе, необходимо повысить уровень прав администратора, заменив "asInvoker" на "requireAdministrator", чтобы создать следующий тег:</span><span class="sxs-lookup"><span data-stu-id="82f10-257">The operating system can be informed a game requires elevation to administrative privileges by replacing "asInvoker" with "requireAdministrator", to create the following tag:</span></span>

``` syntax
<ms_asmv2:requestedExecutionLevel level="requireAdministrator" uiAccess="false" />
```

<span data-ttu-id="82f10-258">При такой конфигурации операционная система запрашивает у текущего пользователя одно из стандартных диалоговых окон по повышению прав UAC при каждом запуске игры.</span><span class="sxs-lookup"><span data-stu-id="82f10-258">With this configuration, the operating system prompts the current user with one of the standard UAC elevation dialogs every time that the game is executed.</span></span> <span data-ttu-id="82f10-259">Настоятельно рекомендуется, чтобы ни одна игра не запускала права администратора, поскольку это диалоговое окно не будет работать быстро, но оно также сделает игру несовместимой с родительскими элементами управления.</span><span class="sxs-lookup"><span data-stu-id="82f10-259">It is highly recommended that no game require administrator privileges to run, because not only will this dialog quickly become annoying, but it also makes the game incompatible with parental controls.</span></span> <span data-ttu-id="82f10-260">Перед добавлением этого требования в любой исполняемый файл тщательно продумайте.</span><span class="sxs-lookup"><span data-stu-id="82f10-260">Think very carefully before adding this requirement to any executable.</span></span>

<span data-ttu-id="82f10-261">Распространенное заблуждение заключается в том, что добавление манифеста, устанавливающего requestedExecutionLevel в значение «requireAdministrator», обходит необходимость в запросе на повышение прав.</span><span class="sxs-lookup"><span data-stu-id="82f10-261">A common misconception is that adding a manifest that sets requestedExecutionLevel to "requireAdministrator" bypasses the need for an elevation prompt.</span></span> <span data-ttu-id="82f10-262">Это не так.</span><span class="sxs-lookup"><span data-stu-id="82f10-262">This is not true.</span></span> <span data-ttu-id="82f10-263">Это просто не потребует от операционной системы угадать, требуются ли для установки или обновления приложения права администратора.</span><span class="sxs-lookup"><span data-stu-id="82f10-263">It simply prevents the operating system from guessing whether your setup or update application needs administrative privileges.</span></span> <span data-ttu-id="82f10-264">Пользователю по-прежнему предлагается авторизовать повышение прав.</span><span class="sxs-lookup"><span data-stu-id="82f10-264">The user is still prompted to authorize elevation.</span></span>

<span data-ttu-id="82f10-265">Windows проверяет подпись любого приложения, помеченного на повышение прав, перед отображением запроса контроля учетных записей.</span><span class="sxs-lookup"><span data-stu-id="82f10-265">Windows checks the signature of any application that is marked for elevation before it displays the UAC prompt.</span></span> <span data-ttu-id="82f10-266">Большой исполняемый файл, помеченный для повышения прав, занимает больше времени, чем небольшой исполняемый файл, и дольше, чем исполняемый файл, помеченный как "asInvoker".</span><span class="sxs-lookup"><span data-stu-id="82f10-266">A large executable that is marked for elevation takes longer to check than a small executable and longer than an executable that is marked as "asInvoker".</span></span> <span data-ttu-id="82f10-267">Исполняемые файлы программы установки, которые являются самораскрывающимися, должны быть помечены как «asInvoker», а все части, которые необходимо пометить как «requireAdministrator», должны быть помещены в отдельный вспомогательный исполняемый файл.</span><span class="sxs-lookup"><span data-stu-id="82f10-267">Setup executables that are self-extracting should, therefore, be marked as "asInvoker", and any portion that needs to be marked as "requireAdministrator" should be placed in a separate helper executable.</span></span>

<span data-ttu-id="82f10-268">Атрибут uiAccess, показанный в предыдущих примерах, должен всегда иметь значение FALSE для игр.</span><span class="sxs-lookup"><span data-stu-id="82f10-268">The uiAccess attribute, shown in the preceding examples, should always be FALSE for games.</span></span> <span data-ttu-id="82f10-269">Этот атрибут указывает, имеют ли клиенты автоматизации пользовательского интерфейса доступ к защищенному системному ИНТЕРФЕЙСу, и имеют особые последствия безопасности, если задано значение TRUE.</span><span class="sxs-lookup"><span data-stu-id="82f10-269">This attribute specifies whether UI automation clients have access to the protected system UI, and it has special security implications if set to TRUE.</span></span>

## <a name="embedding-a-manifest-in-visual-studio"></a><span data-ttu-id="82f10-270">Встраивание манифеста в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="82f10-270">Embedding a Manifest in Visual Studio</span></span>

<span data-ttu-id="82f10-271">Поддержка манифеста была впервые добавлена в Visual Studio, начиная с VS2005.</span><span class="sxs-lookup"><span data-stu-id="82f10-271">Manifest support was first added to Visual Studio beginning in VS2005.</span></span> <span data-ttu-id="82f10-272">По умолчанию исполняемый файл, встроенный в Visual Studio 2005 (или более поздней версии), будет иметь автоматически созданный манифест, внедренный в состав процесса сборки.</span><span class="sxs-lookup"><span data-stu-id="82f10-272">By default, an executable built in Visual Studio 2005 (or newer) will have an auto-generated manifest embedded in it as part of the build process.</span></span> <span data-ttu-id="82f10-273">Содержимое автоматически созданного манифеста зависит от определенных конфигураций проекта, указанных в диалоговом окне Свойства проекта.</span><span class="sxs-lookup"><span data-stu-id="82f10-273">The contents of the auto-generated manifest are dependent on certain project configurations that you specify in the project properties dialog.</span></span>

<span data-ttu-id="82f10-274">Манифест, автоматически формируемый Visual Studio 2005, не будет содержать <trustInfo> блок, так как не существует способа настройки уровня выполнения UAC в свойствах проекта.</span><span class="sxs-lookup"><span data-stu-id="82f10-274">The manifest that is auto-generated by Visual Studio 2005 will not contain a <trustInfo> block as there is no way to configure the UAC execution level in the project properties.</span></span> <span data-ttu-id="82f10-275">Предпочтительный способ добавления этих сведений — позволить VS2005 объединить определяемый пользователем манифест, содержащий <trustInfo> блок, с автоматически созданным манифестом.</span><span class="sxs-lookup"><span data-stu-id="82f10-275">The preferred way to add this information is to let VS2005 merge a user-defined manifest containing the <trustInfo> block with the auto-generated manifest.</span></span> <span data-ttu-id="82f10-276">Это так же просто, как добавить в \* решение файл. manifest, содержащий XML-код, указанный в предыдущем разделе.</span><span class="sxs-lookup"><span data-stu-id="82f10-276">This is as simple as adding a \*.manifest file to your solution that contains the XML listed in the previous section.</span></span> <span data-ttu-id="82f10-277">Когда Visual Studio встречает в решении файл. manifest, он автоматически вызывает средство манифеста (mt.exe) для слияния файлов. manifest с автоматически созданным.</span><span class="sxs-lookup"><span data-stu-id="82f10-277">When Visual Studio encounters a .manifest file in your solution, it will automatically invoke the Manifest Tool (mt.exe) to merge the .manifest files with the auto-generated one.</span></span>

> [!Note]  
> <span data-ttu-id="82f10-278">В средстве манифеста (mt.exe), предоставляемом Visual Studio 2005, есть ошибка, которая приводит к созданию объединенного и внедренного манифеста, что может вызвать проблемы при запуске исполняемого файла в Windows XP до SP3.</span><span class="sxs-lookup"><span data-stu-id="82f10-278">There is a bug in the Manifest Tool (mt.exe) provided by Visual Studio 2005 that results in a merged and embedded manifest which can cause problems when the executable is run on Windows XP prior to SP3.</span></span> <span data-ttu-id="82f10-279">Ошибка является следствием того, как средство переопределяет пространство имен по умолчанию при объявлении <trustInfo> блока.</span><span class="sxs-lookup"><span data-stu-id="82f10-279">The bug is a result of how the tool redefines the default namespace upon declaration of the <trustInfo> block.</span></span> <span data-ttu-id="82f10-280">К счастью, можно легко обойти проблему, явно объявляя другое пространство имен в <trustInfo> блоке и выполнив области дочернего узла до нового пространства имен.</span><span class="sxs-lookup"><span data-stu-id="82f10-280">Fortunately, it is easy to bypass the issue entirely by explicitly declaring a different namespace in the <trustInfo> block and by scoping the child nodes to the new namespace.</span></span> <span data-ttu-id="82f10-281">Это исправление показано в XML-коде, приведенном в предыдущем разделе.</span><span class="sxs-lookup"><span data-stu-id="82f10-281">The XML provided in the previous section demonstrates this fix.</span></span>

 

<span data-ttu-id="82f10-282">Предупреждение об использовании средства mt.exe, включенного в Visual Studio 2005, заключается в том, что при обработке блока будет выдаваться предупреждения, <trustInfo> так как средство не содержит обновленную схему для проверки XML.</span><span class="sxs-lookup"><span data-stu-id="82f10-282">A caveat in using the mt.exe tool included in Visual Studio 2005 is that it will generate a warning when processing the <trustInfo> block as the tool does not contain an updated schema to validate the XML against.</span></span> <span data-ttu-id="82f10-283">Чтобы устранить это предупреждение, рекомендуется заменить все файлы mt.exe в каталоге установки Visual Studio 2005 (существует несколько экземпляров) с mt.exe, указанным в последней Windows SDK.</span><span class="sxs-lookup"><span data-stu-id="82f10-283">To remedy this warning, it is recommended that you replace all mt.exe files under the Visual Studio 2005 install directory (there are multiple instances) with the mt.exe provided in the latest Windows SDK.</span></span>

<span data-ttu-id="82f10-284">Начиная с Visual Studio 2008, теперь можно указать уровень выполнения приложения в диалоговом окне свойств проекта (рис. 3) или с помощью флага компоновщика/MANIFESTUAC.</span><span class="sxs-lookup"><span data-stu-id="82f10-284">Beginning in Visual Studio 2008, you can now specify an application's execution level from within the project properties dialog (Figure 3), or by using the /MANIFESTUAC linker flag.</span></span> <span data-ttu-id="82f10-285">Установка этих параметров приведет к тому, что Visual Studio 2008 автоматически создаст и внедряет манифест с соответствующим <trustInfo> блоком в исполняемый файл.</span><span class="sxs-lookup"><span data-stu-id="82f10-285">Setting these options will cause Visual Studio 2008 to auto-generate and embed a manifest with the appropriate <trustInfo> block into the executable.</span></span>

<span data-ttu-id="82f10-286">**Рис. 3. Настройка уровня выполнения в Visual Studio 2008**</span><span class="sxs-lookup"><span data-stu-id="82f10-286">**Figure 3. Setting the execution level in Visual Studio 2008**</span></span>

![Настройка уровня выполнения в Visual Studio 2008](images/setting-execution-level-in-vs2008.jpg)

<span data-ttu-id="82f10-288">Внедрение манифеста в более ранние версии Visual Studio без поддержки манифеста по-прежнему возможно, но требует больше работы от разработчика.</span><span class="sxs-lookup"><span data-stu-id="82f10-288">Embedding a manifest in older versions of Visual Studio without manifest support is still possible, but does require more work from the developer.</span></span> <span data-ttu-id="82f10-289">Пример того, как это сделать, см. в проекте Visual Studio 2003, включенном в любой пример в пакете SDK DirectX, до выпуска версии за Март 2008.</span><span class="sxs-lookup"><span data-stu-id="82f10-289">For an example on how to do this, please examine the Visual Studio 2003 project included in any sample in the DirectX SDK prior to the March 2008 release.</span></span>

## <a name="uac-compatibility-with-older-games"></a><span data-ttu-id="82f10-290">Совместимость UAC с более старыми играми</span><span class="sxs-lookup"><span data-stu-id="82f10-290">UAC Compatibility with Older Games</span></span>

<span data-ttu-id="82f10-291">Если в игре предполагается, что файл успешно сохраняется и загружается в каталог Program Files, но не свидетельствует о том, что в его манифесте есть 32-разрядное приложение, которое не содержит запрошенный уровень выполнения, то оно считается устаревшим.</span><span class="sxs-lookup"><span data-stu-id="82f10-291">If your game appears to be saving and loading a file successfully to the Program Files directory, yet no evidence of the file iOn Windows Vista, any 32-bit application that does not contain a requested execution level in its manifest is considered a legacy application.</span></span> <span data-ttu-id="82f10-292">До Windows Vista большинство приложений обычно выполнялись пользователями с правами администратора.</span><span class="sxs-lookup"><span data-stu-id="82f10-292">Prior to Windows Vista, most applications were typically run by users with administrative privileges.</span></span> <span data-ttu-id="82f10-293">В результате эти приложения могут свободно считывать и записывать системные файлы и разделы реестра, и многие разработчики не сделали изменений, необходимых для правильной работы в ограниченных учетных записях пользователей в Windows XP.</span><span class="sxs-lookup"><span data-stu-id="82f10-293">As a result, these applications could freely read and write system files and registry keys, and many developers did not make the changes needed to work properly on Limited User Accounts on Windows XP.</span></span> <span data-ttu-id="82f10-294">Однако в Windows Vista такие же приложения будут завершаться сбоем из-за недостаточных прав доступа в новой модели безопасности, что обеспечивает выполнение стандартного пользователя для устаревших приложений.</span><span class="sxs-lookup"><span data-stu-id="82f10-294">However on Windows Vista, these same applications would now fail due to insufficient access privileges under the new security model, which enforces standard user execution for legacy applications.</span></span> <span data-ttu-id="82f10-295">Чтобы снизить последствия этого, Виртуализация также была добавлена в Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="82f10-295">To mitigate the impact of this, virtualization was also added to Windows Vista.</span></span> <span data-ttu-id="82f10-296">Виртуализация будет поддерживать тысячи устаревших приложений, хорошо работающих в Windows Vista, не требуя, чтобы эти приложения имели более высокий уровень привилегий в любой момент, просто наполняя несколько незначительных операций.</span><span class="sxs-lookup"><span data-stu-id="82f10-296">Virtualization will keep thousands of legacy applications working well on Windows Vista without requiring those applications to have elevated privileges at all times simply to succeed at a few minor operations.</span></span> <span data-ttu-id="82f10-297">, шансы на то, что ваша игра работает в устаревшем режиме и была подвержена виртуализации.</span><span class="sxs-lookup"><span data-stu-id="82f10-297">s found, chances are your game is running in legacy mode and was subjected to virtualization.</span></span>

<span data-ttu-id="82f10-298">Виртуализация влияет на файловую систему и реестр путем перенаправления записей, чувствительных к системе (и последующих операций с файлами и реестрами), к месту на уровне пользователя в профиле текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="82f10-298">Virtualization affects the file system and registry by redirecting system-sensitive writes (and subsequent file or registry operations) to a per-user location within the current user's profile.</span></span> <span data-ttu-id="82f10-299">Например, если приложение пытается выполнить запись в следующий файл:</span><span class="sxs-lookup"><span data-stu-id="82f10-299">For example, if an application attempts to write to the following file:</span></span>

<dl> <span data-ttu-id="82f10-300">C: \\ Program Files название \\ компании \\ \\config.ini</span><span class="sxs-lookup"><span data-stu-id="82f10-300">C:\\Program Files\\Company Name\\Title\\config.ini</span></span>  
</dl>

<span data-ttu-id="82f10-301">запись автоматически перенаправляется в:</span><span class="sxs-lookup"><span data-stu-id="82f10-301">the write is automatically redirected to:</span></span>

<dl> <span data-ttu-id="82f10-302">C: \\ Users \\ имя пользователя \\ AppData \\ Local \\ виртуалсторе \\ Program Files название \\ организации \\ \\config.ini</span><span class="sxs-lookup"><span data-stu-id="82f10-302">C:\\Users\\user name\\AppData\\Local\\VirtualStore\\Program Files\\Company Name\\Title\\config.ini</span></span>  
</dl>

<span data-ttu-id="82f10-303">Аналогично, если приложение пытается записать значение реестра следующим образом:</span><span class="sxs-lookup"><span data-stu-id="82f10-303">Likewise, if an application attempts to write a registry value like the following:</span></span>

<dl> <span data-ttu-id="82f10-304">Название \_ компании hKey по для локального \_ компьютера \\ \\ \\</span><span class="sxs-lookup"><span data-stu-id="82f10-304">HKEY\_LOCAL\_MACHINE\\Software\\Company Name\\Title</span></span>  
</dl>

<span data-ttu-id="82f10-305">Вместо этого он будет перенаправлен на:</span><span class="sxs-lookup"><span data-stu-id="82f10-305">it will be redirected instead to:</span></span>

<dl> <span data-ttu-id="82f10-306">HKEY. \_ текущие \_ пользовательские \\ классы программного обеспечения \\ \\ виртуалсторе \\ машинного \\ программного обеспечения \\ \\ название компании</span><span class="sxs-lookup"><span data-stu-id="82f10-306">HKEY\_CURRENT\_USER\\Software\\Classes\\VirtualStore\\MACHINE\\Software\\Company Name\\Title</span></span>  
</dl>

<span data-ttu-id="82f10-307">Доступ к файлам и разделам реестра, затронутым виртуализации, осуществляется только с помощью операций с файлами и реестрами из виртуализированных приложений, работающих от имени текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="82f10-307">Files and registry keys affected by virtualization are only be accessed by file and registry operations from virtualized applications that are running as the current user.</span></span>

<span data-ttu-id="82f10-308">Однако виртуализация имеет много ограничений.</span><span class="sxs-lookup"><span data-stu-id="82f10-308">However, there are many restrictions to virtualization.</span></span> <span data-ttu-id="82f10-309">Один из них заключается в том, что 64-разрядные приложения никогда не работают в устаревшем режиме для операций совместимости, которые связаны с виртуализацией в 32-разрядных приложениях, в 64-bit.</span><span class="sxs-lookup"><span data-stu-id="82f10-309">One is that 64-bit applications are never run in legacy mode for compatibility   operations subjected to virtualization in 32-bit applications will just fail in 64-bit.</span></span> <span data-ttu-id="82f10-310">Кроме того, если устаревшее приложение, выполняемое в качестве стандартного пользователя, пытается записать любой тип исполняемого файла в расположение, для которого требуются учетные данные администратора, виртуализация не будет выполняться и запись завершится ошибкой.</span><span class="sxs-lookup"><span data-stu-id="82f10-310">Also if a legacy application running as a standard user tries to write any type of executable file to a location that requires administrative credentials, then virtualization will not occur and the write will fail.</span></span>

<span data-ttu-id="82f10-311">**Рис. 4. Процесс виртуализации**</span><span class="sxs-lookup"><span data-stu-id="82f10-311">**Figure 4. Virtualization Process**</span></span>

![процесс виртуализации](images/uac-virtualization-process.jpg)

<span data-ttu-id="82f10-313">Когда устаревшее приложение пытается выполнить операцию чтения с учетом системных расположений в файловой системе или реестре, сначала выполняется поиск в виртуальных расположениях.</span><span class="sxs-lookup"><span data-stu-id="82f10-313">When a legacy application attempts a read operation on system-sensitive locations in the file system or registry, the virtual locations are searched first.</span></span> <span data-ttu-id="82f10-314">Если файл или раздел реестра не найден, операционная система обращается к системным расположениям по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="82f10-314">If the file or registry key is not found, then the operating system accesses the default system locations.</span></span>

<span data-ttu-id="82f10-315">Виртуализация будет удалена из последующих версий Windows, поэтому важно не полагаться на эту функцию.</span><span class="sxs-lookup"><span data-stu-id="82f10-315">Virtualization will be removed from subsequent versions of Windows so it important not to rely on this feature.</span></span> <span data-ttu-id="82f10-316">Вместо этого следует явно настроить манифест приложения для стандартных привилегий пользователя или администратора, так как это приведет к отключению виртуализации.</span><span class="sxs-lookup"><span data-stu-id="82f10-316">Instead, you should explicitly configure your application manifest for either standard user or administrative privileges, as this will disable virtualization.</span></span> <span data-ttu-id="82f10-317">Виртуализация также не очевидна для конечных пользователей, поэтому, несмотря на то, что виртуализация может позволить приложению работать, он может создавать вызовы поддержки и затруднять проблемы для этих клиентов.</span><span class="sxs-lookup"><span data-stu-id="82f10-317">Virtualization is also not obvious to end users, so even though virtualization may allow your application to run, it can generate support calls and make it difficult to trouble-shoot for these customers.</span></span>

<span data-ttu-id="82f10-318">Обратите внимание, что если контроль учетных записей отключен, Виртуализация также отключается.</span><span class="sxs-lookup"><span data-stu-id="82f10-318">Note that if UAC is disabled, then virtualization is also disabled.</span></span> <span data-ttu-id="82f10-319">Если виртуализация отключена, учетные записи обычных пользователей ведут себя как ограниченные учетные записи пользователей в Windows XP, а устаревшие приложения могут работать неправильно для обычных пользователей, которые в противном случае были бы успешно выполнены из-за виртуализации.</span><span class="sxs-lookup"><span data-stu-id="82f10-319">If virtualization is disabled, standard user accounts behave exactly like limited user accounts in Windows XP, and legacy applications may not function correctly for standard users that would otherwise have succeeded due to virtualization.</span></span>

## <a name="legacy-scenarios-and-manifests"></a><span data-ttu-id="82f10-320">Устаревшие сценарии и манифесты</span><span class="sxs-lookup"><span data-stu-id="82f10-320">Legacy Scenarios and Manifests</span></span>

<span data-ttu-id="82f10-321">Для большинства сценариев использования просто пометьте exe-файл правильными элементами манифеста UAC и убедитесь, что приложение работает правильно, так как обычный пользователь достаточно для обеспечения совместимости с UAC.</span><span class="sxs-lookup"><span data-stu-id="82f10-321">For the majority of usage scenarios, simply marking the .exe with the correct UAC manifest elements and ensuring the application works correctly as a Standard User is sufficient for excellent UAC compatibility.</span></span> <span data-ttu-id="82f10-322">Большинство игроков работают под управлением Windows Vista или Windows 7 с включенным контролем учетных записей пользователей.</span><span class="sxs-lookup"><span data-stu-id="82f10-322">Most gamers are running Windows Vista or Windows 7 with User Account Control enabled.</span></span> <span data-ttu-id="82f10-323">Для Windows XP и пользователей в Windows Vista или Windows7 с отключенной функцией контроля учетных записей пользователей они обычно запускаются с помощью учетных записей администратора.</span><span class="sxs-lookup"><span data-stu-id="82f10-323">For Windows XP and users on Windows Vista or Windows7 with the User Account Control feature disabled, they typically run using administrator accounts.</span></span> <span data-ttu-id="82f10-324">Хотя это менее безопасный режим работы, он обычно не будет работать с какими-либо дополнительными проблемами совместимости, хотя, как указано выше, отключение UAC также отключает виртуализацию.</span><span class="sxs-lookup"><span data-stu-id="82f10-324">While this is a less secure mode of operation, it will generally not run into any additional compatibility issues although as noted above, disabling UAC disables virtualization as well.</span></span>

<span data-ttu-id="82f10-325">Следует отметить, что в манифесте контроля учетных записей программа помечена как «requireAdministrator».</span><span class="sxs-lookup"><span data-stu-id="82f10-325">There is a special case worth noting when the program is marked as "requireAdministrator" in the UAC manifest.</span></span> <span data-ttu-id="82f10-326">В Windows XP и Windows Vista или Windows 7 с отключенным контролем учетных записей элементы манифеста UAC игнорируются системой.</span><span class="sxs-lookup"><span data-stu-id="82f10-326">On Windows XP and on Windows Vista or Windows 7 with User Account Control disabled, the UAC manifest elements are ignored by the system.</span></span> <span data-ttu-id="82f10-327">В этом случае пользователи с учетными записями администратора всегда будут запускать все программы с полными правами администратора, поэтому эти программы будут работать должным образом.</span><span class="sxs-lookup"><span data-stu-id="82f10-327">In this situation, users with administrator accounts will always run all programs with full administrator rights, and thus these programs will function as expected.</span></span> <span data-ttu-id="82f10-328">В Windows XP ограниченные пользователи и обычные пользователи, работающие в Windows Vista или Windows 7, всегда будут запускать эти программы с ограниченными правами, а все операции уровня администратора завершатся неудачей.</span><span class="sxs-lookup"><span data-stu-id="82f10-328">Windows XP Restricted Users and Standard Users running on Windows Vista or Windows 7, however, will always run these programs with restricted rights and all administrator-level operations will fail.</span></span> <span data-ttu-id="82f10-329">Поэтому рекомендуется, чтобы программы, помеченные как «Рекуиретадминистратор», вызывали [**исусеранадмин**](/windows/win32/api/shlobj_core/nf-shlobj_core-isuseranadmin) при запуске и отображали неустранимую ошибку, если она возвращает значение false.</span><span class="sxs-lookup"><span data-stu-id="82f10-329">It is therefore recommended that programs marked as "requiretAdministrator" call [**IsUserAnAdmin**](/windows/win32/api/shlobj_core/nf-shlobj_core-isuseranadmin) on startup, and display a fatal error message if it returns FALSE.</span></span> <span data-ttu-id="82f10-330">Для сценария большинства, описанного выше, это всегда будет удачно, но обеспечивает лучшую работу пользователя и четкое сообщение об ошибке в этой редкий ситуации.</span><span class="sxs-lookup"><span data-stu-id="82f10-330">For the majority scenario above, this will always succeed, but provides a better user experience and a clear error message for this rare situation.</span></span>

## <a name="conclusion"></a><span data-ttu-id="82f10-331">Заключение</span><span class="sxs-lookup"><span data-stu-id="82f10-331">Conclusion</span></span>

<span data-ttu-id="82f10-332">Как разработчик игры, предназначенный для многопользовательской среды Windows, крайне важно, чтобы ваша игра работала эффективно и в соответствии с этим.</span><span class="sxs-lookup"><span data-stu-id="82f10-332">As a game developer targeting the Windows multi-user environment, it is imperative that you design your game to operate effectively and responsibly.</span></span> <span data-ttu-id="82f10-333">Основной исполняемый файл игры не должен зависеть от прав администратора.</span><span class="sxs-lookup"><span data-stu-id="82f10-333">Your game's main executable file should not be dependent on administrative privileges.</span></span> <span data-ttu-id="82f10-334">Это не только предотвращает появление запросов на повышение прав при каждом запуске игры, что может негативно повлиять на работу пользователей, но также позволяет вашей игре использовать преимущества других функций, требующих выполнения обычных пользовательских привилегий, таких как родительские элементы управления.</span><span class="sxs-lookup"><span data-stu-id="82f10-334">This not only prevents the appearance of prompts for elevation every time that your game is run   which can negatively impact the overall user experience   but it also enables your game to take advantage of other features that require execution with standard user privileges, such as Parental Controls.</span></span>

<span data-ttu-id="82f10-335">Для приложений, которые правильно спроектированы для работы с учетными данными обычного пользователя (или ограниченного пользователя) в предыдущих версиях Windows, UAC не будет влиять на работу без повышения прав.</span><span class="sxs-lookup"><span data-stu-id="82f10-335">Applications that are properly designed to operate as with the credentials of a standard user (or limited user) under previous versions of Windows will not be impacted by UAC   they will run without elevation.</span></span> <span data-ttu-id="82f10-336">Однако они должны включать манифест с требуемым уровнем выполнения, равным "asInvoker", для соответствия стандартам приложения для Vista.</span><span class="sxs-lookup"><span data-stu-id="82f10-336">However, they should include a manifest with their requested execution level set to "asInvoker" to conform to application standards for Vista.</span></span>

## <a name="further-reading"></a><span data-ttu-id="82f10-337">Дополнительные материалы</span><span class="sxs-lookup"><span data-stu-id="82f10-337">Further Reading</span></span>

<span data-ttu-id="82f10-338">Чтобы получить помощь в проектировании приложений для Windows Vista, совместимых с контролем учетных записей, загрузите следующий технический документ: [требования к разработке приложений Windows Vista для обеспечения совместимости управления учетными записями пользователей](/previous-versions/dotnet/articles/bb530410(v=msdn.10)).</span><span class="sxs-lookup"><span data-stu-id="82f10-338">For assistance with designing applications for Windows Vista that are compliant with User Account Control, download the following white paper: [Windows Vista Application Development Requirements for User Account Control Compatibility](/previous-versions/dotnet/articles/bb530410(v=msdn.10)).</span></span>

<span data-ttu-id="82f10-339">Этот технический документ содержит подробные инструкции по проектированию, а также примеры кода, требования и рекомендации.</span><span class="sxs-lookup"><span data-stu-id="82f10-339">This white paper provides detailed steps about the design process, along with code samples, requirements, and best practices.</span></span> <span data-ttu-id="82f10-340">В этой статье также подробно описаны технические обновления и изменения в работе пользователей в Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="82f10-340">This paper also details the technical updates and changes to the user experience in Windows Vista.</span></span>

<span data-ttu-id="82f10-341">Дополнительные сведения об управлении учетными записями пользователей см. в статье [Windows Vista: Управление учетными записями пользователей](https://www.microsoft.com/technet/windowsvista/security/uac.mspx) в [Microsoft TechNet](https://www.microsoft.com/technet/).</span><span class="sxs-lookup"><span data-stu-id="82f10-341">For more information about User Account Control, visit [Windows Vista: User Account Control](https://www.microsoft.com/technet/windowsvista/security/uac.mspx) on [Microsoft TechNet](https://www.microsoft.com/technet/).</span></span>

<span data-ttu-id="82f10-342">Еще один полезный ресурс — это статья о том, [как с помощью управления учетными записями пользователей Windows Vista лучше воспроизводить свои приложения](/archive/msdn-magazine/2007/january/teach-your-apps-to-work-with-windows-vista-user-account-control), из [журнала MSDN Magazine](/archive/msdn-magazine/msdn-magazine-issues), 2007 января.</span><span class="sxs-lookup"><span data-stu-id="82f10-342">Another useful resource is the article [Teach Your Apps To Play Nicely with Windows Vista User Account Control](/archive/msdn-magazine/2007/january/teach-your-apps-to-work-with-windows-vista-user-account-control), from [MSDN Magazine](/archive/msdn-magazine/msdn-magazine-issues), January 2007.</span></span> <span data-ttu-id="82f10-343">В этой статье рассматриваются общие вопросы совместимости приложений, а также преимущества и проблемы использования пакетов установщик Windows в Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="82f10-343">This article discusses general issues of application compatibility, as well as the advantages and issues of using Windows Installer packages on Windows Vista.</span></span>

<span data-ttu-id="82f10-344">Дополнительные сведения об ошибке и исправлении для mt.exe, средство, используемое Visual Studio 2005 для автоматического слияния и внедрения манифеста в исполняемый файл, см. [в разделе Обзор манифестов, часть 2. пространства имен по умолчанию и манифесты UAC в Windows Vista](https://techcommunity.microsoft.com/t5/Windows-Blog-Archive/bg-p/Windows-Blog-Archive/2006/09/08/exploring-manifests-part-2-default-namespaces-and-uac-manifests-in-windows-vista/) в блоге Крис Jackson на [сайте MSDN](/archive/blogs/).</span><span class="sxs-lookup"><span data-stu-id="82f10-344">For more information about the bug and the fix for mt.exe, the tool used by Visual Studio 2005 to automatically merge and embed a manifest into an executable, see [Exploring Manifests Part 2: Default Namespaces and UAC Manifests in Windows Vista](https://techcommunity.microsoft.com/t5/Windows-Blog-Archive/bg-p/Windows-Blog-Archive/2006/09/08/exploring-manifests-part-2-default-namespaces-and-uac-manifests-in-windows-vista/) on Chris Jackson's blog on [MSDN](/archive/blogs/).</span></span>

 

