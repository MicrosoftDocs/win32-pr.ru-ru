---
title: Игры с Least-Privileged учетными записями пользователей
description: В этой статье описывается, как разработчики игр могут создавать игры Microsoft Windows, которые хорошо работают с учетными записями пользователей с минимальными правами доступа (также известными как учетные записи с ограниченным доступом пользователей).
ms.assetid: 1b7cc3c9-b180-14b1-53c8-57f9e545d009
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d4c44d94345462fc02ec649c5674ed88c38c12ee
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104487997"
---
# <a name="gaming-with-least-privileged-user-accounts"></a><span data-ttu-id="a8391-103">Игры с Least-Privileged учетными записями пользователей</span><span class="sxs-lookup"><span data-stu-id="a8391-103">Gaming with Least-Privileged User Accounts</span></span>

<span data-ttu-id="a8391-104">В этой статье описывается, как разработчики игр могут создавать игры Microsoft Windows, которые хорошо работают с учетными записями пользователей с минимальными правами доступа (также известными как учетные записи с ограниченным доступом пользователей).</span><span class="sxs-lookup"><span data-stu-id="a8391-104">This article describes how games developers can author Microsoft Windows games that work well with least-privileged user accounts (also known as limited-user accounts).</span></span>

-   [<span data-ttu-id="a8391-105">Введение</span><span class="sxs-lookup"><span data-stu-id="a8391-105">Introduction</span></span>](#introduction)
-   [<span data-ttu-id="a8391-106">Доступ к файлам для учетных записей пользователей Least-Privileged</span><span class="sxs-lookup"><span data-stu-id="a8391-106">File Access for Least-Privileged User Accounts</span></span>](#file-access-for-least-privileged-user-accounts)
    -   [<span data-ttu-id="a8391-107">Сценарий 1. файлы, которые не нужно просматривать или изменять пользователями</span><span class="sxs-lookup"><span data-stu-id="a8391-107">Scenario 1: Files that do not need to be viewed or altered by users</span></span>](#scenario-1-files-that-do-not-need-to-be-viewed-or-altered-by-users)
    -   [<span data-ttu-id="a8391-108">Сценарий 2. файлы, которые должны быть просмотрены или изменены пользователями</span><span class="sxs-lookup"><span data-stu-id="a8391-108">Scenario 2: Files that need to be viewed or altered by users</span></span>](#scenario-2-files-that-need-to-be-viewed-or-altered-by-users)
-   [<span data-ttu-id="a8391-109">Доступ к реестру для учетных записей пользователей Least-Privileged</span><span class="sxs-lookup"><span data-stu-id="a8391-109">Registry Access for Least-Privileged User Accounts</span></span>](#registry-access-for-least-privileged-user-accounts)
-   [<span data-ttu-id="a8391-110">Установка исправлений с учетными записями пользователей Least-Privileged</span><span class="sxs-lookup"><span data-stu-id="a8391-110">Patching with Least-Privileged User Accounts</span></span>](#patching-with-least-privileged-user-accounts)

## <a name="introduction"></a><span data-ttu-id="a8391-111">Введение</span><span class="sxs-lookup"><span data-stu-id="a8391-111">Introduction</span></span>

<span data-ttu-id="a8391-112">Windows управляет своими пользователями с помощью учетных записей.</span><span class="sxs-lookup"><span data-stu-id="a8391-112">Windows manages its users with accounts.</span></span> <span data-ttu-id="a8391-113">Сегодня более 80% пользователей компьютеров дома используют свой компьютер совместно с другими членами семьи.</span><span class="sxs-lookup"><span data-stu-id="a8391-113">Today, more than eighty percent of computer users at home share their computer with other family members.</span></span> <span data-ttu-id="a8391-114">Если несколько пользователей совместно используют один компьютер Windows, создается несколько учетных записей пользователей, и каждый пользователь входит в систему с помощью отдельной учетной записи для доступа к компьютеру.</span><span class="sxs-lookup"><span data-stu-id="a8391-114">When multiple users share a Windows computer, multiple user accounts are created, and each user logs in with an individual account to access the computer.</span></span> <span data-ttu-id="a8391-115">Благодаря повышению уровня осведомленности о безопасности, многие пользователи работают на компьютерах с учетными записями пользователей с минимальными правами, которые также называются учетными записями ограниченных пользователей, которые не имеют полного контроля над системой.</span><span class="sxs-lookup"><span data-stu-id="a8391-115">With the increasing awareness for security, more people operate their computers with least-privileged user accounts, also known as limited-user accounts, which do not have complete control over the system.</span></span> <span data-ttu-id="a8391-116">Учетные записи администратора обычно имеют неограниченный доступ к каждой части компьютера.</span><span class="sxs-lookup"><span data-stu-id="a8391-116">Administrator accounts typically have unrestricted access to every part of the computer.</span></span> <span data-ttu-id="a8391-117">Это может повлиять на работу игр на основе Windows.</span><span class="sxs-lookup"><span data-stu-id="a8391-117">This can affect how Windows-based games work.</span></span>

<span data-ttu-id="a8391-118">Существуют дополнительные преимущества для разработчиков игр, которые пишут свои игры для работы с учетными записями пользователей с минимальными правами доступа.</span><span class="sxs-lookup"><span data-stu-id="a8391-118">There are additional benefits for games developers who write their games to work with least-privileged user accounts.</span></span> <span data-ttu-id="a8391-119">В Windows Vista и более поздних версиях применяются учетные записи пользователей с минимальными правами, что означает, что каждая учетная запись в системе, за исключением локального администратора, является учетной записью пользователя с минимальными правами доступа.</span><span class="sxs-lookup"><span data-stu-id="a8391-119">In Windows Vista and later, least-privileged user accounts are enforced, which means that every account on the system, with the exception of the local administrator, is a least-privileged user account.</span></span> <span data-ttu-id="a8391-120">Это повлияет на то, как игры, которые не соответствуют рекомендациям (устаревшие приложения), выполняются в Windows Vista и более поздних версиях.</span><span class="sxs-lookup"><span data-stu-id="a8391-120">This will affect how games that do not follow the guideline (legacy applications) run on Windows Vista and later.</span></span> <span data-ttu-id="a8391-121">Например, когда приложение пытается выполнить запись в папку или значение реестра, к которому у него отсутствует разрешение, запись файла перенаправляется в виртуальное хранилище файлов для пользователя.</span><span class="sxs-lookup"><span data-stu-id="a8391-121">For instance, when an application attempts to write to a folder or a registry value to which it does not have permission, the file write is redirected to a virtual file store for the user.</span></span> <span data-ttu-id="a8391-122">Это хранилище виртуальных файлов будет находиться в папке, к которой пользователь имеет доступ для записи.</span><span class="sxs-lookup"><span data-stu-id="a8391-122">This virtual file store will reside in a folder to which the user has write access.</span></span> <span data-ttu-id="a8391-123">Такое поведение может показаться неразрушительным, так как при сбое попытки записи произойдет сбой. Однако приложения, создающие виртуализованные файлы, могут запутать пользователей, так как файлы не будут записываться в местоположение, которое пользователи хотят.</span><span class="sxs-lookup"><span data-stu-id="a8391-123">This behavior may not seem as catastrophic as outright failing the write attempt; however, applications that create virtualized files may confuse users because files will not be written to the location users expect.</span></span> <span data-ttu-id="a8391-124">Например, игры, записывающие файлы высокой оценки в ту же папку, что и исполняемая папка, будут записывать эти файлы в виртуализированную папку.</span><span class="sxs-lookup"><span data-stu-id="a8391-124">For instance, games that write high score files to the same folder as the executable folder will write these files to a virtualized folder instead.</span></span> <span data-ttu-id="a8391-125">Следовательно, один пользователь не может видеть высокую оценку, полученную другим пользователем, так как каждый пользователь имеет отдельное виртуальное хранилище файлов.</span><span class="sxs-lookup"><span data-stu-id="a8391-125">Consequently, one user cannot see the high score achieved by another user because every user has a separate virtualized file store.</span></span>

<span data-ttu-id="a8391-126">Игры, которые следуют рекомендациям в этой статье, будут работать с учетными записями пользователей с минимальными правами и, соответственно, будут поддерживать совместимость с Windows Vista и более поздними версиями.</span><span class="sxs-lookup"><span data-stu-id="a8391-126">Games that follow the guidelines in this article will run with least-privileged user accounts, and consequently will maintain compatibility with Windows Vista and later.</span></span>

## <a name="file-access-for-least-privileged-user-accounts"></a><span data-ttu-id="a8391-127">Доступ к файлам для учетных записей пользователей Least-Privileged</span><span class="sxs-lookup"><span data-stu-id="a8391-127">File Access for Least-Privileged User Accounts</span></span>

<span data-ttu-id="a8391-128">Windows поддерживает две файловые системы: FAT32 и NTFS.</span><span class="sxs-lookup"><span data-stu-id="a8391-128">Windows supports two file systems: FAT32 and NTFS.</span></span> <span data-ttu-id="a8391-129">FAT32 — это устаревшая файловая система, которая поддерживается только для обеспечения обратной совместимости. NTFS поддерживает более мощные и надежные разрешения на доступ к файлам.</span><span class="sxs-lookup"><span data-stu-id="a8391-129">FAT32 is a legacy file system supported only for backward compatibility; NTFS supports more powerful and robust file permissions.</span></span> <span data-ttu-id="a8391-130">Использование файловой системы NTFS в качестве розничных продавцов доставляют новые компьютеры с предварительно установленными ОС Windows на жестком диске с файловой системой NTFS.</span><span class="sxs-lookup"><span data-stu-id="a8391-130">The use of NTFS is expanding as retailers are shipping new computers with Windows pre-installed on a NTFS-partitioned hard drive.</span></span> <span data-ttu-id="a8391-131">В системе Windows XP, основанной на NTFS, пользователи с учетными записями пользователей с минимальными правами имеют ограниченный доступ к нескольким папкам.</span><span class="sxs-lookup"><span data-stu-id="a8391-131">On an NTFS-based Windows XP system, users with least-privileged user accounts have only limited access to several folders.</span></span> <span data-ttu-id="a8391-132">Однако они будут иметь полный доступ к системе Windows XP на основе файловой системы FAT32.</span><span class="sxs-lookup"><span data-stu-id="a8391-132">However, they would have complete access on a FAT32-based Windows XP system.</span></span>

<span data-ttu-id="a8391-133">В следующей таблице перечислены расположения этих папок по умолчанию и их разрешения.</span><span class="sxs-lookup"><span data-stu-id="a8391-133">The following table lists the default location of these folders and their permissions.</span></span>



| <span data-ttu-id="a8391-134">Путь</span><span class="sxs-lookup"><span data-stu-id="a8391-134">Path</span></span>                                               | <span data-ttu-id="a8391-135">Содержимое папки</span><span class="sxs-lookup"><span data-stu-id="a8391-135">Folder Contents</span></span>              | <span data-ttu-id="a8391-136">Чтение</span><span class="sxs-lookup"><span data-stu-id="a8391-136">Read</span></span> | <span data-ttu-id="a8391-137">запись</span><span class="sxs-lookup"><span data-stu-id="a8391-137">Write</span></span> | <span data-ttu-id="a8391-138">Создание/удаление</span><span class="sxs-lookup"><span data-stu-id="a8391-138">Create/Delete</span></span> |
|----------------------------------------------------|------------------------------|------|-------|---------------|
| <span data-ttu-id="a8391-139"><Drive>: \\ Windows</span><span class="sxs-lookup"><span data-stu-id="a8391-139"><Drive>:\\Windows</span></span>                            | <span data-ttu-id="a8391-140">Операционная система Windows</span><span class="sxs-lookup"><span data-stu-id="a8391-140">The Windows operating system</span></span> | <span data-ttu-id="a8391-141">X</span><span class="sxs-lookup"><span data-stu-id="a8391-141">X</span></span>    |       |               |
| <span data-ttu-id="a8391-142"><Drive>: \\ Program Files</span><span class="sxs-lookup"><span data-stu-id="a8391-142"><Drive>:\\Program Files</span></span>                      | <span data-ttu-id="a8391-143">Файлы исполняемого приложения</span><span class="sxs-lookup"><span data-stu-id="a8391-143">Executable application files</span></span> | <span data-ttu-id="a8391-144">X</span><span class="sxs-lookup"><span data-stu-id="a8391-144">X</span></span>    |       |               |
| <span data-ttu-id="a8391-145"><Drive>: \\ Имя пользователя документов и параметров \\\*</span><span class="sxs-lookup"><span data-stu-id="a8391-145"><Drive>:\\Documents and Settings\\Username\*</span></span> | <span data-ttu-id="a8391-146">Файлы каждого пользователя</span><span class="sxs-lookup"><span data-stu-id="a8391-146">Each user's files</span></span>            | <span data-ttu-id="a8391-147">X</span><span class="sxs-lookup"><span data-stu-id="a8391-147">X</span></span>    | <span data-ttu-id="a8391-148">X</span><span class="sxs-lookup"><span data-stu-id="a8391-148">X</span></span>     | <span data-ttu-id="a8391-149">X</span><span class="sxs-lookup"><span data-stu-id="a8391-149">X</span></span>             |
| <span data-ttu-id="a8391-150"><Drive>: \\ Documents and Settings \\ All Users</span><span class="sxs-lookup"><span data-stu-id="a8391-150"><Drive>:\\Documents and Settings\\All Users</span></span>  | <span data-ttu-id="a8391-151">Все файлы пользователей</span><span class="sxs-lookup"><span data-stu-id="a8391-151">All user files</span></span>               | <span data-ttu-id="a8391-152">X</span><span class="sxs-lookup"><span data-stu-id="a8391-152">X</span></span>    | <span data-ttu-id="a8391-153">X</span><span class="sxs-lookup"><span data-stu-id="a8391-153">X</span></span>     | <span data-ttu-id="a8391-154">X</span><span class="sxs-lookup"><span data-stu-id="a8391-154">X</span></span>             |



 

<span data-ttu-id="a8391-155">\* UserName — имя входа пользователя.</span><span class="sxs-lookup"><span data-stu-id="a8391-155">\* Username is the user's login name.</span></span>

<span data-ttu-id="a8391-156">В учетной записи с минимальными правами доступа вы можете читать, записывать, создавать и удалять файлы в любой папке: Documents and Settings \\ username, Documents и Settings \\ All Users.</span><span class="sxs-lookup"><span data-stu-id="a8391-156">In a least-privileged user account, you may read, write, create and delete files in either folder: Documents and Settings\\Username or Documents and Settings\\All Users.</span></span>

<span data-ttu-id="a8391-157">Это означает, что не следует размещать игры в \\ файлах программ, вместо этого они должны находиться в вложенной папке в папке " \\ Мои документы".</span><span class="sxs-lookup"><span data-stu-id="a8391-157">What this means is that you should not place save games in \\Program Files, instead they should go in a sub-folder in \\My Documents.</span></span> <span data-ttu-id="a8391-158">Кроме того, не следует помещать временные данные приложений в \\ Program Files или \\ Мои документы, вместо этого их следует размещать в папке Application Data ( \_ Локальная папка \_ AppData).</span><span class="sxs-lookup"><span data-stu-id="a8391-158">Also you should not place temporary application data in \\Program Files or \\My Documents, instead it should be placed in Application Data folder (CSIDL\_LOCAL\_APPDATA).</span></span>

<span data-ttu-id="a8391-159">В частности, существуют два сценария, которые должны быть обработаны каждой игрой:</span><span class="sxs-lookup"><span data-stu-id="a8391-159">More specifically, there are two scenarios that each game should handle:</span></span>

### <a name="scenario-1-files-that-do-not-need-to-be-viewed-or-altered-by-users"></a><span data-ttu-id="a8391-160">Сценарий 1. файлы, которые не нужно просматривать или изменять пользователями</span><span class="sxs-lookup"><span data-stu-id="a8391-160">Scenario 1: Files that do not need to be viewed or altered by users</span></span>

<span data-ttu-id="a8391-161">Типичным примером будет файл конфигурации игры, временные файлы и файлы кэша игры.</span><span class="sxs-lookup"><span data-stu-id="a8391-161">A typical example would be the game's configuration file, temporary files, and game cache files.</span></span> <span data-ttu-id="a8391-162">Эти файлы обычно хранятся в папке Application Data.</span><span class="sxs-lookup"><span data-stu-id="a8391-162">These files are typically kept in the Application Data folder.</span></span> <span data-ttu-id="a8391-163">Чтобы получить этот путь к папке, вызовите функцию [**шжетфолдерпас**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) с кодом CSid \_ или local AppData (CSID), \_ \_ как показано в следующем примере кода.</span><span class="sxs-lookup"><span data-stu-id="a8391-163">To obtain this folder path, call the [**SHGetFolderPath**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) function with CSIDL\_APPDATA or CSIDL\_LOCAL\_APPDATA as shown in the following code example.</span></span>

``` syntax
#include <shlobj.h>
#include <strsafe.h>

#define APPNAME L"MyApp"

WCHAR wszPath[MAX_PATH];

// Local Application Data
SHGetFolderPath( hWnd, CSIDL_LOCAL_APPDATA, NULL, SHGFP_TYPE_CURRENT, wszPath );
StringCchCatW( wszPath, MAX_PATH, L"\\" );
StringCchCatW( wszPath, MAX_PATH, APPNAME );

// Create the folder wszPath
// Then create files in wszPath
// Roaming Application Data
SHGetFolderPath( hWnd, CSIDL_APPDATA, NULL, SHGFP_TYPE_CURRENT, wszPath );
StringCchCatW( wszPath, MAX_PATH, L"\\" );
StringCchCatW( wszPath, MAX_PATH, APPNAME );

// Create the folder wszPath
// Then create files in wszPath
```

<span data-ttu-id="a8391-164">Различие между локальными и перемещаемыми папками данных приложений заключается в том, что в Windows 2000 и Windows XP перемещаемое содержимое копируется на сервер и с сервера в течение процесса входа и выхода, а локальное содержимое — нет.</span><span class="sxs-lookup"><span data-stu-id="a8391-164">The difference between local and roaming Application Data folders is that on Windows 2000 and Windows XP, roaming content is copied to and from the server during the logon/logoff process, while local content is not.</span></span> <span data-ttu-id="a8391-165">Для большинства игр достаточно данных локального приложения.</span><span class="sxs-lookup"><span data-stu-id="a8391-165">For most games, local Application Data is sufficient.</span></span>

### <a name="scenario-2-files-that-need-to-be-viewed-or-altered-by-users"></a><span data-ttu-id="a8391-166">Сценарий 2. файлы, которые должны быть просмотрены или изменены пользователями</span><span class="sxs-lookup"><span data-stu-id="a8391-166">Scenario 2: Files that need to be viewed or altered by users</span></span>

<span data-ttu-id="a8391-167">В качестве типичного примера можно привести файлы сохраненных игр пользователя.</span><span class="sxs-lookup"><span data-stu-id="a8391-167">A typical example would be a user's saved game files.</span></span> <span data-ttu-id="a8391-168">Храните файлы в папке документов пользователя, чтобы они были легко видны пользователю.</span><span class="sxs-lookup"><span data-stu-id="a8391-168">Store the files in the user's document folder so that they are easily visible to the user.</span></span> <span data-ttu-id="a8391-169">Приложение получает путь к папке документа пользователя, вызывая [**шжетфолдерпас**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) с кодом CSid \_ (личное), как показано в следующем примере кода:</span><span class="sxs-lookup"><span data-stu-id="a8391-169">An application gets the user's document folder path by calling [**SHGetFolderPath**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) with CSIDL\_PERSONAL, as the following code example shows:</span></span>

``` syntax
#include <shlobj.h>
#include <strsafe.h>

#define APPNAME L"MyApp"

WCHAR wszPath[MAX_PATH];

SHGetFolderPath( hWnd, CSIDL_PERSONAL, NULL, SHGFP_TYPE_CURRENT, wszPath );
StringCchCatW( wszPath, MAX_PATH, L"\\" );
StringCchCatW( wszPath, MAX_PATH, APPNAME );

// Create the folder wszPath
// Then create files in wszPath
```

<span data-ttu-id="a8391-170">Иногда в игре может потребоваться хранить файлы, предназначенные для просмотра и использования всеми пользователями.</span><span class="sxs-lookup"><span data-stu-id="a8391-170">At times, a game may need to store files that all users are meant to see and use.</span></span> <span data-ttu-id="a8391-171">Одним из примеров является запись высокой оценки, в которой все пользователи записываются в один и тот же файл записи, чтобы высокие показатели поддерживались на уровне всей системы, а не отдельные высокие оценки для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="a8391-171">One example is the high score record, where all users write to the same record file so that high scores are maintained system-wide instead of a separate high score for each user.</span></span> <span data-ttu-id="a8391-172">Другими примерами являются Скачанные карты, миссии и изменения в игре.</span><span class="sxs-lookup"><span data-stu-id="a8391-172">Other examples are downloaded maps, missions, and game modifications.</span></span> <span data-ttu-id="a8391-173">Если они являются общими, то только один пользователь должен загрузить их, а не каждый пользователь.</span><span class="sxs-lookup"><span data-stu-id="a8391-173">If these are shared, then only one user has to download them instead of every user.</span></span> <span data-ttu-id="a8391-174">В этом сценарии используйте папку Document в папке Shared Profile, как показано в следующем коде.</span><span class="sxs-lookup"><span data-stu-id="a8391-174">In this scenario, use the document folder under the shared profile folder, as demonstrated in the following code.</span></span>

``` syntax
#include <shlobj.h>
#include <strsafe.h>

#define APPNAME L"MyApp"

WCHAR wszPath[MAX_PATH];

SHGetFolderPath( hWnd, CSIDL_COMMON_DOCUMENTS, NULL, SHGFP_TYPE_CURRENT, wszPath );
StringCchCatW( wszPath, MAX_PATH, L"\\" );
StringCchCatW( wszPath, MAX_PATH, APPNAME );

// Create the folder wszPath
// Then create files in wszPath
```

## <a name="registry-access-for-least-privileged-user-accounts"></a><span data-ttu-id="a8391-175">Доступ к реестру для учетных записей пользователей Least-Privileged</span><span class="sxs-lookup"><span data-stu-id="a8391-175">Registry Access for Least-Privileged User Accounts</span></span>

<span data-ttu-id="a8391-176">Приложения часто используют реестр Windows для хранения информации.</span><span class="sxs-lookup"><span data-stu-id="a8391-176">It is common for applications to use the Windows registry to store information.</span></span> <span data-ttu-id="a8391-177">Аналогично доступу к файлам, учетные записи администратора и наименее привилегированных пользователей не имеют одинаковых разрешений для реестра.</span><span class="sxs-lookup"><span data-stu-id="a8391-177">Similar to file access, administrator and least-privileged user accounts do not have the same permission to the registry.</span></span> <span data-ttu-id="a8391-178">Для учетных записей с минимальными правами доступа весь \_ \_ узел ЛОКАЛЬНОГО компьютера hKey доступен только для чтения.</span><span class="sxs-lookup"><span data-stu-id="a8391-178">For least-privileged user accounts, the entire HKEY\_LOCAL\_MACHINE node is read-only.</span></span> <span data-ttu-id="a8391-179">Например, игра может считывать сведения о конфигурации по умолчанию, но не может записывать новые сведения на этот узел.</span><span class="sxs-lookup"><span data-stu-id="a8391-179">For instance, a game can read the default configuration information, but may not write any new information to this node.</span></span> <span data-ttu-id="a8391-180">Следовательно, игры, работающие в пользовательском режиме с минимальными привилегиями и требующие записи в реестр, должны будут \_ использовать \_ узел текущего пользователя hKey для хранения информации для каждого пользователя, как показано в следующем коде.</span><span class="sxs-lookup"><span data-stu-id="a8391-180">Consequently, games running in least-privileged user mode that need to write to the registry will need to use the HKEY\_CURRENT\_USER node to store per-user information, as illustrated in the following code.</span></span>

``` syntax
#define APP_REGISTRY_KEY_PATH L"Software\\MyCompany\\MyApp"

LONG lRetVal;
HKEY hKey;

lRetVal = RegCreateKeyExW( HKEY_CURRENT_USER,
                           APP_REGISTRY_KEY_PATH,
                           0,
                           NULL,
                           REG_OPTION_NON_VOLATILE,
                           KEY_WRITE|KEY_READ,
                           NULL,
                           &hKey,
                           NULL );

if( ERROR_SUCCESS == lRetVal )
{
    // Store information in hKey
}
```

<span data-ttu-id="a8391-181">Следует отметить, что во время установки данные реестра должны быть записаны на \_ локальный \_ компьютер hKey, а не в hKey \_ текущий \_ пользователь.</span><span class="sxs-lookup"><span data-stu-id="a8391-181">It is worth noting that during installation, registry information should be written to HKEY\_LOCAL\_MACHINE, not HKEY\_CURRENT\_USER.</span></span> <span data-ttu-id="a8391-182">Это связано с тем, что пользователь, выполняющий установку, обычно является администратором, и может быть не единственным человеком, использующим эту программу.</span><span class="sxs-lookup"><span data-stu-id="a8391-182">This is because the person running the installation is usually an administrator, and may not be the only person to use the program.</span></span> <span data-ttu-id="a8391-183">В этом случае при записи в HKEY \_ текущий \_ пользователь информация становится недоступной для других пользователей.</span><span class="sxs-lookup"><span data-stu-id="a8391-183">In this situation, writing to HKEY\_CURRENT\_USER makes the information unavailable to other users.</span></span> <span data-ttu-id="a8391-184">Обычно это не проблема, поскольку сведения, записываемые в реестр во время установки, являются параметрами конфигурации и по умолчанию, которые применяются к каждому пользователю программы.</span><span class="sxs-lookup"><span data-stu-id="a8391-184">This is not usually an issue because the information written to the registry during installation is the configuration and default settings that apply to every user of the program.</span></span>

<span data-ttu-id="a8391-185">При удалении игры необходимо выполнить дополнительные усилия, чтобы удалить каждое значение, записанное игрой в реестр.</span><span class="sxs-lookup"><span data-stu-id="a8391-185">When uninstalling the game, extra effort is necessary to remove every value that the game has written to the registry.</span></span> <span data-ttu-id="a8391-186">Поскольку установщик запускается одним человеком, как правило, администратор, просто удаляя соответствующую информацию в HKEY \_ локальный \_ компьютер и hKey \_ текущий \_ пользователь, вы не удаляете значения для других пользователей.</span><span class="sxs-lookup"><span data-stu-id="a8391-186">Because the uninstaller is run by one person, usually the administrator, simply deleting the relevant information in HKEY\_LOCAL\_MACHINE and HKEY\_CURRENT\_USER will not remove values for other users.</span></span> <span data-ttu-id="a8391-187">Одним из способов удаления сведений для каждого пользователя в реестре является перечисление \_ корня куста реестра hKey Users.</span><span class="sxs-lookup"><span data-stu-id="a8391-187">One way to remove the per-user information in the registry is to enumerate the HKEY\_USERS registry hive root.</span></span> <span data-ttu-id="a8391-188">Каждый подраздел в разделе HKEY \_ Users соответствует \_ Hive текущего \_ пользователя hKey для конкретного пользователя в системе.</span><span class="sxs-lookup"><span data-stu-id="a8391-188">Each subkey under HKEY\_USERS corresponds to the HKEY\_CURRENT\_USER hive for a particular user on the system.</span></span> <span data-ttu-id="a8391-189">При перечислении \_ пользователей hKey и удалении сведений, относящихся к игре, в каждом подразделе, установщик может убедиться, что никакие сведения не остались.</span><span class="sxs-lookup"><span data-stu-id="a8391-189">By enumerating HKEY\_USERS and removing the game-specific information under each subkey, the uninstaller can ensure that no information is left behind.</span></span>

## <a name="patching-with-least-privileged-user-accounts"></a><span data-ttu-id="a8391-190">Установка исправлений с учетными записями пользователей Least-Privileged</span><span class="sxs-lookup"><span data-stu-id="a8391-190">Patching with Least-Privileged User Accounts</span></span>

<span data-ttu-id="a8391-191">Установка исправлений для игры предполагает обновление файлов игры.</span><span class="sxs-lookup"><span data-stu-id="a8391-191">Patching a game involves updating the game's files.</span></span> <span data-ttu-id="a8391-192">Таким образом, обычно требуется доступ на запись в папку программы игры.</span><span class="sxs-lookup"><span data-stu-id="a8391-192">Therefore, it usually requires write access to the game's program folder.</span></span> <span data-ttu-id="a8391-193">Установка исправлений для игры — это простой процесс, который выполняется администратором, поскольку он имеет неограниченный доступ к папке программы игры.</span><span class="sxs-lookup"><span data-stu-id="a8391-193">Patching a game is a straightforward process when it is done by an administrator because they have unrestricted access to the game's program folder.</span></span> <span data-ttu-id="a8391-194">И наоборот, он, как правило, был сложным, если это не было возможно, для минимально привилегированного пользователя в исправлении игр из-за ограничений доступа.</span><span class="sxs-lookup"><span data-stu-id="a8391-194">Conversely, it has traditionally been difficult, if not impossible, for a least privileged user to patch games because of the access restriction.</span></span> <span data-ttu-id="a8391-195">Теперь [установщик Windows](/windows/desktop/Msi/windows-installer-portal) был усовершенствован, чтобы сделать возможным исправление учетной записи пользователя с минимальными привилегиями.</span><span class="sxs-lookup"><span data-stu-id="a8391-195">Now, [Windows Installer](/windows/desktop/Msi/windows-installer-portal) has been enhanced to make least-privileged user account patching possible.</span></span> <span data-ttu-id="a8391-196">Чтобы воспользоваться преимуществами этой функции, в играх рекомендуется использовать установщик Windows для установки и исправления.</span><span class="sxs-lookup"><span data-stu-id="a8391-196">To take advantage of this feature, games are encouraged to utilize Windows Installer for installation and patching.</span></span>

<span data-ttu-id="a8391-197">Начиная с установщик Windows 3,0, при выполнении определенных условий исправления приложений могут применяться пользователями с минимальными правами.</span><span class="sxs-lookup"><span data-stu-id="a8391-197">Starting with Windows Installer 3.0, application patches can be applied by least privileged users when certain conditions are met.</span></span> <span data-ttu-id="a8391-198">Это следующие условия:</span><span class="sxs-lookup"><span data-stu-id="a8391-198">These conditions are:</span></span>

-   <span data-ttu-id="a8391-199">Приложение было установлено с помощью установщик Windows 3,0.</span><span class="sxs-lookup"><span data-stu-id="a8391-199">The application was installed using Windows Installer 3.0.</span></span>
-   <span data-ttu-id="a8391-200">Приложение первоначально устанавливалось для каждого компьютера.</span><span class="sxs-lookup"><span data-stu-id="a8391-200">The application was originally installed per-machine.</span></span>
-   <span data-ttu-id="a8391-201">Приложение устанавливается со съемного носителя, такого как компакт-диск или цифровой видеодиск (DVD).</span><span class="sxs-lookup"><span data-stu-id="a8391-201">The application is installed from removable media, such a CD-ROM or digital video disc (DVD).</span></span>
-   <span data-ttu-id="a8391-202">Исправления имеют цифровую подпись сертификата, идентифицируемого исходным пакетом установщика (MSI-файл).</span><span class="sxs-lookup"><span data-stu-id="a8391-202">The patches are digitally signed by a certificate that is identified by the original installer package (.msi file).</span></span>
-   <span data-ttu-id="a8391-203">Исправления можно проверить по цифровой подписи.</span><span class="sxs-lookup"><span data-stu-id="a8391-203">The patches can be validated against the digital signature.</span></span>
-   <span data-ttu-id="a8391-204">Исходный пакет установщика не отключил исправление учетной записи пользователя с минимальными привилегиями.</span><span class="sxs-lookup"><span data-stu-id="a8391-204">The original installer package has not disabled least-privileged user account patching.</span></span>
-   <span data-ttu-id="a8391-205">Системный администратор не отключил исправление учетной записи с минимальными правами доступа через системную политику.</span><span class="sxs-lookup"><span data-stu-id="a8391-205">The system administrator has not disabled least-privileged user account patching via system policy.</span></span>

<span data-ttu-id="a8391-206">Как правило, пользователь с минимальными правами не может изменять программные файлы игры.</span><span class="sxs-lookup"><span data-stu-id="a8391-206">Normally, a least privileged user cannot modify a game's program files.</span></span> <span data-ttu-id="a8391-207">Однако если выполняются указанные выше условия и включено исправление LUA, установщик Windows может обновить файлы игры, чтобы пользователь мог получить последнюю версию.</span><span class="sxs-lookup"><span data-stu-id="a8391-207">However, when the above conditions are met and LUA patching is enabled, Windows Installer can update the game's files so that the user gets the latest version.</span></span>

> [!Note]  
> <span data-ttu-id="a8391-208">Сведения, содержащиеся в этой статье, относятся к предварительной версии программного обеспечения, которая может быть значительно изменена перед первым коммерческим выпуском.</span><span class="sxs-lookup"><span data-stu-id="a8391-208">The information contained in this article relates to pre-release software product, which may be substantially modified before its first commercial release.</span></span> <span data-ttu-id="a8391-209">Таким образом, информация может не точнее описывать или отражать программный продукт при первой коммерческой выпуске.</span><span class="sxs-lookup"><span data-stu-id="a8391-209">Accordingly, the information may not accurately describe or reflect the software product when first commercially released.</span></span> <span data-ttu-id="a8391-210">Эта статья предназначена только для информационных целей, и корпорация Майкрософт не предоставляет никаких гарантий, явных или подразумеваемых, относительно этой статьи или содержащейся в ней информации.</span><span class="sxs-lookup"><span data-stu-id="a8391-210">This article is provided for informational purposes only, and Microsoft makes no warranties, express or implied, with respect to this article or the information contained in it.</span></span>

 

 

 