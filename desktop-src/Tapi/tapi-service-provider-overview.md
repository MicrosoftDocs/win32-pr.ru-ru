---
description: Приложения TAPI находятся в своем собственном пространстве процесса.
ms.assetid: 57dedad1-7264-48fc-9ac2-c6c72f7fee27
title: Общие сведения о поставщике услуг TAPI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 29871b21124eab7ea4e7e84a9e7e8ca49853cb7a236c6f7a482dbf842a568304
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117760310"
---
# <a name="tapi-service-provider-overview"></a>Общие сведения о поставщике услуг TAPI

Приложения TAPI находятся в своем собственном пространстве процесса. Приложения TAPI загружают Tapi32.dll или Tapi3.dll в процесс, а TAPI взаимодействует с ТАПИСРВ через частный интерфейс RPC. TSP выполняется в контексте ТАПИСРВ. Данный TSP может находиться на компьютере, отличном от компьютера пользователя и доступ к которому осуществляется с помощью удаленного TSP. ТАПИСРВ реализуется как процесс службы в SVCHOST. MSP находится в пространстве процесса приложения и всегда является локальным.

Пару TSP/MSP можно рассматривать как виртуальный частный путь обмена данными. Данные могут быть переданы между двумя непрозрачными буферами, которые не обрабатываются ни в ТАПИСРВ, ни в библиотеке DLL TAPI.

Некоторые поставщики услуг реализуют операции, относящиеся к используемому оборудованию. Интерфейс TAPI 2. x обеспечивает доступ к таким операциям с помощью функции [**линедевспеЦифик**](/windows/win32/api/tapi/nf-tapi-linedevspecific) или [**фонедевспеЦифик**](/windows/win32/api/tapi/nf-tapi-phonedevspecific) . Интерфейс TAPI 3. x предоставляет [интерфейсы, зависящие от поставщика](./provider-specific-interfaces.md).

На следующей схеме показан поток управления и сведения, в которых показан один изолированный TSP (Unimodem) и одна пара TSP/MSP (H. 323).

![изолированный TSP и сопряженный поток управления и информации по TSP/MSP](images/tsp-msp1.png)

На следующей схеме показан ход выполнения входящего вызова, включающего как TSP, так и MSP.

![входящий вызов с помощью TSP и MSP](images/tspmspin.png)

## <a name="incoming-call-setup"></a>Настройка входящего вызова

-   TSP отправляет сообщение [**Line \_ НЕВКАЛЛ**](line-newcall.md) в таписрв. [**Состояние вызова**](./linecallstate--constants.md) — линекаллстате \_ предложение.
-   ТАПИСРВ уведомляет клиентов о вызове.
-   TAPI3 создает объект вызова TAPI, а затем вызывает [**итмспаддресс:: креатемспкалл**](/windows/win32/api/tapi3/nf-tapi3-itmspaddress-createmspcall), который реализуется MSP.
-   MSP создает объект вызова MSP и потоки по умолчанию на основе [**типов носителей**](./tapimediatype--constants.md) , необходимых для вызова. Он возвращает указатель IUnknown на объект вызова MSP.
-   TAPI3 выполняет статистическую обработку объекта вызова MSP в объект вызова TAPI, делая доступными для приложения такие интерфейсы, как [**итстреамконтрол**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) . Затем он уведомляет приложение о новом вызове.

Затем приложение может использовать такие методы, как [**итстреам:: селекттерминал**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal) , для завершения подготовительной подготовки к завершению вызова.

## <a name="incoming-call-completion"></a>Завершение входящего вызова

-   Приложение вызывает [**итбасиккаллконтрол:: Answer**](/windows/win32/api/tapi3if/nf-tapi3if-itbasiccallcontrol-answer).
-   TAPI3 вызывает [**линеансвер**](/windows/win32/api/tapi/nf-tapi-lineanswer).
-   ТАПИСЕРВ вызывает [**тспи \_ линеансвер**](/windows/win32/api/tspi/nf-tspi-tspi_lineanswer).
-   TSP инициирует потоковую передачу вызовов. Как правило, TSP отправляет сообщение соответствующему MSP-сообщению, а MSP запускает потоки. В некоторых реализациях TSP/MSP, TSP запускает потоки.

## <a name="tspmsp-communication-during-call-progress"></a>Обмен данными между TSP и MSP во время выполнения вызова

После выполнения вызова TSP и MSP обмениваются данными, передавая непрозрачные буферы через ТАПИСРВ и TAPI3.

-   TSP отправляет сведения в MSP, отправляя сообщение [**Line \_ СЕНДМСПДАТА**](line-sendmspdata.md) в таписрв.
-   MSP получает сведения от TSP с помощью метода [**итмспаддресс:: рецеиветспдата**](/windows/win32/api/tapi3/nf-tapi3-itmspaddress-receivetspdata) . Если данные связаны с объектом вызова MSP, в качестве параметра этого метода предоставляется указатель интерфейса на объект вызова MSP.
-   MSP отправляет сведения в TSP, отправляя событие MSP- \_ \_ данных TSP в интерфейс TAPI 3.
-   TSP получает сведения из MSP с помощью функции [**тспи \_ линерецеивемспдата**](/windows/win32/api/tspi/nf-tspi-tspi_linereceivemspdata) .

Точный процесс и содержимое взаимодействия между поставщиками служб относится к заданному TSP/MSP-набору.

> [!Note]  
> Для исходящих вызовов MSP обычно знает о вызове до TSP. Если MSP пытается связаться с TSP до информирования о вызове TSP, произойдет сбой связи. Когда MSP и TSP должны обмениваться информацией, относящейся к конкретному вызову, TSP следует инициировать обмен данными.

 

 

 
