---
description: Приложения TAPI находятся в своем собственном пространстве процесса.
ms.assetid: 57dedad1-7264-48fc-9ac2-c6c72f7fee27
title: Общие сведения о поставщике услуг TAPI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7e847ed49879e9ff55662477a762fa7297443d12
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104567695"
---
# <a name="tapi-service-provider-overview"></a><span data-ttu-id="2bef8-103">Общие сведения о поставщике услуг TAPI</span><span class="sxs-lookup"><span data-stu-id="2bef8-103">TAPI Service Provider Overview</span></span>

<span data-ttu-id="2bef8-104">Приложения TAPI находятся в своем собственном пространстве процесса.</span><span class="sxs-lookup"><span data-stu-id="2bef8-104">TAPI applications reside in their own process space.</span></span> <span data-ttu-id="2bef8-105">Приложения TAPI загружают Tapi32.dll или Tapi3.dll в процесс, а TAPI взаимодействует с ТАПИСРВ через частный интерфейс RPC.</span><span class="sxs-lookup"><span data-stu-id="2bef8-105">TAPI applications load the Tapi32.dll or Tapi3.dll into their process, and TAPI communicates with TAPISRV through a private RPC interface.</span></span> <span data-ttu-id="2bef8-106">TSP выполняется в контексте ТАПИСРВ.</span><span class="sxs-lookup"><span data-stu-id="2bef8-106">A TSP runs in the context of TAPISRV.</span></span> <span data-ttu-id="2bef8-107">Данный TSP может находиться на компьютере, отличном от компьютера пользователя и доступ к которому осуществляется с помощью удаленного TSP.</span><span class="sxs-lookup"><span data-stu-id="2bef8-107">A given TSP may reside on a machine other than the user's machine and is accessed using a remote TSP.</span></span> <span data-ttu-id="2bef8-108">ТАПИСРВ реализуется как процесс службы в SVCHOST.</span><span class="sxs-lookup"><span data-stu-id="2bef8-108">TAPISRV is implemented as a service process within SVCHOST.</span></span> <span data-ttu-id="2bef8-109">MSP находится в пространстве процесса приложения и всегда является локальным.</span><span class="sxs-lookup"><span data-stu-id="2bef8-109">An MSP lives within the process space of the application and is always local.</span></span>

<span data-ttu-id="2bef8-110">Пару TSP/MSP можно рассматривать как виртуальный частный путь обмена данными.</span><span class="sxs-lookup"><span data-stu-id="2bef8-110">A TSP/MSP pair can be regarded as having a virtual private communication path.</span></span> <span data-ttu-id="2bef8-111">Данные могут быть переданы между двумя непрозрачными буферами, которые не обрабатываются ни в ТАПИСРВ, ни в библиотеке DLL TAPI.</span><span class="sxs-lookup"><span data-stu-id="2bef8-111">Information can be sent between the two using opaque buffers that are not interpreted by either TAPISRV or the TAPI DLL.</span></span>

<span data-ttu-id="2bef8-112">Некоторые поставщики услуг реализуют операции, относящиеся к используемому оборудованию.</span><span class="sxs-lookup"><span data-stu-id="2bef8-112">Some service providers implement operations specific to the hardware involved.</span></span> <span data-ttu-id="2bef8-113">Интерфейс TAPI 2. x обеспечивает доступ к таким операциям с помощью функции [**линедевспеЦифик**](/windows/win32/api/tapi/nf-tapi-linedevspecific) или [**фонедевспеЦифик**](/windows/win32/api/tapi/nf-tapi-phonedevspecific) .</span><span class="sxs-lookup"><span data-stu-id="2bef8-113">TAPI 2.x provides access to such operations through the [**lineDevSpecific**](/windows/win32/api/tapi/nf-tapi-linedevspecific) or [**phoneDevSpecific**](/windows/win32/api/tapi/nf-tapi-phonedevspecific) function.</span></span> <span data-ttu-id="2bef8-114">Интерфейс TAPI 3. x предоставляет [интерфейсы, зависящие от поставщика](./provider-specific-interfaces.md).</span><span class="sxs-lookup"><span data-stu-id="2bef8-114">TAPI 3.x exposes [provider-specific Interfaces](./provider-specific-interfaces.md).</span></span>

<span data-ttu-id="2bef8-115">На следующей схеме показан поток управления и сведения, в которых показан один изолированный TSP (Unimodem) и одна пара TSP/MSP (H. 323).</span><span class="sxs-lookup"><span data-stu-id="2bef8-115">The following diagram illustrates the flow of controls and information, showing one stand-alone TSP (Unimodem) and one TSP/MSP pair (H.323).</span></span>

![изолированный TSP и сопряженный поток управления и информации по TSP/MSP](images/tsp-msp1.png)

<span data-ttu-id="2bef8-117">На следующей схеме показан ход выполнения входящего вызова, включающего как TSP, так и MSP.</span><span class="sxs-lookup"><span data-stu-id="2bef8-117">The following diagram illustrates the progress of an incoming call that involves both a TSP and an MSP.</span></span>

![входящий вызов с помощью TSP и MSP](images/tspmspin.png)

## <a name="incoming-call-setup"></a><span data-ttu-id="2bef8-119">Настройка входящего вызова</span><span class="sxs-lookup"><span data-stu-id="2bef8-119">Incoming Call Setup</span></span>

-   <span data-ttu-id="2bef8-120">TSP отправляет сообщение [**Line \_ НЕВКАЛЛ**](line-newcall.md) в таписрв.</span><span class="sxs-lookup"><span data-stu-id="2bef8-120">The TSP sends a [**LINE\_NEWCALL**](line-newcall.md) message to TAPISRV.</span></span> <span data-ttu-id="2bef8-121">[**Состояние вызова**](./linecallstate--constants.md) — линекаллстате \_ предложение.</span><span class="sxs-lookup"><span data-stu-id="2bef8-121">The [**call state**](./linecallstate--constants.md) is LINECALLSTATE\_OFFERING.</span></span>
-   <span data-ttu-id="2bef8-122">ТАПИСРВ уведомляет клиентов о вызове.</span><span class="sxs-lookup"><span data-stu-id="2bef8-122">TAPISRV notifies clients of the call.</span></span>
-   <span data-ttu-id="2bef8-123">TAPI3 создает объект вызова TAPI, а затем вызывает [**итмспаддресс:: креатемспкалл**](/windows/win32/api/tapi3/nf-tapi3-itmspaddress-createmspcall), который реализуется MSP.</span><span class="sxs-lookup"><span data-stu-id="2bef8-123">TAPI3 creates the TAPI Call object, then calls [**ITMSPAddress::CreateMSPCall**](/windows/win32/api/tapi3/nf-tapi3-itmspaddress-createmspcall), which is implemented by the MSP.</span></span>
-   <span data-ttu-id="2bef8-124">MSP создает объект вызова MSP и потоки по умолчанию на основе [**типов носителей**](./tapimediatype--constants.md) , необходимых для вызова.</span><span class="sxs-lookup"><span data-stu-id="2bef8-124">The MSP creates an MSP Call object and default streams based on the [**media types**](./tapimediatype--constants.md) required for the call.</span></span> <span data-ttu-id="2bef8-125">Он возвращает указатель IUnknown на объект вызова MSP.</span><span class="sxs-lookup"><span data-stu-id="2bef8-125">It returns an IUnknown pointer to the MSP call object.</span></span>
-   <span data-ttu-id="2bef8-126">TAPI3 выполняет статистическую обработку объекта вызова MSP в объект вызова TAPI, делая доступными для приложения такие интерфейсы, как [**итстреамконтрол**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) .</span><span class="sxs-lookup"><span data-stu-id="2bef8-126">TAPI3 aggregates the MSP Call object into the TAPI Call object, making interfaces such as [**ITStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) available to the application.</span></span> <span data-ttu-id="2bef8-127">Затем он уведомляет приложение о новом вызове.</span><span class="sxs-lookup"><span data-stu-id="2bef8-127">It then notifies the application of the new call.</span></span>

<span data-ttu-id="2bef8-128">Затем приложение может использовать такие методы, как [**итстреам:: селекттерминал**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal) , для завершения подготовительной подготовки к завершению вызова.</span><span class="sxs-lookup"><span data-stu-id="2bef8-128">The application may then use methods such as [**ITStream::SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal) to complete preparations for call completion.</span></span>

## <a name="incoming-call-completion"></a><span data-ttu-id="2bef8-129">Завершение входящего вызова</span><span class="sxs-lookup"><span data-stu-id="2bef8-129">Incoming Call Completion</span></span>

-   <span data-ttu-id="2bef8-130">Приложение вызывает [**итбасиккаллконтрол:: Answer**](/windows/win32/api/tapi3if/nf-tapi3if-itbasiccallcontrol-answer).</span><span class="sxs-lookup"><span data-stu-id="2bef8-130">The application calls [**ITBasicCallControl::Answer**](/windows/win32/api/tapi3if/nf-tapi3if-itbasiccallcontrol-answer).</span></span>
-   <span data-ttu-id="2bef8-131">TAPI3 вызывает [**линеансвер**](/windows/win32/api/tapi/nf-tapi-lineanswer).</span><span class="sxs-lookup"><span data-stu-id="2bef8-131">TAPI3 calls [**lineAnswer**](/windows/win32/api/tapi/nf-tapi-lineanswer).</span></span>
-   <span data-ttu-id="2bef8-132">ТАПИСЕРВ вызывает [**тспи \_ линеансвер**](/windows/win32/api/tspi/nf-tspi-tspi_lineanswer).</span><span class="sxs-lookup"><span data-stu-id="2bef8-132">TAPISERV calls [**TSPI\_lineAnswer**](/windows/win32/api/tspi/nf-tspi-tspi_lineanswer).</span></span>
-   <span data-ttu-id="2bef8-133">TSP инициирует потоковую передачу вызовов.</span><span class="sxs-lookup"><span data-stu-id="2bef8-133">The TSP initiates call streaming.</span></span> <span data-ttu-id="2bef8-134">Как правило, TSP отправляет сообщение соответствующему MSP-сообщению, а MSP запускает потоки.</span><span class="sxs-lookup"><span data-stu-id="2bef8-134">Usually, the TSP sends a message to the corresponding MSP, and the MSP starts the streams.</span></span> <span data-ttu-id="2bef8-135">В некоторых реализациях TSP/MSP, TSP запускает потоки.</span><span class="sxs-lookup"><span data-stu-id="2bef8-135">In some TSP/MSP implementations, the TSP starts the streams.</span></span>

## <a name="tspmsp-communication-during-call-progress"></a><span data-ttu-id="2bef8-136">Обмен данными между TSP и MSP во время выполнения вызова</span><span class="sxs-lookup"><span data-stu-id="2bef8-136">TSP/MSP Communication During Call Progress</span></span>

<span data-ttu-id="2bef8-137">После выполнения вызова TSP и MSP обмениваются данными, передавая непрозрачные буферы через ТАПИСРВ и TAPI3.</span><span class="sxs-lookup"><span data-stu-id="2bef8-137">After the call is in progress, the TSP and the MSP communicate by passing opaque buffers through TAPISRV and TAPI3.</span></span>

-   <span data-ttu-id="2bef8-138">TSP отправляет сведения в MSP, отправляя сообщение [**Line \_ СЕНДМСПДАТА**](line-sendmspdata.md) в таписрв.</span><span class="sxs-lookup"><span data-stu-id="2bef8-138">The TSP sends information to the MSP by sending the [**LINE\_SENDMSPDATA**](line-sendmspdata.md) message to TAPISRV.</span></span>
-   <span data-ttu-id="2bef8-139">MSP получает сведения от TSP с помощью метода [**итмспаддресс:: рецеиветспдата**](/windows/win32/api/tapi3/nf-tapi3-itmspaddress-receivetspdata) .</span><span class="sxs-lookup"><span data-stu-id="2bef8-139">The MSP receives information from the TSP through the [**ITMSPAddress::ReceiveTSPData**](/windows/win32/api/tapi3/nf-tapi3-itmspaddress-receivetspdata) method.</span></span> <span data-ttu-id="2bef8-140">Если данные связаны с объектом вызова MSP, в качестве параметра этого метода предоставляется указатель интерфейса на объект вызова MSP.</span><span class="sxs-lookup"><span data-stu-id="2bef8-140">If the data is related to a MSP call object, an interface pointer to the MSP call object is provided as a parameter of that method.</span></span>
-   <span data-ttu-id="2bef8-141">MSP отправляет сведения в TSP, отправляя событие MSP- \_ \_ данных TSP в интерфейс TAPI 3.</span><span class="sxs-lookup"><span data-stu-id="2bef8-141">The MSP sends information to the TSP by sending a MSP\_TSP\_DATA event to TAPI 3.</span></span>
-   <span data-ttu-id="2bef8-142">TSP получает сведения из MSP с помощью функции [**тспи \_ линерецеивемспдата**](/windows/win32/api/tspi/nf-tspi-tspi_linereceivemspdata) .</span><span class="sxs-lookup"><span data-stu-id="2bef8-142">The TSP receives information from the MSP through the [**TSPI\_lineReceiveMSPData**](/windows/win32/api/tspi/nf-tspi-tspi_linereceivemspdata) function.</span></span>

<span data-ttu-id="2bef8-143">Точный процесс и содержимое взаимодействия между поставщиками служб относится к заданному TSP/MSP-набору.</span><span class="sxs-lookup"><span data-stu-id="2bef8-143">The exact process and content of communication between service providers is specific to a given TSP/MSP set.</span></span>

> [!Note]  
> <span data-ttu-id="2bef8-144">Для исходящих вызовов MSP обычно знает о вызове до TSP.</span><span class="sxs-lookup"><span data-stu-id="2bef8-144">For outgoing calls, the MSP typically knows about the call before the TSP.</span></span> <span data-ttu-id="2bef8-145">Если MSP пытается связаться с TSP до информирования о вызове TSP, произойдет сбой связи.</span><span class="sxs-lookup"><span data-stu-id="2bef8-145">If the MSP tries to communicate with the TSP before the TSP is informed about a call, the communication will fail.</span></span> <span data-ttu-id="2bef8-146">Когда MSP и TSP должны обмениваться информацией, относящейся к конкретному вызову, TSP следует инициировать обмен данными.</span><span class="sxs-lookup"><span data-stu-id="2bef8-146">When the MSP and the TSP need to exchange information concerning a specific call, the TSP should initiate communication.</span></span>

 

 

 
