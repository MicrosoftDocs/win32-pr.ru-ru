---
description: Операция, которая завершается асинхронно, выполняет часть своей обработки в вызове функции, сделанной приложением, и остаток от него в независимом потоке выполнения после того, как TAPI 2. x возвращался из вызова функции.
ms.assetid: 37b544e4-6413-4741-b8b6-ec676ce4ca97
title: Асинхронные функции
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 135e792a4b1d6a25a4f49fbb2abe2c19ce3071ad
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105674029"
---
# <a name="asynchronous-functions"></a><span data-ttu-id="8bfb8-103">Асинхронные функции</span><span class="sxs-lookup"><span data-stu-id="8bfb8-103">Asynchronous Functions</span></span>

<span data-ttu-id="8bfb8-104">Операция, которая завершается асинхронно, выполняет часть своей обработки в вызове функции, сделанной приложением, и остаток от него в независимом потоке выполнения после того, как TAPI 2. x возвращался из вызова функции.</span><span class="sxs-lookup"><span data-stu-id="8bfb8-104">An operation that completes asynchronously performs part of its processing in the function call made by the application and the remainder of it in an independent execution thread after TAPI 2.x has returned from the function call.</span></span> <span data-ttu-id="8bfb8-105">Чтобы обеспечить завершение обработки вызова, поставщик услуг применяет запрос к другой активной сущности в системе (например, к серверу локальной сети, оборудованию, коммутатору или сети), а затем возвращает в приложение.</span><span class="sxs-lookup"><span data-stu-id="8bfb8-105">To ensure completion of the call's processing, the service provider vectors the request to another active entity in the system—such as a LAN server, add-in hardware, a switch, or a network—and then returns to the application.</span></span> <span data-ttu-id="8bfb8-106">В настоящее время приложению возвращается отрицательный результат ошибки или положительный идентификатор запроса.</span><span class="sxs-lookup"><span data-stu-id="8bfb8-106">At this time, either a negative error result or a positive request identifier is returned to the application.</span></span>

<span data-ttu-id="8bfb8-107">Во время асинхронного завершения (поставщик услуг получил прерывание от оборудования, что означает, что сообщение должно быть доставлено), поставщик услуг вызывает ТАПИСРВ и сообщает о том, что только что произошло событие *X* .</span><span class="sxs-lookup"><span data-stu-id="8bfb8-107">At the time of asynchronous completion (the service provider has received an interrupt from the hardware, meaning that a message must be delivered), the service provider calls TAPISRV and reports that "Event *X* has just taken place.</span></span> <span data-ttu-id="8bfb8-108">Доставьте соответствующее сообщение всем заинтересованным приложениям».</span><span class="sxs-lookup"><span data-stu-id="8bfb8-108">Deliver an appropriate message to all concerned applications."</span></span> <span data-ttu-id="8bfb8-109">Когда ТАПИСРВ получает это сообщение, он пересылает сообщение в библиотеку динамической компоновки TAPI в процессе приложения, который, в свою очередь, отправляет сообщение окна, сигнализирует об обработке события или отправляет его в порт завершения ввода-вывода в соответствии со схемой уведомлений о сообщениях, выбранной приложением в [**линеинитиализикс**](/windows/win32/api/tapi/nf-tapi-lineinitializeexa) или [**фонеинитиализикс**](/windows/win32/api/tapi/nf-tapi-phoneinitializeexa).</span><span class="sxs-lookup"><span data-stu-id="8bfb8-109">When TAPISRV receives this message, it forwards the message to the TAPI dynamic-link library, in the application's process, which in turn posts a window message, signals an event handle, or posts to an I/O completion port, according to the message notification scheme selected by the application in [**lineInitializeEx**](/windows/win32/api/tapi/nf-tapi-lineinitializeexa) or [**phoneInitializeEx**](/windows/win32/api/tapi/nf-tapi-phoneinitializeexa).</span></span>

<span data-ttu-id="8bfb8-110">По завершении асинхронной части операции в приложение отправляется [**сообщение \_ ответа строки**](./line-reply.md) (или [**телефонного \_ ответа**](./phone-reply.md)).</span><span class="sxs-lookup"><span data-stu-id="8bfb8-110">When the asynchronous portion of the operation completes, a [**LINE\_REPLY**](./line-reply.md) (or [**PHONE\_REPLY**](./phone-reply.md)) message is sent to the application.</span></span> <span data-ttu-id="8bfb8-111">Это сообщение содержит в качестве одного из параметров идентификатор запроса, возвращенный вызовом функции.</span><span class="sxs-lookup"><span data-stu-id="8bfb8-111">This message contains, as one of its parameters, the request identifier returned by the function call.</span></span> <span data-ttu-id="8bfb8-112">Этот идентификатор запроса позволяет приложению определить, какой исходный запрос завершен.</span><span class="sxs-lookup"><span data-stu-id="8bfb8-112">This request identifier allows the application to determine which original request has completed.</span></span> <span data-ttu-id="8bfb8-113">(Приложения должны запомнить идентификаторы всех выполняемых запросов, чтобы можно было правильно обработать ответные сообщения.) Вторым параметром для \_ сообщения ответа строки (или телефонного \_ ответа) является асинхронное возвращаемое значение.</span><span class="sxs-lookup"><span data-stu-id="8bfb8-113">(Applications should remember the request identifiers of all their requests in progress so that reply messages can be properly handled.) A second parameter to the LINE\_REPLY (or PHONE\_REPLY) message is the asynchronous return value.</span></span> <span data-ttu-id="8bfb8-114">Это либо отрицательное значение (для ошибки), либо нуль, если операция завершилась успешно.</span><span class="sxs-lookup"><span data-stu-id="8bfb8-114">This is either a negative value (for an error) or zero if the operation completed successfully.</span></span> <span data-ttu-id="8bfb8-115">Для асинхронных операций любое из возвращаемых значений может быть возвращено как часть возвращаемого значения функции или как параметр *dwParam2* в ответе на строку \_ или на \_ ответное сообщение.</span><span class="sxs-lookup"><span data-stu-id="8bfb8-115">For asynchronous operations, any of the return values may be returned as part of the function return or as the *dwParam2* parameter in the LINE\_REPLY or PHONE\_REPLY message.</span></span> <span data-ttu-id="8bfb8-116">Значение 0, которое указывает на успешное выполнение, будет возвращаться только в ответ на строку \_ и никогда не в качестве возвращаемого значения функции.</span><span class="sxs-lookup"><span data-stu-id="8bfb8-116">The value 0, which indicates success, will only be returned in the LINE\_REPLY message, and never as the function's return value.</span></span>

<span data-ttu-id="8bfb8-117">Функции инициализации ( [**линеинитиализикс**](/windows/win32/api/tapi/nf-tapi-lineinitializeexa) и [**фонеинитиализикс**](/windows/win32/api/tapi/nf-tapi-phoneinitializeexa)) сообщают TAPI, как отправить эти сообщения в приложение.</span><span class="sxs-lookup"><span data-stu-id="8bfb8-117">The initialize functions ( [**lineInitializeEx**](/windows/win32/api/tapi/nf-tapi-lineinitializeexa) and [**phoneInitializeEx**](/windows/win32/api/tapi/nf-tapi-phoneinitializeexa)) tell TAPI how to send these messages to the application.</span></span>

> [!Note]  
> <span data-ttu-id="8bfb8-118">В некоторых случаях, если многопоточное приложение вызывает асинхронную функцию из потока, отличного от потока, из которого приложение инициализирует линию или телефонное устройство, приложение может получить [**\_ ответ строки**](./line-reply.md) или ответ на [**Телефон \_**](./phone-reply.md) перед возвратом асинхронной функции.</span><span class="sxs-lookup"><span data-stu-id="8bfb8-118">In some cases, if a multithreaded application calls an asynchronous function from a thread other than the thread from which the application initialized the line or phone device, the application may receive the [**LINE\_REPLY**](./line-reply.md) or [**PHONE\_REPLY**](./phone-reply.md) message before the asynchronous function has returned.</span></span> <span data-ttu-id="8bfb8-119">В таких случаях приложение должно сохранить параметры сообщения и подождать, пока асинхронная функция не вернет значение, а идентификатор запроса будет известен перед обработкой сообщения.</span><span class="sxs-lookup"><span data-stu-id="8bfb8-119">In such cases, the application should save the message parameters and wait until the asynchronous function returns and the request identifier is known before processing the message.</span></span>

 

 

 
