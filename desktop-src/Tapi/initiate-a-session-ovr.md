---
description: Основным фрагментом информации, предоставляемой приложением для инициации сеанса связи, является тип адреса, тип или типы носителя, а также адрес назначения.
ms.assetid: 65e53587-0e40-411b-8d6c-d6adfc9d1e6c
title: Инициация сеанса
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9e925ba90460b88c85a9aab1624923acdbc4572a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103898625"
---
# <a name="initiate-a-session"></a><span data-ttu-id="92473-103">Инициация сеанса</span><span class="sxs-lookup"><span data-stu-id="92473-103">Initiate a Session</span></span>

<span data-ttu-id="92473-104">Основным фрагментом информации, предоставляемой приложением для инициации сеанса связи, является [тип адреса](address-type-ovr.md), тип или типы [носителя](media-type-ovr.md) , а также [адрес](address-ovr.md)назначения.</span><span class="sxs-lookup"><span data-stu-id="92473-104">The primary pieces of information an application supplies to initiate a communications session are the [address type](address-type-ovr.md), the [media type](media-type-ovr.md) or types, and the destination [address](address-ovr.md).</span></span>

<span data-ttu-id="92473-105">Адресу назначения может потребоваться [Преобразование адреса](#address-translation) для размещения информации, введенной пользователем, в правильный формат для заданного типа адреса.</span><span class="sxs-lookup"><span data-stu-id="92473-105">The destination address may require [address translation](#address-translation) to put the information entered by a user into the proper format for a given address type.</span></span> <span data-ttu-id="92473-106">Например, номер телефона, [находящегося](address-ovr.md) в электронной адресной книге в [каноническом](address-ovr.md) формате, потребует перевода в формат, поддерживаемый набором.</span><span class="sxs-lookup"><span data-stu-id="92473-106">For example, a phone number that was in an electronic address book in [canonical](address-ovr.md) format will require translation to [dialable](address-ovr.md) format.</span></span>

<span data-ttu-id="92473-107">Некоторые сеансы могут требовать специальных параметров установки, если они поддерживаются поставщиком услуг.</span><span class="sxs-lookup"><span data-stu-id="92473-107">Some sessions may require special setup parameters, if supported by the service provider.</span></span> <span data-ttu-id="92473-108">Например, TSP ISDN может передавать сведения о пользователях, а некоторым MSP требуются сведения о направлении потока мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="92473-108">For example, an ISDN TSP can transmit user-user information, and some MSPs require information about media stream direction.</span></span> <span data-ttu-id="92473-109">Ознакомьтесь с [информацией о сеансе](session-information-ovr.md) , чтобы просмотреть данные, которые могут быть заданы или получены в ходе сеанса.</span><span class="sxs-lookup"><span data-stu-id="92473-109">Please see [Session Information](session-information-ovr.md) for a review of data that may be set or obtained concerning a session.</span></span>

<span data-ttu-id="92473-110">После инициации сеанса TAPI уведомляет приложение о ходе вызова, используя механизм уведомления о событиях, настроенный во время инициализации.</span><span class="sxs-lookup"><span data-stu-id="92473-110">Once a session has been initiated, TAPI will inform the application of call progress using the event notification mechanism set up during initialization.</span></span>

<span data-ttu-id="92473-111">**Интерфейс TAPI 2. x:** Приложения инициируют сеанс с помощью функции [**линемакекалл**](/windows/win32/api/tapi/nf-tapi-linemakecall) .</span><span class="sxs-lookup"><span data-stu-id="92473-111">**TAPI 2.x:** Applications initiate a session using the [**lineMakeCall**](/windows/win32/api/tapi/nf-tapi-linemakecall) function.</span></span> <span data-ttu-id="92473-112">Функция [**линетранслатеаддресс**](/windows/win32/api/tapi/nf-tapi-linetranslateaddress) используется для выполнения преобразования адресов, если это необходимо.</span><span class="sxs-lookup"><span data-stu-id="92473-112">The [**lineTranslateAddress**](/windows/win32/api/tapi/nf-tapi-linetranslateaddress) function is used to perform address translation, if required.</span></span>

<span data-ttu-id="92473-113">Параметры установки вызова могут храниться в структуре данных [**линекаллпарамс**](/windows/win32/api/tapi/ns-tapi-linecallparams) , а указатель на эту структуру используется в качестве параметра [**линемакекалл**](/windows/win32/api/tapi/nf-tapi-linemakecall).</span><span class="sxs-lookup"><span data-stu-id="92473-113">Call setup parameters can be stored in the [**LINECALLPARAMS**](/windows/win32/api/tapi/ns-tapi-linecallparams) data structure, and a pointer to this structure is then used as a parameter of [**lineMakeCall**](/windows/win32/api/tapi/nf-tapi-linemakecall).</span></span> <span data-ttu-id="92473-114">Если для **линемакекалл** не указана структура **линекаллпарамс** , запрашивается вызов по умолчанию POTS-класса с набором значений по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="92473-114">If no **LINECALLPARAMS** structure is supplied to **lineMakeCall**, a default POTS voice-grade call is requested with a set of default values.</span></span>

<span data-ttu-id="92473-115">Если сеанс успешно настроен, то в приложение возвращается маркер вызова с  [правами](privilege-ovr.md) владельца, а TAPI отправляет [**\_ каллстате**](./line-callstate.md) сообщения в строке приложения с информацией о ходе выполнения вызова.</span><span class="sxs-lookup"><span data-stu-id="92473-115">If the session is set up successfully, a call handle with *owner* [privileges](privilege-ovr.md) is returned to the application and TAPI sends the application [**LINE\_CALLSTATE**](./line-callstate.md) messages with information concerning the call's progress.</span></span> <span data-ttu-id="92473-116">Приложения обычно используют эти сообщения для вывода отчетов о состоянии пользователю.</span><span class="sxs-lookup"><span data-stu-id="92473-116">Applications typically use these messages to display status reports to the user.</span></span>

<span data-ttu-id="92473-117">**Интерфейс TAPI 3. x:** Приложения инициируют сеанс связи, вызывая метод [**итаддресс:: креатекалл**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddress-createcall) для адреса, способного обрабатывать требуемый тип адреса и тип носителя.</span><span class="sxs-lookup"><span data-stu-id="92473-117">**TAPI 3.x:** Applications initiate a communications session by invoking the [**ITAddress::CreateCall**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddress-createcall) method on an address capable of handling the address type and media type required.</span></span> <span data-ttu-id="92473-118">Если адрес предоставляет интерфейс [**иттерминалсуппорт**](/windows/win32/api/tapi3if/nn-tapi3if-itterminalsupport) , терминалы выбираются в потоках мультимедиа объекта Call.</span><span class="sxs-lookup"><span data-stu-id="92473-118">If the address exposes the [**ITTerminalSupport**](/windows/win32/api/tapi3if/nn-tapi3if-itterminalsupport) interface, terminals are selected onto the media streams of the call object.</span></span> <span data-ttu-id="92473-119">Иллюстрация этого процесса приведена в примере кода [вызова метода make](make-a-call.md) .</span><span class="sxs-lookup"><span data-stu-id="92473-119">See the [Make a Call](make-a-call.md) code example for an illustration of this process.</span></span>

<span data-ttu-id="92473-120">Параметры установки вызова можно сохранять или изменять с помощью методов, предоставляемых интерфейсом [**иткаллинфо**](/windows/desktop/api/tapi3if/nn-tapi3if-itcallinfo) .</span><span class="sxs-lookup"><span data-stu-id="92473-120">Call setup parameters can be stored or changed using methods exposed by the [**ITCallInfo**](/windows/desktop/api/tapi3if/nn-tapi3if-itcallinfo) interface.</span></span>

<span data-ttu-id="92473-121">Если сеанс настроен успешно, TAPI возвращает указатель интерфейса [**итбасиккаллконтрол**](/windows/desktop/api/tapi3if/nn-tapi3if-itbasiccallcontrol) , который может использоваться для дальнейших операций сеанса, или для получения указателя на интерфейс [**иткаллинфо**](/windows/desktop/api/tapi3if/nn-tapi3if-itcallinfo) , который можно использовать для получения дополнительных сведений о сеансе.</span><span class="sxs-lookup"><span data-stu-id="92473-121">If the session is set up successfully, TAPI returns an [**ITBasicCallControl**](/windows/desktop/api/tapi3if/nn-tapi3if-itbasiccallcontrol) interface pointer that can be used for further session operations, or to obtain an [**ITCallInfo**](/windows/desktop/api/tapi3if/nn-tapi3if-itcallinfo) interface pointer that can be used to acquire additional session information.</span></span> <span data-ttu-id="92473-122">Интерфейс [**иткаллстативент**](/windows/desktop/api/tapi3if/nn-tapi3if-itcallstateevent) обрабатывает события состояния вызова TAPI.</span><span class="sxs-lookup"><span data-stu-id="92473-122">The [**ITCallStateEvent**](/windows/desktop/api/tapi3if/nn-tapi3if-itcallstateevent) interface processes TAPI call state events.</span></span>

> [!Note]  
> <span data-ttu-id="92473-123">TAPI не следует использовать для передачи факсов.</span><span class="sxs-lookup"><span data-stu-id="92473-123">TAPI should not be used for fax transmissions.</span></span> <span data-ttu-id="92473-124">Вместо этого используйте функции, доступные через MAPI, API обмена сообщениями Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="92473-124">Instead, use the functions available through MAPI, the Microsoft Messaging API.</span></span>

 

## <a name="address-translation"></a><span data-ttu-id="92473-125">Преобразование адреса</span><span class="sxs-lookup"><span data-stu-id="92473-125">Address Translation</span></span>

<span data-ttu-id="92473-126">Приложение для конечных пользователей или серверов может хранить адреса в формате, который не совместим с потребностями данного поставщика услуг.</span><span class="sxs-lookup"><span data-stu-id="92473-126">An end-user or server application may store addresses in a format that is not compatible with the needs of a given service provider.</span></span> <span data-ttu-id="92473-127">Например, номер телефона может храниться в электронной адресной книге в [каноническом формате](address-ovr.md), но большинству поставщиков услуг, которые обрабатывали номера телефонов, требуется [набор для набора](address-ovr.md).</span><span class="sxs-lookup"><span data-stu-id="92473-127">For example, a phone number may be stored in an electronic address book in [canonical format](address-ovr.md), but most service providers that handle phone numbers require the [dialable format](address-ovr.md).</span></span>

<span data-ttu-id="92473-128">TAPI предоставляет операции преобразования адресов, которые помогают приложению представлять правильный тип адреса для TSP.</span><span class="sxs-lookup"><span data-stu-id="92473-128">TAPI supplies address translation operations that assist an application in presenting the correct address type to a TSP.</span></span> <span data-ttu-id="92473-129">Поставщик услуг указывает TAPI, какие типы адресов он поддерживает, и не обязаны включать в себя никаких форм преобразования адресов.</span><span class="sxs-lookup"><span data-stu-id="92473-129">The service provider specifies to TAPI which address types it supports, and need not include any form of address translation.</span></span>

<span data-ttu-id="92473-130">**Интерфейс TAPI 2. x:** См. [**линетранслатеаддресс**](/windows/win32/api/tapi/nf-tapi-linetranslateaddress).</span><span class="sxs-lookup"><span data-stu-id="92473-130">**TAPI 2.x:** See [**lineTranslateAddress**](/windows/win32/api/tapi/nf-tapi-linetranslateaddress).</span></span>

<span data-ttu-id="92473-131">**TAPI 3:** См. раздел [**итаддресстранслатион**](/windows/desktop/api/tapi3if/nn-tapi3if-itaddresstranslation), [**итаддресстранслатионинфо**](/windows/desktop/api/tapi3if/nn-tapi3if-itaddresstranslationinfo).</span><span class="sxs-lookup"><span data-stu-id="92473-131">**TAPI 3:** See [**ITAddressTranslation**](/windows/desktop/api/tapi3if/nn-tapi3if-itaddresstranslation), [**ITAddressTranslationInfo**](/windows/desktop/api/tapi3if/nn-tapi3if-itaddresstranslationinfo).</span></span>

## <a name="toll-lists"></a><span data-ttu-id="92473-132">Списки платного звонка</span><span class="sxs-lookup"><span data-stu-id="92473-132">Toll Lists</span></span>

<span data-ttu-id="92473-133">В некоторых местах Северная Америка все телефонные звонки, размещенные в локальном коде города, являются локальными вызовами.</span><span class="sxs-lookup"><span data-stu-id="92473-133">In some locations in North America, all telephone calls placed to the local area code are local calls.</span></span> <span data-ttu-id="92473-134">В других местах некоторые вызовы, помещенные в местный код города, являются длинными и требуют префикса "1" для набора.</span><span class="sxs-lookup"><span data-stu-id="92473-134">In other locations, some calls placed to the local area code are long distance, and need a "1" prefix to be dialed.</span></span> <span data-ttu-id="92473-135">Первые три цифры адреса (префикс) определяют, является ли вызов в пределах местного кода города платным вызовом.</span><span class="sxs-lookup"><span data-stu-id="92473-135">The first three digits of the address (the prefix) determine whether or not a call within the local area code is a toll call.</span></span>

<span data-ttu-id="92473-136">*Платный список* — это список префиксов в локальном коде города, адреса которых должны быть набраны в виде длинных адресов и которые оплачиваются по долгосрочной разнице.</span><span class="sxs-lookup"><span data-stu-id="92473-136">A *toll list* is a list of prefixes in the local area code whose addresses must be dialed as long-distance addresses, and are assessed long-distance charges.</span></span>

<span data-ttu-id="92473-137">Списки платных номеров не относятся к поставщикам услуг или к приложениям, которые не обращаются к телефонной сети.</span><span class="sxs-lookup"><span data-stu-id="92473-137">Toll lists are not relevant to service providers, or to applications that do not access a telephone network.</span></span>

<span data-ttu-id="92473-138">**Интерфейс TAPI 2. x:** См. раздел [**линетранслатеаддресс**](/windows/win32/api/tapi/nf-tapi-linetranslateaddress) (линетранслатересулт \_ интолллист and линетранслатересулт \_ Нотинтолллист BITS в структуре [**LINETRANSLATEOUTPUT**](/windows/win32/api/tapi/ns-tapi-linetranslateoutput) ), [**lineSetTollList**](/windows/win32/api/tapi/nf-tapi-linesettolllist).</span><span class="sxs-lookup"><span data-stu-id="92473-138">**TAPI 2.x:** See [**lineTranslateAddress**](/windows/win32/api/tapi/nf-tapi-linetranslateaddress) (LINETRANSLATERESULT\_INTOLLLIST and LINETRANSLATERESULT\_NOTINTOLLLIST bits in the [**LINETRANSLATEOUTPUT**](/windows/win32/api/tapi/ns-tapi-linetranslateoutput) structure), [**lineSetTollList**](/windows/win32/api/tapi/nf-tapi-linesettolllist).</span></span>

<span data-ttu-id="92473-139">**TAPI 3:** См. раздел [**итаддресстранслатион:: транслатеаддресс**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddresstranslation-translateaddress), [**итаддресстранслатионинфо:: Get \_ транслатионресултс**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddresstranslationinfo-get_translationresults).</span><span class="sxs-lookup"><span data-stu-id="92473-139">**TAPI 3:** See [**ITAddressTranslation::TranslateAddress**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddresstranslation-translateaddress), [**ITAddressTranslationInfo::get\_TranslationResults**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddresstranslationinfo-get_translationresults).</span></span>

 

 
