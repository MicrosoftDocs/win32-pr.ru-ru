---
description: В архитектуре TAPI все специалистами выполняются в контексте ТАПИСРВ, который реализуется как процесс службы в SVCHOST.
ms.assetid: f47662f9-2fca-4044-ab26-617e5b1f9eae
title: Архитектура MSP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e8c1229ddce90f79c122c47572b4567d230b0b4e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104423602"
---
# <a name="msp-architecture"></a><span data-ttu-id="f82e9-103">Архитектура MSP</span><span class="sxs-lookup"><span data-stu-id="f82e9-103">MSP Architecture</span></span>

<span data-ttu-id="f82e9-104">В архитектуре TAPI все специалистами выполняются в контексте ТАПИСРВ, который реализуется как процесс службы в SVCHOST.</span><span class="sxs-lookup"><span data-stu-id="f82e9-104">In TAPI architecture, all TSPs are run in the context of TAPISRV, which is implemented as a service process within SVCHOST.</span></span> <span data-ttu-id="f82e9-105">Приложения TAPI находятся в собственном процессе.</span><span class="sxs-lookup"><span data-stu-id="f82e9-105">TAPI applications live in their own process.</span></span> <span data-ttu-id="f82e9-106">Приложения TAPI загружают Tapi3.dll и все необходимые MSP в свой собственный процесс, а библиотека DLL TAPI взаимодействует с ТАПИСРВ через частный интерфейс RPC.</span><span class="sxs-lookup"><span data-stu-id="f82e9-106">TAPI applications load Tapi3.dll and any needed MSPs into their own process, and the TAPI DLL communicates with TAPISRV through a private RPC interface.</span></span> <span data-ttu-id="f82e9-107">На следующей схеме показано взаимодействие этих компонентов.</span><span class="sxs-lookup"><span data-stu-id="f82e9-107">The following diagram illustrates the interaction of these components.</span></span>

![взаимодействие между таписрв, приложениями TAPI и MSP](images/tsp-msp1.png)

<span data-ttu-id="f82e9-109">Поставщик службы мультимедиа (MSP) обеспечивает потоковую передачу мультимедиа с помощью абстракций терминалов, потоков и подпотоков.</span><span class="sxs-lookup"><span data-stu-id="f82e9-109">A media service provider (MSP) provides media streaming using the abstractions of Terminals, Streams, and SubStreams.</span></span>

<span data-ttu-id="f82e9-110">Терминал — это приемник или источник для потока мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="f82e9-110">A Terminal is a sink or source for a media stream.</span></span> <span data-ttu-id="f82e9-111">Это может быть физический объект, например громкоговоритель или микрофон, или абстракция устройства, например видеоокно.</span><span class="sxs-lookup"><span data-stu-id="f82e9-111">It may be a physical object, such as a speaker or a microphone, or it may be an abstraction of a device, such as a video window.</span></span> <span data-ttu-id="f82e9-112">[Объект терминала](terminal-object.md) предоставляет интерфейс [**иттерминал**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) .</span><span class="sxs-lookup"><span data-stu-id="f82e9-112">The [Terminal Object](terminal-object.md) exposes the [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) interface.</span></span> <span data-ttu-id="f82e9-113">Класс терминала описывается идентификатором GUID [**класса терминала**](terminal-class.md) .</span><span class="sxs-lookup"><span data-stu-id="f82e9-113">The class of terminal is described by the [**Terminal Class**](terminal-class.md) GUID.</span></span> <span data-ttu-id="f82e9-114">MSP может определять собственные классы терминалов.</span><span class="sxs-lookup"><span data-stu-id="f82e9-114">An MSP may define its own terminal classes.</span></span>

<span data-ttu-id="f82e9-115">Потоки делят носитель вызова, основываясь на типе или типе [**носителя**](tapimediatype--constants.md) , [**направлении**](/windows/desktop/api/Tapi3if/ne-tapi3if-terminal_direction)потока и адресе назначения носителя.</span><span class="sxs-lookup"><span data-stu-id="f82e9-115">Streams divide the media of a call based on the [**media type**](tapimediatype--constants.md) or type, the stream's [**direction**](/windows/desktop/api/Tapi3if/ne-tapi3if-terminal_direction), and the destination address of the media.</span></span> <span data-ttu-id="f82e9-116">Например, входящий поток аудиопотока от модема — это объект потока, исходящий поток видео с IP-адресом и портом — объект потока, видеопотоки, поступающие из многоадресной группы IP-адресов, также рассматриваются как один объект потока.</span><span class="sxs-lookup"><span data-stu-id="f82e9-116">For example, an incoming audio stream from a modem is a stream object, an outgoing video stream to an IP address and port is a stream object, the video streams coming from a IP multicast group are also considered as one stream object.</span></span> <span data-ttu-id="f82e9-117">Объект потока представлен интерфейсом [**итстреамконтрол**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) .</span><span class="sxs-lookup"><span data-stu-id="f82e9-117">The Stream object is represented by the [**ITStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) interface.</span></span>

<span data-ttu-id="f82e9-118">Подпотоки обеспечивают более точный контроль над носителем.</span><span class="sxs-lookup"><span data-stu-id="f82e9-118">SubStreams allow finer control over the media.</span></span> <span data-ttu-id="f82e9-119">Например, в случае многоадресной IP-рассылки входящий объект видеопотока может представлять несколько людей.</span><span class="sxs-lookup"><span data-stu-id="f82e9-119">For example, in the IP multicast case, the incoming video stream object might represent several people.</span></span> <span data-ttu-id="f82e9-120">Скорее всего, каждому участнику будет назначен отдельный модуль подготовки отчетов.</span><span class="sxs-lookup"><span data-stu-id="f82e9-120">The application will most likely want each participant to have a separate renderer.</span></span> <span data-ttu-id="f82e9-121">Входящий поток видео можно разделить на несколько подпотоков, по одному для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="f82e9-121">The incoming video stream can be divided into several substreams, one for each person.</span></span> <span data-ttu-id="f82e9-122">Один подпоток соответствует одному пользователю, и его можно настраивать и контролировать отдельно.</span><span class="sxs-lookup"><span data-stu-id="f82e9-122">One substream would correspond to one person, and can be configured and controlled separately.</span></span> <span data-ttu-id="f82e9-123">Объект подпотока представлен интерфейсом [**итсубстреамконтрол**](/windows/win32/api/tapi3if/nn-tapi3if-itsubstreamcontrol) .</span><span class="sxs-lookup"><span data-stu-id="f82e9-123">The SubStream object is represented by the [**ITSubStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itsubstreamcontrol) interface.</span></span>

<span data-ttu-id="f82e9-124">Когда приложение вызывает [**итаддресс:: креатекалл**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddress-createcall) для настройки вызова, оно должно указывать тип требуемого носителя.</span><span class="sxs-lookup"><span data-stu-id="f82e9-124">When an application calls [**ITAddress::CreateCall**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddress-createcall) to set up a call, it must specify the type of media required.</span></span> <span data-ttu-id="f82e9-125">При исходящем вызове он просто сообщает TAPI о создании вызова.</span><span class="sxs-lookup"><span data-stu-id="f82e9-125">On an outgoing call, it simply tells TAPI when the call is created.</span></span> <span data-ttu-id="f82e9-126">Пример:</span><span class="sxs-lookup"><span data-stu-id="f82e9-126">For example:</span></span>

``` syntax
HRESULT hr = pAddress->CreateCall( 
       pszDestAddress, 
       lAddressType, 
       TAPIMEDIATYPE_AUDIO | TAPIMEDIATYPE_VIDEO, 
       &pCall 
       ); 
// If (hr != S_OK ) process the error here
```

<span data-ttu-id="f82e9-127">В этом случае приложение создает исходящий вызов аудио-видео.</span><span class="sxs-lookup"><span data-stu-id="f82e9-127">In this case, the application is creating an outgoing audio-video call.</span></span>

<span data-ttu-id="f82e9-128">Переданные типы мультимедиа указывают на носитель, в течение которого приложение заинтересовано в течение времени существования вызова.</span><span class="sxs-lookup"><span data-stu-id="f82e9-128">The media types passed in indicate the media that the application is interested in over the lifetime of the call.</span></span> <span data-ttu-id="f82e9-129">Например, приложение может указать аудио и видео при создании вызова, но в начале выберите только звуковые терминалы.</span><span class="sxs-lookup"><span data-stu-id="f82e9-129">For example, the application may specify audio and video when creating the call, but select only audio terminals at the beginning.</span></span> <span data-ttu-id="f82e9-130">MSP начнет потоковую передачу аудио, но не будет отклонять локальный или удаленный видеозапрос, сделанный позже во время существования вызова.</span><span class="sxs-lookup"><span data-stu-id="f82e9-130">The MSP will start streaming only audio, but will not reject a local or remote video request made later in the lifetime of the call.</span></span>

<span data-ttu-id="f82e9-131">Когда приложение вызывает [**итбасиккаллконтрол:: Connect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-connect), TAPI 3 вызывает [**ТСПИ \_ линемакекалл**](/windows/win32/api/tspi/nf-tspi-tspi_linemakecall) в TSP.</span><span class="sxs-lookup"><span data-stu-id="f82e9-131">When the application then calls [**ITBasicCallControl::Connect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-connect), TAPI 3 calls [**TSPI\_lineMakeCall**](/windows/win32/api/tspi/nf-tspi-tspi_linemakecall) in the TSP.</span></span> <span data-ttu-id="f82e9-132">После установления вызова MSP и TSP могут взаимодействовать по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="f82e9-132">After a call is established, the MSP and TSP can communicate as necessary.</span></span>

<span data-ttu-id="f82e9-133">Когда вызов отключается, он настраивает MSP и TSP для обмена данными о разрыве вызова.</span><span class="sxs-lookup"><span data-stu-id="f82e9-133">When a call is disconnecting, it is up to the MSP and TSP to communicate about tearing down the call.</span></span> <span data-ttu-id="f82e9-134">Tapi3.dll будет вызывать [**тспи \_ линедроп**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) , если приложение вызывает [**Отключение**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-disconnect).</span><span class="sxs-lookup"><span data-stu-id="f82e9-134">Tapi3.dll will call [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) if the application calls [**Disconnect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-disconnect).</span></span>

 

 
