---
description: Общие требования к реализации подключаемого терминала перечислены ниже.
ms.assetid: 7cee19b1-ceea-494a-b576-4deede759905
title: Реализация подключаемых терминалов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 494b2f6bc5ccb214bc7101f570a4db3037fd8cae
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105683606"
---
# <a name="implementing-pluggable-terminals"></a><span data-ttu-id="b7021-103">Реализация подключаемых терминалов</span><span class="sxs-lookup"><span data-stu-id="b7021-103">Implementing Pluggable Terminals</span></span>

<span data-ttu-id="b7021-104">Общие требования к реализации подключаемого терминала:</span><span class="sxs-lookup"><span data-stu-id="b7021-104">The general requirements for pluggable terminal implementation are:</span></span>

-   <span data-ttu-id="b7021-105">Базовый код потоковой передачи терминала должен соответствовать возможностям требуемого MSP.</span><span class="sxs-lookup"><span data-stu-id="b7021-105">A pluggable terminal's underlying streaming code should match the capabilities of the desired MSPs.</span></span>
-   <span data-ttu-id="b7021-106">Терминал должен использовать фильтры DirectShow для работы с большинством MSP (это предполагается здесь).</span><span class="sxs-lookup"><span data-stu-id="b7021-106">The terminal must use DirectShow filters to work with most MSPs (this is assumed from here on).</span></span>
-   <span data-ttu-id="b7021-107">Для большинства MSP звуковые терминалы должны поддерживать 8-битный моно линейный PCM с + кГц.</span><span class="sxs-lookup"><span data-stu-id="b7021-107">Audio terminals must support 8 kHz 16-bit mono linear PCM for most MSPs.</span></span>
-   <span data-ttu-id="b7021-108">Терминал должен включить бесплатный потоковый маршалинг, реализовав [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span><span class="sxs-lookup"><span data-stu-id="b7021-108">The terminal should enable free threaded marshalling by implementing [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span></span> <span data-ttu-id="b7021-109">Терминал может сделать это, вызвав интерфейс API COM [**кокреатефрисреадедмаршалер**](/windows/win32/api/combaseapi/nf-combaseapi-cocreatefreethreadedmarshaler) и выполнив статистическую обработку **IMarshal** в возвращенном указателе.</span><span class="sxs-lookup"><span data-stu-id="b7021-109">The terminal can do this by calling the COM API [**CoCreateFreeThreadedMarshaler**](/windows/win32/api/combaseapi/nf-combaseapi-cocreatefreethreadedmarshaler) and aggregating **IMarshal** to the returned pointer.</span></span> <span data-ttu-id="b7021-110">Деструктор объекта терминала должен вызывать [**IMarshal->выпуск**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span><span class="sxs-lookup"><span data-stu-id="b7021-110">The terminal object's destructor should call [**IMarshal->Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span></span>
-   <span data-ttu-id="b7021-111">Терминал должен реализовывать или выполнять статистическую обработку любых дополнительных интерфейсов, зависящих от терминала.</span><span class="sxs-lookup"><span data-stu-id="b7021-111">The terminal should implement or aggregate any additional terminal-specific interfaces that are appropriate.</span></span>
-   <span data-ttu-id="b7021-112">Реализация терминала должна быть потокобезопасной.</span><span class="sxs-lookup"><span data-stu-id="b7021-112">The terminal implementation must be thread-safe.</span></span>
-   <span data-ttu-id="b7021-113">Реализация терминала должна \# включать терммгр. h для определения [**иттерминалконтрол**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol).</span><span class="sxs-lookup"><span data-stu-id="b7021-113">The terminal implementation must \#include Termmgr.h for the definition of [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol).</span></span> <span data-ttu-id="b7021-114">Это дополнение к обычным включаемым и библиотекам, необходимым для приложений TAPI 3 или TAPI 3 под управлением Windows 2000 с пакетом обновления 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="b7021-114">This is in addition to the usual includes and libs that are needed for TAPI 3 or TAPI 3 applications under Windows 2000 SP1.</span></span>

<span data-ttu-id="b7021-115">Примечания по реализации интерфейса и метода:</span><span class="sxs-lookup"><span data-stu-id="b7021-115">Interface and method implementation notes:</span></span>

<span data-ttu-id="b7021-116">В терминале должен быть реализован [**иттерминал**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) (сдвоенный интерфейс — vtable + [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch)).</span><span class="sxs-lookup"><span data-stu-id="b7021-116">The terminal must implement [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) (dual interface–vtable + [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch)).</span></span>

[<span data-ttu-id="b7021-117">**Иттерминал:: Get \_ терминалкласс**</span><span class="sxs-lookup"><span data-stu-id="b7021-117">**ITTerminal::get\_TerminalClass**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_terminalclass)

<span data-ttu-id="b7021-118">Терминал должен **вернуть представление идентификатора** GUID, который вы выбрали, чтобы определить тип терминала.</span><span class="sxs-lookup"><span data-stu-id="b7021-118">The terminal must return a **BSTR** representation of a GUID you've picked that identifies your type of terminal.</span></span> <span data-ttu-id="b7021-119">Выделение **BSTR** через [**сисаллокстринг**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span><span class="sxs-lookup"><span data-stu-id="b7021-119">Allocate the **BSTR** via [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span></span> <span data-ttu-id="b7021-120">Чтобы преобразовать GUID в **BSTR**, вызовите [**стрингфромклсид**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid), **сисаллокстринг** и [**CoTaskMemFree**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemfree).</span><span class="sxs-lookup"><span data-stu-id="b7021-120">To convert from GUID to **BSTR**, call [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid), **SysAllocString**, and [**CoTaskMemFree**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemfree).</span></span>

[<span data-ttu-id="b7021-121">**Иттерминал:: Get \_ терминалтипе**</span><span class="sxs-lookup"><span data-stu-id="b7021-121">**ITTerminal::get\_TerminalType**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_terminaltype)

<span data-ttu-id="b7021-122">Как правило, терминал должен возвращать TT \_ dynamic, если приложение реализует терминал.</span><span class="sxs-lookup"><span data-stu-id="b7021-122">The terminal should generally return TT\_DYNAMIC if an application implements the terminal.</span></span> <span data-ttu-id="b7021-123">\_Кроме того, возвращается значение TT static, и возврат этого значения может быть уместным, если терминал соответствует устройству, однако это может вызвать путаницу в работе пользователей, поскольку статический терминал не будет присутствовать в статическом перечислении терминала MSP.</span><span class="sxs-lookup"><span data-stu-id="b7021-123">Returning TT\_STATIC will also work, and returning this value may be appropriate if the terminal corresponds to a hardware device; however, doing this may be confusing to users because a static terminal will not be present in the MSP's static terminal enumeration.</span></span>

[<span data-ttu-id="b7021-124">**Иттерминал:: получение \_ состояния**</span><span class="sxs-lookup"><span data-stu-id="b7021-124">**ITTerminal::get\_State**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state)

<span data-ttu-id="b7021-125">Если в реализации терминала произвольно не ограничивается число потоков, к которым может подключиться терминал, то терминал должен всегда возвращать TS \_ нотинусе.</span><span class="sxs-lookup"><span data-stu-id="b7021-125">If the terminal implementation does not arbitrarily limit the number of streams that the terminal can be concurrently connected to, then the terminal should always return TS\_NOTINUSE.</span></span>

<span data-ttu-id="b7021-126">В противном случае реализация терминала произвольно ограничивает количество потоков, к которым может подключаться терминал.</span><span class="sxs-lookup"><span data-stu-id="b7021-126">Otherwise, the terminal implementation arbitrarily limits the number of streams that the terminal can be connected to at a time.</span></span> <span data-ttu-id="b7021-127">В этом случае терминал должен учитывать количество потоков, к которым он подключен.</span><span class="sxs-lookup"><span data-stu-id="b7021-127">In this case, the terminal should keep a count of how many streams it is connected to.</span></span> <span data-ttu-id="b7021-128">Терминал должен увеличить это внутреннее число при успешном вызове [**иттерминалконтрол:: коннекттерминал**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) и уменьшить его при успешном вызове [**Иттерминалконтрол::D исконнекттерминал**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal) .</span><span class="sxs-lookup"><span data-stu-id="b7021-128">The terminal should increment this internal count on a successful [**ITTerminalControl::ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) call and decrement it on a successful [**ITTerminalControl::DisconnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal) call.</span></span> <span data-ttu-id="b7021-129">В [**иттерминал:: Get \_ State**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state)должен вернуть TS INUSE, \_ Если этот счетчик равен максимальному числу потоков, которые может одновременно выбрать терминал. в противном случае он должен вернуть TS \_ нотинусе.</span><span class="sxs-lookup"><span data-stu-id="b7021-129">In [**ITTerminal::get\_State**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state), it should return TS\_INUSE if this count is equal to the maximum number of streams that the terminal can be selected on at a time; otherwise, it should return TS\_NOTINUSE.</span></span> <span data-ttu-id="b7021-130">Обратите внимание, что если предельное значение равно единице, то счетчик может просто быть логическим или \_ значением состояния терминала.</span><span class="sxs-lookup"><span data-stu-id="b7021-130">Note that if the limit is one, the count can simply be a Boolean or a TERMINAL\_STATE value.</span></span>

[<span data-ttu-id="b7021-131">**Иттерминал:: Get \_ Name**</span><span class="sxs-lookup"><span data-stu-id="b7021-131">**ITTerminal::get\_Name**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_name)

<span data-ttu-id="b7021-132">Терминал должен вернуть выбранное имя **BSTR** , выделенное через [**сисаллокстринг**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span><span class="sxs-lookup"><span data-stu-id="b7021-132">The terminal should return a **BSTR** name of its choice, allocated via [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span></span> <span data-ttu-id="b7021-133">Это имя должно быть понятным для пользователя и должно быть локализовано.</span><span class="sxs-lookup"><span data-stu-id="b7021-133">This name should be meaningful to the user and should be localized.</span></span>

[<span data-ttu-id="b7021-134">**Иттерминал:: Get \_ mediaType**</span><span class="sxs-lookup"><span data-stu-id="b7021-134">**ITTerminal::get\_MediaType**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_mediatype)

<span data-ttu-id="b7021-135">Терминал должен вернуть тип носителя ТАПИМЕДИАТИПЕ \_ Audio или тапимедиатипе \_ Video.</span><span class="sxs-lookup"><span data-stu-id="b7021-135">The terminal should return its media type, either TAPIMEDIATYPE\_AUDIO or TAPIMEDIATYPE\_VIDEO.</span></span>

[<span data-ttu-id="b7021-136">**Иттерминал:: получить \_ направление**</span><span class="sxs-lookup"><span data-stu-id="b7021-136">**ITTerminal::get\_Direction**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_direction)

<span data-ttu-id="b7021-137">Терминал возвращает \_ значение перечисления, указывающее направление терминала.</span><span class="sxs-lookup"><span data-stu-id="b7021-137">The terminal returns the TERMINAL\_DIRECTION enum value indicating the direction of the terminal.</span></span> <span data-ttu-id="b7021-138">Если терминал является двунаправленным (например, мостом), он должен возвращать значение TD \_ двунаправленный.</span><span class="sxs-lookup"><span data-stu-id="b7021-138">If the terminal is bidirectional (for example, a bridge), then it must return TD\_BIDIRECTIONAL.</span></span>

<span data-ttu-id="b7021-139">Терминал должен реализовывать [**иттерминалконтрол**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) (только vtable).</span><span class="sxs-lookup"><span data-stu-id="b7021-139">The terminal must implement [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) (vtable only).</span></span>

[<span data-ttu-id="b7021-140">**Иттерминалконтрол:: Get \_ аддресшандле**</span><span class="sxs-lookup"><span data-stu-id="b7021-140">**ITTerminalControl::get\_AddressHandle**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-get_addresshandle)

<span data-ttu-id="b7021-141">Терминал, предоставляемый приложением, должен всегда возвращать **значение NULL** в качестве маркера адреса.</span><span class="sxs-lookup"><span data-stu-id="b7021-141">An application-provided terminal should always return **NULL** as the address handle.</span></span> <span data-ttu-id="b7021-142">Это указывает MSP, что этот терминал не был создан на заданном объекте адреса MSP.</span><span class="sxs-lookup"><span data-stu-id="b7021-142">This indicates to the MSP that this terminal was not created on a specific MSP address object.</span></span>

[<span data-ttu-id="b7021-143">**Иттерминалконтрол:: Коннекттерминал**</span><span class="sxs-lookup"><span data-stu-id="b7021-143">**ITTerminalControl::ConnectTerminal**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal)

<span data-ttu-id="b7021-144">В этом вызове терминал добавит свои фильтры к заданному графу и подключится друг к другу, если это применимо.</span><span class="sxs-lookup"><span data-stu-id="b7021-144">On this call, the terminal will add its filter(s) to the given graph and connect them to each other, if applicable.</span></span> <span data-ttu-id="b7021-145">Затем терминал должен вернуть ПИН-коды, предоставленные терминалом, для указанного направления потока.</span><span class="sxs-lookup"><span data-stu-id="b7021-145">Then the terminal should return the pin(s) exposed by the terminal for the stream direction specified.</span></span>

<span data-ttu-id="b7021-146">Терминал, который не поддерживает одновременный доступ к нескольким потокам, задаст внутренней переменной значение TS \_ INUSE при успешном завершении этого метода.</span><span class="sxs-lookup"><span data-stu-id="b7021-146">A terminal that does not support concurrent connection to multiple streams would set an internal variable to TS\_INUSE on successful completion of this method.</span></span>

<span data-ttu-id="b7021-147">Терминал может использовать параметр *двтерминалдиректион* из этого вызова для определения направления потока, к которому он подключен.</span><span class="sxs-lookup"><span data-stu-id="b7021-147">The terminal can use the *dwTerminalDirection* parameter from this call to determine the direction of the stream that it is being connected to.</span></span> <span data-ttu-id="b7021-148">Это необходимо для двунаправленных терминалов.</span><span class="sxs-lookup"><span data-stu-id="b7021-148">This is required for bidirectional terminals.</span></span>

> [!Note]  
> <span data-ttu-id="b7021-149">Обычно (в базовых классах MSP и во всех известных Mspах) поток MSP не сможет подключиться, если терминал возвращает более одного ПИН-кода из одного вызова [**коннекттерминал**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) .</span><span class="sxs-lookup"><span data-stu-id="b7021-149">Typically (in the MSP base classes and in all known MSPs), the MSP stream code will fail the connection if the terminal returns more than one pin from a single [**ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) call.</span></span> <span data-ttu-id="b7021-150">Это нормально, так как терминал, возвращающий более одного ПИН-кода во время подключения, требует, чтобы MSP имел специальные знания о терминале, чтобы эффективно использовать лишние контакты.</span><span class="sxs-lookup"><span data-stu-id="b7021-150">This is fine, because a terminal that returns more than one pin during connection requires the MSP to have special knowledge of the terminal to make use of the extra pins effectively.</span></span>

 

[<span data-ttu-id="b7021-151">**Иттерминалконтрол:: Комплетеконнекттерминал**</span><span class="sxs-lookup"><span data-stu-id="b7021-151">**ITTerminalControl::CompleteConnectTerminal**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-completeconnectterminal)

<span data-ttu-id="b7021-152">Терминал должен просто вернуть S \_ ОК.</span><span class="sxs-lookup"><span data-stu-id="b7021-152">The terminal should just return S\_OK.</span></span> <span data-ttu-id="b7021-153">Терминал также может выполнить инициализацию после подключения, если это необходимо.</span><span class="sxs-lookup"><span data-stu-id="b7021-153">The terminal may also do post-connection initialization if it needs to.</span></span>

[<span data-ttu-id="b7021-154">**Иттерминалконтрол::D Исконнекттерминал**</span><span class="sxs-lookup"><span data-stu-id="b7021-154">**ITTerminalControl::DisconnectTerminal**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal)

<span data-ttu-id="b7021-155">Терминал должен выполнить все необходимое для отключения терминала от остальной части графа.</span><span class="sxs-lookup"><span data-stu-id="b7021-155">The terminal should do whatever is needed to disconnect the terminal from the rest of the graph.</span></span> <span data-ttu-id="b7021-156">Обычно это подразумевает удаление всех фильтров терминалов из графа и установка состояния терминала TS \_ нотинусе.</span><span class="sxs-lookup"><span data-stu-id="b7021-156">Typically this involves removing all the terminals' filters from the graph and setting the terminal state to TS\_NOTINUSE.</span></span>

[<span data-ttu-id="b7021-157">**Иттерминалконтрол:: Рунрендерфилтер**</span><span class="sxs-lookup"><span data-stu-id="b7021-157">**ITTerminalControl::RunRenderFilter**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-runrenderfilter)

<span data-ttu-id="b7021-158">Терминал должен просто вернуть E \_ нотимпл.</span><span class="sxs-lookup"><span data-stu-id="b7021-158">The terminal should just return E\_NOTIMPL.</span></span>

[<span data-ttu-id="b7021-159">**Иттерминалконтрол:: Стопрендерфилтер**</span><span class="sxs-lookup"><span data-stu-id="b7021-159">**ITTerminalControl::StopRenderFilter**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-stoprenderfilter)

<span data-ttu-id="b7021-160">Терминал должен просто вернуть E \_ нотимпл.</span><span class="sxs-lookup"><span data-stu-id="b7021-160">The terminal should just return E\_NOTIMPL.</span></span>

 

 
