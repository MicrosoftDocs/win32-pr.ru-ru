---
description: Предположим, что поставщик услуг должен отобразить диалоговое окно (например, диалоговое окно Unimodem или АТСП, разрыв соединения) во время обработки Линемакекалл или Линедиал.
ms.assetid: 46f87947-bfcd-48ad-8c33-7ea4d9caa34c
title: Функции, не предназначенные для создания пользовательского интерфейса
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 70bd7ed1395136d1a2d2a31b060127395e8804ac
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104545447"
---
# <a name="functions-not-designed-to-generate-ui"></a>Функции, не предназначенные для создания пользовательского интерфейса

Предположим, что поставщик услуг должен отобразить диалоговое окно (например, диалоговое окно Unimodem или АТСП, **разрыв соединения** ) во время обработки [**линемакекалл**](/windows/win32/api/tapi/nf-tapi-linemakecall) или [**линедиал**](/windows/win32/api/tapi/nf-tapi-linedial). В этом случае это поставщик услуг, а не приложение, которое решает, что пользовательский интерфейс должен быть отображен.

Для вызова библиотеки DLL пользовательского интерфейса в процессе приложения поставщик услуг вызывает обратный вызов [*\_ события строки*](/windows/win32/api/tspi/nc-tspi-lineevent) тспи, создавая сообщение [**\_ креатедиалогинстанце**](line-createdialoginstance.md) строки, передавая указатель на структуру типа [**туиспикреатедиалогинстанцепарамс**](/windows/win32/api/tspi/ns-tspi-tuispicreatedialoginstanceparams). Эта структура содержит **дврекуестид** функции, с которой связан пользовательский интерфейс, что позволяет таписрв определять клиентское приложение, в котором создается пользовательский интерфейс.

ТАПИСРВ запрашивает у нужного экземпляра приложения TAPI для загрузки библиотеки DLL пользовательского интерфейса и создания потока для пользовательского интерфейса в процессе приложения. В этом новом потоке пользовательского интерфейса TAPI вызывает функцию [**туиспи \_ ПРОВИДЕРЖЕНЕРИКДИАЛОГ**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) в DLL пользовательского интерфейса, передавая данные, указанные поставщиком услуг телефонии в структуре, передаваемой с помощью сообщения [**Line \_ креатедиалогинстанце**](line-createdialoginstance.md) . в библиотеке DLL пользовательского интерфейса отображается соответствующее диалоговое окно (это важно для частного проектирования между библиотекой DLL пользовательского интерфейса и поставщиком услуг телефонии). Библиотека DLL пользовательского интерфейса не возвращает из **туиспи \_ провидерженерикдиалог** , пока не закроется диалоговое окно.

Поставщик услуг телефонии может формировать обновленные данные, отображаемые в диалоговом окне (или, например, указывать, что диалоговое окно закрывается, если вызов прерван или происходят другие события), отправив сообщение [**Line \_ сенддиалогинстанцедата**](line-senddialoginstancedata.md) . ТАПИСРВ передает данные в TAPI, который вызывает функцию [**\_ провидерженерикдиалогдата туиспи**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialogdata) пользовательского интерфейса. Этот механизм обеспечивает однонаправленную отправку в библиотеку DLL пользовательского интерфейса. Если библиотека DLL пользовательского интерфейса хочет сообщить поставщику услуг телефонии о результатах диалогового окна или получить другие данные, она может вызвать функцию [*дллкаллбаккпрок*](/windows/win32/api/tspi/nc-tspi-tuispidllcallback) (указатель, полученный при вызове [**туиспи \_ провидерженерикдиалог**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) ).

Когда диалоговое окно закрывается, [**туиспи \_ провидерженерикдиалог**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) возвращает в TAPI. TAPI вызывает [**FreeLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-freelibrary) для освобождения библиотеки DLL пользовательского интерфейса и завершает поток пользовательского интерфейса, созданный в контексте приложения. Затем он запрашивает ТАПИСРВ для вызова функции [**тспи \_ провидерфридиалогинстанце**](/windows/win32/api/tspi/nf-tspi-tspi_providerfreedialoginstance) поставщика услуг телефонии, чтобы отменить привязку ассоциации, созданной, когда поставщик услуг телефонии первоначально отправил [**строку \_ креатедиалогинстанце**](line-createdialoginstance.md) Message. Эта функция также вызывается, если процесс приложения неожиданно завершается до того, как **туиспи \_ провидерженерикдиалог** возвращает.

 

 
