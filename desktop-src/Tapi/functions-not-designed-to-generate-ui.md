---
description: Предположим, что поставщик услуг должен отобразить диалоговое окно (например, диалоговое окно Unimodem или АТСП, разрыв соединения) во время обработки Линемакекалл или Линедиал.
ms.assetid: 46f87947-bfcd-48ad-8c33-7ea4d9caa34c
title: Функции, не предназначенные для создания пользовательского интерфейса
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 70bd7ed1395136d1a2d2a31b060127395e8804ac
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104545447"
---
# <a name="functions-not-designed-to-generate-ui"></a><span data-ttu-id="35101-103">Функции, не предназначенные для создания пользовательского интерфейса</span><span class="sxs-lookup"><span data-stu-id="35101-103">Functions Not Designed to Generate UI</span></span>

<span data-ttu-id="35101-104">Предположим, что поставщик услуг должен отобразить диалоговое окно (например, диалоговое окно Unimodem или АТСП, **разрыв соединения** ) во время обработки [**линемакекалл**](/windows/win32/api/tapi/nf-tapi-linemakecall) или [**линедиал**](/windows/win32/api/tapi/nf-tapi-linedial).</span><span class="sxs-lookup"><span data-stu-id="35101-104">Assume that the service provider must display a dialog box (like the Unimodem or ATSP **Talk/Hangup** dialog box) during the processing of [**lineMakeCall**](/windows/win32/api/tapi/nf-tapi-linemakecall) or [**lineDial**](/windows/win32/api/tapi/nf-tapi-linedial).</span></span> <span data-ttu-id="35101-105">В этом случае это поставщик услуг, а не приложение, которое решает, что пользовательский интерфейс должен быть отображен.</span><span class="sxs-lookup"><span data-stu-id="35101-105">In this case, it is the service provider, not the application, that decides that UI must be displayed.</span></span>

<span data-ttu-id="35101-106">Для вызова библиотеки DLL пользовательского интерфейса в процессе приложения поставщик услуг вызывает обратный вызов [*\_ события строки*](/windows/win32/api/tspi/nc-tspi-lineevent) тспи, создавая сообщение [**\_ креатедиалогинстанце**](line-createdialoginstance.md) строки, передавая указатель на структуру типа [**туиспикреатедиалогинстанцепарамс**](/windows/win32/api/tspi/ns-tspi-tuispicreatedialoginstanceparams).</span><span class="sxs-lookup"><span data-stu-id="35101-106">To invoke the UI DLL in the application process, the service provider calls the TSPI [*Line\_Event*](/windows/win32/api/tspi/nc-tspi-lineevent) callback, generating a [**LINE\_CREATEDIALOGINSTANCE**](line-createdialoginstance.md) message, passing in a pointer to a structure of type [**TUISPICREATEDIALOGINSTANCEPARAMS**](/windows/win32/api/tspi/ns-tspi-tuispicreatedialoginstanceparams).</span></span> <span data-ttu-id="35101-107">Эта структура содержит **дврекуестид** функции, с которой связан пользовательский интерфейс, что позволяет таписрв определять клиентское приложение, в котором создается пользовательский интерфейс.</span><span class="sxs-lookup"><span data-stu-id="35101-107">This structure contains the **dwRequestID** of the function with which the UI is associated, allowing TAPISRV to identify the client application in which the UI is to be generated.</span></span>

<span data-ttu-id="35101-108">ТАПИСРВ запрашивает у нужного экземпляра приложения TAPI для загрузки библиотеки DLL пользовательского интерфейса и создания потока для пользовательского интерфейса в процессе приложения.</span><span class="sxs-lookup"><span data-stu-id="35101-108">TAPISRV requests the correct application's instance of TAPI to load the UI DLL and create a thread for the UI within the application's process.</span></span> <span data-ttu-id="35101-109">В этом новом потоке пользовательского интерфейса TAPI вызывает функцию [**туиспи \_ ПРОВИДЕРЖЕНЕРИКДИАЛОГ**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) в DLL пользовательского интерфейса, передавая данные, указанные поставщиком услуг телефонии в структуре, передаваемой с помощью сообщения [**Line \_ креатедиалогинстанце**](line-createdialoginstance.md) . в библиотеке DLL пользовательского интерфейса отображается соответствующее диалоговое окно (это важно для частного проектирования между библиотекой DLL пользовательского интерфейса и поставщиком услуг телефонии).</span><span class="sxs-lookup"><span data-stu-id="35101-109">From this new UI thread, TAPI calls the UI DLL's [**TUISPI\_providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) function, passing in data that was specified by the telephony service provider in the structure passed in with the [**LINE\_CREATEDIALOGINSTANCE**](line-createdialoginstance.md) message; the UI DLL displays the appropriate dialog box (which is a matter for private design between the UI DLL and the telephony service provider).</span></span> <span data-ttu-id="35101-110">Библиотека DLL пользовательского интерфейса не возвращает из **туиспи \_ провидерженерикдиалог** , пока не закроется диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="35101-110">The UI DLL does not return from **TUISPI\_providerGenericDialog** until the dialog box is closed.</span></span>

<span data-ttu-id="35101-111">Поставщик услуг телефонии может формировать обновленные данные, отображаемые в диалоговом окне (или, например, указывать, что диалоговое окно закрывается, если вызов прерван или происходят другие события), отправив сообщение [**Line \_ сенддиалогинстанцедата**](line-senddialoginstancedata.md) .</span><span class="sxs-lookup"><span data-stu-id="35101-111">The telephony service provider can generate updated data to display in the dialog box (or, for example, instruct the dialog box to be closed, if the call is abandoned or other events occur) by sending a [**LINE\_SENDDIALOGINSTANCEDATA**](line-senddialoginstancedata.md) message.</span></span> <span data-ttu-id="35101-112">ТАПИСРВ передает данные в TAPI, который вызывает функцию [**\_ провидерженерикдиалогдата туиспи**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialogdata) пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="35101-112">TAPISRV conveys the data to TAPI, which calls the UI DLL's [**TUISPI\_providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialogdata) function.</span></span> <span data-ttu-id="35101-113">Этот механизм обеспечивает однонаправленную отправку в библиотеку DLL пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="35101-113">This mechanism provides a unidirectional "send" to the UI DLL.</span></span> <span data-ttu-id="35101-114">Если библиотека DLL пользовательского интерфейса хочет сообщить поставщику услуг телефонии о результатах диалогового окна или получить другие данные, она может вызвать функцию [*дллкаллбаккпрок*](/windows/win32/api/tspi/nc-tspi-tuispidllcallback) (указатель, полученный при вызове [**туиспи \_ провидерженерикдиалог**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) ).</span><span class="sxs-lookup"><span data-stu-id="35101-114">If the UI DLL wants to inform the telephony service provider of the results of the dialog box or obtain other data, it can call the [*DllCallbackProc*](/windows/win32/api/tspi/nc-tspi-tuispidllcallback) function (a pointer to which it received when [**TUISPI\_providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) was called).</span></span>

<span data-ttu-id="35101-115">Когда диалоговое окно закрывается, [**туиспи \_ провидерженерикдиалог**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) возвращает в TAPI.</span><span class="sxs-lookup"><span data-stu-id="35101-115">When the dialog box is dismissed, [**TUISPI\_providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) returns to TAPI.</span></span> <span data-ttu-id="35101-116">TAPI вызывает [**FreeLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-freelibrary) для освобождения библиотеки DLL пользовательского интерфейса и завершает поток пользовательского интерфейса, созданный в контексте приложения.</span><span class="sxs-lookup"><span data-stu-id="35101-116">TAPI calls [**FreeLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-freelibrary) to release the UI DLL, and exits the UI thread it had created in the application context.</span></span> <span data-ttu-id="35101-117">Затем он запрашивает ТАПИСРВ для вызова функции [**тспи \_ провидерфридиалогинстанце**](/windows/win32/api/tspi/nf-tspi-tspi_providerfreedialoginstance) поставщика услуг телефонии, чтобы отменить привязку ассоциации, созданной, когда поставщик услуг телефонии первоначально отправил [**строку \_ креатедиалогинстанце**](line-createdialoginstance.md) Message.</span><span class="sxs-lookup"><span data-stu-id="35101-117">It then requests TAPISRV to call the telephony service provider's [**TSPI\_providerFreeDialogInstance**](/windows/win32/api/tspi/nf-tspi-tspi_providerfreedialoginstance) function to unbind the association created when the telephony service provider originally sent the [**LINE\_CREATEDIALOGINSTANCE**](line-createdialoginstance.md) message.</span></span> <span data-ttu-id="35101-118">Эта функция также вызывается, если процесс приложения неожиданно завершается до того, как **туиспи \_ провидерженерикдиалог** возвращает.</span><span class="sxs-lookup"><span data-stu-id="35101-118">This function is also called if the application process terminates unexpectedly before **TUISPI\_providerGenericDialog** returns.</span></span>

 

 
