---
description: Интерактивная природа телефонии требует, чтобы TAPI был операционной средой в режиме реального времени.
ms.assetid: b8512588-ec28-4fbe-b47f-b900e2dba1f2
title: Синхронная или асинхронная модель
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 02b3d3b58e9704719e502fa3efc11bc4dc216479
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105683400"
---
# <a name="synchronousasynchronous-model"></a><span data-ttu-id="1c622-103">Синхронная или асинхронная модель</span><span class="sxs-lookup"><span data-stu-id="1c622-103">Synchronous/Asynchronous Model</span></span>

<span data-ttu-id="1c622-104">Интерактивная природа телефонии требует, чтобы TAPI был операционной средой в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="1c622-104">The interactive nature of telephony requires TAPI to be a real-time operating environment.</span></span> <span data-ttu-id="1c622-105">Многие функции TAPI должны быстро завершить работу и вернуть результаты в приложение в синхронном режиме.</span><span class="sxs-lookup"><span data-stu-id="1c622-105">Many of the TAPI functions are required to complete quickly and return their results to the application synchronously.</span></span> <span data-ttu-id="1c622-106">Другие функции (например, набор номера) не могут быть выполнены как можно быстрее и поэтому работают асинхронно.</span><span class="sxs-lookup"><span data-stu-id="1c622-106">Other functions (such as dialing) may not be able to complete as quickly and therefore operate asynchronously.</span></span>

<span data-ttu-id="1c622-107">Операции телефонии выполняются синхронно или асинхронно.</span><span class="sxs-lookup"><span data-stu-id="1c622-107">Telephony operations complete either synchronously or asynchronously.</span></span> <span data-ttu-id="1c622-108">Эти две модели различаются следующим образом.</span><span class="sxs-lookup"><span data-stu-id="1c622-108">These two models differ as follows.</span></span> <span data-ttu-id="1c622-109">*Синхронные функции* выполняют весь запрос, прежде чем потоку вызывающего объекта будет разрешено возвращать значение из вызова функции.</span><span class="sxs-lookup"><span data-stu-id="1c622-109">*Synchronous functions* execute the entire request before the caller's thread is allowed to return from the function call.</span></span> <span data-ttu-id="1c622-110">*Асинхронные функции* возвращают значение до того, как запрос будет выполнен полностью.</span><span class="sxs-lookup"><span data-stu-id="1c622-110">*Asynchronous functions* return before the request has executed in its entirety.</span></span> <span data-ttu-id="1c622-111">После последующего завершения асинхронного запроса поставщик услуг сообщает о завершении, вызвав процедуру обратного вызова, изначально предоставленную TAPI в начале последовательности инициализации.</span><span class="sxs-lookup"><span data-stu-id="1c622-111">When the asynchronous request later completes, the service provider reports the completion by calling a callback procedure that TAPI originally supplied to it early in the initialization sequence.</span></span>

-   <span data-ttu-id="1c622-112">В качестве первого параметра асинхронные операции имеют параметр с именем *дврекуестид* определенного типа. [ \_ ИД запроса](./drv-requestid.md) .</span><span class="sxs-lookup"><span data-stu-id="1c622-112">Asynchronous operations have a parameter named *dwRequestID* of the defined type [DRV\_REQUESTID](./drv-requestid.md) as their first parameter.</span></span> <span data-ttu-id="1c622-113">Такая операция выполняет часть своей обработки в вызове функции и оставшуюся часть ее обработки в независимом потоке выполнения после возвращения вызова функции.</span><span class="sxs-lookup"><span data-stu-id="1c622-113">Such an operation performs part of its processing in the function call and the remainder of its processing in an independent execution thread after the function call has returned.</span></span> <span data-ttu-id="1c622-114">Когда функция возвращает значение, возвращается отрицательный результат ошибки или (положительный) *дврекуестид* , переданный в вызове функции.</span><span class="sxs-lookup"><span data-stu-id="1c622-114">When the function returns, it returns either a negative error result or the (positive) *dwRequestID* that was passed in the function call.</span></span> <span data-ttu-id="1c622-115">Отрицательный результат ошибки указывает на то, что операция завершена (и завершилась ошибкой).</span><span class="sxs-lookup"><span data-stu-id="1c622-115">The negative error result indicates that the operation is complete (and failed).</span></span> <span data-ttu-id="1c622-116">Возвращаемый положительный *дврекуестид* указывает, что операция продолжится в отдельном потоке.</span><span class="sxs-lookup"><span data-stu-id="1c622-116">The positive *dwRequestID* returned indicates that the operation continues in the independent thread.</span></span> <span data-ttu-id="1c622-117">В этом случае поставщик услуг в конечном итоге вызывает [**асинхронную процедуру \_ завершения**](/windows/win32/api/tspi/nc-tspi-async_completion) , передавая *дврекуестид* и код результата, чтобы указать результат операции.</span><span class="sxs-lookup"><span data-stu-id="1c622-117">In such a case, the service provider eventually calls the [**ASYNC\_COMPLETION**](/windows/win32/api/tspi/nc-tspi-async_completion) procedure, passing the *dwRequestID* and a result code to indicate the outcome of the operation.</span></span> <span data-ttu-id="1c622-118">Код результата равен нулю для успешного выполнения или одного из того же набора (отрицательных) результатов ошибки.</span><span class="sxs-lookup"><span data-stu-id="1c622-118">The result code is zero for success or one of the same set of (negative) error results.</span></span> <span data-ttu-id="1c622-119">В любом случае поставщик услуг не должен возвращать ноль или любое положительное значение, кроме *дврекуестид* , из функции, обозначенной как асинхронная, так как это может привести к непредвиденным результатам.</span><span class="sxs-lookup"><span data-stu-id="1c622-119">In any case, the service provider must never return zero or any positive value other than *dwRequestID* from a function designated as asynchronous because doing so can produce unexpected results.</span></span> <span data-ttu-id="1c622-120">Поставщики услуг всегда должны копировать входные данные из памяти приложения в память поставщика услуг перед возвратом из асинхронной функции.</span><span class="sxs-lookup"><span data-stu-id="1c622-120">Service providers should always copy input data from application memory into service provider memory before returning from an asynchronous function.</span></span>
-   <span data-ttu-id="1c622-121">В синхронных операциях не *дврекуестид* в качестве первого параметра.</span><span class="sxs-lookup"><span data-stu-id="1c622-121">Synchronous operations do not have *dwRequestID* as their first parameter.</span></span> <span data-ttu-id="1c622-122">Такая операция выполняет всю обработку в потоке выполнения вызывающего объекта, возвращая окончательный результат при возврате.</span><span class="sxs-lookup"><span data-stu-id="1c622-122">Such an operation performs all of its processing in the caller's execution thread, returning the final result when it returns.</span></span> <span data-ttu-id="1c622-123">Результат равен нулю для успешного выполнения или отрицательного кода ошибки.</span><span class="sxs-lookup"><span data-stu-id="1c622-123">The result is zero for success or a negative error code for failure.</span></span> <span data-ttu-id="1c622-124">Поставщик услуг не вызывает [**асинхронное \_ Завершение**](/windows/win32/api/tspi/nc-tspi-async_completion) для синхронных операций.</span><span class="sxs-lookup"><span data-stu-id="1c622-124">The service provider does not call [**ASYNC\_COMPLETION**](/windows/win32/api/tspi/nc-tspi-async_completion) for synchronous operations.</span></span>

<span data-ttu-id="1c622-125">Интересно учитывать время обратного вызова "завершение" относительно момента возврата исходного запроса.</span><span class="sxs-lookup"><span data-stu-id="1c622-125">It is interesting to consider the timing of a "completion" callback relative to when the original request returns.</span></span> <span data-ttu-id="1c622-126">Обычный асинхронный запрос будет реализован поставщиком услуг, как в следующем псевдокоде:</span><span class="sxs-lookup"><span data-stu-id="1c622-126">A typical asynchronous request would be implemented by the service provider as in the following pseudocode:</span></span>

``` syntax
Some_request(Request_ID, ...) {
  check parameters for validity
  check device state for validity
  store Request_ID for Completion Interrupt Handler's use
  manipulate device registers to start physical operation
  return Request_ID  // to indicate asynch operation
}
Operation Completion Interrupt Handler: {
  if operation was successful then
    call "completion" callback passing Request_ID and "success"
  else
    call "completion" callback passing Request_ID and "error num"
  endif
}
```

<span data-ttu-id="1c622-127">Если операция выполняется очень быстро (или если исходный запрос возвращается очень медленно), то возможно, что обработчик прерываний, выполняемый при завершении физической операции, может быть запущен до возврата исходного запроса приложению или даже к TAPI.</span><span class="sxs-lookup"><span data-stu-id="1c622-127">If the operation completes very rapidly (or the original request returns very slowly), it is possible that the interrupt handler that runs when a physical operation completes may be triggered before the original request returns to the application or even to TAPI.</span></span> <span data-ttu-id="1c622-128">Такое поведение разрешено.</span><span class="sxs-lookup"><span data-stu-id="1c622-128">This behavior is allowed.</span></span> <span data-ttu-id="1c622-129">TAPI гарантирует, что окончательное уведомление о завершении приложения будет доставлено после возврата исходного запроса.</span><span class="sxs-lookup"><span data-stu-id="1c622-129">TAPI guarantees that the eventual completion notification to the application is delivered after the original request returns.</span></span>

<span data-ttu-id="1c622-130">**Интерфейс TAPI 2. x:** Список состояний, которые каждая из функций завершает синхронно или асинхронно отображаются в [справочнике по быстрой функции TAPI](./tapi-quick-function-reference.md).</span><span class="sxs-lookup"><span data-stu-id="1c622-130">**TAPI 2.x:** Lists which state whether each function completes synchronously or asynchronously appear in [TAPI Quick Function Reference](./tapi-quick-function-reference.md).</span></span>

 

 
