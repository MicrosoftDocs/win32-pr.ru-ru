---
description: Если у приложения есть права владельца для сеанса связи, приложение может передать владение другому приложению.
ms.assetid: d6d188c9-9cbd-45af-93f0-b78850374919
title: хандоффс
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 343815e35f1fc331c57c4aa2d9d311697cab7022
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673418"
---
# <a name="handoffs"></a><span data-ttu-id="cd131-103">хандоффс</span><span class="sxs-lookup"><span data-stu-id="cd131-103">Handoffs</span></span>

<span data-ttu-id="cd131-104">Если у приложения есть [права](privilege-ovr.md) владельца для сеанса связи, приложение может передать владение другому приложению.</span><span class="sxs-lookup"><span data-stu-id="cd131-104">When an application has owner [privilege](privilege-ovr.md) for a communications session, the application may choose to hand off ownership to another application.</span></span> <span data-ttu-id="cd131-105">Операция передачи обычно используется, чтобы разрешить изменение типа носителя вызова.</span><span class="sxs-lookup"><span data-stu-id="cd131-105">The handoff operation is normally used to allow the call's media type to be changed.</span></span> <span data-ttu-id="cd131-106">Приложение с наивысшим приоритетом для нового типа носителя должно принимать и обслуживать вызов.</span><span class="sxs-lookup"><span data-stu-id="cd131-106">The highest-priority application for the new media type should take and handle the call.</span></span> <span data-ttu-id="cd131-107">Изменение типа носителя обычно происходит по одной из следующих причин.</span><span class="sxs-lookup"><span data-stu-id="cd131-107">Media type changing usually occurs for one of the following reasons.</span></span>

<span data-ttu-id="cd131-108">**Пользовательская команда:** С помощью пользовательского интерфейса или оконных сообщений приложение узнает, что локальный пользователь хочет изменить тип носителя.</span><span class="sxs-lookup"><span data-stu-id="cd131-108">**User command:** Through a user interface or through window messages, the application learns that the local user wants to change media type.</span></span> <span data-ttu-id="cd131-109">Например, пользователь сообщил о новом целевом приложении (которое еще не является владельцем), чтобы получить существующий голосовой вызов для передачи данных.</span><span class="sxs-lookup"><span data-stu-id="cd131-109">For example, the user has told the new target application (which is not yet an owner) to obtain an existing voice call for transmitting data.</span></span> <span data-ttu-id="cd131-110">Теперь целевое приложение должно управлять вызовом.</span><span class="sxs-lookup"><span data-stu-id="cd131-110">The target application must now take control of the call.</span></span> <span data-ttu-id="cd131-111">В этом случае текущий владелец заметит число владельцев, которые увеличиваются, а затем отменяют свой контроль над вызовом.</span><span class="sxs-lookup"><span data-stu-id="cd131-111">In this case, the current owner notices the number of owners increase, and then relinquishes its control of the call.</span></span> <span data-ttu-id="cd131-112">Кроме того, пользователь может указать текущему владельцу вызова передать его в приложение, которое может обрабатывать новый тип мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="cd131-112">Alternatively, the user could instruct the current owner of the call to hand it off to an application that can handle the new media type.</span></span>

<span data-ttu-id="cd131-113">**Изменение типа носителя:** Поставщик услуг может обнаружить изменение типа носителя.</span><span class="sxs-lookup"><span data-stu-id="cd131-113">**Media type change:** The service provider can detect a media type change.</span></span> <span data-ttu-id="cd131-114">Например, локальное приложение воспроизводит записанное голосовое сообщение вызывающему.</span><span class="sxs-lookup"><span data-stu-id="cd131-114">For example, the local application is playing a recorded voice message to the caller.</span></span> <span data-ttu-id="cd131-115">Во время этого сообщения вызывающий объект недостаточным образом решает передать сигнал вызова факса, а локальное приложение может отвечать на запросы, изменяя тип носителя на Fax и, при необходимости, вызывая приложение факса.</span><span class="sxs-lookup"><span data-stu-id="cd131-115">During this message, the caller spontaneously decides to transmit a fax calling tone, and the local application can respond accordingly by changing the media type to fax and, if necessary, handing the call off to a fax application.</span></span> <span data-ttu-id="cd131-116">Другим способом это можно сделать, чтобы приложение мониторинга включило мониторинг типа мультимедиа, а при обнаружении типа носителя, который он заинтересован в вызове, он может запросить владение вызовом.</span><span class="sxs-lookup"><span data-stu-id="cd131-116">Another way this can work is for a monitoring application to enable media type monitoring, and, when the media type in which it is interested is detected on a call, it can request ownership of the call.</span></span> <span data-ttu-id="cd131-117">Этот механизм не требуется для каждого приложения, чтобы отслеживать каждый вызов для каждого типа носителя.</span><span class="sxs-lookup"><span data-stu-id="cd131-117">This mechanism makes it unnecessary for every application to monitor every call for every media type.</span></span>

<span data-ttu-id="cd131-118">**Команда удаленной стороны:** Удаленная сторона может в интерактивном режиме указывать на изменение типов мультимедиа во время существующего вызова, например, если локальное приложение отслеживает входные данные DTMF удаленным вызывающим объектом.</span><span class="sxs-lookup"><span data-stu-id="cd131-118">**Remote party command:** The remote party can interactively indicate a change in media types during an existing call, such as if the local application is monitoring DTMF input by the remote caller.</span></span> <span data-ttu-id="cd131-119">В рамках этого мониторинга вызывающий объект указывает, например, что Факс будет отправлен.</span><span class="sxs-lookup"><span data-stu-id="cd131-119">Through this monitoring, the caller indicates, for example, that a fax is about to be sent.</span></span> <span data-ttu-id="cd131-120">Другим способом управления локальными приложениями может быть команда, полученная при других подключениях к данным и с помощью сообщений о пользователях ISDN.</span><span class="sxs-lookup"><span data-stu-id="cd131-120">Other ways the caller can control local applications are with commands received on other data connections and through ISDN user-user information messages.</span></span>

<span data-ttu-id="cd131-121">Переданный вызов будет иметь один из следующих результатов:</span><span class="sxs-lookup"><span data-stu-id="cd131-121">A call handoff will have one of these outcomes:</span></span>

-   <span data-ttu-id="cd131-122">Вызов передается другому приложению (успешно).</span><span class="sxs-lookup"><span data-stu-id="cd131-122">The call is given to another application (SUCCESS).</span></span>
-   <span data-ttu-id="cd131-123">Пользовательское приложение является целевым объектом (ТАРЖЕТСЕЛФ).</span><span class="sxs-lookup"><span data-stu-id="cd131-123">The handing-off application is itself the target (TARGETSELF).</span></span>
-   <span data-ttu-id="cd131-124">Сбой передачи (ТАРЖЕТНОТФАУНД).</span><span class="sxs-lookup"><span data-stu-id="cd131-124">The handoff fails (TARGETNOTFOUND).</span></span>

<span data-ttu-id="cd131-125">Если приложение, получающее переданный вызов, уже имеет обработчик вызова, используется этот старый маркер вызова.</span><span class="sxs-lookup"><span data-stu-id="cd131-125">If the application that is receiving the handed-off call already has a call handle to the call, this old call handle is used.</span></span> <span data-ttu-id="cd131-126">В противном случае создается новый маркер вызова.</span><span class="sxs-lookup"><span data-stu-id="cd131-126">Otherwise, a new call handle is created.</span></span> <span data-ttu-id="cd131-127">В любом случае приложение завершается с правами владельца для вызова.</span><span class="sxs-lookup"><span data-stu-id="cd131-127">In either case, the application ends up with owner privileges to the call.</span></span> <span data-ttu-id="cd131-128">Каждый раз, когда выходное приложение не совпадает с целевым приложением, целевой объект уведомляется о передаче в сообщении о состоянии сеанса, как если бы он получал новый вызов.</span><span class="sxs-lookup"><span data-stu-id="cd131-128">Whenever the handing-off application is not the same as the target application, the target is informed about the handoff in a session state message as if it were receiving a new call.</span></span>

<span data-ttu-id="cd131-129">Если текущее приложение-владелец сообщило об изменении типов мультимедиа, это достигается путем передачи вызова приложению, используемому для целевого типа носителя.</span><span class="sxs-lookup"><span data-stu-id="cd131-129">If the current owner application is told to change media types, it does so by handing off the call to an application used for the target media type.</span></span> <span data-ttu-id="cd131-130">Два типа вызова хандоффс описаны в разделе [хандоффс](#directed-handoffs) and [Media Type хандоффс](#media-type-handoffs).</span><span class="sxs-lookup"><span data-stu-id="cd131-130">The two types of call handoffs are described in [Directed Handoffs](#directed-handoffs) and [Media type Handoffs](#media-type-handoffs).</span></span>

<span data-ttu-id="cd131-131">Не все поставщики служб поддерживают использование этой операции.</span><span class="sxs-lookup"><span data-stu-id="cd131-131">Not all service providers support use of this operation.</span></span>

<span data-ttu-id="cd131-132">**Интерфейс TAPI 2. x:** См. раздел [**линехандофф**](/windows/win32/api/tapi/nf-tapi-linehandoff), где *лпсзфиленаме* задано имя приложения для прямой передачи или *двмедиамоде* задано на один тип носителя для косвенного перенаправления.</span><span class="sxs-lookup"><span data-stu-id="cd131-132">**TAPI 2.x:** See [**lineHandoff**](/windows/win32/api/tapi/nf-tapi-linehandoff), with *lpszFileName* set to the application name for a direct handoff or *dwMediaMode* set to one media type for an indirect handoff.</span></span>

<span data-ttu-id="cd131-133">**Интерфейс TAPI 3. x:** См. раздел [**итбасиккаллконтрол:: хандоффдирект**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-handoffdirect), [**Итбасиккаллконтрол:: хандоффиндирект**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-handoffindirect).</span><span class="sxs-lookup"><span data-stu-id="cd131-133">**TAPI 3.x:** See [**ITBasicCallControl::HandoffDirect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-handoffdirect), [**ITBasicCallControl::HandoffIndirect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-handoffindirect).</span></span>

## <a name="directed-handoffs"></a><span data-ttu-id="cd131-134">Направленный Хандоффс</span><span class="sxs-lookup"><span data-stu-id="cd131-134">Directed Handoffs</span></span>

<span data-ttu-id="cd131-135">*Направленная перенаправление* выполняется, когда целевое приложение известно по имени исходному приложению.</span><span class="sxs-lookup"><span data-stu-id="cd131-135">A *directed handoff* takes place when the target application is known by name to the original application.</span></span> <span data-ttu-id="cd131-136">Такая ситуация возникнет, например, из набора приложений, написанных одним и тем же поставщиком.</span><span class="sxs-lookup"><span data-stu-id="cd131-136">This situation would occur, for example, among a set of applications written by the same vendor.</span></span> <span data-ttu-id="cd131-137">Обычно пользователь может настроить управление направленным хандоффс.</span><span class="sxs-lookup"><span data-stu-id="cd131-137">The user can usually configure control of directed handoffs.</span></span> <span data-ttu-id="cd131-138">При такой передаче вызов задается указанному приложению, если оно открыло строку, в которой существует вызов.</span><span class="sxs-lookup"><span data-stu-id="cd131-138">With such a handoff, the call is given to the specified application if it has opened the line on which the call exists.</span></span> <span data-ttu-id="cd131-139">Тип носителя, указанный во время открытия строки приложением, игнорируется.</span><span class="sxs-lookup"><span data-stu-id="cd131-139">The media type specified at the time the application opened the line is ignored.</span></span> <span data-ttu-id="cd131-140">Одним из распространенных примеров является вызов голоса, за которым следует передача факса в одном вызове.</span><span class="sxs-lookup"><span data-stu-id="cd131-140">One common example is a voice call followed by a fax transmission in the same call.</span></span> <span data-ttu-id="cd131-141">Перенаправленные передачи чаще всего используются в приложениях от того же разработчика, которые также связаны другими способами.</span><span class="sxs-lookup"><span data-stu-id="cd131-141">Directed handoff would most often be used by applications from the same developer that are linked in other ways as well.</span></span>

<span data-ttu-id="cd131-142">Направленное перенаправление также может использоваться в будущих версиях в рамках процесса арбитратинг нескольких приложений, ожидающих входящих вызовов того же типа мультимедиа, с выбором приложения для обработки вызова, основанного на определении протокола канала передачи данных или более высокого уровня, а не на типе носителя.</span><span class="sxs-lookup"><span data-stu-id="cd131-142">Directed handoff may also be used in future versions as part of the process of arbitrating multiple applications waiting for incoming calls of the same media type, with the selection of the application to handle the call being based on data-link or higher-level protocol detection rather than media type.</span></span> <span data-ttu-id="cd131-143">Примером его использования может служить входящий модем с данными, например удаленный перенаправление, доска объявлений, удаленный доступ к сети и удаленный доступ к электронной почте, ожидающие вызовов одновременно.</span><span class="sxs-lookup"><span data-stu-id="cd131-143">An example of its use would be an incoming data modem line with applications such as remote takeover, bulletin board, remote network access, and remote e-mail access all waiting for calls simultaneously.</span></span>

## <a name="media-type-handoffs"></a><span data-ttu-id="cd131-144">Тип носителя Хандоффс</span><span class="sxs-lookup"><span data-stu-id="cd131-144">Media Type Handoffs</span></span>

<span data-ttu-id="cd131-145">Передается *тип мультимедиа* , если имеется новый, целевой тип носителя, обычно когда приложение-владелец определяет, что тип носителя, необходимый для вызова, отсутствует или будет изменен.</span><span class="sxs-lookup"><span data-stu-id="cd131-145">A *media type handoff* takes place when there is a new, targeted media type, usually when the owning application determines that the media type needed for the call is not present or is about to change.</span></span>

<span data-ttu-id="cd131-146">Процесс передачи, зависящей от носителя, может быть процессом проверки, если для типа носителя задан неизвестный бит.</span><span class="sxs-lookup"><span data-stu-id="cd131-146">The process for a media-dependent handoff can be a probing process if the media type UNKNOWN bit is on.</span></span> <span data-ttu-id="cd131-147">Приложение-владелец отвечает за циклический перебор типов мультимедиа для поиска приложения с наивысшим приоритетом.</span><span class="sxs-lookup"><span data-stu-id="cd131-147">It is the responsibility of the owning application to cycle through media types to find the highest-priority application.</span></span> <span data-ttu-id="cd131-148">TAPI выполняет этот цикл только при первом входящем вызове, чтобы найти первого владельца.</span><span class="sxs-lookup"><span data-stu-id="cd131-148">TAPI does this cycling only on the initial incoming call to find the first owner.</span></span> <span data-ttu-id="cd131-149">Это не делает это для операции передачи.</span><span class="sxs-lookup"><span data-stu-id="cd131-149">It does not do this for a handoff operation.</span></span> <span data-ttu-id="cd131-150">В противном случае передается практически такой же, как и для первоначального назначения вызова приложению.</span><span class="sxs-lookup"><span data-stu-id="cd131-150">Otherwise, a handoff is virtually the same as for the initial assignment of a call to an application.</span></span> <span data-ttu-id="cd131-151">Разница заключается в том, что для передачи косвенного (типа носителя) можно задать только один тип носителя.</span><span class="sxs-lookup"><span data-stu-id="cd131-151">The difference is the fact that only one media type can be set for an indirect (media type) handoff.</span></span>

<span data-ttu-id="cd131-152">Так как можно указать только один бит типа носителя, вызов предоставляется приложению с наивысшим приоритетом для этого типа мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="cd131-152">Because only a single media type bit can be specified, the call is given to the highest priority application for that media type.</span></span> <span data-ttu-id="cd131-153">Однако для передачи можно рассматривать более одного типа носителя.</span><span class="sxs-lookup"><span data-stu-id="cd131-153">However, it is possible that more than one media type is to be considered for the handoff.</span></span> <span data-ttu-id="cd131-154">В этом случае переданное приложение должно указывать наивысший приоритет возможных типов мультимедиа в качестве параметра.</span><span class="sxs-lookup"><span data-stu-id="cd131-154">In this case, the handing-off application should specify the highest priority of the possible media types as a parameter.</span></span>

<span data-ttu-id="cd131-155">Если в приложении указан неизвестный бит при передаче типа носителя и при сбое передачи, это означает, что неизвестное приложение, способное выполнить определение типа носителя, сейчас не выполняется.</span><span class="sxs-lookup"><span data-stu-id="cd131-155">If an application specifies the UNKNOWN bit when performing a media-type handoff and the handoff fails, this means that an unknown application capable of performing media type determination is not currently running.</span></span> <span data-ttu-id="cd131-156">Переданное приложение должно попытаться передать вызов приложению с наивысшим приоритетом, зарегистрированному для следующего типа носителя.</span><span class="sxs-lookup"><span data-stu-id="cd131-156">The application that is handing off should then try to hand the call off to the highest-priority application registered for the next-higher media type.</span></span>

<span data-ttu-id="cd131-157">Принимающее приложение теперь отвечает за вызов.</span><span class="sxs-lookup"><span data-stu-id="cd131-157">The receiving application is now responsible for the call.</span></span> <span data-ttu-id="cd131-158">Теперь он проверяет фактический тип носителя вызова.</span><span class="sxs-lookup"><span data-stu-id="cd131-158">It now probes for the call's actual media type.</span></span> <span data-ttu-id="cd131-159">Если приложение может работать с типом носителя вызова, оно должно гарантировать, что это приложение с наивысшим приоритетом, зарегистрированное для этого типа носителя.</span><span class="sxs-lookup"><span data-stu-id="cd131-159">If the application can handle the call's media type, it must ensure that it is the highest-priority application registered for that media type.</span></span> <span data-ttu-id="cd131-160">Если это так, он продолжает вызов и обрабатывает его в обычном режиме.</span><span class="sxs-lookup"><span data-stu-id="cd131-160">If so, it keeps the call and processes it normally.</span></span> <span data-ttu-id="cd131-161">В противном случае он передает вызов другому приложению, зарегистрированному для этого типа мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="cd131-161">If not, it hands the call off to another application registered for that media type.</span></span>

<span data-ttu-id="cd131-162">Однако если проверка этого типа носителя завершается неудачно, приложение снова проверяется, пытаясь выполнить остальные возможности режима мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="cd131-162">If, however, the probe for that media type fails, the application probes again, attempting the remaining media-mode possibilities.</span></span> <span data-ttu-id="cd131-163">Он должен сначала отключить текущий бит типа мультимедиа, а затем попробовать другую передачу с другим типом.</span><span class="sxs-lookup"><span data-stu-id="cd131-163">It must first turn off the current media type bit, then try another handoff with a different type.</span></span>

<span data-ttu-id="cd131-164">Этот процесс проверки и переработки продолжится, а оставшиеся типы носителей по одному исключены.</span><span class="sxs-lookup"><span data-stu-id="cd131-164">This process of probing and handing off continues, and the remaining media types are eliminated one by one.</span></span> <span data-ttu-id="cd131-165">Таким образом, одно из приложений может увидеть, что тип носителя, который он обрабатывает, находится в вызове, а Перехождение прошло успешно.</span><span class="sxs-lookup"><span data-stu-id="cd131-165">Along the way, one of the applications may see that the media type it handles is on the call, and the handoff is successful.</span></span>

<span data-ttu-id="cd131-166">Затем приложение должно задать правильный тип носителя и очистить все остальные биты типа носителя.</span><span class="sxs-lookup"><span data-stu-id="cd131-166">The application should then set the correct media type and clear all other media-type bits.</span></span> <span data-ttu-id="cd131-167">Это информирует других заинтересованных приложений о правильном типе носителя.</span><span class="sxs-lookup"><span data-stu-id="cd131-167">This informs other interested applications of the correct media type.</span></span> <span data-ttu-id="cd131-168">Эти другие приложения получают уведомление о событии, сообщающее об изменении типа носителя звонка.</span><span class="sxs-lookup"><span data-stu-id="cd131-168">These other applications receive an event notification message stating that the call's media type has changed.</span></span>

 

 
