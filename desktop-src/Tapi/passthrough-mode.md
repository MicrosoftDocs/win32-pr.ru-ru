---
description: При активации вызова в ЛИНЕБЕАРЕРМОДЕ \_ passthrough поставщик услуг предоставляет прямой доступ к подключенному оборудованию для управления приложением.
ms.assetid: 75e31241-c782-4d50-9590-cf68c0505add
title: Сквозной режим
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 985e1caf666fcb3278bacf5c5cfe9d8a4e847dbb
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105682969"
---
# <a name="passthrough-mode"></a>Сквозной режим

При активации вызова в **линебеарермоде \_ passthrough** поставщик услуг предоставляет прямой доступ к подключенному оборудованию для управления приложением. Приложения могут использовать этот режим для временного прямого управления асинхронными модемами, доступ к которым осуществляется через [функции связи](/windows/desktop/DevIO/communications-functions), с целью настройки или использования специальных функций, которые не поддерживаются поставщиком услуг, например Факс (класс 1, 2 и т. д.). Этот режим носителя поддерживается поставщиком службы драйвера универсального модема (UNIMODEM).

Поставщики услуг, поддерживающие **\_ транзит линебеарермоде** , указывают его в элементе **двбеарермодес** структуры [**линедевкапс**](/windows/desktop/api/Tapi/ns-tapi-linedevcaps) . Если **указан \_ транзитный линебеарермоде** , поставщик услуг Unimodem также включается в область **девспеЦифик** структуры **линедевкапс** . раздел реестра, используемый для доступа к данным о модеме, связанном с устройством, имеет следующий формат:

``` syntax
struct {
    DWORD dwContents;   // Set to 1 (indicates containing key).
    DWORD dwKeyOffset;  // Offset to key from start of this
                        // structure (not from start of
                        // LINEDEVCAPS structure).
                        // 8 in this case. 
    BYTE rgby[...];     // Place that contains null-terminated
                        // registry key. 
}
```

Пример:

``` syntax
    00000001 00000008 74737953 435c6d65  ........System\C
    65727275 6f43746e 6f72746e 7465536c  urrentControlSet
    7265535c 65636976 6c435c73 5c737361  urrentControlSet
    65646f4d 30305c6d xx003030 xxxxxxxx  Modem\0000.
```

Этот раздел реестра можно затем открыть с помощью функции [**регопенкэй**](/windows/desktop/api/winreg/nf-winreg-regopenkeya) .

Сквозной режим вызывается чаще всего с помощью функции [**линемакекалл**](/windows/desktop/api/Tapi/nf-tapi-linemakecall) , путем установки бита **\_ транзитного линебеарермоде** в **двбеарермоде** элемента структуры [**линекаллпарамс**](/windows/desktop/api/Tapi/ns-tapi-linecallparams) , на который указывает параметр *лпкаллпарамс* . Когда это будет сделано, поставщик услуг открывает последовательный порт для модема и сразу же помещает вызов в **линекаллстате \_ Connected**. Затем приложение может использовать функцию [**линежетид**](/windows/desktop/api/Tapi/nf-tapi-linegetid) с классом устройства "канал связи/Dataport", чтобы получить открытый маркер файла для чтения и записи в порт связи.

Сквозной режим может быть вызван в ответ на входящий вызов. Как правило, приложения будут вызывать транзитный режим, пока вызов находится в **\_ предложении линекаллстате**, до того, как будет получен ответ на вызов. Вместо вызова [**линеансвер**](/windows/desktop/api/Tapi/nf-tapi-lineanswer)приложение вызывает [**линесеткаллпарамс**](/windows/desktop/api/Tapi/nf-tapi-linesetcallparams), передавая **Линебеарермоде \_ passthrough** в качестве параметра *двбеарермоде* . Когда это делается, как и в случае с [**линемакекалл**](/windows/desktop/api/Tapi/nf-tapi-linemakecall), вызов немедленно помещается в **линекаллстате, \_ подключенный** поставщиком услуг, и приложение может получить маркер открытого порта с помощью [**линежетид**](/windows/desktop/api/Tapi/nf-tapi-linegetid). Функция **линесеткаллпарамс** может вызываться, когда вызов осуществляется в **\_ предложении линекаллстате**, **линекаллстате \_ принят** или **линекаллстате \_ подключен**.

Сквозной режим обычно завершается вызовом [**линедроп**](/windows/desktop/api/Tapi/nf-tapi-linedrop) для маркера вызова, полученного от [**линемакекалл**](/windows/desktop/api/Tapi/nf-tapi-linemakecall) , или сообщения [**\_ каллстате первой строки**](line-callstate.md) , если вызов был входящим вызовом. Поставщик услуг закроет порт и восстановит модем в состояние по умолчанию. Приложение должно вызвать функцию [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) для полученного от [**линежетид**](/windows/desktop/api/Tapi/nf-tapi-linegetid)маркера.

Сквозной режим также можно завершить, вызвав [**линесеткаллпарамс**](/windows/desktop/api/Tapi/nf-tapi-linesetcallparams) , указав для параметра *двбеарермоде* значение **линебеарермоде \_ Voice**. Предполагается, что тип носителя (режим), заданный [**линесетмедиамоде**](/windows/desktop/api/Tapi/nf-tapi-linesetmediamode) , является действующим. Если активен **ЛИНЕМЕДИАМОДЕ \_ модем** , поставщик услуг будет принимать вызов, как будто уже выполняется вызов модема данных. при последующем вызове [**линедроп**](/windows/desktop/api/Tapi/nf-tapi-linedrop) поставщик услуг выдаст соответствующие команды модема или изменения состояния интерфейса, чтобы удалить вызов данных.

> [!Note]  
> Если транзитный режим завершается во время вызова, поставщик услуг TAPI (TSP) для строки может восстановить параметры модема в состояние по умолчанию. Unimodem — это пример TSP, который всегда восстанавливает параметры модема при прерывании транзитного режима. По этой причине сквозной режим нельзя использовать в качестве метода настройки устройства. Сквозной режим следует использовать только для отдельных действий, которые можно считать полными после завершения транзитного. Примеры действий, которые могут использовать транзитный режим, включают отправку факса или воспроизведение аудио-или звуковых данных через собственный протокол модема.

 

 

 
