---
description: Со временем могут существовать различные версии для TAPI, приложений и поставщиков услуг для линий или телефонов.
ms.assetid: 36a17ae8-31db-4db9-a401-097d47aa26ad
title: Согласование версии TAPI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f41f4ca6f12862d6fc19f982c48b90bdafe2aaa2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105674073"
---
# <a name="tapi-version-negotiation"></a><span data-ttu-id="e9bac-103">Согласование версии TAPI</span><span class="sxs-lookup"><span data-stu-id="e9bac-103">TAPI Version Negotiation</span></span>

<span data-ttu-id="e9bac-104">Со временем могут существовать различные версии для TAPI, приложений и поставщиков услуг для линий или телефонов.</span><span class="sxs-lookup"><span data-stu-id="e9bac-104">Over time, different versions may exist for TAPI, applications, and service providers for a line or phone.</span></span> <span data-ttu-id="e9bac-105">Новые версии могут определять новые функции, новые поля для структур данных и т. д.</span><span class="sxs-lookup"><span data-stu-id="e9bac-105">New versions may define new features, new fields to data structures, and so on.</span></span> <span data-ttu-id="e9bac-106">Поэтому номера версий указывают, как интерпретировать различные структуры данных.</span><span class="sxs-lookup"><span data-stu-id="e9bac-106">Version numbers therefore indicate how to interpret various data structures.</span></span>

<span data-ttu-id="e9bac-107">Для обеспечения оптимального взаимодействия различных версий приложений, версий самой TAPI и версий поставщиков служб у разных поставщиков интерфейс TAPI предоставляет простой, двухэтапный механизм согласования версий для приложений.</span><span class="sxs-lookup"><span data-stu-id="e9bac-107">To allow optimal interoperability of different versions of applications, versions of TAPI itself, and versions of service providers by different vendors, TAPI provides a simple, two-step version negotiation mechanism for applications.</span></span> <span data-ttu-id="e9bac-108">Приложение, TAPI и поставщик услуг для каждого линейного устройства должны быть согласованы с двумя разными версиями.</span><span class="sxs-lookup"><span data-stu-id="e9bac-108">Two different versions must be agreed on by the application, TAPI, and the service provider for each line device.</span></span> <span data-ttu-id="e9bac-109">Первый — номер версии для базовой и дополнительной телефонии, который называется версией API.</span><span class="sxs-lookup"><span data-stu-id="e9bac-109">The first is the version number for Basic and Supplementary Telephony and is referred to as the API version.</span></span> <span data-ttu-id="e9bac-110">Другой — для расширений, зависящих от поставщика, если таковые имеются, и называется версией расширения.</span><span class="sxs-lookup"><span data-stu-id="e9bac-110">The other is for provider-specific extensions, if any, and is referred to as the extension version.</span></span> <span data-ttu-id="e9bac-111">Формат структур и типов данных, используемых базовыми и дополнительными компонентами TAPI, определяется версией API, а версия расширения определяет формат структур данных, определенных расширениями, определенными для поставщика.</span><span class="sxs-lookup"><span data-stu-id="e9bac-111">The format of the data structures and datatypes used by TAPI's basic and supplementary features is defined by the API version, while the extension version determines the format of the data structures defined by the vendor-specific extensions.</span></span>

<span data-ttu-id="e9bac-112">Согласование версий продолжается в два этапа.</span><span class="sxs-lookup"><span data-stu-id="e9bac-112">Version negotiation proceeds in two phases.</span></span> <span data-ttu-id="e9bac-113">На первом этапе выполняется согласование номера версии API и выполняется получение идентификатора расширения, связанного с любыми зависящими от поставщика расширениями, поддерживаемыми на устройстве.</span><span class="sxs-lookup"><span data-stu-id="e9bac-113">In the first phase, the API version number is negotiated and the extension identifier associated with any vendor-specific extensions supported on the device is obtained.</span></span> <span data-ttu-id="e9bac-114">На втором этапе выполняется согласование версии расширения.</span><span class="sxs-lookup"><span data-stu-id="e9bac-114">In the second phase, the extension version is negotiated.</span></span> <span data-ttu-id="e9bac-115">Если приложение не использует какие-либо расширения API, оно пропускает второй этап, и расширения не активируются поставщиком услуг.</span><span class="sxs-lookup"><span data-stu-id="e9bac-115">If the application does not use any API extensions, it skips the second phase and extensions are not activated by the service provider.</span></span> <span data-ttu-id="e9bac-116">Если приложение должно использовать расширения, но расширения поставщика услуг (идентификатор расширения) не распознаются приложением, приложение должно пропустить согласование для версии расширения.</span><span class="sxs-lookup"><span data-stu-id="e9bac-116">If the application does want to use extensions, but the service provider's extensions (the extension identifier) are not recognized by the application, the application should skip the negotiation for extension version as well.</span></span> <span data-ttu-id="e9bac-117">Каждый поставщик имеет свой набор юридических (распознаваемых) версий для каждого набора спецификаций расширения, которые он распространяет.</span><span class="sxs-lookup"><span data-stu-id="e9bac-117">Each vendor has its own set of legal (recognized) versions for each set of extension specifications it distributes.</span></span>

<span data-ttu-id="e9bac-118">Функция [**линенеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) используется для согласования используемого номера версии API.</span><span class="sxs-lookup"><span data-stu-id="e9bac-118">The [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) function is used to negotiate the API version number to use.</span></span> <span data-ttu-id="e9bac-119">Он также получает идентификатор расширения, поддерживаемый устройством Line, и возвращает нули, если расширения не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="e9bac-119">It also retrieves the extension identifier supported by the line device, returning zeros if no extensions are supported.</span></span> <span data-ttu-id="e9bac-120">При вызове этой функции приложение предоставляет диапазон версий API, совместимый с.</span><span class="sxs-lookup"><span data-stu-id="e9bac-120">With this function call, the application provides the API version range it is compatible with.</span></span> <span data-ttu-id="e9bac-121">Интерфейс TAPI, в свою очередь, согласовывает с поставщиком услуг линии, чтобы определить, какой диапазон версий API поддерживается.</span><span class="sxs-lookup"><span data-stu-id="e9bac-121">TAPI in turn negotiates with the line's service provider to determine which API version range it supports.</span></span> <span data-ttu-id="e9bac-122">Далее TAPI выбирает номер версии (как правило, хотя и не обязательно) в перекрывающихся диапазонах версий, предоставленных приложением, библиотекой DLL и поставщиком услуг.</span><span class="sxs-lookup"><span data-stu-id="e9bac-122">TAPI next selects a version number (typically, although not necessarily, the highest version number) in the overlapping version range that the application, the DLL, and the service provider have supplied.</span></span> <span data-ttu-id="e9bac-123">Этот номер возвращается в приложение вместе с идентификатором расширения, который определяет расширения, доступные для поставщика услуг этой строки.</span><span class="sxs-lookup"><span data-stu-id="e9bac-123">This number is returned to the application, along with the extension identifier that defines the extensions available from that line's service provider.</span></span>

<span data-ttu-id="e9bac-124">Если приложение хочет использовать расширения, определенные возвращенным идентификатором расширения, необходимо сначала вызвать [**линенеготиатикстверсион**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion) для согласования версии расширения.</span><span class="sxs-lookup"><span data-stu-id="e9bac-124">If the application wants to use the extensions defined by the returned extension identifier, it must first call [**lineNegotiateExtVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion) to negotiate the extension version.</span></span> <span data-ttu-id="e9bac-125">На аналогичном этапе согласования приложение указывает уже согласованную версию API и поддерживаемый диапазон версий расширения.</span><span class="sxs-lookup"><span data-stu-id="e9bac-125">In a similar negotiation phase, the application specifies the already agreed-upon API version and the extension version range it supports.</span></span> <span data-ttu-id="e9bac-126">TAPI передает эту информацию поставщику услуг для строки.</span><span class="sxs-lookup"><span data-stu-id="e9bac-126">TAPI passes this information to the service provider for the line.</span></span> <span data-ttu-id="e9bac-127">Поставщик услуг проверяет версию API и диапазон версий расширений по своему усмотрению и выбирает соответствующий номер версии расширения, если таковой существует.</span><span class="sxs-lookup"><span data-stu-id="e9bac-127">The service provider checks the API version and the extension version range against its own, and selects the appropriate extension version number, if one exists.</span></span>

<span data-ttu-id="e9bac-128">Когда приложение позже вызывает [**линежетдевкапс**](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps), оно возвращает набор возможностей устройства для строки, которая соответствует результатам согласования версий.</span><span class="sxs-lookup"><span data-stu-id="e9bac-128">When the application later calls [**lineGetDevCaps**](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps), it returns a set of device capabilities for the line that correspond to the results of version negotiation.</span></span> <span data-ttu-id="e9bac-129">К ним относятся возможности устройств, совместимые с версией API, и возможности, зависящие от устройства линии, совместимые с версией расширения.</span><span class="sxs-lookup"><span data-stu-id="e9bac-129">These include the line's device capabilities consistent with the API version and the line's device-specific capabilities consistent with the extension version.</span></span> <span data-ttu-id="e9bac-130">Приложение должно указать оба этих номера версии при открытии строки.</span><span class="sxs-lookup"><span data-stu-id="e9bac-130">The application must specify both of these version numbers when it opens a line.</span></span> <span data-ttu-id="e9bac-131">На этом этапе приложение, Библиотека DLL и поставщик служб фиксируются в соответствии с согласованными версиями.</span><span class="sxs-lookup"><span data-stu-id="e9bac-131">At that point, the application, the DLL, and the service provider are committed to using the agreed-upon versions.</span></span> <span data-ttu-id="e9bac-132">Если расширения для конкретных устройств не используются, версия расширения должна быть указана как нуль.</span><span class="sxs-lookup"><span data-stu-id="e9bac-132">If device-specific extensions are not to be used, the extension version should be specified as zero.</span></span>

<span data-ttu-id="e9bac-133">В среде, в которой несколько приложений открывают одно и то же устройство, первое приложение для открытия линейного устройства выбирает версии для всех будущих приложений, которые хотят использовать строку (поставщики услуг не поддерживают несколько версий одновременно). Аналогичным образом приложение, открывающее несколько устройств, может упростить работу с всеми линейными устройствами с одним и тем же номером версии API.</span><span class="sxs-lookup"><span data-stu-id="e9bac-133">In an environment where multiple applications open the same line device, the first application to open the line device selects the versions for all future applications that want to use the line (service providers do not support multiple versions simultaneously.) Similarly, an application that opens multiple line devices may find it easier to operate all line devices under the same API version number.</span></span>

<span data-ttu-id="e9bac-134">Каждая функция, принимающая *двапиверсион* или аналогичный параметр, должна присвоить этому параметру максимальную версию API, поддерживаемую приложением, или версию API, согласованную с помощью функции [**линенеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) или [**фоненеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) на конкретном устройстве.</span><span class="sxs-lookup"><span data-stu-id="e9bac-134">Every function that takes a *dwAPIVersion* or similar parameter must set this parameter to either the highest API version supported by the application or the API version negotiated using the [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) or [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) function on a particular device.</span></span> <span data-ttu-id="e9bac-135">Используйте следующую таблицу в качестве рекомендации:</span><span class="sxs-lookup"><span data-stu-id="e9bac-135">Use the following table as a guide:</span></span>



| <span data-ttu-id="e9bac-136">Функция</span><span class="sxs-lookup"><span data-stu-id="e9bac-136">Function</span></span>                                                     | <span data-ttu-id="e9bac-137">Значение</span><span class="sxs-lookup"><span data-stu-id="e9bac-137">Meaning</span></span>                                                                               |
|--------------------------------------------------------------|---------------------------------------------------------------------------------------|
| [<span data-ttu-id="e9bac-138">**линежетаддресскапс**</span><span class="sxs-lookup"><span data-stu-id="e9bac-138">**lineGetAddressCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetaddresscaps)             | <span data-ttu-id="e9bac-139">Используйте версию, возвращенную [**линенеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="e9bac-139">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="e9bac-140">**линежеткаунтри**</span><span class="sxs-lookup"><span data-stu-id="e9bac-140">**lineGetCountry**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetcountry)                     | <span data-ttu-id="e9bac-141">Использовать наибольшую версию, поддерживаемую приложением.</span><span class="sxs-lookup"><span data-stu-id="e9bac-141">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="e9bac-142">**линежетдевкапс**</span><span class="sxs-lookup"><span data-stu-id="e9bac-142">**lineGetDevCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps)                     | <span data-ttu-id="e9bac-143">Используйте версию, возвращенную [**линенеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="e9bac-143">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="e9bac-144">**линежетпровидерлист**</span><span class="sxs-lookup"><span data-stu-id="e9bac-144">**lineGetProviderList**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetproviderlist)           | <span data-ttu-id="e9bac-145">Использовать наибольшую версию, поддерживаемую приложением.</span><span class="sxs-lookup"><span data-stu-id="e9bac-145">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="e9bac-146">**линежеттранслатекапс**</span><span class="sxs-lookup"><span data-stu-id="e9bac-146">**lineGetTranslateCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegettranslatecaps)         | <span data-ttu-id="e9bac-147">Использовать наибольшую версию, поддерживаемую приложением.</span><span class="sxs-lookup"><span data-stu-id="e9bac-147">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="e9bac-148">**линенеготиатеапиверсион**</span><span class="sxs-lookup"><span data-stu-id="e9bac-148">**lineNegotiateAPIVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion)   | <span data-ttu-id="e9bac-149">Использовать наибольшую версию, поддерживаемую приложением.</span><span class="sxs-lookup"><span data-stu-id="e9bac-149">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="e9bac-150">**линенеготиатикстверсион**</span><span class="sxs-lookup"><span data-stu-id="e9bac-150">**lineNegotiateExtVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion)   | <span data-ttu-id="e9bac-151">Используйте версию, возвращенную [**линенеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="e9bac-151">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="e9bac-152">**линеопен**</span><span class="sxs-lookup"><span data-stu-id="e9bac-152">**lineOpen**</span></span>](/windows/desktop/api/Tapi/nf-tapi-lineopen)                                 | <span data-ttu-id="e9bac-153">Используйте версию, возвращенную [**линенеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="e9bac-153">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="e9bac-154">**линетранслатеаддресс**</span><span class="sxs-lookup"><span data-stu-id="e9bac-154">**lineTranslateAddress**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linetranslateaddress)         | <span data-ttu-id="e9bac-155">Использовать наибольшую версию, поддерживаемую приложением.</span><span class="sxs-lookup"><span data-stu-id="e9bac-155">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="e9bac-156">**линетранслатедиалог**</span><span class="sxs-lookup"><span data-stu-id="e9bac-156">**lineTranslateDialog**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linetranslatedialog)           | <span data-ttu-id="e9bac-157">Использовать наибольшую версию, поддерживаемую приложением.</span><span class="sxs-lookup"><span data-stu-id="e9bac-157">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="e9bac-158">**фонежетдевкапс**</span><span class="sxs-lookup"><span data-stu-id="e9bac-158">**phoneGetDevCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phonegetdevcaps)                   | <span data-ttu-id="e9bac-159">Используйте версию, возвращенную [**фоненеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="e9bac-159">Use version returned by [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span></span> |
| [<span data-ttu-id="e9bac-160">**фоненеготиатеапиверсион**</span><span class="sxs-lookup"><span data-stu-id="e9bac-160">**phoneNegotiateAPIVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) | <span data-ttu-id="e9bac-161">Использовать наибольшую версию, поддерживаемую приложением.</span><span class="sxs-lookup"><span data-stu-id="e9bac-161">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="e9bac-162">**фоненеготиатикстверсион**</span><span class="sxs-lookup"><span data-stu-id="e9bac-162">**phoneNegotiateExtVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateextversion) | <span data-ttu-id="e9bac-163">Используйте версию, возвращенную [**фоненеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="e9bac-163">Use version returned by [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span></span> |
| [<span data-ttu-id="e9bac-164">**фонеопен**</span><span class="sxs-lookup"><span data-stu-id="e9bac-164">**phoneOpen**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phoneopen)                               | <span data-ttu-id="e9bac-165">Используйте версию, возвращенную [**фоненеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="e9bac-165">Use version returned by [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span></span> |



 

> [!IMPORTANT]
> <span data-ttu-id="e9bac-166">При согласовании версии API всегда устанавливайте старшие и младшие номера версий в диапазоне версий, которые может поддерживать ваше приложение.</span><span class="sxs-lookup"><span data-stu-id="e9bac-166">When negotiating an API version, always set the high and low version numbers to the range of versions that your application can support.</span></span> <span data-ttu-id="e9bac-167">Например, никогда не используйте 0x00000000 в качестве нижней или 0xFFFFFFFF для высокого уровня, так как для этих значений требуется, чтобы приложение поддерживало все версии TAPI, как в прошлом, так и в будущем.</span><span class="sxs-lookup"><span data-stu-id="e9bac-167">For example, never use 0x00000000 for the low version or 0xFFFFFFFF for the high because these values require that your application support all versions of TAPI, both past and future.</span></span>

 

 

 



