---
description: Когда приложение вызывает функцию Линеклосе с одной или несколькими необработанными асинхронными операциями, TAPI может направить поставщик услуг на завершение асинхронных операций, связанных с вызовом.
ms.assetid: b26ce074-76dc-4a50-8c17-d3412c336d59
title: Завершение асинхронных операций
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f8ed2acb0f442e5f4f07427f0e224d7a288087d6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105674461"
---
# <a name="termination-of-asynchronous-operations"></a><span data-ttu-id="219e4-103">Завершение асинхронных операций</span><span class="sxs-lookup"><span data-stu-id="219e4-103">Termination of Asynchronous Operations</span></span>

<span data-ttu-id="219e4-104">Когда приложение вызывает функцию [**линеклосе**](/windows/win32/api/tapi/nf-tapi-lineclose) с одной или несколькими необработанными асинхронными операциями, TAPI может направлять поставщик услуг на завершение асинхронных операций, связанных с вызовом, в зависимости от того, является ли приложение единственным владельцем вызова и имеет единственный маркер вызова.</span><span class="sxs-lookup"><span data-stu-id="219e4-104">When an application calls the [**lineClose**](/windows/win32/api/tapi/nf-tapi-lineclose) function with one or more outstanding asynchronous operations, TAPI may direct the service provider to terminate asynchronous operations associated with a call, depending on whether the application is the sole owner of the call and has the only handle to the call.</span></span>

<span data-ttu-id="219e4-105">Если приложение является единственным владельцем вызова, TAPI вызывает [**тспи \_ Линедропонклосе**](./tspi-linedroponclose.md) или [**тспи \_ линедроп**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) (в зависимости от поставщика) для каждого такого вызова.</span><span class="sxs-lookup"><span data-stu-id="219e4-105">If the application is the sole owner of a call, TAPI calls [**TSPI\_lineDropOnClose**](./tspi-linedroponclose.md) or [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) (depending on the provider) for each such call.</span></span> <span data-ttu-id="219e4-106">Поставщик услуг должен проверить наличие ожидающих асинхронных операций, связанных с удаляемым вызовом.</span><span class="sxs-lookup"><span data-stu-id="219e4-106">The service provider should check for any pending asynchronous operations associated with the call being dropped.</span></span> <span data-ttu-id="219e4-107">Если операция, ожидающая выполнения, существует, поставщик услуг должен принять соответствующее действие, возможно, завершая выполняемую операцию.</span><span class="sxs-lookup"><span data-stu-id="219e4-107">If a pending operation exists, the service provider should take the appropriate action, possibly terminating the operation in progress.</span></span>

<span data-ttu-id="219e4-108">Если приложение имеет единственный обработчик вызова (то есть нет других владельцев или мониторов), TAPI вызывает функцию [**тспи \_ линеклосекалл**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) .</span><span class="sxs-lookup"><span data-stu-id="219e4-108">If the application has the only handle to a call (that is, there are no other owners or monitors), TAPI calls the [**TSPI\_lineCloseCall**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) function.</span></span> <span data-ttu-id="219e4-109">Поставщик услуг должен считать этот вызов абсолютным указанием того, что ожидающие асинхронные операции должны быть отменены.</span><span class="sxs-lookup"><span data-stu-id="219e4-109">The service provider must consider this call to be the absolute indication that pending asynchronous operations must be abandoned.</span></span> <span data-ttu-id="219e4-110">Поставщик услуг должен обеспечить упорядоченное завершение вызова и должен вызывать функцию обратного вызова [**асинхронного \_ завершения**](/windows/win32/api/tspi/nc-tspi-async_completion) для всех необработанных асинхронных операций, УКАЗЫВАЯ \_ значение ошибки линирр оператионфаилед.</span><span class="sxs-lookup"><span data-stu-id="219e4-110">The service provider must ensure an orderly completion of the call, and must call the [**ASYNC\_COMPLETION**](/windows/win32/api/tspi/nc-tspi-async_completion) callback function for all outstanding asynchronous operations, specifying the LINEERR\_OPERATIONFAILED error value.</span></span> <span data-ttu-id="219e4-111">Если интерфейс TAPI ранее вызывал [**функцию \_ тспи Линедропонклосе**](./tspi-linedroponclose.md) или [**тспи \_ линедроп**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) , он вызывает **тспи \_** линеклосекалл сразу после возврата поставщиком услуг из другого вызова; он не ждет завершения асинхронной операции, связанной с функцией **тспи \_ линедроп** .</span><span class="sxs-lookup"><span data-stu-id="219e4-111">If TAPI previously called the [**TSPI\_lineDropOnClose**](./tspi-linedroponclose.md) or [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) function, it calls **TSPI\_lineCloseCall** immediately after the service provider returns from the other call; it does not wait for the asynchronous operation associated with the **TSPI\_lineDrop** function to complete.</span></span>

<span data-ttu-id="219e4-112">Если приложение не является единственным владельцем вызова, TAPI не вызывает [**тспи \_ Линедропонклосе**](./tspi-linedroponclose.md) или [**тспи \_ линедроп**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop).</span><span class="sxs-lookup"><span data-stu-id="219e4-112">If the application is not the sole owner of the call, TAPI does not call [**TSPI\_lineDropOnClose**](./tspi-linedroponclose.md) or [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop).</span></span> <span data-ttu-id="219e4-113">Если приложение не имеет единственного маркера для вызова, TAPI не вызывает функцию [**тспи \_ линеклосекалл**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) .</span><span class="sxs-lookup"><span data-stu-id="219e4-113">If the application does not have the only handle to the call, TAPI does not call the [**TSPI\_lineCloseCall**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) function.</span></span> <span data-ttu-id="219e4-114">Если приложение не является ни единственным владельцем, ни самостоятельным обработчиком вызова, TAPI не отправляет уведомления поставщику услуг, поэтому все ожидающие асинхронные операции остаются без изменений.</span><span class="sxs-lookup"><span data-stu-id="219e4-114">If the application is neither the sole owner nor the sole possessor of a handle to the call, TAPI sends no notification to the service provider, and therefore, any pending asynchronous operations remain intact.</span></span> <span data-ttu-id="219e4-115">Это означает, что такие приложения не могут завершать асинхронные операции, запущенные с помощью функции [**линеклосе**](/windows/win32/api/tapi/nf-tapi-lineclose) .</span><span class="sxs-lookup"><span data-stu-id="219e4-115">This means that such applications cannot terminate asynchronous operations that they have started by using the [**lineClose**](/windows/win32/api/tapi/nf-tapi-lineclose) function.</span></span> <span data-ttu-id="219e4-116">Однако, поскольку для каждой асинхронной операции требуется, чтобы вызывающее приложение было владельцем вызова, вероятность того, что приложение не сможет завершить асинхронные операции, очень редки.</span><span class="sxs-lookup"><span data-stu-id="219e4-116">However, because every asynchronous operation requires the invoking application to be an owner of the call, the likelihood of an application not being able to terminate asynchronous operations is very rare.</span></span> <span data-ttu-id="219e4-117">Если это происходит, то другие владельцы вызовов должны принять ответственность за метод обработки расстановки вызовов.</span><span class="sxs-lookup"><span data-stu-id="219e4-117">If it does occur, the other owner(s) of the call(s) must take responsibility for the disposition of the call(s).</span></span>

<span data-ttu-id="219e4-118">Если TAPI вызывает [**тспи \_ Линедропонклосе**](./tspi-linedroponclose.md) или [**тспи \_ линедроп**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop), поставщик услуг, в конечном итоге, должен отправить \_ неактивное сообщение Линекаллстате для связанного вызова (если только [**тспи \_ линеклосекалл**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) не вызывался первым), поэтому мониторы в вызове могут быть очищены.</span><span class="sxs-lookup"><span data-stu-id="219e4-118">If TAPI calls [**TSPI\_lineDropOnClose**](./tspi-linedroponclose.md) or [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop), the service provider must eventually send a LINECALLSTATE\_IDLE message for the associated call (unless [**TSPI\_lineCloseCall**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) is called first) so that monitors on the call can clean up.</span></span> <span data-ttu-id="219e4-119">Когда последний монитор вызвал функцию [**линедеаллокатекалл**](/windows/win32/api/tapi/nf-tapi-linedeallocatecall) , TAPI вызывает функцию **тспи \_ линеклосекалл** ; любые ожидающие операции должны быть завершены или завершаться и [**асинхронно \_**](/windows/win32/api/tspi/nc-tspi-async_completion) вызываться, как описано выше.</span><span class="sxs-lookup"><span data-stu-id="219e4-119">When the last monitor has called the [**lineDeallocateCall**](/windows/win32/api/tapi/nf-tapi-linedeallocatecall) function, TAPI calls the **TSPI\_lineCloseCall** function; any pending operations must be completed or terminated and [**ASYNC\_COMPLETION**](/windows/win32/api/tspi/nc-tspi-async_completion) called, as described earlier.</span></span>

 

 
