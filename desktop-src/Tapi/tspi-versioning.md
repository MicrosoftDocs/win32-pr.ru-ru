---
description: Со временем могут быть созданы различные версии TAPI, приложений и поставщиков служб.
ms.assetid: 994fad0e-5958-4d93-8952-9db2bbe01f44
title: Управление версиями ТСПИ
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dfe405a629ddc64f76535b33554509b1a6fca81d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104542442"
---
# <a name="tspi-versioning"></a><span data-ttu-id="6418e-103">Управление версиями ТСПИ</span><span class="sxs-lookup"><span data-stu-id="6418e-103">TSPI Versioning</span></span>

<span data-ttu-id="6418e-104">Со временем могут быть созданы различные версии TAPI, приложений и поставщиков служб.</span><span class="sxs-lookup"><span data-stu-id="6418e-104">Over time, different versions of TAPI, applications, and service providers may be produced.</span></span> <span data-ttu-id="6418e-105">Эти новые версии могут создавать новые определения, например для новых функций, новых элементов в структурах данных и новых битовых полей.</span><span class="sxs-lookup"><span data-stu-id="6418e-105">These new versions can make new definitions, such as for new features, new members in data structures, and new bit fields.</span></span> <span data-ttu-id="6418e-106">Следовательно, Номера версий необходимы для указания способа интерпретации различных структур данных.</span><span class="sxs-lookup"><span data-stu-id="6418e-106">Version numbers are therefore necessary to indicate how to interpret various data structures.</span></span>

<span data-ttu-id="6418e-107">Чтобы обеспечить оптимальное взаимодействие различных версий приложений, версий самой TAPI и версий поставщиков услуг разных поставщиков, Microsoft телефонии предоставляет простой механизм согласования версий для приложений.</span><span class="sxs-lookup"><span data-stu-id="6418e-107">To allow optimal interoperability of different versions of applications, versions of TAPI itself, and versions of service providers by different vendors, Microsoft Telephony provides a simple version negotiation mechanism for applications.</span></span> <span data-ttu-id="6418e-108">Существует две разные версии, которые необходимо согласовать с интерфейсом TAPI и поставщиком услуг телефонии для каждого устройства линии.</span><span class="sxs-lookup"><span data-stu-id="6418e-108">There are two different versions that need to be agreed on by TAPI and the telephony service provider for each line device.</span></span> <span data-ttu-id="6418e-109">Первый — номер версии для базового и дополнительного телефонного номера SPI, называемый *интерфейсом тспи*.</span><span class="sxs-lookup"><span data-stu-id="6418e-109">The first is the version number for the Basic and Supplementary Telephony SPI, referred to as the *TSPI interface version*.</span></span> <span data-ttu-id="6418e-110">Другой — для расширений, зависящих от поставщика, если таковые имеются, и называется *версией расширения*.</span><span class="sxs-lookup"><span data-stu-id="6418e-110">The other is for provider-specific extensions, if any, and is referred to as the *extension version*.</span></span> <span data-ttu-id="6418e-111">Формат структур и типов данных, используемых базовыми и дополнительными функциями ТСПИ, определяется версией ТСПИ, а версия расширения определяет формат структур данных, определенных расширениями, определенными для поставщика.</span><span class="sxs-lookup"><span data-stu-id="6418e-111">The format of the data structures and datatypes used by TSPI's Basic and Supplementary features is defined by the TSPI version, while the extension version determines the format of data structures defined by the vendor-specific extensions.</span></span>

<span data-ttu-id="6418e-112">Эти два типа согласования версий обрабатываются двумя различными процедурами: [**тспи \_ линенеготиатетспиверсион**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiatetspiversion) используется для согласования версии интерфейса Тспи, а [**тспи \_ линенеготиатикстверсион**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiateextversion) используется для согласования версии расширения.</span><span class="sxs-lookup"><span data-stu-id="6418e-112">These two types of version negotiation are handled by two different procedures: [**TSPI\_lineNegotiateTSPIVersion**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiatetspiversion) is used to negotiate the TSPI interface version, and [**TSPI\_lineNegotiateExtVersion**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiateextversion) is used to negotiate the extension version.</span></span> <span data-ttu-id="6418e-113">Если расширения не требуются, можно пропустить согласование версии расширения.</span><span class="sxs-lookup"><span data-stu-id="6418e-113">Extension version negotiation can be skipped if extensions are not wanted.</span></span> <span data-ttu-id="6418e-114">Если эти диапазоны введены при наложении согласования, поставщик услуг должен вернуть значение в перекрывающейся части диапазона в результате согласования.</span><span class="sxs-lookup"><span data-stu-id="6418e-114">If these ranges input during negotiation overlap, the service provider must return a value within the overlapping portion of the range as the result of the negotiation.</span></span> <span data-ttu-id="6418e-115">Обычно это должно быть наибольшее возможное значение.</span><span class="sxs-lookup"><span data-stu-id="6418e-115">Usually, this should be the highest possible value.</span></span> <span data-ttu-id="6418e-116">Если диапазоны не пересекаются, эти две стороны несовместимы и функция возвращает ошибку.</span><span class="sxs-lookup"><span data-stu-id="6418e-116">If the ranges do not overlap, the two parties are incompatible and the function returns an error.</span></span>

<span data-ttu-id="6418e-117">Результаты согласования просто указывают, что поставщик службы готов к работе по определенному номеру версии, но не фиксирует поставщик услуг для этого.</span><span class="sxs-lookup"><span data-stu-id="6418e-117">Results of a negotiation simply indicate that the service provider is willing to operate at a particular version number, but do not commit the service provider to doing so.</span></span> <span data-ttu-id="6418e-118">Например, TAPI может выполнить повторное согласование, чтобы определить идеальную версию после согласования возможной версии.</span><span class="sxs-lookup"><span data-stu-id="6418e-118">For example, TAPI can renegotiate to determine an ideal version after having negotiated a possible version.</span></span> <span data-ttu-id="6418e-119">Версия интерфейса ТСПИ фиксируется только при открытии строки с помощью [**тспи \_ линеопен**](/windows/win32/api/tspi/nf-tspi-tspi_lineopen) и остается недоступной до закрытия устройства.</span><span class="sxs-lookup"><span data-stu-id="6418e-119">The TSPI interface version is only committed when a line is opened using [**TSPI\_lineOpen**](/windows/win32/api/tspi/nf-tspi-tspi_lineopen) and survives until the device is closed.</span></span> <span data-ttu-id="6418e-120">Версия расширения зафиксируется при вызове функции [**тспи \_ линеселектекстверсион**](/windows/win32/api/tspi/nf-tspi-tspi_lineselectextversion) и остается в неработоспособном виде до тех пор, пока выбор не будет отменен путем выбора версии расширения 0.</span><span class="sxs-lookup"><span data-stu-id="6418e-120">The extension version is committed when the [**TSPI\_lineSelectExtVersion**](/windows/win32/api/tspi/nf-tspi-tspi_lineselectextversion) function is called, and survives until the selection is canceled by selecting extension version zero.</span></span>

<span data-ttu-id="6418e-121">Выбор версии расширения может происходить много раз, включая, когда действует версия расширения.</span><span class="sxs-lookup"><span data-stu-id="6418e-121">Extension version selection can happen many times, including while an extension version is in effect.</span></span> <span data-ttu-id="6418e-122">Так как поставщик услуг фиксируется в версии расширения, его диапазон поддерживаемых версий ограничивается точностью до этой версии расширения.</span><span class="sxs-lookup"><span data-stu-id="6418e-122">Because the service provider is committed to the extension version, its range of supported versions narrows to exactly that extension version.</span></span> <span data-ttu-id="6418e-123">Например, рассмотрим поставщик услуг, который обычно совместим с версиями расширений 1,0 – 5,5.</span><span class="sxs-lookup"><span data-stu-id="6418e-123">For example, consider a service provider that is normally compatible with extension versions 1.0 through 5.5.</span></span> <span data-ttu-id="6418e-124">Если версия 3,0 действует, пока вызывающий объект пытается согласовать версию в диапазоне от 1,0 до 5,5, согласование возвращает 3,0.</span><span class="sxs-lookup"><span data-stu-id="6418e-124">If version 3.0 is in effect while a caller attempts to negotiate a version within the range 1.0 to 5.5, the negotiation returns 3.0.</span></span>

<span data-ttu-id="6418e-125">Так как TAPI согласовывает версию, поставщик услуг можно обновить до новых версий интерфейса, не требуя обновления TAPI.</span><span class="sxs-lookup"><span data-stu-id="6418e-125">Because TAPI negotiates the version, you can upgrade a service provider to new versions of the interface without requiring that TAPI also be upgraded.</span></span> <span data-ttu-id="6418e-126">Аналогичным образом TAPI можно обновить, но по-прежнему использовать старый поставщик услуг.</span><span class="sxs-lookup"><span data-stu-id="6418e-126">Similarly, TAPI can be upgraded, yet still use your older service provider.</span></span>

 

 
