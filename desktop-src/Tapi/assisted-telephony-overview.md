---
description: Ценная функция телефонии — это небольшой набор функций, называемый поддержкой телефонии.
ms.assetid: 1c41f52b-f8bf-410e-a966-9323a690a4d5
title: Обзор службы поддержки телефонии
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7b6a8826fd0c273936204d9250fb91504333d807
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103998869"
---
# <a name="assisted-telephony-overview"></a><span data-ttu-id="12718-103">Обзор службы поддержки телефонии</span><span class="sxs-lookup"><span data-stu-id="12718-103">Assisted Telephony Overview</span></span>

<span data-ttu-id="12718-104">Ценная функция телефонии — это небольшой набор функций, называемый поддержкой телефонии.</span><span class="sxs-lookup"><span data-stu-id="12718-104">A valuable feature of telephony is the small set of functions called Assisted Telephony.</span></span> <span data-ttu-id="12718-105">Служба поддержки телефонии разработана таким образом, чтобы обеспечить доступ к голосовым вызовам и вызовам мультимедиа, доступным для любого приложения, а не только для телефонной функциональности.</span><span class="sxs-lookup"><span data-stu-id="12718-105">Assisted Telephony is designed to make the establishment of voice calls and of media calls available to any application, not just those dedicated to telephonic functionality.</span></span> <span data-ttu-id="12718-106">Другими словами, служба телефонии позволяет приложениям выполнять телефонные звонки без необходимости учитывать сведения о службах полного API телефонии.</span><span class="sxs-lookup"><span data-stu-id="12718-106">In other words, Assisted Telephony lets applications make telephone calls without needing to be aware of the details of the services of the full Telephony API.</span></span> <span data-ttu-id="12718-107">Она расширяет возможности телефонии для работы с текстовыми приложениями, электронными таблицами, базами данных, диспетчерами персональных данных и другими приложениями, отличными от телефонии.</span><span class="sxs-lookup"><span data-stu-id="12718-107">It extends telephony to word-processing applications, spreadsheets, databases, personal information managers, and other non-telephony applications.</span></span>

<span data-ttu-id="12718-108">Список функций телефонии TAPI 2. x, поддерживающих базовые телефонные функции, см. в разделе [Справочник по быстрой функции TAPI](./tapi-quick-function-reference.md).</span><span class="sxs-lookup"><span data-stu-id="12718-108">For a list of TAPI 2.x Assisted Telephony functions of Basic Telephony, see [TAPI Quick Function Reference](./tapi-quick-function-reference.md).</span></span> <span data-ttu-id="12718-109">TAPI 3. x поддерживает телефонную связь через интерфейс [**итрекуест**](/windows/desktop/api/tapi3if/nn-tapi3if-itrequest) .</span><span class="sxs-lookup"><span data-stu-id="12718-109">TAPI 3.x supports assisted telephony through the [**ITRequest**](/windows/desktop/api/tapi3if/nn-tapi3if-itrequest) interface.</span></span>

<span data-ttu-id="12718-110">Полезность телефонной связи может быть продемонстрирована в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="12718-110">The usefulness of Assisted Telephony can be illustrated by the following example.</span></span> <span data-ttu-id="12718-111">Приложение электронной таблицы может включать функции, набираемые телефонный номер для речевого вызова.</span><span class="sxs-lookup"><span data-stu-id="12718-111">A spreadsheet application can incorporate functions that dial a telephone number for a speech call.</span></span> <span data-ttu-id="12718-112">При условии, что приложению не требуется никакой подробной функции управления вызовами, предоставляемой полным API телефонии, служба телефонии является самым простым и наиболее эффективным способом предоставления телефонной функциональности.</span><span class="sxs-lookup"><span data-stu-id="12718-112">As long as the application needs none of the detailed call control provided by the full Telephony API, Assisted Telephony is the easiest and most efficient way to give it telephonic functionality.</span></span>

![Техническая поддержка телефонии с помощью приложения для электронных таблиц](images/assist4.png)

<span data-ttu-id="12718-114">Служба поддержки телефонии и полный API телефонии используются и реализуются различными способами, поэтому не рекомендуется смешивать вызовы функций телефонной связи и вызовы функций API телефонии в одном приложении.</span><span class="sxs-lookup"><span data-stu-id="12718-114">Assisted Telephony and the full Telephony API are used and implemented in different ways, so it is not advised to mix Assisted Telephony function calls and Telephony API function calls within a single application.</span></span>

## <a name="using-assisted-telephony"></a><span data-ttu-id="12718-115">Использование службы поддержки телефонии</span><span class="sxs-lookup"><span data-stu-id="12718-115">Using Assisted Telephony</span></span>

<span data-ttu-id="12718-116">Приложения, использующие службы технической телефонии, инициируют только запросы на вызов, которые временно помещаются в очередь TAPI.</span><span class="sxs-lookup"><span data-stu-id="12718-116">Applications that use Assisted Telephony services only initiate call requests that are temporarily queued by TAPI.</span></span> <span data-ttu-id="12718-117">Приложение запроса получателя получает эти запросы и выполняет их от имени приложения, поддерживающего телефонную связь.</span><span class="sxs-lookup"><span data-stu-id="12718-117">The request recipient application retrieves these requests and executes them on behalf of the Assisted Telephony application.</span></span> <span data-ttu-id="12718-118">Функция [**тапирекуестмакекалл**](/windows/win32/api/tapi/nf-tapi-tapirequestmakecall) запрашивает установленный голосовой вызов.</span><span class="sxs-lookup"><span data-stu-id="12718-118">The [**tapiRequestMakeCall**](/windows/win32/api/tapi/nf-tapi-tapirequestmakecall) function requests the establishment of a voice call.</span></span> <span data-ttu-id="12718-119">Запрашивающее приложение не управляет вызовом.</span><span class="sxs-lookup"><span data-stu-id="12718-119">The requesting application does not control the call.</span></span>

<span data-ttu-id="12718-120">TAPI позволяет пользователю устанавливать разные или одинаковые приложения-получатели запросов для каждой из этих служб.</span><span class="sxs-lookup"><span data-stu-id="12718-120">TAPI allows the user to establish different or the same request recipient applications for each of these services.</span></span> <span data-ttu-id="12718-121">Приложение становится получателем запроса путем регистрации в [**линерегистеррекуестреЦипиент**](/windows/win32/api/tapi/nf-tapi-lineregisterrequestrecipient), в котором значение **true** указано в качестве значения параметра *бенабле*.</span><span class="sxs-lookup"><span data-stu-id="12718-121">An application becomes a request recipient by registering with [**lineRegisterRequestRecipient**](/windows/win32/api/tapi/nf-tapi-lineregisterrequestrecipient), in which **TRUE** is specified as the value for the parameter *bEnable*.</span></span> <span data-ttu-id="12718-122">(При указании значения **false** отменяется регистрация приложения в качестве получателя запроса, который должен быть выполнен, когда определяется, что его обязанности отправляются за текущий сеанс.) Приложение выбирает службы, которые требуется выполнять в параметре *Дврекуестмоде* **линерегистеррекуестреЦипиент**.</span><span class="sxs-lookup"><span data-stu-id="12718-122">(Specifying **FALSE** deregisters the application as a request recipient, which it should do when it has determined that its recipient duties are through for the current session.) The application selects the services it wants to handle in the *dwRequestMode* parameter of **lineRegisterRequestRecipient**.</span></span> <span data-ttu-id="12718-123">Возможные значения для запроса — ЛИНЕРЕКУЕСТМОДЕ \_ MAKECALL, чтобы продемонстрировать, что приложение будет выполнять запросы [**тапирекуестмакекалл**](/windows/win32/api/tapi/nf-tapi-tapirequestmakecall) .</span><span class="sxs-lookup"><span data-stu-id="12718-123">A possible value for a request is LINEREQUESTMODE\_MAKECALL, to show that the application will handle [**tapiRequestMakeCall**](/windows/win32/api/tapi/nf-tapi-tapirequestmakecall) requests.</span></span> <span data-ttu-id="12718-124">Если несколько приложений регистрируются для одних и тех же служб, используется схема приоритета, позволяющая пользователю выбрать приложение, предпочитаемое для обработки запросов.</span><span class="sxs-lookup"><span data-stu-id="12718-124">If multiple applications register for the same services, a priority scheme is used to allow the user to select which application is preferred for handling requests.</span></span> <span data-ttu-id="12718-125">Эта схема приоритета идентична той, которая использовалась для передачи вызовов, и Маршрутизация входящих вызовов на основе списка имен файлов в **хандоффприоритиес** в реестре.</span><span class="sxs-lookup"><span data-stu-id="12718-125">This priority scheme is identical to that used for call handoff and the routing of incoming calls based on a list of file names in **HandoffPriorities** in the registry.</span></span>

## <a name="call-requests"></a><span data-ttu-id="12718-126">Запросы вызовов</span><span class="sxs-lookup"><span data-stu-id="12718-126">Call Requests</span></span>

<span data-ttu-id="12718-127">Служба телефонии предоставляет приложения с поддержкой телефонии с простым в использовании механизмом для осуществления телефонных звонков, не требуя от разработчика полноценного помощника по телефонии.</span><span class="sxs-lookup"><span data-stu-id="12718-127">Assisted Telephony provides telephony-enabled applications with an easy-to-use mechanism for making phone calls without requiring the developer to become fully literate in telephony.</span></span>

<span data-ttu-id="12718-128">Функция [**тапирекуестмакекалл**](/windows/win32/api/tapi/nf-tapi-tapirequestmakecall) запрашивает голосовое обращение между пользователем и удаленной стороной, указанной по номеру телефона.</span><span class="sxs-lookup"><span data-stu-id="12718-128">The [**tapiRequestMakeCall**](/windows/win32/api/tapi/nf-tapi-tapirequestmakecall) function requests a voice call between the user and a remote party specified by its phone number.</span></span> <span data-ttu-id="12718-129">Выполняется запрос к интерфейсу TAPI, который передает его в приложение, зарегистрированное как получатель таких запросов.</span><span class="sxs-lookup"><span data-stu-id="12718-129">The request is made to TAPI, which passes it to an application that is registered as a recipient of such requests.</span></span> <span data-ttu-id="12718-130">Этот получатель является приложением диспетчера вызовов.</span><span class="sxs-lookup"><span data-stu-id="12718-130">This recipient is a call manager application.</span></span>

<span data-ttu-id="12718-131">После того как приложение сделало запрос, управление вызовом осуществляется исключительно из приложения диспетчера звонков, так как вспомогательные приложения телефонии не могут управлять вызовами.</span><span class="sxs-lookup"><span data-stu-id="12718-131">After the application has made the request, the call is controlled entirely from the call manager application because Assisted Telephony applications cannot manage calls.</span></span> <span data-ttu-id="12718-132">Поскольку более сложные аспекты телефонии и все операции с пользовательским интерфейсом обрабатываются приложением диспетчера звонков, приложения, поддерживающие телефонию, не должны изменяться каким-либо значительным образом.</span><span class="sxs-lookup"><span data-stu-id="12718-132">Because the more complex aspects of telephony and all user-interface operations are handled by the call manager application, telephony-enabled applications need not be modified in any substantial way.</span></span> <span data-ttu-id="12718-133">Фактически, приложения, которые позволяют вызывать эту операцию со встроенного языка скриптов, могут быть не изменены вообще.</span><span class="sxs-lookup"><span data-stu-id="12718-133">In fact, applications that allow this operation to be invoked from their built-in script language may not need to be modified at all.</span></span>

<span data-ttu-id="12718-134">Функция [**тапижетлокатионинфо**](/windows/win32/api/tapi/nf-tapi-tapigetlocationinfo) возвращает в приложение код страны или региона и город (область), заданный пользователем в параметрах текущего расположения на панели управления телефонии.</span><span class="sxs-lookup"><span data-stu-id="12718-134">The [**tapiGetLocationInfo**](/windows/win32/api/tapi/nf-tapi-tapigetlocationinfo) function returns to the application the country or region code and city (area) code that the user has set in the current location parameters in the Telephony Control Panel.</span></span> <span data-ttu-id="12718-135">Приложение может использовать эти сведения, чтобы помочь пользователю в создании правильных канонических телефонных номеров, например, по умолчанию при вводе новых номеров в записи телефонной книги или записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="12718-135">The application can use this information to assist the user in forming proper canonical telephone numbers, such as by offering these as defaults when new numbers are entered in a phone book entry or database record.</span></span>

## <a name="request-recipients"></a><span data-ttu-id="12718-136">Запрос получателей</span><span class="sxs-lookup"><span data-stu-id="12718-136">Request Recipients</span></span>

<span data-ttu-id="12718-137">Для запуска телефонной связи необходимы два типа приложений.</span><span class="sxs-lookup"><span data-stu-id="12718-137">Two kinds of applications are needed to run Assisted Telephony.</span></span> <span data-ttu-id="12718-138">*Клиенты* с поддержкой телефонии — это приложения, использующие телефонную связь, вызывая функции с префиксом "TAPI".</span><span class="sxs-lookup"><span data-stu-id="12718-138">Assisted Telephony *clients* are applications that use Assisted Telephony by calling the functions that have the prefix "tapi."</span></span> <span data-ttu-id="12718-139">Примером такого клиентского приложения может быть электронная таблица, в которую добавляется команда меню или **кнопка на панели** инструментов.</span><span class="sxs-lookup"><span data-stu-id="12718-139">An example of such a client application would be a spreadsheet to which a **Dial** menu command or toolbar button is added.</span></span>

<span data-ttu-id="12718-140">Вспомогательные *серверы* телефонии — это приложения, которые могут выполнять функции API телефонии, являющиеся результатом вызова другого приложения с предварительно заданной функцией "TAPI".</span><span class="sxs-lookup"><span data-stu-id="12718-140">Assisted Telephony *servers* are applications that can execute Telephony API functions that result from another application's call to a "tapi"-prefixed function.</span></span> <span data-ttu-id="12718-141">Чтобы сделать его известным как сервер с поддержкой телефонии, такое приложение регистрируется в качестве одного с помощью функции [**линерегистеррекуестреЦипиент**](/windows/win32/api/tapi/nf-tapi-lineregisterrequestrecipient) .</span><span class="sxs-lookup"><span data-stu-id="12718-141">To make itself known as an Assisted Telephony server, such an application registers as one using the [**lineRegisterRequestRecipient**](/windows/win32/api/tapi/nf-tapi-lineregisterrequestrecipient) function.</span></span>

<span data-ttu-id="12718-142">Функции службы телефонии (начинающиеся с префикса "TAPI") называются *функциями запросов*.</span><span class="sxs-lookup"><span data-stu-id="12718-142">The functions of Assisted Telephony (which begin with the prefix "tapi") are known as *request functions*.</span></span> <span data-ttu-id="12718-143">Вспомогательные приложения телефонии, которые обрабатывают эти запросы (поддерживающие серверы телефонии), называются *получателями запросов*.</span><span class="sxs-lookup"><span data-stu-id="12718-143">Assisted Telephony applications that process these requests—Assisted Telephony servers—are called *request recipients*.</span></span>

## <a name="processing-assisted-telephony-requests"></a><span data-ttu-id="12718-144">Обработка запросов к телефонной связи</span><span class="sxs-lookup"><span data-stu-id="12718-144">Processing Assisted Telephony Requests</span></span>

<span data-ttu-id="12718-145">Процесс, с помощью которого доставляются и обслуживаются запросы, выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="12718-145">The process with which requests are delivered and serviced is as follows:</span></span>

1.  <span data-ttu-id="12718-146">Когда TAPI получает запрос на телефонные услуги, он проверяет наличие получателя запроса, то есть приложения, зарегистрированного для обработки этого типа запроса.</span><span class="sxs-lookup"><span data-stu-id="12718-146">When TAPI receives an Assisted Telephony request, it checks for a request recipient, that is, an application currently registered to process that type of request.</span></span> <span data-ttu-id="12718-147">Если имеется получатель запроса, запрос помещается в очередь, а приложение с наивысшим приоритетом, зарегистрированное для службы этого запроса, отправляет сообщение [**\_ запроса строки**](./line-request.md) .</span><span class="sxs-lookup"><span data-stu-id="12718-147">If there is a request recipient, the request is queued, and the highest-priority application that has registered for that request's service is sent a [**LINE\_REQUEST**](./line-request.md) message.</span></span> <span data-ttu-id="12718-148">Сообщение уведомляет получателя запроса о поступлении нового запроса, а также указывает на режим запроса.</span><span class="sxs-lookup"><span data-stu-id="12718-148">The message notifies the request recipient that a new request has arrived, and it carries an indication of the request's mode.</span></span>
2.  <span data-ttu-id="12718-149">Если интерфейсу TAPI не удается найти работающее приложение для обработки такого запроса, оно пытается запустить приложение, которое было зарегистрировано как способное.</span><span class="sxs-lookup"><span data-stu-id="12718-149">If TAPI cannot find a currently running application to process such a request, it tries to launch an application that has been registered as capable of doing so.</span></span> <span data-ttu-id="12718-150">Эти сведения о регистрации записываются в **хандоффприоритиес** в реестре.</span><span class="sxs-lookup"><span data-stu-id="12718-150">This registration information is recorded in **HandoffPriorities** in the registry.</span></span> <span data-ttu-id="12718-151">TAPI пытается запустить приложения в том порядке, в котором они перечислены в разделе **хандоффприоритиес** .</span><span class="sxs-lookup"><span data-stu-id="12718-151">TAPI tries to launch applications in the order in which they are listed in the **HandoffPriorities** section.</span></span> <span data-ttu-id="12718-152">(См. следующий шаг.)</span><span class="sxs-lookup"><span data-stu-id="12718-152">(See the following step.)</span></span>

    <span data-ttu-id="12718-153">Если приложение в настоящее время не зарегистрировано, TAPI проверяет список приложений обработки запросов в связанной записи в **хандоффприоритиес**.</span><span class="sxs-lookup"><span data-stu-id="12718-153">If no application is currently registered, TAPI examines the list of request-processing applications on the associated entry in **HandoffPriorities**.</span></span> <span data-ttu-id="12718-154">Если связанная строка отсутствует в файле, если в ней нет приложений или если ни одно из приложений в списке не может быть запущено, запрос отклоняется с ошибкой ТАПИЕРР \_ норекуестреЦипиент.</span><span class="sxs-lookup"><span data-stu-id="12718-154">If the associated line is missing from the file, if there are no applications listed on it, or if none of the applications in the list can be launched, the request is rejected with the error TAPIERR\_NOREQUESTRECIPIENT.</span></span>

    <span data-ttu-id="12718-155">Когда получатель запроса запускается (независимо от того, был ли он запущен в TAPI), он обязан вызывать [**линерегистеррекуестреЦипиент**](/windows/win32/api/tapi/nf-tapi-lineregisterrequestrecipient) во время процесса запуска и регистрировать себя в качестве получателя запроса.</span><span class="sxs-lookup"><span data-stu-id="12718-155">When a request recipient is launched (whether or not it has been launched by TAPI) it is its duty to call [**lineRegisterRequestRecipient**](/windows/win32/api/tapi/nf-tapi-lineregisterrequestrecipient) during the startup process and register itself as a request recipient.</span></span>

3.  <span data-ttu-id="12718-156">Если в записи указаны одно или несколько приложений, TAPI начинается с первого приложения в списке (наивысший приоритет) и пытается запустить его с помощью функции [**CreateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa) .</span><span class="sxs-lookup"><span data-stu-id="12718-156">If one or more applications are listed in the entry, TAPI begins with the first listed application (highest priority), and attempts to launch it using the [**CreateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa) function.</span></span> <span data-ttu-id="12718-157">Если попытка запуска приложения завершается неудачей, TAPI пытается запустить следующее приложение в списке.</span><span class="sxs-lookup"><span data-stu-id="12718-157">If the attempt to launch the application fails, TAPI attempts to launch the next application in the list.</span></span> <span data-ttu-id="12718-158">При успешном запуске любого приложения TAPI просто помещает запрос в очередь и возвращает приложению уведомление об успешном выполнении, даже если запрос еще не получил сигнал получателю запроса.</span><span class="sxs-lookup"><span data-stu-id="12718-158">When any application launches successfully, TAPI simply queues the request and returns a success indication to the application even though the request hasn't yet been signaled to the request recipient.</span></span>

    <span data-ttu-id="12718-159">После запуска приложения запроса получателя он вызывает [**линерегистеррекуестреЦипиент**](/windows/win32/api/tapi/nf-tapi-lineregisterrequestrecipient), что вызывает отправку сообщения [**\_ запроса строки**](./line-request.md) и сообщает о том, что запрос поставлен в очередь.</span><span class="sxs-lookup"><span data-stu-id="12718-159">After the request recipient application is launched, it calls [**lineRegisterRequestRecipient**](/windows/win32/api/tapi/nf-tapi-lineregisterrequestrecipient), which causes a [**LINE\_REQUEST**](./line-request.md) message to be sent, signaling that the request is queued.</span></span> <span data-ttu-id="12718-160">Если по какой бы то ни было причине запущенное приложение не регистрируется, запрос остается в очереди и остается в очереди до тех пор, пока приложение не будет зарегистрировано для этого типа запроса.</span><span class="sxs-lookup"><span data-stu-id="12718-160">If for some reason the launched application never registers, the request remains queued and remains in the queue indefinitely until an application registers for that type of request.</span></span>

4.  <span data-ttu-id="12718-161">Если интерфейс TAPI находит такое зарегистрированное приложение или успешно запускает его, он помещает запрос в очередь, отправляет \_ сообщение запроса строки в серверное приложение и возвращает индикатор успеха для вызова функции в приложении телефонной связи.</span><span class="sxs-lookup"><span data-stu-id="12718-161">If TAPI finds such a registered application already running or successfully launches one, it queues the request, sending a LINE\_REQUEST message to the server application, and returns a success indication for the function call to the Assisted Telephony application.</span></span> <span data-ttu-id="12718-162">Это сообщение об успешном выполнении сообщает только о том, что запрос был принят и поставлен в очередь, а не на успешное выполнение.</span><span class="sxs-lookup"><span data-stu-id="12718-162">This success message states only that the request has been accepted and queued, not that it has been successfully executed.</span></span>

<span data-ttu-id="12718-163">Когда серверное приложение готово обработать запрос, оно вызывает функцию [**линежетрекуест**](/windows/win32/api/tapi/nf-tapi-linegetrequest) .</span><span class="sxs-lookup"><span data-stu-id="12718-163">When the server application is ready to process a request, it calls the [**lineGetRequest**](/windows/win32/api/tapi/nf-tapi-linegetrequest) function.</span></span> <span data-ttu-id="12718-164">Это позволяет получить все необходимые сведения, например адрес для набора.</span><span class="sxs-lookup"><span data-stu-id="12718-164">This lets it receive any information it needs, such as an address to dial.</span></span> <span data-ttu-id="12718-165">Затем он обрабатывает запрос с помощью функций TAPI (таких как [**линемакекалл**](/windows/win32/api/tapi/nf-tapi-linemakecall) и [**линедроп**](/windows/win32/api/tapi/nf-tapi-linedrop)), которые в противном случае использовались для размещения вызова.</span><span class="sxs-lookup"><span data-stu-id="12718-165">It then processes the request, using the TAPI functions (such as [**lineMakeCall**](/windows/win32/api/tapi/nf-tapi-linemakecall) and [**lineDrop**](/windows/win32/api/tapi/nf-tapi-linedrop)) that would otherwise be used to place the call.</span></span> <span data-ttu-id="12718-166">При вызове **линежетрекуест** удаляется запрос из TAPI, а параметры запроса копируются в буфер запроса, выделенный приложением.</span><span class="sxs-lookup"><span data-stu-id="12718-166">Invoking **lineGetRequest** removes the request from TAPI, and the request parameters are copied in an application-allocated request buffer.</span></span> <span data-ttu-id="12718-167">Размер и Интерпретация содержимого буфера зависят от режима запроса.</span><span class="sxs-lookup"><span data-stu-id="12718-167">The size and interpretation of the contents of the buffer depend on the request mode.</span></span>

<span data-ttu-id="12718-168">Сервер должен гарантировать, что при выполнении запросов он использует правильные параметры.</span><span class="sxs-lookup"><span data-stu-id="12718-168">The server must ensure that it uses the correct parameters when executing requests.</span></span> <span data-ttu-id="12718-169">При этом выполняются следующие действия.</span><span class="sxs-lookup"><span data-stu-id="12718-169">When doing so, these steps are followed:</span></span>

1.  <span data-ttu-id="12718-170">Получатель запроса сначала получает сообщение [**\_ запроса строки**](./line-request.md) , информирующее о том, что для него могут существовать запросы в очереди запросов.</span><span class="sxs-lookup"><span data-stu-id="12718-170">The request recipient first receives a [**LINE\_REQUEST**](./line-request.md) message informing it that requests can exist for it in the request queue.</span></span> <span data-ttu-id="12718-171">Это означает, что приложение вызывает [**линежетрекуест**](/windows/win32/api/tapi/nf-tapi-linegetrequest) и сохраняет его вызов до тех пор, пока очередь не будет остановлена (если запрос на создание нового вызова) или удален существующий вызов.</span><span class="sxs-lookup"><span data-stu-id="12718-171">This tells the application to call [**lineGetRequest**](/windows/win32/api/tapi/nf-tapi-linegetrequest) and keep calling it until the queue is drained (if the request is for making a new call), or to drop an existing call.</span></span> <span data-ttu-id="12718-172">Это сообщение не содержит параметров для запроса, за исключением случаев, когда запрос удаляет существующий вызов.</span><span class="sxs-lookup"><span data-stu-id="12718-172">This message does not contain the parameters for the request, except in the case of a request to drop an existing call.</span></span>
2.  <span data-ttu-id="12718-173">Если запрос должен выполнить новый вызов, сервер телефонной связи использует функцию [**линежетрекуест**](/windows/win32/api/tapi/nf-tapi-linegetrequest) для получения полного запроса, который включает параметры запроса.</span><span class="sxs-lookup"><span data-stu-id="12718-173">If the request is to make a new call, the Assisted Telephony server uses the [**lineGetRequest**](/windows/win32/api/tapi/nf-tapi-linegetrequest) function to retrieve the full request, which includes the request's parameters.</span></span> <span data-ttu-id="12718-174">Теперь на сервере имеется вся необходимая информация, например номер, который необходимо набрать, или идентификатор создателя запроса.</span><span class="sxs-lookup"><span data-stu-id="12718-174">The server now has all the information it needs, such as the number to dial or the identification of the maker of the request.</span></span> <span data-ttu-id="12718-175">Однако сначала сервер должен выделить память, необходимую для хранения этих данных.</span><span class="sxs-lookup"><span data-stu-id="12718-175">First, however, the server must allocate the memory needed to store this information.</span></span>
3.  <span data-ttu-id="12718-176">Наконец, сервер выполняет запрос, вызывая соответствующую функцию TAPI или набор функций.</span><span class="sxs-lookup"><span data-stu-id="12718-176">Finally, the server executes the request by invoking the appropriate TAPI function or set of functions.</span></span>

<span data-ttu-id="12718-177">Если TAPI не может запустить приложение, которое может обслуживаться как получатель запроса, вызов телефонной связи завершается сбоем и возвращает ошибку ТАПИЕРР \_ норекуестреЦипиент.</span><span class="sxs-lookup"><span data-stu-id="12718-177">If TAPI cannot launch an application capable of serving as a request recipient, the Assisted Telephony call fails and returns the error TAPIERR\_NOREQUESTRECIPIENT.</span></span>

## <a name="notes-on-request-recipient-operations"></a><span data-ttu-id="12718-178">Примечания по операциям получателя запроса</span><span class="sxs-lookup"><span data-stu-id="12718-178">Notes on Request Recipient Operations</span></span>

<span data-ttu-id="12718-179">Следующие сведения относятся к системам, на которых обрабатываются запросы на поддержку телефонии.</span><span class="sxs-lookup"><span data-stu-id="12718-179">The following information concerns systems on which Assisted Telephony requests are processed:</span></span>

-   <span data-ttu-id="12718-180">В реестре по умолчанию должно быть список приложений диспетчера звонков в списке приоритетов для [**тапирекуестмакекалл**](/windows/win32/api/tapi/nf-tapi-tapirequestmakecall).</span><span class="sxs-lookup"><span data-stu-id="12718-180">The default registry should list a call manager application in the priority list for [**tapiRequestMakeCall**](/windows/win32/api/tapi/nf-tapi-tapirequestmakecall).</span></span> <span data-ttu-id="12718-181">Это было бы полезно, но не обязательно, чтобы приложение диспетчера вызовов имело параметр меню, который позволяет пользователям задать наивысший приоритет.</span><span class="sxs-lookup"><span data-stu-id="12718-181">It would be helpful, but not essential, for the call manager application to have a menu option that allows users to set it to the highest priority.</span></span>
-   <span data-ttu-id="12718-182">Когда приложение получателя телефонии автоматически запускается с помощью TAPI и является единственным приложением TAPI в системе, это действие инициализирует TAPI.</span><span class="sxs-lookup"><span data-stu-id="12718-182">When an Assisted Telephony recipient application is launched automatically by TAPI and if it is the only TAPI application in the system, this action initializes TAPI.</span></span> <span data-ttu-id="12718-183">Если приложение получателя телефонии инициализирует и завершает работу линейного устройства перед регистрацией для обращений в службы поддержки, TAPI также завершает работу и запрос на телефонную связь теряется.</span><span class="sxs-lookup"><span data-stu-id="12718-183">If the Assisted Telephony recipient application initializes and shuts down the line device before registering for Assisted Telephony requests, TAPI is shut down as well, and the Assisted Telephony request is lost.</span></span> <span data-ttu-id="12718-184">Если запущенное другое приложение TAPI выполняет инициализацию и завершение работы, также могут быть утрачены телефонные запросы на телефонные соединения.</span><span class="sxs-lookup"><span data-stu-id="12718-184">Assisted Telephony requests might also be lost when another TAPI application that is launched performs an initialize and shutdown.</span></span>

 

 
