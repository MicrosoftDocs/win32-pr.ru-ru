---
description: Когда вызов находится в состоянии Connected, данные можно переносить через вызов. Тип носителя вызова предоставляет указание типа данных (например, его тип данных или протокол более высокого уровня) для этого потока мультимедиа.
ms.assetid: 3281387e-3f72-4fda-8199-b3ce6e45e910
title: Мониторинг мультимедиа
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fb54989306fd80c48c0b99c9f8285a83b40bed25
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "105674544"
---
# <a name="media-monitoring"></a><span data-ttu-id="d3d85-104">Мониторинг мультимедиа</span><span class="sxs-lookup"><span data-stu-id="d3d85-104">Media Monitoring</span></span>

<span data-ttu-id="d3d85-105">Когда вызов находится в состоянии *Connected* , данные можно переносить через вызов.</span><span class="sxs-lookup"><span data-stu-id="d3d85-105">When a call is in the *connected* state, data can be transported over the call.</span></span> <span data-ttu-id="d3d85-106">Тип носителя вызова предоставляет указание типа данных (например, его тип данных или протокол более высокого уровня) для этого потока мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="d3d85-106">The call media type provides an indication of the type of data (for example, its datatype, or higher-level protocol) of this media stream.</span></span>

<span data-ttu-id="d3d85-107">TAPI позволяет предоставлять приложениям уведомления об изменениях в типе носителя вызова.</span><span class="sxs-lookup"><span data-stu-id="d3d85-107">TAPI allows applications to be provided with a notification about changes in a call's media type.</span></span> <span data-ttu-id="d3d85-108">Уведомление указывает на новый тип носителя вызова.</span><span class="sxs-lookup"><span data-stu-id="d3d85-108">The notification provides an indication of the call's new media type.</span></span> <span data-ttu-id="d3d85-109">Поставщик услуг принимает решение о том, как это определить.</span><span class="sxs-lookup"><span data-stu-id="d3d85-109">The service provider decides how it wants to make this determination.</span></span> <span data-ttu-id="d3d85-110">Например, поставщик услуг может использовать обработку сигнала потока мультимедиа для определения типа носителя или полагаться на характерные шаблоны звонков, назначенные различным потокам мультимедиа, или на информационные элементы, передаваемые в протоколе нестандартного сигнала.</span><span class="sxs-lookup"><span data-stu-id="d3d85-110">For example, the service provider could use signal processing of the media stream to determine the media type, or it could rely on distinctive ringing patterns assigned to different media streams, or on information elements passed in an out-of-band signaling protocol.</span></span> <span data-ttu-id="d3d85-111">Независимо от того, как достигается определение типа носителя, приложение просто уведомляет об изменениях типа мультимедиа в существующем вызове.</span><span class="sxs-lookup"><span data-stu-id="d3d85-111">Independent of how the media type determination is achieved, the application is simply informed about media type changes on an existing call.</span></span>

<span data-ttu-id="d3d85-112">Дополнительные сведения и список определенных в настоящее время типов или режимов носителей TAPI см. в [разделе \_ константы линемедиамоде](linemediamode--constants.md).</span><span class="sxs-lookup"><span data-stu-id="d3d85-112">For more information and a list of currently defined TAPI media types or modes, see [LINEMEDIAMODE\_ Constants](linemediamode--constants.md).</span></span> <span data-ttu-id="d3d85-113">Поставщики услуг могут реализовывать специфические для поставщика типы носителей для очень специализированных устройств.</span><span class="sxs-lookup"><span data-stu-id="d3d85-113">Service providers may implement provider-specific media types for highly specialized devices.</span></span> <span data-ttu-id="d3d85-114">Сведения о них можно найти в документации по устройству.</span><span class="sxs-lookup"><span data-stu-id="d3d85-114">Information on these will be found in device documentation.</span></span>

<span data-ttu-id="d3d85-115">Типы носителей, определенные TAPI, включают:</span><span class="sxs-lookup"><span data-stu-id="d3d85-115">The media types defined by TAPI include:</span></span>

-   <span data-ttu-id="d3d85-116">Неизвестно.</span><span class="sxs-lookup"><span data-stu-id="d3d85-116">Unknown.</span></span> <span data-ttu-id="d3d85-117">Тип носителя вызова в настоящее время неизвестен — вызов не классифицирован.</span><span class="sxs-lookup"><span data-stu-id="d3d85-117">The media type of the call is not currently known—the call is unclassified.</span></span>
-   <span data-ttu-id="d3d85-118">Интерактивная речь.</span><span class="sxs-lookup"><span data-stu-id="d3d85-118">Interactive voice.</span></span> <span data-ttu-id="d3d85-119">В вызове обнаружена радиоэнергия, и вызов обрабатывается как интерактивный голосовое обращение с пользователем в конце приложения.</span><span class="sxs-lookup"><span data-stu-id="d3d85-119">Voice energy was detected on the call, and the call is handled as an interactive voice call with a person at the application's end.</span></span>
-   <span data-ttu-id="d3d85-120">Автоматическая речь.</span><span class="sxs-lookup"><span data-stu-id="d3d85-120">Automated voice.</span></span> <span data-ttu-id="d3d85-121">В вызове обнаружена радиоэнергия, и вызов обрабатывается как голосовое обращение, но не имеет человека в конце приложения, например, при помощи приложения, отвечающего компьютеру.</span><span class="sxs-lookup"><span data-stu-id="d3d85-121">Voice energy was detected on the call, and the call is handled as a voice call but with no person at the application's end, such as with an answering machine application.</span></span>
-   <span data-ttu-id="d3d85-122">Модем данных.</span><span class="sxs-lookup"><span data-stu-id="d3d85-122">Data modem.</span></span> <span data-ttu-id="d3d85-123">Сеанс модема при вызове.</span><span class="sxs-lookup"><span data-stu-id="d3d85-123">A modem session on the call.</span></span> <span data-ttu-id="d3d85-124">Для использования текущих модемных протоколов требуется вызванная станция для запуска подтверждения.</span><span class="sxs-lookup"><span data-stu-id="d3d85-124">Current modem protocols require the called station to initiate the handshake.</span></span> <span data-ttu-id="d3d85-125">Для вызова входящего модема, как правило, приложение может не выполнять никаких срабатываний.</span><span class="sxs-lookup"><span data-stu-id="d3d85-125">For an incoming data modem call, the application can typically make no positive detection.</span></span> <span data-ttu-id="d3d85-126">То, как поставщик услуг делает это определение, является его выбором.</span><span class="sxs-lookup"><span data-stu-id="d3d85-126">How the service provider makes this determination is its choice.</span></span> <span data-ttu-id="d3d85-127">Например, период бездействия сразу после ответа на входящий вызов можно использовать в качестве эвристики для принятия решения о том, что это может быть вызов модема данных.</span><span class="sxs-lookup"><span data-stu-id="d3d85-127">For example, a period of silence just after answering an incoming call can be used as a heuristic to decide that this might be a data modem call.</span></span>
-   <span data-ttu-id="d3d85-128">G3 Факс.</span><span class="sxs-lookup"><span data-stu-id="d3d85-128">G3 fax.</span></span> <span data-ttu-id="d3d85-129">Сеанс факса группы 3 по вызову.</span><span class="sxs-lookup"><span data-stu-id="d3d85-129">A group 3 fax session on the call.</span></span>
-   <span data-ttu-id="d3d85-130">Факс G4.</span><span class="sxs-lookup"><span data-stu-id="d3d85-130">G4 fax.</span></span> <span data-ttu-id="d3d85-131">Сеанс факса группы 4 по вызову.</span><span class="sxs-lookup"><span data-stu-id="d3d85-131">A group 4 fax session on the call.</span></span>
-   <span data-ttu-id="d3d85-132">TDD.</span><span class="sxs-lookup"><span data-stu-id="d3d85-132">TDD.</span></span> <span data-ttu-id="d3d85-133">Поток мультимедиа вызова использует устройства телефонии для протокола нарушения слуха.</span><span class="sxs-lookup"><span data-stu-id="d3d85-133">The call's media stream uses the Telephony Devices for the Deaf protocol.</span></span>
-   <span data-ttu-id="d3d85-134">Цифровые данные.</span><span class="sxs-lookup"><span data-stu-id="d3d85-134">Digital data.</span></span> <span data-ttu-id="d3d85-135">Поток цифровых данных неопределенного формата.</span><span class="sxs-lookup"><span data-stu-id="d3d85-135">A digital data stream of unspecified format.</span></span>
-   <span data-ttu-id="d3d85-136">Teletex, видеотекс, телекса, Mixed.</span><span class="sxs-lookup"><span data-stu-id="d3d85-136">Teletex, Videotex, Telex, Mixed.</span></span> <span data-ttu-id="d3d85-137">Они соответствуют телематик службам с одинаковыми именами.</span><span class="sxs-lookup"><span data-stu-id="d3d85-137">These correspond to the telematic services of the same names.</span></span>
-   <span data-ttu-id="d3d85-138">ADSI.</span><span class="sxs-lookup"><span data-stu-id="d3d85-138">ADSI.</span></span> <span data-ttu-id="d3d85-139">Сеанс интерфейса аналогового дисплея для вызова.</span><span class="sxs-lookup"><span data-stu-id="d3d85-139">An Analog Display Services Interface session on the call.</span></span> <span data-ttu-id="d3d85-140">Интерфейсы ADSI улучшают голосовые вызовы с помощью буквенно-цифровых данных, загружаемых на телефон, и использования мягких кнопок на телефоне.</span><span class="sxs-lookup"><span data-stu-id="d3d85-140">ADSI enhances voice calls with alphanumeric information downloaded to the phone and the use of soft buttons on the phone.</span></span>

<span data-ttu-id="d3d85-141">Приложение может включить или отключить наблюдение за носителями при указанном вызове с помощью [**линемонитормедиа**](/windows/desktop/api/Tapi/nf-tapi-linemonitormedia).</span><span class="sxs-lookup"><span data-stu-id="d3d85-141">An application can enable or disable media monitoring on a specified call with [**lineMonitorMedia**](/windows/desktop/api/Tapi/nf-tapi-linemonitormedia).</span></span> <span data-ttu-id="d3d85-142">Приложение указывает, какие типы носителей он заинтересован в наблюдении, и когда включен Мониторинг мультимедиа, обнаружение типа носителя приводит к тому, что приложение будет уведомлено с помощью [**строки \_ монитормедиа**](line-monitormedia.md) Message.</span><span class="sxs-lookup"><span data-stu-id="d3d85-142">The application specifies which media types it is interested in monitoring, and when media monitoring is enabled, the detection of a media type change causes the application to be notified with the [**LINE\_MONITORMEDIA**](line-monitormedia.md) message.</span></span> <span data-ttu-id="d3d85-143">Это сообщение предоставляет маркер вызова, на котором обнаружено изменение типа носителя, а также новый тип носителя.</span><span class="sxs-lookup"><span data-stu-id="d3d85-143">This message provides the call handle on which the media type change was detected as well as the new media type.</span></span>

<span data-ttu-id="d3d85-144">Существует различие между типом носителя вызова, сообщаемым [**линежеткаллинфо**](/windows/desktop/api/Tapi/nf-tapi-linegetcallinfo) , и событием типа носителя, которое выводится \_ сообщениями монитормедиа.</span><span class="sxs-lookup"><span data-stu-id="d3d85-144">There is a distinction between the media type of a call as reported by [**lineGetCallInfo**](/windows/desktop/api/Tapi/nf-tapi-linegetcallinfo) and the media type event reports by LINE\_MONITORMEDIA messages.</span></span> <span data-ttu-id="d3d85-145">Тип носителя вызова определяется исключительно приложениями-владельцами вызова и не изменяется автоматически с помощью событий мониторинга мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="d3d85-145">A call's media type is determined exclusively by owner applications of the call and is not automatically changed by media monitoring events.</span></span> <span data-ttu-id="d3d85-146">Единственным исключением является исходное определение типа носителя, которое может быть выполнено библиотекой динамической компоновки TAPI для выбора первого владельца вызова.</span><span class="sxs-lookup"><span data-stu-id="d3d85-146">The one exception is the initial media type determination that can be performed by the TAPI dynamic-link library to select the first owner of a call.</span></span> <span data-ttu-id="d3d85-147">Можно сказать, что в этом случае библиотека является владельцем вызова.</span><span class="sxs-lookup"><span data-stu-id="d3d85-147">One could argue that in this case, the library is the owner of the call.</span></span>

<span data-ttu-id="d3d85-148">Мониторинг типа мультимедиа по умолчанию выполняется для типов мультимедиа, для которых было открыто устройство линии.</span><span class="sxs-lookup"><span data-stu-id="d3d85-148">Default media type monitoring is performed for the media types for which the line device has been opened.</span></span> <span data-ttu-id="d3d85-149">Это позволяет определить тип носителя входящего вызова перед передачей вызова приложению в зависимости от требований приложения.</span><span class="sxs-lookup"><span data-stu-id="d3d85-149">This allows an incoming call's media type to be determined before the call is handed to an application based on what the application demands.</span></span> <span data-ttu-id="d3d85-150">Область наблюдения за носителями вызова ограничивается временем существования вызова.</span><span class="sxs-lookup"><span data-stu-id="d3d85-150">The scope of the media monitoring of a call is bound by the lifetime of the call.</span></span> <span data-ttu-id="d3d85-151">Наблюдение за носителями в вызове завершается, как только вызов *отключается* или переходит в режим *простоя*.</span><span class="sxs-lookup"><span data-stu-id="d3d85-151">Media monitoring on a call ends as soon as the call *disconnects* or goes *idle*.</span></span>

<span data-ttu-id="d3d85-152">Приложение может получать идентификаторы устройств для различных классов устройств, связанных с открытой строкой, вызывая [**линежетид**](/windows/desktop/api/Tapi/nf-tapi-linegetid).</span><span class="sxs-lookup"><span data-stu-id="d3d85-152">An application can obtain device identifiers for various device classes associated with an opened line by calling [**lineGetID**](/windows/desktop/api/Tapi/nf-tapi-linegetid).</span></span> <span data-ttu-id="d3d85-153">Эта функция принимает маркер строки, адрес или маркер вызова и описание класса устройства.</span><span class="sxs-lookup"><span data-stu-id="d3d85-153">This function takes a line handle, address, or call handle and a device class description.</span></span> <span data-ttu-id="d3d85-154">Он возвращает идентификатор устройства для данного класса устройств, связанного с устройством Open Line, адресом или вызовом.</span><span class="sxs-lookup"><span data-stu-id="d3d85-154">It returns the device identifier for the device of the given device class that is associated with the open line device, address, or call.</span></span> <span data-ttu-id="d3d85-155">Если класс устройств имеет значение TAPI/Line, то возвращается идентификатор устройства линейного устройства.</span><span class="sxs-lookup"><span data-stu-id="d3d85-155">If the device class is "tapi/line," then the device identifier of the line device is returned.</span></span> <span data-ttu-id="d3d85-156">Если класс устройств имеет значение MCI/Wave, то возвращается идентификатор устройства mci вавеаудио (если поддерживается), что позволяет выполнять такие действия, как запись или воспроизведение звука через вызов в строке.</span><span class="sxs-lookup"><span data-stu-id="d3d85-156">If the device class is "mci/wave," then the device identifier of an mci waveaudio device is returned (if supported), which allows activities such as the recording or playback of audio over the call on the line.</span></span>

<span data-ttu-id="d3d85-157">Приложение может использовать возвращенный идентификатор устройства с соответствующим API мультимедиа для запроса возможностей устройства и последующего открытия устройства мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="d3d85-157">The application can use the returned device identifier with the corresponding media API to query the device's capabilities and subsequently open the media device.</span></span> <span data-ttu-id="d3d85-158">Например, если приложению требуется использовать строку в качестве устройства аудио, сначала необходимо вызвать [**вавеинжетдевкапс**](/windows/win32/api/mmeapi/nf-mmeapi-waveingetdevcaps) и/или [**вавеаутжетдевкапс**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutgetdevcaps) , чтобы определить возможности аудио вывода устройства.</span><span class="sxs-lookup"><span data-stu-id="d3d85-158">For example, if your application needs to use the line as a waveform device, it must first call [**waveInGetDevCaps**](/windows/win32/api/mmeapi/nf-mmeapi-waveingetdevcaps) and/or [**waveOutGetDevCaps**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutgetdevcaps) to determine the waveform capabilities of the device.</span></span> <span data-ttu-id="d3d85-159">Стандартный формат данных формата Wave, поддерживаемый телефонией в Северная Америка, — это 8-разрядный закон в 8000 выборок в секунду, хотя драйвер волнового устройства может преобразовать эту частоту дискретизации и компандинг к другим распространенным мультимедийным форматам мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="d3d85-159">The typical waveform data format supported by telephony in North America is 8-bit m-law at 8000 samples per second, although the wave device driver can convert this sample rate and companding to other more common multimedia audio formats.</span></span>

<span data-ttu-id="d3d85-160">Чтобы впоследствии открыть линейное устройство для воспроизведения звука с помощью API аудио, приложение вызывает [**вавеаутопен**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutopen).</span><span class="sxs-lookup"><span data-stu-id="d3d85-160">To subsequently open a line device for audio playback using the waveform API, an application calls [**waveOutOpen**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutopen).</span></span> <span data-ttu-id="d3d85-161">Реализация **вавеаутопен** зависит от конкретного устройства, и для реализации этой функции существует множество параметров.</span><span class="sxs-lookup"><span data-stu-id="d3d85-161">The implementation of **waveOutOpen** is device specific, and there are a variety of options for implementing this function.</span></span>

 

 
