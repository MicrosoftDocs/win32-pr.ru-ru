---
title: Multipath I/O теперь поддерживает расширенные блоки запросов хранилища
description: Multipath I/O теперь поддерживает расширенные блоки запросов хранилища
ms.assetid: 5373D9ED-34AF-4D66-8888-49F1EBF768F4
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f558f8088b5066b51447c5f2ea23edd5154d5c10
ms.sourcegitcommit: 46376be61d3fa308f9b1a06d7e2fa122a39755af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2020
ms.locfileid: "104339505"
---
# <a name="multipath-io-now-supports-extended-storage-request-blocks"></a><span data-ttu-id="c410f-103">Multipath I/O теперь поддерживает расширенные блоки запросов хранилища</span><span class="sxs-lookup"><span data-stu-id="c410f-103">Multipath I/O now supports extended storage request blocks</span></span>

## <a name="platforms"></a><span data-ttu-id="c410f-104">Платформы</span><span class="sxs-lookup"><span data-stu-id="c410f-104">Platforms</span></span>

<span data-ttu-id="c410f-105">**Серверы** — Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="c410f-105">**Servers** – Windows Server 2012</span></span> 

## <a name="description"></a><span data-ttu-id="c410f-106">Описание</span><span class="sxs-lookup"><span data-stu-id="c410f-106">Description</span></span>

<span data-ttu-id="c410f-107">В Windows Server 2012 Новая структура, \_ блок запроса хранилища \_ (Extended СРБ), заменяет \_ блок запроса SCSI \_ (Legacy СРБ) в основном стеке хранилища.</span><span class="sxs-lookup"><span data-stu-id="c410f-107">In Windows Server 2012, a new structure, the STORAGE\_REQUEST\_BLOCK (extended SRB) replaces the SCSI\_REQUEST\_BLOCK (legacy SRB) in the core storage stack.</span></span> <span data-ttu-id="c410f-108">Расширенная Србс реплицирует функциональность устаревших Србс, но также расширяема и масштабируется.</span><span class="sxs-lookup"><span data-stu-id="c410f-108">Extended SRBs replicate the functionality of the legacy SRBs, but are also extensible and scalable.</span></span>

<span data-ttu-id="c410f-109">Multipath I/O (MPIO) поддерживает расширенные Србс и позволяет модулям конкретных устройств (DSM) указать также расширенную поддержку СРБ.</span><span class="sxs-lookup"><span data-stu-id="c410f-109">Multipath I/O (MPIO) supports extended SRBs and allows Device Specific Modules (DSMs) to specify extended SRB support as well.</span></span> <span data-ttu-id="c410f-110">Однако, чтобы стек хранилища многопутевого устройства мог использовать расширенную Србс, **все компоненты в стеке должны поддерживать расширенные србс, включая DSM**.</span><span class="sxs-lookup"><span data-stu-id="c410f-110">However, in order for a multipath device’s storage stack to use extended SRBs, **all components in the stack must support extended SRBs, including the DSM**.</span></span> <span data-ttu-id="c410f-111">Обратите внимание, что модуль DSM Microsoft in-Box (MSDSM) поддерживает расширенные Србс.</span><span class="sxs-lookup"><span data-stu-id="c410f-111">Note that the Microsoft in-box DSM, MSDSM, does support extended SRBs.</span></span>

<span data-ttu-id="c410f-112">\_Структура транзитного \_ перебора по протоколу SCSI \_ не входит в состав расширенных проходов MPIO через структуру, так как в зависимости от отладчика командной строки (CDB) может быть переменного размера.</span><span class="sxs-lookup"><span data-stu-id="c410f-112">The SCSI\_PASS\_THROUGH\_EX structure is not part of the extended MPIO pass through structure since the extended SCSI pass through can be of a variable size, depending on the command line debugger (CDB).</span></span> <span data-ttu-id="c410f-113">Вместо этого расширенное передаваемое значение MPIO имеет поле, которое описывает смещение от начала расширенного прохода по структуре с помощью функции перебора \_ по \_ каналу SCSI через \_ структуру.</span><span class="sxs-lookup"><span data-stu-id="c410f-113">Instead, the extended MPIO pass through has a field that describes the offset from the beginning of the extended MPIO pass through structure to the SCSI\_PASS\_THROUGH\_EX structure.</span></span> <span data-ttu-id="c410f-114">Вызывающий объект должен убедиться, что они выделили буфер соответствующего размера и правильно установили смещение SCSI-передачи.</span><span class="sxs-lookup"><span data-stu-id="c410f-114">The caller must make sure they allocate a buffer of the appropriate size and set the SCSI pass through offset correctly.</span></span> <span data-ttu-id="c410f-115">При условии, что вызывающий объект соответствует правилам для расширенных передаваемых дисков SCSI, не должно быть дополнительной работы, чтобы они использовали расширенный проход MPIO.</span><span class="sxs-lookup"><span data-stu-id="c410f-115">As long as the caller follows the rules for extended SCSI pass-throughs, then there should not be any extra work for them to use the extended MPIO pass through.</span></span>

> [!Note]  
> <span data-ttu-id="c410f-116">Если модуль DSM не поддерживает расширенную Србс, MPIO не сможет пройти запросы, для которых в качестве \_ \_ флага ioctl требуется \_ \_ установлен флаг DSM.</span><span class="sxs-lookup"><span data-stu-id="c410f-116">If the DSM does not support extended SRBs, MPIO will fail extended MPIO pass through requests that have the MPIO\_IOCTL\_FLAG\_INVOLVE\_DSM flag set.</span></span>

 

## <a name="manifestation"></a><span data-ttu-id="c410f-117">Проявление</span><span class="sxs-lookup"><span data-stu-id="c410f-117">Manifestation</span></span>

<span data-ttu-id="c410f-118">Если какая либо часть стека хранилища устройства, включая DSM, не поддерживает расширенные Србс, стек хранилища вернется к использованию устаревших Србс.</span><span class="sxs-lookup"><span data-stu-id="c410f-118">If any part of the device’s storage stack, including DSM, does not support extended SRBs, the storage stack will revert to using legacy SRBs.</span></span>

## <a name="solution"></a><span data-ttu-id="c410f-119">Решение</span><span class="sxs-lookup"><span data-stu-id="c410f-119">Solution</span></span>

<span data-ttu-id="c410f-120">Для поддержки блоков запросов хранилища модуль DSM должен иметь только два требования к MPIO \_ \_ :</span><span class="sxs-lookup"><span data-stu-id="c410f-120">There are only two MPIO requirements for a DSM to support STORAGE\_REQUEST\_BLOCKS:</span></span>

-   <span data-ttu-id="c410f-121">Модуль DSM должен сообщить о своем типе как DsmType6</span><span class="sxs-lookup"><span data-stu-id="c410f-121">The DSM must report its type as DsmType6</span></span>
-   <span data-ttu-id="c410f-122">Модуль DSM должен предоставить \_ \_ \_ поддерживаемую функцию типа адреса DSM</span><span class="sxs-lookup"><span data-stu-id="c410f-122">The DSM must provide the DSM\_ADDRESS\_TYPE\_SUPPORTED function</span></span>

<span data-ttu-id="c410f-123">Если модуль DSM не сообщает о DsmType6 или если он сообщает DsmType6, но не предоставляет \_ \_ \_ функцию поддерживаемого типа адреса DSM, MPIO считает, что DSM не поддерживает расширенную србс.</span><span class="sxs-lookup"><span data-stu-id="c410f-123">If the DSM does not report DsmType6 or if it reports DsmType6 but does not provide the DSM\_ADDRESS\_TYPE\_SUPPORTED function, MPIO will assume the DSM does not support extended SRBs.</span></span>

<span data-ttu-id="c410f-124">\_ \_ \_ Поддерживаемая функция типа адреса DSM принимает два параметра, один из которых является типом адреса.</span><span class="sxs-lookup"><span data-stu-id="c410f-124">The DSM\_ADDRESS\_TYPE\_SUPPORTED function accepts two parameters, one of which is an address type.</span></span> <span data-ttu-id="c410f-125">Этот тип адреса должен быть одним из \_ значений типа адреса хранилища, \_ \_ \* определенных в СРБ. h.</span><span class="sxs-lookup"><span data-stu-id="c410f-125">This address type must be one of the STORAGE\_ADDRESS\_TYPE\_\* values defined in srb.h.</span></span> <span data-ttu-id="c410f-126">Модуль DSM должен возвращать значение TRUE, если он поддерживает заданный тип адреса, и значение FALSE в противном случае.</span><span class="sxs-lookup"><span data-stu-id="c410f-126">The DSM must return TRUE if it supports the given address type and FALSE if it does not.</span></span> <span data-ttu-id="c410f-127">Определение "Support" в конечном итоге обеспечивается DSM.</span><span class="sxs-lookup"><span data-stu-id="c410f-127">The definition of “support” is ultimately up to the DSM.</span></span> <span data-ttu-id="c410f-128">MPIO использует эту функцию, чтобы гарантировать, что модуль DSM не будет вести себя, если он передается расширенному СРБ с \_ структурой адресов стор данного типа.</span><span class="sxs-lookup"><span data-stu-id="c410f-128">MPIO uses this function to ensure that the DSM will not misbehave if it is handed an extended SRB with a STOR\_ADDRESS structure of the given type.</span></span> <span data-ttu-id="c410f-129">Таким образом, MPIO обычно вызывает эту функцию при перечислении многопутевого устройства, но функцию можно вызвать в любое время.</span><span class="sxs-lookup"><span data-stu-id="c410f-129">As such, MPIO generally calls this function when a multipath device is being enumerated, but the function could be called at any time.</span></span>

<span data-ttu-id="c410f-130">Если модуль DSM никогда не касается адреса стор расширенного СРБ \_ , он может вернуть значение true для любого допустимого \_ \_ значения типа адреса хранилища \_ \* .</span><span class="sxs-lookup"><span data-stu-id="c410f-130">If a DSM never touches an extended SRB’s STOR\_ADDRESS, then it can return TRUE for any valid STORAGE\_ADDRESS\_TYPE\_\* value.</span></span> <span data-ttu-id="c410f-131">Ознакомьтесь с примером DSM в WDK.</span><span class="sxs-lookup"><span data-stu-id="c410f-131">Review the sample DSM in the WDK.</span></span>

<span data-ttu-id="c410f-132">**Другие важные примечания**</span><span class="sxs-lookup"><span data-stu-id="c410f-132">**Other important notes**</span></span>

-   <span data-ttu-id="c410f-133">DSM, поддерживающие расширенную Србс, должны иметь возможность обрабатывать \_ \_ структуры блоков запросов SCSI и \_ блоки запросов хранилища \_ .</span><span class="sxs-lookup"><span data-stu-id="c410f-133">DSMs that support extended SRBs must be able to handle both SCSI\_REQUEST\_BLOCK structures and STORAGE\_REQUEST\_BLOCK structures.</span></span> <span data-ttu-id="c410f-134">Так как DSM сообщает, что он поддерживает расширенную Србс, не означает, что он будет монопольно принимать расширенные Србс.</span><span class="sxs-lookup"><span data-stu-id="c410f-134">Just because a DSM reports that it supports extended SRBs does not mean that it will exclusively receive extended SRBs.</span></span> <span data-ttu-id="c410f-135">Кроме расширенных Србс, он по-прежнему может получать любое количество устаревших Србс, и поэтому должен иметь возможность обрабатывать оба.</span><span class="sxs-lookup"><span data-stu-id="c410f-135">It may still receive any number of legacy SRBs in addition to extended SRBs, and therefore must be able to handle both.</span></span>
-   <span data-ttu-id="c410f-136">Мы предоставили в WDK файл заголовка с именем србхелпер. h, который содержит встроенные функции, помогающие драйверам, которые должны поддерживать как расширенные, так и устаревшие Србс.</span><span class="sxs-lookup"><span data-stu-id="c410f-136">We have provided a header file in the WDK called srbhelper.h that contains inline functions to help drivers that must handle both extended and legacy SRBs.</span></span> <span data-ttu-id="c410f-137">Наш пример DSM использует этот заголовок, чтобы вы могли использовать его в качестве примера использования этих функций.</span><span class="sxs-lookup"><span data-stu-id="c410f-137">Our sample DSM uses this header so you can use it as an example of how to use these functions.</span></span>
-   <span data-ttu-id="c410f-138">Модуль DSM, не поддерживающий расширенную Србс, никогда не должен будет поддерживать расширенную Србс.</span><span class="sxs-lookup"><span data-stu-id="c410f-138">A DSM that does not support extended SRBs will never have to handle extended SRBs.</span></span>
-   <span data-ttu-id="c410f-139">Возможно, что MPIO будет переносить стек хранилища на устаревшие Србс в случае, если модуль DSM не поддерживает заданный \_ тип адреса хранения \_ \_ \* (но в противном случае поддерживает расширенный србс).</span><span class="sxs-lookup"><span data-stu-id="c410f-139">It’s possible that a MPIO will cause the storage stack to fall back on legacy SRBs in the event that the DSM does not support a given STORAGE\_ADDRESS\_TYPE\_\* (but otherwise supports extended SRBs).</span></span>
-   <span data-ttu-id="c410f-140">"BTL8" — единственный \_ тип адреса хранения \_ , \_ \* определенный в настоящее время для Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="c410f-140">“BTL8” is the only STORAGE\_ADDRESS\_TYPE\_\*currently defined for Windows Server 2012.</span></span>

 

 




