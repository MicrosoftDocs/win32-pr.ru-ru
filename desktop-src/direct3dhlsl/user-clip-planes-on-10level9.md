---
title: Пользовательские плоскости для устройств на уровне компонентов 9
description: Начиная с Windows 8, язык шейдеров высокого уровня (Майкрософт) (HLSL) поддерживает синтаксис, который можно использовать с API Microsoft Direct3D 11 для указания плоскости-клипов пользователя на уровне компонентов 9 \_ x и выше.
ms.assetid: C51FB0E5-94C3-4E7F-AC33-E5F0F26EDC11
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 968831ca39f2501a44b00f202fd8dfda1f92d1e7
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104338057"
---
# <a name="user-clip-planes-on-feature-level-9-hardware"></a>Пользовательские плоскости для устройств на уровне компонентов 9

Начиная с Windows 8, язык шейдеров высокого уровня (Майкрософт) (HLSL) поддерживает синтаксис, который можно использовать с API Microsoft Direct3D 11 для указания плоскости-клипов пользователя на [уровне компонентов](/windows/desktop/direct3d11/overviews-direct3d-11-devices-downlevel-intro) 9 \_ x и выше. Этот синтаксис Clip-плоскостей можно использовать для создания шейдера, а затем использовать этот объект шейдера с API Direct3D 11 для выполнения на всех уровнях функций Direct3D.

-   [Фон](#background-reading)
-   [Синтаксис](#syntax)
-   [Создание вырезок в пространстве клипов на уровне функций 9 и выше](#creating-clip-planes-in-clip-space-on-feature-level-9-and-higher)
    -   [Фоновое чтение](#background-reading)
    -   [уровни компонентов 10Level9](#10level9-feature-levels)
    -   [Математика для плоскости обрезки](#clip-plane-math)
    -   [Обрезка в области просмотра](#clipping-in-view-space)
    -   [Матрица проекции](#projection-matrix)
    -   [Плоскость обрезки области обрезки](#clip-space-clip-plane)
-   [См. также](#related-topics)

## <a name="background"></a>Историческая справка

Вы можете получить доступ к пользовательским роликам в API Microsoft Direct3D 9 с помощью методов [**IDirect3DDevice9:: сетклипплане**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-setclipplane) и [**IDirect3DDevice9:: жетклипплане**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-getclipplane) . В Microsoft Direct3D 10 и более поздних версиях доступ к пользовательским роликам можно получить с помощью [ \_ клипдистанцеа SV](dx-graphics-hlsl-semantics.md) . Но до Windows 8, ОКП \_ клипдистанце было недоступно для оборудования [уровня функции](/windows/desktop/direct3d11/overviews-direct3d-11-devices-downlevel-intro) 9 \_ x в API Direct3D 10 или Direct3D 11. Таким образом, до выхода Windows 8, единственный способ получить доступ к пользовательским плоскостям с оборудованием уровня Feature 9 \_ x с помощью API Direct3D 9. Приложения для Магазина Windows Direct3D не могут использовать API Direct3D 9. Здесь описывается синтаксис, который можно использовать для доступа к пользовательским роликам через API Direct3D 11 на уровне функций 9 \_ x и выше.

В приложениях для определения набора невидимых плоскостей в трехмерном мире, которые обрисуются (отбрасываются) все рисуемые примитивы, используются резкие плоскости. Windows не будет рисовать любой пиксель, находящийся на отрицательной стороне любой плоскости-отсечения. После этого приложения могут использовать резкие плоскости для отрисовки плоских отражений.

## <a name="syntax"></a>Синтаксис

Используйте этот синтаксис для объявления плоскостей Clip в качестве атрибутов функций в [объявлении функции](dx-graphics-hlsl-function-syntax.md). Например, здесь мы используем синтаксис для фрагмента шейдера вершин:

``` syntax
cbuffer ClipPlaneConstantBuffer 
{
       float4 clipPlane1;
       float4 clipPlane2;
};

[clipplanes(clipPlane1,clipPlane2)]
VertexShaderOutput main(VertexShaderInput input)
{
       // the rest of the vertex shader doesn't refer to the clip plane
 
       …
 
       return output;
}
```

В этом примере фрагмента шейдера вершин обозначает две плоскости. Он показывает, что необходимо поместить новый атрибут **клиппланес** в квадратные скобки непосредственно перед возвращаемым значением шейдера вершин. В скобках после атрибута **клиппланес** вы предоставляете список из до 6 констант **float4** , определяющих коэффициенты плоскости для каждой активной плоскости клипов. В примере также показано, что коэффициенты каждой плоскости должны находиться в буфере констант.

> [!Note]  
> Нет доступных синтаксических конструкций для динамического отключения плоскости Clip. Необходимо либо перекомпилировать другой, идентичный шейдер без атрибута **клиппланес** , либо ваше приложение может задать коэффициенты в константном буфере равными нулю, чтобы плоскость больше не влияла ни на одну геометрию.

 

Этот синтаксис доступен для любой цели шейдера вершин 4,0 или более поздней версии, которая включает VS \_ 4 \_ 0 \_ уровня \_ 9 \_ 1 и VS \_ 4 \_ 0 \_ уровня \_ 9 \_ 3.

## <a name="creating-clip-planes-in-clip-space-on-feature-level-9-and-higher"></a>Создание вырезок в пространстве клипов на уровне функций 9 и выше

Здесь мы покажем, как создавать резкие плоскости на [уровне функций](/windows/desktop/direct3d11/overviews-direct3d-11-devices-downlevel-intro) 9 \_ x и выше.

### <a name="background-reading"></a>Фоновое чтение

«Знакомство с программированием трехмерной игры с помощью DirectX 10» от Федор г. Luna объясняет графический математический график (главы 1, 2 и 3), а также различные пробелы и преобразования пробелов, происходящие в шейдере вершин (разделы 5,6 и 5,8).

### <a name="10level9-feature-levels"></a>уровни компонентов 10Level9

В Direct3D 10 и более поздних версиях можно обрезать любое пространство, которое имеет смысл, часто в пространстве мира или области просмотра. Но Direct3D 9 использует место для обрезки, что является предварительной перспективой для разделения области проекции. Векторы находятся в пространстве обрезки, когда шейдер вершин передает их этапам, которые следуют за [графическим конвейером](/windows/desktop/direct3d11/overviews-direct3d-11-graphics-pipeline).

При написании приложения для Магазина Windows необходимо использовать уровни компонентов 10Level9 ([уровень функций](/windows/desktop/direct3d11/overviews-direct3d-11-devices-downlevel-intro) 9 \_ x), чтобы приложение можно было запускать на уровне функций 9 \_ x и более высоких аппаратных средств. Так как приложение поддерживает уровень функций 9 \_ x и более поздних версий, необходимо также использовать распространенную возможность применения плоскостей к области обрезки.

При компиляции шейдера вершин с VS \_ 4 0 на \_ \_ уровне \_ 9 \_ 1 или более поздней версии шейдер вершин может использовать атрибут **клиппланес** . Объект Direct3D 10 или более поздней версии имеет скалярное произведение порожденной вершины, которая содержит каждую из глобальных констант **float4** , указанных в атрибуте. Объект Direct3D 9 имеет достаточно метаданных, чтобы среда выполнения 10Level9 выдавала соответствующие вызовы [**IDirect3DDevice9:: сетклипплане**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-setclipplane).

### <a name="clip-plane-math"></a>Математика для плоскости обрезки

Плоскость обрезки определяется с помощью вектора с 4 компонентами. Первые три компонента определяют вектор x, y и z, основывается от источника в пространстве, которое нужно вырезать. Этот вектор подразумевает плоскость, перпендикулярную вектору и выполняемую через источник. Windows сохраняет все пиксели на стороне вектора плоскости и обрезает все пиксели за плоскостью. Компонент, расположенный на этом уровне, помещает плоскость обратно и заставляет Windows обрезаться меньше (отрицательный w приводит к тому, что Windows обрезается) вдоль векторной линии. Если компоненты x, y, z составляют вектор (нормализованный), w помещает на плоскости единицы w.

Математические вычисления, выполняемые графическим процессором (GPU) для определения обрезки, — это простой точечный продукт между вектором вершин (x, y, z, 1) и вектором плоскости обрезки. Эта математическая операция создает длину проекции на векторе плоскости Clip. Отрицательная точка содержит вершину, которая расположена на обрезанной стороне плоскости.

### <a name="clipping-in-view-space"></a>Обрезка в области просмотра

Вот наша вершина в пространстве для просмотра:

![вершина в пространстве просмотра](images/vertex-clip.png)

Вот наша плоскость обрезки в области просмотра:

![плоскость обрезки в области просмотра](images/clip-plane-view.png)

Ниже приведена точка вершины и плоскости Clip в области просмотра:

Клипдистанце = **v** · **C**  =  *v* ₓ *c* ₓ +*v*<sub>y</sub>*c*<sub>y</sub>  +  *v*<sub>z</sub>*c*<sub>z</sub>  +  *c*<sub>w</sub>

Эта математическая операция работает для объекта Direct3D 10 или более поздней версии, но не будет работать для объекта Direct3D 9. Для Direct3D 9 сначала нужно получить преобразование проекции в область обрезки.

### <a name="projection-matrix"></a>Матрица проекции

Матрица проекции преобразует вершину из пространства просмотра (где источником является глаз средства просмотра, + x — справа, + y — вверх), а + z — прямо вперед) в место обрезки. Матрица проекции считывает вершину вырезки оборудования и [этапа растрирования](/windows/desktop/direct3d11/d3d10-graphics-programming-guide-rasterizer-stage). Ниже приведена стандартная перспективная матрица (другие проекции, для которых требуются различные математические вычисления):

<dl> Коэффициент *r*   по ширине и высоте окна  
   угол обзора α  
*f*   расстояние от средства просмотра до дальней плоскости  
*n*   расстояние от средства просмотра до ближайшей плоскости
</dl>![матрица проекции](images/projection-matrix.png)

Следующая матрица является упрощенной версией предыдущей матрицы. Мы видим, что матрица упрощена, поэтому мы можем использовать ее позже в операции матрицы.

![Упрощенная матрица проекции](images/projection-matrix2.png)

Теперь мы преобразуем вершину представления "представление" в пространство обрезки с помощью матрицы.

![умножение матрицы](images/matrix-multiply.png)

В нашей операции матрицы, наши компоненты x и y незначительно корректируются, но наши компоненты z и w довольно искажены. Наша плоскость обрезки не даст нам нам, что нам нужно.

### <a name="clip-space-clip-plane"></a>Плоскость обрезки области обрезки

Здесь мы хотим создать плоскость обрезки, для которой произведение точки с нашей вершиной размещения отсечения дает нам то же значение, что и **v · C** в разделе [Обрезка в области просмотра](#clipping-in-view-space) .

![плоскость обрезки](images/clip-space-clip-plane.png)

**версия** · **C**  =  **v P** · **C**<sub>P</sub>

*v* ₓ *c* ₓ +*v*<sub>y</sub>*c*<sub>y</sub>  +  *v*<sub>z</sub>*c*<sub>z</sub>  +  *c*<sub>w</sub>  =  *v* ₓ *P* ₓ *c*<sub>p ₓ</sub>  + *v*<sub>y</sub>*p*<sub>y</sub>*c*<sub>p <sub>y</sub></sub>  +  *v*<sub>z</sub>*A*<sub>y</sub>*c*<sub>p <sub>z</sub></sub>  +  *BC*<sub>p <sub>z</sub></sub>  +  *v*<sub>z</sub>*c*<sub>p <sub>w</sub></sub>

Теперь можно прервать предыдущую математическую операцию вверх по компоненту вершины в четыре отдельных уравнения:

![компонент x вершины для продукта плоскости Clip](images/clip-space-clip-plane-equ1.png)

![Координата y для продукта плоскости Clip](images/clip-space-clip-plane-equ2.png)

![компонент вершины с вершиной продукта для плоскости Clip](images/clip-space-clip-plane-equ3.png)

![компонент координат z для продукта плоскости Clip](images/clip-space-clip-plane-equ4.png)

Наша плоскость для просмотра и матрица проекции являются производными и дают нам нашу область клипов.

![плоскость обрезки области обрезки](images/clip-space-clip-plane-matrix.png)

## <a name="related-topics"></a>См. также

<dl> <dt>

[Руководство по программированию для HLSL](dx-graphics-hlsl-pguide.md)
</dt> <dt>

[Синтаксис объявления функций](dx-graphics-hlsl-function-syntax.md)
</dt> </dl>

 

 