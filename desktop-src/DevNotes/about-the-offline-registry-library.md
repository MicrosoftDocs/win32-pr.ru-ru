---
description: Библиотека автономных разделов реестра используется для изменения куста реестра за пределами активного системного реестра.
ms.assetid: 61db2804-1b67-473f-8dd7-6be6c6a7184e
title: Сведения о библиотеке автономных разделов реестра
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e7e08b401a4a77f55a54c48ad147bf38c8796472
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104495894"
---
# <a name="about-the-offline-registry-library"></a><span data-ttu-id="17e87-103">Сведения о библиотеке автономных разделов реестра</span><span class="sxs-lookup"><span data-stu-id="17e87-103">About the Offline Registry Library</span></span>

<span data-ttu-id="17e87-104">Библиотека автономных разделов реестра используется для изменения куста реестра за пределами активного системного реестра.</span><span class="sxs-lookup"><span data-stu-id="17e87-104">The offline registry library is used to modify a registry hive outside of the active system registry.</span></span>

<span data-ttu-id="17e87-105">Библиотека автономных разделов реестра предназначена для сценариев обновления реестра, таких как обслуживание образа операционной системы.</span><span class="sxs-lookup"><span data-stu-id="17e87-105">The offline registry library is intended for registry update scenarios such as servicing an operating system image.</span></span> <span data-ttu-id="17e87-106">Функции автономного реестра предоставляют следующие возможности, недоступные в стандартных функциях реестра:</span><span class="sxs-lookup"><span data-stu-id="17e87-106">The offline registry functions provide the following capabilities that are not available with the standard registry functions:</span></span>

-   <span data-ttu-id="17e87-107">Функции автономного реестра можно использовать для изменения куста реестра в любом поддерживаемом формате реестра.</span><span class="sxs-lookup"><span data-stu-id="17e87-107">The offline registry functions can be used to modify a registry hive in any supported registry format.</span></span> <span data-ttu-id="17e87-108">Стандартные функции реестра могут вносить изменения только в активный куст реестра, а изменения должны быть совместимы с версией Windows, работающей в системе.</span><span class="sxs-lookup"><span data-stu-id="17e87-108">The standard registry functions can make changes only to an active registry hive and the changes must be compatible with the version of Windows running on the system.</span></span>
-   <span data-ttu-id="17e87-109">Для автономной библиотеки реестра требуется только доступ на чтение для открытия файла куста реестра и доступа на запись для сохранения файла.</span><span class="sxs-lookup"><span data-stu-id="17e87-109">The offline registry library requires only read access to open a registry hive file and write access to save the file.</span></span> <span data-ttu-id="17e87-110">Никакие другие проверки доступа к объектам в Hive не выполняются, что позволяет изменять Hive с правами обычного пользователя.</span><span class="sxs-lookup"><span data-stu-id="17e87-110">No other access checks are performed on objects in the hive, making it possible to modify the hive with standard user privileges.</span></span> <span data-ttu-id="17e87-111">При использовании стандартных функций реестра Загрузка Hive в активный реестр является привилегированной операцией, которая требует административного доступа.</span><span class="sxs-lookup"><span data-stu-id="17e87-111">With the standard registry functions, loading a hive into the active registry is a privileged operation that requires administrative access.</span></span>

<span data-ttu-id="17e87-112">Автономные функции реестра не следует использовать в качестве замены для функций системного реестра по следующим причинам.</span><span class="sxs-lookup"><span data-stu-id="17e87-112">The offline registry functions should not be used as a substitute for the system registry functions for the following reasons:</span></span>

-   <span data-ttu-id="17e87-113">Невозможно совместно использовать кусты реестра между процессами с помощью функций автономного реестра.</span><span class="sxs-lookup"><span data-stu-id="17e87-113">It is impossible to share registry hives between processes using the offline registry functions.</span></span>
-   <span data-ttu-id="17e87-114">Функции автономного реестра используют простую блокировку, что может привести к серьезному снижению производительности для многопоточных приложений.</span><span class="sxs-lookup"><span data-stu-id="17e87-114">The offline registry functions use simple locking that can lead to serious performance degradation for multithreaded applications.</span></span>
-   <span data-ttu-id="17e87-115">Изменения, внесенные в автономные функции реестра, не сохраняются до тех пор, пока не будет вызвана функция [**орсавехиве**](orsavehive.md) .</span><span class="sxs-lookup"><span data-stu-id="17e87-115">Changes made with the offline registry functions are not saved until the [**ORSaveHive**](orsavehive.md) function is called.</span></span>

<span data-ttu-id="17e87-116">Приложения не должны использовать автономные функции реестра для обхода требований безопасности системного реестра.</span><span class="sxs-lookup"><span data-stu-id="17e87-116">Applications should not use the offline registry functions to bypass the security requirements of the system registry.</span></span> <span data-ttu-id="17e87-117">Чтобы загрузить Hive, приложение, работающее без специальных привилегий, необходимых функции [реглоадкэй](/windows/win32/api/winreg/nf-winreg-regloadkeya) , может использовать функцию [реглоадаппкэй](/windows/win32/api/winreg/nf-winreg-regloadappkeya) .</span><span class="sxs-lookup"><span data-stu-id="17e87-117">To load a hive, an application running without the special privileges required by the [RegLoadKey](/windows/win32/api/winreg/nf-winreg-regloadkeya) function can use the [RegLoadAppKey](/windows/win32/api/winreg/nf-winreg-regloadappkeya) function.</span></span>

<span data-ttu-id="17e87-118">**Windows Server 2003 и Windows XP:** Функция [реглоадаппкэй](/windows/win32/api/winreg/nf-winreg-regloadappkeya) не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="17e87-118">**Windows Server 2003 and Windows XP:** The [RegLoadAppKey](/windows/win32/api/winreg/nf-winreg-regloadappkeya) function is not supported.</span></span>

<span data-ttu-id="17e87-119">*Автономный куст реестра* — это куст реестра, который был загружен в память с помощью функций автономного реестра.</span><span class="sxs-lookup"><span data-stu-id="17e87-119">An *offline registry hive* is a registry hive that has been loaded into memory using the offline registry functions.</span></span> <span data-ttu-id="17e87-120">Чтобы создать пустой куст автономного реестра, используйте функцию [**оркреатехиве**](orcreatehive.md) .</span><span class="sxs-lookup"><span data-stu-id="17e87-120">To create an empty offline registry hive, use the [**ORCreateHive**](orcreatehive.md) function.</span></span> <span data-ttu-id="17e87-121">Чтобы изменить существующий куст реестра, используйте функцию [регсавекэй](/windows/win32/api/winreg/nf-winreg-regsavekeya) или [регсавекэйекс](/windows/win32/api/winreg/nf-winreg-regsavekeyexa) , чтобы сохранить куст из активного системного реестра в файл, а затем с помощью функции [**оропенхиве**](oropenhive.md) открыть файл.</span><span class="sxs-lookup"><span data-stu-id="17e87-121">To modify an existing registry hive, use the [RegSaveKey](/windows/win32/api/winreg/nf-winreg-regsavekeya) or [RegSaveKeyEx](/windows/win32/api/winreg/nf-winreg-regsavekeyexa) function to save a hive from the active system registry to a file, and then use the [**OROpenHive**](oropenhive.md) function to open the file.</span></span>

<span data-ttu-id="17e87-122">Функции [**оркреатехиве**](orcreatehive.md) и [**оропенхиве**](oropenhive.md) возвращают маркер корневого ключа куста реестра вне сети.</span><span class="sxs-lookup"><span data-stu-id="17e87-122">The [**ORCreateHive**](orcreatehive.md) and [**OROpenHive**](oropenhive.md) functions return a handle to the root key of the offline registry hive.</span></span> <span data-ttu-id="17e87-123">Этот маркер может использоваться как обработчик любого другого ключа в автономном кусте реестра, за исключением следующих исключений: функции [**оркреатекэй**](orcreatekey.md) и [**оропенкэй**](oropenkey.md) нельзя использовать для возврата маркера в корневой раздел. Функция [**орклосекэй**](orclosekey.md) не может использоваться для закрытия корневого ключа; Функция [**орделетекэй**](ordeletekey.md) не может использоваться для удаления корневого ключа.</span><span class="sxs-lookup"><span data-stu-id="17e87-123">This handle can be used like a handle to any other key in the offline registry hive with the following exceptions: the [**ORCreateKey**](orcreatekey.md) and [**OROpenKey**](oropenkey.md) functions cannot be used to return a handle to the root key; the [**ORCloseKey**](orclosekey.md) function cannot be used to close the root key; and the [**ORDeleteKey**](ordeletekey.md) function cannot be used to delete the root key.</span></span> <span data-ttu-id="17e87-124">Во всех этих случаях функция завершается ошибкой с **\_ недопустимым \_ параметром**.</span><span class="sxs-lookup"><span data-stu-id="17e87-124">In all of these cases, the function fails with **ERROR\_INVALID\_PARAMETER**.</span></span>

<span data-ttu-id="17e87-125">Используйте функцию [**оркреатекэй**](orcreatekey.md) , чтобы добавить ключи в куст реестра Open offline и функцию [**орсетвалуе**](orsetvalue.md) , чтобы задать значения ключей.</span><span class="sxs-lookup"><span data-stu-id="17e87-125">Use the [**ORCreateKey**](orcreatekey.md) function to add keys to an open offline registry hive and the [**ORSetValue**](orsetvalue.md) function to set the keys' values.</span></span> <span data-ttu-id="17e87-126">Библиотека автономных разделов реестра поддерживает другие основные операции с реестром, такие как перечисление, извлечение и удаление ключей и значений, а также задание ключевых атрибутов, таких как поведение безопасности и виртуализации.</span><span class="sxs-lookup"><span data-stu-id="17e87-126">The offline registry library supports other basic registry operations such as enumerating, retrieving, and deleting keys and values, and setting key attributes such as security and virtualization behavior.</span></span> <span data-ttu-id="17e87-127">Список функций см. в разделе [функции библиотеки автономного реестра](offline-registry-library-functions.md).</span><span class="sxs-lookup"><span data-stu-id="17e87-127">For a list of functions, see [Offline Registry Library Functions](offline-registry-library-functions.md).</span></span>

<span data-ttu-id="17e87-128">Чтобы сохранить изменения, внесенные в открытый куст автономного реестра, используйте функцию [**орсавехиве**](orsavehive.md) , чтобы сохранить куст в файл.</span><span class="sxs-lookup"><span data-stu-id="17e87-128">To save changes made to an open offline registry hive, use the [**ORSaveHive**](orsavehive.md) function to save the hive to a file.</span></span> <span data-ttu-id="17e87-129">(Изменения не сохраняются, если не вызывается **орсавехиве** .) После сохранения куста используйте функцию [**орклосехиве**](orclosehive.md) , чтобы закрыть куст и свободные ресурсы, связанные с ним.</span><span class="sxs-lookup"><span data-stu-id="17e87-129">(The changes do not persist unless **ORSaveHive** is called.) After saving the hive, use the [**ORCloseHive**](orclosehive.md) function to close the hive and free resources associated with it.</span></span>

<span data-ttu-id="17e87-130">Куст автономного реестра проверяется только в том случае, если он открыт с помощью функции [**оропенхиве**](oropenhive.md) .</span><span class="sxs-lookup"><span data-stu-id="17e87-130">An offline registry hive is validated only when it is opened using the [**OROpenHive**](oropenhive.md) function.</span></span> <span data-ttu-id="17e87-131">Если куст поврежден, операция просто завершается ошибкой. попытка восстановить куст реестра не выполняется.</span><span class="sxs-lookup"><span data-stu-id="17e87-131">If the hive is corrupt, the operation simply fails; no attempt is made to repair the hive.</span></span> <span data-ttu-id="17e87-132">Проверки доступа к объектам в Hive не выполняются до тех пор, пока куст не будет загружен в активный реестр с помощью функции [реглоадкэй](/windows/win32/api/winreg/nf-winreg-regloadkeya) .</span><span class="sxs-lookup"><span data-stu-id="17e87-132">Access checks on objects in the hive are not performed until the hive is loaded into an active registry with the [RegLoadKey](/windows/win32/api/winreg/nf-winreg-regloadkeya) function.</span></span>

<span data-ttu-id="17e87-133">Функции автономного реестра не поддерживают [Стандартные ключи](../sysinfo/predefined-keys.md).</span><span class="sxs-lookup"><span data-stu-id="17e87-133">The offline registry functions do not support the [predefined keys](../sysinfo/predefined-keys.md).</span></span>

<span data-ttu-id="17e87-134">Все строки имени ключа и значения, передаваемые в автономные функции реестра, должны быть в Юникоде.</span><span class="sxs-lookup"><span data-stu-id="17e87-134">All key and value name strings passed to offline registry functions must be Unicode.</span></span>

## <a name="related-topics"></a><span data-ttu-id="17e87-135">См. также</span><span class="sxs-lookup"><span data-stu-id="17e87-135">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="17e87-136">Функции библиотеки автономного реестра \_</span><span class="sxs-lookup"><span data-stu-id="17e87-136">Offline Registry Library\_Functions</span></span>](offline-registry-library-functions.md)
</dt> </dl>

 

 
