---
title: Массивы MIDL
description: Массивы MIDL.
ms.assetid: dee30788-0575-4b49-a6b8-5208ad295183
keywords:
- типы данных MIDL, массивы
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78c5ca08740084783f615d2cd34b46f0de4a4020
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104069949"
---
# <a name="midl-arrays"></a>Массивы MIDL

Деклараторы массивов отображаются в теле интерфейса IDL в виде одного из следующих элементов:

-   Часть общего объявления
-   Член структуры или декларатора объединения
-   Параметр для удаленного вызова процедуры

Границы каждого измерения массива выражаются внутри отдельной пары квадратных скобок. Выражение, результатом которого является *n* , означает нижнюю границу, равную нулю, и верхнюю границу *n-1*. Если квадратные скобки пусты или содержат одну звездочку ( \* ), Нижняя граница равна нулю, а верхняя граница определяется во время выполнения.

Массив также может содержать два значения, разделенные многоточием, которые представляют нижнюю и верхнюю границы массива, как показано \[ *ниже*... *верхний* \] . Для Microsoft RPC требуется нижняя граница, равная нулю. Компилятор MIDL не распознает конструкции, указывающие ненулевые нижние границы.

Массивы могут быть связаны с атрибутами [**поля size \_ —**](size-is.md), [**Max \_ —**](max-is.md), [**length \_ —**](length-is.md), [**First \_ —**](first-is.md), а [**Last \_ —**](last-is.md) указать размер массива или часть массива, которая содержит допустимые данные. Эти атрибуты полей определяют параметр, поле структуры или константу, указывающую измерение или индекс массива.

Массив должен быть связан с идентификатором, указанным в атрибуте Field следующим образом: Если массив является параметром, идентификатор также должен быть параметром той же функции. Если массив является полем структуры, идентификатор должен быть другим полем структуры этой же структуры.

Массив называется "согласованным", если верхняя граница любого измерения определяется во время выполнения. (Во время выполнения можно определить только верхние границы.) Для определения верхней границы в объявлении массива должен быть указан атрибут [**size \_**](size-is.md) или [**Max. \_**](max-is.md)

Массив называется "разной", если его границы определяются во время компиляции, но диапазон переданных элементов определяется в среде выполнения. Чтобы определить диапазон переданных элементов, в объявлении массива должна быть указана [**длина \_**](length-is.md), [**первый \_ —**](first-is.md), или [**Last \_ —**](last-is.md) атрибут.

Согласованный переменный массив (также называемый "Open") — это массив, верхняя граница которого и диапазон передаваемых элементов определяются во время выполнения. Не более одного согласованного или согласованного переменного массива может быть вложен в структуру C и должен быть последним элементом структуры. В отличие от этого, несоответствующие различные массивы могут находиться в любом месте структуры.

## <a name="examples"></a>Примеры

``` syntax
/* IDL file interface body */ 
#define MAX_INDEX 10 
 
typedef char  ATYPE[MAX_INDEX]; 
typedef short BTYPE[];        // Equivalent to [*]; 
typedef long  CTYPE[*][10];   // [][10] 
typedef float DTYPE[0..10];   // Equivalent to [11] 
typedef float ETYPE[0..(MAX_INDEX)];  
 
typedef struct 
{ 
    unsigned short size; 
    unsigned short length; 
    [size_is(size), length_is(length)] char string[*]; 
} counted_string; 
 
HRESULT MyFunction( 
     [in, out] short * pSize,  
     [in, out, string, size_is(*pSize)] char a[0..*] 
);
```

Дополнительные сведения см. в разделе [массивы и указатели](/windows/desktop/Rpc/arrays-and-pointers).

## <a name="multidimensional-arrays"></a>Многомерные массивы

Пользователь может объявлять типы, которые являются массивами, а затем объявлять массивы объектов таких типов. Семантика *объемных* массивов *n*-мерных массивов аналогична семантике  + *n многоуровневых* массивов.

Например, \_ тип Rect может быть определен как двухмерный массив, а переменная *Rect* может быть определена как массив \_ типа Rect. Это эквивалентно трехмерному массиву, *эквивалентному \_ Rect*:

``` syntax
typedef short int RECT_TYPE[10][20]; 
RECT_TYPE rect[15]; 
short int equivalent_rect[15][10][20];  // ~RECT_TYPE rect[15]
```

Microsoft RPC ориентирован на C. В соответствии с соглашениями языка C, в среде выполнения можно определить только первое измерение многомерного массива. Взаимодействие с массивами IDL устройства DCE, которые поддерживают другие языки, ограничено:

-   Многомерные массивы с константами (с определением времени компиляции).
-   Многомерные массивы со всеми постоянными границами, за исключением первого измерения. Верхняя граница и диапазон переданных элементов первого измерения зависят от среды выполнения.
-   Любые одномерные массивы с нижней границей, равной нулю.

Если **\[** [**строковый**](string.md) **\]** атрибут используется в многомерных массивах, атрибут применяется к крайнему правому массиву.

## <a name="arrays-of-pointers"></a>Массивы указателей

Ссылочные указатели должны указывать на допустимые данные. Клиентское приложение должно выделить всю память для **\[** [**входного**](in.md) **\]** или **\[** [**выходного**](out-idl.md) **\]** массива ссылочных указателей, особенно если массив связан с **\[ в \]**, а также в значениях в, а **\[** **\]** также в, **\[** [**length \_**](length-is.md) **\]** или **\[** [**Last \_**](last-is.md) **\]** . Клиентское приложение также должно инициализировать все элементы массива перед вызовом. Перед возвратом клиенту серверное приложение должно убедиться, что все элементы массива в переданной точке диапазона находятся в допустимом хранилище.

На стороне сервера заглушка выделяет хранилище для всех элементов массива независимо от **\[** [**длины \_ —**](length-is.md) **\]** или **\[** [**последнего \_**](last-is.md) **\]** значения во время вызова. Эта функция может повлиять на производительность приложения.

На массивы уникальных указателей не накладываются никакие ограничения. Как на клиенте, так и на сервере хранилище выделяется для пустых указателей. Если указатели не равны NULL, данные помещаются в предварительно выделенное хранилище.

Необязательный декларатор указателя может предшествовать декларатору массива.

Если внедренные ссылочные указатели являются **\[** [](out-idl.md) **\]** параметрами только для использования, код Server Manager должен присвоить допустимые значения массиву ссылочных указателей. Пример:

``` syntax
typedef [ref] short * ARefPointer;
typedef ARefPointer ArrayOfRef[10];
HRESULT proc1( [out] ArrayOfRef Parameter );
```

Созданные заглушки распределяют массив и присваивают значения NULL всем указателям, внедренным в массив.

 

 