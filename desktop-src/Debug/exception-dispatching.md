---
description: При возникновении исключения оборудования или программного обеспечения процессор прекращает выполнение в момент возникновения исключения и передает управление системе.
ms.assetid: 35a1b9bd-8da9-47e6-beda-e0b159bd840d
title: Отправка исключения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e02b40aa132541fe88d692cbbf1881a8b620a209
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104140794"
---
# <a name="exception-dispatching"></a><span data-ttu-id="5ff5c-103">Отправка исключения</span><span class="sxs-lookup"><span data-stu-id="5ff5c-103">Exception Dispatching</span></span>

<span data-ttu-id="5ff5c-104">При возникновении исключения оборудования или программного обеспечения процессор прекращает выполнение в момент возникновения исключения и передает управление системе.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-104">When a hardware or software exception occurs, the processor stops execution at the point at which the exception occurred and transfers control to the system.</span></span> <span data-ttu-id="5ff5c-105">Во первых, система сохраняет как состояние компьютера текущего потока, так и сведения, описывающие исключение.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-105">First, the system saves both the machine state of the current thread and information that describes the exception.</span></span> <span data-ttu-id="5ff5c-106">Затем система пытается найти обработчик исключений для обработки исключения.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-106">The system then attempts to find an exception handler to handle the exception.</span></span>

<span data-ttu-id="5ff5c-107">Состояние компьютера в потоке, в котором произошло исключение, сохраняется в структуре [**контекста**](/windows/desktop/api/WinNT/ns-winnt-arm64_nt_context) .</span><span class="sxs-lookup"><span data-stu-id="5ff5c-107">The machine state of the thread in which the exception occurred is saved in a [**CONTEXT**](/windows/desktop/api/WinNT/ns-winnt-arm64_nt_context) structure.</span></span> <span data-ttu-id="5ff5c-108">Эта информация (называемая *записью контекста*) позволяет системе продолжить выполнение в точке исключения, если исключение успешно обработано.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-108">This information (called the *context record*) enables the system to continue execution at the point of the exception if the exception is successfully handled.</span></span> <span data-ttu-id="5ff5c-109">Описание исключения (называемое **записью исключения**) сохраняется в структуре [**\_ записи исключения**](/windows/desktop/api/WinNT/ns-winnt-exception_record) .</span><span class="sxs-lookup"><span data-stu-id="5ff5c-109">The description of the exception (called the **exception record**) is saved in an [**EXCEPTION\_RECORD**](/windows/desktop/api/WinNT/ns-winnt-exception_record) structure.</span></span> <span data-ttu-id="5ff5c-110">Так как в нем хранятся зависимые от компьютера сведения о записи контекста отдельно от независимой от компьютера информации об исключении, механизм обработки исключений передается на разные платформы.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-110">Because it stores the machine-dependent information of the context record separately from the machine-independent information of the exception record, the exception-handling mechanism is portable to different platforms.</span></span>

<span data-ttu-id="5ff5c-111">Информация в контексте и записи исключений доступна с помощью функции [**жетексцептионинформатион**](getexceptioninformation.md) и может быть предоставлена любым обработчикам исключений, которые выполняются в результате исключения.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-111">The information in both the context and exception records is available by means of the [**GetExceptionInformation**](getexceptioninformation.md) function, and can be made available to any exception handlers that are executed as a result of the exception.</span></span> <span data-ttu-id="5ff5c-112">Запись исключения содержит следующие сведения.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-112">The exception record includes the following information.</span></span>

-   <span data-ttu-id="5ff5c-113">Код исключения, определяющий тип исключения.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-113">An exception code that identifies the type of exception.</span></span>
-   <span data-ttu-id="5ff5c-114">Флаги, указывающие, является ли исключение непрерывным.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-114">Flags indicating whether the exception is continuable.</span></span> <span data-ttu-id="5ff5c-115">Любая попытка продолжить выполнение после непостоянного исключения создает еще одно исключение.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-115">Any attempt to continue execution after a noncontinuable exception generates another exception.</span></span>
-   <span data-ttu-id="5ff5c-116">Указатель на другую запись исключения.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-116">A pointer to another exception record.</span></span> <span data-ttu-id="5ff5c-117">Это упрощает создание связанного списка исключений при возникновении вложенных исключений.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-117">This facilitates creation of a linked list of exceptions if nested exceptions occur.</span></span>
-   <span data-ttu-id="5ff5c-118">Адрес, по которому произошло исключение.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-118">The address at which the exception occurred.</span></span>
-   <span data-ttu-id="5ff5c-119">Массив аргументов, которые предоставляют дополнительные сведения об исключении.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-119">An array of arguments that provide additional information about the exception.</span></span>

<span data-ttu-id="5ff5c-120">При возникновении исключения в коде пользовательского режима система использует следующий порядок поиска для поиска обработчика исключений:</span><span class="sxs-lookup"><span data-stu-id="5ff5c-120">When an exception occurs in user-mode code, the system uses the following search order to find an exception handler:</span></span>

1.  <span data-ttu-id="5ff5c-121">Если процесс отлаживается, система уведомляет отладчик.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-121">If the process is being debugged, the system notifies the debugger.</span></span> <span data-ttu-id="5ff5c-122">Дополнительные сведения см. в разделе [обработка исключений отладчика](debugger-exception-handling.md).</span><span class="sxs-lookup"><span data-stu-id="5ff5c-122">For more information, see [Debugger Exception Handling](debugger-exception-handling.md).</span></span>
2.  <span data-ttu-id="5ff5c-123">Если процесс не отлаживается или связанный отладчик не обрабатывает исключение, система пытается найти обработчик исключений на основе кадров путем поиска в кадрах стека потока, в котором произошло исключение.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-123">If the process is not being debugged, or if the associated debugger does not handle the exception, the system attempts to locate a frame-based exception handler by searching the stack frames of the thread in which the exception occurred.</span></span> <span data-ttu-id="5ff5c-124">Сначала система выполняет поиск в текущем кадре стека, а затем выполняет поиск по предшествующим кадрам стека в обратном порядке.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-124">The system searches the current stack frame first, then searches through preceding stack frames in reverse order.</span></span>
3.  <span data-ttu-id="5ff5c-125">Если не удается найти обработчик на основе фрейма или обработчик на основе фрейма не обрабатывает исключение, но процесс отлаживается, система уведомляет отладчик второй раз.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-125">If no frame-based handler can be found, or no frame-based handler handles the exception, but the process is being debugged, the system notifies the debugger a second time.</span></span>
4.  <span data-ttu-id="5ff5c-126">Если процесс не отлаживается или связанный отладчик не обрабатывает исключение, система обеспечивает обработку по умолчанию на основе типа исключения.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-126">If the process is not being debugged, or if the associated debugger does not handle the exception, the system provides default handling based on the exception type.</span></span> <span data-ttu-id="5ff5c-127">Для большинства исключений действием по умолчанию является вызов функции [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) .</span><span class="sxs-lookup"><span data-stu-id="5ff5c-127">For most exceptions, the default action is to call the [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) function.</span></span>

<span data-ttu-id="5ff5c-128">При возникновении исключения в коде режима ядра система выполняет поиск в кадрах стека ядра в попытке найти обработчик исключений.</span><span class="sxs-lookup"><span data-stu-id="5ff5c-128">When an exception occurs in kernel-mode code, the system searches the stack frames of the kernel stack in an attempt to locate an exception handler.</span></span> <span data-ttu-id="5ff5c-129">Если обработчик не найден или обработчик не обрабатывает исключение, система завершает работу так, как если бы была вызвана функция [**екситвиндовс**](/windows/win32/api/winuser/nf-winuser-exitwindows) .</span><span class="sxs-lookup"><span data-stu-id="5ff5c-129">If a handler cannot be located or no handler handles the exception, the system is shut down as if the [**ExitWindows**](/windows/win32/api/winuser/nf-winuser-exitwindows) function had been called.</span></span>

 

 
