---
description: Обработчик исключений на основе кадров позволяет решать, что исключение может возникнуть в определенной последовательности кода. Обработчик исключений на основе кадров состоит из следующих элементов.
ms.assetid: 07aac772-f917-48b7-91a9-3b5d4cb43600
title: Обработка исключений на основе кадров
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 12b268b5d02de83bca22a1d3311905b05be1f748
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104496383"
---
# <a name="frame-based-exception-handling"></a><span data-ttu-id="67d9c-104">Обработка исключений на основе кадров</span><span class="sxs-lookup"><span data-stu-id="67d9c-104">Frame-based Exception Handling</span></span>

<span data-ttu-id="67d9c-105">*Обработчик исключений на основе кадров* позволяет решать, что исключение может возникнуть в определенной последовательности кода.</span><span class="sxs-lookup"><span data-stu-id="67d9c-105">A *frame-based exception handler* allows you to deal with the possibility that an exception may occur in a certain sequence of code.</span></span> <span data-ttu-id="67d9c-106">Обработчик исключений на основе кадров состоит из следующих элементов.</span><span class="sxs-lookup"><span data-stu-id="67d9c-106">A frame-based exception handler consists of the following elements.</span></span>

-   <span data-ttu-id="67d9c-107">Защищенный текст кода</span><span class="sxs-lookup"><span data-stu-id="67d9c-107">A guarded body of code</span></span>
-   <span data-ttu-id="67d9c-108">Критерий фильтра</span><span class="sxs-lookup"><span data-stu-id="67d9c-108">A filter expression</span></span>
-   <span data-ttu-id="67d9c-109">Блок обработчика исключений</span><span class="sxs-lookup"><span data-stu-id="67d9c-109">An exception-handler block</span></span>

<span data-ttu-id="67d9c-110">Обработчики исключений на основе кадров объявляются в синтаксисе, зависящем от языка.</span><span class="sxs-lookup"><span data-stu-id="67d9c-110">Frame-based exception handlers are declared in language-specific syntax.</span></span> <span data-ttu-id="67d9c-111">Например, в компиляторе оптимизации Microsoft C/C++ они реализуются с помощью **\_ \_ try** и **\_ \_ except**.</span><span class="sxs-lookup"><span data-stu-id="67d9c-111">For example, in the Microsoft C/C++ Optimizing Compiler, they are implemented using **\_\_try** and **\_\_except**.</span></span> <span data-ttu-id="67d9c-112">Дополнительные сведения см. в разделе [синтаксис обработчика](handler-syntax.md).</span><span class="sxs-lookup"><span data-stu-id="67d9c-112">For more information, see [Handler Syntax](handler-syntax.md).</span></span>

<span data-ttu-id="67d9c-113">*Защищенный текст кода* — это набор из одной или нескольких инструкций, для которых выражение фильтра и блок обработчика исключений обеспечивают защиту обработки исключений.</span><span class="sxs-lookup"><span data-stu-id="67d9c-113">The *guarded body of code* is a set of one or more statements for which the filter expression and the exception-handler block provide exception-handling protection.</span></span> <span data-ttu-id="67d9c-114">Защищенный текст может быть блоком кода, набором вложенных блоков или целой процедурой или функцией.</span><span class="sxs-lookup"><span data-stu-id="67d9c-114">The guarded body can be a block of code, a set of nested blocks, or an entire procedure or function.</span></span> <span data-ttu-id="67d9c-115">При использовании оптимизирующих компиляторов Microsoft C/C++ защищенный текст заключен в фигурные скобки ( {} ) после ключевого слова **\_ \_ try** .</span><span class="sxs-lookup"><span data-stu-id="67d9c-115">Using the Microsoft C/C++ Optimizing Compiler, a guarded body is enclosed by braces ({}) following the **\_\_try** keyword.</span></span>

<span data-ttu-id="67d9c-116">*Критерий фильтра* обработчика исключений на основе кадров является выражением, которое вычисляется системой при возникновении исключения в защищенном тексте.</span><span class="sxs-lookup"><span data-stu-id="67d9c-116">The *filter expression* of a frame-based exception handler is an expression that is evaluated by the system when an exception occurs within the guarded body.</span></span> <span data-ttu-id="67d9c-117">Эта оценка приводит к одному из следующих действий в системе.</span><span class="sxs-lookup"><span data-stu-id="67d9c-117">This evaluation results in one of the following actions by the system.</span></span>

-   <span data-ttu-id="67d9c-118">Система останавливает поиск обработчика исключений, восстанавливает состояние компьютера и возобновляет выполнение потока в момент возникновения исключения.</span><span class="sxs-lookup"><span data-stu-id="67d9c-118">The system stops its search for an exception handler, restores the machine state, and continues thread execution at the point at which the exception occurred.</span></span>
-   <span data-ttu-id="67d9c-119">Система продолжит поиск обработчика исключений.</span><span class="sxs-lookup"><span data-stu-id="67d9c-119">The system continues its search for an exception handler.</span></span>
-   <span data-ttu-id="67d9c-120">Система передает управление обработчику исключений, и выполнение потока последовательно выполняется в кадре стека, в котором найден обработчик исключений.</span><span class="sxs-lookup"><span data-stu-id="67d9c-120">The system transfers control to the exception handler, and thread execution continues sequentially in the stack frame in which the exception handler is found.</span></span> <span data-ttu-id="67d9c-121">Если обработчик не находится в кадре стека, в котором произошло исключение, система очищает стек, освобождая текущий кадр стека и другие кадры стека до тех пор, пока не вернется к кадру стека обработчика исключений.</span><span class="sxs-lookup"><span data-stu-id="67d9c-121">If the handler is not in the stack frame in which the exception occurred, the system unwinds the stack, leaving the current stack frame and any other stack frames until it is back to the exception handler's stack frame.</span></span> <span data-ttu-id="67d9c-122">Перед выполнением обработчика исключений обработчики завершения выполняются для всех защищенных частей кода, которые прерываются в результате перемещения управления в обработчик исключений.</span><span class="sxs-lookup"><span data-stu-id="67d9c-122">Before an exception handler is executed, termination handlers are executed for any guarded bodies of code that terminated as a result of the transfer of control to the exception handler.</span></span> <span data-ttu-id="67d9c-123">Дополнительные сведения о обработчиках завершения см. в разделе [обработка завершения](termination-handling.md).</span><span class="sxs-lookup"><span data-stu-id="67d9c-123">For more information about termination handlers, refer to [Termination Handling](termination-handling.md).</span></span>

<span data-ttu-id="67d9c-124">Критерий фильтра может быть простым выражением или вызывать *функцию фильтра* , которая пытается справиться с исключением.</span><span class="sxs-lookup"><span data-stu-id="67d9c-124">The filter expression can be a simple expression, or it can invoke a *filter function* that attempts to handle the exception.</span></span> <span data-ttu-id="67d9c-125">Вы можете вызвать функции [**GetExceptionCode**](getexceptioncode.md) и [**жетексцептионинформатион**](getexceptioninformation.md) из критерия фильтра, чтобы получить сведения о фильтруемом исключении.</span><span class="sxs-lookup"><span data-stu-id="67d9c-125">You can call the [**GetExceptionCode**](getexceptioncode.md) and [**GetExceptionInformation**](getexceptioninformation.md) functions from within a filter expression to get information about the exception being filtered.</span></span> <span data-ttu-id="67d9c-126">**GetExceptionCode** возвращает код, определяющий тип исключения, а **жетексцептионинформатион** возвращает указатель на структуру [**\_ указателей исключений**](/windows/desktop/api/WinNT/ns-winnt-exception_pointers) , содержащую указатели на структуры записей [**контекста**](/windows/desktop/api/WinNT/ns-winnt-arm64_nt_context) и [**исключения \_**](/windows/desktop/api/WinNT/ns-winnt-exception_record) .</span><span class="sxs-lookup"><span data-stu-id="67d9c-126">**GetExceptionCode** returns a code that identifies the type of exception, and **GetExceptionInformation** returns a pointer to an [**EXCEPTION\_POINTERS**](/windows/desktop/api/WinNT/ns-winnt-exception_pointers) structure that contains pointers to [**CONTEXT**](/windows/desktop/api/WinNT/ns-winnt-arm64_nt_context) and [**EXCEPTION\_RECORD**](/windows/desktop/api/WinNT/ns-winnt-exception_record) structures.</span></span>

<span data-ttu-id="67d9c-127">Эти функции нельзя вызывать из функции фильтра, но их возвращаемые значения могут передаваться в качестве параметров функции фильтра.</span><span class="sxs-lookup"><span data-stu-id="67d9c-127">These functions cannot be called from within a filter function, but their return values can be passed as parameters to a filter function.</span></span> <span data-ttu-id="67d9c-128">[**GetExceptionCode**](getexceptioncode.md) можно использовать в блоке обработчика исключений, но [**жетексцептионинформатион**](getexceptioninformation.md) не может потому, что информация, на которую он указывает, обычно находится в стеке и уничтожается при передаче управления в обработчик исключений.</span><span class="sxs-lookup"><span data-stu-id="67d9c-128">[**GetExceptionCode**](getexceptioncode.md) can be used within the exception-handler block, but [**GetExceptionInformation**](getexceptioninformation.md) cannot because the information it points to is typically on the stack and is destroyed when control is transferred to an exception handler.</span></span> <span data-ttu-id="67d9c-129">Однако приложение может скопировать сведения в надежное хранилище, чтобы сделать их доступными для обработчика исключений.</span><span class="sxs-lookup"><span data-stu-id="67d9c-129">However, an application can copy the information to safe storage to make it available to the exception handler.</span></span>

<span data-ttu-id="67d9c-130">Преимущество функции фильтра заключается в том, что она может обменяться исключением и возвращать значение, которое приводит к тому, что система продолжит выполнение с момента возникновения исключения.</span><span class="sxs-lookup"><span data-stu-id="67d9c-130">The advantage of a filter function is that it can handle an exception and return a value that causes the system to continue execution from the point at which the exception occurred.</span></span> <span data-ttu-id="67d9c-131">В отличие от блока обработчика исключений, выполнение выполняется последовательно из обработчика исключений, а не из точки исключения.</span><span class="sxs-lookup"><span data-stu-id="67d9c-131">With an exception-handler block, in contrast, execution continues sequentially from the exception handler rather than from the point of the exception.</span></span>

<span data-ttu-id="67d9c-132">Обработка исключения может быть такой же простой, как сообщение об ошибке и установка флага, который будет рассмотрен позже, выводить предупреждение или сообщение об ошибке или выполнить какое-либо другое ограниченное действие.</span><span class="sxs-lookup"><span data-stu-id="67d9c-132">Handling an exception may be as simple as noting an error and setting a flag that will be examined later, printing a warning or error message, or taking some other limited action.</span></span> <span data-ttu-id="67d9c-133">Если выполнение может быть продолжено, также может потребоваться изменить состояние компьютера, изменив запись контекста.</span><span class="sxs-lookup"><span data-stu-id="67d9c-133">If execution can be continued, it may also be necessary to change the machine state by modifying the context record.</span></span> <span data-ttu-id="67d9c-134">Пример функции фильтра, обрабатывающей исключение ошибки страницы, см. [в разделе Использование функций виртуальной памяти](../memory/using-the-memory-management-functions.md).</span><span class="sxs-lookup"><span data-stu-id="67d9c-134">For an example of a filter function that handles a page fault exception, see [Using the Virtual Memory Functions](../memory/using-the-memory-management-functions.md).</span></span>

<span data-ttu-id="67d9c-135">Функцию [**UnhandledExceptionFilter**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-unhandledexceptionfilter) можно использовать в качестве функции фильтра в критерии фильтра.</span><span class="sxs-lookup"><span data-stu-id="67d9c-135">The [**UnhandledExceptionFilter**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-unhandledexceptionfilter) function can be used as a filter function in a filter expression.</span></span> <span data-ttu-id="67d9c-136">Он возвращает \_ обработчик исключений \_ , если процесс не отлаживается. в этом случае возвращается исключение \_ "продолжить \_ Поиск".</span><span class="sxs-lookup"><span data-stu-id="67d9c-136">It returns EXCEPTION\_EXECUTE\_HANDLER unless the process is being debugged, in which case it returns EXCEPTION\_CONTINUE\_SEARCH.</span></span>

 

 
