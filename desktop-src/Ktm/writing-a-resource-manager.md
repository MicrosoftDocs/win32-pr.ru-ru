---
description: При написании службы или компонента и необходимости использования служб транзакций или при необходимости наблюдения за состоянием транзакций ядра необходимо создать диспетчер ресурсов (RM).
ms.assetid: 9b62ef58-9897-4573-bda4-8c3ec952b6d2
title: Запись диспетчер ресурсов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b2c47f9a0704f6edaea02d752fe39f01fce61c0a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673596"
---
# <a name="writing-a-resource-manager"></a>Запись диспетчер ресурсов

При написании службы или компонента и необходимости использования служб транзакций или при необходимости наблюдения за состоянием транзакций ядра необходимо создать диспетчер ресурсов (RM).

Для создания диспетчера ресурсов необходимо создать несколько объектов ядра. Объекты, используемые диспетчером ресурсов:

-   Объекты диспетчера транзакций (TM)
-   диспетчер ресурсов объекты
-   Объекты зачислений

Сначала создайте объект TM. Существует два типа TMs:

-   Volatile — эти TMs не имеют журнала и не могут восстановить их состояние.
-   Устойчивый — у этих TMs есть журнал

Чтобы создать устойчивый TM-диспетчер, необходимо создать журнал CLFS и вызвать [**креатетрансактионманажер**](/windows/desktop/api/Ktmw32/nf-ktmw32-createtransactionmanager) или создать его для вас с помощью KTM. После создания долговременного TM необходимо сначала восстановить TM, вызвав [**рековертрансактионманажер**](/windows/desktop/api/Ktmw32/nf-ktmw32-recovertransactionmanager). После восстановления TM она становится доступной для использования.

Если вы восстановили существующий TM, все RMs, связанные с этим TM, начнут получать сообщения о восстановлении. Дополнительные сведения см. в разделе [Обработка восстановления](recovery-processing.md).

Затем создайте диспетчер ресурсов, вызвав [**креатересаурцеманажер**](/windows/desktop/api/Ktmw32/nf-ktmw32-createresourcemanager) с помощью обработчика TM. RM может быть энергозависимой или устойчивой. С устойчивым RMs можно использовать только устойчивый TMs.

При работе с транзакционными операциями вы присоединяете транзакцию, вызывая [**креатинлистмент**](/windows/desktop/api/KtmW32/nf-ktmw32-createenlistment)и указывая, какие уведомления следует получать.

**Примечание**  .  Вы можете начать получать уведомления до завершения вызова [**креатинлистмент**](/windows/desktop/api/KtmW32/nf-ktmw32-createenlistment) .

При получении уведомления вызовите соответствующую функцию Complete, \* когда завершится любая работа, связанная с обработкой уведомления. Полные функции:

-   [**коммиткомплете**](/windows/desktop/api/Ktmw32/nf-ktmw32-commitcomplete)
-   [**препарекомплете**](/windows/desktop/api/Ktmw32/nf-ktmw32-preparecomplete)
-   [**препрепарекомплете**](/windows/desktop/api/Ktmw32/nf-ktmw32-prepreparecomplete)

Если в любой момент, когда диспетчер ресурсов не сможет завершить работу транзакции или если продолжить, приложение не сможет отменить работу, выполненную в рамках транзакции, необходимо выполнить откат транзакции, вызвав [**роллбаккенлистмент**](/windows/desktop/api/Ktmw32/nf-ktmw32-rollbackenlistment).

 

 



