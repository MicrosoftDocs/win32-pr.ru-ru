---
description: Диспетчер транзакций (TM) является экземпляром журнала. В KTM объекты TM определяют журнал и некоторые функции TM. Обычно на определенном узле доступно множество объектов TM. Диспетчеры ресурсов (RMs) должны быть связаны с конкретным TM.
ms.assetid: 8d43977a-84cf-4109-b7db-f9c94a226c5d
title: Диспетчеры транзакций
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 313215816642201c75ae5f0facae3bf98799c8d1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673598"
---
# <a name="transaction-managers"></a><span data-ttu-id="8c89e-106">Диспетчеры транзакций</span><span class="sxs-lookup"><span data-stu-id="8c89e-106">Transaction Managers</span></span>

<span data-ttu-id="8c89e-107">Диспетчер транзакций (TM) является экземпляром журнала.</span><span class="sxs-lookup"><span data-stu-id="8c89e-107">A transaction manager (TM) is an instance of a log.</span></span> <span data-ttu-id="8c89e-108">В KTM объекты TM определяют журнал и некоторые функции TM.</span><span class="sxs-lookup"><span data-stu-id="8c89e-108">In KTM, the TM objects specify the log and some of the functionality of the TM.</span></span> <span data-ttu-id="8c89e-109">Обычно на определенном узле доступно множество объектов TM.</span><span class="sxs-lookup"><span data-stu-id="8c89e-109">There are typically many TM objects on a particular node.</span></span> <span data-ttu-id="8c89e-110">Диспетчеры ресурсов (RMs) должны быть связаны с конкретным TM.</span><span class="sxs-lookup"><span data-stu-id="8c89e-110">Resource managers (RMs) must be associated with a specific TM.</span></span> <span data-ttu-id="8c89e-111">Существует три типа TMs:</span><span class="sxs-lookup"><span data-stu-id="8c89e-111">There are three types of TMs:</span></span>

-   <span data-ttu-id="8c89e-112">Временный TM-журнал, в котором нет журнала.</span><span class="sxs-lookup"><span data-stu-id="8c89e-112">A volatile TM, which has no log.</span></span>
-   <span data-ttu-id="8c89e-113">Обычный TM, который имеет журнал и используется для координации транзакций одного или нескольких RMs.</span><span class="sxs-lookup"><span data-stu-id="8c89e-113">A regular TM, which has a log and is used to coordinate the transactions of one or more RMs.</span></span>
-   <span data-ttu-id="8c89e-114">Старший диспетчер транзакций.</span><span class="sxs-lookup"><span data-stu-id="8c89e-114">A superior transaction manager.</span></span>

## <a name="volatile-transaction-managers"></a><span data-ttu-id="8c89e-115">Временные диспетчеры транзакций</span><span class="sxs-lookup"><span data-stu-id="8c89e-115">Volatile Transaction Managers</span></span>

<span data-ttu-id="8c89e-116">Энергонезависимая TM — это диспетчер операций с правами только для чтения или для временного RMs.</span><span class="sxs-lookup"><span data-stu-id="8c89e-116">A volatile TM is a TM for read-only or volatile RMs.</span></span> <span data-ttu-id="8c89e-117">Он не имеет журнала и не сохраняет состояние транзакций при перезапуске системы.</span><span class="sxs-lookup"><span data-stu-id="8c89e-117">It does not have a log and does not persist the state of transactions across system restarts.</span></span>

## <a name="transaction-managers"></a><span data-ttu-id="8c89e-118">Диспетчеры транзакций</span><span class="sxs-lookup"><span data-stu-id="8c89e-118">Transaction Managers</span></span>

<span data-ttu-id="8c89e-119">В TMs имеется журнал, один или более устойчивый или временный RMs или оба.</span><span class="sxs-lookup"><span data-stu-id="8c89e-119">TMs have a log, one or more durable or volatile RMs, or both.</span></span> <span data-ttu-id="8c89e-120">Диспетчер транзакций будет сохранять состояние транзакции по перезапуску системы до завершения транзакций.</span><span class="sxs-lookup"><span data-stu-id="8c89e-120">The TM will persist the state of a transaction across system restarts until the transactions are completed.</span></span> <span data-ttu-id="8c89e-121">Используется Предполагаемая модель прекращения, поэтому выполняется откат транзакций, которые были активны, но не были подготовлены при завершении работы объекта TM.</span><span class="sxs-lookup"><span data-stu-id="8c89e-121">A presumed-abort model is used, so transactions which were active but not prepared when the TM object is shut down are rolled back.</span></span> <span data-ttu-id="8c89e-122">При первом запуске TM необходимо восстановить TM, вызвав функцию [**рековертрансактионманажер**](/windows/desktop/api/Ktmw32/nf-ktmw32-recovertransactionmanager) .</span><span class="sxs-lookup"><span data-stu-id="8c89e-122">When you open a TM for the first time, you must recover the TM by calling the [**RecoverTransactionManager**](/windows/desktop/api/Ktmw32/nf-ktmw32-recovertransactionmanager) function.</span></span>

## <a name="superior-transaction-managers"></a><span data-ttu-id="8c89e-123">Старшие диспетчеры транзакций</span><span class="sxs-lookup"><span data-stu-id="8c89e-123">Superior Transaction Managers</span></span>

<span data-ttu-id="8c89e-124">Старший TM — TM для других TMs.</span><span class="sxs-lookup"><span data-stu-id="8c89e-124">A superior TM is a TM for other TMs.</span></span> <span data-ttu-id="8c89e-125">Он координирует транзакции.</span><span class="sxs-lookup"><span data-stu-id="8c89e-125">It coordinates transactions.</span></span> <span data-ttu-id="8c89e-126">Он также выдает **\_ уведомление о \_ подготовке транзакций** к диспетчеру транзакций ядра (KTM).</span><span class="sxs-lookup"><span data-stu-id="8c89e-126">It also issues **TRANSACTION\_NOTIFY\_PREPARE** notifications to the Kernel Transaction Manager (KTM).</span></span> <span data-ttu-id="8c89e-127">Примером старший TM является Microsoft координатор распределенных транзакций (DTC).</span><span class="sxs-lookup"><span data-stu-id="8c89e-127">An example of a superior TM is the Microsoft Distributed Transaction Coordinator (DTC).</span></span> <span data-ttu-id="8c89e-128">Эта возможность связана с дополнительными обязанностями времени восстановления.</span><span class="sxs-lookup"><span data-stu-id="8c89e-128">This ability comes with an added recovery-time responsibility.</span></span> <span data-ttu-id="8c89e-129">Во время восстановления RM должен сначала вызвать функцию [**опененлистмент**](/windows/desktop/api/Ktmw32/nf-ktmw32-openenlistment) , чтобы повторно открыть зачисление.</span><span class="sxs-lookup"><span data-stu-id="8c89e-129">During recovery, the RM must first call the [**OpenEnlistment**](/windows/desktop/api/Ktmw32/nf-ktmw32-openenlistment) function to re-open the enlistment.</span></span> <span data-ttu-id="8c89e-130">Он также должен доставлять (или повторно доставлять) результат транзакции, если транзакция была зафиксирована. можно допустить результат, вызвав либо функцию [**CommitTransaction**](/windows/desktop/api/Ktmw32/nf-ktmw32-committransaction) , либо функцию [**RollbackTransaction**](/windows/desktop/api/Ktmw32/nf-ktmw32-rollbacktransaction) .</span><span class="sxs-lookup"><span data-stu-id="8c89e-130">It must also deliver (or re-deliver) the transaction's outcome if the transaction was committed; it is free to deliver an outcome by calling either the [**CommitTransaction**](/windows/desktop/api/Ktmw32/nf-ktmw32-committransaction) function or the [**RollbackTransaction**](/windows/desktop/api/Ktmw32/nf-ktmw32-rollbacktransaction) function.</span></span> <span data-ttu-id="8c89e-131">Это обязательство не заканчивается до тех пор, пока не будет получено событие уведомления о завершении **\_ \_ фиксации \_** или **\_ \_ отката \_ транзакции** уведомление о завершении транзакции. Если диспетчеру TM не удается выполнить эти операции во время восстановления, то KTM очистит все транзакции, которые не получали результаты в конце фазы восстановления.</span><span class="sxs-lookup"><span data-stu-id="8c89e-131">This obligation does not end until it has received an associated **TRANSACTION\_NOTIFY\_COMMIT\_COMPLETE** or **TRANSACTION\_NOTIFY\_ROLLBACK\_COMPLETE** notification event.If a superior TM fails to perform these operations at recovery time, the KTM will clean up any transactions that have not received outcomes by the end of the recovery phase.</span></span> <span data-ttu-id="8c89e-132">Однако это может привести к несовместимости результатов транзакций.</span><span class="sxs-lookup"><span data-stu-id="8c89e-132">However, this can result in inconsistent transaction outcomes.</span></span>

## <a name="transaction-manager-functions"></a><span data-ttu-id="8c89e-133">Функции диспетчера транзакций</span><span class="sxs-lookup"><span data-stu-id="8c89e-133">Transaction Manager Functions</span></span>

<span data-ttu-id="8c89e-134">С диспетчерами транзакций используются следующие функции.</span><span class="sxs-lookup"><span data-stu-id="8c89e-134">The following functions are used with transaction managers.</span></span>



| <span data-ttu-id="8c89e-135">Функция</span><span class="sxs-lookup"><span data-stu-id="8c89e-135">Function</span></span>                                                                            | <span data-ttu-id="8c89e-136">Описание</span><span class="sxs-lookup"><span data-stu-id="8c89e-136">Description</span></span>                                                                                    |
|-------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="8c89e-137">**креатетрансактионманажер**</span><span class="sxs-lookup"><span data-stu-id="8c89e-137">**CreateTransactionManager**</span></span>](/windows/desktop/api/Ktmw32/nf-ktmw32-createtransactionmanager)                        | <span data-ttu-id="8c89e-138">Создает новый объект диспетчера транзакций (TM) и возвращает маркер с указанным доступом.</span><span class="sxs-lookup"><span data-stu-id="8c89e-138">Creates a new transaction manager (TM) object and returns a handle with the specified access.</span></span>  |
| [<span data-ttu-id="8c89e-139">**жеткуррентклокктрансактионманажер**</span><span class="sxs-lookup"><span data-stu-id="8c89e-139">**GetCurrentClockTransactionManager**</span></span>](/windows/desktop/api/Ktmw32/nf-ktmw32-getcurrentclocktransactionmanager) | <span data-ttu-id="8c89e-140">Получает значение виртуального часов из диспетчера транзакций.</span><span class="sxs-lookup"><span data-stu-id="8c89e-140">Obtains a virtual clock value from a transaction manager.</span></span>                                      |
| [<span data-ttu-id="8c89e-141">**жеттрансактионманажерид**</span><span class="sxs-lookup"><span data-stu-id="8c89e-141">**GetTransactionManagerId**</span></span>](/windows/desktop/api/Ktmw32/nf-ktmw32-gettransactionmanagerid)                          | <span data-ttu-id="8c89e-142">Получает идентификатор для указанного диспетчера транзакций.</span><span class="sxs-lookup"><span data-stu-id="8c89e-142">Obtains an identifier for the specified transaction manager.</span></span>                                   |
| [<span data-ttu-id="8c89e-143">**опентрансактионманажер**</span><span class="sxs-lookup"><span data-stu-id="8c89e-143">**OpenTransactionManager**</span></span>](/windows/desktop/api/Ktmw32/nf-ktmw32-opentransactionmanager)                            | <span data-ttu-id="8c89e-144">Открывает существующий диспетчер транзакций.</span><span class="sxs-lookup"><span data-stu-id="8c89e-144">Opens an existing transaction manager.</span></span>                                                         |
| [<span data-ttu-id="8c89e-145">**рековертрансактионманажер**</span><span class="sxs-lookup"><span data-stu-id="8c89e-145">**RecoverTransactionManager**</span></span>](/windows/desktop/api/Ktmw32/nf-ktmw32-recovertransactionmanager)                      | <span data-ttu-id="8c89e-146">Восстанавливает состояние диспетчера транзакций из файла журнала.</span><span class="sxs-lookup"><span data-stu-id="8c89e-146">Recovers a transaction manager's state from its log file.</span></span>                                      |
| [<span data-ttu-id="8c89e-147">**роллфорвардтрансактионманажер**</span><span class="sxs-lookup"><span data-stu-id="8c89e-147">**RollforwardTransactionManager**</span></span>](/windows/desktop/api/KtmW32/nf-ktmw32-rollforwardtransactionmanager)              | <span data-ttu-id="8c89e-148">Восстанавливает состояние диспетчера транзакций из файла журнала до указанного значения виртуального часов.</span><span class="sxs-lookup"><span data-stu-id="8c89e-148">Recovers a transaction manager's state from its log file to the specified virtual clock value.</span></span> |



 

 

 



