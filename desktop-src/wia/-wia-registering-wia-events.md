---
description: 'Приложения могут регистрироваться для получения уведомлений о событиях аппаратного устройства получения образа Windows (WIA) путем вызова одного из следующих методов интерфейса Ивиадевмгр или IWiaDevMgr2: Ивиадевмгр:: Регистеревенткаллбаккклсид или IWiaDevMgr2:: Регистеревенткаллбаккклсидивиадевмгр:: RegisterEventCallbackInterface или IWiaDevMgr2:: RegisterEventCallbackInterfaceIWiaDevMgr:: RegisterEventCallbackProgram или IWiaDevMgr2:: RegisterEventCallbackProgram'
ms.assetid: 0c142083-835f-4bbd-ab32-eb6130f99c59
title: Регистрация событий WIA
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: aa9fc36540a64211428579bc13b84902490ea103
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103991151"
---
# <a name="registering-wia-events"></a><span data-ttu-id="dc4f5-103">Регистрация событий WIA</span><span class="sxs-lookup"><span data-stu-id="dc4f5-103">Registering WIA Events</span></span>

<span data-ttu-id="dc4f5-104">Приложения могут регистрироваться для получения уведомлений о событиях аппаратного устройства получения образа Windows (WIA) путем вызова одного из следующих методов интерфейса [**ивиадевмгр**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiadevmgr) или [**IWiaDevMgr2**](-wia-iwiadevmgr2.md) :</span><span class="sxs-lookup"><span data-stu-id="dc4f5-104">Applications can register to be notified of Windows Image Acquisition (WIA) hardware device events by calling one of the following [**IWiaDevMgr**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiadevmgr) or [**IWiaDevMgr2**](-wia-iwiadevmgr2.md) interface methods:</span></span>

-   <span data-ttu-id="dc4f5-105">[**Ивиадевмгр:: регистеревенткаллбаккклсид**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiadevmgr-registereventcallbackclsid) или [ **IWiaDevMgr2:: регистеревенткаллбаккклсид**](-wia-iwiadevmgr2-registereventcallbackclsid.md)</span><span class="sxs-lookup"><span data-stu-id="dc4f5-105">[**IWiaDevMgr::RegisterEventCallbackCLSID**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiadevmgr-registereventcallbackclsid) or [**IWiaDevMgr2::RegisterEventCallbackCLSID**](-wia-iwiadevmgr2-registereventcallbackclsid.md)</span></span>
-   <span data-ttu-id="dc4f5-106">[**Ивиадевмгр:: регистеревенткаллбаккинтерфаце**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiadevmgr-registereventcallbackinterface) или [ **IWiaDevMgr2:: регистеревенткаллбаккинтерфаце**](-wia-iwiadevmgr2-registereventcallbackinterface.md)</span><span class="sxs-lookup"><span data-stu-id="dc4f5-106">[**IWiaDevMgr::RegisterEventCallbackInterface**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiadevmgr-registereventcallbackinterface) or [**IWiaDevMgr2::RegisterEventCallbackInterface**](-wia-iwiadevmgr2-registereventcallbackinterface.md)</span></span>
-   <span data-ttu-id="dc4f5-107">[**Ивиадевмгр:: регистеревенткаллбаккпрограм**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiadevmgr-registereventcallbackprogram) или [ **IWiaDevMgr2:: регистеревенткаллбаккпрограм**](-wia-iwiadevmgr2-registereventcallbackprogram.md)</span><span class="sxs-lookup"><span data-stu-id="dc4f5-107">[**IWiaDevMgr::RegisterEventCallbackProgram**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiadevmgr-registereventcallbackprogram) or [**IWiaDevMgr2::RegisterEventCallbackProgram**](-wia-iwiadevmgr2-registereventcallbackprogram.md)</span></span>

<span data-ttu-id="dc4f5-108">Все эти методы принимают параметры, указывающие событие и устройство, для которого приложение должно получать уведомления.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-108">All of these methods take parameters that specify the event and the hardware device for which the application is to be notified.</span></span> <span data-ttu-id="dc4f5-109">Приложения регистрируются для получения события для всех устройств WIA путем передачи значения **null** для параметра, указывающего устройство.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-109">Applications register to receive an event for all WIA devices by passing a **NULL** value for the parameter that specifies the hardware device.</span></span>

<span data-ttu-id="dc4f5-110">Метод **регистеревенткаллбаккинтерфаце** регистрирует приложение для получения события аппаратного устройства WIA, если приложение выполняется в момент возникновения события.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-110">The **RegisterEventCallbackInterface** method registers an application to receive a WIA hardware device event if the application is running at the time the event occurs.</span></span> <span data-ttu-id="dc4f5-111">При возникновении события, для которого регистрируется приложение, WIA вызывает метод [**ивиаевенткаллбакк:: имажеевенткаллбакк**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiaeventcallback-imageeventcallback) предоставленного приложением объекта для передачи сведений о событии.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-111">When the event for which the application is registered occurs, WIA calls the [**IWiaEventCallback::ImageEventCallback**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiaeventcallback-imageeventcallback) method of the application-provided object to transmit the event information.</span></span>

<span data-ttu-id="dc4f5-112">Метод **регистеревенткаллбаккклсид** регистрирует приложение, которое является зарегистрированным компонентом модели компонентов компонента (com) для получения события аппаратного устройства WIA, даже если приложение не работает.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-112">The **RegisterEventCallbackCLSID** method registers an application that is a registered Component Object Model (COM) component to receive a WIA hardware device event even if the application is not running.</span></span> <span data-ttu-id="dc4f5-113">В дополнение к параметрам, упомянутым выше, этот метод принимает параметр *пклсид*, указывающий идентификатор класса приложения.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-113">In addition to the parameters mentioned previously, this method takes a parameter, *pClsID*, that specifies the class ID of the application.</span></span> <span data-ttu-id="dc4f5-114">Когда происходит указанное событие, система WIA использует функцию [CoCreateInstance](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) и идентификатор класса, указанный параметром *пклсид* , для создания нового экземпляра приложения и вызывает метод [**ивиаевенткаллбакк:: имажеевенткаллбакк**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiaeventcallback-imageeventcallback) этого приложения для передачи сведений о событии.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-114">When the specified event occurs, the WIA system uses the [CoCreateInstance](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) function and the class ID specified by *pClsID* to create a new instance of the application, and calls the [**IWiaEventCallback::ImageEventCallback**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiaeventcallback-imageeventcallback) method of that application to transmit the event information.</span></span>

<span data-ttu-id="dc4f5-115">Метод **регистеревенткаллбаккпрограм** регистрирует приложение для получения события аппаратного устройства WIA, даже если приложение не выполняется при возникновении этого события.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-115">The **RegisterEventCallbackProgram** method registers an application to receive a WIA hardware device event even if the application is not running when the event occurs.</span></span> <span data-ttu-id="dc4f5-116">Приложение не обязательно должно быть зарегистрированным COM-компонентом.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-116">The application need not be a registered COM component.</span></span> <span data-ttu-id="dc4f5-117">WIA запускает приложение с помощью инструкции командной строки.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-117">WIA launches the application with a command line statement.</span></span> <span data-ttu-id="dc4f5-118">**Регистеревенткаллбаккпрограм** принимает параметр *бстркоммандлине*, который указывает полный путь и имя файла исполняемого приложения.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-118">**RegisterEventCallbackProgram** takes a parameter, *bstrCommandline*, that specifies the full path and filename of the executable application.</span></span> <span data-ttu-id="dc4f5-119">**Регистеревенткаллбаккпрограм** существует для обеспечения обратной совместимости с приложениями, которые не были написаны для WIA, и следует избегать.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-119">**RegisterEventCallbackProgram** exists for backward compatibility with applications that were not written for WIA, and should be avoided.</span></span> <span data-ttu-id="dc4f5-120">Вместо этого используйте **регистеревенткаллбаккинтерфаце** или **регистеревенткаллбаккклсид** .</span><span class="sxs-lookup"><span data-stu-id="dc4f5-120">Use **RegisterEventCallbackInterface** or **RegisterEventCallbackCLSID** instead.</span></span>

<span data-ttu-id="dc4f5-121">Чтобы определить, какие обработчики зарегистрированы для событий на конкретном устройстве WIA, приложение вызывает метод [**ивиаитем:: енумрегистеревентинфо**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiaitem-enumregistereventinfo) или [**IWiaItem2:: енумрегистеревентинфо**](-wia-iwiaitem2-enumregistereventinfo.md) корневого элемента.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-121">To determine which handlers are registered for events on a specific WIA device, an application calls a [**IWiaItem::EnumRegisterEventInfo**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiaitem-enumregistereventinfo) or [**IWiaItem2::EnumRegisterEventInfo**](-wia-iwiaitem2-enumregistereventinfo.md) method of a root item.</span></span> <span data-ttu-id="dc4f5-122">Этот метод создает объект перечисления для сведений о регистрации.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-122">This method creates an enumeration object for the registration information.</span></span> <span data-ttu-id="dc4f5-123">Затем приложение может использовать интерфейс [**Caps иенумвиа \_ dev \_**](/windows/desktop/api/wia_xp/nn-wia_xp-ienumwia_dev_caps) этого объекта для перечисления сведений о обработчиках, зарегистрированных для получения событий для этого устройства.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-123">The application can then use the [**IEnumWIA\_DEV\_CAPS**](/windows/desktop/api/wia_xp/nn-wia_xp-ienumwia_dev_caps) interface of that object to enumerate information about the handlers registered to receive events for that device.</span></span>

<span data-ttu-id="dc4f5-124">Если происходит событие, для которого запущенное приложение регистрируется через **регистеревенткаллбаккинтерфаце** и либо **Регистеревенткаллбаккклсид** , либо **регистеревенткаллбаккпрограм**, WIA уведомляет запущенное приложение и не пытается запустить новый экземпляр приложения, так как регистрация событий через **RegisterEventCallbackInterface** имеет приоритет над **RegisterEventCallbackCLSID** и **RegisterEventCallbackProgram**.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-124">If an event occurs for which a running application is registered through **RegisterEventCallbackInterface** and either **RegisterEventCallbackCLSID** or **RegisterEventCallbackProgram**, WIA notifies the running application and does not attempt to launch a new instance of the application because event registration through **RegisterEventCallbackInterface** takes precedence over both **RegisterEventCallbackCLSID** and **RegisterEventCallbackProgram**.</span></span>

> [!Note]  
> <span data-ttu-id="dc4f5-125">В многопоточном приложении нет никакой гарантии, что поток, возвращаемый обратным вызовом уведомлений о событиях, будет в том же потоке, который зарегистрировал обратный вызов.</span><span class="sxs-lookup"><span data-stu-id="dc4f5-125">In a multi-threaded application, there is no guarantee that the thread that the event notification callback will return on is the same thread that registered the callback.</span></span>

 

 

 
