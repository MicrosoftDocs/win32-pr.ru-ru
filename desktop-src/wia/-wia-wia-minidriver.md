---
description: Приложения видят устройства для получения изображений Windows (WIA) в виде иерархического дерева объектов Ивиаитем или IWiaItem2 с корневым элементом, представляющим само устройство.
ms.assetid: ae4ded93-09be-4caa-ad6e-1a9071fdb4b6
title: WIA Минидривер
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f5aadaf55cfe2e8102d4e0e02cf9787b9696e327
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104541906"
---
# <a name="wia-minidriver"></a><span data-ttu-id="89565-103">WIA Минидривер</span><span class="sxs-lookup"><span data-stu-id="89565-103">WIA Minidriver</span></span>

<span data-ttu-id="89565-104">Приложения видят устройства для получения изображений Windows (WIA) в виде иерархического дерева объектов [**ивиаитем**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) или [**IWiaItem2**](-wia-iwiaitem2.md) с корневым элементом, представляющим само устройство.</span><span class="sxs-lookup"><span data-stu-id="89565-104">Applications see Windows Image Acquisition (WIA) devices as a hierarchical tree of [**IWiaItem**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) or [**IWiaItem2**](-wia-iwiaitem2.md) objects with the root item representing the device itself.</span></span> <span data-ttu-id="89565-105">Устройства WIA могут использоваться одновременно несколькими приложениями.</span><span class="sxs-lookup"><span data-stu-id="89565-105">WIA devices may be used concurrently by more than one application.</span></span> <span data-ttu-id="89565-106">Поэтому необходимо, чтобы представление каждого приложения объекта **ивиаитем** или **IWiaItem2** было независимым от представлений другого приложения.</span><span class="sxs-lookup"><span data-stu-id="89565-106">It is therefore necessary that each application's view of an **IWiaItem** or **IWiaItem2** object be independent of another application's views.</span></span> <span data-ttu-id="89565-107">Это достигается за счет наличия двух различных объектов Item.</span><span class="sxs-lookup"><span data-stu-id="89565-107">This is accomplished by having two different item objects.</span></span> <span data-ttu-id="89565-108">Драйвер создает дерево элементов драйвера для объектов [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) , также называемых элементами драйвера, с помощью методов служб драйвера WIA.</span><span class="sxs-lookup"><span data-stu-id="89565-108">The driver creates the driver item tree of [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) objects, also called driver items, using the WIA driver services methods.</span></span> <span data-ttu-id="89565-109">Это глобальные объекты, используемые драйвером для представления внутренних элементов каждого драйвера.</span><span class="sxs-lookup"><span data-stu-id="89565-109">These are global objects that the driver uses to represent each driver's internal items.</span></span> <span data-ttu-id="89565-110">Когда приложение создает объект **ивиаитем** или **IWiaItem2** (также называемый элементом приложения), этот объект связывается с соответствующим [интерфейсом ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) драйвера в дереве элементов драйвера.</span><span class="sxs-lookup"><span data-stu-id="89565-110">When an application creates an **IWiaItem** or **IWiaItem2** object (also called an application item), this object is linked to the driver's corresponding [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) in the driver item tree.</span></span> <span data-ttu-id="89565-111">Счетчик ссылок сохраняется в объекте [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) в соответствии со следующими правилами:</span><span class="sxs-lookup"><span data-stu-id="89565-111">A reference count is maintained on the [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object subject to the following rules:</span></span>

-   <span data-ttu-id="89565-112">Когда драйвер добавляет объект [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) в дерево элементов драйвера, счетчик ссылок объекта [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) увеличивается.</span><span class="sxs-lookup"><span data-stu-id="89565-112">When a driver adds an [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object to the driver item tree, the [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object's reference count is incremented.</span></span> <span data-ttu-id="89565-113">Обычно это происходит во время [ивиаминидрв::D рвинитиализевиа](https://msdn.microsoft.com/library/ms794097.aspx) или при \_ \_ обработке команды WIA cmd SYNCHRONIZE.</span><span class="sxs-lookup"><span data-stu-id="89565-113">This typically takes place during [IWiaMiniDrv::drvInitializeWia](https://msdn.microsoft.com/library/ms794097.aspx) or when a WIA\_CMD\_SYNCHRONIZE command is processed.</span></span>
-   <span data-ttu-id="89565-114">Когда драйвер удаляет объект [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) из дерева элементов драйвера, счетчик ссылок объекта [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) уменьшается, а объект [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) помечается таким образом, что он не может снова получить доступ к устройству.</span><span class="sxs-lookup"><span data-stu-id="89565-114">When a driver removes an [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object from the driver item tree, the [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object's reference count is decremented and the [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object is marked so that it can't access the device again.</span></span> <span data-ttu-id="89565-115">Обычно это происходит при отключении устройства или удалении элемента.</span><span class="sxs-lookup"><span data-stu-id="89565-115">This typically takes place when a device is disconnected or an item is deleted.</span></span> <span data-ttu-id="89565-116">Приложения по-прежнему могут считывать свойства из объекта [**ивиаитем**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) или [**IWiaItem2**](-wia-iwiaitem2.md) , даже если соответствующий объект [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) был удален из дерева элементов драйвера.</span><span class="sxs-lookup"><span data-stu-id="89565-116">Applications are still able to read properties from an [**IWiaItem**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) or [**IWiaItem2**](-wia-iwiaitem2.md) object even when the corresponding [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object has been removed from the driver item tree.</span></span>
-   <span data-ttu-id="89565-117">При создании объекта [**ивиаитем**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) или [**IWiaItem2**](-wia-iwiaitem2.md) он связывается с соответствующим объектом [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) .</span><span class="sxs-lookup"><span data-stu-id="89565-117">When an [**IWiaItem**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) or [**IWiaItem2**](-wia-iwiaitem2.md) object is created it is linked to a corresponding [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object.</span></span> <span data-ttu-id="89565-118">Счетчик ссылок объекта [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) увеличивается.</span><span class="sxs-lookup"><span data-stu-id="89565-118">The reference count of the [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object is incremented.</span></span>
-   <span data-ttu-id="89565-119">При освобождении объекта [**ивиаитем**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) или [**IWiaItem2**](-wia-iwiaitem2.md) ссылка на соответствующий ему объект [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) является серьезной, а счетчик ссылок объекта [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) уменьшается.</span><span class="sxs-lookup"><span data-stu-id="89565-119">When an [**IWiaItem**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) or [**IWiaItem2**](-wia-iwiaitem2.md) object is released, the link to its corresponding [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object is severed and the [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object's reference count is decremented.</span></span>
-   <span data-ttu-id="89565-120">Если счетчик ссылок объекта [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) становится равным нулю, объект [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) удаляется.</span><span class="sxs-lookup"><span data-stu-id="89565-120">If an [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object's reference count goes to zero, the [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object is deleted.</span></span> <span data-ttu-id="89565-121">Это относится ко всем объектам [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) , включая корневой элемент.</span><span class="sxs-lookup"><span data-stu-id="89565-121">This applies to all [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) objects including the root item.</span></span> <span data-ttu-id="89565-122">Счетчик ссылок объекта [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) становится равным нулю, только если элементы приложения ссылаются на него и больше не связаны с деревом элементов драйвера.</span><span class="sxs-lookup"><span data-stu-id="89565-122">An [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) object's reference count only goes to zero when no application items reference it and it is no longer linked to the driver item tree.</span></span>

<span data-ttu-id="89565-123">Используя эту схему подсчета ссылок, многие объекты [**ивиаитем**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) или [**IWiaItem2**](-wia-iwiaitem2.md) могут ссылаться на один [интерфейс ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) без помех.</span><span class="sxs-lookup"><span data-stu-id="89565-123">Using this reference counting scheme, many [**IWiaItem**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) or [**IWiaItem2**](-wia-iwiaitem2.md) objects may link to one [IWiaDrvItem Interface](https://msdn.microsoft.com/library/ms793976.aspx) without interference.</span></span> <span data-ttu-id="89565-124">Так как каждый **ивиаитем** или **IWiaItem2** содержит собственное хранилище свойств, приложение может продолжить чтение свойств элемента даже после удаления элемента, но никаких операций, требующих доступа к устройству, будет успешно.</span><span class="sxs-lookup"><span data-stu-id="89565-124">Because each **IWiaItem** or **IWiaItem2** contains its own property storage, an application can continue to read item properties even after an item has been deleted, but no operation that requires access to the device will succeed.</span></span> <span data-ttu-id="89565-125">Так как свойства элемента хранятся в объекте **ивиаитем** или **IWiaItem2** , драйвер должен задать свойства объекта **ивиаитем** или **IWiaItem2** для устройства перед передачей данных.</span><span class="sxs-lookup"><span data-stu-id="89565-125">Because item properties are stored in the **IWiaItem** or **IWiaItem2** object, the driver must set the **IWiaItem** or **IWiaItem2** object's properties to the device before a data transfer.</span></span>

 

 



