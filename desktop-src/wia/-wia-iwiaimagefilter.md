---
description: Интерфейс Ивиаимажефилтер — это интерфейс расширения, реализованный разработчиками фильтра обработки изображений и вызываемый службой получения изображений Windows (WIA) 2,0.
ms.assetid: 2abe913b-bb2b-486d-a3f4-d5932433fc82
title: Интерфейс Ивиаимажефилтер (WIA. h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- IWiaImageFilter
api_type:
- COM
api_location:
- Wia.h
ms.openlocfilehash: 8d859b79d15db627bb09cb60f758791a8b5860f7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103909859"
---
# <a name="iwiaimagefilter-interface"></a><span data-ttu-id="20540-103">Интерфейс Ивиаимажефилтер</span><span class="sxs-lookup"><span data-stu-id="20540-103">IWiaImageFilter interface</span></span>

<span data-ttu-id="20540-104">Интерфейс **ивиаимажефилтер** — это интерфейс расширения, реализованный разработчиками фильтра обработки изображений и вызываемый службой получения изображений Windows (WIA) 2,0.</span><span class="sxs-lookup"><span data-stu-id="20540-104">The **IWiaImageFilter** interface is an extension interface implemented by image processing filter developers and called by Windows Image Acquisition (WIA) 2.0.</span></span>

## <a name="members"></a><span data-ttu-id="20540-105">Элементы</span><span class="sxs-lookup"><span data-stu-id="20540-105">Members</span></span>

<span data-ttu-id="20540-106">Интерфейс **ивиаимажефилтер** наследует от интерфейса [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) .</span><span class="sxs-lookup"><span data-stu-id="20540-106">The **IWiaImageFilter** interface inherits from the [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) interface.</span></span> <span data-ttu-id="20540-107">**Ивиаимажефилтер** также имеет следующие типы членов:</span><span class="sxs-lookup"><span data-stu-id="20540-107">**IWiaImageFilter** also has these types of members:</span></span>

-   [<span data-ttu-id="20540-108">Методы</span><span class="sxs-lookup"><span data-stu-id="20540-108">Methods</span></span>](#methods)

### <a name="methods"></a><span data-ttu-id="20540-109">Методы</span><span class="sxs-lookup"><span data-stu-id="20540-109">Methods</span></span>

<span data-ttu-id="20540-110">Интерфейс **ивиаимажефилтер** содержит следующие методы.</span><span class="sxs-lookup"><span data-stu-id="20540-110">The **IWiaImageFilter** interface has these methods.</span></span>



| <span data-ttu-id="20540-111">Метод</span><span class="sxs-lookup"><span data-stu-id="20540-111">Method</span></span>                                                                | <span data-ttu-id="20540-112">Описание</span><span class="sxs-lookup"><span data-stu-id="20540-112">Description</span></span>                                                                                             |
|:----------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="20540-113">**апплипропертиес**</span><span class="sxs-lookup"><span data-stu-id="20540-113">**ApplyProperties**</span></span>](-wia-iwiaimagefilter-applyproperties.md)       | <span data-ttu-id="20540-114">Включает фильтр обработки изображений для записи свойств обратно в драйвер (и на устройство).</span><span class="sxs-lookup"><span data-stu-id="20540-114">Enables the image processing filter to write properties back to the driver (and device).</span></span><br/>     |
| [<span data-ttu-id="20540-115">**филтерпревиевимаже**</span><span class="sxs-lookup"><span data-stu-id="20540-115">**FilterPreviewImage**</span></span>](-wia-iwiaimagefilter-filterpreviewimage.md) | <span data-ttu-id="20540-116">Фильтрует изображение предварительного просмотра.</span><span class="sxs-lookup"><span data-stu-id="20540-116">Filters the preview image.</span></span><br/>                                                                   |
| [<span data-ttu-id="20540-117">**инитиализефилтер**</span><span class="sxs-lookup"><span data-stu-id="20540-117">**InitializeFilter**</span></span>](-wia-iwiaimagefilter-initializefilter.md)     | <span data-ttu-id="20540-118">Инициализирует фильтр.</span><span class="sxs-lookup"><span data-stu-id="20540-118">Initializes the filter.</span></span> <span data-ttu-id="20540-119">Вызывается WIA 2,0 до загрузки каждого изображения.</span><span class="sxs-lookup"><span data-stu-id="20540-119">Called by WIA 2.0 before each image download.</span></span> <br/>                       |
| [<span data-ttu-id="20540-120">**сетневкаллбакк**</span><span class="sxs-lookup"><span data-stu-id="20540-120">**SetNewCallback**</span></span>](-wia-iwiaimagefilter-setnewcallback.md)         | <span data-ttu-id="20540-121">Задает новый обратный вызов приложения для фильтра обработки изображений, используемого для переадресации вызовов.</span><span class="sxs-lookup"><span data-stu-id="20540-121">Sets a new application callback for the image processing filter to use for forwarding calls.</span></span><br/> |



 

## <a name="remarks"></a><span data-ttu-id="20540-122">Комментарии</span><span class="sxs-lookup"><span data-stu-id="20540-122">Remarks</span></span>

<span data-ttu-id="20540-123">Разработчики фильтра обработки изображений должны реализовать этот интерфейс и интерфейс [**ивиатрансферкаллбакк**](-wia-iwiatransfercallback.md) .</span><span class="sxs-lookup"><span data-stu-id="20540-123">Image processing filter developers should implement this interface and the [**IWiaTransferCallback**](-wia-iwiatransfercallback.md) interface.</span></span>

<span data-ttu-id="20540-124">WIA 2,0 вызывает методы фильтрации.</span><span class="sxs-lookup"><span data-stu-id="20540-124">WIA 2.0 calls filter methods.</span></span> <span data-ttu-id="20540-125">Они никогда не вызываются напрямую из приложения.</span><span class="sxs-lookup"><span data-stu-id="20540-125">They are never called directly from an application.</span></span>

<span data-ttu-id="20540-126">Корпорация Майкрософт предоставляет компонент WIA 2,0 Preview, который кэширует исходный, нефильтрованный образ предварительного просмотра, полученный от сканера.</span><span class="sxs-lookup"><span data-stu-id="20540-126">Microsoft supplies the WIA 2.0 Preview Component, which caches the original, unfiltered preview image that is acquired from the scanner.</span></span> <span data-ttu-id="20540-127">Приложение использует [CoCreateInstance](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) для совместного создания экземпляра компонента WIA 2,0 Preview (CLSID \_ виапревиев), который загружает фильтр с помощью [**IWiaItem2:: Extension**](-wia-iwiaitem2-getextension.md).</span><span class="sxs-lookup"><span data-stu-id="20540-127">An application uses [CoCreateInstance](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to co-create an instance of the WIA 2.0 Preview Component (CLSID\_WiaPreview), which loads the filter using [**IWiaItem2::GetExtension**](-wia-iwiaitem2-getextension.md).</span></span> <span data-ttu-id="20540-128">Фильтр вызывается автоматически при вызове приложением [**ивиатрансфер::D гружать**](-wia-iwiatransfer-download.md).</span><span class="sxs-lookup"><span data-stu-id="20540-128">The filter is called automatically when the application calls [**IWiaTransfer::Download**](-wia-iwiatransfer-download.md).</span></span>

<span data-ttu-id="20540-129">Фильтр обработки изображений всегда выполняется при сканировании изображения.</span><span class="sxs-lookup"><span data-stu-id="20540-129">The image processing filter is always executed when an image is scanned.</span></span> <span data-ttu-id="20540-130">Приложение не может получить изображение от сканера, не применяя сначала фильтр по образам.</span><span class="sxs-lookup"><span data-stu-id="20540-130">An application cannot acquire an image from the scanner without having the imaging filter applied first.</span></span>

<span data-ttu-id="20540-131">Фильтр должен реализовывать как минимум яркость и контрастность.</span><span class="sxs-lookup"><span data-stu-id="20540-131">A filter must implement brightness and contrast at a minimum.</span></span> <span data-ttu-id="20540-132">Обычный пользовательский интерфейс, предоставляющий пользователю элементы управления яркостью и контрастностью, может отображать точные предварительные версии для пользователя.</span><span class="sxs-lookup"><span data-stu-id="20540-132">The common UI, which provides brightness and contrast controls to the user, can display accurate previews to the user.</span></span>

<span data-ttu-id="20540-133">Фильтр обработки изображений никогда не должен изменять элемент *лмессаже* структуры [**виатрансферпарамс**](-wia-wiatransferparams.md) .</span><span class="sxs-lookup"><span data-stu-id="20540-133">An image processing filter should never modify the *lMessage* member of the [**WiaTransferParams**](-wia-wiatransferparams.md) structure.</span></span>

<span data-ttu-id="20540-134">Для чтения обязательных свойств фильтр обработки изображений должен вызвать [**ивиапропертистораже:: жетпропертистреам**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiapropertystorage-getpropertystream) в интерфейсе [**ивиапропертистораже**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiapropertystorage) , который он получает из элемента, вызвав [ивиаимажефилтер:: QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)).</span><span class="sxs-lookup"><span data-stu-id="20540-134">To read the required properties the image processing filter should call [**IWiaPropertyStorage::GetPropertyStream**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiapropertystorage-getpropertystream) on the [**IWiaPropertyStorage**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiapropertystorage) interface that it gets from the item by calling [IWiaImageFilter::QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)).</span></span> <span data-ttu-id="20540-135">Затем фильтр может создать экземпляр экземпляра [ипропертистораже](/windows/win32/api/propidlbase/nn-propidlbase-ipropertystorage) в этом потоке для чтения свойств элементов.</span><span class="sxs-lookup"><span data-stu-id="20540-135">The filter can then instantiate an [IPropertyStorage](/windows/win32/api/propidlbase/nn-propidlbase-ipropertystorage) instance on this stream to read the items properties.</span></span> <span data-ttu-id="20540-136">Фильтр обработки изображений не должен вызывать [ивиапропертистораже:: реадмултипле](/windows/win32/api/propidlbase/nf-propidlbase-ipropertystorage-readmultiple) напрямую, так как этот метод вызывает драйвер `drvReadItemProperties` , но служба WIA 2,0 уже заблокировала драйвер в `drvAcquireItemData` вызове, поэтому этот вызов истечет и завершится сбоем.</span><span class="sxs-lookup"><span data-stu-id="20540-136">The image processing filter should not call [IWiaPropertyStorage::ReadMultiple](/windows/win32/api/propidlbase/nf-propidlbase-ipropertystorage-readmultiple) directly because this method calls into the driver's `drvReadItemProperties`, but the WIA 2.0 service has already locked the driver in the `drvAcquireItemData` call so this call will timeout and fail.</span></span>

<span data-ttu-id="20540-137">Свойства, которые заинтересованы в фильтре, могут быть, например, параметрами яркости и контрастности.</span><span class="sxs-lookup"><span data-stu-id="20540-137">The properties that the filter is interested in could for example be the brightness and contrast settings.</span></span> <span data-ttu-id="20540-138">Фильтр, как правило, также должен считывать формат изображения, а также свойство Preview, [**\_ \_ предварительную версию WIA DPS**](-wia-wiaitempropscannerdevice.md), из *pWiaItem2*.</span><span class="sxs-lookup"><span data-stu-id="20540-138">The filter typically also needs to read the image format as well as the preview property, [**WIA\_DPS\_PREVIEW**](-wia-wiaitempropscannerdevice.md), from *pWiaItem2*.</span></span> <span data-ttu-id="20540-139">Все эти свойства используются в процессе фильтрации.</span><span class="sxs-lookup"><span data-stu-id="20540-139">These properties are all used in the filtering process.</span></span>

<span data-ttu-id="20540-140">Компоненты WIA 2,0 всегда записывают нефильтрованные данные в фильтр обработки изображений.</span><span class="sxs-lookup"><span data-stu-id="20540-140">The WIA 2.0 components always writes unfiltered data into the image processing filter.</span></span> <span data-ttu-id="20540-141">Алгоритм обработки изображений, реализованный потоком фильтра, может фильтровать данные более одного раза и не должен беспокоиться о том, чтобы получить те же результаты, что и при фильтрации данных.</span><span class="sxs-lookup"><span data-stu-id="20540-141">The image processing algorithm implemented by the filter's stream can filter the data more than once and does not have to be concerned with producing the same results as filtering the data once.</span></span>

<span data-ttu-id="20540-142">Фильтр должен обратить внимание на свойство [**\_ \_ предварительной версии WIA DP**](-wia-wiaitempropscannerdevice.md) , особенно если некоторые задачи, связанные с фильтрами, обрабатываются оборудованием.</span><span class="sxs-lookup"><span data-stu-id="20540-142">The filter must pay attention to the [**WIA\_DPS\_PREVIEW**](-wia-wiaitempropscannerdevice.md) property, especially if some filter related tasks are handled in hardware.</span></span> <span data-ttu-id="20540-143">Например, определенный драйвер может изменить яркость лампы в оборудовании сканера в зависимости от того, как приложение установило яркость в элемент WIA 2,0.</span><span class="sxs-lookup"><span data-stu-id="20540-143">For example, a certain driver can change the brightness of the lamp in the scanner hardware depending on how the application has set the brightness into a WIA 2.0 item.</span></span> <span data-ttu-id="20540-144">Во время окончательного сканирования (когда приложение вызывает [**ивиатрансфер::D гружать**](-wia-iwiatransfer-download.md)) драйвер обычно изменяет физическую лампу сканера.</span><span class="sxs-lookup"><span data-stu-id="20540-144">During the final scan (when the application calls [**IWiaTransfer::Download**](-wia-iwiatransfer-download.md)) the driver would typically modify the physical lamp of the scanner.</span></span> <span data-ttu-id="20540-145">В этом случае фильтру обработки изображений может не потребоваться выполнять какую либо обработку яркости.</span><span class="sxs-lookup"><span data-stu-id="20540-145">In this case the image processing filter may not have to perform any brightness processing at all.</span></span> <span data-ttu-id="20540-146">Однако во время предварительной проверки драйвер не должен изменять яркость лампы — вместо этого следует позаботиться только о фильтре обработки изображений.</span><span class="sxs-lookup"><span data-stu-id="20540-146">During a preview scan, however, the driver should not modify the brightness of the lamp—instead this should be taken care of solely in the image processing filter.</span></span> <span data-ttu-id="20540-147">Важно, чтобы компонент WIA 2,0 Preview и фильтр обработки изображений возвращали точные изображения на основе свойств, заданных в элементе.</span><span class="sxs-lookup"><span data-stu-id="20540-147">It is important that the WIA 2.0 Preview Component and the image processing filter return accurate images based on the properties set into the item.</span></span>

<span data-ttu-id="20540-148">Фильтр обработки изображений должен поддерживать все форматы изображений, поддерживаемые драйвером.</span><span class="sxs-lookup"><span data-stu-id="20540-148">An image processing filter must support all image formats that the driver supports.</span></span>

<span data-ttu-id="20540-149">Фильтру обработки изображений всегда присваивается изображение, соответствующее области выбора, заданному для элемента, для которого выполняется получение изображения.</span><span class="sxs-lookup"><span data-stu-id="20540-149">The image processing filter is always given an image corresponding to the selection area set into the item for which we are acquiring the image.</span></span> <span data-ttu-id="20540-150">Однако обратите внимание, что изображение может быть повернуто драйвером в том случае, если он поддерживает свойство [**\_ \_ вращения IP-адресов**](-wia-wiaitempropscanneritem.md) .</span><span class="sxs-lookup"><span data-stu-id="20540-150">Note, however, that the image may have been rotated by the driver in case it supports the [**WIA\_IPS\_ROTATION**](-wia-wiaitempropscanneritem.md) property.</span></span>

<span data-ttu-id="20540-151">Фильтр обработки изображений создается с помощью [**IWiaItem2:: Extension**](-wia-iwiaitem2-getextension.md), обычно не приложением, но компонентами WIA 2,0, когда приложение вызывает [**Ивиапревиев:: жетневпревиев**](-wia-iwiapreview-getnewpreview.md) или [**ивиатрансфер::D гружать**](-wia-iwiatransfer-download.md).</span><span class="sxs-lookup"><span data-stu-id="20540-151">The image processing filter is created through [**IWiaItem2::GetExtension**](-wia-iwiaitem2-getextension.md), typically not by the application but by WIA 2.0 components when an application calls [**IWiaPreview::GetNewPreview**](-wia-iwiapreview-getnewpreview.md) or [**IWiaTransfer::Download**](-wia-iwiatransfer-download.md).</span></span>

<span data-ttu-id="20540-152">Интерфейс **ивиаимажефилтер** , как и все интерфейсы модели компонентных объектов (com), наследует методы интерфейса [IUnknown](/windows/win32/api/unknwn/nn-unknwn-iunknown) .</span><span class="sxs-lookup"><span data-stu-id="20540-152">The **IWiaImageFilter** interface, like all Component Object Model (COM) interfaces, inherits the [IUnknown](/windows/win32/api/unknwn/nn-unknwn-iunknown) interface methods.</span></span>



| <span data-ttu-id="20540-153">Методы IUnknown</span><span class="sxs-lookup"><span data-stu-id="20540-153">IUnknown Methods</span></span>                                        | <span data-ttu-id="20540-154">Описание</span><span class="sxs-lookup"><span data-stu-id="20540-154">Description</span></span>                               |
|---------------------------------------------------------|-------------------------------------------|
| <span data-ttu-id="20540-155">[IUnknown:: QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q))</span><span class="sxs-lookup"><span data-stu-id="20540-155">[IUnknown::QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q))</span></span> | <span data-ttu-id="20540-156">Возвращает указатели на поддерживаемые интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="20540-156">Returns pointers to supported interfaces.</span></span> |
| [<span data-ttu-id="20540-157">IUnknown:: AddRef</span><span class="sxs-lookup"><span data-stu-id="20540-157">IUnknown::AddRef</span></span>](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref)                 | <span data-ttu-id="20540-158">Увеличивает значение счетчика ссылок.</span><span class="sxs-lookup"><span data-stu-id="20540-158">Increments reference count.</span></span>               |
| [<span data-ttu-id="20540-159">IUnknown:: Release</span><span class="sxs-lookup"><span data-stu-id="20540-159">IUnknown::Release</span></span>](/windows/win32/api/unknwn/nf-unknwn-iunknown-release)               | <span data-ttu-id="20540-160">Уменьшает значение счетчика ссылок.</span><span class="sxs-lookup"><span data-stu-id="20540-160">Decrements reference count.</span></span>               |



 

## <a name="requirements"></a><span data-ttu-id="20540-161">Требования</span><span class="sxs-lookup"><span data-stu-id="20540-161">Requirements</span></span>



| <span data-ttu-id="20540-162">Требование</span><span class="sxs-lookup"><span data-stu-id="20540-162">Requirement</span></span> | <span data-ttu-id="20540-163">Значение</span><span class="sxs-lookup"><span data-stu-id="20540-163">Value</span></span> |
|-------------------------------------|------------------------------------------------------------------------------------|
| <span data-ttu-id="20540-164">Минимальная версия клиента</span><span class="sxs-lookup"><span data-stu-id="20540-164">Minimum supported client</span></span><br/> | <span data-ttu-id="20540-165">Только для \[ классических приложений Windows Vista\]</span><span class="sxs-lookup"><span data-stu-id="20540-165">Windows Vista \[desktop apps only\]</span></span><br/>                                     |
| <span data-ttu-id="20540-166">Минимальная версия сервера</span><span class="sxs-lookup"><span data-stu-id="20540-166">Minimum supported server</span></span><br/> | <span data-ttu-id="20540-167">\[Только для настольных приложений Windows Server 2008\]</span><span class="sxs-lookup"><span data-stu-id="20540-167">Windows Server 2008 \[desktop apps only\]</span></span><br/>                               |
| <span data-ttu-id="20540-168">Header</span><span class="sxs-lookup"><span data-stu-id="20540-168">Header</span></span><br/>                   | <dl> <span data-ttu-id="20540-169"><dt>WIA. h</dt></span><span class="sxs-lookup"><span data-stu-id="20540-169"><dt>Wia.h</dt></span></span> </dl>   |
| <span data-ttu-id="20540-170">IDL</span><span class="sxs-lookup"><span data-stu-id="20540-170">IDL</span></span><br/>                      | <dl> <span data-ttu-id="20540-171"><dt>WIA. idl</dt></span><span class="sxs-lookup"><span data-stu-id="20540-171"><dt>Wia.idl</dt></span></span> </dl> |



 

 
