---
title: Создание шейдера поверхности
description: В этом разделе показано, как спроектировать поверхности шейдер.
ms.assetid: c11c5652-dd7d-433d-bfa2-9853618ba334
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ece816ae33e7f4ecf4d024098e7741f197c423f1
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104997055"
---
# <a name="how-to-design-a-hull-shader"></a>Руководство. Проектирование шейдера поверхности

Шейдер поверхности — это первый из трех этапов, которые работают вместе для реализации [тесселяции](direct3d-11-advanced-stages-tessellation.md) (два других этапа — тесселяция и Шейдер доменов). В этом разделе показано, как спроектировать поверхности шейдер.

Шейдер поверхности требует наличия двух функций: основного шейдера поверхности и функции константы patch. Шейдер поверхности реализует вычисления для каждой контрольной точки; Шейдер поверхности также вызывает функцию константы Patch, которая реализует вычисления для каждого исправления.

После создания шейдера поверхности см. раздел [как создать поверхности шейдер](direct3d-11-advanced-stages-hull-shader-create.md) , чтобы узнать, как создать шейдер поверхности.

**Разработка шейдера поверхности**

1.  Определите точки управления входными и выходными данными шейдера поверхности.

    ```
    // Input control point
    struct VS_CONTROL_POINT_OUTPUT
    {
        float3 vPosition : WORLDPOS;
        float2 vUV       : TEXCOORD0;
        float3 vTangent  : TANGENT;
    };

    // Output control point
    struct BEZIER_CONTROL_POINT
    {
        float3 vPosition    : BEZIERPOS;
    };
    ```

    

2.  Определите постоянные данные выходного исправления.

    ```
    // Output patch constant data.
    struct HS_CONSTANT_DATA_OUTPUT
    {
        float Edges[4]        : SV_TessFactor;
        float Inside[2]       : SV_InsideTessFactor;
        
        float3 vTangent[4]    : TANGENT;
        float2 vUV[4]         : TEXCOORD;
        float3 vTanUCorner[4] : TANUCORNER;
        float3 vTanVCorner[4] : TANVCORNER;
        float4 vCWts          : TANWEIGHTS;
    };
    ```

    

    Для четырехъядерного домена [ОКП \_ тессфактор](/windows/desktop/direct3dhlsl/sv-tessfactor) определяет 4 фактора тесселяции краев (для тесселяции краев), так как для тесселяции фиксированных функций необходимо иметь представление о том, сколько нужно тесселяции. Необходимые выходные данные отличаются для доменов треугольников и исолине.

    Фиксированная тесселяция функции не просматривает никакие другие выходные данные шейдера поверхности, такие как другие константы исправления или любые контрольные точки. Шейдер домена, который вызывается для каждой точки, выдается с помощью предопределенной тесселяции функции, будет видеть все точки управления выходными данными шейдера поверхности и все данные константы выходного исправления. Шейдер оценивает исправление в своем расположении.

3.  Определите функцию константы patch. Функция константы Patch выполняется один раз для каждого исправления, чтобы вычислить все данные, которые являются постоянными для всего исправления (в отличие от данных точки управления, которые вычисляются в шейдере поверхности).

    ```
    
    #define MAX_POINTS 32

    // Patch Constant Function
    HS_CONSTANT_DATA_OUTPUT SubDToBezierConstantsHS( 
        InputPatch<VS_CONTROL_POINT_OUTPUT, MAX_POINTS> ip,
        uint PatchID : SV_PrimitiveID )
    {   
        HS_CONSTANT_DATA_OUTPUT Output;

        // Insert code to compute Output here
        
        return Output;
    }
    ```

    

    В функцию константы Patch входят следующие свойства:

    -   Один вход указывает переменную, содержащую идентификатор исправления, и определяется системным значением **SV \_ примитивеид** (см. [семантику](../direct3dhlsl/dx-graphics-hlsl-semantics.md) в модели шейдера 4).
    -   Одним входным параметром являются контрольные точки ввода, объявленные в **\_ \_ \_ выходных данных точки управления VS** в этом примере. Функция Patch может видеть все контрольные точки ввода для каждого исправления. в этом примере имеется 32 контрольных точек для каждого исправления.
    -   Как минимум, функция должна рассчитывать факторы тесселяции для каждого исправления для этапа тесселяции, которые определяются с помощью [SV \_ тессфактор](/windows/desktop/direct3dhlsl/sv-tessfactor). Для четырех доменов требуется четыре фактора тесселяции для краев и два дополнительных фактора (обозначены [ОКП \_ инсидетессфактор](/windows/desktop/direct3dhlsl/sv-insidetessfactor)) для тесселяции внутри исправления. Фиксированная тесселяция функции не просматривает никакие другие выходные данные шейдера поверхности (например, постоянные данные исправления или любые контрольные точки).
    -   Выходы обычно определяются структурой и определяются с помощью **\_ \_ \_ выходных данных о константах HS** в этом примере; структура зависит от типа домена и будет отличаться для доменов треугольников и исолине.

    Шейдер домена с другой стороны вызывается для каждой точки, создаваемой с помощью предопределенной тесселяции функции, и необходимо просмотреть контрольные точки вывода и данные константы выходного исправления (оба из шейдера поверхности) для вычисления исправления в его расположении.

4.  Определите шейдер поверхности. Шейдер поверхности определяет свойства исправления, включая функцию константы patch. Шейдер поверхности вызывается один раз для каждой контрольной точки вывода.

    ```
    [domain("quad")]
    [partitioning("integer")]
    [outputtopology("triangle_cw")]
    [outputcontrolpoints(16)]
    [patchconstantfunc("SubDToBezierConstantsHS")]
    BEZIER_CONTROL_POINT SubDToBezierHS( 
        InputPatch<VS_CONTROL_POINT_OUTPUT, MAX_POINTS> ip, 
        uint i : SV_OutputControlPointID,
        uint PatchID : SV_PrimitiveID )
    {
        VS_CONTROL_POINT_OUTPUT Output;

        // Insert code to compute Output here.
        
        return Output;
    }
    ```

    

    Шейдер поверхности использует следующие атрибуты:

    -   Атрибут [домена](/windows/desktop/direct3dhlsl/sm5-attributes-domain) .
    -   Атрибут [секционирования](/windows/desktop/direct3dhlsl/sm5-attributes-partitioning) .
    -   Атрибут [аутпуттопологи](/windows/desktop/direct3dhlsl/sm5-attributes-outputtopology) .
    -   Атрибут [аутпутконтролпоинтс](/windows/desktop/direct3dhlsl/sm5-attributes-outputcontrolpoints) .
    -   Атрибут [патчконстантфунк](/windows/desktop/direct3dhlsl/sm5-attributes-patchconstantfunc) . Шейдер поверхности вычисляет контрольные точки вывода, в этом примере есть 16 выходных контрольных точек Безье.

Все контрольные точки ввода (определяемые **\_ \_ \_ выходными данными точки управления VS**) видимы для каждого вызова шейдера поверхности. В этом примере есть 32 контрольных точек ввода.

Шейдер поверхности вызывается один раз для каждой контрольной точки вывода (определяется с помощью [SV \_ аутпутконтролпоинтид](/windows/desktop/direct3dhlsl/sv-outputcontrolpointid)) для каждого исправления (ОПРЕДЕЛЯЕТСЯ с помощью SV \_ примитивеид). Цель этого конкретного шейдера — вычислить вывод *i*, который был определен как контрольная точка Безье (в этом примере есть 16 контрольных точек вывода, определенных аутпутконтролпоинтс).

Шейдер поверхности выполняет подпрограммы один раз для каждого исправления (функция константы Patch) для расчета данных исправления (в качестве минимального значения). По отдельности, шейдер поверхности запускает функцию константы patch (именуемую Субдтобезиерконстантшс) для каждого исправления, чтобы вычислить постоянные данные исправления, такие как факторы тесселяции для этапа тесселяции.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Использование Direct3D 11](how-to-use-direct3d-11.md)
</dt> <dt>

[Общие сведения об тесселяции](direct3d-11-advanced-stages-tessellation.md)
</dt> </dl>

 

 