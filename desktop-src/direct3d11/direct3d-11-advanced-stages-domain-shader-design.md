---
title: Создание шейдера доменов
description: В этом разделе показано, как спроектировать Шейдер доменов.
ms.assetid: 329d4eb9-8886-401d-8fb4-39e06886998f
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2a01d6b006c5ffe3afa355abe5e662cb96aa1391
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104134171"
---
# <a name="how-to-design-a-domain-shader"></a><span data-ttu-id="57395-103">Руководство. Проектирование шейдера доменов</span><span class="sxs-lookup"><span data-stu-id="57395-103">How To: Design a Domain Shader</span></span>

<span data-ttu-id="57395-104">Шейдер доменов — это третий из трех этапов, которые работают вместе для реализации [тесселяции](direct3d-11-advanced-stages-tessellation.md).</span><span class="sxs-lookup"><span data-stu-id="57395-104">A domain shader is the third of three stages that work together to implement [tessellation](direct3d-11-advanced-stages-tessellation.md).</span></span> <span data-ttu-id="57395-105">Шейдер домена создает геометрию поверхности из преобразованных контрольных точек из шейдера поверхности и UV-координат.</span><span class="sxs-lookup"><span data-stu-id="57395-105">The domain shader generates the surface geometry from the transformed control points from a hull shader and the UV coordinates.</span></span> <span data-ttu-id="57395-106">В этом разделе показано, как спроектировать Шейдер доменов.</span><span class="sxs-lookup"><span data-stu-id="57395-106">This topics shows how to design a domain shader.</span></span>

<span data-ttu-id="57395-107">Шейдер домена вызывается один раз для каждой точки, созданной с помощью тесселяции предопределенных функций.</span><span class="sxs-lookup"><span data-stu-id="57395-107">A domain shader is invoked once for each point generated by the fixed function tessellator.</span></span> <span data-ttu-id="57395-108">Входные данные представляют собой \[ координаты UV W \] точки на данном исправлении, а также все выходных данных из шейдера поверхности, включая контрольные точки и константы исправлений.</span><span class="sxs-lookup"><span data-stu-id="57395-108">The inputs are the UV\[W\] coordinates of the point on the patch, as well as all of the output data from the hull shader including control points and patch constants.</span></span> <span data-ttu-id="57395-109">Выходные данные представляют собой вершину, определенную как угодно.</span><span class="sxs-lookup"><span data-stu-id="57395-109">The output is a vertex defined in whatever way is desired.</span></span> <span data-ttu-id="57395-110">Если выходные данные отправляются в шейдер пикселей, то выходные данные должны включать в себя расположение (обозначено \_ семантикой позиций SV).</span><span class="sxs-lookup"><span data-stu-id="57395-110">If the output is being sent to the pixel shader, the output must include a position (denoted with a SV\_Position semantic).</span></span>

<span data-ttu-id="57395-111">**Разработка шейдера домена**</span><span class="sxs-lookup"><span data-stu-id="57395-111">**To design a domain shader**</span></span>

1.  <span data-ttu-id="57395-112">Определите атрибут домена.</span><span class="sxs-lookup"><span data-stu-id="57395-112">Define the domain attribute.</span></span>

    ```
    [domain("quad")]
    ```

    

    <span data-ttu-id="57395-113">Домен определен для установки четырех исправлений.</span><span class="sxs-lookup"><span data-stu-id="57395-113">The domain is defined for a quad patch.</span></span>

2.  <span data-ttu-id="57395-114">Объявите расположение в поверхности с системным значением [расположения домена](/windows/desktop/direct3dhlsl/sv-domainlocation) .</span><span class="sxs-lookup"><span data-stu-id="57395-114">Declare the location on the hull with the [domain location](/windows/desktop/direct3dhlsl/sv-domainlocation) system value.</span></span>

    -   <span data-ttu-id="57395-115">Для четырех исправлений используйте float2.</span><span class="sxs-lookup"><span data-stu-id="57395-115">For a quad patch, use a float2.</span></span>
    -   <span data-ttu-id="57395-116">Для более трехуровневого обновления используйте float3 (для координат барицентрик).</span><span class="sxs-lookup"><span data-stu-id="57395-116">For a tri patch, use a float3 (for barycentric coordinates)</span></span>
    -   <span data-ttu-id="57395-117">Для исолине используйте float2.</span><span class="sxs-lookup"><span data-stu-id="57395-117">For an isoline, use a float2.</span></span>

    <span data-ttu-id="57395-118">Таким образом, расположение в домене для четырехъядерного исправления выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="57395-118">Therefore, the domain location for a quad patch looks like this:</span></span>

    ```
    float2 UV : SV_DomainLocation
    ```

    

3.  <span data-ttu-id="57395-119">Определите другие входные данные.</span><span class="sxs-lookup"><span data-stu-id="57395-119">Define the other inputs.</span></span>

    <span data-ttu-id="57395-120">Другие входные данные поступают из шейдера поверхности и определяются пользователем.</span><span class="sxs-lookup"><span data-stu-id="57395-120">The other inputs come from the hull shader and are user defined.</span></span> <span data-ttu-id="57395-121">Сюда входят контрольные точки ввода для исправления, в котором может находиться от 1 до 32 точек, а также данные константы с исправлением ввода.</span><span class="sxs-lookup"><span data-stu-id="57395-121">This includes the input control points for patch, of which there can be between 1 and 32 points, and input patch constant data.</span></span>

    <span data-ttu-id="57395-122">Контрольные точки определяются пользователем, обычно со структурой, такой как this (определена в [процедуре конструирования шейдера поверхности](direct3d-11-advanced-stages-hull-shader-design.md)):</span><span class="sxs-lookup"><span data-stu-id="57395-122">The control points are user defined, usually with a structure such as this one (defined in [How To: Design a Hull Shader](direct3d-11-advanced-stages-hull-shader-design.md)):</span></span>

    ```
    const OutputPatch<BEZIER_CONTROL_POINT, 16> bezpatch
    ```

    

    <span data-ttu-id="57395-123">Постоянные данные исправления также определяются пользователем и могут выглядеть следующим образом (определено в [процедуре конструирования шейдера поверхности](direct3d-11-advanced-stages-hull-shader-design.md)):</span><span class="sxs-lookup"><span data-stu-id="57395-123">The patch constant data is also user defined, and might look like this one (defined in [How To: Design a Hull Shader](direct3d-11-advanced-stages-hull-shader-design.md)):</span></span>

    ```
    HS_CONSTANT_DATA_OUTPUT input
    ```

    

4.  <span data-ttu-id="57395-124">Добавьте пользовательский код для расчета выходных данных. в результате образуется основная часть шейдера домена.</span><span class="sxs-lookup"><span data-stu-id="57395-124">Add user-defined code to compute the outputs; this makes up the body of the domain shader.</span></span>

    <span data-ttu-id="57395-125">Эта структура содержит определяемые пользователем выходные данные шейдера домена.</span><span class="sxs-lookup"><span data-stu-id="57395-125">This structure contains user-defined domain shader outputs.</span></span>

    ```
    struct DS_OUTPUT
    {
        float3 vNormal    : NORMAL;
        float2 vUV        : TEXCOORD;
        float3 vTangent   : TANGENT;
        float3 vBiTangent : BITANGENT;
        
        float4 vPosition  : SV_POSITION;
    };
    ```

    

    <span data-ttu-id="57395-126">Функция принимает каждый входной элемент UV (из тесселяции) и оценивает исправление Безье в этой позиции.</span><span class="sxs-lookup"><span data-stu-id="57395-126">The function takes each input UV (from the tessellator) and evaluates the Bezier patch at this position.</span></span>

    ```
    [domain("quad")]
    DS_OUTPUT BezierEvalDS( HS_CONSTANT_DATA_OUTPUT input, 
                            float2 UV : SV_DomainLocation,
                            const OutputPatch<BEZIER_CONTROL_POINT, 16> bezpatch )
    {
        DS_OUTPUT Output;

        // Insert code to compute the output here.

        return Output;    
    }
    ```

    

    <span data-ttu-id="57395-127">Функция вызывается один раз для каждой точки, созданной с помощью тесселяции предопределенных функций.</span><span class="sxs-lookup"><span data-stu-id="57395-127">The function is invoked once for each point generated by the fixed function tessellator.</span></span> <span data-ttu-id="57395-128">Так как в этом примере используется четыре исправления, входное расположение домена ([SV \_ домаинлокатион](/windows/desktop/direct3dhlsl/sv-domainlocation)) — это float2 (UV); у него должно быть float3ое расположение входных данных (УВВ барицентрик), а исолине — расположение домена ввода float2.</span><span class="sxs-lookup"><span data-stu-id="57395-128">Since this example uses a quad patch, the input domain location ([SV\_DomainLocation](/windows/desktop/direct3dhlsl/sv-domainlocation)) is a float2 (UV); a tri patch would have a float3 input location (UVW barycentric coordinates), and an isoline would have a float2 input domain location.</span></span>

    <span data-ttu-id="57395-129">Другие входные данные для функции берутся из шейдера поверхности напрямую.</span><span class="sxs-lookup"><span data-stu-id="57395-129">The other inputs for the function come from the hull shader directly.</span></span> <span data-ttu-id="57395-130">В этом примере 16 контрольных точек, каждая из которых является **\_ контрольной \_ точкой Безье**, а также постоянные данные исправления (**\_ \_ \_ выходные данные константы HS**).</span><span class="sxs-lookup"><span data-stu-id="57395-130">In this example it is 16 control points each one being a **BEZIER\_CONTROL\_POINT**, as well as patch constant data (**HS\_CONSTANT\_DATA\_OUTPUT**).</span></span> <span data-ttu-id="57395-131">Выходные данные — это вершина, содержащая любые данные, необходимые для **\_ вывода данных DS** в этом примере.</span><span class="sxs-lookup"><span data-stu-id="57395-131">The output is a vertex containing any data desired - **DS\_OUTPUT** in this example.</span></span>

<span data-ttu-id="57395-132">После разработки шейдера домена см. раздел [как создать Шейдер доменов](direct3d-11-advanced-stages-domain-shader-create.md).</span><span class="sxs-lookup"><span data-stu-id="57395-132">After designing a domain shader, see [How To: Create a Domain Shader](direct3d-11-advanced-stages-domain-shader-create.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="57395-133">См. также</span><span class="sxs-lookup"><span data-stu-id="57395-133">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="57395-134">Использование Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="57395-134">How to Use Direct3D 11</span></span>](how-to-use-direct3d-11.md)
</dt> <dt>

[<span data-ttu-id="57395-135">Общие сведения об тесселяции</span><span class="sxs-lookup"><span data-stu-id="57395-135">Tessellation Overview</span></span>](direct3d-11-advanced-stages-tessellation.md)
</dt> </dl>

 

 