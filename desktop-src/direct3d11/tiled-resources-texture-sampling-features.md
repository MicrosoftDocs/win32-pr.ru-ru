---
title: Функции выборки текстур для мозаичных ресурсов
description: В этом разделе описываются функции выборки текстуры для мозаичных ресурсов.
ms.assetid: E56737CE-C468-4D3C-84EE-E8EB2AB6F505
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cdd46c96219e54aea6990e91de8e340fdca5e32b
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103792696"
---
# <a name="tiled-resources-texture-sampling-features"></a><span data-ttu-id="5f5f4-103">Функции выборки текстур для мозаичных ресурсов</span><span class="sxs-lookup"><span data-stu-id="5f5f4-103">Tiled resources texture sampling features</span></span>

<span data-ttu-id="5f5f4-104">В этом разделе описываются функции выборки текстуры для мозаичных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-104">This section describes tiled resources texture sampling features.</span></span>

## <a name="requirements-of-tiled-resources-texture-sampling-features"></a><span data-ttu-id="5f5f4-105">Требования к функциям выборки текстур для мозаичных ресурсов</span><span class="sxs-lookup"><span data-stu-id="5f5f4-105">Requirements of tiled resources texture sampling features</span></span>

<span data-ttu-id="5f5f4-106">Описанные здесь функции выборки текстуры нуждаются в уровне уровня [2](tier-2.md) для поддержки мозаичных ресурсов.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-106">The texture sampling features described here require [Tier 2](tier-2.md) level of tiled resources support.</span></span>

## <a name="shader-feedback-about-mapped-areas"></a><span data-ttu-id="5f5f4-107">Обратная связь шейдера с сопоставленными областями</span><span class="sxs-lookup"><span data-stu-id="5f5f4-107">Shader feedback about mapped areas</span></span>

<span data-ttu-id="5f5f4-108">Любая инструкция шейдера, которая считывает и (или) выполняет запись в мозаичный ресурс, вызывает запись сведений о состоянии.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-108">Any shader instruction that reads and/or writes to a tiled resource causes status information to be recorded.</span></span> <span data-ttu-id="5f5f4-109">Этот статус предоставляется как дополнительное возвращаемое значение в каждой инструкции доступа к ресурсу, которая попадает в 32-разрядный временный регистр.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-109">This status is exposed as an optional extra return value on every resource access instruction that goes into a 32-bit temp register.</span></span> <span data-ttu-id="5f5f4-110">Содержимое возвращаемого значения является непрозрачным.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-110">The contents of the return value are opaque.</span></span> <span data-ttu-id="5f5f4-111">То есть его прямое чтения программой-шейдером запрещено.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-111">That is, direct reading by the shader program is disallowed.</span></span> <span data-ttu-id="5f5f4-112">Однако вы можете использовать функцию [**CheckAccessFullyMapped**](/windows/desktop/direct3dhlsl/checkaccessfullymapped), чтобы извлечь сведения о статусе.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-112">But, you can use the [**CheckAccessFullyMapped**](/windows/desktop/direct3dhlsl/checkaccessfullymapped) function to extract the status info.</span></span>

## <a name="fully-mapped-check"></a><span data-ttu-id="5f5f4-113">Проверка полного сопоставления</span><span class="sxs-lookup"><span data-stu-id="5f5f4-113">Fully mapped check</span></span>

<span data-ttu-id="5f5f4-114">Функция [**CheckAccessFullyMapped**](/windows/desktop/direct3dhlsl/checkaccessfullymapped) интерпретирует статус, возвращенный при доступе к памяти и указывает, все ли запрошенные данные были сопоставлены в ресурсе.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-114">The [**CheckAccessFullyMapped**](/windows/desktop/direct3dhlsl/checkaccessfullymapped) function interprets the status returned from a memory access and indicates whether all data being accessed was mapped in the resource.</span></span> <span data-ttu-id="5f5f4-115">**CheckAccessFullyMapped** возвращает значение true (0xFFFFFFFF), если данные сопоставлены и значение false (0x00000000) в ином случае.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-115">**CheckAccessFullyMapped** returns true (0xFFFFFFFF) if data was mapped or false (0x00000000) if data was unmapped.</span></span>

<span data-ttu-id="5f5f4-116">Иногда во время выполнения операций фильтров вес определенного текселя окажется равным 0.0.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-116">During filter operations, sometimes the weight of a given texel ends up being 0.0.</span></span> <span data-ttu-id="5f5f4-117">Примером является линейная выборка с координатами текстуры, точно попадающими на центр текселя: 3 других текселя (какие именно зависит от оборудования) участвуют в фильтре, но с весом равным 0.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-117">An example is a linear sample with texture coordinates that fall directly on a texel center: 3 other texels (which ones they are can vary by hardware) contribute to the filter but with 0 weight.</span></span> <span data-ttu-id="5f5f4-118">Эти тексели с нулевым весом совсем не влияют на результат фильтра, так что если они попадут на плитки **NULL**, они не будут считаться доступом без сопоставления.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-118">These 0 weight texels don't contribute to the filter result at all, so if they happen to fall on **NULL** tiles, they don't count as an unmapped access.</span></span> <span data-ttu-id="5f5f4-119">Обратите внимание, что те же гарантии действуют для фильтров текстур с несколькими уровнями MIP-карт. Если тексели в одной из этих карт не сопоставлены, но их вес равен 0, то эти тексели не будут считаться как доступ без сопоставления.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-119">Note the same guarantee applies for texture filters that include multiple mip levels; if the texels on one of the mipmaps isn't mapped but the weight on those texels is 0, those texels don't count as an unmapped access.</span></span>

<span data-ttu-id="5f5f4-120">При выборке из формата, который содержит менее 4 компонентов (например, \_ Формат DXGI \_ R8 \_ UNORM), любые пикселей текстуры, которые попадают на плитки **null** , приводят к тому, что полученный доступ сопоставляется со **значением NULL** независимо от того, какие компоненты на самом деле просматриваются шейдером в результате.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-120">When sampling from a format that has fewer than 4 components (such as DXGI\_FORMAT\_R8\_UNORM), any texels that fall on **NULL** tiles result in the a **NULL** mapped access being reported regardless of which components the shader actually looks at in the result.</span></span> <span data-ttu-id="5f5f4-121">Например, чтение из R8 \_ UNORM и маскирование результата чтения в шейдере с помощью. Гба/. ИЗВ не появлялось, чтобы полностью прочитать текстуру.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-121">For example, reading from R8\_UNORM and masking the read result in the shader with .gba/.yzw wouldn't appear to need to read the texture at all.</span></span> <span data-ttu-id="5f5f4-122">Но если адрес текселя это плитка, сопоставленная с **NULL**, операция все равно считается как доступ к **NULL** карте.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-122">But if the texel address is a **NULL** mapped tile, the operation still counts as a **NULL** map access.</span></span>

<span data-ttu-id="5f5f4-123">Шейдер может проверить этот статус и выполнить любую линию поведения в случае ошибки.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-123">The shader can check the status and pursue any desired course of action on failure.</span></span> <span data-ttu-id="5f5f4-124">Например, зарегистрировать «промахи» в журнале (например, через UAV-запись) и/или выдать другую инструкцию чтения, скрепленную с более грубым LOD, который точно сопоставлен.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-124">For example, a course of action can be logging 'misses' (say via UAV write) and/or issuing another read clamped to a coarser LOD known to be mapped.</span></span> <span data-ttu-id="5f5f4-125">Приложению также может потребоваться отслеживать успешные операции доступа, чтобы понять, какая часть сопоставленного набора плиток находится в работе.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-125">An application might want to track successful accesses as well in order to get a sense of what portion of the mapped set of tiles got accessed.</span></span>

<span data-ttu-id="5f5f4-126">Одна сложность для ведения подобного журнала заключается в том, нет механизма для регистрации точного набора плиток, к которым был осуществлен доступ.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-126">One complication for logging is no mechanism exists for reporting the exact set of tiles that would have been accessed.</span></span> <span data-ttu-id="5f5f4-127">Приложение может принимать консервативные предположения на основе сведений о координатах, используемых для доступа, а также использовать инструкцию Лод (например, [**tex2Dlod**](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-tex2dlod)), которая возвращает сведения о вычислении оборудования Лод.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-127">The application can make conservative guesses based on knowing the coordinates it used for access, as well as using the LOD instruction (for example, [**tex2Dlod**](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-tex2dlod)) which returns what the hardware LOD calculation is.</span></span>

<span data-ttu-id="5f5f4-128">Другая сложность — множество операций доступа будет для одних и тех же плиток, поэтому в журнале будет избыточная информация и возможны конфликты при обращении к памяти.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-128">Another complication is that lots of accesses will be to the same tiles, so a lot of redundant logging will occur and possibly contention on memory.</span></span> <span data-ttu-id="5f5f4-129">Будет удобно, если оборудованию дать возможность не регистрировать доступ к плитке, если это было сделано где-то раньше.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-129">It could be convenient if the hardware could be given the option to not bother to report tile accesses if they were reported elsewhere before.</span></span> <span data-ttu-id="5f5f4-130">Возможно, состояние такого отслеживания можно будет сбросить из API (скорее всего на границе кадра).</span><span class="sxs-lookup"><span data-stu-id="5f5f4-130">Perhaps the state of such tracking could be reset from the API (likely at frame boundaries).</span></span>

## <a name="per-sample-minlod-clamp"></a><span data-ttu-id="5f5f4-131">Скрепление MinLOD-по выборке</span><span class="sxs-lookup"><span data-stu-id="5f5f4-131">Per-sample MinLOD clamp</span></span>

<span data-ttu-id="5f5f4-132">Чтобы помочь шейдеру избежать областей в мипмаппед мозаичных ресурсах, которые известны как несопоставленные, большинство инструкций шейдера, использующих выборку (фильтрация), имеют новый режим, позволяющий шейдеру передавать дополнительный параметр float32 Минлод среза в образец текстуры.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-132">To help shaders avoid areas in mipmapped tiled resources that are known to be non-mapped, most shader instructions that involve using a sampler (filtering) have a new mode that allows the shader to pass an additional float32 MinLOD clamp parameter to the texture sample.</span></span> <span data-ttu-id="5f5f4-133">Это значение указывается в численном пространстве MIP-карты представления в противоположность нижележащему ресурсу.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-133">This value is in the view's mipmap number space, as opposed to the underlying resource.</span></span>

<span data-ttu-id="5f5f4-134">Оборудование выполняет [**Max**](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-max)(Фшадерминлодкламп, фкомпутедлод) в том же месте в вычислении Лод, где происходит минлодный зажим для каждого ресурса, что также является **максимальным**().</span><span class="sxs-lookup"><span data-stu-id="5f5f4-134">The hardware performs [**max**](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-max)(fShaderMinLODClamp,fComputedLOD) in the same place in the LOD calculation where the per-resource MinLOD clamp occurs, which is also a **max**().</span></span>

<span data-ttu-id="5f5f4-135">Если результатом применения скрепления LOD для каждого образца и любых других закреплений LOD, определенных в дискретизаторе, является пустое множество, то результатом будет тот же доступ вне границ как и при поресурсном закреплении minLOD: 0 для компонент в формате поверхности и значения по умолчанию для отсутствующих компонент.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-135">If the result of applying the per-sample LOD clamp and any other LOD clamps defined in the sampler is an empty set, the result is the same out of bounds access result as the per-resource minLOD clamp: 0 for components in the surface format and defaults for missing components.</span></span>

<span data-ttu-id="5f5f4-136">Инструкция Лод (например, [**tex2Dlod**](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-tex2dlod)), которая является префиксом для каждого образца минлод, описанного здесь, возвращает как векторную, так и нефрагментную Лод.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-136">The LOD instruction (for example, [**tex2Dlod**](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-tex2dlod)), which predates the per-sample minLOD clamp described here, returns both a clamped and unclamped LOD.</span></span> <span data-ttu-id="5f5f4-137">Скрепленный LOD, возвращенный из этой инструкции LOD, отражает все скрепления, включая скрепления по ресурсам, но не скрепления по выборкам.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-137">The clamped LOD returned from this LOD instruction reflects all clamping including the per-resource clamp, but not a per-sample clamp.</span></span> <span data-ttu-id="5f5f4-138">Скрепление по выборке все равно известно шейдеру и контролируется им, поэтому автор шейдера по желанию может вручную применить это скрепление к возвращенному значением инструкции LOD.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-138">Per-sample clamp is controlled and known by the shader anyway, so the shader author can manually apply that clamp to the LOD instruction's return value if desired.</span></span>

## <a name="minmax-reduction-filtering"></a><span data-ttu-id="5f5f4-139">Фильтрация сокращения минимумов и максимумов</span><span class="sxs-lookup"><span data-stu-id="5f5f4-139">Min/Max reduction filtering</span></span>

<span data-ttu-id="5f5f4-140">Приложения могут управлять собственными структурами данных, которые сообщают о том, как выглядят сопоставления для мозаичного ресурса.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-140">Applications can choose to manage their own data structures that inform them of what the mappings looks like for a tiled resource.</span></span> <span data-ttu-id="5f5f4-141">Примером может быть поверхность, содержащая шаг текселя для хранения информации о каждой плитке в мозаичном ресурсе.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-141">An example would be a surface that contains a texel to hold information for every tile in a tiled resource.</span></span> <span data-ttu-id="5f5f4-142">Например, можно сохранить первый LOD, сопоставленный в заданном расположении плитки.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-142">One might store the first LOD that is mapped at a given tile location.</span></span> <span data-ttu-id="5f5f4-143">С помощью тщательной выборки структуры данных аналогично тому, как предполагается выборка мозаичного ресурса, можно обнаружить минимальное Лод, полностью сопоставленное для всего объема фильтра текстур.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-143">By careful sampling of this data structure in a similar way that the tiled resource is intended to be sampled, one might discover what the minimum LOD that is fully mapped for an entire texture filter footprint will be.</span></span> <span data-ttu-id="5f5f4-144">Чтобы упростить этот процесс, Direct3D 11.2 предлагает новый режим дискретизатора общего назначения — min/max фильтрация.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-144">To help make this process easier, Direct3D 11.2 introduces a new general purpose sampler mode, min/max filtering.</span></span>

<span data-ttu-id="5f5f4-145">Возможности min/max фильтрации для отслеживания LOD могут пригодиться и для других целей, например, для фильтрации поверхности глубин.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-145">The utility of min/max filtering for LOD tracking might be useful for other purposes, such as, perhaps the filtering of depth surfaces.</span></span>

<span data-ttu-id="5f5f4-146">Min/max фильтрации сокращения — это режим дискретизаторов, который извлекает тот же набор текселей,что даст и обычный текстурный фильтр.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-146">Min/max reduction filtering is a mode on samplers that fetches the same set of texels that a normal texture filter would fetch.</span></span> <span data-ttu-id="5f5f4-147">Но вместо смешивания значений для получения результата, он возвращает min() или max() извлеченных текселей по отдельным компонентам (например, минимум всех R-значений, отдельно от минимума всех G-значений и т. д).</span><span class="sxs-lookup"><span data-stu-id="5f5f4-147">But instead of blending the values to produce an answer, it returns the min() or max() of the texels fetched, on a per-component basis (for example, the min of all the R values, separately from the min of all the G values and so on).</span></span>

<span data-ttu-id="5f5f4-148">Операции min/max действуют согласно правилам арифметической точности Direct3D.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-148">The min/max operations follow Direct3D arithmetic precision rules.</span></span> <span data-ttu-id="5f5f4-149">Порядок сравнений не важен.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-149">The order of comparisons doesn't matter.</span></span>

<span data-ttu-id="5f5f4-150">Иногда во время операций фильтра, которые не относится к режиму min/max, вес определенного текселя может оказаться равен 0.0.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-150">During filter operations that aren't min/max, sometimes the weight of a given texel ends up being 0.0.</span></span> <span data-ttu-id="5f5f4-151">Примером является линейная выборка с координатами текстуры, которые попадают непосредственно в шаг текселя Center-3 другие пикселей текстуры (то есть они могут варьироваться в зависимости от оборудования), участвующие в фильтре, но с нулевым весом.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-151">An example is a linear sample with texture coordinates that fall directly on a texel center - 3 other texels (which ones they are may vary by hardware) contribute to the filter but with 0 weight.</span></span> <span data-ttu-id="5f5f4-152">Любые из этих текселей, которые будут иметь вес 0 в фильтре, отличном от min/max, в случае фильтра min/max, по-прежнему не будут влиять на результат (и веса никаким образом не повлияют на работу фильтра min/max).</span><span class="sxs-lookup"><span data-stu-id="5f5f4-152">For any of these texels that would be 0 weight on a non-min/max filter, if the filter is min/max, these texels still do not contribute to the result (and the weights do not otherwise affect the min/max filter operation).</span></span>

<span data-ttu-id="5f5f4-153">Полный список режимов фильтрации показан в перечислении [**\_ фильтров D3D11**](/windows/desktop/api/D3D11/ne-d3d11-d3d11_filter) с МИНИМАЛЬным и максимальным значениями перечисления.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-153">The full list of filter modes is shown in the [**D3D11\_FILTER**](/windows/desktop/api/D3D11/ne-d3d11-d3d11_filter) enumeration with MINIMUM and MAXIMUM in the enumeration values.</span></span>

<span data-ttu-id="5f5f4-154">Поддержка этой функции зависит от поддержки [уровня 2](tier-2.md) для мозаичного распределения ресурсов.</span><span class="sxs-lookup"><span data-stu-id="5f5f4-154">Support for this feature depends on [Tier 2](tier-2.md) support for tiled resources.</span></span>

## <a name="related-topics"></a><span data-ttu-id="5f5f4-155">См. также</span><span class="sxs-lookup"><span data-stu-id="5f5f4-155">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="5f5f4-156">Доступ конвейера к мозаичным ресурсам</span><span class="sxs-lookup"><span data-stu-id="5f5f4-156">Pipeline access to tiled resources</span></span>](pipeline-access-to-tiled-resources.md)
</dt> </dl>

 

 