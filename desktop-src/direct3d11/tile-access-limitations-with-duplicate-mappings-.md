---
title: Ограничения доступа к плитке с повторяющимися сопоставлениями
description: В этом разделе описаны ограничения на доступ к плиткам с повторяющимися сопоставлениями.
ms.assetid: 7A498E0D-9151-4A89-B7C3-C4F476457D17
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0909b0d10e286e5f774f6893b692abdeb19d3ef7
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104067496"
---
# <a name="tile-access-limitations-with-duplicate-mappings"></a><span data-ttu-id="95f2e-103">Ограничения доступа к плитке с повторяющимися сопоставлениями</span><span class="sxs-lookup"><span data-stu-id="95f2e-103">Tile access limitations with duplicate mappings</span></span>

<span data-ttu-id="95f2e-104">В этом разделе описаны ограничения на доступ к плиткам с повторяющимися сопоставлениями.</span><span class="sxs-lookup"><span data-stu-id="95f2e-104">This section describes tile access limitations with duplicate mappings.</span></span>

## <a name="copying-tiled-resources-with-overlapping-source-and-destination"></a><span data-ttu-id="95f2e-105">Копирование мозаичных ресурсов с перекрывающимися источниками и назначениеми</span><span class="sxs-lookup"><span data-stu-id="95f2e-105">Copying tiled resources with overlapping source and destination</span></span>

<span data-ttu-id="95f2e-106">Если плитки в области источника и назначения \* операции копирования имеют дубликаты сопоставлений в области копирования, которые были бы перекрыто, даже если оба ресурса не были заполнены ресурсами \* , а операция копирования поддерживает перекрывающиеся копии, \* операция копирования будет работать нормально (как если бы источник копировался во временное расположение перед переходом к назначению).</span><span class="sxs-lookup"><span data-stu-id="95f2e-106">If tiles in the source and destination area of a Copy\* operation have duplicated mappings in the copy area that would have overlapped even if both resources were not tiled resources and the Copy\* operation supports overlapping copies, the Copy\* operation will behave fine (as if the source is copied to a temporary location before going to the destination).</span></span> <span data-ttu-id="95f2e-107">Но если перекрытие не является очевидным (например, когда ресурсы источника и назначения различаются, но имеют общие сопоставления, или сопоставления дублируются на определенной поверхности), результаты операции копирования для общих плиток будут не определены.</span><span class="sxs-lookup"><span data-stu-id="95f2e-107">But if the overlap is not obvious (like the source and destination resources are different but share mappings or mappings are duplicated over a given surface), results of the copy operation on the tiles that are shared are undefined.</span></span>

## <a name="copying-to-tiled-resource-with-duplicated-tiles-in-destination-area"></a><span data-ttu-id="95f2e-108">Копирование в мозаичный ресурс с повторяющимися плитками в области назначения</span><span class="sxs-lookup"><span data-stu-id="95f2e-108">Copying to tiled resource with duplicated tiles in destination area</span></span>

<span data-ttu-id="95f2e-109">Копирование в мозаичный ресурс с повторяющимися плитками в целевой области приведет к неопределенному результату на этих плитках, если только сами данные не идентичны. плитки могут записываться в разные заказы.</span><span class="sxs-lookup"><span data-stu-id="95f2e-109">Copying to a tiled resource with duplicated tiles in the destination area produces undefined results in these tiles unless the data itself is identical; different tiles might write the tiles in different orders.</span></span>

## <a name="uav-accesses-to-duplicate-tiles-mappings"></a><span data-ttu-id="95f2e-110">Доступ UAV к сопоставлениям дублирующихся плиток</span><span class="sxs-lookup"><span data-stu-id="95f2e-110">UAV accesses to duplicate tiles mappings</span></span>

<span data-ttu-id="95f2e-111">Предположим, что неупорядоченное представление доступа (UAV) в мозаичном ресурсе содержит дубликаты сопоставлений плиток в области или с другими ресурсами, привязанными к конвейеру.</span><span class="sxs-lookup"><span data-stu-id="95f2e-111">Suppose an unordered access view (UAV) on a tiled resource has duplicate tile mappings in its area or with other resources bound to the pipeline.</span></span> <span data-ttu-id="95f2e-112">Порядок доступа к этим повторяющимся плиткам не определен, если выполняется разными потоками, так же, как и любой порядок доступа к памяти в представлениях неупорядоченного доступа.</span><span class="sxs-lookup"><span data-stu-id="95f2e-112">Ordering of accesses to these duplicated tiles is undefined if performed by different threads, just as any ordering of memory access to UAVs in general is unordered.</span></span>

## <a name="rendering-after-tile-mapping-changes-or-content-updates-from-outside-mappings"></a><span data-ttu-id="95f2e-113">Отрисовка после изменения сопоставления плиток или обновления содержимого из внешних сопоставлений</span><span class="sxs-lookup"><span data-stu-id="95f2e-113">Rendering after tile mapping changes or content updates from outside mappings</span></span>

<span data-ttu-id="95f2e-114">Если изменились сопоставления плитки мозаичного ресурса или содержимое сопоставленных плиток мозаичного пула изменилось с помощью сопоставления другого мозаичного ресурса, и мозаичный ресурс будет подготовлен к просмотру с помощью представления целевого объекта прорисовки или представления трафарета глубины, приложение должно быть очищено (с помощью функций очистки API с фиксированной функцией) или полностью копировать с помощью \* \* API-интерфейсов Copy/Update. плитки, измененные в области визуализации (сопоставленные или нет).</span><span class="sxs-lookup"><span data-stu-id="95f2e-114">If a tiled resource's tile mappings have changed or content in mapped tiled pool tiles have changed via another tiled resource's mappings, and the tiled resource is going to be rendered via render target view or depth stencil view, the application must Clear (using the fixed function Clear APIs) or fully copy over using Copy\*/Update\* APIs the tiles that have changed within the area being rendered (mapped or not).</span></span> <span data-ttu-id="95f2e-115">Сбой приложения для очистки или копирования в этих случаях приводит к тому, что структуры оптимизации оборудования для данного представления целевого объекта прорисовки или представления трафарета глубины устарели, что приведет к несогласованности оборудования и несоответствия между различными аппаратными средствами.</span><span class="sxs-lookup"><span data-stu-id="95f2e-115">Failure of an application to clear or copy in these cases results in hardware optimization structures for the given render target view or depth stencil view being stale and will result in garbage rendering results on some hardware and inconsistency across different hardware.</span></span> <span data-ttu-id="95f2e-116">Эти скрытые структуры данных оптимизации, используемые оборудованием, могут быть локальными для отдельных сопоставлений и недоступны другим сопоставлениям одной и той же памяти.</span><span class="sxs-lookup"><span data-stu-id="95f2e-116">These hidden optimization data structures used by hardware might be local to individual mappings and not visible to other mappings to the same memory.</span></span>

<span data-ttu-id="95f2e-117">Операция [**ID3D11DeviceContext1:: клеарвиев**](/windows/desktop/api/D3D11_1/nf-d3d11_1-id3d11devicecontext1-clearview) поддерживает очистку целевых представлений прорисовки с помощью прямоугольников.</span><span class="sxs-lookup"><span data-stu-id="95f2e-117">The [**ID3D11DeviceContext1::ClearView**](/windows/desktop/api/D3D11_1/nf-d3d11_1-id3d11devicecontext1-clearview) operation supports clearing render target views with rectangles.</span></span> <span data-ttu-id="95f2e-118">Для оборудования, поддерживающего мозаичные ресурсы, **клеарвиев** также должен поддерживать очистку представлений трафаретов глубины с прямоугольниками, для поверхностей только глубины (без трафарета).</span><span class="sxs-lookup"><span data-stu-id="95f2e-118">For hardware that supports tiled resources, **ClearView** must also support clearing of depth stencil views with rectangles, for depth only surfaces (without stencil).</span></span> <span data-ttu-id="95f2e-119">Эта операция позволяет приложениям очистить только необходимые области поверхности.</span><span class="sxs-lookup"><span data-stu-id="95f2e-119">This operation allows applications to clear only the necessary area of a surface.</span></span>

<span data-ttu-id="95f2e-120">Если приложению необходимо сохранить содержимое памяти областей в мозаичном ресурсе, в котором изменились сопоставления, это приложение должно обойти требование четко.</span><span class="sxs-lookup"><span data-stu-id="95f2e-120">If an application needs to preserve existing memory contents of areas in a tiled resource where mappings have changed, that application must work around the clear requirement.</span></span> <span data-ttu-id="95f2e-121">Приложение может решить эту задачу, сначала сохранив содержимое, в котором изменились сопоставления плиток (путем копирования их на временную поверхность, например с помощью [**ID3D11DeviceContext2:: копитилес**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles)), выполнив необходимую команду CLEAR, а затем скопировав содержимое обратно.</span><span class="sxs-lookup"><span data-stu-id="95f2e-121">The application can accomplish this work-around by first saving the contents where tile mappings have changed (by copying them to a temporary surface, for example, by using [**ID3D11DeviceContext2::CopyTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles)), issuing the required clear command and then copying the contents back.</span></span> <span data-ttu-id="95f2e-122">Несмотря на то, что задача сохранения содержимого поверхности для постепенной отрисовки будет выполнена, недостаток состоит в том, что может снизиться производительность последующей отрисовки на данной поверхности, так оптимизации отрисовки могут быть потеряны.</span><span class="sxs-lookup"><span data-stu-id="95f2e-122">While this would accomplish the task of preserving surface contents for incremental rendering, the downside is that subsequent rendering performance on the surface might suffer because rendering optimizations might be lost.</span></span>

<span data-ttu-id="95f2e-123">Если плитка сопоставлена с несколькими мозаичными ресурсами одновременно, а содержимое плитки обрабатывается любыми средствами (рендеринг, копирование и т. д.) с помощью одного из мозаичных ресурсов, то, если одна и та же плитка должна быть подготовлена к просмотру с помощью любого другого мозаичного ресурса, плитку необходимо сначала очистить, как описано выше.</span><span class="sxs-lookup"><span data-stu-id="95f2e-123">If a tile is mapped into multiple tiled resources at the same time and tile contents are manipulated by any means (render, copy, and so on) via one of the tiled resources, if the same tile is to be rendered via any other tiled resource, the tile must be cleared first as previously described.</span></span>

## <a name="rendering-to-tiles-shared-outside-render-area"></a><span data-ttu-id="95f2e-124">Отрисовка общих плиток вне области отрисовки</span><span class="sxs-lookup"><span data-stu-id="95f2e-124">Rendering to tiles shared outside render area</span></span>

<span data-ttu-id="95f2e-125">Предположим, что область в мозаичном ресурсе готовится к просмотру, а плитки пула плиток, на которые ссылается область прорисовки, также сопоставляются с внешней областью прорисовки (включая через другие мозаичные ресурсы одновременно).</span><span class="sxs-lookup"><span data-stu-id="95f2e-125">Suppose an area in a tiled resource is being rendered to and the tile pool tiles referenced by the render area are also mapped to from outside the render area (including via other tiled resources, at the same time or not).</span></span> <span data-ttu-id="95f2e-126">Правильное отображение данных на этих плитках не гарантируется при просмотре через другие сопоставления, даже если базовая структура памяти совместима.</span><span class="sxs-lookup"><span data-stu-id="95f2e-126">Data rendered to these tiles isn't guaranteed to appear correctly when viewed through the other mappings, even though the underlying memory layout is compatible.</span></span> <span data-ttu-id="95f2e-127">Это происходит из-за структур данных оптимизации, используемых некоторым оборудованием, которые могут быть локальными для отдельных сопоставлений отрисовываемых поверхностей и недоступны другим сопоставлениям того же участка памяти.</span><span class="sxs-lookup"><span data-stu-id="95f2e-127">This fact is due to optimization data structures some hardware use that can be local to individual mappings for renderable surfaces and not visible to other mappings to the same memory location.</span></span> <span data-ttu-id="95f2e-128">Это ограничение можно обойти, произведя копирование из отрисованного сопоставления во все остальные сопоставления той же памяти, к которым может осуществляться доступ (или очистку памяти либо копирование в нее других данных, если старое содержимое больше не требуется).</span><span class="sxs-lookup"><span data-stu-id="95f2e-128">You can work around this restriction by copying from the rendered mapping to all the other mappings to the same memory that might be accessed (or clearing that memory or copying other data to it if the old contents are no longer needed).</span></span> <span data-ttu-id="95f2e-129">Несмотря на то, что этот обходной путь выглядит избыточным, благодаря ему все остальные сопоставления для одного и того же участка памяти способны получить доступ к его содержимому, и сохраняется экономия памяти благодаря наличию единого резерва физической памяти.</span><span class="sxs-lookup"><span data-stu-id="95f2e-129">While this work-around seems redundant, it makes all other mappings to the same memory correctly understand how to access its contents, and at least the memory savings of having only a single physical memory backing remains intact.</span></span> <span data-ttu-id="95f2e-130">Кроме того, при переключении между использованием различных мозаичных ресурсов с общими сопоставлениями (если только чтение не выполняется) необходимо вызвать API [**ID3D11DeviceContext2:: тиледресаурцебарриер**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier) между коммутаторами.</span><span class="sxs-lookup"><span data-stu-id="95f2e-130">Also, when you switch between using different tiled resources that share mappings (unless only reading), you must call the [**ID3D11DeviceContext2::TiledResourceBarrier**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier) API in between the switches.</span></span>

## <a name="rendering-to-tiles-shared-within-render-area"></a><span data-ttu-id="95f2e-131">Отрисовка общих плиток внутри области отрисовки</span><span class="sxs-lookup"><span data-stu-id="95f2e-131">Rendering to tiles shared within render area</span></span>

<span data-ttu-id="95f2e-132">Если область в мозаичном ресурсе готовится к просмотру, а в области прорисовки несколько плиток сопоставляются с одним и тем же расположением пула плиток, то результаты отрисовки на этих плитках не определены.</span><span class="sxs-lookup"><span data-stu-id="95f2e-132">If an area in a tiled resource is being rendered to and within the render area multiple tiles are mapped to the same tile pool location, rendering results are undefined on those tiles.</span></span>

## <a name="data-compatibility-across-tiled-resources-sharing-tiles"></a><span data-ttu-id="95f2e-133">Совместимость данных по плиткам совместного использования ресурсов</span><span class="sxs-lookup"><span data-stu-id="95f2e-133">Data compatibility across tiled resources sharing tiles</span></span>

<span data-ttu-id="95f2e-134">Предположим, что несколько мозаичных ресурсов имеют сопоставления с одними и теми же расположениями пула плиток, а каждый ресурс используется для доступа к одним и тем же данным.</span><span class="sxs-lookup"><span data-stu-id="95f2e-134">Suppose multiple tiled resources have mappings to the same tile pool locations and each resource is used to access the same data.</span></span> <span data-ttu-id="95f2e-135">Этот сценарий допустим только в том случае, если другие правила, связанные с устранением проблем с структурами оптимизации оборудования, исключаются, выполняются соответствующие вызовы [**ID3D11DeviceContext2:: тиледресаурцебарриер**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier) , а ресурсы мозаичного заполнения совместимы друг с другом.</span><span class="sxs-lookup"><span data-stu-id="95f2e-135">This scenario is only valid if the other rules about avoiding problems with hardware optimization structures are avoided, appropriate calls to [**ID3D11DeviceContext2::TiledResourceBarrier**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier) are made, and the tiled resources are compatible with each other.</span></span> <span data-ttu-id="95f2e-136">Последнее описывается в терминах того, что означает, что для мозаичного разделения ресурсов плитки не совместимы.</span><span class="sxs-lookup"><span data-stu-id="95f2e-136">The latter is described here in terms of what it means for tiled resources sharing tiles to be incompatible.</span></span> <span data-ttu-id="95f2e-137">Условием несовместимости при доступе к одним и тем же данным в повторяющихся сопоставлениях плиток является использование различных размеров или форматов поверхностей, либо наличие у ресурсов флагов привязки трафарета глубины или целей отрисовки.</span><span class="sxs-lookup"><span data-stu-id="95f2e-137">The incompatibility conditions of accessing the same data across duplicate tile mappings are the use of different surface dimensions or format, or differences in the presence of render target or depth stencil bind flags on the resources.</span></span> <span data-ttu-id="95f2e-138">Запись в память с одним типом сопоставления дает неопределенные результаты, если в дальнейшем производить чтение или отрисовку через сопоставление несовместимого ресурса.</span><span class="sxs-lookup"><span data-stu-id="95f2e-138">Writing to the memory with one type of mapping produces undefined results if you subsequently read or render via a mapping from an incompatible resource.</span></span> <span data-ttu-id="95f2e-139">Если другие сопоставления общих ресурсов сначала инициализируются с новыми данными (утилизация памяти для другой цели), последующие операции чтения или отрисовки проходят нормально, так как данные не подвергаются несовместимым интерпретациям.</span><span class="sxs-lookup"><span data-stu-id="95f2e-139">If the other resource sharing mappings are first initialized with new data (recycling the memory for a different purpose), the subsequent read or render operation is fine since data isn't bleeding across incompatible interpretations.</span></span> <span data-ttu-id="95f2e-140">Но при переключении между доступом к несовместимым сопоставлениям, таким как это, необходимо вызвать API **тиледресаурцебарриер** .</span><span class="sxs-lookup"><span data-stu-id="95f2e-140">But, you must call the **TiledResourceBarrier** API when you switch between accessing incompatible mappings like this.</span></span>

<span data-ttu-id="95f2e-141">Если флаг привязки цели отрисовки или трафарета глубины не установлен ни на одном ресурсе, имеющем общие сопоставления с другими ресурсами, ограничений становится гораздо меньше.</span><span class="sxs-lookup"><span data-stu-id="95f2e-141">If the render target or depth stencil bind flag isn't set on any of the resources sharing mappings with each other, there are far fewer restrictions.</span></span> <span data-ttu-id="95f2e-142">Если формат и типы поверхностей (например, Texture2D) совпадают, плитки могут использоваться совместно.</span><span class="sxs-lookup"><span data-stu-id="95f2e-142">As long as the format and surface types (for example, Texture2D) are the same, tiles can be shared.</span></span> <span data-ttu-id="95f2e-143">Поддерживаются различные форматы, например, поверхности BC \* и эквивалентный размер несжатого 32 бита или 16 бит на один формат компонента, например BC6H и R32G32B32A32.</span><span class="sxs-lookup"><span data-stu-id="95f2e-143">Different formats being compatible are cases such as BC\* surfaces and the equivalent sized uncompressed 32 bit or 16 bit per component format, like BC6H and R32G32B32A32.</span></span> <span data-ttu-id="95f2e-144">Многие форматы 32 бит на элемент могут иметь псевдонимы R32 \_ \* (R10G10B10A2 \_ \* , R8G8B8A8 \_ \* , B8G8R8A8 \_ \* , B8G8R8X8 \_ \* , R16G16 \_ \* ). Эта операция всегда была разрешена для ресурсов без мозаичного заполнения.</span><span class="sxs-lookup"><span data-stu-id="95f2e-144">Many 32 bit per element formats can be aliased with R32\_\* as well (R10G10B10A2\_\*, R8G8B8A8\_\*, B8G8R8A8\_\*,B8G8R8X8\_\*,R16G16\_\*); this operation has always been allowed for non-tiled resources.</span></span>

<span data-ttu-id="95f2e-145">Совместное использование упакованных и не упакованных плиток допускается, если форматы совместимы, а плитки заполняются сплошным цветом.</span><span class="sxs-lookup"><span data-stu-id="95f2e-145">Sharing between packed and non-packed tiles is fine if the formats are compatible and the tiles are filled with solid color.</span></span>

<span data-ttu-id="95f2e-146">И наконец, если у ресурсов, использующих общее сопоставление плиток, нет ничего общего, за исключением отсутствующих флагов привязки цели отрисовки или трафарета глубины, безопасно можно совместно использовать только память, заполненную нулями; сопоставление будет отображаться в виде декодированного нуля для определения формата конкретного ресурса (обычно просто 0).</span><span class="sxs-lookup"><span data-stu-id="95f2e-146">Finally, if nothing is common about the resources sharing tile mappings except that none have render target or depth stencil bind flags, only memory filled with 0 can be shared safely; the mapping will appear as whatever 0 decodes to for the definition of the given resource format (typically just 0).</span></span>

## <a name="related-topics"></a><span data-ttu-id="95f2e-147">См. также</span><span class="sxs-lookup"><span data-stu-id="95f2e-147">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="95f2e-148">Доступ конвейера к мозаичным ресурсам</span><span class="sxs-lookup"><span data-stu-id="95f2e-148">Pipeline access to tiled resources</span></span>](pipeline-access-to-tiled-resources.md)
</dt> </dl>

 

 




