---
title: API-интерфейсы мозаичного ресурса
description: Интерфейсы API, описанные в этом разделе, работают с мозаичными ресурсами и пулом плиток.
ms.assetid: 02DCF9BA-F9EA-4176-AD6F-AA620CE968BA
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8a0d97f5272f4f96db56e6e89b871951de035105
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104410672"
---
# <a name="tiled-resource-apis"></a><span data-ttu-id="4dae1-103">API-интерфейсы мозаичного ресурса</span><span class="sxs-lookup"><span data-stu-id="4dae1-103">Tiled Resource APIs</span></span>

<span data-ttu-id="4dae1-104">Интерфейсы API, описанные в этом разделе, работают с мозаичными ресурсами и пулом плиток.</span><span class="sxs-lookup"><span data-stu-id="4dae1-104">The APIs described in this section work with tiled resources and tile pool.</span></span>

-   [<span data-ttu-id="4dae1-105">Назначение плиток из пула плиток ресурсу</span><span class="sxs-lookup"><span data-stu-id="4dae1-105">Assigning tiles from a tile pool to a resource</span></span>](#assigning-tiles-from-a-tile-pool-to-a-resource)
-   [<span data-ttu-id="4dae1-106">Запрос заполнения и поддержки ресурсов</span><span class="sxs-lookup"><span data-stu-id="4dae1-106">Querying resource tiling and support</span></span>](#querying-resource-tiling-and-support)
-   [<span data-ttu-id="4dae1-107">Копирование мозаичных данных</span><span class="sxs-lookup"><span data-stu-id="4dae1-107">Copying tiled data</span></span>](#copying-tiled-data)
-   [<span data-ttu-id="4dae1-108">Изменение размера пула плиток</span><span class="sxs-lookup"><span data-stu-id="4dae1-108">Resizing tile pool</span></span>](#resizing-tile-pool)
-   [<span data-ttu-id="4dae1-109">Барьер ресурсов мозаики</span><span class="sxs-lookup"><span data-stu-id="4dae1-109">Tiled resource barrier</span></span>](#tiled-resource-barrier)
-   [<span data-ttu-id="4dae1-110">См. также</span><span class="sxs-lookup"><span data-stu-id="4dae1-110">Related topics</span></span>](#related-topics)

## <a name="assigning-tiles-from-a-tile-pool-to-a-resource"></a><span data-ttu-id="4dae1-111">Назначение плиток из пула плиток ресурсу</span><span class="sxs-lookup"><span data-stu-id="4dae1-111">Assigning tiles from a tile pool to a resource</span></span>

<span data-ttu-id="4dae1-112">Интерфейсы API [**ID3D11DeviceContext2:: упдатетилемаппингс**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-updatetilemappings) и [**ID3D11DeviceContext2:: копитилемаппингс**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytilemappings) обрабатывают и сопоставлений плиток запросов.</span><span class="sxs-lookup"><span data-stu-id="4dae1-112">The [**ID3D11DeviceContext2::UpdateTileMappings**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-updatetilemappings) and [**ID3D11DeviceContext2::CopyTileMappings**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytilemappings) APIs manipulate and query tile mappings.</span></span> <span data-ttu-id="4dae1-113">Вызовы Update влияют только на плитки, указанные в вызове, а другие остаются, как определено ранее.</span><span class="sxs-lookup"><span data-stu-id="4dae1-113">Update calls only affect the tiles identified in the call, and others are left as defined previously.</span></span>

<span data-ttu-id="4dae1-114">Любую плитку из пула плиток можно сопоставить с несколькими расположениями в ресурсе и даже с несколькими ресурсами.</span><span class="sxs-lookup"><span data-stu-id="4dae1-114">Any given tile from a tile pool can be mapped to multiple locations in a resource and even multiple resources.</span></span> <span data-ttu-id="4dae1-115">Это сопоставление включает плитки в ресурсе с макетом, выбранным для реализации ([mipmap упаковка](mipmap-packing.md)), где несколько MIP-карты упаковываются в одну плитку.</span><span class="sxs-lookup"><span data-stu-id="4dae1-115">This mapping includes tiles in a resource that have an implementation-chosen layout ([Mipmap packing](mipmap-packing.md)) where multiple mipmaps are packed together into a single tile.</span></span> <span data-ttu-id="4dae1-116">Catch заключается в том, что если данные записываются на плитку через одно сопоставление, но считываются с помощью другого настроенного сопоставления, результаты будут неопределенными.</span><span class="sxs-lookup"><span data-stu-id="4dae1-116">The catch is that if data is written to the tile via one mapping, but read via a differently configured mapping, the results are undefined.</span></span> <span data-ttu-id="4dae1-117">Внимательное использование этой гибкости может быть полезно для приложения, например для совместного использования плитки между ресурсами, которые не будут использоваться одновременно, где содержимое плитки всегда инициализируется с использованием того же сопоставления ресурсов, которое будет впоследствии считаться.</span><span class="sxs-lookup"><span data-stu-id="4dae1-117">Careful use of this flexibility can still be useful for an application though, like sharing a tile between resources that will not be used simultaneously, where the contents of the tile are always initialized through the same resource mapping as they will be subsequently read from.</span></span> <span data-ttu-id="4dae1-118">Аналогично, плитка, сопоставленная с упакованной MIP-карты нескольких разных ресурсов с одинаковыми измерениями поверхности, будет работать хорошо. данные будут отображаться одинаково в обоих сопоставлениях.</span><span class="sxs-lookup"><span data-stu-id="4dae1-118">Similarly, a tile mapped to hold the packed mipmaps of multiple different resources with the same surface dimensions will work fine - the data will appear the same in both mappings.</span></span>

<span data-ttu-id="4dae1-119">Изменения в назначениях плиток для ресурса можно вносить в любое время в немедленном или отложенном контексте.</span><span class="sxs-lookup"><span data-stu-id="4dae1-119">Changes to tile assignments for a resource can be made at any time in an immediate or deferred context.</span></span>

## <a name="querying-resource-tiling-and-support"></a><span data-ttu-id="4dae1-120">Запрос заполнения и поддержки ресурсов</span><span class="sxs-lookup"><span data-stu-id="4dae1-120">Querying resource tiling and support</span></span>

<span data-ttu-id="4dae1-121">Чтобы запросить разбиение ресурсов, используйте [**ID3D11Device2:: жетресаурцетилинг**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11device2-getresourcetiling).</span><span class="sxs-lookup"><span data-stu-id="4dae1-121">To query resource tiling, use [**ID3D11Device2::GetResourceTiling**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11device2-getresourcetiling).</span></span>

<span data-ttu-id="4dae1-122">Для поддержки разбиения ресурсов на другие ресурсы используйте [**ID3D11Device2:: CheckMultisampleQualityLevels1**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11device2-checkmultisamplequalitylevels1).</span><span class="sxs-lookup"><span data-stu-id="4dae1-122">For other resource tiling support, use [**ID3D11Device2::CheckMultisampleQualityLevels1**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11device2-checkmultisamplequalitylevels1).</span></span>

## <a name="copying-tiled-data"></a><span data-ttu-id="4dae1-123">Копирование мозаичных данных</span><span class="sxs-lookup"><span data-stu-id="4dae1-123">Copying tiled data</span></span>

<span data-ttu-id="4dae1-124">Любые методы в Direct3D для перемещения данных по работе с мозаичными ресурсами точно так же, как если бы они не были мозаичными, за исключением того, что операции записи в несопоставленные области удаляются, а операции чтения из несопоставленных областей создают 0.</span><span class="sxs-lookup"><span data-stu-id="4dae1-124">Any methods in Direct3D for moving data around work with tiled resources just as if they are not tiled, except that writes to unmapped areas are dropped and reads from unmapped areas produce 0.</span></span> <span data-ttu-id="4dae1-125">Если операция копирования включает запись в одно и то же расположение в памяти несколько раз, так как несколько расположений в целевом ресурсе сопоставляются с одной и той же памятью плитки, то результирующие записи в многосопоставленные плитки не являются детерминированными и не повторяются.</span><span class="sxs-lookup"><span data-stu-id="4dae1-125">If a copy operation involves writing to the same memory location multiple times because multiple locations in the destination resource are mapped to the same tile memory, the resulting writes to multi-mapped tiles are non-deterministic and non-repeatable.</span></span> <span data-ttu-id="4dae1-126">То есть, доступ выполняется в любом порядке, в котором происходит копирование.</span><span class="sxs-lookup"><span data-stu-id="4dae1-126">That is, accesses happen in whatever order the hardware happens to execute the copy.</span></span>

<span data-ttu-id="4dae1-127">В Direct3D 11,2 появились методы для следующих дополнительных способов копирования:</span><span class="sxs-lookup"><span data-stu-id="4dae1-127">Direct3D 11.2 introduces methods for these additional ways to copy:</span></span>

-   <span data-ttu-id="4dae1-128">Копирование между плитками в мозаичном ресурсе (с гранулярностью в 64 КБ) и (to/from) буфер в памяти графического процессора (или промежуточного ресурса) — [ **ID3D11DeviceContext2:: копитилес**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles)</span><span class="sxs-lookup"><span data-stu-id="4dae1-128">Copy between tiles in a tiled resource (at 64KB tile granularity) and (to/from) a buffer in graphics processing unit (GPU) memory (or staging resource) - [**ID3D11DeviceContext2::CopyTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles)</span></span>
-   <span data-ttu-id="4dae1-129">Копирование из памяти, предоставленной приложением, в плитки в мозаичном ресурсе — [ **ID3D11DeviceContext2:: упдатетилес**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-updatetiles)</span><span class="sxs-lookup"><span data-stu-id="4dae1-129">Copy from application-provided memory to tiles in a tiled resource - [**ID3D11DeviceContext2::UpdateTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-updatetiles)</span></span>

<span data-ttu-id="4dae1-130">При необходимости эти методы свиззле/десвиззле и разрешают D3D11 \_ плитку \_ Copy \_ без \_ флага перезаписи, когда вызывающий объект обещает, что на целевую память не ссылается работа GPU, которая находится в полете.</span><span class="sxs-lookup"><span data-stu-id="4dae1-130">These methods swizzle/deswizzle as needed, and allow a D3D11\_TILE\_COPY\_NO\_OVERWRITE flag when the caller promises the destination memory is not referenced by GPU work that is in flight.</span></span>

<span data-ttu-id="4dae1-131">Плитки, участвующие в копии, не могут включать плитки, содержащие Упакованные MIP-карты или имеющие неопределенные результаты.</span><span class="sxs-lookup"><span data-stu-id="4dae1-131">The tiles involved in the copy can't include tiles that contain packed mipmaps or that have results that are undefined.</span></span> <span data-ttu-id="4dae1-132">Чтобы передавать данные в MIP-карты и обратно, чтобы пакеты оборудования были в одной плитке, необходимо использовать стандартные (не относящиеся к плитке) API копирования и обновления или [**ссылку ID3D11DeviceContext:: женератемипс**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-generatemips) для всей цепочки MIP.</span><span class="sxs-lookup"><span data-stu-id="4dae1-132">To transfer data to/from mipmaps that the hardware packs into one tile, you must use the standard (non-tile specific) Copy/Update APIs or [**ID3D11DeviceContext::GenerateMips**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-generatemips) for the whole mip chain.</span></span>

<span data-ttu-id="4dae1-133">**Примечание. в [**женератемипс**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-generatemips):** использование [**ссылку ID3D11DeviceContext:: женератемипс**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-generatemips) для ресурса с частично сопоставленными плитками приведет к получению результатов, которые просто следуют правилам чтения и записи **значений NULL** , примененных к любому алгоритму, который может использоваться для **женератемипс**.</span><span class="sxs-lookup"><span data-stu-id="4dae1-133">**Note on [**GenerateMips**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-generatemips):** Using [**ID3D11DeviceContext::GenerateMips**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-generatemips) on a resource with partially mapped tiles will produce results that simply follow the rules for reading and writing **NULL** applied to whatever algorithm the hardware and display driver happen to use to **GenerateMips**.</span></span> <span data-ttu-id="4dae1-134">Таким образом, не особенно полезно, чтобы приложение применяет эту возможность, если не каким-либо областям с сопоставлениями **null** (и их влияния на другие MIPS на этапе создания) не повлияет на части поверхности, о которых позаботится приложение.</span><span class="sxs-lookup"><span data-stu-id="4dae1-134">So, it is not particularly useful for an application to bother doing this unless somehow the areas with **NULL** mappings (and their effect on other mips during the generation phase) will have no consequence on the parts of the surface the application does care about.</span></span>

<span data-ttu-id="4dae1-135">Копирование данных плитки из промежуточной поверхности или из памяти приложения — это способ передачи плиток, которые могут быть переработаны с диска, например.</span><span class="sxs-lookup"><span data-stu-id="4dae1-135">Copying tile data from a staging surface or from application memory would be the way to upload tiles that may have been streamed off disk, for example.</span></span> <span data-ttu-id="4dae1-136">Вариант при потоковой передаче диска — передача некоторых сжатых данных в память GPU и последующее декодирование графического процессора.</span><span class="sxs-lookup"><span data-stu-id="4dae1-136">A variation when streaming off disk is uploading some sort of compressed data to GPU memory and then decoding on the GPU.</span></span> <span data-ttu-id="4dae1-137">Целью декодирования может быть ресурс буфера в памяти GPU, из которого [**копитилес**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles) копируется в фактический мозаичный ресурс.</span><span class="sxs-lookup"><span data-stu-id="4dae1-137">The decode target could be a buffer resource in GPU memory, from which [**CopyTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles) then copies to the actual tiled resource.</span></span> <span data-ttu-id="4dae1-138">Этот шаг копирования позволяет свиззле GPU, если шаблон свиззле неизвестен.</span><span class="sxs-lookup"><span data-stu-id="4dae1-138">This copy step allows the GPU to swizzle when the swizzle pattern is not known.</span></span> <span data-ttu-id="4dae1-139">Группирующие не требуется, если сам мозаичный ресурс является буферным ресурсом (например, в отличие от текстуры).</span><span class="sxs-lookup"><span data-stu-id="4dae1-139">Swizzling is not needed if the tiled resource itself is a buffer resource (for example, as opposed to a Texture).</span></span>

<span data-ttu-id="4dae1-140">Макет памяти мозаичных элементов на стороне копии ресурсов, не являющихся мозаичным буфером, — это просто линейная память в блоках памяти объемом 64 КБ, которые должны свиззле/десвиззле на плитку при передаче в или из мозаичного ресурса.</span><span class="sxs-lookup"><span data-stu-id="4dae1-140">The memory layout of the tiles in the non-tiled buffer resource side of the copy is simply linear in memory within 64KB tiles, which the hardware and display driver would swizzle/deswizzle per tile as appropriate when transferring to/from a tiled resource.</span></span> <span data-ttu-id="4dae1-141">Для поверхностей многовыборочного сглаживания (MSAA) все выборки пикселов проходят в порядке выборки перед переходом к следующему пикселю.</span><span class="sxs-lookup"><span data-stu-id="4dae1-141">For multisample antialiasing (MSAA) surfaces, each pixel's samples are traversed in sample-index order before moving to the next pixel.</span></span> <span data-ttu-id="4dae1-142">Для плиток, которые частично заполнены в правой части (для поверхности, ширина которой не кратна ширине плитки в пикселях), шаг/шаг для перемещения вниз по строке — это полный размер в байтах от числа пикселей, которые помещаются на плитке, если плитка заполнена.</span><span class="sxs-lookup"><span data-stu-id="4dae1-142">For tiles that are partially filled on the right side (for a surface that has a width not a multiple of tile width in pixels), the pitch/stride to move down a row is the full size in bytes of the number pixels that would fit across the tile if the tile was full.</span></span> <span data-ttu-id="4dae1-143">Таким образом, между каждой строкой пикселей в памяти может быть разрыв.</span><span class="sxs-lookup"><span data-stu-id="4dae1-143">So, there can be a gap between each row of pixels in memory.</span></span> <span data-ttu-id="4dae1-144">Для простоты спецификации MIP-карты меньше, чем плитка, не упаковывается вместе в линейный макет.</span><span class="sxs-lookup"><span data-stu-id="4dae1-144">For specification simplicity, mipmaps smaller than a tile are not packed together in the linear layout.</span></span> <span data-ttu-id="4dae1-145">Вероятно, это непростое место в памяти, но, как упоминалось, копирование в MIPS, что пакеты оборудования вместе не разрешены через [**копитилес**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles) или [**упдатетилес**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-updatetiles).</span><span class="sxs-lookup"><span data-stu-id="4dae1-145">This seems to be a waste of memory space, but as mentioned copying to mips that the hardware packs together is not allowed via [**CopyTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles) or [**UpdateTiles**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-updatetiles).</span></span> <span data-ttu-id="4dae1-146">Приложение может просто использовать универсальные \* API упдатесубресаурце () или кописубресаурце \* () для копирования мелких MIPS по отдельности, хотя в случае кописубресаурце \* () это означает, что линейная память должна быть той же размерности, что и мозаичный ресурс-кописубресаурце \* (). не удается скопировать из буферного ресурса в Texture2D для экземпляра.</span><span class="sxs-lookup"><span data-stu-id="4dae1-146">The application can just use generic UpdateSubresource\*() or CopySubresource\*() APIs to copy small mips individually, though in the case of CopySubresource\*() that means the linear memory has to be the same dimension as the tiled resource - CopySubresource\*() can't copy from a buffer resource to a Texture2D for instance.</span></span>

<span data-ttu-id="4dae1-147">Если определена аппаратная стандартная свиззле, можно добавить флаги, чтобы указать, что данные в буфере должны интерпретироваться в этом формате (не требуется свиззле при передаче), хотя альтернативные подходы к отправке данных могут также иметь смысл в таком случае, например предоставить приложениям прямой доступ к памяти пула плиток.</span><span class="sxs-lookup"><span data-stu-id="4dae1-147">If a hardware standard swizzle is defined, flags could be added to indicate that the data in the buffer is to be interpreted in that format (no swizzle necessary on transfer), though alternative approaches to uploading data may also make sense in that case such as allowing applications direct access to tile pool memory.</span></span>

<span data-ttu-id="4dae1-148">Операции копирования можно выполнять в немедленном или отложенном контексте.</span><span class="sxs-lookup"><span data-stu-id="4dae1-148">Copying operations can be done on an immediate or deferred context.</span></span>

## <a name="resizing-tile-pool"></a><span data-ttu-id="4dae1-149">Изменение размера пула плиток</span><span class="sxs-lookup"><span data-stu-id="4dae1-149">Resizing tile pool</span></span>

<span data-ttu-id="4dae1-150">Чтобы изменить размер пула плиток, используйте [**ID3D11DeviceContext2:: ресизетилепул**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-resizetilepool).</span><span class="sxs-lookup"><span data-stu-id="4dae1-150">To resize a tile pool, use [**ID3D11DeviceContext2::ResizeTilePool**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-resizetilepool).</span></span>

## <a name="tiled-resource-barrier"></a><span data-ttu-id="4dae1-151">Барьер ресурсов мозаики</span><span class="sxs-lookup"><span data-stu-id="4dae1-151">Tiled resource barrier</span></span>

<span data-ttu-id="4dae1-152">Чтобы указать ограничение упорядочения доступа к данным между несколькими мозаичными ресурсами, используйте [**ID3D11DeviceContext2:: тиледресаурцебарриер**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier).</span><span class="sxs-lookup"><span data-stu-id="4dae1-152">To specify a data access ordering constraint between multiple tiled resources, use [**ID3D11DeviceContext2::TiledResourceBarrier**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier).</span></span>

## <a name="related-topics"></a><span data-ttu-id="4dae1-153">См. также</span><span class="sxs-lookup"><span data-stu-id="4dae1-153">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4dae1-154">Мозаичные ресурсы</span><span class="sxs-lookup"><span data-stu-id="4dae1-154">Tiled resources</span></span>](tiled-resources.md)
</dt> </dl>

 

 




