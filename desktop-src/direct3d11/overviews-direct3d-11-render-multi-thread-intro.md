---
title: Вводные сведения о многопоточности в Direct3D 11
description: Многопоточность разработана для повышения производительности за счет выполнения работы с использованием одного или нескольких потоков одновременно.
ms.assetid: b4bef1e4-8d34-455c-8aed-01af974c66c8
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 527b78d8b29a507247c8eb067c20739004ace687
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104337561"
---
# <a name="introduction-to-multithreading-in-direct3d-11"></a><span data-ttu-id="6ff99-103">Вводные сведения о многопоточности в Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="6ff99-103">Introduction to Multithreading in Direct3D 11</span></span>

<span data-ttu-id="6ff99-104">Многопоточность разработана для повышения производительности за счет выполнения работы с использованием одного или нескольких потоков одновременно.</span><span class="sxs-lookup"><span data-stu-id="6ff99-104">Multithreading is designed to improve performance by performing work using one or more threads at the same time.</span></span>

<span data-ttu-id="6ff99-105">В прошлом это было сделано за счет создания одного основного потока для подготовки к просмотру и одного или нескольких потоков для выполнения подготовительной работы, такой как создание, Загрузка, обработка и т. д.</span><span class="sxs-lookup"><span data-stu-id="6ff99-105">In the past, this has often been done by generating a single main thread for rendering and one or more threads for doing preparation work such as object creation, loading, processing, and so on.</span></span> <span data-ttu-id="6ff99-106">Однако при встроенной синхронизации в Direct3D 11 Цель многопоточности состоит в том, чтобы использовать все циклы ЦП и GPU, не требуя от процессора ожидания другого процессора (в частности, не выполняя его, так как это напрямую влияет на частоту кадров).</span><span class="sxs-lookup"><span data-stu-id="6ff99-106">However, with the built in synchronization in Direct3D 11, the goal behind multithreading is to utilize every CPU and GPU cycle without making a processor wait for another processor (particularly not making the GPU wait because it directly impacts frame rate).</span></span> <span data-ttu-id="6ff99-107">Таким образом, можно создать большую часть работы, сохранив при этом оптимальную частоту кадров.</span><span class="sxs-lookup"><span data-stu-id="6ff99-107">By doing so, you can generate the most amount of work while maintaining the best frame rate.</span></span> <span data-ttu-id="6ff99-108">Понятие одного кадра для отрисовки больше не требуется, так как API реализует синхронизацию.</span><span class="sxs-lookup"><span data-stu-id="6ff99-108">The concept of a single frame for rendering is no longer as necessary since the API implements synchronization.</span></span>

<span data-ttu-id="6ff99-109">Для многопоточности требуется определенная форма синхронизации.</span><span class="sxs-lookup"><span data-stu-id="6ff99-109">Multithreading requires some form of synchronization.</span></span> <span data-ttu-id="6ff99-110">Например, если несколько потоков, выполняемых в приложении, должны иметь доступ к контексту одного устройства ([**ссылку ID3D11DeviceContext**](/windows/desktop/api/D3D11/nn-d3d11-id3d11devicecontext)), это приложение должно использовать некоторый механизм синхронизации, например критические разделы, для синхронизации доступа к этому контексту устройства.</span><span class="sxs-lookup"><span data-stu-id="6ff99-110">For example, if multiple threads that run in an application must access a single device context ([**ID3D11DeviceContext**](/windows/desktop/api/D3D11/nn-d3d11-id3d11devicecontext)), that application must use some synchronization mechanism, such as critical sections, to synchronize access to that device context.</span></span> <span data-ttu-id="6ff99-111">Это обусловлено тем, что обработка команд отрисовки (обычно выполняется на GPU) и создание команд отрисовки (обычно выполняется в ЦП посредством создания объектов, загрузки данных, изменения состояния, обработки данных) часто используют те же ресурсы (текстуры, шейдеры, состояние конвейера и т. д.).</span><span class="sxs-lookup"><span data-stu-id="6ff99-111">This is because processing of the render commands (generally done on the GPU) and generating the render commands (generally done on the CPU through object creation, data loading, state changing, data processing) often use the same resources (textures, shaders, pipeline state, and so on).</span></span> <span data-ttu-id="6ff99-112">Для организации работы между несколькими потоками требуется синхронизация, чтобы предотвратить изменение или чтение одного потока данных, изменяемых другим потоком.</span><span class="sxs-lookup"><span data-stu-id="6ff99-112">Organizing the work across multiple threads requires synchronization to prevent one thread from modifying or reading data that is being modified by another thread.</span></span>

<span data-ttu-id="6ff99-113">Хотя использование контекста устройства ([**ссылку ID3D11DeviceContext**](/windows/desktop/api/D3D11/nn-d3d11-id3d11devicecontext)) не является потокобезопасным, использование устройства Direct3D 11 ([**ID3D11Device**](/windows/desktop/api/D3D11/nn-d3d11-id3d11device)) является потокобезопасным.</span><span class="sxs-lookup"><span data-stu-id="6ff99-113">While the use of a device context ([**ID3D11DeviceContext**](/windows/desktop/api/D3D11/nn-d3d11-id3d11devicecontext)) is not thread-safe, the use of a Direct3D 11 device ([**ID3D11Device**](/windows/desktop/api/D3D11/nn-d3d11-id3d11device)) is thread-safe.</span></span> <span data-ttu-id="6ff99-114">Так как каждый **ссылку ID3D11DeviceContext** является однопотоковым, только один поток может вызвать **ссылку ID3D11DeviceContext** за раз.</span><span class="sxs-lookup"><span data-stu-id="6ff99-114">Because each **ID3D11DeviceContext** is single threaded, only one thread can call a **ID3D11DeviceContext** at a time.</span></span> <span data-ttu-id="6ff99-115">Если несколько потоков должны иметь доступ к одному **ссылку ID3D11DeviceContext**, они должны использовать какой-либо механизм синхронизации, например критические разделы, для синхронизации доступа к этому **ссылку ID3D11DeviceContext**.</span><span class="sxs-lookup"><span data-stu-id="6ff99-115">If multiple threads must access a single **ID3D11DeviceContext**, they must use some synchronization mechanism, such as critical sections, to synchronize access to that **ID3D11DeviceContext**.</span></span> <span data-ttu-id="6ff99-116">Однако нескольким потокам не требуется использовать критические разделы или примитивы синхронизации для доступа к одному **ID3D11Device**.</span><span class="sxs-lookup"><span data-stu-id="6ff99-116">However, multiple threads are not required to use critical sections or synchronization primitives to access a single **ID3D11Device**.</span></span> <span data-ttu-id="6ff99-117">Таким образом, если приложение использует **ID3D11Device** для создания объектов ресурсов, это приложение не обязано использовать синхронизацию для одновременного создания нескольких объектов ресурсов.</span><span class="sxs-lookup"><span data-stu-id="6ff99-117">Therefore, if an application uses **ID3D11Device** to create resource objects, that application is not required to use synchronization to create multiple resource objects at the same time.</span></span>

<span data-ttu-id="6ff99-118">Поддержка многопоточности разделяет API на две различные функциональные области:</span><span class="sxs-lookup"><span data-stu-id="6ff99-118">Multithreading support divides the API into two distinct functional areas:</span></span>

-   [<span data-ttu-id="6ff99-119">Создание объектов с использованием многопоточности</span><span class="sxs-lookup"><span data-stu-id="6ff99-119">Object Creation with Multithreading</span></span>](overviews-direct3d-11-render-multi-thread-create.md)
-   [<span data-ttu-id="6ff99-120">Немедленное и отложенное отображение</span><span class="sxs-lookup"><span data-stu-id="6ff99-120">Immediate and Deferred Rendering</span></span>](overviews-direct3d-11-render-multi-thread-render.md)

<span data-ttu-id="6ff99-121">Производительность многопоточности зависит от поддержки драйверов.</span><span class="sxs-lookup"><span data-stu-id="6ff99-121">Multithreading performance depends on the driver support.</span></span> <span data-ttu-id="6ff99-122">[Инструкции. Проверка наличия поддержки драйверов](overviews-direct3d-11-render-multi-thread-support.md) содержит дополнительные сведения о запросах к драйверу и о том, что означают результаты.</span><span class="sxs-lookup"><span data-stu-id="6ff99-122">[How To: Check for Driver Support](overviews-direct3d-11-render-multi-thread-support.md) provides more information about querying the driver and what the results mean.</span></span>

<span data-ttu-id="6ff99-123">Direct3D 11 был разработан с нуля, чтобы поддерживать многопоточность.</span><span class="sxs-lookup"><span data-stu-id="6ff99-123">Direct3D 11 has been designed from the ground up to support multithreading.</span></span> <span data-ttu-id="6ff99-124">В Direct3D 10 реализована ограниченная поддержка многопоточности с помощью [потокобезопасного уровня](/windows/desktop/direct3d10/d3d10-graphics-programming-guide-api-features-layers).</span><span class="sxs-lookup"><span data-stu-id="6ff99-124">Direct3D 10 implements limited support for multithreading using the [thread-safe layer](/windows/desktop/direct3d10/d3d10-graphics-programming-guide-api-features-layers).</span></span> <span data-ttu-id="6ff99-125">На этой странице перечислены различия в поведении между двумя версиями DirectX: [различия в потоках между версиями Direct3D](overviews-direct3d-11-render-multi-thread-differences.md).</span><span class="sxs-lookup"><span data-stu-id="6ff99-125">This page lists the behavior differences between the two versions of DirectX: [Threading Differences between Direct3D Versions](overviews-direct3d-11-render-multi-thread-differences.md).</span></span>

## <a name="multithreading-and-dxgi"></a><span data-ttu-id="6ff99-126">Многопоточность и DXGI</span><span class="sxs-lookup"><span data-stu-id="6ff99-126">Multithreading and DXGI</span></span>

<span data-ttu-id="6ff99-127">Только один поток за раз должен использовать непосредственный контекст.</span><span class="sxs-lookup"><span data-stu-id="6ff99-127">Only one thread at a time should use the immediate context.</span></span> <span data-ttu-id="6ff99-128">Однако приложение также должно использовать тот же поток для операций с графической инфраструктурой Microsoft DirectX (DXGI), особенно когда приложение выполняет вызовы метода [**идксгисвапчаин::P**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-present) повторной отправки.</span><span class="sxs-lookup"><span data-stu-id="6ff99-128">However, your application should also use that same thread for Microsoft DirectX Graphics Infrastructure (DXGI) operations, especially when the application makes calls to the [**IDXGISwapChain::Present**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-present) method.</span></span>

> [!Note]  
> <span data-ttu-id="6ff99-129">Недопустимо использовать непосредственный контекст параллельно с большинством функций интерфейса DXGI.</span><span class="sxs-lookup"><span data-stu-id="6ff99-129">It is invalid to use an immediate context concurrently with most of the DXGI interface functions.</span></span> <span data-ttu-id="6ff99-130">В пакетах SDK для DirectX за Март 2009 и более поздних версий единственными функциями DXGI являются [**AddRef**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-addref), [**Release**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-release)и [**QueryInterface**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-queryinterface(q)).</span><span class="sxs-lookup"><span data-stu-id="6ff99-130">For the March 2009 and later DirectX SDKs, the only DXGI functions that are safe are [**AddRef**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-addref), [**Release**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-release), and [**QueryInterface**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-queryinterface(q)).</span></span>

 

<span data-ttu-id="6ff99-131">Дополнительные сведения об использовании DXGI с несколькими потоками см. в разделе [вопросы многопоточности](/windows/desktop/direct3ddxgi/d3d10-graphics-programming-guide-dxgi).</span><span class="sxs-lookup"><span data-stu-id="6ff99-131">For more info about using DXGI with multiple threads, see [Multithread Considerations](/windows/desktop/direct3ddxgi/d3d10-graphics-programming-guide-dxgi).</span></span>

## <a name="related-topics"></a><span data-ttu-id="6ff99-132">См. также</span><span class="sxs-lookup"><span data-stu-id="6ff99-132">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="6ff99-133">Многопоточность</span><span class="sxs-lookup"><span data-stu-id="6ff99-133">Multithreading</span></span>](overviews-direct3d-11-render-multi-thread.md)
</dt> </dl>

 

 