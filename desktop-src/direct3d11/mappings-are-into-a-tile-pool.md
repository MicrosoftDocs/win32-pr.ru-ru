---
title: Сопоставления в пуле плиток
description: При создании ресурса с помощью \_ флага D3D11 ресурса " \_ Разное" элементы \_ мозаики, составляющие ресурс, берутся из расположения в пуле плиток.
ms.assetid: 1DBE23B2-A1E6-4491-9B74-4E92508A68FC
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1537113d6685e39cab94445c8d3f16d406638820
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104997051"
---
# <a name="mappings-are-into-a-tile-pool"></a><span data-ttu-id="dea11-103">Сопоставления в пуле плиток</span><span class="sxs-lookup"><span data-stu-id="dea11-103">Mappings are into a tile pool</span></span>

<span data-ttu-id="dea11-104">При создании ресурса с помощью флага [**D3D11 \_ ресурса \_ " \_ Разное**](/windows/desktop/api/D3D11/ne-d3d11-d3d11_resource_misc_flag) " элементы мозаики, составляющие ресурс, берутся из расположения в пуле плиток.</span><span class="sxs-lookup"><span data-stu-id="dea11-104">When a resource is created with the [**D3D11\_RESOURCE\_MISC\_TILED**](/windows/desktop/api/D3D11/ne-d3d11-d3d11_resource_misc_flag) flag, the tiles that make up the resource come from pointing at locations in a tile pool.</span></span> <span data-ttu-id="dea11-105">Пул плиток — это пул памяти (в фоновом режиме которого выполняется одно или несколько выделений, которые не видны приложению).</span><span class="sxs-lookup"><span data-stu-id="dea11-105">A tile pool is a pool of memory (backed by one or more allocations behind the scenes - unseen by the application).</span></span> <span data-ttu-id="dea11-106">Операционная система и видеодрайвер управляют этим пулом памяти, а занятый в памяти участок легко понятен приложению.</span><span class="sxs-lookup"><span data-stu-id="dea11-106">The operating system and display driver manage this pool of memory, and the memory footprint is easily understood by an application.</span></span> <span data-ttu-id="dea11-107">Мозаичные ресурсы сопоставляют регионы в 64 КБ, указывая на расположения в пуле плиток.</span><span class="sxs-lookup"><span data-stu-id="dea11-107">Tiled resources map 64KB regions by pointing to locations in a tile pool.</span></span> <span data-ttu-id="dea11-108">Один из недостатков такой конфигурации заключается в том, что она позволяет нескольким ресурсам совместно и многократно использовать одни и те же плитки, а также повторно использовать одни и те же плитки в различных расположениях в ресурсе, если это необходимо.</span><span class="sxs-lookup"><span data-stu-id="dea11-108">One fallout of this setup is it allows multiple resources to share and reuse the same tiles, and also for the same tiles to be reused at different locations within a resource if desired.</span></span>

<span data-ttu-id="dea11-109">Цена, которую приходится платить за гибкость заполнения плиток для ресурсов из пула плиток, состоит в том, что ресурсу приходится выполнять работу по определению и поддержанию соответствия плиток в пуле плиткам, необходимым ресурсам.</span><span class="sxs-lookup"><span data-stu-id="dea11-109">The cost for the flexibility of populating the tiles for a resource out of a tile pool is that the resource has to do the work of defining and maintaining the mapping of which tiles in the tile pool represent the tiles needed for the resource.</span></span> <span data-ttu-id="dea11-110">Сопоставления плиток можно изменить.</span><span class="sxs-lookup"><span data-stu-id="dea11-110">Tile mappings can be changed.</span></span> <span data-ttu-id="dea11-111">Кроме того, не все плитки в ресурсе необходимо сопоставлять единовременно; ресурс может иметь сопоставления **NULL**.</span><span class="sxs-lookup"><span data-stu-id="dea11-111">Also, not all tiles in a resource need to be mapped at a time; a resource can have **NULL** mappings.</span></span> <span data-ttu-id="dea11-112">Сопоставление **NULL** определяет плитку как недоступную с точки зрения ресурса, осуществляющего доступ к ней.</span><span class="sxs-lookup"><span data-stu-id="dea11-112">A **NULL** mapping defines a tile as not being available from the point of view of the resource accessing it.</span></span>

<span data-ttu-id="dea11-113">Можно создать несколько пулов плиток, и любое количество мозаичных ресурсов может быть сопоставлено с любым пулом плиток одновременно.</span><span class="sxs-lookup"><span data-stu-id="dea11-113">Multiple tile pools can be created, and any number of tiled resources can map into any given tile pool at the same time.</span></span> <span data-ttu-id="dea11-114">Пулы плиток также можно расширять и сокращать.</span><span class="sxs-lookup"><span data-stu-id="dea11-114">Tile pools can also be grown or shrunk.</span></span> <span data-ttu-id="dea11-115">Дополнительные сведения см. в разделе [Изменение размера пула плиток](tile-pool-resizing.md).</span><span class="sxs-lookup"><span data-stu-id="dea11-115">For more info, see [Tile pool resizing](tile-pool-resizing.md).</span></span> <span data-ttu-id="dea11-116">Одно из ограничений, которое существует для упрощения драйвера экрана и реализации среды выполнения, заключается в том, что данный мозаичный ресурс может одновременно сопоставляться только с одним пулом плиток (в отличие от одновременного сопоставления с несколькими пулами плиток).</span><span class="sxs-lookup"><span data-stu-id="dea11-116">One constraint that exists to simplify display driver and runtime implementation is that a given tiled resource can only have mappings into at most one tile pool at a time (as opposed to having simultaneous mapping to multiple tile pools).</span></span>

<span data-ttu-id="dea11-117">Объем хранилища, связанный с самим ресурсом (то есть независимой памятью пула плиток), приблизительно пропорционален количеству плиток, фактически сопоставленных с пулом в любое заданное время.</span><span class="sxs-lookup"><span data-stu-id="dea11-117">The amount of storage that is associated with a tiled resource itself (that is, independent tile-pool memory) is roughly proportional to the number of tiles actually mapped to the pool at any given time.</span></span> <span data-ttu-id="dea11-118">Для оборудования этот факт сводится к масштабированию объема памяти для хранения таблицы страниц примерно в соответствии с количеством сопоставленных плиток (например, с помощью многоуровневой таблицы страниц, если это необходимо).</span><span class="sxs-lookup"><span data-stu-id="dea11-118">In hardware, this fact boils down to scaling the memory footprint for page table storage roughly with the amount of tiles that are mapped (for example, using a multilevel page table scheme as appropriate).</span></span>

<span data-ttu-id="dea11-119">Пул плиток можно считать полностью программной абстракцией, которая позволяет приложениям Direct3D эффективно создавать таблицы страниц на графическом процессоре (GPU) без необходимости получения сведений о реализации на низком уровне (или работать непосредственно с адресами-указателями).</span><span class="sxs-lookup"><span data-stu-id="dea11-119">The tile pool can be thought of as an entirely software abstraction that enables Direct3D applications to effectively be able to program the page tables on the graphics processing unit (GPU) without having to know the low level implementation details (or deal with pointer addresses directly).</span></span> <span data-ttu-id="dea11-120">Пулы плиток не добавляют каких-либо дополнительных уровней косвенного обращения в оборудовании.</span><span class="sxs-lookup"><span data-stu-id="dea11-120">Tile pools don't apply any additional levels of indirection in hardware.</span></span> <span data-ttu-id="dea11-121">Оптимизация одноуровневой таблицы страниц с помощью таких конструкций, как каталоги страницы, не зависит от концепции пула плиток.</span><span class="sxs-lookup"><span data-stu-id="dea11-121">Optimizations of a single level page table using constructs like page directories are independent of the tile pool concept.</span></span>

<span data-ttu-id="dea11-122">Рассмотрим, какой объем памяти может потребоваться самой таблице страницы в худшем случае (хотя на практике требуется объем памяти, примерно пропорциональный сопоставляемым объектам).</span><span class="sxs-lookup"><span data-stu-id="dea11-122">Let us explore what storage the page table itself could require in the worst case (though in practice implementations only require storage roughly proportional to what is mapped).</span></span>

<span data-ttu-id="dea11-123">Предположим, что каждая запись таблицы страниц состоит из 64 бит.</span><span class="sxs-lookup"><span data-stu-id="dea11-123">Suppose each page table entry is 64 bits.</span></span>

<span data-ttu-id="dea11-124">Для неограниченного размера таблицы страниц с наихудшим регистром, учитывая ограничения ресурсов в Direct3D 11, предположим, что создается мозаичный ресурс с 128-разрядным форматом элемента (например, RGBA с плавающей точкой), поэтому плитка 64 КБ содержит только 4096 пикселов.</span><span class="sxs-lookup"><span data-stu-id="dea11-124">For the worst-case page table size hit for a single surface, given the resource limits in Direct3D 11, suppose a tiled resource is created with a 128 bit-per-element format (for example, a RGBA float), so a 64KB tile contains only 4096 pixels.</span></span> <span data-ttu-id="dea11-125">Максимальный поддерживаемый размер [**Texture2DArray**](/windows/desktop/direct3dhlsl/sm5-object-texture2darray) 16384 \* 16384 \* 2048 (но только для одного mipmap) потребовал около 1 ГБ хранилища в таблице страниц, если они полностью заполнены (не включая MIP-карты) с использованием записей таблицы битов 64.</span><span class="sxs-lookup"><span data-stu-id="dea11-125">The maximum supported [**Texture2DArray**](/windows/desktop/direct3dhlsl/sm5-object-texture2darray) size of 16384\*16384\*2048 (but with only a single mipmap) would require about 1GB of storage in the page table if fully populated (not including mipmaps) using 64 bit table entries.</span></span> <span data-ttu-id="dea11-126">Добавление MIP-карт приведет к увеличению пространства для полностью сопоставленной (в худшем случае) таблицы страниц примерно на треть, то есть приблизительно до 1,3 ГБ.</span><span class="sxs-lookup"><span data-stu-id="dea11-126">Adding mipmaps would grow the fully-mapped (worst case) page table storage by about a third, to about 1.3GB.</span></span>

<span data-ttu-id="dea11-127">В этом случае обеспечивается доступ к примерно 10,6 терабайт адресуемой памяти.</span><span class="sxs-lookup"><span data-stu-id="dea11-127">This case would give access to about 10.6 terabytes of addressable memory.</span></span> <span data-ttu-id="dea11-128">Однако может существовать ограничение на объем адресуемой памяти, которое сократит эти объемы, возможно, до значений около одного терабайта.</span><span class="sxs-lookup"><span data-stu-id="dea11-128">There might be a limit on the amount of addressable memory however, which would reduce these amounts, perhaps to around the terabyte range.</span></span>

<span data-ttu-id="dea11-129">Другим вариантом, который следует рассмотреть, является один [**Texture2Dный**](/windows/desktop/direct3dhlsl/sm5-object-texture2d) мозаичный ресурс 16384 \* 16384 с форматом 32 bit-for-element, в том числе MIP-карты.</span><span class="sxs-lookup"><span data-stu-id="dea11-129">Another case to consider is a single [**Texture2D**](/windows/desktop/direct3dhlsl/sm5-object-texture2d) tiled resource of 16384\*16384 with a 32 bit-per-element format, including mipmaps.</span></span> <span data-ttu-id="dea11-130">Место, необходимое в полностью заполненной таблице страниц, составит около 170 КБ при 64-битных записях в таблице.</span><span class="sxs-lookup"><span data-stu-id="dea11-130">The space needed in a fully populated page table would be roughly 170KB with 64 bit table entries.</span></span>

<span data-ttu-id="dea11-131">Наконец, рассмотрим пример с использованием формата BC, скажем, BC7 со 128 битами на плитку размером 4 × 4 пикселя.</span><span class="sxs-lookup"><span data-stu-id="dea11-131">Finally, consider an example using a BC format, say BC7 with 128 bits per tile of 4x4 pixels.</span></span> <span data-ttu-id="dea11-132">Это составит один байт на пиксель.</span><span class="sxs-lookup"><span data-stu-id="dea11-132">That is one byte per pixel.</span></span> <span data-ttu-id="dea11-133">[**Texture2DArray**](/windows/desktop/direct3dhlsl/sm5-object-texture2darray) 16384 \* 16384 2048, \* включая MIP-карты, потребует примерно 85MB, чтобы полностью заполнить эту память в таблице страниц.</span><span class="sxs-lookup"><span data-stu-id="dea11-133">A [**Texture2DArray**](/windows/desktop/direct3dhlsl/sm5-object-texture2darray) of 16384\*16384\*2048 including mipmaps would require roughly 85MB to fully populate this memory in a page table.</span></span> <span data-ttu-id="dea11-134">Это неплохо, но это позволяет одному мозаичному ресурсу охватывать 550 гигапикселс (в данном случае 512 ГБ памяти).</span><span class="sxs-lookup"><span data-stu-id="dea11-134">That is not bad considering this allows one tiled resource to span 550 gigapixels (512 GB of memory in this case).</span></span>

<span data-ttu-id="dea11-135">На практике настолько полные сопоставления не определяются с учетом того, что объем физической памяти не позволит выполнить сопоставление и адресацию одновременно в подобных масштабах.</span><span class="sxs-lookup"><span data-stu-id="dea11-135">In practice, nowhere near these full mappings would be defined given that the amount of physical memory available wouldn't allow anywhere near that much to be mapped and referenced at a time.</span></span> <span data-ttu-id="dea11-136">Однако при работе с пулом плиток приложения могут повторно использовать плитки (в качестве простого примера мы можем повторно использовать плитку для заполнения крупных черных областей изображения), что позволяет эффективно применять пул плиток (то есть, сопоставления таблицы страниц) как средство для сокращения объемов памяти.</span><span class="sxs-lookup"><span data-stu-id="dea11-136">But with a tile pool, applications could choose to reuse tiles (as a simple example, reusing a "black" colored tile for large black regions in an image) - effectively using the tile pool (that is, page table mappings) as a tool for memory compression.</span></span>

<span data-ttu-id="dea11-137">Начальное содержимое таблицы страниц — **NULL** для всех записей.</span><span class="sxs-lookup"><span data-stu-id="dea11-137">The initial contents of the page table are **NULL** for all entries.</span></span> <span data-ttu-id="dea11-138">Приложения также не могут передавать исходные данные для содержимого памяти для поверхности, поскольку они запускаются без резервирования памяти.</span><span class="sxs-lookup"><span data-stu-id="dea11-138">Applications also can't pass initial data for the memory contents of the surface since it starts off with no memory backing.</span></span>

## <a name="in-this-section"></a><span data-ttu-id="dea11-139">В этом разделе</span><span class="sxs-lookup"><span data-stu-id="dea11-139">In this section</span></span>



| <span data-ttu-id="dea11-140">Раздел</span><span class="sxs-lookup"><span data-stu-id="dea11-140">Topic</span></span>                                                                                                   | <span data-ttu-id="dea11-141">Описание</span><span class="sxs-lookup"><span data-stu-id="dea11-141">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                |
|---------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="dea11-142">Создание пула плиток</span><span class="sxs-lookup"><span data-stu-id="dea11-142">Tile pool creation</span></span>](tile-pool-creation.md)<br/>                                                 | <span data-ttu-id="dea11-143">Пул плиток создается с помощью API-интерфейса [**ID3D11Device:: CreateBuffer**](/windows/desktop/api/D3D11/nf-d3d11-id3d11device-createbuffer) путем передачи флага [**\_ \_ \_ \_ пула плиток ресурсов D3D11**](/windows/desktop/api/D3D11/ne-d3d11-d3d11_resource_misc_flag) в элементе **мискфлагс** в структуре [**D3D11 \_ buffer \_**](/windows/desktop/api/D3D11/ns-d3d11-d3d11_buffer_desc) , на которую указывает параметр *пдеск* .</span><span class="sxs-lookup"><span data-stu-id="dea11-143">A tile pool is created via the [**ID3D11Device::CreateBuffer**](/windows/desktop/api/D3D11/nf-d3d11-id3d11device-createbuffer) API by passing the [**D3D11\_RESOURCE\_MISC\_TILE\_POOL**](/windows/desktop/api/D3D11/ne-d3d11-d3d11_resource_misc_flag) flag in the **MiscFlags** member of the [**D3D11\_BUFFER\_DESC**](/windows/desktop/api/D3D11/ns-d3d11-d3d11_buffer_desc) structure that the *pDesc* parameter points to.</span></span> <br/> |
| [<span data-ttu-id="dea11-144">Изменение размера пула плиток</span><span class="sxs-lookup"><span data-stu-id="dea11-144">Tile pool resizing</span></span>](tile-pool-resizing.md)<br/>                                                 | <span data-ttu-id="dea11-145">Используйте API [**ID3D11DeviceContext2:: ресизетилепул**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-resizetilepool) , чтобы расширить пул плиток, если приложению требуется больше рабочего набора для сопоставления с мозаичными ресурсами или для сжатия, если требуется меньше пространства.</span><span class="sxs-lookup"><span data-stu-id="dea11-145">Use the [**ID3D11DeviceContext2::ResizeTilePool**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-resizetilepool) API to grow a tile pool if the application needs more working set for the tiled resources mapping into it or to shrink if less space is needed.</span></span> <br/>                                                                                                                    |
| [<span data-ttu-id="dea11-146">Отслеживание рисков и ресурсы пула плиток</span><span class="sxs-lookup"><span data-stu-id="dea11-146">Hazard tracking versus tile pool resources</span></span>](hazard-tracking-versus-tile-pool-resources.md)<br/> | <span data-ttu-id="dea11-147">Для ресурсов без мозаичного разбиения Direct3D может предотвратить определенные условия опасности во время подготовки к просмотру, но так как отслеживание угроз будет на уровне плитки для мозаичных ресурсов, отслеживание условий угрозы во время отрисовки мозаичных ресурсов может оказаться слишком дорогостоящим.</span><span class="sxs-lookup"><span data-stu-id="dea11-147">For non-tiled resources, Direct3D can prevent certain hazard conditions during rendering, but because hazard tracking would be at a tile level for tiled resources, tracking hazard conditions during rendering of tiled resources might be too expensive.</span></span> <br/>                                                                                                     |



 

## <a name="related-topics"></a><span data-ttu-id="dea11-148">См. также</span><span class="sxs-lookup"><span data-stu-id="dea11-148">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="dea11-149">Создание мозаичных ресурсов</span><span class="sxs-lookup"><span data-stu-id="dea11-149">Creating tiled resources</span></span>](creating-tiled-resources.md)
</dt> </dl>

 

