---
title: Общие сведения о буферах в Direct3D 11
description: Буферный ресурс — это коллекция полностью типизированных данных, сгруппированных в элементы.
ms.assetid: e33ca01e-f13c-4f91-b0db-2b2bc6b4fd8f
keywords:
- буфер констант, что такое
- буфер вершин, что такое
- буфер индексов, что такое
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 241ade0721ae87b1371586bc901ee18f8975b53f
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104337897"
---
# <a name="introduction-to-buffers-in-direct3d-11"></a><span data-ttu-id="f2b9c-106">Общие сведения о буферах в Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="f2b9c-106">Introduction to Buffers in Direct3D 11</span></span>

<span data-ttu-id="f2b9c-107">Буферный ресурс — это коллекция полностью типизированных данных, сгруппированных в элементы.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-107">A buffer resource is a collection of fully typed data grouped into elements.</span></span> <span data-ttu-id="f2b9c-108">Буферы можно использовать для хранения самых разных данных, в том числе векторов положений, нормальных векторов, координат текстур (в буфере вершин), индексов (в буфере индексов) или состояния устройства.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-108">You can use buffers to store a wide variety of data, including position vectors, normal vectors, texture coordinates in a vertex buffer, indexes in an index buffer, or device state.</span></span> <span data-ttu-id="f2b9c-109">Элемент буфера состоит из компонентов числом от 1 до 4.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-109">A buffer element is made up of 1 to 4 components.</span></span> <span data-ttu-id="f2b9c-110">Элементы буфера могут включать в себя упакованные значения данных (например, значения поверхности R8G8B8A8), единичные 8-разрядные целые числа или четыре 32-разрядных значения с плавающей запятой.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-110">Buffer elements can include packed data values (like R8G8B8A8 surface values), single 8-bit integers, or four 32-bit floating point values.</span></span>

<span data-ttu-id="f2b9c-111">Буфер создается как неструктурированный ресурс.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-111">A buffer is created as an unstructured resource.</span></span> <span data-ttu-id="f2b9c-112">Поскольку он неструктурированный, буфер не может содержать какие-либо уровни MIP, не может использовать фильтрацию при чтении и не может подвергаться множественной дискретизации.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-112">Because it is unstructured, a buffer cannot contain any mipmap levels, it cannot get filtered when read, and it cannot be multisampled.</span></span>

## <a name="buffer-types"></a><span data-ttu-id="f2b9c-113">Типы буферов</span><span class="sxs-lookup"><span data-stu-id="f2b9c-113">Buffer Types</span></span>

<span data-ttu-id="f2b9c-114">Ниже приведены типы буферных ресурсов, поддерживаемые Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-114">The following are the buffer resource types supported by Direct3D 11.</span></span> <span data-ttu-id="f2b9c-115">Все типы буферов инкапсулированы интерфейсом [**ID3D11Buffer**](/windows/desktop/api/D3D11/nn-d3d11-id3d11buffer) .</span><span class="sxs-lookup"><span data-stu-id="f2b9c-115">All buffer types are encapsulated by the [**ID3D11Buffer**](/windows/desktop/api/D3D11/nn-d3d11-id3d11buffer) interface.</span></span>

-   [<span data-ttu-id="f2b9c-116">Буфер вершин</span><span class="sxs-lookup"><span data-stu-id="f2b9c-116">Vertex Buffer</span></span>](#vertex-buffer)
-   [<span data-ttu-id="f2b9c-117">Буфер индексов</span><span class="sxs-lookup"><span data-stu-id="f2b9c-117">Index Buffer</span></span>](#index-buffer)
-   [<span data-ttu-id="f2b9c-118">Буфер констант</span><span class="sxs-lookup"><span data-stu-id="f2b9c-118">Constant Buffer</span></span>](#constant-buffer)

### <a name="vertex-buffer"></a><span data-ttu-id="f2b9c-119">Буфер вершин</span><span class="sxs-lookup"><span data-stu-id="f2b9c-119">Vertex Buffer</span></span>

<span data-ttu-id="f2b9c-120">Буфер вершин содержит данные вершин, используемые для определения геометрии.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-120">A vertex buffer contains the vertex data used to define your geometry.</span></span> <span data-ttu-id="f2b9c-121">К данным вершин относятся координаты положения, данные цвета, данные координат текстуры, данные нормали и т. д.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-121">Vertex data includes position coordinates, color data, texture coordinate data, normal data, and so on.</span></span>

<span data-ttu-id="f2b9c-122">Самый простой пример буфера вершин — это буфер, который содержит только данные положения.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-122">The simplest example of a vertex buffer is one that only contains position data.</span></span> <span data-ttu-id="f2b9c-123">Его можно изобразить, как на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-123">It can be visualized like the following illustration.</span></span>

![иллюстрация буфера вершин, который содержит данные положения](images/d3d10-resources-single-element-vb2.png)

<span data-ttu-id="f2b9c-125">Чаще всего буфер вершин содержит все данные, необходимые для полного описания трехмерных вершин.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-125">More often, a vertex buffer contains all the data needed to fully specify 3D vertices.</span></span> <span data-ttu-id="f2b9c-126">Примером этого может быть буфер вершин, который содержит положение, нормаль и координаты текстуры для каждой вершины.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-126">An example of this could be a vertex buffer that contains per-vertex position, normal and texture coordinates.</span></span> <span data-ttu-id="f2b9c-127">Эти данные обычно упорядочены в виде наборов элементов для каждой вершины, как показано на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-127">This data is usually organized as sets of per-vertex elements, as shown in the following illustration.</span></span>

![иллюстрация буфера вершин, который содержит данные положения, нормали и текстуры](images/d3d10-vertex-buffer-element.png)

<span data-ttu-id="f2b9c-129">Этот буфер вершин содержит данные по каждой вершине; для каждой вершины сохраняются три элемента (положение, нормаль и координаты текстуры).</span><span class="sxs-lookup"><span data-stu-id="f2b9c-129">This vertex buffer contains per-vertex data; each vertex stores three elements (position, normal, and texture coordinates).</span></span> <span data-ttu-id="f2b9c-130">Положения и нормали обычно задаются с помощью 3 32-битных плавающих чисел (в \_ формате DXGI \_ R32G32B32 \_ float) и координатах текстуры с использованием 2 32-разрядных чисел с плавающей запятой ( \_ Формат DXGI \_ R32G32 \_ float).</span><span class="sxs-lookup"><span data-stu-id="f2b9c-130">The position and normal are each typically specified using three 32-bit floats (DXGI\_FORMAT\_R32G32B32\_FLOAT) and the texture coordinates using two 32-bit floats (DXGI\_FORMAT\_R32G32\_FLOAT).</span></span>

<span data-ttu-id="f2b9c-131">Для доступа к данным из буфера вершин необходимо знать, какая вершина нужна, а также следующие дополнительные параметры буфера.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-131">To access data from a vertex buffer you need to know which vertex to access, plus the following additional buffer parameters:</span></span>

-   <span data-ttu-id="f2b9c-132">Смещение — число байтов от начала буфера до данных для первой вершины.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-132">Offset - the number of bytes from the start of the buffer to the data for the first vertex.</span></span> <span data-ttu-id="f2b9c-133">Смещение можно указать с помощью метода [**ссылку ID3D11DeviceContext:: иасетвертексбуфферс**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-iasetvertexbuffers) .</span><span class="sxs-lookup"><span data-stu-id="f2b9c-133">You can specify the offset using the [**ID3D11DeviceContext::IASetVertexBuffers**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-iasetvertexbuffers) method.</span></span>
-   <span data-ttu-id="f2b9c-134">BaseVertexLocation — количество байтов от смещения до первой вершины, используемой с помощью соответствующего вызова рисования.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-134">BaseVertexLocation - the number of bytes from the offset to the first vertex used by the appropriate draw call.</span></span>

<span data-ttu-id="f2b9c-135">Перед созданием буфера вершин необходимо определить его макет, создав интерфейс [**ID3D11InputLayout**](/windows/win32/api/d3d11/nn-d3d11-id3d11inputlayout) . Это делается путем вызова метода [**ID3D11Device:: креатеинпутлайаут**](/windows/desktop/api/D3D11/nf-d3d11-id3d11device-createinputlayout) .</span><span class="sxs-lookup"><span data-stu-id="f2b9c-135">Before you create a vertex buffer, you need to define its layout by creating an [**ID3D11InputLayout**](/windows/win32/api/d3d11/nn-d3d11-id3d11inputlayout) interface; this is done by calling the [**ID3D11Device::CreateInputLayout**](/windows/desktop/api/D3D11/nf-d3d11-id3d11device-createinputlayout) method.</span></span> <span data-ttu-id="f2b9c-136">После создания объекта макета ввода его можно привязать к этапу входного ассемблера, вызвав метод [**ссылку ID3D11DeviceContext:: иасетинпутлайаут**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-iasetinputlayout).</span><span class="sxs-lookup"><span data-stu-id="f2b9c-136">After the input-layout object is created, you can bind it to the input-assembler stage by calling the [**ID3D11DeviceContext::IASetInputLayout**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-iasetinputlayout).</span></span>

<span data-ttu-id="f2b9c-137">Чтобы создать буфер вершин, вызовите [**ID3D11Device:: CreateBuffer**](/windows/desktop/api/D3D11/nf-d3d11-id3d11device-createbuffer).</span><span class="sxs-lookup"><span data-stu-id="f2b9c-137">To create a vertex buffer, call [**ID3D11Device::CreateBuffer**](/windows/desktop/api/D3D11/nf-d3d11-id3d11device-createbuffer).</span></span>

### <a name="index-buffer"></a><span data-ttu-id="f2b9c-138">Буфер индексов</span><span class="sxs-lookup"><span data-stu-id="f2b9c-138">Index Buffer</span></span>

<span data-ttu-id="f2b9c-139">Буферы индексов содержат целочисленные указатели в буферы вершин и используются для более эффективной отрисовки примитивов.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-139">Index buffers contain integer offsets into vertex buffers and are used to render primitives more efficiently.</span></span> <span data-ttu-id="f2b9c-140">Буфер индексов содержит последовательный набор 16-разрядных или 32-разрядных индексов; каждый индекс используется для идентификации вершины в буфере вершин.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-140">An index buffer contains a sequential set of 16-bit or 32-bit indices; each index is used to identify a vertex in a vertex buffer.</span></span> <span data-ttu-id="f2b9c-141">Буфер индексов можно изобразить, как на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-141">An index buffer can be visualized like the following illustration.</span></span>

![иллюстрация буфера индексов](images/d3d10-index-buffer.png)

<span data-ttu-id="f2b9c-143">Последовательные индексы, хранящиеся в буфере индексов, обнаруживаются по следующим параметрам:</span><span class="sxs-lookup"><span data-stu-id="f2b9c-143">The sequential indices stored in an index buffer are located with the following parameters:</span></span>

-   <span data-ttu-id="f2b9c-144">Смещение — число байтов от базового адреса буфера индексов.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-144">Offset - the number of bytes from the base address of the index buffer.</span></span> <span data-ttu-id="f2b9c-145">Смещение предоставляется методу [**ссылку ID3D11DeviceContext:: иасетиндексбуффер**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-iasetindexbuffer) .</span><span class="sxs-lookup"><span data-stu-id="f2b9c-145">The offset is supplied to the [**ID3D11DeviceContext::IASetIndexBuffer**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-iasetindexbuffer) method.</span></span>
-   <span data-ttu-id="f2b9c-146">Стартиндекслокатион — указывает первый элемент буфера индекса из базового адреса и смещение, предоставленное в [**иасетиндексбуффер**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-iasetindexbuffer).</span><span class="sxs-lookup"><span data-stu-id="f2b9c-146">StartIndexLocation - specifies the first index buffer element from the base address and the offset provided in [**IASetIndexBuffer**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-iasetindexbuffer).</span></span> <span data-ttu-id="f2b9c-147">Начальное расположение указывается для метода [**ссылку ID3D11DeviceContext::D равиндексед**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-drawindexed) или [**ссылку ID3D11DeviceContext::D равиндексединстанцед**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-drawindexedinstanced) и представляет первый индекс для отображения.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-147">The start location is supplied to the [**ID3D11DeviceContext::DrawIndexed**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-drawindexed) or [**ID3D11DeviceContext::DrawIndexedInstanced**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-drawindexedinstanced) method and represents the first index to render.</span></span>
-   <span data-ttu-id="f2b9c-148">IndexCount — число индексов для отрисовки.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-148">IndexCount - the number of indices to render.</span></span> <span data-ttu-id="f2b9c-149">Номер предоставляется методу [**дравиндексед**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-drawindexed)</span><span class="sxs-lookup"><span data-stu-id="f2b9c-149">The number is supplied to the [**DrawIndexed**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-drawindexed) method</span></span>

<span data-ttu-id="f2b9c-150">Начало буфера индекса = базовый адрес буфера индексов + смещение (в байтах) + Стартиндекслокатион \* ElementSize (байт);</span><span class="sxs-lookup"><span data-stu-id="f2b9c-150">Start of Index Buffer = Index Buffer Base Address + Offset (bytes) + StartIndexLocation \* ElementSize (bytes);</span></span>

<span data-ttu-id="f2b9c-151">В этом расчете ElementSize — это размер каждого элемента буфера индексов, представляющий собой два или четыре байта.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-151">In this calculation, ElementSize is the size of each index buffer element, which is either two or four bytes.</span></span>

<span data-ttu-id="f2b9c-152">Чтобы создать буфер индекса, вызовите метод [**ID3D11Device:: CreateBuffer**](/windows/desktop/api/D3D11/nf-d3d11-id3d11device-createbuffer).</span><span class="sxs-lookup"><span data-stu-id="f2b9c-152">To create an index buffer, call [**ID3D11Device::CreateBuffer**](/windows/desktop/api/D3D11/nf-d3d11-id3d11device-createbuffer).</span></span>

### <a name="constant-buffer"></a><span data-ttu-id="f2b9c-153">Буфер констант</span><span class="sxs-lookup"><span data-stu-id="f2b9c-153">Constant Buffer</span></span>

<span data-ttu-id="f2b9c-154">Буфер констант позволяет эффективно поставлять данные констант шейдера в конвейер.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-154">A constant buffer allows you to efficiently supply shader constants data to the pipeline.</span></span> <span data-ttu-id="f2b9c-155">Буфер констант можно использовать для хранения результатов этапа вывода потока.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-155">You can use a constant buffer to store the results of the stream-output stage.</span></span> <span data-ttu-id="f2b9c-156">Концептуально буфер констант аналогичен одноэлементному буферу вершин, что показано на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-156">Conceptually, a constant buffer looks just like a single-element vertex buffer, as shown in the following illustration.</span></span>

![иллюстрация буфера констант шейдера](images/d3d10-shader-resource-buffer.png)

<span data-ttu-id="f2b9c-158">Каждый элемент хранит определяемую форматом данных константу с числом компонентов от 1 до 4.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-158">Each element stores a 1-to-4 component constant, determined by the format of the data stored.</span></span> <span data-ttu-id="f2b9c-159">Чтобы создать буфер шейдера, вызовите [**ID3D11Device:: CreateBuffer**](/windows/desktop/api/D3D11/nf-d3d11-id3d11device-createbuffer) и укажите элемент **\_ \_ \_ буфера константы D3D11 BIND** в перечислимом типе [**\_ \_ флага D3D11 BIND**](/windows/desktop/api/D3D11/ne-d3d11-d3d11_bind_flag) .</span><span class="sxs-lookup"><span data-stu-id="f2b9c-159">To create a shader-constant buffer, call [**ID3D11Device::CreateBuffer**](/windows/desktop/api/D3D11/nf-d3d11-id3d11device-createbuffer) and specify the **D3D11\_BIND\_CONSTANT\_BUFFER** member of the [**D3D11\_BIND\_FLAG**](/windows/desktop/api/D3D11/ne-d3d11-d3d11_bind_flag) enumerated type.</span></span>

<span data-ttu-id="f2b9c-160">Буфер константы может использовать только один флаг привязки (**D3D11- \_ \_ \_ буфер константы привязки**), который нельзя сочетать с другими флагами привязки.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-160">A constant buffer can only use a single bind flag (**D3D11\_BIND\_CONSTANT\_BUFFER**), which cannot be combined with any other bind flag.</span></span> <span data-ttu-id="f2b9c-161">Чтобы привязать буфер шейдера к конвейеру, вызовите один из следующих методов: [**ссылку ID3D11DeviceContext:: гссетконстантбуфферс**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-gssetconstantbuffers), [**ссылку ID3D11DeviceContext::P ссетконстантбуфферс**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-pssetconstantbuffers)или [**ссылку ID3D11DeviceContext:: вссетконстантбуфферс**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-vssetconstantbuffers).</span><span class="sxs-lookup"><span data-stu-id="f2b9c-161">To bind a shader-constant buffer to the pipeline, call one of the following methods: [**ID3D11DeviceContext::GSSetConstantBuffers**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-gssetconstantbuffers), [**ID3D11DeviceContext::PSSetConstantBuffers**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-pssetconstantbuffers), or [**ID3D11DeviceContext::VSSetConstantBuffers**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-vssetconstantbuffers).</span></span>

<span data-ttu-id="f2b9c-162">Для считывания буфера констант шейдера из шейдера используйте функцию загрузки HLSL (например, [**Load**](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-to-load)).</span><span class="sxs-lookup"><span data-stu-id="f2b9c-162">To read a shader-constant buffer from a shader, use a HLSL load function (for example, [**Load**](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-to-load)).</span></span> <span data-ttu-id="f2b9c-163">На каждом этапе шейдера можно определить до 15 буферов констант шейдера, причем каждый буфер может содержать до 4096 констант.</span><span class="sxs-lookup"><span data-stu-id="f2b9c-163">Each shader stage allows up to 15 shader-constant buffers; each buffer can hold up to 4096 constants.</span></span>

## <a name="related-topics"></a><span data-ttu-id="f2b9c-164">См. также</span><span class="sxs-lookup"><span data-stu-id="f2b9c-164">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f2b9c-165">Buffers</span><span class="sxs-lookup"><span data-stu-id="f2b9c-165">Buffers</span></span>](overviews-direct3d-11-resources-buffers.md)
</dt> </dl>

 

 