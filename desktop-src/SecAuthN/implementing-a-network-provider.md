---
description: Поставщик сети — это библиотека DLL, которая позволяет операционной системе Windows поддерживать конкретный сетевой протокол.
ms.assetid: 21dfa941-72fd-4f2c-8bc4-379ed6ca2a4c
title: Реализация поставщика сети
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 97819b033c57feb25cf882f97051785123e2e382
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104143738"
---
# <a name="implementing-a-network-provider"></a><span data-ttu-id="22a85-103">Реализация поставщика сети</span><span class="sxs-lookup"><span data-stu-id="22a85-103">Implementing a Network Provider</span></span>

<span data-ttu-id="22a85-104">Поставщик сети — это библиотека DLL, которая позволяет операционной системе Windows поддерживать конкретный сетевой протокол.</span><span class="sxs-lookup"><span data-stu-id="22a85-104">A network provider is a DLL that enables the Windows operating system to support a specific network protocol.</span></span> <span data-ttu-id="22a85-105">Это достигается путем реализации API поставщика сети.</span><span class="sxs-lookup"><span data-stu-id="22a85-105">It does this by implementing the Network Provider API.</span></span> <span data-ttu-id="22a85-106">Этот API представляет собой набор функций, которые вызывают [*маршрутизаторы нескольких поставщиков*](../secgloss/m-gly.md) (многопротокольные вызовы) для взаимодействия с сетью.</span><span class="sxs-lookup"><span data-stu-id="22a85-106">This API is a set of functions the [*Multiple Provider Router*](../secgloss/m-gly.md) (MPR) calls to communicate with the network.</span></span> <span data-ttu-id="22a85-107">Затем поставщик сети преобразует эти вызовы в вызовы API для конкретного сетевого интерфейса, чтобы выполнить действие, заданное многопротокольным маршрутизатором.</span><span class="sxs-lookup"><span data-stu-id="22a85-107">The network provider then translates these calls into network-specific API calls to perform the action specified by the MPR.</span></span> <span data-ttu-id="22a85-108">Таким образом, операционная система Windows может взаимодействовать с новыми сетевыми протоколами без необходимости понимания сетевых интерфейсов API.</span><span class="sxs-lookup"><span data-stu-id="22a85-108">In this way, the Windows operating system can interact with new network protocols without having to understand their network-specific APIs.</span></span>

<span data-ttu-id="22a85-109">Чтобы создать поставщик сети, напишите библиотеку DLL, которая экспортирует функцию [**нпжеткапс**](/windows/desktop/api/Npapi/nf-npapi-npgetcaps) .</span><span class="sxs-lookup"><span data-stu-id="22a85-109">To create a network provider, write a DLL that exports the [**NPGetCaps**](/windows/desktop/api/Npapi/nf-npapi-npgetcaps) function.</span></span>

<span data-ttu-id="22a85-110">Поддержка других функций в API поставщика сети является необязательной.</span><span class="sxs-lookup"><span data-stu-id="22a85-110">Support of the other functions in the Network Provider API is optional.</span></span> <span data-ttu-id="22a85-111">Если поставщику сети не требуется функция, Библиотека DLL не должна реализовывать ее или предоставлять реализацию заглушки.</span><span class="sxs-lookup"><span data-stu-id="22a85-111">If your network provider does not require a function, your DLL does not need to implement it or provide a stub implementation.</span></span> <span data-ttu-id="22a85-112">Дополнительные сведения см. в разделах по отдельным функциям в разделе [функции поставщика сети](authentication-functions.md).</span><span class="sxs-lookup"><span data-stu-id="22a85-112">For more information, see the individual function topics in [Network Provider Functions](authentication-functions.md).</span></span>

<span data-ttu-id="22a85-113">Исключением является то, что если поддерживается одна из следующих функций перечисления, необходимо также поддерживать две другие функции: [**нпопененум**](/windows/desktop/api/Npapi/nf-npapi-npopenenum), [**нпенумресаурце**](/windows/desktop/api/Npapi/nf-npapi-npenumresource)и [**нпклосинум**](/windows/desktop/api/Npapi/nf-npapi-npcloseenum).</span><span class="sxs-lookup"><span data-stu-id="22a85-113">The exception is that if you support one of the following enumeration functions, you must support the other two functions as well: [**NPOpenEnum**](/windows/desktop/api/Npapi/nf-npapi-npopenenum), [**NPEnumResource**](/windows/desktop/api/Npapi/nf-npapi-npenumresource), and [**NPCloseEnum**](/windows/desktop/api/Npapi/nf-npapi-npcloseenum).</span></span>

<span data-ttu-id="22a85-114">Следующие рекомендации описывают, как создать поставщик сети, который взаимодействует с многопротокольной и операционной системой Windows.</span><span class="sxs-lookup"><span data-stu-id="22a85-114">The following guidelines describe how to write a network provider that interacts well with the MPR and the Windows operating system.</span></span> <span data-ttu-id="22a85-115">Когда это возможно, поставщик должен соблюдать следующие рекомендации по скорости, проверке и маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="22a85-115">Whenever possible, your provider should adhere to the following guidelines for speed, validation, and routing.</span></span>

## <a name="speed"></a><span data-ttu-id="22a85-116">Speed</span><span class="sxs-lookup"><span data-stu-id="22a85-116">Speed</span></span>

<span data-ttu-id="22a85-117">Поставщик сети должен быстро определить, является ли сетевой ресурс собственным.</span><span class="sxs-lookup"><span data-stu-id="22a85-117">A network provider should quickly determine whether a network resource is its own.</span></span> <span data-ttu-id="22a85-118">Это обусловлено тем, что многопротокольному маршрутизатору может потребоваться циклический перебор нескольких поставщиков для поиска владельца ресурса.</span><span class="sxs-lookup"><span data-stu-id="22a85-118">This is because the MPR may have to cycle through many providers to find the owner of a resource.</span></span>

<span data-ttu-id="22a85-119">Если поставщик сети не владеет ресурсом, он должен сразу же вернуть \_ код состояния WN Bad \_ NETNAME.</span><span class="sxs-lookup"><span data-stu-id="22a85-119">If the network provider does not own the resource, it should immediately return the WN\_BAD\_NETNAME status code.</span></span>

<span data-ttu-id="22a85-120">Также важно, чтобы поставщики, которые поддерживают [**нпжетдиректоритипе**](/windows/desktop/api/Npapi/nf-npapi-npgetdirectorytype) , быстро возвращали результаты для этой функции, так как она вызывается, когда винфиле вырисовывает дерево каталогов.</span><span class="sxs-lookup"><span data-stu-id="22a85-120">It is also important that providers that support [**NPGetDirectoryType**](/windows/desktop/api/Npapi/nf-npapi-npgetdirectorytype) return results for this function quickly because it is called while WinFile is painting the directory tree.</span></span>

## <a name="validation"></a><span data-ttu-id="22a85-121">Проверка</span><span class="sxs-lookup"><span data-stu-id="22a85-121">Validation</span></span>

<span data-ttu-id="22a85-122">Порядок проверки важен.</span><span class="sxs-lookup"><span data-stu-id="22a85-122">The order of validation is important.</span></span> <span data-ttu-id="22a85-123">Поставщик сети должен сначала определить, запущена ли его сеть, а затем определить, поддерживает ли сеть и сетевой поставщик операцию.</span><span class="sxs-lookup"><span data-stu-id="22a85-123">A network provider should first determine whether its network is started and then determine whether the network and network provider support the operation.</span></span> <span data-ttu-id="22a85-124">Если после выполнения этих проверок поставщик сети получает сетевые ресурсы, он должен определить, владеет ли он.</span><span class="sxs-lookup"><span data-stu-id="22a85-124">If, after these checks, the network provider receives any network resources, it should determine whether it owns them.</span></span> <span data-ttu-id="22a85-125">Наконец, он должен проверить другие параметры.</span><span class="sxs-lookup"><span data-stu-id="22a85-125">Finally, it should validate other parameters.</span></span>

## <a name="routing"></a><span data-ttu-id="22a85-126">Маршрутизация</span><span class="sxs-lookup"><span data-stu-id="22a85-126">Routing</span></span>

<span data-ttu-id="22a85-127">Если многопротокольный маршрутизатор должен циклически проходить через поставщиков сети, он попытается использовать всех поставщиков, пока один из них не примет вызов.</span><span class="sxs-lookup"><span data-stu-id="22a85-127">If the MPR has to cycle through network providers, it will try all providers until one accepts the call.</span></span> <span data-ttu-id="22a85-128">Иными словами, многопротокольный маршрутизатор всегда пытается найти поставщика сети.</span><span class="sxs-lookup"><span data-stu-id="22a85-128">In other words, the MPR always continues to try to find a network provider.</span></span>

<span data-ttu-id="22a85-129">Однако он запишите первую значительную ошибку, сообщаемую поставщиком.</span><span class="sxs-lookup"><span data-stu-id="22a85-129">It does, however, take note of the first significant error reported by a provider.</span></span> <span data-ttu-id="22a85-130">Ошибки, такие как ошибка \_ Bad \_ НЕТПАС, ошибка \_ Bad \_ net \_ Name, ошибка \_ Недопустимый \_ параметр, \_ Недопустимый уровень, \_ считаются несущественными, так как они просто означают, что поставщик не управляет ресурсом.</span><span class="sxs-lookup"><span data-stu-id="22a85-130">Errors such as ERROR\_BAD\_NETPATH, ERROR\_BAD\_NET\_NAME, ERROR\_INVALID\_PARAMETER, ERROR\_INVALID\_LEVEL are considered insignificant because they simply mean that the provider does not manage the resource.</span></span> <span data-ttu-id="22a85-131">Тем не менее, если поставщик завершается ошибкой с ошибкой \_ Недопустимый пароль или произошла какая-либо \_ другая существенная ошибка, то он записывает эту ошибку и возобновляет работу через поставщиков сети.</span><span class="sxs-lookup"><span data-stu-id="22a85-131">However, if the provider fails with the error ERROR\_INVALID\_PASSWORD or some other significant error, MPR records this error and continues cycling through the network providers.</span></span> <span data-ttu-id="22a85-132">В общем случае при маршрутизации, если поставщик не принимает вызов, многопротокольный маршрутизатор сообщает о первой важной ошибке, обнаруженной при переборе поставщиков сети.</span><span class="sxs-lookup"><span data-stu-id="22a85-132">In general, when routing, if no provider accepts the call, the MPR reports the first significant error it encounters while cycling through the network providers.</span></span>

<span data-ttu-id="22a85-133">Поставщику сети следует использовать такое поведение многопротокольного поставщика при выборе возвращаемого сообщения об ошибке.</span><span class="sxs-lookup"><span data-stu-id="22a85-133">Your network provider should take this behavior of the MPR into account when deciding what error message to return.</span></span>

## <a name="implementation-note"></a><span data-ttu-id="22a85-134">Примечание о реализации</span><span class="sxs-lookup"><span data-stu-id="22a85-134">Implementation note</span></span>

<span data-ttu-id="22a85-135">При реализации библиотеки DLL поставщика сети поставщик не должен вызывать другие [сетевые функции Windows](../wnet/windows-networking-functions.md), [API оболочки](../shell/samples-usingthumbnailproviders.md)или другие запросы на основе пути UNC, которые могут привести к перезаписи в подсистему MPR.</span><span class="sxs-lookup"><span data-stu-id="22a85-135">When implementing Network Provider DLL’s, the provider must not call into other [Windows Networking Functions](../wnet/windows-networking-functions.md), [Shell APIs](../shell/samples-usingthumbnailproviders.md), or other UNC path-based queries that could cause reentry into the MPR subsystem.</span></span> <span data-ttu-id="22a85-136">Если вы выполняете такие вызовы из библиотеки DLL поставщика сети, приложение или другие компоненты операционной системы могут столкнуться с состязаниями, низкой производительностью или взаимоблокировками внутри подсистемы MPR.</span><span class="sxs-lookup"><span data-stu-id="22a85-136">If you make such calls from a Network Provider DLL, the application, or other operating system components may experience contention, poor performance, or deadlocks inside the MPR subsystem.</span></span>

 

 
