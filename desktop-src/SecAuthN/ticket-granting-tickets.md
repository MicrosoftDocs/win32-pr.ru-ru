---
description: По мере первоначальной разработки протокола Kerberos главный ключ пользователя был получен на основе пароля, предоставленного пользователем.
ms.assetid: b8fcb68d-751e-4495-ab92-8b70c96aaa7a
title: Ticket-Grantingные билеты
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 39dff161ba2d905f676fe6b6b5e7e7d5289ee550
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104145247"
---
# <a name="ticket-granting-tickets"></a><span data-ttu-id="073e0-103">Ticket-Grantingные билеты</span><span class="sxs-lookup"><span data-stu-id="073e0-103">Ticket-Granting Tickets</span></span>

<span data-ttu-id="073e0-104">По мере первоначальной разработки [*протокола Kerberos*](../secgloss/k-gly.md) главный ключ пользователя был получен на основе пароля, предоставленного пользователем.</span><span class="sxs-lookup"><span data-stu-id="073e0-104">As the [*Kerberos protocol*](../secgloss/k-gly.md) was originally designed, a master key for a user was derived from a password provided by the user.</span></span> <span data-ttu-id="073e0-105">Когда пользователь вошел в систему, клиент Kerberos на рабочей станции пользователя принимает пароль от пользователя и преобразует его в ключ шифрования путем передачи текста с помощью односторонней [*хэш-*](../secgloss/h-gly.md) функции.</span><span class="sxs-lookup"><span data-stu-id="073e0-105">When a user logged on, the Kerberos client on the user's workstation accepted the password from the user and converted it into an encryption key by passing the text through a one-way [*hash*](../secgloss/h-gly.md) function.</span></span> <span data-ttu-id="073e0-106">Полученный хэш-код был [*главным ключом*](../secgloss/m-gly.md)пользователя.</span><span class="sxs-lookup"><span data-stu-id="073e0-106">The resulting hash was the user's [*master key*](../secgloss/m-gly.md).</span></span> <span data-ttu-id="073e0-107">Клиент использовал этот *главный ключ* для расшифровки [*ключей сеанса*](../secgloss/s-gly.md) , полученных от KDC.</span><span class="sxs-lookup"><span data-stu-id="073e0-107">The client used this *master key* to decrypt [*session keys*](../secgloss/s-gly.md) received from KDC.</span></span>

<span data-ttu-id="073e0-108">Проблема с первоначальным проектированием Kerberos заключается в том, что клиенту требуется главный ключ пользователя каждый раз при расшифровке ключа сеанса из центра распространения ключей.</span><span class="sxs-lookup"><span data-stu-id="073e0-108">The problem with the original Kerberos design is the client needs the user's master key each time it decrypts a session key from the KDC.</span></span> <span data-ttu-id="073e0-109">Это означает, что клиент должен попросить пользователя указать пароль в начале каждого обмена клиента и сервера, либо клиент должен сохранить ключ пользователя на рабочей станции.</span><span class="sxs-lookup"><span data-stu-id="073e0-109">That means either the client must ask the user for the password at the beginning of every client/server exchange, or the client must store the user's key on the workstation.</span></span> <span data-ttu-id="073e0-110">Частое прерывание работы пользователя слишком агрессивно.</span><span class="sxs-lookup"><span data-stu-id="073e0-110">Frequent interruptions of the user are too intrusive.</span></span> <span data-ttu-id="073e0-111">Хранение ключа на рабочей станции вызывает риск компрометации ключа, полученного на основе пароля пользователя, который является долгосрочным ключом.</span><span class="sxs-lookup"><span data-stu-id="073e0-111">Storing the key on the workstation risks compromising a key derived from the user password which is a long term key.</span></span>

<span data-ttu-id="073e0-112">Решение этой проблемы в протоколе Kerberos заключается в том, что клиент получает временный ключ из центра распространения ключей.</span><span class="sxs-lookup"><span data-stu-id="073e0-112">The Kerberos protocol's solution to this problem is for the client to get a temporary key from the KDC.</span></span> <span data-ttu-id="073e0-113">Этот временный ключ подходит только для этого [*сеанса входа в систему*](../secgloss/l-gly.md).</span><span class="sxs-lookup"><span data-stu-id="073e0-113">This temporary key is good only for this [*logon session*](../secgloss/l-gly.md).</span></span> <span data-ttu-id="073e0-114">Когда пользователь входит в систему, клиент запрашивает билет для KDC так же, как он запрашивает билет для любой другой службы.</span><span class="sxs-lookup"><span data-stu-id="073e0-114">When a user logs on, the client requests a ticket for the KDC just as it would request a ticket for any other service.</span></span> <span data-ttu-id="073e0-115">KDC реагирует на создание ключа сеанса входа и билета для специального сервера, полной службы предоставления билетов KDC.</span><span class="sxs-lookup"><span data-stu-id="073e0-115">The KDC responds by creating a logon session key and a ticket for a special server, the KDC's full ticket-granting service.</span></span> <span data-ttu-id="073e0-116">Одна копия ключа сеанса входа внедряется в билет, а билет шифруется с помощью главного ключа KDC.</span><span class="sxs-lookup"><span data-stu-id="073e0-116">One copy of the logon session key is embedded in the ticket, and the ticket is encrypted with the KDC's master key.</span></span> <span data-ttu-id="073e0-117">Еще одна копия ключа сеанса входа шифруется с помощью главного ключа пользователя, полученного из пароля входа пользователя.</span><span class="sxs-lookup"><span data-stu-id="073e0-117">Another copy of the logon session key is encrypted with the user's master key derived from the user's logon password.</span></span> <span data-ttu-id="073e0-118">Как билет, так и зашифрованный ключ сеанса отправляются клиенту.</span><span class="sxs-lookup"><span data-stu-id="073e0-118">Both the ticket and the encrypted session key are sent to the client.</span></span>

<span data-ttu-id="073e0-119">Когда клиент получает ответ KDC, он расшифровывает ключ сеанса входа с помощью главного ключа пользователя, полученного из пароля пользователя.</span><span class="sxs-lookup"><span data-stu-id="073e0-119">When the client gets the KDC's reply, it decrypts the logon session key with the user's master key derived from the user's password.</span></span> <span data-ttu-id="073e0-120">Клиенту больше не требуется ключ, полученный из пароля пользователя, так как клиент теперь будет использовать ключ сеанса входа для расшифровки его копии любого ключа сеанса сервера, получаемого из центра распространения ключей.</span><span class="sxs-lookup"><span data-stu-id="073e0-120">The client no longer needs the key derived from the user's password because the client will now use the logon session key to decrypt its copy of any server session key it gets from the KDC.</span></span> <span data-ttu-id="073e0-121">Клиент сохраняет ключ сеанса входа в кэш билетов и его билет для полной службы предоставления билетов KDC.</span><span class="sxs-lookup"><span data-stu-id="073e0-121">The client stores the logon session key in its ticket cache along with its ticket for the KDC's full ticket-granting service.</span></span>

<span data-ttu-id="073e0-122">Билет для полной службы предоставления билетов называется билет предоставления билета (TGT).</span><span class="sxs-lookup"><span data-stu-id="073e0-122">The ticket for the full ticket-granting service is called a ticket-granting ticket (TGT).</span></span> <span data-ttu-id="073e0-123">Когда клиент запрашивает у центра распространения ключей запрос на получение билета к серверу, он предоставляет [*учетные данные*](../secgloss/c-gly.md) в виде сообщения средства проверки подлинности и билета — в данном случае TGT — так же, как и учетные данные для любой другой службы.</span><span class="sxs-lookup"><span data-stu-id="073e0-123">When the client asks the KDC for a ticket to a server, it presents [*credentials*](../secgloss/c-gly.md) in the form of an authenticator message and a ticket — in this case a TGT — just as it would present credentials to any other service.</span></span> <span data-ttu-id="073e0-124">Служба предоставления билетов открывает TGT с главным ключом, извлекает ключ сеанса входа для этого клиента и использует ключ сеанса входа для шифрования клиентской версии ключа сеанса для сервера.</span><span class="sxs-lookup"><span data-stu-id="073e0-124">The ticket-granting service opens the TGT with its master key, extracts the logon session key for this client, and uses the logon session key to encrypt the client's copy of a session key for the server.</span></span>

 

 
