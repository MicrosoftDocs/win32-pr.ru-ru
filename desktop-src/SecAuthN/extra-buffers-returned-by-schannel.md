---
description: Schannel имеет четко определенный набор поведений для неполных или избыточных сведений, включаемых в Входные буферы для этих функций.
ms.assetid: 5fad1e76-6520-4ff7-b2b0-2cc2061062a1
title: Дополнительные буферы, возвращаемые SChannel
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5b0c9ce7a468b1b04389ad19f91785b64fb50e74
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105651102"
---
# <a name="extra-buffers-returned-by-schannel"></a>Дополнительные буферы, возвращаемые SChannel

Данные должны передаваться между клиентом и сервером во время установки [*контекста безопасности*](/windows/desktop/SecGloss/s-gly) и последующего выполнения, поскольку защищенные сообщения обмениваются с помощью функций шифрования и расшифровки, предоставляемых SChannel. Для выполнения этих задач используются следующие функции.

-   [**AcceptSecurityContext (Общие)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext)
-   [**InitializeSecurityContext (Общие)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta)
-   [**Декриптмессаже (Общие)**](/windows/win32/api/sspi/nf-sspi-decryptmessage)

Schannel имеет четко определенный набор поведений для неполных или избыточных сведений, включаемых в Входные буферы для этих функций. Обмен данными между клиентом и сервером осуществляется следующим образом:

1.  Локальная сторона взаимодействует с SChannel, вызывая функцию SSPI и передая сведения. Как правило, эта информация была получена от удаленной стороны.
2.  Функция возвращает код состояния и буферы вывода, содержащие сведения.
3.  В зависимости от кода состояния выходные буферы отправляются удаленной стороне с помощью некоторого механизма связи.
4.  Удаленная сторона читает информацию, отправленную местным лицом.
5.  Цикл повторяется, и локальные и удаленные стороны взаимоменяются. (Удаленная сторона вызывает функцию SSPI и передает сведения, считанные на предыдущем шаге.)

Все работает правильно, если входной буфер функции SSPI содержит только необходимые сведения. Однако из-за особенностей потоковой передачи некоторых протоколов связи это может быть не так. блок информации, полученной от удаленной стороны, может содержать меньше данных, чем требуется или больше, чем может обработать канал Schannel в одном вызове функции.

Если входной буфер содержит слишком мало информации, функция возвращает \_ \_ сообщение о неполном отсутствии \_ . Вызывающий объект должен получить дополнительные данные от удаленной стороны и вызвать функцию еще раз.

Если входные буферы содержат слишком много сведений, SChannel не обрабатывает это как ошибку. Функция обрабатывает как можно больше входных данных и возвращает код состояния для этого действия обработки. Кроме того, SChannel указывает на наличие необработанной информации во входных буферах, возвращая выходной буфер типа PVBUFFER " \_ дополнительный". Тестирование буферов вывода для этого типа буфера является единственным способом обнаружения такой ситуации. Поле **кббуффер** в структуре дополнительных буферов показывает, сколько байтов входных данных не было обработано.

> [!Note]  
> Поле **пвбуффер** в лишнем буфере не содержит копии лишних данных.

 

При получении дополнительного буфера из функции SSPI необходимо удалить уже обработанные данные из входного буфера и вызвать функцию снова. Schannel может и часто возвращать только дополнительный буфер, а не все остальные в выходных буферах.

 

 
