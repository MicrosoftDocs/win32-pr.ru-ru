---
description: Контексты потоков обрабатывали защищенные потоковые протоколы, такие как SSL или PCT.
ms.assetid: 05a6b036-1f7f-473f-9813-a1e1534e0f0d
title: Контексты потока
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 53103dc1269c05e5a2c162133d21e167d8035c2c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103991535"
---
# <a name="stream-contexts"></a><span data-ttu-id="a21cf-103">Контексты потока</span><span class="sxs-lookup"><span data-stu-id="a21cf-103">Stream Contexts</span></span>

<span data-ttu-id="a21cf-104">Контексты потоков обрабатывали защищенные потоковые протоколы, такие как SSL или PCT.</span><span class="sxs-lookup"><span data-stu-id="a21cf-104">Stream contexts handle the secure stream-oriented protocols such as SSL or PCT.</span></span> <span data-ttu-id="a21cf-105">В интересах совместного использования одного и того же интерфейса и аналогичного управления учетными данными SSPI обеспечивает поддержку контекстов потоков.</span><span class="sxs-lookup"><span data-stu-id="a21cf-105">In the interest of sharing the same interface and similar credential management, SSPI provides support for stream contexts.</span></span> <span data-ttu-id="a21cf-106">[*Протокол безопасности*](../secgloss/s-gly.md) включает как потоковую схему проверки подлинности, так и форматы записей.</span><span class="sxs-lookup"><span data-stu-id="a21cf-106">The [*security protocol*](../secgloss/s-gly.md) incorporates both the stream authentication scheme and record formats.</span></span>

<span data-ttu-id="a21cf-107">Для обеспечения протоколов, ориентированных на поток, [*пакеты безопасности*](../secgloss/s-gly.md) , поддерживающие контексты потоков, имеют следующие характеристики процесса:</span><span class="sxs-lookup"><span data-stu-id="a21cf-107">To provide stream-oriented protocols, [*security packages*](../secgloss/s-gly.md) that support stream contexts have the following process characteristics:</span></span>

-   <span data-ttu-id="a21cf-108">Пакет устанавливает \_ флаг потока флага SECPKG, \_ чтобы указать, что он поддерживает семантику потока.</span><span class="sxs-lookup"><span data-stu-id="a21cf-108">The package sets the SECPKG\_FLAG\_STREAM flag to indicate that it supports stream semantics.</span></span>
-   <span data-ttu-id="a21cf-109">Транспортные приложения запрашивают семантику потока, устанавливая в \_ \_ \_ \_ вызовах функций [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) и [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) флаги "поток требований" ISC "и" ASC req Stream ".</span><span class="sxs-lookup"><span data-stu-id="a21cf-109">Transport applications requests stream semantics by setting the ISC\_REQ\_STREAM and ASC\_REQ\_STREAM flags in the calls to the [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) and [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) functions.</span></span>
-   <span data-ttu-id="a21cf-110">Приложение вызывает функцию [**QueryContextAttributes (General)**](/windows/win32/api/sspi/nf-sspi-querycontextattributesa) с структурой [**секпкгконтекст \_ стреамсизес**](/windows/desktop/api/Sspi/ns-sspi-secpkgcontext_streamsizes) , чтобы запросить [*контекст безопасности*](../secgloss/s-gly.md) о количестве предоставляемых буферов и размерах, резервируемых для заголовков или трейлеров.</span><span class="sxs-lookup"><span data-stu-id="a21cf-110">The application calls the [**QueryContextAttributes (General)**](/windows/win32/api/sspi/nf-sspi-querycontextattributesa) function with a [**SecPkgContext\_StreamSizes**](/windows/desktop/api/Sspi/ns-sspi-secpkgcontext_streamsizes) structure to query the [*security context*](../secgloss/s-gly.md) for the number of buffers to provide and the sizes to reserve for headers or trailers.</span></span>
-   <span data-ttu-id="a21cf-111">Приложение предоставляет дескрипторы буфера для резервирования во время фактической обработки данных.</span><span class="sxs-lookup"><span data-stu-id="a21cf-111">The application provides buffer descriptors to spare during the actual processing of the data.</span></span> <span data-ttu-id="a21cf-112">Указывая семантику потока, вызывающий объект указывает готовность выполнить лишнюю обработку, чтобы [*пакет безопасности*](../secgloss/s-gly.md) мог обработать блокировку сообщений.</span><span class="sxs-lookup"><span data-stu-id="a21cf-112">By specifying stream semantics, the caller indicates willingness to do extra processing so that the [*security package*](../secgloss/s-gly.md) can handle the blocking of the messages.</span></span> <span data-ttu-id="a21cf-113">По сути, для функций [**макесигнатуре**](/windows/desktop/api/Sspi/nf-sspi-makesignature) и [**VerifySignature**](/windows/desktop/api/Sspi/nf-sspi-verifysignature) вызывающий объект передает список буферов.</span><span class="sxs-lookup"><span data-stu-id="a21cf-113">In essence, for the [**MakeSignature**](/windows/desktop/api/Sspi/nf-sspi-makesignature) and [**VerifySignature**](/windows/desktop/api/Sspi/nf-sspi-verifysignature) functions, the caller passes in a list of buffers.</span></span> <span data-ttu-id="a21cf-114">Когда сообщение получено из канала, ориентированного на поток (например, TCP-порт), вызывающий объект передает список буферов следующим образом.</span><span class="sxs-lookup"><span data-stu-id="a21cf-114">When a message is received from a channel that is stream-oriented (such as a TCP port), the caller passes in a buffer list as follows.</span></span>

    | <span data-ttu-id="a21cf-115">Буфер</span><span class="sxs-lookup"><span data-stu-id="a21cf-115">Buffer</span></span> | <span data-ttu-id="a21cf-116">Длина</span><span class="sxs-lookup"><span data-stu-id="a21cf-116">Length</span></span>         | <span data-ttu-id="a21cf-117">Тип буфера</span><span class="sxs-lookup"><span data-stu-id="a21cf-117">Buffer type</span></span>      |
    |--------|----------------|------------------|
    | <span data-ttu-id="a21cf-118">1</span><span class="sxs-lookup"><span data-stu-id="a21cf-118">1</span></span>      | <span data-ttu-id="a21cf-119">Длина сообщения</span><span class="sxs-lookup"><span data-stu-id="a21cf-119">Message Length</span></span> | <span data-ttu-id="a21cf-120">\_данные pvbuffer</span><span class="sxs-lookup"><span data-stu-id="a21cf-120">SECBUFFER\_DATA</span></span>  |
    | <span data-ttu-id="a21cf-121">2</span><span class="sxs-lookup"><span data-stu-id="a21cf-121">2</span></span>      | <span data-ttu-id="a21cf-122">0</span><span class="sxs-lookup"><span data-stu-id="a21cf-122">0</span></span>              | <span data-ttu-id="a21cf-123">PVBUFFER \_ пусто</span><span class="sxs-lookup"><span data-stu-id="a21cf-123">SECBUFFER\_EMPTY</span></span> |
    | <span data-ttu-id="a21cf-124">3</span><span class="sxs-lookup"><span data-stu-id="a21cf-124">3</span></span>      | <span data-ttu-id="a21cf-125">0</span><span class="sxs-lookup"><span data-stu-id="a21cf-125">0</span></span>              | <span data-ttu-id="a21cf-126">PVBUFFER \_ пусто</span><span class="sxs-lookup"><span data-stu-id="a21cf-126">SECBUFFER\_EMPTY</span></span> |
    | <span data-ttu-id="a21cf-127">4</span><span class="sxs-lookup"><span data-stu-id="a21cf-127">4</span></span>      | <span data-ttu-id="a21cf-128">0</span><span class="sxs-lookup"><span data-stu-id="a21cf-128">0</span></span>              | <span data-ttu-id="a21cf-129">PVBUFFER \_ пусто</span><span class="sxs-lookup"><span data-stu-id="a21cf-129">SECBUFFER\_EMPTY</span></span> |
    | <span data-ttu-id="a21cf-130">5</span><span class="sxs-lookup"><span data-stu-id="a21cf-130">5</span></span>      | <span data-ttu-id="a21cf-131">0</span><span class="sxs-lookup"><span data-stu-id="a21cf-131">0</span></span>              | <span data-ttu-id="a21cf-132">PVBUFFER \_ пусто</span><span class="sxs-lookup"><span data-stu-id="a21cf-132">SECBUFFER\_EMPTY</span></span> |

    

     

    <span data-ttu-id="a21cf-133">Затем пакет безопасности работает с большим [*двоичным объектом*](../secgloss/b-gly.md).</span><span class="sxs-lookup"><span data-stu-id="a21cf-133">The security package then works on the [*BLOB*](../secgloss/b-gly.md).</span></span> <span data-ttu-id="a21cf-134">Если функция возвращается успешно, буферный список выглядит следующим образом.</span><span class="sxs-lookup"><span data-stu-id="a21cf-134">If the function returns successfully, the buffer list looks like the following.</span></span>

    

    | <span data-ttu-id="a21cf-135">Буфер</span><span class="sxs-lookup"><span data-stu-id="a21cf-135">Buffer</span></span> | <span data-ttu-id="a21cf-136">Длина</span><span class="sxs-lookup"><span data-stu-id="a21cf-136">Length</span></span>         | <span data-ttu-id="a21cf-137">Тип буфера</span><span class="sxs-lookup"><span data-stu-id="a21cf-137">Buffer type</span></span>                |
    |--------|----------------|----------------------------|
    | <span data-ttu-id="a21cf-138">1</span><span class="sxs-lookup"><span data-stu-id="a21cf-138">1</span></span>      | <span data-ttu-id="a21cf-139">Длина заголовка</span><span class="sxs-lookup"><span data-stu-id="a21cf-139">Header Length</span></span>  | <span data-ttu-id="a21cf-140">\_заголовок потока \_ pvbuffer</span><span class="sxs-lookup"><span data-stu-id="a21cf-140">SECBUFFER\_STREAM\_HEADER</span></span>  |
    | <span data-ttu-id="a21cf-141">2</span><span class="sxs-lookup"><span data-stu-id="a21cf-141">2</span></span>      | <span data-ttu-id="a21cf-142">Длина данных</span><span class="sxs-lookup"><span data-stu-id="a21cf-142">Data Length</span></span>    | <span data-ttu-id="a21cf-143">\_данные pvbuffer</span><span class="sxs-lookup"><span data-stu-id="a21cf-143">SECBUFFER\_DATA</span></span>            |
    | <span data-ttu-id="a21cf-144">3</span><span class="sxs-lookup"><span data-stu-id="a21cf-144">3</span></span>      | <span data-ttu-id="a21cf-145">Длина трейлера</span><span class="sxs-lookup"><span data-stu-id="a21cf-145">Trailer Length</span></span> | <span data-ttu-id="a21cf-146">\_трейлер потока \_ pvbuffer</span><span class="sxs-lookup"><span data-stu-id="a21cf-146">SECBUFFER\_STREAM\_TRAILER</span></span> |
    | <span data-ttu-id="a21cf-147">4</span><span class="sxs-lookup"><span data-stu-id="a21cf-147">4</span></span>      | <span data-ttu-id="a21cf-148">0</span><span class="sxs-lookup"><span data-stu-id="a21cf-148">0</span></span>              | <span data-ttu-id="a21cf-149">PVBUFFER \_ пусто</span><span class="sxs-lookup"><span data-stu-id="a21cf-149">SECBUFFER\_EMPTY</span></span>           |
    | <span data-ttu-id="a21cf-150">5</span><span class="sxs-lookup"><span data-stu-id="a21cf-150">5</span></span>      | <span data-ttu-id="a21cf-151">0</span><span class="sxs-lookup"><span data-stu-id="a21cf-151">0</span></span>              | <span data-ttu-id="a21cf-152">PVBUFFER \_ пусто</span><span class="sxs-lookup"><span data-stu-id="a21cf-152">SECBUFFER\_EMPTY</span></span>           |

    

     

    <span data-ttu-id="a21cf-153">Пакет мог бы также вернуть буфер \# 4 с длиной x и типом буфера pvbuffer \_ , что означает, что данные в этом буфере являются частью следующей записи и еще не были обработаны.</span><span class="sxs-lookup"><span data-stu-id="a21cf-153">The package could have also returned buffer \#4 with length x and buffer type SECBUFFER\_EXTRA indicating that the data in this buffer is part of the next record and has not yet been processed.</span></span> <span data-ttu-id="a21cf-154">И наоборот, если функция Message возвращает \_ \_ код ошибки незавершенного сообщения sec E \_ , возвращенный буфер будет выглядеть следующим образом.</span><span class="sxs-lookup"><span data-stu-id="a21cf-154">Conversely, if the message function returns the SEC\_E\_INCOMPLETE\_MESSAGE error code, the returned buffer list would look like the following.</span></span>

    

    | <span data-ttu-id="a21cf-155">Буфер</span><span class="sxs-lookup"><span data-stu-id="a21cf-155">Buffer</span></span> | <span data-ttu-id="a21cf-156">Длина</span><span class="sxs-lookup"><span data-stu-id="a21cf-156">Length</span></span> | <span data-ttu-id="a21cf-157">Тип буфера</span><span class="sxs-lookup"><span data-stu-id="a21cf-157">Buffer type</span></span>        |
    |--------|--------|--------------------|
    | <span data-ttu-id="a21cf-158">1</span><span class="sxs-lookup"><span data-stu-id="a21cf-158">1</span></span>      | <span data-ttu-id="a21cf-159">x</span><span class="sxs-lookup"><span data-stu-id="a21cf-159">x</span></span>      | <span data-ttu-id="a21cf-160">\_отсутствует pvbuffer</span><span class="sxs-lookup"><span data-stu-id="a21cf-160">SECBUFFER\_MISSING</span></span> |

    

     

    <span data-ttu-id="a21cf-161">Это означает, что для обработки записи потребовались дополнительные данные.</span><span class="sxs-lookup"><span data-stu-id="a21cf-161">This indicates that more data was needed to process the record.</span></span> <span data-ttu-id="a21cf-162">В отличие от большинства ошибок, возвращаемых функцией Message, этот тип буфера не указывает на то, что контекст был скомпрометирован.</span><span class="sxs-lookup"><span data-stu-id="a21cf-162">Unlike most errors returned from a message function, this buffer type does not indicate that the context has been compromised.</span></span> <span data-ttu-id="a21cf-163">Вместо этого он указывает, что требуются дополнительные данные.</span><span class="sxs-lookup"><span data-stu-id="a21cf-163">Instead, it indicates that more data is needed.</span></span> <span data-ttu-id="a21cf-164">[*пакеты безопасности*](../secgloss/s-gly.md) не должны обновлять свое [*состояние*](../secgloss/s-gly.md) в этом состоянии.</span><span class="sxs-lookup"><span data-stu-id="a21cf-164">[*security packages*](../secgloss/s-gly.md) must not update their [*state*](../secgloss/s-gly.md) in this condition.</span></span>

    <span data-ttu-id="a21cf-165">Аналогично, на стороне отправителя взаимодействия вызывающий объект может вызвать функцию [**макесигнатуре**](/windows/desktop/api/Sspi/nf-sspi-makesignature) .</span><span class="sxs-lookup"><span data-stu-id="a21cf-165">Similarly, on the sender side of the communication, the caller can call the [**MakeSignature**](/windows/desktop/api/Sspi/nf-sspi-makesignature) function.</span></span> <span data-ttu-id="a21cf-166">Возможно, для пакета безопасности потребуется перераспределить буфер или выполнить операции копирования.</span><span class="sxs-lookup"><span data-stu-id="a21cf-166">The security package may need to reallocate the buffer or copy things around.</span></span> <span data-ttu-id="a21cf-167">Вызывающий объект может быть более эффективным, предоставляя список буферов следующим образом.</span><span class="sxs-lookup"><span data-stu-id="a21cf-167">The caller can be more efficient by providing a buffer list as follows.</span></span>

    

    | <span data-ttu-id="a21cf-168">Буфер</span><span class="sxs-lookup"><span data-stu-id="a21cf-168">Buffer</span></span> | <span data-ttu-id="a21cf-169">Длина</span><span class="sxs-lookup"><span data-stu-id="a21cf-169">Length</span></span>         | <span data-ttu-id="a21cf-170">Тип</span><span class="sxs-lookup"><span data-stu-id="a21cf-170">Type</span></span>                       |
    |--------|----------------|----------------------------|
    | <span data-ttu-id="a21cf-171">1</span><span class="sxs-lookup"><span data-stu-id="a21cf-171">1</span></span>      | <span data-ttu-id="a21cf-172">Длина заголовка</span><span class="sxs-lookup"><span data-stu-id="a21cf-172">Header Length</span></span>  | <span data-ttu-id="a21cf-173">\_заголовок потока \_ pvbuffer</span><span class="sxs-lookup"><span data-stu-id="a21cf-173">SECBUFFER\_STREAM\_HEADER</span></span>  |
    | <span data-ttu-id="a21cf-174">2</span><span class="sxs-lookup"><span data-stu-id="a21cf-174">2</span></span>      | <span data-ttu-id="a21cf-175">Длина данных</span><span class="sxs-lookup"><span data-stu-id="a21cf-175">Data Length</span></span>    | <span data-ttu-id="a21cf-176">\_данные pvbuffer</span><span class="sxs-lookup"><span data-stu-id="a21cf-176">SECBUFFER\_DATA</span></span>            |
    | <span data-ttu-id="a21cf-177">3</span><span class="sxs-lookup"><span data-stu-id="a21cf-177">3</span></span>      | <span data-ttu-id="a21cf-178">Длина трейлера</span><span class="sxs-lookup"><span data-stu-id="a21cf-178">Trailer Length</span></span> | <span data-ttu-id="a21cf-179">\_трейлер потока \_ pvbuffer</span><span class="sxs-lookup"><span data-stu-id="a21cf-179">SECBUFFER\_STREAM\_TRAILER</span></span> |

    

     

    <span data-ttu-id="a21cf-180">Это позволяет вызывающему объекту более эффективно использовать буферы.</span><span class="sxs-lookup"><span data-stu-id="a21cf-180">This allows the caller to use the buffers more efficiently.</span></span> <span data-ttu-id="a21cf-181">Вызвав функцию [**QueryContextAttributes**](/windows/win32/api/sspi/nf-sspi-querycontextattributesa) , чтобы определить объем пространства, которое необходимо зарезервировать перед вызовом [**макесигнатуре**](/windows/desktop/api/Sspi/nf-sspi-makesignature), операция более эффективна для приложения и пакета безопасности.</span><span class="sxs-lookup"><span data-stu-id="a21cf-181">By calling the [**QueryContextAttributes**](/windows/win32/api/sspi/nf-sspi-querycontextattributesa) function to determine the amount of space to reserve before calling [**MakeSignature**](/windows/desktop/api/Sspi/nf-sspi-makesignature), the operation is more efficient for the application and the security package.</span></span>

 

 
