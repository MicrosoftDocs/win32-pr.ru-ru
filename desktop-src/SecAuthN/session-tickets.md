---
description: Вместо отправки зашифрованных ключей сеанса обоим участникам, KDC отправляет клиенту и серверу клиентские и серверные ключи сеанса.
ms.assetid: 6b20ab30-2cd9-4f2e-a26b-316980c4bc78
title: Билеты сеансов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 762223311dd71f8bded5e021372d3a281f711eda
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105663016"
---
# <a name="session-tickets"></a><span data-ttu-id="272be-103">Билеты сеансов</span><span class="sxs-lookup"><span data-stu-id="272be-103">Session Tickets</span></span>

<span data-ttu-id="272be-104">Вместо отправки зашифрованных ключей сеанса обоим участникам, [KDC](key-distribution-center.md) отправляет клиенту и серверу клиентские и серверные ключи [*сеанса*](../secgloss/s-gly.md) .</span><span class="sxs-lookup"><span data-stu-id="272be-104">Instead of sending the encrypted session keys to both of the principals, the [KDC](key-distribution-center.md) sends both the client's and the server's copies of the [*session key*](../secgloss/s-gly.md) to the client.</span></span> <span data-ttu-id="272be-105">Копия ключа сеанса клиента шифруется с помощью [*главного ключа*](../secgloss/m-gly.md) клиента и поэтому не может быть расшифрована любой другой сущностью.</span><span class="sxs-lookup"><span data-stu-id="272be-105">The client's copy of the session key is encrypted with the client's [*master key*](../secgloss/m-gly.md) and therefore cannot be decrypted by any other entity.</span></span> <span data-ttu-id="272be-106">Копия ключа сеанса сервера внедряется вместе с данными авторизации о клиенте в структуре данных, именуемой билетом.</span><span class="sxs-lookup"><span data-stu-id="272be-106">The server's copy of the session key is embedded, along with authorization data about the client, in a data structure called a ticket.</span></span> <span data-ttu-id="272be-107">Билет полностью шифруется с помощью главного ключа сервера и поэтому не может быть прочитан или изменен клиентом или любой другой сущностью, не имеющей доступа к главному ключу сервера.</span><span class="sxs-lookup"><span data-stu-id="272be-107">The ticket is entirely encrypted with the server's master key and therefore cannot be read or changed by the client or any other entity that does not have access to the server's master key.</span></span> <span data-ttu-id="272be-108">Клиент должен безопасно хранить билет до обращения к серверу.</span><span class="sxs-lookup"><span data-stu-id="272be-108">It is the responsibility of the client to store the ticket safely until contact with the server.</span></span>

> [!Note]  
> <span data-ttu-id="272be-109">KDC предоставляет только службу предоставления билетов.</span><span class="sxs-lookup"><span data-stu-id="272be-109">The KDC only provides a ticket-granting service.</span></span> <span data-ttu-id="272be-110">Клиент и сервер отвечают за поддержание безопасности соответствующих главных ключей.</span><span class="sxs-lookup"><span data-stu-id="272be-110">The client and server are responsible for keeping their respective master keys secure.</span></span>

 

<span data-ttu-id="272be-111">Когда клиент получает ответ KDC, он извлекает билет и собственную копию ключа сеанса, помещая ее в безопасный кэш.</span><span class="sxs-lookup"><span data-stu-id="272be-111">When the client receives the KDC's response, it extracts the ticket and its own copy of the session key, putting both aside in a secure cache.</span></span> <span data-ttu-id="272be-112">Чтобы установить безопасный сеанс с сервером, он отправляет серверу сообщение, состоящее из билета, по-прежнему зашифрованного с помощью главного ключа сервера, и [сообщение средства проверки подлинности](authenticator-messages.md) , зашифрованное с помощью ключа сеанса.</span><span class="sxs-lookup"><span data-stu-id="272be-112">To establish a secure session with the server, it sends the server a message consisting of the ticket, still encrypted with the server's master key, and an [authenticator message](authenticator-messages.md) encrypted with the session key.</span></span> <span data-ttu-id="272be-113">В совокупности сообщение с билетом и средством проверки подлинности — это [*учетные данные*](../secgloss/c-gly.md) клиента на сервере.</span><span class="sxs-lookup"><span data-stu-id="272be-113">Together, the ticket and authenticator message are the client's [*credentials*](../secgloss/c-gly.md) to the server.</span></span>

<span data-ttu-id="272be-114">Когда сервер получает учетные данные от клиента, он расшифровывает билет с помощью его [*главного ключа*](../secgloss/m-gly.md), извлекает [*ключ сеанса*](../secgloss/s-gly.md)и использует сеансовый ключ для расшифровки сообщения средства проверки подлинности клиента.</span><span class="sxs-lookup"><span data-stu-id="272be-114">When the server receives credentials from a client, it decrypts the ticket with its [*master key*](../secgloss/m-gly.md), extracts the [*session key*](../secgloss/s-gly.md), and uses the session key to decrypt the client's authenticator message.</span></span> <span data-ttu-id="272be-115">Если все проверяются, сервер знает, что учетные данные клиента были выданы центром распространения ключей, доверенным центром сертификации.</span><span class="sxs-lookup"><span data-stu-id="272be-115">If everything checks out, the server knows that the client's credentials were issued by the KDC, a trusted authority.</span></span> <span data-ttu-id="272be-116">Для взаимной проверки подлинности сервер отвечает путем шифрования метки времени из сообщения средства проверки подлинности клиента с помощью ключа сеанса.</span><span class="sxs-lookup"><span data-stu-id="272be-116">For mutual authentication, the server responds by encrypting the time stamp from the client's authenticator message using the session key.</span></span> <span data-ttu-id="272be-117">Это зашифрованное сообщение отправляется клиенту.</span><span class="sxs-lookup"><span data-stu-id="272be-117">This encrypted message is sent to the client.</span></span> <span data-ttu-id="272be-118">Затем клиент расшифровывает сообщение.</span><span class="sxs-lookup"><span data-stu-id="272be-118">The client then decrypts the message.</span></span> <span data-ttu-id="272be-119">Если возвращаемое сообщение совпадает с меткой времени исходного сообщения средства проверки подлинности, сервер проходит проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="272be-119">If the returned message is the same as the time stamp in the original authenticator message, the server is authenticated.</span></span>

<span data-ttu-id="272be-120">В качестве дополнительного преимущества серверу не нужно хранить ключи сеансов, которые он использует для своих клиентов.</span><span class="sxs-lookup"><span data-stu-id="272be-120">As an added benefit, the server does not need to store the session keys it uses with its clients.</span></span> <span data-ttu-id="272be-121">Ответственность за управление билетом сервера в кэше билетов и на предоставление этого билета при каждом доступе к серверу осуществляется каждой обязанностью клиента.</span><span class="sxs-lookup"><span data-stu-id="272be-121">It is each client's responsibility to manage the ticket for the server in its ticket cache and to present that ticket each time it accesses the server.</span></span> <span data-ttu-id="272be-122">Каждый раз, когда сервер получает билет от клиента, он использует его главный ключ для расшифровки билета и извлечения ключа сеанса.</span><span class="sxs-lookup"><span data-stu-id="272be-122">Whenever the server receives a ticket from a client, it uses its master key to decrypt the ticket and extract the session key.</span></span> <span data-ttu-id="272be-123">Если серверу больше не требуется ключ сеанса, ключ удаляется.</span><span class="sxs-lookup"><span data-stu-id="272be-123">When the server no longer needs the session key, the key is deleted.</span></span>

<span data-ttu-id="272be-124">Клиенту не требуется доступ к KDC каждый раз, когда ему нужен доступ к этому конкретному серверу.</span><span class="sxs-lookup"><span data-stu-id="272be-124">The client does not need to access the KDC each time it wants access to this particular server.</span></span> <span data-ttu-id="272be-125">Билеты можно использовать повторно.</span><span class="sxs-lookup"><span data-stu-id="272be-125">Tickets can be reused.</span></span> <span data-ttu-id="272be-126">В качестве меры предосторожности при краже билетов у билетов есть срок действия, заданный KDC в структуре билетов.</span><span class="sxs-lookup"><span data-stu-id="272be-126">As a precaution against the possibility of ticket theft, tickets have an expiration time, specified by the KDC in the ticket structure.</span></span> <span data-ttu-id="272be-127">Срок действия билета зависит от политики Kerberos для области.</span><span class="sxs-lookup"><span data-stu-id="272be-127">How long a ticket is valid depends on Kerberos policy for the realm.</span></span> <span data-ttu-id="272be-128">Как правило, билеты хорошо подходят не более восьми часов, о продолжительности обычного [*сеанса входа в систему*](../secgloss/l-gly.md).</span><span class="sxs-lookup"><span data-stu-id="272be-128">Typically, tickets are good for no longer than eight hours, about the length of a normal [*logon session*](../secgloss/l-gly.md).</span></span> <span data-ttu-id="272be-129">Когда пользователь на клиентской рабочей станции выходит из системы, кэш билетов клиента очищается, и все билеты и ключи сеанса клиента уничтожаются.</span><span class="sxs-lookup"><span data-stu-id="272be-129">When the user at a client workstation logs off, the client ticket cache is flushed and all tickets and client session keys are destroyed.</span></span>

 

 
