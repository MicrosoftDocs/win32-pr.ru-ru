---
description: Расшифровывает сообщение с помощью Negotiate.
ms.assetid: 188341ff-4e67-481e-af30-7f9913b1d24e
title: Функция Декриптмессаже (Negotiate)
ms.topic: reference
ms.date: 07/25/2019
ms.openlocfilehash: 7da05842fc5aba4dc9c19cd530b38e0d46b640aac10b4614981c30c8863d7e7b
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119008522"
---
# <a name="decryptmessage-negotiate-function"></a>Функция Декриптмессаже (Negotiate)

Функция **декриптмессаже (Negotiate)** расшифровывает сообщение. Некоторые пакеты не шифруют и не расшифровываются сообщения, а выполняют и проверяют [*хэш*](../secgloss/h-gly.md)целостности.

> [!Note]  
> [**Енкриптмессаже (Negotiate)**](encryptmessage--negotiate.md) и **декриптмессаже (Negotiate)** могут быть вызваны одновременно из двух разных потоков в одном контексте SSPI, [*Если один поток*](../secgloss/s-gly.md) шифруется, а другой расшифровывается. При шифровании нескольких потоков или при расшифровке более одного потока каждый поток должен получить уникальный контекст.

## <a name="syntax"></a>Синтаксис

```C++
SECURITY_STATUS SEC_Entry DecryptMessage(
  _In_    PCtxtHandle    phContext,
  _Inout_ PSecBufferDesc pMessage,
  _In_    ULONG          MessageSeqNo,
  _Out_   PULONG         pfQOP
);
```

## <a name="parameters"></a>Параметры

*фконтекст* \[ окне\]

Маркер [*контекста безопасности*](../secgloss/s-gly.md) , который будет использоваться для расшифровки сообщения.

*пмессаже* \[ в, out\]

Указатель на структуру [**секбуффердеск**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) . На входе структура ссылается на одну или несколько структур [**pvbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) . По крайней мере один из них должен иметь тип \_ данных pvbuffer. Этот буфер содержит зашифрованное сообщение. Зашифрованное сообщение расшифровывается на месте, переписывая исходное содержимое его буфера.

*Мессажесекно* \[ окне\]

Порядковый номер, ожидаемый транспортным приложением (при наличии). Если транспортное приложение не поддерживает порядковые номера, этот параметр должен иметь значение 0.

*пфкоп* \[ заполняет\]

Указатель на переменную типа **ulong** , которая получает зависящие от пакета флаги, указывающие качество защиты.

Этот параметр может иметь следующий флаг.

<table><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><thead><tr class="header"><th>Значение</th><th>Значение</th></tr></thead><tbody><tr class="odd"><td><span id="SECQOP_WRAP_NO_ENCRYPT"></span><span id="secqop_wrap_no_encrypt"></span><dl> <dt><strong>SECQOP_WRAP_NO_ENCRYPT</strong></dt> </dl></td><td>Сообщение не было зашифровано, но был создан заголовок или трейлер.<br/><blockquote>[!Note]<br />
KERB_WRAP_NO_ENCRYPT имеет то же значение и то же самое.</blockquote><br/></td></tr></tbody></table>

## <a name="return-value"></a>Возвращаемое значение

Если функция проверяет, что сообщение было получено в правильной последовательности, функция возвращает значение в секунду \_ E \_ ОК.

Если функция не расшифрует сообщение, она возвращает один из следующих кодов ошибок.

| Код возврата                     | Описание                                                                                                                                                                        |
|---------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **с \_ \_ неполным \_ сообщением электронной почты** | Данные во входном буфере неполны. Приложению необходимо прочитать больше данных с сервера и снова вызвать [**декриптмессаже (Negotiate)**](decryptmessage--negotiate.md) . |
| **с \_ не \_ \_ по \_ порядку**   | Сообщение не было получено в правильной последовательности.                                                                                                                              |

## <a name="remarks"></a>Remarks

Иногда приложение будет считывать данные от удаленной стороны, пытаться расшифровать их с помощью **декриптмессаже (Negotiate)**, а также обнаружить, что **декриптмессаже (Negotiate)** закончились, но выходные буферы пусты. Это нормальное поведение, и приложения должны уметь работать с ним.

**Windows XP:** Эта функция также называлась **унсеалмессаже**. Теперь приложения должны использовать только **декриптмессаже (Negotiate)** .

## <a name="requirements"></a>Requirements (Требования)

| Требование | Значение |
|-------------------------------------|--------------------------------|
| Минимальная версия клиента | Windows \[Только классические приложения XP\]          |
| Минимальная версия сервера | Windows Только для \[ настольных приложений сервера 2003\] |
| Заголовок                   | SSPI. h (включая Security. h)               |
| Библиотека                  | Secur32. lib                               |
| DLL                      | Secur32.dll                               |

## <a name="see-also"></a>См. также

- [Функции SSPI](authentication-functions.md#sspi-functions)
- [**Енкриптмессаже (согласование)**](encryptmessage--negotiate.md)
- [**Pvbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer)
- [**секбуффердеск**](/windows/win32/api/sspi/ns-sspi-secbufferdesc)
