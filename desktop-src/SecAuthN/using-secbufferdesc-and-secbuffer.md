---
description: Связь часто включает потенциально большие объемы данных или данные неизвестной длины.
ms.assetid: e7b12b9e-8caa-4dad-b81f-b609ccb92c9f
title: Использование Секбуффердеск и Pvbuffer
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3ca7d8155a610263838d2baf2a7d1c8fc96ec874
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103911855"
---
# <a name="using-secbufferdesc-and-secbuffer"></a><span data-ttu-id="1aef7-103">Использование Секбуффердеск и Pvbuffer</span><span class="sxs-lookup"><span data-stu-id="1aef7-103">Using SecBufferDesc and SecBuffer</span></span>

<span data-ttu-id="1aef7-104">Связь часто включает потенциально большие объемы данных или данные неизвестной длины.</span><span class="sxs-lookup"><span data-stu-id="1aef7-104">Communication often involves potentially large amounts of data or data of unknown length.</span></span> <span data-ttu-id="1aef7-105">Отправка и получение данных выполняются аналогично или одинаково в обоих случаях.</span><span class="sxs-lookup"><span data-stu-id="1aef7-105">Sending and receiving data is done in similar or identical fashion in both of these cases.</span></span> <span data-ttu-id="1aef7-106">Для обработки неизвестной длины и потенциально больших объемов данных связь SSPI выполняется с помощью двух структур: [**секбуффердеск**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) и [**pvbuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer).</span><span class="sxs-lookup"><span data-stu-id="1aef7-106">To deal with unknown length and potentially large amounts of data, SSPI communication is done using two structures, [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) and [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer).</span></span>

<span data-ttu-id="1aef7-107">Структура [**секбуффердеск**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) — это контейнер для массива структур [**pvbuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) .</span><span class="sxs-lookup"><span data-stu-id="1aef7-107">A [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) structure is a container for an array of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structures.</span></span> <span data-ttu-id="1aef7-108">Структура **секбуффердеск** имеет следующие члены:</span><span class="sxs-lookup"><span data-stu-id="1aef7-108">A **SecBufferDesc** structure has the following members:</span></span>

-   <span data-ttu-id="1aef7-109">Номер версии</span><span class="sxs-lookup"><span data-stu-id="1aef7-109">Version number</span></span>
-   <span data-ttu-id="1aef7-110">Число элементов [**pvbuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer)</span><span class="sxs-lookup"><span data-stu-id="1aef7-110">Number of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) elements</span></span>
-   <span data-ttu-id="1aef7-111">Адрес массива структур [**pvbuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer)</span><span class="sxs-lookup"><span data-stu-id="1aef7-111">Address of the array of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structures</span></span>

<span data-ttu-id="1aef7-112">Структура [**pvbuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) содержит следующие три члена:</span><span class="sxs-lookup"><span data-stu-id="1aef7-112">A [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structure contains the following three members:</span></span>

-   <span data-ttu-id="1aef7-113">Число байтов в буфере</span><span class="sxs-lookup"><span data-stu-id="1aef7-113">Number of bytes in the buffer</span></span>
-   <span data-ttu-id="1aef7-114">Тип сведений, содержащихся в элементе данных</span><span class="sxs-lookup"><span data-stu-id="1aef7-114">Type of information contained in the data item</span></span>
-   <span data-ttu-id="1aef7-115">Сами байты</span><span class="sxs-lookup"><span data-stu-id="1aef7-115">The bytes themselves</span></span>

<span data-ttu-id="1aef7-116">Полное сообщение SSPI часто состоит из массива структур [**pvbuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) .</span><span class="sxs-lookup"><span data-stu-id="1aef7-116">A whole SSPI message often consists of an array of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structures.</span></span>

<span data-ttu-id="1aef7-117">Следующие типы данных буфера определяются следующим образом.</span><span class="sxs-lookup"><span data-stu-id="1aef7-117">The following buffer data types are defined as follows.</span></span>



| <span data-ttu-id="1aef7-118">Тип буфера</span><span class="sxs-lookup"><span data-stu-id="1aef7-118">Buffer type</span></span>                | <span data-ttu-id="1aef7-119">Значение</span><span class="sxs-lookup"><span data-stu-id="1aef7-119">Meaning</span></span>                                                                                                                                |
|----------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="1aef7-120">PVBUFFER \_ пусто</span><span class="sxs-lookup"><span data-stu-id="1aef7-120">SECBUFFER\_EMPTY</span></span>           | <span data-ttu-id="1aef7-121">Не определено, заменено функцией [*пакета безопасности*](../secgloss/s-gly.md)</span><span class="sxs-lookup"><span data-stu-id="1aef7-121">Undefined, replaced by the [*security package*](../secgloss/s-gly.md) function</span></span> |
| <span data-ttu-id="1aef7-122">\_данные pvbuffer</span><span class="sxs-lookup"><span data-stu-id="1aef7-122">SECBUFFER\_DATA</span></span>            | <span data-ttu-id="1aef7-123">Данные пакета</span><span class="sxs-lookup"><span data-stu-id="1aef7-123">Packet data</span></span>                                                                                                                            |
| <span data-ttu-id="1aef7-124">\_токен pvbuffer</span><span class="sxs-lookup"><span data-stu-id="1aef7-124">SECBUFFER\_TOKEN</span></span>           | <span data-ttu-id="1aef7-125">Маркер безопасности</span><span class="sxs-lookup"><span data-stu-id="1aef7-125">Security token</span></span>                                                                                                                         |
| <span data-ttu-id="1aef7-126">\_Параметры pvbuffer pkg \_</span><span class="sxs-lookup"><span data-stu-id="1aef7-126">SECBUFFER\_PKG\_PARAMS</span></span>     | <span data-ttu-id="1aef7-127">Параметры, зависящие от пакета</span><span class="sxs-lookup"><span data-stu-id="1aef7-127">Package-specific parameters</span></span>                                                                                                            |
| <span data-ttu-id="1aef7-128">\_отсутствует pvbuffer</span><span class="sxs-lookup"><span data-stu-id="1aef7-128">SECBUFFER\_MISSING</span></span>         | <span data-ttu-id="1aef7-129">Отсутствующий индикатор данных</span><span class="sxs-lookup"><span data-stu-id="1aef7-129">Missing data indicator</span></span>                                                                                                                 |
| <span data-ttu-id="1aef7-130">PVBUFFER, \_ дополнительный</span><span class="sxs-lookup"><span data-stu-id="1aef7-130">SECBUFFER\_EXTRA</span></span>           | <span data-ttu-id="1aef7-131">Дополнительные данные</span><span class="sxs-lookup"><span data-stu-id="1aef7-131">Extra data</span></span>                                                                                                                             |
| <span data-ttu-id="1aef7-132">\_поток pvbuffer</span><span class="sxs-lookup"><span data-stu-id="1aef7-132">SECBUFFER\_STREAM</span></span>          | <span data-ttu-id="1aef7-133">Данные потока безопасности</span><span class="sxs-lookup"><span data-stu-id="1aef7-133">Security stream data</span></span>                                                                                                                   |
| <span data-ttu-id="1aef7-134">\_трейлер потока \_ pvbuffer</span><span class="sxs-lookup"><span data-stu-id="1aef7-134">SECBUFFER\_STREAM\_TRAILER</span></span> | <span data-ttu-id="1aef7-135">Трейлер потока безопасности</span><span class="sxs-lookup"><span data-stu-id="1aef7-135">Security stream trailer</span></span>                                                                                                                |
| <span data-ttu-id="1aef7-136">\_заголовок потока \_ pvbuffer</span><span class="sxs-lookup"><span data-stu-id="1aef7-136">SECBUFFER\_STREAM\_HEADER</span></span>  | <span data-ttu-id="1aef7-137">Заголовок потока безопасности</span><span class="sxs-lookup"><span data-stu-id="1aef7-137">Security stream header</span></span>                                                                                                                 |



 

<span data-ttu-id="1aef7-138">Приведенные выше буферы можно комбинировать с помощью битовой операции **or** с любым из следующих типов буфера.</span><span class="sxs-lookup"><span data-stu-id="1aef7-138">The buffer types above can be combined using a bitwise-**OR** operation with either of the following buffer types.</span></span>



| <span data-ttu-id="1aef7-139">Тип буфера</span><span class="sxs-lookup"><span data-stu-id="1aef7-139">Buffer type</span></span>         | <span data-ttu-id="1aef7-140">Значение</span><span class="sxs-lookup"><span data-stu-id="1aef7-140">Meaning</span></span>                                                                          |
|---------------------|----------------------------------------------------------------------------------|
| <span data-ttu-id="1aef7-141">PVBUFFER \_ аттрмаск</span><span class="sxs-lookup"><span data-stu-id="1aef7-141">SECBUFFER\_ATTRMASK</span></span> | <span data-ttu-id="1aef7-142">Маскировать атрибуты безопасности, разделив флаги атрибутов от типа буфера.</span><span class="sxs-lookup"><span data-stu-id="1aef7-142">Mask security attributes by separating the attribute flags from the buffer type.</span></span> |
| <span data-ttu-id="1aef7-143">PVBUFFER \_ ReadOnly</span><span class="sxs-lookup"><span data-stu-id="1aef7-143">SECBUFFER\_READONLY</span></span> | <span data-ttu-id="1aef7-144">Буфер доступен только для чтения</span><span class="sxs-lookup"><span data-stu-id="1aef7-144">Buffer is read-only</span></span>                                                              |



 

<span data-ttu-id="1aef7-145">Перед каждым вызовом API SSPI, для которого требуется параметр [**секбуффердеск**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) , объявляется и инициализируется один или несколько элементов массива [**pvbuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) .</span><span class="sxs-lookup"><span data-stu-id="1aef7-145">Before each call to an SSPI API that requires a [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) parameter, one or more [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) array elements are declared and initialized.</span></span> <span data-ttu-id="1aef7-146">Например, могут существовать два буфера безопасности: один, содержащий входные данные сообщения, а другой — непрозрачный токен безопасности, возвращенный пакетом безопасности.</span><span class="sxs-lookup"><span data-stu-id="1aef7-146">For example, there can be two security buffers: one that contains input message data and the other for the output opaque security token returned by the security package.</span></span> <span data-ttu-id="1aef7-147">Порядок буферов безопасности в дескрипторе буфера безопасности не важен, но каждый буфер должен быть помечен соответствующим типом.</span><span class="sxs-lookup"><span data-stu-id="1aef7-147">The order of security buffers in the security buffer descriptor is not important, but each buffer must be tagged with its appropriate type.</span></span> <span data-ttu-id="1aef7-148">Тег, предназначенный только для чтения, можно использовать со всеми входными буферами, которые не должны изменяться [*пакетом безопасности*](../secgloss/s-gly.md).</span><span class="sxs-lookup"><span data-stu-id="1aef7-148">A read-only tag can be used with any input buffer that must not be modified by the [*security package*](../secgloss/s-gly.md).</span></span>

<span data-ttu-id="1aef7-149">Важен размер выходного буфера, который должен содержать маркер безопасности.</span><span class="sxs-lookup"><span data-stu-id="1aef7-149">The size of the output buffer that is expected to contain the security token is important.</span></span> <span data-ttu-id="1aef7-150">Приложение может найти максимальный размер маркера для пакета безопасности во время начальной настройки.</span><span class="sxs-lookup"><span data-stu-id="1aef7-150">An application can find the maximum token size for a security package during initial setup.</span></span> <span data-ttu-id="1aef7-151">Вызов [**енумератесекуритипаккажес**](/windows/desktop/api/Sspi/nf-sspi-enumeratesecuritypackagesa) возвращает массив указателей на сведения о пакете безопасности.</span><span class="sxs-lookup"><span data-stu-id="1aef7-151">The call to [**EnumerateSecurityPackages**](/windows/desktop/api/Sspi/nf-sspi-enumeratesecuritypackagesa) returns an array of pointers to security package information.</span></span> <span data-ttu-id="1aef7-152">Структура сведений о пакете безопасности содержит максимальный размер маркера для каждого пакета.</span><span class="sxs-lookup"><span data-stu-id="1aef7-152">The security package information structure contains the maximum token size for each package.</span></span> <span data-ttu-id="1aef7-153">В этом примере сведения находятся в элементе **кбмакстокен** структуры [**секпкгинфо**](/windows/desktop/api/Sspi/ns-sspi-secpkginfoa) .</span><span class="sxs-lookup"><span data-stu-id="1aef7-153">In the example, the information is in the **cbMaxToken** member of the [**SecPkgInfo**](/windows/desktop/api/Sspi/ns-sspi-secpkginfoa) structure.</span></span> <span data-ttu-id="1aef7-154">Те же сведения можно получить позже с помощью [**куерисекуритипаккажеинфо**](/windows/desktop/api/Sspi/nf-sspi-querysecuritypackageinfoa).</span><span class="sxs-lookup"><span data-stu-id="1aef7-154">The same information can be obtained later using [**QuerySecurityPackageInfo**](/windows/desktop/api/Sspi/nf-sspi-querysecuritypackageinfoa).</span></span>

<span data-ttu-id="1aef7-155">Приложение инициализирует указатели буфера и размеры в описании буфера, чтобы указать, где можно найти данные сообщений и другие сведения.</span><span class="sxs-lookup"><span data-stu-id="1aef7-155">The application initializes the buffer pointers and sizes in the buffer description to indicate where message data and other information can be found.</span></span>

<span data-ttu-id="1aef7-156">Дополнительные сведения см. в разделе [пример кода pvbuffer и секбуффердеск](secbuffer-and-secbufferdesc-example-code.md).</span><span class="sxs-lookup"><span data-stu-id="1aef7-156">For details, see [SecBuffer and SecBufferDesc Example Code](secbuffer-and-secbufferdesc-example-code.md).</span></span>

 

 
