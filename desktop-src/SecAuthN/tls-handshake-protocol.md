---
description: Протокол подтверждения протокола TLS отвечает за проверку подлинности и обмен ключами, необходимые для установки или возобновления безопасных сеансов.
ms.assetid: 65fb4db3-e505-457a-9159-dba0b506ea0b
title: Протокол подтверждения TLS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e0c7cfa9e9db54a6035abe147ce00bbde59bcc86
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105664154"
---
# <a name="tls-handshake-protocol"></a><span data-ttu-id="e9ba2-103">Протокол подтверждения TLS</span><span class="sxs-lookup"><span data-stu-id="e9ba2-103">TLS Handshake Protocol</span></span>

<span data-ttu-id="e9ba2-104">Протокол [*подтверждения протокола TLS*](../secgloss/t-gly.md) отвечает за проверку подлинности и обмен ключами, необходимые для установки или возобновления безопасных сеансов.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-104">The [*Transport Layer Security*](../secgloss/t-gly.md) (TLS) Handshake Protocol is responsible for the authentication and key exchange necessary to establish or resume secure sessions.</span></span> <span data-ttu-id="e9ba2-105">При установке безопасного [*сеанса*](../secgloss/s-gly.md)протокол подтверждения управляет следующими параметрами:</span><span class="sxs-lookup"><span data-stu-id="e9ba2-105">When establishing a secure [*session*](../secgloss/s-gly.md), the Handshake Protocol manages the following:</span></span>

-   <span data-ttu-id="e9ba2-106">Согласование комплекта шифров</span><span class="sxs-lookup"><span data-stu-id="e9ba2-106">Cipher suite negotiation</span></span>
-   <span data-ttu-id="e9ba2-107">Проверка подлинности сервера и, при необходимости, клиента</span><span class="sxs-lookup"><span data-stu-id="e9ba2-107">Authentication of the server and optionally, the client</span></span>
-   <span data-ttu-id="e9ba2-108">Обмен сведениями о ключе сеанса.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-108">Session key information exchange.</span></span>

## <a name="cipher-suite-negotiation"></a><span data-ttu-id="e9ba2-109">Согласование комплекта шифров</span><span class="sxs-lookup"><span data-stu-id="e9ba2-109">Cipher Suite Negotiation</span></span>

<span data-ttu-id="e9ba2-110">Клиент и сервер делают контакт и выбирают комплект шифров, который будет использоваться в процессе обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-110">The client and server make contact and choose the cipher suite that will be used throughout their message exchange.</span></span>

## <a name="authentication"></a><span data-ttu-id="e9ba2-111">Аутентификация</span><span class="sxs-lookup"><span data-stu-id="e9ba2-111">Authentication</span></span>

<span data-ttu-id="e9ba2-112">В протоколе TLS сервер подтверждает свою подлинность клиенту.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-112">In TLS, a server proves its identity to the client.</span></span> <span data-ttu-id="e9ba2-113">Клиенту также может потребоваться подтвердить свою личность на сервер.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-113">The client might also need to prove its identity to the server.</span></span> <span data-ttu-id="e9ba2-114">PKI, использование [*пар открытого и закрытого ключей*](../secgloss/p-gly.md)является основанием этой проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-114">PKI, the use of [*public/private key pairs*](../secgloss/p-gly.md), is the basis of this authentication.</span></span> <span data-ttu-id="e9ba2-115">Точный метод, используемый для проверки подлинности, определяется согласованным комплектом шифров.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-115">The exact method used for authentication is determined by the cipher suite negotiated.</span></span>

## <a name="key-exchange"></a><span data-ttu-id="e9ba2-116">Обмен ключами</span><span class="sxs-lookup"><span data-stu-id="e9ba2-116">Key Exchange</span></span>

<span data-ttu-id="e9ba2-117">Клиент и сервер обмениваются случайными числами и специальным числом, которое называется секретом предварительного главного компьютера.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-117">The client and server exchange random numbers and a special number called the Pre-Master Secret.</span></span> <span data-ttu-id="e9ba2-118">Эти числа объединяются с дополнительными данными, позволяющими клиенту и серверу создавать свои общие секреты, называемые главным секретом.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-118">These numbers are combined with additional data permitting client and server to create their shared secret, called the Master Secret.</span></span> <span data-ttu-id="e9ba2-119">Главный секрет используется клиентом и сервером для создания секрета для записи MAC, который является ключом сеанса, используемым для [*хэширования*](../secgloss/h-gly.md), и ключом записи, который является [*ключом сеанса*](../secgloss/s-gly.md) , используемым для шифрования.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-119">The Master Secret is used by client and server to generate the write MAC secret, which is the session key used for [*hashing*](../secgloss/h-gly.md), and the write key, which is the [*session key*](../secgloss/s-gly.md) used for encryption.</span></span>

## <a name="establishing-a-secure-session-by-using-tls"></a><span data-ttu-id="e9ba2-120">Установка безопасного сеанса с помощью TLS</span><span class="sxs-lookup"><span data-stu-id="e9ba2-120">Establishing a Secure Session by Using TLS</span></span>

<span data-ttu-id="e9ba2-121">Протокол подтверждения TLS включает следующие шаги.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-121">The TLS Handshake Protocol involves the following steps:</span></span>

1.  <span data-ttu-id="e9ba2-122">Клиент отправляет на сервер сообщение Hello Client, а также случайное значение клиента и поддерживаемые комплекты шифров.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-122">The client sends a "Client hello" message to the server, along with the client's random value and supported cipher suites.</span></span>
2.  <span data-ttu-id="e9ba2-123">Сервер отвечает, отправляя клиенту сообщение "Server Hello", а также случайное значение сервера.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-123">The server responds by sending a "Server hello" message to the client, along with the server's random value.</span></span>
3.  <span data-ttu-id="e9ba2-124">Сервер отправляет клиенту сертификат для проверки подлинности и может запросить сертификат у клиента.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-124">The server sends its certificate to the client for authentication and may request a certificate from the client.</span></span> <span data-ttu-id="e9ba2-125">Сервер отправляет сообщение "Hello Server Done".</span><span class="sxs-lookup"><span data-stu-id="e9ba2-125">The server sends the "Server hello done" message.</span></span>
4.  <span data-ttu-id="e9ba2-126">Если сервер запросил сертификат от клиента, клиент отправляет его.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-126">If the server has requested a certificate from the client, the client sends it.</span></span>
5.  <span data-ttu-id="e9ba2-127">Клиент создает случайный предварительный секретный ключ и шифрует его с помощью [*открытого ключа*](../secgloss/p-gly.md) из сертификата сервера и отправляет зашифрованный предварительный основной секрет на сервер.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-127">The client creates a random Pre-Master Secret and encrypts it with the [*public key*](../secgloss/p-gly.md) from the server's certificate, sending the encrypted Pre-Master Secret to the server.</span></span>
6.  <span data-ttu-id="e9ba2-128">Сервер получает секрет предварительного главного сервера.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-128">The server receives the Pre-Master Secret.</span></span> <span data-ttu-id="e9ba2-129">Каждый сервер и клиент создают главный секретный и [*сеансовый ключи*](../secgloss/s-gly.md) на основе предварительной версии секрета.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-129">The server and client each generate the Master Secret and [*session keys*](../secgloss/s-gly.md) based on the Pre-Master Secret.</span></span>
7.  <span data-ttu-id="e9ba2-130">Клиент отправляет уведомление "изменение спецификации шифра" на сервер, чтобы указать, что клиент начнет использовать новые [*ключи сеанса*](../secgloss/s-gly.md) для [*хэширования*](../secgloss/h-gly.md) и шифрования сообщений.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-130">The client sends "Change cipher spec" notification to server to indicate that the client will start using the new [*session keys*](../secgloss/s-gly.md) for [*hashing*](../secgloss/h-gly.md) and encrypting messages.</span></span> <span data-ttu-id="e9ba2-131">Клиент также отправляет сообщение "клиент завершен".</span><span class="sxs-lookup"><span data-stu-id="e9ba2-131">Client also sends "Client finished" message.</span></span>
8.  <span data-ttu-id="e9ba2-132">Сервер получает "изменить спецификацию шифра" и переключает состояние безопасности уровня записи на [*симметричное шифрование*](../secgloss/s-gly.md) с помощью [*ключей сеанса*](../secgloss/s-gly.md).</span><span class="sxs-lookup"><span data-stu-id="e9ba2-132">Server receives "Change cipher spec" and switches its record layer security state to [*symmetric encryption*](../secgloss/s-gly.md) using the [*session keys*](../secgloss/s-gly.md).</span></span> <span data-ttu-id="e9ba2-133">Сервер отправляет клиенту сообщение "Server Finished".</span><span class="sxs-lookup"><span data-stu-id="e9ba2-133">Server sends "Server finished" message to the client.</span></span>
9.  <span data-ttu-id="e9ba2-134">Теперь клиент и сервер могут обмениваться данными приложения через защищенный канал, который они установили.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-134">Client and server can now exchange application data over the secured channel they have established.</span></span> <span data-ttu-id="e9ba2-135">Все сообщения, отправляемые от клиента серверу и от сервера к клиенту, шифруются с помощью ключа сеанса.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-135">All messages sent from client to server and from server to client are encrypted using session key.</span></span>

## <a name="resuming-a-secure-session-by-using-tls"></a><span data-ttu-id="e9ba2-136">Возобновление безопасного сеанса с помощью TLS</span><span class="sxs-lookup"><span data-stu-id="e9ba2-136">Resuming a Secure Session by Using TLS</span></span>

1.  <span data-ttu-id="e9ba2-137">Клиент отправляет сообщение "клиент Hello", используя идентификатор сеанса для возобновления сеанса.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-137">The client sends a "Client hello" message using the Session ID of the session to be resumed.</span></span>
2.  <span data-ttu-id="e9ba2-138">Сервер проверяет кэш сеанса на соответствие ИДЕНТИФИКАТОРу сеанса.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-138">The server checks its session cache for a matching Session ID.</span></span> <span data-ttu-id="e9ba2-139">Если совпадение найдено, и сервер способен возобновить сеанс, он отправляет сообщение "Server Hello" с ИДЕНТИФИКАТОРом сеанса.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-139">If a match is found, and the server is able to resume the session, it sends a "Server hello" message with the Session ID.</span></span>
    > [!Note]  
    > <span data-ttu-id="e9ba2-140">Если идентификатор сеанса не найден, сервер создает новый идентификатор сеанса, а клиент и сервер TLS выполняют полное подтверждение.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-140">If a session ID match is not found, the server generates a new session ID and the TLS client and server perform a full handshake.</span></span>

     

3.  <span data-ttu-id="e9ba2-141">Клиент и сервер должны обмениваться сообщениями "изменить спецификацию шифра" и отправить сообщения "клиент завершен" и "сервер завершен".</span><span class="sxs-lookup"><span data-stu-id="e9ba2-141">Client and server must exchange "Change cipher spec" messages and send "Client finished" and "Server finished" messages.</span></span>
4.  <span data-ttu-id="e9ba2-142">Теперь клиент и сервер могут возобновить обмен данными приложения по безопасному каналу.</span><span class="sxs-lookup"><span data-stu-id="e9ba2-142">Client and server can now resume application data exchange over the secure channel.</span></span>

 

 
