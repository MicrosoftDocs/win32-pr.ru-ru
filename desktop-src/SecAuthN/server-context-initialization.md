---
description: Как и клиент, сервер также получает маркер учетных данных, готовый к ответу на входящий запрос проверки подлинности от клиента.
ms.assetid: 2a0aeadf-e099-4264-8522-e498f437bf75
title: Инициализация контекста сервера
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1362c8fd71e079392f10a8e35f76ad511de3c49f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103813577"
---
# <a name="server-context-initialization"></a><span data-ttu-id="1aa37-103">Инициализация контекста сервера</span><span class="sxs-lookup"><span data-stu-id="1aa37-103">Server Context Initialization</span></span>

<span data-ttu-id="1aa37-104">Как и клиент, сервер также получает маркер [*учетных данных*](../secgloss/c-gly.md) , готовый к ответу на входящий запрос проверки подлинности от клиента.</span><span class="sxs-lookup"><span data-stu-id="1aa37-104">Like the client, the server also acquires a [*credentials*](../secgloss/c-gly.md) handle to be ready to respond to an incoming authentication request from the client.</span></span> <span data-ttu-id="1aa37-105">Учетные данные сервера используются для проверки подлинности сервера для клиента в [*протоколах безопасности*](../secgloss/s-gly.md) , поддерживающих проверку подлинности сервера или взаимную проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="1aa37-105">Server credentials are used to authenticate the server to the client in [*security protocols*](../secgloss/s-gly.md) that support server authentication or mutual authentication.</span></span> <span data-ttu-id="1aa37-106">Сервер получает маркер для своих учетных данных, определенных учетной записью службы, используемой для запуска сервера.</span><span class="sxs-lookup"><span data-stu-id="1aa37-106">The server obtains a handle to its credentials defined by the service account used to start the server.</span></span> <span data-ttu-id="1aa37-107">Для этого вызывается [**AcquireCredentialsHandle**](/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea).</span><span class="sxs-lookup"><span data-stu-id="1aa37-107">It does so by calling [**AcquireCredentialsHandle**](/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea).</span></span>

<span data-ttu-id="1aa37-108">Сервер может получить свой обработчик учетных данных, а затем переключиться в состояние прослушивания или подождать в состоянии прослушивания до тех пор, пока не будет получен запрос на подключение и не получится обработчик входящих учетных данных.</span><span class="sxs-lookup"><span data-stu-id="1aa37-108">The server can acquire its credentials handle and then go into a listen state, or it can wait in a listen state until a connection request arrives and then acquire an inbound credentials handle.</span></span> <span data-ttu-id="1aa37-109">Дополнительные сведения о функциях учетных данных см. в разделе [Управление учетными](authentication-functions.md)данными.</span><span class="sxs-lookup"><span data-stu-id="1aa37-109">For more information on credentials functions, see [Credential Management](authentication-functions.md).</span></span>

<span data-ttu-id="1aa37-110">Когда сервер получает сообщение запроса на подключение от клиента, он создает локальный [*контекст безопасности*](../secgloss/s-gly.md) для клиента с помощью [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext).</span><span class="sxs-lookup"><span data-stu-id="1aa37-110">When the server receives a connection request message from a client, it creates a local [*security context*](../secgloss/s-gly.md) for the client using [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext).</span></span> <span data-ttu-id="1aa37-111">Сервер использует этот локальный контекст безопасности для выполнения будущих запросов тем же клиентом.</span><span class="sxs-lookup"><span data-stu-id="1aa37-111">The server uses this local security context to carry out future requests by the same client.</span></span> <span data-ttu-id="1aa37-112">Дополнительные сведения о контекстных функциях см. в разделе [Управление контекстами](authentication-functions.md).</span><span class="sxs-lookup"><span data-stu-id="1aa37-112">For more information on context functions, see [Context Management](authentication-functions.md).</span></span>

<span data-ttu-id="1aa37-113">Сервер проверяет состояние возврата и дескриптор буфера вывода, чтобы убедиться в отсутствии ошибок, и может отклонить запрос на соединение в случае возникновения ошибок.</span><span class="sxs-lookup"><span data-stu-id="1aa37-113">The server checks the return status and output buffer descriptor to ensure there are no errors so far, and can reject the connection request if there are errors.</span></span> <span data-ttu-id="1aa37-114">Если в выходном буфере, возвращенном функцией [**AcceptSecurityContext (Общие)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext), содержится информация, она объединяет этот буфер в ответное сообщение клиенту.</span><span class="sxs-lookup"><span data-stu-id="1aa37-114">If there is information in the output buffer returned by [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext), it bundles that buffer into a response message to the client.</span></span>

<span data-ttu-id="1aa37-115">Любой выходной буфер из [**AcceptSecurityContext (Общие)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) должен быть отправлен обратно клиенту.</span><span class="sxs-lookup"><span data-stu-id="1aa37-115">Any output buffer from [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) must be sent back to the client.</span></span> <span data-ttu-id="1aa37-116">Кроме того, если для состояния возврата требуется, чтобы протокол продолжал работу (в СЕКУНДах, когда это \_ \_ \_ необходимо, или же \_ я \_ завершил работу \_ и \_ Продолжить), требуется еще один обмен сообщениями с клиентом.</span><span class="sxs-lookup"><span data-stu-id="1aa37-116">In addition, if the return status requires the protocol to continue (SEC\_I\_CONTINUE\_NEEDED or SEC\_I\_COMPLETE\_AND\_CONTINUE), another message exchange with the client is required.</span></span>

<span data-ttu-id="1aa37-117">Для дополнительных отрезков сервер ожидает ответа клиента с помощью другого сообщения.</span><span class="sxs-lookup"><span data-stu-id="1aa37-117">For additional legs, the server waits for the client to respond with another message.</span></span> <span data-ttu-id="1aa37-118">Это время ожидания может быть истекло, чтобы избежать атаки типа "отказ в обслуживании", когда клиент намеренно не отвечает, что вызывает серверный поток и скоро все потоки сервера перестают отвечать на запросы.</span><span class="sxs-lookup"><span data-stu-id="1aa37-118">This wait can be timed out so as to avoid a denial of service attack where a client purposely never responds, causing a server thread and soon, all server threads, to stop responding.</span></span>

 

 
