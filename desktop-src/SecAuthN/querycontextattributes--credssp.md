---
description: Позволяет транспортному приложению запрашивать пакет безопасности "поставщик поддержки безопасности учетных данных (CredSSP)" для определенных атрибутов контекста безопасности.
ms.assetid: 4956c4ab-b71e-4960-b750-f3a79b87baac
title: Функция QueryContextAttributes (CredSSP) (Sspi.h)
ms.topic: reference
ms.date: 07/25/2019
ms.openlocfilehash: 191c3c8d3b2b5bd829aaf8eb45bacadbbd2bbade
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105719554"
---
# <a name="querycontextattributes-credssp-function"></a>Функция QueryContextAttributes (CredSSP)

Функция **QueryContextAttributes (CredSSP)** позволяет транспортному приложению запрашивать пакет безопасности "поставщик поддержки безопасности учетных данных (CredSSP)" для определенных [*атрибутов*](../secgloss/a-gly.md#_security_attribute_gly) контекста безопасности.

## <a name="syntax"></a>Синтаксис


```C++
SECURITY_STATUS SEC_ENTRY QueryContextAttributes(
  _In_  PCtxtHandle phContext,
  _In_  ULONG       ulAttribute,
  _Out_ PVOID       pBuffer
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*фконтекст* \[ окне\]
</dt> <dd>

Описатель контекста безопасности для запроса.

</dd> <dt>

*улаттрибуте* \[ окне\]
</dt> <dd>

Атрибут возвращаемого контекста. Этот параметр может принимать одно из указанных ниже значений. Если не указано иное, атрибуты применимы как к клиенту, так и к серверу.



| Значение                                                                                                                                                                                                                                                                                                   | Значение                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="SECPKG_ATTR_C_ACCESS_TOKEN"></span><span id="secpkg_attr_c_access_token"></span><dl> <dt>**SECPKG \_ 0x80000012 \_ \_ \_ маркер доступа attr C**</dt> <dt></dt> </dl>                                 | Параметр *pBuffer* содержит указатель на структуру [**секпкгконтекст \_ AccessToken**](/windows/win32/api/sspi/ns-sspi-secpkgcontext_accesstoken) , указывающую маркер доступа для текущего контекста безопасности.<br/> Этот атрибут поддерживается только на сервере.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <span id="SECPKG_ATTR_C_FULL_ACCESS_TOKEN"></span><span id="secpkg_attr_c_full_access_token"></span><dl> <dt>**SECPKG \_ 0x80000082 \_ \_ \_ \_ маркера полного доступа attr C**</dt> <dt></dt> </dl>                 | Параметр *pBuffer* содержит указатель на структуру [**секпкгконтекст \_ AccessToken**](/windows/win32/api/sspi/ns-sspi-secpkgcontext_accesstoken) , указывающую маркер доступа для текущего контекста безопасности.<br/> Этот атрибут поддерживается только на сервере.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <span id="SECPKG_ATTR_CERT_TRUST_STATUS"></span><span id="secpkg_attr_cert_trust_status"></span><dl> <dt>**SECPKG \_ 0x80000084 \_ \_ \_ состояния доверия для сертификата attr**</dt> <dt></dt> </dl>                        | Параметр *pBuffer* содержит указатель на структуру [**\_ \_ состояния доверия сертификатов**](/windows/win32/api/wincrypt/ns-wincrypt-cert_trust_status) , указывающую сведения о доверии для сертификата.<br/> Этот атрибут поддерживается только в клиенте.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| <span id="SECPKG_ATTR_CREDS"></span><span id="secpkg_attr_creds"></span><dl> <dt>**SECPKG \_ \_**</dt> <dt>0x80000080</dt> учетных с attr </dl>                                                              | Параметр *pBuffer* содержит указатель на структуру [**секпкгконтекст \_ клиенткредс**](/windows/win32/api/credssp/ns-credssp-secpkgcontext_clientcreds) , указывающую учетные данные клиента.<br/> Учетные данные клиента могут быть либо именем пользователя, либо паролем, либо именем пользователя и ПИН-кодом.<br/> Этот атрибут поддерживается только на сервере.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <span id="SECPKG_ATTR_CREDS_2"></span><span id="secpkg_attr_creds_2"></span><dl> <dt>**SECPKG \_ \_ \_**</dt> Учетные <dt>0x80000086и</dt> с учетом атрибутов 2 </dl>                                                       | Параметр *pBuffer* содержит указатель на структуру [**секпкгконтекст \_ клиенткредс**](/windows/win32/api/credssp/ns-credssp-secpkgcontext_clientcreds) , указывающую учетные данные клиента. <br/> Если учетные данные клиента являются именем пользователя и паролем, то буфер является упакованной структурой [**\_ интерактивного \_ входа в Kerberos**](/windows/win32/api/ntsecapi/ns-ntsecapi-kerb_interactive_logon) .<br/> Если учетные данные клиента имеют имя пользователя и PIN-код, буфер является упакованной структурой [**\_ \_ входа в Kerberos сертификат**](/windows/win32/api/ntsecapi/ns-ntsecapi-kerb_certificate_logon) .<br/> Если учетные данные клиента являются учетными данными удостоверения в сети, то буфер представляет собой EX2 структуру с упакованной [**\_ \_ \_ идентификацией \_ с помощью WinNT auth Identity**](/windows/win32/api/sspi/ns-sspi-sec_winnt_auth_identity_ex2) .<br/> Этот атрибут поддерживается только на сервере CredSSP.<br/> **Windows server 2008 R2, Windows 7, Windows server 2008, Windows Vista, Windows server 2003 и Windows XP:** Это значение не поддерживается.<br/> |
| <span id="SECPKG_ATTR_NEGOTIATION_PACKAGE"></span><span id="secpkg_attr_negotiation_package"></span><dl> <dt>**SECPKG \_ 0x80000081 \_ \_ пакета СОГЛАСОВАНия attr**</dt> <dt></dt> </dl>                   | Параметр *pBuffer* содержит указатель на структуру [**секпкгконтекст \_ PackageInfo**](/windows/win32/api/sspi/ns-sspi-secpkginfoa) , указывающую имя пакета проверки подлинности, согласованного с поставщиком [Microsoft Negotiate](microsoft-negotiate.md) .<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| <span id="SECPKG_ATTR_PACKAGE_INFO"></span><span id="secpkg_attr_package_info"></span><dl> <dt>**SECPKG \_ \_ \_ Сведения о пакете attr**</dt> <dt>10</dt> </dl>                                                | Параметр *pBuffer* содержит указатель на структуру [**секпкгконтекст \_ PackageInfo**](/windows/win32/api/sspi/ns-sspi-secpkginfoa).<br/> Возвращает сведения о используемом поставщике служб.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| <span id="SECPKG_ATTR_SERVER_AUTH_FLAGS"></span><span id="secpkg_attr_server_auth_flags"></span><dl> <dt>**SECPKG \_ \_ \_ \_ Флаги проверки подлинности сервера attr**</dt> <dt>0x80000083</dt> </dl>                        | Параметр *pBuffer* содержит указатель на структуру [**\_ флагов секпкгконтекст**](/windows/win32/api/sspi/ns-sspi-secpkgcontext_flags) , которая задает сведения о флагах в текущем контексте безопасности.<br/> Этот атрибут поддерживается только в клиенте.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span id="SECPKG_ATTR_SIZES"></span><span id="secpkg_attr_sizes"></span><dl> <dt>**SECPKG \_ \_Размеры attr**</dt> <dt>0x0</dt> </dl>                                                                     | Параметр *pBuffer* содержит указатель на структуру [**\_ размеров секпкгконтекст**](/windows/win32/api/sspi/ns-sspi-secpkgcontext_sizes) .<br/> Запрашивает размеры структур, используемых в функциях для каждого сообщения и обмене данными проверки подлинности.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| <span id="SECPKG_ATTR_SUBJECT_SECURITY_ATTRIBUTES"></span><span id="secpkg_attr_subject_security_attributes"></span><dl> <dt>**SECPKG \_ \_ \_ \_ Атрибуты безопасности субъекта attr**</dt> <dt>124</dt> </dl> | Параметр *pBuffer* содержит указатель на структуру [**секпкгконтекст \_ субжектаттрибутес**](/windows/win32/api/sspi/ns-sspi-secpkgcontext_subjectattributes) .<br/> Это значение возвращает сведения об атрибутах безопасности для соединения.<br/> Это значение поддерживается только на сервере CredSSP.<br/> Windows **server 2008, Windows Vista, Windows server 2003 и Windows XP:** Это значение не поддерживается.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |



 

</dd> <dt>

*pBuffer* \[ заполняет\]
</dt> <dd>

Указатель на структуру, которая получает атрибуты. Тип структуры зависит от значения параметра *улаттрибуте* .

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Если функция завершается успешно, возвращается в секунду \_ E \_ OK.

Если функция завершается ошибкой, она может возвращать следующие коды ошибок.



| Возвращаемый код и значение                                                                                                                                                            | Описание                                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| <dl> <dt>**С \_ \_Недопустимый 0x80100003 \_ Handle**</dt> <dt></dt> </dl>       | Ошибка при выполнении функции. Параметр *фконтекст* задает маркер неполного контекста.<br/> |
| <dl> <dt>**С \_ \_НЕподдерживаемая \_ функция**</dt> <dt>0x80090302</dt> </dl> | Ошибка при выполнении функции. Недопустимое значение параметра *улаттрибуте* .<br/>                 |



 

## <a name="remarks"></a>Комментарии

Структура, на которую указывает параметр *pBuffer* , зависит от запрашиваемого атрибута.

Хотя вызывающий объект должен выделить структуру *pBuffer* , он выделяет любой объем памяти, необходимый для хранения членов переменной размера в структуре *pBuffer* . Память, выделенная поставщиком общих служб, должна быть освобождена путем вызова функции [**фриконтекстбуффер**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) .

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|--------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Только для \[ классических приложений Windows Vista\]<br/>                                                         |
| Минимальная версия сервера<br/> | \[Только для настольных приложений Windows Server 2008\]<br/>                                                   |
| Header<br/>                   | <dl> <dt>SSPI. h (включая Security. h)</dt> </dl> |
| Библиотека<br/>                  | <dl> <dt>Secur32. lib</dt> </dl>                 |
| DLL<br/>                      | <dl> <dt>Secur32.dll</dt> </dl>                 |
| Имя в кодировке Юникод и ANSI<br/>   | **Куериконтекстаттрибутесв** (Юникод) и **куериконтекстаттрибутеса** (ANSI)<br/>                |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[Функции SSPI](authentication-functions.md#sspi-functions)
</dt> <dt>

[**\_контекст сертификата**](/windows/win32/api/wincrypt/ns-wincrypt-cert_context)
</dt> <dt>

[**фриконтекстбуффер**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer)
</dt> <dt>

[**Секпкгконтекст \_ клиенткредс**](/windows/win32/api/credssp/ns-credssp-secpkgcontext_clientcreds)
</dt> <dt>

[**\_Размеры секпкгконтекст**](/windows/win32/api/sspi/ns-sspi-secpkgcontext_sizes)
</dt> </dl>

 

 
