---
description: После получения запроса от сервера клиент создает ответ на запрос дайджеста, вызывая функцию InitializeSecurityContext (Digest).
ms.assetid: b26b5676-a614-4017-a4e5-a5395292a667
title: Создание ответа на запрос дайджеста
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8b577334348745425db23d3de41431ba4e37b7af
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103912495"
---
# <a name="generating-the-digest-challenge-response"></a><span data-ttu-id="dbcdd-103">Создание ответа на запрос дайджеста</span><span class="sxs-lookup"><span data-stu-id="dbcdd-103">Generating the Digest Challenge Response</span></span>

<span data-ttu-id="dbcdd-104">После получения запроса от сервера клиент создает ответ на запрос дайджеста, вызывая функцию [**InitializeSecurityContext (Digest)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) .</span><span class="sxs-lookup"><span data-stu-id="dbcdd-104">After receiving a challenge from the server, the client creates the Digest challenge response by calling the [**InitializeSecurityContext (Digest)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) function.</span></span> <span data-ttu-id="dbcdd-105">Эта функция создает отпечаток [*ХЭША*](/windows/desktop/SecGloss/h-gly) MD5, используя сведения о запрошенном ресурсе и данных из запроса, и выводит маркер безопасности, который представляет [*контекст*](/windows/desktop/SecGloss/s-gly)частичной безопасности.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-105">This function generates an MD5 [*hash*](/windows/desktop/SecGloss/h-gly) fingerprint by using information about the requested resource and data from the challenge, and outputs a security token that represents a partial [*security context*](/windows/desktop/SecGloss/s-gly).</span></span> <span data-ttu-id="dbcdd-106">Для завершения проверки подлинности клиент должен вернуть маркер серверу, который выдал запрос.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-106">To complete the authentication, the client must return the token to the server that issued the challenge.</span></span>

<span data-ttu-id="dbcdd-107">В следующей таблице описаны параметры [*функции*](/windows/desktop/SecGloss/c-gly) [**InitializeSecurityContext (Digest)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) и значения, которые необходимо указать при формировании ответа на запрос дайджеста.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-107">The following table describes the parameters of the [**InitializeSecurityContext (Digest)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) [*function*](/windows/desktop/SecGloss/c-gly), and the values to supply when constructing a Digest challenge response.</span></span>



| <span data-ttu-id="dbcdd-108">Параметр</span><span class="sxs-lookup"><span data-stu-id="dbcdd-108">Parameter</span></span>                  | <span data-ttu-id="dbcdd-109">Описание</span><span class="sxs-lookup"><span data-stu-id="dbcdd-109">Description</span></span>                                                                                                                                                                                               |
|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="dbcdd-110">*фконтекстрек*</span><span class="sxs-lookup"><span data-stu-id="dbcdd-110">*fContextReq*</span></span><br/>   | <span data-ttu-id="dbcdd-111">Атрибуты контекста безопасности, запрашиваемые клиентом.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-111">The security context attributes requested by the client.</span></span> <span data-ttu-id="dbcdd-112">Дополнительные сведения см. в разделе Требования к контексту ответа дайджест-запроса.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-112">For more information, see Digest Challenge Response Context Requirements.</span></span><br/>                                                             |
| <span data-ttu-id="dbcdd-113">*псзтаржетнаме*</span><span class="sxs-lookup"><span data-stu-id="dbcdd-113">*pszTargetName*</span></span><br/> | <span data-ttu-id="dbcdd-114">HTTP: строка с завершающим нулем, указывающая целевой URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-114">HTTP: Null-terminated string that specifies the target URL.</span></span><br/> <span data-ttu-id="dbcdd-115">SASL: строка с завершающим нулем, указывающая целевой объект DNS/SPN.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-115">SASL: Null-terminated string that specifies the DNS/SPN target.</span></span><br/>                                                         |
| <span data-ttu-id="dbcdd-116">*пинпут*</span><span class="sxs-lookup"><span data-stu-id="dbcdd-116">*pInput*</span></span><br/>        | <span data-ttu-id="dbcdd-117">Буферы, содержащие сведения, необходимые для дайджест-поставщика общих служб.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-117">Buffers that contain information required by the Digest SSP.</span></span> <span data-ttu-id="dbcdd-118">Дополнительные сведения см. [в разделе Входные буферы для ответа на запрос дайджеста](input-buffers-for-the-digest-challenge-response.md).</span><span class="sxs-lookup"><span data-stu-id="dbcdd-118">For more information, see [Input Buffers for the Digest Challenge Response](input-buffers-for-the-digest-challenge-response.md).</span></span><br/> |
| <span data-ttu-id="dbcdd-119">*пфконтекстаттр*</span><span class="sxs-lookup"><span data-stu-id="dbcdd-119">*pfContextAttr*</span></span><br/> | <span data-ttu-id="dbcdd-120">Получает атрибуты, поддерживаемые возвращенным контекстом безопасности.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-120">Receives the attributes supported by the returned security context.</span></span> <span data-ttu-id="dbcdd-121">Дополнительные сведения см. в разделе Требования к контексту ответа дайджест-запроса.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-121">For more information, see Digest Challenge Response Context Requirements.</span></span><br/>                                                  |
| <span data-ttu-id="dbcdd-122">*паутпут*</span><span class="sxs-lookup"><span data-stu-id="dbcdd-122">*pOutput*</span></span><br/>       | <span data-ttu-id="dbcdd-123">Адрес \_ буфера типа токена pvbuffer, который получает маркер безопасности для отправки обратно на сервер.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-123">Address of a SECBUFFER\_TOKEN type buffer that receives a security token to send back to the server.</span></span><br/>                                                                                           |



 

## <a name="digest-challenge-response-context-requirements"></a><span data-ttu-id="dbcdd-124">Требования к контексту ответа дайджест-запроса</span><span class="sxs-lookup"><span data-stu-id="dbcdd-124">Digest Challenge Response Context Requirements</span></span>

<span data-ttu-id="dbcdd-125">Требования к контексту — это флаги, которые определяют:</span><span class="sxs-lookup"><span data-stu-id="dbcdd-125">Context requirements are flags that determine:</span></span>

-   <span data-ttu-id="dbcdd-126">Определяет, функционируют ли Microsoft Digest как механизм SASL или протокол проверки подлинности HTTP.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-126">Whether Microsoft Digest functions as a SASL mechanism or HTTP authentication protocol.</span></span>
-   <span data-ttu-id="dbcdd-127">Качество защиты, поддерживаемое [*контекстом безопасности*](/windows/desktop/SecGloss/s-gly) , совместно используемым клиентом и сервером.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-127">The quality of protection supported by the [*security context*](/windows/desktop/SecGloss/s-gly) shared by the client and server.</span></span>

<span data-ttu-id="dbcdd-128">По умолчанию Microsoft Digest функционирует как механизм SASL.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-128">By default, Microsoft Digest functions as a SASL mechanism.</span></span>

<span data-ttu-id="dbcdd-129">Требования к контексту указываются как флаги, передаваемые в параметр *фконтекстрек* функции [**InitializeSecurityContext**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) .</span><span class="sxs-lookup"><span data-stu-id="dbcdd-129">Context requirements are specified as flags passed to the *fContextReq* parameter of the [**InitializeSecurityContext**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) function.</span></span> <span data-ttu-id="dbcdd-130">Флаги влияют на качество защиты контекста безопасности, управляя директивой КОП в ответе на запрос.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-130">The flags affect the security context's quality of protection by controlling the qop directive in the challenge response.</span></span>

<span data-ttu-id="dbcdd-131">По умолчанию директива КОП имеет значение "auth".</span><span class="sxs-lookup"><span data-stu-id="dbcdd-131">By default, the qop directive is set to "auth".</span></span> <span data-ttu-id="dbcdd-132">Чтобы создать ответ на запрос, который устанавливает для КОП значение "auth-int", необходимо следующее:</span><span class="sxs-lookup"><span data-stu-id="dbcdd-132">To generate a challenge response that sets qop to "auth-int", the following must occur:</span></span>

1.  <span data-ttu-id="dbcdd-133">Для запроса дайджеста должна быть задана директива КОП с параметром "auth-int".</span><span class="sxs-lookup"><span data-stu-id="dbcdd-133">The Digest challenge must have had a qop directive set to "auth-int".</span></span>
2.  <span data-ttu-id="dbcdd-134">Клиент должен указать один или несколько из следующих флагов:</span><span class="sxs-lookup"><span data-stu-id="dbcdd-134">The client must specify one or more of the following flags:</span></span>

    -   <span data-ttu-id="dbcdd-135">\_ \_ целостность требований ISC</span><span class="sxs-lookup"><span data-stu-id="dbcdd-135">ISC\_REQ\_INTEGRITY</span></span>
    -   <span data-ttu-id="dbcdd-136">\_ \_ обнаружение воспроизведения на наличие заявок на ISC \_</span><span class="sxs-lookup"><span data-stu-id="dbcdd-136">ISC\_REQ\_REPLAY\_DETECT</span></span>
    -   <span data-ttu-id="dbcdd-137">\_ \_ Обнаружение последовательности заявок \_ ISC</span><span class="sxs-lookup"><span data-stu-id="dbcdd-137">ISC\_REQ\_SEQUENCE\_DETECT</span></span>

<span data-ttu-id="dbcdd-138">Только для SASL: создание ответа на запрос с директивой КОП, для которого задано значение "auth-conf", с указанием \_ \_ флага конфиденциальности ISC.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-138">For SASL only: Generate a challenge response with the qop directive set to "auth-conf" by specifying the ISC\_REQ\_CONFIDENTIALITY flag.</span></span> <span data-ttu-id="dbcdd-139">Поскольку этот флаг не является допустимым для проверки подлинности HTTP, он не может использоваться с \_ \_ флагом HTTP ISC.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-139">Because this flag is not valid for HTTP authentication, it cannot be used with the ISC\_REQ\_HTTP flag.</span></span>

## <a name="verifying-the-quality-of-protection"></a><span data-ttu-id="dbcdd-140">Проверка качества защиты</span><span class="sxs-lookup"><span data-stu-id="dbcdd-140">Verifying the Quality of Protection</span></span>

<span data-ttu-id="dbcdd-141">Клиент должен проверить флаги атрибутов контекста безопасности, возвращаемые в параметре *пфконтекстаттр* функции [**InitializeSecurityContext**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) .</span><span class="sxs-lookup"><span data-stu-id="dbcdd-141">The client must examine the security context attributes flags returned in the [**InitializeSecurityContext**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) function's *pfContextAttr* parameter.</span></span> <span data-ttu-id="dbcdd-142">Клиент должен отправить ответ на запрос серверу только в том случае, если качество защиты, обозначенное флагами, достаточно для целей.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-142">The client should send the challenge response to the server only if the quality of protection indicated by the flags is sufficient for its purposes.</span></span> <span data-ttu-id="dbcdd-143">Соответствующие флаги могут быть любым сочетанием следующих.</span><span class="sxs-lookup"><span data-stu-id="dbcdd-143">The relevant flags can be any combination of the following:</span></span>

-   <span data-ttu-id="dbcdd-144">\_ \_ целостность возврата ISC</span><span class="sxs-lookup"><span data-stu-id="dbcdd-144">ISC\_RET\_INTEGRITY</span></span>
-   <span data-ttu-id="dbcdd-145">Обнаружение повторного \_ воспроизведения ISC RET \_ \_</span><span class="sxs-lookup"><span data-stu-id="dbcdd-145">ISC\_RET\_REPLAY\_DETECT</span></span>
-   <span data-ttu-id="dbcdd-146">\_ \_ Обнаружение последовательности возврата \_ ISC</span><span class="sxs-lookup"><span data-stu-id="dbcdd-146">ISC\_RET\_SEQUENCE\_DETECT</span></span>
-   <span data-ttu-id="dbcdd-147">\_Конфиденциальность возврата ISC \_ (только для контекстов SASL)</span><span class="sxs-lookup"><span data-stu-id="dbcdd-147">ISC\_RET\_CONFIDENTIALITY (SASL contexts only)</span></span>

<span data-ttu-id="dbcdd-148">Дополнительные сведения об директиве КОП см. в разделе [качество защиты и шифров](quality-of-protection-and-ciphers.md).</span><span class="sxs-lookup"><span data-stu-id="dbcdd-148">For more information about the qop directive, see [Quality of Protection and Ciphers](quality-of-protection-and-ciphers.md).</span></span>

<span data-ttu-id="dbcdd-149">Дополнительные сведения об директивах ответа на запрос см. [в разделе содержимое ответа на запрос дайджеста](contents-of-a-digest-challenge-response.md).</span><span class="sxs-lookup"><span data-stu-id="dbcdd-149">For more information about challenge response directives, see [Contents of a Digest Challenge Response](contents-of-a-digest-challenge-response.md).</span></span>

 

