---
description: Позволяет компоненту сервера транспортного приложения устанавливать [*контекст безопасности*](../secgloss/s-gly.md) между сервером и удаленным клиентом.
ms.assetid: eaa15fed-4438-4e43-9be3-aa100ca453c7
title: Функция AcceptSecurityContext (General) (SSPI. h)
ms.topic: reference
ms.date: 07/25/2019
ms.openlocfilehash: 41b3220e9304f63e1a6ac4f77b609e3cbbac8741
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103910351"
---
# <a name="acceptsecuritycontext-general-function"></a><span data-ttu-id="e96ab-103">Функция AcceptSecurityContext (общая)</span><span class="sxs-lookup"><span data-stu-id="e96ab-103">AcceptSecurityContext (General) function</span></span>

<span data-ttu-id="e96ab-104">Функция **AcceptSecurityContext (General)** позволяет компоненту сервера транспортного приложения устанавливать [*контекст безопасности*](../secgloss/s-gly.md) между сервером и удаленным клиентом.</span><span class="sxs-lookup"><span data-stu-id="e96ab-104">The **AcceptSecurityContext (General)** function enables the server component of a transport application to establish a [*security context*](../secgloss/s-gly.md) between the server and a remote client.</span></span> <span data-ttu-id="e96ab-105">Удаленный клиент использует функцию [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md) для запуска процесса установки [*контекста безопасности*](../secgloss/s-gly.md).</span><span class="sxs-lookup"><span data-stu-id="e96ab-105">The remote client uses the [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md) function to start the process of establishing a [*security context*](../secgloss/s-gly.md).</span></span> <span data-ttu-id="e96ab-106">Серверу может потребоваться один или несколько маркеров ответа от удаленного клиента для завершения установки [*контекста безопасности*](../secgloss/s-gly.md).</span><span class="sxs-lookup"><span data-stu-id="e96ab-106">The server can require one or more reply tokens from the remote client to complete establishing the [*security context*](../secgloss/s-gly.md).</span></span>

<span data-ttu-id="e96ab-107">Сведения об использовании этой функции с конкретным [*поставщиком поддержки безопасности*](../secgloss/s-gly.md) (SSP) см. в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="e96ab-107">For information about using this function with a specific [*security support provider*](../secgloss/s-gly.md) (SSP), see the following topics.</span></span>



| <span data-ttu-id="e96ab-108">Раздел</span><span class="sxs-lookup"><span data-stu-id="e96ab-108">Topic</span></span>                                                                          | <span data-ttu-id="e96ab-109">Описание</span><span class="sxs-lookup"><span data-stu-id="e96ab-109">Description</span></span>                                                                                                                                                                                                                                                                      |
|--------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="e96ab-110">**AcceptSecurityContext (CredSSP)**</span><span class="sxs-lookup"><span data-stu-id="e96ab-110">**AcceptSecurityContext (CredSSP)**</span></span>](acceptsecuritycontext--credssp.md)     | <span data-ttu-id="e96ab-111">Позволяет компоненту сервера транспортного приложения устанавливать [*контекст безопасности*](../secgloss/s-gly.md) между сервером и удаленным клиентом с помощью поставщика службы поддержки безопасности учетных данных (CredSSP).</span><span class="sxs-lookup"><span data-stu-id="e96ab-111">Allows the server component of a transport application establish a [*security context*](../secgloss/s-gly.md) between the server and a remote client by using Credential Security Support Provider (CredSSP).</span></span><br/> |
| [<span data-ttu-id="e96ab-112">**AcceptSecurityContext (дайджест)**</span><span class="sxs-lookup"><span data-stu-id="e96ab-112">**AcceptSecurityContext (Digest)**</span></span>](acceptsecuritycontext--digest.md)       | <span data-ttu-id="e96ab-113">Позволяет компоненту сервера транспортного приложения устанавливать [*контекст безопасности*](../secgloss/s-gly.md) между сервером и удаленным клиентом, использующим дайджест.</span><span class="sxs-lookup"><span data-stu-id="e96ab-113">Enables the server component of a transport application to establish a [*security context*](../secgloss/s-gly.md) between the server and a remote client that is using Digest.</span></span><br/>                                                                                                                  |
| [<span data-ttu-id="e96ab-114">**AcceptSecurityContext (Kerberos)**</span><span class="sxs-lookup"><span data-stu-id="e96ab-114">**AcceptSecurityContext (Kerberos)**</span></span>](acceptsecuritycontext--kerberos.md)   | <span data-ttu-id="e96ab-115">Позволяет компоненту сервера транспортного приложения устанавливать [*контекст безопасности*](../secgloss/s-gly.md) между сервером и удаленным клиентом, использующим Kerberos.</span><span class="sxs-lookup"><span data-stu-id="e96ab-115">Enables the server component of a transport application to establish a [*security context*](../secgloss/s-gly.md) between the server and a remote client that is using Kerberos.</span></span><br/>                                                                                                                |
| [<span data-ttu-id="e96ab-116">**AcceptSecurityContext (согласование)**</span><span class="sxs-lookup"><span data-stu-id="e96ab-116">**AcceptSecurityContext (Negotiate)**</span></span>](acceptsecuritycontext--negotiate.md) | <span data-ttu-id="e96ab-117">Позволяет компоненту сервера транспортного приложения устанавливать [*контекст безопасности*](../secgloss/s-gly.md) между сервером и удаленным клиентом, использующим Negotiate.</span><span class="sxs-lookup"><span data-stu-id="e96ab-117">Enables the server component of a transport application to establish a [*security context*](../secgloss/s-gly.md) between the server and a remote client that is using Negotiate.</span></span><br/>                                                                                                               |
| [<span data-ttu-id="e96ab-118">**AcceptSecurityContext (NTLM)**</span><span class="sxs-lookup"><span data-stu-id="e96ab-118">**AcceptSecurityContext (NTLM)**</span></span>](acceptsecuritycontext--ntlm.md)           | <span data-ttu-id="e96ab-119">Позволяет компоненту сервера транспортного приложения устанавливать [*контекст безопасности*](../secgloss/s-gly.md) между сервером и удаленным клиентом, использующим NTLM.</span><span class="sxs-lookup"><span data-stu-id="e96ab-119">Enables the server component of a transport application to establish a [*security context*](../secgloss/s-gly.md) between the server and a remote client that is using NTLM.</span></span><br/>                                                                                                                    |
| [<span data-ttu-id="e96ab-120">**AcceptSecurityContext (Schannel)**</span><span class="sxs-lookup"><span data-stu-id="e96ab-120">**AcceptSecurityContext (Schannel)**</span></span>](acceptsecuritycontext--schannel.md)   | <span data-ttu-id="e96ab-121">Позволяет компоненту сервера транспортного приложения устанавливать [*контекст безопасности*](../secgloss/s-gly.md) между сервером и удаленным клиентом, использующим SChannel.</span><span class="sxs-lookup"><span data-stu-id="e96ab-121">Enables the server component of a transport application to establish a [*security context*](../secgloss/s-gly.md) between the server and a remote client that is using Schannel.</span></span><br/>                                                                                                                |



 

## <a name="syntax"></a><span data-ttu-id="e96ab-122">Синтаксис</span><span class="sxs-lookup"><span data-stu-id="e96ab-122">Syntax</span></span>


```C++
SECURITY_STATUS SEC_Entry AcceptSecurityContext(
  _In_opt_    PCredHandle    phCredential,
  _Inout_opt_ PCtxtHandle    phContext,
  _In_opt_    PSecBufferDesc pInput,
  _In_        ULONG          fContextReq,
  _In_        ULONG          TargetDataRep,
  _Inout_opt_ PCtxtHandle    phNewContext,
  _Inout_opt_ PSecBufferDesc pOutput,
  _Out_       PULONG         pfContextAttr,
  _Out_opt_   PTimeStamp     ptsExpiry
);
```



## <a name="parameters"></a><span data-ttu-id="e96ab-123">Параметры</span><span class="sxs-lookup"><span data-stu-id="e96ab-123">Parameters</span></span>

<dl> <dt>

<span data-ttu-id="e96ab-124">*фкредентиал* \[ в необязательное\]</span><span class="sxs-lookup"><span data-stu-id="e96ab-124">*phCredential* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="e96ab-125">Маркер учетных данных сервера.</span><span class="sxs-lookup"><span data-stu-id="e96ab-125">A handle to the credentials of the server.</span></span> <span data-ttu-id="e96ab-126">Сервер вызывает функцию [**AcquireCredentialsHandle (General)**](acquirecredentialshandle--general.md) с \_ \_ флагом SECPKG CRED Inbound или SECPKG CRED, \_ \_ установленным для получения этого маркера.</span><span class="sxs-lookup"><span data-stu-id="e96ab-126">The server calls the [**AcquireCredentialsHandle (General)**](acquirecredentialshandle--general.md) function with either the SECPKG\_CRED\_INBOUND or SECPKG\_CRED\_BOTH flag set to retrieve this handle.</span></span>

</dd> <dt>

<span data-ttu-id="e96ab-127">*фконтекст* \[ в, out\]</span><span class="sxs-lookup"><span data-stu-id="e96ab-127">*phContext* \[in, out\]</span></span>
</dt> <dd>

<span data-ttu-id="e96ab-128">Указатель на структуру [кткссандле](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="e96ab-128">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="e96ab-129">При первом вызове метода **AcceptSecurityContext (General)** этот указатель имеет **значение NULL**.</span><span class="sxs-lookup"><span data-stu-id="e96ab-129">On the first call to **AcceptSecurityContext (General)**, this pointer is **NULL**.</span></span> <span data-ttu-id="e96ab-130">При последующих вызовах *фконтекст* — это описатель частично сформированного контекста, который был возвращен в параметре *фневконтекст* при первом вызове.</span><span class="sxs-lookup"><span data-stu-id="e96ab-130">On subsequent calls, *phContext* is the handle to the partially formed context that was returned in the *phNewContext* parameter by the first call.</span></span>

</dd> <dt>

<span data-ttu-id="e96ab-131">*пинпут* \[ в необязательное\]</span><span class="sxs-lookup"><span data-stu-id="e96ab-131">*pInput* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="e96ab-132">Указатель на структуру [**секбуффердеск**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) , созданную клиентским вызовом [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md) , который содержит дескриптор входного буфера.</span><span class="sxs-lookup"><span data-stu-id="e96ab-132">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure generated by a client call to [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md) that contains the input buffer descriptor.</span></span>

<span data-ttu-id="e96ab-133">При использовании поставщика общих служб SChannel первый буфер должен иметь тип \_ Token pvbuffer и содержать маркер безопасности, полученный от клиента.</span><span class="sxs-lookup"><span data-stu-id="e96ab-133">When using the Schannel SSP, the first buffer must be of type SECBUFFER\_TOKEN and contain the security token received from the client.</span></span> <span data-ttu-id="e96ab-134">Второй буфер должен иметь тип PVBUFFER \_ Empty.</span><span class="sxs-lookup"><span data-stu-id="e96ab-134">The second buffer should be of type SECBUFFER\_EMPTY.</span></span>

<span data-ttu-id="e96ab-135">При использовании SSP Negotiate, Kerberos или NTLM сведения о привязке канала можно указать, передав структуру [**pvbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) **\_ \_ привязок каналов типа pvbuffer** в дополнение к буферам, созданным вызовом функции [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md) .</span><span class="sxs-lookup"><span data-stu-id="e96ab-135">When using the Negotiate, Kerberos, or NTLM SSPs, channel binding information can be specified by passing in a [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) structure of type **SECBUFFER\_CHANNEL\_BINDINGS** in addition to the buffers generated by the call to the [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md) function.</span></span> <span data-ttu-id="e96ab-136">Сведения о привязке канала для буфера привязки канала можно получить, вызвав функцию [**QueryContextAttributes (Schannel)**](querycontextattributes--schannel.md) в контексте SChannel, который клиент использовал для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="e96ab-136">The channel binding information for the channel binding buffer can be obtained by calling the [**QueryContextAttributes (Schannel)**](querycontextattributes--schannel.md) function on the Schannel context the client used to authenticate.</span></span>

</dd> <dt>

<span data-ttu-id="e96ab-137">*фконтекстрек* \[ окне\]</span><span class="sxs-lookup"><span data-stu-id="e96ab-137">*fContextReq* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="e96ab-138">Битовые флаги, указывающие атрибуты, необходимые серверу для установки контекста.</span><span class="sxs-lookup"><span data-stu-id="e96ab-138">Bit flags that specify the attributes required by the server to establish the context.</span></span> <span data-ttu-id="e96ab-139">Битовые флаги можно комбинировать с помощью операций побитового **или** .</span><span class="sxs-lookup"><span data-stu-id="e96ab-139">Bit flags can be combined by using bitwise-**OR** operations.</span></span> <span data-ttu-id="e96ab-140">Этот параметр может принимать одно или несколько следующих значений.</span><span class="sxs-lookup"><span data-stu-id="e96ab-140">This parameter can be one or more of the following values.</span></span>



| <span data-ttu-id="e96ab-141">Значение</span><span class="sxs-lookup"><span data-stu-id="e96ab-141">Value</span></span>                                                                                                                                                                                                                                          | <span data-ttu-id="e96ab-142">Значение</span><span class="sxs-lookup"><span data-stu-id="e96ab-142">Meaning</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="ASC_REQ_ALLOCATE_MEMORY"></span><span id="asc_req_allocate_memory"></span><dl> <span data-ttu-id="e96ab-143"><dt>**по УБЫВАНИЮ \_ требований \_ выделить \_ память**</dt></span><span class="sxs-lookup"><span data-stu-id="e96ab-143"><dt>**ASC\_REQ\_ALLOCATE\_MEMORY**</dt></span></span> </dl>                                                  | <span data-ttu-id="e96ab-144">Digest и SChannel будут выделять выходные буферы.</span><span class="sxs-lookup"><span data-stu-id="e96ab-144">Digest and Schannel will allocate output buffers for you.</span></span> <span data-ttu-id="e96ab-145">Завершив использование выходных буферов, освободите их, вызвав функцию [**фриконтекстбуффер**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) .</span><span class="sxs-lookup"><span data-stu-id="e96ab-145">When you have finished using the output buffers, free them by calling the [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) function.</span></span><br/>                                                                                                                                                                                                                                                                                |
| <span id="ASC_REQ_ALLOW_MISSING_BINDINGS"></span><span id="asc_req_allow_missing_bindings"></span><dl> <span data-ttu-id="e96ab-146"><dt>**в ASC \_ req \_ разрешены \_ отсутствующие \_ привязки**</dt></span><span class="sxs-lookup"><span data-stu-id="e96ab-146"><dt>**ASC\_REQ\_ALLOW\_MISSING\_BINDINGS**</dt></span></span> </dl>                            | <span data-ttu-id="e96ab-147">Указывает, что дайджест не требует привязки каналов для внутренних и внешних каналов.</span><span class="sxs-lookup"><span data-stu-id="e96ab-147">Indicates that Digest does not require channel bindings for both inner and outer channels.</span></span> <span data-ttu-id="e96ab-148">Это значение используется для обратной совместимости, если неизвестна поддержка привязки канала конечной точки.</span><span class="sxs-lookup"><span data-stu-id="e96ab-148">This value is used for backward compatibility when support for endpoint channel binding is not known.</span></span><br/> <span data-ttu-id="e96ab-149">Это значение взаимоисключающее с **\_ \_ \_ привязками прокси-сервера ASC req**.</span><span class="sxs-lookup"><span data-stu-id="e96ab-149">This value is mutually exclusive with **ASC\_REQ\_PROXY\_BINDINGS**.</span></span><br/> <span data-ttu-id="e96ab-150">Это значение поддерживается только для дайджеста SSP.</span><span class="sxs-lookup"><span data-stu-id="e96ab-150">This value is supported only by the Digest SSP.</span></span><br/> <span data-ttu-id="e96ab-151">Windows **server 2008, Windows Vista, Windows server 2003 и Windows XP:** Это значение не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="e96ab-151">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** This value is not supported.</span></span><br/> <br/> |
| <span id="ASC_REQ_CONFIDENTIALITY"></span><span id="asc_req_confidentiality"></span><dl> <span data-ttu-id="e96ab-152"><dt>**конфиденциальность по УБЫВАНИЮ \_ требований \_**</dt></span><span class="sxs-lookup"><span data-stu-id="e96ab-152"><dt>**ASC\_REQ\_CONFIDENTIALITY**</dt></span></span> </dl>                                                   | <span data-ttu-id="e96ab-153">Шифрование и расшифровка сообщений.</span><span class="sxs-lookup"><span data-stu-id="e96ab-153">Encrypt and decrypt messages.</span></span> <br/> <span data-ttu-id="e96ab-154">Хэш-код дайджеста поддерживает этот флаг только для SASL.</span><span class="sxs-lookup"><span data-stu-id="e96ab-154">The Digest SSP supports this flag for SASL only.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                  |
| <span id="ASC_REQ_CONNECTION"></span><span id="asc_req_connection"></span><dl> <span data-ttu-id="e96ab-155"><dt>**\_Подключение ASC req \_**</dt></span><span class="sxs-lookup"><span data-stu-id="e96ab-155"><dt>**ASC\_REQ\_CONNECTION**</dt></span></span> </dl>                                                                  | <span data-ttu-id="e96ab-156">[*Контекст безопасности*](../secgloss/s-gly.md) не будет работать с сообщениями форматирования.</span><span class="sxs-lookup"><span data-stu-id="e96ab-156">The [*security context*](../secgloss/s-gly.md) will not handle formatting messages.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                   |
| <span id="ASC_REQ_DELEGATE"></span><span id="asc_req_delegate"></span><dl> <span data-ttu-id="e96ab-157"><dt>**\_ДЕЛЕГАТ ASC req \_**</dt></span><span class="sxs-lookup"><span data-stu-id="e96ab-157"><dt>**ASC\_REQ\_DELEGATE**</dt></span></span> </dl>                                                                        | <span data-ttu-id="e96ab-158">Серверу разрешено олицетворять клиента.</span><span class="sxs-lookup"><span data-stu-id="e96ab-158">The server is allowed to impersonate the client.</span></span> <span data-ttu-id="e96ab-159">Допустимо для Kerberos.</span><span class="sxs-lookup"><span data-stu-id="e96ab-159">Valid for Kerberos.</span></span> <span data-ttu-id="e96ab-160">Игнорировать этот флаг для [*ограниченного делегирования*](../secgloss/c-gly.md).</span><span class="sxs-lookup"><span data-stu-id="e96ab-160">Ignore this flag for [*constrained delegation*](../secgloss/c-gly.md).</span></span><br/>                                                                                                                                                                                                                                                             |
| <span id="ASC_REQ_EXTENDED_ERROR"></span><span id="asc_req_extended_error"></span><dl> <span data-ttu-id="e96ab-161"><dt>**\_ \_ Расширенная ошибка по убыванию требований \_**</dt></span><span class="sxs-lookup"><span data-stu-id="e96ab-161"><dt>**ASC\_REQ\_EXTENDED\_ERROR**</dt></span></span> </dl>                                                     | <span data-ttu-id="e96ab-162">При возникновении ошибок удаленная сторона будет уведомлена.</span><span class="sxs-lookup"><span data-stu-id="e96ab-162">When errors occur, the remote party will be notified.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span id="ASC_REQ_HTTP__0x10000000_"></span><span id="asc_req_http__0x10000000_"></span><span id="ASC_REQ_HTTP__0X10000000_"></span><dl> <span data-ttu-id="e96ab-163"><dt>**ASC \_ req \_ http (0x10000000)**</dt></span><span class="sxs-lookup"><span data-stu-id="e96ab-163"><dt>**ASC\_REQ\_HTTP (0x10000000)**</dt></span></span> </dl> | <span data-ttu-id="e96ab-164">Используйте дайджест для HTTP.</span><span class="sxs-lookup"><span data-stu-id="e96ab-164">Use Digest for HTTP.</span></span> <span data-ttu-id="e96ab-165">Пропустите этот флаг, чтобы использовать дайджест в качестве механизма SASL.</span><span class="sxs-lookup"><span data-stu-id="e96ab-165">Omit this flag to use Digest as an SASL mechanism.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                     |
| <span id="ASC_REQ_INTEGRITY"></span><span id="asc_req_integrity"></span><dl> <span data-ttu-id="e96ab-166"><dt>**\_ \_ целостность требований ASC**</dt></span><span class="sxs-lookup"><span data-stu-id="e96ab-166"><dt>**ASC\_REQ\_INTEGRITY**</dt></span></span> </dl>                                                                     | <span data-ttu-id="e96ab-167">Подписывание сообщений и проверка подписей.</span><span class="sxs-lookup"><span data-stu-id="e96ab-167">Sign messages and verify signatures.</span></span><br/> <span data-ttu-id="e96ab-168">Канал Schannel не поддерживает этот флаг.</span><span class="sxs-lookup"><span data-stu-id="e96ab-168">Schannel does not support this flag.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                        |
| <span id="ASC_REQ_MUTUAL_AUTH"></span><span id="asc_req_mutual_auth"></span><dl> <span data-ttu-id="e96ab-169"><dt>**\_ \_ взаимная \_ Проверка подлинности по убыванию требований**</dt></span><span class="sxs-lookup"><span data-stu-id="e96ab-169"><dt>**ASC\_REQ\_MUTUAL\_AUTH**</dt></span></span> </dl>                                                              | <span data-ttu-id="e96ab-170">Клиент должен предоставить сертификат, который будет использоваться для проверки подлинности клиента.</span><span class="sxs-lookup"><span data-stu-id="e96ab-170">The client is required to supply a certificate to be used for client authentication.</span></span><br/> <span data-ttu-id="e96ab-171">Этот флаг поддерживается только SChannel.</span><span class="sxs-lookup"><span data-stu-id="e96ab-171">This flag is supported only by Schannel.</span></span><br/>                                                                                                                                                                                                                                                                                                                                    |
| <span id="ASC_REQ_PROXY_BINDINGS"></span><span id="asc_req_proxy_bindings"></span><dl> <span data-ttu-id="e96ab-172"><dt>**\_ \_ привязка прокси-сервера ASC req \_**</dt></span><span class="sxs-lookup"><span data-stu-id="e96ab-172"><dt>**ASC\_REQ\_PROXY\_BINDINGS**</dt></span></span> </dl>                                                     | <span data-ttu-id="e96ab-173">Указывает, что для дайджеста требуется привязка канала.</span><span class="sxs-lookup"><span data-stu-id="e96ab-173">Indicates that Digest requires channel binding.</span></span><br/> <span data-ttu-id="e96ab-174">Это значение взаимоисключающее с параметром **ASC \_ req \_ разрешает \_ отсутствие \_ привязок**.</span><span class="sxs-lookup"><span data-stu-id="e96ab-174">This value is mutually exclusive with **ASC\_REQ\_ALLOW\_MISSING\_BINDINGS**.</span></span><br/> <span data-ttu-id="e96ab-175">Это значение поддерживается только для дайджеста SSP.</span><span class="sxs-lookup"><span data-stu-id="e96ab-175">This value is supported only by the Digest SSP.</span></span><br/> <span data-ttu-id="e96ab-176">Windows **server 2008, Windows Vista, Windows server 2003 и Windows XP:** Это значение не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="e96ab-176">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** This value is not supported.</span></span><br/> <br/>                                                                                                                                         |
| <span id="ASC_REQ_REPLAY_DETECT"></span><span id="asc_req_replay_detect"></span><dl> <span data-ttu-id="e96ab-177"><dt>**Обнаружение повторного \_ воспроизведения требований ASC \_ \_**</dt></span><span class="sxs-lookup"><span data-stu-id="e96ab-177"><dt>**ASC\_REQ\_REPLAY\_DETECT**</dt></span></span> </dl>                                                        | <span data-ttu-id="e96ab-178">Обнаружение воспроизводимых пакетов.</span><span class="sxs-lookup"><span data-stu-id="e96ab-178">Detect replayed packets.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span id="ASC_REQ_SEQUENCE_DETECT"></span><span id="asc_req_sequence_detect"></span><dl> <span data-ttu-id="e96ab-179"><dt>**\_ \_ Обнаружение последовательности "ASC req" \_**</dt></span><span class="sxs-lookup"><span data-stu-id="e96ab-179"><dt>**ASC\_REQ\_SEQUENCE\_DETECT**</dt></span></span> </dl>                                                  | <span data-ttu-id="e96ab-180">Обнаружение сообщений, полученных за пределами последовательности.</span><span class="sxs-lookup"><span data-stu-id="e96ab-180">Detect messages received out of sequence.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| <span id="ASC_REQ_STREAM"></span><span id="asc_req_stream"></span><dl> <span data-ttu-id="e96ab-181"><dt>**\_поток требований \_ ASC**</dt></span><span class="sxs-lookup"><span data-stu-id="e96ab-181"><dt>**ASC\_REQ\_STREAM**</dt></span></span> </dl>                                                                              | <span data-ttu-id="e96ab-182">Поддерживать соединение с потоковой ориентацией.</span><span class="sxs-lookup"><span data-stu-id="e96ab-182">Support a stream-oriented connection.</span></span><br/> <span data-ttu-id="e96ab-183">Этот флаг поддерживается только SChannel.</span><span class="sxs-lookup"><span data-stu-id="e96ab-183">This flag is supported only by Schannel.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                   |



 

<span data-ttu-id="e96ab-184">Возможные флаги атрибутов и их значения см. в разделе [требования к контексту](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="e96ab-184">For possible attribute flags and their meanings, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="e96ab-185">Флаги, используемые для этого параметра, имеют префикс ASC \_ req, например, ASC \_ req \_ Delegate.</span><span class="sxs-lookup"><span data-stu-id="e96ab-185">Flags used for this parameter are prefixed with ASC\_REQ, for example, ASC\_REQ\_DELEGATE.</span></span>

<span data-ttu-id="e96ab-186">Запрошенные атрибуты могут не поддерживаться клиентом.</span><span class="sxs-lookup"><span data-stu-id="e96ab-186">The requested attributes may not be supported by the client.</span></span> <span data-ttu-id="e96ab-187">Дополнительные сведения см. в описании параметра *пфконтекстаттр* .</span><span class="sxs-lookup"><span data-stu-id="e96ab-187">For more information, see the *pfContextAttr* parameter.</span></span>

</dd> <dt>

<span data-ttu-id="e96ab-188">*Таржетдатареп* \[ окне\]</span><span class="sxs-lookup"><span data-stu-id="e96ab-188">*TargetDataRep* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="e96ab-189">Представление данных, например порядок байтов, на целевом объекте.</span><span class="sxs-lookup"><span data-stu-id="e96ab-189">The data representation, such as byte ordering, on the target.</span></span> <span data-ttu-id="e96ab-190">Этот параметр может быть либо \_ собственными \_ дреп, либо безопасностью \_ сети \_ дреп.</span><span class="sxs-lookup"><span data-stu-id="e96ab-190">This parameter can be either SECURITY\_NATIVE\_DREP or SECURITY\_NETWORK\_DREP.</span></span>

<span data-ttu-id="e96ab-191">Этот параметр не используется с SChannel или дайджест-SSP.</span><span class="sxs-lookup"><span data-stu-id="e96ab-191">This parameter is not used with Schannel or Digest SSPs.</span></span> <span data-ttu-id="e96ab-192">При использовании SChannel или дайджест-SSP укажите для этого параметра нулевое значение.</span><span class="sxs-lookup"><span data-stu-id="e96ab-192">When you use Schannel or Digest SSPs, specify zero for this parameter.</span></span>

</dd> <dt>

<span data-ttu-id="e96ab-193">*фневконтекст* \[ в, out, необязательно\]</span><span class="sxs-lookup"><span data-stu-id="e96ab-193">*phNewContext* \[in, out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="e96ab-194">Указатель на структуру [кткссандле](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="e96ab-194">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="e96ab-195">При первом вызове метода **AcceptSecurityContext (General)** этот указатель получает новый обработчик контекста.</span><span class="sxs-lookup"><span data-stu-id="e96ab-195">On the first call to **AcceptSecurityContext (General)**, this pointer receives the new context handle.</span></span> <span data-ttu-id="e96ab-196">При последующих вызовах *фневконтекст* может совпадать с маркером, указанным в параметре *фконтекст* .</span><span class="sxs-lookup"><span data-stu-id="e96ab-196">On subsequent calls, *phNewContext* can be the same as the handle specified in the *phContext* parameter.</span></span>

</dd> <dt>

<span data-ttu-id="e96ab-197">*паутпут* \[ в, out, необязательно\]</span><span class="sxs-lookup"><span data-stu-id="e96ab-197">*pOutput* \[in, out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="e96ab-198">Указатель на структуру [**секбуффердеск**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) , содержащую дескриптор выходного буфера.</span><span class="sxs-lookup"><span data-stu-id="e96ab-198">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure that contains the output buffer descriptor.</span></span> <span data-ttu-id="e96ab-199">Этот буфер отправляется клиенту для ввода в дополнительные вызовы [**InitializeSecurityContext (Общие)**](initializesecuritycontext--general.md).</span><span class="sxs-lookup"><span data-stu-id="e96ab-199">This buffer is sent to the client for input into additional calls to [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md).</span></span> <span data-ttu-id="e96ab-200">Выходной буфер может быть создан, даже если функция возвращает значение в СЕКУНДах \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="e96ab-200">An output buffer may be generated even if the function returns SEC\_E\_OK.</span></span> <span data-ttu-id="e96ab-201">Любой созданный буфер должен быть отправлен обратно клиентскому приложению.</span><span class="sxs-lookup"><span data-stu-id="e96ab-201">Any buffer generated must be sent back to the client application.</span></span>

<span data-ttu-id="e96ab-202">При использовании канала SChannel на выходе этот буфер получает маркер для [*контекста безопасности*](../secgloss/s-gly.md).</span><span class="sxs-lookup"><span data-stu-id="e96ab-202">When using Schannel, on output, this buffer receives a token for the [*security context*](../secgloss/s-gly.md).</span></span> <span data-ttu-id="e96ab-203">Маркер должен быть отправлен клиенту.</span><span class="sxs-lookup"><span data-stu-id="e96ab-203">The token must be sent to the client.</span></span> <span data-ttu-id="e96ab-204">Функция также может возвращать буфер типа PVBUFFER " \_ дополнительный".</span><span class="sxs-lookup"><span data-stu-id="e96ab-204">The function can also return a buffer of type SECBUFFER\_EXTRA.</span></span> <span data-ttu-id="e96ab-205">Кроме того, вызывающий объект должен передать в буфер типа **\_ Alert pvbuffer**.</span><span class="sxs-lookup"><span data-stu-id="e96ab-205">In addition, the caller must pass in a buffer of type **SECBUFFER\_ALERT**.</span></span> <span data-ttu-id="e96ab-206">В выходных данных, если создается предупреждение, этот буфер содержит сведения об этом предупреждении, и функция завершается ошибкой.</span><span class="sxs-lookup"><span data-stu-id="e96ab-206">On output, if an alert is generated, this buffer contains information about that alert, and the function fails.</span></span>

</dd> <dt>

<span data-ttu-id="e96ab-207">*пфконтекстаттр* \[ заполняет\]</span><span class="sxs-lookup"><span data-stu-id="e96ab-207">*pfContextAttr* \[out\]</span></span>
</dt> <dd>

<span data-ttu-id="e96ab-208">Указатель на переменную, которая получает набор битовых флагов, указывающих атрибуты установленного контекста.</span><span class="sxs-lookup"><span data-stu-id="e96ab-208">A pointer to a variable that receives a set of bit flags that indicate the attributes of the established context.</span></span> <span data-ttu-id="e96ab-209">Описание различных атрибутов см. в разделе [требования к контексту](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="e96ab-209">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="e96ab-210">Флаги, используемые для этого параметра, имеют префикс ASC \_ RET, например, ASC \_ RET \_ Delegate.</span><span class="sxs-lookup"><span data-stu-id="e96ab-210">Flags used for this parameter are prefixed with ASC\_RET, for example, ASC\_RET\_DELEGATE.</span></span>

<span data-ttu-id="e96ab-211">Не проверяйте атрибуты, связанные с безопасностью, до тех пор, пока завершающий вызов функции не вернется успешно.</span><span class="sxs-lookup"><span data-stu-id="e96ab-211">Do not check for security-related attributes until the final function call returns successfully.</span></span> <span data-ttu-id="e96ab-212">Флаги атрибутов, не связанные с безопасностью, такие как \_ \_ флаг ASC \_ , выделенная память, можно проверить перед окончательным возвратом.</span><span class="sxs-lookup"><span data-stu-id="e96ab-212">Attribute flags not related to security, such as the ASC\_RET\_ALLOCATED\_MEMORY flag, can be checked before the final return.</span></span>

</dd> <dt>

<span data-ttu-id="e96ab-213">*птстиместамп* \[ out, необязательно\]</span><span class="sxs-lookup"><span data-stu-id="e96ab-213">*ptsTimeStamp* \[out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="e96ab-214">Указатель на структуру [**метки времени**](timestamp.md) , которая получает время окончания срока действия контекста.</span><span class="sxs-lookup"><span data-stu-id="e96ab-214">A pointer to a [**TimeStamp**](timestamp.md) structure that receives the expiration time of the context.</span></span> <span data-ttu-id="e96ab-215">Рекомендуется, чтобы [*пакет безопасности*](../secgloss/s-gly.md) всегда возвращал это значение в местное время.</span><span class="sxs-lookup"><span data-stu-id="e96ab-215">We recommend that the [*security package*](../secgloss/s-gly.md) always return this value in local time.</span></span>

<span data-ttu-id="e96ab-216">Для этого параметра задается постоянное максимальное время.</span><span class="sxs-lookup"><span data-stu-id="e96ab-216">This parameter is set to a constant maximum time.</span></span> <span data-ttu-id="e96ab-217">Нет времени истечения срока действия для дайджест- [*контекста безопасности*](../secgloss/s-gly.md)или учетных данных, либо при использовании дайджест-поставщика общих служб.</span><span class="sxs-lookup"><span data-stu-id="e96ab-217">There is no expiration time for Digest [*security context*](../secgloss/s-gly.md)s or credentials or when using the Digest SSP.</span></span>

<span data-ttu-id="e96ab-218">Это необязательно при использовании поставщика общих служб SChannel.</span><span class="sxs-lookup"><span data-stu-id="e96ab-218">This is optional when using the Schannel SSP.</span></span> <span data-ttu-id="e96ab-219">Когда удаленная сторона предоставил сертификат, который будет использоваться для проверки подлинности, этот параметр получает срок действия этого сертификата.</span><span class="sxs-lookup"><span data-stu-id="e96ab-219">When the remote party has supplied a certificate to be used for authentication, this parameter receives the expiration time for that certificate.</span></span> <span data-ttu-id="e96ab-220">Если сертификат не был указан, возвращается максимальное значение времени.</span><span class="sxs-lookup"><span data-stu-id="e96ab-220">If no certificate was supplied, a maximum time value is returned.</span></span>

> [!Note]  
> <span data-ttu-id="e96ab-221">До последнего вызова процесса проверки подлинности время истечения срока действия контекста может быть неправильным, поскольку на последующих этапах согласования будут предоставлены дополнительные сведения.</span><span class="sxs-lookup"><span data-stu-id="e96ab-221">Until the last call of the authentication process, the expiration time for the context can be incorrect because more information will be provided during later stages of the negotiation.</span></span> <span data-ttu-id="e96ab-222">Таким образом, *птстиместамп* должен иметь **значение NULL** до последнего вызова функции.</span><span class="sxs-lookup"><span data-stu-id="e96ab-222">Therefore, *ptsTimeStamp* must be **NULL** until the last call to the function.</span></span>

 

</dd> </dl>

## <a name="return-value"></a><span data-ttu-id="e96ab-223">Возвращаемое значение</span><span class="sxs-lookup"><span data-stu-id="e96ab-223">Return value</span></span>

<span data-ttu-id="e96ab-224">Эта функция возвращает одно из следующих значений.</span><span class="sxs-lookup"><span data-stu-id="e96ab-224">This function returns one of the following values.</span></span>



<table><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><thead><tr class="header"><th><span data-ttu-id="e96ab-225">Возвращаемый код и значение</span><span class="sxs-lookup"><span data-stu-id="e96ab-225">Return code/value</span></span></th><th><span data-ttu-id="e96ab-226">Описание</span><span class="sxs-lookup"><span data-stu-id="e96ab-226">Description</span></span></th></tr></thead><tbody><tr class="odd"><td><dl> <span data-ttu-id="e96ab-227"><dt><strong>SEC_E_BAD_BINDINGS</strong></dt> <dt>0x80090346L</dt> </span><span class="sxs-lookup"><span data-stu-id="e96ab-227"><dt><strong>SEC_E_BAD_BINDINGS</strong></dt> <dt>0x80090346L</dt> </span></span></dl></td><td><span data-ttu-id="e96ab-228">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="e96ab-228">The function failed.</span></span> <span data-ttu-id="e96ab-229">Политика привязки канала не была удовлетворена.</span><span class="sxs-lookup"><span data-stu-id="e96ab-229">Channel binding policy was not satisfied.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="e96ab-230"><dt><strong>SEC_E_INCOMPLETE_MESSAGE</strong></dt> <dt>0x80090318L</dt> </span><span class="sxs-lookup"><span data-stu-id="e96ab-230"><dt><strong>SEC_E_INCOMPLETE_MESSAGE</strong></dt> <dt>0x80090318L</dt> </span></span></dl></td><td><span data-ttu-id="e96ab-231">Функция выполнена успешно.</span><span class="sxs-lookup"><span data-stu-id="e96ab-231">The function succeeded.</span></span> <span data-ttu-id="e96ab-232">Данные во входном буфере неполны.</span><span class="sxs-lookup"><span data-stu-id="e96ab-232">The data in the input buffer is incomplete.</span></span> <span data-ttu-id="e96ab-233">Приложение должно считывать дополнительные данные от клиента и вызывать [<strong>AcceptSecurityContext (General)</strong>] (AcceptSecurityContext--General.md) еще раз.</span><span class="sxs-lookup"><span data-stu-id="e96ab-233">The application must read additional data from the client and call [<strong>AcceptSecurityContext (General)</strong>](acceptsecuritycontext--general.md) again.</span></span><br/> <span data-ttu-id="e96ab-234">Это значение может быть возвращено при использовании поставщика общих служб SChannel.</span><span class="sxs-lookup"><span data-stu-id="e96ab-234">This value can be returned when using the Schannel SSP.</span></span> <span data-ttu-id="e96ab-235">Дополнительные сведения об этом возвращаемом значении см. в разделе [<strong>AcceptSecurityContext (Schannel)</strong>] (AcceptSecurityContext--SChannel.md).</span><span class="sxs-lookup"><span data-stu-id="e96ab-235">For more information about this return value, see [<strong>AcceptSecurityContext (Schannel)</strong>](acceptsecuritycontext--schannel.md).</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="e96ab-236"><dt><strong>SEC_E_INSUFFICIENT_MEMORY</strong></dt> <dt>0x80090300L</dt> </span><span class="sxs-lookup"><span data-stu-id="e96ab-236"><dt><strong>SEC_E_INSUFFICIENT_MEMORY</strong></dt> <dt>0x80090300L</dt> </span></span></dl></td><td><span data-ttu-id="e96ab-237">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="e96ab-237">The function failed.</span></span> <span data-ttu-id="e96ab-238">Недостаточно доступной памяти для завершения запрошенного действия.</span><span class="sxs-lookup"><span data-stu-id="e96ab-238">There is not enough memory available to complete the requested action.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="e96ab-239"><dt><strong>SEC_E_INTERNAL_ERROR</strong></dt> <dt>0x80090304L</dt> </span><span class="sxs-lookup"><span data-stu-id="e96ab-239"><dt><strong>SEC_E_INTERNAL_ERROR</strong></dt> <dt>0x80090304L</dt> </span></span></dl></td><td><span data-ttu-id="e96ab-240">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="e96ab-240">The function failed.</span></span> <span data-ttu-id="e96ab-241">Произошла ошибка, которая не сопоставлена с кодом ошибки SSPI.</span><span class="sxs-lookup"><span data-stu-id="e96ab-241">An error occurred that did not map to an SSPI error code.</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="e96ab-242"><dt><strong>SEC_E_INVALID_HANDLE</strong></dt> <dt>0x80100003L</dt> </span><span class="sxs-lookup"><span data-stu-id="e96ab-242"><dt><strong>SEC_E_INVALID_HANDLE</strong></dt> <dt>0x80100003L</dt> </span></span></dl></td><td><span data-ttu-id="e96ab-243">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="e96ab-243">The function failed.</span></span> <span data-ttu-id="e96ab-244">В функцию передан недопустимый маркер.</span><span class="sxs-lookup"><span data-stu-id="e96ab-244">The handle passed to the function is not valid.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="e96ab-245"><dt><strong>SEC_E_INVALID_TOKEN</strong></dt> <dt>0x80090308L</dt> </span><span class="sxs-lookup"><span data-stu-id="e96ab-245"><dt><strong>SEC_E_INVALID_TOKEN</strong></dt> <dt>0x80090308L</dt> </span></span></dl></td><td><span data-ttu-id="e96ab-246">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="e96ab-246">The function failed.</span></span> <span data-ttu-id="e96ab-247">В функцию передан недопустимый токен.</span><span class="sxs-lookup"><span data-stu-id="e96ab-247">The token passed to the function is not valid.</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="e96ab-248"><dt><strong>SEC_E_LOGON_DENIED</strong></dt> <dt>0x8009030CL</dt> </span><span class="sxs-lookup"><span data-stu-id="e96ab-248"><dt><strong>SEC_E_LOGON_DENIED</strong></dt> <dt>0x8009030CL</dt> </span></span></dl></td><td><span data-ttu-id="e96ab-249">Ошибка входа в систему.</span><span class="sxs-lookup"><span data-stu-id="e96ab-249">The logon failed.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="e96ab-250"><dt><strong>SEC_E_NO_AUTHENTICATING_AUTHORITY</strong></dt> <dt>0x80090311L</dt> </span><span class="sxs-lookup"><span data-stu-id="e96ab-250"><dt><strong>SEC_E_NO_AUTHENTICATING_AUTHORITY</strong></dt> <dt>0x80090311L</dt> </span></span></dl></td><td><span data-ttu-id="e96ab-251">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="e96ab-251">The function failed.</span></span> <span data-ttu-id="e96ab-252">Не удалось связаться с центром сертификации для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="e96ab-252">No authority could be contacted for authentication.</span></span> <span data-ttu-id="e96ab-253">Это может быть вызвано следующими причинами.</span><span class="sxs-lookup"><span data-stu-id="e96ab-253">This could be due to the following conditions:</span></span><br/><ul><li><span data-ttu-id="e96ab-254">Неверное доменное имя субъекта проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="e96ab-254">The domain name of the authenticating party is incorrect.</span></span></li><li><span data-ttu-id="e96ab-255">Домен недоступен.</span><span class="sxs-lookup"><span data-stu-id="e96ab-255">The domain is unavailable.</span></span></li><li><span data-ttu-id="e96ab-256">Не удалось установить отношение доверия.</span><span class="sxs-lookup"><span data-stu-id="e96ab-256">The trust relationship has failed.</span></span></li></ul></td></tr><tr class="odd"><td><dl> <span data-ttu-id="e96ab-257"><dt><strong>SEC_E_NO_CREDENTIALS</strong></dt> <dt>0x8009030EL</dt> </span><span class="sxs-lookup"><span data-stu-id="e96ab-257"><dt><strong>SEC_E_NO_CREDENTIALS</strong></dt> <dt>0x8009030EL</dt> </span></span></dl></td><td><span data-ttu-id="e96ab-258">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="e96ab-258">The function failed.</span></span> <span data-ttu-id="e96ab-259">Недопустимый обработчик учетных данных, указанный в параметре <em>фкредентиал</em> .</span><span class="sxs-lookup"><span data-stu-id="e96ab-259">The credentials handle specified in the <em>phCredential</em> parameter is not valid.</span></span> <span data-ttu-id="e96ab-260">Это значение может быть возвращено при использовании дайджеста или поставщика общих служб SChannel.</span><span class="sxs-lookup"><span data-stu-id="e96ab-260">This value can be returned when using the Digest or Schannel SSP.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="e96ab-261"><dt><strong>SEC_E_OK</strong></dt> <dt>0x00000000</dt> </span><span class="sxs-lookup"><span data-stu-id="e96ab-261"><dt><strong>SEC_E_OK</strong></dt> <dt>0x00000000L</dt> </span></span></dl></td><td><span data-ttu-id="e96ab-262">Функция выполнена успешно.</span><span class="sxs-lookup"><span data-stu-id="e96ab-262">The function succeeded.</span></span> <span data-ttu-id="e96ab-263">Был принят [*контекст безопасности*](../secgloss/s-gly.md) , полученный от клиента.</span><span class="sxs-lookup"><span data-stu-id="e96ab-263">The [*security context*](../secgloss/s-gly.md) received from the client was accepted.</span></span> <span data-ttu-id="e96ab-264">Если выходная лексема была создана функцией, она должна быть отправлена в клиентский процесс.</span><span class="sxs-lookup"><span data-stu-id="e96ab-264">If an output token was generated by the function, it must be sent to the client process.</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="e96ab-265"><dt><strong>SEC_E_SECURITY_QOS_FAILED</strong></dt> <dt>0x80090332L</dt> </span><span class="sxs-lookup"><span data-stu-id="e96ab-265"><dt><strong>SEC_E_SECURITY_QOS_FAILED</strong></dt> <dt>0x80090332L</dt> </span></span></dl></td><td><span data-ttu-id="e96ab-266">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="e96ab-266">The function failed.</span></span> <span data-ttu-id="e96ab-267">В параметре <em>фконтекстрек</em> указан недопустимый флаг атрибута контекста.</span><span class="sxs-lookup"><span data-stu-id="e96ab-267">A context attribute flag that is not valid was specified in the <em>fContextReq</em> parameter.</span></span> <span data-ttu-id="e96ab-268">Это значение может быть возвращено при использовании дайджест-поставщика общих служб.</span><span class="sxs-lookup"><span data-stu-id="e96ab-268">This value can be returned when using the Digest SSP.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="e96ab-269"><dt><strong>SEC_E_UNSUPPORTED_FUNCTION</strong></dt> <dt>0x80090302L</dt> </span><span class="sxs-lookup"><span data-stu-id="e96ab-269"><dt><strong>SEC_E_UNSUPPORTED_FUNCTION</strong></dt> <dt>0x80090302L</dt> </span></span></dl></td><td><span data-ttu-id="e96ab-270">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="e96ab-270">The function failed.</span></span> <span data-ttu-id="e96ab-271">Недопустимый флаг атрибута контекста (ASC_REQ_DELEGATE или ASC_REQ_PROMPT_FOR_CREDS) был указан в параметре <em>фконтекстрек</em> .</span><span class="sxs-lookup"><span data-stu-id="e96ab-271">A context attribute flag that is not valid (ASC_REQ_DELEGATE or ASC_REQ_PROMPT_FOR_CREDS) was specified in the <em>fContextReq</em> parameter.</span></span> <span data-ttu-id="e96ab-272">Это значение может быть возвращено при использовании поставщика общих служб SChannel.</span><span class="sxs-lookup"><span data-stu-id="e96ab-272">This value can be returned when using the Schannel SSP.</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="e96ab-273"><dt><strong>SEC_I_COMPLETE_AND_CONTINUE</strong></dt> <dt>0x00090314L</dt> </span><span class="sxs-lookup"><span data-stu-id="e96ab-273"><dt><strong>SEC_I_COMPLETE_AND_CONTINUE</strong></dt> <dt>0x00090314L</dt> </span></span></dl></td><td><span data-ttu-id="e96ab-274">Функция выполнена успешно.</span><span class="sxs-lookup"><span data-stu-id="e96ab-274">The function succeeded.</span></span> <span data-ttu-id="e96ab-275">Сервер должен вызвать [<strong>CompleteAuthToken</strong>] (/Windows/Win32/API/SSPI/NF-SSPI-completeauthtoken) и передать выходной токен клиенту.</span><span class="sxs-lookup"><span data-stu-id="e96ab-275">The server must call [<strong>CompleteAuthToken</strong>](/windows/win32/api/sspi/nf-sspi-completeauthtoken) and pass the output token to the client.</span></span> <span data-ttu-id="e96ab-276">Затем сервер ждет возврата токена от клиента, а затем выполняет еще один вызов [<strong>AcceptSecurityContext (General)</strong>] (AcceptSecurityContext--General.md).</span><span class="sxs-lookup"><span data-stu-id="e96ab-276">The server then waits for a return token from the client and then makes another call to [<strong>AcceptSecurityContext (General)</strong>](acceptsecuritycontext--general.md).</span></span> <br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="e96ab-277"><dt><strong>SEC_I_COMPLETE_NEEDED</strong></dt> <dt>0x00090313L</dt> </span><span class="sxs-lookup"><span data-stu-id="e96ab-277"><dt><strong>SEC_I_COMPLETE_NEEDED</strong></dt> <dt>0x00090313L</dt> </span></span></dl></td><td><span data-ttu-id="e96ab-278">Функция выполнена успешно.</span><span class="sxs-lookup"><span data-stu-id="e96ab-278">The function succeeded.</span></span> <span data-ttu-id="e96ab-279">Сервер должен завершить создание сообщения от клиента, а затем вызвать функцию [<strong>CompleteAuthToken</strong>] (/Windows/Win32/API/SSPI/NF-SSPI-completeauthtoken).</span><span class="sxs-lookup"><span data-stu-id="e96ab-279">The server must finish building the message from the client and then call the [<strong>CompleteAuthToken</strong>](/windows/win32/api/sspi/nf-sspi-completeauthtoken) function.</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="e96ab-280"><dt><strong>SEC_I_CONTINUE_NEEDED</strong></dt> <dt>0x00090312L</dt> </span><span class="sxs-lookup"><span data-stu-id="e96ab-280"><dt><strong>SEC_I_CONTINUE_NEEDED</strong></dt> <dt>0x00090312L</dt> </span></span></dl></td><td><span data-ttu-id="e96ab-281">Функция выполнена успешно.</span><span class="sxs-lookup"><span data-stu-id="e96ab-281">The function succeeded.</span></span> <span data-ttu-id="e96ab-282">Сервер должен отправить выходной токен клиенту и дождаться возвращенного маркера.</span><span class="sxs-lookup"><span data-stu-id="e96ab-282">The server must send the output token to the client and wait for a returned token.</span></span> <span data-ttu-id="e96ab-283">Возвращаемый токен должен передаваться в <em>пинпут</em> для другого вызова [<strong>AcceptSecurityContext (General)</strong>] (AcceptSecurityContext--General.md).</span><span class="sxs-lookup"><span data-stu-id="e96ab-283">The returned token should be passed in <em>pInput</em> for another call to [<strong>AcceptSecurityContext (General)</strong>](acceptsecuritycontext--general.md).</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="e96ab-284"><dt><strong>STATUS_LOGON_FAILURE</strong></dt> <dt>0xC000006DL</dt> </span><span class="sxs-lookup"><span data-stu-id="e96ab-284"><dt><strong>STATUS_LOGON_FAILURE</strong></dt> <dt>0xC000006DL</dt> </span></span></dl></td><td><span data-ttu-id="e96ab-285">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="e96ab-285">The function failed.</span></span> <span data-ttu-id="e96ab-286">Функция [<strong>AcceptSecurityContext (General)</strong>] (AcceptSecurityContext--General.md) была вызвана после установки указанного контекста.</span><span class="sxs-lookup"><span data-stu-id="e96ab-286">The [<strong>AcceptSecurityContext (General)</strong>](acceptsecuritycontext--general.md) function was called after the specified context was established.</span></span> <span data-ttu-id="e96ab-287">Это значение может быть возвращено при использовании дайджест-поставщика общих служб.</span><span class="sxs-lookup"><span data-stu-id="e96ab-287">This value can be returned when using the Digest SSP.</span></span><br/></td></tr></tbody></table>



 

## <a name="remarks"></a><span data-ttu-id="e96ab-288">Комментарии</span><span class="sxs-lookup"><span data-stu-id="e96ab-288">Remarks</span></span>

<span data-ttu-id="e96ab-289">Функция **AcceptSecurityContext (General)** — это серверный аналог функции [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md) .</span><span class="sxs-lookup"><span data-stu-id="e96ab-289">The **AcceptSecurityContext (General)** function is the server counterpart to the [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md) function.</span></span>

<span data-ttu-id="e96ab-290">Когда сервер получает запрос от клиента, сервер использует параметр *фконтекстрек* , чтобы указать, что он требует для сеанса.</span><span class="sxs-lookup"><span data-stu-id="e96ab-290">When the server receives a request from a client, the server uses the *fContextReq* parameter to specify what it requires of the session.</span></span> <span data-ttu-id="e96ab-291">Таким образом, сервер может указать, что клиенты должны иметь возможность использовать конфиденциальную сессию или сеанс с проверкой [*целостности*](../secgloss/i-gly.md), а также могут отклонять клиенты, которые не могут удовлетворить это требование.</span><span class="sxs-lookup"><span data-stu-id="e96ab-291">In this fashion, a server can specify that clients must be capable of using a confidential or [*integrity*](../secgloss/i-gly.md)-checked session, and it can reject clients that cannot meet that demand.</span></span> <span data-ttu-id="e96ab-292">Кроме того, сервер может не потребовать ничего, а любой клиент, который может предоставить или требуется, возвращается в параметре *пфконтекстаттр* .</span><span class="sxs-lookup"><span data-stu-id="e96ab-292">Alternatively, a server can require nothing, and whatever the client can provide or requires is returned in the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="e96ab-293">Для пакета, поддерживающего многоэтапную проверку подлинности, например взаимную проверку подлинности, вызывающая последовательность выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="e96ab-293">For a package that supports multiple-leg authentication, such as mutual authentication, the calling sequence is as follows:</span></span>

1.  <span data-ttu-id="e96ab-294">Клиент передает токен на сервер.</span><span class="sxs-lookup"><span data-stu-id="e96ab-294">The client transmits a token to the server.</span></span>
2.  <span data-ttu-id="e96ab-295">Сервер вызывает **AcceptSecurityContext (Общие)** в первый раз, что создает маркер ответа, который затем отправляется клиенту.</span><span class="sxs-lookup"><span data-stu-id="e96ab-295">The server calls **AcceptSecurityContext (General)** the first time, which generates a reply token that is then sent to the client.</span></span>
3.  <span data-ttu-id="e96ab-296">Клиент получает маркер и передает его в [**InitializeSecurityContext (Общие)**](initializesecuritycontext--general.md).</span><span class="sxs-lookup"><span data-stu-id="e96ab-296">The client receives the token and passes it to [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md).</span></span> <span data-ttu-id="e96ab-297">Если **InitializeSecurityContext (Общие)** возвращает значение \_ \_ в секунду, то выполнена взаимная проверка подлинности, и может начаться безопасный сеанс.</span><span class="sxs-lookup"><span data-stu-id="e96ab-297">If **InitializeSecurityContext (General)** returns SEC\_E\_OK, mutual authentication has been completed and a secure session can begin.</span></span> <span data-ttu-id="e96ab-298">Если **InitializeSecurityContext (Общие)** возвращает код ошибки, согласование взаимной проверки подлинности завершается.</span><span class="sxs-lookup"><span data-stu-id="e96ab-298">If **InitializeSecurityContext (General)** returns an error code, the mutual authentication negotiation ends.</span></span> <span data-ttu-id="e96ab-299">В противном случае маркер безопасности, возвращенный **InitializeSecurityContext (General)** , отправляется клиенту, а шаги 2 и 3 повторяются.</span><span class="sxs-lookup"><span data-stu-id="e96ab-299">Otherwise, the security token returned by **InitializeSecurityContext (General)** is sent to the client, and steps 2 and 3 are repeated.</span></span>

<span data-ttu-id="e96ab-300">Параметры *фконтекстрек* и *пфконтекстаттр* представляют собой битовую маску, представляющую различные атрибуты контекста.</span><span class="sxs-lookup"><span data-stu-id="e96ab-300">The *fContextReq* and *pfContextAttr* parameters are bitmasks that represent various context attributes.</span></span> <span data-ttu-id="e96ab-301">Описание различных атрибутов см. в разделе [требования к контексту](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="e96ab-301">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span>

> [!Note]  
> <span data-ttu-id="e96ab-302">Параметр *пфконтекстаттр* допустим при любом успешном возвращении, но только при окончательном успешном возвращении следует изучить флаги, относящиеся к аспектам безопасности контекста.</span><span class="sxs-lookup"><span data-stu-id="e96ab-302">The *pfContextAttr* parameter is valid on any successful return, but only on the final successful return should you examine the flags pertaining to security aspects of the context.</span></span> <span data-ttu-id="e96ab-303">Промежуточные возвраты могут задавать, например, \_ флаг « \_ Выделенная память ISC» \_ .</span><span class="sxs-lookup"><span data-stu-id="e96ab-303">Intermediate returns can set, for example, the ISC\_RET\_ALLOCATED\_MEMORY flag.</span></span>

 

<span data-ttu-id="e96ab-304">Вызывающий объект отвечает за определение того, достаточно ли атрибутов последнего контекста.</span><span class="sxs-lookup"><span data-stu-id="e96ab-304">The caller is responsible for determining whether the final context attributes are sufficient.</span></span> <span data-ttu-id="e96ab-305">Если, например, был запрошен параметр конфиденциальность (шифрование), но его не удалось установить, некоторые приложения могут немедленно завершить подключение.</span><span class="sxs-lookup"><span data-stu-id="e96ab-305">If, for example, confidentiality (encryption) was requested, but could not be established, some applications may choose to shut down the connection immediately.</span></span> <span data-ttu-id="e96ab-306">Если невозможно установить [*контекст безопасности*](../secgloss/s-gly.md) , сервер должен освободить частично созданный контекст, вызвав функцию [**делетесекуритиконтекст**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) .</span><span class="sxs-lookup"><span data-stu-id="e96ab-306">If the [*security context*](../secgloss/s-gly.md) cannot be established, the server must free the partially created context by calling the [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) function.</span></span> <span data-ttu-id="e96ab-307">Сведения о том, когда следует вызывать функцию **делетесекуритиконтекст** , см. в разделе **делетесекуритиконтекст**.</span><span class="sxs-lookup"><span data-stu-id="e96ab-307">For information about when to call the **DeleteSecurityContext** function, see **DeleteSecurityContext**.</span></span>

<span data-ttu-id="e96ab-308">После установки [*контекста безопасности*](../secgloss/s-gly.md) серверное приложение может использовать функцию [**куерисекуритиконтексттокен**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) для получения маркера учетной записи пользователя, которой сопоставлен сертификат клиента.</span><span class="sxs-lookup"><span data-stu-id="e96ab-308">After the [*security context*](../secgloss/s-gly.md) has been established, the server application can use the [**QuerySecurityContextToken**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) function to retrieve a handle to the user account to which the client certificate was mapped.</span></span> <span data-ttu-id="e96ab-309">Кроме того, сервер может использовать функцию [**имперсонатесекуритиконтекст**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) для олицетворения пользователя.</span><span class="sxs-lookup"><span data-stu-id="e96ab-309">Also, the server can use the [**ImpersonateSecurityContext**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) function to impersonate the user.</span></span>

## <a name="requirements"></a><span data-ttu-id="e96ab-310">Требования</span><span class="sxs-lookup"><span data-stu-id="e96ab-310">Requirements</span></span>



| <span data-ttu-id="e96ab-311">Требование</span><span class="sxs-lookup"><span data-stu-id="e96ab-311">Requirement</span></span> | <span data-ttu-id="e96ab-312">Значение</span><span class="sxs-lookup"><span data-stu-id="e96ab-312">Value</span></span> |
|-------------------------------------|--------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="e96ab-313">Минимальная версия клиента</span><span class="sxs-lookup"><span data-stu-id="e96ab-313">Minimum supported client</span></span><br/> | <span data-ttu-id="e96ab-314">Только для \[ классических приложений Windows XP\]</span><span class="sxs-lookup"><span data-stu-id="e96ab-314">Windows XP \[desktop apps only\]</span></span><br/>                                                            |
| <span data-ttu-id="e96ab-315">Минимальная версия сервера</span><span class="sxs-lookup"><span data-stu-id="e96ab-315">Minimum supported server</span></span><br/> | <span data-ttu-id="e96ab-316">\[Только для настольных приложений Windows Server 2003\]</span><span class="sxs-lookup"><span data-stu-id="e96ab-316">Windows Server 2003 \[desktop apps only\]</span></span><br/>                                                   |
| <span data-ttu-id="e96ab-317">Header</span><span class="sxs-lookup"><span data-stu-id="e96ab-317">Header</span></span><br/>                   | <dl> <span data-ttu-id="e96ab-318"><dt>SSPI. h (включая Security. h)</dt></span><span class="sxs-lookup"><span data-stu-id="e96ab-318"><dt>Sspi.h (include Security.h)</dt></span></span> </dl> |
| <span data-ttu-id="e96ab-319">Библиотека</span><span class="sxs-lookup"><span data-stu-id="e96ab-319">Library</span></span><br/>                  | <dl> <span data-ttu-id="e96ab-320"><dt>Secur32. lib</dt></span><span class="sxs-lookup"><span data-stu-id="e96ab-320"><dt>Secur32.lib</dt></span></span> </dl>                 |
| <span data-ttu-id="e96ab-321">DLL</span><span class="sxs-lookup"><span data-stu-id="e96ab-321">DLL</span></span><br/>                      | <dl> <span data-ttu-id="e96ab-322"><dt>Secur32.dll</dt></span><span class="sxs-lookup"><span data-stu-id="e96ab-322"><dt>Secur32.dll</dt></span></span> </dl>                 |



## <a name="see-also"></a><span data-ttu-id="e96ab-323">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="e96ab-323">See also</span></span>

<dl> <dt>

[<span data-ttu-id="e96ab-324">Функции SSPI</span><span class="sxs-lookup"><span data-stu-id="e96ab-324">SSPI Functions</span></span>](authentication-functions.md#sspi-functions)
</dt> <dt>

[<span data-ttu-id="e96ab-325">**делетесекуритиконтекст**</span><span class="sxs-lookup"><span data-stu-id="e96ab-325">**DeleteSecurityContext**</span></span>](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext)
</dt> <dt>

[<span data-ttu-id="e96ab-326">**InitializeSecurityContext (Общие)**</span><span class="sxs-lookup"><span data-stu-id="e96ab-326">**InitializeSecurityContext (General)**</span></span>](initializesecuritycontext--general.md)
</dt> </dl>

 

 
